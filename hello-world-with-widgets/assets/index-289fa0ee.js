var JY=Object.defineProperty;var QY=(r,t,e)=>t in r?JY(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var st=(r,t,e)=>(QY(r,typeof t!="symbol"?t+"":t,e),e);function tK(r,t){for(var e=0;e<t.length;e++){const i=t[e];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in r)){const a=Object.getOwnPropertyDescriptor(i,n);a&&Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();var eK=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var NU={exports:{}};(function(r,t){(function(e,i){r.exports=i()})(eK,function(){var e,i,n;function a(o,l){if(!e)e=l;else if(!i)i=l;else{var u="var sharedChunk = {}; ("+e+")(sharedChunk); ("+i+")(sharedChunk);",c={};e(c),n=l(c),typeof window<"u"&&(n.workerUrl=window.URL.createObjectURL(new Blob([u],{type:"text/javascript"})))}}a(["exports"],function(o){function l(g,f,m,b){return new(m||(m=Promise))(function(A,P){function D($){try{z(b.next($))}catch(X){P(X)}}function k($){try{z(b.throw($))}catch(X){P(X)}}function z($){var X;$.done?A($.value):(X=$.value,X instanceof m?X:new m(function(K){K(X)})).then(D,k)}z((b=b.apply(g,f||[])).next())})}function u(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}typeof SuppressedError=="function"&&SuppressedError;var c=h;function h(g,f){this.x=g,this.y=f}h.prototype={clone:function(){return new h(this.x,this.y)},add:function(g){return this.clone()._add(g)},sub:function(g){return this.clone()._sub(g)},multByPoint:function(g){return this.clone()._multByPoint(g)},divByPoint:function(g){return this.clone()._divByPoint(g)},mult:function(g){return this.clone()._mult(g)},div:function(g){return this.clone()._div(g)},rotate:function(g){return this.clone()._rotate(g)},rotateAround:function(g,f){return this.clone()._rotateAround(g,f)},matMult:function(g){return this.clone()._matMult(g)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(g){return this.x===g.x&&this.y===g.y},dist:function(g){return Math.sqrt(this.distSqr(g))},distSqr:function(g){var f=g.x-this.x,m=g.y-this.y;return f*f+m*m},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(g){return Math.atan2(this.y-g.y,this.x-g.x)},angleWith:function(g){return this.angleWithSep(g.x,g.y)},angleWithSep:function(g,f){return Math.atan2(this.x*f-this.y*g,this.x*g+this.y*f)},_matMult:function(g){var f=g[2]*this.x+g[3]*this.y;return this.x=g[0]*this.x+g[1]*this.y,this.y=f,this},_add:function(g){return this.x+=g.x,this.y+=g.y,this},_sub:function(g){return this.x-=g.x,this.y-=g.y,this},_mult:function(g){return this.x*=g,this.y*=g,this},_div:function(g){return this.x/=g,this.y/=g,this},_multByPoint:function(g){return this.x*=g.x,this.y*=g.y,this},_divByPoint:function(g){return this.x/=g.x,this.y/=g.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var g=this.y;return this.y=this.x,this.x=-g,this},_rotate:function(g){var f=Math.cos(g),m=Math.sin(g),b=m*this.x+f*this.y;return this.x=f*this.x-m*this.y,this.y=b,this},_rotateAround:function(g,f){var m=Math.cos(g),b=Math.sin(g),A=f.y+b*(this.x-f.x)+m*(this.y-f.y);return this.x=f.x+m*(this.x-f.x)-b*(this.y-f.y),this.y=A,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(g){return g instanceof h?g:Array.isArray(g)?new h(g[0],g[1]):g};var p=u(c),v=y;function y(g,f,m,b){this.cx=3*g,this.bx=3*(m-g)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*f,this.by=3*(b-f)-this.cy,this.ay=1-this.cy-this.by,this.p1x=g,this.p1y=f,this.p2x=m,this.p2y=b}y.prototype={sampleCurveX:function(g){return((this.ax*g+this.bx)*g+this.cx)*g},sampleCurveY:function(g){return((this.ay*g+this.by)*g+this.cy)*g},sampleCurveDerivativeX:function(g){return(3*this.ax*g+2*this.bx)*g+this.cx},solveCurveX:function(g,f){if(f===void 0&&(f=1e-6),g<0)return 0;if(g>1)return 1;for(var m=g,b=0;b<8;b++){var A=this.sampleCurveX(m)-g;if(Math.abs(A)<f)return m;var P=this.sampleCurveDerivativeX(m);if(Math.abs(P)<1e-6)break;m-=A/P}var D=0,k=1;for(m=g,b=0;b<20&&(A=this.sampleCurveX(m),!(Math.abs(A-g)<f));b++)g>A?D=m:k=m,m=.5*(k-D)+D;return m},solve:function(g,f){return this.sampleCurveY(this.solveCurveX(g,f))}};var x=u(v);let w,T;function E(){return w==null&&(w=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),w}function M(){if(T==null&&(T=!1,E())){const f=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(f){for(let b=0;b<5*5;b++){const A=4*b;f.fillStyle=`rgb(${A},${A+1},${A+2})`,f.fillRect(b%5,Math.floor(b/5),1,1)}const m=f.getImageData(0,0,5,5).data;for(let b=0;b<5*5*4;b++)if(b%4!=3&&m[b]!==b){T=!0;break}}}return T||!1}function L(g,f,m,b){const A=new x(g,f,m,b);return function(P){return A.solve(P)}}const F=L(.25,.1,.25,1);function O(g,f,m){return Math.min(m,Math.max(f,g))}function U(g,f,m){const b=m-f,A=((g-f)%b+b)%b+f;return A===f?m:A}function W(g,...f){for(const m of f)for(const b in m)g[b]=m[b];return g}let H=1;function j(g,f,m){const b={};for(const A in g)b[A]=f.call(m||this,g[A],A,g);return b}function Y(g,f,m){const b={};for(const A in g)f.call(m||this,g[A],A,g)&&(b[A]=g[A]);return b}function tt(g){return Array.isArray(g)?g.map(tt):typeof g=="object"&&g?j(g,tt):g}const it={};function lt(g){it[g]||(typeof console<"u"&&console.warn(g),it[g]=!0)}function ht(g,f,m){return(m.y-g.y)*(f.x-g.x)>(f.y-g.y)*(m.x-g.x)}function Tt(g){let f=0;for(let m,b,A=0,P=g.length,D=P-1;A<P;D=A++)m=g[A],b=g[D],f+=(b.x-m.x)*(m.y+b.y);return f}function Ot(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Rt=null;function Ut(g){return typeof ImageBitmap<"u"&&g instanceof ImageBitmap}const Jt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ne(g,f,m,b,A){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const P=new VideoFrame(g,{timestamp:0});try{const D=P==null?void 0:P.format;if(!D||!D.startsWith("BGR")&&!D.startsWith("RGB"))throw new Error(`Unrecognized format ${D}`);const k=D.startsWith("BGR"),z=new Uint8ClampedArray(b*A*4);if(yield P.copyTo(z,function($,X,K,et,at){const ot=4*Math.max(-X,0),pt=(Math.max(0,K)-K)*et*4+ot,bt=4*et,Ct=Math.max(0,X),kt=Math.max(0,K);return{rect:{x:Ct,y:kt,width:Math.min($.width,X+et)-Ct,height:Math.min($.height,K+at)-kt},layout:[{offset:pt,stride:bt}]}}(g,f,m,b,A)),k)for(let $=0;$<z.length;$+=4){const X=z[$];z[$]=z[$+2],z[$+2]=X}return z}finally{P.close()}})}let se,ce,ye,Qe;const sr={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(g){const f=requestAnimationFrame(g);return{cancel:()=>cancelAnimationFrame(f)}},getImageData(g,f=0){return this.getImageCanvasContext(g).getImageData(-f,-f,g.width+2*f,g.height+2*f)},getImageCanvasContext(g){const f=window.document.createElement("canvas"),m=f.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return f.width=g.width,f.height=g.height,m.drawImage(g,0,0,g.width,g.height),m},resolveURL:g=>(ye||(ye=document.createElement("a")),ye.href=g,ye.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Qe==null&&(Qe=matchMedia("(prefers-reduced-motion: reduce)")),Qe.matches)}},ke={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Ce extends Error{constructor(f,m,b,A){super(`AJAXError: ${m} (${f}): ${b}`),this.status=f,this.statusText=m,this.url=b,this.body=A}}const Ee=Ot()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Ie=g=>ke.REGISTERED_PROTOCOLS[g.substring(0,g.indexOf("://"))];function Se(g,f){const m=new AbortController,b=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:Ee(),signal:m.signal});let A=!1,P=!1;return g.type==="json"&&b.headers.set("Accept","application/json"),P||fetch(b).then(D=>D.ok?(k=>{(g.type==="arrayBuffer"||g.type==="image"?k.arrayBuffer():g.type==="json"?k.json():k.text()).then(z=>{P||(A=!0,f(null,z,k.headers.get("Cache-Control"),k.headers.get("Expires")))}).catch(z=>{P||f(new Error(z.message))})})(D):D.blob().then(k=>f(new Ce(D.status,D.statusText,g.url,k)))).catch(D=>{D.code!==20&&f(new Error(D.message))}),{cancel:()=>{P=!0,A||m.abort()}}}const Fe=function(g,f){if(/:\/\//.test(g.url)&&!/^https?:|^file:/.test(g.url)){if(Ot()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",g,f);if(!Ot())return(Ie(g.url)||Se)(g,f)}if(!(/^file:/.test(m=g.url)||/^file:/.test(Ee())&&!/^\w+:/.test(m))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Se(g,f);if(Ot()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",g,f,void 0,!0)}var m;return function(b,A){const P=new XMLHttpRequest;P.open(b.method||"GET",b.url,!0),b.type!=="arrayBuffer"&&b.type!=="image"||(P.responseType="arraybuffer");for(const D in b.headers)P.setRequestHeader(D,b.headers[D]);return b.type==="json"&&(P.responseType="text",P.setRequestHeader("Accept","application/json")),P.withCredentials=b.credentials==="include",P.onerror=()=>{A(new Error(P.statusText))},P.onload=()=>{if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){let D=P.response;if(b.type==="json")try{D=JSON.parse(P.response)}catch(k){return A(k)}A(null,D,P.getResponseHeader("Cache-Control"),P.getResponseHeader("Expires"))}else{const D=new Blob([P.response],{type:P.getResponseHeader("Content-Type")});A(new Ce(P.status,P.statusText,b.url,D))}},P.send(b.body),{cancel:()=>P.abort()}}(g,f)},Rr=function(g,f){return Fe(W(g,{type:"arrayBuffer"}),f)};function tr(g){if(!g||g.indexOf("://")<=0||g.indexOf("data:image/")===0||g.indexOf("blob:")===0)return!0;const f=new URL(g),m=window.location;return f.protocol===m.protocol&&f.host===m.host}function Vr(g,f,m){m[g]&&m[g].indexOf(f)!==-1||(m[g]=m[g]||[],m[g].push(f))}function _r(g,f,m){if(m&&m[g]){const b=m[g].indexOf(f);b!==-1&&m[g].splice(b,1)}}class Xr{constructor(f,m={}){W(this,m),this.type=f}}class Hi extends Xr{constructor(f,m={}){super("error",W({error:f},m))}}class wi{on(f,m){return this._listeners=this._listeners||{},Vr(f,m,this._listeners),this}off(f,m){return _r(f,m,this._listeners),_r(f,m,this._oneTimeListeners),this}once(f,m){return m?(this._oneTimeListeners=this._oneTimeListeners||{},Vr(f,m,this._oneTimeListeners),this):new Promise(b=>this.once(f,b))}fire(f,m){typeof f=="string"&&(f=new Xr(f,m||{}));const b=f.type;if(this.listens(b)){f.target=this;const A=this._listeners&&this._listeners[b]?this._listeners[b].slice():[];for(const k of A)k.call(this,f);const P=this._oneTimeListeners&&this._oneTimeListeners[b]?this._oneTimeListeners[b].slice():[];for(const k of P)_r(b,k,this._oneTimeListeners),k.call(this,f);const D=this._eventedParent;D&&(W(f,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(f))}else f instanceof Hi&&console.error(f.error);return this}listens(f){return this._listeners&&this._listeners[f]&&this._listeners[f].length>0||this._oneTimeListeners&&this._oneTimeListeners[f]&&this._oneTimeListeners[f].length>0||this._eventedParent&&this._eventedParent.listens(f)}setEventedParent(f,m){return this._eventedParent=f,this._eventedParentData=m,this}}var qt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ur=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function wn(g,f){const m={};for(const b in g)b!=="ref"&&(m[b]=g[b]);return Ur.forEach(b=>{b in f&&(m[b]=f[b])}),m}function Gr(g,f){if(Array.isArray(g)){if(!Array.isArray(f)||g.length!==f.length)return!1;for(let m=0;m<g.length;m++)if(!Gr(g[m],f[m]))return!1;return!0}if(typeof g=="object"&&g!==null&&f!==null){if(typeof f!="object"||Object.keys(g).length!==Object.keys(f).length)return!1;for(const m in g)if(!Gr(g[m],f[m]))return!1;return!0}return g===f}const $r={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ya(g,f,m){m.push({command:$r.addSource,args:[g,f[g]]})}function Wo(g,f,m){f.push({command:$r.removeSource,args:[g]}),m[g]=!0}function Ka(g,f,m,b){Wo(g,m,b),Ya(g,f,m)}function Ml(g,f,m){let b;for(b in g[m])if(Object.prototype.hasOwnProperty.call(g[m],b)&&b!=="data"&&!Gr(g[m][b],f[m][b]))return!1;for(b in f[m])if(Object.prototype.hasOwnProperty.call(f[m],b)&&b!=="data"&&!Gr(g[m][b],f[m][b]))return!1;return!0}function uo(g,f,m,b,A,P){let D;for(D in f=f||{},g=g||{})Object.prototype.hasOwnProperty.call(g,D)&&(Gr(g[D],f[D])||m.push({command:P,args:[b,D,f[D],A]}));for(D in f)Object.prototype.hasOwnProperty.call(f,D)&&!Object.prototype.hasOwnProperty.call(g,D)&&(Gr(g[D],f[D])||m.push({command:P,args:[b,D,f[D],A]}))}function gs(g){return g.id}function Ja(g,f){return g[f.id]=f,g}class de{constructor(f,m,b,A){this.message=(f?`${f}: `:"")+b,A&&(this.identifier=A),m!=null&&m.__line__&&(this.line=m.__line__)}}function Qa(g,...f){for(const m of f)for(const b in m)g[b]=m[b];return g}class Si extends Error{constructor(f,m){super(m),this.message=m,this.key=f}}class co{constructor(f,m=[]){this.parent=f,this.bindings={};for(const[b,A]of m)this.bindings[b]=A}concat(f){return new co(this,f)}get(f){if(this.bindings[f])return this.bindings[f];if(this.parent)return this.parent.get(f);throw new Error(`${f} not found in scope.`)}has(f){return!!this.bindings[f]||!!this.parent&&this.parent.has(f)}}const vs={kind:"null"},ge={kind:"number"},fr={kind:"string"},ur={kind:"boolean"},Sn={kind:"color"},Aa={kind:"object"},dr={kind:"value"},Ca={kind:"collator"},yt={kind:"formatted"},Q={kind:"padding"},rt={kind:"resolvedImage"},ct={kind:"variableAnchorOffsetCollection"};function xt(g,f){return{kind:"array",itemType:g,N:f}}function wt(g){if(g.kind==="array"){const f=wt(g.itemType);return typeof g.N=="number"?`array<${f}, ${g.N}>`:g.itemType.kind==="value"?"array":`array<${f}>`}return g.kind}const Nt=[vs,ge,fr,ur,Sn,yt,Aa,xt(dr),Q,rt,ct];function Mt(g,f){if(f.kind==="error")return null;if(g.kind==="array"){if(f.kind==="array"&&(f.N===0&&f.itemType.kind==="value"||!Mt(g.itemType,f.itemType))&&(typeof g.N!="number"||g.N===f.N))return null}else{if(g.kind===f.kind)return null;if(g.kind==="value"){for(const m of Nt)if(!Mt(m,f))return null}}return`Expected ${wt(g)} but found ${wt(f)} instead.`}function At(g,f){return f.some(m=>m.kind===g.kind)}function Dt(g,f){return f.some(m=>m==="null"?g===null:m==="array"?Array.isArray(g):m==="object"?g&&!Array.isArray(g)&&typeof g=="object":m===typeof g)}function Yt(g,f){return g.kind==="array"&&f.kind==="array"?g.itemType.kind===f.itemType.kind&&typeof g.N=="number":g.kind===f.kind}const Qt=.96422,ie=.82521,Xe=4/29,ar=6/29,Oe=3*ar*ar,qe=ar*ar*ar,or=Math.PI/180,Hr=180/Math.PI;function Zr(g){return(g%=360)<0&&(g+=360),g}function yr([g,f,m,b]){let A,P;const D=Ni((.2225045*(g=xr(g))+.7168786*(f=xr(f))+.0606169*(m=xr(m)))/1);g===f&&f===m?A=P=D:(A=Ni((.4360747*g+.3850649*f+.1430804*m)/Qt),P=Ni((.0139322*g+.0971045*f+.7141733*m)/ie));const k=116*D-16;return[k<0?0:k,500*(A-D),200*(D-P),b]}function xr(g){return g<=.04045?g/12.92:Math.pow((g+.055)/1.055,2.4)}function Ni(g){return g>qe?Math.pow(g,1/3):g/Oe+Xe}function Kr([g,f,m,b]){let A=(g+16)/116,P=isNaN(f)?A:A+f/500,D=isNaN(m)?A:A-m/200;return A=1*an(A),P=Qt*an(P),D=ie*an(D),[Ii(3.1338561*P-1.6168667*A-.4906146*D),Ii(-.9787684*P+1.9161415*A+.033454*D),Ii(.0719453*P-.2289914*A+1.4052427*D),b]}function Ii(g){return(g=g<=.00304?12.92*g:1.055*Math.pow(g,1/2.4)-.055)<0?0:g>1?1:g}function an(g){return g>ar?g*g*g:Oe*(g-Xe)}function na(g){return parseInt(g.padEnd(2,g),16)/255}function Pl(g,f){return sn(f?g/100:g,0,1)}function sn(g,f,m){return Math.min(Math.max(f,g),m)}function Ea(g){return!g.some(Number.isNaN)}const Ps={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ar{constructor(f,m,b,A=1,P=!0){this.r=f,this.g=m,this.b=b,this.a=A,P||(this.r*=A,this.g*=A,this.b*=A,A||this.overwriteGetter("rgb",[f,m,b,A]))}static parse(f){if(f instanceof Ar)return f;if(typeof f!="string")return;const m=function(b){if((b=b.toLowerCase().trim())==="transparent")return[0,0,0,0];const A=Ps[b];if(A){const[D,k,z]=A;return[D/255,k/255,z/255,1]}if(b.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(b)){const D=b.length<6?1:2;let k=1;return[na(b.slice(k,k+=D)),na(b.slice(k,k+=D)),na(b.slice(k,k+=D)),na(b.slice(k,k+D)||"ff")]}if(b.startsWith("rgb")){const D=b.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(D){const[k,z,$,X,K,et,at,ot,pt,bt,Ct,kt]=D,It=[X||" ",at||" ",bt].join("");if(It==="  "||It==="  /"||It===",,"||It===",,,"){const Ft=[$,et,pt].join(""),Ht=Ft==="%%%"?100:Ft===""?255:0;if(Ht){const re=[sn(+z/Ht,0,1),sn(+K/Ht,0,1),sn(+ot/Ht,0,1),Ct?Pl(+Ct,kt):1];if(Ea(re))return re}}return}}const P=b.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(P){const[D,k,z,$,X,K,et,at,ot]=P,pt=[z||" ",X||" ",et].join("");if(pt==="  "||pt==="  /"||pt===",,"||pt===",,,"){const bt=[+k,sn(+$,0,100),sn(+K,0,100),at?Pl(+at,ot):1];if(Ea(bt))return function([Ct,kt,It,Ft]){function Ht(re){const Pe=(re+Ct/30)%12,ze=kt*Math.min(It,1-It);return It-ze*Math.max(-1,Math.min(Pe-3,9-Pe,1))}return Ct=Zr(Ct),kt/=100,It/=100,[Ht(0),Ht(8),Ht(4),Ft]}(bt)}}}(f);return m?new Ar(...m,!1):void 0}get rgb(){const{r:f,g:m,b,a:A}=this,P=A||1/0;return this.overwriteGetter("rgb",[f/P,m/P,b/P,A])}get hcl(){return this.overwriteGetter("hcl",function(f){const[m,b,A,P]=yr(f),D=Math.sqrt(b*b+A*A);return[Math.round(1e4*D)?Zr(Math.atan2(A,b)*Hr):NaN,D,m,P]}(this.rgb))}get lab(){return this.overwriteGetter("lab",yr(this.rgb))}overwriteGetter(f,m){return Object.defineProperty(this,f,{value:m}),m}toString(){const[f,m,b,A]=this.rgb;return`rgba(${[f,m,b].map(P=>Math.round(255*P)).join(",")},${A})`}}Ar.black=new Ar(0,0,0,1),Ar.white=new Ar(1,1,1,1),Ar.transparent=new Ar(0,0,0,0),Ar.red=new Ar(1,0,0,1);class ho{constructor(f,m,b){this.sensitivity=f?m?"variant":"case":m?"accent":"base",this.locale=b,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(f,m){return this.collator.compare(f,m)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Wn{constructor(f,m,b,A,P){this.text=f,this.image=m,this.scale=b,this.fontStack=A,this.textColor=P}}class pi{constructor(f){this.sections=f}static fromString(f){return new pi([new Wn(f,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(f=>f.text.length!==0||f.image&&f.image.name.length!==0)}static factory(f){return f instanceof pi?f:pi.fromString(f)}toString(){return this.sections.length===0?"":this.sections.map(f=>f.text).join("")}}class kn{constructor(f){this.values=f.slice()}static parse(f){if(f instanceof kn)return f;if(typeof f=="number")return new kn([f,f,f,f]);if(Array.isArray(f)&&!(f.length<1||f.length>4)){for(const m of f)if(typeof m!="number")return;switch(f.length){case 1:f=[f[0],f[0],f[0],f[0]];break;case 2:f=[f[0],f[1],f[0],f[1]];break;case 3:f=[f[0],f[1],f[2],f[1]]}return new kn(f)}}toString(){return JSON.stringify(this.values)}}const ld=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Tn{constructor(f){this.values=f.slice()}static parse(f){if(f instanceof Tn)return f;if(Array.isArray(f)&&!(f.length<1)&&f.length%2==0){for(let m=0;m<f.length;m+=2){const b=f[m],A=f[m+1];if(typeof b!="string"||!ld.has(b)||!Array.isArray(A)||A.length!==2||typeof A[0]!="number"||typeof A[1]!="number")return}return new Tn(f)}}toString(){return JSON.stringify(this.values)}}class ii{constructor(f){this.name=f.name,this.available=f.available}toString(){return this.name}static fromString(f){return f?new ii({name:f,available:!1}):null}}function fo(g,f,m,b){return typeof g=="number"&&g>=0&&g<=255&&typeof f=="number"&&f>=0&&f<=255&&typeof m=="number"&&m>=0&&m<=255?b===void 0||typeof b=="number"&&b>=0&&b<=1?null:`Invalid rgba value [${[g,f,m,b].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof b=="number"?[g,f,m,b]:[g,f,m]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rs(g){if(g===null||typeof g=="string"||typeof g=="boolean"||typeof g=="number"||g instanceof Ar||g instanceof ho||g instanceof pi||g instanceof kn||g instanceof Tn||g instanceof ii)return!0;if(Array.isArray(g)){for(const f of g)if(!Rs(f))return!1;return!0}if(typeof g=="object"){for(const f in g)if(!Rs(g[f]))return!1;return!0}return!1}function si(g){if(g===null)return vs;if(typeof g=="string")return fr;if(typeof g=="boolean")return ur;if(typeof g=="number")return ge;if(g instanceof Ar)return Sn;if(g instanceof ho)return Ca;if(g instanceof pi)return yt;if(g instanceof kn)return Q;if(g instanceof Tn)return ct;if(g instanceof ii)return rt;if(Array.isArray(g)){const f=g.length;let m;for(const b of g){const A=si(b);if(m){if(m===A)continue;m=dr;break}m=A}return xt(m||dr,f)}return Aa}function Br(g){const f=typeof g;return g===null?"":f==="string"||f==="number"||f==="boolean"?String(g):g instanceof Ar||g instanceof pi||g instanceof kn||g instanceof Tn||g instanceof ii?g.toString():JSON.stringify(g)}class ms{constructor(f,m){this.type=f,this.value=m}static parse(f,m){if(f.length!==2)return m.error(`'literal' expression requires exactly one argument, but found ${f.length-1} instead.`);if(!Rs(f[1]))return m.error("invalid value");const b=f[1];let A=si(b);const P=m.expectedType;return A.kind!=="array"||A.N!==0||!P||P.kind!=="array"||typeof P.N=="number"&&P.N!==0||(A=P),new ms(A,b)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class oi{constructor(f){this.name="ExpressionEvaluationError",this.message=f}toJSON(){return this.message}}const aa={string:fr,number:ge,boolean:ur,object:Aa};class sa{constructor(f,m){this.type=f,this.args=m}static parse(f,m){if(f.length<2)return m.error("Expected at least one argument.");let b,A=1;const P=f[0];if(P==="array"){let k,z;if(f.length>2){const $=f[1];if(typeof $!="string"||!($ in aa)||$==="object")return m.error('The item type argument of "array" must be one of string, number, boolean',1);k=aa[$],A++}else k=dr;if(f.length>3){if(f[2]!==null&&(typeof f[2]!="number"||f[2]<0||f[2]!==Math.floor(f[2])))return m.error('The length argument to "array" must be a positive integer literal',2);z=f[2],A++}b=xt(k,z)}else{if(!aa[P])throw new Error(`Types doesn't contain name = ${P}`);b=aa[P]}const D=[];for(;A<f.length;A++){const k=m.parse(f[A],A,dr);if(!k)return null;D.push(k)}return new sa(b,D)}evaluate(f){for(let m=0;m<this.args.length;m++){const b=this.args[m].evaluate(f);if(!Mt(this.type,si(b)))return b;if(m===this.args.length-1)throw new oi(`Expected value to be of type ${wt(this.type)}, but found ${wt(si(b))} instead.`)}throw new Error}eachChild(f){this.args.forEach(f)}outputDefined(){return this.args.every(f=>f.outputDefined())}}const Au={"to-boolean":ur,"to-color":Sn,"to-number":ge,"to-string":fr};class ts{constructor(f,m){this.type=f,this.args=m}static parse(f,m){if(f.length<2)return m.error("Expected at least one argument.");const b=f[0];if(!Au[b])throw new Error(`Can't parse ${b} as it is not part of the known types`);if((b==="to-boolean"||b==="to-string")&&f.length!==2)return m.error("Expected one argument.");const A=Au[b],P=[];for(let D=1;D<f.length;D++){const k=m.parse(f[D],D,dr);if(!k)return null;P.push(k)}return new ts(A,P)}evaluate(f){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(f);case"color":{let m,b;for(const A of this.args){if(m=A.evaluate(f),b=null,m instanceof Ar)return m;if(typeof m=="string"){const P=f.parseColor(m);if(P)return P}else if(Array.isArray(m)&&(b=m.length<3||m.length>4?`Invalid rbga value ${JSON.stringify(m)}: expected an array containing either three or four numeric values.`:fo(m[0],m[1],m[2],m[3]),!b))return new Ar(m[0]/255,m[1]/255,m[2]/255,m[3])}throw new oi(b||`Could not parse color from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"padding":{let m;for(const b of this.args){m=b.evaluate(f);const A=kn.parse(m);if(A)return A}throw new oi(`Could not parse padding from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"variableAnchorOffsetCollection":{let m;for(const b of this.args){m=b.evaluate(f);const A=Tn.parse(m);if(A)return A}throw new oi(`Could not parse variableAnchorOffsetCollection from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"number":{let m=null;for(const b of this.args){if(m=b.evaluate(f),m===null)return 0;const A=Number(m);if(!isNaN(A))return A}throw new oi(`Could not convert ${JSON.stringify(m)} to number.`)}case"formatted":return pi.fromString(Br(this.args[0].evaluate(f)));case"resolvedImage":return ii.fromString(Br(this.args[0].evaluate(f)));default:return Br(this.args[0].evaluate(f))}}eachChild(f){this.args.forEach(f)}outputDefined(){return this.args.every(f=>f.outputDefined())}}const Qc=["Unknown","Point","LineString","Polygon"];class th{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(f){let m=this._parseColorCache[f];return m||(m=this._parseColorCache[f]=Ar.parse(f)),m}}class Cu{constructor(f,m,b=[],A,P=new co,D=[]){this.registry=f,this.path=b,this.key=b.map(k=>`[${k}]`).join(""),this.scope=P,this.errors=D,this.expectedType=A,this._isConstant=m}parse(f,m,b,A,P={}){return m?this.concat(m,b,A)._parse(f,P):this._parse(f,P)}_parse(f,m){function b(A,P,D){return D==="assert"?new sa(P,[A]):D==="coerce"?new ts(P,[A]):A}if(f!==null&&typeof f!="string"&&typeof f!="boolean"&&typeof f!="number"||(f=["literal",f]),Array.isArray(f)){if(f.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const A=f[0];if(typeof A!="string")return this.error(`Expression name must be a string, but found ${typeof A} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const P=this.registry[A];if(P){let D=P.parse(f,this);if(!D)return null;if(this.expectedType){const k=this.expectedType,z=D.type;if(k.kind!=="string"&&k.kind!=="number"&&k.kind!=="boolean"&&k.kind!=="object"&&k.kind!=="array"||z.kind!=="value")if(k.kind!=="color"&&k.kind!=="formatted"&&k.kind!=="resolvedImage"||z.kind!=="value"&&z.kind!=="string")if(k.kind!=="padding"||z.kind!=="value"&&z.kind!=="number"&&z.kind!=="array")if(k.kind!=="variableAnchorOffsetCollection"||z.kind!=="value"&&z.kind!=="array"){if(this.checkSubtype(k,z))return null}else D=b(D,k,m.typeAnnotation||"coerce");else D=b(D,k,m.typeAnnotation||"coerce");else D=b(D,k,m.typeAnnotation||"coerce");else D=b(D,k,m.typeAnnotation||"assert")}if(!(D instanceof ms)&&D.type.kind!=="resolvedImage"&&this._isConstant(D)){const k=new th;try{D=new ms(D.type,D.evaluate(k))}catch(z){return this.error(z.message),null}}return D}return this.error(`Unknown expression "${A}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(f===void 0?"'undefined' value invalid. Use null instead.":typeof f=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof f} instead.`)}concat(f,m,b){const A=typeof f=="number"?this.path.concat(f):this.path,P=b?this.scope.concat(b):this.scope;return new Cu(this.registry,this._isConstant,A,m||null,P,this.errors)}error(f,...m){const b=`${this.key}${m.map(A=>`[${A}]`).join("")}`;this.errors.push(new Si(b,f))}checkSubtype(f,m){const b=Mt(f,m);return b&&this.error(b),b}}class ut{constructor(f,m,b){this.type=Ca,this.locale=b,this.caseSensitive=f,this.diacriticSensitive=m}static parse(f,m){if(f.length!==2)return m.error("Expected one argument.");const b=f[1];if(typeof b!="object"||Array.isArray(b))return m.error("Collator options argument must be an object.");const A=m.parse(b["case-sensitive"]!==void 0&&b["case-sensitive"],1,ur);if(!A)return null;const P=m.parse(b["diacritic-sensitive"]!==void 0&&b["diacritic-sensitive"],1,ur);if(!P)return null;let D=null;return b.locale&&(D=m.parse(b.locale,1,fr),!D)?null:new ut(A,P,D)}evaluate(f){return new ho(this.caseSensitive.evaluate(f),this.diacriticSensitive.evaluate(f),this.locale?this.locale.evaluate(f):null)}eachChild(f){f(this.caseSensitive),f(this.diacriticSensitive),this.locale&&f(this.locale)}outputDefined(){return!1}}const ft=8192;function Et(g,f){g[0]=Math.min(g[0],f[0]),g[1]=Math.min(g[1],f[1]),g[2]=Math.max(g[2],f[0]),g[3]=Math.max(g[3],f[1])}function jt(g,f){return!(g[0]<=f[0]||g[2]>=f[2]||g[1]<=f[1]||g[3]>=f[3])}function ue(g,f){const m=(180+g[0])/360,b=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g[1]*Math.PI/360)))/360,A=Math.pow(2,f.z);return[Math.round(m*A*ft),Math.round(b*A*ft)]}function Ne(g,f,m){const b=g[0]-f[0],A=g[1]-f[1],P=g[0]-m[0],D=g[1]-m[1];return b*D-P*A==0&&b*P<=0&&A*D<=0}function Sr(g,f){let m=!1;for(let D=0,k=f.length;D<k;D++){const z=f[D];for(let $=0,X=z.length;$<X-1;$++){if(Ne(g,z[$],z[$+1]))return!1;(A=z[$])[1]>(b=g)[1]!=(P=z[$+1])[1]>b[1]&&b[0]<(P[0]-A[0])*(b[1]-A[1])/(P[1]-A[1])+A[0]&&(m=!m)}}var b,A,P;return m}function Fi(g,f){for(let m=0;m<f.length;m++)if(Sr(g,f[m]))return!0;return!1}function Ki(g,f,m,b){const A=b[0]-m[0],P=b[1]-m[1],D=(g[0]-m[0])*P-A*(g[1]-m[1]),k=(f[0]-m[0])*P-A*(f[1]-m[1]);return D>0&&k<0||D<0&&k>0}function An(g,f,m){for(const $ of m)for(let X=0;X<$.length-1;++X)if((k=[(D=$[X+1])[0]-(P=$[X])[0],D[1]-P[1]])[0]*(z=[(A=f)[0]-(b=g)[0],A[1]-b[1]])[1]-k[1]*z[0]!=0&&Ki(b,A,P,D)&&Ki(P,D,b,A))return!0;var b,A,P,D,k,z;return!1}function Ia(g,f){for(let m=0;m<g.length;++m)if(!Sr(g[m],f))return!1;for(let m=0;m<g.length-1;++m)if(An(g[m],g[m+1],f))return!1;return!0}function G_(g,f){for(let m=0;m<f.length;m++)if(Ia(g,f[m]))return!0;return!1}function ud(g,f,m){const b=[];for(let A=0;A<g.length;A++){const P=[];for(let D=0;D<g[A].length;D++){const k=ue(g[A][D],m);Et(f,k),P.push(k)}b.push(P)}return b}function j_(g,f,m){const b=[];for(let A=0;A<g.length;A++){const P=ud(g[A],f,m);b.push(P)}return b}function X_(g,f,m,b){if(g[0]<m[0]||g[0]>m[2]){const A=.5*b;let P=g[0]-m[0]>A?-b:m[0]-g[0]>A?b:0;P===0&&(P=g[0]-m[2]>A?-b:m[2]-g[0]>A?b:0),g[0]+=P}Et(f,g)}function Gg(g,f,m,b){const A=Math.pow(2,b.z)*ft,P=[b.x*ft,b.y*ft],D=[];for(const k of g)for(const z of k){const $=[z.x+P[0],z.y+P[1]];X_($,f,m,A),D.push($)}return D}function jg(g,f,m,b){const A=Math.pow(2,b.z)*ft,P=[b.x*ft,b.y*ft],D=[];for(const z of g){const $=[];for(const X of z){const K=[X.x+P[0],X.y+P[1]];Et(f,K),$.push(K)}D.push($)}if(f[2]-f[0]<=A/2){(k=f)[0]=k[1]=1/0,k[2]=k[3]=-1/0;for(const z of D)for(const $ of z)X_($,f,m,A)}var k;return D}class Rl{constructor(f,m){this.type=ur,this.geojson=f,this.geometries=m}static parse(f,m){if(f.length!==2)return m.error(`'within' expression requires exactly one argument, but found ${f.length-1} instead.`);if(Rs(f[1])){const b=f[1];if(b.type==="FeatureCollection")for(let A=0;A<b.features.length;++A){const P=b.features[A].geometry.type;if(P==="Polygon"||P==="MultiPolygon")return new Rl(b,b.features[A].geometry)}else if(b.type==="Feature"){const A=b.geometry.type;if(A==="Polygon"||A==="MultiPolygon")return new Rl(b,b.geometry)}else if(b.type==="Polygon"||b.type==="MultiPolygon")return new Rl(b,b)}return m.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(f){if(f.geometry()!=null&&f.canonicalID()!=null){if(f.geometryType()==="Point")return function(m,b){const A=[1/0,1/0,-1/0,-1/0],P=[1/0,1/0,-1/0,-1/0],D=m.canonicalID();if(b.type==="Polygon"){const k=ud(b.coordinates,P,D),z=Gg(m.geometry(),A,P,D);if(!jt(A,P))return!1;for(const $ of z)if(!Sr($,k))return!1}if(b.type==="MultiPolygon"){const k=j_(b.coordinates,P,D),z=Gg(m.geometry(),A,P,D);if(!jt(A,P))return!1;for(const $ of z)if(!Fi($,k))return!1}return!0}(f,this.geometries);if(f.geometryType()==="LineString")return function(m,b){const A=[1/0,1/0,-1/0,-1/0],P=[1/0,1/0,-1/0,-1/0],D=m.canonicalID();if(b.type==="Polygon"){const k=ud(b.coordinates,P,D),z=jg(m.geometry(),A,P,D);if(!jt(A,P))return!1;for(const $ of z)if(!Ia($,k))return!1}if(b.type==="MultiPolygon"){const k=j_(b.coordinates,P,D),z=jg(m.geometry(),A,P,D);if(!jt(A,P))return!1;for(const $ of z)if(!G_($,k))return!1}return!0}(f,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class cd{constructor(f,m){this.type=m.type,this.name=f,this.boundExpression=m}static parse(f,m){if(f.length!==2||typeof f[1]!="string")return m.error("'var' expression requires exactly one string literal argument.");const b=f[1];return m.scope.has(b)?new cd(b,m.scope.get(b)):m.error(`Unknown variable "${b}". Make sure "${b}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(f){return this.boundExpression.evaluate(f)}eachChild(){}outputDefined(){return!1}}class es{constructor(f,m,b,A){this.name=f,this.type=m,this._evaluate=b,this.args=A}evaluate(f){return this._evaluate(f,this.args)}eachChild(f){this.args.forEach(f)}outputDefined(){return!1}static parse(f,m){const b=f[0],A=es.definitions[b];if(!A)return m.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0);const P=Array.isArray(A)?A[0]:A.type,D=Array.isArray(A)?[[A[1],A[2]]]:A.overloads,k=D.filter(([$])=>!Array.isArray($)||$.length===f.length-1);let z=null;for(const[$,X]of k){z=new Cu(m.registry,hd,m.path,null,m.scope);const K=[];let et=!1;for(let at=1;at<f.length;at++){const ot=f[at],pt=Array.isArray($)?$[at-1]:$.type,bt=z.parse(ot,1+K.length,pt);if(!bt){et=!0;break}K.push(bt)}if(!et)if(Array.isArray($)&&$.length!==K.length)z.error(`Expected ${$.length} arguments, but found ${K.length} instead.`);else{for(let at=0;at<K.length;at++){const ot=Array.isArray($)?$[at]:$.type,pt=K[at];z.concat(at+1).checkSubtype(ot,pt.type)}if(z.errors.length===0)return new es(b,P,X,K)}}if(k.length===1)m.errors.push(...z.errors);else{const $=(k.length?k:D).map(([K])=>{return et=K,Array.isArray(et)?`(${et.map(wt).join(", ")})`:`(${wt(et.type)}...)`;var et}).join(" | "),X=[];for(let K=1;K<f.length;K++){const et=m.parse(f[K],1+X.length);if(!et)return null;X.push(wt(et.type))}m.error(`Expected arguments of type ${$}, but found (${X.join(", ")}) instead.`)}return null}static register(f,m){es.definitions=m;for(const b in m)f[b]=es}}function hd(g){if(g instanceof cd)return hd(g.boundExpression);if(g instanceof es&&g.name==="error"||g instanceof ut||g instanceof Rl)return!1;const f=g instanceof ts||g instanceof sa;let m=!0;return g.eachChild(b=>{m=f?m&&hd(b):m&&b instanceof ms}),!!m&&fd(g)&&dd(g,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function fd(g){if(g instanceof es&&(g.name==="get"&&g.args.length===1||g.name==="feature-state"||g.name==="has"&&g.args.length===1||g.name==="properties"||g.name==="geometry-type"||g.name==="id"||/^filter-/.test(g.name))||g instanceof Rl)return!1;let f=!0;return g.eachChild(m=>{f&&!fd(m)&&(f=!1)}),f}function eh(g){if(g instanceof es&&g.name==="feature-state")return!1;let f=!0;return g.eachChild(m=>{f&&!eh(m)&&(f=!1)}),f}function dd(g,f){if(g instanceof es&&f.indexOf(g.name)>=0)return!1;let m=!0;return g.eachChild(b=>{m&&!dd(b,f)&&(m=!1)}),m}function Eu(g,f){const m=g.length-1;let b,A,P=0,D=m,k=0;for(;P<=D;)if(k=Math.floor((P+D)/2),b=g[k],A=g[k+1],b<=f){if(k===m||f<A)return k;P=k+1}else{if(!(b>f))throw new oi("Input is not a number.");D=k-1}return 0}class Ho{constructor(f,m,b){this.type=f,this.input=m,this.labels=[],this.outputs=[];for(const[A,P]of b)this.labels.push(A),this.outputs.push(P)}static parse(f,m){if(f.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${f.length-1}.`);if((f.length-1)%2!=0)return m.error("Expected an even number of arguments.");const b=m.parse(f[1],1,ge);if(!b)return null;const A=[];let P=null;m.expectedType&&m.expectedType.kind!=="value"&&(P=m.expectedType);for(let D=1;D<f.length;D+=2){const k=D===1?-1/0:f[D],z=f[D+1],$=D,X=D+1;if(typeof k!="number")return m.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(A.length&&A[A.length-1][0]>=k)return m.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',$);const K=m.parse(z,X,P);if(!K)return null;P=P||K.type,A.push([k,K])}return new Ho(P,b,A)}evaluate(f){const m=this.labels,b=this.outputs;if(m.length===1)return b[0].evaluate(f);const A=this.input.evaluate(f);if(A<=m[0])return b[0].evaluate(f);const P=m.length;return A>=m[P-1]?b[P-1].evaluate(f):b[Eu(m,A)].evaluate(f)}eachChild(f){f(this.input);for(const m of this.outputs)f(m)}outputDefined(){return this.outputs.every(f=>f.outputDefined())}}function Dr(g,f,m){return g+m*(f-g)}function pd(g,f,m){return g.map((b,A)=>Dr(b,f[A],m))}const Ma={number:Dr,color:function(g,f,m,b="rgb"){switch(b){case"rgb":{const[A,P,D,k]=pd(g.rgb,f.rgb,m);return new Ar(A,P,D,k,!1)}case"hcl":{const[A,P,D,k]=g.hcl,[z,$,X,K]=f.hcl;let et,at;if(isNaN(A)||isNaN(z))isNaN(A)?isNaN(z)?et=NaN:(et=z,D!==1&&D!==0||(at=$)):(et=A,X!==1&&X!==0||(at=P));else{let kt=z-A;z>A&&kt>180?kt-=360:z<A&&A-z>180&&(kt+=360),et=A+m*kt}const[ot,pt,bt,Ct]=function([kt,It,Ft,Ht]){return kt=isNaN(kt)?0:kt*or,Kr([Ft,Math.cos(kt)*It,Math.sin(kt)*It,Ht])}([et,at??Dr(P,$,m),Dr(D,X,m),Dr(k,K,m)]);return new Ar(ot,pt,bt,Ct,!1)}case"lab":{const[A,P,D,k]=Kr(pd(g.lab,f.lab,m));return new Ar(A,P,D,k,!1)}}},array:pd,padding:function(g,f,m){return new kn(pd(g.values,f.values,m))},variableAnchorOffsetCollection:function(g,f,m){const b=g.values,A=f.values;if(b.length!==A.length)throw new oi(`Cannot interpolate values of different length. from: ${g.toString()}, to: ${f.toString()}`);const P=[];for(let D=0;D<b.length;D+=2){if(b[D]!==A[D])throw new oi(`Cannot interpolate values containing mismatched anchors. from[${D}]: ${b[D]}, to[${D}]: ${A[D]}`);P.push(b[D]);const[k,z]=b[D+1],[$,X]=A[D+1];P.push([Dr(k,$,m),Dr(z,X,m)])}return new Tn(P)}};class Pa{constructor(f,m,b,A,P){this.type=f,this.operator=m,this.interpolation=b,this.input=A,this.labels=[],this.outputs=[];for(const[D,k]of P)this.labels.push(D),this.outputs.push(k)}static interpolationFactor(f,m,b,A){let P=0;if(f.name==="exponential")P=Xg(m,f.base,b,A);else if(f.name==="linear")P=Xg(m,1,b,A);else if(f.name==="cubic-bezier"){const D=f.controlPoints;P=new x(D[0],D[1],D[2],D[3]).solve(Xg(m,1,b,A))}return P}static parse(f,m){let[b,A,P,...D]=f;if(!Array.isArray(A)||A.length===0)return m.error("Expected an interpolation type expression.",1);if(A[0]==="linear")A={name:"linear"};else if(A[0]==="exponential"){const $=A[1];if(typeof $!="number")return m.error("Exponential interpolation requires a numeric base.",1,1);A={name:"exponential",base:$}}else{if(A[0]!=="cubic-bezier")return m.error(`Unknown interpolation type ${String(A[0])}`,1,0);{const $=A.slice(1);if($.length!==4||$.some(X=>typeof X!="number"||X<0||X>1))return m.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);A={name:"cubic-bezier",controlPoints:$}}}if(f.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${f.length-1}.`);if((f.length-1)%2!=0)return m.error("Expected an even number of arguments.");if(P=m.parse(P,2,ge),!P)return null;const k=[];let z=null;b==="interpolate-hcl"||b==="interpolate-lab"?z=Sn:m.expectedType&&m.expectedType.kind!=="value"&&(z=m.expectedType);for(let $=0;$<D.length;$+=2){const X=D[$],K=D[$+1],et=$+3,at=$+4;if(typeof X!="number")return m.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',et);if(k.length&&k[k.length-1][0]>=X)return m.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',et);const ot=m.parse(K,at,z);if(!ot)return null;z=z||ot.type,k.push([X,ot])}return Yt(z,ge)||Yt(z,Sn)||Yt(z,Q)||Yt(z,ct)||Yt(z,xt(ge))?new Pa(z,b,A,P,k):m.error(`Type ${wt(z)} is not interpolatable.`)}evaluate(f){const m=this.labels,b=this.outputs;if(m.length===1)return b[0].evaluate(f);const A=this.input.evaluate(f);if(A<=m[0])return b[0].evaluate(f);const P=m.length;if(A>=m[P-1])return b[P-1].evaluate(f);const D=Eu(m,A),k=Pa.interpolationFactor(this.interpolation,A,m[D],m[D+1]),z=b[D].evaluate(f),$=b[D+1].evaluate(f);switch(this.operator){case"interpolate":return Ma[this.type.kind](z,$,k);case"interpolate-hcl":return Ma.color(z,$,k,"hcl");case"interpolate-lab":return Ma.color(z,$,k,"lab")}}eachChild(f){f(this.input);for(const m of this.outputs)f(m)}outputDefined(){return this.outputs.every(f=>f.outputDefined())}}function Xg(g,f,m,b){const A=b-m,P=g-m;return A===0?0:f===1?P/A:(Math.pow(f,P)-1)/(Math.pow(f,A)-1)}class gd{constructor(f,m){this.type=f,this.args=m}static parse(f,m){if(f.length<2)return m.error("Expectected at least one argument.");let b=null;const A=m.expectedType;A&&A.kind!=="value"&&(b=A);const P=[];for(const k of f.slice(1)){const z=m.parse(k,1+P.length,b,void 0,{typeAnnotation:"omit"});if(!z)return null;b=b||z.type,P.push(z)}if(!b)throw new Error("No output type");const D=A&&P.some(k=>Mt(A,k.type));return new gd(D?dr:b,P)}evaluate(f){let m,b=null,A=0;for(const P of this.args)if(A++,b=P.evaluate(f),b&&b instanceof ii&&!b.available&&(m||(m=b.name),b=null,A===this.args.length&&(b=m)),b!==null)break;return b}eachChild(f){this.args.forEach(f)}outputDefined(){return this.args.every(f=>f.outputDefined())}}class vd{constructor(f,m){this.type=m.type,this.bindings=[].concat(f),this.result=m}evaluate(f){return this.result.evaluate(f)}eachChild(f){for(const m of this.bindings)f(m[1]);f(this.result)}static parse(f,m){if(f.length<4)return m.error(`Expected at least 3 arguments, but found ${f.length-1} instead.`);const b=[];for(let P=1;P<f.length-1;P+=2){const D=f[P];if(typeof D!="string")return m.error(`Expected string, but found ${typeof D} instead.`,P);if(/[^a-zA-Z0-9_]/.test(D))return m.error("Variable names must contain only alphanumeric characters or '_'.",P);const k=m.parse(f[P+1],P+1);if(!k)return null;b.push([D,k])}const A=m.parse(f[f.length-1],f.length-1,m.expectedType,b);return A?new vd(b,A):null}outputDefined(){return this.result.outputDefined()}}class Zg{constructor(f,m,b){this.type=f,this.index=m,this.input=b}static parse(f,m){if(f.length!==3)return m.error(`Expected 2 arguments, but found ${f.length-1} instead.`);const b=m.parse(f[1],1,ge),A=m.parse(f[2],2,xt(m.expectedType||dr));return b&&A?new Zg(A.type.itemType,b,A):null}evaluate(f){const m=this.index.evaluate(f),b=this.input.evaluate(f);if(m<0)throw new oi(`Array index out of bounds: ${m} < 0.`);if(m>=b.length)throw new oi(`Array index out of bounds: ${m} > ${b.length-1}.`);if(m!==Math.floor(m))throw new oi(`Array index must be an integer, but found ${m} instead.`);return b[m]}eachChild(f){f(this.index),f(this.input)}outputDefined(){return!1}}class qg{constructor(f,m){this.type=ur,this.needle=f,this.haystack=m}static parse(f,m){if(f.length!==3)return m.error(`Expected 2 arguments, but found ${f.length-1} instead.`);const b=m.parse(f[1],1,dr),A=m.parse(f[2],2,dr);return b&&A?At(b.type,[ur,fr,ge,vs,dr])?new qg(b,A):m.error(`Expected first argument to be of type boolean, string, number or null, but found ${wt(b.type)} instead`):null}evaluate(f){const m=this.needle.evaluate(f),b=this.haystack.evaluate(f);if(!b)return!1;if(!Dt(m,["boolean","string","number","null"]))throw new oi(`Expected first argument to be of type boolean, string, number or null, but found ${wt(si(m))} instead.`);if(!Dt(b,["string","array"]))throw new oi(`Expected second argument to be of type array or string, but found ${wt(si(b))} instead.`);return b.indexOf(m)>=0}eachChild(f){f(this.needle),f(this.haystack)}outputDefined(){return!0}}class md{constructor(f,m,b){this.type=ge,this.needle=f,this.haystack=m,this.fromIndex=b}static parse(f,m){if(f.length<=2||f.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${f.length-1} instead.`);const b=m.parse(f[1],1,dr),A=m.parse(f[2],2,dr);if(!b||!A)return null;if(!At(b.type,[ur,fr,ge,vs,dr]))return m.error(`Expected first argument to be of type boolean, string, number or null, but found ${wt(b.type)} instead`);if(f.length===4){const P=m.parse(f[3],3,ge);return P?new md(b,A,P):null}return new md(b,A)}evaluate(f){const m=this.needle.evaluate(f),b=this.haystack.evaluate(f);if(!Dt(m,["boolean","string","number","null"]))throw new oi(`Expected first argument to be of type boolean, string, number or null, but found ${wt(si(m))} instead.`);if(!Dt(b,["string","array"]))throw new oi(`Expected second argument to be of type array or string, but found ${wt(si(b))} instead.`);if(this.fromIndex){const A=this.fromIndex.evaluate(f);return b.indexOf(m,A)}return b.indexOf(m)}eachChild(f){f(this.needle),f(this.haystack),this.fromIndex&&f(this.fromIndex)}outputDefined(){return!1}}class Yg{constructor(f,m,b,A,P,D){this.inputType=f,this.type=m,this.input=b,this.cases=A,this.outputs=P,this.otherwise=D}static parse(f,m){if(f.length<5)return m.error(`Expected at least 4 arguments, but found only ${f.length-1}.`);if(f.length%2!=1)return m.error("Expected an even number of arguments.");let b,A;m.expectedType&&m.expectedType.kind!=="value"&&(A=m.expectedType);const P={},D=[];for(let $=2;$<f.length-1;$+=2){let X=f[$];const K=f[$+1];Array.isArray(X)||(X=[X]);const et=m.concat($);if(X.length===0)return et.error("Expected at least one branch label.");for(const ot of X){if(typeof ot!="number"&&typeof ot!="string")return et.error("Branch labels must be numbers or strings.");if(typeof ot=="number"&&Math.abs(ot)>Number.MAX_SAFE_INTEGER)return et.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ot=="number"&&Math.floor(ot)!==ot)return et.error("Numeric branch labels must be integer values.");if(b){if(et.checkSubtype(b,si(ot)))return null}else b=si(ot);if(P[String(ot)]!==void 0)return et.error("Branch labels must be unique.");P[String(ot)]=D.length}const at=m.parse(K,$,A);if(!at)return null;A=A||at.type,D.push(at)}const k=m.parse(f[1],1,dr);if(!k)return null;const z=m.parse(f[f.length-1],f.length-1,A);return z?k.type.kind!=="value"&&m.concat(1).checkSubtype(b,k.type)?null:new Yg(b,A,k,P,D,z):null}evaluate(f){const m=this.input.evaluate(f);return(si(m)===this.inputType&&this.outputs[this.cases[m]]||this.otherwise).evaluate(f)}eachChild(f){f(this.input),this.outputs.forEach(f),f(this.otherwise)}outputDefined(){return this.outputs.every(f=>f.outputDefined())&&this.otherwise.outputDefined()}}class Kg{constructor(f,m,b){this.type=f,this.branches=m,this.otherwise=b}static parse(f,m){if(f.length<4)return m.error(`Expected at least 3 arguments, but found only ${f.length-1}.`);if(f.length%2!=0)return m.error("Expected an odd number of arguments.");let b;m.expectedType&&m.expectedType.kind!=="value"&&(b=m.expectedType);const A=[];for(let D=1;D<f.length-1;D+=2){const k=m.parse(f[D],D,ur);if(!k)return null;const z=m.parse(f[D+1],D+1,b);if(!z)return null;A.push([k,z]),b=b||z.type}const P=m.parse(f[f.length-1],f.length-1,b);if(!P)return null;if(!b)throw new Error("Can't infer output type");return new Kg(b,A,P)}evaluate(f){for(const[m,b]of this.branches)if(m.evaluate(f))return b.evaluate(f);return this.otherwise.evaluate(f)}eachChild(f){for(const[m,b]of this.branches)f(m),f(b);f(this.otherwise)}outputDefined(){return this.branches.every(([f,m])=>m.outputDefined())&&this.otherwise.outputDefined()}}class yd{constructor(f,m,b,A){this.type=f,this.input=m,this.beginIndex=b,this.endIndex=A}static parse(f,m){if(f.length<=2||f.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${f.length-1} instead.`);const b=m.parse(f[1],1,dr),A=m.parse(f[2],2,ge);if(!b||!A)return null;if(!At(b.type,[xt(dr),fr,dr]))return m.error(`Expected first argument to be of type array or string, but found ${wt(b.type)} instead`);if(f.length===4){const P=m.parse(f[3],3,ge);return P?new yd(b.type,b,A,P):null}return new yd(b.type,b,A)}evaluate(f){const m=this.input.evaluate(f),b=this.beginIndex.evaluate(f);if(!Dt(m,["string","array"]))throw new oi(`Expected first argument to be of type array or string, but found ${wt(si(m))} instead.`);if(this.endIndex){const A=this.endIndex.evaluate(f);return m.slice(b,A)}return m.slice(b)}eachChild(f){f(this.input),f(this.beginIndex),this.endIndex&&f(this.endIndex)}outputDefined(){return!1}}function Z_(g,f){return g==="=="||g==="!="?f.kind==="boolean"||f.kind==="string"||f.kind==="number"||f.kind==="null"||f.kind==="value":f.kind==="string"||f.kind==="number"||f.kind==="value"}function q_(g,f,m,b){return b.compare(f,m)===0}function Iu(g,f,m){const b=g!=="=="&&g!=="!=";return class FU{constructor(P,D,k){this.type=ur,this.lhs=P,this.rhs=D,this.collator=k,this.hasUntypedArgument=P.type.kind==="value"||D.type.kind==="value"}static parse(P,D){if(P.length!==3&&P.length!==4)return D.error("Expected two or three arguments.");const k=P[0];let z=D.parse(P[1],1,dr);if(!z)return null;if(!Z_(k,z.type))return D.concat(1).error(`"${k}" comparisons are not supported for type '${wt(z.type)}'.`);let $=D.parse(P[2],2,dr);if(!$)return null;if(!Z_(k,$.type))return D.concat(2).error(`"${k}" comparisons are not supported for type '${wt($.type)}'.`);if(z.type.kind!==$.type.kind&&z.type.kind!=="value"&&$.type.kind!=="value")return D.error(`Cannot compare types '${wt(z.type)}' and '${wt($.type)}'.`);b&&(z.type.kind==="value"&&$.type.kind!=="value"?z=new sa($.type,[z]):z.type.kind!=="value"&&$.type.kind==="value"&&($=new sa(z.type,[$])));let X=null;if(P.length===4){if(z.type.kind!=="string"&&$.type.kind!=="string"&&z.type.kind!=="value"&&$.type.kind!=="value")return D.error("Cannot use collator to compare non-string types.");if(X=D.parse(P[3],3,Ca),!X)return null}return new FU(z,$,X)}evaluate(P){const D=this.lhs.evaluate(P),k=this.rhs.evaluate(P);if(b&&this.hasUntypedArgument){const z=si(D),$=si(k);if(z.kind!==$.kind||z.kind!=="string"&&z.kind!=="number")throw new oi(`Expected arguments for "${g}" to be (string, string) or (number, number), but found (${z.kind}, ${$.kind}) instead.`)}if(this.collator&&!b&&this.hasUntypedArgument){const z=si(D),$=si(k);if(z.kind!=="string"||$.kind!=="string")return f(P,D,k)}return this.collator?m(P,D,k,this.collator.evaluate(P)):f(P,D,k)}eachChild(P){P(this.lhs),P(this.rhs),this.collator&&P(this.collator)}outputDefined(){return!0}}}const rT=Iu("==",function(g,f,m){return f===m},q_),iT=Iu("!=",function(g,f,m){return f!==m},function(g,f,m,b){return!q_(0,f,m,b)}),nT=Iu("<",function(g,f,m){return f<m},function(g,f,m,b){return b.compare(f,m)<0}),aT=Iu(">",function(g,f,m){return f>m},function(g,f,m,b){return b.compare(f,m)>0}),sT=Iu("<=",function(g,f,m){return f<=m},function(g,f,m,b){return b.compare(f,m)<=0}),oT=Iu(">=",function(g,f,m){return f>=m},function(g,f,m,b){return b.compare(f,m)>=0});class Jg{constructor(f,m,b,A,P){this.type=fr,this.number=f,this.locale=m,this.currency=b,this.minFractionDigits=A,this.maxFractionDigits=P}static parse(f,m){if(f.length!==3)return m.error("Expected two arguments.");const b=m.parse(f[1],1,ge);if(!b)return null;const A=f[2];if(typeof A!="object"||Array.isArray(A))return m.error("NumberFormat options argument must be an object.");let P=null;if(A.locale&&(P=m.parse(A.locale,1,fr),!P))return null;let D=null;if(A.currency&&(D=m.parse(A.currency,1,fr),!D))return null;let k=null;if(A["min-fraction-digits"]&&(k=m.parse(A["min-fraction-digits"],1,ge),!k))return null;let z=null;return A["max-fraction-digits"]&&(z=m.parse(A["max-fraction-digits"],1,ge),!z)?null:new Jg(b,P,D,k,z)}evaluate(f){return new Intl.NumberFormat(this.locale?this.locale.evaluate(f):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(f):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(f):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(f):void 0}).format(this.number.evaluate(f))}eachChild(f){f(this.number),this.locale&&f(this.locale),this.currency&&f(this.currency),this.minFractionDigits&&f(this.minFractionDigits),this.maxFractionDigits&&f(this.maxFractionDigits)}outputDefined(){return!1}}class _d{constructor(f){this.type=yt,this.sections=f}static parse(f,m){if(f.length<2)return m.error("Expected at least one argument.");const b=f[1];if(!Array.isArray(b)&&typeof b=="object")return m.error("First argument must be an image or text section.");const A=[];let P=!1;for(let D=1;D<=f.length-1;++D){const k=f[D];if(P&&typeof k=="object"&&!Array.isArray(k)){P=!1;let z=null;if(k["font-scale"]&&(z=m.parse(k["font-scale"],1,ge),!z))return null;let $=null;if(k["text-font"]&&($=m.parse(k["text-font"],1,xt(fr)),!$))return null;let X=null;if(k["text-color"]&&(X=m.parse(k["text-color"],1,Sn),!X))return null;const K=A[A.length-1];K.scale=z,K.font=$,K.textColor=X}else{const z=m.parse(f[D],1,dr);if(!z)return null;const $=z.type.kind;if($!=="string"&&$!=="value"&&$!=="null"&&$!=="resolvedImage")return m.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");P=!0,A.push({content:z,scale:null,font:null,textColor:null})}}return new _d(A)}evaluate(f){return new pi(this.sections.map(m=>{const b=m.content.evaluate(f);return si(b)===rt?new Wn("",b,null,null,null):new Wn(Br(b),null,m.scale?m.scale.evaluate(f):null,m.font?m.font.evaluate(f).join(","):null,m.textColor?m.textColor.evaluate(f):null)}))}eachChild(f){for(const m of this.sections)f(m.content),m.scale&&f(m.scale),m.font&&f(m.font),m.textColor&&f(m.textColor)}outputDefined(){return!1}}class Qg{constructor(f){this.type=rt,this.input=f}static parse(f,m){if(f.length!==2)return m.error("Expected two arguments.");const b=m.parse(f[1],1,fr);return b?new Qg(b):m.error("No image name provided.")}evaluate(f){const m=this.input.evaluate(f),b=ii.fromString(m);return b&&f.availableImages&&(b.available=f.availableImages.indexOf(m)>-1),b}eachChild(f){f(this.input)}outputDefined(){return!1}}class tv{constructor(f){this.type=ge,this.input=f}static parse(f,m){if(f.length!==2)return m.error(`Expected 1 argument, but found ${f.length-1} instead.`);const b=m.parse(f[1],1);return b?b.type.kind!=="array"&&b.type.kind!=="string"&&b.type.kind!=="value"?m.error(`Expected argument of type string or array, but found ${wt(b.type)} instead.`):new tv(b):null}evaluate(f){const m=this.input.evaluate(f);if(typeof m=="string"||Array.isArray(m))return m.length;throw new oi(`Expected value to be of type string or array, but found ${wt(si(m))} instead.`)}eachChild(f){f(this.input)}outputDefined(){return!1}}const Mu={"==":rT,"!=":iT,">":aT,"<":nT,">=":oT,"<=":sT,array:sa,at:Zg,boolean:sa,case:Kg,coalesce:gd,collator:ut,format:_d,image:Qg,in:qg,"index-of":md,interpolate:Pa,"interpolate-hcl":Pa,"interpolate-lab":Pa,length:tv,let:vd,literal:ms,match:Yg,number:sa,"number-format":Jg,object:sa,slice:yd,step:Ho,string:sa,"to-boolean":ts,"to-color":ts,"to-number":ts,"to-string":ts,var:cd,within:Rl};function Y_(g,[f,m,b,A]){f=f.evaluate(g),m=m.evaluate(g),b=b.evaluate(g);const P=A?A.evaluate(g):1,D=fo(f,m,b,P);if(D)throw new oi(D);return new Ar(f/255,m/255,b/255,P,!1)}function K_(g,f){return g in f}function ev(g,f){const m=f[g];return m===void 0?null:m}function Dl(g){return{type:g}}function J_(g){return{result:"success",value:g}}function Go(g){return{result:"error",value:g}}function Pu(g){return g["property-type"]==="data-driven"||g["property-type"]==="cross-faded-data-driven"}function Q_(g){return!!g.expression&&g.expression.parameters.indexOf("zoom")>-1}function rv(g){return!!g.expression&&g.expression.interpolated}function qr(g){return g instanceof Number?"number":g instanceof String?"string":g instanceof Boolean?"boolean":Array.isArray(g)?"array":g===null?"null":typeof g}function Mi(g){return typeof g=="object"&&g!==null&&!Array.isArray(g)}function lT(g){return g}function Lr(g,f){const m=f.type==="color",b=g.stops&&typeof g.stops[0][0]=="object",A=b||!(b||g.property!==void 0),P=g.type||(rv(f)?"exponential":"interval");if(m||f.type==="padding"){const X=m?Ar.parse:kn.parse;(g=Qa({},g)).stops&&(g.stops=g.stops.map(K=>[K[0],X(K[1])])),g.default=X(g.default?g.default:f.default)}if(g.colorSpace&&(D=g.colorSpace)!=="rgb"&&D!=="hcl"&&D!=="lab")throw new Error(`Unknown color space: "${g.colorSpace}"`);var D;let k,z,$;if(P==="exponential")k=rh;else if(P==="interval")k=Ti;else if(P==="categorical"){k=Pi,z=Object.create(null);for(const X of g.stops)z[X[0]]=X[1];$=typeof g.stops[0][0]}else{if(P!=="identity")throw new Error(`Unknown function type "${P}"`);k=t0}if(b){const X={},K=[];for(let ot=0;ot<g.stops.length;ot++){const pt=g.stops[ot],bt=pt[0].zoom;X[bt]===void 0&&(X[bt]={zoom:bt,type:g.type,property:g.property,default:g.default,stops:[]},K.push(bt)),X[bt].stops.push([pt[0].value,pt[1]])}const et=[];for(const ot of K)et.push([X[ot].zoom,Lr(X[ot],f)]);const at={name:"linear"};return{kind:"composite",interpolationType:at,interpolationFactor:Pa.interpolationFactor.bind(void 0,at),zoomStops:et.map(ot=>ot[0]),evaluate:({zoom:ot},pt)=>rh({stops:et,base:g.base},f,ot).evaluate(ot,pt)}}if(A){const X=P==="exponential"?{name:"exponential",base:g.base!==void 0?g.base:1}:null;return{kind:"camera",interpolationType:X,interpolationFactor:Pa.interpolationFactor.bind(void 0,X),zoomStops:g.stops.map(K=>K[0]),evaluate:({zoom:K})=>k(g,f,K,z,$)}}return{kind:"source",evaluate(X,K){const et=K&&K.properties?K.properties[g.property]:void 0;return et===void 0?Ll(g.default,f.default):k(g,f,et,z,$)}}}function Ll(g,f,m){return g!==void 0?g:f!==void 0?f:m!==void 0?m:void 0}function Pi(g,f,m,b,A){return Ll(typeof m===A?b[m]:void 0,g.default,f.default)}function Ti(g,f,m){if(qr(m)!=="number")return Ll(g.default,f.default);const b=g.stops.length;if(b===1||m<=g.stops[0][0])return g.stops[0][1];if(m>=g.stops[b-1][0])return g.stops[b-1][1];const A=Eu(g.stops.map(P=>P[0]),m);return g.stops[A][1]}function rh(g,f,m){const b=g.base!==void 0?g.base:1;if(qr(m)!=="number")return Ll(g.default,f.default);const A=g.stops.length;if(A===1||m<=g.stops[0][0])return g.stops[0][1];if(m>=g.stops[A-1][0])return g.stops[A-1][1];const P=Eu(g.stops.map(X=>X[0]),m),D=function(X,K,et,at){const ot=at-et,pt=X-et;return ot===0?0:K===1?pt/ot:(Math.pow(K,pt)-1)/(Math.pow(K,ot)-1)}(m,b,g.stops[P][0],g.stops[P+1][0]),k=g.stops[P][1],z=g.stops[P+1][1],$=Ma[f.type]||lT;return typeof k.evaluate=="function"?{evaluate(...X){const K=k.evaluate.apply(void 0,X),et=z.evaluate.apply(void 0,X);if(K!==void 0&&et!==void 0)return $(K,et,D,g.colorSpace)}}:$(k,z,D,g.colorSpace)}function t0(g,f,m){switch(f.type){case"color":m=Ar.parse(m);break;case"formatted":m=pi.fromString(m.toString());break;case"resolvedImage":m=ii.fromString(m.toString());break;case"padding":m=kn.parse(m);break;default:qr(m)===f.type||f.type==="enum"&&f.values[m]||(m=void 0)}return Ll(m,g.default,f.default)}es.register(Mu,{error:[{kind:"error"},[fr],(g,[f])=>{throw new oi(f.evaluate(g))}],typeof:[fr,[dr],(g,[f])=>wt(si(f.evaluate(g)))],"to-rgba":[xt(ge,4),[Sn],(g,[f])=>{const[m,b,A,P]=f.evaluate(g).rgb;return[255*m,255*b,255*A,P]}],rgb:[Sn,[ge,ge,ge],Y_],rgba:[Sn,[ge,ge,ge,ge],Y_],has:{type:ur,overloads:[[[fr],(g,[f])=>K_(f.evaluate(g),g.properties())],[[fr,Aa],(g,[f,m])=>K_(f.evaluate(g),m.evaluate(g))]]},get:{type:dr,overloads:[[[fr],(g,[f])=>ev(f.evaluate(g),g.properties())],[[fr,Aa],(g,[f,m])=>ev(f.evaluate(g),m.evaluate(g))]]},"feature-state":[dr,[fr],(g,[f])=>ev(f.evaluate(g),g.featureState||{})],properties:[Aa,[],g=>g.properties()],"geometry-type":[fr,[],g=>g.geometryType()],id:[dr,[],g=>g.id()],zoom:[ge,[],g=>g.globals.zoom],"heatmap-density":[ge,[],g=>g.globals.heatmapDensity||0],"line-progress":[ge,[],g=>g.globals.lineProgress||0],accumulated:[dr,[],g=>g.globals.accumulated===void 0?null:g.globals.accumulated],"+":[ge,Dl(ge),(g,f)=>{let m=0;for(const b of f)m+=b.evaluate(g);return m}],"*":[ge,Dl(ge),(g,f)=>{let m=1;for(const b of f)m*=b.evaluate(g);return m}],"-":{type:ge,overloads:[[[ge,ge],(g,[f,m])=>f.evaluate(g)-m.evaluate(g)],[[ge],(g,[f])=>-f.evaluate(g)]]},"/":[ge,[ge,ge],(g,[f,m])=>f.evaluate(g)/m.evaluate(g)],"%":[ge,[ge,ge],(g,[f,m])=>f.evaluate(g)%m.evaluate(g)],ln2:[ge,[],()=>Math.LN2],pi:[ge,[],()=>Math.PI],e:[ge,[],()=>Math.E],"^":[ge,[ge,ge],(g,[f,m])=>Math.pow(f.evaluate(g),m.evaluate(g))],sqrt:[ge,[ge],(g,[f])=>Math.sqrt(f.evaluate(g))],log10:[ge,[ge],(g,[f])=>Math.log(f.evaluate(g))/Math.LN10],ln:[ge,[ge],(g,[f])=>Math.log(f.evaluate(g))],log2:[ge,[ge],(g,[f])=>Math.log(f.evaluate(g))/Math.LN2],sin:[ge,[ge],(g,[f])=>Math.sin(f.evaluate(g))],cos:[ge,[ge],(g,[f])=>Math.cos(f.evaluate(g))],tan:[ge,[ge],(g,[f])=>Math.tan(f.evaluate(g))],asin:[ge,[ge],(g,[f])=>Math.asin(f.evaluate(g))],acos:[ge,[ge],(g,[f])=>Math.acos(f.evaluate(g))],atan:[ge,[ge],(g,[f])=>Math.atan(f.evaluate(g))],min:[ge,Dl(ge),(g,f)=>Math.min(...f.map(m=>m.evaluate(g)))],max:[ge,Dl(ge),(g,f)=>Math.max(...f.map(m=>m.evaluate(g)))],abs:[ge,[ge],(g,[f])=>Math.abs(f.evaluate(g))],round:[ge,[ge],(g,[f])=>{const m=f.evaluate(g);return m<0?-Math.round(-m):Math.round(m)}],floor:[ge,[ge],(g,[f])=>Math.floor(f.evaluate(g))],ceil:[ge,[ge],(g,[f])=>Math.ceil(f.evaluate(g))],"filter-==":[ur,[fr,dr],(g,[f,m])=>g.properties()[f.value]===m.value],"filter-id-==":[ur,[dr],(g,[f])=>g.id()===f.value],"filter-type-==":[ur,[fr],(g,[f])=>g.geometryType()===f.value],"filter-<":[ur,[fr,dr],(g,[f,m])=>{const b=g.properties()[f.value],A=m.value;return typeof b==typeof A&&b<A}],"filter-id-<":[ur,[dr],(g,[f])=>{const m=g.id(),b=f.value;return typeof m==typeof b&&m<b}],"filter->":[ur,[fr,dr],(g,[f,m])=>{const b=g.properties()[f.value],A=m.value;return typeof b==typeof A&&b>A}],"filter-id->":[ur,[dr],(g,[f])=>{const m=g.id(),b=f.value;return typeof m==typeof b&&m>b}],"filter-<=":[ur,[fr,dr],(g,[f,m])=>{const b=g.properties()[f.value],A=m.value;return typeof b==typeof A&&b<=A}],"filter-id-<=":[ur,[dr],(g,[f])=>{const m=g.id(),b=f.value;return typeof m==typeof b&&m<=b}],"filter->=":[ur,[fr,dr],(g,[f,m])=>{const b=g.properties()[f.value],A=m.value;return typeof b==typeof A&&b>=A}],"filter-id->=":[ur,[dr],(g,[f])=>{const m=g.id(),b=f.value;return typeof m==typeof b&&m>=b}],"filter-has":[ur,[dr],(g,[f])=>f.value in g.properties()],"filter-has-id":[ur,[],g=>g.id()!==null&&g.id()!==void 0],"filter-type-in":[ur,[xt(fr)],(g,[f])=>f.value.indexOf(g.geometryType())>=0],"filter-id-in":[ur,[xt(dr)],(g,[f])=>f.value.indexOf(g.id())>=0],"filter-in-small":[ur,[fr,xt(dr)],(g,[f,m])=>m.value.indexOf(g.properties()[f.value])>=0],"filter-in-large":[ur,[fr,xt(dr)],(g,[f,m])=>function(b,A,P,D){for(;P<=D;){const k=P+D>>1;if(A[k]===b)return!0;A[k]>b?D=k-1:P=k+1}return!1}(g.properties()[f.value],m.value,0,m.value.length-1)],all:{type:ur,overloads:[[[ur,ur],(g,[f,m])=>f.evaluate(g)&&m.evaluate(g)],[Dl(ur),(g,f)=>{for(const m of f)if(!m.evaluate(g))return!1;return!0}]]},any:{type:ur,overloads:[[[ur,ur],(g,[f,m])=>f.evaluate(g)||m.evaluate(g)],[Dl(ur),(g,f)=>{for(const m of f)if(m.evaluate(g))return!0;return!1}]]},"!":[ur,[ur],(g,[f])=>!f.evaluate(g)],"is-supported-script":[ur,[fr],(g,[f])=>{const m=g.globals&&g.globals.isSupportedScript;return!m||m(f.evaluate(g))}],upcase:[fr,[fr],(g,[f])=>f.evaluate(g).toUpperCase()],downcase:[fr,[fr],(g,[f])=>f.evaluate(g).toLowerCase()],concat:[fr,Dl(dr),(g,f)=>f.map(m=>Br(m.evaluate(g))).join("")],"resolved-locale":[fr,[Ca],(g,[f])=>f.evaluate(g).resolvedLocale()]});class iv{constructor(f,m){var b;this.expression=f,this._warningHistory={},this._evaluator=new th,this._defaultValue=m?(b=m).type==="color"&&Mi(b.default)?new Ar(0,0,0,0):b.type==="color"?Ar.parse(b.default)||null:b.type==="padding"?kn.parse(b.default)||null:b.type==="variableAnchorOffsetCollection"?Tn.parse(b.default)||null:b.default===void 0?null:b.default:null,this._enumValues=m&&m.type==="enum"?m.values:null}evaluateWithoutErrorHandling(f,m,b,A,P,D){return this._evaluator.globals=f,this._evaluator.feature=m,this._evaluator.featureState=b,this._evaluator.canonical=A,this._evaluator.availableImages=P||null,this._evaluator.formattedSection=D,this.expression.evaluate(this._evaluator)}evaluate(f,m,b,A,P,D){this._evaluator.globals=f,this._evaluator.feature=m||null,this._evaluator.featureState=b||null,this._evaluator.canonical=A,this._evaluator.availableImages=P||null,this._evaluator.formattedSection=D||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new oi(`Expected value to be one of ${Object.keys(this._enumValues).map(z=>JSON.stringify(z)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(k.message)),this._defaultValue}}}function xd(g){return Array.isArray(g)&&g.length>0&&typeof g[0]=="string"&&g[0]in Mu}function bd(g,f){const m=new Cu(Mu,hd,[],f?function(A){const P={color:Sn,string:fr,number:ge,enum:fr,boolean:ur,formatted:yt,padding:Q,resolvedImage:rt,variableAnchorOffsetCollection:ct};return A.type==="array"?xt(P[A.value]||dr,A.length):P[A.type]}(f):void 0),b=m.parse(g,void 0,void 0,void 0,f&&f.type==="string"?{typeAnnotation:"coerce"}:void 0);return b?J_(new iv(b,f)):Go(m.errors)}class nv{constructor(f,m){this.kind=f,this._styleExpression=m,this.isStateDependent=f!=="constant"&&!eh(m.expression)}evaluateWithoutErrorHandling(f,m,b,A,P,D){return this._styleExpression.evaluateWithoutErrorHandling(f,m,b,A,P,D)}evaluate(f,m,b,A,P,D){return this._styleExpression.evaluate(f,m,b,A,P,D)}}class wd{constructor(f,m,b,A){this.kind=f,this.zoomStops=b,this._styleExpression=m,this.isStateDependent=f!=="camera"&&!eh(m.expression),this.interpolationType=A}evaluateWithoutErrorHandling(f,m,b,A,P,D){return this._styleExpression.evaluateWithoutErrorHandling(f,m,b,A,P,D)}evaluate(f,m,b,A,P,D){return this._styleExpression.evaluate(f,m,b,A,P,D)}interpolationFactor(f,m,b){return this.interpolationType?Pa.interpolationFactor(this.interpolationType,f,m,b):0}}function av(g,f){const m=bd(g,f);if(m.result==="error")return m;const b=m.value.expression,A=fd(b);if(!A&&!Pu(f))return Go([new Si("","data expressions not supported")]);const P=dd(b,["zoom"]);if(!P&&!Q_(f))return Go([new Si("","zoom expressions not supported")]);const D=nh(b);return D||P?D instanceof Si?Go([D]):D instanceof Pa&&!rv(f)?Go([new Si("",'"interpolate" expressions cannot be used with this property')]):J_(D?new wd(A?"camera":"composite",m.value,D.labels,D instanceof Pa?D.interpolation:void 0):new nv(A?"constant":"source",m.value)):Go([new Si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ih{constructor(f,m){this._parameters=f,this._specification=m,Qa(this,Lr(this._parameters,this._specification))}static deserialize(f){return new ih(f._parameters,f._specification)}static serialize(f){return{_parameters:f._parameters,_specification:f._specification}}}function nh(g){let f=null;if(g instanceof vd)f=nh(g.result);else if(g instanceof gd){for(const m of g.args)if(f=nh(m),f)break}else(g instanceof Ho||g instanceof Pa)&&g.input instanceof es&&g.input.name==="zoom"&&(f=g);return f instanceof Si||g.eachChild(m=>{const b=nh(m);b instanceof Si?f=b:!f&&b?f=new Si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):f&&b&&f!==b&&(f=new Si("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),f}function ah(g){if(g===!0||g===!1)return!0;if(!Array.isArray(g)||g.length===0)return!1;switch(g[0]){case"has":return g.length>=2&&g[1]!=="$id"&&g[1]!=="$type";case"in":return g.length>=3&&(typeof g[1]!="string"||Array.isArray(g[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return g.length!==3||Array.isArray(g[1])||Array.isArray(g[2]);case"any":case"all":for(const f of g.slice(1))if(!ah(f)&&typeof f!="boolean")return!1;return!0;default:return!0}}const uT={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function sv(g){if(g==null)return{filter:()=>!0,needGeometry:!1};ah(g)||(g=Sd(g));const f=bd(g,uT);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return{filter:(m,b,A)=>f.value.evaluate(m,b,{},A),needGeometry:e0(g)}}function cT(g,f){return g<f?-1:g>f?1:0}function e0(g){if(!Array.isArray(g))return!1;if(g[0]==="within")return!0;for(let f=1;f<g.length;f++)if(e0(g[f]))return!0;return!1}function Sd(g){if(!g)return!0;const f=g[0];return g.length<=1?f!=="any":f==="=="?ov(g[1],g[2],"=="):f==="!="?sh(ov(g[1],g[2],"==")):f==="<"||f===">"||f==="<="||f===">="?ov(g[1],g[2],f):f==="any"?(m=g.slice(1),["any"].concat(m.map(Sd))):f==="all"?["all"].concat(g.slice(1).map(Sd)):f==="none"?["all"].concat(g.slice(1).map(Sd).map(sh)):f==="in"?r0(g[1],g.slice(2)):f==="!in"?sh(r0(g[1],g.slice(2))):f==="has"?i0(g[1]):f==="!has"?sh(i0(g[1])):f!=="within"||g;var m}function ov(g,f,m){switch(g){case"$type":return[`filter-type-${m}`,f];case"$id":return[`filter-id-${m}`,f];default:return[`filter-${m}`,g,f]}}function r0(g,f){if(f.length===0)return!1;switch(g){case"$type":return["filter-type-in",["literal",f]];case"$id":return["filter-id-in",["literal",f]];default:return f.length>200&&!f.some(m=>typeof m!=typeof f[0])?["filter-in-large",g,["literal",f.sort(cT)]]:["filter-in-small",g,["literal",f]]}}function i0(g){switch(g){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",g]}}function sh(g){return["!",g]}function Td(g){const f=typeof g;if(f==="number"||f==="boolean"||f==="string"||g==null)return JSON.stringify(g);if(Array.isArray(g)){let A="[";for(const P of g)A+=`${Td(P)},`;return`${A}]`}const m=Object.keys(g).sort();let b="{";for(let A=0;A<m.length;A++)b+=`${JSON.stringify(m[A])}:${Td(g[m[A]])},`;return`${b}}`}function Ad(g){let f="";for(const m of Ur)f+=`/${Td(g[m])}`;return f}function n0(g){const f=g.value;return f?[new de(g.key,f,"constants have been deprecated as of v8")]:[]}function ki(g){return g instanceof Number||g instanceof String||g instanceof Boolean?g.valueOf():g}function kl(g){if(Array.isArray(g))return g.map(kl);if(g instanceof Object&&!(g instanceof Number||g instanceof String||g instanceof Boolean)){const f={};for(const m in g)f[m]=kl(g[m]);return f}return ki(g)}function oa(g){const f=g.key,m=g.value,b=g.valueSpec||{},A=g.objectElementValidators||{},P=g.style,D=g.styleSpec,k=g.validateSpec;let z=[];const $=qr(m);if($!=="object")return[new de(f,m,`object expected, ${$} found`)];for(const X in m){const K=X.split(".")[0],et=b[K]||b["*"];let at;if(A[K])at=A[K];else if(b[K])at=k;else if(A["*"])at=A["*"];else{if(!b["*"]){z.push(new de(f,m[X],`unknown property "${X}"`));continue}at=k}z=z.concat(at({key:(f&&`${f}.`)+X,value:m[X],valueSpec:et,style:P,styleSpec:D,object:m,objectKey:X,validateSpec:k},m))}for(const X in b)A[X]||b[X].required&&b[X].default===void 0&&m[X]===void 0&&z.push(new de(f,m,`missing required property "${X}"`));return z}function Ru(g){const f=g.value,m=g.valueSpec,b=g.style,A=g.styleSpec,P=g.key,D=g.arrayElementValidator||g.validateSpec;if(qr(f)!=="array")return[new de(P,f,`array expected, ${qr(f)} found`)];if(m.length&&f.length!==m.length)return[new de(P,f,`array length ${m.length} expected, length ${f.length} found`)];if(m["min-length"]&&f.length<m["min-length"])return[new de(P,f,`array length at least ${m["min-length"]} expected, length ${f.length} found`)];let k={type:m.value,values:m.values};A.$version<7&&(k.function=m.function),qr(m.value)==="object"&&(k=m.value);let z=[];for(let $=0;$<f.length;$++)z=z.concat(D({array:f,arrayIndex:$,value:f[$],valueSpec:k,validateSpec:g.validateSpec,style:b,styleSpec:A,key:`${P}[${$}]`}));return z}function oh(g){const f=g.key,m=g.value,b=g.valueSpec;let A=qr(m);return A==="number"&&m!=m&&(A="NaN"),A!=="number"?[new de(f,m,`number expected, ${A} found`)]:"minimum"in b&&m<b.minimum?[new de(f,m,`${m} is less than the minimum value ${b.minimum}`)]:"maximum"in b&&m>b.maximum?[new de(f,m,`${m} is greater than the maximum value ${b.maximum}`)]:[]}function Cd(g){const f=g.valueSpec,m=ki(g.value.type);let b,A,P,D={};const k=m!=="categorical"&&g.value.property===void 0,z=!k,$=qr(g.value.stops)==="array"&&qr(g.value.stops[0])==="array"&&qr(g.value.stops[0][0])==="object",X=oa({key:g.key,value:g.value,valueSpec:g.styleSpec.function,validateSpec:g.validateSpec,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(at){if(m==="identity")return[new de(at.key,at.value,'identity function may not have a "stops" property')];let ot=[];const pt=at.value;return ot=ot.concat(Ru({key:at.key,value:pt,valueSpec:at.valueSpec,validateSpec:at.validateSpec,style:at.style,styleSpec:at.styleSpec,arrayElementValidator:K})),qr(pt)==="array"&&pt.length===0&&ot.push(new de(at.key,pt,"array must have at least one stop")),ot},default:function(at){return at.validateSpec({key:at.key,value:at.value,valueSpec:f,validateSpec:at.validateSpec,style:at.style,styleSpec:at.styleSpec})}}});return m==="identity"&&k&&X.push(new de(g.key,g.value,'missing required property "property"')),m==="identity"||g.value.stops||X.push(new de(g.key,g.value,'missing required property "stops"')),m==="exponential"&&g.valueSpec.expression&&!rv(g.valueSpec)&&X.push(new de(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(z&&!Pu(g.valueSpec)?X.push(new de(g.key,g.value,"property functions not supported")):k&&!Q_(g.valueSpec)&&X.push(new de(g.key,g.value,"zoom functions not supported"))),m!=="categorical"&&!$||g.value.property!==void 0||X.push(new de(g.key,g.value,'"property" property is required')),X;function K(at){let ot=[];const pt=at.value,bt=at.key;if(qr(pt)!=="array")return[new de(bt,pt,`array expected, ${qr(pt)} found`)];if(pt.length!==2)return[new de(bt,pt,`array length 2 expected, length ${pt.length} found`)];if($){if(qr(pt[0])!=="object")return[new de(bt,pt,`object expected, ${qr(pt[0])} found`)];if(pt[0].zoom===void 0)return[new de(bt,pt,"object stop key must have zoom")];if(pt[0].value===void 0)return[new de(bt,pt,"object stop key must have value")];if(P&&P>ki(pt[0].zoom))return[new de(bt,pt[0].zoom,"stop zoom values must appear in ascending order")];ki(pt[0].zoom)!==P&&(P=ki(pt[0].zoom),A=void 0,D={}),ot=ot.concat(oa({key:`${bt}[0]`,value:pt[0],valueSpec:{zoom:{}},validateSpec:at.validateSpec,style:at.style,styleSpec:at.styleSpec,objectElementValidators:{zoom:oh,value:et}}))}else ot=ot.concat(et({key:`${bt}[0]`,value:pt[0],valueSpec:{},validateSpec:at.validateSpec,style:at.style,styleSpec:at.styleSpec},pt));return xd(kl(pt[1]))?ot.concat([new de(`${bt}[1]`,pt[1],"expressions are not allowed in function stops.")]):ot.concat(at.validateSpec({key:`${bt}[1]`,value:pt[1],valueSpec:f,validateSpec:at.validateSpec,style:at.style,styleSpec:at.styleSpec}))}function et(at,ot){const pt=qr(at.value),bt=ki(at.value),Ct=at.value!==null?at.value:ot;if(b){if(pt!==b)return[new de(at.key,Ct,`${pt} stop domain type must match previous stop domain type ${b}`)]}else b=pt;if(pt!=="number"&&pt!=="string"&&pt!=="boolean")return[new de(at.key,Ct,"stop domain value must be a number, string, or boolean")];if(pt!=="number"&&m!=="categorical"){let kt=`number expected, ${pt} found`;return Pu(f)&&m===void 0&&(kt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new de(at.key,Ct,kt)]}return m!=="categorical"||pt!=="number"||isFinite(bt)&&Math.floor(bt)===bt?m!=="categorical"&&pt==="number"&&A!==void 0&&bt<A?[new de(at.key,Ct,"stop domain values must appear in ascending order")]:(A=bt,m==="categorical"&&bt in D?[new de(at.key,Ct,"stop domain values must be unique")]:(D[bt]=!0,[])):[new de(at.key,Ct,`integer expected, found ${bt}`)]}}function Ol(g){const f=(g.expressionContext==="property"?av:bd)(kl(g.value),g.valueSpec);if(f.result==="error")return f.value.map(b=>new de(`${g.key}${b.key}`,g.value,b.message));const m=f.value.expression||f.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!m.outputDefined())return[new de(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!eh(m))return[new de(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter"&&!eh(m))return[new de(g.key,g.value,'"feature-state" data expressions are not supported with filters.')];if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!dd(m,["zoom","feature-state"]))return[new de(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!fd(m))return[new de(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lh(g){const f=g.key,m=g.value,b=g.valueSpec,A=[];return Array.isArray(b.values)?b.values.indexOf(ki(m))===-1&&A.push(new de(f,m,`expected one of [${b.values.join(", ")}], ${JSON.stringify(m)} found`)):Object.keys(b.values).indexOf(ki(m))===-1&&A.push(new de(f,m,`expected one of [${Object.keys(b.values).join(", ")}], ${JSON.stringify(m)} found`)),A}function Du(g){return ah(kl(g.value))?Ol(Qa({},g,{expressionContext:"filter",valueSpec:{value:"boolean"}})):a0(g)}function a0(g){const f=g.value,m=g.key;if(qr(f)!=="array")return[new de(m,f,`array expected, ${qr(f)} found`)];const b=g.styleSpec;let A,P=[];if(f.length<1)return[new de(m,f,"filter array must have at least 1 element")];switch(P=P.concat(lh({key:`${m}[0]`,value:f[0],valueSpec:b.filter_operator,style:g.style,styleSpec:g.styleSpec})),ki(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&ki(f[1])==="$type"&&P.push(new de(m,f,`"$type" cannot be use with operator "${f[0]}"`));case"==":case"!=":f.length!==3&&P.push(new de(m,f,`filter array for operator "${f[0]}" must have 3 elements`));case"in":case"!in":f.length>=2&&(A=qr(f[1]),A!=="string"&&P.push(new de(`${m}[1]`,f[1],`string expected, ${A} found`)));for(let D=2;D<f.length;D++)A=qr(f[D]),ki(f[1])==="$type"?P=P.concat(lh({key:`${m}[${D}]`,value:f[D],valueSpec:b.geometry_type,style:g.style,styleSpec:g.styleSpec})):A!=="string"&&A!=="number"&&A!=="boolean"&&P.push(new de(`${m}[${D}]`,f[D],`string, number, or boolean expected, ${A} found`));break;case"any":case"all":case"none":for(let D=1;D<f.length;D++)P=P.concat(a0({key:`${m}[${D}]`,value:f[D],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":A=qr(f[1]),f.length!==2?P.push(new de(m,f,`filter array for "${f[0]}" operator must have 2 elements`)):A!=="string"&&P.push(new de(`${m}[1]`,f[1],`string expected, ${A} found`));break;case"within":A=qr(f[1]),f.length!==2?P.push(new de(m,f,`filter array for "${f[0]}" operator must have 2 elements`)):A!=="object"&&P.push(new de(`${m}[1]`,f[1],`object expected, ${A} found`))}return P}function s0(g,f){const m=g.key,b=g.validateSpec,A=g.style,P=g.styleSpec,D=g.value,k=g.objectKey,z=P[`${f}_${g.layerType}`];if(!z)return[];const $=k.match(/^(.*)-transition$/);if(f==="paint"&&$&&z[$[1]]&&z[$[1]].transition)return b({key:m,value:D,valueSpec:P.transition,style:A,styleSpec:P});const X=g.valueSpec||z[k];if(!X)return[new de(m,D,`unknown property "${k}"`)];let K;if(qr(D)==="string"&&Pu(X)&&!X.tokens&&(K=/^{([^}]+)}$/.exec(D)))return[new de(m,D,`"${k}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(K[1])} }\`.`)];const et=[];return g.layerType==="symbol"&&(k==="text-field"&&A&&!A.glyphs&&et.push(new de(m,D,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&Mi(kl(D))&&ki(D.type)==="identity"&&et.push(new de(m,D,'"text-font" does not support identity functions'))),et.concat(b({key:g.key,value:D,valueSpec:X,style:A,styleSpec:P,expressionContext:"property",propertyType:f,propertyKey:k}))}function o0(g){return s0(g,"paint")}function l0(g){return s0(g,"layout")}function u0(g){let f=[];const m=g.value,b=g.key,A=g.style,P=g.styleSpec;m.type||m.ref||f.push(new de(b,m,'either "type" or "ref" is required'));let D=ki(m.type);const k=ki(m.ref);if(m.id){const z=ki(m.id);for(let $=0;$<g.arrayIndex;$++){const X=A.layers[$];ki(X.id)===z&&f.push(new de(b,m.id,`duplicate layer id "${m.id}", previously used at line ${X.id.__line__}`))}}if("ref"in m){let z;["type","source","source-layer","filter","layout"].forEach($=>{$ in m&&f.push(new de(b,m[$],`"${$}" is prohibited for ref layers`))}),A.layers.forEach($=>{ki($.id)===k&&(z=$)}),z?z.ref?f.push(new de(b,m.ref,"ref cannot reference another ref layer")):D=ki(z.type):f.push(new de(b,m.ref,`ref layer "${k}" not found`))}else if(D!=="background")if(m.source){const z=A.sources&&A.sources[m.source],$=z&&ki(z.type);z?$==="vector"&&D==="raster"?f.push(new de(b,m.source,`layer "${m.id}" requires a raster source`)):$!=="raster-dem"&&D==="hillshade"?f.push(new de(b,m.source,`layer "${m.id}" requires a raster-dem source`)):$==="raster"&&D!=="raster"?f.push(new de(b,m.source,`layer "${m.id}" requires a vector source`)):$!=="vector"||m["source-layer"]?$==="raster-dem"&&D!=="hillshade"?f.push(new de(b,m.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="line"||!m.paint||!m.paint["line-gradient"]||$==="geojson"&&z.lineMetrics||f.push(new de(b,m,`layer "${m.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):f.push(new de(b,m,`layer "${m.id}" must specify a "source-layer"`)):f.push(new de(b,m.source,`source "${m.source}" not found`))}else f.push(new de(b,m,'missing required property "source"'));return f=f.concat(oa({key:b,value:m,valueSpec:P.layer,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":()=>[],type:()=>g.validateSpec({key:`${b}.type`,value:m.type,valueSpec:P.layer.type,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,object:m,objectKey:"type"}),filter:Du,layout:z=>oa({layer:m,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,validateSpec:z.validateSpec,objectElementValidators:{"*":$=>l0(Qa({layerType:D},$))}}),paint:z=>oa({layer:m,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,validateSpec:z.validateSpec,objectElementValidators:{"*":$=>o0(Qa({layerType:D},$))}})}})),f}function Ds(g){const f=g.value,m=g.key,b=qr(f);return b!=="string"?[new de(m,f,`string expected, ${b} found`)]:[]}const uh={promoteId:function({key:g,value:f}){if(qr(f)==="string")return Ds({key:g,value:f});{const m=[];for(const b in f)m.push(...Ds({key:`${g}.${b}`,value:f[b]}));return m}}};function Ra(g){const f=g.value,m=g.key,b=g.styleSpec,A=g.style,P=g.validateSpec;if(!f.type)return[new de(m,f,'"type" is required')];const D=ki(f.type);let k;switch(D){case"vector":case"raster":return k=oa({key:m,value:f,valueSpec:b[`source_${D.replace("-","_")}`],style:g.style,styleSpec:b,objectElementValidators:uh,validateSpec:P}),k;case"raster-dem":return k=function(z){var $;const X=($=z.sourceName)!==null&&$!==void 0?$:"",K=z.value,et=z.styleSpec,at=et.source_raster_dem,ot=z.style;let pt=[];const bt=qr(K);if(K===void 0)return pt;if(bt!=="object")return pt.push(new de("source_raster_dem",K,`object expected, ${bt} found`)),pt;const Ct=ki(K.encoding)==="custom",kt=["redFactor","greenFactor","blueFactor","baseShift"],It=z.value.encoding?`"${z.value.encoding}"`:"Default";for(const Ft in K)!Ct&&kt.includes(Ft)?pt.push(new de(Ft,K[Ft],`In "${X}": "${Ft}" is only valid when "encoding" is set to "custom". ${It} encoding found`)):at[Ft]?pt=pt.concat(z.validateSpec({key:Ft,value:K[Ft],valueSpec:at[Ft],validateSpec:z.validateSpec,style:ot,styleSpec:et})):pt.push(new de(Ft,K[Ft],`unknown property "${Ft}"`));return pt}({sourceName:m,value:f,style:g.style,styleSpec:b,validateSpec:P}),k;case"geojson":if(k=oa({key:m,value:f,valueSpec:b.source_geojson,style:A,styleSpec:b,validateSpec:P,objectElementValidators:uh}),f.cluster)for(const z in f.clusterProperties){const[$,X]=f.clusterProperties[z],K=typeof $=="string"?[$,["accumulated"],["get",z]]:$;k.push(...Ol({key:`${m}.${z}.map`,value:X,validateSpec:P,expressionContext:"cluster-map"})),k.push(...Ol({key:`${m}.${z}.reduce`,value:K,validateSpec:P,expressionContext:"cluster-reduce"}))}return k;case"video":return oa({key:m,value:f,valueSpec:b.source_video,style:A,validateSpec:P,styleSpec:b});case"image":return oa({key:m,value:f,valueSpec:b.source_image,style:A,validateSpec:P,styleSpec:b});case"canvas":return[new de(m,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return lh({key:`${m}.type`,value:f.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:A,validateSpec:P,styleSpec:b})}}function ch(g){const f=g.value,m=g.styleSpec,b=m.light,A=g.style;let P=[];const D=qr(f);if(f===void 0)return P;if(D!=="object")return P=P.concat([new de("light",f,`object expected, ${D} found`)]),P;for(const k in f){const z=k.match(/^(.*)-transition$/);P=P.concat(z&&b[z[1]]&&b[z[1]].transition?g.validateSpec({key:k,value:f[k],valueSpec:m.transition,validateSpec:g.validateSpec,style:A,styleSpec:m}):b[k]?g.validateSpec({key:k,value:f[k],valueSpec:b[k],validateSpec:g.validateSpec,style:A,styleSpec:m}):[new de(k,f[k],`unknown property "${k}"`)])}return P}function c0(g){const f=g.value,m=g.styleSpec,b=m.terrain,A=g.style;let P=[];const D=qr(f);if(f===void 0)return P;if(D!=="object")return P=P.concat([new de("terrain",f,`object expected, ${D} found`)]),P;for(const k in f)P=P.concat(b[k]?g.validateSpec({key:k,value:f[k],valueSpec:b[k],validateSpec:g.validateSpec,style:A,styleSpec:m}):[new de(k,f[k],`unknown property "${k}"`)]);return P}function h0(g){let f=[];const m=g.value,b=g.key;if(Array.isArray(m)){const A=[],P=[];for(const D in m)m[D].id&&A.includes(m[D].id)&&f.push(new de(b,m,`all the sprites' ids must be unique, but ${m[D].id} is duplicated`)),A.push(m[D].id),m[D].url&&P.includes(m[D].url)&&f.push(new de(b,m,`all the sprites' URLs must be unique, but ${m[D].url} is duplicated`)),P.push(m[D].url),f=f.concat(oa({key:`${b}[${D}]`,value:m[D],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:g.validateSpec}));return f}return Ds({key:b,value:m})}const f0={"*":()=>[],array:Ru,boolean:function(g){const f=g.value,m=g.key,b=qr(f);return b!=="boolean"?[new de(m,f,`boolean expected, ${b} found`)]:[]},number:oh,color:function(g){const f=g.key,m=g.value,b=qr(m);return b!=="string"?[new de(f,m,`color expected, ${b} found`)]:Ar.parse(String(m))?[]:[new de(f,m,`color expected, "${m}" found`)]},constants:n0,enum:lh,filter:Du,function:Cd,layer:u0,object:oa,source:Ra,light:ch,terrain:c0,string:Ds,formatted:function(g){return Ds(g).length===0?[]:Ol(g)},resolvedImage:function(g){return Ds(g).length===0?[]:Ol(g)},padding:function(g){const f=g.key,m=g.value;if(qr(m)==="array"){if(m.length<1||m.length>4)return[new de(f,m,`padding requires 1 to 4 values; ${m.length} values found`)];const b={type:"number"};let A=[];for(let P=0;P<m.length;P++)A=A.concat(g.validateSpec({key:`${f}[${P}]`,value:m[P],validateSpec:g.validateSpec,valueSpec:b}));return A}return oh({key:f,value:m,valueSpec:{}})},variableAnchorOffsetCollection:function(g){const f=g.key,m=g.value,b=qr(m),A=g.styleSpec;if(b!=="array"||m.length<1||m.length%2!=0)return[new de(f,m,"variableAnchorOffsetCollection requires a non-empty array of even length")];let P=[];for(let D=0;D<m.length;D+=2)P=P.concat(lh({key:`${f}[${D}]`,value:m[D],valueSpec:A.layout_symbol["text-anchor"]})),P=P.concat(Ru({key:`${f}[${D+1}]`,value:m[D+1],valueSpec:{length:2,value:"number"},validateSpec:g.validateSpec,style:g.style,styleSpec:A}));return P},sprite:h0};function po(g){const f=g.value,m=g.valueSpec,b=g.styleSpec;return g.validateSpec=po,m.expression&&Mi(ki(f))?Cd(g):m.expression&&xd(kl(f))?Ol(g):m.type&&f0[m.type]?f0[m.type](g):oa(Qa({},g,{valueSpec:m.type?b[m.type]:m}))}function d0(g){const f=g.value,m=g.key,b=Ds(g);return b.length||(f.indexOf("{fontstack}")===-1&&b.push(new de(m,f,'"glyphs" url must include a "{fontstack}" token')),f.indexOf("{range}")===-1&&b.push(new de(m,f,'"glyphs" url must include a "{range}" token'))),b}function rs(g,f=qt){let m=[];return m=m.concat(po({key:"",value:g,valueSpec:f.$root,styleSpec:f,style:g,validateSpec:po,objectElementValidators:{glyphs:d0,"*":()=>[]}})),g.constants&&(m=m.concat(n0({key:"constants",value:g.constants,style:g,styleSpec:f,validateSpec:po}))),Ed(m)}function go(g){return function(f){return g({...f,validateSpec:po})}}function Ed(g){return[].concat(g).sort((f,m)=>f.line-m.line)}function vo(g){return function(...f){return Ed(g.apply(this,f))}}rs.source=vo(go(Ra)),rs.sprite=vo(go(h0)),rs.glyphs=vo(go(d0)),rs.light=vo(go(ch)),rs.terrain=vo(go(c0)),rs.layer=vo(go(u0)),rs.filter=vo(go(Du)),rs.paintProperty=vo(go(o0)),rs.layoutProperty=vo(go(l0));const mo=rs,hT=mo.light,lv=mo.paintProperty,p0=mo.layoutProperty;function Id(g,f){let m=!1;if(f&&f.length)for(const b of f)g.fire(new Hi(new Error(b.message))),m=!0;return m}class Lu{constructor(f,m,b){const A=this.cells=[];if(f instanceof ArrayBuffer){this.arrayBuffer=f;const D=new Int32Array(this.arrayBuffer);f=D[0],this.d=(m=D[1])+2*(b=D[2]);for(let z=0;z<this.d*this.d;z++){const $=D[3+z],X=D[3+z+1];A.push($===X?null:D.subarray($,X))}const k=D[3+A.length+1];this.keys=D.subarray(D[3+A.length],k),this.bboxes=D.subarray(k),this.insert=this._insertReadonly}else{this.d=m+2*b;for(let D=0;D<this.d*this.d;D++)A.push([]);this.keys=[],this.bboxes=[]}this.n=m,this.extent=f,this.padding=b,this.scale=m/f,this.uid=0;const P=b/m*f;this.min=-P,this.max=f+P}insert(f,m,b,A,P){this._forEachCell(m,b,A,P,this._insertCell,this.uid++,void 0,void 0),this.keys.push(f),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(A),this.bboxes.push(P)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(f,m,b,A,P,D){this.cells[P].push(D)}query(f,m,b,A,P){const D=this.min,k=this.max;if(f<=D&&m<=D&&k<=b&&k<=A&&!P)return Array.prototype.slice.call(this.keys);{const z=[];return this._forEachCell(f,m,b,A,this._queryCell,z,{},P),z}}_queryCell(f,m,b,A,P,D,k,z){const $=this.cells[P];if($!==null){const X=this.keys,K=this.bboxes;for(let et=0;et<$.length;et++){const at=$[et];if(k[at]===void 0){const ot=4*at;(z?z(K[ot+0],K[ot+1],K[ot+2],K[ot+3]):f<=K[ot+2]&&m<=K[ot+3]&&b>=K[ot+0]&&A>=K[ot+1])?(k[at]=!0,D.push(X[at])):k[at]=!1}}}}_forEachCell(f,m,b,A,P,D,k,z){const $=this._convertToCellCoord(f),X=this._convertToCellCoord(m),K=this._convertToCellCoord(b),et=this._convertToCellCoord(A);for(let at=$;at<=K;at++)for(let ot=X;ot<=et;ot++){const pt=this.d*ot+at;if((!z||z(this._convertFromCellCoord(at),this._convertFromCellCoord(ot),this._convertFromCellCoord(at+1),this._convertFromCellCoord(ot+1)))&&P.call(this,f,m,b,A,pt,D,k,z))return}}_convertFromCellCoord(f){return(f-this.padding)/this.scale}_convertToCellCoord(f){return Math.max(0,Math.min(this.d-1,Math.floor(f*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const f=this.cells,m=3+this.cells.length+1+1;let b=0;for(let D=0;D<this.cells.length;D++)b+=this.cells[D].length;const A=new Int32Array(m+b+this.keys.length+this.bboxes.length);A[0]=this.extent,A[1]=this.n,A[2]=this.padding;let P=m;for(let D=0;D<f.length;D++){const k=f[D];A[3+D]=P,A.set(k,P),P+=k.length}return A[3+f.length]=P,A.set(this.keys,P),P+=this.keys.length,A[3+f.length+1]=P,A.set(this.bboxes,P),P+=this.bboxes.length,A.buffer}static serialize(f,m){const b=f.toArrayBuffer();return m&&m.push(b),{buffer:b}}static deserialize(f){return new Lu(f.buffer)}}const yo={};function De(g,f,m={}){if(yo[g])throw new Error(`${g} is already registered.`);Object.defineProperty(f,"_classRegistryKey",{value:g,writeable:!1}),yo[g]={klass:f,omit:m.omit||[],shallow:m.shallow||[]}}De("Object",Object),De("TransferableGridIndex",Lu),De("Color",Ar),De("Error",Error),De("AJAXError",Ce),De("ResolvedImage",ii),De("StylePropertyFunction",ih),De("StyleExpression",iv,{omit:["_evaluator"]}),De("ZoomDependentExpression",wd),De("ZoomConstantExpression",nv),De("CompoundExpression",es,{omit:["_evaluate"]});for(const g in Mu)Mu[g]._classRegistryKey||De(`Expression_${g}`,Mu[g]);function Md(g){return g&&typeof ArrayBuffer<"u"&&(g instanceof ArrayBuffer||g.constructor&&g.constructor.name==="ArrayBuffer")}function jo(g,f){if(g==null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||g instanceof Boolean||g instanceof Number||g instanceof String||g instanceof Date||g instanceof RegExp||g instanceof Blob)return g;if(Md(g)||Ut(g))return f&&f.push(g),g;if(ArrayBuffer.isView(g)){const m=g;return f&&f.push(m.buffer),m}if(g instanceof ImageData)return f&&f.push(g.data.buffer),g;if(Array.isArray(g)){const m=[];for(const b of g)m.push(jo(b,f));return m}if(typeof g=="object"){const m=g.constructor,b=m._classRegistryKey;if(!b)throw new Error("can't serialize object of unregistered class");if(!yo[b])throw new Error(`${b} is not registered.`);const A=m.serialize?m.serialize(g,f):{};if(m.serialize){if(f&&A===f[f.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const P in g){if(!g.hasOwnProperty(P)||yo[b].omit.indexOf(P)>=0)continue;const D=g[P];A[P]=yo[b].shallow.indexOf(P)>=0?D:jo(D,f)}g instanceof Error&&(A.message=g.message)}if(A.$name)throw new Error("$name property is reserved for worker serialization logic.");return b!=="Object"&&(A.$name=b),A}throw new Error("can't serialize object of type "+typeof g)}function ku(g){if(g==null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||g instanceof Boolean||g instanceof Number||g instanceof String||g instanceof Date||g instanceof RegExp||g instanceof Blob||Md(g)||Ut(g)||ArrayBuffer.isView(g)||g instanceof ImageData)return g;if(Array.isArray(g))return g.map(ku);if(typeof g=="object"){const f=g.$name||"Object";if(!yo[f])throw new Error(`can't deserialize unregistered class ${f}`);const{klass:m}=yo[f];if(!m)throw new Error(`can't deserialize unregistered class ${f}`);if(m.deserialize)return m.deserialize(g);const b=Object.create(m.prototype);for(const A of Object.keys(g)){if(A==="$name")continue;const P=g[A];b[A]=yo[f].shallow.indexOf(A)>=0?P:ku(P)}return b}throw new Error("can't deserialize object of type "+typeof g)}class g0{constructor(){this.first=!0}update(f,m){const b=Math.floor(f);return this.first?(this.first=!1,this.lastIntegerZoom=b,this.lastIntegerZoomTime=0,this.lastZoom=f,this.lastFloorZoom=b,!0):(this.lastFloorZoom>b?(this.lastIntegerZoom=b+1,this.lastIntegerZoomTime=m):this.lastFloorZoom<b&&(this.lastIntegerZoom=b,this.lastIntegerZoomTime=m),f!==this.lastZoom&&(this.lastZoom=f,this.lastFloorZoom=b,!0))}}const Me={"Latin-1 Supplement":g=>g>=128&&g<=255,Arabic:g=>g>=1536&&g<=1791,"Arabic Supplement":g=>g>=1872&&g<=1919,"Arabic Extended-A":g=>g>=2208&&g<=2303,"Hangul Jamo":g=>g>=4352&&g<=4607,"Unified Canadian Aboriginal Syllabics":g=>g>=5120&&g<=5759,Khmer:g=>g>=6016&&g<=6143,"Unified Canadian Aboriginal Syllabics Extended":g=>g>=6320&&g<=6399,"General Punctuation":g=>g>=8192&&g<=8303,"Letterlike Symbols":g=>g>=8448&&g<=8527,"Number Forms":g=>g>=8528&&g<=8591,"Miscellaneous Technical":g=>g>=8960&&g<=9215,"Control Pictures":g=>g>=9216&&g<=9279,"Optical Character Recognition":g=>g>=9280&&g<=9311,"Enclosed Alphanumerics":g=>g>=9312&&g<=9471,"Geometric Shapes":g=>g>=9632&&g<=9727,"Miscellaneous Symbols":g=>g>=9728&&g<=9983,"Miscellaneous Symbols and Arrows":g=>g>=11008&&g<=11263,"CJK Radicals Supplement":g=>g>=11904&&g<=12031,"Kangxi Radicals":g=>g>=12032&&g<=12255,"Ideographic Description Characters":g=>g>=12272&&g<=12287,"CJK Symbols and Punctuation":g=>g>=12288&&g<=12351,Hiragana:g=>g>=12352&&g<=12447,Katakana:g=>g>=12448&&g<=12543,Bopomofo:g=>g>=12544&&g<=12591,"Hangul Compatibility Jamo":g=>g>=12592&&g<=12687,Kanbun:g=>g>=12688&&g<=12703,"Bopomofo Extended":g=>g>=12704&&g<=12735,"CJK Strokes":g=>g>=12736&&g<=12783,"Katakana Phonetic Extensions":g=>g>=12784&&g<=12799,"Enclosed CJK Letters and Months":g=>g>=12800&&g<=13055,"CJK Compatibility":g=>g>=13056&&g<=13311,"CJK Unified Ideographs Extension A":g=>g>=13312&&g<=19903,"Yijing Hexagram Symbols":g=>g>=19904&&g<=19967,"CJK Unified Ideographs":g=>g>=19968&&g<=40959,"Yi Syllables":g=>g>=40960&&g<=42127,"Yi Radicals":g=>g>=42128&&g<=42191,"Hangul Jamo Extended-A":g=>g>=43360&&g<=43391,"Hangul Syllables":g=>g>=44032&&g<=55215,"Hangul Jamo Extended-B":g=>g>=55216&&g<=55295,"Private Use Area":g=>g>=57344&&g<=63743,"CJK Compatibility Ideographs":g=>g>=63744&&g<=64255,"Arabic Presentation Forms-A":g=>g>=64336&&g<=65023,"Vertical Forms":g=>g>=65040&&g<=65055,"CJK Compatibility Forms":g=>g>=65072&&g<=65103,"Small Form Variants":g=>g>=65104&&g<=65135,"Arabic Presentation Forms-B":g=>g>=65136&&g<=65279,"Halfwidth and Fullwidth Forms":g=>g>=65280&&g<=65519};function uv(g){for(const f of g)if(hv(f.charCodeAt(0)))return!0;return!1}function cv(g){for(const f of g)if(!fT(f.charCodeAt(0)))return!1;return!0}function fT(g){return!(Me.Arabic(g)||Me["Arabic Supplement"](g)||Me["Arabic Extended-A"](g)||Me["Arabic Presentation Forms-A"](g)||Me["Arabic Presentation Forms-B"](g))}function hv(g){return!(g!==746&&g!==747&&(g<4352||!(Me["Bopomofo Extended"](g)||Me.Bopomofo(g)||Me["CJK Compatibility Forms"](g)&&!(g>=65097&&g<=65103)||Me["CJK Compatibility Ideographs"](g)||Me["CJK Compatibility"](g)||Me["CJK Radicals Supplement"](g)||Me["CJK Strokes"](g)||!(!Me["CJK Symbols and Punctuation"](g)||g>=12296&&g<=12305||g>=12308&&g<=12319||g===12336)||Me["CJK Unified Ideographs Extension A"](g)||Me["CJK Unified Ideographs"](g)||Me["Enclosed CJK Letters and Months"](g)||Me["Hangul Compatibility Jamo"](g)||Me["Hangul Jamo Extended-A"](g)||Me["Hangul Jamo Extended-B"](g)||Me["Hangul Jamo"](g)||Me["Hangul Syllables"](g)||Me.Hiragana(g)||Me["Ideographic Description Characters"](g)||Me.Kanbun(g)||Me["Kangxi Radicals"](g)||Me["Katakana Phonetic Extensions"](g)||Me.Katakana(g)&&g!==12540||!(!Me["Halfwidth and Fullwidth Forms"](g)||g===65288||g===65289||g===65293||g>=65306&&g<=65310||g===65339||g===65341||g===65343||g>=65371&&g<=65503||g===65507||g>=65512&&g<=65519)||!(!Me["Small Form Variants"](g)||g>=65112&&g<=65118||g>=65123&&g<=65126)||Me["Unified Canadian Aboriginal Syllabics"](g)||Me["Unified Canadian Aboriginal Syllabics Extended"](g)||Me["Vertical Forms"](g)||Me["Yijing Hexagram Symbols"](g)||Me["Yi Syllables"](g)||Me["Yi Radicals"](g))))}function v0(g){return!(hv(g)||function(f){return!!(Me["Latin-1 Supplement"](f)&&(f===167||f===169||f===174||f===177||f===188||f===189||f===190||f===215||f===247)||Me["General Punctuation"](f)&&(f===8214||f===8224||f===8225||f===8240||f===8241||f===8251||f===8252||f===8258||f===8263||f===8264||f===8265||f===8273)||Me["Letterlike Symbols"](f)||Me["Number Forms"](f)||Me["Miscellaneous Technical"](f)&&(f>=8960&&f<=8967||f>=8972&&f<=8991||f>=8996&&f<=9e3||f===9003||f>=9085&&f<=9114||f>=9150&&f<=9165||f===9167||f>=9169&&f<=9179||f>=9186&&f<=9215)||Me["Control Pictures"](f)&&f!==9251||Me["Optical Character Recognition"](f)||Me["Enclosed Alphanumerics"](f)||Me["Geometric Shapes"](f)||Me["Miscellaneous Symbols"](f)&&!(f>=9754&&f<=9759)||Me["Miscellaneous Symbols and Arrows"](f)&&(f>=11026&&f<=11055||f>=11088&&f<=11097||f>=11192&&f<=11243)||Me["CJK Symbols and Punctuation"](f)||Me.Katakana(f)||Me["Private Use Area"](f)||Me["CJK Compatibility Forms"](f)||Me["Small Form Variants"](f)||Me["Halfwidth and Fullwidth Forms"](f)||f===8734||f===8756||f===8757||f>=9984&&f<=10087||f>=10102&&f<=10131||f===65532||f===65533)}(g))}function m0(g){return g>=1424&&g<=2303||Me["Arabic Presentation Forms-A"](g)||Me["Arabic Presentation Forms-B"](g)}function y0(g,f){return!(!f&&m0(g)||g>=2304&&g<=3583||g>=3840&&g<=4255||Me.Khmer(g))}function dT(g){for(const f of g)if(m0(f.charCodeAt(0)))return!0;return!1}const fv="deferred",dv="loading",pv="loaded";let gv=null,la="unavailable",Xo=null;const hh=function(g){g&&typeof g=="string"&&g.indexOf("NetworkError")>-1&&(la="error"),gv&&gv(g)};function vv(){fh.fire(new Xr("pluginStateChange",{pluginStatus:la,pluginURL:Xo}))}const fh=new wi,mv=function(){return la},_0=function(){if(la!==fv||!Xo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");la=dv,vv(),Xo&&Rr({url:Xo},g=>{g?hh(g):(la=pv,vv())})},Da={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>la===pv||Da.applyArabicShaping!=null,isLoading:()=>la===dv,setState(g){if(!Ot())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");la=g.pluginStatus,Xo=g.pluginURL},isParsed(){if(!Ot())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Da.applyArabicShaping!=null&&Da.processBidirectionalText!=null&&Da.processStyledBidirectionalText!=null},getPluginURL(){if(!Ot())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Xo}};class gi{constructor(f,m){this.zoom=f,m?(this.now=m.now,this.fadeDuration=m.fadeDuration,this.zoomHistory=m.zoomHistory,this.transition=m.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new g0,this.transition={})}isSupportedScript(f){return function(m,b){for(const A of m)if(!y0(A.charCodeAt(0),b))return!1;return!0}(f,Da.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const f=this.zoom,m=f-Math.floor(f),b=this.crossFadingFactor();return f>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:m+(1-m)*b}:{fromScale:.5,toScale:1,t:1-(1-b)*m}}}class Pd{constructor(f,m){this.property=f,this.value=m,this.expression=function(b,A){if(Mi(b))return new ih(b,A);if(xd(b)){const P=av(b,A);if(P.result==="error")throw new Error(P.value.map(D=>`${D.key}: ${D.message}`).join(", "));return P.value}{let P=b;return A.type==="color"&&typeof b=="string"?P=Ar.parse(b):A.type!=="padding"||typeof b!="number"&&!Array.isArray(b)?A.type==="variableAnchorOffsetCollection"&&Array.isArray(b)&&(P=Tn.parse(b)):P=kn.parse(b),{kind:"constant",evaluate:()=>P}}}(m===void 0?f.specification.default:m,f.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(f,m,b){return this.property.possiblyEvaluate(this,f,m,b)}}class yv{constructor(f){this.property=f,this.value=new Pd(f,void 0)}transitioned(f,m){return new b0(this.property,this.value,m,W({},f.transition,this.transition),f.now)}untransitioned(){return new b0(this.property,this.value,null,{},0)}}class x0{constructor(f){this._properties=f,this._values=Object.create(f.defaultTransitionablePropertyValues)}getValue(f){return tt(this._values[f].value.value)}setValue(f,m){Object.prototype.hasOwnProperty.call(this._values,f)||(this._values[f]=new yv(this._values[f].property)),this._values[f].value=new Pd(this._values[f].property,m===null?void 0:tt(m))}getTransition(f){return tt(this._values[f].transition)}setTransition(f,m){Object.prototype.hasOwnProperty.call(this._values,f)||(this._values[f]=new yv(this._values[f].property)),this._values[f].transition=tt(m)||void 0}serialize(){const f={};for(const m of Object.keys(this._values)){const b=this.getValue(m);b!==void 0&&(f[m]=b);const A=this.getTransition(m);A!==void 0&&(f[`${m}-transition`]=A)}return f}transitioned(f,m){const b=new w0(this._properties);for(const A of Object.keys(this._values))b._values[A]=this._values[A].transitioned(f,m._values[A]);return b}untransitioned(){const f=new w0(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].untransitioned();return f}}class b0{constructor(f,m,b,A,P){this.property=f,this.value=m,this.begin=P+A.delay||0,this.end=this.begin+A.duration||0,f.specification.transition&&(A.delay||A.duration)&&(this.prior=b)}possiblyEvaluate(f,m,b){const A=f.now||0,P=this.value.possiblyEvaluate(f,m,b),D=this.prior;if(D){if(A>this.end)return this.prior=null,P;if(this.value.isDataDriven())return this.prior=null,P;if(A<this.begin)return D.possiblyEvaluate(f,m,b);{const k=(A-this.begin)/(this.end-this.begin);return this.property.interpolate(D.possiblyEvaluate(f,m,b),P,function(z){if(z<=0)return 0;if(z>=1)return 1;const $=z*z,X=$*z;return 4*(z<.5?X:3*(z-$)+X-.75)}(k))}}return P}}class w0{constructor(f){this._properties=f,this._values=Object.create(f.defaultTransitioningPropertyValues)}possiblyEvaluate(f,m,b){const A=new Rd(this._properties);for(const P of Object.keys(this._values))A._values[P]=this._values[P].possiblyEvaluate(f,m,b);return A}hasTransition(){for(const f of Object.keys(this._values))if(this._values[f].prior)return!0;return!1}}class pT{constructor(f){this._properties=f,this._values=Object.create(f.defaultPropertyValues)}hasValue(f){return this._values[f].value!==void 0}getValue(f){return tt(this._values[f].value)}setValue(f,m){this._values[f]=new Pd(this._values[f].property,m===null?void 0:tt(m))}serialize(){const f={};for(const m of Object.keys(this._values)){const b=this.getValue(m);b!==void 0&&(f[m]=b)}return f}possiblyEvaluate(f,m,b){const A=new Rd(this._properties);for(const P of Object.keys(this._values))A._values[P]=this._values[P].possiblyEvaluate(f,m,b);return A}}class Hn{constructor(f,m,b){this.property=f,this.value=m,this.parameters=b}isConstant(){return this.value.kind==="constant"}constantOr(f){return this.value.kind==="constant"?this.value.value:f}evaluate(f,m,b,A){return this.property.evaluate(this.value,this.parameters,f,m,b,A)}}class Rd{constructor(f){this._properties=f,this._values=Object.create(f.defaultPossiblyEvaluatedValues)}get(f){return this._values[f]}}class He{constructor(f){this.specification=f}possiblyEvaluate(f,m){if(f.isDataDriven())throw new Error("Value should not be data driven");return f.expression.evaluate(m)}interpolate(f,m,b){const A=Ma[this.specification.type];return A?A(f,m,b):f}}class er{constructor(f,m){this.specification=f,this.overrides=m}possiblyEvaluate(f,m,b,A){return new Hn(this,f.expression.kind==="constant"||f.expression.kind==="camera"?{kind:"constant",value:f.expression.evaluate(m,null,{},b,A)}:f.expression,m)}interpolate(f,m,b){if(f.value.kind!=="constant"||m.value.kind!=="constant")return f;if(f.value.value===void 0||m.value.value===void 0)return new Hn(this,{kind:"constant",value:void 0},f.parameters);const A=Ma[this.specification.type];if(A){const P=A(f.value.value,m.value.value,b);return new Hn(this,{kind:"constant",value:P},f.parameters)}return f}evaluate(f,m,b,A,P,D){return f.kind==="constant"?f.value:f.evaluate(m,b,A,P,D)}}class dh extends er{possiblyEvaluate(f,m,b,A){if(f.value===void 0)return new Hn(this,{kind:"constant",value:void 0},m);if(f.expression.kind==="constant"){const P=f.expression.evaluate(m,null,{},b,A),D=f.property.specification.type==="resolvedImage"&&typeof P!="string"?P.name:P,k=this._calculate(D,D,D,m);return new Hn(this,{kind:"constant",value:k},m)}if(f.expression.kind==="camera"){const P=this._calculate(f.expression.evaluate({zoom:m.zoom-1}),f.expression.evaluate({zoom:m.zoom}),f.expression.evaluate({zoom:m.zoom+1}),m);return new Hn(this,{kind:"constant",value:P},m)}return new Hn(this,f.expression,m)}evaluate(f,m,b,A,P,D){if(f.kind==="source"){const k=f.evaluate(m,b,A,P,D);return this._calculate(k,k,k,m)}return f.kind==="composite"?this._calculate(f.evaluate({zoom:Math.floor(m.zoom)-1},b,A),f.evaluate({zoom:Math.floor(m.zoom)},b,A),f.evaluate({zoom:Math.floor(m.zoom)+1},b,A),m):f.value}_calculate(f,m,b,A){return A.zoom>A.zoomHistory.lastIntegerZoom?{from:f,to:m}:{from:b,to:m}}interpolate(f){return f}}class _v{constructor(f){this.specification=f}possiblyEvaluate(f,m,b,A){if(f.value!==void 0){if(f.expression.kind==="constant"){const P=f.expression.evaluate(m,null,{},b,A);return this._calculate(P,P,P,m)}return this._calculate(f.expression.evaluate(new gi(Math.floor(m.zoom-1),m)),f.expression.evaluate(new gi(Math.floor(m.zoom),m)),f.expression.evaluate(new gi(Math.floor(m.zoom+1),m)),m)}}_calculate(f,m,b,A){return A.zoom>A.zoomHistory.lastIntegerZoom?{from:f,to:m}:{from:b,to:m}}interpolate(f){return f}}class xv{constructor(f){this.specification=f}possiblyEvaluate(f,m,b,A){return!!f.expression.evaluate(m,null,{},b,A)}interpolate(){return!1}}class Gi{constructor(f){this.properties=f,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const m in f){const b=f[m];b.specification.overridable&&this.overridableProperties.push(m);const A=this.defaultPropertyValues[m]=new Pd(b,void 0),P=this.defaultTransitionablePropertyValues[m]=new yv(b);this.defaultTransitioningPropertyValues[m]=P.untransitioned(),this.defaultPossiblyEvaluatedValues[m]=A.possiblyEvaluate({})}}}De("DataDrivenProperty",er),De("DataConstantProperty",He),De("CrossFadedDataDrivenProperty",dh),De("CrossFadedProperty",_v),De("ColorRampProperty",xv);const bv="-transition";class is extends wi{constructor(f,m){if(super(),this.id=f.id,this.type=f.type,this._featureFilter={filter:()=>!0,needGeometry:!1},f.type!=="custom"&&(this.metadata=f.metadata,this.minzoom=f.minzoom,this.maxzoom=f.maxzoom,f.type!=="background"&&(this.source=f.source,this.sourceLayer=f["source-layer"],this.filter=f.filter),m.layout&&(this._unevaluatedLayout=new pT(m.layout)),m.paint)){this._transitionablePaint=new x0(m.paint);for(const b in f.paint)this.setPaintProperty(b,f.paint[b],{validate:!1});for(const b in f.layout)this.setLayoutProperty(b,f.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Rd(m.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(f){return f==="visibility"?this.visibility:this._unevaluatedLayout.getValue(f)}setLayoutProperty(f,m,b={}){m!=null&&this._validate(p0,`layers.${this.id}.layout.${f}`,f,m,b)||(f!=="visibility"?this._unevaluatedLayout.setValue(f,m):this.visibility=m)}getPaintProperty(f){return f.endsWith(bv)?this._transitionablePaint.getTransition(f.slice(0,-11)):this._transitionablePaint.getValue(f)}setPaintProperty(f,m,b={}){if(m!=null&&this._validate(lv,`layers.${this.id}.paint.${f}`,f,m,b))return!1;if(f.endsWith(bv))return this._transitionablePaint.setTransition(f.slice(0,-11),m||void 0),!1;{const A=this._transitionablePaint._values[f],P=A.property.specification["property-type"]==="cross-faded-data-driven",D=A.value.isDataDriven(),k=A.value;this._transitionablePaint.setValue(f,m),this._handleSpecialPaintPropertyUpdate(f);const z=this._transitionablePaint._values[f].value;return z.isDataDriven()||D||P||this._handleOverridablePaintPropertyUpdate(f,k,z)}}_handleSpecialPaintPropertyUpdate(f){}_handleOverridablePaintPropertyUpdate(f,m,b){return!1}isHidden(f){return!!(this.minzoom&&f<this.minzoom)||!!(this.maxzoom&&f>=this.maxzoom)||this.visibility==="none"}updateTransitions(f){this._transitioningPaint=this._transitionablePaint.transitioned(f,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(f,m){f.getCrossfadeParameters&&(this._crossfadeParameters=f.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(f,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(f,void 0,m)}serialize(){const f={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(f.layout=f.layout||{},f.layout.visibility=this.visibility),Y(f,(m,b)=>!(m===void 0||b==="layout"&&!Object.keys(m).length||b==="paint"&&!Object.keys(m).length))}_validate(f,m,b,A,P={}){return(!P||P.validate!==!1)&&Id(this,f.call(mo,{key:m,layerType:this.type,objectKey:b,value:A,styleSpec:qt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const f in this.paint._values){const m=this.paint.get(f);if(m instanceof Hn&&Pu(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1}}const S0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Nl{constructor(f,m){this._structArray=f,this._pos1=m*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Oi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(f,m){return f._trim(),m&&(f.isTransferred=!0,m.push(f.arrayBuffer)),{length:f.length,arrayBuffer:f.arrayBuffer}}static deserialize(f){const m=Object.create(this.prototype);return m.arrayBuffer=f.arrayBuffer,m.length=f.length,m.capacity=f.arrayBuffer.byteLength/m.bytesPerElement,m._refreshViews(),m}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(f){this.reserve(f),this.length=f}reserve(f){if(f>this.capacity){this.capacity=Math.max(f,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const m=this.uint8;this._refreshViews(),m&&this.uint8.set(m)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ri(g,f=1){let m=0,b=0;return{members:g.map(A=>{const P=S0[A.type].BYTES_PER_ELEMENT,D=m=Ou(m,Math.max(f,P)),k=A.components||1;return b=Math.max(b,P),m+=P*k,{name:A.name,type:A.type,components:k,offset:D}}),size:Ou(m,Math.max(b,f)),alignment:f}}function Ou(g,f){return Math.ceil(g/f)*f}class ph extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,m){const b=this.length;return this.resize(b+1),this.emplace(b,f,m)}emplace(f,m,b){const A=2*f;return this.int16[A+0]=m,this.int16[A+1]=b,f}}ph.prototype.bytesPerElement=4,De("StructArrayLayout2i4",ph);class gh extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,m,b){const A=this.length;return this.resize(A+1),this.emplace(A,f,m,b)}emplace(f,m,b,A){const P=3*f;return this.int16[P+0]=m,this.int16[P+1]=b,this.int16[P+2]=A,f}}gh.prototype.bytesPerElement=6,De("StructArrayLayout3i6",gh);class Fl extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,m,b,A){const P=this.length;return this.resize(P+1),this.emplace(P,f,m,b,A)}emplace(f,m,b,A,P){const D=4*f;return this.int16[D+0]=m,this.int16[D+1]=b,this.int16[D+2]=A,this.int16[D+3]=P,f}}Fl.prototype.bytesPerElement=8,De("StructArrayLayout4i8",Fl);class wv extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,m,b,A,P,D){const k=this.length;return this.resize(k+1),this.emplace(k,f,m,b,A,P,D)}emplace(f,m,b,A,P,D,k){const z=6*f;return this.int16[z+0]=m,this.int16[z+1]=b,this.int16[z+2]=A,this.int16[z+3]=P,this.int16[z+4]=D,this.int16[z+5]=k,f}}wv.prototype.bytesPerElement=12,De("StructArrayLayout2i4i12",wv);class Sv extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,m,b,A,P,D){const k=this.length;return this.resize(k+1),this.emplace(k,f,m,b,A,P,D)}emplace(f,m,b,A,P,D,k){const z=4*f,$=8*f;return this.int16[z+0]=m,this.int16[z+1]=b,this.uint8[$+4]=A,this.uint8[$+5]=P,this.uint8[$+6]=D,this.uint8[$+7]=k,f}}Sv.prototype.bytesPerElement=8,De("StructArrayLayout2i4ub8",Sv);class Nu extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,m){const b=this.length;return this.resize(b+1),this.emplace(b,f,m)}emplace(f,m,b){const A=2*f;return this.float32[A+0]=m,this.float32[A+1]=b,f}}Nu.prototype.bytesPerElement=8,De("StructArrayLayout2f8",Nu);class Tv extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,m,b,A,P,D,k,z,$,X){const K=this.length;return this.resize(K+1),this.emplace(K,f,m,b,A,P,D,k,z,$,X)}emplace(f,m,b,A,P,D,k,z,$,X,K){const et=10*f;return this.uint16[et+0]=m,this.uint16[et+1]=b,this.uint16[et+2]=A,this.uint16[et+3]=P,this.uint16[et+4]=D,this.uint16[et+5]=k,this.uint16[et+6]=z,this.uint16[et+7]=$,this.uint16[et+8]=X,this.uint16[et+9]=K,f}}Tv.prototype.bytesPerElement=20,De("StructArrayLayout10ui20",Tv);class Av extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,m,b,A,P,D,k,z,$,X,K,et){const at=this.length;return this.resize(at+1),this.emplace(at,f,m,b,A,P,D,k,z,$,X,K,et)}emplace(f,m,b,A,P,D,k,z,$,X,K,et,at){const ot=12*f;return this.int16[ot+0]=m,this.int16[ot+1]=b,this.int16[ot+2]=A,this.int16[ot+3]=P,this.uint16[ot+4]=D,this.uint16[ot+5]=k,this.uint16[ot+6]=z,this.uint16[ot+7]=$,this.int16[ot+8]=X,this.int16[ot+9]=K,this.int16[ot+10]=et,this.int16[ot+11]=at,f}}Av.prototype.bytesPerElement=24,De("StructArrayLayout4i4ui4i24",Av);class Yr extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,m,b){const A=this.length;return this.resize(A+1),this.emplace(A,f,m,b)}emplace(f,m,b,A){const P=3*f;return this.float32[P+0]=m,this.float32[P+1]=b,this.float32[P+2]=A,f}}Yr.prototype.bytesPerElement=12,De("StructArrayLayout3f12",Yr);class I extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(f){const m=this.length;return this.resize(m+1),this.emplace(m,f)}emplace(f,m){return this.uint32[1*f+0]=m,f}}I.prototype.bytesPerElement=4,De("StructArrayLayout1ul4",I);class d extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,m,b,A,P,D,k,z,$){const X=this.length;return this.resize(X+1),this.emplace(X,f,m,b,A,P,D,k,z,$)}emplace(f,m,b,A,P,D,k,z,$,X){const K=10*f,et=5*f;return this.int16[K+0]=m,this.int16[K+1]=b,this.int16[K+2]=A,this.int16[K+3]=P,this.int16[K+4]=D,this.int16[K+5]=k,this.uint32[et+3]=z,this.uint16[K+8]=$,this.uint16[K+9]=X,f}}d.prototype.bytesPerElement=20,De("StructArrayLayout6i1ul2ui20",d);class _ extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,m,b,A,P,D){const k=this.length;return this.resize(k+1),this.emplace(k,f,m,b,A,P,D)}emplace(f,m,b,A,P,D,k){const z=6*f;return this.int16[z+0]=m,this.int16[z+1]=b,this.int16[z+2]=A,this.int16[z+3]=P,this.int16[z+4]=D,this.int16[z+5]=k,f}}_.prototype.bytesPerElement=12,De("StructArrayLayout2i2i2i12",_);class S extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,m,b,A,P){const D=this.length;return this.resize(D+1),this.emplace(D,f,m,b,A,P)}emplace(f,m,b,A,P,D){const k=4*f,z=8*f;return this.float32[k+0]=m,this.float32[k+1]=b,this.float32[k+2]=A,this.int16[z+6]=P,this.int16[z+7]=D,f}}S.prototype.bytesPerElement=16,De("StructArrayLayout2f1f2i16",S);class C extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,m,b,A){const P=this.length;return this.resize(P+1),this.emplace(P,f,m,b,A)}emplace(f,m,b,A,P){const D=12*f,k=3*f;return this.uint8[D+0]=m,this.uint8[D+1]=b,this.float32[k+1]=A,this.float32[k+2]=P,f}}C.prototype.bytesPerElement=12,De("StructArrayLayout2ub2f12",C);class R extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,m,b){const A=this.length;return this.resize(A+1),this.emplace(A,f,m,b)}emplace(f,m,b,A){const P=3*f;return this.uint16[P+0]=m,this.uint16[P+1]=b,this.uint16[P+2]=A,f}}R.prototype.bytesPerElement=6,De("StructArrayLayout3ui6",R);class N extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,m,b,A,P,D,k,z,$,X,K,et,at,ot,pt,bt,Ct){const kt=this.length;return this.resize(kt+1),this.emplace(kt,f,m,b,A,P,D,k,z,$,X,K,et,at,ot,pt,bt,Ct)}emplace(f,m,b,A,P,D,k,z,$,X,K,et,at,ot,pt,bt,Ct,kt){const It=24*f,Ft=12*f,Ht=48*f;return this.int16[It+0]=m,this.int16[It+1]=b,this.uint16[It+2]=A,this.uint16[It+3]=P,this.uint32[Ft+2]=D,this.uint32[Ft+3]=k,this.uint32[Ft+4]=z,this.uint16[It+10]=$,this.uint16[It+11]=X,this.uint16[It+12]=K,this.float32[Ft+7]=et,this.float32[Ft+8]=at,this.uint8[Ht+36]=ot,this.uint8[Ht+37]=pt,this.uint8[Ht+38]=bt,this.uint32[Ft+10]=Ct,this.int16[It+22]=kt,f}}N.prototype.bytesPerElement=48,De("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",N);class B extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,m,b,A,P,D,k,z,$,X,K,et,at,ot,pt,bt,Ct,kt,It,Ft,Ht,re,Pe,ze,Te,be,pe,Le){const me=this.length;return this.resize(me+1),this.emplace(me,f,m,b,A,P,D,k,z,$,X,K,et,at,ot,pt,bt,Ct,kt,It,Ft,Ht,re,Pe,ze,Te,be,pe,Le)}emplace(f,m,b,A,P,D,k,z,$,X,K,et,at,ot,pt,bt,Ct,kt,It,Ft,Ht,re,Pe,ze,Te,be,pe,Le,me){const le=32*f,Ye=16*f;return this.int16[le+0]=m,this.int16[le+1]=b,this.int16[le+2]=A,this.int16[le+3]=P,this.int16[le+4]=D,this.int16[le+5]=k,this.int16[le+6]=z,this.int16[le+7]=$,this.uint16[le+8]=X,this.uint16[le+9]=K,this.uint16[le+10]=et,this.uint16[le+11]=at,this.uint16[le+12]=ot,this.uint16[le+13]=pt,this.uint16[le+14]=bt,this.uint16[le+15]=Ct,this.uint16[le+16]=kt,this.uint16[le+17]=It,this.uint16[le+18]=Ft,this.uint16[le+19]=Ht,this.uint16[le+20]=re,this.uint16[le+21]=Pe,this.uint16[le+22]=ze,this.uint32[Ye+12]=Te,this.float32[Ye+13]=be,this.float32[Ye+14]=pe,this.uint16[le+30]=Le,this.uint16[le+31]=me,f}}B.prototype.bytesPerElement=64,De("StructArrayLayout8i15ui1ul2f2ui64",B);class V extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f){const m=this.length;return this.resize(m+1),this.emplace(m,f)}emplace(f,m){return this.float32[1*f+0]=m,f}}V.prototype.bytesPerElement=4,De("StructArrayLayout1f4",V);class G extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,m,b){const A=this.length;return this.resize(A+1),this.emplace(A,f,m,b)}emplace(f,m,b,A){const P=3*f;return this.uint16[6*f+0]=m,this.float32[P+1]=b,this.float32[P+2]=A,f}}G.prototype.bytesPerElement=12,De("StructArrayLayout1ui2f12",G);class Z extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,m,b){const A=this.length;return this.resize(A+1),this.emplace(A,f,m,b)}emplace(f,m,b,A){const P=4*f;return this.uint32[2*f+0]=m,this.uint16[P+2]=b,this.uint16[P+3]=A,f}}Z.prototype.bytesPerElement=8,De("StructArrayLayout1ul2ui8",Z);class q extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,m){const b=this.length;return this.resize(b+1),this.emplace(b,f,m)}emplace(f,m,b){const A=2*f;return this.uint16[A+0]=m,this.uint16[A+1]=b,f}}q.prototype.bytesPerElement=4,De("StructArrayLayout2ui4",q);class nt extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f){const m=this.length;return this.resize(m+1),this.emplace(m,f)}emplace(f,m){return this.uint16[1*f+0]=m,f}}nt.prototype.bytesPerElement=2,De("StructArrayLayout1ui2",nt);class vt extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,m,b,A){const P=this.length;return this.resize(P+1),this.emplace(P,f,m,b,A)}emplace(f,m,b,A,P){const D=4*f;return this.float32[D+0]=m,this.float32[D+1]=b,this.float32[D+2]=A,this.float32[D+3]=P,f}}vt.prototype.bytesPerElement=16,De("StructArrayLayout4f16",vt);class gt extends Nl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new p(this.anchorPointX,this.anchorPointY)}}gt.prototype.size=20;class _t extends d{get(f){return new gt(this,f)}}De("CollisionBoxArray",_t);class dt extends Nl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(f){this._structArray.uint8[this._pos1+37]=f}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(f){this._structArray.uint8[this._pos1+38]=f}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(f){this._structArray.uint32[this._pos4+10]=f}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}dt.prototype.size=48;class Pt extends N{get(f){return new dt(this,f)}}De("PlacedSymbolArray",Pt);class $t extends Nl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(f){this._structArray.uint32[this._pos4+12]=f}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}$t.prototype.size=64;class St extends B{get(f){return new $t(this,f)}}De("SymbolInstanceArray",St);class Lt extends V{getoffsetX(f){return this.float32[1*f+0]}}De("GlyphOffsetArray",Lt);class Gt extends gh{getx(f){return this.int16[3*f+0]}gety(f){return this.int16[3*f+1]}gettileUnitDistanceFromAnchor(f){return this.int16[3*f+2]}}De("SymbolLineVertexArray",Gt);class Xt extends Nl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Xt.prototype.size=12;class ee extends G{get(f){return new Xt(this,f)}}De("TextAnchorOffsetArray",ee);class oe extends Nl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}oe.prototype.size=8;class ae extends Z{get(f){return new oe(this,f)}}De("FeatureIndexArray",ae);class fe extends ph{}class Be extends ph{}class Cr extends ph{}class xe extends wv{}class rr extends Sv{}class Ue extends Nu{}class ei extends Tv{}class Tr extends Av{}class mr extends Yr{}class Er extends I{}class Bi extends _{}class ui extends C{}class Cn extends R{}class on extends q{}const ji=Ri([{name:"a_pos",components:2,type:"Int16"}],4),{members:La}=ji;class vi{constructor(f=[]){this.segments=f}prepareSegment(f,m,b,A){let P=this.segments[this.segments.length-1];return f>vi.MAX_VERTEX_ARRAY_LENGTH&&lt(`Max vertices per segment is ${vi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${f}`),(!P||P.vertexLength+f>vi.MAX_VERTEX_ARRAY_LENGTH||P.sortKey!==A)&&(P={vertexOffset:m.length,primitiveOffset:b.length,vertexLength:0,primitiveLength:0},A!==void 0&&(P.sortKey=A),this.segments.push(P)),P}get(){return this.segments}destroy(){for(const f of this.segments)for(const m in f.vaos)f.vaos[m].destroy()}static simpleSegment(f,m,b,A){return new vi([{vertexOffset:f,primitiveOffset:m,vertexLength:b,primitiveLength:A,vaos:{},sortKey:0}])}}function Ls(g,f){return 256*(g=O(Math.floor(g),0,255))+O(Math.floor(f),0,255)}vi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,De("SegmentVector",vi);const ks=Ri([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Zo={exports:{}},Bl={exports:{}};Bl.exports=function(g,f){var m,b,A,P,D,k,z,$;for(b=g.length-(m=3&g.length),A=f,D=3432918353,k=461845907,$=0;$<b;)z=255&g.charCodeAt($)|(255&g.charCodeAt(++$))<<8|(255&g.charCodeAt(++$))<<16|(255&g.charCodeAt(++$))<<24,++$,A=27492+(65535&(P=5*(65535&(A=(A^=z=(65535&(z=(z=(65535&z)*D+(((z>>>16)*D&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(P>>>16)&65535)<<16);switch(z=0,m){case 3:z^=(255&g.charCodeAt($+2))<<16;case 2:z^=(255&g.charCodeAt($+1))<<8;case 1:A^=z=(65535&(z=(z=(65535&(z^=255&g.charCodeAt($)))*D+(((z>>>16)*D&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295}return A^=g.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0};var Fu=Bl.exports,On={exports:{}};On.exports=function(g,f){for(var m,b=g.length,A=f^b,P=0;b>=4;)m=1540483477*(65535&(m=255&g.charCodeAt(P)|(255&g.charCodeAt(++P))<<8|(255&g.charCodeAt(++P))<<16|(255&g.charCodeAt(++P))<<24))+((1540483477*(m>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),b-=4,++P;switch(b){case 3:A^=(255&g.charCodeAt(P+2))<<16;case 2:A^=(255&g.charCodeAt(P+1))<<8;case 1:A=1540483477*(65535&(A^=255&g.charCodeAt(P)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0};var En=Fu,Gn=On.exports;Zo.exports=En,Zo.exports.murmur3=En,Zo.exports.murmur2=Gn;var zl=u(Zo.exports);class zi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(f,m,b,A){this.ids.push(ln(f)),this.positions.push(m,b,A)}getPositions(f){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const m=ln(f);let b=0,A=this.ids.length-1;for(;b<A;){const D=b+A>>1;this.ids[D]>=m?A=D:b=D+1}const P=[];for(;this.ids[b]===m;)P.push({index:this.positions[3*b],start:this.positions[3*b+1],end:this.positions[3*b+2]}),b++;return P}static serialize(f,m){const b=new Float64Array(f.ids),A=new Uint32Array(f.positions);return ua(b,A,0,b.length-1),m&&m.push(b.buffer,A.buffer),{ids:b,positions:A}}static deserialize(f){const m=new zi;return m.ids=f.ids,m.positions=f.positions,m.indexed=!0,m}}function ln(g){const f=+g;return!isNaN(f)&&f<=Number.MAX_SAFE_INTEGER?f:zl(String(g))}function ua(g,f,m,b){for(;m<b;){const A=g[m+b>>1];let P=m-1,D=b+1;for(;;){do P++;while(g[P]<A);do D--;while(g[D]>A);if(P>=D)break;Vi(g,P,D),Vi(f,3*P,3*D),Vi(f,3*P+1,3*D+1),Vi(f,3*P+2,3*D+2)}D-m<b-D?(ua(g,f,m,D),m=D+1):(ua(g,f,D+1,b),b=D)}}function Vi(g,f,m){const b=g[f];g[f]=g[m],g[m]=b}De("FeaturePositionMap",zi);class Vl{constructor(f,m){this.gl=f.gl,this.location=m}}class Dd extends Vl{constructor(f,m){super(f,m),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class T0 extends Vl{constructor(f,m){super(f,m),this.current=[0,0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3]))}}class A0 extends Vl{constructor(f,m){super(f,m),this.current=Ar.transparent}set(f){f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a))}}const gT=new Float32Array(16);function Cv(g){return[Ls(255*g.r,255*g.g),Ls(255*g.b,255*g.a)]}class Os{constructor(f,m,b){this.value=f,this.uniformNames=m.map(A=>`u_${A}`),this.type=b}setUniform(f,m,b){f.set(b.constantOr(this.value))}getBinding(f,m,b){return this.type==="color"?new A0(f,m):new Dd(f,m)}}class Ul{constructor(f,m){this.uniformNames=m.map(b=>`u_${b}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(f,m){this.pixelRatioFrom=m.pixelRatio,this.pixelRatioTo=f.pixelRatio,this.patternFrom=m.tlbr,this.patternTo=f.tlbr}setUniform(f,m,b,A){const P=A==="u_pattern_to"?this.patternTo:A==="u_pattern_from"?this.patternFrom:A==="u_pixel_ratio_to"?this.pixelRatioTo:A==="u_pixel_ratio_from"?this.pixelRatioFrom:null;P&&f.set(P)}getBinding(f,m,b){return b.substr(0,9)==="u_pattern"?new T0(f,m):new Dd(f,m)}}class Ns{constructor(f,m,b,A){this.expression=f,this.type=b,this.maxValue=0,this.paintVertexAttributes=m.map(P=>({name:`a_${P}`,type:"Float32",components:b==="color"?2:1,offset:0})),this.paintVertexArray=new A}populatePaintArray(f,m,b,A,P){const D=this.paintVertexArray.length,k=this.expression.evaluate(new gi(0),m,{},A,[],P);this.paintVertexArray.resize(f),this._setPaintValue(D,f,k)}updatePaintArray(f,m,b,A){const P=this.expression.evaluate({zoom:0},b,A);this._setPaintValue(f,m,P)}_setPaintValue(f,m,b){if(this.type==="color"){const A=Cv(b);for(let P=f;P<m;P++)this.paintVertexArray.emplace(P,A[0],A[1])}else{for(let A=f;A<m;A++)this.paintVertexArray.emplace(A,b);this.maxValue=Math.max(this.maxValue,Math.abs(b))}}upload(f){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=f.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ns{constructor(f,m,b,A,P,D){this.expression=f,this.uniformNames=m.map(k=>`u_${k}_t`),this.type=b,this.useIntegerZoom=A,this.zoom=P,this.maxValue=0,this.paintVertexAttributes=m.map(k=>({name:`a_${k}`,type:"Float32",components:b==="color"?4:2,offset:0})),this.paintVertexArray=new D}populatePaintArray(f,m,b,A,P){const D=this.expression.evaluate(new gi(this.zoom),m,{},A,[],P),k=this.expression.evaluate(new gi(this.zoom+1),m,{},A,[],P),z=this.paintVertexArray.length;this.paintVertexArray.resize(f),this._setPaintValue(z,f,D,k)}updatePaintArray(f,m,b,A){const P=this.expression.evaluate({zoom:this.zoom},b,A),D=this.expression.evaluate({zoom:this.zoom+1},b,A);this._setPaintValue(f,m,P,D)}_setPaintValue(f,m,b,A){if(this.type==="color"){const P=Cv(b),D=Cv(A);for(let k=f;k<m;k++)this.paintVertexArray.emplace(k,P[0],P[1],D[0],D[1])}else{for(let P=f;P<m;P++)this.paintVertexArray.emplace(P,b,A);this.maxValue=Math.max(this.maxValue,Math.abs(b),Math.abs(A))}}upload(f){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=f.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(f,m){const b=this.useIntegerZoom?Math.floor(m.zoom):m.zoom,A=O(this.expression.interpolationFactor(b,this.zoom,this.zoom+1),0,1);f.set(A)}getBinding(f,m,b){return new Dd(f,m)}}class Fs{constructor(f,m,b,A,P,D){this.expression=f,this.type=m,this.useIntegerZoom=b,this.zoom=A,this.layerId=D,this.zoomInPaintVertexArray=new P,this.zoomOutPaintVertexArray=new P}populatePaintArray(f,m,b){const A=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(f),this.zoomOutPaintVertexArray.resize(f),this._setPaintValues(A,f,m.patterns&&m.patterns[this.layerId],b)}updatePaintArray(f,m,b,A,P){this._setPaintValues(f,m,b.patterns&&b.patterns[this.layerId],P)}_setPaintValues(f,m,b,A){if(!A||!b)return;const{min:P,mid:D,max:k}=b,z=A[P],$=A[D],X=A[k];if(z&&$&&X)for(let K=f;K<m;K++)this.zoomInPaintVertexArray.emplace(K,$.tl[0],$.tl[1],$.br[0],$.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],$.pixelRatio,z.pixelRatio),this.zoomOutPaintVertexArray.emplace(K,$.tl[0],$.tl[1],$.br[0],$.br[1],X.tl[0],X.tl[1],X.br[0],X.br[1],$.pixelRatio,X.pixelRatio)}upload(f){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=f.createVertexBuffer(this.zoomInPaintVertexArray,ks.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=f.createVertexBuffer(this.zoomOutPaintVertexArray,ks.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ev{constructor(f,m,b){this.binders={},this._buffers=[];const A=[];for(const P in f.paint._values){if(!b(P))continue;const D=f.paint.get(P);if(!(D instanceof Hn&&Pu(D.property.specification)))continue;const k=nq(P,f.type),z=D.value,$=D.property.specification.type,X=D.property.useIntegerZoom,K=D.property.specification["property-type"],et=K==="cross-faded"||K==="cross-faded-data-driven";if(z.kind==="constant")this.binders[P]=et?new Ul(z.value,k):new Os(z.value,k,$),A.push(`/u_${P}`);else if(z.kind==="source"||et){const at=NL(P,$,"source");this.binders[P]=et?new Fs(z,$,X,m,at,f.id):new Ns(z,k,$,at),A.push(`/a_${P}`)}else{const at=NL(P,$,"composite");this.binders[P]=new ns(z,k,$,X,m,at),A.push(`/z_${P}`)}}this.cacheKey=A.sort().join("")}getMaxValue(f){const m=this.binders[f];return m instanceof Ns||m instanceof ns?m.maxValue:0}populatePaintArrays(f,m,b,A,P){for(const D in this.binders){const k=this.binders[D];(k instanceof Ns||k instanceof ns||k instanceof Fs)&&k.populatePaintArray(f,m,b,A,P)}}setConstantPatternPositions(f,m){for(const b in this.binders){const A=this.binders[b];A instanceof Ul&&A.setConstantPatternPositions(f,m)}}updatePaintArrays(f,m,b,A,P){let D=!1;for(const k in f){const z=m.getPositions(k);for(const $ of z){const X=b.feature($.index);for(const K in this.binders){const et=this.binders[K];if((et instanceof Ns||et instanceof ns||et instanceof Fs)&&et.expression.isStateDependent===!0){const at=A.paint.get(K);et.expression=at.value,et.updatePaintArray($.start,$.end,X,f[k],P),D=!0}}}}return D}defines(){const f=[];for(const m in this.binders){const b=this.binders[m];(b instanceof Os||b instanceof Ul)&&f.push(...b.uniformNames.map(A=>`#define HAS_UNIFORM_${A}`))}return f}getBinderAttributes(){const f=[];for(const m in this.binders){const b=this.binders[m];if(b instanceof Ns||b instanceof ns)for(let A=0;A<b.paintVertexAttributes.length;A++)f.push(b.paintVertexAttributes[A].name);else if(b instanceof Fs)for(let A=0;A<ks.members.length;A++)f.push(ks.members[A].name)}return f}getBinderUniforms(){const f=[];for(const m in this.binders){const b=this.binders[m];if(b instanceof Os||b instanceof Ul||b instanceof ns)for(const A of b.uniformNames)f.push(A)}return f}getPaintVertexBuffers(){return this._buffers}getUniforms(f,m){const b=[];for(const A in this.binders){const P=this.binders[A];if(P instanceof Os||P instanceof Ul||P instanceof ns){for(const D of P.uniformNames)if(m[D]){const k=P.getBinding(f,m[D],D);b.push({name:D,property:A,binding:k})}}}return b}setUniforms(f,m,b,A){for(const{name:P,property:D,binding:k}of m)this.binders[D].setUniform(k,A,b.get(D),P)}updatePaintBuffers(f){this._buffers=[];for(const m in this.binders){const b=this.binders[m];if(f&&b instanceof Fs){const A=f.fromScale===2?b.zoomInPaintVertexBuffer:b.zoomOutPaintVertexBuffer;A&&this._buffers.push(A)}else(b instanceof Ns||b instanceof ns)&&b.paintVertexBuffer&&this._buffers.push(b.paintVertexBuffer)}}upload(f){for(const m in this.binders){const b=this.binders[m];(b instanceof Ns||b instanceof ns||b instanceof Fs)&&b.upload(f)}this.updatePaintBuffers()}destroy(){for(const f in this.binders){const m=this.binders[f];(m instanceof Ns||m instanceof ns||m instanceof Fs)&&m.destroy()}}}class _o{constructor(f,m,b=()=>!0){this.programConfigurations={};for(const A of f)this.programConfigurations[A.id]=new Ev(A,m,b);this.needsUpload=!1,this._featureMap=new zi,this._bufferOffset=0}populatePaintArrays(f,m,b,A,P,D){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(f,m,A,P,D);m.id!==void 0&&this._featureMap.add(m.id,b,this._bufferOffset,f),this._bufferOffset=f,this.needsUpload=!0}updatePaintArrays(f,m,b,A){for(const P of b)this.needsUpload=this.programConfigurations[P.id].updatePaintArrays(f,this._featureMap,m,P,A)||this.needsUpload}get(f){return this.programConfigurations[f]}upload(f){if(this.needsUpload){for(const m in this.programConfigurations)this.programConfigurations[m].upload(f);this.needsUpload=!1}}destroy(){for(const f in this.programConfigurations)this.programConfigurations[f].destroy()}}function nq(g,f){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[g]||[g.replace(`${f}-`,"").replace(/-/g,"_")]}function NL(g,f,m){const b={color:{source:Nu,composite:vt},number:{source:V,composite:Nu}},A=function(P){return{"line-pattern":{source:ei,composite:ei},"fill-pattern":{source:ei,composite:ei},"fill-extrusion-pattern":{source:ei,composite:ei}}[P]}(g);return A&&A[m]||b[f][m]}De("ConstantBinder",Os),De("CrossFadedConstantBinder",Ul),De("SourceExpressionBinder",Ns),De("CrossFadedCompositeBinder",Fs),De("CompositeExpressionBinder",ns),De("ProgramConfiguration",Ev,{omit:["_buffers"]}),De("ProgramConfigurationSet",_o);const Ji=8192,vT=Math.pow(2,14)-1,FL=-vT-1;function vh(g){const f=Ji/g.extent,m=g.loadGeometry();for(let b=0;b<m.length;b++){const A=m[b];for(let P=0;P<A.length;P++){const D=A[P],k=Math.round(D.x*f),z=Math.round(D.y*f);D.x=O(k,FL,vT),D.y=O(z,FL,vT),(k<D.x||k>D.x+1||z<D.y||z>D.y+1)&&lt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return m}function mh(g,f){return{type:g.type,id:g.id,properties:g.properties,geometry:f?vh(g):[]}}function C0(g,f,m,b,A){g.emplaceBack(2*f+(b+1)/2,2*m+(A+1)/2)}class mT{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(m=>m.id),this.index=f.index,this.hasPattern=!1,this.layoutVertexArray=new Be,this.indexArray=new Cn,this.segments=new vi,this.programConfigurations=new _o(f.layers,f.zoom),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(f,m,b){const A=this.layers[0],P=[];let D=null,k=!1;A.type==="circle"&&(D=A.layout.get("circle-sort-key"),k=!D.isConstant());for(const{feature:z,id:$,index:X,sourceLayerIndex:K}of f){const et=this.layers[0]._featureFilter.needGeometry,at=mh(z,et);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),at,b))continue;const ot=k?D.evaluate(at,{},b):void 0,pt={id:$,properties:z.properties,type:z.type,sourceLayerIndex:K,index:X,geometry:et?at.geometry:vh(z),patterns:{},sortKey:ot};P.push(pt)}k&&P.sort((z,$)=>z.sortKey-$.sortKey);for(const z of P){const{geometry:$,index:X,sourceLayerIndex:K}=z,et=f[X].feature;this.addFeature(z,$,X,b),m.featureIndex.insert(et,$,X,K,this.index)}}update(f,m,b){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,m,this.stateDependentLayers,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,La),this.indexBuffer=f.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(f,m,b,A){for(const P of m)for(const D of P){const k=D.x,z=D.y;if(k<0||k>=Ji||z<0||z>=Ji)continue;const $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,f.sortKey),X=$.vertexLength;C0(this.layoutVertexArray,k,z,-1,-1),C0(this.layoutVertexArray,k,z,1,-1),C0(this.layoutVertexArray,k,z,1,1),C0(this.layoutVertexArray,k,z,-1,1),this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+3,X+2),$.vertexLength+=4,$.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,b,{},A)}}function BL(g,f){for(let m=0;m<g.length;m++)if(Ld(f,g[m]))return!0;for(let m=0;m<f.length;m++)if(Ld(g,f[m]))return!0;return!!yT(g,f)}function aq(g,f,m){return!!Ld(g,f)||!!_T(f,g,m)}function zL(g,f){if(g.length===1)return UL(f,g[0]);for(let m=0;m<f.length;m++){const b=f[m];for(let A=0;A<b.length;A++)if(Ld(g,b[A]))return!0}for(let m=0;m<g.length;m++)if(UL(f,g[m]))return!0;for(let m=0;m<f.length;m++)if(yT(g,f[m]))return!0;return!1}function sq(g,f,m){if(g.length>1){if(yT(g,f))return!0;for(let b=0;b<f.length;b++)if(_T(f[b],g,m))return!0}for(let b=0;b<g.length;b++)if(_T(g[b],f,m))return!0;return!1}function yT(g,f){if(g.length===0||f.length===0)return!1;for(let m=0;m<g.length-1;m++){const b=g[m],A=g[m+1];for(let P=0;P<f.length-1;P++)if(oq(b,A,f[P],f[P+1]))return!0}return!1}function oq(g,f,m,b){return ht(g,m,b)!==ht(f,m,b)&&ht(g,f,m)!==ht(g,f,b)}function _T(g,f,m){const b=m*m;if(f.length===1)return g.distSqr(f[0])<b;for(let A=1;A<f.length;A++)if(VL(g,f[A-1],f[A])<b)return!0;return!1}function VL(g,f,m){const b=f.distSqr(m);if(b===0)return g.distSqr(f);const A=((g.x-f.x)*(m.x-f.x)+(g.y-f.y)*(m.y-f.y))/b;return g.distSqr(A<0?f:A>1?m:m.sub(f)._mult(A)._add(f))}function UL(g,f){let m,b,A,P=!1;for(let D=0;D<g.length;D++){m=g[D];for(let k=0,z=m.length-1;k<m.length;z=k++)b=m[k],A=m[z],b.y>f.y!=A.y>f.y&&f.x<(A.x-b.x)*(f.y-b.y)/(A.y-b.y)+b.x&&(P=!P)}return P}function Ld(g,f){let m=!1;for(let b=0,A=g.length-1;b<g.length;A=b++){const P=g[b],D=g[A];P.y>f.y!=D.y>f.y&&f.x<(D.x-P.x)*(f.y-P.y)/(D.y-P.y)+P.x&&(m=!m)}return m}function lq(g,f,m){const b=m[0],A=m[2];if(g.x<b.x&&f.x<b.x||g.x>A.x&&f.x>A.x||g.y<b.y&&f.y<b.y||g.y>A.y&&f.y>A.y)return!1;const P=ht(g,f,m[0]);return P!==ht(g,f,m[1])||P!==ht(g,f,m[2])||P!==ht(g,f,m[3])}function Iv(g,f,m){const b=f.paint.get(g).value;return b.kind==="constant"?b.value:m.programConfigurations.get(f.id).getMaxValue(g)}function E0(g){return Math.sqrt(g[0]*g[0]+g[1]*g[1])}function I0(g,f,m,b,A){if(!f[0]&&!f[1])return g;const P=p.convert(f)._mult(A);m==="viewport"&&P._rotate(-b);const D=[];for(let k=0;k<g.length;k++)D.push(g[k].sub(P));return D}let $L,WL;De("CircleBucket",mT,{omit:["layers"]});var uq={get paint(){return WL=WL||new Gi({"circle-radius":new er(qt.paint_circle["circle-radius"]),"circle-color":new er(qt.paint_circle["circle-color"]),"circle-blur":new er(qt.paint_circle["circle-blur"]),"circle-opacity":new er(qt.paint_circle["circle-opacity"]),"circle-translate":new He(qt.paint_circle["circle-translate"]),"circle-translate-anchor":new He(qt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new He(qt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new He(qt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new er(qt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new er(qt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new er(qt.paint_circle["circle-stroke-opacity"])})},get layout(){return $L=$L||new Gi({"circle-sort-key":new er(qt.layout_circle["circle-sort-key"])})}},ca=1e-6,kd=typeof Float32Array<"u"?Float32Array:Array;function xT(g){return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function HL(g,f,m){var b=f[0],A=f[1],P=f[2],D=f[3],k=f[4],z=f[5],$=f[6],X=f[7],K=f[8],et=f[9],at=f[10],ot=f[11],pt=f[12],bt=f[13],Ct=f[14],kt=f[15],It=m[0],Ft=m[1],Ht=m[2],re=m[3];return g[0]=It*b+Ft*k+Ht*K+re*pt,g[1]=It*A+Ft*z+Ht*et+re*bt,g[2]=It*P+Ft*$+Ht*at+re*Ct,g[3]=It*D+Ft*X+Ht*ot+re*kt,g[4]=(It=m[4])*b+(Ft=m[5])*k+(Ht=m[6])*K+(re=m[7])*pt,g[5]=It*A+Ft*z+Ht*et+re*bt,g[6]=It*P+Ft*$+Ht*at+re*Ct,g[7]=It*D+Ft*X+Ht*ot+re*kt,g[8]=(It=m[8])*b+(Ft=m[9])*k+(Ht=m[10])*K+(re=m[11])*pt,g[9]=It*A+Ft*z+Ht*et+re*bt,g[10]=It*P+Ft*$+Ht*at+re*Ct,g[11]=It*D+Ft*X+Ht*ot+re*kt,g[12]=(It=m[12])*b+(Ft=m[13])*k+(Ht=m[14])*K+(re=m[15])*pt,g[13]=It*A+Ft*z+Ht*et+re*bt,g[14]=It*P+Ft*$+Ht*at+re*Ct,g[15]=It*D+Ft*X+Ht*ot+re*kt,g}Math.hypot||(Math.hypot=function(){for(var g=0,f=arguments.length;f--;)g+=arguments[f]*arguments[f];return Math.sqrt(g)});var Mv,cq=HL;function M0(g,f,m){var b=f[0],A=f[1],P=f[2],D=f[3];return g[0]=m[0]*b+m[4]*A+m[8]*P+m[12]*D,g[1]=m[1]*b+m[5]*A+m[9]*P+m[13]*D,g[2]=m[2]*b+m[6]*A+m[10]*P+m[14]*D,g[3]=m[3]*b+m[7]*A+m[11]*P+m[15]*D,g}Mv=new kd(4),kd!=Float32Array&&(Mv[0]=0,Mv[1]=0,Mv[2]=0,Mv[3]=0);class hq extends is{constructor(f){super(f,uq)}createBucket(f){return new mT(f)}queryRadius(f){const m=f;return Iv("circle-radius",this,m)+Iv("circle-stroke-width",this,m)+E0(this.paint.get("circle-translate"))}queryIntersectsFeature(f,m,b,A,P,D,k,z){const $=I0(f,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),D.angle,k),X=this.paint.get("circle-radius").evaluate(m,b)+this.paint.get("circle-stroke-width").evaluate(m,b),K=this.paint.get("circle-pitch-alignment")==="map",et=K?$:function(ot,pt){return ot.map(bt=>GL(bt,pt))}($,z),at=K?X*k:X;for(const ot of A)for(const pt of ot){const bt=K?pt:GL(pt,z);let Ct=at;const kt=M0([],[pt.x,pt.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ct*=kt[3]/D.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ct*=D.cameraToCenterDistance/kt[3]),aq(et,bt,Ct))return!0}return!1}}function GL(g,f){const m=M0([],[g.x,g.y,0,1],f);return new p(m[0]/m[3],m[1]/m[3])}class jL extends mT{}let XL;De("HeatmapBucket",jL,{omit:["layers"]});var fq={get paint(){return XL=XL||new Gi({"heatmap-radius":new er(qt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new er(qt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new He(qt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xv(qt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new He(qt.paint_heatmap["heatmap-opacity"])})}};function bT(g,{width:f,height:m},b,A){if(A){if(A instanceof Uint8ClampedArray)A=new Uint8Array(A.buffer);else if(A.length!==f*m*b)throw new RangeError(`mismatched image size. expected: ${A.length} but got: ${f*m*b}`)}else A=new Uint8Array(f*m*b);return g.width=f,g.height=m,g.data=A,g}function ZL(g,{width:f,height:m},b){if(f===g.width&&m===g.height)return;const A=bT({},{width:f,height:m},b);wT(g,A,{x:0,y:0},{x:0,y:0},{width:Math.min(g.width,f),height:Math.min(g.height,m)},b),g.width=f,g.height=m,g.data=A.data}function wT(g,f,m,b,A,P){if(A.width===0||A.height===0)return f;if(A.width>g.width||A.height>g.height||m.x>g.width-A.width||m.y>g.height-A.height)throw new RangeError("out of range source coordinates for image copy");if(A.width>f.width||A.height>f.height||b.x>f.width-A.width||b.y>f.height-A.height)throw new RangeError("out of range destination coordinates for image copy");const D=g.data,k=f.data;if(D===k)throw new Error("srcData equals dstData, so image is already copied");for(let z=0;z<A.height;z++){const $=((m.y+z)*g.width+m.x)*P,X=((b.y+z)*f.width+b.x)*P;for(let K=0;K<A.width*P;K++)k[X+K]=D[$+K]}return f}class Pv{constructor(f,m){bT(this,f,1,m)}resize(f){ZL(this,f,1)}clone(){return new Pv({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(f,m,b,A,P){wT(f,m,b,A,P,1)}}class ys{constructor(f,m){bT(this,f,4,m)}resize(f){ZL(this,f,4)}replace(f,m){m?this.data.set(f):this.data=f instanceof Uint8ClampedArray?new Uint8Array(f.buffer):f}clone(){return new ys({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(f,m,b,A,P){wT(f,m,b,A,P,4)}}function qL(g){const f={},m=g.resolution||256,b=g.clips?g.clips.length:1,A=g.image||new ys({width:m,height:b});if(Math.log(m)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${m}`);const P=(D,k,z)=>{f[g.evaluationKey]=z;const $=g.expression.evaluate(f);A.data[D+k+0]=Math.floor(255*$.r/$.a),A.data[D+k+1]=Math.floor(255*$.g/$.a),A.data[D+k+2]=Math.floor(255*$.b/$.a),A.data[D+k+3]=Math.floor(255*$.a)};if(g.clips)for(let D=0,k=0;D<b;++D,k+=4*m)for(let z=0,$=0;z<m;z++,$+=4){const X=z/(m-1),{start:K,end:et}=g.clips[D];P(k,$,K*(1-X)+et*X)}else for(let D=0,k=0;D<m;D++,k+=4)P(0,k,D/(m-1));return A}De("AlphaImage",Pv),De("RGBAImage",ys);class dq extends is{createBucket(f){return new jL(f)}constructor(f){super(f,fq),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(f){f==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qL({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let YL;var pq={get paint(){return YL=YL||new Gi({"hillshade-illumination-direction":new He(qt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new He(qt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new He(qt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new He(qt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new He(qt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new He(qt.paint_hillshade["hillshade-accent-color"])})}};class gq extends is{constructor(f){super(f,pq)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const vq=Ri([{name:"a_pos",components:2,type:"Int16"}],4),{members:mq}=vq;var ST={exports:{}};function P0(g,f,m){m=m||2;var b,A,P,D,k,z,$,X=f&&f.length,K=X?f[0]*m:g.length,et=KL(g,0,K,m,!0),at=[];if(!et||et.next===et.prev)return at;if(X&&(et=function(pt,bt,Ct,kt){var It,Ft,Ht,re=[];for(It=0,Ft=bt.length;It<Ft;It++)(Ht=KL(pt,bt[It]*kt,It<Ft-1?bt[It+1]*kt:pt.length,kt,!1))===Ht.next&&(Ht.steiner=!0),re.push(Aq(Ht));for(re.sort(wq),It=0;It<re.length;It++)Ct=Sq(re[It],Ct);return Ct}(g,f,et,m)),g.length>80*m){b=P=g[0],A=D=g[1];for(var ot=m;ot<K;ot+=m)(k=g[ot])<b&&(b=k),(z=g[ot+1])<A&&(A=z),k>P&&(P=k),z>D&&(D=z);$=($=Math.max(P-b,D-A))!==0?32767/$:0}return Rv(et,at,m,b,A,$,0),at}function KL(g,f,m,b,A){var P,D;if(A===CT(g,f,m,b)>0)for(P=f;P<m;P+=b)D=tk(P,g[P],g[P+1],D);else for(P=m-b;P>=f;P-=b)D=tk(P,g[P],g[P+1],D);return D&&R0(D,D.next)&&(Lv(D),D=D.next),D}function yh(g,f){if(!g)return g;f||(f=g);var m,b=g;do if(m=!1,b.steiner||!R0(b,b.next)&&Xi(b.prev,b,b.next)!==0)b=b.next;else{if(Lv(b),(b=f=b.prev)===b.next)break;m=!0}while(m||b!==f);return f}function Rv(g,f,m,b,A,P,D){if(g){!D&&P&&function(X,K,et,at){var ot=X;do ot.z===0&&(ot.z=TT(ot.x,ot.y,K,et,at)),ot.prevZ=ot.prev,ot.nextZ=ot.next,ot=ot.next;while(ot!==X);ot.prevZ.nextZ=null,ot.prevZ=null,function(pt){var bt,Ct,kt,It,Ft,Ht,re,Pe,ze=1;do{for(Ct=pt,pt=null,Ft=null,Ht=0;Ct;){for(Ht++,kt=Ct,re=0,bt=0;bt<ze&&(re++,kt=kt.nextZ);bt++);for(Pe=ze;re>0||Pe>0&&kt;)re!==0&&(Pe===0||!kt||Ct.z<=kt.z)?(It=Ct,Ct=Ct.nextZ,re--):(It=kt,kt=kt.nextZ,Pe--),Ft?Ft.nextZ=It:pt=It,It.prevZ=Ft,Ft=It;Ct=kt}Ft.nextZ=null,ze*=2}while(Ht>1)}(ot)}(g,b,A,P);for(var k,z,$=g;g.prev!==g.next;)if(k=g.prev,z=g.next,P?_q(g,b,A,P):yq(g))f.push(k.i/m|0),f.push(g.i/m|0),f.push(z.i/m|0),Lv(g),g=z.next,$=z.next;else if((g=z)===$){D?D===1?Rv(g=xq(yh(g),f,m),f,m,b,A,P,2):D===2&&bq(g,f,m,b,A,P):Rv(yh(g),f,m,b,A,P,1);break}}}function yq(g){var f=g.prev,m=g,b=g.next;if(Xi(f,m,b)>=0)return!1;for(var A=f.x,P=m.x,D=b.x,k=f.y,z=m.y,$=b.y,X=A<P?A<D?A:D:P<D?P:D,K=k<z?k<$?k:$:z<$?z:$,et=A>P?A>D?A:D:P>D?P:D,at=k>z?k>$?k:$:z>$?z:$,ot=b.next;ot!==f;){if(ot.x>=X&&ot.x<=et&&ot.y>=K&&ot.y<=at&&Od(A,k,P,z,D,$,ot.x,ot.y)&&Xi(ot.prev,ot,ot.next)>=0)return!1;ot=ot.next}return!0}function _q(g,f,m,b){var A=g.prev,P=g,D=g.next;if(Xi(A,P,D)>=0)return!1;for(var k=A.x,z=P.x,$=D.x,X=A.y,K=P.y,et=D.y,at=k<z?k<$?k:$:z<$?z:$,ot=X<K?X<et?X:et:K<et?K:et,pt=k>z?k>$?k:$:z>$?z:$,bt=X>K?X>et?X:et:K>et?K:et,Ct=TT(at,ot,f,m,b),kt=TT(pt,bt,f,m,b),It=g.prevZ,Ft=g.nextZ;It&&It.z>=Ct&&Ft&&Ft.z<=kt;){if(It.x>=at&&It.x<=pt&&It.y>=ot&&It.y<=bt&&It!==A&&It!==D&&Od(k,X,z,K,$,et,It.x,It.y)&&Xi(It.prev,It,It.next)>=0||(It=It.prevZ,Ft.x>=at&&Ft.x<=pt&&Ft.y>=ot&&Ft.y<=bt&&Ft!==A&&Ft!==D&&Od(k,X,z,K,$,et,Ft.x,Ft.y)&&Xi(Ft.prev,Ft,Ft.next)>=0))return!1;Ft=Ft.nextZ}for(;It&&It.z>=Ct;){if(It.x>=at&&It.x<=pt&&It.y>=ot&&It.y<=bt&&It!==A&&It!==D&&Od(k,X,z,K,$,et,It.x,It.y)&&Xi(It.prev,It,It.next)>=0)return!1;It=It.prevZ}for(;Ft&&Ft.z<=kt;){if(Ft.x>=at&&Ft.x<=pt&&Ft.y>=ot&&Ft.y<=bt&&Ft!==A&&Ft!==D&&Od(k,X,z,K,$,et,Ft.x,Ft.y)&&Xi(Ft.prev,Ft,Ft.next)>=0)return!1;Ft=Ft.nextZ}return!0}function xq(g,f,m){var b=g;do{var A=b.prev,P=b.next.next;!R0(A,P)&&JL(A,b,b.next,P)&&Dv(A,P)&&Dv(P,A)&&(f.push(A.i/m|0),f.push(b.i/m|0),f.push(P.i/m|0),Lv(b),Lv(b.next),b=g=P),b=b.next}while(b!==g);return yh(b)}function bq(g,f,m,b,A,P){var D=g;do{for(var k=D.next.next;k!==D.prev;){if(D.i!==k.i&&Cq(D,k)){var z=QL(D,k);return D=yh(D,D.next),z=yh(z,z.next),Rv(D,f,m,b,A,P,0),void Rv(z,f,m,b,A,P,0)}k=k.next}D=D.next}while(D!==g)}function wq(g,f){return g.x-f.x}function Sq(g,f){var m=function(A,P){var D,k=P,z=A.x,$=A.y,X=-1/0;do{if($<=k.y&&$>=k.next.y&&k.next.y!==k.y){var K=k.x+($-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(K<=z&&K>X&&(X=K,D=k.x<k.next.x?k:k.next,K===z))return D}k=k.next}while(k!==P);if(!D)return null;var et,at=D,ot=D.x,pt=D.y,bt=1/0;k=D;do z>=k.x&&k.x>=ot&&z!==k.x&&Od($<pt?z:X,$,ot,pt,$<pt?X:z,$,k.x,k.y)&&(et=Math.abs($-k.y)/(z-k.x),Dv(k,A)&&(et<bt||et===bt&&(k.x>D.x||k.x===D.x&&Tq(D,k)))&&(D=k,bt=et)),k=k.next;while(k!==at);return D}(g,f);if(!m)return f;var b=QL(m,g);return yh(b,b.next),yh(m,m.next)}function Tq(g,f){return Xi(g.prev,g,f.prev)<0&&Xi(f.next,g,g.next)<0}function TT(g,f,m,b,A){return(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g=(g-m)*A|0)|g<<8))|g<<4))|g<<2))|g<<1))|(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-b)*A|0)|f<<8))|f<<4))|f<<2))|f<<1))<<1}function Aq(g){var f=g,m=g;do(f.x<m.x||f.x===m.x&&f.y<m.y)&&(m=f),f=f.next;while(f!==g);return m}function Od(g,f,m,b,A,P,D,k){return(A-D)*(f-k)>=(g-D)*(P-k)&&(g-D)*(b-k)>=(m-D)*(f-k)&&(m-D)*(P-k)>=(A-D)*(b-k)}function Cq(g,f){return g.next.i!==f.i&&g.prev.i!==f.i&&!function(m,b){var A=m;do{if(A.i!==m.i&&A.next.i!==m.i&&A.i!==b.i&&A.next.i!==b.i&&JL(A,A.next,m,b))return!0;A=A.next}while(A!==m);return!1}(g,f)&&(Dv(g,f)&&Dv(f,g)&&function(m,b){var A=m,P=!1,D=(m.x+b.x)/2,k=(m.y+b.y)/2;do A.y>k!=A.next.y>k&&A.next.y!==A.y&&D<(A.next.x-A.x)*(k-A.y)/(A.next.y-A.y)+A.x&&(P=!P),A=A.next;while(A!==m);return P}(g,f)&&(Xi(g.prev,g,f.prev)||Xi(g,f.prev,f))||R0(g,f)&&Xi(g.prev,g,g.next)>0&&Xi(f.prev,f,f.next)>0)}function Xi(g,f,m){return(f.y-g.y)*(m.x-f.x)-(f.x-g.x)*(m.y-f.y)}function R0(g,f){return g.x===f.x&&g.y===f.y}function JL(g,f,m,b){var A=L0(Xi(g,f,m)),P=L0(Xi(g,f,b)),D=L0(Xi(m,b,g)),k=L0(Xi(m,b,f));return A!==P&&D!==k||!(A!==0||!D0(g,m,f))||!(P!==0||!D0(g,b,f))||!(D!==0||!D0(m,g,b))||!(k!==0||!D0(m,f,b))}function D0(g,f,m){return f.x<=Math.max(g.x,m.x)&&f.x>=Math.min(g.x,m.x)&&f.y<=Math.max(g.y,m.y)&&f.y>=Math.min(g.y,m.y)}function L0(g){return g>0?1:g<0?-1:0}function Dv(g,f){return Xi(g.prev,g,g.next)<0?Xi(g,f,g.next)>=0&&Xi(g,g.prev,f)>=0:Xi(g,f,g.prev)<0||Xi(g,g.next,f)<0}function QL(g,f){var m=new AT(g.i,g.x,g.y),b=new AT(f.i,f.x,f.y),A=g.next,P=f.prev;return g.next=f,f.prev=g,m.next=A,A.prev=m,b.next=m,m.prev=b,P.next=b,b.prev=P,b}function tk(g,f,m,b){var A=new AT(g,f,m);return b?(A.next=b.next,A.prev=b,b.next.prev=A,b.next=A):(A.prev=A,A.next=A),A}function Lv(g){g.next.prev=g.prev,g.prev.next=g.next,g.prevZ&&(g.prevZ.nextZ=g.nextZ),g.nextZ&&(g.nextZ.prevZ=g.prevZ)}function AT(g,f,m){this.i=g,this.x=f,this.y=m,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function CT(g,f,m,b){for(var A=0,P=f,D=m-b;P<m;P+=b)A+=(g[D]-g[P])*(g[P+1]+g[D+1]),D=P;return A}ST.exports=P0,ST.exports.default=P0,P0.deviation=function(g,f,m,b){var A=f&&f.length,P=Math.abs(CT(g,0,A?f[0]*m:g.length,m));if(A)for(var D=0,k=f.length;D<k;D++)P-=Math.abs(CT(g,f[D]*m,D<k-1?f[D+1]*m:g.length,m));var z=0;for(D=0;D<b.length;D+=3){var $=b[D]*m,X=b[D+1]*m,K=b[D+2]*m;z+=Math.abs((g[$]-g[K])*(g[X+1]-g[$+1])-(g[$]-g[X])*(g[K+1]-g[$+1]))}return P===0&&z===0?0:Math.abs((z-P)/P)},P0.flatten=function(g){for(var f=g[0][0].length,m={vertices:[],holes:[],dimensions:f},b=0,A=0;A<g.length;A++){for(var P=0;P<g[A].length;P++)for(var D=0;D<f;D++)m.vertices.push(g[A][P][D]);A>0&&m.holes.push(b+=g[A-1].length)}return m};var ek=u(ST.exports);function Eq(g,f,m,b,A){rk(g,f,m||0,b||g.length-1,A||Iq)}function rk(g,f,m,b,A){for(;b>m;){if(b-m>600){var P=b-m+1,D=f-m+1,k=Math.log(P),z=.5*Math.exp(2*k/3),$=.5*Math.sqrt(k*z*(P-z)/P)*(D-P/2<0?-1:1);rk(g,f,Math.max(m,Math.floor(f-D*z/P+$)),Math.min(b,Math.floor(f+(P-D)*z/P+$)),A)}var X=g[f],K=m,et=b;for(kv(g,m,f),A(g[b],X)>0&&kv(g,m,b);K<et;){for(kv(g,K,et),K++,et--;A(g[K],X)<0;)K++;for(;A(g[et],X)>0;)et--}A(g[m],X)===0?kv(g,m,et):kv(g,++et,b),et<=f&&(m=et+1),f<=et&&(b=et-1)}}function kv(g,f,m){var b=g[f];g[f]=g[m],g[m]=b}function Iq(g,f){return g<f?-1:g>f?1:0}function ET(g,f){const m=g.length;if(m<=1)return[g];const b=[];let A,P;for(let D=0;D<m;D++){const k=Tt(g[D]);k!==0&&(g[D].area=Math.abs(k),P===void 0&&(P=k<0),P===k<0?(A&&b.push(A),A=[g[D]]):A.push(g[D]))}if(A&&b.push(A),f>1)for(let D=0;D<b.length;D++)b[D].length<=f||(Eq(b[D],f,1,b[D].length-1,Mq),b[D]=b[D].slice(0,f));return b}function Mq(g,f){return f.area-g.area}function IT(g,f,m){const b=m.patternDependencies;let A=!1;for(const P of f){const D=P.paint.get(`${g}-pattern`);D.isConstant()||(A=!0);const k=D.constantOr(null);k&&(A=!0,b[k.to]=!0,b[k.from]=!0)}return A}function MT(g,f,m,b,A){const P=A.patternDependencies;for(const D of f){const k=D.paint.get(`${g}-pattern`).value;if(k.kind!=="constant"){let z=k.evaluate({zoom:b-1},m,{},A.availableImages),$=k.evaluate({zoom:b},m,{},A.availableImages),X=k.evaluate({zoom:b+1},m,{},A.availableImages);z=z&&z.name?z.name:z,$=$&&$.name?$.name:$,X=X&&X.name?X.name:X,P[z]=!0,P[$]=!0,P[X]=!0,m.patterns[D.id]={min:z,mid:$,max:X}}}return m}class PT{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(m=>m.id),this.index=f.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Cr,this.indexArray=new Cn,this.indexArray2=new on,this.programConfigurations=new _o(f.layers,f.zoom),this.segments=new vi,this.segments2=new vi,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(f,m,b){this.hasPattern=IT("fill",this.layers,m);const A=this.layers[0].layout.get("fill-sort-key"),P=!A.isConstant(),D=[];for(const{feature:k,id:z,index:$,sourceLayerIndex:X}of f){const K=this.layers[0]._featureFilter.needGeometry,et=mh(k,K);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),et,b))continue;const at=P?A.evaluate(et,{},b,m.availableImages):void 0,ot={id:z,properties:k.properties,type:k.type,sourceLayerIndex:X,index:$,geometry:K?et.geometry:vh(k),patterns:{},sortKey:at};D.push(ot)}P&&D.sort((k,z)=>k.sortKey-z.sortKey);for(const k of D){const{geometry:z,index:$,sourceLayerIndex:X}=k;if(this.hasPattern){const K=MT("fill",this.layers,k,this.zoom,m);this.patternFeatures.push(K)}else this.addFeature(k,z,$,b,{});m.featureIndex.insert(f[$].feature,z,$,X,this.index)}}update(f,m,b){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,m,this.stateDependentLayers,b)}addFeatures(f,m,b){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,m,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,mq),this.indexBuffer=f.createIndexBuffer(this.indexArray),this.indexBuffer2=f.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(f,m,b,A,P){for(const D of ET(m,500)){let k=0;for(const at of D)k+=at.length;const z=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),$=z.vertexLength,X=[],K=[];for(const at of D){if(at.length===0)continue;at!==D[0]&&K.push(X.length/2);const ot=this.segments2.prepareSegment(at.length,this.layoutVertexArray,this.indexArray2),pt=ot.vertexLength;this.layoutVertexArray.emplaceBack(at[0].x,at[0].y),this.indexArray2.emplaceBack(pt+at.length-1,pt),X.push(at[0].x),X.push(at[0].y);for(let bt=1;bt<at.length;bt++)this.layoutVertexArray.emplaceBack(at[bt].x,at[bt].y),this.indexArray2.emplaceBack(pt+bt-1,pt+bt),X.push(at[bt].x),X.push(at[bt].y);ot.vertexLength+=at.length,ot.primitiveLength+=at.length}const et=ek(X,K);for(let at=0;at<et.length;at+=3)this.indexArray.emplaceBack($+et[at],$+et[at+1],$+et[at+2]);z.vertexLength+=k,z.primitiveLength+=et.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,b,P,A)}}let ik,nk;De("FillBucket",PT,{omit:["layers","patternFeatures"]});var Pq={get paint(){return nk=nk||new Gi({"fill-antialias":new He(qt.paint_fill["fill-antialias"]),"fill-opacity":new er(qt.paint_fill["fill-opacity"]),"fill-color":new er(qt.paint_fill["fill-color"]),"fill-outline-color":new er(qt.paint_fill["fill-outline-color"]),"fill-translate":new He(qt.paint_fill["fill-translate"]),"fill-translate-anchor":new He(qt.paint_fill["fill-translate-anchor"]),"fill-pattern":new dh(qt.paint_fill["fill-pattern"])})},get layout(){return ik=ik||new Gi({"fill-sort-key":new er(qt.layout_fill["fill-sort-key"])})}};class Rq extends is{constructor(f){super(f,Pq)}recalculate(f,m){super.recalculate(f,m);const b=this.paint._values["fill-outline-color"];b.value.kind==="constant"&&b.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(f){return new PT(f)}queryRadius(){return E0(this.paint.get("fill-translate"))}queryIntersectsFeature(f,m,b,A,P,D,k){return zL(I0(f,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),D.angle,k),A)}isTileClipped(){return!0}}const Dq=Ri([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Lq=Ri([{name:"a_centroid",components:2,type:"Int16"}],4),{members:kq}=Dq;var Bu={},Oq=c,ak=Nd;function Nd(g,f,m,b,A){this.properties={},this.extent=m,this.type=0,this._pbf=g,this._geometry=-1,this._keys=b,this._values=A,g.readFields(Nq,this,f)}function Nq(g,f,m){g==1?f.id=m.readVarint():g==2?function(b,A){for(var P=b.readVarint()+b.pos;b.pos<P;){var D=A._keys[b.readVarint()],k=A._values[b.readVarint()];A.properties[D]=k}}(m,f):g==3?f.type=m.readVarint():g==4&&(f._geometry=m.pos)}function Fq(g){for(var f,m,b=0,A=0,P=g.length,D=P-1;A<P;D=A++)b+=((m=g[D]).x-(f=g[A]).x)*(f.y+m.y);return b}Nd.types=["Unknown","Point","LineString","Polygon"],Nd.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var f,m=g.readVarint()+g.pos,b=1,A=0,P=0,D=0,k=[];g.pos<m;){if(A<=0){var z=g.readVarint();b=7&z,A=z>>3}if(A--,b===1||b===2)P+=g.readSVarint(),D+=g.readSVarint(),b===1&&(f&&k.push(f),f=[]),f.push(new Oq(P,D));else{if(b!==7)throw new Error("unknown command "+b);f&&f.push(f[0].clone())}}return f&&k.push(f),k},Nd.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var f=g.readVarint()+g.pos,m=1,b=0,A=0,P=0,D=1/0,k=-1/0,z=1/0,$=-1/0;g.pos<f;){if(b<=0){var X=g.readVarint();m=7&X,b=X>>3}if(b--,m===1||m===2)(A+=g.readSVarint())<D&&(D=A),A>k&&(k=A),(P+=g.readSVarint())<z&&(z=P),P>$&&($=P);else if(m!==7)throw new Error("unknown command "+m)}return[D,z,k,$]},Nd.prototype.toGeoJSON=function(g,f,m){var b,A,P=this.extent*Math.pow(2,m),D=this.extent*g,k=this.extent*f,z=this.loadGeometry(),$=Nd.types[this.type];function X(at){for(var ot=0;ot<at.length;ot++){var pt=at[ot];at[ot]=[360*(pt.x+D)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(pt.y+k)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(b=0;b<z.length;b++)K[b]=z[b][0];X(z=K);break;case 2:for(b=0;b<z.length;b++)X(z[b]);break;case 3:for(z=function(at){var ot=at.length;if(ot<=1)return[at];for(var pt,bt,Ct=[],kt=0;kt<ot;kt++){var It=Fq(at[kt]);It!==0&&(bt===void 0&&(bt=It<0),bt===It<0?(pt&&Ct.push(pt),pt=[at[kt]]):pt.push(at[kt]))}return pt&&Ct.push(pt),Ct}(z),b=0;b<z.length;b++)for(A=0;A<z[b].length;A++)X(z[b][A])}z.length===1?z=z[0]:$="Multi"+$;var et={type:"Feature",geometry:{type:$,coordinates:z},properties:this.properties};return"id"in this&&(et.id=this.id),et};var Bq=ak,sk=ok;function ok(g,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=g,this._keys=[],this._values=[],this._features=[],g.readFields(zq,this,f),this.length=this._features.length}function zq(g,f,m){g===15?f.version=m.readVarint():g===1?f.name=m.readString():g===5?f.extent=m.readVarint():g===2?f._features.push(m.pos):g===3?f._keys.push(m.readString()):g===4&&f._values.push(function(b){for(var A=null,P=b.readVarint()+b.pos;b.pos<P;){var D=b.readVarint()>>3;A=D===1?b.readString():D===2?b.readFloat():D===3?b.readDouble():D===4?b.readVarint64():D===5?b.readVarint():D===6?b.readSVarint():D===7?b.readBoolean():null}return A}(m))}ok.prototype.feature=function(g){if(g<0||g>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[g];var f=this._pbf.readVarint()+this._pbf.pos;return new Bq(this._pbf,f,this.extent,this._keys,this._values)};var Vq=sk;function Uq(g,f,m){if(g===3){var b=new Vq(m,m.readVarint()+m.pos);b.length&&(f[b.name]=b)}}Bu.VectorTile=function(g,f){this.layers=g.readFields(Uq,{},f)},Bu.VectorTileFeature=ak,Bu.VectorTileLayer=sk;const $q=Bu.VectorTileFeature.types,RT=Math.pow(2,13);function Ov(g,f,m,b,A,P,D,k){g.emplaceBack(f,m,2*Math.floor(b*RT)+D,A*RT*2,P*RT*2,Math.round(k))}class DT{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(m=>m.id),this.index=f.index,this.hasPattern=!1,this.layoutVertexArray=new xe,this.centroidVertexArray=new fe,this.indexArray=new Cn,this.programConfigurations=new _o(f.layers,f.zoom),this.segments=new vi,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(f,m,b){this.features=[],this.hasPattern=IT("fill-extrusion",this.layers,m);for(const{feature:A,id:P,index:D,sourceLayerIndex:k}of f){const z=this.layers[0]._featureFilter.needGeometry,$=mh(A,z);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),$,b))continue;const X={id:P,sourceLayerIndex:k,index:D,geometry:z?$.geometry:vh(A),properties:A.properties,type:A.type,patterns:{}};this.hasPattern?this.features.push(MT("fill-extrusion",this.layers,X,this.zoom,m)):this.addFeature(X,X.geometry,D,b,{}),m.featureIndex.insert(A,X.geometry,D,k,this.index,!0)}}addFeatures(f,m,b){for(const A of this.features){const{geometry:P}=A;this.addFeature(A,P,A.index,m,b)}}update(f,m,b){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,m,this.stateDependentLayers,b)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,kq),this.centroidVertexBuffer=f.createVertexBuffer(this.centroidVertexArray,Lq.members,!0),this.indexBuffer=f.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(f,m,b,A,P){const D={x:0,y:0,vertexCount:0};for(const k of ET(m,500)){let z=0;for(const ot of k)z+=ot.length;let $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ot of k){if(ot.length===0||Hq(ot))continue;let pt=0;for(let bt=0;bt<ot.length;bt++){const Ct=ot[bt];if(bt>=1){const kt=ot[bt-1];if(!Wq(Ct,kt)){$.vertexLength+4>vi.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const It=Ct.sub(kt)._perp()._unit(),Ft=kt.dist(Ct);pt+Ft>32768&&(pt=0),Ov(this.layoutVertexArray,Ct.x,Ct.y,It.x,It.y,0,0,pt),Ov(this.layoutVertexArray,Ct.x,Ct.y,It.x,It.y,0,1,pt),D.x+=2*Ct.x,D.y+=2*Ct.y,D.vertexCount+=2,pt+=Ft,Ov(this.layoutVertexArray,kt.x,kt.y,It.x,It.y,0,0,pt),Ov(this.layoutVertexArray,kt.x,kt.y,It.x,It.y,0,1,pt),D.x+=2*kt.x,D.y+=2*kt.y,D.vertexCount+=2;const Ht=$.vertexLength;this.indexArray.emplaceBack(Ht,Ht+2,Ht+1),this.indexArray.emplaceBack(Ht+1,Ht+2,Ht+3),$.vertexLength+=4,$.primitiveLength+=2}}}}if($.vertexLength+z>vi.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray)),$q[f.type]!=="Polygon")continue;const X=[],K=[],et=$.vertexLength;for(const ot of k)if(ot.length!==0){ot!==k[0]&&K.push(X.length/2);for(let pt=0;pt<ot.length;pt++){const bt=ot[pt];Ov(this.layoutVertexArray,bt.x,bt.y,0,0,1,1,0),D.x+=bt.x,D.y+=bt.y,D.vertexCount+=1,X.push(bt.x),X.push(bt.y)}}const at=ek(X,K);for(let ot=0;ot<at.length;ot+=3)this.indexArray.emplaceBack(et+at[ot],et+at[ot+2],et+at[ot+1]);$.primitiveLength+=at.length/3,$.vertexLength+=z}for(let k=0;k<D.vertexCount;k++)this.centroidVertexArray.emplaceBack(Math.floor(D.x/D.vertexCount),Math.floor(D.y/D.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,b,P,A)}}function Wq(g,f){return g.x===f.x&&(g.x<0||g.x>Ji)||g.y===f.y&&(g.y<0||g.y>Ji)}function Hq(g){return g.every(f=>f.x<0)||g.every(f=>f.x>Ji)||g.every(f=>f.y<0)||g.every(f=>f.y>Ji)}let lk;De("FillExtrusionBucket",DT,{omit:["layers","features"]});var Gq={get paint(){return lk=lk||new Gi({"fill-extrusion-opacity":new He(qt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new er(qt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new He(qt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new He(qt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new dh(qt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new er(qt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new er(qt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new He(qt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class jq extends is{constructor(f){super(f,Gq)}createBucket(f){return new DT(f)}queryRadius(){return E0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(f,m,b,A,P,D,k,z){const $=I0(f,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),D.angle,k),X=this.paint.get("fill-extrusion-height").evaluate(m,b),K=this.paint.get("fill-extrusion-base").evaluate(m,b),et=function(ot,pt,bt,Ct){const kt=[];for(const It of ot){const Ft=[It.x,It.y,0,1];M0(Ft,Ft,pt),kt.push(new p(Ft[0]/Ft[3],Ft[1]/Ft[3]))}return kt}($,z),at=function(ot,pt,bt,Ct){const kt=[],It=[],Ft=Ct[8]*pt,Ht=Ct[9]*pt,re=Ct[10]*pt,Pe=Ct[11]*pt,ze=Ct[8]*bt,Te=Ct[9]*bt,be=Ct[10]*bt,pe=Ct[11]*bt;for(const Le of ot){const me=[],le=[];for(const Ye of Le){const $e=Ye.x,wr=Ye.y,mi=Ct[0]*$e+Ct[4]*wr+Ct[12],Ai=Ct[1]*$e+Ct[5]*wr+Ct[13],cn=Ct[2]*$e+Ct[6]*wr+Ct[14],as=Ct[3]*$e+Ct[7]*wr+Ct[15],ha=cn+re,Qi=as+Pe,In=mi+ze,Fn=Ai+Te,fa=cn+be,da=as+pe,hn=new p((mi+Ft)/Qi,(Ai+Ht)/Qi);hn.z=ha/Qi,me.push(hn);const fn=new p(In/da,Fn/da);fn.z=fa/da,le.push(fn)}kt.push(me),It.push(le)}return[kt,It]}(A,K,X,z);return function(ot,pt,bt){let Ct=1/0;zL(bt,pt)&&(Ct=uk(bt,pt[0]));for(let kt=0;kt<pt.length;kt++){const It=pt[kt],Ft=ot[kt];for(let Ht=0;Ht<It.length-1;Ht++){const re=It[Ht],Pe=[re,It[Ht+1],Ft[Ht+1],Ft[Ht],re];BL(bt,Pe)&&(Ct=Math.min(Ct,uk(bt,Pe)))}}return Ct!==1/0&&Ct}(at[0],at[1],et)}}function Nv(g,f){return g.x*f.x+g.y*f.y}function uk(g,f){if(g.length===1){let m=0;const b=f[m++];let A;for(;!A||b.equals(A);)if(A=f[m++],!A)return 1/0;for(;m<f.length;m++){const P=f[m],D=g[0],k=A.sub(b),z=P.sub(b),$=D.sub(b),X=Nv(k,k),K=Nv(k,z),et=Nv(z,z),at=Nv($,k),ot=Nv($,z),pt=X*et-K*K,bt=(et*at-K*ot)/pt,Ct=(X*ot-K*at)/pt,kt=b.z*(1-bt-Ct)+A.z*bt+P.z*Ct;if(isFinite(kt))return kt}return 1/0}{let m=1/0;for(const b of f)m=Math.min(m,b.z);return m}}const Xq=Ri([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Zq}=Xq,qq=Ri([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Yq}=qq,Kq=Bu.VectorTileFeature.types,Jq=Math.cos(Math.PI/180*37.5),ck=Math.pow(2,14)/.5;class LT{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(m=>m.id),this.index=f.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(m=>{this.gradients[m.id]={}}),this.layoutVertexArray=new rr,this.layoutVertexArray2=new Ue,this.indexArray=new Cn,this.programConfigurations=new _o(f.layers,f.zoom),this.segments=new vi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(f,m,b){this.hasPattern=IT("line",this.layers,m);const A=this.layers[0].layout.get("line-sort-key"),P=!A.isConstant(),D=[];for(const{feature:k,id:z,index:$,sourceLayerIndex:X}of f){const K=this.layers[0]._featureFilter.needGeometry,et=mh(k,K);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),et,b))continue;const at=P?A.evaluate(et,{},b):void 0,ot={id:z,properties:k.properties,type:k.type,sourceLayerIndex:X,index:$,geometry:K?et.geometry:vh(k),patterns:{},sortKey:at};D.push(ot)}P&&D.sort((k,z)=>k.sortKey-z.sortKey);for(const k of D){const{geometry:z,index:$,sourceLayerIndex:X}=k;if(this.hasPattern){const K=MT("line",this.layers,k,this.zoom,m);this.patternFeatures.push(K)}else this.addFeature(k,z,$,b,{});m.featureIndex.insert(f[$].feature,z,$,X,this.index)}}update(f,m,b){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,m,this.stateDependentLayers,b)}addFeatures(f,m,b){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,m,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=f.createVertexBuffer(this.layoutVertexArray2,Yq)),this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,Zq),this.indexBuffer=f.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(f){if(f.properties&&Object.prototype.hasOwnProperty.call(f.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(f.properties,"mapbox_clip_end"))return{start:+f.properties.mapbox_clip_start,end:+f.properties.mapbox_clip_end}}addFeature(f,m,b,A,P){const D=this.layers[0].layout,k=D.get("line-join").evaluate(f,{}),z=D.get("line-cap"),$=D.get("line-miter-limit"),X=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(f);for(const K of m)this.addLine(K,f,k,z,$,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,b,P,A)}addLine(f,m,b,A,P,D){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ct=0;Ct<f.length-1;Ct++)this.totalDistance+=f[Ct].dist(f[Ct+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const k=Kq[m.type]==="Polygon";let z=f.length;for(;z>=2&&f[z-1].equals(f[z-2]);)z--;let $=0;for(;$<z-1&&f[$].equals(f[$+1]);)$++;if(z<(k?3:2))return;b==="bevel"&&(P=1.05);const X=this.overscaling<=16?15*Ji/(512*this.overscaling):0,K=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray);let et,at,ot,pt,bt;this.e1=this.e2=-1,k&&(et=f[z-2],bt=f[$].sub(et)._unit()._perp());for(let Ct=$;Ct<z;Ct++){if(ot=Ct===z-1?k?f[$+1]:void 0:f[Ct+1],ot&&f[Ct].equals(ot))continue;bt&&(pt=bt),et&&(at=et),et=f[Ct],bt=ot?ot.sub(et)._unit()._perp():pt,pt=pt||bt;let kt=pt.add(bt);kt.x===0&&kt.y===0||kt._unit();const It=pt.x*bt.x+pt.y*bt.y,Ft=kt.x*bt.x+kt.y*bt.y,Ht=Ft!==0?1/Ft:1/0,re=2*Math.sqrt(2-2*Ft),Pe=Ft<Jq&&at&&ot,ze=pt.x*bt.y-pt.y*bt.x>0;if(Pe&&Ct>$){const pe=et.dist(at);if(pe>2*X){const Le=et.sub(et.sub(at)._mult(X/pe)._round());this.updateDistance(at,Le),this.addCurrentVertex(Le,pt,0,0,K),at=Le}}const Te=at&&ot;let be=Te?b:k?"butt":A;if(Te&&be==="round"&&(Ht<D?be="miter":Ht<=2&&(be="fakeround")),be==="miter"&&Ht>P&&(be="bevel"),be==="bevel"&&(Ht>2&&(be="flipbevel"),Ht<P&&(be="miter")),at&&this.updateDistance(at,et),be==="miter")kt._mult(Ht),this.addCurrentVertex(et,kt,0,0,K);else if(be==="flipbevel"){if(Ht>100)kt=bt.mult(-1);else{const pe=Ht*pt.add(bt).mag()/pt.sub(bt).mag();kt._perp()._mult(pe*(ze?-1:1))}this.addCurrentVertex(et,kt,0,0,K),this.addCurrentVertex(et,kt.mult(-1),0,0,K)}else if(be==="bevel"||be==="fakeround"){const pe=-Math.sqrt(Ht*Ht-1),Le=ze?pe:0,me=ze?0:pe;if(at&&this.addCurrentVertex(et,pt,Le,me,K),be==="fakeround"){const le=Math.round(180*re/Math.PI/20);for(let Ye=1;Ye<le;Ye++){let $e=Ye/le;if($e!==.5){const mi=$e-.5;$e+=$e*mi*($e-1)*((1.0904+It*(It*(3.55645-1.43519*It)-3.2452))*mi*mi+(.848013+It*(.215638*It-1.06021)))}const wr=bt.sub(pt)._mult($e)._add(pt)._unit()._mult(ze?-1:1);this.addHalfVertex(et,wr.x,wr.y,!1,ze,0,K)}}ot&&this.addCurrentVertex(et,bt,-Le,-me,K)}else if(be==="butt")this.addCurrentVertex(et,kt,0,0,K);else if(be==="square"){const pe=at?1:-1;this.addCurrentVertex(et,kt,pe,pe,K)}else be==="round"&&(at&&(this.addCurrentVertex(et,pt,0,0,K),this.addCurrentVertex(et,pt,1,1,K,!0)),ot&&(this.addCurrentVertex(et,bt,-1,-1,K,!0),this.addCurrentVertex(et,bt,0,0,K)));if(Pe&&Ct<z-1){const pe=et.dist(ot);if(pe>2*X){const Le=et.add(ot.sub(et)._mult(X/pe)._round());this.updateDistance(et,Le),this.addCurrentVertex(Le,bt,0,0,K),et=Le}}}}addCurrentVertex(f,m,b,A,P,D=!1){const k=m.y*A-m.x,z=-m.y-m.x*A;this.addHalfVertex(f,m.x+m.y*b,m.y-m.x*b,D,!1,b,P),this.addHalfVertex(f,k,z,D,!0,-A,P),this.distance>ck/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(f,m,b,A,P,D))}addHalfVertex({x:f,y:m},b,A,P,D,k,z){const $=.5*(this.lineClips?this.scaledDistance*(ck-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((f<<1)+(P?1:0),(m<<1)+(D?1:0),Math.round(63*b)+128,Math.round(63*A)+128,1+(k===0?0:k<0?-1:1)|(63&$)<<2,$>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const X=z.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,X),z.primitiveLength++),D?this.e2=X:this.e1=X}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(f,m){this.distance+=f.dist(m),this.updateScaledDistance()}}let hk,fk;De("LineBucket",LT,{omit:["layers","patternFeatures"]});var dk={get paint(){return fk=fk||new Gi({"line-opacity":new er(qt.paint_line["line-opacity"]),"line-color":new er(qt.paint_line["line-color"]),"line-translate":new He(qt.paint_line["line-translate"]),"line-translate-anchor":new He(qt.paint_line["line-translate-anchor"]),"line-width":new er(qt.paint_line["line-width"]),"line-gap-width":new er(qt.paint_line["line-gap-width"]),"line-offset":new er(qt.paint_line["line-offset"]),"line-blur":new er(qt.paint_line["line-blur"]),"line-dasharray":new _v(qt.paint_line["line-dasharray"]),"line-pattern":new dh(qt.paint_line["line-pattern"]),"line-gradient":new xv(qt.paint_line["line-gradient"])})},get layout(){return hk=hk||new Gi({"line-cap":new He(qt.layout_line["line-cap"]),"line-join":new er(qt.layout_line["line-join"]),"line-miter-limit":new He(qt.layout_line["line-miter-limit"]),"line-round-limit":new He(qt.layout_line["line-round-limit"]),"line-sort-key":new er(qt.layout_line["line-sort-key"])})}};class Qq extends er{possiblyEvaluate(f,m){return m=new gi(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),super.possiblyEvaluate(f,m)}evaluate(f,m,b,A){return m=W({},m,{zoom:Math.floor(m.zoom)}),super.evaluate(f,m,b,A)}}let k0;class tY extends is{constructor(f){super(f,dk),this.gradientVersion=0,k0||(k0=new Qq(dk.paint.properties["line-width"].specification),k0.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(f){if(f==="line-gradient"){const m=this.gradientExpression();this.stepInterpolant=!!function(b){return b._styleExpression!==void 0}(m)&&m._styleExpression.expression instanceof Ho,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(f,m){super.recalculate(f,m),this.paint._values["line-floorwidth"]=k0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,f)}createBucket(f){return new LT(f)}queryRadius(f){const m=f,b=pk(Iv("line-width",this,m),Iv("line-gap-width",this,m)),A=Iv("line-offset",this,m);return b/2+Math.abs(A)+E0(this.paint.get("line-translate"))}queryIntersectsFeature(f,m,b,A,P,D,k){const z=I0(f,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),D.angle,k),$=k/2*pk(this.paint.get("line-width").evaluate(m,b),this.paint.get("line-gap-width").evaluate(m,b)),X=this.paint.get("line-offset").evaluate(m,b);return X&&(A=function(K,et){const at=[];for(let ot=0;ot<K.length;ot++){const pt=K[ot],bt=[];for(let Ct=0;Ct<pt.length;Ct++){const kt=pt[Ct-1],It=pt[Ct],Ft=pt[Ct+1],Ht=Ct===0?new p(0,0):It.sub(kt)._unit()._perp(),re=Ct===pt.length-1?new p(0,0):Ft.sub(It)._unit()._perp(),Pe=Ht._add(re)._unit(),ze=Pe.x*re.x+Pe.y*re.y;ze!==0&&Pe._mult(1/ze),bt.push(Pe._mult(et)._add(It))}at.push(bt)}return at}(A,X*k)),function(K,et,at){for(let ot=0;ot<et.length;ot++){const pt=et[ot];if(K.length>=3){for(let bt=0;bt<pt.length;bt++)if(Ld(K,pt[bt]))return!0}if(sq(K,pt,at))return!0}return!1}(z,A,$)}isTileClipped(){return!0}}function pk(g,f){return f>0?f+2*g:g}const eY=Ri([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rY=Ri([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ri([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const iY=Ri([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ri([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const gk=Ri([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nY=Ri([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function aY(g,f,m){return g.sections.forEach(b=>{b.text=function(A,P,D){const k=P.layout.get("text-transform").evaluate(D,{});return k==="uppercase"?A=A.toLocaleUpperCase():k==="lowercase"&&(A=A.toLocaleLowerCase()),Da.applyArabicShaping&&(A=Da.applyArabicShaping(A)),A}(b.text,f,m)}),g}Ri([{name:"triangle",components:3,type:"Uint16"}]),Ri([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ri([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ri([{type:"Float32",name:"offsetX"}]),Ri([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ri([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Fv={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var un=24,vk=ni,mk=function(g,f,m,b,A){var P,D,k=8*A-b-1,z=(1<<k)-1,$=z>>1,X=-7,K=m?A-1:0,et=m?-1:1,at=g[f+K];for(K+=et,P=at&(1<<-X)-1,at>>=-X,X+=k;X>0;P=256*P+g[f+K],K+=et,X-=8);for(D=P&(1<<-X)-1,P>>=-X,X+=b;X>0;D=256*D+g[f+K],K+=et,X-=8);if(P===0)P=1-$;else{if(P===z)return D?NaN:1/0*(at?-1:1);D+=Math.pow(2,b),P-=$}return(at?-1:1)*D*Math.pow(2,P-b)},yk=function(g,f,m,b,A,P){var D,k,z,$=8*P-A-1,X=(1<<$)-1,K=X>>1,et=A===23?Math.pow(2,-24)-Math.pow(2,-77):0,at=b?0:P-1,ot=b?1:-1,pt=f<0||f===0&&1/f<0?1:0;for(f=Math.abs(f),isNaN(f)||f===1/0?(k=isNaN(f)?1:0,D=X):(D=Math.floor(Math.log(f)/Math.LN2),f*(z=Math.pow(2,-D))<1&&(D--,z*=2),(f+=D+K>=1?et/z:et*Math.pow(2,1-K))*z>=2&&(D++,z/=2),D+K>=X?(k=0,D=X):D+K>=1?(k=(f*z-1)*Math.pow(2,A),D+=K):(k=f*Math.pow(2,K-1)*Math.pow(2,A),D=0));A>=8;g[m+at]=255&k,at+=ot,k/=256,A-=8);for(D=D<<A|k,$+=A;$>0;g[m+at]=255&D,at+=ot,D/=256,$-=8);g[m+at-ot]|=128*pt};function ni(g){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(g)?g:new Uint8Array(g||0),this.pos=0,this.type=0,this.length=this.buf.length}ni.Varint=0,ni.Fixed64=1,ni.Bytes=2,ni.Fixed32=5;var kT=4294967296,_k=1/kT,xk=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function $l(g){return g.type===ni.Bytes?g.readVarint()+g.pos:g.pos+1}function Fd(g,f,m){return m?4294967296*f+(g>>>0):4294967296*(f>>>0)+(g>>>0)}function bk(g,f,m){var b=f<=16383?1:f<=2097151?2:f<=268435455?3:Math.floor(Math.log(f)/(7*Math.LN2));m.realloc(b);for(var A=m.pos-1;A>=g;A--)m.buf[A+b]=m.buf[A]}function sY(g,f){for(var m=0;m<g.length;m++)f.writeVarint(g[m])}function oY(g,f){for(var m=0;m<g.length;m++)f.writeSVarint(g[m])}function lY(g,f){for(var m=0;m<g.length;m++)f.writeFloat(g[m])}function uY(g,f){for(var m=0;m<g.length;m++)f.writeDouble(g[m])}function cY(g,f){for(var m=0;m<g.length;m++)f.writeBoolean(g[m])}function hY(g,f){for(var m=0;m<g.length;m++)f.writeFixed32(g[m])}function fY(g,f){for(var m=0;m<g.length;m++)f.writeSFixed32(g[m])}function dY(g,f){for(var m=0;m<g.length;m++)f.writeFixed64(g[m])}function pY(g,f){for(var m=0;m<g.length;m++)f.writeSFixed64(g[m])}function O0(g,f){return(g[f]|g[f+1]<<8|g[f+2]<<16)+16777216*g[f+3]}function Bd(g,f,m){g[m]=f,g[m+1]=f>>>8,g[m+2]=f>>>16,g[m+3]=f>>>24}function wk(g,f){return(g[f]|g[f+1]<<8|g[f+2]<<16)+(g[f+3]<<24)}ni.prototype={destroy:function(){this.buf=null},readFields:function(g,f,m){for(m=m||this.length;this.pos<m;){var b=this.readVarint(),A=b>>3,P=this.pos;this.type=7&b,g(A,f,this),this.pos===P&&this.skip(b)}return f},readMessage:function(g,f){return this.readFields(g,f,this.readVarint()+this.pos)},readFixed32:function(){var g=O0(this.buf,this.pos);return this.pos+=4,g},readSFixed32:function(){var g=wk(this.buf,this.pos);return this.pos+=4,g},readFixed64:function(){var g=O0(this.buf,this.pos)+O0(this.buf,this.pos+4)*kT;return this.pos+=8,g},readSFixed64:function(){var g=O0(this.buf,this.pos)+wk(this.buf,this.pos+4)*kT;return this.pos+=8,g},readFloat:function(){var g=mk(this.buf,this.pos,!0,23,4);return this.pos+=4,g},readDouble:function(){var g=mk(this.buf,this.pos,!0,52,8);return this.pos+=8,g},readVarint:function(g){var f,m,b=this.buf;return f=127&(m=b[this.pos++]),m<128?f:(f|=(127&(m=b[this.pos++]))<<7,m<128?f:(f|=(127&(m=b[this.pos++]))<<14,m<128?f:(f|=(127&(m=b[this.pos++]))<<21,m<128?f:function(A,P,D){var k,z,$=D.buf;if(k=(112&(z=$[D.pos++]))>>4,z<128||(k|=(127&(z=$[D.pos++]))<<3,z<128)||(k|=(127&(z=$[D.pos++]))<<10,z<128)||(k|=(127&(z=$[D.pos++]))<<17,z<128)||(k|=(127&(z=$[D.pos++]))<<24,z<128)||(k|=(1&(z=$[D.pos++]))<<31,z<128))return Fd(A,k,P);throw new Error("Expected varint not more than 10 bytes")}(f|=(15&(m=b[this.pos]))<<28,g,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var g=this.readVarint();return g%2==1?(g+1)/-2:g/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var g=this.readVarint()+this.pos,f=this.pos;return this.pos=g,g-f>=12&&xk?function(m,b,A){return xk.decode(m.subarray(b,A))}(this.buf,f,g):function(m,b,A){for(var P="",D=b;D<A;){var k,z,$,X=m[D],K=null,et=X>239?4:X>223?3:X>191?2:1;if(D+et>A)break;et===1?X<128&&(K=X):et===2?(192&(k=m[D+1]))==128&&(K=(31&X)<<6|63&k)<=127&&(K=null):et===3?(z=m[D+2],(192&(k=m[D+1]))==128&&(192&z)==128&&((K=(15&X)<<12|(63&k)<<6|63&z)<=2047||K>=55296&&K<=57343)&&(K=null)):et===4&&(z=m[D+2],$=m[D+3],(192&(k=m[D+1]))==128&&(192&z)==128&&(192&$)==128&&((K=(15&X)<<18|(63&k)<<12|(63&z)<<6|63&$)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,et=1):K>65535&&(K-=65536,P+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),P+=String.fromCharCode(K),D+=et}return P}(this.buf,f,g)},readBytes:function(){var g=this.readVarint()+this.pos,f=this.buf.subarray(this.pos,g);return this.pos=g,f},readPackedVarint:function(g,f){if(this.type!==ni.Bytes)return g.push(this.readVarint(f));var m=$l(this);for(g=g||[];this.pos<m;)g.push(this.readVarint(f));return g},readPackedSVarint:function(g){if(this.type!==ni.Bytes)return g.push(this.readSVarint());var f=$l(this);for(g=g||[];this.pos<f;)g.push(this.readSVarint());return g},readPackedBoolean:function(g){if(this.type!==ni.Bytes)return g.push(this.readBoolean());var f=$l(this);for(g=g||[];this.pos<f;)g.push(this.readBoolean());return g},readPackedFloat:function(g){if(this.type!==ni.Bytes)return g.push(this.readFloat());var f=$l(this);for(g=g||[];this.pos<f;)g.push(this.readFloat());return g},readPackedDouble:function(g){if(this.type!==ni.Bytes)return g.push(this.readDouble());var f=$l(this);for(g=g||[];this.pos<f;)g.push(this.readDouble());return g},readPackedFixed32:function(g){if(this.type!==ni.Bytes)return g.push(this.readFixed32());var f=$l(this);for(g=g||[];this.pos<f;)g.push(this.readFixed32());return g},readPackedSFixed32:function(g){if(this.type!==ni.Bytes)return g.push(this.readSFixed32());var f=$l(this);for(g=g||[];this.pos<f;)g.push(this.readSFixed32());return g},readPackedFixed64:function(g){if(this.type!==ni.Bytes)return g.push(this.readFixed64());var f=$l(this);for(g=g||[];this.pos<f;)g.push(this.readFixed64());return g},readPackedSFixed64:function(g){if(this.type!==ni.Bytes)return g.push(this.readSFixed64());var f=$l(this);for(g=g||[];this.pos<f;)g.push(this.readSFixed64());return g},skip:function(g){var f=7&g;if(f===ni.Varint)for(;this.buf[this.pos++]>127;);else if(f===ni.Bytes)this.pos=this.readVarint()+this.pos;else if(f===ni.Fixed32)this.pos+=4;else{if(f!==ni.Fixed64)throw new Error("Unimplemented type: "+f);this.pos+=8}},writeTag:function(g,f){this.writeVarint(g<<3|f)},realloc:function(g){for(var f=this.length||16;f<this.pos+g;)f*=2;if(f!==this.length){var m=new Uint8Array(f);m.set(this.buf),this.buf=m,this.length=f}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(g){this.realloc(4),Bd(this.buf,g,this.pos),this.pos+=4},writeSFixed32:function(g){this.realloc(4),Bd(this.buf,g,this.pos),this.pos+=4},writeFixed64:function(g){this.realloc(8),Bd(this.buf,-1&g,this.pos),Bd(this.buf,Math.floor(g*_k),this.pos+4),this.pos+=8},writeSFixed64:function(g){this.realloc(8),Bd(this.buf,-1&g,this.pos),Bd(this.buf,Math.floor(g*_k),this.pos+4),this.pos+=8},writeVarint:function(g){(g=+g||0)>268435455||g<0?function(f,m){var b,A;if(f>=0?(b=f%4294967296|0,A=f/4294967296|0):(A=~(-f/4294967296),4294967295^(b=~(-f%4294967296))?b=b+1|0:(b=0,A=A+1|0)),f>=18446744073709552e3||f<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");m.realloc(10),function(P,D,k){k.buf[k.pos++]=127&P|128,P>>>=7,k.buf[k.pos++]=127&P|128,P>>>=7,k.buf[k.pos++]=127&P|128,P>>>=7,k.buf[k.pos++]=127&P|128,k.buf[k.pos]=127&(P>>>=7)}(b,0,m),function(P,D){var k=(7&P)<<4;D.buf[D.pos++]|=k|((P>>>=3)?128:0),P&&(D.buf[D.pos++]=127&P|((P>>>=7)?128:0),P&&(D.buf[D.pos++]=127&P|((P>>>=7)?128:0),P&&(D.buf[D.pos++]=127&P|((P>>>=7)?128:0),P&&(D.buf[D.pos++]=127&P|((P>>>=7)?128:0),P&&(D.buf[D.pos++]=127&P)))))}(A,m)}(g,this):(this.realloc(4),this.buf[this.pos++]=127&g|(g>127?128:0),g<=127||(this.buf[this.pos++]=127&(g>>>=7)|(g>127?128:0),g<=127||(this.buf[this.pos++]=127&(g>>>=7)|(g>127?128:0),g<=127||(this.buf[this.pos++]=g>>>7&127))))},writeSVarint:function(g){this.writeVarint(g<0?2*-g-1:2*g)},writeBoolean:function(g){this.writeVarint(!!g)},writeString:function(g){g=String(g),this.realloc(4*g.length),this.pos++;var f=this.pos;this.pos=function(b,A,P){for(var D,k,z=0;z<A.length;z++){if((D=A.charCodeAt(z))>55295&&D<57344){if(!k){D>56319||z+1===A.length?(b[P++]=239,b[P++]=191,b[P++]=189):k=D;continue}if(D<56320){b[P++]=239,b[P++]=191,b[P++]=189,k=D;continue}D=k-55296<<10|D-56320|65536,k=null}else k&&(b[P++]=239,b[P++]=191,b[P++]=189,k=null);D<128?b[P++]=D:(D<2048?b[P++]=D>>6|192:(D<65536?b[P++]=D>>12|224:(b[P++]=D>>18|240,b[P++]=D>>12&63|128),b[P++]=D>>6&63|128),b[P++]=63&D|128)}return P}(this.buf,g,this.pos);var m=this.pos-f;m>=128&&bk(f,m,this),this.pos=f-1,this.writeVarint(m),this.pos+=m},writeFloat:function(g){this.realloc(4),yk(this.buf,g,this.pos,!0,23,4),this.pos+=4},writeDouble:function(g){this.realloc(8),yk(this.buf,g,this.pos,!0,52,8),this.pos+=8},writeBytes:function(g){var f=g.length;this.writeVarint(f),this.realloc(f);for(var m=0;m<f;m++)this.buf[this.pos++]=g[m]},writeRawMessage:function(g,f){this.pos++;var m=this.pos;g(f,this);var b=this.pos-m;b>=128&&bk(m,b,this),this.pos=m-1,this.writeVarint(b),this.pos+=b},writeMessage:function(g,f,m){this.writeTag(g,ni.Bytes),this.writeRawMessage(f,m)},writePackedVarint:function(g,f){f.length&&this.writeMessage(g,sY,f)},writePackedSVarint:function(g,f){f.length&&this.writeMessage(g,oY,f)},writePackedBoolean:function(g,f){f.length&&this.writeMessage(g,cY,f)},writePackedFloat:function(g,f){f.length&&this.writeMessage(g,lY,f)},writePackedDouble:function(g,f){f.length&&this.writeMessage(g,uY,f)},writePackedFixed32:function(g,f){f.length&&this.writeMessage(g,hY,f)},writePackedSFixed32:function(g,f){f.length&&this.writeMessage(g,fY,f)},writePackedFixed64:function(g,f){f.length&&this.writeMessage(g,dY,f)},writePackedSFixed64:function(g,f){f.length&&this.writeMessage(g,pY,f)},writeBytesField:function(g,f){this.writeTag(g,ni.Bytes),this.writeBytes(f)},writeFixed32Field:function(g,f){this.writeTag(g,ni.Fixed32),this.writeFixed32(f)},writeSFixed32Field:function(g,f){this.writeTag(g,ni.Fixed32),this.writeSFixed32(f)},writeFixed64Field:function(g,f){this.writeTag(g,ni.Fixed64),this.writeFixed64(f)},writeSFixed64Field:function(g,f){this.writeTag(g,ni.Fixed64),this.writeSFixed64(f)},writeVarintField:function(g,f){this.writeTag(g,ni.Varint),this.writeVarint(f)},writeSVarintField:function(g,f){this.writeTag(g,ni.Varint),this.writeSVarint(f)},writeStringField:function(g,f){this.writeTag(g,ni.Bytes),this.writeString(f)},writeFloatField:function(g,f){this.writeTag(g,ni.Fixed32),this.writeFloat(f)},writeDoubleField:function(g,f){this.writeTag(g,ni.Fixed64),this.writeDouble(f)},writeBooleanField:function(g,f){this.writeVarintField(g,!!f)}};var OT=u(vk);const NT=3;function gY(g,f,m){g===1&&m.readMessage(vY,f)}function vY(g,f,m){if(g===3){const{id:b,bitmap:A,width:P,height:D,left:k,top:z,advance:$}=m.readMessage(mY,{});f.push({id:b,bitmap:new Pv({width:P+2*NT,height:D+2*NT},A),metrics:{width:P,height:D,left:k,top:z,advance:$}})}}function mY(g,f,m){g===1?f.id=m.readVarint():g===2?f.bitmap=m.readBytes():g===3?f.width=m.readVarint():g===4?f.height=m.readVarint():g===5?f.left=m.readSVarint():g===6?f.top=m.readSVarint():g===7&&(f.advance=m.readVarint())}const Sk=NT;function Tk(g){let f=0,m=0;for(const D of g)f+=D.w*D.h,m=Math.max(m,D.w);g.sort((D,k)=>k.h-D.h);const b=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(f/.95)),m),h:1/0}];let A=0,P=0;for(const D of g)for(let k=b.length-1;k>=0;k--){const z=b[k];if(!(D.w>z.w||D.h>z.h)){if(D.x=z.x,D.y=z.y,P=Math.max(P,D.y+D.h),A=Math.max(A,D.x+D.w),D.w===z.w&&D.h===z.h){const $=b.pop();k<b.length&&(b[k]=$)}else D.h===z.h?(z.x+=D.w,z.w-=D.w):D.w===z.w?(z.y+=D.h,z.h-=D.h):(b.push({x:z.x+D.w,y:z.y,w:z.w-D.w,h:D.h}),z.y+=D.h,z.h-=D.h);break}}return{w:A,h:P,fill:f/(A*P)||0}}const ka=1;class FT{constructor(f,{pixelRatio:m,version:b,stretchX:A,stretchY:P,content:D}){this.paddedRect=f,this.pixelRatio=m,this.stretchX=A,this.stretchY=P,this.content=D,this.version=b}get tl(){return[this.paddedRect.x+ka,this.paddedRect.y+ka]}get br(){return[this.paddedRect.x+this.paddedRect.w-ka,this.paddedRect.y+this.paddedRect.h-ka]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ka)/this.pixelRatio,(this.paddedRect.h-2*ka)/this.pixelRatio]}}class Ak{constructor(f,m){const b={},A={};this.haveRenderCallbacks=[];const P=[];this.addImages(f,b,P),this.addImages(m,A,P);const{w:D,h:k}=Tk(P),z=new ys({width:D||1,height:k||1});for(const $ in f){const X=f[$],K=b[$].paddedRect;ys.copy(X.data,z,{x:0,y:0},{x:K.x+ka,y:K.y+ka},X.data)}for(const $ in m){const X=m[$],K=A[$].paddedRect,et=K.x+ka,at=K.y+ka,ot=X.data.width,pt=X.data.height;ys.copy(X.data,z,{x:0,y:0},{x:et,y:at},X.data),ys.copy(X.data,z,{x:0,y:pt-1},{x:et,y:at-1},{width:ot,height:1}),ys.copy(X.data,z,{x:0,y:0},{x:et,y:at+pt},{width:ot,height:1}),ys.copy(X.data,z,{x:ot-1,y:0},{x:et-1,y:at},{width:1,height:pt}),ys.copy(X.data,z,{x:0,y:0},{x:et+ot,y:at},{width:1,height:pt})}this.image=z,this.iconPositions=b,this.patternPositions=A}addImages(f,m,b){for(const A in f){const P=f[A],D={x:0,y:0,w:P.data.width+2*ka,h:P.data.height+2*ka};b.push(D),m[A]=new FT(D,P),P.hasRenderCallback&&this.haveRenderCallbacks.push(A)}}patchUpdatedImages(f,m){f.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const b in f.updatedImages)this.patchUpdatedImage(this.iconPositions[b],f.getImage(b),m),this.patchUpdatedImage(this.patternPositions[b],f.getImage(b),m)}patchUpdatedImage(f,m,b){if(!f||!m||f.version===m.version)return;f.version=m.version;const[A,P]=f.tl;b.update(m.data,void 0,{x:A,y:P})}}var zu;De("ImagePosition",FT),De("ImageAtlas",Ak),o.ai=void 0,(zu=o.ai||(o.ai={}))[zu.none=0]="none",zu[zu.horizontal=1]="horizontal",zu[zu.vertical=2]="vertical",zu[zu.horizontalOnly=3]="horizontalOnly";const Bv=-17;class zv{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(f,m){const b=new zv;return b.scale=f||1,b.fontStack=m,b}static forImage(f){const m=new zv;return m.imageName=f,m}}class zd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(f,m){const b=new zd;for(let A=0;A<f.sections.length;A++){const P=f.sections[A];P.image?b.addImageSection(P):b.addTextSection(P,m)}return b}length(){return this.text.length}getSection(f){return this.sections[this.sectionIndex[f]]}getSectionIndex(f){return this.sectionIndex[f]}getCharCode(f){return this.text.charCodeAt(f)}verticalizePunctuation(){this.text=function(f){let m="";for(let b=0;b<f.length;b++){const A=f.charCodeAt(b+1)||null,P=f.charCodeAt(b-1)||null;m+=A&&v0(A)&&!Fv[f[b+1]]||P&&v0(P)&&!Fv[f[b-1]]||!Fv[f[b]]?f[b]:Fv[f[b]]}return m}(this.text)}trim(){let f=0;for(let b=0;b<this.text.length&&F0[this.text.charCodeAt(b)];b++)f++;let m=this.text.length;for(let b=this.text.length-1;b>=0&&b>=f&&F0[this.text.charCodeAt(b)];b--)m--;this.text=this.text.substring(f,m),this.sectionIndex=this.sectionIndex.slice(f,m)}substring(f,m){const b=new zd;return b.text=this.text.substring(f,m),b.sectionIndex=this.sectionIndex.slice(f,m),b.sections=this.sections,b}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((f,m)=>Math.max(f,this.sections[m].scale),0)}addTextSection(f,m){this.text+=f.text,this.sections.push(zv.forText(f.scale,f.fontStack||m));const b=this.sections.length-1;for(let A=0;A<f.text.length;++A)this.sectionIndex.push(b)}addImageSection(f){const m=f.image?f.image.name:"";if(m.length===0)return void lt("Can't add FormattedSection with an empty image.");const b=this.getNextImageSectionCharCode();b?(this.text+=String.fromCharCode(b),this.sections.push(zv.forImage(m)),this.sectionIndex.push(this.sections.length-1)):lt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function N0(g,f,m,b,A,P,D,k,z,$,X,K,et,at,ot,pt){const bt=zd.fromFeature(g,A);let Ct;K===o.ai.vertical&&bt.verticalizePunctuation();const{processBidirectionalText:kt,processStyledBidirectionalText:It}=Da;if(kt&&bt.sections.length===1){Ct=[];const re=kt(bt.toString(),BT(bt,$,P,f,b,at,ot));for(const Pe of re){const ze=new zd;ze.text=Pe,ze.sections=bt.sections;for(let Te=0;Te<Pe.length;Te++)ze.sectionIndex.push(0);Ct.push(ze)}}else if(It){Ct=[];const re=It(bt.text,bt.sectionIndex,BT(bt,$,P,f,b,at,ot));for(const Pe of re){const ze=new zd;ze.text=Pe[0],ze.sectionIndex=Pe[1],ze.sections=bt.sections,Ct.push(ze)}}else Ct=function(re,Pe){const ze=[],Te=re.text;let be=0;for(const pe of Pe)ze.push(re.substring(be,pe)),be=pe;return be<Te.length&&ze.push(re.substring(be,Te.length)),ze}(bt,BT(bt,$,P,f,b,at,ot));const Ft=[],Ht={positionedLines:Ft,text:bt.toString(),top:X[1],bottom:X[1],left:X[0],right:X[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(re,Pe,ze,Te,be,pe,Le,me,le,Ye,$e,wr){let mi=0,Ai=Bv,cn=0,as=0;const ha=me==="right"?1:me==="left"?0:.5;let Qi=0;for(const hn of be){hn.trim();const fn=hn.getMaxScale(),jn=(fn-1)*un,pa={positionedGlyphs:[],lineOffset:0};re.positionedLines[Qi]=pa;const Xn=pa.positionedGlyphs;let Oa=0;if(!hn.length()){Ai+=pe,++Qi;continue}for(let dn=0;dn<hn.length();dn++){const Mr=hn.getSection(dn),Zn=hn.getSectionIndex(dn),Bn=hn.getCharCode(dn);let pn=0,Bs=null,xo=null,bo=null,Wl=un;const zs=!(le===o.ai.horizontal||!$e&&!hv(Bn)||$e&&(F0[Bn]||(In=Bn,Me.Arabic(In)||Me["Arabic Supplement"](In)||Me["Arabic Extended-A"](In)||Me["Arabic Presentation Forms-A"](In)||Me["Arabic Presentation Forms-B"](In))));if(Mr.imageName){const xs=Te[Mr.imageName];if(!xs)continue;bo=Mr.imageName,re.iconsInText=re.iconsInText||!0,xo=xs.paddedRect;const Fa=xs.displaySize;Mr.scale=Mr.scale*un/wr,Bs={width:Fa[0],height:Fa[1],left:ka,top:-Sk,advance:zs?Fa[1]:Fa[0]},pn=jn+(un-Fa[1]*Mr.scale),Wl=Bs.advance;const Hl=zs?Fa[0]*Mr.scale-un*fn:Fa[1]*Mr.scale-un*fn;Hl>0&&Hl>Oa&&(Oa=Hl)}else{const xs=ze[Mr.fontStack],Fa=xs&&xs[Bn];if(Fa&&Fa.rect)xo=Fa.rect,Bs=Fa.metrics;else{const Hl=Pe[Mr.fontStack],Hv=Hl&&Hl[Bn];if(!Hv)continue;Bs=Hv.metrics}pn=(fn-Mr.scale)*un}zs?(re.verticalizable=!0,Xn.push({glyph:Bn,imageName:bo,x:mi,y:Ai+pn,vertical:zs,scale:Mr.scale,fontStack:Mr.fontStack,sectionIndex:Zn,metrics:Bs,rect:xo}),mi+=Wl*Mr.scale+Ye):(Xn.push({glyph:Bn,imageName:bo,x:mi,y:Ai+pn,vertical:zs,scale:Mr.scale,fontStack:Mr.fontStack,sectionIndex:Zn,metrics:Bs,rect:xo}),mi+=Bs.advance*Mr.scale+Ye)}Xn.length!==0&&(cn=Math.max(mi-Ye,cn),xY(Xn,0,Xn.length-1,ha,Oa)),mi=0;const Na=pe*fn+Oa;pa.lineOffset=Math.max(Oa,jn),Ai+=Na,as=Math.max(Na,as),++Qi}var In;const Fn=Ai-Bv,{horizontalAlign:fa,verticalAlign:da}=zT(Le);(function(hn,fn,jn,pa,Xn,Oa,Na,dn,Mr){const Zn=(fn-jn)*Xn;let Bn=0;Bn=Oa!==Na?-dn*pa-Bv:(-pa*Mr+.5)*Na;for(const pn of hn)for(const Bs of pn.positionedGlyphs)Bs.x+=Zn,Bs.y+=Bn})(re.positionedLines,ha,fa,da,cn,as,pe,Fn,be.length),re.top+=-da*Fn,re.bottom=re.top+Fn,re.left+=-fa*cn,re.right=re.left+cn}(Ht,f,m,b,Ct,D,k,z,K,$,et,pt),!function(re){for(const Pe of re)if(Pe.positionedGlyphs.length!==0)return!1;return!0}(Ft)&&Ht}const F0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yY={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ck(g,f,m,b,A,P){if(f.imageName){const D=b[f.imageName];return D?D.displaySize[0]*f.scale*un/P+A:0}{const D=m[f.fontStack],k=D&&D[g];return k?k.metrics.advance*f.scale+A:0}}function Ek(g,f,m,b){const A=Math.pow(g-f,2);return b?g<f?A/2:2*A:A+Math.abs(m)*m}function _Y(g,f,m){let b=0;return g===10&&(b-=1e4),m&&(b+=150),g!==40&&g!==65288||(b+=50),f!==41&&f!==65289||(b+=50),b}function Ik(g,f,m,b,A,P){let D=null,k=Ek(f,m,A,P);for(const z of b){const $=Ek(f-z.x,m,A,P)+z.badness;$<=k&&(D=z,k=$)}return{index:g,x:f,priorBreak:D,badness:k}}function Mk(g){return g?Mk(g.priorBreak).concat(g.index):[]}function BT(g,f,m,b,A,P,D){if(P!=="point")return[];if(!g)return[];const k=[],z=function(et,at,ot,pt,bt,Ct){let kt=0;for(let It=0;It<et.length();It++){const Ft=et.getSection(It);kt+=Ck(et.getCharCode(It),Ft,pt,bt,at,Ct)}return kt/Math.max(1,Math.ceil(kt/ot))}(g,f,m,b,A,D),$=g.text.indexOf("")>=0;let X=0;for(let et=0;et<g.length();et++){const at=g.getSection(et),ot=g.getCharCode(et);if(F0[ot]||(X+=Ck(ot,at,b,A,f,D)),et<g.length()-1){const pt=!((K=ot)<11904||!(Me["Bopomofo Extended"](K)||Me.Bopomofo(K)||Me["CJK Compatibility Forms"](K)||Me["CJK Compatibility Ideographs"](K)||Me["CJK Compatibility"](K)||Me["CJK Radicals Supplement"](K)||Me["CJK Strokes"](K)||Me["CJK Symbols and Punctuation"](K)||Me["CJK Unified Ideographs Extension A"](K)||Me["CJK Unified Ideographs"](K)||Me["Enclosed CJK Letters and Months"](K)||Me["Halfwidth and Fullwidth Forms"](K)||Me.Hiragana(K)||Me["Ideographic Description Characters"](K)||Me["Kangxi Radicals"](K)||Me["Katakana Phonetic Extensions"](K)||Me.Katakana(K)||Me["Vertical Forms"](K)||Me["Yi Radicals"](K)||Me["Yi Syllables"](K)));(yY[ot]||pt||at.imageName)&&k.push(Ik(et+1,X,z,k,_Y(ot,g.getCharCode(et+1),pt&&$),!1))}}var K;return Mk(Ik(g.length(),X,z,k,0,!0))}function zT(g){let f=.5,m=.5;switch(g){case"right":case"top-right":case"bottom-right":f=1;break;case"left":case"top-left":case"bottom-left":f=0}switch(g){case"bottom":case"bottom-right":case"bottom-left":m=1;break;case"top":case"top-right":case"top-left":m=0}return{horizontalAlign:f,verticalAlign:m}}function xY(g,f,m,b,A){if(!b&&!A)return;const P=g[m],D=(g[m].x+P.metrics.advance*P.scale)*b;for(let k=f;k<=m;k++)g[k].x-=D,g[k].y+=A}function bY(g,f,m){const{horizontalAlign:b,verticalAlign:A}=zT(m),P=f[0]-g.displaySize[0]*b,D=f[1]-g.displaySize[1]*A;return{image:g,top:D,bottom:D+g.displaySize[1],left:P,right:P+g.displaySize[0]}}function Pk(g,f,m,b,A,P){const D=g.image;let k;if(D.content){const bt=D.content,Ct=D.pixelRatio||1;k=[bt[0]/Ct,bt[1]/Ct,D.displaySize[0]-bt[2]/Ct,D.displaySize[1]-bt[3]/Ct]}const z=f.left*P,$=f.right*P;let X,K,et,at;m==="width"||m==="both"?(at=A[0]+z-b[3],K=A[0]+$+b[1]):(at=A[0]+(z+$-D.displaySize[0])/2,K=at+D.displaySize[0]);const ot=f.top*P,pt=f.bottom*P;return m==="height"||m==="both"?(X=A[1]+ot-b[0],et=A[1]+pt+b[2]):(X=A[1]+(ot+pt-D.displaySize[1])/2,et=X+D.displaySize[1]),{image:D,top:X,right:K,bottom:et,left:at,collisionPadding:k}}const Vv=255,qo=128,Vu=Vv*qo;function Rk(g,f){const{expression:m}=f;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new gi(g+1))};if(m.kind==="source")return{kind:"source"};{const{zoomStops:b,interpolationType:A}=m;let P=0;for(;P<b.length&&b[P]<=g;)P++;P=Math.max(0,P-1);let D=P;for(;D<b.length&&b[D]<g+1;)D++;D=Math.min(b.length-1,D);const k=b[P],z=b[D];return m.kind==="composite"?{kind:"composite",minZoom:k,maxZoom:z,interpolationType:A}:{kind:"camera",minZoom:k,maxZoom:z,minSize:m.evaluate(new gi(k)),maxSize:m.evaluate(new gi(z)),interpolationType:A}}}function VT(g,f,m){let b="never";const A=g.get(f);return A?b=A:g.get(m)&&(b="always"),b}const wY=Bu.VectorTileFeature.types,SY=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function B0(g,f,m,b,A,P,D,k,z,$,X,K,et){const at=k?Math.min(Vu,Math.round(k[0])):0,ot=k?Math.min(Vu,Math.round(k[1])):0;g.emplaceBack(f,m,Math.round(32*b),Math.round(32*A),P,D,(at<<1)+(z?1:0),ot,16*$,16*X,256*K,256*et)}function UT(g,f,m){g.emplaceBack(f.x,f.y,m),g.emplaceBack(f.x,f.y,m),g.emplaceBack(f.x,f.y,m),g.emplaceBack(f.x,f.y,m)}function TY(g){for(const f of g.sections)if(dT(f.text))return!0;return!1}class $T{constructor(f){this.layoutVertexArray=new Tr,this.indexArray=new Cn,this.programConfigurations=f,this.segments=new vi,this.dynamicLayoutVertexArray=new mr,this.opacityVertexArray=new Er,this.hasVisibleVertices=!1,this.placedSymbolArray=new Pt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(f,m,b,A){this.isEmpty()||(b&&(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,eY.members),this.indexBuffer=f.createIndexBuffer(this.indexArray,m),this.dynamicLayoutVertexBuffer=f.createVertexBuffer(this.dynamicLayoutVertexArray,rY.members,!0),this.opacityVertexBuffer=f.createVertexBuffer(this.opacityVertexArray,SY,!0),this.opacityVertexBuffer.itemSize=1),(b||A)&&this.programConfigurations.upload(f))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}De("SymbolBuffers",$T);class WT{constructor(f,m,b){this.layoutVertexArray=new f,this.layoutAttributes=m,this.indexArray=new b,this.segments=new vi,this.collisionVertexArray=new ui}upload(f){this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=f.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=f.createVertexBuffer(this.collisionVertexArray,iY.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}De("CollisionBuffers",WT);class Vd{constructor(f){this.collisionBoxArray=f.collisionBoxArray,this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(D=>D.id),this.index=f.index,this.pixelRatio=f.pixelRatio,this.sourceLayerIndex=f.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=xT([]),this.placementViewportMatrix=xT([]);const m=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Rk(this.zoom,m["text-size"]),this.iconSizeData=Rk(this.zoom,m["icon-size"]);const b=this.layers[0].layout,A=b.get("symbol-sort-key"),P=b.get("symbol-z-order");this.canOverlap=VT(b,"text-overlap","text-allow-overlap")!=="never"||VT(b,"icon-overlap","icon-allow-overlap")!=="never"||b.get("text-ignore-placement")||b.get("icon-ignore-placement"),this.sortFeaturesByKey=P!=="viewport-y"&&!A.isConstant(),this.sortFeaturesByY=(P==="viewport-y"||P==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,b.get("symbol-placement")==="point"&&(this.writingModes=b.get("text-writing-mode").map(D=>o.ai[D])),this.stateDependentLayerIds=this.layers.filter(D=>D.isStateDependent()).map(D=>D.id),this.sourceID=f.sourceID}createArrays(){this.text=new $T(new _o(this.layers,this.zoom,f=>/^text/.test(f))),this.icon=new $T(new _o(this.layers,this.zoom,f=>/^icon/.test(f))),this.glyphOffsetArray=new Lt,this.lineVertexArray=new Gt,this.symbolInstances=new St,this.textAnchorOffsets=new ee}calculateGlyphDependencies(f,m,b,A,P){for(let D=0;D<f.length;D++)if(m[f.charCodeAt(D)]=!0,(b||A)&&P){const k=Fv[f.charAt(D)];k&&(m[k.charCodeAt(0)]=!0)}}populate(f,m,b){const A=this.layers[0],P=A.layout,D=P.get("text-font"),k=P.get("text-field"),z=P.get("icon-image"),$=(k.value.kind!=="constant"||k.value.value instanceof pi&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(D.value.kind!=="constant"||D.value.value.length>0),X=z.value.kind!=="constant"||!!z.value.value||Object.keys(z.parameters).length>0,K=P.get("symbol-sort-key");if(this.features=[],!$&&!X)return;const et=m.iconDependencies,at=m.glyphDependencies,ot=m.availableImages,pt=new gi(this.zoom);for(const{feature:bt,id:Ct,index:kt,sourceLayerIndex:It}of f){const Ft=A._featureFilter.needGeometry,Ht=mh(bt,Ft);if(!A._featureFilter.filter(pt,Ht,b))continue;let re,Pe;if(Ft||(Ht.geometry=vh(bt)),$){const Te=A.getValueAndResolveTokens("text-field",Ht,b,ot),be=pi.factory(Te);TY(be)&&(this.hasRTLText=!0),(!this.hasRTLText||mv()==="unavailable"||this.hasRTLText&&Da.isParsed())&&(re=aY(be,A,Ht))}if(X){const Te=A.getValueAndResolveTokens("icon-image",Ht,b,ot);Pe=Te instanceof ii?Te:ii.fromString(Te)}if(!re&&!Pe)continue;const ze=this.sortFeaturesByKey?K.evaluate(Ht,{},b):void 0;if(this.features.push({id:Ct,text:re,icon:Pe,index:kt,sourceLayerIndex:It,geometry:Ht.geometry,properties:bt.properties,type:wY[bt.type],sortKey:ze}),Pe&&(et[Pe.name]=!0),re){const Te=D.evaluate(Ht,{},b).join(","),be=P.get("text-rotation-alignment")!=="viewport"&&P.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.ai.vertical)>=0;for(const pe of re.sections)if(pe.image)et[pe.image.name]=!0;else{const Le=uv(re.toString()),me=pe.fontStack||Te,le=at[me]=at[me]||{};this.calculateGlyphDependencies(pe.text,le,be,this.allowVerticalPlacement,Le)}}}P.get("symbol-placement")==="line"&&(this.features=function(bt){const Ct={},kt={},It=[];let Ft=0;function Ht(Te){It.push(bt[Te]),Ft++}function re(Te,be,pe){const Le=kt[Te];return delete kt[Te],kt[be]=Le,It[Le].geometry[0].pop(),It[Le].geometry[0]=It[Le].geometry[0].concat(pe[0]),Le}function Pe(Te,be,pe){const Le=Ct[be];return delete Ct[be],Ct[Te]=Le,It[Le].geometry[0].shift(),It[Le].geometry[0]=pe[0].concat(It[Le].geometry[0]),Le}function ze(Te,be,pe){const Le=pe?be[0][be[0].length-1]:be[0][0];return`${Te}:${Le.x}:${Le.y}`}for(let Te=0;Te<bt.length;Te++){const be=bt[Te],pe=be.geometry,Le=be.text?be.text.toString():null;if(!Le){Ht(Te);continue}const me=ze(Le,pe),le=ze(Le,pe,!0);if(me in kt&&le in Ct&&kt[me]!==Ct[le]){const Ye=Pe(me,le,pe),$e=re(me,le,It[Ye].geometry);delete Ct[me],delete kt[le],kt[ze(Le,It[$e].geometry,!0)]=$e,It[Ye].geometry=null}else me in kt?re(me,le,pe):le in Ct?Pe(me,le,pe):(Ht(Te),Ct[me]=Ft-1,kt[le]=Ft-1)}return It.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((bt,Ct)=>bt.sortKey-Ct.sortKey)}update(f,m,b){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(f,m,this.layers,b),this.icon.programConfigurations.updatePaintArrays(f,m,this.layers,b))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(f){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(f),this.iconCollisionBox.upload(f)),this.text.upload(f,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(f,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(f,m){const b=this.lineVertexArray.length;if(f.segment!==void 0){let A=f.dist(m[f.segment+1]),P=f.dist(m[f.segment]);const D={};for(let k=f.segment+1;k<m.length;k++)D[k]={x:m[k].x,y:m[k].y,tileUnitDistanceFromAnchor:A},k<m.length-1&&(A+=m[k+1].dist(m[k]));for(let k=f.segment||0;k>=0;k--)D[k]={x:m[k].x,y:m[k].y,tileUnitDistanceFromAnchor:P},k>0&&(P+=m[k-1].dist(m[k]));for(let k=0;k<m.length;k++){const z=D[k];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:b,lineLength:this.lineVertexArray.length-b}}addSymbols(f,m,b,A,P,D,k,z,$,X,K,et){const at=f.indexArray,ot=f.layoutVertexArray,pt=f.segments.prepareSegment(4*m.length,ot,at,this.canOverlap?D.sortKey:void 0),bt=this.glyphOffsetArray.length,Ct=pt.vertexLength,kt=this.allowVerticalPlacement&&k===o.ai.vertical?Math.PI/2:0,It=D.text&&D.text.sections;for(let Ft=0;Ft<m.length;Ft++){const{tl:Ht,tr:re,bl:Pe,br:ze,tex:Te,pixelOffsetTL:be,pixelOffsetBR:pe,minFontScaleX:Le,minFontScaleY:me,glyphOffset:le,isSDF:Ye,sectionIndex:$e}=m[Ft],wr=pt.vertexLength,mi=le[1];B0(ot,z.x,z.y,Ht.x,mi+Ht.y,Te.x,Te.y,b,Ye,be.x,be.y,Le,me),B0(ot,z.x,z.y,re.x,mi+re.y,Te.x+Te.w,Te.y,b,Ye,pe.x,be.y,Le,me),B0(ot,z.x,z.y,Pe.x,mi+Pe.y,Te.x,Te.y+Te.h,b,Ye,be.x,pe.y,Le,me),B0(ot,z.x,z.y,ze.x,mi+ze.y,Te.x+Te.w,Te.y+Te.h,b,Ye,pe.x,pe.y,Le,me),UT(f.dynamicLayoutVertexArray,z,kt),at.emplaceBack(wr,wr+1,wr+2),at.emplaceBack(wr+1,wr+2,wr+3),pt.vertexLength+=4,pt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(le[0]),Ft!==m.length-1&&$e===m[Ft+1].sectionIndex||f.programConfigurations.populatePaintArrays(ot.length,D,D.index,{},et,It&&It[$e])}f.placedSymbolArray.emplaceBack(z.x,z.y,bt,this.glyphOffsetArray.length-bt,Ct,$,X,z.segment,b?b[0]:0,b?b[1]:0,A[0],A[1],k,0,!1,0,K)}_addCollisionDebugVertex(f,m,b,A,P,D){return m.emplaceBack(0,0),f.emplaceBack(b.x,b.y,A,P,Math.round(D.x),Math.round(D.y))}addCollisionDebugVertices(f,m,b,A,P,D,k){const z=P.segments.prepareSegment(4,P.layoutVertexArray,P.indexArray),$=z.vertexLength,X=P.layoutVertexArray,K=P.collisionVertexArray,et=k.anchorX,at=k.anchorY;this._addCollisionDebugVertex(X,K,D,et,at,new p(f,m)),this._addCollisionDebugVertex(X,K,D,et,at,new p(b,m)),this._addCollisionDebugVertex(X,K,D,et,at,new p(b,A)),this._addCollisionDebugVertex(X,K,D,et,at,new p(f,A)),z.vertexLength+=4;const ot=P.indexArray;ot.emplaceBack($,$+1),ot.emplaceBack($+1,$+2),ot.emplaceBack($+2,$+3),ot.emplaceBack($+3,$),z.primitiveLength+=4}addDebugCollisionBoxes(f,m,b,A){for(let P=f;P<m;P++){const D=this.collisionBoxArray.get(P);this.addCollisionDebugVertices(D.x1,D.y1,D.x2,D.y2,A?this.textCollisionBox:this.iconCollisionBox,D.anchorPoint,b)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new WT(Bi,gk.members,on),this.iconCollisionBox=new WT(Bi,gk.members,on);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this.addDebugCollisionBoxes(m.textBoxStartIndex,m.textBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.iconBoxStartIndex,m.iconBoxEndIndex,m,!1),this.addDebugCollisionBoxes(m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m,!1)}}_deserializeCollisionBoxesForSymbol(f,m,b,A,P,D,k,z,$){const X={};for(let K=m;K<b;K++){const et=f.get(K);X.textBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},X.textFeatureIndex=et.featureIndex;break}for(let K=A;K<P;K++){const et=f.get(K);X.verticalTextBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},X.verticalTextFeatureIndex=et.featureIndex;break}for(let K=D;K<k;K++){const et=f.get(K);X.iconBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},X.iconFeatureIndex=et.featureIndex;break}for(let K=z;K<$;K++){const et=f.get(K);X.verticalIconBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},X.verticalIconFeatureIndex=et.featureIndex;break}return X}deserializeCollisionBoxes(f){this.collisionArrays=[];for(let m=0;m<this.symbolInstances.length;m++){const b=this.symbolInstances.get(m);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(f,b.textBoxStartIndex,b.textBoxEndIndex,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b.iconBoxStartIndex,b.iconBoxEndIndex,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(f,m){const b=f.placedSymbolArray.get(m),A=b.vertexStartIndex+4*b.numGlyphs;for(let P=b.vertexStartIndex;P<A;P+=4)f.indexArray.emplaceBack(P,P+1,P+2),f.indexArray.emplaceBack(P+1,P+2,P+3)}getSortedSymbolIndexes(f){if(this.sortedAngle===f&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const m=Math.sin(f),b=Math.cos(f),A=[],P=[],D=[];for(let k=0;k<this.symbolInstances.length;++k){D.push(k);const z=this.symbolInstances.get(k);A.push(0|Math.round(m*z.anchorX+b*z.anchorY)),P.push(z.featureIndex)}return D.sort((k,z)=>A[k]-A[z]||P[z]-P[k]),D}addToSortKeyRanges(f,m){const b=this.sortKeyRanges[this.sortKeyRanges.length-1];b&&b.sortKey===m?b.symbolInstanceEnd=f+1:this.sortKeyRanges.push({sortKey:m,symbolInstanceStart:f,symbolInstanceEnd:f+1})}sortFeatures(f){if(this.sortFeaturesByY&&this.sortedAngle!==f&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(f),this.sortedAngle=f,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const m of this.symbolInstanceIndexes){const b=this.symbolInstances.get(m);this.featureSortOrder.push(b.featureIndex),[b.rightJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.leftJustifiedTextSymbolIndex].forEach((A,P,D)=>{A>=0&&D.indexOf(A)===P&&this.addIndicesForPlacedSymbol(this.text,A)}),b.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,b.verticalPlacedTextSymbolIndex),b.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.placedIconSymbolIndex),b.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Dk,Lk;De("SymbolBucket",Vd,{omit:["layers","collisionBoxArray","features","compareText"]}),Vd.MAX_GLYPHS=65535,Vd.addDynamicAttributes=UT;var HT={get paint(){return Lk=Lk||new Gi({"icon-opacity":new er(qt.paint_symbol["icon-opacity"]),"icon-color":new er(qt.paint_symbol["icon-color"]),"icon-halo-color":new er(qt.paint_symbol["icon-halo-color"]),"icon-halo-width":new er(qt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new er(qt.paint_symbol["icon-halo-blur"]),"icon-translate":new He(qt.paint_symbol["icon-translate"]),"icon-translate-anchor":new He(qt.paint_symbol["icon-translate-anchor"]),"text-opacity":new er(qt.paint_symbol["text-opacity"]),"text-color":new er(qt.paint_symbol["text-color"],{runtimeType:Sn,getOverride:g=>g.textColor,hasOverride:g=>!!g.textColor}),"text-halo-color":new er(qt.paint_symbol["text-halo-color"]),"text-halo-width":new er(qt.paint_symbol["text-halo-width"]),"text-halo-blur":new er(qt.paint_symbol["text-halo-blur"]),"text-translate":new He(qt.paint_symbol["text-translate"]),"text-translate-anchor":new He(qt.paint_symbol["text-translate-anchor"])})},get layout(){return Dk=Dk||new Gi({"symbol-placement":new He(qt.layout_symbol["symbol-placement"]),"symbol-spacing":new He(qt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new He(qt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new er(qt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new He(qt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new He(qt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new He(qt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new He(qt.layout_symbol["icon-ignore-placement"]),"icon-optional":new He(qt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new He(qt.layout_symbol["icon-rotation-alignment"]),"icon-size":new er(qt.layout_symbol["icon-size"]),"icon-text-fit":new He(qt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new He(qt.layout_symbol["icon-text-fit-padding"]),"icon-image":new er(qt.layout_symbol["icon-image"]),"icon-rotate":new er(qt.layout_symbol["icon-rotate"]),"icon-padding":new er(qt.layout_symbol["icon-padding"]),"icon-keep-upright":new He(qt.layout_symbol["icon-keep-upright"]),"icon-offset":new er(qt.layout_symbol["icon-offset"]),"icon-anchor":new er(qt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new He(qt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new He(qt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new He(qt.layout_symbol["text-rotation-alignment"]),"text-field":new er(qt.layout_symbol["text-field"]),"text-font":new er(qt.layout_symbol["text-font"]),"text-size":new er(qt.layout_symbol["text-size"]),"text-max-width":new er(qt.layout_symbol["text-max-width"]),"text-line-height":new He(qt.layout_symbol["text-line-height"]),"text-letter-spacing":new er(qt.layout_symbol["text-letter-spacing"]),"text-justify":new er(qt.layout_symbol["text-justify"]),"text-radial-offset":new er(qt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new He(qt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new er(qt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new er(qt.layout_symbol["text-anchor"]),"text-max-angle":new He(qt.layout_symbol["text-max-angle"]),"text-writing-mode":new He(qt.layout_symbol["text-writing-mode"]),"text-rotate":new er(qt.layout_symbol["text-rotate"]),"text-padding":new He(qt.layout_symbol["text-padding"]),"text-keep-upright":new He(qt.layout_symbol["text-keep-upright"]),"text-transform":new er(qt.layout_symbol["text-transform"]),"text-offset":new er(qt.layout_symbol["text-offset"]),"text-allow-overlap":new He(qt.layout_symbol["text-allow-overlap"]),"text-overlap":new He(qt.layout_symbol["text-overlap"]),"text-ignore-placement":new He(qt.layout_symbol["text-ignore-placement"]),"text-optional":new He(qt.layout_symbol["text-optional"])})}};class kk{constructor(f){if(f.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=f.property.overrides?f.property.overrides.runtimeType:vs,this.defaultValue=f}evaluate(f){if(f.formattedSection){const m=this.defaultValue.property.overrides;if(m&&m.hasOverride(f.formattedSection))return m.getOverride(f.formattedSection)}return f.feature&&f.featureState?this.defaultValue.evaluate(f.feature,f.featureState):this.defaultValue.property.specification.default}eachChild(f){this.defaultValue.isConstant()||f(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}De("FormatSectionOverride",kk,{omit:["defaultValue"]});class z0 extends is{constructor(f){super(f,HT)}recalculate(f,m){if(super.recalculate(f,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const b=this.layout.get("text-writing-mode");if(b){const A=[];for(const P of b)A.indexOf(P)<0&&A.push(P);this.layout._values["text-writing-mode"]=A}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(f,m,b,A){const P=this.layout.get(f).evaluate(m,{},b,A),D=this._unevaluatedLayout._values[f];return D.isDataDriven()||xd(D.value)||!P?P:function(k,z){return z.replace(/{([^{}]+)}/g,($,X)=>k&&X in k?String(k[X]):"")}(m.properties,P)}createBucket(f){return new Vd(f)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const f of HT.paint.overridableProperties){if(!z0.hasPaintOverride(this.layout,f))continue;const m=this.paint.get(f),b=new kk(m),A=new iv(b,m.property.specification);let P=null;P=m.value.kind==="constant"||m.value.kind==="source"?new nv("source",A):new wd("composite",A,m.value.zoomStops),this.paint._values[f]=new Hn(m.property,P,m.parameters)}}_handleOverridablePaintPropertyUpdate(f,m,b){return!(!this.layout||m.isDataDriven()||b.isDataDriven())&&z0.hasPaintOverride(this.layout,f)}static hasPaintOverride(f,m){const b=f.get("text-field"),A=HT.paint.properties[m];let P=!1;const D=k=>{for(const z of k)if(A.overrides&&A.overrides.hasOverride(z))return void(P=!0)};if(b.value.kind==="constant"&&b.value.value instanceof pi)D(b.value.value.sections);else if(b.value.kind==="source"){const k=$=>{P||($ instanceof ms&&si($.value)===yt?D($.value.sections):$ instanceof _d?D($.sections):$.eachChild(k))},z=b.value;z._styleExpression&&k(z._styleExpression.expression)}return P}}let Ok;var AY={get paint(){return Ok=Ok||new Gi({"background-color":new He(qt.paint_background["background-color"]),"background-pattern":new _v(qt.paint_background["background-pattern"]),"background-opacity":new He(qt.paint_background["background-opacity"])})}};class CY extends is{constructor(f){super(f,AY)}}let Nk;var EY={get paint(){return Nk=Nk||new Gi({"raster-opacity":new He(qt.paint_raster["raster-opacity"]),"raster-hue-rotate":new He(qt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new He(qt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new He(qt.paint_raster["raster-brightness-max"]),"raster-saturation":new He(qt.paint_raster["raster-saturation"]),"raster-contrast":new He(qt.paint_raster["raster-contrast"]),"raster-resampling":new He(qt.paint_raster["raster-resampling"]),"raster-fade-duration":new He(qt.paint_raster["raster-fade-duration"])})}};class IY extends is{constructor(f){super(f,EY)}}class MY extends is{constructor(f){super(f,{}),this.onAdd=m=>{this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},this.onRemove=m=>{this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},this.implementation=f}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class PY{constructor(f){this._callback=f,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const GT=63710088e-1;class Uu{constructor(f,m){if(isNaN(f)||isNaN(m))throw new Error(`Invalid LngLat object: (${f}, ${m})`);if(this.lng=+f,this.lat=+m,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Uu(U(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(f){const m=Math.PI/180,b=this.lat*m,A=f.lat*m,P=Math.sin(b)*Math.sin(A)+Math.cos(b)*Math.cos(A)*Math.cos((f.lng-this.lng)*m);return GT*Math.acos(Math.min(P,1))}static convert(f){if(f instanceof Uu)return f;if(Array.isArray(f)&&(f.length===2||f.length===3))return new Uu(Number(f[0]),Number(f[1]));if(!Array.isArray(f)&&typeof f=="object"&&f!==null)return new Uu(Number("lng"in f?f.lng:f.lon),Number(f.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Fk=2*Math.PI*GT;function Bk(g){return Fk*Math.cos(g*Math.PI/180)}function zk(g){return(180+g)/360}function Vk(g){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g*Math.PI/360)))/360}function Uk(g,f){return g/Bk(f)}function $k(g){return 360*g-180}function jT(g){return 360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90}class V0{constructor(f,m,b=0){this.x=+f,this.y=+m,this.z=+b}static fromLngLat(f,m=0){const b=Uu.convert(f);return new V0(zk(b.lng),Vk(b.lat),Uk(m,b.lat))}toLngLat(){return new Uu($k(this.x),jT(this.y))}toAltitude(){return this.z*Bk(jT(this.y))}meterInMercatorCoordinateUnits(){return 1/Fk*(f=jT(this.y),1/Math.cos(f*Math.PI/180));var f}}function Wk(g,f,m){var b=2*Math.PI*6378137/256/Math.pow(2,m);return[g*b-2*Math.PI*6378137/2,f*b-2*Math.PI*6378137/2]}class XT{constructor(f,m,b){if(f<0||f>25||b<0||b>=Math.pow(2,f)||m<0||m>=Math.pow(2,f))throw new Error(`x=${m}, y=${b}, z=${f} outside of bounds. 0<=x<${Math.pow(2,f)}, 0<=y<${Math.pow(2,f)} 0<=z<=25 `);this.z=f,this.x=m,this.y=b,this.key=Uv(0,f,f,m,b)}equals(f){return this.z===f.z&&this.x===f.x&&this.y===f.y}url(f,m,b){const A=(D=this.y,k=this.z,z=Wk(256*(P=this.x),256*(D=Math.pow(2,k)-D-1),k),$=Wk(256*(P+1),256*(D+1),k),z[0]+","+z[1]+","+$[0]+","+$[1]);var P,D,k,z,$;const X=function(K,et,at){let ot,pt="";for(let bt=K;bt>0;bt--)ot=1<<bt-1,pt+=(et&ot?1:0)+(at&ot?2:0);return pt}(this.z,this.x,this.y);return f[(this.x+this.y)%f.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(b==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,m>1?"@2x":"").replace(/{quadkey}/g,X).replace(/{bbox-epsg-3857}/g,A)}isChildOf(f){const m=this.z-f.z;return m>0&&f.x===this.x>>m&&f.y===this.y>>m}getTilePoint(f){const m=Math.pow(2,this.z);return new p((f.x*m-this.x)*Ji,(f.y*m-this.y)*Ji)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hk{constructor(f,m){this.wrap=f,this.canonical=m,this.key=Uv(f,m.z,m.z,m.x,m.y)}}class _s{constructor(f,m,b,A,P){if(f<b)throw new Error(`overscaledZ should be >= z; overscaledZ = ${f}; z = ${b}`);this.overscaledZ=f,this.wrap=m,this.canonical=new XT(b,+A,+P),this.key=Uv(m,f,b,A,P)}clone(){return new _s(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(f){return this.overscaledZ===f.overscaledZ&&this.wrap===f.wrap&&this.canonical.equals(f.canonical)}scaledTo(f){if(f>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${f}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-f;return f>this.canonical.z?new _s(f,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _s(f,this.wrap,f,this.canonical.x>>m,this.canonical.y>>m)}calculateScaledKey(f,m){if(f>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${f}; overscaledZ = ${this.overscaledZ}`);const b=this.canonical.z-f;return f>this.canonical.z?Uv(this.wrap*+m,f,this.canonical.z,this.canonical.x,this.canonical.y):Uv(this.wrap*+m,f,f,this.canonical.x>>b,this.canonical.y>>b)}isChildOf(f){if(f.wrap!==this.wrap)return!1;const m=this.canonical.z-f.canonical.z;return f.overscaledZ===0||f.overscaledZ<this.overscaledZ&&f.canonical.x===this.canonical.x>>m&&f.canonical.y===this.canonical.y>>m}children(f){if(this.overscaledZ>=f)return[new _s(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const m=this.canonical.z+1,b=2*this.canonical.x,A=2*this.canonical.y;return[new _s(m,this.wrap,m,b,A),new _s(m,this.wrap,m,b+1,A),new _s(m,this.wrap,m,b,A+1),new _s(m,this.wrap,m,b+1,A+1)]}isLessThan(f){return this.wrap<f.wrap||!(this.wrap>f.wrap)&&(this.overscaledZ<f.overscaledZ||!(this.overscaledZ>f.overscaledZ)&&(this.canonical.x<f.canonical.x||!(this.canonical.x>f.canonical.x)&&this.canonical.y<f.canonical.y))}wrapped(){return new _s(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(f){return new _s(this.overscaledZ,f,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hk(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(f){return this.canonical.getTilePoint(new V0(f.x-this.wrap,f.y))}}function Uv(g,f,m,b,A){(g*=2)<0&&(g=-1*g-1);const P=1<<m;return(P*P*g+P*A+b).toString(36)+m.toString(36)+f.toString(36)}De("CanonicalTileID",XT),De("OverscaledTileID",_s,{omit:["posMatrix"]});class Gk{constructor(f,m,b,A=1,P=1,D=1,k=0){if(this.uid=f,m.height!==m.width)throw new RangeError("DEM tiles must be square");if(b&&!["mapbox","terrarium","custom"].includes(b))return void lt(`"${b}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=m.height;const z=this.dim=m.height-2;switch(this.data=new Uint32Array(m.data.buffer),b){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=A,this.greenFactor=P,this.blueFactor=D,this.baseShift=k;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let $=0;$<z;$++)this.data[this._idx(-1,$)]=this.data[this._idx(0,$)],this.data[this._idx(z,$)]=this.data[this._idx(z-1,$)],this.data[this._idx($,-1)]=this.data[this._idx($,0)],this.data[this._idx($,z)]=this.data[this._idx($,z-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(z,-1)]=this.data[this._idx(z-1,0)],this.data[this._idx(-1,z)]=this.data[this._idx(0,z-1)],this.data[this._idx(z,z)]=this.data[this._idx(z-1,z-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let $=0;$<z;$++)for(let X=0;X<z;X++){const K=this.get($,X);K>this.max&&(this.max=K),K<this.min&&(this.min=K)}}get(f,m){const b=new Uint8Array(this.data.buffer),A=4*this._idx(f,m);return this.unpack(b[A],b[A+1],b[A+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(f,m){if(f<-1||f>=this.dim+1||m<-1||m>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(m+1)*this.stride+(f+1)}unpack(f,m,b){return f*this.redFactor+m*this.greenFactor+b*this.blueFactor-this.baseShift}getPixels(){return new ys({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(f,m,b){if(this.dim!==f.dim)throw new Error("dem dimension mismatch");let A=m*this.dim,P=m*this.dim+this.dim,D=b*this.dim,k=b*this.dim+this.dim;switch(m){case-1:A=P-1;break;case 1:P=A+1}switch(b){case-1:D=k-1;break;case 1:k=D+1}const z=-m*this.dim,$=-b*this.dim;for(let X=D;X<k;X++)for(let K=A;K<P;K++)this.data[this._idx(K,X)]=f.data[this._idx(K+z,X+$)]}}De("DEMData",Gk);class jk{constructor(f){this._stringToNumber={},this._numberToString=[];for(let m=0;m<f.length;m++){const b=f[m];this._stringToNumber[b]=m,this._numberToString[m]=b}}encode(f){return this._stringToNumber[f]}decode(f){if(f>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${f} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[f]}}class Xk{constructor(f,m,b,A,P){this.type="Feature",this._vectorTileFeature=f,f._z=m,f._x=b,f._y=A,this.properties=f.properties,this.id=P}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(f){this._geometry=f}toJSON(){const f={geometry:this.geometry};for(const m in this)m!=="_geometry"&&m!=="_vectorTileFeature"&&(f[m]=this[m]);return f}}class Zk{constructor(f,m){this.tileID=f,this.x=f.canonical.x,this.y=f.canonical.y,this.z=f.canonical.z,this.grid=new Lu(Ji,16,0),this.grid3D=new Lu(Ji,16,0),this.featureIndexArray=new ae,this.promoteId=m}insert(f,m,b,A,P,D){const k=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(b,A,P);const z=D?this.grid3D:this.grid;for(let $=0;$<m.length;$++){const X=m[$],K=[1/0,1/0,-1/0,-1/0];for(let et=0;et<X.length;et++){const at=X[et];K[0]=Math.min(K[0],at.x),K[1]=Math.min(K[1],at.y),K[2]=Math.max(K[2],at.x),K[3]=Math.max(K[3],at.y)}K[0]<Ji&&K[1]<Ji&&K[2]>=0&&K[3]>=0&&z.insert(k,K[0],K[1],K[2],K[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Bu.VectorTile(new OT(this.rawTileData)).layers,this.sourceLayerCoder=new jk(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(f,m,b,A){this.loadVTLayers();const P=f.params||{},D=Ji/f.tileSize/f.scale,k=sv(P.filter),z=f.queryGeometry,$=f.queryPadding*D,X=Yk(z),K=this.grid.query(X.minX-$,X.minY-$,X.maxX+$,X.maxY+$),et=Yk(f.cameraQueryGeometry),at=this.grid3D.query(et.minX-$,et.minY-$,et.maxX+$,et.maxY+$,(bt,Ct,kt,It)=>function(Ft,Ht,re,Pe,ze){for(const be of Ft)if(Ht<=be.x&&re<=be.y&&Pe>=be.x&&ze>=be.y)return!0;const Te=[new p(Ht,re),new p(Ht,ze),new p(Pe,ze),new p(Pe,re)];if(Ft.length>2){for(const be of Te)if(Ld(Ft,be))return!0}for(let be=0;be<Ft.length-1;be++)if(lq(Ft[be],Ft[be+1],Te))return!0;return!1}(f.cameraQueryGeometry,bt-$,Ct-$,kt+$,It+$));for(const bt of at)K.push(bt);K.sort(RY);const ot={};let pt;for(let bt=0;bt<K.length;bt++){const Ct=K[bt];if(Ct===pt)continue;pt=Ct;const kt=this.featureIndexArray.get(Ct);let It=null;this.loadMatchingFeature(ot,kt.bucketIndex,kt.sourceLayerIndex,kt.featureIndex,k,P.layers,P.availableImages,m,b,A,(Ft,Ht,re)=>(It||(It=vh(Ft)),Ht.queryIntersectsFeature(z,Ft,re,It,this.z,f.transform,D,f.pixelPosMatrix)))}return ot}loadMatchingFeature(f,m,b,A,P,D,k,z,$,X,K){const et=this.bucketLayerIDs[m];if(D&&!function(bt,Ct){for(let kt=0;kt<bt.length;kt++)if(Ct.indexOf(bt[kt])>=0)return!0;return!1}(D,et))return;const at=this.sourceLayerCoder.decode(b),ot=this.vtLayers[at].feature(A);if(P.needGeometry){const bt=mh(ot,!0);if(!P.filter(new gi(this.tileID.overscaledZ),bt,this.tileID.canonical))return}else if(!P.filter(new gi(this.tileID.overscaledZ),ot))return;const pt=this.getId(ot,at);for(let bt=0;bt<et.length;bt++){const Ct=et[bt];if(D&&D.indexOf(Ct)<0)continue;const kt=z[Ct];if(!kt)continue;let It={};pt&&X&&(It=X.getState(kt.sourceLayer||"_geojsonTileLayer",pt));const Ft=W({},$[Ct]);Ft.paint=qk(Ft.paint,kt.paint,ot,It,k),Ft.layout=qk(Ft.layout,kt.layout,ot,It,k);const Ht=!K||K(ot,kt,It);if(!Ht)continue;const re=new Xk(ot,this.z,this.x,this.y,pt);re.layer=Ft;let Pe=f[Ct];Pe===void 0&&(Pe=f[Ct]=[]),Pe.push({featureIndex:A,feature:re,intersectionZ:Ht})}}lookupSymbolFeatures(f,m,b,A,P,D,k,z){const $={};this.loadVTLayers();const X=sv(P);for(const K of f)this.loadMatchingFeature($,b,A,K,X,D,k,z,m);return $}hasLayer(f){for(const m of this.bucketLayerIDs)for(const b of m)if(f===b)return!0;return!1}getId(f,m){let b=f.id;return this.promoteId&&(b=f.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[m]],typeof b=="boolean"&&(b=Number(b))),b}}function qk(g,f,m,b,A){return j(g,(P,D)=>{const k=f instanceof Rd?f.get(D):null;return k&&k.evaluate?k.evaluate(m,b,A):k})}function Yk(g){let f=1/0,m=1/0,b=-1/0,A=-1/0;for(const P of g)f=Math.min(f,P.x),m=Math.min(m,P.y),b=Math.max(b,P.x),A=Math.max(A,P.y);return{minX:f,minY:m,maxX:b,maxY:A}}function RY(g,f){return f-g}function Kk(g,f,m,b,A){const P=[];for(let D=0;D<g.length;D++){const k=g[D];let z;for(let $=0;$<k.length-1;$++){let X=k[$],K=k[$+1];X.x<f&&K.x<f||(X.x<f?X=new p(f,X.y+(f-X.x)/(K.x-X.x)*(K.y-X.y))._round():K.x<f&&(K=new p(f,X.y+(f-X.x)/(K.x-X.x)*(K.y-X.y))._round()),X.y<m&&K.y<m||(X.y<m?X=new p(X.x+(m-X.y)/(K.y-X.y)*(K.x-X.x),m)._round():K.y<m&&(K=new p(X.x+(m-X.y)/(K.y-X.y)*(K.x-X.x),m)._round()),X.x>=b&&K.x>=b||(X.x>=b?X=new p(b,X.y+(b-X.x)/(K.x-X.x)*(K.y-X.y))._round():K.x>=b&&(K=new p(b,X.y+(b-X.x)/(K.x-X.x)*(K.y-X.y))._round()),X.y>=A&&K.y>=A||(X.y>=A?X=new p(X.x+(A-X.y)/(K.y-X.y)*(K.x-X.x),A)._round():K.y>=A&&(K=new p(X.x+(A-X.y)/(K.y-X.y)*(K.x-X.x),A)._round()),z&&X.equals(z[z.length-1])||(z=[X],P.push(z)),z.push(K)))))}}return P}De("FeatureIndex",Zk,{omit:["rawTileData","sourceLayerCoder"]});class $u extends p{constructor(f,m,b,A){super(f,m),this.angle=b,A!==void 0&&(this.segment=A)}clone(){return new $u(this.x,this.y,this.angle,this.segment)}}function Jk(g,f,m,b,A){if(f.segment===void 0||m===0)return!0;let P=f,D=f.segment+1,k=0;for(;k>-m/2;){if(D--,D<0)return!1;k-=g[D].dist(P),P=g[D]}k+=g[D].dist(g[D+1]),D++;const z=[];let $=0;for(;k<m/2;){const X=g[D],K=g[D+1];if(!K)return!1;let et=g[D-1].angleTo(X)-X.angleTo(K);for(et=Math.abs((et+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:k,angleDelta:et}),$+=et;k-z[0].distance>b;)$-=z.shift().angleDelta;if($>A)return!1;D++,k+=X.dist(K)}return!0}function Qk(g){let f=0;for(let m=0;m<g.length-1;m++)f+=g[m].dist(g[m+1]);return f}function t3(g,f,m){return g?.6*f*m:0}function e3(g,f){return Math.max(g?g.right-g.left:0,f?f.right-f.left:0)}function DY(g,f,m,b,A,P){const D=t3(m,A,P),k=e3(m,b)*P;let z=0;const $=Qk(g)/2;for(let X=0;X<g.length-1;X++){const K=g[X],et=g[X+1],at=K.dist(et);if(z+at>$){const ot=($-z)/at,pt=Ma.number(K.x,et.x,ot),bt=Ma.number(K.y,et.y,ot),Ct=new $u(pt,bt,et.angleTo(K),X);return Ct._round(),!D||Jk(g,Ct,k,D,f)?Ct:void 0}z+=at}}function LY(g,f,m,b,A,P,D,k,z){const $=t3(b,P,D),X=e3(b,A),K=X*D,et=g[0].x===0||g[0].x===z||g[0].y===0||g[0].y===z;return f-K<f/4&&(f=K+f/4),r3(g,et?f/2*k%f:(X/2+2*P)*D*k%f,f,$,m,K,et,!1,z)}function r3(g,f,m,b,A,P,D,k,z){const $=P/2,X=Qk(g);let K=0,et=f-m,at=[];for(let ot=0;ot<g.length-1;ot++){const pt=g[ot],bt=g[ot+1],Ct=pt.dist(bt),kt=bt.angleTo(pt);for(;et+m<K+Ct;){et+=m;const It=(et-K)/Ct,Ft=Ma.number(pt.x,bt.x,It),Ht=Ma.number(pt.y,bt.y,It);if(Ft>=0&&Ft<z&&Ht>=0&&Ht<z&&et-$>=0&&et+$<=X){const re=new $u(Ft,Ht,kt,ot);re._round(),b&&!Jk(g,re,P,b,A)||at.push(re)}}K+=Ct}return k||at.length||D||(at=r3(g,K/2,m,b,A,P,D,!0,z)),at}De("Anchor",$u);const Ud=ka;function i3(g,f,m,b){const A=[],P=g.image,D=P.pixelRatio,k=P.paddedRect.w-2*Ud,z=P.paddedRect.h-2*Ud,$=g.right-g.left,X=g.bottom-g.top,K=P.stretchX||[[0,k]],et=P.stretchY||[[0,z]],at=(pe,Le)=>pe+Le[1]-Le[0],ot=K.reduce(at,0),pt=et.reduce(at,0),bt=k-ot,Ct=z-pt;let kt=0,It=ot,Ft=0,Ht=pt,re=0,Pe=bt,ze=0,Te=Ct;if(P.content&&b){const pe=P.content;kt=U0(K,0,pe[0]),Ft=U0(et,0,pe[1]),It=U0(K,pe[0],pe[2]),Ht=U0(et,pe[1],pe[3]),re=pe[0]-kt,ze=pe[1]-Ft,Pe=pe[2]-pe[0]-It,Te=pe[3]-pe[1]-Ht}const be=(pe,Le,me,le)=>{const Ye=$0(pe.stretch-kt,It,$,g.left),$e=W0(pe.fixed-re,Pe,pe.stretch,ot),wr=$0(Le.stretch-Ft,Ht,X,g.top),mi=W0(Le.fixed-ze,Te,Le.stretch,pt),Ai=$0(me.stretch-kt,It,$,g.left),cn=W0(me.fixed-re,Pe,me.stretch,ot),as=$0(le.stretch-Ft,Ht,X,g.top),ha=W0(le.fixed-ze,Te,le.stretch,pt),Qi=new p(Ye,wr),In=new p(Ai,wr),Fn=new p(Ai,as),fa=new p(Ye,as),da=new p($e/D,mi/D),hn=new p(cn/D,ha/D),fn=f*Math.PI/180;if(fn){const Xn=Math.sin(fn),Oa=Math.cos(fn),Na=[Oa,-Xn,Xn,Oa];Qi._matMult(Na),In._matMult(Na),fa._matMult(Na),Fn._matMult(Na)}const jn=pe.stretch+pe.fixed,pa=Le.stretch+Le.fixed;return{tl:Qi,tr:In,bl:fa,br:Fn,tex:{x:P.paddedRect.x+Ud+jn,y:P.paddedRect.y+Ud+pa,w:me.stretch+me.fixed-jn,h:le.stretch+le.fixed-pa},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:da,pixelOffsetBR:hn,minFontScaleX:Pe/D/$,minFontScaleY:Te/D/X,isSDF:m}};if(b&&(P.stretchX||P.stretchY)){const pe=n3(K,bt,ot),Le=n3(et,Ct,pt);for(let me=0;me<pe.length-1;me++){const le=pe[me],Ye=pe[me+1];for(let $e=0;$e<Le.length-1;$e++)A.push(be(le,Le[$e],Ye,Le[$e+1]))}}else A.push(be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:z+1}));return A}function U0(g,f,m){let b=0;for(const A of g)b+=Math.max(f,Math.min(m,A[1]))-Math.max(f,Math.min(m,A[0]));return b}function n3(g,f,m){const b=[{fixed:-Ud,stretch:0}];for(const[A,P]of g){const D=b[b.length-1];b.push({fixed:A-D.stretch,stretch:D.stretch}),b.push({fixed:A-D.stretch,stretch:D.stretch+(P-A)})}return b.push({fixed:f+Ud,stretch:m}),b}function $0(g,f,m,b){return g/f*m+b}function W0(g,f,m,b){return g-f*m/b}class H0{constructor(f,m,b,A,P,D,k,z,$,X){if(this.boxStartIndex=f.length,$){let K=D.top,et=D.bottom;const at=D.collisionPadding;at&&(K-=at[1],et+=at[3]);let ot=et-K;ot>0&&(ot=Math.max(10,ot),this.circleDiameter=ot)}else{let K=D.top*k-z[0],et=D.bottom*k+z[2],at=D.left*k-z[3],ot=D.right*k+z[1];const pt=D.collisionPadding;if(pt&&(at-=pt[0]*k,K-=pt[1]*k,ot+=pt[2]*k,et+=pt[3]*k),X){const bt=new p(at,K),Ct=new p(ot,K),kt=new p(at,et),It=new p(ot,et),Ft=X*Math.PI/180;bt._rotate(Ft),Ct._rotate(Ft),kt._rotate(Ft),It._rotate(Ft),at=Math.min(bt.x,Ct.x,kt.x,It.x),ot=Math.max(bt.x,Ct.x,kt.x,It.x),K=Math.min(bt.y,Ct.y,kt.y,It.y),et=Math.max(bt.y,Ct.y,kt.y,It.y)}f.emplaceBack(m.x,m.y,at,K,ot,et,b,A,P)}this.boxEndIndex=f.length}}class kY{constructor(f=[],m=OY){if(this.data=f,this.length=this.data.length,this.compare=m,this.length>0)for(let b=(this.length>>1)-1;b>=0;b--)this._down(b)}push(f){this.data.push(f),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const f=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),f}peek(){return this.data[0]}_up(f){const{data:m,compare:b}=this,A=m[f];for(;f>0;){const P=f-1>>1,D=m[P];if(b(A,D)>=0)break;m[f]=D,f=P}m[f]=A}_down(f){const{data:m,compare:b}=this,A=this.length>>1,P=m[f];for(;f<A;){let D=1+(f<<1),k=m[D];const z=D+1;if(z<this.length&&b(m[z],k)<0&&(D=z,k=m[z]),b(k,P)>=0)break;m[f]=k,f=D}m[f]=P}}function OY(g,f){return g<f?-1:g>f?1:0}function NY(g,f=1,m=!1){let b=1/0,A=1/0,P=-1/0,D=-1/0;const k=g[0];for(let at=0;at<k.length;at++){const ot=k[at];(!at||ot.x<b)&&(b=ot.x),(!at||ot.y<A)&&(A=ot.y),(!at||ot.x>P)&&(P=ot.x),(!at||ot.y>D)&&(D=ot.y)}const z=Math.min(P-b,D-A);let $=z/2;const X=new kY([],FY);if(z===0)return new p(b,A);for(let at=b;at<P;at+=z)for(let ot=A;ot<D;ot+=z)X.push(new $d(at+$,ot+$,$,g));let K=function(at){let ot=0,pt=0,bt=0;const Ct=at[0];for(let kt=0,It=Ct.length,Ft=It-1;kt<It;Ft=kt++){const Ht=Ct[kt],re=Ct[Ft],Pe=Ht.x*re.y-re.x*Ht.y;pt+=(Ht.x+re.x)*Pe,bt+=(Ht.y+re.y)*Pe,ot+=3*Pe}return new $d(pt/ot,bt/ot,0,at)}(g),et=X.length;for(;X.length;){const at=X.pop();(at.d>K.d||!K.d)&&(K=at,m&&console.log("found best %d after %d probes",Math.round(1e4*at.d)/1e4,et)),at.max-K.d<=f||($=at.h/2,X.push(new $d(at.p.x-$,at.p.y-$,$,g)),X.push(new $d(at.p.x+$,at.p.y-$,$,g)),X.push(new $d(at.p.x-$,at.p.y+$,$,g)),X.push(new $d(at.p.x+$,at.p.y+$,$,g)),et+=4)}return m&&(console.log(`num probes: ${et}`),console.log(`best distance: ${K.d}`)),K.p}function FY(g,f){return f.max-g.max}function $d(g,f,m,b){this.p=new p(g,f),this.h=m,this.d=function(A,P){let D=!1,k=1/0;for(let z=0;z<P.length;z++){const $=P[z];for(let X=0,K=$.length,et=K-1;X<K;et=X++){const at=$[X],ot=$[et];at.y>A.y!=ot.y>A.y&&A.x<(ot.x-at.x)*(A.y-at.y)/(ot.y-at.y)+at.x&&(D=!D),k=Math.min(k,VL(A,at,ot))}}return(D?1:-1)*Math.sqrt(k)}(this.p,b),this.max=this.d+this.h*Math.SQRT2}var Nn;o.aq=void 0,(Nn=o.aq||(o.aq={}))[Nn.center=1]="center",Nn[Nn.left=2]="left",Nn[Nn.right=3]="right",Nn[Nn.top=4]="top",Nn[Nn.bottom=5]="bottom",Nn[Nn["top-left"]=6]="top-left",Nn[Nn["top-right"]=7]="top-right",Nn[Nn["bottom-left"]=8]="bottom-left",Nn[Nn["bottom-right"]=9]="bottom-right";const Wu=7,ZT=Number.POSITIVE_INFINITY;function a3(g,f){return f[1]!==ZT?function(m,b,A){let P=0,D=0;switch(b=Math.abs(b),A=Math.abs(A),m){case"top-right":case"top-left":case"top":D=A-Wu;break;case"bottom-right":case"bottom-left":case"bottom":D=-A+Wu}switch(m){case"top-right":case"bottom-right":case"right":P=-b;break;case"top-left":case"bottom-left":case"left":P=b}return[P,D]}(g,f[0],f[1]):function(m,b){let A=0,P=0;b<0&&(b=0);const D=b/Math.SQRT2;switch(m){case"top-right":case"top-left":P=D-Wu;break;case"bottom-right":case"bottom-left":P=-D+Wu;break;case"bottom":P=-b+Wu;break;case"top":P=b-Wu}switch(m){case"top-right":case"bottom-right":A=-D;break;case"top-left":case"bottom-left":A=D;break;case"left":A=b;break;case"right":A=-b}return[A,P]}(g,f[0])}function s3(g,f,m){var b;const A=g.layout,P=(b=A.get("text-variable-anchor-offset"))===null||b===void 0?void 0:b.evaluate(f,{},m);if(P){const k=P.values,z=[];for(let $=0;$<k.length;$+=2){const X=z[$]=k[$],K=k[$+1].map(et=>et*un);X.startsWith("top")?K[1]-=Wu:X.startsWith("bottom")&&(K[1]+=Wu),z[$+1]=K}return new Tn(z)}const D=A.get("text-variable-anchor");if(D){let k;k=g._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[A.get("text-radial-offset").evaluate(f,{},m)*un,ZT]:A.get("text-offset").evaluate(f,{},m).map($=>$*un);const z=[];for(const $ of D)z.push($,a3($,k));return new Tn(z)}return null}function qT(g){switch(g){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function BY(g,f,m,b,A,P,D,k,z,$,X){let K=P.textMaxSize.evaluate(f,{});K===void 0&&(K=D);const et=g.layers[0].layout,at=et.get("icon-offset").evaluate(f,{},X),ot=l3(m.horizontal),pt=D/24,bt=g.tilePixelRatio*pt,Ct=g.tilePixelRatio*K/24,kt=g.tilePixelRatio*k,It=g.tilePixelRatio*et.get("symbol-spacing"),Ft=et.get("text-padding")*g.tilePixelRatio,Ht=function(le,Ye,$e,wr=1){const mi=le.get("icon-padding").evaluate(Ye,{},$e),Ai=mi&&mi.values;return[Ai[0]*wr,Ai[1]*wr,Ai[2]*wr,Ai[3]*wr]}(et,f,X,g.tilePixelRatio),re=et.get("text-max-angle")/180*Math.PI,Pe=et.get("text-rotation-alignment")!=="viewport"&&et.get("symbol-placement")!=="point",ze=et.get("icon-rotation-alignment")==="map"&&et.get("symbol-placement")!=="point",Te=et.get("symbol-placement"),be=It/2,pe=et.get("icon-text-fit");let Le;b&&pe!=="none"&&(g.allowVerticalPlacement&&m.vertical&&(Le=Pk(b,m.vertical,pe,et.get("icon-text-fit-padding"),at,pt)),ot&&(b=Pk(b,ot,pe,et.get("icon-text-fit-padding"),at,pt)));const me=(le,Ye)=>{Ye.x<0||Ye.x>=Ji||Ye.y<0||Ye.y>=Ji||function($e,wr,mi,Ai,cn,as,ha,Qi,In,Fn,fa,da,hn,fn,jn,pa,Xn,Oa,Na,dn,Mr,Zn,Bn,pn,Bs){const xo=$e.addToLineVertexArray(wr,mi);let bo,Wl,zs,xs,Fa=0,Hl=0,Hv=0,f3=0,iA=-1,nA=-1;const Gl={};let d3=zl("");if($e.allowVerticalPlacement&&Ai.vertical){const qn=Qi.layout.get("text-rotate").evaluate(Mr,{},pn)+90;zs=new H0(In,wr,Fn,fa,da,Ai.vertical,hn,fn,jn,qn),ha&&(xs=new H0(In,wr,Fn,fa,da,ha,Xn,Oa,jn,qn))}if(cn){const qn=Qi.layout.get("icon-rotate").evaluate(Mr,{}),bs=Qi.layout.get("icon-text-fit")!=="none",_h=i3(cn,qn,Bn,bs),So=ha?i3(ha,qn,Bn,bs):void 0;Wl=new H0(In,wr,Fn,fa,da,cn,Xn,Oa,!1,qn),Fa=4*_h.length;const xh=$e.iconSizeData;let Yo=null;xh.kind==="source"?(Yo=[qo*Qi.layout.get("icon-size").evaluate(Mr,{})],Yo[0]>Vu&&lt(`${$e.layerIds[0]}: Value for "icon-size" is >= ${Vv}. Reduce your "icon-size".`)):xh.kind==="composite"&&(Yo=[qo*Zn.compositeIconSizes[0].evaluate(Mr,{},pn),qo*Zn.compositeIconSizes[1].evaluate(Mr,{},pn)],(Yo[0]>Vu||Yo[1]>Vu)&&lt(`${$e.layerIds[0]}: Value for "icon-size" is >= ${Vv}. Reduce your "icon-size".`)),$e.addSymbols($e.icon,_h,Yo,dn,Na,Mr,o.ai.none,wr,xo.lineStartIndex,xo.lineLength,-1,pn),iA=$e.icon.placedSymbolArray.length-1,So&&(Hl=4*So.length,$e.addSymbols($e.icon,So,Yo,dn,Na,Mr,o.ai.vertical,wr,xo.lineStartIndex,xo.lineLength,-1,pn),nA=$e.icon.placedSymbolArray.length-1)}const p3=Object.keys(Ai.horizontal);for(const qn of p3){const bs=Ai.horizontal[qn];if(!bo){d3=zl(bs.text);const So=Qi.layout.get("text-rotate").evaluate(Mr,{},pn);bo=new H0(In,wr,Fn,fa,da,bs,hn,fn,jn,So)}const _h=bs.positionedLines.length===1;if(Hv+=o3($e,wr,bs,as,Qi,jn,Mr,pa,xo,Ai.vertical?o.ai.horizontal:o.ai.horizontalOnly,_h?p3:[qn],Gl,iA,Zn,pn),_h)break}Ai.vertical&&(f3+=o3($e,wr,Ai.vertical,as,Qi,jn,Mr,pa,xo,o.ai.vertical,["vertical"],Gl,nA,Zn,pn));const UY=bo?bo.boxStartIndex:$e.collisionBoxArray.length,$Y=bo?bo.boxEndIndex:$e.collisionBoxArray.length,WY=zs?zs.boxStartIndex:$e.collisionBoxArray.length,HY=zs?zs.boxEndIndex:$e.collisionBoxArray.length,GY=Wl?Wl.boxStartIndex:$e.collisionBoxArray.length,jY=Wl?Wl.boxEndIndex:$e.collisionBoxArray.length,XY=xs?xs.boxStartIndex:$e.collisionBoxArray.length,ZY=xs?xs.boxEndIndex:$e.collisionBoxArray.length;let wo=-1;const j0=(qn,bs)=>qn&&qn.circleDiameter?Math.max(qn.circleDiameter,bs):bs;wo=j0(bo,wo),wo=j0(zs,wo),wo=j0(Wl,wo),wo=j0(xs,wo);const g3=wo>-1?1:0;g3&&(wo*=Bs/un),$e.glyphOffsetArray.length>=Vd.MAX_GLYPHS&&lt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mr.sortKey!==void 0&&$e.addToSortKeyRanges($e.symbolInstances.length,Mr.sortKey);const qY=s3(Qi,Mr,pn),[YY,KY]=function(qn,bs){const _h=qn.length,So=bs==null?void 0:bs.values;if((So==null?void 0:So.length)>0)for(let xh=0;xh<So.length;xh+=2){const Yo=So[xh+1];qn.emplaceBack(o.aq[So[xh]],Yo[0],Yo[1])}return[_h,qn.length]}($e.textAnchorOffsets,qY);$e.symbolInstances.emplaceBack(wr.x,wr.y,Gl.right>=0?Gl.right:-1,Gl.center>=0?Gl.center:-1,Gl.left>=0?Gl.left:-1,Gl.vertical||-1,iA,nA,d3,UY,$Y,WY,HY,GY,jY,XY,ZY,Fn,Hv,f3,Fa,Hl,g3,0,hn,wo,YY,KY)}(g,Ye,le,m,b,A,Le,g.layers[0],g.collisionBoxArray,f.index,f.sourceLayerIndex,g.index,bt,[Ft,Ft,Ft,Ft],Pe,z,kt,Ht,ze,at,f,P,$,X,D)};if(Te==="line")for(const le of Kk(f.geometry,0,0,Ji,Ji)){const Ye=LY(le,It,re,m.vertical||ot,b,24,Ct,g.overscaling,Ji);for(const $e of Ye)ot&&zY(g,ot.text,be,$e)||me(le,$e)}else if(Te==="line-center"){for(const le of f.geometry)if(le.length>1){const Ye=DY(le,re,m.vertical||ot,b,24,Ct);Ye&&me(le,Ye)}}else if(f.type==="Polygon")for(const le of ET(f.geometry,0)){const Ye=NY(le,16);me(le[0],new $u(Ye.x,Ye.y,0))}else if(f.type==="LineString")for(const le of f.geometry)me(le,new $u(le[0].x,le[0].y,0));else if(f.type==="Point")for(const le of f.geometry)for(const Ye of le)me([Ye],new $u(Ye.x,Ye.y,0))}function o3(g,f,m,b,A,P,D,k,z,$,X,K,et,at,ot){const pt=function(kt,It,Ft,Ht,re,Pe,ze,Te){const be=Ht.layout.get("text-rotate").evaluate(Pe,{})*Math.PI/180,pe=[];for(const Le of It.positionedLines)for(const me of Le.positionedGlyphs){if(!me.rect)continue;const le=me.rect||{};let Ye=Sk+1,$e=!0,wr=1,mi=0;const Ai=(re||Te)&&me.vertical,cn=me.metrics.advance*me.scale/2;if(Te&&It.verticalizable&&(mi=Le.lineOffset/2-(me.imageName?-(un-me.metrics.width*me.scale)/2:(me.scale-1)*un)),me.imageName){const dn=ze[me.imageName];$e=dn.sdf,wr=dn.pixelRatio,Ye=ka/wr}const as=re?[me.x+cn,me.y]:[0,0];let ha=re?[0,0]:[me.x+cn+Ft[0],me.y+Ft[1]-mi],Qi=[0,0];Ai&&(Qi=ha,ha=[0,0]);const In=me.metrics.isDoubleResolution?2:1,Fn=(me.metrics.left-Ye)*me.scale-cn+ha[0],fa=(-me.metrics.top-Ye)*me.scale+ha[1],da=Fn+le.w/In*me.scale/wr,hn=fa+le.h/In*me.scale/wr,fn=new p(Fn,fa),jn=new p(da,fa),pa=new p(Fn,hn),Xn=new p(da,hn);if(Ai){const dn=new p(-cn,cn-Bv),Mr=-Math.PI/2,Zn=un/2-cn,Bn=new p(5-Bv-Zn,-(me.imageName?Zn:0)),pn=new p(...Qi);fn._rotateAround(Mr,dn)._add(Bn)._add(pn),jn._rotateAround(Mr,dn)._add(Bn)._add(pn),pa._rotateAround(Mr,dn)._add(Bn)._add(pn),Xn._rotateAround(Mr,dn)._add(Bn)._add(pn)}if(be){const dn=Math.sin(be),Mr=Math.cos(be),Zn=[Mr,-dn,dn,Mr];fn._matMult(Zn),jn._matMult(Zn),pa._matMult(Zn),Xn._matMult(Zn)}const Oa=new p(0,0),Na=new p(0,0);pe.push({tl:fn,tr:jn,bl:pa,br:Xn,tex:le,writingMode:It.writingMode,glyphOffset:as,sectionIndex:me.sectionIndex,isSDF:$e,pixelOffsetTL:Oa,pixelOffsetBR:Na,minFontScaleX:0,minFontScaleY:0})}return pe}(0,m,k,A,P,D,b,g.allowVerticalPlacement),bt=g.textSizeData;let Ct=null;bt.kind==="source"?(Ct=[qo*A.layout.get("text-size").evaluate(D,{})],Ct[0]>Vu&&lt(`${g.layerIds[0]}: Value for "text-size" is >= ${Vv}. Reduce your "text-size".`)):bt.kind==="composite"&&(Ct=[qo*at.compositeTextSizes[0].evaluate(D,{},ot),qo*at.compositeTextSizes[1].evaluate(D,{},ot)],(Ct[0]>Vu||Ct[1]>Vu)&&lt(`${g.layerIds[0]}: Value for "text-size" is >= ${Vv}. Reduce your "text-size".`)),g.addSymbols(g.text,pt,Ct,k,P,D,$,f,z.lineStartIndex,z.lineLength,et,ot);for(const kt of X)K[kt]=g.text.placedSymbolArray.length-1;return 4*pt.length}function l3(g){for(const f in g)return g[f];return null}function zY(g,f,m,b){const A=g.compareText;if(f in A){const P=A[f];for(let D=P.length-1;D>=0;D--)if(b.dist(P[D])<m)return!0}else A[f]=[];return A[f].push(b),!1}const u3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class YT{static from(f){if(!(f instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[m,b]=new Uint8Array(f,0,2);if(m!==219)throw new Error("Data does not appear to be in a KDBush format.");const A=b>>4;if(A!==1)throw new Error(`Got v${A} data when expected v1.`);const P=u3[15&b];if(!P)throw new Error("Unrecognized array type.");const[D]=new Uint16Array(f,2,1),[k]=new Uint32Array(f,4,1);return new YT(k,D,P,f)}constructor(f,m=64,b=Float64Array,A){if(isNaN(f)||f<0)throw new Error(`Unpexpected numItems value: ${f}.`);this.numItems=+f,this.nodeSize=Math.min(Math.max(+m,2),65535),this.ArrayType=b,this.IndexArrayType=f<65536?Uint16Array:Uint32Array;const P=u3.indexOf(this.ArrayType),D=2*f*this.ArrayType.BYTES_PER_ELEMENT,k=f*this.IndexArrayType.BYTES_PER_ELEMENT,z=(8-k%8)%8;if(P<0)throw new Error(`Unexpected typed array class: ${b}.`);A&&A instanceof ArrayBuffer?(this.data=A,this.ids=new this.IndexArrayType(this.data,8,f),this.coords=new this.ArrayType(this.data,8+k+z,2*f),this._pos=2*f,this._finished=!0):(this.data=new ArrayBuffer(8+D+k+z),this.ids=new this.IndexArrayType(this.data,8,f),this.coords=new this.ArrayType(this.data,8+k+z,2*f),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+P]),new Uint16Array(this.data,2,1)[0]=m,new Uint32Array(this.data,4,1)[0]=f)}add(f,m){const b=this._pos>>1;return this.ids[b]=b,this.coords[this._pos++]=f,this.coords[this._pos++]=m,b}finish(){const f=this._pos>>1;if(f!==this.numItems)throw new Error(`Added ${f} items when expected ${this.numItems}.`);return KT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(f,m,b,A){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:P,coords:D,nodeSize:k}=this,z=[0,P.length-1,0],$=[];for(;z.length;){const X=z.pop()||0,K=z.pop()||0,et=z.pop()||0;if(K-et<=k){for(let bt=et;bt<=K;bt++){const Ct=D[2*bt],kt=D[2*bt+1];Ct>=f&&Ct<=b&&kt>=m&&kt<=A&&$.push(P[bt])}continue}const at=et+K>>1,ot=D[2*at],pt=D[2*at+1];ot>=f&&ot<=b&&pt>=m&&pt<=A&&$.push(P[at]),(X===0?f<=ot:m<=pt)&&(z.push(et),z.push(at-1),z.push(1-X)),(X===0?b>=ot:A>=pt)&&(z.push(at+1),z.push(K),z.push(1-X))}return $}within(f,m,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:A,coords:P,nodeSize:D}=this,k=[0,A.length-1,0],z=[],$=b*b;for(;k.length;){const X=k.pop()||0,K=k.pop()||0,et=k.pop()||0;if(K-et<=D){for(let bt=et;bt<=K;bt++)h3(P[2*bt],P[2*bt+1],f,m)<=$&&z.push(A[bt]);continue}const at=et+K>>1,ot=P[2*at],pt=P[2*at+1];h3(ot,pt,f,m)<=$&&z.push(A[at]),(X===0?f-b<=ot:m-b<=pt)&&(k.push(et),k.push(at-1),k.push(1-X)),(X===0?f+b>=ot:m+b>=pt)&&(k.push(at+1),k.push(K),k.push(1-X))}return z}}function KT(g,f,m,b,A,P){if(A-b<=m)return;const D=b+A>>1;c3(g,f,D,b,A,P),KT(g,f,m,b,D-1,1-P),KT(g,f,m,D+1,A,1-P)}function c3(g,f,m,b,A,P){for(;A>b;){if(A-b>600){const $=A-b+1,X=m-b+1,K=Math.log($),et=.5*Math.exp(2*K/3),at=.5*Math.sqrt(K*et*($-et)/$)*(X-$/2<0?-1:1);c3(g,f,m,Math.max(b,Math.floor(m-X*et/$+at)),Math.min(A,Math.floor(m+($-X)*et/$+at)),P)}const D=f[2*m+P];let k=b,z=A;for($v(g,f,b,m),f[2*A+P]>D&&$v(g,f,b,A);k<z;){for($v(g,f,k,z),k++,z--;f[2*k+P]<D;)k++;for(;f[2*z+P]>D;)z--}f[2*b+P]===D?$v(g,f,b,z):(z++,$v(g,f,z,A)),z<=m&&(b=z+1),m<=z&&(A=z-1)}}function $v(g,f,m,b){JT(g,m,b),JT(f,2*m,2*b),JT(f,2*m+1,2*b+1)}function JT(g,f,m){const b=g[f];g[f]=g[m],g[m]=b}function h3(g,f,m,b){const A=g-m,P=f-b;return A*A+P*P}var QT;o.bh=void 0,(QT=o.bh||(o.bh={})).create="create",QT.load="load",QT.fullLoad="fullLoad";let G0=null,Wv=[];const tA=1e3/60,eA="loadTime",rA="fullLoadTime",VY={mark(g){performance.mark(g)},frame(g){const f=g;G0!=null&&Wv.push(f-G0),G0=f},clearMetrics(){G0=null,Wv=[],performance.clearMeasures(eA),performance.clearMeasures(rA);for(const g in o.bh)performance.clearMarks(o.bh[g])},getPerformanceMetrics(){performance.measure(eA,o.bh.create,o.bh.load),performance.measure(rA,o.bh.create,o.bh.fullLoad);const g=performance.getEntriesByName(eA)[0].duration,f=performance.getEntriesByName(rA)[0].duration,m=Wv.length,b=1/(Wv.reduce((P,D)=>P+D,0)/m/1e3),A=Wv.filter(P=>P>tA).reduce((P,D)=>P+(D-tA)/tA,0);return{loadTime:g,fullLoadTime:f,fps:b,percentDroppedFrames:A/(m+A)*100,totalFrames:m}}};o.$=function(g,f,m){var b,A,P,D,k,z,$,X,K,et,at,ot,pt=m[0],bt=m[1],Ct=m[2];return f===g?(g[12]=f[0]*pt+f[4]*bt+f[8]*Ct+f[12],g[13]=f[1]*pt+f[5]*bt+f[9]*Ct+f[13],g[14]=f[2]*pt+f[6]*bt+f[10]*Ct+f[14],g[15]=f[3]*pt+f[7]*bt+f[11]*Ct+f[15]):(A=f[1],P=f[2],D=f[3],k=f[4],z=f[5],$=f[6],X=f[7],K=f[8],et=f[9],at=f[10],ot=f[11],g[0]=b=f[0],g[1]=A,g[2]=P,g[3]=D,g[4]=k,g[5]=z,g[6]=$,g[7]=X,g[8]=K,g[9]=et,g[10]=at,g[11]=ot,g[12]=b*pt+k*bt+K*Ct+f[12],g[13]=A*pt+z*bt+et*Ct+f[13],g[14]=P*pt+$*bt+at*Ct+f[14],g[15]=D*pt+X*bt+ot*Ct+f[15]),g},o.A=kd,o.B=Ma,o.C=class{constructor(g,f,m){this.receive=b=>{const A=b.data,P=A.id;if(P&&(!A.targetMapId||this.mapId===A.targetMapId))if(A.type==="<cancel>"){delete this.tasks[P];const D=this.cancelCallbacks[P];delete this.cancelCallbacks[P],D&&D()}else Ot()||A.mustQueue?(this.tasks[P]=A,this.taskQueue.push(P),this.invoker.trigger()):this.processTask(P,A)},this.process=()=>{if(!this.taskQueue.length)return;const b=this.taskQueue.shift(),A=this.tasks[b];delete this.tasks[b],this.taskQueue.length&&this.invoker.trigger(),A&&this.processTask(b,A)},this.target=g,this.parent=f,this.mapId=m,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new PY(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ot()?g:window}send(g,f,m,b,A=!1){const P=Math.round(1e18*Math.random()).toString(36).substring(0,10);m&&(this.callbacks[P]=m);const D=[],k={id:P,type:g,hasCallback:!!m,targetMapId:b,mustQueue:A,sourceMapId:this.mapId,data:jo(f,D)};return this.target.postMessage(k,{transfer:D}),{cancel:()=>{m&&delete this.callbacks[P],this.target.postMessage({id:P,type:"<cancel>",targetMapId:b,sourceMapId:this.mapId})}}}processTask(g,f){if(f.type==="<response>"){const m=this.callbacks[g];delete this.callbacks[g],m&&(f.error?m(ku(f.error)):m(null,ku(f.data)))}else{let m=!1;const b=[],A=f.hasCallback?(k,z)=>{m=!0,delete this.cancelCallbacks[g];const $={id:g,type:"<response>",sourceMapId:this.mapId,error:k?jo(k):null,data:jo(z,b)};this.target.postMessage($,{transfer:b})}:k=>{m=!0};let P=null;const D=ku(f.data);if(this.parent[f.type])P=this.parent[f.type](f.sourceMapId,D,A);else if("getWorkerSource"in this.parent){const k=f.type.split(".");P=this.parent.getWorkerSource(f.sourceMapId,k[0],D.source)[k[1]](D,A)}else A(new Error(`Could not find function ${f.type}`));!m&&P&&P.cancel&&(this.cancelCallbacks[g]=P.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.D=He,o.E=wi,o.F=function(g,f){const m={};for(let b=0;b<f.length;b++){const A=f[b];A in g&&(m[A]=g[A])}return m},o.G=zk,o.H=Vk,o.I=FT,o.J=E,o.K=M,o.L=Uu,o.M=ne,o.N=Ji,o.O=_s,o.P=p,o.Q=Ri,o.R=ys,o.S=vi,o.T=x0,o.U=V0,o.V=class extends Fl{},o.W=XT,o.X=function(g,f){const m=window.document.createElement("video");m.muted=!0,m.onloadstart=function(){f(null,m)};for(let b=0;b<g.length;b++){const A=window.document.createElement("source");tr(g[b])||(m.crossOrigin="Anonymous"),A.src=g[b],m.appendChild(A)}return{cancel:()=>{}}},o.Y=de,o.Z=function(){var g=new kd(16);return kd!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0),g[0]=1,g[5]=1,g[10]=1,g[15]=1,g},o._=l,o.a=Ut,o.a$=class extends nt{},o.a0=function(g,f,m){var b=m[0],A=m[1],P=m[2];return g[0]=f[0]*b,g[1]=f[1]*b,g[2]=f[2]*b,g[3]=f[3]*b,g[4]=f[4]*A,g[5]=f[5]*A,g[6]=f[6]*A,g[7]=f[7]*A,g[8]=f[8]*P,g[9]=f[9]*P,g[10]=f[10]*P,g[11]=f[11]*P,g[12]=f[12],g[13]=f[13],g[14]=f[14],g[15]=f[15],g},o.a1=HL,o.a2=function(){return H++},o.a3=_t,o.a4=Vd,o.a5=function(){Da.isLoading()||Da.isLoaded()||mv()!=="deferred"||_0()},o.a6=sv,o.a7=mh,o.a8=gi,o.a9=Xk,o.aA=hh,o.aB=function(g){g=g.slice();const f=Object.create(null);for(let m=0;m<g.length;m++)f[g[m].id]=g[m];for(let m=0;m<g.length;m++)"ref"in g[m]&&(g[m]=wn(g[m],f[g[m].ref]));return g},o.aC=function(g){if(g.type==="custom")return new MY(g);switch(g.type){case"background":return new CY(g);case"circle":return new hq(g);case"fill":return new Rq(g);case"fill-extrusion":return new jq(g);case"heatmap":return new dq(g);case"hillshade":return new gq(g);case"line":return new tY(g);case"raster":return new IY(g);case"symbol":return new z0(g)}},o.aD=tt,o.aE=function(g,f){if(!g)return[{command:$r.setStyle,args:[f]}];let m=[];try{if(!Gr(g.version,f.version))return[{command:$r.setStyle,args:[f]}];Gr(g.center,f.center)||m.push({command:$r.setCenter,args:[f.center]}),Gr(g.zoom,f.zoom)||m.push({command:$r.setZoom,args:[f.zoom]}),Gr(g.bearing,f.bearing)||m.push({command:$r.setBearing,args:[f.bearing]}),Gr(g.pitch,f.pitch)||m.push({command:$r.setPitch,args:[f.pitch]}),Gr(g.sprite,f.sprite)||m.push({command:$r.setSprite,args:[f.sprite]}),Gr(g.glyphs,f.glyphs)||m.push({command:$r.setGlyphs,args:[f.glyphs]}),Gr(g.transition,f.transition)||m.push({command:$r.setTransition,args:[f.transition]}),Gr(g.light,f.light)||m.push({command:$r.setLight,args:[f.light]});const b={},A=[];(function(D,k,z,$){let X;for(X in k=k||{},D=D||{})Object.prototype.hasOwnProperty.call(D,X)&&(Object.prototype.hasOwnProperty.call(k,X)||Wo(X,z,$));for(X in k)Object.prototype.hasOwnProperty.call(k,X)&&(Object.prototype.hasOwnProperty.call(D,X)?Gr(D[X],k[X])||(D[X].type==="geojson"&&k[X].type==="geojson"&&Ml(D,k,X)?z.push({command:$r.setGeoJSONSourceData,args:[X,k[X].data]}):Ka(X,k,z,$)):Ya(X,k,z))})(g.sources,f.sources,A,b);const P=[];g.layers&&g.layers.forEach(D=>{b[D.source]?m.push({command:$r.removeLayer,args:[D.id]}):P.push(D)}),m=m.concat(A),function(D,k,z){k=k||[];const $=(D=D||[]).map(gs),X=k.map(gs),K=D.reduce(Ja,{}),et=k.reduce(Ja,{}),at=$.slice(),ot=Object.create(null);let pt,bt,Ct,kt,It,Ft,Ht;for(pt=0,bt=0;pt<$.length;pt++)Ct=$[pt],Object.prototype.hasOwnProperty.call(et,Ct)?bt++:(z.push({command:$r.removeLayer,args:[Ct]}),at.splice(at.indexOf(Ct,bt),1));for(pt=0,bt=0;pt<X.length;pt++)Ct=X[X.length-1-pt],at[at.length-1-pt]!==Ct&&(Object.prototype.hasOwnProperty.call(K,Ct)?(z.push({command:$r.removeLayer,args:[Ct]}),at.splice(at.lastIndexOf(Ct,at.length-bt),1)):bt++,Ft=at[at.length-pt],z.push({command:$r.addLayer,args:[et[Ct],Ft]}),at.splice(at.length-pt,0,Ct),ot[Ct]=!0);for(pt=0;pt<X.length;pt++)if(Ct=X[pt],kt=K[Ct],It=et[Ct],!ot[Ct]&&!Gr(kt,It))if(Gr(kt.source,It.source)&&Gr(kt["source-layer"],It["source-layer"])&&Gr(kt.type,It.type)){for(Ht in uo(kt.layout,It.layout,z,Ct,null,$r.setLayoutProperty),uo(kt.paint,It.paint,z,Ct,null,$r.setPaintProperty),Gr(kt.filter,It.filter)||z.push({command:$r.setFilter,args:[Ct,It.filter]}),Gr(kt.minzoom,It.minzoom)&&Gr(kt.maxzoom,It.maxzoom)||z.push({command:$r.setLayerZoomRange,args:[Ct,It.minzoom,It.maxzoom]}),kt)Object.prototype.hasOwnProperty.call(kt,Ht)&&Ht!=="layout"&&Ht!=="paint"&&Ht!=="filter"&&Ht!=="metadata"&&Ht!=="minzoom"&&Ht!=="maxzoom"&&(Ht.indexOf("paint.")===0?uo(kt[Ht],It[Ht],z,Ct,Ht.slice(6),$r.setPaintProperty):Gr(kt[Ht],It[Ht])||z.push({command:$r.setLayerProperty,args:[Ct,Ht,It[Ht]]}));for(Ht in It)Object.prototype.hasOwnProperty.call(It,Ht)&&!Object.prototype.hasOwnProperty.call(kt,Ht)&&Ht!=="layout"&&Ht!=="paint"&&Ht!=="filter"&&Ht!=="metadata"&&Ht!=="minzoom"&&Ht!=="maxzoom"&&(Ht.indexOf("paint.")===0?uo(kt[Ht],It[Ht],z,Ct,Ht.slice(6),$r.setPaintProperty):Gr(kt[Ht],It[Ht])||z.push({command:$r.setLayerProperty,args:[Ct,Ht,It[Ht]]}))}else z.push({command:$r.removeLayer,args:[Ct]}),Ft=at[at.lastIndexOf(Ct)+1],z.push({command:$r.addLayer,args:[It,Ft]})}(P,f.layers,m)}catch(b){console.warn("Unable to compute style diff:",b),m=[{command:$r.setStyle,args:[f]}]}return m},o.aF=function(g){const f=[],m=g.id;return m===void 0&&f.push({message:`layers.${m}: missing required property "id"`}),g.render===void 0&&f.push({message:`layers.${m}: missing required method "render"`}),g.renderingMode&&g.renderingMode!=="2d"&&g.renderingMode!=="3d"&&f.push({message:`layers.${m}: property "renderingMode" must be either "2d" or "3d"`}),f},o.aG=function g(f,m){if(Array.isArray(f)){if(!Array.isArray(m)||f.length!==m.length)return!1;for(let b=0;b<f.length;b++)if(!g(f[b],m[b]))return!1;return!0}if(typeof f=="object"&&f!==null&&m!==null){if(typeof m!="object"||Object.keys(f).length!==Object.keys(m).length)return!1;for(const b in f)if(!g(f[b],m[b]))return!1;return!0}return f===m},o.aH=j,o.aI=Y,o.aJ=fh,o.aK=function(g){return g({pluginStatus:la,pluginURL:Xo}),fh.on("pluginStateChange",g),g},o.aL=class extends Vl{constructor(g,f){super(g,f),this.current=0}set(g){this.current!==g&&(this.current=g,this.gl.uniform1i(this.location,g))}},o.aM=Dd,o.aN=class extends Vl{constructor(g,f){super(g,f),this.current=gT}set(g){if(g[12]!==this.current[12]||g[0]!==this.current[0])return this.current=g,void this.gl.uniformMatrix4fv(this.location,!1,g);for(let f=1;f<16;f++)if(g[f]!==this.current[f]){this.current=g,this.gl.uniformMatrix4fv(this.location,!1,g);break}}},o.aO=T0,o.aP=class extends Vl{constructor(g,f){super(g,f),this.current=[0,0,0]}set(g){g[0]===this.current[0]&&g[1]===this.current[1]&&g[2]===this.current[2]||(this.current=g,this.gl.uniform3f(this.location,g[0],g[1],g[2]))}},o.aQ=class extends Vl{constructor(g,f){super(g,f),this.current=[0,0]}set(g){g[0]===this.current[0]&&g[1]===this.current[1]||(this.current=g,this.gl.uniform2f(this.location,g[0],g[1]))}},o.aR=A0,o.aS=function(g,f,m,b,A,P,D){var k=1/(f-m),z=1/(b-A),$=1/(P-D);return g[0]=-2*k,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=-2*z,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=2*$,g[11]=0,g[12]=(f+m)*k,g[13]=(A+b)*z,g[14]=(D+P)*$,g[15]=1,g},o.aT=Ar,o.aU=cq,o.aV=class extends S{},o.aW=nY,o.aX=class extends R{},o.aY=function(g){return g<=1?1:Math.pow(2,Math.ceil(Math.log(g)/Math.LN2))},o.aZ=qL,o.a_=fe,o.aa=function(g){const f={};if(g.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(m,b,A,P)=>{const D=A||P;return f[b]=!D||D.toLowerCase(),""}),f["max-age"]){const m=parseInt(f["max-age"],10);isNaN(m)?delete f["max-age"]:f["max-age"]=m}return f},o.ab=function(g,f){const m=[];for(const b in g)b in f||m.push(b);return m},o.ac=function(g){if(Rt==null){const f=g.navigator?g.navigator.userAgent:null;Rt=!!g.safari||!(!f||!(/\b(iPad|iPhone|iPod)\b/.test(f)||f.match("Safari")&&!f.match("Chrome")))}return Rt},o.ad=O,o.ae=function(g,f,m){var b=Math.sin(m),A=Math.cos(m),P=f[0],D=f[1],k=f[2],z=f[3],$=f[4],X=f[5],K=f[6],et=f[7];return f!==g&&(g[8]=f[8],g[9]=f[9],g[10]=f[10],g[11]=f[11],g[12]=f[12],g[13]=f[13],g[14]=f[14],g[15]=f[15]),g[0]=P*A+$*b,g[1]=D*A+X*b,g[2]=k*A+K*b,g[3]=z*A+et*b,g[4]=$*A-P*b,g[5]=X*A-D*b,g[6]=K*A-k*b,g[7]=et*A-z*b,g},o.af=function(g){var f=new kd(16);return f[0]=g[0],f[1]=g[1],f[2]=g[2],f[3]=g[3],f[4]=g[4],f[5]=g[5],f[6]=g[6],f[7]=g[7],f[8]=g[8],f[9]=g[9],f[10]=g[10],f[11]=g[11],f[12]=g[12],f[13]=g[13],f[14]=g[14],f[15]=g[15],f},o.ag=M0,o.ah=function(g,f){let m=0,b=0;if(g.kind==="constant")b=g.layoutSize;else if(g.kind!=="source"){const{interpolationType:A,minZoom:P,maxZoom:D}=g,k=A?O(Pa.interpolationFactor(A,f,P,D),0,1):0;g.kind==="camera"?b=Ma.number(g.minSize,g.maxSize,k):m=k}return{uSizeT:m,uSize:b}},o.aj=function(g,{uSize:f,uSizeT:m},{lowerSize:b,upperSize:A}){return g.kind==="source"?b/qo:g.kind==="composite"?Ma.number(b/qo,A/qo,m):f},o.ak=UT,o.al=function(g,f,m,b){const A=f.y-g.y,P=f.x-g.x,D=b.y-m.y,k=b.x-m.x,z=D*P-k*A;if(z===0)return null;const $=(k*(g.y-m.y)-D*(g.x-m.x))/z;return new p(g.x+$*P,g.y+$*A)},o.am=Kk,o.an=BL,o.ao=xT,o.ap=un,o.ar=VT,o.as=function(g,f){var m=f[0],b=f[1],A=f[2],P=f[3],D=f[4],k=f[5],z=f[6],$=f[7],X=f[8],K=f[9],et=f[10],at=f[11],ot=f[12],pt=f[13],bt=f[14],Ct=f[15],kt=m*k-b*D,It=m*z-A*D,Ft=m*$-P*D,Ht=b*z-A*k,re=b*$-P*k,Pe=A*$-P*z,ze=X*pt-K*ot,Te=X*bt-et*ot,be=X*Ct-at*ot,pe=K*bt-et*pt,Le=K*Ct-at*pt,me=et*Ct-at*bt,le=kt*me-It*Le+Ft*pe+Ht*be-re*Te+Pe*ze;return le?(g[0]=(k*me-z*Le+$*pe)*(le=1/le),g[1]=(A*Le-b*me-P*pe)*le,g[2]=(pt*Pe-bt*re+Ct*Ht)*le,g[3]=(et*re-K*Pe-at*Ht)*le,g[4]=(z*be-D*me-$*Te)*le,g[5]=(m*me-A*be+P*Te)*le,g[6]=(bt*Ft-ot*Pe-Ct*It)*le,g[7]=(X*Pe-et*Ft+at*It)*le,g[8]=(D*Le-k*be+$*ze)*le,g[9]=(b*be-m*Le-P*ze)*le,g[10]=(ot*re-pt*Ft+Ct*kt)*le,g[11]=(K*Ft-X*re-at*kt)*le,g[12]=(k*Te-D*pe-z*ze)*le,g[13]=(m*pe-b*Te+A*ze)*le,g[14]=(pt*It-ot*Ht-bt*kt)*le,g[15]=(X*Ht-K*It+et*kt)*le,g):null},o.at=qT,o.au=zT,o.av=YT,o.aw=function(){const g={},f=qt.$version;for(const m in qt.$root){const b=qt.$root[m];if(b.required){let A=null;A=m==="version"?f:b.type==="array"?[]:{},A!=null&&(g[m]=A)}}return g},o.ax=$r,o.ay=g0,o.az=Ee,o.b=function(g,f){const m=new Blob([new Uint8Array(g)],{type:"image/png"});createImageBitmap(m).then(b=>{f(null,b)}).catch(b=>{f(new Error(`Could not load image because of ${b.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.b0=Cn,o.b1=function(g,f){var m=g[0],b=g[1],A=g[2],P=g[3],D=g[4],k=g[5],z=g[6],$=g[7],X=g[8],K=g[9],et=g[10],at=g[11],ot=g[12],pt=g[13],bt=g[14],Ct=g[15],kt=f[0],It=f[1],Ft=f[2],Ht=f[3],re=f[4],Pe=f[5],ze=f[6],Te=f[7],be=f[8],pe=f[9],Le=f[10],me=f[11],le=f[12],Ye=f[13],$e=f[14],wr=f[15];return Math.abs(m-kt)<=ca*Math.max(1,Math.abs(m),Math.abs(kt))&&Math.abs(b-It)<=ca*Math.max(1,Math.abs(b),Math.abs(It))&&Math.abs(A-Ft)<=ca*Math.max(1,Math.abs(A),Math.abs(Ft))&&Math.abs(P-Ht)<=ca*Math.max(1,Math.abs(P),Math.abs(Ht))&&Math.abs(D-re)<=ca*Math.max(1,Math.abs(D),Math.abs(re))&&Math.abs(k-Pe)<=ca*Math.max(1,Math.abs(k),Math.abs(Pe))&&Math.abs(z-ze)<=ca*Math.max(1,Math.abs(z),Math.abs(ze))&&Math.abs($-Te)<=ca*Math.max(1,Math.abs($),Math.abs(Te))&&Math.abs(X-be)<=ca*Math.max(1,Math.abs(X),Math.abs(be))&&Math.abs(K-pe)<=ca*Math.max(1,Math.abs(K),Math.abs(pe))&&Math.abs(et-Le)<=ca*Math.max(1,Math.abs(et),Math.abs(Le))&&Math.abs(at-me)<=ca*Math.max(1,Math.abs(at),Math.abs(me))&&Math.abs(ot-le)<=ca*Math.max(1,Math.abs(ot),Math.abs(le))&&Math.abs(pt-Ye)<=ca*Math.max(1,Math.abs(pt),Math.abs(Ye))&&Math.abs(bt-$e)<=ca*Math.max(1,Math.abs(bt),Math.abs($e))&&Math.abs(Ct-wr)<=ca*Math.max(1,Math.abs(Ct),Math.abs(wr))},o.b2=function(g,f){return g[0]=f[0],g[1]=f[1],g[2]=f[2],g[3]=f[3],g[4]=f[4],g[5]=f[5],g[6]=f[6],g[7]=f[7],g[8]=f[8],g[9]=f[9],g[10]=f[10],g[11]=f[11],g[12]=f[12],g[13]=f[13],g[14]=f[14],g[15]=f[15],g},o.b3=function(g,f,m){return g[0]=f[0]*m[0],g[1]=f[1]*m[1],g[2]=f[2]*m[2],g[3]=f[3]*m[3],g},o.b4=function(g,f){return g[0]*f[0]+g[1]*f[1]+g[2]*f[2]+g[3]*f[3]},o.b5=U,o.b6=Hk,o.b7=Uk,o.b8=function(g,f,m,b,A){var P,D=1/Math.tan(f/2);return g[0]=D/m,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=D,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=-1,g[12]=0,g[13]=0,g[15]=0,A!=null&&A!==1/0?(g[10]=(A+b)*(P=1/(b-A)),g[14]=2*A*b*P):(g[10]=-1,g[14]=-2*b),g},o.b9=function(g,f,m){var b=Math.sin(m),A=Math.cos(m),P=f[4],D=f[5],k=f[6],z=f[7],$=f[8],X=f[9],K=f[10],et=f[11];return f!==g&&(g[0]=f[0],g[1]=f[1],g[2]=f[2],g[3]=f[3],g[12]=f[12],g[13]=f[13],g[14]=f[14],g[15]=f[15]),g[4]=P*A+$*b,g[5]=D*A+X*b,g[6]=k*A+K*b,g[7]=z*A+et*b,g[8]=$*A-P*b,g[9]=X*A-D*b,g[10]=K*A-k*b,g[11]=et*A-z*b,g},o.bA=c,o.bB=vk,o.bC=bd,o.bD=Da,o.ba=L,o.bb=F,o.bc=function(g,f){return g[0]=f[0],g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=f[1],g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=f[2],g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g},o.bd=class extends gh{},o.be=GT,o.bf=$k,o.bg=VY,o.bi=Ce,o.bj=function(g,f,m=!1){if(la===fv||la===dv||la===pv)throw new Error("setRTLTextPlugin cannot be called multiple times.");Xo=sr.resolveURL(g),la=fv,gv=f,vv(),m||_0()},o.bk=mv,o.bl=function(g,f){const m={};for(let A=0;A<g.length;A++){const P=f&&f[g[A].id]||Ad(g[A]);f&&(f[g[A].id]=P);let D=m[P];D||(D=m[P]=[]),D.push(g[A])}const b=[];for(const A in m)b.push(m[A]);return b},o.bm=De,o.bn=jk,o.bo=Zk,o.bp=Ak,o.bq=function(g){g.bucket.createArrays(),g.bucket.tilePixelRatio=Ji/(512*g.bucket.overscaling),g.bucket.compareText={},g.bucket.iconsNeedLinear=!1;const f=g.bucket.layers[0],m=f.layout,b=f._unevaluatedLayout._values,A={layoutIconSize:b["icon-size"].possiblyEvaluate(new gi(g.bucket.zoom+1),g.canonical),layoutTextSize:b["text-size"].possiblyEvaluate(new gi(g.bucket.zoom+1),g.canonical),textMaxSize:b["text-size"].possiblyEvaluate(new gi(18))};if(g.bucket.textSizeData.kind==="composite"){const{minZoom:$,maxZoom:X}=g.bucket.textSizeData;A.compositeTextSizes=[b["text-size"].possiblyEvaluate(new gi($),g.canonical),b["text-size"].possiblyEvaluate(new gi(X),g.canonical)]}if(g.bucket.iconSizeData.kind==="composite"){const{minZoom:$,maxZoom:X}=g.bucket.iconSizeData;A.compositeIconSizes=[b["icon-size"].possiblyEvaluate(new gi($),g.canonical),b["icon-size"].possiblyEvaluate(new gi(X),g.canonical)]}const P=m.get("text-line-height")*un,D=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point",k=m.get("text-keep-upright"),z=m.get("text-size");for(const $ of g.bucket.features){const X=m.get("text-font").evaluate($,{},g.canonical).join(","),K=z.evaluate($,{},g.canonical),et=A.layoutTextSize.evaluate($,{},g.canonical),at=A.layoutIconSize.evaluate($,{},g.canonical),ot={horizontal:{},vertical:void 0},pt=$.text;let bt,Ct=[0,0];if(pt){const Ft=pt.toString(),Ht=m.get("text-letter-spacing").evaluate($,{},g.canonical)*un,re=cv(Ft)?Ht:0,Pe=m.get("text-anchor").evaluate($,{},g.canonical),ze=s3(f,$,g.canonical);if(!ze){const me=m.get("text-radial-offset").evaluate($,{},g.canonical);Ct=me?a3(Pe,[me*un,ZT]):m.get("text-offset").evaluate($,{},g.canonical).map(le=>le*un)}let Te=D?"center":m.get("text-justify").evaluate($,{},g.canonical);const be=m.get("symbol-placement"),pe=be==="point"?m.get("text-max-width").evaluate($,{},g.canonical)*un:0,Le=()=>{g.bucket.allowVerticalPlacement&&uv(Ft)&&(ot.vertical=N0(pt,g.glyphMap,g.glyphPositions,g.imagePositions,X,pe,P,Pe,"left",re,Ct,o.ai.vertical,!0,be,et,K))};if(!D&&ze){const me=new Set;if(Te==="auto")for(let Ye=0;Ye<ze.values.length;Ye+=2)me.add(qT(ze.values[Ye]));else me.add(Te);let le=!1;for(const Ye of me)if(!ot.horizontal[Ye])if(le)ot.horizontal[Ye]=ot.horizontal[0];else{const $e=N0(pt,g.glyphMap,g.glyphPositions,g.imagePositions,X,pe,P,"center",Ye,re,Ct,o.ai.horizontal,!1,be,et,K);$e&&(ot.horizontal[Ye]=$e,le=$e.positionedLines.length===1)}Le()}else{Te==="auto"&&(Te=qT(Pe));const me=N0(pt,g.glyphMap,g.glyphPositions,g.imagePositions,X,pe,P,Pe,Te,re,Ct,o.ai.horizontal,!1,be,et,K);me&&(ot.horizontal[Te]=me),Le(),uv(Ft)&&D&&k&&(ot.vertical=N0(pt,g.glyphMap,g.glyphPositions,g.imagePositions,X,pe,P,Pe,Te,re,Ct,o.ai.vertical,!1,be,et,K))}}let kt=!1;if($.icon&&$.icon.name){const Ft=g.imageMap[$.icon.name];Ft&&(bt=bY(g.imagePositions[$.icon.name],m.get("icon-offset").evaluate($,{},g.canonical),m.get("icon-anchor").evaluate($,{},g.canonical)),kt=!!Ft.sdf,g.bucket.sdfIcons===void 0?g.bucket.sdfIcons=kt:g.bucket.sdfIcons!==kt&&lt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ft.pixelRatio!==g.bucket.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(g.bucket.iconsNeedLinear=!0))}const It=l3(ot.horizontal)||ot.vertical;g.bucket.iconsInText=!!It&&It.iconsInText,(It||bt)&&BY(g.bucket,$,ot,bt,g.imageMap,A,et,at,Ct,kt,g.canonical)}g.showCollisionBoxes&&g.bucket.generateCollisionDebugBuffers()},o.br=LT,o.bs=PT,o.bt=DT,o.bu=class{constructor(g){this._marks={start:[g.url,"start"].join("#"),end:[g.url,"end"].join("#"),measure:g.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let g=performance.getEntriesByName(this._marks.measure);return g.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),g=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),g}},o.bv=OT,o.bw=Bu,o.bx=function(g,f,m,b,A){return l(this,void 0,void 0,function*(){if(M())try{return yield ne(g,f,m,b,A)}catch{}return function(P,D,k,z,$){const X=P.width,K=P.height;se&&ce||(se=new OffscreenCanvas(X,K),ce=se.getContext("2d",{willReadFrequently:!0})),se.width=X,se.height=K,ce.drawImage(P,0,0,X,K);const et=ce.getImageData(D,k,z,$);return ce.clearRect(0,0,X,K),et.data}(g,f,m,b,A)})},o.by=Gk,o.bz=u,o.c=ke,o.d=function(g,f){const m=new Image;m.onload=()=>{f(null,m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=Jt})},m.onerror=()=>f(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(g)],{type:"image/png"});m.src=g.byteLength?URL.createObjectURL(b):Jt},o.e=W,o.f=function(g,f){return Fe(W(g,{type:"json"}),f)},o.g=Ie,o.h=sr,o.i=Ot,o.j=Hi,o.k=Xr,o.l=Rr,o.m=Fe,o.n=function(g){return new OT(g).readFields(gY,[])},o.o=function(g,f,m){if(!g.length)return m(null,[]);let b=g.length;const A=new Array(g.length);let P=null;g.forEach((D,k)=>{f(D,(z,$)=>{z&&(P=z),A[k]=$,--b==0&&m(P,A)})})},o.p=Tk,o.q=Pv,o.r=Gi,o.s=tr,o.t=hT,o.u=Me,o.v=qt,o.w=lt,o.x=Id,o.y=mo,o.z=function([g,f,m]){return f+=90,f*=Math.PI/180,m*=Math.PI/180,{x:g*Math.cos(f)*Math.sin(m),y:g*Math.sin(f)*Math.sin(m),z:g*Math.cos(m)}}}),a(["./shared"],function(o){class l{constructor(Q){this.keyCache={},Q&&this.replace(Q)}replace(Q){this._layerConfigs={},this._layers={},this.update(Q,[])}update(Q,rt){for(const xt of Q){this._layerConfigs[xt.id]=xt;const wt=this._layers[xt.id]=o.aC(xt);wt._featureFilter=o.a6(wt.filter),this.keyCache[xt.id]&&delete this.keyCache[xt.id]}for(const xt of rt)delete this.keyCache[xt],delete this._layerConfigs[xt],delete this._layers[xt];this.familiesBySource={};const ct=o.bl(Object.values(this._layerConfigs),this.keyCache);for(const xt of ct){const wt=xt.map(Qt=>this._layers[Qt.id]),Nt=wt[0];if(Nt.visibility==="none")continue;const Mt=Nt.source||"";let At=this.familiesBySource[Mt];At||(At=this.familiesBySource[Mt]={});const Dt=Nt.sourceLayer||"_geojsonTileLayer";let Yt=At[Dt];Yt||(Yt=At[Dt]=[]),Yt.push(wt)}}}class u{constructor(Q){const rt={},ct=[];for(const Mt in Q){const At=Q[Mt],Dt=rt[Mt]={};for(const Yt in At){const Qt=At[+Yt];if(!Qt||Qt.bitmap.width===0||Qt.bitmap.height===0)continue;const ie={x:0,y:0,w:Qt.bitmap.width+2,h:Qt.bitmap.height+2};ct.push(ie),Dt[Yt]={rect:ie,metrics:Qt.metrics}}}const{w:xt,h:wt}=o.p(ct),Nt=new o.q({width:xt||1,height:wt||1});for(const Mt in Q){const At=Q[Mt];for(const Dt in At){const Yt=At[+Dt];if(!Yt||Yt.bitmap.width===0||Yt.bitmap.height===0)continue;const Qt=rt[Mt][Dt].rect;o.q.copy(Yt.bitmap,Nt,{x:0,y:0},{x:Qt.x+1,y:Qt.y+1},Yt.bitmap)}}this.image=Nt,this.positions=rt}}o.bm("GlyphAtlas",u);class c{constructor(Q){this.tileID=new o.O(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(Q,rt,ct,xt,wt){this.status="parsing",this.data=Q,this.collisionBoxArray=new o.a3;const Nt=new o.bn(Object.keys(Q.layers).sort()),Mt=new o.bo(this.tileID,this.promoteId);Mt.bucketLayerIDs=[];const At={},Dt={featureIndex:Mt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ct},Yt=rt.familiesBySource[this.source];for(const yr in Yt){const xr=Q.layers[yr];if(!xr)continue;xr.version===1&&o.w(`Vector tile source "${this.source}" layer "${yr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ni=Nt.encode(yr),Kr=[];for(let Ii=0;Ii<xr.length;Ii++){const an=xr.feature(Ii),na=Mt.getId(an,yr);Kr.push({feature:an,id:na,index:Ii,sourceLayerIndex:Ni})}for(const Ii of Yt[yr]){const an=Ii[0];an.source!==this.source&&o.w(`layer.source = ${an.source} does not equal this.source = ${this.source}`),an.minzoom&&this.zoom<Math.floor(an.minzoom)||an.maxzoom&&this.zoom>=an.maxzoom||an.visibility!=="none"&&(h(Ii,this.zoom,ct),(At[an.id]=an.createBucket({index:Mt.bucketLayerIDs.length,layers:Ii,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ni,sourceID:this.source})).populate(Kr,Dt,this.tileID.canonical),Mt.bucketLayerIDs.push(Ii.map(na=>na.id)))}}let Qt,ie,Xe,ar;const Oe=o.aH(Dt.glyphDependencies,yr=>Object.keys(yr).map(Number));this.inFlightDependencies.forEach(yr=>yr==null?void 0:yr.cancel()),this.inFlightDependencies=[];const qe=++this.dependencySentinel;Object.keys(Oe).length?this.inFlightDependencies.push(xt.send("getGlyphs",{uid:this.uid,stacks:Oe,source:this.source,tileID:this.tileID,type:"glyphs"},(yr,xr)=>{qe===this.dependencySentinel&&(Qt||(Qt=yr,ie=xr,Zr.call(this)))})):ie={};const or=Object.keys(Dt.iconDependencies);or.length?this.inFlightDependencies.push(xt.send("getImages",{icons:or,source:this.source,tileID:this.tileID,type:"icons"},(yr,xr)=>{qe===this.dependencySentinel&&(Qt||(Qt=yr,Xe=xr,Zr.call(this)))})):Xe={};const Hr=Object.keys(Dt.patternDependencies);function Zr(){if(Qt)return wt(Qt);if(ie&&Xe&&ar){const yr=new u(ie),xr=new o.bp(Xe,ar);for(const Ni in At){const Kr=At[Ni];Kr instanceof o.a4?(h(Kr.layers,this.zoom,ct),o.bq({bucket:Kr,glyphMap:ie,glyphPositions:yr.positions,imageMap:Xe,imagePositions:xr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Kr.hasPattern&&(Kr instanceof o.br||Kr instanceof o.bs||Kr instanceof o.bt)&&(h(Kr.layers,this.zoom,ct),Kr.addFeatures(Dt,this.tileID.canonical,xr.patternPositions))}this.status="done",wt(null,{buckets:Object.values(At).filter(Ni=>!Ni.isEmpty()),featureIndex:Mt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yr.image,imageAtlas:xr,glyphMap:this.returnDependencies?ie:null,iconMap:this.returnDependencies?Xe:null,glyphPositions:this.returnDependencies?yr.positions:null})}}Hr.length?this.inFlightDependencies.push(xt.send("getImages",{icons:Hr,source:this.source,tileID:this.tileID,type:"patterns"},(yr,xr)=>{qe===this.dependencySentinel&&(Qt||(Qt=yr,ar=xr,Zr.call(this)))})):ar={},Zr.call(this)}}function h(yt,Q,rt){const ct=new o.a8(Q);for(const xt of yt)xt.recalculate(ct,rt)}function p(yt,Q){const rt=o.l(yt.request,(ct,xt,wt,Nt)=>{if(ct)Q(ct);else if(xt)try{const Mt=new o.bw.VectorTile(new o.bv(xt));Q(null,{vectorTile:Mt,rawData:xt,cacheControl:wt,expires:Nt})}catch(Mt){const At=new Uint8Array(xt);let Dt=`Unable to parse the tile at ${yt.request.url}, `;Dt+=At[0]===31&&At[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Mt.messge}`,Q(new Error(Dt))}});return()=>{rt.cancel(),Q()}}class v{constructor(Q,rt,ct,xt){this.actor=Q,this.layerIndex=rt,this.availableImages=ct,this.loadVectorData=xt||p,this.fetching={},this.loading={},this.loaded={}}loadTile(Q,rt){const ct=Q.uid;this.loading||(this.loading={});const xt=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new o.bu(Q.request),wt=this.loading[ct]=new c(Q);wt.abort=this.loadVectorData(Q,(Nt,Mt)=>{if(delete this.loading[ct],Nt||!Mt)return wt.status="done",this.loaded[ct]=wt,rt(Nt);const At=Mt.rawData,Dt={};Mt.expires&&(Dt.expires=Mt.expires),Mt.cacheControl&&(Dt.cacheControl=Mt.cacheControl);const Yt={};if(xt){const Qt=xt.finish();Qt&&(Yt.resourceTiming=JSON.parse(JSON.stringify(Qt)))}wt.vectorTile=Mt.vectorTile,wt.parse(Mt.vectorTile,this.layerIndex,this.availableImages,this.actor,(Qt,ie)=>{if(delete this.fetching[ct],Qt||!ie)return rt(Qt);rt(null,o.e({rawTileData:At.slice(0)},ie,Dt,Yt))}),this.loaded=this.loaded||{},this.loaded[ct]=wt,this.fetching[ct]={rawTileData:At,cacheControl:Dt,resourceTiming:Yt}})}reloadTile(Q,rt){const ct=this.loaded,xt=Q.uid;if(ct&&ct[xt]){const wt=ct[xt];wt.showCollisionBoxes=Q.showCollisionBoxes,wt.status==="parsing"?wt.parse(wt.vectorTile,this.layerIndex,this.availableImages,this.actor,(Nt,Mt)=>{if(Nt||!Mt)return rt(Nt,Mt);let At;if(this.fetching[xt]){const{rawTileData:Dt,cacheControl:Yt,resourceTiming:Qt}=this.fetching[xt];delete this.fetching[xt],At=o.e({rawTileData:Dt.slice(0)},Mt,Yt,Qt)}else At=Mt;rt(null,At)}):wt.status==="done"&&(wt.vectorTile?wt.parse(wt.vectorTile,this.layerIndex,this.availableImages,this.actor,rt):rt())}}abortTile(Q,rt){const ct=this.loading,xt=Q.uid;ct&&ct[xt]&&ct[xt].abort&&(ct[xt].abort(),delete ct[xt]),rt()}removeTile(Q,rt){const ct=this.loaded,xt=Q.uid;ct&&ct[xt]&&delete ct[xt],rt()}}class y{constructor(){this.loaded={}}loadTile(Q,rt){return o._(this,void 0,void 0,function*(){const{uid:ct,encoding:xt,rawImageData:wt,redFactor:Nt,greenFactor:Mt,blueFactor:At,baseShift:Dt}=Q,Yt=wt.width+2,Qt=wt.height+2,ie=o.a(wt)?new o.R({width:Yt,height:Qt},yield o.bx(wt,-1,-1,Yt,Qt)):wt,Xe=new o.by(ct,ie,xt,Nt,Mt,At,Dt);this.loaded=this.loaded||{},this.loaded[ct]=Xe,rt(null,Xe)})}removeTile(Q){const rt=this.loaded,ct=Q.uid;rt&&rt[ct]&&delete rt[ct]}}function x(yt,Q){if(yt.length!==0){w(yt[0],Q);for(var rt=1;rt<yt.length;rt++)w(yt[rt],!Q)}}function w(yt,Q){for(var rt=0,ct=0,xt=0,wt=yt.length,Nt=wt-1;xt<wt;Nt=xt++){var Mt=(yt[xt][0]-yt[Nt][0])*(yt[Nt][1]+yt[xt][1]),At=rt+Mt;ct+=Math.abs(rt)>=Math.abs(Mt)?rt-At+Mt:Mt-At+rt,rt=At}rt+ct>=0!=!!Q&&yt.reverse()}var T=o.bz(function yt(Q,rt){var ct,xt=Q&&Q.type;if(xt==="FeatureCollection")for(ct=0;ct<Q.features.length;ct++)yt(Q.features[ct],rt);else if(xt==="GeometryCollection")for(ct=0;ct<Q.geometries.length;ct++)yt(Q.geometries[ct],rt);else if(xt==="Feature")yt(Q.geometry,rt);else if(xt==="Polygon")x(Q.coordinates,rt);else if(xt==="MultiPolygon")for(ct=0;ct<Q.coordinates.length;ct++)x(Q.coordinates[ct],rt);return Q});const E=o.bw.VectorTileFeature.prototype.toGeoJSON;var M={exports:{}},L=o.bA,F=o.bw.VectorTileFeature,O=U;function U(yt,Q){this.options=Q||{},this.features=yt,this.length=yt.length}function W(yt,Q){this.id=typeof yt.id=="number"?yt.id:void 0,this.type=yt.type,this.rawGeometry=yt.type===1?[yt.geometry]:yt.geometry,this.properties=yt.tags,this.extent=Q||4096}U.prototype.feature=function(yt){return new W(this.features[yt],this.options.extent)},W.prototype.loadGeometry=function(){var yt=this.rawGeometry;this.geometry=[];for(var Q=0;Q<yt.length;Q++){for(var rt=yt[Q],ct=[],xt=0;xt<rt.length;xt++)ct.push(new L(rt[xt][0],rt[xt][1]));this.geometry.push(ct)}return this.geometry},W.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var yt=this.geometry,Q=1/0,rt=-1/0,ct=1/0,xt=-1/0,wt=0;wt<yt.length;wt++)for(var Nt=yt[wt],Mt=0;Mt<Nt.length;Mt++){var At=Nt[Mt];Q=Math.min(Q,At.x),rt=Math.max(rt,At.x),ct=Math.min(ct,At.y),xt=Math.max(xt,At.y)}return[Q,ct,rt,xt]},W.prototype.toGeoJSON=F.prototype.toGeoJSON;var H=o.bB,j=O;function Y(yt){var Q=new H;return function(rt,ct){for(var xt in rt.layers)ct.writeMessage(3,tt,rt.layers[xt])}(yt,Q),Q.finish()}function tt(yt,Q){var rt;Q.writeVarintField(15,yt.version||1),Q.writeStringField(1,yt.name||""),Q.writeVarintField(5,yt.extent||4096);var ct={keys:[],values:[],keycache:{},valuecache:{}};for(rt=0;rt<yt.length;rt++)ct.feature=yt.feature(rt),Q.writeMessage(2,it,ct);var xt=ct.keys;for(rt=0;rt<xt.length;rt++)Q.writeStringField(3,xt[rt]);var wt=ct.values;for(rt=0;rt<wt.length;rt++)Q.writeMessage(4,Rt,wt[rt])}function it(yt,Q){var rt=yt.feature;rt.id!==void 0&&Q.writeVarintField(1,rt.id),Q.writeMessage(2,lt,yt),Q.writeVarintField(3,rt.type),Q.writeMessage(4,Ot,rt)}function lt(yt,Q){var rt=yt.feature,ct=yt.keys,xt=yt.values,wt=yt.keycache,Nt=yt.valuecache;for(var Mt in rt.properties){var At=rt.properties[Mt],Dt=wt[Mt];if(At!==null){Dt===void 0&&(ct.push(Mt),wt[Mt]=Dt=ct.length-1),Q.writeVarint(Dt);var Yt=typeof At;Yt!=="string"&&Yt!=="boolean"&&Yt!=="number"&&(At=JSON.stringify(At));var Qt=Yt+":"+At,ie=Nt[Qt];ie===void 0&&(xt.push(At),Nt[Qt]=ie=xt.length-1),Q.writeVarint(ie)}}}function ht(yt,Q){return(Q<<3)+(7&yt)}function Tt(yt){return yt<<1^yt>>31}function Ot(yt,Q){for(var rt=yt.loadGeometry(),ct=yt.type,xt=0,wt=0,Nt=rt.length,Mt=0;Mt<Nt;Mt++){var At=rt[Mt],Dt=1;ct===1&&(Dt=At.length),Q.writeVarint(ht(1,Dt));for(var Yt=ct===3?At.length-1:At.length,Qt=0;Qt<Yt;Qt++){Qt===1&&ct!==1&&Q.writeVarint(ht(2,Yt-1));var ie=At[Qt].x-xt,Xe=At[Qt].y-wt;Q.writeVarint(Tt(ie)),Q.writeVarint(Tt(Xe)),xt+=ie,wt+=Xe}ct===3&&Q.writeVarint(ht(7,1))}}function Rt(yt,Q){var rt=typeof yt;rt==="string"?Q.writeStringField(1,yt):rt==="boolean"?Q.writeBooleanField(7,yt):rt==="number"&&(yt%1!=0?Q.writeDoubleField(3,yt):yt<0?Q.writeSVarintField(6,yt):Q.writeVarintField(5,yt))}M.exports=Y,M.exports.fromVectorTileJs=Y,M.exports.fromGeojsonVt=function(yt,Q){Q=Q||{};var rt={};for(var ct in yt)rt[ct]=new j(yt[ct].features,Q),rt[ct].name=ct,rt[ct].version=Q.version,rt[ct].extent=Q.extent;return Y({layers:rt})},M.exports.GeoJSONWrapper=j;var Ut=o.bz(M.exports);const Jt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:yt=>yt},ne=Math.fround||(se=new Float32Array(1),yt=>(se[0]=+yt,se[0]));var se;const ce=3,ye=5,Qe=6;class sr{constructor(Q){this.options=Object.assign(Object.create(Jt),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:rt,minZoom:ct,maxZoom:xt}=this.options;rt&&console.time("total time");const wt=`prepare ${Q.length} points`;rt&&console.time(wt),this.points=Q;const Nt=[];for(let At=0;At<Q.length;At++){const Dt=Q[At];if(!Dt.geometry)continue;const[Yt,Qt]=Dt.geometry.coordinates,ie=ne(Ee(Yt)),Xe=ne(Ie(Qt));Nt.push(ie,Xe,1/0,At,-1,1),this.options.reduce&&Nt.push(0)}let Mt=this.trees[xt+1]=this._createTree(Nt);rt&&console.timeEnd(wt);for(let At=xt;At>=ct;At--){const Dt=+Date.now();Mt=this.trees[At]=this._createTree(this._cluster(Mt,At)),rt&&console.log("z%d: %d clusters in %dms",At,Mt.numItems,+Date.now()-Dt)}return rt&&console.timeEnd("total time"),this}getClusters(Q,rt){let ct=((Q[0]+180)%360+360)%360-180;const xt=Math.max(-90,Math.min(90,Q[1]));let wt=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const Nt=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)ct=-180,wt=180;else if(ct>wt){const Qt=this.getClusters([ct,xt,180,Nt],rt),ie=this.getClusters([-180,xt,wt,Nt],rt);return Qt.concat(ie)}const Mt=this.trees[this._limitZoom(rt)],At=Mt.range(Ee(ct),Ie(Nt),Ee(wt),Ie(xt)),Dt=Mt.data,Yt=[];for(const Qt of At){const ie=this.stride*Qt;Yt.push(Dt[ie+ye]>1?ke(Dt,ie,this.clusterProps):this.points[Dt[ie+ce]])}return Yt}getChildren(Q){const rt=this._getOriginId(Q),ct=this._getOriginZoom(Q),xt="No cluster with the specified id.",wt=this.trees[ct];if(!wt)throw new Error(xt);const Nt=wt.data;if(rt*this.stride>=Nt.length)throw new Error(xt);const Mt=this.options.radius/(this.options.extent*Math.pow(2,ct-1)),At=wt.within(Nt[rt*this.stride],Nt[rt*this.stride+1],Mt),Dt=[];for(const Yt of At){const Qt=Yt*this.stride;Nt[Qt+4]===Q&&Dt.push(Nt[Qt+ye]>1?ke(Nt,Qt,this.clusterProps):this.points[Nt[Qt+ce]])}if(Dt.length===0)throw new Error(xt);return Dt}getLeaves(Q,rt,ct){const xt=[];return this._appendLeaves(xt,Q,rt=rt||10,ct=ct||0,0),xt}getTile(Q,rt,ct){const xt=this.trees[this._limitZoom(Q)],wt=Math.pow(2,Q),{extent:Nt,radius:Mt}=this.options,At=Mt/Nt,Dt=(ct-At)/wt,Yt=(ct+1+At)/wt,Qt={features:[]};return this._addTileFeatures(xt.range((rt-At)/wt,Dt,(rt+1+At)/wt,Yt),xt.data,rt,ct,wt,Qt),rt===0&&this._addTileFeatures(xt.range(1-At/wt,Dt,1,Yt),xt.data,wt,ct,wt,Qt),rt===wt-1&&this._addTileFeatures(xt.range(0,Dt,At/wt,Yt),xt.data,-1,ct,wt,Qt),Qt.features.length?Qt:null}getClusterExpansionZoom(Q){let rt=this._getOriginZoom(Q)-1;for(;rt<=this.options.maxZoom;){const ct=this.getChildren(Q);if(rt++,ct.length!==1)break;Q=ct[0].properties.cluster_id}return rt}_appendLeaves(Q,rt,ct,xt,wt){const Nt=this.getChildren(rt);for(const Mt of Nt){const At=Mt.properties;if(At&&At.cluster?wt+At.point_count<=xt?wt+=At.point_count:wt=this._appendLeaves(Q,At.cluster_id,ct,xt,wt):wt<xt?wt++:Q.push(Mt),Q.length===ct)break}return wt}_createTree(Q){const rt=new o.av(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ct=0;ct<Q.length;ct+=this.stride)rt.add(Q[ct],Q[ct+1]);return rt.finish(),rt.data=Q,rt}_addTileFeatures(Q,rt,ct,xt,wt,Nt){for(const Mt of Q){const At=Mt*this.stride,Dt=rt[At+ye]>1;let Yt,Qt,ie;if(Dt)Yt=Ce(rt,At,this.clusterProps),Qt=rt[At],ie=rt[At+1];else{const Oe=this.points[rt[At+ce]];Yt=Oe.properties;const[qe,or]=Oe.geometry.coordinates;Qt=Ee(qe),ie=Ie(or)}const Xe={type:1,geometry:[[Math.round(this.options.extent*(Qt*wt-ct)),Math.round(this.options.extent*(ie*wt-xt))]],tags:Yt};let ar;ar=Dt||this.options.generateId?rt[At+ce]:this.points[rt[At+ce]].id,ar!==void 0&&(Xe.id=ar),Nt.features.push(Xe)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,rt){const{radius:ct,extent:xt,reduce:wt,minPoints:Nt}=this.options,Mt=ct/(xt*Math.pow(2,rt)),At=Q.data,Dt=[],Yt=this.stride;for(let Qt=0;Qt<At.length;Qt+=Yt){if(At[Qt+2]<=rt)continue;At[Qt+2]=rt;const ie=At[Qt],Xe=At[Qt+1],ar=Q.within(At[Qt],At[Qt+1],Mt),Oe=At[Qt+ye];let qe=Oe;for(const or of ar){const Hr=or*Yt;At[Hr+2]>rt&&(qe+=At[Hr+ye])}if(qe>Oe&&qe>=Nt){let or,Hr=ie*Oe,Zr=Xe*Oe,yr=-1;const xr=((Qt/Yt|0)<<5)+(rt+1)+this.points.length;for(const Ni of ar){const Kr=Ni*Yt;if(At[Kr+2]<=rt)continue;At[Kr+2]=rt;const Ii=At[Kr+ye];Hr+=At[Kr]*Ii,Zr+=At[Kr+1]*Ii,At[Kr+4]=xr,wt&&(or||(or=this._map(At,Qt,!0),yr=this.clusterProps.length,this.clusterProps.push(or)),wt(or,this._map(At,Kr)))}At[Qt+4]=xr,Dt.push(Hr/qe,Zr/qe,1/0,xr,-1,qe),wt&&Dt.push(yr)}else{for(let or=0;or<Yt;or++)Dt.push(At[Qt+or]);if(qe>1)for(const or of ar){const Hr=or*Yt;if(!(At[Hr+2]<=rt)){At[Hr+2]=rt;for(let Zr=0;Zr<Yt;Zr++)Dt.push(At[Hr+Zr])}}}}return Dt}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,rt,ct){if(Q[rt+ye]>1){const Nt=this.clusterProps[Q[rt+Qe]];return ct?Object.assign({},Nt):Nt}const xt=this.points[Q[rt+ce]].properties,wt=this.options.map(xt);return ct&&wt===xt?Object.assign({},wt):wt}}function ke(yt,Q,rt){return{type:"Feature",id:yt[Q+ce],properties:Ce(yt,Q,rt),geometry:{type:"Point",coordinates:[(ct=yt[Q],360*(ct-.5)),Se(yt[Q+1])]}};var ct}function Ce(yt,Q,rt){const ct=yt[Q+ye],xt=ct>=1e4?`${Math.round(ct/1e3)}k`:ct>=1e3?Math.round(ct/100)/10+"k":ct,wt=yt[Q+Qe],Nt=wt===-1?{}:Object.assign({},rt[wt]);return Object.assign(Nt,{cluster:!0,cluster_id:yt[Q+ce],point_count:ct,point_count_abbreviated:xt})}function Ee(yt){return yt/360+.5}function Ie(yt){const Q=Math.sin(yt*Math.PI/180),rt=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return rt<0?0:rt>1?1:rt}function Se(yt){const Q=(180-360*yt)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function Fe(yt,Q,rt,ct){for(var xt,wt=ct,Nt=rt-Q>>1,Mt=rt-Q,At=yt[Q],Dt=yt[Q+1],Yt=yt[rt],Qt=yt[rt+1],ie=Q+3;ie<rt;ie+=3){var Xe=Rr(yt[ie],yt[ie+1],At,Dt,Yt,Qt);if(Xe>wt)xt=ie,wt=Xe;else if(Xe===wt){var ar=Math.abs(ie-Nt);ar<Mt&&(xt=ie,Mt=ar)}}wt>ct&&(xt-Q>3&&Fe(yt,Q,xt,ct),yt[xt+2]=wt,rt-xt>3&&Fe(yt,xt,rt,ct))}function Rr(yt,Q,rt,ct,xt,wt){var Nt=xt-rt,Mt=wt-ct;if(Nt!==0||Mt!==0){var At=((yt-rt)*Nt+(Q-ct)*Mt)/(Nt*Nt+Mt*Mt);At>1?(rt=xt,ct=wt):At>0&&(rt+=Nt*At,ct+=Mt*At)}return(Nt=yt-rt)*Nt+(Mt=Q-ct)*Mt}function tr(yt,Q,rt,ct){var xt={id:yt===void 0?null:yt,type:Q,geometry:rt,tags:ct,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(wt){var Nt=wt.geometry,Mt=wt.type;if(Mt==="Point"||Mt==="MultiPoint"||Mt==="LineString")Vr(wt,Nt);else if(Mt==="Polygon"||Mt==="MultiLineString")for(var At=0;At<Nt.length;At++)Vr(wt,Nt[At]);else if(Mt==="MultiPolygon")for(At=0;At<Nt.length;At++)for(var Dt=0;Dt<Nt[At].length;Dt++)Vr(wt,Nt[At][Dt])}(xt),xt}function Vr(yt,Q){for(var rt=0;rt<Q.length;rt+=3)yt.minX=Math.min(yt.minX,Q[rt]),yt.minY=Math.min(yt.minY,Q[rt+1]),yt.maxX=Math.max(yt.maxX,Q[rt]),yt.maxY=Math.max(yt.maxY,Q[rt+1])}function _r(yt,Q,rt,ct){if(Q.geometry){var xt=Q.geometry.coordinates,wt=Q.geometry.type,Nt=Math.pow(rt.tolerance/((1<<rt.maxZoom)*rt.extent),2),Mt=[],At=Q.id;if(rt.promoteId?At=Q.properties[rt.promoteId]:rt.generateId&&(At=ct||0),wt==="Point")Xr(xt,Mt);else if(wt==="MultiPoint")for(var Dt=0;Dt<xt.length;Dt++)Xr(xt[Dt],Mt);else if(wt==="LineString")Hi(xt,Mt,Nt,!1);else if(wt==="MultiLineString"){if(rt.lineMetrics){for(Dt=0;Dt<xt.length;Dt++)Hi(xt[Dt],Mt=[],Nt,!1),yt.push(tr(At,"LineString",Mt,Q.properties));return}wi(xt,Mt,Nt,!1)}else if(wt==="Polygon")wi(xt,Mt,Nt,!0);else{if(wt!=="MultiPolygon"){if(wt==="GeometryCollection"){for(Dt=0;Dt<Q.geometry.geometries.length;Dt++)_r(yt,{id:At,geometry:Q.geometry.geometries[Dt],properties:Q.properties},rt,ct);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Dt=0;Dt<xt.length;Dt++){var Yt=[];wi(xt[Dt],Yt,Nt,!0),Mt.push(Yt)}}yt.push(tr(At,wt,Mt,Q.properties))}}function Xr(yt,Q){Q.push(qt(yt[0])),Q.push(Ur(yt[1])),Q.push(0)}function Hi(yt,Q,rt,ct){for(var xt,wt,Nt=0,Mt=0;Mt<yt.length;Mt++){var At=qt(yt[Mt][0]),Dt=Ur(yt[Mt][1]);Q.push(At),Q.push(Dt),Q.push(0),Mt>0&&(Nt+=ct?(xt*Dt-At*wt)/2:Math.sqrt(Math.pow(At-xt,2)+Math.pow(Dt-wt,2))),xt=At,wt=Dt}var Yt=Q.length-3;Q[2]=1,Fe(Q,0,Yt,rt),Q[Yt+2]=1,Q.size=Math.abs(Nt),Q.start=0,Q.end=Q.size}function wi(yt,Q,rt,ct){for(var xt=0;xt<yt.length;xt++){var wt=[];Hi(yt[xt],wt,rt,ct),Q.push(wt)}}function qt(yt){return yt/360+.5}function Ur(yt){var Q=Math.sin(yt*Math.PI/180),rt=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return rt<0?0:rt>1?1:rt}function wn(yt,Q,rt,ct,xt,wt,Nt,Mt){if(ct/=Q,wt>=(rt/=Q)&&Nt<ct)return yt;if(Nt<rt||wt>=ct)return null;for(var At=[],Dt=0;Dt<yt.length;Dt++){var Yt=yt[Dt],Qt=Yt.geometry,ie=Yt.type,Xe=xt===0?Yt.minX:Yt.minY,ar=xt===0?Yt.maxX:Yt.maxY;if(Xe>=rt&&ar<ct)At.push(Yt);else if(!(ar<rt||Xe>=ct)){var Oe=[];if(ie==="Point"||ie==="MultiPoint")Gr(Qt,Oe,rt,ct,xt);else if(ie==="LineString")$r(Qt,Oe,rt,ct,xt,!1,Mt.lineMetrics);else if(ie==="MultiLineString")Wo(Qt,Oe,rt,ct,xt,!1);else if(ie==="Polygon")Wo(Qt,Oe,rt,ct,xt,!0);else if(ie==="MultiPolygon")for(var qe=0;qe<Qt.length;qe++){var or=[];Wo(Qt[qe],or,rt,ct,xt,!0),or.length&&Oe.push(or)}if(Oe.length){if(Mt.lineMetrics&&ie==="LineString"){for(qe=0;qe<Oe.length;qe++)At.push(tr(Yt.id,ie,Oe[qe],Yt.tags));continue}ie!=="LineString"&&ie!=="MultiLineString"||(Oe.length===1?(ie="LineString",Oe=Oe[0]):ie="MultiLineString"),ie!=="Point"&&ie!=="MultiPoint"||(ie=Oe.length===3?"Point":"MultiPoint"),At.push(tr(Yt.id,ie,Oe,Yt.tags))}}}return At.length?At:null}function Gr(yt,Q,rt,ct,xt){for(var wt=0;wt<yt.length;wt+=3){var Nt=yt[wt+xt];Nt>=rt&&Nt<=ct&&(Q.push(yt[wt]),Q.push(yt[wt+1]),Q.push(yt[wt+2]))}}function $r(yt,Q,rt,ct,xt,wt,Nt){for(var Mt,At,Dt=Ya(yt),Yt=xt===0?Ml:uo,Qt=yt.start,ie=0;ie<yt.length-3;ie+=3){var Xe=yt[ie],ar=yt[ie+1],Oe=yt[ie+2],qe=yt[ie+3],or=yt[ie+4],Hr=xt===0?Xe:ar,Zr=xt===0?qe:or,yr=!1;Nt&&(Mt=Math.sqrt(Math.pow(Xe-qe,2)+Math.pow(ar-or,2))),Hr<rt?Zr>rt&&(At=Yt(Dt,Xe,ar,qe,or,rt),Nt&&(Dt.start=Qt+Mt*At)):Hr>ct?Zr<ct&&(At=Yt(Dt,Xe,ar,qe,or,ct),Nt&&(Dt.start=Qt+Mt*At)):Ka(Dt,Xe,ar,Oe),Zr<rt&&Hr>=rt&&(At=Yt(Dt,Xe,ar,qe,or,rt),yr=!0),Zr>ct&&Hr<=ct&&(At=Yt(Dt,Xe,ar,qe,or,ct),yr=!0),!wt&&yr&&(Nt&&(Dt.end=Qt+Mt*At),Q.push(Dt),Dt=Ya(yt)),Nt&&(Qt+=Mt)}var xr=yt.length-3;Xe=yt[xr],ar=yt[xr+1],Oe=yt[xr+2],(Hr=xt===0?Xe:ar)>=rt&&Hr<=ct&&Ka(Dt,Xe,ar,Oe),xr=Dt.length-3,wt&&xr>=3&&(Dt[xr]!==Dt[0]||Dt[xr+1]!==Dt[1])&&Ka(Dt,Dt[0],Dt[1],Dt[2]),Dt.length&&Q.push(Dt)}function Ya(yt){var Q=[];return Q.size=yt.size,Q.start=yt.start,Q.end=yt.end,Q}function Wo(yt,Q,rt,ct,xt,wt){for(var Nt=0;Nt<yt.length;Nt++)$r(yt[Nt],Q,rt,ct,xt,wt,!1)}function Ka(yt,Q,rt,ct){yt.push(Q),yt.push(rt),yt.push(ct)}function Ml(yt,Q,rt,ct,xt,wt){var Nt=(wt-Q)/(ct-Q);return yt.push(wt),yt.push(rt+(xt-rt)*Nt),yt.push(1),Nt}function uo(yt,Q,rt,ct,xt,wt){var Nt=(wt-rt)/(xt-rt);return yt.push(Q+(ct-Q)*Nt),yt.push(wt),yt.push(1),Nt}function gs(yt,Q){for(var rt=[],ct=0;ct<yt.length;ct++){var xt,wt=yt[ct],Nt=wt.type;if(Nt==="Point"||Nt==="MultiPoint"||Nt==="LineString")xt=Ja(wt.geometry,Q);else if(Nt==="MultiLineString"||Nt==="Polygon"){xt=[];for(var Mt=0;Mt<wt.geometry.length;Mt++)xt.push(Ja(wt.geometry[Mt],Q))}else if(Nt==="MultiPolygon")for(xt=[],Mt=0;Mt<wt.geometry.length;Mt++){for(var At=[],Dt=0;Dt<wt.geometry[Mt].length;Dt++)At.push(Ja(wt.geometry[Mt][Dt],Q));xt.push(At)}rt.push(tr(wt.id,Nt,xt,wt.tags))}return rt}function Ja(yt,Q){var rt=[];rt.size=yt.size,yt.start!==void 0&&(rt.start=yt.start,rt.end=yt.end);for(var ct=0;ct<yt.length;ct+=3)rt.push(yt[ct]+Q,yt[ct+1],yt[ct+2]);return rt}function de(yt,Q){if(yt.transformed)return yt;var rt,ct,xt,wt=1<<yt.z,Nt=yt.x,Mt=yt.y;for(rt=0;rt<yt.features.length;rt++){var At=yt.features[rt],Dt=At.geometry,Yt=At.type;if(At.geometry=[],Yt===1)for(ct=0;ct<Dt.length;ct+=2)At.geometry.push(Qa(Dt[ct],Dt[ct+1],Q,wt,Nt,Mt));else for(ct=0;ct<Dt.length;ct++){var Qt=[];for(xt=0;xt<Dt[ct].length;xt+=2)Qt.push(Qa(Dt[ct][xt],Dt[ct][xt+1],Q,wt,Nt,Mt));At.geometry.push(Qt)}}return yt.transformed=!0,yt}function Qa(yt,Q,rt,ct,xt,wt){return[Math.round(rt*(yt*ct-xt)),Math.round(rt*(Q*ct-wt))]}function Si(yt,Q,rt,ct,xt){for(var wt=Q===xt.maxZoom?0:xt.tolerance/((1<<Q)*xt.extent),Nt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:rt,y:ct,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Mt=0;Mt<yt.length;Mt++){Nt.numFeatures++,co(Nt,yt[Mt],wt,xt);var At=yt[Mt].minX,Dt=yt[Mt].minY,Yt=yt[Mt].maxX,Qt=yt[Mt].maxY;At<Nt.minX&&(Nt.minX=At),Dt<Nt.minY&&(Nt.minY=Dt),Yt>Nt.maxX&&(Nt.maxX=Yt),Qt>Nt.maxY&&(Nt.maxY=Qt)}return Nt}function co(yt,Q,rt,ct){var xt=Q.geometry,wt=Q.type,Nt=[];if(wt==="Point"||wt==="MultiPoint")for(var Mt=0;Mt<xt.length;Mt+=3)Nt.push(xt[Mt]),Nt.push(xt[Mt+1]),yt.numPoints++,yt.numSimplified++;else if(wt==="LineString")vs(Nt,xt,yt,rt,!1,!1);else if(wt==="MultiLineString"||wt==="Polygon")for(Mt=0;Mt<xt.length;Mt++)vs(Nt,xt[Mt],yt,rt,wt==="Polygon",Mt===0);else if(wt==="MultiPolygon")for(var At=0;At<xt.length;At++){var Dt=xt[At];for(Mt=0;Mt<Dt.length;Mt++)vs(Nt,Dt[Mt],yt,rt,!0,Mt===0)}if(Nt.length){var Yt=Q.tags||null;if(wt==="LineString"&&ct.lineMetrics){for(var Qt in Yt={},Q.tags)Yt[Qt]=Q.tags[Qt];Yt.mapbox_clip_start=xt.start/xt.size,Yt.mapbox_clip_end=xt.end/xt.size}var ie={geometry:Nt,type:wt==="Polygon"||wt==="MultiPolygon"?3:wt==="LineString"||wt==="MultiLineString"?2:1,tags:Yt};Q.id!==null&&(ie.id=Q.id),yt.features.push(ie)}}function vs(yt,Q,rt,ct,xt,wt){var Nt=ct*ct;if(ct>0&&Q.size<(xt?Nt:ct))rt.numPoints+=Q.length/3;else{for(var Mt=[],At=0;At<Q.length;At+=3)(ct===0||Q[At+2]>Nt)&&(rt.numSimplified++,Mt.push(Q[At]),Mt.push(Q[At+1])),rt.numPoints++;xt&&function(Dt,Yt){for(var Qt=0,ie=0,Xe=Dt.length,ar=Xe-2;ie<Xe;ar=ie,ie+=2)Qt+=(Dt[ie]-Dt[ar])*(Dt[ie+1]+Dt[ar+1]);if(Qt>0===Yt)for(ie=0,Xe=Dt.length;ie<Xe/2;ie+=2){var Oe=Dt[ie],qe=Dt[ie+1];Dt[ie]=Dt[Xe-2-ie],Dt[ie+1]=Dt[Xe-1-ie],Dt[Xe-2-ie]=Oe,Dt[Xe-1-ie]=qe}}(Mt,wt),yt.push(Mt)}}function ge(yt,Q){var rt=(Q=this.options=function(xt,wt){for(var Nt in wt)xt[Nt]=wt[Nt];return xt}(Object.create(this.options),Q)).debug;if(rt&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");var ct=function(xt,wt){var Nt=[];if(xt.type==="FeatureCollection")for(var Mt=0;Mt<xt.features.length;Mt++)_r(Nt,xt.features[Mt],wt,Mt);else _r(Nt,xt.type==="Feature"?xt:{geometry:xt},wt);return Nt}(yt,Q);this.tiles={},this.tileCoords=[],rt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ct=function(xt,wt){var Nt=wt.buffer/wt.extent,Mt=xt,At=wn(xt,1,-1-Nt,Nt,0,-1,2,wt),Dt=wn(xt,1,1-Nt,2+Nt,0,-1,2,wt);return(At||Dt)&&(Mt=wn(xt,1,-Nt,1+Nt,0,-1,2,wt)||[],At&&(Mt=gs(At,1).concat(Mt)),Dt&&(Mt=Mt.concat(gs(Dt,-1)))),Mt}(ct,Q),ct.length&&this.splitTile(ct,0,0,0),rt&&(ct.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function fr(yt,Q,rt){return 32*((1<<yt)*rt+Q)+yt}function ur(yt,Q){return Q?yt.properties[Q]:yt.id}function Sn(yt,Q){if(yt==null)return!0;if(yt.type==="Feature")return ur(yt,Q)!=null;if(yt.type==="FeatureCollection"){const rt=new Set;for(const ct of yt.features){const xt=ur(ct,Q);if(xt==null||rt.has(xt))return!1;rt.add(xt)}return!0}return!1}function Aa(yt,Q){const rt=new Map;if(yt!=null)if(yt.type==="Feature")rt.set(ur(yt,Q),yt);else for(const ct of yt.features)rt.set(ur(ct,Q),ct);return rt}ge.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ge.prototype.splitTile=function(yt,Q,rt,ct,xt,wt,Nt){for(var Mt=[yt,Q,rt,ct],At=this.options,Dt=At.debug;Mt.length;){ct=Mt.pop(),rt=Mt.pop(),Q=Mt.pop(),yt=Mt.pop();var Yt=1<<Q,Qt=fr(Q,rt,ct),ie=this.tiles[Qt];if(!ie&&(Dt>1&&console.time("creation"),ie=this.tiles[Qt]=Si(yt,Q,rt,ct,At),this.tileCoords.push({z:Q,x:rt,y:ct}),Dt)){Dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,rt,ct,ie.numFeatures,ie.numPoints,ie.numSimplified),console.timeEnd("creation"));var Xe="z"+Q;this.stats[Xe]=(this.stats[Xe]||0)+1,this.total++}if(ie.source=yt,xt){if(Q===At.maxZoom||Q===xt)continue;var ar=1<<xt-Q;if(rt!==Math.floor(wt/ar)||ct!==Math.floor(Nt/ar))continue}else if(Q===At.indexMaxZoom||ie.numPoints<=At.indexMaxPoints)continue;if(ie.source=null,yt.length!==0){Dt>1&&console.time("clipping");var Oe,qe,or,Hr,Zr,yr,xr=.5*At.buffer/At.extent,Ni=.5-xr,Kr=.5+xr,Ii=1+xr;Oe=qe=or=Hr=null,Zr=wn(yt,Yt,rt-xr,rt+Kr,0,ie.minX,ie.maxX,At),yr=wn(yt,Yt,rt+Ni,rt+Ii,0,ie.minX,ie.maxX,At),yt=null,Zr&&(Oe=wn(Zr,Yt,ct-xr,ct+Kr,1,ie.minY,ie.maxY,At),qe=wn(Zr,Yt,ct+Ni,ct+Ii,1,ie.minY,ie.maxY,At),Zr=null),yr&&(or=wn(yr,Yt,ct-xr,ct+Kr,1,ie.minY,ie.maxY,At),Hr=wn(yr,Yt,ct+Ni,ct+Ii,1,ie.minY,ie.maxY,At),yr=null),Dt>1&&console.timeEnd("clipping"),Mt.push(Oe||[],Q+1,2*rt,2*ct),Mt.push(qe||[],Q+1,2*rt,2*ct+1),Mt.push(or||[],Q+1,2*rt+1,2*ct),Mt.push(Hr||[],Q+1,2*rt+1,2*ct+1)}}},ge.prototype.getTile=function(yt,Q,rt){var ct=this.options,xt=ct.extent,wt=ct.debug;if(yt<0||yt>24)return null;var Nt=1<<yt,Mt=fr(yt,Q=(Q%Nt+Nt)%Nt,rt);if(this.tiles[Mt])return de(this.tiles[Mt],xt);wt>1&&console.log("drilling down to z%d-%d-%d",yt,Q,rt);for(var At,Dt=yt,Yt=Q,Qt=rt;!At&&Dt>0;)Dt--,Yt=Math.floor(Yt/2),Qt=Math.floor(Qt/2),At=this.tiles[fr(Dt,Yt,Qt)];return At&&At.source?(wt>1&&console.log("found parent tile z%d-%d-%d",Dt,Yt,Qt),wt>1&&console.time("drilling down"),this.splitTile(At.source,Dt,Yt,Qt,yt,Q,rt),wt>1&&console.timeEnd("drilling down"),this.tiles[Mt]?de(this.tiles[Mt],xt):null):null};class dr extends v{constructor(Q,rt,ct,xt){super(Q,rt,ct),this._dataUpdateable=new Map,this.loadGeoJSON=(wt,Nt)=>{const{promoteId:Mt}=wt;if(wt.request)return o.f(wt.request,(At,Dt,Yt,Qt)=>{this._dataUpdateable=Sn(Dt,Mt)?Aa(Dt,Mt):void 0,Nt(At,Dt,Yt,Qt)});if(typeof wt.data=="string")try{const At=JSON.parse(wt.data);this._dataUpdateable=Sn(At,Mt)?Aa(At,Mt):void 0,Nt(null,At)}catch{Nt(new Error(`Input data given to '${wt.source}' is not a valid GeoJSON object.`))}else wt.dataDiff?this._dataUpdateable?(function(At,Dt,Yt){var Qt,ie,Xe,ar;if(Dt.removeAll&&At.clear(),Dt.remove)for(const Oe of Dt.remove)At.delete(Oe);if(Dt.add)for(const Oe of Dt.add){const qe=ur(Oe,Yt);qe!=null&&At.set(qe,Oe)}if(Dt.update)for(const Oe of Dt.update){let qe=At.get(Oe.id);if(qe==null)continue;const or=!Oe.removeAllProperties&&(((Qt=Oe.removeProperties)===null||Qt===void 0?void 0:Qt.length)>0||((ie=Oe.addOrUpdateProperties)===null||ie===void 0?void 0:ie.length)>0);if((Oe.newGeometry||Oe.removeAllProperties||or)&&(qe=Object.assign({},qe),At.set(Oe.id,qe),or&&(qe.properties=Object.assign({},qe.properties))),Oe.newGeometry&&(qe.geometry=Oe.newGeometry),Oe.removeAllProperties)qe.properties={};else if(((Xe=Oe.removeProperties)===null||Xe===void 0?void 0:Xe.length)>0)for(const Hr of Oe.removeProperties)Object.prototype.hasOwnProperty.call(qe.properties,Hr)&&delete qe.properties[Hr];if(((ar=Oe.addOrUpdateProperties)===null||ar===void 0?void 0:ar.length)>0)for(const{key:Hr,value:Zr}of Oe.addOrUpdateProperties)qe.properties[Hr]=Zr}}(this._dataUpdateable,wt.dataDiff,Mt),Nt(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Nt(new Error(`Cannot update existing geojson data in ${wt.source}`)):Nt(new Error(`Input data given to '${wt.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,xt&&(this.loadGeoJSON=xt)}loadGeoJSONTile(Q,rt){const ct=Q.tileID.canonical;if(!this._geoJSONIndex)return rt(null,null);const xt=this._geoJSONIndex.getTile(ct.z,ct.x,ct.y);if(!xt)return rt(null,null);const wt=new class{constructor(Mt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.N,this.length=Mt.length,this._features=Mt}feature(Mt){return new class{constructor(At){this._feature=At,this.extent=o.N,this.type=At.type,this.properties=At.tags,"id"in At&&!isNaN(At.id)&&(this.id=parseInt(At.id,10))}loadGeometry(){if(this._feature.type===1){const At=[];for(const Dt of this._feature.geometry)At.push([new o.P(Dt[0],Dt[1])]);return At}{const At=[];for(const Dt of this._feature.geometry){const Yt=[];for(const Qt of Dt)Yt.push(new o.P(Qt[0],Qt[1]));At.push(Yt)}return At}}toGeoJSON(At,Dt,Yt){return E.call(this,At,Dt,Yt)}}(this._features[Mt])}}(xt.features);let Nt=Ut(wt);Nt.byteOffset===0&&Nt.byteLength===Nt.buffer.byteLength||(Nt=new Uint8Array(Nt)),rt(null,{vectorTile:wt,rawData:Nt.buffer})}loadData(Q,rt){var ct;(ct=this._pendingRequest)===null||ct===void 0||ct.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const xt=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new o.bu(Q.request);this._pendingCallback=rt,this._pendingRequest=this.loadGeoJSON(Q,(wt,Nt)=>{if(delete this._pendingCallback,delete this._pendingRequest,wt||!Nt)return rt(wt);if(typeof Nt!="object")return rt(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));{T(Nt,!0);try{if(Q.filter){const At=o.bC(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(At.result==="error")throw new Error(At.value.map(Yt=>`${Yt.key}: ${Yt.message}`).join(", "));Nt={type:"FeatureCollection",features:Nt.features.filter(Yt=>At.value.evaluate({zoom:0},Yt))}}this._geoJSONIndex=Q.cluster?new sr(function({superclusterOptions:At,clusterProperties:Dt}){if(!Dt||!At)return At;const Yt={},Qt={},ie={accumulated:null,zoom:0},Xe={properties:null},ar=Object.keys(Dt);for(const Oe of ar){const[qe,or]=Dt[Oe],Hr=o.bC(or),Zr=o.bC(typeof qe=="string"?[qe,["accumulated"],["get",Oe]]:qe);Yt[Oe]=Hr.value,Qt[Oe]=Zr.value}return At.map=Oe=>{Xe.properties=Oe;const qe={};for(const or of ar)qe[or]=Yt[or].evaluate(ie,Xe);return qe},At.reduce=(Oe,qe)=>{Xe.properties=qe;for(const or of ar)ie.accumulated=Oe[or],Oe[or]=Qt[or].evaluate(ie,Xe)},At}(Q)).load(Nt.features):function(At,Dt){return new ge(At,Dt)}(Nt,Q.geojsonVtOptions)}catch(At){return rt(At)}this.loaded={};const Mt={};if(xt){const At=xt.finish();At&&(Mt.resourceTiming={},Mt.resourceTiming[Q.source]=JSON.parse(JSON.stringify(At)))}rt(null,Mt)}})}reloadTile(Q,rt){const ct=this.loaded;return ct&&ct[Q.uid]?super.reloadTile(Q,rt):this.loadTile(Q,rt)}removeSource(Q,rt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),rt()}getClusterExpansionZoom(Q,rt){try{rt(null,this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId))}catch(ct){rt(ct)}}getClusterChildren(Q,rt){try{rt(null,this._geoJSONIndex.getChildren(Q.clusterId))}catch(ct){rt(ct)}}getClusterLeaves(Q,rt){try{rt(null,this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset))}catch(ct){rt(ct)}}}class Ca{constructor(Q){this.self=Q,this.actor=new o.C(Q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:v,geojson:dr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(rt,ct)=>{if(this.workerSourceTypes[rt])throw new Error(`Worker source with name "${rt}" already registered.`);this.workerSourceTypes[rt]=ct},this.self.registerRTLTextPlugin=rt=>{if(o.bD.isParsed())throw new Error("RTL text plugin already registered.");o.bD.applyArabicShaping=rt.applyArabicShaping,o.bD.processBidirectionalText=rt.processBidirectionalText,o.bD.processStyledBidirectionalText=rt.processStyledBidirectionalText}}setReferrer(Q,rt){this.referrer=rt}setImages(Q,rt,ct){this.availableImages[Q]=rt;for(const xt in this.workerSources[Q]){const wt=this.workerSources[Q][xt];for(const Nt in wt)wt[Nt].availableImages=rt}ct()}setLayers(Q,rt,ct){this.getLayerIndex(Q).replace(rt),ct()}updateLayers(Q,rt,ct){this.getLayerIndex(Q).update(rt.layers,rt.removedIds),ct()}loadTile(Q,rt,ct){this.getWorkerSource(Q,rt.type,rt.source).loadTile(rt,ct)}loadDEMTile(Q,rt,ct){this.getDEMWorkerSource(Q,rt.source).loadTile(rt,ct)}reloadTile(Q,rt,ct){this.getWorkerSource(Q,rt.type,rt.source).reloadTile(rt,ct)}abortTile(Q,rt,ct){this.getWorkerSource(Q,rt.type,rt.source).abortTile(rt,ct)}removeTile(Q,rt,ct){this.getWorkerSource(Q,rt.type,rt.source).removeTile(rt,ct)}removeDEMTile(Q,rt){this.getDEMWorkerSource(Q,rt.source).removeTile(rt)}removeSource(Q,rt,ct){if(!this.workerSources[Q]||!this.workerSources[Q][rt.type]||!this.workerSources[Q][rt.type][rt.source])return;const xt=this.workerSources[Q][rt.type][rt.source];delete this.workerSources[Q][rt.type][rt.source],xt.removeSource!==void 0?xt.removeSource(rt,ct):ct()}loadWorkerSource(Q,rt,ct){try{this.self.importScripts(rt.url),ct()}catch(xt){ct(xt.toString())}}syncRTLPluginState(Q,rt,ct){try{o.bD.setState(rt);const xt=o.bD.getPluginURL();if(o.bD.isLoaded()&&!o.bD.isParsed()&&xt!=null){this.self.importScripts(xt);const wt=o.bD.isParsed();ct(wt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${xt}`),wt)}}catch(xt){ct(xt.toString())}}getAvailableImages(Q){let rt=this.availableImages[Q];return rt||(rt=[]),rt}getLayerIndex(Q){let rt=this.layerIndexes[Q];return rt||(rt=this.layerIndexes[Q]=new l),rt}getWorkerSource(Q,rt,ct){return this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][rt]||(this.workerSources[Q][rt]={}),this.workerSources[Q][rt][ct]||(this.workerSources[Q][rt][ct]=new this.workerSourceTypes[rt]({send:(xt,wt,Nt)=>{this.actor.send(xt,wt,Nt,Q)}},this.getLayerIndex(Q),this.getAvailableImages(Q))),this.workerSources[Q][rt][ct]}getDEMWorkerSource(Q,rt){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][rt]||(this.demWorkerSources[Q][rt]=new y),this.demWorkerSources[Q][rt]}}return o.i()&&(self.worker=new Ca(self)),Ca}),a(["./shared"],function(o){var l="3.6.2";class u{static testProp(d){if(!u.docStyle)return d[0];for(let _=0;_<d.length;_++)if(d[_]in u.docStyle)return d[_];return d[0]}static create(d,_,S){const C=window.document.createElement(d);return _!==void 0&&(C.className=_),S&&S.appendChild(C),C}static createNS(d,_){return window.document.createElementNS(d,_)}static disableDrag(){u.docStyle&&u.selectProp&&(u.userSelect=u.docStyle[u.selectProp],u.docStyle[u.selectProp]="none")}static enableDrag(){u.docStyle&&u.selectProp&&(u.docStyle[u.selectProp]=u.userSelect)}static setTransform(d,_){d.style[u.transformProp]=_}static addEventListener(d,_,S,C={}){d.addEventListener(_,S,"passive"in C?C:C.capture)}static removeEventListener(d,_,S,C={}){d.removeEventListener(_,S,"passive"in C?C:C.capture)}static suppressClickInternal(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",u.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",u.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",u.suppressClickInternal,!0)},0)}static mousePos(d,_){const S=d.getBoundingClientRect();return new o.P(_.clientX-S.left-d.clientLeft,_.clientY-S.top-d.clientTop)}static touchPos(d,_){const S=d.getBoundingClientRect(),C=[];for(let R=0;R<_.length;R++)C.push(new o.P(_[R].clientX-S.left-d.clientLeft,_[R].clientY-S.top-d.clientTop));return C}static mouseButton(d){return d.button}static remove(d){d.parentNode&&d.parentNode.removeChild(d)}}u.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,u.selectProp=u.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),u.transformProp=u.testProp(["transform","WebkitTransform"]);const c={supported:!1,testSupport:function(I){!v&&p&&(y?x(I):h=I)}};let h,p,v=!1,y=!1;function x(I){const d=I.createTexture();I.bindTexture(I.TEXTURE_2D,d);try{if(I.texImage2D(I.TEXTURE_2D,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,p),I.isContextLost())return;c.supported=!0}catch{}I.deleteTexture(d),v=!0}var w,T;typeof document<"u"&&(p=document.createElement("img"),p.onload=function(){h&&x(h),h=null,y=!0},p.onerror=function(){v=!0,h=null},p.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(I){let d,_,S,C;I.resetRequestQueue=()=>{d=[],_=0,S=0,C={}},I.addThrottleControl=G=>{const Z=S++;return C[Z]=G,Z},I.removeThrottleControl=G=>{delete C[G],B()},I.getImage=(G,Z,q=!0)=>{c.supported&&(G.headers||(G.headers={}),G.headers.accept="image/webp,*/*");const nt={requestParameters:G,supportImageRefresh:q,callback:Z,cancelled:!1,completed:!1,cancel:()=>{nt.completed||nt.cancelled||(nt.cancelled=!0,nt.innerRequest&&(nt.innerRequest.cancel(),_--),B())}};return d.push(nt),B(),nt};const R=G=>{const{requestParameters:Z,supportImageRefresh:q,callback:nt}=G;return o.e(Z,{type:"image"}),(q!==!1||o.i()||o.g(Z.url)||Z.headers&&!Object.keys(Z.headers).reduce((vt,gt)=>vt&&gt==="accept",!0)?o.m:V)(Z,(vt,gt,_t,dt)=>{N(G,nt,vt,gt,_t,dt)})},N=(G,Z,q,nt,vt,gt)=>{q?Z(q):nt instanceof HTMLImageElement||o.a(nt)?Z(null,nt):nt&&((_t,dt)=>{typeof createImageBitmap=="function"?o.b(_t,dt):o.d(_t,dt)})(nt,(_t,dt)=>{_t!=null?Z(_t):dt!=null&&Z(null,dt,{cacheControl:vt,expires:gt})}),G.cancelled||(G.completed=!0,_--,B())},B=()=>{const G=(()=>{const Z=Object.keys(C);let q=!1;if(Z.length>0){for(const nt of Z)if(q=C[nt](),q)break}return q})()?o.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let Z=_;Z<G&&d.length>0;Z++){const q=d.shift();if(q.cancelled){Z--;continue}const nt=R(q);_++,q.innerRequest=nt}},V=(G,Z)=>{const q=new Image,nt=G.url;let vt=!1;const gt=G.credentials;return gt&&gt==="include"?q.crossOrigin="use-credentials":(gt&&gt==="same-origin"||!o.s(nt))&&(q.crossOrigin="anonymous"),q.fetchPriority="high",q.onload=()=>{Z(null,q),q.onerror=q.onload=null},q.onerror=()=>{vt||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),q.onerror=q.onload=null},q.src=nt,{cancel:()=>{vt=!0,q.src=""}}}}(w||(w={})),w.resetRequestQueue(),function(I){I.Glyphs="Glyphs",I.Image="Image",I.Source="Source",I.SpriteImage="SpriteImage",I.SpriteJSON="SpriteJSON",I.Style="Style",I.Tile="Tile",I.Unknown="Unknown"}(T||(T={}));class E{constructor(d){this._transformRequestFn=d}transformRequest(d,_){return this._transformRequestFn&&this._transformRequestFn(d,_)||{url:d}}normalizeSpriteURL(d,_,S){const C=function(R){const N=R.match(M);if(!N)throw new Error(`Unable to parse URL "${R}"`);return{protocol:N[1],authority:N[2],path:N[3]||"/",params:N[4]?N[4].split("&"):[]}}(d);return C.path+=`${_}${S}`,function(R){const N=R.params.length?`?${R.params.join("&")}`:"";return`${R.protocol}://${R.authority}${R.path}${N}`}(C)}setTransformRequest(d){this._transformRequestFn=d}}const M=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function L(I){var d=new o.A(3);return d[0]=I[0],d[1]=I[1],d[2]=I[2],d}var F,O=function(I,d,_){return I[0]=d[0]-_[0],I[1]=d[1]-_[1],I[2]=d[2]-_[2],I};F=new o.A(3),o.A!=Float32Array&&(F[0]=0,F[1]=0,F[2]=0);var U=function(I){var d=I[0],_=I[1];return d*d+_*_};function W(I){const d=[];if(typeof I=="string")d.push({id:"default",url:I});else if(I&&I.length>0){const _=[];for(const{id:S,url:C}of I){const R=`${S}${C}`;_.indexOf(R)===-1&&(_.push(R),d.push({id:S,url:C}))}}return d}function H(I,d,_,S,C){if(S)return void I(S);if(C!==Object.values(d).length||C!==Object.values(_).length)return;const R={};for(const N in d){R[N]={};const B=o.h.getImageCanvasContext(_[N]),V=d[N];for(const G in V){const{width:Z,height:q,x:nt,y:vt,sdf:gt,pixelRatio:_t,stretchX:dt,stretchY:Pt,content:$t}=V[G];R[N][G]={data:null,pixelRatio:_t,sdf:gt,stretchX:dt,stretchY:Pt,content:$t,spriteData:{width:Z,height:q,x:nt,y:vt,context:B}}}}I(null,R)}(function(){var I=new o.A(2);o.A!=Float32Array&&(I[0]=0,I[1]=0)})();class j{constructor(d,_,S,C){this.context=d,this.format=S,this.texture=d.gl.createTexture(),this.update(_,C)}update(d,_,S){const{width:C,height:R}=d,N=!(this.size&&this.size[0]===C&&this.size[1]===R||S),{context:B}=this,{gl:V}=B;if(this.useMipmap=!!(_&&_.useMipmap),V.bindTexture(V.TEXTURE_2D,this.texture),B.pixelStoreUnpackFlipY.set(!1),B.pixelStoreUnpack.set(1),B.pixelStoreUnpackPremultiplyAlpha.set(this.format===V.RGBA&&(!_||_.premultiply!==!1)),N)this.size=[C,R],d instanceof HTMLImageElement||d instanceof HTMLCanvasElement||d instanceof HTMLVideoElement||d instanceof ImageData||o.a(d)?V.texImage2D(V.TEXTURE_2D,0,this.format,this.format,V.UNSIGNED_BYTE,d):V.texImage2D(V.TEXTURE_2D,0,this.format,C,R,0,this.format,V.UNSIGNED_BYTE,d.data);else{const{x:G,y:Z}=S||{x:0,y:0};d instanceof HTMLImageElement||d instanceof HTMLCanvasElement||d instanceof HTMLVideoElement||d instanceof ImageData||o.a(d)?V.texSubImage2D(V.TEXTURE_2D,0,G,Z,V.RGBA,V.UNSIGNED_BYTE,d):V.texSubImage2D(V.TEXTURE_2D,0,G,Z,C,R,V.RGBA,V.UNSIGNED_BYTE,d.data)}this.useMipmap&&this.isSizePowerOfTwo()&&V.generateMipmap(V.TEXTURE_2D)}bind(d,_,S){const{context:C}=this,{gl:R}=C;R.bindTexture(R.TEXTURE_2D,this.texture),S!==R.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(S=R.LINEAR),d!==this.filter&&(R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,d),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,S||d),this.filter=d),_!==this.wrap&&(R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,_),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,_),this.wrap=_)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:d}=this.context;d.deleteTexture(this.texture),this.texture=null}}function Y(I){const{userImage:d}=I;return!!(d&&d.render&&d.render())&&(I.data.replace(new Uint8Array(d.data.buffer)),!0)}class tt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(d){if(this.loaded!==d&&(this.loaded=d,d)){for(const{ids:_,callback:S}of this.requestors)this._notify(_,S);this.requestors=[]}}getImage(d){const _=this.images[d];if(_&&!_.data&&_.spriteData){const S=_.spriteData;_.data=new o.R({width:S.width,height:S.height},S.context.getImageData(S.x,S.y,S.width,S.height).data),_.spriteData=null}return _}addImage(d,_){if(this.images[d])throw new Error(`Image id ${d} already exist, use updateImage instead`);this._validate(d,_)&&(this.images[d]=_)}_validate(d,_){let S=!0;const C=_.data||_.spriteData;return this._validateStretch(_.stretchX,C&&C.width)||(this.fire(new o.j(new Error(`Image "${d}" has invalid "stretchX" value`))),S=!1),this._validateStretch(_.stretchY,C&&C.height)||(this.fire(new o.j(new Error(`Image "${d}" has invalid "stretchY" value`))),S=!1),this._validateContent(_.content,_)||(this.fire(new o.j(new Error(`Image "${d}" has invalid "content" value`))),S=!1),S}_validateStretch(d,_){if(!d)return!0;let S=0;for(const C of d){if(C[0]<S||C[1]<C[0]||_<C[1])return!1;S=C[1]}return!0}_validateContent(d,_){if(!d)return!0;if(d.length!==4)return!1;const S=_.spriteData,C=S&&S.width||_.data.width,R=S&&S.height||_.data.height;return!(d[0]<0||C<d[0]||d[1]<0||R<d[1]||d[2]<0||C<d[2]||d[3]<0||R<d[3]||d[2]<d[0]||d[3]<d[1])}updateImage(d,_,S=!0){const C=this.getImage(d);if(S&&(C.data.width!==_.data.width||C.data.height!==_.data.height))throw new Error(`size mismatch between old image (${C.data.width}x${C.data.height}) and new image (${_.data.width}x${_.data.height}).`);_.version=C.version+1,this.images[d]=_,this.updatedImages[d]=!0}removeImage(d){const _=this.images[d];delete this.images[d],delete this.patterns[d],_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(d,_){let S=!0;if(!this.isLoaded())for(const C of d)this.images[C]||(S=!1);this.isLoaded()||S?this._notify(d,_):this.requestors.push({ids:d,callback:_})}_notify(d,_){const S={};for(const C of d){let R=this.getImage(C);R||(this.fire(new o.k("styleimagemissing",{id:C})),R=this.getImage(C)),R?S[C]={data:R.data.clone(),pixelRatio:R.pixelRatio,sdf:R.sdf,version:R.version,stretchX:R.stretchX,stretchY:R.stretchY,content:R.content,hasRenderCallback:!!(R.userImage&&R.userImage.render)}:o.w(`Image "${C}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}_(null,S)}getPixelSize(){const{width:d,height:_}=this.atlasImage;return{width:d,height:_}}getPattern(d){const _=this.patterns[d],S=this.getImage(d);if(!S)return null;if(_&&_.position.version===S.version)return _.position;if(_)_.position.version=S.version;else{const C={w:S.data.width+2,h:S.data.height+2,x:0,y:0},R=new o.I(C,S);this.patterns[d]={bin:C,position:R}}return this._updatePatternAtlas(),this.patterns[d].position}bind(d){const _=d.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new j(d,this.atlasImage,_.RGBA),this.atlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(){const d=[];for(const R in this.patterns)d.push(this.patterns[R].bin);const{w:_,h:S}=o.p(d),C=this.atlasImage;C.resize({width:_||1,height:S||1});for(const R in this.patterns){const{bin:N}=this.patterns[R],B=N.x+1,V=N.y+1,G=this.getImage(R).data,Z=G.width,q=G.height;o.R.copy(G,C,{x:0,y:0},{x:B,y:V},{width:Z,height:q}),o.R.copy(G,C,{x:0,y:q-1},{x:B,y:V-1},{width:Z,height:1}),o.R.copy(G,C,{x:0,y:0},{x:B,y:V+q},{width:Z,height:1}),o.R.copy(G,C,{x:Z-1,y:0},{x:B-1,y:V},{width:1,height:q}),o.R.copy(G,C,{x:0,y:0},{x:B+Z,y:V},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(d){for(const _ of d){if(this.callbackDispatchedThisFrame[_])continue;this.callbackDispatchedThisFrame[_]=!0;const S=this.getImage(_);S||o.w(`Image with ID: "${_}" was not found`),Y(S)&&this.updateImage(_,S)}}}const it=1e20;function lt(I,d,_,S,C,R,N,B,V){for(let G=d;G<d+S;G++)ht(I,_*R+G,R,C,N,B,V);for(let G=_;G<_+C;G++)ht(I,G*R+d,1,S,N,B,V)}function ht(I,d,_,S,C,R,N){R[0]=0,N[0]=-it,N[1]=it,C[0]=I[d];for(let B=1,V=0,G=0;B<S;B++){C[B]=I[d+B*_];const Z=B*B;do{const q=R[V];G=(C[B]-C[q]+Z-q*q)/(B-q)/2}while(G<=N[V]&&--V>-1);V++,R[V]=B,N[V]=G,N[V+1]=it}for(let B=0,V=0;B<S;B++){for(;N[V+1]<B;)V++;const G=R[V],Z=B-G;I[d+B*_]=C[G]+Z*Z}}class Tt{constructor(d,_){this.requestManager=d,this.localIdeographFontFamily=_,this.entries={}}setURL(d){this.url=d}getGlyphs(d,_){const S=[];for(const C in d)for(const R of d[C])S.push({stack:C,id:R});o.o(S,({stack:C,id:R},N)=>{let B=this.entries[C];B||(B=this.entries[C]={glyphs:{},requests:{},ranges:{}});let V=B.glyphs[R];if(V!==void 0)return void N(null,{stack:C,id:R,glyph:V});if(V=this._tinySDF(B,C,R),V)return B.glyphs[R]=V,void N(null,{stack:C,id:R,glyph:V});const G=Math.floor(R/256);if(256*G>65535)return void N(new Error("glyphs > 65535 not supported"));if(B.ranges[G])return void N(null,{stack:C,id:R,glyph:V});if(!this.url)return void N(new Error("glyphsUrl is not set"));let Z=B.requests[G];Z||(Z=B.requests[G]=[],Tt.loadGlyphRange(C,G,this.url,this.requestManager,(q,nt)=>{if(nt){for(const vt in nt)this._doesCharSupportLocalGlyph(+vt)||(B.glyphs[+vt]=nt[+vt]);B.ranges[G]=!0}for(const vt of Z)vt(q,nt);delete B.requests[G]})),Z.push((q,nt)=>{q?N(q):nt&&N(null,{stack:C,id:R,glyph:nt[R]||null})})},(C,R)=>{if(C)_(C);else if(R){const N={};for(const{stack:B,id:V,glyph:G}of R)(N[B]||(N[B]={}))[V]=G&&{id:G.id,bitmap:G.bitmap.clone(),metrics:G.metrics};_(null,N)}})}_doesCharSupportLocalGlyph(d){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](d)||o.u["Hangul Syllables"](d)||o.u.Hiragana(d)||o.u.Katakana(d))}_tinySDF(d,_,S){const C=this.localIdeographFontFamily;if(!C||!this._doesCharSupportLocalGlyph(S))return;let R=d.tinySDF;if(!R){let B="400";/bold/i.test(_)?B="900":/medium/i.test(_)?B="500":/light/i.test(_)&&(B="200"),R=d.tinySDF=new Tt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:C,fontWeight:B})}const N=R.draw(String.fromCharCode(S));return{id:S,bitmap:new o.q({width:N.width||60,height:N.height||60},N.data),metrics:{width:N.glyphWidth/2||24,height:N.glyphHeight/2||24,left:N.glyphLeft/2+.5||0,top:N.glyphTop/2-27.5||-8,advance:N.glyphAdvance/2||24,isDoubleResolution:!0}}}}Tt.loadGlyphRange=function(I,d,_,S,C){const R=256*d,N=R+255,B=S.transformRequest(_.replace("{fontstack}",I).replace("{range}",`${R}-${N}`),T.Glyphs);o.l(B,(V,G)=>{if(V)C(V);else if(G){const Z={};for(const q of o.n(G))Z[q.id]=q;C(null,Z)}})},Tt.TinySDF=class{constructor({fontSize:I=24,buffer:d=3,radius:_=8,cutoff:S=.25,fontFamily:C="sans-serif",fontWeight:R="normal",fontStyle:N="normal"}={}){this.buffer=d,this.cutoff=S,this.radius=_;const B=this.size=I+4*d,V=this._createCanvas(B),G=this.ctx=V.getContext("2d",{willReadFrequently:!0});G.font=`${N} ${R} ${I}px ${C}`,G.textBaseline="alphabetic",G.textAlign="left",G.fillStyle="black",this.gridOuter=new Float64Array(B*B),this.gridInner=new Float64Array(B*B),this.f=new Float64Array(B),this.z=new Float64Array(B+1),this.v=new Uint16Array(B)}_createCanvas(I){const d=document.createElement("canvas");return d.width=d.height=I,d}draw(I){const{width:d,actualBoundingBoxAscent:_,actualBoundingBoxDescent:S,actualBoundingBoxLeft:C,actualBoundingBoxRight:R}=this.ctx.measureText(I),N=Math.ceil(_),B=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(R-C))),V=Math.min(this.size-this.buffer,N+Math.ceil(S)),G=B+2*this.buffer,Z=V+2*this.buffer,q=Math.max(G*Z,0),nt=new Uint8ClampedArray(q),vt={data:nt,width:G,height:Z,glyphWidth:B,glyphHeight:V,glyphTop:N,glyphLeft:0,glyphAdvance:d};if(B===0||V===0)return vt;const{ctx:gt,buffer:_t,gridInner:dt,gridOuter:Pt}=this;gt.clearRect(_t,_t,B,V),gt.fillText(I,_t,_t+N);const $t=gt.getImageData(_t,_t,B,V);Pt.fill(it,0,q),dt.fill(0,0,q);for(let St=0;St<V;St++)for(let Lt=0;Lt<B;Lt++){const Gt=$t.data[4*(St*B+Lt)+3]/255;if(Gt===0)continue;const Xt=(St+_t)*G+Lt+_t;if(Gt===1)Pt[Xt]=0,dt[Xt]=it;else{const ee=.5-Gt;Pt[Xt]=ee>0?ee*ee:0,dt[Xt]=ee<0?ee*ee:0}}lt(Pt,0,0,G,Z,G,this.f,this.v,this.z),lt(dt,_t,_t,B,V,G,this.f,this.v,this.z);for(let St=0;St<q;St++){const Lt=Math.sqrt(Pt[St])-Math.sqrt(dt[St]);nt[St]=Math.round(255-255*(Lt/this.radius+this.cutoff))}return vt}};class Ot{constructor(){this.specification=o.v.light.position}possiblyEvaluate(d,_){return o.z(d.expression.evaluate(_))}interpolate(d,_,S){return{x:o.B.number(d.x,_.x,S),y:o.B.number(d.y,_.y,S),z:o.B.number(d.z,_.z,S)}}}let Rt;class Ut extends o.E{constructor(d){super(),Rt=Rt||new o.r({anchor:new o.D(o.v.light.anchor),position:new Ot,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(Rt),this.setLight(d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(d,_={}){if(!this._validate(o.t,d,_))for(const S in d){const C=d[S];S.endsWith("-transition")?this._transitionable.setTransition(S.slice(0,-11),C):this._transitionable.setValue(S,C)}}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,_,S){return(!S||S.validate!==!1)&&o.x(this,d.call(o.y,o.e({value:_,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}}class Jt{constructor(d,_){this.width=d,this.height=_,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(d,_){const S=d.join(",")+String(_);return this.dashEntry[S]||(this.dashEntry[S]=this.addDash(d,_)),this.dashEntry[S]}getDashRanges(d,_,S){const C=[];let R=d.length%2==1?-d[d.length-1]*S:0,N=d[0]*S,B=!0;C.push({left:R,right:N,isDash:B,zeroLength:d[0]===0});let V=d[0];for(let G=1;G<d.length;G++){B=!B;const Z=d[G];R=V*S,V+=Z,N=V*S,C.push({left:R,right:N,isDash:B,zeroLength:Z===0})}return C}addRoundDash(d,_,S){const C=_/2;for(let R=-S;R<=S;R++){const N=this.width*(this.nextRow+S+R);let B=0,V=d[B];for(let G=0;G<this.width;G++){G/V.right>1&&(V=d[++B]);const Z=Math.abs(G-V.left),q=Math.abs(G-V.right),nt=Math.min(Z,q);let vt;const gt=R/S*(C+1);if(V.isDash){const _t=C-Math.abs(gt);vt=Math.sqrt(nt*nt+_t*_t)}else vt=C-Math.sqrt(nt*nt+gt*gt);this.data[N+G]=Math.max(0,Math.min(255,vt+128))}}}addRegularDash(d){for(let B=d.length-1;B>=0;--B){const V=d[B],G=d[B+1];V.zeroLength?d.splice(B,1):G&&G.isDash===V.isDash&&(G.left=V.left,d.splice(B,1))}const _=d[0],S=d[d.length-1];_.isDash===S.isDash&&(_.left=S.left-this.width,S.right=_.right+this.width);const C=this.width*this.nextRow;let R=0,N=d[R];for(let B=0;B<this.width;B++){B/N.right>1&&(N=d[++R]);const V=Math.abs(B-N.left),G=Math.abs(B-N.right),Z=Math.min(V,G);this.data[C+B]=Math.max(0,Math.min(255,(N.isDash?Z:-Z)+128))}}addDash(d,_){const S=_?7:0,C=2*S+1;if(this.nextRow+C>this.height)return o.w("LineAtlas out of space"),null;let R=0;for(let B=0;B<d.length;B++)R+=d[B];if(R!==0){const B=this.width/R,V=this.getDashRanges(d,this.width,B);_?this.addRoundDash(V,B,S):this.addRegularDash(V)}const N={y:(this.nextRow+S+.5)/this.height,height:2*S/this.height,width:R};return this.nextRow+=C,this.dirty=!0,N}bind(d){const _=d.gl;this.texture?(_.bindTexture(_.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,_.texSubImage2D(_.TEXTURE_2D,0,0,0,this.width,this.height,_.ALPHA,_.UNSIGNED_BYTE,this.data))):(this.texture=_.createTexture(),_.bindTexture(_.TEXTURE_2D,this.texture),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.REPEAT),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.REPEAT),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.texImage2D(_.TEXTURE_2D,0,_.ALPHA,this.width,this.height,0,_.ALPHA,_.UNSIGNED_BYTE,this.data))}}class ne{constructor(d,_,S){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=S;const C=this.workerPool.acquire(S);for(let R=0;R<C.length;R++){const N=new o.C(C[R],_,S);N.name=`Worker ${R}`,this.actors.push(N)}if(!this.actors.length)throw new Error("No actors found")}broadcast(d,_,S){o.o(this.actors,(C,R)=>{C.send(d,_,R)},S=S||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(d=!0){this.actors.forEach(_=>{_.remove()}),this.actors=[],d&&this.workerPool.release(this.id)}}function se(I,d,_){const S=function(C,R){if(C)return _(C);if(R){const N=o.F(o.e(R,I),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);R.vector_layers&&(N.vectorLayers=R.vector_layers,N.vectorLayerIds=N.vectorLayers.map(B=>B.id)),_(null,N)}};return I.url?o.f(d.transformRequest(I.url,T.Source),S):o.h.frame(()=>S(null,I))}class ce{constructor(d,_){d&&(_?this.setSouthWest(d).setNorthEast(_):Array.isArray(d)&&(d.length===4?this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]]):this.setSouthWest(d[0]).setNorthEast(d[1])))}setNorthEast(d){return this._ne=d instanceof o.L?new o.L(d.lng,d.lat):o.L.convert(d),this}setSouthWest(d){return this._sw=d instanceof o.L?new o.L(d.lng,d.lat):o.L.convert(d),this}extend(d){const _=this._sw,S=this._ne;let C,R;if(d instanceof o.L)C=d,R=d;else{if(!(d instanceof ce))return Array.isArray(d)?d.length===4||d.every(Array.isArray)?this.extend(ce.convert(d)):this.extend(o.L.convert(d)):d&&("lng"in d||"lon"in d)&&"lat"in d?this.extend(o.L.convert(d)):this;if(C=d._sw,R=d._ne,!C||!R)return this}return _||S?(_.lng=Math.min(C.lng,_.lng),_.lat=Math.min(C.lat,_.lat),S.lng=Math.max(R.lng,S.lng),S.lat=Math.max(R.lat,S.lat)):(this._sw=new o.L(C.lng,C.lat),this._ne=new o.L(R.lng,R.lat)),this}getCenter(){return new o.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.L(this.getWest(),this.getNorth())}getSouthEast(){return new o.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(d){const{lng:_,lat:S}=o.L.convert(d);let C=this._sw.lng<=_&&_<=this._ne.lng;return this._sw.lng>this._ne.lng&&(C=this._sw.lng>=_&&_>=this._ne.lng),this._sw.lat<=S&&S<=this._ne.lat&&C}static convert(d){return d instanceof ce?d:d&&new ce(d)}static fromLngLat(d,_=0){const S=360*_/40075017,C=S/Math.cos(Math.PI/180*d.lat);return new ce(new o.L(d.lng-C,d.lat-S),new o.L(d.lng+C,d.lat+S))}}class ye{constructor(d,_,S){this.bounds=ce.convert(this.validateBounds(d)),this.minzoom=_||0,this.maxzoom=S||24}validateBounds(d){return Array.isArray(d)&&d.length===4?[Math.max(-180,d[0]),Math.max(-90,d[1]),Math.min(180,d[2]),Math.min(90,d[3])]:[-180,-90,180,90]}contains(d){const _=Math.pow(2,d.z),S=Math.floor(o.G(this.bounds.getWest())*_),C=Math.floor(o.H(this.bounds.getNorth())*_),R=Math.ceil(o.G(this.bounds.getEast())*_),N=Math.ceil(o.H(this.bounds.getSouth())*_);return d.x>=S&&d.x<R&&d.y>=C&&d.y<N}}class Qe extends o.E{constructor(d,_,S,C){if(super(),this.load=()=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=se(this._options,this.map._requestManager,(R,N)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),R?this.fire(new o.j(R)):N&&(o.e(this,N),N.bounds&&(this.tileBounds=new ye(N.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>o.e({},this._options),this.id=d,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.F(_,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},_),this._collectResourceTiming=_.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d(),this.load()}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(d,_){const S=d.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),C={request:this.map._requestManager.transformRequest(S,T.Tile),uid:d.uid,tileID:d.tileID,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(N,B){return delete d.request,d.aborted?_(null):N&&N.status!==404?_(N):(B&&B.resourceTiming&&(d.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&d.setExpiryData(B),d.loadVectorData(B,this.map.painter),_(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired"?d.state==="loading"?d.reloadCallback=_:d.request=d.actor.send("reloadTile",C,R.bind(this)):(d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",C,R.bind(this)))}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id},void 0)}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class sr extends o.E{constructor(d,_,S,C){super(),this.id=d,this.dispatcher=S,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},_),o.e(this,o.F(_,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=se(this._options,this.map._requestManager,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new o.j(d)):_&&(o.e(this,_),_.bounds&&(this.tileBounds=new ye(_.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(d){this.map=d,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d(),this.load()}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}serialize(){return o.e({},this._options)}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,_){const S=d.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);d.request=w.getImage(this.map._requestManager.transformRequest(S,T.Tile),(C,R,N)=>{if(delete d.request,d.aborted)d.state="unloaded",_(null);else if(C)d.state="errored",_(C);else if(R){this.map._refreshExpiredTiles&&N&&d.setExpiryData(N);const B=this.map.painter.context,V=B.gl;d.texture=this.map.painter.getTileTexture(R.width),d.texture?d.texture.update(R,{useMipmap:!0}):(d.texture=new j(B,R,V.RGBA,{useMipmap:!0}),d.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),B.extTextureFilterAnisotropic&&V.texParameterf(V.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax)),d.state="loaded",_(null)}},this.map._refreshExpiredTiles)}abortTile(d,_){d.request&&(d.request.cancel(),delete d.request),_()}unloadTile(d,_){d.texture&&this.map.painter.saveTileTexture(d.texture),_()}hasTransition(){return!1}}class ke extends sr{constructor(d,_,S,C){super(d,_,S,C),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},_),this.encoding=_.encoding||"mapbox",this.redFactor=_.redFactor,this.greenFactor=_.greenFactor,this.blueFactor=_.blueFactor,this.baseShift=_.baseShift}loadTile(d,_){const S=d.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),C=this.map._requestManager.transformRequest(S,T.Tile);function R(N,B){N&&(d.state="errored",_(N)),B&&(d.dem=B,d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0,d.state="loaded",_(null))}d.neighboringTiles=this._getNeighboringTiles(d.tileID),d.request=w.getImage(C,(N,B,V)=>o._(this,void 0,void 0,function*(){if(delete d.request,d.aborted)d.state="unloaded",_(null);else if(N)d.state="errored",_(N);else if(B){this.map._refreshExpiredTiles&&d.setExpiryData(V);const G=o.a(B)&&o.J()?B:yield function(q){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.K()){const nt=q.width+2,vt=q.height+2;try{return new o.R({width:nt,height:vt},yield o.M(q,-1,-1,nt,vt))}catch{}}return o.h.getImageData(q,1)})}(B),Z={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:G,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",Z,R))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(d){const _=d.canonical,S=Math.pow(2,_.z),C=(_.x-1+S)%S,R=_.x===0?d.wrap-1:d.wrap,N=(_.x+1+S)%S,B=_.x+1===S?d.wrap+1:d.wrap,V={};return V[new o.O(d.overscaledZ,R,_.z,C,_.y).key]={backfilled:!1},V[new o.O(d.overscaledZ,B,_.z,N,_.y).key]={backfilled:!1},_.y>0&&(V[new o.O(d.overscaledZ,R,_.z,C,_.y-1).key]={backfilled:!1},V[new o.O(d.overscaledZ,d.wrap,_.z,_.x,_.y-1).key]={backfilled:!1},V[new o.O(d.overscaledZ,B,_.z,N,_.y-1).key]={backfilled:!1}),_.y+1<S&&(V[new o.O(d.overscaledZ,R,_.z,C,_.y+1).key]={backfilled:!1},V[new o.O(d.overscaledZ,d.wrap,_.z,_.x,_.y+1).key]={backfilled:!1},V[new o.O(d.overscaledZ,B,_.z,N,_.y+1).key]={backfilled:!1}),V}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded",d.actor&&d.actor.send("removeDEMTile",{uid:d.uid,source:this.id})}}class Ce extends o.E{constructor(d,_,S,C){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>o.e({},this._options,{type:this.type,data:this._data}),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=S.getActor(),this.setEventedParent(C),this._data=_.data,this._options=o.e({},_),this._collectResourceTiming=_.collectResourceTiming,_.maxzoom!==void 0&&(this.maxzoom=_.maxzoom),_.type&&(this.type=_.type),_.attribution&&(this.attribution=_.attribution),this.promoteId=_.promoteId;const R=o.N/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:_.cluster||!1,geojsonVtOptions:{buffer:(_.buffer!==void 0?_.buffer:128)*R,tolerance:(_.tolerance!==void 0?_.tolerance:.375)*R,extent:o.N,maxZoom:this.maxzoom,lineMetrics:_.lineMetrics||!1,generateId:_.generateId||!1},superclusterOptions:{maxZoom:_.clusterMaxZoom!==void 0?_.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,_.clusterMinPoints||2),extent:o.N,radius:(_.clusterRadius||50)*R,log:!1,generateId:_.generateId||!1},clusterProperties:_.clusterProperties,filter:_.filter},_.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(d){this.map=d,this.load()}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){return this._updateWorkerData(d),this}setClusterOptions(d){return this.workerOptions.cluster=d.cluster,d&&(d.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=d.clusterRadius),d.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=d.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(d,_){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},_),this}getClusterChildren(d,_){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},_),this}getClusterLeaves(d,_,S,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:_,offset:S},C),this}_updateWorkerData(d){const _=o.e({},this.workerOptions);d?_.dataDiff=d:typeof this._data=="string"?(_.request=this.map._requestManager.transformRequest(o.h.resolveURL(this._data),T.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,_,(S,C)=>{if(this._pendingLoads--,this._removed||C&&C.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let R=null;if(C&&C.resourceTiming&&C.resourceTiming[this.id]&&(R=C.resourceTiming[this.id].slice(0)),S)return void this.fire(new o.j(S));const N={dataType:"source"};this._collectResourceTiming&&R&&R.length>0&&o.e(N,{resourceTiming:R}),this.fire(new o.k("data",Object.assign(Object.assign({},N),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},N),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(d,_){const S=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const C={type:this.type,uid:d.uid,tileID:d.tileID,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};d.request=this.actor.send(S,C,(R,N)=>(delete d.request,d.unloadVectorData(),d.aborted?_(null):R?_(R):(d.loadVectorData(N,this.map.painter,S==="reloadTile"),_(null))))}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Ee=o.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ie extends o.E{constructor(d,_,S,C){super(),this.load=(R,N)=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=w.getImage(this.map._requestManager.transformRequest(this.url,T.Image),(B,V)=>{this._request=null,this._loaded=!0,B?this.fire(new o.j(B)):V&&(this.image=V,R&&(this.coordinates=R),N&&N(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const R=this.map.painter.context,N=R.gl;this.boundsBuffer||(this.boundsBuffer=R.createVertexBuffer(this._boundsArray,Ee.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new j(R,this.image,N.RGBA),this.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE));let B=!1;for(const V in this.tiles){const G=this.tiles[V];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture,B=!0)}B&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=d,this.dispatcher=S,this.coordinates=_.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=_}loaded(){return this._loaded}updateImage(d){return d.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=d.url,this.load(d.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(d){this.map=d,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(d){this.coordinates=d;const _=d.map(o.U.fromLngLat);this.tileID=function(C){let R=1/0,N=1/0,B=-1/0,V=-1/0;for(const nt of C)R=Math.min(R,nt.x),N=Math.min(N,nt.y),B=Math.max(B,nt.x),V=Math.max(V,nt.y);const G=Math.max(B-R,V-N),Z=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),q=Math.pow(2,Z);return new o.W(Z,Math.floor((R+B)/2*q),Math.floor((N+V)/2*q))}(_),this.minzoom=this.maxzoom=this.tileID.z;const S=_.map(C=>this.tileID.getTilePoint(C)._round());return this._boundsArray=new o.V,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,o.N,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,o.N),this._boundsArray.emplaceBack(S[2].x,S[2].y,o.N,o.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(d,_){this.tileID&&this.tileID.equals(d.tileID.canonical)?(this.tiles[String(d.tileID.wrap)]=d,d.buckets={},_(null)):(d.state="errored",_(null))}hasTransition(){return!1}}class Se extends Ie{constructor(d,_,S,C){super(d,_,S,C),this.load=()=>{this._loaded=!1;const R=this.options;this.urls=[];for(const N of R.urls)this.urls.push(this.map._requestManager.transformRequest(N,T.Source).url);o.X(this.urls,(N,B)=>{this._loaded=!0,N?this.fire(new o.j(N)):B&&(this.video=B,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const R=this.map.painter.context,N=R.gl;this.boundsBuffer||(this.boundsBuffer=R.createVertexBuffer(this._boundsArray,Ee.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE),N.texSubImage2D(N.TEXTURE_2D,0,0,0,N.RGBA,N.UNSIGNED_BYTE,this.video)):(this.texture=new j(R,this.video,N.RGBA),this.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE));let B=!1;for(const V in this.tiles){const G=this.tiles[V];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture,B=!0)}B&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=_}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const _=this.video.seekable;d<_.start(0)||d>_.end(0)?this.fire(new o.j(new o.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${_.start(0)} and ${_.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Fe extends Ie{constructor(d,_,S,C){super(d,_,S,C),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let R=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,R=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,R=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const N=this.map.painter.context,B=N.gl;this.boundsBuffer||(this.boundsBuffer=N.createVertexBuffer(this._boundsArray,Ee.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?(R||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new j(N,this.canvas,B.RGBA,{premultiply:!0});let V=!1;for(const G in this.tiles){const Z=this.tiles[G];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture,V=!0)}V&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),_.coordinates?Array.isArray(_.coordinates)&&_.coordinates.length===4&&!_.coordinates.some(R=>!Array.isArray(R)||R.length!==2||R.some(N=>typeof N!="number"))||this.fire(new o.j(new o.Y(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.Y(`sources.${d}`,null,'missing required property "coordinates"'))),_.animate&&typeof _.animate!="boolean"&&this.fire(new o.j(new o.Y(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),_.canvas?typeof _.canvas=="string"||_.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.Y(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.Y(`sources.${d}`,null,'missing required property "canvas"'))),this.options=_,this.animate=_.animate===void 0||_.animate}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}}const Rr={},tr=I=>{switch(I){case"geojson":return Ce;case"image":return Ie;case"raster":return sr;case"raster-dem":return ke;case"vector":return Qe;case"video":return Se;case"canvas":return Fe}return Rr[I]};function Vr(I,d){const _=o.Z();return o.$(_,_,[1,1,0]),o.a0(_,_,[.5*I.width,.5*I.height,1]),o.a1(_,_,I.calculatePosMatrix(d.toUnwrapped()))}function _r(I,d,_,S,C,R){const N=function(q,nt,vt){if(q)for(const gt of q){const _t=nt[gt];if(_t&&_t.source===vt&&_t.type==="fill-extrusion")return!0}else for(const gt in nt){const _t=nt[gt];if(_t.source===vt&&_t.type==="fill-extrusion")return!0}return!1}(C&&C.layers,d,I.id),B=R.maxPitchScaleFactor(),V=I.tilesIn(S,B,N);V.sort(Xr);const G=[];for(const q of V)G.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(d,_,I._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,C,R,B,Vr(I.transform,q.tileID))});const Z=function(q){const nt={},vt={};for(const gt of q){const _t=gt.queryResults,dt=gt.wrappedTileID,Pt=vt[dt]=vt[dt]||{};for(const $t in _t){const St=_t[$t],Lt=Pt[$t]=Pt[$t]||{},Gt=nt[$t]=nt[$t]||[];for(const Xt of St)Lt[Xt.featureIndex]||(Lt[Xt.featureIndex]=!0,Gt.push(Xt))}}return nt}(G);for(const q in Z)Z[q].forEach(nt=>{const vt=nt.feature,gt=I.getFeatureState(vt.layer["source-layer"],vt.id);vt.source=vt.layer.source,vt.layer["source-layer"]&&(vt.sourceLayer=vt.layer["source-layer"]),vt.state=gt});return Z}function Xr(I,d){const _=I.tileID,S=d.tileID;return _.overscaledZ-S.overscaledZ||_.canonical.y-S.canonical.y||_.wrap-S.wrap||_.canonical.x-S.canonical.x}class Hi{constructor(d,_){this.timeAdded=0,this.fadeEndTime=0,this.tileID=d,this.uid=o.a2(),this.uses=0,this.tileSize=_,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(d){const _=d+this.timeAdded;_<this.fadeEndTime||(this.fadeEndTime=_)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(d){this.demTexture&&d.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(d,_,S){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",d){d.featureIndex&&(this.latestFeatureIndex=d.featureIndex,d.rawTileData?(this.latestRawTileData=d.rawTileData,this.latestFeatureIndex.rawTileData=d.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=d.collisionBoxArray,this.buckets=function(C,R){const N={};if(!R)return N;for(const B of C){const V=B.layerIds.map(G=>R.getLayer(G)).filter(Boolean);if(V.length!==0){B.layers=V,B.stateDependentLayerIds&&(B.stateDependentLayers=B.stateDependentLayerIds.map(G=>V.filter(Z=>Z.id===G)[0]));for(const G of V)N[G.id]=B}}return N}(d.buckets,_.style),this.hasSymbolBuckets=!1;for(const C in this.buckets){const R=this.buckets[C];if(R instanceof o.a4){if(this.hasSymbolBuckets=!0,!S)break;R.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const C in this.buckets){const R=this.buckets[C];if(R instanceof o.a4&&R.hasRTLText){this.hasRTLText=!0,o.a5();break}}this.queryPadding=0;for(const C in this.buckets){const R=this.buckets[C];this.queryPadding=Math.max(this.queryPadding,_.style.getLayer(C).queryRadius(R))}d.imageAtlas&&(this.imageAtlas=d.imageAtlas),d.glyphAtlasImage&&(this.glyphAtlasImage=d.glyphAtlasImage)}else this.collisionBoxArray=new o.a3}unloadVectorData(){for(const d in this.buckets)this.buckets[d].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(d){return this.buckets[d.id]}upload(d){for(const S in this.buckets){const C=this.buckets[S];C.uploadPending()&&C.upload(d)}const _=d.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new j(d,this.imageAtlas.image,_.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new j(d,this.glyphAtlasImage,_.ALPHA),this.glyphAtlasImage=null)}prepare(d){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(d,this.imageAtlasTexture)}queryRenderedFeatures(d,_,S,C,R,N,B,V,G,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:C,cameraQueryGeometry:R,scale:N,tileSize:this.tileSize,pixelPosMatrix:Z,transform:V,params:B,queryPadding:this.queryPadding*G},d,_,S):{}}querySourceFeatures(d,_){const S=this.latestFeatureIndex;if(!S||!S.rawTileData)return;const C=S.loadVTLayers(),R=_&&_.sourceLayer?_.sourceLayer:"",N=C._geojsonTileLayer||C[R];if(!N)return;const B=o.a6(_&&_.filter),{z:V,x:G,y:Z}=this.tileID.canonical,q={z:V,x:G,y:Z};for(let nt=0;nt<N.length;nt++){const vt=N.feature(nt);if(B.needGeometry){const dt=o.a7(vt,!0);if(!B.filter(new o.a8(this.tileID.overscaledZ),dt,this.tileID.canonical))continue}else if(!B.filter(new o.a8(this.tileID.overscaledZ),vt))continue;const gt=S.getId(vt,R),_t=new o.a9(vt,V,G,Z,gt);_t.tile=q,d.push(_t)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(d){const _=this.expirationTime;if(d.cacheControl){const S=o.aa(d.cacheControl);S["max-age"]&&(this.expirationTime=Date.now()+1e3*S["max-age"])}else d.expires&&(this.expirationTime=new Date(d.expires).getTime());if(this.expirationTime){const S=Date.now();let C=!1;if(this.expirationTime>S)C=!1;else if(_)if(this.expirationTime<_)C=!0;else{const R=this.expirationTime-_;R?this.expirationTime=S+Math.max(R,3e4):C=!0}else C=!0;C?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(d,_){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(d).length===0)return;const S=this.latestFeatureIndex.loadVTLayers();for(const C in this.buckets){if(!_.style.hasLayer(C))continue;const R=this.buckets[C],N=R.layers[0].sourceLayer||"_geojsonTileLayer",B=S[N],V=d[N];if(!B||!V||Object.keys(V).length===0)continue;R.update(V,B,this.imageAtlas&&this.imageAtlas.patternPositions||{});const G=_&&_.style&&_.style.getLayer(C);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(R)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(d){this.symbolFadeHoldUntil=o.h.now()+d}setDependencies(d,_){const S={};for(const C of _)S[C]=!0;this.dependencies[d]=S}hasDependency(d,_){for(const S of d){const C=this.dependencies[S];if(C){for(const R of _)if(C[R])return!0}}return!1}}class wi{constructor(d,_){this.max=d,this.onRemove=_,this.reset()}reset(){for(const d in this.data)for(const _ of this.data[d])_.timeout&&clearTimeout(_.timeout),this.onRemove(_.value);return this.data={},this.order=[],this}add(d,_,S){const C=d.wrapped().key;this.data[C]===void 0&&(this.data[C]=[]);const R={value:_,timeout:void 0};if(S!==void 0&&(R.timeout=setTimeout(()=>{this.remove(d,R)},S)),this.data[C].push(R),this.order.push(C),this.order.length>this.max){const N=this._getAndRemoveByKey(this.order[0]);N&&this.onRemove(N)}return this}has(d){return d.wrapped().key in this.data}getAndRemove(d){return this.has(d)?this._getAndRemoveByKey(d.wrapped().key):null}_getAndRemoveByKey(d){const _=this.data[d].shift();return _.timeout&&clearTimeout(_.timeout),this.data[d].length===0&&delete this.data[d],this.order.splice(this.order.indexOf(d),1),_.value}getByKey(d){const _=this.data[d];return _?_[0].value:null}get(d){return this.has(d)?this.data[d.wrapped().key][0].value:null}remove(d,_){if(!this.has(d))return this;const S=d.wrapped().key,C=_===void 0?0:this.data[S].indexOf(_),R=this.data[S][C];return this.data[S].splice(C,1),R.timeout&&clearTimeout(R.timeout),this.data[S].length===0&&delete this.data[S],this.onRemove(R.value),this.order.splice(this.order.indexOf(S),1),this}setMaxSize(d){for(this.max=d;this.order.length>this.max;){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}filter(d){const _=[];for(const S in this.data)for(const C of this.data[S])d(C.value)||_.push(C);for(const S of _)this.remove(S.value.tileID,S)}}class qt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(d,_,S){const C=String(_);if(this.stateChanges[d]=this.stateChanges[d]||{},this.stateChanges[d][C]=this.stateChanges[d][C]||{},o.e(this.stateChanges[d][C],S),this.deletedStates[d]===null){this.deletedStates[d]={};for(const R in this.state[d])R!==C&&(this.deletedStates[d][R]=null)}else if(this.deletedStates[d]&&this.deletedStates[d][C]===null){this.deletedStates[d][C]={};for(const R in this.state[d][C])S[R]||(this.deletedStates[d][C][R]=null)}else for(const R in S)this.deletedStates[d]&&this.deletedStates[d][C]&&this.deletedStates[d][C][R]===null&&delete this.deletedStates[d][C][R]}removeFeatureState(d,_,S){if(this.deletedStates[d]===null)return;const C=String(_);if(this.deletedStates[d]=this.deletedStates[d]||{},S&&_!==void 0)this.deletedStates[d][C]!==null&&(this.deletedStates[d][C]=this.deletedStates[d][C]||{},this.deletedStates[d][C][S]=null);else if(_!==void 0)if(this.stateChanges[d]&&this.stateChanges[d][C])for(S in this.deletedStates[d][C]={},this.stateChanges[d][C])this.deletedStates[d][C][S]=null;else this.deletedStates[d][C]=null;else this.deletedStates[d]=null}getState(d,_){const S=String(_),C=o.e({},(this.state[d]||{})[S],(this.stateChanges[d]||{})[S]);if(this.deletedStates[d]===null)return{};if(this.deletedStates[d]){const R=this.deletedStates[d][_];if(R===null)return{};for(const N in R)delete C[N]}return C}initializeTileState(d,_){d.setFeatureState(this.state,_)}coalesceChanges(d,_){const S={};for(const C in this.stateChanges){this.state[C]=this.state[C]||{};const R={};for(const N in this.stateChanges[C])this.state[C][N]||(this.state[C][N]={}),o.e(this.state[C][N],this.stateChanges[C][N]),R[N]=this.state[C][N];S[C]=R}for(const C in this.deletedStates){this.state[C]=this.state[C]||{};const R={};if(this.deletedStates[C]===null)for(const N in this.state[C])R[N]={},this.state[C][N]={};else for(const N in this.deletedStates[C]){if(this.deletedStates[C][N]===null)this.state[C][N]={};else for(const B of Object.keys(this.deletedStates[C][N]))delete this.state[C][N][B];R[N]=this.state[C][N]}S[C]=S[C]||{},o.e(S[C],R)}if(this.stateChanges={},this.deletedStates={},Object.keys(S).length!==0)for(const C in d)d[C].setFeatureState(S,_)}}class Ur extends o.E{constructor(d,_,S){super(),this.id=d,this.dispatcher=S,this.on("data",C=>{C.dataType==="source"&&C.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&C.dataType==="source"&&C.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((C,R,N,B)=>{const V=new(tr(R.type))(C,R,N,B);if(V.id!==C)throw new Error(`Expected Source id to be ${C} instead of ${V.id}`);return V})(d,_,S,this),this._tiles={},this._cache=new wi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new qt,this._didEmitContent=!1,this._updated=!1}onAdd(d){this.map=d,this._maxTileCacheSize=d?d._maxTileCacheSize:null,this._maxTileCacheZoomLevels=d?d._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(d)}onRemove(d){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(d)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const d in this._tiles){const _=this._tiles[d];if(_.state!=="loaded"&&_.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const d=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,d&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(d,_){return this._source.loadTile(d,_)}_unloadTile(d){if(this._source.unloadTile)return this._source.unloadTile(d,()=>{})}_abortTile(d){this._source.abortTile&&this._source.abortTile(d,()=>{}),this._source.fire(new o.k("dataabort",{tile:d,coord:d.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(d){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const _ in this._tiles){const S=this._tiles[_];S.upload(d),S.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(d=>d.tileID).sort(wn).map(d=>d.key)}getRenderableIds(d){const _=[];for(const S in this._tiles)this._isIdRenderable(S,d)&&_.push(this._tiles[S]);return d?_.sort((S,C)=>{const R=S.tileID,N=C.tileID,B=new o.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle),V=new o.P(N.canonical.x,N.canonical.y)._rotate(this.transform.angle);return R.overscaledZ-N.overscaledZ||V.y-B.y||V.x-B.x}).map(S=>S.tileID.key):_.map(S=>S.tileID).sort(wn).map(S=>S.key)}hasRenderableParent(d){const _=this.findLoadedParent(d,0);return!!_&&this._isIdRenderable(_.tileID.key)}_isIdRenderable(d,_){return this._tiles[d]&&this._tiles[d].hasData()&&!this._coveredTiles[d]&&(_||!this._tiles[d].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const d in this._tiles)this._tiles[d].state!=="errored"&&this._reloadTile(d,"reloading")}}_reloadTile(d,_){const S=this._tiles[d];S&&(S.state!=="loading"&&(S.state=_),this._loadTile(S,this._tileLoaded.bind(this,S,d,_)))}_tileLoaded(d,_,S,C){if(C)return d.state="errored",void(C.status!==404?this._source.fire(new o.j(C,{tile:d})):this.update(this.transform,this.terrain));d.timeAdded=o.h.now(),S==="expired"&&(d.refreshedUponExpiration=!0),this._setTileReloadTimer(_,d),this.getSource().type==="raster-dem"&&d.dem&&this._backfillDEM(d),this._state.initializeTileState(d,this.map?this.map.painter:null),d.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:d,coord:d.tileID}))}_backfillDEM(d){const _=this.getRenderableIds();for(let C=0;C<_.length;C++){const R=_[C];if(d.neighboringTiles&&d.neighboringTiles[R]){const N=this.getTileByID(R);S(d,N),S(N,d)}}function S(C,R){C.needsHillshadePrepare=!0,C.needsTerrainPrepare=!0;let N=R.tileID.canonical.x-C.tileID.canonical.x;const B=R.tileID.canonical.y-C.tileID.canonical.y,V=Math.pow(2,C.tileID.canonical.z),G=R.tileID.key;N===0&&B===0||Math.abs(B)>1||(Math.abs(N)>1&&(Math.abs(N+V)===1?N+=V:Math.abs(N-V)===1&&(N-=V)),R.dem&&C.dem&&(C.dem.backfillBorder(R.dem,N,B),C.neighboringTiles&&C.neighboringTiles[G]&&(C.neighboringTiles[G].backfilled=!0)))}}getTile(d){return this.getTileByID(d.key)}getTileByID(d){return this._tiles[d]}_retainLoadedChildren(d,_,S,C){for(const R in this._tiles){let N=this._tiles[R];if(C[R]||!N.hasData()||N.tileID.overscaledZ<=_||N.tileID.overscaledZ>S)continue;let B=N.tileID;for(;N&&N.tileID.overscaledZ>_+1;){const G=N.tileID.scaledTo(N.tileID.overscaledZ-1);N=this._tiles[G.key],N&&N.hasData()&&(B=G)}let V=B;for(;V.overscaledZ>_;)if(V=V.scaledTo(V.overscaledZ-1),d[V.key]){C[B.key]=B;break}}}findLoadedParent(d,_){if(d.key in this._loadedParentTiles){const S=this._loadedParentTiles[d.key];return S&&S.tileID.overscaledZ>=_?S:null}for(let S=d.overscaledZ-1;S>=_;S--){const C=d.scaledTo(S),R=this._getLoadedTile(C);if(R)return R}}_getLoadedTile(d){const _=this._tiles[d.key];return _&&_.hasData()?_:this._cache.getByKey(d.wrapped().key)}updateCacheSize(d){const _=Math.ceil(d.width/this._source.tileSize)+1,S=Math.ceil(d.height/this._source.tileSize)+1,C=Math.floor(_*S*(this._maxTileCacheZoomLevels===null?o.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(R)}handleWrapJump(d){const _=Math.round((d-(this._prevLng===void 0?d:this._prevLng))/360);if(this._prevLng=d,_){const S={};for(const C in this._tiles){const R=this._tiles[C];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+_),S[R.tileID.key]=R}this._tiles=S;for(const C in this._timers)clearTimeout(this._timers[C]),delete this._timers[C];for(const C in this._tiles)this._setTileReloadTimer(C,this._tiles[C])}}update(d,_){if(this.transform=d,this.terrain=_,!this._sourceLoaded||this._paused)return;let S;this.updateCacheSize(d),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?S=d.getVisibleUnwrappedCoordinates(this._source.tileID).map(Z=>new o.O(Z.canonical.z,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y)):(S=d.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:_}),this._source.hasTile&&(S=S.filter(Z=>this._source.hasTile(Z)))):S=[];const C=d.coveringZoomLevel(this._source),R=Math.max(C-Ur.maxOverzooming,this._source.minzoom),N=Math.max(C+Ur.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const Z={};for(const q of S)if(q.canonical.z>this._source.minzoom){const nt=q.scaledTo(q.canonical.z-1);Z[nt.key]=nt;const vt=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));Z[vt.key]=vt}S=S.concat(Object.values(Z))}const B=S.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,B&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const V=this._updateRetainedTiles(S,C);if(Gr(this._source.type)){const Z={},q={},nt=Object.keys(V),vt=o.h.now();for(const gt of nt){const _t=V[gt],dt=this._tiles[gt];if(!dt||dt.fadeEndTime!==0&&dt.fadeEndTime<=vt)continue;const Pt=this.findLoadedParent(_t,R);Pt&&(this._addTile(Pt.tileID),Z[Pt.tileID.key]=Pt.tileID),q[gt]=_t}this._retainLoadedChildren(q,C,N,V);for(const gt in Z)V[gt]||(this._coveredTiles[gt]=!0,V[gt]=Z[gt]);if(_){const gt={},_t={};for(const dt of S)this._tiles[dt.key].hasData()?gt[dt.key]=dt:_t[dt.key]=dt;for(const dt in _t){const Pt=_t[dt].children(this._source.maxzoom);this._tiles[Pt[0].key]&&this._tiles[Pt[1].key]&&this._tiles[Pt[2].key]&&this._tiles[Pt[3].key]&&(gt[Pt[0].key]=V[Pt[0].key]=Pt[0],gt[Pt[1].key]=V[Pt[1].key]=Pt[1],gt[Pt[2].key]=V[Pt[2].key]=Pt[2],gt[Pt[3].key]=V[Pt[3].key]=Pt[3],delete _t[dt])}for(const dt in _t){const Pt=this.findLoadedParent(_t[dt],this._source.minzoom);if(Pt){gt[Pt.tileID.key]=V[Pt.tileID.key]=Pt.tileID;for(const $t in gt)gt[$t].isChildOf(Pt.tileID)&&delete gt[$t]}}for(const dt in this._tiles)gt[dt]||(this._coveredTiles[dt]=!0)}}for(const Z in V)this._tiles[Z].clearFadeHold();const G=o.ab(this._tiles,V);for(const Z of G){const q=this._tiles[Z];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(Z)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const d in this._tiles)this._tiles[d].holdingForFade()&&this._removeTile(d)}_updateRetainedTiles(d,_){const S={},C={},R=Math.max(_-Ur.maxOverzooming,this._source.minzoom),N=Math.max(_+Ur.maxUnderzooming,this._source.minzoom),B={};for(const V of d){const G=this._addTile(V);S[V.key]=V,G.hasData()||_<this._source.maxzoom&&(B[V.key]=V)}this._retainLoadedChildren(B,_,N,S);for(const V of d){let G=this._tiles[V.key];if(G.hasData())continue;if(_+1>this._source.maxzoom){const q=V.children(this._source.maxzoom)[0],nt=this.getTile(q);if(nt&&nt.hasData()){S[q.key]=q;continue}}else{const q=V.children(this._source.maxzoom);if(S[q[0].key]&&S[q[1].key]&&S[q[2].key]&&S[q[3].key])continue}let Z=G.wasRequested();for(let q=V.overscaledZ-1;q>=R;--q){const nt=V.scaledTo(q);if(C[nt.key])break;if(C[nt.key]=!0,G=this.getTile(nt),!G&&Z&&(G=this._addTile(nt)),G){const vt=G.hasData();if((Z||vt)&&(S[nt.key]=nt),Z=G.wasRequested(),vt)break}}}return S}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const d in this._tiles){const _=[];let S,C=this._tiles[d].tileID;for(;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){S=this._loadedParentTiles[C.key];break}_.push(C.key);const R=C.scaledTo(C.overscaledZ-1);if(S=this._getLoadedTile(R),S)break;C=R}for(const R of _)this._loadedParentTiles[R]=S}}_addTile(d){let _=this._tiles[d.key];if(_)return _;_=this._cache.getAndRemove(d),_&&(this._setTileReloadTimer(d.key,_),_.tileID=d,this._state.initializeTileState(_,this.map?this.map.painter:null),this._cacheTimers[d.key]&&(clearTimeout(this._cacheTimers[d.key]),delete this._cacheTimers[d.key],this._setTileReloadTimer(d.key,_)));const S=_;return _||(_=new Hi(d,this._source.tileSize*d.overscaleFactor()),this._loadTile(_,this._tileLoaded.bind(this,_,d.key,_.state))),_.uses++,this._tiles[d.key]=_,S||this._source.fire(new o.k("dataloading",{tile:_,coord:_.tileID,dataType:"source"})),_}_setTileReloadTimer(d,_){d in this._timers&&(clearTimeout(this._timers[d]),delete this._timers[d]);const S=_.getExpiryTimeout();S&&(this._timers[d]=setTimeout(()=>{this._reloadTile(d,"expired"),delete this._timers[d]},S))}_removeTile(d){const _=this._tiles[d];_&&(_.uses--,delete this._tiles[d],this._timers[d]&&(clearTimeout(this._timers[d]),delete this._timers[d]),_.uses>0||(_.hasData()&&_.state!=="reloading"?this._cache.add(_.tileID,_,_.getExpiryTimeout()):(_.aborted=!0,this._abortTile(_),this._unloadTile(_))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const d in this._tiles)this._removeTile(d);this._cache.reset()}tilesIn(d,_,S){const C=[],R=this.transform;if(!R)return C;const N=S?R.getCameraQueryGeometry(d):d,B=d.map(gt=>R.pointCoordinate(gt,this.terrain)),V=N.map(gt=>R.pointCoordinate(gt,this.terrain)),G=this.getIds();let Z=1/0,q=1/0,nt=-1/0,vt=-1/0;for(const gt of V)Z=Math.min(Z,gt.x),q=Math.min(q,gt.y),nt=Math.max(nt,gt.x),vt=Math.max(vt,gt.y);for(let gt=0;gt<G.length;gt++){const _t=this._tiles[G[gt]];if(_t.holdingForFade())continue;const dt=_t.tileID,Pt=Math.pow(2,R.zoom-_t.tileID.overscaledZ),$t=_*_t.queryPadding*o.N/_t.tileSize/Pt,St=[dt.getTilePoint(new o.U(Z,q)),dt.getTilePoint(new o.U(nt,vt))];if(St[0].x-$t<o.N&&St[0].y-$t<o.N&&St[1].x+$t>=0&&St[1].y+$t>=0){const Lt=B.map(Xt=>dt.getTilePoint(Xt)),Gt=V.map(Xt=>dt.getTilePoint(Xt));C.push({tile:_t,tileID:dt,queryGeometry:Lt,cameraQueryGeometry:Gt,scale:Pt})}}return C}getVisibleCoordinates(d){const _=this.getRenderableIds(d).map(S=>this._tiles[S].tileID);for(const S of _)S.posMatrix=this.transform.calculatePosMatrix(S.toUnwrapped());return _}hasTransition(){if(this._source.hasTransition())return!0;if(Gr(this._source.type)){const d=o.h.now();for(const _ in this._tiles)if(this._tiles[_].fadeEndTime>=d)return!0}return!1}setFeatureState(d,_,S){this._state.updateState(d=d||"_geojsonTileLayer",_,S)}removeFeatureState(d,_,S){this._state.removeFeatureState(d=d||"_geojsonTileLayer",_,S)}getFeatureState(d,_){return this._state.getState(d=d||"_geojsonTileLayer",_)}setDependencies(d,_,S){const C=this._tiles[d];C&&C.setDependencies(_,S)}reloadTilesForDependencies(d,_){for(const S in this._tiles)this._tiles[S].hasDependency(d,_)&&this._reloadTile(S,"reloading");this._cache.filter(S=>!S.hasDependency(d,_))}}function wn(I,d){const _=Math.abs(2*I.wrap)-+(I.wrap<0),S=Math.abs(2*d.wrap)-+(d.wrap<0);return I.overscaledZ-d.overscaledZ||S-_||d.canonical.y-I.canonical.y||d.canonical.x-I.canonical.x}function Gr(I){return I==="raster"||I==="image"||I==="video"}Ur.maxOverzooming=10,Ur.maxUnderzooming=3;const $r="mapboxgl_preloaded_worker_pool";class Ya{constructor(){this.active={}}acquire(d){if(!this.workers)for(this.workers=[];this.workers.length<Ya.workerCount;)this.workers.push(new Worker(o.c.WORKER_URL));return this.active[d]=!0,this.workers.slice()}release(d){delete this.active[d],this.numActive()===0&&(this.workers.forEach(_=>{_.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$r]}numActive(){return Object.keys(this.active).length}}const Wo=Math.floor(o.h.hardwareConcurrency/2);let Ka;function Ml(){return Ka||(Ka=new Ya),Ka}Ya.workerCount=o.ac(globalThis)?Math.max(Math.min(Wo,3),1):1;class uo{constructor(d,_){this.reset(d,_)}reset(d,_){this.points=d||[],this._distances=[0];for(let S=1;S<this.points.length;S++)this._distances[S]=this._distances[S-1]+this.points[S].dist(this.points[S-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(_||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(d){if(this.points.length===1)return this.points[0];d=o.ad(d,0,1);let _=1,S=this._distances[_];const C=d*this.paddedLength+this.padding;for(;S<C&&_<this._distances.length;)S=this._distances[++_];const R=_-1,N=this._distances[R],B=S-N,V=B>0?(C-N)/B:0;return this.points[R].mult(1-V).add(this.points[_].mult(V))}}function gs(I,d){let _=!0;return I==="always"||I!=="never"&&d!=="never"||(_=!1),_}class Ja{constructor(d,_,S){const C=this.boxCells=[],R=this.circleCells=[];this.xCellCount=Math.ceil(d/S),this.yCellCount=Math.ceil(_/S);for(let N=0;N<this.xCellCount*this.yCellCount;N++)C.push([]),R.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=d,this.height=_,this.xScale=this.xCellCount/d,this.yScale=this.yCellCount/_,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(d,_,S,C,R){this._forEachCell(_,S,C,R,this._insertBoxCell,this.boxUid++),this.boxKeys.push(d),this.bboxes.push(_),this.bboxes.push(S),this.bboxes.push(C),this.bboxes.push(R)}insertCircle(d,_,S,C){this._forEachCell(_-C,S-C,_+C,S+C,this._insertCircleCell,this.circleUid++),this.circleKeys.push(d),this.circles.push(_),this.circles.push(S),this.circles.push(C)}_insertBoxCell(d,_,S,C,R,N){this.boxCells[R].push(N)}_insertCircleCell(d,_,S,C,R,N){this.circleCells[R].push(N)}_query(d,_,S,C,R,N,B){if(S<0||d>this.width||C<0||_>this.height)return[];const V=[];if(d<=0&&_<=0&&this.width<=S&&this.height<=C){if(R)return[{key:null,x1:d,y1:_,x2:S,y2:C}];for(let G=0;G<this.boxKeys.length;G++)V.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const Z=this.circles[3*G],q=this.circles[3*G+1],nt=this.circles[3*G+2];V.push({key:this.circleKeys[G],x1:Z-nt,y1:q-nt,x2:Z+nt,y2:q+nt})}}else this._forEachCell(d,_,S,C,this._queryCell,V,{hitTest:R,overlapMode:N,seenUids:{box:{},circle:{}}},B);return V}query(d,_,S,C){return this._query(d,_,S,C,!1,null)}hitTest(d,_,S,C,R,N){return this._query(d,_,S,C,!0,R,N).length>0}hitTestCircle(d,_,S,C,R){const N=d-S,B=d+S,V=_-S,G=_+S;if(B<0||N>this.width||G<0||V>this.height)return!1;const Z=[];return this._forEachCell(N,V,B,G,this._queryCellCircle,Z,{hitTest:!0,overlapMode:C,circle:{x:d,y:_,radius:S},seenUids:{box:{},circle:{}}},R),Z.length>0}_queryCell(d,_,S,C,R,N,B,V){const{seenUids:G,hitTest:Z,overlapMode:q}=B,nt=this.boxCells[R];if(nt!==null){const gt=this.bboxes;for(const _t of nt)if(!G.box[_t]){G.box[_t]=!0;const dt=4*_t,Pt=this.boxKeys[_t];if(d<=gt[dt+2]&&_<=gt[dt+3]&&S>=gt[dt+0]&&C>=gt[dt+1]&&(!V||V(Pt))&&(!Z||!gs(q,Pt.overlapMode))&&(N.push({key:Pt,x1:gt[dt],y1:gt[dt+1],x2:gt[dt+2],y2:gt[dt+3]}),Z))return!0}}const vt=this.circleCells[R];if(vt!==null){const gt=this.circles;for(const _t of vt)if(!G.circle[_t]){G.circle[_t]=!0;const dt=3*_t,Pt=this.circleKeys[_t];if(this._circleAndRectCollide(gt[dt],gt[dt+1],gt[dt+2],d,_,S,C)&&(!V||V(Pt))&&(!Z||!gs(q,Pt.overlapMode))){const $t=gt[dt],St=gt[dt+1],Lt=gt[dt+2];if(N.push({key:Pt,x1:$t-Lt,y1:St-Lt,x2:$t+Lt,y2:St+Lt}),Z)return!0}}}return!1}_queryCellCircle(d,_,S,C,R,N,B,V){const{circle:G,seenUids:Z,overlapMode:q}=B,nt=this.boxCells[R];if(nt!==null){const gt=this.bboxes;for(const _t of nt)if(!Z.box[_t]){Z.box[_t]=!0;const dt=4*_t,Pt=this.boxKeys[_t];if(this._circleAndRectCollide(G.x,G.y,G.radius,gt[dt+0],gt[dt+1],gt[dt+2],gt[dt+3])&&(!V||V(Pt))&&!gs(q,Pt.overlapMode))return N.push(!0),!0}}const vt=this.circleCells[R];if(vt!==null){const gt=this.circles;for(const _t of vt)if(!Z.circle[_t]){Z.circle[_t]=!0;const dt=3*_t,Pt=this.circleKeys[_t];if(this._circlesCollide(gt[dt],gt[dt+1],gt[dt+2],G.x,G.y,G.radius)&&(!V||V(Pt))&&!gs(q,Pt.overlapMode))return N.push(!0),!0}}}_forEachCell(d,_,S,C,R,N,B,V){const G=this._convertToXCellCoord(d),Z=this._convertToYCellCoord(_),q=this._convertToXCellCoord(S),nt=this._convertToYCellCoord(C);for(let vt=G;vt<=q;vt++)for(let gt=Z;gt<=nt;gt++)if(R.call(this,d,_,S,C,this.xCellCount*gt+vt,N,B,V))return}_convertToXCellCoord(d){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(d*this.xScale)))}_convertToYCellCoord(d){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(d*this.yScale)))}_circlesCollide(d,_,S,C,R,N){const B=C-d,V=R-_,G=S+N;return G*G>B*B+V*V}_circleAndRectCollide(d,_,S,C,R,N,B){const V=(N-C)/2,G=Math.abs(d-(C+V));if(G>V+S)return!1;const Z=(B-R)/2,q=Math.abs(_-(R+Z));if(q>Z+S)return!1;if(G<=V||q<=Z)return!0;const nt=G-V,vt=q-Z;return nt*nt+vt*vt<=S*S}}function de(I,d,_,S,C){const R=o.Z();return d?(o.a0(R,R,[1/C,1/C,1]),_||o.ae(R,R,S.angle)):o.a1(R,S.labelPlaneMatrix,I),R}function Qa(I,d,_,S,C){if(d){const R=o.af(I);return o.a0(R,R,[C,C,1]),_||o.ae(R,R,-S.angle),R}return S.glCoordMatrix}function Si(I,d,_){let S;_?(S=[I.x,I.y,_(I.x,I.y),1],o.ag(S,S,d)):(S=[I.x,I.y,0,1],xt(S,S,d));const C=S[3];return{point:new o.P(S[0]/C,S[1]/C),signedDistanceFromCamera:C}}function co(I,d){return .5+I/d*.5}function vs(I,d){const _=I[0]/I[3],S=I[1]/I[3];return _>=-d[0]&&_<=d[0]&&S>=-d[1]&&S<=d[1]}function ge(I,d,_,S,C,R,N,B,V,G){const Z=S?I.textSizeData:I.iconSizeData,q=o.ah(Z,_.transform.zoom),nt=[256/_.width*2+1,256/_.height*2+1],vt=S?I.text.dynamicLayoutVertexArray:I.icon.dynamicLayoutVertexArray;vt.clear();const gt=I.lineVertexArray,_t=S?I.text.placedSymbolArray:I.icon.placedSymbolArray,dt=_.transform.width/_.transform.height;let Pt=!1;for(let $t=0;$t<_t.length;$t++){const St=_t.get($t);if(St.hidden||St.writingMode===o.ai.vertical&&!Pt){ct(St.numGlyphs,vt);continue}let Lt;if(Pt=!1,G?(Lt=[St.anchorX,St.anchorY,G(St.anchorX,St.anchorY),1],o.ag(Lt,Lt,d)):(Lt=[St.anchorX,St.anchorY,0,1],xt(Lt,Lt,d)),!vs(Lt,nt)){ct(St.numGlyphs,vt);continue}const Gt=co(_.transform.cameraToCenterDistance,Lt[3]),Xt=o.aj(Z,q,St),ee=N?Xt/Gt:Xt*Gt,oe=new o.P(St.anchorX,St.anchorY),ae=Si(oe,C,G).point,fe={projections:{},offsets:{}},Be=Sn(St,ee,!1,B,d,C,R,I.glyphOffsetArray,gt,vt,ae,oe,fe,dt,V,G);Pt=Be.useVertical,(Be.notEnoughRoom||Pt||Be.needsFlipping&&Sn(St,ee,!0,B,d,C,R,I.glyphOffsetArray,gt,vt,ae,oe,fe,dt,V,G).notEnoughRoom)&&ct(St.numGlyphs,vt)}S?I.text.dynamicLayoutVertexBuffer.updateData(vt):I.icon.dynamicLayoutVertexBuffer.updateData(vt)}function fr(I,d,_,S,C,R,N,B,V,G,Z,q,nt){const vt=B.glyphStartIndex+B.numGlyphs,gt=B.lineStartIndex,_t=B.lineStartIndex+B.lineLength,dt=d.getoffsetX(B.glyphStartIndex),Pt=d.getoffsetX(vt-1),$t=Q(I*dt,_,S,C,R,N,B.segment,gt,_t,V,G,Z,q,nt);if(!$t)return null;const St=Q(I*Pt,_,S,C,R,N,B.segment,gt,_t,V,G,Z,q,nt);return St?{first:$t,last:St}:null}function ur(I,d,_,S){return I===o.ai.horizontal&&Math.abs(_.y-d.y)>Math.abs(_.x-d.x)*S?{useVertical:!0}:(I===o.ai.vertical?d.y<_.y:d.x>_.x)?{needsFlipping:!0}:null}function Sn(I,d,_,S,C,R,N,B,V,G,Z,q,nt,vt,gt,_t){const dt=d/24,Pt=I.lineOffsetX*dt,$t=I.lineOffsetY*dt;let St;if(I.numGlyphs>1){const Lt=I.glyphStartIndex+I.numGlyphs,Gt=I.lineStartIndex,Xt=I.lineStartIndex+I.lineLength,ee=fr(dt,B,Pt,$t,_,Z,q,I,V,R,nt,gt,_t);if(!ee)return{notEnoughRoom:!0};const oe=Si(ee.first.point,N,_t).point,ae=Si(ee.last.point,N,_t).point;if(S&&!_){const fe=ur(I.writingMode,oe,ae,vt);if(fe)return fe}St=[ee.first];for(let fe=I.glyphStartIndex+1;fe<Lt-1;fe++)St.push(Q(dt*B.getoffsetX(fe),Pt,$t,_,Z,q,I.segment,Gt,Xt,V,R,nt,gt,_t));St.push(ee.last)}else{if(S&&!_){const Gt=Si(q,C,_t).point,Xt=I.lineStartIndex+I.segment+1,ee=new o.P(V.getx(Xt),V.gety(Xt)),oe=Si(ee,C,_t),ae=oe.signedDistanceFromCamera>0?oe.point:Aa(q,ee,Gt,1,C,_t),fe=ur(I.writingMode,Gt,ae,vt);if(fe)return fe}const Lt=Q(dt*B.getoffsetX(I.glyphStartIndex),Pt,$t,_,Z,q,I.segment,I.lineStartIndex,I.lineStartIndex+I.lineLength,V,R,nt,gt,_t);if(!Lt)return{notEnoughRoom:!0};St=[Lt]}for(const Lt of St)o.ak(G,Lt.point,Lt.angle);return{}}function Aa(I,d,_,S,C,R){const N=Si(I.add(I.sub(d)._unit()),C,R).point,B=_.sub(N);return _.add(B._mult(S/B.mag()))}function dr(I,d){const{projectionCache:_,lineVertexArray:S,labelPlaneMatrix:C,tileAnchorPoint:R,distanceFromAnchor:N,getElevation:B,previousVertex:V,direction:G,absOffsetX:Z}=d;if(_.projections[I])return _.projections[I];const q=new o.P(S.getx(I),S.gety(I)),nt=Si(q,C,B);if(nt.signedDistanceFromCamera>0)return _.projections[I]=nt.point,nt.point;const vt=I-G;return Aa(N===0?R:new o.P(S.getx(vt),S.gety(vt)),q,V,Z-N+1,C,B)}function Ca(I,d,_){return I._unit()._perp()._mult(d*_)}function yt(I,d,_,S,C,R,N,B){const{projectionCache:V,direction:G}=B;if(V.offsets[I])return V.offsets[I];const Z=_.add(d);if(I+G<S||I+G>=C)return V.offsets[I]=Z,Z;const q=dr(I+G,B),nt=Ca(q.sub(_),N,G),vt=_.add(nt),gt=q.add(nt);return V.offsets[I]=o.al(R,Z,vt,gt)||Z,V.offsets[I]}function Q(I,d,_,S,C,R,N,B,V,G,Z,q,nt,vt){const gt=S?I-d:I+d;let _t=gt>0?1:-1,dt=0;S&&(_t*=-1,dt=Math.PI),_t<0&&(dt+=Math.PI);let Pt,$t,St=_t>0?B+N:B+N+1,Lt=C,Gt=C,Xt=0,ee=0;const oe=Math.abs(gt),ae=[];let fe;for(;Xt+ee<=oe;){if(St+=_t,St<B||St>=V)return null;Xt+=ee,Gt=Lt,$t=Pt;const xe={projectionCache:q,lineVertexArray:G,labelPlaneMatrix:Z,tileAnchorPoint:R,distanceFromAnchor:Xt,getElevation:vt,previousVertex:Gt,direction:_t,absOffsetX:oe};if(Lt=dr(St,xe),_===0)ae.push(Gt),fe=Lt.sub(Gt);else{let rr;const Ue=Lt.sub(Gt);rr=Ue.mag()===0?Ca(dr(St+_t,xe).sub(Lt),_,_t):Ca(Ue,_,_t),$t||($t=Gt.add(rr)),Pt=yt(St,rr,Lt,B,V,$t,_,xe),ae.push($t),fe=Pt.sub($t)}ee=fe.mag()}const Be=fe._mult((oe-Xt)/ee)._add($t||Gt),Cr=dt+Math.atan2(Lt.y-Gt.y,Lt.x-Gt.x);return ae.push(Be),{point:Be,angle:nt?Cr:0,path:ae}}const rt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ct(I,d){for(let _=0;_<I;_++){const S=d.length;d.resize(S+4),d.float32.set(rt,3*S)}}function xt(I,d,_){const S=d[0],C=d[1];return I[0]=_[0]*S+_[4]*C+_[12],I[1]=_[1]*S+_[5]*C+_[13],I[3]=_[3]*S+_[7]*C+_[15],I}const wt=100;class Nt{constructor(d,_=new Ja(d.width+200,d.height+200,25),S=new Ja(d.width+200,d.height+200,25)){this.transform=d,this.grid=_,this.ignoredGrid=S,this.pitchfactor=Math.cos(d._pitch)*d.cameraToCenterDistance,this.screenRightBoundary=d.width+wt,this.screenBottomBoundary=d.height+wt,this.gridRightBoundary=d.width+200,this.gridBottomBoundary=d.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(d,_,S,C,R,N){const B=this.projectAndGetPerspectiveRatio(C,d.anchorPointX,d.anchorPointY,N),V=S*B.perspectiveRatio,G=d.x1*V+B.point.x,Z=d.y1*V+B.point.y,q=d.x2*V+B.point.x,nt=d.y2*V+B.point.y;return!this.isInsideGrid(G,Z,q,nt)||_!=="always"&&this.grid.hitTest(G,Z,q,nt,_,R)||B.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[G,Z,q,nt],offscreen:this.isOffscreen(G,Z,q,nt)}}placeCollisionCircles(d,_,S,C,R,N,B,V,G,Z,q,nt,vt,gt){const _t=[],dt=new o.P(_.anchorX,_.anchorY),Pt=Si(dt,N,gt),$t=co(this.transform.cameraToCenterDistance,Pt.signedDistanceFromCamera),St=(Z?R/$t:R*$t)/o.ap,Lt=Si(dt,B,gt).point,Gt=fr(St,C,_.lineOffsetX*St,_.lineOffsetY*St,!1,Lt,dt,_,S,B,{projections:{},offsets:{}},!1,gt);let Xt=!1,ee=!1,oe=!0;if(Gt){const ae=.5*nt*$t+vt,fe=new o.P(-100,-100),Be=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Cr=new uo,xe=Gt.first,rr=Gt.last;let Ue=[];for(let mr=xe.path.length-1;mr>=1;mr--)Ue.push(xe.path[mr]);for(let mr=1;mr<rr.path.length;mr++)Ue.push(rr.path[mr]);const ei=2.5*ae;if(V){const mr=Ue.map(Er=>Si(Er,V,gt));Ue=mr.some(Er=>Er.signedDistanceFromCamera<=0)?[]:mr.map(Er=>Er.point)}let Tr=[];if(Ue.length>0){const mr=Ue[0].clone(),Er=Ue[0].clone();for(let Bi=1;Bi<Ue.length;Bi++)mr.x=Math.min(mr.x,Ue[Bi].x),mr.y=Math.min(mr.y,Ue[Bi].y),Er.x=Math.max(Er.x,Ue[Bi].x),Er.y=Math.max(Er.y,Ue[Bi].y);Tr=mr.x>=fe.x&&Er.x<=Be.x&&mr.y>=fe.y&&Er.y<=Be.y?[Ue]:Er.x<fe.x||mr.x>Be.x||Er.y<fe.y||mr.y>Be.y?[]:o.am([Ue],fe.x,fe.y,Be.x,Be.y)}for(const mr of Tr){Cr.reset(mr,.25*ae);let Er=0;Er=Cr.length<=.5*ae?1:Math.ceil(Cr.paddedLength/ei)+1;for(let Bi=0;Bi<Er;Bi++){const ui=Bi/Math.max(Er-1,1),Cn=Cr.lerp(ui),on=Cn.x+wt,ji=Cn.y+wt;_t.push(on,ji,ae,0);const La=on-ae,vi=ji-ae,Ls=on+ae,ks=ji+ae;if(oe=oe&&this.isOffscreen(La,vi,Ls,ks),ee=ee||this.isInsideGrid(La,vi,Ls,ks),d!=="always"&&this.grid.hitTestCircle(on,ji,ae,d,q)&&(Xt=!0,!G))return{circles:[],offscreen:!1,collisionDetected:Xt}}}}return{circles:!G&&Xt||!ee||$t<this.perspectiveRatioCutoff?[]:_t,offscreen:oe,collisionDetected:Xt}}queryRenderedSymbols(d){if(d.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const _=[];let S=1/0,C=1/0,R=-1/0,N=-1/0;for(const Z of d){const q=new o.P(Z.x+wt,Z.y+wt);S=Math.min(S,q.x),C=Math.min(C,q.y),R=Math.max(R,q.x),N=Math.max(N,q.y),_.push(q)}const B=this.grid.query(S,C,R,N).concat(this.ignoredGrid.query(S,C,R,N)),V={},G={};for(const Z of B){const q=Z.key;if(V[q.bucketInstanceId]===void 0&&(V[q.bucketInstanceId]={}),V[q.bucketInstanceId][q.featureIndex])continue;const nt=[new o.P(Z.x1,Z.y1),new o.P(Z.x2,Z.y1),new o.P(Z.x2,Z.y2),new o.P(Z.x1,Z.y2)];o.an(_,nt)&&(V[q.bucketInstanceId][q.featureIndex]=!0,G[q.bucketInstanceId]===void 0&&(G[q.bucketInstanceId]=[]),G[q.bucketInstanceId].push(q.featureIndex))}return G}insertCollisionBox(d,_,S,C,R,N){(S?this.ignoredGrid:this.grid).insert({bucketInstanceId:C,featureIndex:R,collisionGroupID:N,overlapMode:_},d[0],d[1],d[2],d[3])}insertCollisionCircles(d,_,S,C,R,N){const B=S?this.ignoredGrid:this.grid,V={bucketInstanceId:C,featureIndex:R,collisionGroupID:N,overlapMode:_};for(let G=0;G<d.length;G+=4)B.insertCircle(V,d[G],d[G+1],d[G+2])}projectAndGetPerspectiveRatio(d,_,S,C){let R;return C?(R=[_,S,C(_,S),1],o.ag(R,R,d)):(R=[_,S,0,1],xt(R,R,d)),{point:new o.P((R[0]/R[3]+1)/2*this.transform.width+wt,(-R[1]/R[3]+1)/2*this.transform.height+wt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/R[3]*.5}}isOffscreen(d,_,S,C){return S<wt||d>=this.screenRightBoundary||C<wt||_>this.screenBottomBoundary}isInsideGrid(d,_,S,C){return S>=0&&d<this.gridRightBoundary&&C>=0&&_<this.gridBottomBoundary}getViewportMatrix(){const d=o.ao([]);return o.$(d,d,[-100,-100,0]),d}}function Mt(I,d,_){return d*(o.N/(I.tileSize*Math.pow(2,_-I.tileID.overscaledZ)))}class At{constructor(d,_,S,C){this.opacity=d?Math.max(0,Math.min(1,d.opacity+(d.placed?_:-_))):C&&S?1:0,this.placed=S}isHidden(){return this.opacity===0&&!this.placed}}class Dt{constructor(d,_,S,C,R){this.text=new At(d?d.text:null,_,S,R),this.icon=new At(d?d.icon:null,_,C,R)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yt{constructor(d,_,S){this.text=d,this.icon=_,this.skipFade=S}}class Qt{constructor(){this.invProjMatrix=o.Z(),this.viewportMatrix=o.Z(),this.circles=[]}}class ie{constructor(d,_,S,C,R){this.bucketInstanceId=d,this.featureIndex=_,this.sourceLayerIndex=S,this.bucketIndex=C,this.tileID=R}}class Xe{constructor(d){this.crossSourceCollisions=d,this.maxGroupID=0,this.collisionGroups={}}get(d){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[d]){const _=++this.maxGroupID;this.collisionGroups[d]={ID:_,predicate:S=>S.collisionGroupID===_}}return this.collisionGroups[d]}}function ar(I,d,_,S,C){const{horizontalAlign:R,verticalAlign:N}=o.au(I);return new o.P(-(R-.5)*d+S[0]*C,-(N-.5)*_+S[1]*C)}function Oe(I,d,_,S,C,R){const{x1:N,x2:B,y1:V,y2:G,anchorPointX:Z,anchorPointY:q}=I,nt=new o.P(d,_);return S&&nt._rotate(C?R:-R),{x1:N+nt.x,y1:V+nt.y,x2:B+nt.x,y2:G+nt.y,anchorPointX:Z,anchorPointY:q}}class qe{constructor(d,_,S,C,R){this.transform=d.clone(),this.terrain=_,this.collisionIndex=new Nt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=S,this.retainedQueryData={},this.collisionGroups=new Xe(C),this.collisionCircleArrays={},this.prevPlacement=R,R&&(R.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(d,_,S,C){const R=S.getBucket(_),N=S.latestFeatureIndex;if(!R||!N||_.id!==R.layerIds[0])return;const B=S.collisionBoxArray,V=R.layers[0].layout,G=Math.pow(2,this.transform.zoom-S.tileID.overscaledZ),Z=S.tileSize/o.N,q=this.transform.calculatePosMatrix(S.tileID.toUnwrapped()),nt=V.get("text-pitch-alignment")==="map",vt=V.get("text-rotation-alignment")==="map",gt=Mt(S,1,this.transform.zoom),_t=de(q,nt,vt,this.transform,gt);let dt=null;if(nt){const $t=Qa(q,nt,vt,this.transform,gt);dt=o.a1([],this.transform.labelPlaneMatrix,$t)}this.retainedQueryData[R.bucketInstanceId]=new ie(R.bucketInstanceId,N,R.sourceLayerIndex,R.index,S.tileID);const Pt={bucket:R,layout:V,posMatrix:q,textLabelPlaneMatrix:_t,labelToScreenMatrix:dt,scale:G,textPixelRatio:Z,holdingForFade:S.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:o.ah(R.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(R.sourceID)};if(C)for(const $t of R.sortKeyRanges){const{sortKey:St,symbolInstanceStart:Lt,symbolInstanceEnd:Gt}=$t;d.push({sortKey:St,symbolInstanceStart:Lt,symbolInstanceEnd:Gt,parameters:Pt})}else d.push({symbolInstanceStart:0,symbolInstanceEnd:R.symbolInstances.length,parameters:Pt})}attemptAnchorPlacement(d,_,S,C,R,N,B,V,G,Z,q,nt,vt,gt,_t,dt){const Pt=o.aq[d.textAnchor],$t=[d.textOffset0,d.textOffset1],St=ar(Pt,S,C,$t,R),Lt=this.collisionIndex.placeCollisionBox(Oe(_,St.x,St.y,N,B,this.transform.angle),q,V,G,Z.predicate,dt);if((!_t||this.collisionIndex.placeCollisionBox(Oe(_t,St.x,St.y,N,B,this.transform.angle),q,V,G,Z.predicate,dt).box.length!==0)&&Lt.box.length>0){let Gt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[nt.crossTileID]&&this.prevPlacement.placements[nt.crossTileID]&&this.prevPlacement.placements[nt.crossTileID].text&&(Gt=this.prevPlacement.variableOffsets[nt.crossTileID].anchor),nt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[nt.crossTileID]={textOffset:$t,width:S,height:C,anchor:Pt,textBoxScale:R,prevAnchor:Gt},this.markUsedJustification(vt,Pt,nt,gt),vt.allowVerticalPlacement&&(this.markUsedOrientation(vt,gt,nt),this.placedOrientations[nt.crossTileID]=gt),{shift:St,placedGlyphBoxes:Lt}}}placeLayerBucketPart(d,_,S){const{bucket:C,layout:R,posMatrix:N,textLabelPlaneMatrix:B,labelToScreenMatrix:V,textPixelRatio:G,holdingForFade:Z,collisionBoxArray:q,partiallyEvaluatedTextSize:nt,collisionGroup:vt}=d.parameters,gt=R.get("text-optional"),_t=R.get("icon-optional"),dt=o.ar(R,"text-overlap","text-allow-overlap"),Pt=dt==="always",$t=o.ar(R,"icon-overlap","icon-allow-overlap"),St=$t==="always",Lt=R.get("text-rotation-alignment")==="map",Gt=R.get("text-pitch-alignment")==="map",Xt=R.get("icon-text-fit")!=="none",ee=R.get("symbol-z-order")==="viewport-y",oe=Pt&&(St||!C.hasIconData()||_t),ae=St&&(Pt||!C.hasTextData()||gt);!C.collisionArrays&&q&&C.deserializeCollisionBoxes(q);const fe=this.retainedQueryData[C.bucketInstanceId].tileID,Be=this.terrain?(xe,rr)=>this.terrain.getElevation(fe,xe,rr):null,Cr=(xe,rr)=>{var Ue,ei;if(_[xe.crossTileID])return;if(Z)return void(this.placements[xe.crossTileID]=new Yt(!1,!1,!1));let Tr=!1,mr=!1,Er=!0,Bi=null,ui={box:null,offscreen:null},Cn={box:null,offscreen:null},on=null,ji=null,La=null,vi=0,Ls=0,ks=0;rr.textFeatureIndex?vi=rr.textFeatureIndex:xe.useRuntimeCollisionCircles&&(vi=xe.featureIndex),rr.verticalTextFeatureIndex&&(Ls=rr.verticalTextFeatureIndex);const Zo=rr.textBox;if(Zo){const On=zi=>{let ln=o.ai.horizontal;if(C.allowVerticalPlacement&&!zi&&this.prevPlacement){const ua=this.prevPlacement.placedOrientations[xe.crossTileID];ua&&(this.placedOrientations[xe.crossTileID]=ua,ln=ua,this.markUsedOrientation(C,ln,xe))}return ln},En=(zi,ln)=>{if(C.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&rr.verticalTextBox){for(const ua of C.writingModes)if(ua===o.ai.vertical?(ui=ln(),Cn=ui):ui=zi(),ui&&ui.box&&ui.box.length)break}else ui=zi()},Gn=xe.textAnchorOffsetStartIndex,zl=xe.textAnchorOffsetEndIndex;if(zl===Gn){const zi=(ln,ua)=>{const Vi=this.collisionIndex.placeCollisionBox(ln,dt,G,N,vt.predicate,Be);return Vi&&Vi.box&&Vi.box.length&&(this.markUsedOrientation(C,ua,xe),this.placedOrientations[xe.crossTileID]=ua),Vi};En(()=>zi(Zo,o.ai.horizontal),()=>{const ln=rr.verticalTextBox;return C.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&ln?zi(ln,o.ai.vertical):{box:null,offscreen:null}}),On(ui&&ui.box&&ui.box.length)}else{let zi=o.aq[(ei=(Ue=this.prevPlacement)===null||Ue===void 0?void 0:Ue.variableOffsets[xe.crossTileID])===null||ei===void 0?void 0:ei.anchor];const ln=(Vi,Vl,Dd)=>{const T0=Vi.x2-Vi.x1,A0=Vi.y2-Vi.y1,gT=xe.textBoxScale,Cv=Xt&&$t==="never"?Vl:null;let Os={box:[],offscreen:!1},Ul=dt==="never"?1:2,Ns="never";zi&&Ul++;for(let ns=0;ns<Ul;ns++){for(let Fs=Gn;Fs<zl;Fs++){const Ev=C.textAnchorOffsets.get(Fs);if(zi&&Ev.textAnchor!==zi)continue;const _o=this.attemptAnchorPlacement(Ev,Vi,T0,A0,gT,Lt,Gt,G,N,vt,Ns,xe,C,Dd,Cv,Be);if(_o&&(Os=_o.placedGlyphBoxes,Os&&Os.box&&Os.box.length))return Tr=!0,Bi=_o.shift,Os}zi?zi=null:Ns=dt}return Os};En(()=>ln(Zo,rr.iconBox,o.ai.horizontal),()=>{const Vi=rr.verticalTextBox;return C.allowVerticalPlacement&&!(ui&&ui.box&&ui.box.length)&&xe.numVerticalGlyphVertices>0&&Vi?ln(Vi,rr.verticalIconBox,o.ai.vertical):{box:null,offscreen:null}}),ui&&(Tr=ui.box,Er=ui.offscreen);const ua=On(ui&&ui.box);if(!Tr&&this.prevPlacement){const Vi=this.prevPlacement.variableOffsets[xe.crossTileID];Vi&&(this.variableOffsets[xe.crossTileID]=Vi,this.markUsedJustification(C,Vi.anchor,xe,ua))}}}if(on=ui,Tr=on&&on.box&&on.box.length>0,Er=on&&on.offscreen,xe.useRuntimeCollisionCircles){const On=C.text.placedSymbolArray.get(xe.centerJustifiedTextSymbolIndex),En=o.aj(C.textSizeData,nt,On),Gn=R.get("text-padding");ji=this.collisionIndex.placeCollisionCircles(dt,On,C.lineVertexArray,C.glyphOffsetArray,En,N,B,V,S,Gt,vt.predicate,xe.collisionCircleDiameter,Gn,Be),ji.circles.length&&ji.collisionDetected&&!S&&o.w("Collisions detected, but collision boxes are not shown"),Tr=Pt||ji.circles.length>0&&!ji.collisionDetected,Er=Er&&ji.offscreen}if(rr.iconFeatureIndex&&(ks=rr.iconFeatureIndex),rr.iconBox){const On=En=>{const Gn=Xt&&Bi?Oe(En,Bi.x,Bi.y,Lt,Gt,this.transform.angle):En;return this.collisionIndex.placeCollisionBox(Gn,$t,G,N,vt.predicate,Be)};Cn&&Cn.box&&Cn.box.length&&rr.verticalIconBox?(La=On(rr.verticalIconBox),mr=La.box.length>0):(La=On(rr.iconBox),mr=La.box.length>0),Er=Er&&La.offscreen}const Bl=gt||xe.numHorizontalGlyphVertices===0&&xe.numVerticalGlyphVertices===0,Fu=_t||xe.numIconVertices===0;if(Bl||Fu?Fu?Bl||(mr=mr&&Tr):Tr=mr&&Tr:mr=Tr=mr&&Tr,Tr&&on&&on.box&&this.collisionIndex.insertCollisionBox(on.box,dt,R.get("text-ignore-placement"),C.bucketInstanceId,Cn&&Cn.box&&Ls?Ls:vi,vt.ID),mr&&La&&this.collisionIndex.insertCollisionBox(La.box,$t,R.get("icon-ignore-placement"),C.bucketInstanceId,ks,vt.ID),ji&&(Tr&&this.collisionIndex.insertCollisionCircles(ji.circles,dt,R.get("text-ignore-placement"),C.bucketInstanceId,vi,vt.ID),S)){const On=C.bucketInstanceId;let En=this.collisionCircleArrays[On];En===void 0&&(En=this.collisionCircleArrays[On]=new Qt);for(let Gn=0;Gn<ji.circles.length;Gn+=4)En.circles.push(ji.circles[Gn+0]),En.circles.push(ji.circles[Gn+1]),En.circles.push(ji.circles[Gn+2]),En.circles.push(ji.collisionDetected?1:0)}if(xe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(C.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[xe.crossTileID]=new Yt(Tr||oe,mr||ae,Er||C.justReloaded),_[xe.crossTileID]=!0};if(ee){if(d.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const xe=C.getSortedSymbolIndexes(this.transform.angle);for(let rr=xe.length-1;rr>=0;--rr){const Ue=xe[rr];Cr(C.symbolInstances.get(Ue),C.collisionArrays[Ue])}}else for(let xe=d.symbolInstanceStart;xe<d.symbolInstanceEnd;xe++)Cr(C.symbolInstances.get(xe),C.collisionArrays[xe]);if(S&&C.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[C.bucketInstanceId];o.as(xe.invProjMatrix,N),xe.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(d,_,S,C){let R;R=C===o.ai.vertical?S.verticalPlacedTextSymbolIndex:{left:S.leftJustifiedTextSymbolIndex,center:S.centerJustifiedTextSymbolIndex,right:S.rightJustifiedTextSymbolIndex}[o.at(_)];const N=[S.leftJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.rightJustifiedTextSymbolIndex,S.verticalPlacedTextSymbolIndex];for(const B of N)B>=0&&(d.text.placedSymbolArray.get(B).crossTileID=R>=0&&B!==R?0:S.crossTileID)}markUsedOrientation(d,_,S){const C=_===o.ai.horizontal||_===o.ai.horizontalOnly?_:0,R=_===o.ai.vertical?_:0,N=[S.leftJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.rightJustifiedTextSymbolIndex];for(const B of N)d.text.placedSymbolArray.get(B).placedOrientation=C;S.verticalPlacedTextSymbolIndex&&(d.text.placedSymbolArray.get(S.verticalPlacedTextSymbolIndex).placedOrientation=R)}commit(d){this.commitTime=d,this.zoomAtLastRecencyCheck=this.transform.zoom;const _=this.prevPlacement;let S=!1;this.prevZoomAdjustment=_?_.zoomAdjustment(this.transform.zoom):0;const C=_?_.symbolFadeChange(d):1,R=_?_.opacities:{},N=_?_.variableOffsets:{},B=_?_.placedOrientations:{};for(const V in this.placements){const G=this.placements[V],Z=R[V];Z?(this.opacities[V]=new Dt(Z,C,G.text,G.icon),S=S||G.text!==Z.text.placed||G.icon!==Z.icon.placed):(this.opacities[V]=new Dt(null,C,G.text,G.icon,G.skipFade),S=S||G.text||G.icon)}for(const V in R){const G=R[V];if(!this.opacities[V]){const Z=new Dt(G,C,!1,!1);Z.isHidden()||(this.opacities[V]=Z,S=S||G.text.placed||G.icon.placed)}}for(const V in N)this.variableOffsets[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.variableOffsets[V]=N[V]);for(const V in B)this.placedOrientations[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.placedOrientations[V]=B[V]);if(_&&_.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");S?this.lastPlacementChangeTime=d:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=_?_.lastPlacementChangeTime:d)}updateLayerOpacities(d,_){const S={};for(const C of _){const R=C.getBucket(d);R&&C.latestFeatureIndex&&d.id===R.layerIds[0]&&this.updateBucketOpacities(R,S,C.collisionBoxArray)}}updateBucketOpacities(d,_,S){d.hasTextData()&&(d.text.opacityVertexArray.clear(),d.text.hasVisibleVertices=!1),d.hasIconData()&&(d.icon.opacityVertexArray.clear(),d.icon.hasVisibleVertices=!1),d.hasIconCollisionBoxData()&&d.iconCollisionBox.collisionVertexArray.clear(),d.hasTextCollisionBoxData()&&d.textCollisionBox.collisionVertexArray.clear();const C=d.layers[0],R=C.layout,N=new Dt(null,0,!1,!1,!0),B=R.get("text-allow-overlap"),V=R.get("icon-allow-overlap"),G=C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Z=R.get("text-rotation-alignment")==="map",q=R.get("text-pitch-alignment")==="map",nt=R.get("icon-text-fit")!=="none",vt=new Dt(null,0,B&&(V||!d.hasIconData()||R.get("icon-optional")),V&&(B||!d.hasTextData()||R.get("text-optional")),!0);!d.collisionArrays&&S&&(d.hasIconCollisionBoxData()||d.hasTextCollisionBoxData())&&d.deserializeCollisionBoxes(S);const gt=(_t,dt,Pt)=>{for(let $t=0;$t<dt/4;$t++)_t.opacityVertexArray.emplaceBack(Pt);_t.hasVisibleVertices=_t.hasVisibleVertices||Pt!==na};for(let _t=0;_t<d.symbolInstances.length;_t++){const dt=d.symbolInstances.get(_t),{numHorizontalGlyphVertices:Pt,numVerticalGlyphVertices:$t,crossTileID:St}=dt;let Lt=this.opacities[St];_[St]?Lt=N:Lt||(Lt=vt,this.opacities[St]=Lt),_[St]=!0;const Gt=dt.numIconVertices>0,Xt=this.placedOrientations[dt.crossTileID],ee=Xt===o.ai.vertical,oe=Xt===o.ai.horizontal||Xt===o.ai.horizontalOnly;if(Pt>0||$t>0){const ae=an(Lt.text);gt(d.text,Pt,ee?na:ae),gt(d.text,$t,oe?na:ae);const fe=Lt.text.isHidden();[dt.rightJustifiedTextSymbolIndex,dt.centerJustifiedTextSymbolIndex,dt.leftJustifiedTextSymbolIndex].forEach(xe=>{xe>=0&&(d.text.placedSymbolArray.get(xe).hidden=fe||ee?1:0)}),dt.verticalPlacedTextSymbolIndex>=0&&(d.text.placedSymbolArray.get(dt.verticalPlacedTextSymbolIndex).hidden=fe||oe?1:0);const Be=this.variableOffsets[dt.crossTileID];Be&&this.markUsedJustification(d,Be.anchor,dt,Xt);const Cr=this.placedOrientations[dt.crossTileID];Cr&&(this.markUsedJustification(d,"left",dt,Cr),this.markUsedOrientation(d,Cr,dt))}if(Gt){const ae=an(Lt.icon),fe=!(nt&&dt.verticalPlacedIconSymbolIndex&&ee);dt.placedIconSymbolIndex>=0&&(gt(d.icon,dt.numIconVertices,fe?ae:na),d.icon.placedSymbolArray.get(dt.placedIconSymbolIndex).hidden=Lt.icon.isHidden()),dt.verticalPlacedIconSymbolIndex>=0&&(gt(d.icon,dt.numVerticalIconVertices,fe?na:ae),d.icon.placedSymbolArray.get(dt.verticalPlacedIconSymbolIndex).hidden=Lt.icon.isHidden())}if(d.hasIconCollisionBoxData()||d.hasTextCollisionBoxData()){const ae=d.collisionArrays[_t];if(ae){let fe=new o.P(0,0);if(ae.textBox||ae.verticalTextBox){let Cr=!0;if(G){const xe=this.variableOffsets[St];xe?(fe=ar(xe.anchor,xe.width,xe.height,xe.textOffset,xe.textBoxScale),Z&&fe._rotate(q?this.transform.angle:-this.transform.angle)):Cr=!1}ae.textBox&&or(d.textCollisionBox.collisionVertexArray,Lt.text.placed,!Cr||ee,fe.x,fe.y),ae.verticalTextBox&&or(d.textCollisionBox.collisionVertexArray,Lt.text.placed,!Cr||oe,fe.x,fe.y)}const Be=!!(!oe&&ae.verticalIconBox);ae.iconBox&&or(d.iconCollisionBox.collisionVertexArray,Lt.icon.placed,Be,nt?fe.x:0,nt?fe.y:0),ae.verticalIconBox&&or(d.iconCollisionBox.collisionVertexArray,Lt.icon.placed,!Be,nt?fe.x:0,nt?fe.y:0)}}}if(d.sortFeatures(this.transform.angle),this.retainedQueryData[d.bucketInstanceId]&&(this.retainedQueryData[d.bucketInstanceId].featureSortOrder=d.featureSortOrder),d.hasTextData()&&d.text.opacityVertexBuffer&&d.text.opacityVertexBuffer.updateData(d.text.opacityVertexArray),d.hasIconData()&&d.icon.opacityVertexBuffer&&d.icon.opacityVertexBuffer.updateData(d.icon.opacityVertexArray),d.hasIconCollisionBoxData()&&d.iconCollisionBox.collisionVertexBuffer&&d.iconCollisionBox.collisionVertexBuffer.updateData(d.iconCollisionBox.collisionVertexArray),d.hasTextCollisionBoxData()&&d.textCollisionBox.collisionVertexBuffer&&d.textCollisionBox.collisionVertexBuffer.updateData(d.textCollisionBox.collisionVertexArray),d.text.opacityVertexArray.length!==d.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${d.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${d.text.layoutVertexArray.length}) / 4`);if(d.icon.opacityVertexArray.length!==d.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${d.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${d.icon.layoutVertexArray.length}) / 4`);if(d.bucketInstanceId in this.collisionCircleArrays){const _t=this.collisionCircleArrays[d.bucketInstanceId];d.placementInvProjMatrix=_t.invProjMatrix,d.placementViewportMatrix=_t.viewportMatrix,d.collisionCircleArray=_t.circles,delete this.collisionCircleArrays[d.bucketInstanceId]}}symbolFadeChange(d){return this.fadeDuration===0?1:(d-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(d){return Math.max(0,(this.transform.zoom-d)/1.5)}hasTransitions(d){return this.stale||d-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(d,_){const S=this.zoomAtLastRecencyCheck===_?1-this.zoomAdjustment(_):1;return this.zoomAtLastRecencyCheck=_,this.commitTime+this.fadeDuration*S>d}setStale(){this.stale=!0}}function or(I,d,_,S,C){I.emplaceBack(d?1:0,_?1:0,S||0,C||0),I.emplaceBack(d?1:0,_?1:0,S||0,C||0),I.emplaceBack(d?1:0,_?1:0,S||0,C||0),I.emplaceBack(d?1:0,_?1:0,S||0,C||0)}const Hr=Math.pow(2,25),Zr=Math.pow(2,24),yr=Math.pow(2,17),xr=Math.pow(2,16),Ni=Math.pow(2,9),Kr=Math.pow(2,8),Ii=Math.pow(2,1);function an(I){if(I.opacity===0&&!I.placed)return 0;if(I.opacity===1&&I.placed)return 4294967295;const d=I.placed?1:0,_=Math.floor(127*I.opacity);return _*Hr+d*Zr+_*yr+d*xr+_*Ni+d*Kr+_*Ii+d}const na=0;class Pl{constructor(d){this._sortAcrossTiles=d.layout.get("symbol-z-order")!=="viewport-y"&&!d.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(d,_,S,C,R){const N=this._bucketParts;for(;this._currentTileIndex<d.length;)if(_.getBucketParts(N,C,d[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,R())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,N.sort((B,V)=>B.sortKey-V.sortKey));this._currentPartIndex<N.length;)if(_.placeLayerBucketPart(N[this._currentPartIndex],this._seenCrossTileIDs,S),this._currentPartIndex++,R())return!0;return!1}}class sn{constructor(d,_,S,C,R,N,B,V){this.placement=new qe(d,_,N,B,V),this._currentPlacementIndex=S.length-1,this._forceFullPlacement=C,this._showCollisionBoxes=R,this._done=!1}isDone(){return this._done}continuePlacement(d,_,S){const C=o.h.now(),R=()=>!this._forceFullPlacement&&o.h.now()-C>2;for(;this._currentPlacementIndex>=0;){const N=_[d[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=B)&&(!N.maxzoom||N.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new Pl(N)),this._inProgressLayer.continuePlacement(S[N.source],this.placement,this._showCollisionBoxes,N,R))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(d){return this.placement.commit(d),this.placement}}const Ea=512/o.N/2;class Ps{constructor(d,_,S){this.tileID=d,this.bucketInstanceId=S,this._symbolsByKey={};const C=new Map;for(let R=0;R<_.length;R++){const N=_.get(R),B=N.key,V=C.get(B);V?V.push(N):C.set(B,[N])}for(const[R,N]of C){const B={positions:N.map(V=>({x:Math.floor(V.anchorX*Ea),y:Math.floor(V.anchorY*Ea)})),crossTileIDs:N.map(V=>V.crossTileID)};if(B.positions.length>128){const V=new o.av(B.positions.length,16,Uint16Array);for(const{x:G,y:Z}of B.positions)V.add(G,Z);V.finish(),delete B.positions,B.index=V}this._symbolsByKey[R]=B}}getScaledCoordinates(d,_){const{x:S,y:C,z:R}=this.tileID.canonical,{x:N,y:B,z:V}=_.canonical,G=Ea/Math.pow(2,V-R),Z=(B*o.N+d.anchorY)*G,q=C*o.N*Ea;return{x:Math.floor((N*o.N+d.anchorX)*G-S*o.N*Ea),y:Math.floor(Z-q)}}findMatches(d,_,S){const C=this.tileID.canonical.z<_.canonical.z?1:Math.pow(2,this.tileID.canonical.z-_.canonical.z);for(let R=0;R<d.length;R++){const N=d.get(R);if(N.crossTileID)continue;const B=this._symbolsByKey[N.key];if(!B)continue;const V=this.getScaledCoordinates(N,_);if(B.index){const G=B.index.range(V.x-C,V.y-C,V.x+C,V.y+C).sort();for(const Z of G){const q=B.crossTileIDs[Z];if(!S[q]){S[q]=!0,N.crossTileID=q;break}}}else if(B.positions)for(let G=0;G<B.positions.length;G++){const Z=B.positions[G],q=B.crossTileIDs[G];if(Math.abs(Z.x-V.x)<=C&&Math.abs(Z.y-V.y)<=C&&!S[q]){S[q]=!0,N.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:d})=>d)}}class Ar{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ho{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(d){const _=Math.round((d-this.lng)/360);if(_!==0)for(const S in this.indexes){const C=this.indexes[S],R={};for(const N in C){const B=C[N];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+_),R[B.tileID.key]=B}this.indexes[S]=R}this.lng=d}addBucket(d,_,S){if(this.indexes[d.overscaledZ]&&this.indexes[d.overscaledZ][d.key]){if(this.indexes[d.overscaledZ][d.key].bucketInstanceId===_.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(d.overscaledZ,this.indexes[d.overscaledZ][d.key])}for(let R=0;R<_.symbolInstances.length;R++)_.symbolInstances.get(R).crossTileID=0;this.usedCrossTileIDs[d.overscaledZ]||(this.usedCrossTileIDs[d.overscaledZ]={});const C=this.usedCrossTileIDs[d.overscaledZ];for(const R in this.indexes){const N=this.indexes[R];if(Number(R)>d.overscaledZ)for(const B in N){const V=N[B];V.tileID.isChildOf(d)&&V.findMatches(_.symbolInstances,d,C)}else{const B=N[d.scaledTo(Number(R)).key];B&&B.findMatches(_.symbolInstances,d,C)}}for(let R=0;R<_.symbolInstances.length;R++){const N=_.symbolInstances.get(R);N.crossTileID||(N.crossTileID=S.generate(),C[N.crossTileID]=!0)}return this.indexes[d.overscaledZ]===void 0&&(this.indexes[d.overscaledZ]={}),this.indexes[d.overscaledZ][d.key]=new Ps(d,_.symbolInstances,_.bucketInstanceId),!0}removeBucketCrossTileIDs(d,_){for(const S of _.getCrossTileIDsLists())for(const C of S)delete this.usedCrossTileIDs[d][C]}removeStaleBuckets(d){let _=!1;for(const S in this.indexes){const C=this.indexes[S];for(const R in C)d[C[R].bucketInstanceId]||(this.removeBucketCrossTileIDs(S,C[R]),delete C[R],_=!0)}return _}}class Wn{constructor(){this.layerIndexes={},this.crossTileIDs=new Ar,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(d,_,S){let C=this.layerIndexes[d.id];C===void 0&&(C=this.layerIndexes[d.id]=new ho);let R=!1;const N={};C.handleWrapJump(S);for(const B of _){const V=B.getBucket(d);V&&d.id===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(B.tileID,V,this.crossTileIDs)&&(R=!0),N[V.bucketInstanceId]=!0)}return C.removeStaleBuckets(N)&&(R=!0),R}pruneUnusedLayers(d){const _={};d.forEach(S=>{_[S]=!0});for(const S in this.layerIndexes)_[S]||delete this.layerIndexes[S]}}const pi=(I,d)=>o.x(I,d&&d.filter(_=>_.identifier!=="source.canvas")),kn=o.F(o.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),ld=o.F(o.ax,["setCenter","setZoom","setBearing","setPitch"]),Tn=o.aw();class ii extends o.E{constructor(d,_={}){super(),this.map=d,this.dispatcher=new ne(Ml(),this,d._getMapId()),this.imageManager=new tt,this.imageManager.setEventedParent(this),this.glyphManager=new Tt(d._requestManager,_.localIdeographFontFamily),this.lineAtlas=new Jt(256,512),this.crossTileSymbolIndex=new Wn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.az());const S=this;this._rtlTextPluginCallback=ii.registerForPluginStateChange(C=>{S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:C.pluginStatus,pluginURL:C.pluginURL},(R,N)=>{if(o.aA(R),N&&N.every(B=>B))for(const B in S.sourceCaches){const V=S.sourceCaches[B].getSource().type;V!=="vector"&&V!=="geojson"||S.sourceCaches[B].reload()}})}),this.on("data",C=>{if(C.dataType!=="source"||C.sourceDataType!=="metadata")return;const R=this.sourceCaches[C.sourceId];if(!R)return;const N=R.getSource();if(N&&N.vectorLayerIds)for(const B in this._layers){const V=this._layers[B];V.source===N.id&&this._validateLayer(V)}})}loadURL(d,_={},S){this.fire(new o.k("dataloading",{dataType:"style"})),_.validate=typeof _.validate!="boolean"||_.validate;const C=this.map._requestManager.transformRequest(d,T.Style);this._request=o.f(C,(R,N)=>{this._request=null,R?this.fire(new o.j(R)):N&&this._load(N,_,S)})}loadJSON(d,_={},S){this.fire(new o.k("dataloading",{dataType:"style"})),this._request=o.h.frame(()=>{this._request=null,_.validate=_.validate!==!1,this._load(d,_,S)})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(Tn,{validate:!1})}_load(d,_,S){var C;const R=_.transformStyle?_.transformStyle(S,d):d;if(!_.validate||!pi(this,o.y(R))){this._loaded=!0,this.stylesheet=R;for(const N in R.sources)this.addSource(N,R.sources[N],{validate:!1});R.sprite?this._loadSprite(R.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(R.glyphs),this._createLayers(),this.light=new Ut(this.stylesheet.light),this.map.setTerrain((C=this.stylesheet.terrain)!==null&&C!==void 0?C:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const d=o.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",d),this._order=d.map(_=>_.id),this._layers={},this._serializedLayers=null;for(const _ of d){const S=o.aC(_);S.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=S}}_loadSprite(d,_=!1,S=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(C,R,N,B){const V=W(C),G=V.length,Z=N>1?"@2x":"",q={},nt={},vt={};for(const{id:gt,url:_t}of V){const dt=R.transformRequest(R.normalizeSpriteURL(_t,Z,".json"),T.SpriteJSON),Pt=`${gt}_${dt.url}`;q[Pt]=o.f(dt,(Lt,Gt)=>{delete q[Pt],nt[gt]=Gt,H(B,nt,vt,Lt,G)});const $t=R.transformRequest(R.normalizeSpriteURL(_t,Z,".png"),T.SpriteImage),St=`${gt}_${$t.url}`;q[St]=w.getImage($t,(Lt,Gt)=>{delete q[St],vt[gt]=Gt,H(B,nt,vt,Lt,G)})}return{cancel(){for(const gt of Object.values(q))gt.cancel()}}}(d,this.map._requestManager,this.map.getPixelRatio(),(C,R)=>{if(this._spriteRequest=null,C)this.fire(new o.j(C));else if(R)for(const N in R){this._spritesImagesIds[N]=[];const B=this._spritesImagesIds[N]?this._spritesImagesIds[N].filter(V=>!(V in R)):[];for(const V of B)this.imageManager.removeImage(V),this._changedImages[V]=!0;for(const V in R[N]){const G=N==="default"?V:`${N}:${V}`;this._spritesImagesIds[N].push(G),G in this.imageManager.images?this.imageManager.updateImage(G,R[N][V],!1):this.imageManager.addImage(G,R[N][V]),_&&(this._changedImages[G]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),_&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),S&&S(C)})}_unloadSprite(){for(const d of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(d),this._changedImages[d]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(d){const _=this.sourceCaches[d.source];if(!_)return;const S=d.sourceLayer;if(!S)return;const C=_.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(S)===-1)&&this.fire(new o.j(new Error(`Source layer "${S}" does not exist on source "${C.id}" as specified by style layer "${d.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const d in this.sourceCaches)if(!this.sourceCaches[d].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(d){const _=this._serializedAllLayers();if(!d||d.length===0)return Object.values(_);const S=[];for(const C of d)_[C]&&S.push(_[C]);return S}_serializedAllLayers(){let d=this._serializedLayers;if(d)return d;d=this._serializedLayers={};const _=Object.keys(this._layers);for(const S of _){const C=this._layers[S];C.type!=="custom"&&(d[S]=C.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(d){if(!this._loaded)return;const _=this._changed;if(this._changed){const C=Object.keys(this._updatedLayers),R=Object.keys(this._removedLayers);(C.length||R.length)&&this._updateWorkerLayers(C,R);for(const N in this._updatedSources){const B=this._updatedSources[N];if(B==="reload")this._reloadSource(N);else{if(B!=="clear")throw new Error(`Invalid action ${B}`);this._clearSource(N)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const N in this._updatedPaintProps)this._layers[N].updateTransitions(d);this.light.updateTransitions(d),this._resetUpdates()}const S={};for(const C in this.sourceCaches){const R=this.sourceCaches[C];S[C]=R.used,R.used=!1}for(const C of this._order){const R=this._layers[C];R.recalculate(d,this._availableImages),!R.isHidden(d.zoom)&&R.source&&(this.sourceCaches[R.source].used=!0)}for(const C in S){const R=this.sourceCaches[C];S[C]!==R.used&&R.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:C}))}this.light.recalculate(d),this.z=d.zoom,_&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const d=Object.keys(this._changedImages);if(d.length){for(const _ in this.sourceCaches)this.sourceCaches[_].reloadTilesForDependencies(["icons","patterns"],d);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(d,_){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(d),removedIds:_})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(d,_={}){this._checkLoaded();const S=this.serialize();if(d=_.transformStyle?_.transformStyle(S,d):d,pi(this,o.y(d)))return!1;(d=o.aD(d)).layers=o.aB(d.layers);const C=o.aE(S,d).filter(N=>!(N.command in ld));if(C.length===0)return!1;const R=C.filter(N=>!(N.command in kn));if(R.length>0)throw new Error(`Unimplemented: ${R.map(N=>N.command).join(", ")}.`);for(const N of C)N.command!=="setTransition"&&this[N.command].apply(this,N.args);return this.stylesheet=d,this._serializedLayers=null,!0}addImage(d,_){if(this.getImage(d))return this.fire(new o.j(new Error(`An image named "${d}" already exists.`)));this.imageManager.addImage(d,_),this._afterImageUpdated(d)}updateImage(d,_){this.imageManager.updateImage(d,_)}getImage(d){return this.imageManager.getImage(d)}removeImage(d){if(!this.getImage(d))return this.fire(new o.j(new Error(`An image named "${d}" does not exist.`)));this.imageManager.removeImage(d),this._afterImageUpdated(d)}_afterImageUpdated(d){this._availableImages=this.imageManager.listImages(),this._changedImages[d]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(d,_,S={}){if(this._checkLoaded(),this.sourceCaches[d]!==void 0)throw new Error(`Source "${d}" already exists.`);if(!_.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(_).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(_.type)>=0&&this._validate(o.y.source,`sources.${d}`,_,null,S))return;this.map&&this.map._collectResourceTiming&&(_.collectResourceTiming=!0);const C=this.sourceCaches[d]=new Ur(d,_,this.dispatcher);C.style=this,C.setEventedParent(this,()=>({isSourceLoaded:C.loaded(),source:C.serialize(),sourceId:d})),C.onAdd(this.map),this._changed=!0}removeSource(d){if(this._checkLoaded(),this.sourceCaches[d]===void 0)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===d)return this.fire(new o.j(new Error(`Source "${d}" cannot be removed while layer "${S}" is using it.`)));const _=this.sourceCaches[d];delete this.sourceCaches[d],delete this._updatedSources[d],_.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:d})),_.setEventedParent(null),_.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(d,_){if(this._checkLoaded(),this.sourceCaches[d]===void 0)throw new Error(`There is no source with this ID=${d}`);const S=this.sourceCaches[d].getSource();if(S.type!=="geojson")throw new Error(`geojsonSource.type is ${S.type}, which is !== 'geojson`);S.setData(_),this._changed=!0}getSource(d){return this.sourceCaches[d]&&this.sourceCaches[d].getSource()}addLayer(d,_,S={}){this._checkLoaded();const C=d.id;if(this.getLayer(C))return void this.fire(new o.j(new Error(`Layer "${C}" already exists on this map.`)));let R;if(d.type==="custom"){if(pi(this,o.aF(d)))return;R=o.aC(d)}else{if("source"in d&&typeof d.source=="object"&&(this.addSource(C,d.source),d=o.aD(d),d=o.e(d,{source:C})),this._validate(o.y.layer,`layers.${C}`,d,{arrayIndex:-1},S))return;R=o.aC(d),this._validateLayer(R),R.setEventedParent(this,{layer:{id:C}})}const N=_?this._order.indexOf(_):this._order.length;if(_&&N===-1)this.fire(new o.j(new Error(`Cannot add layer "${C}" before non-existing layer "${_}".`)));else{if(this._order.splice(N,0,C),this._layerOrderChanged=!0,this._layers[C]=R,this._removedLayers[C]&&R.source&&R.type!=="custom"){const B=this._removedLayers[C];delete this._removedLayers[C],B.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}moveLayer(d,_){if(this._checkLoaded(),this._changed=!0,!this._layers[d])return void this.fire(new o.j(new Error(`The layer '${d}' does not exist in the map's style and cannot be moved.`)));if(d===_)return;const S=this._order.indexOf(d);this._order.splice(S,1);const C=_?this._order.indexOf(_):this._order.length;_&&C===-1?this.fire(new o.j(new Error(`Cannot move layer "${d}" before non-existing layer "${_}".`))):(this._order.splice(C,0,d),this._layerOrderChanged=!0)}removeLayer(d){this._checkLoaded();const _=this._layers[d];if(!_)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${d}".`)));_.setEventedParent(null);const S=this._order.indexOf(d);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[d]=_,delete this._layers[d],this._serializedLayers&&delete this._serializedLayers[d],delete this._updatedLayers[d],delete this._updatedPaintProps[d],_.onRemove&&_.onRemove(this.map)}getLayer(d){return this._layers[d]}getLayersOrder(){return[...this._order]}hasLayer(d){return d in this._layers}setLayerZoomRange(d,_,S){this._checkLoaded();const C=this.getLayer(d);C?C.minzoom===_&&C.maxzoom===S||(_!=null&&(C.minzoom=_),S!=null&&(C.maxzoom=S),this._updateLayer(C)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${d}".`)))}setFilter(d,_,S={}){this._checkLoaded();const C=this.getLayer(d);if(C){if(!o.aG(C.filter,_))return _==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(o.y.filter,`layers.${C.id}.filter`,_,null,S)||(C.filter=o.aD(_),this._updateLayer(C)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${d}".`)))}getFilter(d){return o.aD(this.getLayer(d).filter)}setLayoutProperty(d,_,S,C={}){this._checkLoaded();const R=this.getLayer(d);R?o.aG(R.getLayoutProperty(_),S)||(R.setLayoutProperty(_,S,C),this._updateLayer(R)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${d}".`)))}getLayoutProperty(d,_){const S=this.getLayer(d);if(S)return S.getLayoutProperty(_);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${d}".`)))}setPaintProperty(d,_,S,C={}){this._checkLoaded();const R=this.getLayer(d);R?o.aG(R.getPaintProperty(_),S)||(R.setPaintProperty(_,S,C)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[d]=!0):this.fire(new o.j(new Error(`Cannot style non-existing layer "${d}".`)))}getPaintProperty(d,_){return this.getLayer(d).getPaintProperty(_)}setFeatureState(d,_){this._checkLoaded();const S=d.source,C=d.sourceLayer,R=this.sourceCaches[S];if(R===void 0)return void this.fire(new o.j(new Error(`The source '${S}' does not exist in the map's style.`)));const N=R.getSource().type;N==="geojson"&&C?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):N!=="vector"||C?(d.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),R.setFeatureState(C,d.id,_)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(d,_){this._checkLoaded();const S=d.source,C=this.sourceCaches[S];if(C===void 0)return void this.fire(new o.j(new Error(`The source '${S}' does not exist in the map's style.`)));const R=C.getSource().type,N=R==="vector"?d.sourceLayer:void 0;R!=="vector"||N?_&&typeof d.id!="string"&&typeof d.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(N,d.id,_):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(d){this._checkLoaded();const _=d.source,S=d.sourceLayer,C=this.sourceCaches[_];if(C!==void 0)return C.getSource().type!=="vector"||S?(d.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),C.getFeatureState(S,d.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${_}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const d=o.aH(this.sourceCaches,R=>R.serialize()),_=this._serializeByIds(this._order),S=this.map.getTerrain()||void 0,C=this.stylesheet;return o.aI({version:C.version,name:C.name,metadata:C.metadata,light:C.light,center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch,sprite:C.sprite,glyphs:C.glyphs,transition:C.transition,sources:d,layers:_,terrain:S},R=>R!==void 0)}_updateLayer(d){this._updatedLayers[d.id]=!0,d.source&&!this._updatedSources[d.source]&&this.sourceCaches[d.source].getSource().type!=="raster"&&(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(d){const _=N=>this._layers[N].type==="fill-extrusion",S={},C=[];for(let N=this._order.length-1;N>=0;N--){const B=this._order[N];if(_(B)){S[B]=N;for(const V of d){const G=V[B];if(G)for(const Z of G)C.push(Z)}}}C.sort((N,B)=>B.intersectionZ-N.intersectionZ);const R=[];for(let N=this._order.length-1;N>=0;N--){const B=this._order[N];if(_(B))for(let V=C.length-1;V>=0;V--){const G=C[V].feature;if(S[G.layer.id]<N)break;R.push(G),C.pop()}else for(const V of d){const G=V[B];if(G)for(const Z of G)R.push(Z.feature)}}return R}queryRenderedFeatures(d,_,S){_&&_.filter&&this._validate(o.y.filter,"queryRenderedFeatures.filter",_.filter,null,_);const C={};if(_&&_.layers){if(!Array.isArray(_.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const B of _.layers){const V=this._layers[B];if(!V)return this.fire(new o.j(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];C[V.source]=!0}}const R=[];_.availableImages=this._availableImages;const N=this._serializedAllLayers();for(const B in this.sourceCaches)_.layers&&!C[B]||R.push(_r(this.sourceCaches[B],this._layers,N,d,_,S));return this.placement&&R.push(function(B,V,G,Z,q,nt,vt){const gt={},_t=nt.queryRenderedSymbols(Z),dt=[];for(const Pt of Object.keys(_t).map(Number))dt.push(vt[Pt]);dt.sort(Xr);for(const Pt of dt){const $t=Pt.featureIndex.lookupSymbolFeatures(_t[Pt.bucketInstanceId],V,Pt.bucketIndex,Pt.sourceLayerIndex,q.filter,q.layers,q.availableImages,B);for(const St in $t){const Lt=gt[St]=gt[St]||[],Gt=$t[St];Gt.sort((Xt,ee)=>{const oe=Pt.featureSortOrder;if(oe){const ae=oe.indexOf(Xt.featureIndex);return oe.indexOf(ee.featureIndex)-ae}return ee.featureIndex-Xt.featureIndex});for(const Xt of Gt)Lt.push(Xt)}}for(const Pt in gt)gt[Pt].forEach($t=>{const St=$t.feature,Lt=G[B[Pt].source].getFeatureState(St.layer["source-layer"],St.id);St.source=St.layer.source,St.layer["source-layer"]&&(St.sourceLayer=St.layer["source-layer"]),St.state=Lt});return gt}(this._layers,N,this.sourceCaches,d,_,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(R)}querySourceFeatures(d,_){_&&_.filter&&this._validate(o.y.filter,"querySourceFeatures.filter",_.filter,null,_);const S=this.sourceCaches[d];return S?function(C,R){const N=C.getRenderableIds().map(G=>C.getTileByID(G)),B=[],V={};for(let G=0;G<N.length;G++){const Z=N[G],q=Z.tileID.canonical.key;V[q]||(V[q]=!0,Z.querySourceFeatures(B,R))}return B}(S,_):[]}addSourceType(d,_,S){return tr(d)?S(new Error(`A source type called "${d}" already exists.`)):(((C,R)=>{Rr[C]=R})(d,_),_.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:d,url:_.workerSourceURL},S):S(null,null))}getLight(){return this.light.getLight()}setLight(d,_={}){this._checkLoaded();const S=this.light.getLight();let C=!1;for(const N in d)if(!o.aG(d[N],S[N])){C=!0;break}if(!C)return;const R={now:o.h.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(d,_),this.light.updateTransitions(R)}_validate(d,_,S,C,R={}){return(!R||R.validate!==!1)&&pi(this,d.call(o.y,o.e({key:_,style:this.serialize(),value:S,styleSpec:o.v},C)))}_remove(d=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const _ in this._layers)this._layers[_].setEventedParent(null);for(const _ in this.sourceCaches){const S=this.sourceCaches[_];S.setEventedParent(null),S.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(d)}_clearSource(d){this.sourceCaches[d].clearTiles()}_reloadSource(d){this.sourceCaches[d].resume(),this.sourceCaches[d].reload()}_updateSources(d){for(const _ in this.sourceCaches)this.sourceCaches[_].update(d,this.map.terrain)}_generateCollisionBoxes(){for(const d in this.sourceCaches)this._reloadSource(d)}_updatePlacement(d,_,S,C,R=!1){let N=!1,B=!1;const V={};for(const G of this._order){const Z=this._layers[G];if(Z.type!=="symbol")continue;if(!V[Z.source]){const nt=this.sourceCaches[Z.source];V[Z.source]=nt.getRenderableIds(!0).map(vt=>nt.getTileByID(vt)).sort((vt,gt)=>gt.tileID.overscaledZ-vt.tileID.overscaledZ||(vt.tileID.isLessThan(gt.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(Z,V[Z.source],d.center.lng);N=N||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.h.now(),d.zoom))&&(this.pauseablePlacement=new sn(d,this.map.terrain,this._order,R,_,S,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,V),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.h.now()),B=!0),N&&this.pauseablePlacement.placement.setStale()),B||N)for(const G of this._order){const Z=this._layers[G];Z.type==="symbol"&&this.placement.updateLayerOpacities(Z,V[Z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.h.now())}_releaseSymbolFadeTiles(){for(const d in this.sourceCaches)this.sourceCaches[d].releaseSymbolFadeTiles()}getImages(d,_,S){this.imageManager.getImages(_.icons,S),this._updateTilesForChangedImages();const C=this.sourceCaches[_.source];C&&C.setDependencies(_.tileID.key,_.type,_.icons)}getGlyphs(d,_,S){this.glyphManager.getGlyphs(_.stacks,S);const C=this.sourceCaches[_.source];C&&C.setDependencies(_.tileID.key,_.type,[""])}getResource(d,_,S){return o.m(_,S)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(d,_={}){this._checkLoaded(),d&&this._validate(o.y.glyphs,"glyphs",d,null,_)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=d,this.glyphManager.entries={},this.glyphManager.setURL(d))}addSprite(d,_,S={},C){this._checkLoaded();const R=[{id:d,url:_}],N=[...W(this.stylesheet.sprite),...R];this._validate(o.y.sprite,"sprite",N,null,S)||(this.stylesheet.sprite=N,this._loadSprite(R,!0,C))}removeSprite(d){this._checkLoaded();const _=W(this.stylesheet.sprite);if(_.find(S=>S.id===d)){if(this._spritesImagesIds[d])for(const S of this._spritesImagesIds[d])this.imageManager.removeImage(S),this._changedImages[S]=!0;_.splice(_.findIndex(S=>S.id===d),1),this.stylesheet.sprite=_.length>0?_:void 0,delete this._spritesImagesIds[d],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${d}" doesn't exists on this map.`)))}getSprite(){return W(this.stylesheet.sprite)}setSprite(d,_={},S){this._checkLoaded(),d&&this._validate(o.y.sprite,"sprite",d,null,_)||(this.stylesheet.sprite=d,d?this._loadSprite(d,!0,S):(this._unloadSprite(),S&&S(null)))}}ii.registerForPluginStateChange=o.aK;var fo=o.Q([{name:"a_pos",type:"Int16",components:2}]),Rs="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const si={prelude:Br(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Br(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Br(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Br(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Br("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Br(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Br(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Br("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Br("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Br("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Br(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Br(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Br(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Br(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Br(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Br(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Br(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Br(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Br(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Br(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Br(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Br(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Br(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Br(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Br("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Rs),terrainDepth:Br("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Rs),terrainCoords:Br("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Rs)};function Br(I,d){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,S=d.match(/attribute ([\w]+) ([\w]+)/g),C=I.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),N=R?R.concat(C):C,B={};return{fragmentSource:I=I.replace(_,(V,G,Z,q,nt)=>(B[nt]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${nt}
varying ${Z} ${q} ${nt};
#else
uniform ${Z} ${q} u_${nt};
#endif
`:`
#ifdef HAS_UNIFORM_u_${nt}
    ${Z} ${q} ${nt} = u_${nt};
#endif
`)),vertexSource:d=d.replace(_,(V,G,Z,q,nt)=>{const vt=q==="float"?"vec2":"vec4",gt=nt.match(/color/)?"color":vt;return B[nt]?G==="define"?`
#ifndef HAS_UNIFORM_u_${nt}
uniform lowp float u_${nt}_t;
attribute ${Z} ${vt} a_${nt};
varying ${Z} ${q} ${nt};
#else
uniform ${Z} ${q} u_${nt};
#endif
`:gt==="vec4"?`
#ifndef HAS_UNIFORM_u_${nt}
    ${nt} = a_${nt};
#else
    ${Z} ${q} ${nt} = u_${nt};
#endif
`:`
#ifndef HAS_UNIFORM_u_${nt}
    ${nt} = unpack_mix_${gt}(a_${nt}, u_${nt}_t);
#else
    ${Z} ${q} ${nt} = u_${nt};
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_${nt}
uniform lowp float u_${nt}_t;
attribute ${Z} ${vt} a_${nt};
#else
uniform ${Z} ${q} u_${nt};
#endif
`:gt==="vec4"?`
#ifndef HAS_UNIFORM_u_${nt}
    ${Z} ${q} ${nt} = a_${nt};
#else
    ${Z} ${q} ${nt} = u_${nt};
#endif
`:`
#ifndef HAS_UNIFORM_u_${nt}
    ${Z} ${q} ${nt} = unpack_mix_${gt}(a_${nt}, u_${nt}_t);
#else
    ${Z} ${q} ${nt} = u_${nt};
#endif
`}),staticAttributes:S,staticUniforms:N}}class ms{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(d,_,S,C,R,N,B,V,G){this.context=d;let Z=this.boundPaintVertexBuffers.length!==C.length;for(let q=0;!Z&&q<C.length;q++)this.boundPaintVertexBuffers[q]!==C[q]&&(Z=!0);!this.vao||this.boundProgram!==_||this.boundLayoutVertexBuffer!==S||Z||this.boundIndexBuffer!==R||this.boundVertexOffset!==N||this.boundDynamicVertexBuffer!==B||this.boundDynamicVertexBuffer2!==V||this.boundDynamicVertexBuffer3!==G?this.freshBind(_,S,C,R,N,B,V,G):(d.bindVertexArray.set(this.vao),B&&B.bind(),R&&R.dynamicDraw&&R.bind(),V&&V.bind(),G&&G.bind())}freshBind(d,_,S,C,R,N,B,V){const G=d.numAttributes,Z=this.context,q=Z.gl;this.vao&&this.destroy(),this.vao=Z.createVertexArray(),Z.bindVertexArray.set(this.vao),this.boundProgram=d,this.boundLayoutVertexBuffer=_,this.boundPaintVertexBuffers=S,this.boundIndexBuffer=C,this.boundVertexOffset=R,this.boundDynamicVertexBuffer=N,this.boundDynamicVertexBuffer2=B,this.boundDynamicVertexBuffer3=V,_.enableAttributes(q,d);for(const nt of S)nt.enableAttributes(q,d);N&&N.enableAttributes(q,d),B&&B.enableAttributes(q,d),V&&V.enableAttributes(q,d),_.bind(),_.setVertexAttribPointers(q,d,R);for(const nt of S)nt.bind(),nt.setVertexAttribPointers(q,d,R);N&&(N.bind(),N.setVertexAttribPointers(q,d,R)),C&&C.bind(),B&&(B.bind(),B.setVertexAttribPointers(q,d,R)),V&&(V.bind(),V.setVertexAttribPointers(q,d,R)),Z.currentNumAttributes=G}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function oi(I){const d=[];for(let _=0;_<I.length;_++){if(I[_]===null)continue;const S=I[_].split(" ");d.push(S.pop())}return d}class aa{constructor(d,_,S,C,R,N){const B=d.gl;this.program=B.createProgram();const V=oi(_.staticAttributes),G=S?S.getBinderAttributes():[],Z=V.concat(G),q=si.prelude.staticUniforms?oi(si.prelude.staticUniforms):[],nt=_.staticUniforms?oi(_.staticUniforms):[],vt=S?S.getBinderUniforms():[],gt=q.concat(nt).concat(vt),_t=[];for(const Xt of gt)_t.indexOf(Xt)<0&&_t.push(Xt);const dt=S?S.defines():[];R&&dt.push("#define OVERDRAW_INSPECTOR;"),N&&dt.push("#define TERRAIN3D;");const Pt=dt.concat(si.prelude.fragmentSource,_.fragmentSource).join(`
`),$t=dt.concat(si.prelude.vertexSource,_.vertexSource).join(`
`),St=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(St,Pt),B.compileShader(St),!B.getShaderParameter(St,B.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${B.getShaderInfoLog(St)}`);B.attachShader(this.program,St);const Lt=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Lt,$t),B.compileShader(Lt),!B.getShaderParameter(Lt,B.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${B.getShaderInfoLog(Lt)}`);B.attachShader(this.program,Lt),this.attributes={};const Gt={};this.numAttributes=Z.length;for(let Xt=0;Xt<this.numAttributes;Xt++)Z[Xt]&&(B.bindAttribLocation(this.program,Xt,Z[Xt]),this.attributes[Z[Xt]]=Xt);if(B.linkProgram(this.program),!B.getProgramParameter(this.program,B.LINK_STATUS))throw new Error(`Program failed to link: ${B.getProgramInfoLog(this.program)}`);B.deleteShader(Lt),B.deleteShader(St);for(let Xt=0;Xt<_t.length;Xt++){const ee=_t[Xt];if(ee&&!Gt[ee]){const oe=B.getUniformLocation(this.program,ee);oe&&(Gt[ee]=oe)}}this.fixedUniforms=C(d,Gt),this.terrainUniforms=((Xt,ee)=>({u_depth:new o.aL(Xt,ee.u_depth),u_terrain:new o.aL(Xt,ee.u_terrain),u_terrain_dim:new o.aM(Xt,ee.u_terrain_dim),u_terrain_matrix:new o.aN(Xt,ee.u_terrain_matrix),u_terrain_unpack:new o.aO(Xt,ee.u_terrain_unpack),u_terrain_exaggeration:new o.aM(Xt,ee.u_terrain_exaggeration)}))(d,Gt),this.binderUniforms=S?S.getUniforms(d,Gt):[]}draw(d,_,S,C,R,N,B,V,G,Z,q,nt,vt,gt,_t,dt,Pt,$t){const St=d.gl;if(this.failedToCreate)return;if(d.program.set(this.program),d.setDepthMode(S),d.setStencilMode(C),d.setColorMode(R),d.setCullFace(N),V){d.activeTexture.set(St.TEXTURE2),St.bindTexture(St.TEXTURE_2D,V.depthTexture),d.activeTexture.set(St.TEXTURE3),St.bindTexture(St.TEXTURE_2D,V.texture);for(const Gt in this.terrainUniforms)this.terrainUniforms[Gt].set(V[Gt])}for(const Gt in this.fixedUniforms)this.fixedUniforms[Gt].set(B[Gt]);_t&&_t.setUniforms(d,this.binderUniforms,vt,{zoom:gt});let Lt=0;switch(_){case St.LINES:Lt=2;break;case St.TRIANGLES:Lt=3;break;case St.LINE_STRIP:Lt=1}for(const Gt of nt.get()){const Xt=Gt.vaos||(Gt.vaos={});(Xt[G]||(Xt[G]=new ms)).bind(d,this,Z,_t?_t.getPaintVertexBuffers():[],q,Gt.vertexOffset,dt,Pt,$t),St.drawElements(_,Gt.primitiveLength*Lt,St.UNSIGNED_SHORT,Gt.primitiveOffset*Lt*2)}}}function sa(I,d,_){const S=1/Mt(_,1,d.transform.tileZoom),C=Math.pow(2,_.tileID.overscaledZ),R=_.tileSize*Math.pow(2,d.transform.tileZoom)/C,N=R*(_.tileID.canonical.x+_.tileID.wrap*C),B=R*_.tileID.canonical.y;return{u_image:0,u_texsize:_.imageAtlasTexture.size,u_scale:[S,I.fromScale,I.toScale],u_fade:I.t,u_pixel_coord_upper:[N>>16,B>>16],u_pixel_coord_lower:[65535&N,65535&B]}}const Au=(I,d,_,S)=>{const C=d.style.light,R=C.properties.get("position"),N=[R.x,R.y,R.z],B=function(){var G=new o.A(9);return o.A!=Float32Array&&(G[1]=0,G[2]=0,G[3]=0,G[5]=0,G[6]=0,G[7]=0),G[0]=1,G[4]=1,G[8]=1,G}();C.properties.get("anchor")==="viewport"&&function(G,Z){var q=Math.sin(Z),nt=Math.cos(Z);G[0]=nt,G[1]=q,G[2]=0,G[3]=-q,G[4]=nt,G[5]=0,G[6]=0,G[7]=0,G[8]=1}(B,-d.transform.angle),function(G,Z,q){var nt=Z[0],vt=Z[1],gt=Z[2];G[0]=nt*q[0]+vt*q[3]+gt*q[6],G[1]=nt*q[1]+vt*q[4]+gt*q[7],G[2]=nt*q[2]+vt*q[5]+gt*q[8]}(N,N,B);const V=C.properties.get("color");return{u_matrix:I,u_lightpos:N,u_lightintensity:C.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+_,u_opacity:S}},ts=(I,d,_,S,C,R,N)=>o.e(Au(I,d,_,S),sa(R,d,N),{u_height_factor:-Math.pow(2,C.overscaledZ)/N.tileSize/8}),Qc=I=>({u_matrix:I}),th=(I,d,_,S)=>o.e(Qc(I),sa(_,d,S)),Cu=(I,d)=>({u_matrix:I,u_world:d}),ut=(I,d,_,S,C)=>o.e(th(I,d,_,S),{u_world:C}),ft=(I,d,_,S)=>{const C=I.transform;let R,N;if(S.paint.get("circle-pitch-alignment")==="map"){const B=Mt(_,1,C.zoom);R=!0,N=[B,B]}else R=!1,N=C.pixelsToGLUnits;return{u_camera_to_center_distance:C.cameraToCenterDistance,u_scale_with_map:+(S.paint.get("circle-pitch-scale")==="map"),u_matrix:I.translatePosMatrix(d.posMatrix,_,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_pitch_with_map:+R,u_device_pixel_ratio:I.pixelRatio,u_extrude_scale:N}},Et=(I,d,_)=>{const S=Mt(_,1,d.zoom),C=Math.pow(2,d.zoom-_.tileID.overscaledZ),R=_.tileID.overscaleFactor();return{u_matrix:I,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:S,u_extrude_scale:[d.pixelsToGLUnits[0]/(S*C),d.pixelsToGLUnits[1]/(S*C)],u_overscale_factor:R}},jt=(I,d,_=1)=>({u_matrix:I,u_color:d,u_overlay:0,u_overlay_scale:_}),ue=I=>({u_matrix:I}),Ne=(I,d,_,S)=>({u_matrix:I,u_extrude_scale:Mt(d,1,_),u_intensity:S});function Sr(I,d){const _=Math.pow(2,d.canonical.z),S=d.canonical.y;return[new o.U(0,S/_).toLngLat().lat,new o.U(0,(S+1)/_).toLngLat().lat]}const Fi=(I,d,_,S)=>{const C=I.transform;return{u_matrix:ud(I,d,_,S),u_ratio:1/Mt(d,1,C.zoom),u_device_pixel_ratio:I.pixelRatio,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},Ki=(I,d,_,S,C)=>o.e(Fi(I,d,_,C),{u_image:0,u_image_height:S}),An=(I,d,_,S,C)=>{const R=I.transform,N=G_(d,R);return{u_matrix:ud(I,d,_,C),u_texsize:d.imageAtlasTexture.size,u_ratio:1/Mt(d,1,R.zoom),u_device_pixel_ratio:I.pixelRatio,u_image:0,u_scale:[N,S.fromScale,S.toScale],u_fade:S.t,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]]}},Ia=(I,d,_,S,C,R)=>{const N=I.lineAtlas,B=G_(d,I.transform),V=_.layout.get("line-cap")==="round",G=N.getDash(S.from,V),Z=N.getDash(S.to,V),q=G.width*C.fromScale,nt=Z.width*C.toScale;return o.e(Fi(I,d,_,R),{u_patternscale_a:[B/q,-G.height/2],u_patternscale_b:[B/nt,-Z.height/2],u_sdfgamma:N.width/(256*Math.min(q,nt)*I.pixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:Z.y,u_mix:C.t})};function G_(I,d){return 1/Mt(I,1,d.tileZoom)}function ud(I,d,_,S){return I.translatePosMatrix(S?S.posMatrix:d.tileID.posMatrix,d,_.paint.get("line-translate"),_.paint.get("line-translate-anchor"))}const j_=(I,d,_,S,C)=>{return{u_matrix:I,u_tl_parent:d,u_scale_parent:_,u_buffer_scale:1,u_fade_t:S.mix,u_opacity:S.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(N=C.paint.get("raster-saturation"),N>0?1-1/(1.001-N):-N),u_contrast_factor:(R=C.paint.get("raster-contrast"),R>0?1/(1-R):1+R),u_spin_weights:X_(C.paint.get("raster-hue-rotate"))};var R,N};function X_(I){I*=Math.PI/180;const d=Math.sin(I),_=Math.cos(I);return[(2*_+1)/3,(-Math.sqrt(3)*d-_+1)/3,(Math.sqrt(3)*d-_+1)/3]}const Gg=(I,d,_,S,C,R,N,B,V,G)=>{const Z=C.transform;return{u_is_size_zoom_constant:+(I==="constant"||I==="source"),u_is_size_feature_constant:+(I==="constant"||I==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+_,u_aspect_ratio:Z.width/Z.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:R,u_label_plane_matrix:N,u_coord_matrix:B,u_is_text:+V,u_pitch_with_map:+S,u_texsize:G,u_texture:0}},jg=(I,d,_,S,C,R,N,B,V,G,Z)=>{const q=C.transform;return o.e(Gg(I,d,_,S,C,R,N,B,V,G),{u_gamma_scale:S?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:+Z})},Rl=(I,d,_,S,C,R,N,B,V,G)=>o.e(jg(I,d,_,S,C,R,N,B,!0,V,!0),{u_texsize_icon:G,u_texture_icon:1}),cd=(I,d,_)=>({u_matrix:I,u_opacity:d,u_color:_}),es=(I,d,_,S,C,R)=>o.e(function(N,B,V,G){const Z=V.imageManager.getPattern(N.from.toString()),q=V.imageManager.getPattern(N.to.toString()),{width:nt,height:vt}=V.imageManager.getPixelSize(),gt=Math.pow(2,G.tileID.overscaledZ),_t=G.tileSize*Math.pow(2,V.transform.tileZoom)/gt,dt=_t*(G.tileID.canonical.x+G.tileID.wrap*gt),Pt=_t*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Z.tl,u_pattern_br_a:Z.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[nt,vt],u_mix:B.t,u_pattern_size_a:Z.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/Mt(G,1,V.transform.tileZoom),u_pixel_coord_upper:[dt>>16,Pt>>16],u_pixel_coord_lower:[65535&dt,65535&Pt]}}(S,R,_,C),{u_matrix:I,u_opacity:d}),hd={fillExtrusion:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_lightpos:new o.aP(I,d.u_lightpos),u_lightintensity:new o.aM(I,d.u_lightintensity),u_lightcolor:new o.aP(I,d.u_lightcolor),u_vertical_gradient:new o.aM(I,d.u_vertical_gradient),u_opacity:new o.aM(I,d.u_opacity)}),fillExtrusionPattern:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_lightpos:new o.aP(I,d.u_lightpos),u_lightintensity:new o.aM(I,d.u_lightintensity),u_lightcolor:new o.aP(I,d.u_lightcolor),u_vertical_gradient:new o.aM(I,d.u_vertical_gradient),u_height_factor:new o.aM(I,d.u_height_factor),u_image:new o.aL(I,d.u_image),u_texsize:new o.aQ(I,d.u_texsize),u_pixel_coord_upper:new o.aQ(I,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(I,d.u_pixel_coord_lower),u_scale:new o.aP(I,d.u_scale),u_fade:new o.aM(I,d.u_fade),u_opacity:new o.aM(I,d.u_opacity)}),fill:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix)}),fillPattern:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_image:new o.aL(I,d.u_image),u_texsize:new o.aQ(I,d.u_texsize),u_pixel_coord_upper:new o.aQ(I,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(I,d.u_pixel_coord_lower),u_scale:new o.aP(I,d.u_scale),u_fade:new o.aM(I,d.u_fade)}),fillOutline:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_world:new o.aQ(I,d.u_world)}),fillOutlinePattern:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_world:new o.aQ(I,d.u_world),u_image:new o.aL(I,d.u_image),u_texsize:new o.aQ(I,d.u_texsize),u_pixel_coord_upper:new o.aQ(I,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(I,d.u_pixel_coord_lower),u_scale:new o.aP(I,d.u_scale),u_fade:new o.aM(I,d.u_fade)}),circle:(I,d)=>({u_camera_to_center_distance:new o.aM(I,d.u_camera_to_center_distance),u_scale_with_map:new o.aL(I,d.u_scale_with_map),u_pitch_with_map:new o.aL(I,d.u_pitch_with_map),u_extrude_scale:new o.aQ(I,d.u_extrude_scale),u_device_pixel_ratio:new o.aM(I,d.u_device_pixel_ratio),u_matrix:new o.aN(I,d.u_matrix)}),collisionBox:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_camera_to_center_distance:new o.aM(I,d.u_camera_to_center_distance),u_pixels_to_tile_units:new o.aM(I,d.u_pixels_to_tile_units),u_extrude_scale:new o.aQ(I,d.u_extrude_scale),u_overscale_factor:new o.aM(I,d.u_overscale_factor)}),collisionCircle:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_inv_matrix:new o.aN(I,d.u_inv_matrix),u_camera_to_center_distance:new o.aM(I,d.u_camera_to_center_distance),u_viewport_size:new o.aQ(I,d.u_viewport_size)}),debug:(I,d)=>({u_color:new o.aR(I,d.u_color),u_matrix:new o.aN(I,d.u_matrix),u_overlay:new o.aL(I,d.u_overlay),u_overlay_scale:new o.aM(I,d.u_overlay_scale)}),clippingMask:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix)}),heatmap:(I,d)=>({u_extrude_scale:new o.aM(I,d.u_extrude_scale),u_intensity:new o.aM(I,d.u_intensity),u_matrix:new o.aN(I,d.u_matrix)}),heatmapTexture:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_world:new o.aQ(I,d.u_world),u_image:new o.aL(I,d.u_image),u_color_ramp:new o.aL(I,d.u_color_ramp),u_opacity:new o.aM(I,d.u_opacity)}),hillshade:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_image:new o.aL(I,d.u_image),u_latrange:new o.aQ(I,d.u_latrange),u_light:new o.aQ(I,d.u_light),u_shadow:new o.aR(I,d.u_shadow),u_highlight:new o.aR(I,d.u_highlight),u_accent:new o.aR(I,d.u_accent)}),hillshadePrepare:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_image:new o.aL(I,d.u_image),u_dimension:new o.aQ(I,d.u_dimension),u_zoom:new o.aM(I,d.u_zoom),u_unpack:new o.aO(I,d.u_unpack)}),line:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_ratio:new o.aM(I,d.u_ratio),u_device_pixel_ratio:new o.aM(I,d.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(I,d.u_units_to_pixels)}),lineGradient:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_ratio:new o.aM(I,d.u_ratio),u_device_pixel_ratio:new o.aM(I,d.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(I,d.u_units_to_pixels),u_image:new o.aL(I,d.u_image),u_image_height:new o.aM(I,d.u_image_height)}),linePattern:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_texsize:new o.aQ(I,d.u_texsize),u_ratio:new o.aM(I,d.u_ratio),u_device_pixel_ratio:new o.aM(I,d.u_device_pixel_ratio),u_image:new o.aL(I,d.u_image),u_units_to_pixels:new o.aQ(I,d.u_units_to_pixels),u_scale:new o.aP(I,d.u_scale),u_fade:new o.aM(I,d.u_fade)}),lineSDF:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_ratio:new o.aM(I,d.u_ratio),u_device_pixel_ratio:new o.aM(I,d.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(I,d.u_units_to_pixels),u_patternscale_a:new o.aQ(I,d.u_patternscale_a),u_patternscale_b:new o.aQ(I,d.u_patternscale_b),u_sdfgamma:new o.aM(I,d.u_sdfgamma),u_image:new o.aL(I,d.u_image),u_tex_y_a:new o.aM(I,d.u_tex_y_a),u_tex_y_b:new o.aM(I,d.u_tex_y_b),u_mix:new o.aM(I,d.u_mix)}),raster:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_tl_parent:new o.aQ(I,d.u_tl_parent),u_scale_parent:new o.aM(I,d.u_scale_parent),u_buffer_scale:new o.aM(I,d.u_buffer_scale),u_fade_t:new o.aM(I,d.u_fade_t),u_opacity:new o.aM(I,d.u_opacity),u_image0:new o.aL(I,d.u_image0),u_image1:new o.aL(I,d.u_image1),u_brightness_low:new o.aM(I,d.u_brightness_low),u_brightness_high:new o.aM(I,d.u_brightness_high),u_saturation_factor:new o.aM(I,d.u_saturation_factor),u_contrast_factor:new o.aM(I,d.u_contrast_factor),u_spin_weights:new o.aP(I,d.u_spin_weights)}),symbolIcon:(I,d)=>({u_is_size_zoom_constant:new o.aL(I,d.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(I,d.u_is_size_feature_constant),u_size_t:new o.aM(I,d.u_size_t),u_size:new o.aM(I,d.u_size),u_camera_to_center_distance:new o.aM(I,d.u_camera_to_center_distance),u_pitch:new o.aM(I,d.u_pitch),u_rotate_symbol:new o.aL(I,d.u_rotate_symbol),u_aspect_ratio:new o.aM(I,d.u_aspect_ratio),u_fade_change:new o.aM(I,d.u_fade_change),u_matrix:new o.aN(I,d.u_matrix),u_label_plane_matrix:new o.aN(I,d.u_label_plane_matrix),u_coord_matrix:new o.aN(I,d.u_coord_matrix),u_is_text:new o.aL(I,d.u_is_text),u_pitch_with_map:new o.aL(I,d.u_pitch_with_map),u_texsize:new o.aQ(I,d.u_texsize),u_texture:new o.aL(I,d.u_texture)}),symbolSDF:(I,d)=>({u_is_size_zoom_constant:new o.aL(I,d.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(I,d.u_is_size_feature_constant),u_size_t:new o.aM(I,d.u_size_t),u_size:new o.aM(I,d.u_size),u_camera_to_center_distance:new o.aM(I,d.u_camera_to_center_distance),u_pitch:new o.aM(I,d.u_pitch),u_rotate_symbol:new o.aL(I,d.u_rotate_symbol),u_aspect_ratio:new o.aM(I,d.u_aspect_ratio),u_fade_change:new o.aM(I,d.u_fade_change),u_matrix:new o.aN(I,d.u_matrix),u_label_plane_matrix:new o.aN(I,d.u_label_plane_matrix),u_coord_matrix:new o.aN(I,d.u_coord_matrix),u_is_text:new o.aL(I,d.u_is_text),u_pitch_with_map:new o.aL(I,d.u_pitch_with_map),u_texsize:new o.aQ(I,d.u_texsize),u_texture:new o.aL(I,d.u_texture),u_gamma_scale:new o.aM(I,d.u_gamma_scale),u_device_pixel_ratio:new o.aM(I,d.u_device_pixel_ratio),u_is_halo:new o.aL(I,d.u_is_halo)}),symbolTextAndIcon:(I,d)=>({u_is_size_zoom_constant:new o.aL(I,d.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(I,d.u_is_size_feature_constant),u_size_t:new o.aM(I,d.u_size_t),u_size:new o.aM(I,d.u_size),u_camera_to_center_distance:new o.aM(I,d.u_camera_to_center_distance),u_pitch:new o.aM(I,d.u_pitch),u_rotate_symbol:new o.aL(I,d.u_rotate_symbol),u_aspect_ratio:new o.aM(I,d.u_aspect_ratio),u_fade_change:new o.aM(I,d.u_fade_change),u_matrix:new o.aN(I,d.u_matrix),u_label_plane_matrix:new o.aN(I,d.u_label_plane_matrix),u_coord_matrix:new o.aN(I,d.u_coord_matrix),u_is_text:new o.aL(I,d.u_is_text),u_pitch_with_map:new o.aL(I,d.u_pitch_with_map),u_texsize:new o.aQ(I,d.u_texsize),u_texsize_icon:new o.aQ(I,d.u_texsize_icon),u_texture:new o.aL(I,d.u_texture),u_texture_icon:new o.aL(I,d.u_texture_icon),u_gamma_scale:new o.aM(I,d.u_gamma_scale),u_device_pixel_ratio:new o.aM(I,d.u_device_pixel_ratio),u_is_halo:new o.aL(I,d.u_is_halo)}),background:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_opacity:new o.aM(I,d.u_opacity),u_color:new o.aR(I,d.u_color)}),backgroundPattern:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_opacity:new o.aM(I,d.u_opacity),u_image:new o.aL(I,d.u_image),u_pattern_tl_a:new o.aQ(I,d.u_pattern_tl_a),u_pattern_br_a:new o.aQ(I,d.u_pattern_br_a),u_pattern_tl_b:new o.aQ(I,d.u_pattern_tl_b),u_pattern_br_b:new o.aQ(I,d.u_pattern_br_b),u_texsize:new o.aQ(I,d.u_texsize),u_mix:new o.aM(I,d.u_mix),u_pattern_size_a:new o.aQ(I,d.u_pattern_size_a),u_pattern_size_b:new o.aQ(I,d.u_pattern_size_b),u_scale_a:new o.aM(I,d.u_scale_a),u_scale_b:new o.aM(I,d.u_scale_b),u_pixel_coord_upper:new o.aQ(I,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(I,d.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aM(I,d.u_tile_units_to_pixels)}),terrain:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_texture:new o.aL(I,d.u_texture),u_ele_delta:new o.aM(I,d.u_ele_delta)}),terrainDepth:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_ele_delta:new o.aM(I,d.u_ele_delta)}),terrainCoords:(I,d)=>({u_matrix:new o.aN(I,d.u_matrix),u_texture:new o.aL(I,d.u_texture),u_terrain_coords_id:new o.aM(I,d.u_terrain_coords_id),u_ele_delta:new o.aM(I,d.u_ele_delta)})};class fd{constructor(d,_,S){this.context=d;const C=d.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!S,this.context.unbindVAO(),d.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,_.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete _.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(d){const _=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),_.bufferSubData(_.ELEMENT_ARRAY_BUFFER,0,d.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const eh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class dd{constructor(d,_,S,C){this.length=_.length,this.attributes=S,this.itemSize=_.bytesPerElement,this.dynamicDraw=C,this.context=d;const R=d.gl;this.buffer=R.createBuffer(),d.bindVertexBuffer.set(this.buffer),R.bufferData(R.ARRAY_BUFFER,_.arrayBuffer,this.dynamicDraw?R.DYNAMIC_DRAW:R.STATIC_DRAW),this.dynamicDraw||delete _.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(d){if(d.length!==this.length)throw new Error(`Length of new data is ${d.length}, which doesn't match current length of ${this.length}`);const _=this.context.gl;this.bind(),_.bufferSubData(_.ARRAY_BUFFER,0,d.arrayBuffer)}enableAttributes(d,_){for(let S=0;S<this.attributes.length;S++){const C=_.attributes[this.attributes[S].name];C!==void 0&&d.enableVertexAttribArray(C)}}setVertexAttribPointers(d,_,S){for(let C=0;C<this.attributes.length;C++){const R=this.attributes[C],N=_.attributes[R.name];N!==void 0&&d.vertexAttribPointer(N,R.components,d[eh[R.type]],!1,this.itemSize,R.offset+this.itemSize*(S||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Eu=new WeakMap;function Ho(I){var d;if(Eu.has(I))return Eu.get(I);{const _=(d=I.getParameter(I.VERSION))===null||d===void 0?void 0:d.startsWith("WebGL 2.0");return Eu.set(I,_),_}}class Dr{constructor(d){this.gl=d.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(d){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pd extends Dr{getDefault(){return o.aT.transparent}set(d){const _=this.current;(d.r!==_.r||d.g!==_.g||d.b!==_.b||d.a!==_.a||this.dirty)&&(this.gl.clearColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)}}class Ma extends Dr{getDefault(){return 1}set(d){(d!==this.current||this.dirty)&&(this.gl.clearDepth(d),this.current=d,this.dirty=!1)}}class Pa extends Dr{getDefault(){return 0}set(d){(d!==this.current||this.dirty)&&(this.gl.clearStencil(d),this.current=d,this.dirty=!1)}}class Xg extends Dr{getDefault(){return[!0,!0,!0,!0]}set(d){const _=this.current;(d[0]!==_[0]||d[1]!==_[1]||d[2]!==_[2]||d[3]!==_[3]||this.dirty)&&(this.gl.colorMask(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)}}class gd extends Dr{getDefault(){return!0}set(d){(d!==this.current||this.dirty)&&(this.gl.depthMask(d),this.current=d,this.dirty=!1)}}class vd extends Dr{getDefault(){return 255}set(d){(d!==this.current||this.dirty)&&(this.gl.stencilMask(d),this.current=d,this.dirty=!1)}}class Zg extends Dr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(d){const _=this.current;(d.func!==_.func||d.ref!==_.ref||d.mask!==_.mask||this.dirty)&&(this.gl.stencilFunc(d.func,d.ref,d.mask),this.current=d,this.dirty=!1)}}class qg extends Dr{getDefault(){const d=this.gl;return[d.KEEP,d.KEEP,d.KEEP]}set(d){const _=this.current;(d[0]!==_[0]||d[1]!==_[1]||d[2]!==_[2]||this.dirty)&&(this.gl.stencilOp(d[0],d[1],d[2]),this.current=d,this.dirty=!1)}}class md extends Dr{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _=this.gl;d?_.enable(_.STENCIL_TEST):_.disable(_.STENCIL_TEST),this.current=d,this.dirty=!1}}class Yg extends Dr{getDefault(){return[0,1]}set(d){const _=this.current;(d[0]!==_[0]||d[1]!==_[1]||this.dirty)&&(this.gl.depthRange(d[0],d[1]),this.current=d,this.dirty=!1)}}class Kg extends Dr{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _=this.gl;d?_.enable(_.DEPTH_TEST):_.disable(_.DEPTH_TEST),this.current=d,this.dirty=!1}}class yd extends Dr{getDefault(){return this.gl.LESS}set(d){(d!==this.current||this.dirty)&&(this.gl.depthFunc(d),this.current=d,this.dirty=!1)}}class Z_ extends Dr{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _=this.gl;d?_.enable(_.BLEND):_.disable(_.BLEND),this.current=d,this.dirty=!1}}class q_ extends Dr{getDefault(){const d=this.gl;return[d.ONE,d.ZERO]}set(d){const _=this.current;(d[0]!==_[0]||d[1]!==_[1]||this.dirty)&&(this.gl.blendFunc(d[0],d[1]),this.current=d,this.dirty=!1)}}class Iu extends Dr{getDefault(){return o.aT.transparent}set(d){const _=this.current;(d.r!==_.r||d.g!==_.g||d.b!==_.b||d.a!==_.a||this.dirty)&&(this.gl.blendColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)}}class rT extends Dr{getDefault(){return this.gl.FUNC_ADD}set(d){(d!==this.current||this.dirty)&&(this.gl.blendEquation(d),this.current=d,this.dirty=!1)}}class iT extends Dr{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _=this.gl;d?_.enable(_.CULL_FACE):_.disable(_.CULL_FACE),this.current=d,this.dirty=!1}}class nT extends Dr{getDefault(){return this.gl.BACK}set(d){(d!==this.current||this.dirty)&&(this.gl.cullFace(d),this.current=d,this.dirty=!1)}}class aT extends Dr{getDefault(){return this.gl.CCW}set(d){(d!==this.current||this.dirty)&&(this.gl.frontFace(d),this.current=d,this.dirty=!1)}}class sT extends Dr{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}}class oT extends Dr{getDefault(){return this.gl.TEXTURE0}set(d){(d!==this.current||this.dirty)&&(this.gl.activeTexture(d),this.current=d,this.dirty=!1)}}class Jg extends Dr{getDefault(){const d=this.gl;return[0,0,d.drawingBufferWidth,d.drawingBufferHeight]}set(d){const _=this.current;(d[0]!==_[0]||d[1]!==_[1]||d[2]!==_[2]||d[3]!==_[3]||this.dirty)&&(this.gl.viewport(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)}}class _d extends Dr{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const _=this.gl;_.bindFramebuffer(_.FRAMEBUFFER,d),this.current=d,this.dirty=!1}}class Qg extends Dr{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const _=this.gl;_.bindRenderbuffer(_.RENDERBUFFER,d),this.current=d,this.dirty=!1}}class tv extends Dr{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const _=this.gl;_.bindTexture(_.TEXTURE_2D,d),this.current=d,this.dirty=!1}}class Mu extends Dr{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const _=this.gl;_.bindBuffer(_.ARRAY_BUFFER,d),this.current=d,this.dirty=!1}}class Y_ extends Dr{getDefault(){return null}set(d){const _=this.gl;_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,d),this.current=d,this.dirty=!1}}class K_ extends Dr{getDefault(){return null}set(d){var _;if(d===this.current&&!this.dirty)return;const S=this.gl;Ho(S)?S.bindVertexArray(d):(_=S.getExtension("OES_vertex_array_object"))===null||_===void 0||_.bindVertexArrayOES(d),this.current=d,this.dirty=!1}}class ev extends Dr{getDefault(){return 4}set(d){if(d===this.current&&!this.dirty)return;const _=this.gl;_.pixelStorei(_.UNPACK_ALIGNMENT,d),this.current=d,this.dirty=!1}}class Dl extends Dr{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _=this.gl;_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),this.current=d,this.dirty=!1}}class J_ extends Dr{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _=this.gl;_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,d),this.current=d,this.dirty=!1}}class Go extends Dr{constructor(d,_){super(d),this.context=d,this.parent=_}getDefault(){return null}}class Pu extends Go{setDirty(){this.dirty=!0}set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const _=this.gl;_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,d,0),this.current=d,this.dirty=!1}}class Q_ extends Go{set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const _=this.gl;_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,d),this.current=d,this.dirty=!1}}class rv extends Go{set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const _=this.gl;_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.RENDERBUFFER,d),this.current=d,this.dirty=!1}}class qr{constructor(d,_,S,C,R){this.context=d,this.width=_,this.height=S;const N=d.gl,B=this.framebuffer=N.createFramebuffer();if(this.colorAttachment=new Pu(d,B),C)this.depthAttachment=R?new rv(d,B):new Q_(d,B);else if(R)throw new Error("Stencil cannot be setted without depth");if(N.checkFramebufferStatus(N.FRAMEBUFFER)!==N.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const d=this.context.gl,_=this.colorAttachment.get();if(_&&d.deleteTexture(_),this.depthAttachment){const S=this.depthAttachment.get();S&&d.deleteRenderbuffer(S)}d.deleteFramebuffer(this.framebuffer)}}class Mi{constructor(d,_,S){this.blendFunction=d,this.blendColor=_,this.mask=S}}Mi.Replace=[1,0],Mi.disabled=new Mi(Mi.Replace,o.aT.transparent,[!1,!1,!1,!1]),Mi.unblended=new Mi(Mi.Replace,o.aT.transparent,[!0,!0,!0,!0]),Mi.alphaBlended=new Mi([1,771],o.aT.transparent,[!0,!0,!0,!0]);class lT{constructor(d){var _,S;if(this.gl=d,this.clearColor=new pd(this),this.clearDepth=new Ma(this),this.clearStencil=new Pa(this),this.colorMask=new Xg(this),this.depthMask=new gd(this),this.stencilMask=new vd(this),this.stencilFunc=new Zg(this),this.stencilOp=new qg(this),this.stencilTest=new md(this),this.depthRange=new Yg(this),this.depthTest=new Kg(this),this.depthFunc=new yd(this),this.blend=new Z_(this),this.blendFunc=new q_(this),this.blendColor=new Iu(this),this.blendEquation=new rT(this),this.cullFace=new iT(this),this.cullFaceSide=new nT(this),this.frontFace=new aT(this),this.program=new sT(this),this.activeTexture=new oT(this),this.viewport=new Jg(this),this.bindFramebuffer=new _d(this),this.bindRenderbuffer=new Qg(this),this.bindTexture=new tv(this),this.bindVertexBuffer=new Mu(this),this.bindElementBuffer=new Y_(this),this.bindVertexArray=new K_(this),this.pixelStoreUnpack=new ev(this),this.pixelStoreUnpackPremultiplyAlpha=new Dl(this),this.pixelStoreUnpackFlipY=new J_(this),this.extTextureFilterAnisotropic=d.getExtension("EXT_texture_filter_anisotropic")||d.getExtension("MOZ_EXT_texture_filter_anisotropic")||d.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=d.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE),Ho(d)){this.HALF_FLOAT=d.HALF_FLOAT;const C=d.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(_=d.RGBA16F)!==null&&_!==void 0?_:C==null?void 0:C.RGBA16F_EXT,this.RGB16F=(S=d.RGB16F)!==null&&S!==void 0?S:C==null?void 0:C.RGB16F_EXT,d.getExtension("EXT_color_buffer_float")}else{d.getExtension("EXT_color_buffer_half_float"),d.getExtension("OES_texture_half_float_linear");const C=d.getExtension("OES_texture_half_float");this.HALF_FLOAT=C==null?void 0:C.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(d,_){return new fd(this,d,_)}createVertexBuffer(d,_,S){return new dd(this,d,_,S)}createRenderbuffer(d,_,S){const C=this.gl,R=C.createRenderbuffer();return this.bindRenderbuffer.set(R),C.renderbufferStorage(C.RENDERBUFFER,d,_,S),this.bindRenderbuffer.set(null),R}createFramebuffer(d,_,S,C){return new qr(this,d,_,S,C)}clear({color:d,depth:_,stencil:S}){const C=this.gl;let R=0;d&&(R|=C.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),_!==void 0&&(R|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(_),this.depthMask.set(!0)),S!==void 0&&(R|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(S),this.stencilMask.set(255)),C.clear(R)}setCullFace(d){d.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(d.mode),this.frontFace.set(d.frontFace))}setDepthMode(d){d.func!==this.gl.ALWAYS||d.mask?(this.depthTest.set(!0),this.depthFunc.set(d.func),this.depthMask.set(d.mask),this.depthRange.set(d.range)):this.depthTest.set(!1)}setStencilMode(d){d.test.func!==this.gl.ALWAYS||d.mask?(this.stencilTest.set(!0),this.stencilMask.set(d.mask),this.stencilOp.set([d.fail,d.depthFail,d.pass]),this.stencilFunc.set({func:d.test.func,ref:d.ref,mask:d.test.mask})):this.stencilTest.set(!1)}setColorMode(d){o.aG(d.blendFunction,Mi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(d.blendFunction),this.blendColor.set(d.blendColor)),this.colorMask.set(d.mask)}createVertexArray(){var d;return Ho(this.gl)?this.gl.createVertexArray():(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.createVertexArrayOES()}deleteVertexArray(d){var _;return Ho(this.gl)?this.gl.deleteVertexArray(d):(_=this.gl.getExtension("OES_vertex_array_object"))===null||_===void 0?void 0:_.deleteVertexArrayOES(d)}unbindVAO(){this.bindVertexArray.set(null)}}class Lr{constructor(d,_,S){this.func=d,this.mask=_,this.range=S}}Lr.ReadOnly=!1,Lr.ReadWrite=!0,Lr.disabled=new Lr(519,Lr.ReadOnly,[0,1]);const Ll=7680;class Pi{constructor(d,_,S,C,R,N){this.test=d,this.ref=_,this.mask=S,this.fail=C,this.depthFail=R,this.pass=N}}Pi.disabled=new Pi({func:519,mask:0},0,0,Ll,Ll,Ll);class Ti{constructor(d,_,S){this.enable=d,this.mode=_,this.frontFace=S}}let rh;function t0(I,d,_,S,C,R,N){const B=I.context,V=B.gl,G=I.useProgram("collisionBox"),Z=[];let q=0,nt=0;for(let St=0;St<S.length;St++){const Lt=S[St],Gt=d.getTile(Lt),Xt=Gt.getBucket(_);if(!Xt)continue;let ee=Lt.posMatrix;C[0]===0&&C[1]===0||(ee=I.translatePosMatrix(Lt.posMatrix,Gt,C,R));const oe=N?Xt.textCollisionBox:Xt.iconCollisionBox,ae=Xt.collisionCircleArray;if(ae.length>0){const fe=o.Z(),Be=ee;o.aU(fe,Xt.placementInvProjMatrix,I.transform.glCoordMatrix),o.aU(fe,fe,Xt.placementViewportMatrix),Z.push({circleArray:ae,circleOffset:nt,transform:Be,invTransform:fe,coord:Lt}),q+=ae.length/4,nt=q}oe&&G.draw(B,V.LINES,Lr.disabled,Pi.disabled,I.colorModeForRenderPass(),Ti.disabled,Et(ee,I.transform,Gt),I.style.map.terrain&&I.style.map.terrain.getTerrainData(Lt),_.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,null,I.transform.zoom,null,null,oe.collisionVertexBuffer)}if(!N||!Z.length)return;const vt=I.useProgram("collisionCircle"),gt=new o.aV;gt.resize(4*q),gt._trim();let _t=0;for(const St of Z)for(let Lt=0;Lt<St.circleArray.length/4;Lt++){const Gt=4*Lt,Xt=St.circleArray[Gt+0],ee=St.circleArray[Gt+1],oe=St.circleArray[Gt+2],ae=St.circleArray[Gt+3];gt.emplace(_t++,Xt,ee,oe,ae,0),gt.emplace(_t++,Xt,ee,oe,ae,1),gt.emplace(_t++,Xt,ee,oe,ae,2),gt.emplace(_t++,Xt,ee,oe,ae,3)}(!rh||rh.length<2*q)&&(rh=function(St){const Lt=2*St,Gt=new o.aX;Gt.resize(Lt),Gt._trim();for(let Xt=0;Xt<Lt;Xt++){const ee=6*Xt;Gt.uint16[ee+0]=4*Xt+0,Gt.uint16[ee+1]=4*Xt+1,Gt.uint16[ee+2]=4*Xt+2,Gt.uint16[ee+3]=4*Xt+2,Gt.uint16[ee+4]=4*Xt+3,Gt.uint16[ee+5]=4*Xt+0}return Gt}(q));const dt=B.createIndexBuffer(rh,!0),Pt=B.createVertexBuffer(gt,o.aW.members,!0);for(const St of Z){const Lt={u_matrix:St.transform,u_inv_matrix:St.invTransform,u_camera_to_center_distance:($t=I.transform).cameraToCenterDistance,u_viewport_size:[$t.width,$t.height]};vt.draw(B,V.TRIANGLES,Lr.disabled,Pi.disabled,I.colorModeForRenderPass(),Ti.disabled,Lt,I.style.map.terrain&&I.style.map.terrain.getTerrainData(St.coord),_.id,Pt,dt,o.S.simpleSegment(0,2*St.circleOffset,St.circleArray.length,St.circleArray.length/2),null,I.transform.zoom,null,null,null)}var $t;Pt.destroy(),dt.destroy()}Ti.disabled=new Ti(!1,1029,2305),Ti.backCCW=new Ti(!0,1029,2305);const iv=o.ao(new Float32Array(16));function xd(I,d,_,S,C,R){const{horizontalAlign:N,verticalAlign:B}=o.au(I);return new o.P((-(N-.5)*d/C+S[0])*R,(-(B-.5)*_/C+S[1])*R)}function bd(I,d,_,S,C,R,N,B,V,G,Z){const q=I.text.placedSymbolArray,nt=I.text.dynamicLayoutVertexArray,vt=I.icon.dynamicLayoutVertexArray,gt={};nt.clear();for(let _t=0;_t<q.length;_t++){const dt=q.get(_t),Pt=dt.hidden||!dt.crossTileID||I.allowVerticalPlacement&&!dt.placedOrientation?null:S[dt.crossTileID];if(Pt){const $t=new o.P(dt.anchorX,dt.anchorY),St=Si($t,_?N:R,Z),Lt=co(C.cameraToCenterDistance,St.signedDistanceFromCamera);let Gt=o.aj(I.textSizeData,V,dt)*Lt/o.ap;_&&(Gt*=I.tilePixelRatio/B);const{width:Xt,height:ee,anchor:oe,textOffset:ae,textBoxScale:fe}=Pt,Be=xd(oe,Xt,ee,ae,fe,Gt),Cr=_?Si($t.add(Be),R,Z).point:St.point.add(d?Be.rotate(-C.angle):Be),xe=I.allowVerticalPlacement&&dt.placedOrientation===o.ai.vertical?Math.PI/2:0;for(let rr=0;rr<dt.numGlyphs;rr++)o.ak(nt,Cr,xe);G&&dt.associatedIconIndex>=0&&(gt[dt.associatedIconIndex]={shiftedAnchor:Cr,angle:xe})}else ct(dt.numGlyphs,nt)}if(G){vt.clear();const _t=I.icon.placedSymbolArray;for(let dt=0;dt<_t.length;dt++){const Pt=_t.get(dt);if(Pt.hidden)ct(Pt.numGlyphs,vt);else{const $t=gt[dt];if($t)for(let St=0;St<Pt.numGlyphs;St++)o.ak(vt,$t.shiftedAnchor,$t.angle);else ct(Pt.numGlyphs,vt)}}I.icon.dynamicLayoutVertexBuffer.updateData(vt)}I.text.dynamicLayoutVertexBuffer.updateData(nt)}function nv(I,d,_){return _.iconsInText&&d?"symbolTextAndIcon":I?"symbolSDF":"symbolIcon"}function wd(I,d,_,S,C,R,N,B,V,G,Z,q){const nt=I.context,vt=nt.gl,gt=I.transform,_t=B==="map",dt=V==="map",Pt=B!=="viewport"&&_.layout.get("symbol-placement")!=="point",$t=_t&&!dt&&!Pt,St=!_.layout.get("symbol-sort-key").isConstant();let Lt=!1;const Gt=I.depthModeForSublayer(0,Lr.ReadOnly),Xt=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ee=[];for(const oe of S){const ae=d.getTile(oe),fe=ae.getBucket(_);if(!fe)continue;const Be=C?fe.text:fe.icon;if(!Be||!Be.segments.get().length||!Be.hasVisibleVertices)continue;const Cr=Be.programConfigurations.get(_.id),xe=C||fe.sdfIcons,rr=C?fe.textSizeData:fe.iconSizeData,Ue=dt||gt.pitch!==0,ei=I.useProgram(nv(xe,C,fe),Cr),Tr=o.ah(rr,gt.zoom),mr=I.style.map.terrain&&I.style.map.terrain.getTerrainData(oe);let Er,Bi,ui,Cn,on=[0,0],ji=null;if(C)Bi=ae.glyphAtlasTexture,ui=vt.LINEAR,Er=ae.glyphAtlasTexture.size,fe.iconsInText&&(on=ae.imageAtlasTexture.size,ji=ae.imageAtlasTexture,Cn=Ue||I.options.rotating||I.options.zooming||rr.kind==="composite"||rr.kind==="camera"?vt.LINEAR:vt.NEAREST);else{const zi=_.layout.get("icon-size").constantOr(0)!==1||fe.iconsNeedLinear;Bi=ae.imageAtlasTexture,ui=xe||I.options.rotating||I.options.zooming||zi||Ue?vt.LINEAR:vt.NEAREST,Er=ae.imageAtlasTexture.size}const La=Mt(ae,1,I.transform.zoom),vi=de(oe.posMatrix,dt,_t,I.transform,La),Ls=Qa(oe.posMatrix,dt,_t,I.transform,La),ks=Xt&&fe.hasTextData(),Zo=_.layout.get("icon-text-fit")!=="none"&&ks&&fe.hasIconData();if(Pt){const zi=I.style.map.terrain?(ua,Vi)=>I.style.map.terrain.getElevation(oe,ua,Vi):null,ln=_.layout.get("text-rotation-alignment")==="map";ge(fe,oe.posMatrix,I,C,vi,Ls,dt,G,ln,zi)}const Bl=I.translatePosMatrix(oe.posMatrix,ae,R,N),Fu=Pt||C&&Xt||Zo?iv:vi,On=I.translatePosMatrix(Ls,ae,R,N,!0),En=xe&&_.paint.get(C?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Gn;Gn=xe?fe.iconsInText?Rl(rr.kind,Tr,$t,dt,I,Bl,Fu,On,Er,on):jg(rr.kind,Tr,$t,dt,I,Bl,Fu,On,C,Er,!0):Gg(rr.kind,Tr,$t,dt,I,Bl,Fu,On,C,Er);const zl={program:ei,buffers:Be,uniformValues:Gn,atlasTexture:Bi,atlasTextureIcon:ji,atlasInterpolation:ui,atlasInterpolationIcon:Cn,isSDF:xe,hasHalo:En};if(St&&fe.canOverlap){Lt=!0;const zi=Be.segments.get();for(const ln of zi)ee.push({segments:new o.S([ln]),sortKey:ln.sortKey,state:zl,terrainData:mr})}else ee.push({segments:Be.segments,sortKey:0,state:zl,terrainData:mr})}Lt&&ee.sort((oe,ae)=>oe.sortKey-ae.sortKey);for(const oe of ee){const ae=oe.state;if(nt.activeTexture.set(vt.TEXTURE0),ae.atlasTexture.bind(ae.atlasInterpolation,vt.CLAMP_TO_EDGE),ae.atlasTextureIcon&&(nt.activeTexture.set(vt.TEXTURE1),ae.atlasTextureIcon&&ae.atlasTextureIcon.bind(ae.atlasInterpolationIcon,vt.CLAMP_TO_EDGE)),ae.isSDF){const fe=ae.uniformValues;ae.hasHalo&&(fe.u_is_halo=1,av(ae.buffers,oe.segments,_,I,ae.program,Gt,Z,q,fe,oe.terrainData)),fe.u_is_halo=0}av(ae.buffers,oe.segments,_,I,ae.program,Gt,Z,q,ae.uniformValues,oe.terrainData)}}function av(I,d,_,S,C,R,N,B,V,G){const Z=S.context;C.draw(Z,Z.gl.TRIANGLES,R,N,B,Ti.disabled,V,G,_.id,I.layoutVertexBuffer,I.indexBuffer,d,_.paint,S.transform.zoom,I.programConfigurations.get(_.id),I.dynamicLayoutVertexBuffer,I.opacityVertexBuffer)}function ih(I,d,_,S,C){if(!_||!S||!S.imageAtlas)return;const R=S.imageAtlas.patternPositions;let N=R[_.to.toString()],B=R[_.from.toString()];if(!N&&B&&(N=B),!B&&N&&(B=N),!N||!B){const V=C.getPaintProperty(d);N=R[V],B=R[V]}N&&B&&I.setConstantPatternPositions(N,B)}function nh(I,d,_,S,C,R,N){const B=I.context.gl,V="fill-pattern",G=_.paint.get(V),Z=G&&G.constantOr(1),q=_.getCrossfadeParameters();let nt,vt,gt,_t,dt;N?(vt=Z&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",nt=B.LINES):(vt=Z?"fillPattern":"fill",nt=B.TRIANGLES);const Pt=G.constantOr(null);for(const $t of S){const St=d.getTile($t);if(Z&&!St.patternsLoaded())continue;const Lt=St.getBucket(_);if(!Lt)continue;const Gt=Lt.programConfigurations.get(_.id),Xt=I.useProgram(vt,Gt),ee=I.style.map.terrain&&I.style.map.terrain.getTerrainData($t);Z&&(I.context.activeTexture.set(B.TEXTURE0),St.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Gt.updatePaintBuffers(q)),ih(Gt,V,Pt,St,_);const oe=ee?$t:null,ae=I.translatePosMatrix(oe?oe.posMatrix:$t.posMatrix,St,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));if(N){_t=Lt.indexBuffer2,dt=Lt.segments2;const fe=[B.drawingBufferWidth,B.drawingBufferHeight];gt=vt==="fillOutlinePattern"&&Z?ut(ae,I,q,St,fe):Cu(ae,fe)}else _t=Lt.indexBuffer,dt=Lt.segments,gt=Z?th(ae,I,q,St):Qc(ae);Xt.draw(I.context,nt,C,I.stencilModeForClipping($t),R,Ti.disabled,gt,ee,_.id,Lt.layoutVertexBuffer,_t,dt,_.paint,I.transform.zoom,Gt)}}function ah(I,d,_,S,C,R,N){const B=I.context,V=B.gl,G="fill-extrusion-pattern",Z=_.paint.get(G),q=Z.constantOr(1),nt=_.getCrossfadeParameters(),vt=_.paint.get("fill-extrusion-opacity"),gt=Z.constantOr(null);for(const _t of S){const dt=d.getTile(_t),Pt=dt.getBucket(_);if(!Pt)continue;const $t=I.style.map.terrain&&I.style.map.terrain.getTerrainData(_t),St=Pt.programConfigurations.get(_.id),Lt=I.useProgram(q?"fillExtrusionPattern":"fillExtrusion",St);q&&(I.context.activeTexture.set(V.TEXTURE0),dt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),St.updatePaintBuffers(nt)),ih(St,G,gt,dt,_);const Gt=I.translatePosMatrix(_t.posMatrix,dt,_.paint.get("fill-extrusion-translate"),_.paint.get("fill-extrusion-translate-anchor")),Xt=_.paint.get("fill-extrusion-vertical-gradient"),ee=q?ts(Gt,I,Xt,vt,_t,nt,dt):Au(Gt,I,Xt,vt);Lt.draw(B,B.gl.TRIANGLES,C,R,N,Ti.backCCW,ee,$t,_.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,_.paint,I.transform.zoom,St,I.style.map.terrain&&Pt.centroidVertexBuffer)}}function uT(I,d,_,S,C,R,N){const B=I.context,V=B.gl,G=_.fbo;if(!G)return;const Z=I.useProgram("hillshade"),q=I.style.map.terrain&&I.style.map.terrain.getTerrainData(d);B.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,G.colorAttachment.get()),Z.draw(B,V.TRIANGLES,C,R,N,Ti.disabled,((nt,vt,gt,_t)=>{const dt=gt.paint.get("hillshade-shadow-color"),Pt=gt.paint.get("hillshade-highlight-color"),$t=gt.paint.get("hillshade-accent-color");let St=gt.paint.get("hillshade-illumination-direction")*(Math.PI/180);gt.paint.get("hillshade-illumination-anchor")==="viewport"&&(St-=nt.transform.angle);const Lt=!nt.options.moving;return{u_matrix:_t?_t.posMatrix:nt.transform.calculatePosMatrix(vt.tileID.toUnwrapped(),Lt),u_image:0,u_latrange:Sr(0,vt.tileID),u_light:[gt.paint.get("hillshade-exaggeration"),St],u_shadow:dt,u_highlight:Pt,u_accent:$t}})(I,_,S,q?d:null),q,S.id,I.rasterBoundsBuffer,I.quadTriangleIndexBuffer,I.rasterBoundsSegments)}function sv(I,d,_,S,C,R){const N=I.context,B=N.gl,V=d.dem;if(V&&V.data){const G=V.dim,Z=V.stride,q=V.getPixels();if(N.activeTexture.set(B.TEXTURE1),N.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||I.getTileTexture(Z),d.demTexture){const vt=d.demTexture;vt.update(q,{premultiply:!1}),vt.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else d.demTexture=new j(N,q,B.RGBA,{premultiply:!1}),d.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);N.activeTexture.set(B.TEXTURE0);let nt=d.fbo;if(!nt){const vt=new j(N,{width:G,height:G,data:null},B.RGBA);vt.bind(B.LINEAR,B.CLAMP_TO_EDGE),nt=d.fbo=N.createFramebuffer(G,G,!0,!1),nt.colorAttachment.set(vt.texture)}N.bindFramebuffer.set(nt.framebuffer),N.viewport.set([0,0,G,G]),I.useProgram("hillshadePrepare").draw(N,B.TRIANGLES,S,C,R,Ti.disabled,((vt,gt)=>{const _t=gt.stride,dt=o.Z();return o.aS(dt,0,o.N,-o.N,0,0,1),o.$(dt,dt,[0,-o.N,0]),{u_matrix:dt,u_image:1,u_dimension:[_t,_t],u_zoom:vt.overscaledZ,u_unpack:gt.getUnpackVector()}})(d.tileID,V),null,_.id,I.rasterBoundsBuffer,I.quadTriangleIndexBuffer,I.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function cT(I,d,_,S,C,R){const N=S.paint.get("raster-fade-duration");if(!R&&N>0){const B=o.h.now(),V=(B-I.timeAdded)/N,G=d?(B-d.timeAdded)/N:-1,Z=_.getSource(),q=C.coveringZoomLevel({tileSize:Z.tileSize,roundZoom:Z.roundZoom}),nt=!d||Math.abs(d.tileID.overscaledZ-q)>Math.abs(I.tileID.overscaledZ-q),vt=nt&&I.refreshedUponExpiration?1:o.ad(nt?V:1-G,0,1);return I.refreshedUponExpiration&&V>=1&&(I.refreshedUponExpiration=!1),d?{opacity:1,mix:1-vt}:{opacity:vt,mix:0}}return{opacity:1,mix:0}}const e0=new o.aT(1,0,0,1),Sd=new o.aT(0,1,0,1),ov=new o.aT(0,0,1,1),r0=new o.aT(1,0,1,1),i0=new o.aT(0,1,1,1);function sh(I,d,_,S){Ad(I,0,d+_/2,I.transform.width,_,S)}function Td(I,d,_,S){Ad(I,d-_/2,0,_,I.transform.height,S)}function Ad(I,d,_,S,C,R){const N=I.context,B=N.gl;B.enable(B.SCISSOR_TEST),B.scissor(d*I.pixelRatio,_*I.pixelRatio,S*I.pixelRatio,C*I.pixelRatio),N.clear({color:R}),B.disable(B.SCISSOR_TEST)}function n0(I,d,_){const S=I.context,C=S.gl,R=_.posMatrix,N=I.useProgram("debug"),B=Lr.disabled,V=Pi.disabled,G=I.colorModeForRenderPass(),Z="$debug",q=I.style.map.terrain&&I.style.map.terrain.getTerrainData(_);S.activeTexture.set(C.TEXTURE0);const nt=d.getTileByID(_.key).latestRawTileData,vt=Math.floor((nt&&nt.byteLength||0)/1024),gt=d.getTile(_).tileSize,_t=512/Math.min(gt,512)*(_.overscaledZ/I.transform.zoom)*.5;let dt=_.canonical.toString();_.overscaledZ!==_.canonical.z&&(dt+=` => ${_.overscaledZ}`),function(Pt,$t){Pt.initDebugOverlayCanvas();const St=Pt.debugOverlayCanvas,Lt=Pt.context.gl,Gt=Pt.debugOverlayCanvas.getContext("2d");Gt.clearRect(0,0,St.width,St.height),Gt.shadowColor="white",Gt.shadowBlur=2,Gt.lineWidth=1.5,Gt.strokeStyle="white",Gt.textBaseline="top",Gt.font="bold 36px Open Sans, sans-serif",Gt.fillText($t,5,5),Gt.strokeText($t,5,5),Pt.debugOverlayTexture.update(St),Pt.debugOverlayTexture.bind(Lt.LINEAR,Lt.CLAMP_TO_EDGE)}(I,`${dt} ${vt}kB`),N.draw(S,C.TRIANGLES,B,V,Mi.alphaBlended,Ti.disabled,jt(R,o.aT.transparent,_t),null,Z,I.debugBuffer,I.quadTriangleIndexBuffer,I.debugSegments),N.draw(S,C.LINE_STRIP,B,V,G,Ti.disabled,jt(R,o.aT.red),q,Z,I.debugBuffer,I.tileBorderIndexBuffer,I.debugSegments)}function ki(I,d,_){const S=I.context,C=S.gl,R=I.colorModeForRenderPass(),N=new Lr(C.LEQUAL,Lr.ReadWrite,I.depthRangeFor3D),B=I.useProgram("terrain"),V=d.getTerrainMesh();S.bindFramebuffer.set(null),S.viewport.set([0,0,I.width,I.height]);for(const G of _){const Z=I.renderToTexture.getTexture(G),q=d.getTerrainData(G.tileID);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,Z.texture);const nt={u_matrix:I.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_texture:0,u_ele_delta:d.getMeshFrameDelta(I.transform.zoom)};B.draw(S,C.TRIANGLES,N,Pi.disabled,R,Ti.backCCW,nt,q,"terrain",V.vertexBuffer,V.indexBuffer,V.segments)}}class kl{constructor(d,_){this.context=new lT(d),this.transform=_,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.Z(),renderTime:0},this.setup(),this.numSublayers=Ur.maxUnderzooming+Ur.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Wn}resize(d,_,S){if(this.width=Math.floor(d*S),this.height=Math.floor(_*S),this.pixelRatio=S,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const C of this.style._order)this.style._layers[C].resize()}setup(){const d=this.context,_=new o.a_;_.emplaceBack(0,0),_.emplaceBack(o.N,0),_.emplaceBack(0,o.N),_.emplaceBack(o.N,o.N),this.tileExtentBuffer=d.createVertexBuffer(_,fo.members),this.tileExtentSegments=o.S.simpleSegment(0,0,4,2);const S=new o.a_;S.emplaceBack(0,0),S.emplaceBack(o.N,0),S.emplaceBack(0,o.N),S.emplaceBack(o.N,o.N),this.debugBuffer=d.createVertexBuffer(S,fo.members),this.debugSegments=o.S.simpleSegment(0,0,4,5);const C=new o.V;C.emplaceBack(0,0,0,0),C.emplaceBack(o.N,0,o.N,0),C.emplaceBack(0,o.N,0,o.N),C.emplaceBack(o.N,o.N,o.N,o.N),this.rasterBoundsBuffer=d.createVertexBuffer(C,Ee.members),this.rasterBoundsSegments=o.S.simpleSegment(0,0,4,2);const R=new o.a_;R.emplaceBack(0,0),R.emplaceBack(1,0),R.emplaceBack(0,1),R.emplaceBack(1,1),this.viewportBuffer=d.createVertexBuffer(R,fo.members),this.viewportSegments=o.S.simpleSegment(0,0,4,2);const N=new o.a$;N.emplaceBack(0),N.emplaceBack(1),N.emplaceBack(3),N.emplaceBack(2),N.emplaceBack(0),this.tileBorderIndexBuffer=d.createIndexBuffer(N);const B=new o.b0;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=d.createIndexBuffer(B);const V=this.context.gl;this.stencilClearMode=new Pi({func:V.ALWAYS,mask:0},0,255,V.ZERO,V.ZERO,V.ZERO)}clearStencil(){const d=this.context,_=d.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const S=o.Z();o.aS(S,0,this.width,this.height,0,0,1),o.a0(S,S,[_.drawingBufferWidth,_.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(d,_.TRIANGLES,Lr.disabled,this.stencilClearMode,Mi.disabled,Ti.disabled,ue(S),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(d,_){if(this.currentStencilSource===d.source||!d.isTileClipped()||!_||!_.length)return;this.currentStencilSource=d.source;const S=this.context,C=S.gl;this.nextStencilID+_.length>256&&this.clearStencil(),S.setColorMode(Mi.disabled),S.setDepthMode(Lr.disabled);const R=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const N of _){const B=this._tileClippingMaskIDs[N.key]=this.nextStencilID++,V=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N);R.draw(S,C.TRIANGLES,Lr.disabled,new Pi({func:C.ALWAYS,mask:0},B,255,C.KEEP,C.KEEP,C.REPLACE),Mi.disabled,Ti.disabled,ue(N.posMatrix),V,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const d=this.nextStencilID++,_=this.context.gl;return new Pi({func:_.NOTEQUAL,mask:255},d,255,_.KEEP,_.KEEP,_.REPLACE)}stencilModeForClipping(d){const _=this.context.gl;return new Pi({func:_.EQUAL,mask:255},this._tileClippingMaskIDs[d.key],0,_.KEEP,_.KEEP,_.REPLACE)}stencilConfigForOverlap(d){const _=this.context.gl,S=d.sort((N,B)=>B.overscaledZ-N.overscaledZ),C=S[S.length-1].overscaledZ,R=S[0].overscaledZ-C+1;if(R>1){this.currentStencilSource=void 0,this.nextStencilID+R>256&&this.clearStencil();const N={};for(let B=0;B<R;B++)N[B+C]=new Pi({func:_.GEQUAL,mask:255},B+this.nextStencilID,255,_.KEEP,_.KEEP,_.REPLACE);return this.nextStencilID+=R,[N,S]}return[{[C]:Pi.disabled},S]}colorModeForRenderPass(){const d=this.context.gl;return this._showOverdrawInspector?new Mi([d.CONSTANT_COLOR,d.ONE],new o.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mi.unblended:Mi.alphaBlended}depthModeForSublayer(d,_,S){if(!this.opaquePassEnabledForLayer())return Lr.disabled;const C=1-((1+this.currentLayer)*this.numSublayers+d)*this.depthEpsilon;return new Lr(S||this.context.gl.LEQUAL,_,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(d,_){this.style=d,this.options=_,this.lineAtlas=d.lineAtlas,this.imageManager=d.imageManager,this.glyphManager=d.glyphManager,this.symbolFadeChange=d.placement.symbolFadeChange(o.h.now()),this.imageManager.beginFrame();const S=this.style._order,C=this.style.sourceCaches,R={},N={},B={};for(const V in C){const G=C[V];G.used&&G.prepare(this.context),R[V]=G.getVisibleCoordinates(),N[V]=R[V].slice().reverse(),B[V]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let V=0;V<S.length;V++)if(this.style._layers[S[V]].is3D()){this.opaquePassCutoff=V;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const V=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||V.length)&&(o.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(G,Z){const q=G.context,nt=q.gl,vt=Mi.unblended,gt=new Lr(nt.LEQUAL,Lr.ReadWrite,[0,1]),_t=Z.getTerrainMesh(),dt=Z.sourceCache.getRenderableTiles(),Pt=G.useProgram("terrainDepth");q.bindFramebuffer.set(Z.getFramebuffer("depth").framebuffer),q.viewport.set([0,0,G.width/devicePixelRatio,G.height/devicePixelRatio]),q.clear({color:o.aT.transparent,depth:1});for(const $t of dt){const St=Z.getTerrainData($t.tileID),Lt={u_matrix:G.transform.calculatePosMatrix($t.tileID.toUnwrapped()),u_ele_delta:Z.getMeshFrameDelta(G.transform.zoom)};Pt.draw(q,nt.TRIANGLES,gt,Pi.disabled,vt,Ti.backCCW,Lt,St,"terrain",_t.vertexBuffer,_t.indexBuffer,_t.segments)}q.bindFramebuffer.set(null),q.viewport.set([0,0,G.width,G.height])}(this,this.style.map.terrain),function(G,Z){const q=G.context,nt=q.gl,vt=Mi.unblended,gt=new Lr(nt.LEQUAL,Lr.ReadWrite,[0,1]),_t=Z.getTerrainMesh(),dt=Z.getCoordsTexture(),Pt=Z.sourceCache.getRenderableTiles(),$t=G.useProgram("terrainCoords");q.bindFramebuffer.set(Z.getFramebuffer("coords").framebuffer),q.viewport.set([0,0,G.width/devicePixelRatio,G.height/devicePixelRatio]),q.clear({color:o.aT.transparent,depth:1}),Z.coordsIndex=[];for(const St of Pt){const Lt=Z.getTerrainData(St.tileID);q.activeTexture.set(nt.TEXTURE0),nt.bindTexture(nt.TEXTURE_2D,dt.texture);const Gt={u_matrix:G.transform.calculatePosMatrix(St.tileID.toUnwrapped()),u_terrain_coords_id:(255-Z.coordsIndex.length)/255,u_texture:0,u_ele_delta:Z.getMeshFrameDelta(G.transform.zoom)};$t.draw(q,nt.TRIANGLES,gt,Pi.disabled,vt,Ti.backCCW,Gt,Lt,"terrain",_t.vertexBuffer,_t.indexBuffer,_t.segments),Z.coordsIndex.push(St.tileID.key)}q.bindFramebuffer.set(null),q.viewport.set([0,0,G.width,G.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const V of S){const G=this.style._layers[V];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const Z=N[G.source];(G.type==="custom"||Z.length)&&this.renderLayer(this,C[G.source],G,Z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:_.showOverdrawInspector?o.aT.black:o.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=_.showOverdrawInspector,this.depthRangeFor3D=[0,1-(d._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const V=this.style._layers[S[this.currentLayer]],G=C[V.source],Z=R[V.source];this._renderTileClippingMasks(V,Z),this.renderLayer(this,G,V,Z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const V=this.style._layers[S[this.currentLayer]],G=C[V.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(V))continue;const Z=(V.type==="symbol"?B:N)[V.source];this._renderTileClippingMasks(V,R[V.source]),this.renderLayer(this,G,V,Z)}if(this.options.showTileBoundaries){const V=function(G,Z){let q=null;const nt=Object.values(G._layers).flatMap(dt=>dt.source&&!dt.isHidden(Z)?[G.sourceCaches[dt.source]]:[]),vt=nt.filter(dt=>dt.getSource().type==="vector"),gt=nt.filter(dt=>dt.getSource().type!=="vector"),_t=dt=>{(!q||q.getSource().maxzoom<dt.getSource().maxzoom)&&(q=dt)};return vt.forEach(dt=>_t(dt)),q||gt.forEach(dt=>_t(dt)),q}(this.style,this.transform.zoom);V&&function(G,Z,q){for(let nt=0;nt<q.length;nt++)n0(G,Z,q[nt])}(this,V,V.getVisibleCoordinates())}this.options.showPadding&&function(V){const G=V.transform.padding;sh(V,V.transform.height-(G.top||0),3,e0),sh(V,G.bottom||0,3,Sd),Td(V,G.left||0,3,ov),Td(V,V.transform.width-(G.right||0),3,r0);const Z=V.transform.centerPoint;(function(q,nt,vt,gt){Ad(q,nt-1,vt-10,2,20,gt),Ad(q,nt-10,vt-1,20,2,gt)})(V,Z.x,V.transform.height-Z.y,i0)}(this),this.context.setDefault()}renderLayer(d,_,S,C){if(!S.isHidden(this.transform.zoom)&&(S.type==="background"||S.type==="custom"||(C||[]).length))switch(this.id=S.id,S.type){case"symbol":(function(R,N,B,V,G){if(R.renderPass!=="translucent")return;const Z=Pi.disabled,q=R.colorModeForRenderPass();(B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(nt,vt,gt,_t,dt,Pt,$t){const St=vt.transform,Lt=dt==="map",Gt=Pt==="map";for(const Xt of nt){const ee=_t.getTile(Xt),oe=ee.getBucket(gt);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const ae=o.ah(oe.textSizeData,St.zoom),fe=Mt(ee,1,vt.transform.zoom),Be=de(Xt.posMatrix,Gt,Lt,vt.transform,fe),Cr=gt.layout.get("icon-text-fit")!=="none"&&oe.hasIconData();if(ae){const xe=Math.pow(2,St.zoom-ee.tileID.overscaledZ);bd(oe,Lt,Gt,$t,St,Be,Xt.posMatrix,xe,ae,Cr,vt.style.map.terrain?(rr,Ue)=>vt.style.map.terrain.getElevation(Xt,rr,Ue):null)}}}(V,R,B,N,B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),G),B.paint.get("icon-opacity").constantOr(1)!==0&&wd(R,N,B,V,!1,B.paint.get("icon-translate"),B.paint.get("icon-translate-anchor"),B.layout.get("icon-rotation-alignment"),B.layout.get("icon-pitch-alignment"),B.layout.get("icon-keep-upright"),Z,q),B.paint.get("text-opacity").constantOr(1)!==0&&wd(R,N,B,V,!0,B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),B.layout.get("text-keep-upright"),Z,q),N.map.showCollisionBoxes&&(t0(R,N,B,V,B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),!0),t0(R,N,B,V,B.paint.get("icon-translate"),B.paint.get("icon-translate-anchor"),!1))})(d,_,S,C,this.style.placement.variableOffsets);break;case"circle":(function(R,N,B,V){if(R.renderPass!=="translucent")return;const G=B.paint.get("circle-opacity"),Z=B.paint.get("circle-stroke-width"),q=B.paint.get("circle-stroke-opacity"),nt=!B.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(Z.constantOr(1)===0||q.constantOr(1)===0))return;const vt=R.context,gt=vt.gl,_t=R.depthModeForSublayer(0,Lr.ReadOnly),dt=Pi.disabled,Pt=R.colorModeForRenderPass(),$t=[];for(let St=0;St<V.length;St++){const Lt=V[St],Gt=N.getTile(Lt),Xt=Gt.getBucket(B);if(!Xt)continue;const ee=Xt.programConfigurations.get(B.id),oe=R.useProgram("circle",ee),ae=Xt.layoutVertexBuffer,fe=Xt.indexBuffer,Be=R.style.map.terrain&&R.style.map.terrain.getTerrainData(Lt),Cr={programConfiguration:ee,program:oe,layoutVertexBuffer:ae,indexBuffer:fe,uniformValues:ft(R,Lt,Gt,B),terrainData:Be};if(nt){const xe=Xt.segments.get();for(const rr of xe)$t.push({segments:new o.S([rr]),sortKey:rr.sortKey,state:Cr})}else $t.push({segments:Xt.segments,sortKey:0,state:Cr})}nt&&$t.sort((St,Lt)=>St.sortKey-Lt.sortKey);for(const St of $t){const{programConfiguration:Lt,program:Gt,layoutVertexBuffer:Xt,indexBuffer:ee,uniformValues:oe,terrainData:ae}=St.state;Gt.draw(vt,gt.TRIANGLES,_t,dt,Pt,Ti.disabled,oe,ae,B.id,Xt,ee,St.segments,B.paint,R.transform.zoom,Lt)}})(d,_,S,C);break;case"heatmap":(function(R,N,B,V){if(B.paint.get("heatmap-opacity")!==0)if(R.renderPass==="offscreen"){const G=R.context,Z=G.gl,q=Pi.disabled,nt=new Mi([Z.ONE,Z.ONE],o.aT.transparent,[!0,!0,!0,!0]);(function(vt,gt,_t){const dt=vt.gl;vt.activeTexture.set(dt.TEXTURE1),vt.viewport.set([0,0,gt.width/4,gt.height/4]);let Pt=_t.heatmapFbo;if(Pt)dt.bindTexture(dt.TEXTURE_2D,Pt.colorAttachment.get()),vt.bindFramebuffer.set(Pt.framebuffer);else{const $t=dt.createTexture();dt.bindTexture(dt.TEXTURE_2D,$t),dt.texParameteri(dt.TEXTURE_2D,dt.TEXTURE_WRAP_S,dt.CLAMP_TO_EDGE),dt.texParameteri(dt.TEXTURE_2D,dt.TEXTURE_WRAP_T,dt.CLAMP_TO_EDGE),dt.texParameteri(dt.TEXTURE_2D,dt.TEXTURE_MIN_FILTER,dt.LINEAR),dt.texParameteri(dt.TEXTURE_2D,dt.TEXTURE_MAG_FILTER,dt.LINEAR),Pt=_t.heatmapFbo=vt.createFramebuffer(gt.width/4,gt.height/4,!1,!1),function(St,Lt,Gt,Xt){var ee,oe;const ae=St.gl,fe=(ee=St.HALF_FLOAT)!==null&&ee!==void 0?ee:ae.UNSIGNED_BYTE,Be=(oe=St.RGBA16F)!==null&&oe!==void 0?oe:ae.RGBA;ae.texImage2D(ae.TEXTURE_2D,0,Be,Lt.width/4,Lt.height/4,0,ae.RGBA,fe,null),Xt.colorAttachment.set(Gt)}(vt,gt,$t,Pt)}})(G,R,B),G.clear({color:o.aT.transparent});for(let vt=0;vt<V.length;vt++){const gt=V[vt];if(N.hasRenderableParent(gt))continue;const _t=N.getTile(gt),dt=_t.getBucket(B);if(!dt)continue;const Pt=dt.programConfigurations.get(B.id),$t=R.useProgram("heatmap",Pt),{zoom:St}=R.transform;$t.draw(G,Z.TRIANGLES,Lr.disabled,q,nt,Ti.disabled,Ne(gt.posMatrix,_t,St,B.paint.get("heatmap-intensity")),null,B.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,B.paint,R.transform.zoom,Pt)}G.viewport.set([0,0,R.width,R.height])}else R.renderPass==="translucent"&&(R.context.setColorMode(R.colorModeForRenderPass()),function(G,Z){const q=G.context,nt=q.gl,vt=Z.heatmapFbo;if(!vt)return;q.activeTexture.set(nt.TEXTURE0),nt.bindTexture(nt.TEXTURE_2D,vt.colorAttachment.get()),q.activeTexture.set(nt.TEXTURE1);let gt=Z.colorRampTexture;gt||(gt=Z.colorRampTexture=new j(q,Z.colorRamp,nt.RGBA)),gt.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(q,nt.TRIANGLES,Lr.disabled,Pi.disabled,G.colorModeForRenderPass(),Ti.disabled,((_t,dt,Pt,$t)=>{const St=o.Z();o.aS(St,0,_t.width,_t.height,0,0,1);const Lt=_t.context.gl;return{u_matrix:St,u_world:[Lt.drawingBufferWidth,Lt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:dt.paint.get("heatmap-opacity")}})(G,Z),null,Z.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,Z.paint,G.transform.zoom)}(R,B))})(d,_,S,C);break;case"line":(function(R,N,B,V){if(R.renderPass!=="translucent")return;const G=B.paint.get("line-opacity"),Z=B.paint.get("line-width");if(G.constantOr(1)===0||Z.constantOr(1)===0)return;const q=R.depthModeForSublayer(0,Lr.ReadOnly),nt=R.colorModeForRenderPass(),vt=B.paint.get("line-dasharray"),gt=B.paint.get("line-pattern"),_t=gt.constantOr(1),dt=B.paint.get("line-gradient"),Pt=B.getCrossfadeParameters(),$t=_t?"linePattern":vt?"lineSDF":dt?"lineGradient":"line",St=R.context,Lt=St.gl;let Gt=!0;for(const Xt of V){const ee=N.getTile(Xt);if(_t&&!ee.patternsLoaded())continue;const oe=ee.getBucket(B);if(!oe)continue;const ae=oe.programConfigurations.get(B.id),fe=R.context.program.get(),Be=R.useProgram($t,ae),Cr=Gt||Be.program!==fe,xe=R.style.map.terrain&&R.style.map.terrain.getTerrainData(Xt),rr=gt.constantOr(null);if(rr&&ee.imageAtlas){const Tr=ee.imageAtlas,mr=Tr.patternPositions[rr.to.toString()],Er=Tr.patternPositions[rr.from.toString()];mr&&Er&&ae.setConstantPatternPositions(mr,Er)}const Ue=xe?Xt:null,ei=_t?An(R,ee,B,Pt,Ue):vt?Ia(R,ee,B,vt,Pt,Ue):dt?Ki(R,ee,B,oe.lineClipsArray.length,Ue):Fi(R,ee,B,Ue);if(_t)St.activeTexture.set(Lt.TEXTURE0),ee.imageAtlasTexture.bind(Lt.LINEAR,Lt.CLAMP_TO_EDGE),ae.updatePaintBuffers(Pt);else if(vt&&(Cr||R.lineAtlas.dirty))St.activeTexture.set(Lt.TEXTURE0),R.lineAtlas.bind(St);else if(dt){const Tr=oe.gradients[B.id];let mr=Tr.texture;if(B.gradientVersion!==Tr.version){let Er=256;if(B.stepInterpolant){const Bi=N.getSource().maxzoom,ui=Xt.canonical.z===Bi?Math.ceil(1<<R.transform.maxZoom-Xt.canonical.z):1;Er=o.ad(o.aY(oe.maxLineLength/o.N*1024*ui),256,St.maxTextureSize)}Tr.gradient=o.aZ({expression:B.gradientExpression(),evaluationKey:"lineProgress",resolution:Er,image:Tr.gradient||void 0,clips:oe.lineClipsArray}),Tr.texture?Tr.texture.update(Tr.gradient):Tr.texture=new j(St,Tr.gradient,Lt.RGBA),Tr.version=B.gradientVersion,mr=Tr.texture}St.activeTexture.set(Lt.TEXTURE0),mr.bind(B.stepInterpolant?Lt.NEAREST:Lt.LINEAR,Lt.CLAMP_TO_EDGE)}Be.draw(St,Lt.TRIANGLES,q,R.stencilModeForClipping(Xt),nt,Ti.disabled,ei,xe,B.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,B.paint,R.transform.zoom,ae,oe.layoutVertexBuffer2),Gt=!1}})(d,_,S,C);break;case"fill":(function(R,N,B,V){const G=B.paint.get("fill-color"),Z=B.paint.get("fill-opacity");if(Z.constantOr(1)===0)return;const q=R.colorModeForRenderPass(),nt=B.paint.get("fill-pattern"),vt=R.opaquePassEnabledForLayer()&&!nt.constantOr(1)&&G.constantOr(o.aT.transparent).a===1&&Z.constantOr(0)===1?"opaque":"translucent";if(R.renderPass===vt){const gt=R.depthModeForSublayer(1,R.renderPass==="opaque"?Lr.ReadWrite:Lr.ReadOnly);nh(R,N,B,V,gt,q,!1)}if(R.renderPass==="translucent"&&B.paint.get("fill-antialias")){const gt=R.depthModeForSublayer(B.getPaintProperty("fill-outline-color")?2:0,Lr.ReadOnly);nh(R,N,B,V,gt,q,!0)}})(d,_,S,C);break;case"fill-extrusion":(function(R,N,B,V){const G=B.paint.get("fill-extrusion-opacity");if(G!==0&&R.renderPass==="translucent"){const Z=new Lr(R.context.gl.LEQUAL,Lr.ReadWrite,R.depthRangeFor3D);if(G!==1||B.paint.get("fill-extrusion-pattern").constantOr(1))ah(R,N,B,V,Z,Pi.disabled,Mi.disabled),ah(R,N,B,V,Z,R.stencilModeFor3D(),R.colorModeForRenderPass());else{const q=R.colorModeForRenderPass();ah(R,N,B,V,Z,Pi.disabled,q)}}})(d,_,S,C);break;case"hillshade":(function(R,N,B,V){if(R.renderPass!=="offscreen"&&R.renderPass!=="translucent")return;const G=R.context,Z=R.depthModeForSublayer(0,Lr.ReadOnly),q=R.colorModeForRenderPass(),[nt,vt]=R.renderPass==="translucent"?R.stencilConfigForOverlap(V):[{},V];for(const gt of vt){const _t=N.getTile(gt);_t.needsHillshadePrepare!==void 0&&_t.needsHillshadePrepare&&R.renderPass==="offscreen"?sv(R,_t,B,Z,Pi.disabled,q):R.renderPass==="translucent"&&uT(R,gt,_t,B,Z,nt[gt.overscaledZ],q)}G.viewport.set([0,0,R.width,R.height])})(d,_,S,C);break;case"raster":(function(R,N,B,V){if(R.renderPass!=="translucent"||B.paint.get("raster-opacity")===0||!V.length)return;const G=R.context,Z=G.gl,q=N.getSource(),nt=R.useProgram("raster"),vt=R.colorModeForRenderPass(),[gt,_t]=q instanceof Ie?[{},V]:R.stencilConfigForOverlap(V),dt=_t[_t.length-1].overscaledZ,Pt=!R.options.moving;for(const $t of _t){const St=R.depthModeForSublayer($t.overscaledZ-dt,B.paint.get("raster-opacity")===1?Lr.ReadWrite:Lr.ReadOnly,Z.LESS),Lt=N.getTile($t);Lt.registerFadeDuration(B.paint.get("raster-fade-duration"));const Gt=N.findLoadedParent($t,0),Xt=cT(Lt,Gt,N,B,R.transform,R.style.map.terrain);let ee,oe;const ae=B.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR;G.activeTexture.set(Z.TEXTURE0),Lt.texture.bind(ae,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),G.activeTexture.set(Z.TEXTURE1),Gt?(Gt.texture.bind(ae,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),ee=Math.pow(2,Gt.tileID.overscaledZ-Lt.tileID.overscaledZ),oe=[Lt.tileID.canonical.x*ee%1,Lt.tileID.canonical.y*ee%1]):Lt.texture.bind(ae,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST);const fe=R.style.map.terrain&&R.style.map.terrain.getTerrainData($t),Be=fe?$t:null,Cr=Be?Be.posMatrix:R.transform.calculatePosMatrix($t.toUnwrapped(),Pt),xe=j_(Cr,oe||[0,0],ee||1,Xt,B);q instanceof Ie?nt.draw(G,Z.TRIANGLES,St,Pi.disabled,vt,Ti.disabled,xe,fe,B.id,q.boundsBuffer,R.quadTriangleIndexBuffer,q.boundsSegments):nt.draw(G,Z.TRIANGLES,St,gt[$t.overscaledZ],vt,Ti.disabled,xe,fe,B.id,R.rasterBoundsBuffer,R.quadTriangleIndexBuffer,R.rasterBoundsSegments)}})(d,_,S,C);break;case"background":(function(R,N,B,V){const G=B.paint.get("background-color"),Z=B.paint.get("background-opacity");if(Z===0)return;const q=R.context,nt=q.gl,vt=R.transform,gt=vt.tileSize,_t=B.paint.get("background-pattern");if(R.isPatternMissing(_t))return;const dt=!_t&&G.a===1&&Z===1&&R.opaquePassEnabledForLayer()?"opaque":"translucent";if(R.renderPass!==dt)return;const Pt=Pi.disabled,$t=R.depthModeForSublayer(0,dt==="opaque"?Lr.ReadWrite:Lr.ReadOnly),St=R.colorModeForRenderPass(),Lt=R.useProgram(_t?"backgroundPattern":"background"),Gt=V||vt.coveringTiles({tileSize:gt,terrain:R.style.map.terrain});_t&&(q.activeTexture.set(nt.TEXTURE0),R.imageManager.bind(R.context));const Xt=B.getCrossfadeParameters();for(const ee of Gt){const oe=V?ee.posMatrix:R.transform.calculatePosMatrix(ee.toUnwrapped()),ae=_t?es(oe,Z,R,_t,{tileID:ee,tileSize:gt},Xt):cd(oe,Z,G),fe=R.style.map.terrain&&R.style.map.terrain.getTerrainData(ee);Lt.draw(q,nt.TRIANGLES,$t,Pt,St,Ti.disabled,ae,fe,B.id,R.tileExtentBuffer,R.quadTriangleIndexBuffer,R.tileExtentSegments)}})(d,0,S,C);break;case"custom":(function(R,N,B){const V=R.context,G=B.implementation;if(R.renderPass==="offscreen"){const Z=G.prerender;Z&&(R.setCustomLayerDefaults(),V.setColorMode(R.colorModeForRenderPass()),Z.call(G,V.gl,R.transform.customLayerMatrix()),V.setDirty(),R.setBaseState())}else if(R.renderPass==="translucent"){R.setCustomLayerDefaults(),V.setColorMode(R.colorModeForRenderPass()),V.setStencilMode(Pi.disabled);const Z=G.renderingMode==="3d"?new Lr(R.context.gl.LEQUAL,Lr.ReadWrite,R.depthRangeFor3D):R.depthModeForSublayer(0,Lr.ReadOnly);V.setDepthMode(Z),G.render(V.gl,R.transform.customLayerMatrix()),V.setDirty(),R.setBaseState(),V.bindFramebuffer.set(null)}})(d,0,S)}}translatePosMatrix(d,_,S,C,R){if(!S[0]&&!S[1])return d;const N=R?C==="map"?this.transform.angle:0:C==="viewport"?-this.transform.angle:0;if(N){const G=Math.sin(N),Z=Math.cos(N);S=[S[0]*Z-S[1]*G,S[0]*G+S[1]*Z]}const B=[R?S[0]:Mt(_,S[0],this.transform.zoom),R?S[1]:Mt(_,S[1],this.transform.zoom),0],V=new Float32Array(16);return o.$(V,d,B),V}saveTileTexture(d){const _=this._tileTextures[d.size[0]];_?_.push(d):this._tileTextures[d.size[0]]=[d]}getTileTexture(d){const _=this._tileTextures[d];return _&&_.length>0?_.pop():null}isPatternMissing(d){if(!d)return!1;if(!d.from||!d.to)return!0;const _=this.imageManager.getPattern(d.from.toString()),S=this.imageManager.getPattern(d.to.toString());return!_||!S}useProgram(d,_){this.cache=this.cache||{};const S=d+(_?_.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[S]||(this.cache[S]=new aa(this.context,si[d],_,hd[d],this._showOverdrawInspector,this.style.map.terrain)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const d=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(d.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new j(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:d,drawingBufferHeight:_}=this.context.gl;return this.width!==d||this.height!==_}}class oa{constructor(d,_){this.points=d,this.planes=_}static fromInvProjectionMatrix(d,_,S){const C=Math.pow(2,S),R=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>{const V=1/(B=o.ag([],B,d))[3]/_*C;return o.b3(B,B,[V,V,1/B[3],V])}),N=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(B=>{const V=function(nt,vt){var gt=vt[0],_t=vt[1],dt=vt[2],Pt=gt*gt+_t*_t+dt*dt;return Pt>0&&(Pt=1/Math.sqrt(Pt)),nt[0]=vt[0]*Pt,nt[1]=vt[1]*Pt,nt[2]=vt[2]*Pt,nt}([],function(nt,vt,gt){var _t=vt[0],dt=vt[1],Pt=vt[2],$t=gt[0],St=gt[1],Lt=gt[2];return nt[0]=dt*Lt-Pt*St,nt[1]=Pt*$t-_t*Lt,nt[2]=_t*St-dt*$t,nt}([],O([],R[B[0]],R[B[1]]),O([],R[B[2]],R[B[1]]))),G=-((Z=V)[0]*(q=R[B[1]])[0]+Z[1]*q[1]+Z[2]*q[2]);var Z,q;return V.concat(G)});return new oa(R,N)}}class Ru{constructor(d,_){this.min=d,this.max=_,this.center=function(S,C,R){return S[0]=.5*C[0],S[1]=.5*C[1],S[2]=.5*C[2],S}([],function(S,C,R){return S[0]=C[0]+R[0],S[1]=C[1]+R[1],S[2]=C[2]+R[2],S}([],this.min,this.max))}quadrant(d){const _=[d%2==0,d<2],S=L(this.min),C=L(this.max);for(let R=0;R<_.length;R++)S[R]=_[R]?this.min[R]:this.center[R],C[R]=_[R]?this.center[R]:this.max[R];return C[2]=this.max[2],new Ru(S,C)}distanceX(d){return Math.max(Math.min(this.max[0],d[0]),this.min[0])-d[0]}distanceY(d){return Math.max(Math.min(this.max[1],d[1]),this.min[1])-d[1]}intersects(d){const _=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let S=!0;for(let C=0;C<d.planes.length;C++){const R=d.planes[C];let N=0;for(let B=0;B<_.length;B++)o.b4(R,_[B])>=0&&N++;if(N===0)return 0;N!==_.length&&(S=!1)}if(S)return 2;for(let C=0;C<3;C++){let R=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let B=0;B<d.points.length;B++){const V=d.points[B][C]-this.min[C];R=Math.min(R,V),N=Math.max(N,V)}if(N<0||R>this.max[C]-this.min[C])return 0}return 1}}class oh{constructor(d=0,_=0,S=0,C=0){if(isNaN(d)||d<0||isNaN(_)||_<0||isNaN(S)||S<0||isNaN(C)||C<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=d,this.bottom=_,this.left=S,this.right=C}interpolate(d,_,S){return _.top!=null&&d.top!=null&&(this.top=o.B.number(d.top,_.top,S)),_.bottom!=null&&d.bottom!=null&&(this.bottom=o.B.number(d.bottom,_.bottom,S)),_.left!=null&&d.left!=null&&(this.left=o.B.number(d.left,_.left,S)),_.right!=null&&d.right!=null&&(this.right=o.B.number(d.right,_.right,S)),this}getCenter(d,_){const S=o.ad((this.left+d-this.right)/2,0,d),C=o.ad((this.top+_-this.bottom)/2,0,_);return new o.P(S,C)}equals(d){return this.top===d.top&&this.bottom===d.bottom&&this.left===d.left&&this.right===d.right}clone(){return new oh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Cd{constructor(d,_,S,C,R){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=R===void 0||!!R,this._minZoom=d||0,this._maxZoom=_||22,this._minPitch=S??0,this._maxPitch=C??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new oh,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const d=new Cd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return d.apply(this),d}apply(d){this.tileSize=d.tileSize,this.latRange=d.latRange,this.width=d.width,this.height=d.height,this._center=d._center,this._elevation=d._elevation,this._minEleveationForCurrentTile=d._minEleveationForCurrentTile,this.zoom=d.zoom,this.angle=d.angle,this._fov=d._fov,this._pitch=d._pitch,this._unmodified=d._unmodified,this._edgeInsets=d._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(d){this._minZoom!==d&&(this._minZoom=d,this.zoom=Math.max(this.zoom,d))}get maxZoom(){return this._maxZoom}set maxZoom(d){this._maxZoom!==d&&(this._maxZoom=d,this.zoom=Math.min(this.zoom,d))}get minPitch(){return this._minPitch}set minPitch(d){this._minPitch!==d&&(this._minPitch=d,this.pitch=Math.max(this.pitch,d))}get maxPitch(){return this._maxPitch}set maxPitch(d){this._maxPitch!==d&&(this._maxPitch=d,this.pitch=Math.min(this.pitch,d))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(d){d===void 0?d=!0:d===null&&(d=!1),this._renderWorldCopies=d}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(d){const _=-o.b5(d,-180,180)*Math.PI/180;this.angle!==_&&(this._unmodified=!1,this.angle=_,this._calcMatrices(),this.rotationMatrix=function(){var S=new o.A(4);return o.A!=Float32Array&&(S[1]=0,S[2]=0),S[0]=1,S[3]=1,S}(),function(S,C,R){var N=C[0],B=C[1],V=C[2],G=C[3],Z=Math.sin(R),q=Math.cos(R);S[0]=N*q+V*Z,S[1]=B*q+G*Z,S[2]=N*-Z+V*q,S[3]=B*-Z+G*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(d){const _=o.ad(d,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==_&&(this._unmodified=!1,this._pitch=_,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(d){d=Math.max(.01,Math.min(60,d)),this._fov!==d&&(this._unmodified=!1,this._fov=d/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(d){const _=Math.min(Math.max(d,this.minZoom),this.maxZoom);this._zoom!==_&&(this._unmodified=!1,this._zoom=_,this.tileZoom=Math.max(0,Math.floor(_)),this.scale=this.zoomScale(_),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(d){d.lat===this._center.lat&&d.lng===this._center.lng||(this._unmodified=!1,this._center=d,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(d){d!==this._elevation&&(this._elevation=d,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(d){this._edgeInsets.equals(d)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,d,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(d){return this._edgeInsets.equals(d)}interpolatePadding(d,_,S){this._unmodified=!1,this._edgeInsets.interpolate(d,_,S),this._constrain(),this._calcMatrices()}coveringZoomLevel(d){const _=(d.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/d.tileSize));return Math.max(0,_)}getVisibleUnwrappedCoordinates(d){const _=[new o.b6(0,d)];if(this._renderWorldCopies){const S=this.pointCoordinate(new o.P(0,0)),C=this.pointCoordinate(new o.P(this.width,0)),R=this.pointCoordinate(new o.P(this.width,this.height)),N=this.pointCoordinate(new o.P(0,this.height)),B=Math.floor(Math.min(S.x,C.x,R.x,N.x)),V=Math.floor(Math.max(S.x,C.x,R.x,N.x)),G=1;for(let Z=B-G;Z<=V+G;Z++)Z!==0&&_.push(new o.b6(Z,d))}return _}coveringTiles(d){var _,S;let C=this.coveringZoomLevel(d);const R=C;if(d.minzoom!==void 0&&C<d.minzoom)return[];d.maxzoom!==void 0&&C>d.maxzoom&&(C=d.maxzoom);const N=this.pointCoordinate(this.getCameraPoint()),B=o.U.fromLngLat(this.center),V=Math.pow(2,C),G=[V*N.x,V*N.y,0],Z=[V*B.x,V*B.y,0],q=oa.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,C);let nt=d.minzoom||0;!d.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(nt=C);const vt=d.terrain?2/Math.min(this.tileSize,d.tileSize)*this.tileSize:3,gt=St=>({aabb:new Ru([St*V,0,0],[(St+1)*V,V,0]),zoom:0,x:0,y:0,wrap:St,fullyVisible:!1}),_t=[],dt=[],Pt=C,$t=d.reparseOverscaled?R:C;if(this._renderWorldCopies)for(let St=1;St<=3;St++)_t.push(gt(-St)),_t.push(gt(St));for(_t.push(gt(0));_t.length>0;){const St=_t.pop(),Lt=St.x,Gt=St.y;let Xt=St.fullyVisible;if(!Xt){const Be=St.aabb.intersects(q);if(Be===0)continue;Xt=Be===2}const ee=d.terrain?G:Z,oe=St.aabb.distanceX(ee),ae=St.aabb.distanceY(ee),fe=Math.max(Math.abs(oe),Math.abs(ae));if(St.zoom===Pt||fe>vt+(1<<Pt-St.zoom)-2&&St.zoom>=nt){const Be=Pt-St.zoom,Cr=G[0]-.5-(Lt<<Be),xe=G[1]-.5-(Gt<<Be);dt.push({tileID:new o.O(St.zoom===Pt?$t:St.zoom,St.wrap,St.zoom,Lt,Gt),distanceSq:U([Z[0]-.5-Lt,Z[1]-.5-Gt]),tileDistanceToCamera:Math.sqrt(Cr*Cr+xe*xe)})}else for(let Be=0;Be<4;Be++){const Cr=(Lt<<1)+Be%2,xe=(Gt<<1)+(Be>>1),rr=St.zoom+1;let Ue=St.aabb.quadrant(Be);if(d.terrain){const ei=new o.O(rr,St.wrap,rr,Cr,xe),Tr=d.terrain.getMinMaxElevation(ei),mr=(_=Tr.minElevation)!==null&&_!==void 0?_:this.elevation,Er=(S=Tr.maxElevation)!==null&&S!==void 0?S:this.elevation;Ue=new Ru([Ue.min[0],Ue.min[1],mr],[Ue.max[0],Ue.max[1],Er])}_t.push({aabb:Ue,zoom:rr,x:Cr,y:xe,wrap:St.wrap,fullyVisible:Xt})}}return dt.sort((St,Lt)=>St.distanceSq-Lt.distanceSq).map(St=>St.tileID)}resize(d,_){this.width=d,this.height=_,this.pixelsToGLUnits=[2/d,-2/_],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(d){return Math.pow(2,d)}scaleZoom(d){return Math.log(d)/Math.LN2}project(d){const _=o.ad(d.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.P(o.G(d.lng)*this.worldSize,o.H(_)*this.worldSize)}unproject(d){return new o.U(d.x/this.worldSize,d.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(d){const _=this.pointLocation(this.centerPoint,d),S=d.getElevationForLngLatZoom(_,this.tileZoom);if(!(this.elevation-S))return;const C=this.getCameraPosition(),R=o.U.fromLngLat(C.lngLat,C.altitude),N=o.U.fromLngLat(_,S),B=R.x-N.x,V=R.y-N.y,G=R.z-N.z,Z=Math.sqrt(B*B+V*V+G*G),q=this.scaleZoom(this.cameraToCenterDistance/Z/this.tileSize);this._elevation=S,this._center=_,this.zoom=q}setLocationAtPoint(d,_){const S=this.pointCoordinate(_),C=this.pointCoordinate(this.centerPoint),R=this.locationCoordinate(d),N=new o.U(R.x-(S.x-C.x),R.y-(S.y-C.y));this.center=this.coordinateLocation(N),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(d,_){return _?this.coordinatePoint(this.locationCoordinate(d),_.getElevationForLngLatZoom(d,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(d))}pointLocation(d,_){return this.coordinateLocation(this.pointCoordinate(d,_))}locationCoordinate(d){return o.U.fromLngLat(d)}coordinateLocation(d){return d&&d.toLngLat()}pointCoordinate(d,_){if(_){const nt=_.pointCoordinate(d);if(nt!=null)return nt}const S=[d.x,d.y,0,1],C=[d.x,d.y,1,1];o.ag(S,S,this.pixelMatrixInverse),o.ag(C,C,this.pixelMatrixInverse);const R=S[3],N=C[3],B=S[1]/R,V=C[1]/N,G=S[2]/R,Z=C[2]/N,q=G===Z?0:(0-G)/(Z-G);return new o.U(o.B.number(S[0]/R,C[0]/N,q)/this.worldSize,o.B.number(B,V,q)/this.worldSize)}coordinatePoint(d,_=0,S=this.pixelMatrix){const C=[d.x*this.worldSize,d.y*this.worldSize,_,1];return o.ag(C,C,S),new o.P(C[0]/C[3],C[1]/C[3])}getBounds(){const d=Math.max(0,this.height/2-this.getHorizon());return new ce().extend(this.pointLocation(new o.P(0,d))).extend(this.pointLocation(new o.P(this.width,d))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ce([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(d){d?(this.lngRange=[d.getWest(),d.getEast()],this.latRange=[d.getSouth(),d.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(d,_=!1){const S=d.key,C=_?this._alignedPosMatrixCache:this._posMatrixCache;if(C[S])return C[S];const R=d.canonical,N=this.worldSize/this.zoomScale(R.z),B=R.x+Math.pow(2,R.z)*d.wrap,V=o.ao(new Float64Array(16));return o.$(V,V,[B*N,R.y*N,0]),o.a0(V,V,[N/o.N,N/o.N,1]),o.a1(V,_?this.alignedProjMatrix:this.projMatrix,V),C[S]=new Float32Array(V),C[S]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let d,_,S,C,R=-90,N=90,B=-180,V=180;const G=this.size,Z=this._unmodified;if(this.latRange){const vt=this.latRange;R=o.H(vt[1])*this.worldSize,N=o.H(vt[0])*this.worldSize,d=N-R<G.y?G.y/(N-R):0}if(this.lngRange){const vt=this.lngRange;B=o.b5(o.G(vt[0])*this.worldSize,0,this.worldSize),V=o.b5(o.G(vt[1])*this.worldSize,0,this.worldSize),V<B&&(V+=this.worldSize),_=V-B<G.x?G.x/(V-B):0}const q=this.point,nt=Math.max(_||0,d||0);if(nt)return this.center=this.unproject(new o.P(_?(V+B)/2:q.x,d?(N+R)/2:q.y)),this.zoom+=this.scaleZoom(nt),this._unmodified=Z,void(this._constraining=!1);if(this.latRange){const vt=q.y,gt=G.y/2;vt-gt<R&&(C=R+gt),vt+gt>N&&(C=N-gt)}if(this.lngRange){const vt=(B+V)/2,gt=o.b5(q.x,vt-this.worldSize/2,vt+this.worldSize/2),_t=G.x/2;gt-_t<B&&(S=B+_t),gt+_t>V&&(S=V-_t)}S===void 0&&C===void 0||(this.center=this.unproject(new o.P(S!==void 0?S:q.x,C!==void 0?C:q.y)).wrap()),this._unmodified=Z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const d=this.centerOffset,_=this.point.x,S=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b7(1,this.center.lat)*this.worldSize;let C=o.ao(new Float64Array(16));o.a0(C,C,[this.width/2,-this.height/2,1]),o.$(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=o.ao(new Float64Array(16)),o.a0(C,C,[1,-1,1]),o.$(C,C,[-1,-1,0]),o.a0(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C;const R=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),N=Math.min(this.elevation,this._minEleveationForCurrentTile),B=R-N*this._pixelPerMeter/Math.cos(this._pitch),V=N<0?B:R,G=Math.PI/2+this._pitch,Z=this._fov*(.5+d.y/this.height),q=Math.sin(Z)*V/Math.sin(o.ad(Math.PI-G-Z,.01,Math.PI-.01)),nt=this.getHorizon(),vt=2*Math.atan(nt/this.cameraToCenterDistance)*(.5+d.y/(2*nt)),gt=Math.sin(vt)*V/Math.sin(o.ad(Math.PI-G-vt,.01,Math.PI-.01)),_t=Math.min(q,gt),dt=1.01*(Math.cos(Math.PI/2-this._pitch)*_t+V),Pt=this.height/50;C=new Float64Array(16),o.b8(C,this._fov,this.width/this.height,Pt,dt),C[8]=2*-d.x/this.width,C[9]=2*d.y/this.height,o.a0(C,C,[1,-1,1]),o.$(C,C,[0,0,-this.cameraToCenterDistance]),o.b9(C,C,this._pitch),o.ae(C,C,this.angle),o.$(C,C,[-_,-S,0]),this.mercatorMatrix=o.a0([],C,[this.worldSize,this.worldSize,this.worldSize]),o.a0(C,C,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.a1(new Float64Array(16),this.labelPlaneMatrix,C),o.$(C,C,[0,0,-this.elevation]),this.projMatrix=C,this.invProjMatrix=o.as([],C),this.pixelMatrix3D=o.a1(new Float64Array(16),this.labelPlaneMatrix,C);const $t=this.width%2/2,St=this.height%2/2,Lt=Math.cos(this.angle),Gt=Math.sin(this.angle),Xt=_-Math.round(_)+Lt*$t+Gt*St,ee=S-Math.round(S)+Lt*St+Gt*$t,oe=new Float64Array(C);if(o.$(oe,oe,[Xt>.5?Xt-1:Xt,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=oe,C=o.as(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");this.pixelMatrixInverse=C,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const d=this.pointCoordinate(new o.P(0,0)),_=[d.x*this.worldSize,d.y*this.worldSize,0,1];return o.ag(_,_,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const d=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,d))}getCameraQueryGeometry(d){const _=this.getCameraPoint();if(d.length===1)return[d[0],_];{let S=_.x,C=_.y,R=_.x,N=_.y;for(const B of d)S=Math.min(S,B.x),C=Math.min(C,B.y),R=Math.max(R,B.x),N=Math.max(N,B.y);return[new o.P(S,C),new o.P(R,C),new o.P(R,N),new o.P(S,N),new o.P(S,C)]}}}function Ol(I,d){let _,S=!1,C=null,R=null;const N=()=>{C=null,S&&(I.apply(R,_),C=setTimeout(N,d),S=!1)};return(...B)=>(S=!0,R=this,_=B,C||N(),C)}class lh{constructor(d){this._getCurrentHash=()=>{const _=window.location.hash.replace("#","");if(this._hashName){let S;return _.split("&").map(C=>C.split("=")).forEach(C=>{C[0]===this._hashName&&(S=C)}),(S&&S[1]||"").split("/")}return _.split("/")},this._onHashChange=()=>{const _=this._getCurrentHash();if(_.length>=3&&!_.some(S=>isNaN(S))){const S=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(_[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+_[2],+_[1]],zoom:+_[0],bearing:S,pitch:+(_[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const _=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,_)}catch{}},this._updateHash=Ol(this._updateHashUnthrottled,300),this._hashName=d&&encodeURIComponent(d)}addTo(d){return this._map=d,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(d){const _=this._map.getCenter(),S=Math.round(100*this._map.getZoom())/100,C=Math.ceil((S*Math.LN2+Math.log(512/360/.5))/Math.LN10),R=Math.pow(10,C),N=Math.round(_.lng*R)/R,B=Math.round(_.lat*R)/R,V=this._map.getBearing(),G=this._map.getPitch();let Z="";if(Z+=d?`/${N}/${B}/${S}`:`${S}/${B}/${N}`,(V||G)&&(Z+="/"+Math.round(10*V)/10),G&&(Z+=`/${Math.round(G)}`),this._hashName){const q=this._hashName;let nt=!1;const vt=window.location.hash.slice(1).split("&").map(gt=>{const _t=gt.split("=")[0];return _t===q?(nt=!0,`${_t}=${Z}`):gt}).filter(gt=>gt);return nt||vt.push(`${q}=${Z}`),`#${vt.join("&")}`}return`#${Z}`}}const Du={linearity:.3,easing:o.ba(0,0,.3,1)},a0=o.e({deceleration:2500,maxSpeed:1400},Du),s0=o.e({deceleration:20,maxSpeed:1400},Du),o0=o.e({deceleration:1e3,maxSpeed:360},Du),l0=o.e({deceleration:1e3,maxSpeed:90},Du);class u0{constructor(d){this._map=d,this.clear()}clear(){this._inertiaBuffer=[]}record(d){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.h.now(),settings:d})}_drainInertiaBuffer(){const d=this._inertiaBuffer,_=o.h.now();for(;d.length>0&&_-d[0].time>160;)d.shift()}_onMoveEnd(d){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const _={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:R}of this._inertiaBuffer)_.zoom+=R.zoomDelta||0,_.bearing+=R.bearingDelta||0,_.pitch+=R.pitchDelta||0,R.panDelta&&_.pan._add(R.panDelta),R.around&&(_.around=R.around),R.pinchAround&&(_.pinchAround=R.pinchAround);const S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,C={};if(_.pan.mag()){const R=uh(_.pan.mag(),S,o.e({},a0,d||{}));C.offset=_.pan.mult(R.amount/_.pan.mag()),C.center=this._map.transform.center,Ds(C,R)}if(_.zoom){const R=uh(_.zoom,S,s0);C.zoom=this._map.transform.zoom+R.amount,Ds(C,R)}if(_.bearing){const R=uh(_.bearing,S,o0);C.bearing=this._map.transform.bearing+o.ad(R.amount,-179,179),Ds(C,R)}if(_.pitch){const R=uh(_.pitch,S,l0);C.pitch=this._map.transform.pitch+R.amount,Ds(C,R)}if(C.zoom||C.bearing){const R=_.pinchAround===void 0?_.around:_.pinchAround;C.around=R?this._map.unproject(R):this._map.getCenter()}return this.clear(),o.e(C,{noMoveStart:!0})}}function Ds(I,d){(!I.duration||I.duration<d.duration)&&(I.duration=d.duration,I.easing=d.easing)}function uh(I,d,_){const{maxSpeed:S,linearity:C,deceleration:R}=_,N=o.ad(I*C/(d/1e3),-S,S),B=Math.abs(N)/(R*C);return{easing:_.easing,duration:1e3*B,amount:N*(B/2)}}class Ra extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,_,S,C={}){const R=u.mousePos(_.getCanvasContainer(),S),N=_.unproject(R);super(d,o.e({point:R,lngLat:N,originalEvent:S},C)),this._defaultPrevented=!1,this.target=_}}class ch extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,_,S){const C=d==="touchend"?S.changedTouches:S.touches,R=u.touchPos(_.getCanvasContainer(),C),N=R.map(V=>_.unproject(V)),B=R.reduce((V,G,Z,q)=>V.add(G.div(q.length)),new o.P(0,0));super(d,{points:R,point:B,lngLats:N,lngLat:_.unproject(B),originalEvent:S}),this._defaultPrevented=!1}}class c0 extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,_,S){super(d,{originalEvent:S}),this._defaultPrevented=!1}}class h0{constructor(d,_){this._map=d,this._clickTolerance=_.clickTolerance}reset(){delete this._mousedownPos}wheel(d){return this._firePreventable(new c0(d.type,this._map,d))}mousedown(d,_){return this._mousedownPos=_,this._firePreventable(new Ra(d.type,this._map,d))}mouseup(d){this._map.fire(new Ra(d.type,this._map,d))}click(d,_){this._mousedownPos&&this._mousedownPos.dist(_)>=this._clickTolerance||this._map.fire(new Ra(d.type,this._map,d))}dblclick(d){return this._firePreventable(new Ra(d.type,this._map,d))}mouseover(d){this._map.fire(new Ra(d.type,this._map,d))}mouseout(d){this._map.fire(new Ra(d.type,this._map,d))}touchstart(d){return this._firePreventable(new ch(d.type,this._map,d))}touchmove(d){this._map.fire(new ch(d.type,this._map,d))}touchend(d){this._map.fire(new ch(d.type,this._map,d))}touchcancel(d){this._map.fire(new ch(d.type,this._map,d))}_firePreventable(d){if(this._map.fire(d),d.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class f0{constructor(d){this._map=d}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(d){this._map.fire(new Ra(d.type,this._map,d))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ra("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(d){this._delayContextMenu?this._contextMenuEvent=d:this._ignoreContextMenu||this._map.fire(new Ra(d.type,this._map,d)),this._map.listens("contextmenu")&&d.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class po{constructor(d){this._map=d}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(d){return this.transform.pointLocation(o.P.convert(d),this._map.terrain)}}class d0{constructor(d,_){this._map=d,this._tr=new po(d),this._el=d.getCanvasContainer(),this._container=d.getContainer(),this._clickTolerance=_.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(d,_){this.isEnabled()&&d.shiftKey&&d.button===0&&(u.disableDrag(),this._startPos=this._lastPos=_,this._active=!0)}mousemoveWindow(d,_){if(!this._active)return;const S=_;if(this._lastPos.equals(S)||!this._box&&S.dist(this._startPos)<this._clickTolerance)return;const C=this._startPos;this._lastPos=S,this._box||(this._box=u.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",d));const R=Math.min(C.x,S.x),N=Math.max(C.x,S.x),B=Math.min(C.y,S.y),V=Math.max(C.y,S.y);u.setTransform(this._box,`translate(${R}px,${B}px)`),this._box.style.width=N-R+"px",this._box.style.height=V-B+"px"}mouseupWindow(d,_){if(!this._active||d.button!==0)return;const S=this._startPos,C=_;if(this.reset(),u.suppressClick(),S.x!==C.x||S.y!==C.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:d})),{cameraAnimation:R=>R.fitScreenCoordinates(S,C,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",d)}keydown(d){this._active&&d.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",d))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(u.remove(this._box),this._box=null),u.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(d,_){return this._map.fire(new o.k(d,{originalEvent:_}))}}function rs(I,d){if(I.length!==d.length)throw new Error(`The number of touches and points are not equal - touches ${I.length}, points ${d.length}`);const _={};for(let S=0;S<I.length;S++)_[I[S].identifier]=d[S];return _}class go{constructor(d){this.reset(),this.numTouches=d.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(d,_,S){(this.centroid||S.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=d.timeStamp),S.length===this.numTouches&&(this.centroid=function(C){const R=new o.P(0,0);for(const N of C)R._add(N);return R.div(C.length)}(_),this.touches=rs(S,_)))}touchmove(d,_,S){if(this.aborted||!this.centroid)return;const C=rs(S,_);for(const R in this.touches){const N=C[R];(!N||N.dist(this.touches[R])>30)&&(this.aborted=!0)}}touchend(d,_,S){if((!this.centroid||d.timeStamp-this.startTime>500)&&(this.aborted=!0),S.length===0){const C=!this.aborted&&this.centroid;if(this.reset(),C)return C}}}class Ed{constructor(d){this.singleTap=new go(d),this.numTaps=d.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(d,_,S){this.singleTap.touchstart(d,_,S)}touchmove(d,_,S){this.singleTap.touchmove(d,_,S)}touchend(d,_,S){const C=this.singleTap.touchend(d,_,S);if(C){const R=d.timeStamp-this.lastTime<500,N=!this.lastTap||this.lastTap.dist(C)<30;if(R&&N||this.reset(),this.count++,this.lastTime=d.timeStamp,this.lastTap=C,this.count===this.numTaps)return this.reset(),C}}}class vo{constructor(d){this._tr=new po(d),this._zoomIn=new Ed({numTouches:1,numTaps:2}),this._zoomOut=new Ed({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(d,_,S){this._zoomIn.touchstart(d,_,S),this._zoomOut.touchstart(d,_,S)}touchmove(d,_,S){this._zoomIn.touchmove(d,_,S),this._zoomOut.touchmove(d,_,S)}touchend(d,_,S){const C=this._zoomIn.touchend(d,_,S),R=this._zoomOut.touchend(d,_,S),N=this._tr;return C?(this._active=!0,d.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:N.zoom+1,around:N.unproject(C)},{originalEvent:d})}):R?(this._active=!0,d.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:N.zoom-1,around:N.unproject(R)},{originalEvent:d})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mo{constructor(d){this._enabled=!!d.enable,this._moveStateManager=d.moveStateManager,this._clickTolerance=d.clickTolerance||1,this._moveFunction=d.move,this._activateOnStart=!!d.activateOnStart,d.assignEvents(this),this.reset()}reset(d){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(d)}_move(...d){const _=this._moveFunction(...d);if(_.bearingDelta||_.pitchDelta||_.around||_.panDelta)return this._active=!0,_}dragStart(d,_){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(d)&&(this._moveStateManager.startMove(d),this._lastPoint=_.length?_[0]:_,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(d,_){if(!this.isEnabled())return;const S=this._lastPoint;if(!S)return;if(d.preventDefault(),!this._moveStateManager.isValidMoveEvent(d))return void this.reset(d);const C=_.length?_[0]:_;return!this._moved&&C.dist(S)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=C,this._move(S,C))}dragEnd(d){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(d)&&(this._moved&&u.suppressClick(),this.reset(d))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const hT={0:1,2:2};class lv{constructor(d){this._correctEvent=d.checkCorrectEvent}startMove(d){const _=u.mouseButton(d);this._eventButton=_}endMove(d){delete this._eventButton}isValidStartEvent(d){return this._correctEvent(d)}isValidMoveEvent(d){return!function(_,S){const C=hT[S];return _.buttons===void 0||(_.buttons&C)!==C}(d,this._eventButton)}isValidEndEvent(d){return u.mouseButton(d)===this._eventButton}}class p0{constructor(){this._firstTouch=void 0}_isOneFingerTouch(d){return d.targetTouches.length===1}_isSameTouchEvent(d){return d.targetTouches[0].identifier===this._firstTouch}startMove(d){this._firstTouch=d.targetTouches[0].identifier}endMove(d){delete this._firstTouch}isValidStartEvent(d){return this._isOneFingerTouch(d)}isValidMoveEvent(d){return this._isOneFingerTouch(d)&&this._isSameTouchEvent(d)}isValidEndEvent(d){return this._isOneFingerTouch(d)&&this._isSameTouchEvent(d)}}const Id=I=>{I.mousedown=I.dragStart,I.mousemoveWindow=I.dragMove,I.mouseup=I.dragEnd,I.contextmenu=function(d){d.preventDefault()}},Lu=({enable:I,clickTolerance:d,bearingDegreesPerPixelMoved:_=.8})=>{const S=new lv({checkCorrectEvent:C=>u.mouseButton(C)===0&&C.ctrlKey||u.mouseButton(C)===2});return new mo({clickTolerance:d,move:(C,R)=>({bearingDelta:(R.x-C.x)*_}),moveStateManager:S,enable:I,assignEvents:Id})},yo=({enable:I,clickTolerance:d,pitchDegreesPerPixelMoved:_=-.5})=>{const S=new lv({checkCorrectEvent:C=>u.mouseButton(C)===0&&C.ctrlKey||u.mouseButton(C)===2});return new mo({clickTolerance:d,move:(C,R)=>({pitchDelta:(R.y-C.y)*_}),moveStateManager:S,enable:I,assignEvents:Id})};class De{constructor(d,_){this._minTouches=d.cooperativeGestures?2:1,this._clickTolerance=d.clickTolerance||1,this._map=_,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(d,_,S){return this._calculateTransform(d,_,S)}touchmove(d,_,S){if(this._map._cooperativeGestures&&(this._minTouches===2&&S.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(d,!1,S.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(S.length<this._minTouches))return d.preventDefault(),this._calculateTransform(d,_,S)}touchend(d,_,S){this._calculateTransform(d,_,S),this._active&&S.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(d,_,S){S.length>0&&(this._active=!0);const C=rs(S,_),R=new o.P(0,0),N=new o.P(0,0);let B=0;for(const G in C){const Z=C[G],q=this._touches[G];q&&(R._add(Z),N._add(Z.sub(q)),B++,C[G]=Z)}if(this._touches=C,B<this._minTouches||!N.mag())return;const V=N.div(B);return this._sum._add(V),this._sum.mag()<this._clickTolerance?void 0:{around:R.div(B),panDelta:V}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Md{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(d,_,S){this._firstTwoTouches||S.length<2||(this._firstTwoTouches=[S[0].identifier,S[1].identifier],this._start([_[0],_[1]]))}touchmove(d,_,S){if(!this._firstTwoTouches)return;d.preventDefault();const[C,R]=this._firstTwoTouches,N=jo(S,_,C),B=jo(S,_,R);if(!N||!B)return;const V=this._aroundCenter?null:N.add(B).div(2);return this._move([N,B],V,d)}touchend(d,_,S){if(!this._firstTwoTouches)return;const[C,R]=this._firstTwoTouches,N=jo(S,_,C),B=jo(S,_,R);N&&B||(this._active&&u.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(d){this._enabled=!0,this._aroundCenter=!!d&&d.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function jo(I,d,_){for(let S=0;S<I.length;S++)if(I[S].identifier===_)return d[S]}function ku(I,d){return Math.log(I/d)/Math.LN2}class g0 extends Md{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(d){this._startDistance=this._distance=d[0].dist(d[1])}_move(d,_){const S=this._distance;if(this._distance=d[0].dist(d[1]),this._active||!(Math.abs(ku(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ku(this._distance,S),pinchAround:_}}}function Me(I,d){return 180*I.angleWith(d)/Math.PI}class uv extends Md{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(d){this._startVector=this._vector=d[0].sub(d[1]),this._minDiameter=d[0].dist(d[1])}_move(d,_){const S=this._vector;if(this._vector=d[0].sub(d[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Me(this._vector,S),pinchAround:_}}_isBelowThreshold(d){this._minDiameter=Math.min(this._minDiameter,d.mag());const _=25/(Math.PI*this._minDiameter)*360,S=Me(d,this._startVector);return Math.abs(S)<_}}function cv(I){return Math.abs(I.y)>Math.abs(I.x)}class fT extends Md{constructor(d){super(),this._map=d}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(d,_,S){super.touchstart(d,_,S),this._currentTouchCount=S.length}_start(d){this._lastPoints=d,cv(d[0].sub(d[1]))&&(this._valid=!1)}_move(d,_,S){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const C=d[0].sub(this._lastPoints[0]),R=d[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(C,R,S.timeStamp),this._valid?(this._lastPoints=d,this._active=!0,{pitchDelta:(C.y+R.y)/2*-.5}):void 0}gestureBeginsVertically(d,_,S){if(this._valid!==void 0)return this._valid;const C=d.mag()>=2,R=_.mag()>=2;if(!C&&!R)return;if(!C||!R)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;const N=d.y>0==_.y>0;return cv(d)&&cv(_)&&N}}const hv={panStep:100,bearingStep:15,pitchStep:10};class v0{constructor(d){this._tr=new po(d);const _=hv;this._panStep=_.panStep,this._bearingStep=_.bearingStep,this._pitchStep=_.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(d){if(d.altKey||d.ctrlKey||d.metaKey)return;let _=0,S=0,C=0,R=0,N=0;switch(d.keyCode){case 61:case 107:case 171:case 187:_=1;break;case 189:case 109:case 173:_=-1;break;case 37:d.shiftKey?S=-1:(d.preventDefault(),R=-1);break;case 39:d.shiftKey?S=1:(d.preventDefault(),R=1);break;case 38:d.shiftKey?C=1:(d.preventDefault(),N=-1);break;case 40:d.shiftKey?C=-1:(d.preventDefault(),N=1);break;default:return}return this._rotationDisabled&&(S=0,C=0),{cameraAnimation:B=>{const V=this._tr;B.easeTo({duration:300,easeId:"keyboardHandler",easing:m0,zoom:_?Math.round(V.zoom)+_*(d.shiftKey?2:1):V.zoom,bearing:V.bearing+S*this._bearingStep,pitch:V.pitch+C*this._pitchStep,offset:[-R*this._panStep,-N*this._panStep],center:V.center},{originalEvent:d})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function m0(I){return I*(2-I)}const y0=4.000244140625;class dT{constructor(d,_){this._onTimeout=S=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(S)},this._map=d,this._tr=new po(d),this._el=d.getCanvasContainer(),this._triggerRenderFrame=_,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(d){this._defaultZoomRate=d}setWheelZoomRate(d){this._wheelZoomRate=d}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(d){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!d&&d.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(d){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!d[this._map._metaKey])return;d.preventDefault()}let _=d.deltaMode===WheelEvent.DOM_DELTA_LINE?40*d.deltaY:d.deltaY;const S=o.h.now(),C=S-(this._lastWheelEventTime||0);this._lastWheelEventTime=S,_!==0&&_%y0==0?this._type="wheel":_!==0&&Math.abs(_)<4?this._type="trackpad":C>400?(this._type=null,this._lastValue=_,this._timeout=setTimeout(this._onTimeout,40,d)):this._type||(this._type=Math.abs(C*_)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,_+=this._lastValue)),d.shiftKey&&_&&(_/=4),this._type&&(this._lastWheelEvent=d,this._delta-=_,this._active||this._start(d)),d.preventDefault()}_start(d){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const _=u.mousePos(this._el,d),S=this._tr;this._around=o.L.convert(this._aroundCenter?S.center:S.unproject(_)),this._aroundPoint=S.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const d=this._tr.transform;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>y0?this._wheelZoomRate:this._defaultZoomRate;let V=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&V!==0&&(V=1/V);const G=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(G*V))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,S=this._startZoom,C=this._easing;let R,N=!1;if(this._type==="wheel"&&S&&C){const B=Math.min((o.h.now()-this._lastWheelEventTime)/200,1),V=C(B);R=o.B.number(S,_,V),B<1?this._frameId||(this._frameId=!0):N=!0}else R=_,N=!0;return this._active=!0,N&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!N,zoomDelta:R-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(d){let _=o.bb;if(this._prevEase){const S=this._prevEase,C=(o.h.now()-S.start)/S.duration,R=S.easing(C+.01)-S.easing(C),N=.27/Math.sqrt(R*R+1e-4)*.01,B=Math.sqrt(.0729-N*N);_=o.ba(N,B,.25,1)}return this._prevEase={start:o.h.now(),duration:d,easing:_},_}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class fv{constructor(d,_){this._clickZoom=d,this._tapZoom=_}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dv{constructor(d){this._tr=new po(d),this.reset()}reset(){this._active=!1}dblclick(d,_){return d.preventDefault(),{cameraAnimation:S=>{S.easeTo({duration:300,zoom:this._tr.zoom+(d.shiftKey?-1:1),around:this._tr.unproject(_)},{originalEvent:d})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pv{constructor(){this._tap=new Ed({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(d,_,S){if(!this._swipePoint)if(this._tapTime){const C=_[0],R=d.timeStamp-this._tapTime<500,N=this._tapPoint.dist(C)<30;R&&N?S.length>0&&(this._swipePoint=C,this._swipeTouch=S[0].identifier):this.reset()}else this._tap.touchstart(d,_,S)}touchmove(d,_,S){if(this._tapTime){if(this._swipePoint){if(S[0].identifier!==this._swipeTouch)return;const C=_[0],R=C.y-this._swipePoint.y;return this._swipePoint=C,d.preventDefault(),this._active=!0,{zoomDelta:R/128}}}else this._tap.touchmove(d,_,S)}touchend(d,_,S){if(this._tapTime)this._swipePoint&&S.length===0&&this.reset();else{const C=this._tap.touchend(d,_,S);C&&(this._tapTime=d.timeStamp,this._tapPoint=C)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gv{constructor(d,_,S){this._el=d,this._mousePan=_,this._touchPan=S}enable(d){this._inertiaOptions=d||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class la{constructor(d,_,S){this._pitchWithRotate=d.pitchWithRotate,this._mouseRotate=_,this._mousePitch=S}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xo{constructor(d,_,S,C){this._el=d,this._touchZoom=_,this._touchRotate=S,this._tapDragZoom=C,this._rotationDisabled=!1,this._enabled=!0}enable(d){this._touchZoom.enable(d),this._rotationDisabled||this._touchRotate.enable(d),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const hh=I=>I.zoom||I.drag||I.pitch||I.rotate;class vv extends o.k{}function fh(I){return I.panDelta&&I.panDelta.mag()||I.zoomDelta||I.bearingDelta||I.pitchDelta}class mv{constructor(d,_){this.handleWindowEvent=C=>{this.handleEvent(C,`${C.type}Window`)},this.handleEvent=(C,R)=>{if(C.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const N=C.type==="renderFrame"?void 0:C,B={needsRenderFrame:!1},V={},G={},Z=C.touches,q=Z?this._getMapTouches(Z):void 0,nt=q?u.touchPos(this._el,q):u.mousePos(this._el,C);for(const{handlerName:_t,handler:dt,allowed:Pt}of this._handlers){if(!dt.isEnabled())continue;let $t;this._blockedByActive(G,Pt,_t)?dt.reset():dt[R||C.type]&&($t=dt[R||C.type](C,nt,q),this.mergeHandlerResult(B,V,$t,_t,N),$t&&$t.needsRenderFrame&&this._triggerRenderFrame()),($t||dt.isActive())&&(G[_t]=dt)}const vt={};for(const _t in this._previousActiveHandlers)G[_t]||(vt[_t]=N);this._previousActiveHandlers=G,(Object.keys(vt).length||fh(B))&&(this._changes.push([B,V,vt]),this._triggerRenderFrame()),(Object.keys(G).length||fh(B))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:gt}=B;gt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],gt(this._map))},this._map=d,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new u0(d),this._bearingSnap=_.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(_);const S=this._el;this._listeners=[[S,"touchstart",{passive:!0}],[S,"touchmove",{passive:!1}],[S,"touchend",void 0],[S,"touchcancel",void 0],[S,"mousedown",void 0],[S,"mousemove",void 0],[S,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[S,"mouseover",void 0],[S,"mouseout",void 0],[S,"dblclick",void 0],[S,"click",void 0],[S,"keydown",{capture:!1}],[S,"keyup",void 0],[S,"wheel",{passive:!1}],[S,"contextmenu",void 0],[window,"blur",void 0]];for(const[C,R,N]of this._listeners)u.addEventListener(C,R,C===document?this.handleWindowEvent:this.handleEvent,N)}destroy(){for(const[d,_,S]of this._listeners)u.removeEventListener(d,_,d===document?this.handleWindowEvent:this.handleEvent,S)}_addDefaultHandlers(d){const _=this._map,S=_.getCanvasContainer();this._add("mapEvent",new h0(_,d));const C=_.boxZoom=new d0(_,d);this._add("boxZoom",C),d.interactive&&d.boxZoom&&C.enable();const R=new vo(_),N=new dv(_);_.doubleClickZoom=new fv(N,R),this._add("tapZoom",R),this._add("clickZoom",N),d.interactive&&d.doubleClickZoom&&_.doubleClickZoom.enable();const B=new pv;this._add("tapDragZoom",B);const V=_.touchPitch=new fT(_);this._add("touchPitch",V),d.interactive&&d.touchPitch&&_.touchPitch.enable(d.touchPitch);const G=Lu(d),Z=yo(d);_.dragRotate=new la(d,G,Z),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]),d.interactive&&d.dragRotate&&_.dragRotate.enable();const q=(({enable:Pt,clickTolerance:$t})=>{const St=new lv({checkCorrectEvent:Lt=>u.mouseButton(Lt)===0&&!Lt.ctrlKey});return new mo({clickTolerance:$t,move:(Lt,Gt)=>({around:Gt,panDelta:Gt.sub(Lt)}),activateOnStart:!0,moveStateManager:St,enable:Pt,assignEvents:Id})})(d),nt=new De(d,_);_.dragPan=new gv(S,q,nt),this._add("mousePan",q),this._add("touchPan",nt,["touchZoom","touchRotate"]),d.interactive&&d.dragPan&&_.dragPan.enable(d.dragPan);const vt=new uv,gt=new g0;_.touchZoomRotate=new Xo(S,gt,vt,B),this._add("touchRotate",vt,["touchPan","touchZoom"]),this._add("touchZoom",gt,["touchPan","touchRotate"]),d.interactive&&d.touchZoomRotate&&_.touchZoomRotate.enable(d.touchZoomRotate);const _t=_.scrollZoom=new dT(_,()=>this._triggerRenderFrame());this._add("scrollZoom",_t,["mousePan"]),d.interactive&&d.scrollZoom&&_.scrollZoom.enable(d.scrollZoom);const dt=_.keyboard=new v0(_);this._add("keyboard",dt),d.interactive&&d.keyboard&&_.keyboard.enable(),this._add("blockableMapEvent",new f0(_))}_add(d,_,S){this._handlers.push({handlerName:d,handler:_,allowed:S}),this._handlersById[d]=_}stop(d){if(!this._updatingCamera){for(const{handler:_}of this._handlers)_.reset();this._inertia.clear(),this._fireEvents({},{},d),this._changes=[]}}isActive(){for(const{handler:d}of this._handlers)if(d.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!hh(this._eventsInProgress)||this.isZooming()}_blockedByActive(d,_,S){for(const C in d)if(C!==S&&(!_||_.indexOf(C)<0))return!0;return!1}_getMapTouches(d){const _=[];for(const S of d)this._el.contains(S.target)&&_.push(S);return _}mergeHandlerResult(d,_,S,C,R){if(!S)return;o.e(d,S);const N={handlerName:C,originalEvent:S.originalEvent||R};S.zoomDelta!==void 0&&(_.zoom=N),S.panDelta!==void 0&&(_.drag=N),S.pitchDelta!==void 0&&(_.pitch=N),S.bearingDelta!==void 0&&(_.rotate=N)}_applyChanges(){const d={},_={},S={};for(const[C,R,N]of this._changes)C.panDelta&&(d.panDelta=(d.panDelta||new o.P(0,0))._add(C.panDelta)),C.zoomDelta&&(d.zoomDelta=(d.zoomDelta||0)+C.zoomDelta),C.bearingDelta&&(d.bearingDelta=(d.bearingDelta||0)+C.bearingDelta),C.pitchDelta&&(d.pitchDelta=(d.pitchDelta||0)+C.pitchDelta),C.around!==void 0&&(d.around=C.around),C.pinchAround!==void 0&&(d.pinchAround=C.pinchAround),C.noInertia&&(d.noInertia=C.noInertia),o.e(_,R),o.e(S,N);this._updateMapTransform(d,_,S),this._changes=[]}_updateMapTransform(d,_,S){const C=this._map,R=C._getTransformForUpdate(),N=C.terrain;if(!(fh(d)||N&&this._terrainMovement))return this._fireEvents(_,S,!0);let{panDelta:B,zoomDelta:V,bearingDelta:G,pitchDelta:Z,around:q,pinchAround:nt}=d;nt!==void 0&&(q=nt),C._stop(!0),q=q||C.transform.centerPoint;const vt=R.pointLocation(B?q.sub(B):q);G&&(R.bearing+=G),Z&&(R.pitch+=Z),V&&(R.zoom+=V),N?this._terrainMovement||!_.drag&&!_.zoom?_.drag&&this._terrainMovement?R.center=R.pointLocation(R.centerPoint.sub(B)):R.setLocationAtPoint(vt,q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,R.setLocationAtPoint(vt,q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,R.recalculateZoom(C.terrain)})):R.setLocationAtPoint(vt,q),C._applyUpdatedTransform(R),this._map._update(),d.noInertia||this._inertia.record(d),this._fireEvents(_,S,!0)}_fireEvents(d,_,S){const C=hh(this._eventsInProgress),R=hh(d),N={};for(const Z in d){const{originalEvent:q}=d[Z];this._eventsInProgress[Z]||(N[`${Z}start`]=q),this._eventsInProgress[Z]=d[Z]}!C&&R&&this._fireEvent("movestart",R.originalEvent);for(const Z in N)this._fireEvent(Z,N[Z]);R&&this._fireEvent("move",R.originalEvent);for(const Z in d){const{originalEvent:q}=d[Z];this._fireEvent(Z,q)}const B={};let V;for(const Z in this._eventsInProgress){const{handlerName:q,originalEvent:nt}=this._eventsInProgress[Z];this._handlersById[q].isActive()||(delete this._eventsInProgress[Z],V=_[q]||nt,B[`${Z}end`]=V)}for(const Z in B)this._fireEvent(Z,B[Z]);const G=hh(this._eventsInProgress);if(S&&(C||R)&&!G){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=nt=>nt!==0&&-this._bearingSnap<nt&&nt<this._bearingSnap;!Z||!Z.essential&&o.h.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:V})),q(this._map.getBearing())&&this._map.resetNorth()):(q(Z.bearing||this._map.getBearing())&&(Z.bearing=0),Z.freezeElevation=!0,this._map.easeTo(Z,{originalEvent:V})),this._updatingCamera=!1}}_fireEvent(d,_){this._map.fire(new o.k(d,_?{originalEvent:_}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(d=>{delete this._frameId,this.handleEvent(new vv("renderFrame",{timeStamp:d})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class _0 extends o.E{constructor(d,_){super(),this._renderFrameCallback=()=>{const S=Math.min((o.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(S)),S<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=d,this._bearingSnap=_.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.L(this.transform.center.lng,this.transform.center.lat)}setCenter(d,_){return this.jumpTo({center:d},_)}panBy(d,_,S){return d=o.P.convert(d).mult(-1),this.panTo(this.transform.center,o.e({offset:d},_),S)}panTo(d,_,S){return this.easeTo(o.e({center:d},_),S)}getZoom(){return this.transform.zoom}setZoom(d,_){return this.jumpTo({zoom:d},_),this}zoomTo(d,_,S){return this.easeTo(o.e({zoom:d},_),S)}zoomIn(d,_){return this.zoomTo(this.getZoom()+1,d,_),this}zoomOut(d,_){return this.zoomTo(this.getZoom()-1,d,_),this}getBearing(){return this.transform.bearing}setBearing(d,_){return this.jumpTo({bearing:d},_),this}getPadding(){return this.transform.padding}setPadding(d,_){return this.jumpTo({padding:d},_),this}rotateTo(d,_,S){return this.easeTo(o.e({bearing:d},_),S)}resetNorth(d,_){return this.rotateTo(0,o.e({duration:1e3},d),_),this}resetNorthPitch(d,_){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},d),_),this}snapToNorth(d,_){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(d,_):this}getPitch(){return this.transform.pitch}setPitch(d,_){return this.jumpTo({pitch:d},_),this}cameraForBounds(d,_){d=ce.convert(d);const S=_&&_.bearing||0;return this._cameraForBoxAndBearing(d.getNorthWest(),d.getSouthEast(),S,_)}_cameraForBoxAndBearing(d,_,S,C){const R={top:0,bottom:0,right:0,left:0};if(typeof(C=o.e({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){const Gt=C.padding;C.padding={top:Gt,bottom:Gt,right:Gt,left:Gt}}C.padding=o.e(R,C.padding);const N=this.transform,B=N.padding,V=N.project(o.L.convert(d)),G=N.project(o.L.convert(_)),Z=V.rotate(-S*Math.PI/180),q=G.rotate(-S*Math.PI/180),nt=new o.P(Math.max(Z.x,q.x),Math.max(Z.y,q.y)),vt=new o.P(Math.min(Z.x,q.x),Math.min(Z.y,q.y)),gt=nt.sub(vt),_t=(N.width-(B.left+B.right+C.padding.left+C.padding.right))/gt.x,dt=(N.height-(B.top+B.bottom+C.padding.top+C.padding.bottom))/gt.y;if(dt<0||_t<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Pt=Math.min(N.scaleZoom(N.scale*Math.min(_t,dt)),C.maxZoom),$t=o.P.convert(C.offset),St=new o.P((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(S*Math.PI/180),Lt=$t.add(St).mult(N.scale/N.zoomScale(Pt));return{center:N.unproject(V.add(G).div(2).sub(Lt)),zoom:Pt,bearing:S}}fitBounds(d,_,S){return this._fitInternal(this.cameraForBounds(d,_),_,S)}fitScreenCoordinates(d,_,S,C,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(d)),this.transform.pointLocation(o.P.convert(_)),S,C),C,R)}_fitInternal(d,_,S){return d?(delete(_=o.e(d,_)).padding,_.linear?this.easeTo(_,S):this.flyTo(_,S)):this}jumpTo(d,_){this.stop();const S=this._getTransformForUpdate();let C=!1,R=!1,N=!1;return"zoom"in d&&S.zoom!==+d.zoom&&(C=!0,S.zoom=+d.zoom),d.center!==void 0&&(S.center=o.L.convert(d.center)),"bearing"in d&&S.bearing!==+d.bearing&&(R=!0,S.bearing=+d.bearing),"pitch"in d&&S.pitch!==+d.pitch&&(N=!0,S.pitch=+d.pitch),d.padding==null||S.isPaddingEqual(d.padding)||(S.padding=d.padding),this._applyUpdatedTransform(S),this.fire(new o.k("movestart",_)).fire(new o.k("move",_)),C&&this.fire(new o.k("zoomstart",_)).fire(new o.k("zoom",_)).fire(new o.k("zoomend",_)),R&&this.fire(new o.k("rotatestart",_)).fire(new o.k("rotate",_)).fire(new o.k("rotateend",_)),N&&this.fire(new o.k("pitchstart",_)).fire(new o.k("pitch",_)).fire(new o.k("pitchend",_)),this.fire(new o.k("moveend",_))}calculateCameraOptionsFromTo(d,_,S,C=0){const R=o.U.fromLngLat(d,_),N=o.U.fromLngLat(S,C),B=N.x-R.x,V=N.y-R.y,G=N.z-R.z,Z=Math.hypot(B,V,G);if(Z===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(B,V),nt=this.transform.scaleZoom(this.transform.cameraToCenterDistance/Z/this.transform.tileSize),vt=180*Math.atan2(B,-V)/Math.PI;let gt=180*Math.acos(q/Z)/Math.PI;return gt=G<0?90-gt:90+gt,{center:N.toLngLat(),zoom:nt,pitch:gt,bearing:vt}}easeTo(d,_){this._stop(!1,d.easeId),((d=o.e({offset:[0,0],duration:500,easing:o.bb},d)).animate===!1||!d.essential&&o.h.prefersReducedMotion)&&(d.duration=0);const S=this._getTransformForUpdate(),C=this.getZoom(),R=this.getBearing(),N=this.getPitch(),B=this.getPadding(),V="zoom"in d?+d.zoom:C,G="bearing"in d?this._normalizeBearing(d.bearing,R):R,Z="pitch"in d?+d.pitch:N,q="padding"in d?d.padding:S.padding,nt=o.P.convert(d.offset);let vt=S.centerPoint.add(nt);const gt=S.pointLocation(vt),_t=o.L.convert(d.center||gt);this._normalizeCenter(_t);const dt=S.project(gt),Pt=S.project(_t).sub(dt),$t=S.zoomScale(V-C);let St,Lt;d.around&&(St=o.L.convert(d.around),Lt=S.locationPoint(St));const Gt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||V!==C,this._rotating=this._rotating||R!==G,this._pitching=this._pitching||Z!==N,this._padding=!S.isPaddingEqual(q),this._easeId=d.easeId,this._prepareEase(_,d.noMoveStart,Gt),this.terrain&&this._prepareElevation(_t),this._ease(Xt=>{if(this._zooming&&(S.zoom=o.B.number(C,V,Xt)),this._rotating&&(S.bearing=o.B.number(R,G,Xt)),this._pitching&&(S.pitch=o.B.number(N,Z,Xt)),this._padding&&(S.interpolatePadding(B,q,Xt),vt=S.centerPoint.add(nt)),this.terrain&&!d.freezeElevation&&this._updateElevation(Xt),St)S.setLocationAtPoint(St,Lt);else{const ee=S.zoomScale(S.zoom-C),oe=V>C?Math.min(2,$t):Math.max(.5,$t),ae=Math.pow(oe,1-Xt),fe=S.unproject(dt.add(Pt.mult(Xt*ae)).mult(ee));S.setLocationAtPoint(S.renderWorldCopies?fe.wrap():fe,vt)}this._applyUpdatedTransform(S),this._fireMoveEvents(_)},Xt=>{this.terrain&&this._finalizeElevation(),this._afterEase(_,Xt)},d),this}_prepareEase(d,_,S={}){this._moving=!0,_||S.moving||this.fire(new o.k("movestart",d)),this._zooming&&!S.zooming&&this.fire(new o.k("zoomstart",d)),this._rotating&&!S.rotating&&this.fire(new o.k("rotatestart",d)),this._pitching&&!S.pitching&&this.fire(new o.k("pitchstart",d))}_prepareElevation(d){this._elevationCenter=d,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(d){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const _=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(d<1&&_!==this._elevationTarget){const S=this._elevationTarget-this._elevationStart;this._elevationStart+=d*(S-(_-(S*d+this._elevationStart))/(1-d)),this._elevationTarget=_}this.transform.elevation=o.B.number(this._elevationStart,this._elevationTarget,d)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(d){if(!this.transformCameraUpdate)return;const _=d.clone(),{center:S,zoom:C,pitch:R,bearing:N,elevation:B}=this.transformCameraUpdate(_);S&&(_.center=S),C!==void 0&&(_.zoom=C),R!==void 0&&(_.pitch=R),N!==void 0&&(_.bearing=N),B!==void 0&&(_.elevation=B),this.transform.apply(_)}_fireMoveEvents(d){this.fire(new o.k("move",d)),this._zooming&&this.fire(new o.k("zoom",d)),this._rotating&&this.fire(new o.k("rotate",d)),this._pitching&&this.fire(new o.k("pitch",d))}_afterEase(d,_){if(this._easeId&&_&&this._easeId===_)return;delete this._easeId;const S=this._zooming,C=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new o.k("zoomend",d)),C&&this.fire(new o.k("rotateend",d)),R&&this.fire(new o.k("pitchend",d)),this.fire(new o.k("moveend",d))}flyTo(d,_){if(!d.essential&&o.h.prefersReducedMotion){const Ue=o.F(d,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ue,_)}this.stop(),d=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.bb},d);const S=this._getTransformForUpdate(),C=this.getZoom(),R=this.getBearing(),N=this.getPitch(),B=this.getPadding(),V="zoom"in d?o.ad(+d.zoom,S.minZoom,S.maxZoom):C,G="bearing"in d?this._normalizeBearing(d.bearing,R):R,Z="pitch"in d?+d.pitch:N,q="padding"in d?d.padding:S.padding,nt=S.zoomScale(V-C),vt=o.P.convert(d.offset);let gt=S.centerPoint.add(vt);const _t=S.pointLocation(gt),dt=o.L.convert(d.center||_t);this._normalizeCenter(dt);const Pt=S.project(_t),$t=S.project(dt).sub(Pt);let St=d.curve;const Lt=Math.max(S.width,S.height),Gt=Lt/nt,Xt=$t.mag();if("minZoom"in d){const Ue=o.ad(Math.min(d.minZoom,C,V),S.minZoom,S.maxZoom),ei=Lt/S.zoomScale(Ue-C);St=Math.sqrt(ei/Xt*2)}const ee=St*St;function oe(Ue){const ei=(Gt*Gt-Lt*Lt+(Ue?-1:1)*ee*ee*Xt*Xt)/(2*(Ue?Gt:Lt)*ee*Xt);return Math.log(Math.sqrt(ei*ei+1)-ei)}function ae(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function fe(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}const Be=oe(!1);let Cr=function(Ue){return fe(Be)/fe(Be+St*Ue)},xe=function(Ue){return Lt*((fe(Be)*(ae(ei=Be+St*Ue)/fe(ei))-ae(Be))/ee)/Xt;var ei},rr=(oe(!0)-Be)/St;if(Math.abs(Xt)<1e-6||!isFinite(rr)){if(Math.abs(Lt-Gt)<1e-6)return this.easeTo(d,_);const Ue=Gt<Lt?-1:1;rr=Math.abs(Math.log(Gt/Lt))/St,xe=function(){return 0},Cr=function(ei){return Math.exp(Ue*St*ei)}}return d.duration="duration"in d?+d.duration:1e3*rr/("screenSpeed"in d?+d.screenSpeed/St:+d.speed),d.maxDuration&&d.duration>d.maxDuration&&(d.duration=0),this._zooming=!0,this._rotating=R!==G,this._pitching=Z!==N,this._padding=!S.isPaddingEqual(q),this._prepareEase(_,!1),this.terrain&&this._prepareElevation(dt),this._ease(Ue=>{const ei=Ue*rr,Tr=1/Cr(ei);S.zoom=Ue===1?V:C+S.scaleZoom(Tr),this._rotating&&(S.bearing=o.B.number(R,G,Ue)),this._pitching&&(S.pitch=o.B.number(N,Z,Ue)),this._padding&&(S.interpolatePadding(B,q,Ue),gt=S.centerPoint.add(vt)),this.terrain&&!d.freezeElevation&&this._updateElevation(Ue);const mr=Ue===1?dt:S.unproject(Pt.add($t.mult(xe(ei))).mult(Tr));S.setLocationAtPoint(S.renderWorldCopies?mr.wrap():mr,gt),this._applyUpdatedTransform(S),this._fireMoveEvents(_)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(_)},d),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(d,_){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,_)}if(!d){const S=this.handlers;S&&S.stop(!1)}return this}_ease(d,_,S){S.animate===!1||S.duration===0?(d(1),_()):(this._easeStart=o.h.now(),this._easeOptions=S,this._onEaseFrame=d,this._onEaseEnd=_,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(d,_){d=o.b5(d,-180,180);const S=Math.abs(d-_);return Math.abs(d-360-_)<S&&(d-=360),Math.abs(d+360-_)<S&&(d+=360),d}_normalizeCenter(d){const _=this.transform;if(!_.renderWorldCopies||_.lngRange)return;const S=d.lng-_.center.lng;d.lng+=S>180?-360:S<-180?360:0}queryTerrainElevation(d){return this.terrain?this.terrain.getElevationForLngLatZoom(o.L.convert(d),this.transform.tileZoom)-this.transform.elevation:null}}class Da{constructor(d={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=_=>{!_||_.sourceDataType!=="metadata"&&_.sourceDataType!=="visibility"&&_.dataType!=="style"&&_.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=d}getDefaultPosition(){return"bottom-right"}onAdd(d){return this._map=d,this._compact=this.options&&this.options.compact,this._container=u.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=u.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=u.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){u.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(d,_){const S=this._map._getUIString(`AttributionControl.${_}`);d.title=S,d.setAttribute("aria-label",S)}_updateAttributions(){if(!this._map.style)return;let d=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?d=d.concat(this.options.customAttribution.map(C=>typeof C!="string"?"":C)):typeof this.options.customAttribution=="string"&&d.push(this.options.customAttribution)),this._map.style.stylesheet){const C=this._map.style.stylesheet;this.styleOwner=C.owner,this.styleId=C.id}const _=this._map.style.sourceCaches;for(const C in _){const R=_[C];if(R.used||R.usedForTerrain){const N=R.getSource();N.attribution&&d.indexOf(N.attribution)<0&&d.push(N.attribution)}}d=d.filter(C=>String(C).trim()),d.sort((C,R)=>C.length-R.length),d=d.filter((C,R)=>{for(let N=R+1;N<d.length;N++)if(d[N].indexOf(C)>=0)return!1;return!0});const S=d.join(" | ");S!==this._attribHTML&&(this._attribHTML=S,d.length?(this._innerContainer.innerHTML=S,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class gi{constructor(d={}){this._updateCompact=()=>{const _=this._container.children;if(_.length){const S=_[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&S.classList.add("maplibregl-compact"):S.classList.remove("maplibregl-compact")}},this.options=d}getDefaultPosition(){return"bottom-left"}onAdd(d){this._map=d,this._compact=this.options&&this.options.compact,this._container=u.create("div","maplibregl-ctrl");const _=u.create("a","maplibregl-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://maplibre.org/",_.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),_.setAttribute("rel","noopener nofollow"),this._container.appendChild(_),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){u.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Pd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(d){const _=++this._id;return this._queue.push({callback:d,id:_,cancelled:!1}),_}remove(d){const _=this._currentlyRunning,S=_?this._queue.concat(_):this._queue;for(const C of S)if(C.id===d)return void(C.cancelled=!0)}run(d=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const _=this._currentlyRunning=this._queue;this._queue=[];for(const S of _)if(!S.cancelled&&(S.callback(d),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const yv={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var x0=o.Q([{name:"a_pos3d",type:"Int16",components:3}]);class b0 extends o.E{constructor(d){super(),this.sourceCache=d,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,d.usedForTerrain=!0,d.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(d,_){this.sourceCache.update(d,_),this._renderableTilesKeys=[];const S={};for(const C of d.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:_}))S[C.key]=!0,this._renderableTilesKeys.push(C.key),this._tiles[C.key]||(C.posMatrix=new Float64Array(16),o.aS(C.posMatrix,0,o.N,0,o.N,0,1),this._tiles[C.key]=new Hi(C,this.tileSize));for(const C in this._tiles)S[C]||delete this._tiles[C]}freeRtt(d){for(const _ in this._tiles){const S=this._tiles[_];(!d||S.tileID.equals(d)||S.tileID.isChildOf(d)||d.isChildOf(S.tileID))&&(S.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(d=>this.getTileByID(d))}getTileByID(d){return this._tiles[d]}getTerrainCoords(d){const _={};for(const S of this._renderableTilesKeys){const C=this._tiles[S].tileID;if(C.canonical.equals(d.canonical)){const R=d.clone();R.posMatrix=new Float64Array(16),o.aS(R.posMatrix,0,o.N,0,o.N,0,1),_[S]=R}else if(C.canonical.isChildOf(d.canonical)){const R=d.clone();R.posMatrix=new Float64Array(16);const N=C.canonical.z-d.canonical.z,B=C.canonical.x-(C.canonical.x>>N<<N),V=C.canonical.y-(C.canonical.y>>N<<N),G=o.N>>N;o.aS(R.posMatrix,0,G,0,G,0,1),o.$(R.posMatrix,R.posMatrix,[-B*G,-V*G,0]),_[S]=R}else if(d.canonical.isChildOf(C.canonical)){const R=d.clone();R.posMatrix=new Float64Array(16);const N=d.canonical.z-C.canonical.z,B=d.canonical.x-(d.canonical.x>>N<<N),V=d.canonical.y-(d.canonical.y>>N<<N),G=o.N>>N;o.aS(R.posMatrix,0,o.N,0,o.N,0,1),o.$(R.posMatrix,R.posMatrix,[B*G,V*G,0]),o.a0(R.posMatrix,R.posMatrix,[1/2**N,1/2**N,0]),_[S]=R}}return _}getSourceTile(d,_){const S=this.sourceCache._source;let C=d.overscaledZ-this.deltaZoom;if(C>S.maxzoom&&(C=S.maxzoom),C<S.minzoom)return null;this._sourceTileCache[d.key]||(this._sourceTileCache[d.key]=d.scaledTo(C).key);let R=this.sourceCache.getTileByID(this._sourceTileCache[d.key]);if((!R||!R.dem)&&_)for(;C>=S.minzoom&&(!R||!R.dem);)R=this.sourceCache.getTileByID(d.scaledTo(C--).key);return R}tilesAfterTime(d=Date.now()){return Object.values(this._tiles).filter(_=>_.timeAdded>=d)}}class w0{constructor(d,_,S){this.painter=d,this.sourceCache=new b0(_),this.options=S,this.exaggeration=typeof S.exaggeration=="number"?S.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(d,_,S,C=o.N){var R;if(!(_>=0&&_<C&&S>=0&&S<C))return 0;const N=this.getTerrainData(d),B=(R=N.tile)===null||R===void 0?void 0:R.dem;if(!B)return 0;const V=function(gt,_t,dt){var Pt=_t[0],$t=_t[1];return gt[0]=dt[0]*Pt+dt[4]*$t+dt[12],gt[1]=dt[1]*Pt+dt[5]*$t+dt[13],gt}([],[_/C*o.N,S/C*o.N],N.u_terrain_matrix),G=[V[0]*B.dim,V[1]*B.dim],Z=Math.floor(G[0]),q=Math.floor(G[1]),nt=G[0]-Z,vt=G[1]-q;return B.get(Z,q)*(1-nt)*(1-vt)+B.get(Z+1,q)*nt*(1-vt)+B.get(Z,q+1)*(1-nt)*vt+B.get(Z+1,q+1)*nt*vt}getElevationForLngLatZoom(d,_){const{tileID:S,mercatorX:C,mercatorY:R}=this._getOverscaledTileIDFromLngLatZoom(d,_);return this.getElevation(S,C%o.N,R%o.N,o.N)}getElevation(d,_,S,C=o.N){return this.getDEMElevation(d,_,S,C)*this.exaggeration}getTerrainData(d){if(!this._emptyDemTexture){const C=this.painter.context,R=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new j(C,R,C.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new j(C,new o.R({width:1,height:1}),C.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(C.gl.NEAREST,C.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ao([])}const _=this.sourceCache.getSourceTile(d,!0);if(_&&_.dem&&(!_.demTexture||_.needsTerrainPrepare)){const C=this.painter.context;_.demTexture=this.painter.getTileTexture(_.dem.stride),_.demTexture?_.demTexture.update(_.dem.getPixels(),{premultiply:!1}):_.demTexture=new j(C,_.dem.getPixels(),C.gl.RGBA,{premultiply:!1}),_.demTexture.bind(C.gl.NEAREST,C.gl.CLAMP_TO_EDGE),_.needsTerrainPrepare=!1}const S=_&&_+_.tileID.key+d.key;if(S&&!this._demMatrixCache[S]){const C=this.sourceCache.sourceCache._source.maxzoom;let R=d.canonical.z-_.tileID.canonical.z;d.overscaledZ>d.canonical.z&&(d.canonical.z>=C?R=d.canonical.z-C:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const N=d.canonical.x-(d.canonical.x>>R<<R),B=d.canonical.y-(d.canonical.y>>R<<R),V=o.bc(new Float64Array(16),[1/(o.N<<R),1/(o.N<<R),0]);o.$(V,V,[N*o.N,B*o.N,0]),this._demMatrixCache[d.key]={matrix:V,coord:d}}return{u_depth:2,u_terrain:3,u_terrain_dim:_&&_.dem&&_.dem.dim||1,u_terrain_matrix:S?this._demMatrixCache[d.key].matrix:this._emptyDemMatrix,u_terrain_unpack:_&&_.dem&&_.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(_&&_.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:_}}getFramebuffer(d){const _=this.painter,S=_.width/devicePixelRatio,C=_.height/devicePixelRatio;return!this._fbo||this._fbo.width===S&&this._fbo.height===C||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new j(_.context,{width:S,height:C,data:null},_.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(_.context.gl.NEAREST,_.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new j(_.context,{width:S,height:C,data:null},_.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(_.context.gl.NEAREST,_.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=_.context.createFramebuffer(S,C,!0,!1),this._fbo.depthAttachment.set(_.context.createRenderbuffer(_.context.gl.DEPTH_COMPONENT16,S,C))),this._fbo.colorAttachment.set(d==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const d=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const _=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let R=0,N=0;R<this._coordsTextureSize;R++)for(let B=0;B<this._coordsTextureSize;B++,N+=4)_[N+0]=255&B,_[N+1]=255&R,_[N+2]=B>>8<<4|R>>8,_[N+3]=0;const S=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(_.buffer)),C=new j(d,S,d.gl.RGBA,{premultiply:!1});return C.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._coordsTexture=C,C}pointCoordinate(d){const _=new Uint8Array(4),S=this.painter.context,C=S.gl;S.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),C.readPixels(d.x,this.painter.height/devicePixelRatio-d.y-1,1,1,C.RGBA,C.UNSIGNED_BYTE,_),S.bindFramebuffer.set(null);const R=_[0]+(_[2]>>4<<8),N=_[1]+((15&_[2])<<8),B=this.coordsIndex[255-_[3]],V=B&&this.sourceCache.getTileByID(B);if(!V)return null;const G=this._coordsTextureSize,Z=(1<<V.tileID.canonical.z)*G;return new o.U(this._allowMercatorOverflow(d,(V.tileID.canonical.x*G+R)/Z),(V.tileID.canonical.y*G+N)/Z,this.getElevation(V.tileID,R,N,G))}getTerrainMesh(){if(this._mesh)return this._mesh;const d=this.painter.context,_=new o.bd,S=new o.b0,C=this.meshSize,R=o.N/C,N=C*C;for(let q=0;q<=C;q++)for(let nt=0;nt<=C;nt++)_.emplaceBack(nt*R,q*R,0);for(let q=0;q<N;q+=C+1)for(let nt=0;nt<C;nt++)S.emplaceBack(nt+q,C+nt+q+1,C+nt+q+2),S.emplaceBack(nt+q,C+nt+q+2,nt+q+1);const B=_.length,V=B+2*(C+1);for(const q of[0,1])for(let nt=0;nt<=C;nt++)for(const vt of[0,1])_.emplaceBack(nt*R,q*o.N,vt);for(let q=0;q<2*C;q+=2)S.emplaceBack(V+q,V+q+1,V+q+3),S.emplaceBack(V+q,V+q+3,V+q+2),S.emplaceBack(B+q,B+q+3,B+q+1),S.emplaceBack(B+q,B+q+2,B+q+3);const G=_.length,Z=G+2*(C+1);for(const q of[0,1])for(let nt=0;nt<=C;nt++)for(const vt of[0,1])_.emplaceBack(q*o.N,nt*R,vt);for(let q=0;q<2*C;q+=2)S.emplaceBack(G+q,G+q+1,G+q+3),S.emplaceBack(G+q,G+q+3,G+q+2),S.emplaceBack(Z+q,Z+q+3,Z+q+1),S.emplaceBack(Z+q,Z+q+2,Z+q+3);return this._mesh={indexBuffer:d.createIndexBuffer(S),vertexBuffer:d.createVertexBuffer(_,x0.members),segments:o.S.simpleSegment(0,0,_.length,S.length)},this._mesh}getMeshFrameDelta(d){return 2*Math.PI*o.be/Math.pow(2,d)/5}getMinTileElevationForLngLatZoom(d,_){var S;const{tileID:C}=this._getOverscaledTileIDFromLngLatZoom(d,_);return(S=this.getMinMaxElevation(C).minElevation)!==null&&S!==void 0?S:0}getMinMaxElevation(d){const _=this.getTerrainData(d).tile,S={minElevation:null,maxElevation:null};return _&&_.dem&&(S.minElevation=_.dem.min*this.exaggeration,S.maxElevation=_.dem.max*this.exaggeration),S}_getOverscaledTileIDFromLngLatZoom(d,_){const S=o.U.fromLngLat(d.wrap()),C=(1<<_)*o.N,R=S.x*C,N=S.y*C,B=Math.floor(R/o.N),V=Math.floor(N/o.N);return{tileID:new o.O(_,0,_,B,V),mercatorX:R,mercatorY:N}}_allowMercatorOverflow(d,_){const S=d.x<this.painter.width/2;let C=o.bf(_);const R=this.painter.transform.center.lng;return S&&Math.sign(C)>0&&Math.sign(R)<0||!S&&Math.sign(C)<0&&Math.sign(R)>0?(C=360*Math.sign(R)+C,o.G(C)):_}}class pT{constructor(d,_,S){this._context=d,this._size=_,this._tileSize=S,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const d of this._objects)d.texture.destroy(),d.fbo.destroy()}_createObject(d){const _=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),S=new j(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return S.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),_.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),_.colorAttachment.set(S.texture),{id:d,fbo:_,texture:S,stamp:-1,inUse:!1}}getObjectForId(d){return this._objects[d]}useObject(d){d.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(_=>d.id!==_),this._recentlyUsed.push(d.id)}stampObject(d){d.stamp=++this._stamp}getOrCreateFreeObject(){for(const _ of this._recentlyUsed)if(!this._objects[_].inUse)return this._objects[_];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const d=this._createObject(this._objects.length);return this._objects.push(d),d}freeObject(d){d.inUse=!1}freeAllObjects(){for(const d of this._objects)this.freeObject(d)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(d=>!d.inUse)===!1}}const Hn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Rd{constructor(d,_){this.painter=d,this.terrain=_,this.pool=new pT(d.context,30,_.sourceCache.tileSize*_.qualityFactor)}destruct(){this.pool.destruct()}getTexture(d){return this.pool.getObjectForId(d.rtt[this._stacks.length-1].id).texture}prepareForRender(d,_){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=d._order.filter(S=>!d._layers[S].isHidden(_)),this._coordsDescendingInv={};for(const S in d.sourceCaches){this._coordsDescendingInv[S]={};const C=d.sourceCaches[S].getVisibleCoordinates();for(const R of C){const N=this.terrain.sourceCache.getTerrainCoords(R);for(const B in N)this._coordsDescendingInv[S][B]||(this._coordsDescendingInv[S][B]=[]),this._coordsDescendingInv[S][B].push(N[B])}}this._coordsDescendingInvStr={};for(const S of d._order){const C=d._layers[S],R=C.source;if(Hn[C.type]&&!this._coordsDescendingInvStr[R]){this._coordsDescendingInvStr[R]={};for(const N in this._coordsDescendingInv[R])this._coordsDescendingInvStr[R][N]=this._coordsDescendingInv[R][N].map(B=>B.key).sort().join()}}for(const S of this._renderableTiles)for(const C in this._coordsDescendingInvStr){const R=this._coordsDescendingInvStr[C][S.tileID.key];R&&R!==S.rttCoords[C]&&(S.rtt=[])}}renderLayer(d){if(d.isHidden(this.painter.transform.zoom))return!1;const _=d.type,S=this.painter,C=this._renderableLayerIds[this._renderableLayerIds.length-1]===d.id;if(Hn[_]&&(this._prevType&&Hn[this._prevType]||this._stacks.push([]),this._prevType=_,this._stacks[this._stacks.length-1].push(d.id),!C))return!0;if(Hn[this._prevType]||Hn[_]&&C){this._prevType=_;const R=this._stacks.length-1,N=this._stacks[R]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&(ki(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[R]){const G=this.pool.getObjectForId(B.rtt[R].id);if(G.stamp===B.rtt[R].stamp){this.pool.useObject(G);continue}}const V=this.pool.getOrCreateFreeObject();this.pool.useObject(V),this.pool.stampObject(V),B.rtt[R]={id:V.id,stamp:V.stamp},S.context.bindFramebuffer.set(V.fbo.framebuffer),S.context.clear({color:o.aT.transparent,stencil:0}),S.currentStencilSource=void 0;for(let G=0;G<N.length;G++){const Z=S.style._layers[N[G]],q=Z.source?this._coordsDescendingInv[Z.source][B.tileID.key]:[B.tileID];S.context.viewport.set([0,0,V.fbo.width,V.fbo.height]),S._renderTileClippingMasks(Z,q),S.renderLayer(S,S.style.sourceCaches[Z.source],Z,q),Z.source&&(B.rttCoords[Z.source]=this._coordsDescendingInvStr[Z.source][B.tileID.key])}}return ki(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Hn[_]}return!1}}const He=l,er={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},dh=I=>{I.touchstart=I.dragStart,I.touchmoveWindow=I.dragMove,I.touchend=I.dragEnd},_v={showCompass:!0,showZoom:!0,visualizePitch:!1};class xv{constructor(d,_,S=!1){this.mousedown=N=>{this.startMouse(o.e({},N,{ctrlKey:!0,preventDefault:()=>N.preventDefault()}),u.mousePos(this.element,N)),u.addEventListener(window,"mousemove",this.mousemove),u.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=N=>{this.moveMouse(N,u.mousePos(this.element,N))},this.mouseup=N=>{this.mouseRotate.dragEnd(N),this.mousePitch&&this.mousePitch.dragEnd(N),this.offTemp()},this.touchstart=N=>{N.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=u.touchPos(this.element,N.targetTouches)[0],this.startTouch(N,this._startPos),u.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),u.addEventListener(window,"touchend",this.touchend))},this.touchmove=N=>{N.targetTouches.length!==1?this.reset():(this._lastPos=u.touchPos(this.element,N.targetTouches)[0],this.moveTouch(N,this._lastPos))},this.touchend=N=>{N.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const C=d.dragRotate._mouseRotate.getClickTolerance(),R=d.dragRotate._mousePitch.getClickTolerance();this.element=_,this.mouseRotate=Lu({clickTolerance:C,enable:!0}),this.touchRotate=(({enable:N,clickTolerance:B,bearingDegreesPerPixelMoved:V=.8})=>{const G=new p0;return new mo({clickTolerance:B,move:(Z,q)=>({bearingDelta:(q.x-Z.x)*V}),moveStateManager:G,enable:N,assignEvents:dh})})({clickTolerance:C,enable:!0}),this.map=d,S&&(this.mousePitch=yo({clickTolerance:R,enable:!0}),this.touchPitch=(({enable:N,clickTolerance:B,pitchDegreesPerPixelMoved:V=-.5})=>{const G=new p0;return new mo({clickTolerance:B,move:(Z,q)=>({pitchDelta:(q.y-Z.y)*V}),moveStateManager:G,enable:N,assignEvents:dh})})({clickTolerance:R,enable:!0})),u.addEventListener(_,"mousedown",this.mousedown),u.addEventListener(_,"touchstart",this.touchstart,{passive:!1}),u.addEventListener(_,"touchcancel",this.reset)}startMouse(d,_){this.mouseRotate.dragStart(d,_),this.mousePitch&&this.mousePitch.dragStart(d,_),u.disableDrag()}startTouch(d,_){this.touchRotate.dragStart(d,_),this.touchPitch&&this.touchPitch.dragStart(d,_),u.disableDrag()}moveMouse(d,_){const S=this.map,{bearingDelta:C}=this.mouseRotate.dragMove(d,_)||{};if(C&&S.setBearing(S.getBearing()+C),this.mousePitch){const{pitchDelta:R}=this.mousePitch.dragMove(d,_)||{};R&&S.setPitch(S.getPitch()+R)}}moveTouch(d,_){const S=this.map,{bearingDelta:C}=this.touchRotate.dragMove(d,_)||{};if(C&&S.setBearing(S.getBearing()+C),this.touchPitch){const{pitchDelta:R}=this.touchPitch.dragMove(d,_)||{};R&&S.setPitch(S.getPitch()+R)}}off(){const d=this.element;u.removeEventListener(d,"mousedown",this.mousedown),u.removeEventListener(d,"touchstart",this.touchstart,{passive:!1}),u.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),u.removeEventListener(window,"touchend",this.touchend),u.removeEventListener(d,"touchcancel",this.reset),this.offTemp()}offTemp(){u.enableDrag(),u.removeEventListener(window,"mousemove",this.mousemove),u.removeEventListener(window,"mouseup",this.mouseup),u.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),u.removeEventListener(window,"touchend",this.touchend)}}let Gi;function bv(I,d,_){if(I=new o.L(I.lng,I.lat),d){const S=new o.L(I.lng-360,I.lat),C=new o.L(I.lng+360,I.lat),R=_.locationPoint(I).distSqr(d);_.locationPoint(S).distSqr(d)<R?I=S:_.locationPoint(C).distSqr(d)<R&&(I=C)}for(;Math.abs(I.lng-_.center.lng)>180;){const S=_.locationPoint(I);if(S.x>=0&&S.y>=0&&S.x<=_.width&&S.y<=_.height)break;I.lng>_.center.lng?I.lng-=360:I.lng+=360}return I}const is={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function S0(I,d,_){const S=I.classList;for(const C in is)S.remove(`maplibregl-${_}-anchor-${C}`);S.add(`maplibregl-${_}-anchor-${d}`)}class Nl extends o.E{constructor(d){if(super(),this._onKeyPress=_=>{const S=_.code,C=_.charCode||_.keyCode;S!=="Space"&&S!=="Enter"&&C!==32&&C!==13||this.togglePopup()},this._onMapClick=_=>{const S=_.originalEvent.target,C=this._element;this._popup&&(S===C||C.contains(S))&&this.togglePopup()},this._update=_=>{if(!this._map)return;const S=this._map.loaded()&&!this._map.isMoving();((_==null?void 0:_.type)==="terrain"||(_==null?void 0:_.type)==="render"&&!S)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=bv(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let C="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?C=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(C=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let R="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?R="rotateX(0deg)":this._pitchAlignment==="map"&&(R=`rotateX(${this._map.getPitch()}deg)`),_&&_.type!=="moveend"||(this._pos=this._pos.round()),u.setTransform(this._element,`${is[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${R} ${C}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const N=this._map.unproject(this._pos),B=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=N.distanceTo(this._lngLat)>20*B?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=_=>{if(!this._isDragging){const S=this._clickTolerance||this._map._clickTolerance;this._isDragging=_.point.dist(this._pointerdownPos)>=S}this._isDragging&&(this._pos=_.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=_=>{this._element.contains(_.originalEvent.target)&&(_.preventDefault(),this._positionDelta=_.point.sub(this._pos).add(this._offset),this._pointerdownPos=_.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=d&&d.anchor||"center",this._color=d&&d.color||"#3FB1CE",this._scale=d&&d.scale||1,this._draggable=d&&d.draggable||!1,this._clickTolerance=d&&d.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=d&&d.rotation||0,this._rotationAlignment=d&&d.rotationAlignment||"auto",this._pitchAlignment=d&&d.pitchAlignment&&d.pitchAlignment!=="auto"?d.pitchAlignment:this._rotationAlignment,d&&d.element)this._element=d.element,this._offset=o.P.convert(d&&d.offset||[0,0]);else{this._defaultMarker=!0,this._element=u.create("div"),this._element.setAttribute("aria-label","Map marker");const _=u.createNS("http://www.w3.org/2000/svg","svg"),S=41,C=27;_.setAttributeNS(null,"display","block"),_.setAttributeNS(null,"height",`${S}px`),_.setAttributeNS(null,"width",`${C}px`),_.setAttributeNS(null,"viewBox",`0 0 ${C} ${S}`);const R=u.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"stroke","none"),R.setAttributeNS(null,"stroke-width","1"),R.setAttributeNS(null,"fill","none"),R.setAttributeNS(null,"fill-rule","evenodd");const N=u.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill-rule","nonzero");const B=u.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");const V=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Pt of V){const $t=u.createNS("http://www.w3.org/2000/svg","ellipse");$t.setAttributeNS(null,"opacity","0.04"),$t.setAttributeNS(null,"cx","10.5"),$t.setAttributeNS(null,"cy","5.80029008"),$t.setAttributeNS(null,"rx",Pt.rx),$t.setAttributeNS(null,"ry",Pt.ry),B.appendChild($t)}const G=u.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"fill",this._color);const Z=u.createNS("http://www.w3.org/2000/svg","path");Z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),G.appendChild(Z);const q=u.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const nt=u.createNS("http://www.w3.org/2000/svg","path");nt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(nt);const vt=u.createNS("http://www.w3.org/2000/svg","g");vt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),vt.setAttributeNS(null,"fill","#FFFFFF");const gt=u.createNS("http://www.w3.org/2000/svg","g");gt.setAttributeNS(null,"transform","translate(8.0, 8.0)");const _t=u.createNS("http://www.w3.org/2000/svg","circle");_t.setAttributeNS(null,"fill","#000000"),_t.setAttributeNS(null,"opacity","0.25"),_t.setAttributeNS(null,"cx","5.5"),_t.setAttributeNS(null,"cy","5.5"),_t.setAttributeNS(null,"r","5.4999962");const dt=u.createNS("http://www.w3.org/2000/svg","circle");dt.setAttributeNS(null,"fill","#FFFFFF"),dt.setAttributeNS(null,"cx","5.5"),dt.setAttributeNS(null,"cy","5.5"),dt.setAttributeNS(null,"r","5.4999962"),gt.appendChild(_t),gt.appendChild(dt),N.appendChild(B),N.appendChild(G),N.appendChild(q),N.appendChild(vt),N.appendChild(gt),_.appendChild(N),_.setAttributeNS(null,"height",S*this._scale+"px"),_.setAttributeNS(null,"width",C*this._scale+"px"),this._element.appendChild(_),this._offset=o.P.convert(d&&d.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()}),S0(this._element,this._anchor,"marker"),d&&d.className)for(const _ of d.className.split(" "))this._element.classList.add(_);this._popup=null}addTo(d){return this.remove(),this._map=d,d.getCanvasContainer().appendChild(this._element),d.on("move",this._update),d.on("moveend",this._update),d.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),u.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=o.L.convert(d),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(d){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),d){if(!("offset"in d.options)){const C=Math.abs(13.5)/Math.SQRT2;d.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[C,-1*(38.1-13.5+C)],"bottom-right":[-C,-1*(38.1-13.5+C)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=d,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const d=this._popup;return d?(d.isOpen()?d.remove():d.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(d){return this._offset=o.P.convert(d),this._update(),this}addClassName(d){this._element.classList.add(d)}removeClassName(d){this._element.classList.remove(d)}toggleClassName(d){return this._element.classList.toggle(d)}setDraggable(d){return this._draggable=!!d,this._map&&(d?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(d){return this._rotation=d||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(d){return this._rotationAlignment=d||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(d){return this._pitchAlignment=d&&d!=="auto"?d:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Oi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ri=0,Ou=!1;const ph={maxWidth:100,unit:"metric"};function gh(I,d,_){const S=_&&_.maxWidth||100,C=I._container.clientHeight/2,R=I.unproject([0,C]),N=I.unproject([S,C]),B=R.distanceTo(N);if(_&&_.unit==="imperial"){const V=3.2808*B;V>5280?Fl(d,S,V/5280,I._getUIString("ScaleControl.Miles")):Fl(d,S,V,I._getUIString("ScaleControl.Feet"))}else _&&_.unit==="nautical"?Fl(d,S,B/1852,I._getUIString("ScaleControl.NauticalMiles")):B>=1e3?Fl(d,S,B/1e3,I._getUIString("ScaleControl.Kilometers")):Fl(d,S,B,I._getUIString("ScaleControl.Meters"))}function Fl(I,d,_,S){const C=function(R){const N=Math.pow(10,`${Math.floor(R)}`.length-1);let B=R/N;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:function(V){const G=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*G)/G}(B),N*B}(_);I.style.width=d*(C/_)+"px",I.innerHTML=`${C}&nbsp;${S}`}const wv={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Sv=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nu(I){if(I){if(typeof I=="number"){const d=Math.round(Math.abs(I)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,I),"top-left":new o.P(d,d),"top-right":new o.P(-d,d),bottom:new o.P(0,-I),"bottom-left":new o.P(d,-d),"bottom-right":new o.P(-d,-d),left:new o.P(I,0),right:new o.P(-I,0)}}if(I instanceof o.P||Array.isArray(I)){const d=o.P.convert(I);return{center:d,top:d,"top-left":d,"top-right":d,bottom:d,"bottom-left":d,"bottom-right":d,left:d,right:d}}return{center:o.P.convert(I.center||[0,0]),top:o.P.convert(I.top||[0,0]),"top-left":o.P.convert(I["top-left"]||[0,0]),"top-right":o.P.convert(I["top-right"]||[0,0]),bottom:o.P.convert(I.bottom||[0,0]),"bottom-left":o.P.convert(I["bottom-left"]||[0,0]),"bottom-right":o.P.convert(I["bottom-right"]||[0,0]),left:o.P.convert(I.left||[0,0]),right:o.P.convert(I.right||[0,0])}}return Nu(new o.P(0,0))}const Tv={extend:(I,...d)=>o.e(I,...d),run(I){I()},logToElement(I,d=!1,_="log"){const S=window.document.getElementById(_);S&&(d&&(S.innerHTML=""),S.innerHTML+=`<br>${I}`)}},Av=l;class Yr{static get version(){return Av}static get workerCount(){return Ya.workerCount}static set workerCount(d){Ya.workerCount=d}static get maxParallelImageRequests(){return o.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(d){o.c.MAX_PARALLEL_IMAGE_REQUESTS=d}static get workerUrl(){return o.c.WORKER_URL}static set workerUrl(d){o.c.WORKER_URL=d}static addProtocol(d,_){o.c.REGISTERED_PROTOCOLS[d]=_}static removeProtocol(d){delete o.c.REGISTERED_PROTOCOLS[d]}}return Yr.Map=class extends _0{constructor(I){if(o.bg.mark(o.bh.create),(I=o.e({},er,I)).minZoom!=null&&I.maxZoom!=null&&I.minZoom>I.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(I.minPitch!=null&&I.maxPitch!=null&&I.minPitch>I.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(I.minPitch!=null&&I.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(I.maxPitch!=null&&I.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Cd(I.minZoom,I.maxZoom,I.minPitch,I.maxPitch,I.renderWorldCopies),{bearingSnap:I.bearingSnap}),this._cooperativeGesturesOnWheel=d=>{this._onCooperativeGesture(d,d[this._metaKey],1)},this._contextLost=d=>{d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.k("webglcontextlost",{originalEvent:d}))},this._contextRestored=d=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:d}))},this._onMapScroll=d=>{if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=I.interactive,this._cooperativeGestures=I.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=I.maxTileCacheSize,this._maxTileCacheZoomLevels=I.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=I.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=I.preserveDrawingBuffer,this._antialias=I.antialias,this._trackResize=I.trackResize,this._bearingSnap=I.bearingSnap,this._refreshExpiredTiles=I.refreshExpiredTiles,this._fadeDuration=I.fadeDuration,this._crossSourceCollisions=I.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=I.collectResourceTiming,this._renderTaskQueue=new Pd,this._controls=[],this._mapId=o.a2(),this._locale=o.e({},yv,I.locale),this._clickTolerance=I.clickTolerance,this._overridePixelRatio=I.pixelRatio,this._maxCanvasSize=I.maxCanvasSize,this.transformCameraUpdate=I.transformCameraUpdate,this._imageQueueHandle=w.addThrottleControl(()=>this.isMoving()),this._requestManager=new E(I.transformRequest),typeof I.container=="string"){if(this._container=document.getElementById(I.container),!this._container)throw new Error(`Container '${I.container}' not found.`)}else{if(!(I.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=I.container}if(I.maxBounds&&this.setMaxBounds(I.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let d=!1;const _=Ol(S=>{this._trackResize&&!this._removed&&this.resize(S)._update()},50);this._resizeObserver=new ResizeObserver(S=>{d?_(S):d=!0}),this._resizeObserver.observe(this._container)}this.handlers=new mv(this,I),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=I.hash&&new lh(typeof I.hash=="string"&&I.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:I.center,zoom:I.zoom,bearing:I.bearing,pitch:I.pitch}),I.bounds&&(this.resize(),this.fitBounds(I.bounds,o.e({},I.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=I.localIdeographFontFamily,this._validateStyle=I.validateStyle,I.style&&this.setStyle(I.style,{localIdeographFontFamily:I.localIdeographFontFamily}),I.attributionControl&&this.addControl(new Da({customAttribution:I.customAttribution})),I.maplibreLogo&&this.addControl(new gi,I.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new o.k(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new o.k(`${d.dataType}dataloading`,d))}),this.on("dataabort",d=>{this.fire(new o.k("sourcedataabort",d))})}_getMapId(){return this._mapId}addControl(I,d){if(d===void 0&&(d=I.getDefaultPosition?I.getDefaultPosition():"top-right"),!I||!I.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const _=I.onAdd(this);this._controls.push(I);const S=this._controlPositions[d];return d.indexOf("bottom")!==-1?S.insertBefore(_,S.firstChild):S.appendChild(_),this}removeControl(I){if(!I||!I.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const d=this._controls.indexOf(I);return d>-1&&this._controls.splice(d,1),I.onRemove(this),this}hasControl(I){return this._controls.indexOf(I)>-1}calculateCameraOptionsFromTo(I,d,_,S){return S==null&&this.terrain&&(S=this.terrain.getElevationForLngLatZoom(_,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(I,d,_,S)}resize(I){var d;const _=this._containerDimensions(),S=_[0],C=_[1],R=this._getClampedPixelRatio(S,C);if(this._resizeCanvas(S,C,R),this.painter.resize(S,C,R),this.painter.overLimit()){const B=this.painter.context.gl;this._maxCanvasSize=[B.drawingBufferWidth,B.drawingBufferHeight];const V=this._getClampedPixelRatio(S,C);this._resizeCanvas(S,C,V),this.painter.resize(S,C,V)}this.transform.resize(S,C),(d=this._requestedCameraState)===null||d===void 0||d.resize(S,C);const N=!this._moving;return N&&(this.stop(),this.fire(new o.k("movestart",I)).fire(new o.k("move",I))),this.fire(new o.k("resize",I)),N&&this.fire(new o.k("moveend",I)),this}_getClampedPixelRatio(I,d){const{0:_,1:S}=this._maxCanvasSize,C=this.getPixelRatio(),R=I*C,N=d*C;return Math.min(R>_?_/R:1,N>S?S/N:1)*C}getPixelRatio(){var I;return(I=this._overridePixelRatio)!==null&&I!==void 0?I:devicePixelRatio}setPixelRatio(I){this._overridePixelRatio=I,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(I){return this.transform.setMaxBounds(ce.convert(I)),this._update()}setMinZoom(I){if((I=I??-2)>=-2&&I<=this.transform.maxZoom)return this.transform.minZoom=I,this._update(),this.getZoom()<I&&this.setZoom(I),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(I){if((I=I??22)>=this.transform.minZoom)return this.transform.maxZoom=I,this._update(),this.getZoom()>I&&this.setZoom(I),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(I){if((I=I??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(I>=0&&I<=this.transform.maxPitch)return this.transform.minPitch=I,this._update(),this.getPitch()<I&&this.setPitch(I),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(I){if((I=I??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(I>=this.transform.minPitch)return this.transform.maxPitch=I,this._update(),this.getPitch()>I&&this.setPitch(I),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(I){return this.transform.renderWorldCopies=I,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(I){return this._cooperativeGestures=I,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(I){return this.transform.locationPoint(o.L.convert(I),this.style&&this.terrain)}unproject(I){return this.transform.pointLocation(o.P.convert(I),this.terrain)}isMoving(){var I;return this._moving||((I=this.handlers)===null||I===void 0?void 0:I.isMoving())}isZooming(){var I;return this._zooming||((I=this.handlers)===null||I===void 0?void 0:I.isZooming())}isRotating(){var I;return this._rotating||((I=this.handlers)===null||I===void 0?void 0:I.isRotating())}_createDelegatedListener(I,d,_){if(I==="mouseenter"||I==="mouseover"){let S=!1;return{layer:d,listener:_,delegates:{mousemove:R=>{const N=this.getLayer(d)?this.queryRenderedFeatures(R.point,{layers:[d]}):[];N.length?S||(S=!0,_.call(this,new Ra(I,this,R.originalEvent,{features:N}))):S=!1},mouseout:()=>{S=!1}}}}if(I==="mouseleave"||I==="mouseout"){let S=!1;return{layer:d,listener:_,delegates:{mousemove:N=>{(this.getLayer(d)?this.queryRenderedFeatures(N.point,{layers:[d]}):[]).length?S=!0:S&&(S=!1,_.call(this,new Ra(I,this,N.originalEvent)))},mouseout:N=>{S&&(S=!1,_.call(this,new Ra(I,this,N.originalEvent)))}}}}{const S=C=>{const R=this.getLayer(d)?this.queryRenderedFeatures(C.point,{layers:[d]}):[];R.length&&(C.features=R,_.call(this,C),delete C.features)};return{layer:d,listener:_,delegates:{[I]:S}}}}on(I,d,_){if(_===void 0)return super.on(I,d);const S=this._createDelegatedListener(I,d,_);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[I]=this._delegatedListeners[I]||[],this._delegatedListeners[I].push(S);for(const C in S.delegates)this.on(C,S.delegates[C]);return this}once(I,d,_){if(_===void 0)return super.once(I,d);const S=this._createDelegatedListener(I,d,_);for(const C in S.delegates)this.once(C,S.delegates[C]);return this}off(I,d,_){return _===void 0?super.off(I,d):(this._delegatedListeners&&this._delegatedListeners[I]&&(S=>{const C=this._delegatedListeners[I];for(let R=0;R<C.length;R++){const N=C[R];if(N.layer===d&&N.listener===_){for(const B in N.delegates)this.off(B,N.delegates[B]);return C.splice(R,1),this}}})(),this)}queryRenderedFeatures(I,d){if(!this.style)return[];let _;const S=I instanceof o.P||Array.isArray(I),C=S?I:[[0,0],[this.transform.width,this.transform.height]];if(d=d||(S?{}:I)||{},C instanceof o.P||typeof C[0]=="number")_=[o.P.convert(C)];else{const R=o.P.convert(C[0]),N=o.P.convert(C[1]);_=[R,new o.P(N.x,R.y),N,new o.P(R.x,N.y),R]}return this.style.queryRenderedFeatures(_,d,this.transform)}querySourceFeatures(I,d){return this.style.querySourceFeatures(I,d)}setStyle(I,d){return(d=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},d)).diff!==!1&&d.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&I?(this._diffStyle(I,d),this):(this._localIdeographFontFamily=d.localIdeographFontFamily,this._updateStyle(I,d))}setTransformRequest(I){return this._requestManager.setTransformRequest(I),this}_getUIString(I){const d=this._locale[I];if(d==null)throw new Error(`Missing UI string '${I}'`);return d}_updateStyle(I,d){if(d.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(I,d));const _=this.style&&d.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!I)),I?(this.style=new ii(this,d||{}),this.style.setEventedParent(this,{style:this.style}),typeof I=="string"?this.style.loadURL(I,d,_):this.style.loadJSON(I,d,_),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ii(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(I,d){if(typeof I=="string"){const _=this._requestManager.transformRequest(I,T.Style);o.f(_,(S,C)=>{S?this.fire(new o.j(S)):C&&this._updateDiff(C,d)})}else typeof I=="object"&&this._updateDiff(I,d)}_updateDiff(I,d){try{this.style.setState(I,d)&&this._update(!0)}catch(_){o.w(`Unable to perform style diff: ${_.message||_.error||_}.  Rebuilding the style from scratch.`),this._updateStyle(I,d)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(I,d){return this._lazyInitEmptyStyle(),this.style.addSource(I,d),this._update(!0)}isSourceLoaded(I){const d=this.style&&this.style.sourceCaches[I];if(d!==void 0)return d.loaded();this.fire(new o.j(new Error(`There is no source with ID '${I}'`)))}setTerrain(I){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),I){const d=this.style.sourceCaches[I.source];if(!d)throw new Error(`cannot load terrain, because there exists no source with ID: ${I.source}`);for(const _ in this.style._layers){const S=this.style._layers[_];S.type==="hillshade"&&S.source===I.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new w0(this.painter,d,I),this.painter.renderToTexture=new Rd(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=_=>{_.dataType==="style"?this.terrain.sourceCache.freeRtt():_.dataType==="source"&&_.tile&&(_.sourceId!==I.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(_.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:I})),this}getTerrain(){var I,d;return(d=(I=this.terrain)===null||I===void 0?void 0:I.options)!==null&&d!==void 0?d:null}areTilesLoaded(){const I=this.style&&this.style.sourceCaches;for(const d in I){const _=I[d]._tiles;for(const S in _){const C=_[S];if(C.state!=="loaded"&&C.state!=="errored")return!1}}return!0}addSourceType(I,d,_){return this._lazyInitEmptyStyle(),this.style.addSourceType(I,d,_)}removeSource(I){return this.style.removeSource(I),this._update(!0)}getSource(I){return this.style.getSource(I)}addImage(I,d,_={}){const{pixelRatio:S=1,sdf:C=!1,stretchX:R,stretchY:N,content:B}=_;if(this._lazyInitEmptyStyle(),!(d instanceof HTMLImageElement||o.a(d))){if(d.width===void 0||d.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:V,height:G,data:Z}=d,q=d;return this.style.addImage(I,{data:new o.R({width:V,height:G},new Uint8Array(Z)),pixelRatio:S,stretchX:R,stretchY:N,content:B,sdf:C,version:0,userImage:q}),q.onAdd&&q.onAdd(this,I),this}}{const{width:V,height:G,data:Z}=o.h.getImageData(d);this.style.addImage(I,{data:new o.R({width:V,height:G},Z),pixelRatio:S,stretchX:R,stretchY:N,content:B,sdf:C,version:0})}}updateImage(I,d){const _=this.style.getImage(I);if(!_)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const S=d instanceof HTMLImageElement||o.a(d)?o.h.getImageData(d):d,{width:C,height:R,data:N}=S;if(C===void 0||R===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(C!==_.data.width||R!==_.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const B=!(d instanceof HTMLImageElement||o.a(d));return _.data.replace(N,B),this.style.updateImage(I,_),this}getImage(I){return this.style.getImage(I)}hasImage(I){return I?!!this.style.getImage(I):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(I){this.style.removeImage(I)}loadImage(I,d){w.getImage(this._requestManager.transformRequest(I,T.Image),d)}listImages(){return this.style.listImages()}addLayer(I,d){return this._lazyInitEmptyStyle(),this.style.addLayer(I,d),this._update(!0)}moveLayer(I,d){return this.style.moveLayer(I,d),this._update(!0)}removeLayer(I){return this.style.removeLayer(I),this._update(!0)}getLayer(I){return this.style.getLayer(I)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(I,d,_){return this.style.setLayerZoomRange(I,d,_),this._update(!0)}setFilter(I,d,_={}){return this.style.setFilter(I,d,_),this._update(!0)}getFilter(I){return this.style.getFilter(I)}setPaintProperty(I,d,_,S={}){return this.style.setPaintProperty(I,d,_,S),this._update(!0)}getPaintProperty(I,d){return this.style.getPaintProperty(I,d)}setLayoutProperty(I,d,_,S={}){return this.style.setLayoutProperty(I,d,_,S),this._update(!0)}getLayoutProperty(I,d){return this.style.getLayoutProperty(I,d)}setGlyphs(I,d={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(I,d),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(I,d,_={}){return this._lazyInitEmptyStyle(),this.style.addSprite(I,d,_,S=>{S||this._update(!0)}),this}removeSprite(I){return this._lazyInitEmptyStyle(),this.style.removeSprite(I),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(I,d={}){return this._lazyInitEmptyStyle(),this.style.setSprite(I,d,_=>{_||this._update(!0)}),this}setLight(I,d={}){return this._lazyInitEmptyStyle(),this.style.setLight(I,d),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(I,d){return this.style.setFeatureState(I,d),this._update()}removeFeatureState(I,d){return this.style.removeFeatureState(I,d),this._update()}getFeatureState(I){return this.style.getFeatureState(I)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let I=0,d=0;return this._container&&(I=this._container.clientWidth||400,d=this._container.clientHeight||300),[I,d]}_setupContainer(){const I=this._container;I.classList.add("maplibregl-map");const d=this._canvasContainer=u.create("div","maplibregl-canvas-container",I);this._interactive&&d.classList.add("maplibregl-interactive"),this._canvas=u.create("canvas","maplibregl-canvas",d),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const _=this._containerDimensions(),S=this._getClampedPixelRatio(_[0],_[1]);this._resizeCanvas(_[0],_[1],S);const C=this._controlContainer=u.create("div","maplibregl-control-container",I),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(N=>{R[N]=u.create("div",`maplibregl-ctrl-${N} `,C)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=u.create("div","maplibregl-cooperative-gesture-screen",this._container);let I=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(I=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${I}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){u.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(I,d,_){this._canvas.width=Math.floor(_*I),this._canvas.height=Math.floor(_*d),this._canvas.style.width=`${I}px`,this._canvas.style.height=`${d}px`}_setupPainter(){const I={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let d=null;this._canvas.addEventListener("webglcontextcreationerror",S=>{d={requestedAttributes:I},S&&(d.statusMessage=S.statusMessage,d.type=S.type)},{once:!0});const _=this._canvas.getContext("webgl2",I)||this._canvas.getContext("webgl",I);if(!_){const S="Failed to initialize WebGL";throw d?(d.message=S,new Error(JSON.stringify(d))):new Error(S)}this.painter=new kl(_,this.transform),c.testSupport(_)}_onCooperativeGesture(I,d,_){return!d&&_<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(I){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||I,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(I){return this._update(),this._renderTaskQueue.add(I)}_cancelRenderFrame(I){this._renderTaskQueue.remove(I)}_render(I){const d=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(I),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,R=o.h.now();this.style.zoomHistory.update(C,R);const N=new o.a8(C,{now:R,fadeDuration:d,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),B=N.crossFadingFactor();B===1&&B===this._crossFadingFactor||(_=!0,this._crossFadingFactor=B),this.style.update(N)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,d,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:d,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bg.mark(o.bh.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const S=this._sourcesDirty||this._styleDirty||this._placementDirty;return S||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,o.bg.mark(o.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var I;this._hash&&this._hash.remove();for(const _ of this._controls)_.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),w.removeThrottleControl(this._imageQueueHandle),(I=this._resizeObserver)===null||I===void 0||I.disconnect();const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),u.remove(this._canvasContainer),u.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.bg.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.h.frame(I=>{o.bg.frame(I),this._frame=null,this._render(I)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(I){this._showTileBoundaries!==I&&(this._showTileBoundaries=I,this._update())}get showPadding(){return!!this._showPadding}set showPadding(I){this._showPadding!==I&&(this._showPadding=I,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(I){this._showCollisionBoxes!==I&&(this._showCollisionBoxes=I,I?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(I){this._showOverdrawInspector!==I&&(this._showOverdrawInspector=I,this._update())}get repaint(){return!!this._repaint}set repaint(I){this._repaint!==I&&(this._repaint=I,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(I){this._vertices=I,this._update()}get version(){return He}getCameraTargetElevation(){return this.transform.elevation}},Yr.NavigationControl=class{constructor(I){this._updateZoomButtons=()=>{const d=this._map.getZoom(),_=d===this._map.getMaxZoom(),S=d===this._map.getMinZoom();this._zoomInButton.disabled=_,this._zoomOutButton.disabled=S,this._zoomInButton.setAttribute("aria-disabled",_.toString()),this._zoomOutButton.setAttribute("aria-disabled",S.toString())},this._rotateCompassArrow=()=>{const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=d},this._setButtonTitle=(d,_)=>{const S=this._map._getUIString(`NavigationControl.${_}`);d.title=S,d.setAttribute("aria-label",S)},this.options=o.e({},_v,I),this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",d=>d.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",d=>this._map.zoomIn({},{originalEvent:d})),u.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",d=>this._map.zoomOut({},{originalEvent:d})),u.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",d=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:d}):this._map.resetNorth({},{originalEvent:d})}),this._compassIcon=u.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(I){return this._map=I,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xv(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){u.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(I,d){const _=u.create("button",I,this._container);return _.type="button",_.addEventListener("click",d),_}},Yr.GeolocateControl=class extends o.E{constructor(I){super(),this._onSuccess=d=>{if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",d)),this._finish()}},this._updateCamera=d=>{const _=new o.L(d.coords.longitude,d.coords.latitude),S=d.coords.accuracy,C=this._map.getBearing(),R=o.e({bearing:C},this.options.fitBoundsOptions),N=ce.fromLngLat(_,S);this._map.fitBounds(N,R,{geolocateSource:!0})},this._updateMarker=d=>{if(d){const _=new o.L(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(_).addTo(this._map),this._userLocationDotMarker.setLngLat(_).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=d=>{if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const _=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=_,this._geolocateButton.setAttribute("aria-label",_),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&Ou)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",d)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=d=>{if(this._map){if(this._container.addEventListener("contextmenu",_=>_.preventDefault()),this._geolocateButton=u.create("button","maplibregl-ctrl-geolocate",this._container),u.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const _=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=_,this._geolocateButton.setAttribute("aria-label",_)}else{const _=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=_,this._geolocateButton.setAttribute("aria-label",_)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=u.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Nl({element:this._dotElement}),this._circleElement=u.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",_=>{_.geolocateSource||this._watchState!=="ACTIVE_LOCK"||_.originalEvent&&_.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},Oi,I)}onAdd(I){return this._map=I,this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(d,_=!1){Gi===void 0||_?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(S=>{Gi=S.state!=="denied",d(Gi)}).catch(()=>{Gi=!!window.navigator.geolocation,d(Gi)}):(Gi=!!window.navigator.geolocation,d(Gi)):d(Gi)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),u.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ri=0,Ou=!1}_isOutOfMapMaxBounds(I){const d=this._map.getMaxBounds(),_=I.coords;return d&&(_.longitude<d.getWest()||_.longitude>d.getEast()||_.latitude<d.getSouth()||_.latitude>d.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const I=this._map.getBounds(),d=I.getSouthEast(),_=I.getNorthEast(),S=d.distanceTo(_),C=Math.ceil(this._accuracy/(S/this._map._container.clientHeight)*2);this._circleElement.style.width=`${C}px`,this._circleElement.style.height=`${C}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ri--,Ou=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let I;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ri++,Ri>1?(I={maximumAge:6e5,timeout:0},Ou=!0):(I=this.options.positionOptions,Ou=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,I)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Yr.AttributionControl=Da,Yr.LogoControl=gi,Yr.ScaleControl=class{constructor(I){this._onMove=()=>{gh(this._map,this._container,this.options)},this.setUnit=d=>{this.options.unit=d,gh(this._map,this._container,this.options)},this.options=o.e({},ph,I)}getDefaultPosition(){return"bottom-left"}onAdd(I){return this._map=I,this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-scale",I.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){u.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Yr.FullscreenControl=class extends o.E{constructor(I={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,I&&I.container&&(I.container instanceof HTMLElement?this._container=I.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(I){return this._map=I,this._container||(this._container=this._map.getContainer()),this._controlContainer=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){u.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const I=this._fullscreenButton=u.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);u.create("span","maplibregl-ctrl-icon",I).setAttribute("aria-hidden","true"),I.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const I=this._getTitle();this._fullscreenButton.setAttribute("aria-label",I),this._fullscreenButton.title=I}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Yr.TerrainControl=class{constructor(I){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=I}onAdd(I){return this._map=I,this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=u.create("button","maplibregl-ctrl-terrain",this._container),u.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){u.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Yr.Popup=class extends o.E{constructor(I){super(),this.remove=()=>(this._content&&u.remove(this._content),this._container&&(u.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.k("close")),this),this._onMouseUp=d=>{this._update(d.point)},this._onMouseMove=d=>{this._update(d.point)},this._onDrag=d=>{this._update(d.point)},this._update=d=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=u.create("div","maplibregl-popup",this._map.getContainer()),this._tip=u.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const N of this.options.className.split(" "))this._container.classList.add(N);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=bv(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!d)return;const _=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat);let S=this.options.anchor;const C=Nu(this.options.offset);if(!S){const N=this._container.offsetWidth,B=this._container.offsetHeight;let V;V=_.y+C.bottom.y<B?["top"]:_.y>this._map.transform.height-B?["bottom"]:[],_.x<N/2?V.push("left"):_.x>this._map.transform.width-N/2&&V.push("right"),S=V.length===0?"bottom":V.join("-")}const R=_.add(C[S]).round();u.setTransform(this._container,`${is[S]} translate(${R.x}px,${R.y}px)`),S0(this._container,S,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(wv),I)}addTo(I){return this._map&&this.remove(),this._map=I,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(I){return this._lngLat=o.L.convert(I),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(I){return this.setDOMContent(document.createTextNode(I))}setHTML(I){const d=document.createDocumentFragment(),_=document.createElement("body");let S;for(_.innerHTML=I;S=_.firstChild,S;)d.appendChild(S);return this.setDOMContent(d)}getMaxWidth(){var I;return(I=this._container)===null||I===void 0?void 0:I.style.maxWidth}setMaxWidth(I){return this.options.maxWidth=I,this._update(),this}setDOMContent(I){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=u.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(I),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(I){this._container&&this._container.classList.add(I)}removeClassName(I){this._container&&this._container.classList.remove(I)}setOffset(I){return this.options.offset=I,this._update(),this}toggleClassName(I){if(this._container)return this._container.classList.toggle(I)}_createCloseButton(){this.options.closeButton&&(this._closeButton=u.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const I=this._container.querySelector(Sv);I&&I.focus()}},Yr.Marker=Nl,Yr.Style=ii,Yr.LngLat=o.L,Yr.LngLatBounds=ce,Yr.Point=o.P,Yr.MercatorCoordinate=o.U,Yr.Evented=o.E,Yr.AJAXError=o.bi,Yr.config=o.c,Yr.CanvasSource=Fe,Yr.GeoJSONSource=Ce,Yr.ImageSource=Ie,Yr.RasterDEMTileSource=ke,Yr.RasterTileSource=sr,Yr.VectorTileSource=Qe,Yr.VideoSource=Se,Yr.setRTLTextPlugin=o.bj,Yr.getRTLTextPluginStatus=o.bk,Yr.prewarm=function(){Ml().acquire($r)},Yr.clearPrewarmedResources=function(){const I=Ka;I&&(I.isPreloaded()&&I.numActive()===1?(I.release($r),Ka=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Tv.extend(Yr,{isSafari:o.ac,getPerformanceMetrics:o.bg.getPerformanceMetrics}),Yr});var s=n;return s})})(NU);var rK=NU.exports;const iK=Kw(rK);function lb(r,t){if(!r)throw new Error(t||"loader assertion failed.")}const mP=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),v3=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);v3&&parseFloat(v3[1]);const X0=globalThis,Wd=globalThis.process||{},nK=globalThis.navigator||{};function BU(r){var i,n;if(typeof window<"u"&&((i=window.process)==null?void 0:i.type)==="renderer"||typeof process<"u"&&((n=process.versions)!=null&&n.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent,e=r||t;return!!(e&&e.indexOf("Electron")>=0)}function qc(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||BU()}function aK(r){return!r&&!qc()?"Node":BU(r)?"Electron":(r||nK.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const zU="4.0.7";function sK(r){try{const t=window[r],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class oK{constructor(t,e,i="sessionStorage"){this.storage=sK(i),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function lK(r){let t;return r<10?t=`${r.toFixed(2)}ms`:r<100?t=`${r.toFixed(1)}ms`:r<1e3?t=`${r.toFixed(0)}ms`:t=`${(r/1e3).toFixed(2)}s`,t}function uK(r,t=8){const e=Math.max(t-r.length,0);return`${" ".repeat(e)}${r}`}var ub;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(ub||(ub={}));const cK=10;function m3(r){return typeof r!="string"?r:(r=r.toUpperCase(),ub[r]||ub.WHITE)}function hK(r,t,e){return!qc&&typeof r=="string"&&(t&&(r=`\x1B[${m3(t)}m${r}\x1B[39m`),e&&(r=`\x1B[${m3(e)+cK}m${r}\x1B[49m`)),r}function fK(r,t=["constructor"]){const e=Object.getPrototypeOf(r),i=Object.getOwnPropertyNames(e),n=r;for(const a of i){const s=n[a];typeof s=="function"&&(t.find(o=>a===o)||(n[a]=s.bind(r)))}}function yP(r,t){if(!r)throw new Error(t||"Assertion failed")}function Hd(){var t,e,i;let r;if(qc()&&X0.performance)r=(e=(t=X0==null?void 0:X0.performance)==null?void 0:t.now)==null?void 0:e.call(t);else if("hrtime"in Wd){const n=(i=Wd==null?void 0:Wd.hrtime)==null?void 0:i.call(Wd);r=n[0]*1e3+n[1]/1e6}else r=Date.now();return r}const Gd={debug:qc()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},dK={enabled:!0,level:0};function jd(){}const y3={},_3={once:!0};class d_{constructor({id:t}={id:""}){this.VERSION=zU,this._startTs=Hd(),this._deltaTs=Hd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new oK(`__probe-${this.id}__`,dK),this.timeStamp(`${this.id} started`),fK(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Hd()-this._startTs).toPrecision(10))}getDelta(){return Number((Hd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,Gd.warn,arguments,_3)}error(t){return this._getLogFunction(0,t,Gd.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,Gd.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Gd.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,Gd.debug||Gd.info,arguments,_3)}table(t,e,i){return e?this._getLogFunction(t,e,console.table||jd,i&&[i],{tag:gK(e)}):jd}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||jd)}group(t,e,i={collapsed:!1}){const n=x3({logLevel:t,message:e,opts:i}),{collapsed:a}=i;return n.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(t,e,i={}){return this.group(t,e,Object.assign({},i,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||jd)}withGroup(t,e,i){this.group(t,e)();try{i()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=VU(t)}_getLogFunction(t,e,i,n,a){if(this._shouldLog(t)){a=x3({logLevel:t,message:e,args:n,opts:a}),i=i||a.method,yP(i),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=Hd();const s=a.tag||a.message;if(a.once&&s)if(!y3[s])y3[s]=Hd();else return jd;return e=pK(this.id,a.message,a),i.bind(console,e,...a.args)}return jd}}d_.VERSION=zU;function VU(r){if(!r)return 0;let t;switch(typeof r){case"number":t=r;break;case"object":t=r.logLevel||r.priority||0;break;default:return 0}return yP(Number.isFinite(t)&&t>=0),t}function x3(r){const{logLevel:t,message:e}=r;r.logLevel=VU(t);const i=r.args?Array.from(r.args):[];for(;i.length&&i.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&i.unshift(e),r.message=t;break;case"object":Object.assign(r,t);break}typeof r.message=="function"&&(r.message=r.message());const n=typeof r.message;return yP(n==="string"||n==="object"),Object.assign(r,{args:i},r.opts)}function pK(r,t,e){if(typeof t=="string"){const i=e.time?uK(lK(e.total)):"";t=e.time?`${r}: ${i}  ${t}`:`${r}: ${t}`,t=hK(t,e.color,e.background)}return t}function gK(r){for(const t in r)for(const e in r[t])return e||"untitled";return"empty"}const aA="4.3.1",vK=aA[0]>="0"&&aA[0]<="9"?`v${aA}`:"";function mK(){const r=new d_({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=r,globalThis.loaders.version=vK,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=r,r}const UU=mK();function yK(r,t){return $U(r||{},t)}function $U(r,t,e=0){if(e>3)return t;const i={...r};for(const[n,a]of Object.entries(t))a&&typeof a=="object"&&!Array.isArray(a)?i[n]=$U(i[n]||{},t[n],e+1):i[n]=t[n];return i}const _K="latest";function xK(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const bK=xK();function Nc(r,t){if(!r)throw new Error(t||"loaders.gl assertion failed.")}const bf=typeof process!="object"||String(process)!=="[object process]"||process.browser,wK=typeof window<"u"&&typeof window.orientation<"u",b3=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);b3&&parseFloat(b3[1]);class SK{constructor(t,e){st(this,"name");st(this,"workerThread");st(this,"isRunning",!0);st(this,"result");st(this,"_resolve",()=>{});st(this,"_reject",()=>{});this.name=t,this.workerThread=e,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){Nc(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Nc(this.isRunning),this.isRunning=!1,this._reject(t)}}class sA{terminate(){}}const oA=new Map;function TK(r){Nc(r.source&&!r.url||!r.source&&r.url);let t=oA.get(r.source||r.url);return t||(r.url&&(t=AK(r.url),oA.set(r.url,t)),r.source&&(t=WU(r.source),oA.set(r.source,t))),Nc(t),t}function AK(r){if(!r.startsWith("http"))return r;const t=CK(r);return WU(t)}function WU(r){const t=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(t)}function CK(r){return`try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`}function HU(r,t=!0,e){const i=e||new Set;if(r){if(w3(r))i.add(r);else if(w3(r.buffer))i.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(t&&typeof r=="object")for(const n in r)HU(r[n],t,i)}}return e===void 0?Array.from(i):[]}function w3(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const lA=()=>{};class wE{constructor(t){st(this,"name");st(this,"source");st(this,"url");st(this,"terminated",!1);st(this,"worker");st(this,"onMessage");st(this,"onError");st(this,"_loadableURL","");const{name:e,source:i,url:n}=t;Nc(i||n),this.name=e,this.source=i,this.url=n,this.onMessage=lA,this.onError=a=>console.log(a),this.worker=bf?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&bf||typeof sA<"u"&&!bf}destroy(){this.onMessage=lA,this.onError=lA,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||HU(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=TK({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new sA(i,{eval:!1})}else if(this.source)t=new sA(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class EK{constructor(t){st(this,"name","unnamed");st(this,"source");st(this,"url");st(this,"maxConcurrency",1);st(this,"maxMobileConcurrency",1);st(this,"onDebug",()=>{});st(this,"reuseWorkers",!0);st(this,"props",{});st(this,"jobQueue",[]);st(this,"idleQueue",[]);st(this,"count",0);st(this,"isDestroyed",!1);this.source=t.source,this.url=t.url,this.setProps(t)}static isSupported(){return wE.isSupported()}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,e=(n,a,s)=>n.done(s),i=(n,a)=>n.error(a)){const n=new Promise(a=>(this.jobQueue.push({name:t,onMessage:e,onError:i,onStart:a}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const i=new SK(e.name,t);t.onMessage=n=>e.onMessage(i,n.type,n.payload),t.onError=n=>e.onError(i,n),e.onStart(i);try{await i.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!bf||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new wE({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return wK?this.maxMobileConcurrency:this.maxConcurrency}}const IK={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},hc=class hc{constructor(t){st(this,"props");st(this,"workerPools",new Map);this.props={...IK},this.setProps(t),this.workerPools=new Map}static isSupported(){return wE.isSupported()}static getWorkerFarm(t={}){return hc._workerFarm=hc._workerFarm||new hc({}),hc._workerFarm.setProps(t),hc._workerFarm}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:i,url:n}=t;let a=this.workerPools.get(e);return a||(a=new EK({name:e,source:i,url:n}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};st(hc,"_workerFarm");let cb=hc;function MK(r,t={}){const e=t[r.id]||{},i=bf?`${r.id}-worker.js`:`${r.id}-worker-node.js`;let n=e.workerUrl;if(!n&&r.id==="compression"&&(n=t.workerUrl),t._workerType==="test"&&(bf?n=`modules/${r.module}/dist/${i}`:n=`modules/${r.module}/src/workers/${r.id}-worker-node.ts`),!n){let a=r.version;a==="latest"&&(a=_K);const s=a?`@${a}`:"";n=`https://unpkg.com/@loaders.gl/${r.module}${s}/dist/${i}`}return Nc(n),n}function PK(r,t=bK){Nc(r,"no worker provided");const e=r.version;return!(!t||!e)}function RK(r,t){return!cb.isSupported()||!bf&&!(t!=null&&t._nodeWorkers)?!1:r.worker&&(t==null?void 0:t.worker)}async function DK(r,t,e,i,n){const a=r.id,s=MK(r,e),l=cb.getWorkerFarm(e).getWorkerPool({name:a,url:s});e=JSON.parse(JSON.stringify(e)),i=JSON.parse(JSON.stringify(i||{}));const u=await l.startJob("process-on-worker",LK.bind(null,n));return u.postMessage("process",{input:t,options:e,context:i}),await(await u.result).result}async function LK(r,t,e,i){switch(e){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:n,input:a,options:s}=i;try{const o=await r(a,s);t.postMessage("done",{id:n,result:o})}catch(o){const l=o instanceof Error?o.message:"unknown error";t.postMessage("error",{id:n,error:l})}break;default:console.warn(`parse-with-worker unknown message ${e}`)}}function kK(r,t,e){if(e=e||r.byteLength,r.byteLength<e||t.byteLength<e)return!1;const i=new Uint8Array(r),n=new Uint8Array(t);for(let a=0;a<i.length;++a)if(i[a]!==n[a])return!1;return!0}function OK(...r){return NK(r)}function NK(r){const t=r.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),e=t.reduce((a,s)=>a+s.byteLength,0),i=new Uint8Array(e);let n=0;for(const a of t)i.set(a,n),n+=a.byteLength;return i.buffer}async function FK(r){const t=[];for await(const e of r)t.push(e);return OK(...t)}function S3(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();r=t[0]*1e3+t[1]/1e6}else r=Date.now();return r}class T3{constructor(t,e){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=S3(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(S3()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class p_{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,e="count"){return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:i}=t;let n=this.stats[e];return n||(t instanceof T3?n=t:n=new T3(e,i),this.stats[e]=n),n}}const BK="Queued Requests",zK="Active Requests",VK="Cancelled Requests",UK="Queued Requests Ever",$K="Active Requests Ever",WK={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class HK{constructor(t={}){st(this,"props");st(this,"stats");st(this,"activeRequestCount",0);st(this,"requestQueue",[]);st(this,"requestMap",new Map);st(this,"updateTimer",null);this.props={...WK,...t},this.stats=new p_({id:this.props.id}),this.stats.get(BK),this.stats.get(zK),this.stats.get(VK),this.stats.get(UK),this.stats.get($K)}scheduleRequest(t,e=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const i={handle:t,priority:0,getPriority:e},n=new Promise(a=>(i.resolve=a,i));return this.requestQueue.push(i),this.requestMap.set(t,n),this._issueNewRequests(),n}_issueRequest(t){const{handle:e,resolve:i}=t;let n=!1;const a=()=>{n||(n=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:a}):Promise.resolve({done:a})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const i=t[e];this._updateRequest(i)||(t.splice(e,1),this.requestMap.delete(i.handle),e--)}t.sort((e,i)=>e.priority-i.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let GK="";const A3={};function jK(r){for(const t in A3)if(r.startsWith(t)){const e=A3[t];r=r.replace(t,e)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r=`${GK}${r}`),r}function XK(r){return r&&typeof r=="object"&&r.isBuffer}function GU(r){if(XK(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const t=r;return new TextEncoder().encode(t).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function jU(r){const t=r?r.lastIndexOf("/"):-1;return t>=0?r.substr(t+1):""}function ZK(r){const t=r?r.lastIndexOf("/"):-1;return t>=0?r.substr(0,t):""}const qK=r=>typeof r=="boolean",qm=r=>typeof r=="function",g_=r=>r!==null&&typeof r=="object",C3=r=>g_(r)&&r.constructor==={}.constructor,YK=r=>!!r&&typeof r[Symbol.iterator]=="function",KK=r=>r&&typeof r[Symbol.asyncIterator]=="function",qf=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,Yf=r=>typeof Blob<"u"&&r instanceof Blob,JK=r=>r&&typeof r=="object"&&r.isBuffer,QK=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||g_(r)&&qm(r.tee)&&qm(r.cancel)&&qm(r.getReader),tJ=r=>g_(r)&&qm(r.read)&&qm(r.pipe)&&qK(r.readable),XU=r=>QK(r)||tJ(r);class eJ extends Error{constructor(e,i){super(e);st(this,"reason");st(this,"url");st(this,"response");this.reason=i.reason,this.url=i.url,this.response=i.response}}const rJ=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,iJ=/^([-\w.]+\/[-\w.+]+)/;function E3(r,t){return r.toLowerCase()===t.toLowerCase()}function nJ(r){const t=iJ.exec(r);return t?t[1]:r}function I3(r){const t=rJ.exec(r);return t?t[1]:""}const ZU=/\?.*/;function aJ(r){const t=r.match(ZU);return t&&t[0]}function _P(r){return r.replace(ZU,"")}function sJ(r){if(r.length<50)return r;const t=r.slice(r.length-15);return`${r.substr(0,32)}...${t}`}function Jw(r){return qf(r)?r.url:Yf(r)?r.name||"":typeof r=="string"?r:""}function xP(r){if(qf(r)){const t=r,e=t.headers.get("content-type")||"",i=_P(t.url);return nJ(e)||I3(i)}return Yf(r)?r.type||"":typeof r=="string"?I3(r):""}function oJ(r){return qf(r)?r.headers["content-length"]||-1:Yf(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function qU(r){if(qf(r))return r;const t={},e=oJ(r);e>=0&&(t["content-length"]=String(e));const i=Jw(r),n=xP(r);n&&(t["content-type"]=n);const a=await cJ(r);a&&(t["x-first-bytes"]=a),typeof r=="string"&&(r=new TextEncoder().encode(r));const s=new Response(r,{headers:t});return Object.defineProperty(s,"url",{value:i}),s}async function lJ(r){if(!r.ok)throw await uJ(r)}async function uJ(r){const t=sJ(r.url);let e=`Failed to fetch resource (${r.status}) ${r.statusText}: ${t}`;e=e.length>100?`${e.slice(0,100)}...`:e;const i={reason:r.statusText,url:r.url,response:r};try{const n=r.headers.get("Content-Type");i.reason=!r.bodyUsed&&(n!=null&&n.includes("application/json"))?await r.json():await r.text()}catch{}return new eJ(e,i)}async function cJ(r){if(typeof r=="string")return`data:,${r.slice(0,5)}`;if(r instanceof Blob){const e=r.slice(0,5);return await new Promise(i=>{const n=new FileReader;n.onload=a=>{var s;return i((s=a==null?void 0:a.target)==null?void 0:s.result)},n.readAsDataURL(e)})}if(r instanceof ArrayBuffer){const e=r.slice(0,5);return`data:base64,${hJ(e)}`}return null}function hJ(r){let t="";const e=new Uint8Array(r);for(let i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return btoa(t)}function fJ(r){return!dJ(r)&&!pJ(r)}function dJ(r){return r.startsWith("http:")||r.startsWith("https:")}function pJ(r){return r.startsWith("data:")}async function M3(r,t){var e,i;if(typeof r=="string"){const n=jK(r);return fJ(n)&&(e=globalThis.loaders)!=null&&e.fetchNode?(i=globalThis.loaders)==null?void 0:i.fetchNode(n,t):await fetch(n,t)}return await qU(r)}const P3=new d_({id:"loaders.gl"});class gJ{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class vJ{constructor(){st(this,"console");this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const YU={fetch:null,mimeType:void 0,nothrow:!1,log:new vJ,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:mP,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},mJ={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function KU(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state||(r._state={}),r._state}function JU(){const r=KU();return r.globalOptions=r.globalOptions||{...YU},r.globalOptions}function yJ(r,t,e,i){return e=e||[],e=Array.isArray(e)?e:[e],_J(r,e),bJ(t,r,i)}function _J(r,t){R3(r,null,YU,mJ,t);for(const e of t){const i=r&&r[e.id]||{},n=e.options&&e.options[e.id]||{},a=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};R3(i,e.id,n,a,t)}}function R3(r,t,e,i,n){const a=t||"Top level",s=t?`${t}.`:"";for(const o in r){const l=!t&&g_(r[o]),u=o==="baseUri"&&!t,c=o==="workerUrl"&&t;if(!(o in e)&&!u&&!c){if(o in i)P3.warn(`${a} loader option '${s}${o}' no longer supported, use '${i[o]}'`)();else if(!l){const h=xJ(o,n);P3.warn(`${a} loader option '${s}${o}' not recognized. ${h}`)()}}}}function xJ(r,t){const e=r.toLowerCase();let i="";for(const n of t)for(const a in n.options){if(r===a)return`Did you mean '${n.id}.${a}'?`;const s=a.toLowerCase();(e.startsWith(s)||s.startsWith(e))&&(i=i||`Did you mean '${n.id}.${a}'?`)}return i}function bJ(r,t,e){const n={...r.options||{}};return wJ(n,e),n.log===null&&(n.log=new gJ),D3(n,JU()),D3(n,t),n}function D3(r,t){for(const e in t)if(e in t){const i=t[e];C3(i)&&C3(r[e])?r[e]={...r[e],...t[e]}:r[e]=t[e]}}function wJ(r,t){t&&!("baseUri"in r)&&(r.baseUri=t)}function bP(r){return r?(Array.isArray(r)&&(r=r[0]),Array.isArray(r==null?void 0:r.extensions)):!1}function wP(r){lb(r,"null loader"),lb(bP(r),"invalid loader");let t;return Array.isArray(r)&&(t=r[1],r=r[0],r={...r,options:{...r.options,...t}}),(r!=null&&r.parseTextSync||r!=null&&r.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const QU=()=>{const r=KU();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function t8(r){const t=QU();r=Array.isArray(r)?r:[r];for(const e of r){const i=wP(e);t.find(n=>i===n)||t.unshift(i)}}function SJ(){return QU()}const TJ=/\.([^.]+)$/;async function AJ(r,t=[],e,i){if(!e8(r))return null;let n=L3(r,t,{...e,nothrow:!0},i);if(n)return n;if(Yf(r)&&(r=await r.slice(0,10).arrayBuffer(),n=L3(r,t,e,i)),!n&&!(e!=null&&e.nothrow))throw new Error(r8(r));return n}function L3(r,t=[],e,i){if(!e8(r))return null;if(t&&!Array.isArray(t))return wP(t);let n=[];t&&(n=n.concat(t)),e!=null&&e.ignoreRegisteredLoaders||n.push(...SJ()),EJ(n);const a=CJ(r,n,e,i);if(!a&&!(e!=null&&e.nothrow))throw new Error(r8(r));return a}function CJ(r,t,e,i){const n=Jw(r),a=xP(r),s=_P(n)||(i==null?void 0:i.url);let o=null,l="";return e!=null&&e.mimeType&&(o=uA(t,e==null?void 0:e.mimeType),l=`match forced by supplied MIME type ${e==null?void 0:e.mimeType}`),o=o||IJ(t,s),l=l||(o?`matched url ${s}`:""),o=o||uA(t,a),l=l||(o?`matched MIME type ${a}`:""),o=o||PJ(t,r),l=l||(o?`matched initial data ${i8(r)}`:""),e!=null&&e.fallbackMimeType&&(o=o||uA(t,e==null?void 0:e.fallbackMimeType),l=l||(o?`matched fallback MIME type ${a}`:"")),l&&UU.log(1,`selectLoader selected ${o==null?void 0:o.name}: ${l}.`),o}function e8(r){return!(r instanceof Response&&r.status===204)}function r8(r){const t=Jw(r),e=xP(r);let i="No valid loader found (";i+=t?`${jU(t)}, `:"no url provided, ",i+=`MIME type: ${e?`"${e}"`:"not provided"}, `;const n=r?i8(r):"";return i+=n?` first bytes: "${n}"`:"first bytes: not available",i+=")",i}function EJ(r){for(const t of r)wP(t)}function IJ(r,t){const e=t&&TJ.exec(t),i=e&&e[1];return i?MJ(r,i):null}function MJ(r,t){t=t.toLowerCase();for(const e of r)for(const i of e.extensions)if(i.toLowerCase()===t)return e;return null}function uA(r,t){var e;for(const i of r)if((e=i.mimeTypes)!=null&&e.some(n=>E3(t,n))||E3(t,`application/x.${i.id}`))return i;return null}function PJ(r,t){if(!t)return null;for(const e of r)if(typeof t=="string"){if(RJ(t,e))return e}else if(ArrayBuffer.isView(t)){if(k3(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&k3(t,0,e))return e;return null}function RJ(r,t){return t.testText?t.testText(r):(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>r.startsWith(i))}function k3(r,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>DJ(r,t,e,n))}function DJ(r,t,e,i){if(i instanceof ArrayBuffer)return kK(i,r,i.byteLength);switch(typeof i){case"function":return i(r);case"string":const n=SE(r,t,i.length);return i===n;default:return!1}}function i8(r,t=5){return typeof r=="string"?r.slice(0,t):ArrayBuffer.isView(r)?SE(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?SE(r,0,t):""}function SE(r,t,e){if(r.byteLength<t+e)return"";const i=new DataView(r);let n="";for(let a=0;a<e;a++)n+=String.fromCharCode(i.getUint8(t+a));return n}const LJ=256*1024;function*kJ(r,t){const e=(t==null?void 0:t.chunkSize)||LJ;let i=0;const n=new TextEncoder;for(;i<r.length;){const a=Math.min(r.length-i,e),s=r.slice(i,i+a);i+=a,yield n.encode(s)}}const OJ=256*1024;function*NJ(r,t={}){const{chunkSize:e=OJ}=t;let i=0;for(;i<r.byteLength;){const n=Math.min(r.byteLength-i,e),a=new ArrayBuffer(n),s=new Uint8Array(r,i,n);new Uint8Array(a).set(s),i+=n,yield a}}const FJ=1024*1024;async function*BJ(r,t){const e=(t==null?void 0:t.chunkSize)||FJ;let i=0;for(;i<r.size;){const n=i+e,a=await r.slice(i,n).arrayBuffer();i=n,yield a}}function O3(r,t){return mP?zJ(r,t):VJ(r)}async function*zJ(r,t){const e=r.getReader();let i;try{for(;;){const n=i||e.read();t!=null&&t._streamReadAhead&&(i=e.read());const{done:a,value:s}=await n;if(a)return;yield GU(s)}}catch{e.releaseLock()}}async function*VJ(r,t){for await(const e of r)yield GU(e)}function UJ(r,t){if(typeof r=="string")return kJ(r,t);if(r instanceof ArrayBuffer)return NJ(r,t);if(Yf(r))return BJ(r,t);if(XU(r))return O3(r,t);if(qf(r))return O3(r.body,t);throw new Error("makeIterator")}const n8="Cannot convert supplied data type";function $J(r,t,e){if(t.text&&typeof r=="string")return r;if(JK(r)&&(r=r.buffer),r instanceof ArrayBuffer){const i=r;return t.text&&!t.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(r)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(r);let i=r.buffer;const n=r.byteLength||r.length;return(r.byteOffset!==0||n!==i.byteLength)&&(i=i.slice(r.byteOffset,r.byteOffset+n)),i}throw new Error(n8)}async function WJ(r,t,e){const i=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||i)return $J(r,t);if(Yf(r)&&(r=await qU(r)),qf(r)){const n=r;return await lJ(n),t.binary?await n.arrayBuffer():await n.text()}if(XU(r)&&(r=UJ(r,e)),YK(r)||KK(r))return FK(r);throw new Error(n8)}function a8(r,t){const e=JU(),i=r||e;return typeof i.fetch=="function"?i.fetch:g_(i.fetch)?n=>M3(n,i.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:M3}function HJ(r,t,e){if(e)return e;const i={fetch:a8(t,r),...r};if(i.url){const n=_P(i.url);i.baseUrl=n,i.queryString=aJ(i.url),i.filename=jU(n),i.baseUrl=ZK(n)}return Array.isArray(i.loaders)||(i.loaders=null),i}function GJ(r,t){if(r&&!Array.isArray(r))return r;let e;if(r&&(e=Array.isArray(r)?r:[r]),t&&t.loaders){const i=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...i]:i}return e&&e.length?e:void 0}async function hb(r,t,e,i){t&&!Array.isArray(t)&&!bP(t)&&(i=void 0,e=t,t=void 0),r=await r,e=e||{};const n=Jw(r),s=GJ(t,i),o=await AJ(r,s,e);return o?(e=yJ(e,o,s,n),i=HJ({url:n,_parse:hb,loaders:s},e,i||null),await jJ(o,r,e,i)):null}async function jJ(r,t,e,i){if(PK(r),e=yK(r.options,e),qf(t)){const a=t,{ok:s,redirected:o,status:l,statusText:u,type:c,url:h}=a,p=Object.fromEntries(a.headers.entries());i.response={headers:p,ok:s,redirected:o,status:l,statusText:u,type:c,url:h}}t=await WJ(t,r,e);const n=r;if(n.parseTextSync&&typeof t=="string")return n.parseTextSync(t,e,i);if(RK(r,e))return await DK(r,t,e,i,hb);if(n.parseText&&typeof t=="string")return await n.parseText(t,e,i);if(n.parse)return await n.parse(t,e,i);throw Nc(!n.parseSync),new Error(`${r.id} loader - no parser found and worker is disabled`)}async function fb(r,t,e,i){let n,a;!Array.isArray(t)&&!bP(t)?(n=[],a=t):(n=t,a=e);const s=a8(a);let o=r;return typeof r=="string"&&(o=await s(r)),Yf(r)&&(o=await s(r)),Array.isArray(n)?await hb(o,n,a):await hb(o,n,a)}const XJ="4.3.1";var OU;const ZJ=(OU=globalThis.loaders)==null?void 0:OU.parseImageNode,TE=typeof Image<"u",AE=typeof ImageBitmap<"u",qJ=!!ZJ,CE=mP?!0:qJ;function YJ(r){switch(r){case"auto":return AE||TE||CE;case"imagebitmap":return AE;case"image":return TE;case"data":return CE;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function KJ(){if(AE)return"imagebitmap";if(TE)return"image";if(CE)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function JJ(r){const t=tQ(r);if(!t)throw new Error("Not an image");return t}function QJ(r){switch(JJ(r)){case"data":return r;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=r.width,t.height=r.height,e.drawImage(r,0,0),e.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function tQ(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const eQ=/^data:image\/svg\+xml/,rQ=/\.svg((\?|#).*)?$/;function SP(r){return r&&(eQ.test(r)||rQ.test(r))}function iQ(r,t){if(SP(t)){let i=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(a){throw new Error(a.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return s8(r,t)}function s8(r,t){if(SP(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function o8(r,t,e){const i=iQ(r,e),n=self.URL||self.webkitURL,a=typeof i!="string"&&n.createObjectURL(i);try{return await nQ(a||i,t)}finally{a&&n.revokeObjectURL(a)}}async function nQ(r,t){const e=new Image;return e.src=r,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((i,n)=>{try{e.onload=()=>i(e),e.onerror=a=>{const s=a instanceof Error?a.message:"error";n(new Error(s))}}catch(a){n(a)}})}const aQ={};let N3=!0;async function sQ(r,t,e){let i;SP(e)?i=await o8(r,t,e):i=s8(r,e);const n=t&&t.imagebitmap;return await oQ(i,n)}async function oQ(r,t=null){if((lQ(t)||!N3)&&(t=null),t)try{return await createImageBitmap(r,t)}catch(e){console.warn(e),N3=!1}return await createImageBitmap(r)}function lQ(r){for(const t in r||aQ)return!1;return!0}function uQ(r){return!dQ(r,"ftyp",4)||!(r[8]&96)?null:cQ(r)}function cQ(r){switch(hQ(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function hQ(r,t,e){return String.fromCharCode(...r.slice(t,e))}function fQ(r){return[...r].map(t=>t.charCodeAt(0))}function dQ(r,t,e=0){const i=fQ(t);for(let n=0;n<i.length;++n)if(i[n]!==r[n+e])return!1;return!0}const hl=!1,Ym=!0;function l8(r){const t=v_(r);return gQ(t)||yQ(t)||vQ(t)||mQ(t)||pQ(t)}function pQ(r){const t=new Uint8Array(r instanceof DataView?r.buffer:r),e=uQ(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function gQ(r){const t=v_(r);return t.byteLength>=24&&t.getUint32(0,hl)===2303741511?{mimeType:"image/png",width:t.getUint32(16,hl),height:t.getUint32(20,hl)}:null}function vQ(r){const t=v_(r);return t.byteLength>=10&&t.getUint32(0,hl)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Ym),height:t.getUint16(8,Ym)}:null}function mQ(r){const t=v_(r);return t.byteLength>=14&&t.getUint16(0,hl)===16973&&t.getUint32(2,Ym)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Ym),height:t.getUint32(22,Ym)}:null}function yQ(r){const t=v_(r);if(!(t.byteLength>=3&&t.getUint16(0,hl)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:n}=_Q();let a=2;for(;a+9<t.byteLength;){const s=t.getUint16(a,hl);if(n.has(s))return{mimeType:"image/jpeg",height:t.getUint16(a+5,hl),width:t.getUint16(a+7,hl)};if(!i.has(s))return null;a+=2,a+=t.getUint16(a,hl)}return null}function _Q(){const r=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)r.add(e);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function v_(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function xQ(r,t){var n;const{mimeType:e}=l8(r)||{},i=(n=globalThis.loaders)==null?void 0:n.parseImageNode;return lb(i),await i(r,e)}async function bQ(r,t,e){t=t||{};const n=(t.image||{}).type||"auto",{url:a}=e||{},s=wQ(n);let o;switch(s){case"imagebitmap":o=await sQ(r,t,a);break;case"image":o=await o8(r,t,a);break;case"data":o=await xQ(r);break;default:lb(!1)}return n==="data"&&(o=QJ(o)),o}function wQ(r){switch(r){case"auto":case"data":return KJ();default:return YJ(r),r}}const SQ=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],TQ=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],AQ={image:{type:"auto",decode:!0}},CQ={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:XJ,mimeTypes:TQ,extensions:SQ,parse:bQ,tests:[r=>!!l8(new DataView(r))],options:AQ},EQ=new d_({id:"deck"}),Wr=EQ;let EE={};function IQ(r){EE=r}function xa(r,t,e,i){Wr.level>0&&EE[r]&&EE[r].call(null,t,e,i)}function MQ(r){const t=r[0],e=r[r.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const PQ={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:MQ,parseTextSync:JSON.parse};function RQ(){const r="9.0.36",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==r)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${r}`);return t||(Wr.log(1,`deck.gl ${r}`)(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:Wr,_registerLoggers:IQ},t8([PQ,[CQ,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const u8=RQ();function cf(r,t){if(!r)throw new Error(t||"shadertools: assertion failed.")}const cA={number:{type:"number",validate(r,t){return Number.isFinite(r)&&typeof t=="object"&&(t.max===void 0||r<=t.max)&&(t.min===void 0||r>=t.min)}},array:{type:"array",validate(r,t){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function DQ(r){const t={};for(const[e,i]of Object.entries(r))t[e]=kQ(i);return t}function LQ(r,t,e){const i={};for(const[n,a]of Object.entries(t))r&&n in r&&!a.private?(a.validate&&cf(a.validate(r[n],a),`${e}: invalid ${n}`),i[n]=r[n]):i[n]=a.value;return i}function kQ(r){let t=F3(r);if(t!=="object")return{value:r,...cA[t],type:t};if(typeof r=="object")return r?r.type!==void 0?{...r,...cA[r.type],type:r.type}:r.value===void 0?{type:"object",value:r}:(t=F3(r.value),{...r,...cA[t],type:t}):{type:"object",value:null};throw new Error("props")}function F3(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const OQ=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,NQ=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,FQ={vertex:OQ,fragment:NQ},B3=/void\s+main\s*\([^)]*\)\s*\{\n?/,z3=/}\n?[^{}]*$/,hA=[],P1="__LUMA_INJECT_DECLARATIONS__";function BQ(r){const t={vertex:{},fragment:{}};for(const e in r){let i=r[e];const n=zQ(e);typeof i=="string"&&(i={order:0,injection:i}),t[n][e]=i}return t}function zQ(r){const t=r.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function db(r,t,e,i=!1){const n=t==="vertex";for(const a in e){const s=e[a];s.sort((l,u)=>l.order-u.order),hA.length=s.length;for(let l=0,u=s.length;l<u;++l)hA[l]=s[l].injection;const o=`${hA.join(`
`)}
`;switch(a){case"vs:#decl":n&&(r=r.replace(P1,o));break;case"vs:#main-start":n&&(r=r.replace(B3,l=>l+o));break;case"vs:#main-end":n&&(r=r.replace(z3,l=>o+l));break;case"fs:#decl":n||(r=r.replace(P1,o));break;case"fs:#main-start":n||(r=r.replace(B3,l=>l+o));break;case"fs:#main-end":n||(r=r.replace(z3,l=>o+l));break;default:r=r.replace(a,l=>l+o)}}return r=r.replace(P1,""),i&&(r=r.replace(/\}\s*$/,a=>a+FQ[t])),r}let VQ=1;class hf{constructor(t){st(this,"name");st(this,"vs");st(this,"fs");st(this,"getModuleUniforms");st(this,"dependencies");st(this,"deprecations");st(this,"defines");st(this,"injections");st(this,"uniforms",{});st(this,"uniformTypes",{});const{name:e,vs:i,fs:n,dependencies:a=[],uniformTypes:s={},uniformPropTypes:o={},getUniforms:l,deprecations:u=[],defines:c={},inject:h={}}=t;cf(typeof e=="string"),this.name=e,this.vs=i,this.fs=n,this.getModuleUniforms=l,this.dependencies=hf.instantiateModules(a),this.deprecations=this._parseDeprecationDefinitions(u),this.defines=c,this.injections=BQ(h),this.uniformTypes=s,o&&(this.uniforms=DQ(o))}static instantiateModules(t){return t.map(e=>{if(e instanceof hf)return e;cf(typeof e!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(e)}' and use it directly.`),e.name||(console.warn("shader module has no name"),e.name=`shader-module-${VQ++}`);const i=new hf(e);return i.dependencies=hf.instantiateModules(e.dependencies||[]),i})}getModuleSource(t){let e;switch(t){case"vertex":e=this.vs||"";break;case"fragment":e=this.fs||"";break;default:cf(!1)}const i=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${i}
${e}

`}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):LQ(t,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach(i=>{var n;(n=i.regex)!=null&&n.test(t)&&(i.deprecated?e.deprecated(i.old,i.new)():e.removed(i.old,i.new)())})}_parseDeprecationDefinitions(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}_defaultGetUniforms(t={}){const e={},i=this.uniforms;for(const n in i){const a=i[n];n in t&&!a.private?(a.validate&&cf(a.validate(t[n],a),`${this.name}: invalid ${n}`),e[n]=t[n]):e[n]=a.value}return e}}function V3(r){if(r.source&&r.platformInfo.type==="webgpu")return{...r,vs:void 0,fs:void 0};if(!r.vs)throw new Error("no vertex shader");const t=U3(r.platformInfo,r.vs);let e;return r.fs&&(e=U3(r.platformInfo,r.fs)),{...r,vs:t,fs:e}}function U3(r,t){if(typeof t=="string")return t;switch(r.type){case"webgpu":if(t!=null&&t.wgsl)return t.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(t!=null&&t.glsl)return t.glsl;throw new Error("WebGL does not support WGSL shaders")}}function Qw(r){const t=hf.instantiateModules(r);return UQ(t)}function UQ(r){const t={},e={};return c8({modules:r,level:0,moduleMap:t,moduleDepth:e}),Object.keys(e).sort((i,n)=>e[n]-e[i]).map(i=>t[i])}function c8(r){const{modules:t,level:e,moduleMap:i,moduleDepth:n}=r;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const a of t)i[a.name]=a,(n[a.name]===void 0||n[a.name]<e)&&(n[a.name]=e);for(const a of t)a.dependencies&&c8({modules:a.dependencies,level:e+1,moduleMap:i,moduleDepth:n})}function $Q(r){switch(r==null?void 0:r.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function WQ(r,t){var i;if(Number(((i=r.match(/^#version[ \t]+(\d+)/m))==null?void 0:i[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return r=$3(r,HQ),r;case"fragment":return r=$3(r,GQ),r;default:throw new Error(t)}}const h8=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],HQ=[...h8,[IE("attribute"),"in $1"],[IE("varying"),"out $1"]],GQ=[...h8,[IE("varying"),"in $1"]];function $3(r,t){for(const[e,i]of t)r=r.replace(e,i);return r}function IE(r){return new RegExp(`\\b${r}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function f8(r,t){let e="";for(const i in r){const n=r[i];if(e+=`void ${n.signature} {
`,n.header&&(e+=`  ${n.header}`),t[i]){const a=t[i];a.sort((s,o)=>s.order-o.order);for(const s of a)e+=`  ${s.injection}
`}n.footer&&(e+=`  ${n.footer}`),e+=`}
`}return e}function d8(r){const t={vertex:{},fragment:{}};for(const e of r){let i,n;typeof e!="string"?(i=e,n=i.hook):(i={},n=e),n=n.trim();const[a,s]=n.split(":"),o=n.replace(/\(.+/,""),l=Object.assign(i,{signature:s});switch(a){case"vs":t.vertex[o]=l;break;case"fs":t.fragment[o]=l;break;default:throw new Error(a)}}return t}function jQ(r,t){return{name:XQ(r,t),language:"glsl",version:ZQ(r)}}function XQ(r,t="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(r);return i?i[1]:t}function ZQ(r){let t=100;const e=r.match(/[^\s]+/g);if(e&&e.length>=2&&e[0]==="#version"){const i=parseInt(e[1],10);Number.isFinite(i)&&(t=i)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}const p8=`

${P1}
`,qQ=`precision highp float;
`;function YQ(r){const t=Qw(r.modules||[]);return{source:ME(r.platformInfo,{...r,source:r.source,stage:"vertex",modules:t}),getUniforms:TP(t)}}function KQ(r){const t=Qw(r.modules||[]);return{vs:ME(r.platformInfo,{...r,source:r.vs,stage:"vertex",modules:t}),fs:ME(r.platformInfo,{...r,source:r.fs,stage:"fragment",modules:t}),getUniforms:TP(t)}}function JQ(r){const{vs:t,fs:e}=r,i=Qw(r.modules||[]);return{vs:W3(r.platformInfo,{...r,source:t,stage:"vertex",modules:i}),fs:W3(r.platformInfo,{...r,source:e,stage:"fragment",modules:i}),getUniforms:TP(i)}}function ME(r,t){const{source:e,stage:i,modules:n,hookFunctions:a=[],inject:s={},log:o}=t;cf(typeof e=="string","shader source must be a string");const l=e;let u="";const c=d8(a),h={},p={},v={};for(const x in s){const w=typeof s[x]=="string"?{injection:s[x],order:0}:s[x],T=/^(v|f)s:(#)?([\w-]+)$/.exec(x);if(T){const E=T[2],M=T[3];E?M==="decl"?p[x]=[w]:v[x]=[w]:h[x]=[w]}else v[x]=[w]}const y=r.type!=="webgpu"?n:[];for(const x of y){o&&x.checkDeprecations(l,o);const w=x.getModuleSource(i,"wgsl");u+=w;const T=x.injections[i];for(const E in T){const M=/^(v|f)s:#([\w-]+)$/.exec(E);if(M){const F=M[2]==="decl"?p:v;F[E]=F[E]||[],F[E].push(T[E])}else h[E]=h[E]||[],h[E].push(T[E])}}return u+=p8,u=db(u,i,p),u+=f8(c[i],h),u+=l,u=db(u,i,v),u}function W3(r,t){const{id:e,source:i,stage:n,language:a="glsl",modules:s,defines:o={},hookFunctions:l=[],inject:u={},prologue:c=!0,log:h}=t;cf(typeof i=="string","shader source must be a string");const p=a==="glsl"?jQ(i).version:-1,v=r.shaderLanguageVersion,y=p===100?"#version 100":"#version 300 es",w=i.split(`
`).slice(1).join(`
`),T={};s.forEach(U=>{Object.assign(T,U.getDefines())}),Object.assign(T,o);let E="";switch(a){case"wgsl":break;case"glsl":E=c?`${y}

// ----- PROLOGUE -------------------------
${QQ({id:e,source:i,stage:n})}
${`#define SHADER_TYPE_${n.toUpperCase()}`}
${$Q(r)}
${n==="fragment"?qQ:""}

// ----- APPLICATION DEFINES -------------------------

${ttt(T)}

`:`${y}
`;break}const M=d8(l),L={},F={},O={};for(const U in u){const W=typeof u[U]=="string"?{injection:u[U],order:0}:u[U],H=/^(v|f)s:(#)?([\w-]+)$/.exec(U);if(H){const j=H[2],Y=H[3];j?Y==="decl"?F[U]=[W]:O[U]=[W]:L[U]=[W]}else O[U]=[W]}for(const U of s){h&&U.checkDeprecations(w,h);const W=U.getModuleSource(n);E+=W;const H=U.injections[n];for(const j in H){const Y=/^(v|f)s:#([\w-]+)$/.exec(j);if(Y){const it=Y[2]==="decl"?F:O;it[j]=it[j]||[],it[j].push(H[j])}else L[j]=L[j]||[],L[j].push(H[j])}}return E+="// ----- MAIN SHADER SOURCE -------------------------",E+=p8,E=db(E,n,F),E+=f8(M[n],L),E+=w,E=db(E,n,O),a==="glsl"&&p!==v&&(E=WQ(E,n)),E.trim()}function TP(r){return function(e){const i={};for(const n of r){const a=n.getUniforms(e,i);Object.assign(i,a)}return i}}function QQ(r){const{id:t,source:e,stage:i}=r;return t&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${i}

`:""}function ttt(r={}){let t="";for(const e in r){const i=r[e];(i||Number.isFinite(i))&&(t+=`#define ${e.toUpperCase()} ${r[e]}
`)}return t}const lf=class lf{constructor(){st(this,"_hookFunctions",[]);st(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return lf.defaultShaderAssembler=lf.defaultShaderAssembler||new lf,lf.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(e=>e.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==e)}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t)}assembleShader(t){const e=this._getModuleList(t.modules),i=this._hookFunctions,n=V3(t);return{...YQ({platformInfo:t.platformInfo,...n,modules:e,hookFunctions:i}),modules:e}}assembleShaderPair(t){const e=V3(t),i=this._getModuleList(t.modules),n=this._hookFunctions,{platformInfo:a}=t;return{...t.platformInfo.shaderLanguage==="wgsl"?KQ({platformInfo:a,...e,modules:i,hookFunctions:n}):JQ({platformInfo:a,...e,modules:i,hookFunctions:n}),modules:i}}_getModuleList(t=[]){const e=new Array(this._defaultModules.length+t.length),i={};let n=0;for(let a=0,s=this._defaultModules.length;a<s;++a){const o=this._defaultModules[a],l=o.name;e[n++]=o,i[l]=!0}for(let a=0,s=t.length;a<s;++a){const o=t[a],l=o.name;i[l]||(e[n++]=o,i[l]=!0)}return e.length=n,hf.instantiateModules(e)}};st(lf,"defaultShaderAssembler");let pb=lf;const ett=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,rtt=`#version 300 es
${ett}`;function itt(r){const{input:t,inputChannels:e,output:i}=r||{};if(!t)return rtt;if(!e)throw new Error("inputChannels");const n=ntt(e),a=att(t,e);return`#version 300 es
in ${n} ${t};
out vec4 ${i};
void main() {
  ${i} = ${a};
}`}function ntt(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${r}`)}}function att(r,t){switch(t){case 1:return`vec4(${r}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${r}, 0.0, 1.0)`;case 3:return`vec4(${r}, 1.0)`;case 4:return r;default:throw new Error(`invalid channels: ${t}`)}}const _e=new d_({id:"luma.gl"});class stt{constructor(){st(this,"stats",new Map)}getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new p_({id:t})),this.stats.get(t)}}const AP=new stt;function ott(){const r="9.0.27",t="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==r)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${r}`);return globalThis.luma||(qc()&&_e.log(1,`${r} - ${t}`)(),globalThis.luma=globalThis.luma||{VERSION:r,version:r,log:_e,stats:AP}),r}const ltt=ott();function utt(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)?r:null}function wy(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number"?r:null:utt(r)}const fA={};function Kf(r="id"){fA[r]=fA[r]||1;const t=fA[r]++;return`${r}-${t}`}function gb(r){let t=!0;for(const e in r){t=!1;break}return t}var bE;let xi=(bE=class{constructor(t,e,i){st(this,"id");st(this,"props");st(this,"userData",{});st(this,"_device");st(this,"destroyed",!1);st(this,"allocatedBytes",0);st(this,"_attachedResources",new Set);if(!t)throw new Error("no device");this._device=t,this.props=ctt(e,i);const n=this.props.id!=="undefined"?this.props.id:Kf(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get(`${e}s Active`).decrementCount()}trackAllocatedMemory(t,e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(t),i.get(`${e} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const e=this._device.statsManager.getStats("Resource Counts");e.get("GPU Memory").subtractCount(this.allocatedBytes),e.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}},st(bE,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),bE);function ctt(r,t){const e={...t};for(const i in r)r[i]!==void 0&&(e[i]=r[i]);return e}var Mn;let rn=(Mn=class extends xi{constructor(e,i){const n={...i};(i.usage||0)&Mn.INDEX&&!i.indexType&&(i.data instanceof Uint32Array?n.indexType="uint32":i.data instanceof Uint16Array&&(n.indexType="uint16"));super(e,n,Mn.defaultProps);st(this,"usage");st(this,"indexType");st(this,"updateTimestamp");st(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(e,i){throw new Error("not implemented")}_setDebugData(e,i,n){const a=ArrayBuffer.isView(e)?e.buffer:e,s=Math.min(e?e.byteLength:n,Mn.DEBUG_DATA_MAX_LENGTH);e===null?this.debugData=new ArrayBuffer(s):i===0&&n===e.byteLength?this.debugData=a.slice(0,s):this.debugData=a.slice(i,i+s)}},st(Mn,"defaultProps",{...xi.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),st(Mn,"MAP_READ",1),st(Mn,"MAP_WRITE",2),st(Mn,"COPY_SRC",4),st(Mn,"COPY_DST",8),st(Mn,"INDEX",16),st(Mn,"VERTEX",32),st(Mn,"UNIFORM",64),st(Mn,"STORAGE",128),st(Mn,"INDIRECT",256),st(Mn,"QUERY_RESOLVE",512),st(Mn,"DEBUG_DATA_MAX_LENGTH",32),Mn);function g8(r){const t=H3[r],e=htt(t),i=r.includes("norm"),n=!i&&!r.startsWith("float"),a=r.startsWith("s");return{dataType:H3[r],byteLength:e,integer:n,signed:a,normalized:i}}function htt(r){return ftt[r]}const H3={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},ftt={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},dtt=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],ptt=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function gtt(r){return dtt.some(t=>r.startsWith(t))}function v8(r){const t=ptt.exec(r);if(t){const[,e,i,n,a,s]=t;if(e){const o=`${n}${i}`,l=g8(o);return{format:e,components:e.length,srgb:a==="-srgb",unsized:s==="-unsized",webgl:s==="-webgl",...l}}}return mtt(r)}const vtt={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function mtt(r){var e;const t=vtt[r];if(!t)throw new Error(`Unknown format ${r}`);return{format:t.format||"",components:t.components||((e=t.format)==null?void 0:e.length)||1,byteLength:t.bpp||1,srgb:!1,unsized:!1}}class ytt{}class _tt{constructor(t=[],e){st(this,"features");st(this,"disabledFeatures");this.features=new Set(t),this.disabledFeatures=e||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures[t]&&this.features.has(t)}}const xy=class xy{constructor(t){st(this,"id");st(this,"props");st(this,"userData",{});st(this,"statsManager",AP);st(this,"_lumaData",{});st(this,"timestamp",0);this.props={...xy.defaultProps,...t},this.id=this.props.id||Kf(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(t){return gtt(t)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(t){return(t instanceof Promise||typeof t=="string")&&(t={data:t}),this._createTexture(t)}createCommandEncoder(t={}){throw new Error("not implemented")}readPixelsToArrayWebGL(t,e){throw new Error("not implemented")}readPixelsToBufferWebGL(t,e){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,e){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}_getBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const e={...t};return(t.usage||0)&rn.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?e.indexType="uint32":t.data instanceof Uint16Array?e.indexType="uint16":_e.warn("indices buffer content must be of integer type")()),e}};st(xy,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!_e.get("debug"),spector:!!(_e.get("spector")||_e.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:t=>_e.error(t.message)}),st(xy,"VERSION",ltt);let ig=xy;function Di(r,t){if(!r)throw new Error(t||"luma.gl: assertion failed.")}const Gv=new Map,Wp=class Wp{static registerDevices(t){for(const e of t)Di(e.type&&e.isSupported&&e.create),Gv.set(e.type,e)}static getAvailableDevices(){return Array.from(Gv).map(t=>t.type)}static getSupportedDevices(){return Array.from(Gv).filter(t=>t.isSupported()).map(t=>t.type)}static setDefaultDeviceProps(t){Object.assign(ig.defaultProps,t)}static async attachDevice(t){const e=G3(t.devices)||Gv;if(t.handle instanceof WebGL2RenderingContext){const i=e.get("webgl");if(i)return await i.attach(t.handle)}if(t.handle===null){const i=e.get("unknown");if(i)return await i.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(t={}){var a,s;t={...Wp.defaultProps,...t},t.gl&&(t.type="webgl");const e=G3(t.devices)||Gv;let i,n;switch(t.type){case"webgpu":if(i=e.get("webgpu"),i)return await i.create(t);break;case"webgl":if(n=e.get("webgl"),n)return await n.create(t);break;case"unknown":const o=e.get("unknown");if(o)return await o.create(t);break;case"best-available":if(i=e.get("webgpu"),(a=i==null?void 0:i.isSupported)!=null&&a.call(i))return await i.create(t);if(n=e.get("webgl"),(s=n==null?void 0:n.isSupported)!=null&&s.call(n))return await n.create(t);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(i,n){return i==="webgl"||i==="experimental-webgl"?this.originalGetContext("webgl2",n):this.originalGetContext(i,n)}}};st(Wp,"defaultProps",{...ig.defaultProps,type:"best-available",devices:void 0}),st(Wp,"stats",AP),st(Wp,"log",_e);let Hp=Wp;function G3(r){if(!r||(r==null?void 0:r.length)===0)return null;const t=new Map;for(const e of r)t.set(e.type,e);return t}const xtt=qc()&&typeof document<"u",tS=()=>xtt&&document.readyState==="complete",btt={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class CP{constructor(t){st(this,"id");st(this,"props");st(this,"canvas");st(this,"htmlCanvas");st(this,"offscreenCanvas");st(this,"type");st(this,"width",1);st(this,"height",1);st(this,"resizeObserver");st(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...btt,...t},t=this.props,!qc()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(t.canvas)typeof t.canvas=="string"?this.canvas=Ttt(t.canvas):this.canvas=t.canvas;else{const e=Att(t),i=Stt((t==null?void 0:t.container)||null);i.insertBefore(e,i.firstChild),this.canvas=e,t!=null&&t.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&t.autoResize&&(this.resizeObserver=new ResizeObserver(e=>{for(const i of e)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return tS()}getDevicePixelRatio(t){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(t=t===void 0?this.props.useDevicePixels:t,!t||t<=0)?1:t===!0?typeof window<"u"&&window.devicePixelRatio||1:t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const t=this.getDevicePixelRatio(),e=this.canvas;return e.parentElement?[e.clientWidth*t,e.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[t,e]=this.getPixelSize();return t/e}cssToDeviceRatio(){try{const[t]=this.getDrawingBufferSize(),{clientWidth:e}=this._canvasSizeInfo;return e?t/e:1}catch{return 1}}cssToDevicePixels(t,e=!0){const i=this.cssToDeviceRatio(),[n,a]=this.getDrawingBufferSize();return Ctt(t,i,n,a,e)}setDevicePixelRatio(t,e={}){if(!this.htmlCanvas)return;let i="width"in e?e.width:this.htmlCanvas.clientWidth,n="height"in e?e.height:this.htmlCanvas.clientHeight;(!i||!n)&&(_e.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,i=this.htmlCanvas.width||1,n=this.htmlCanvas.height||1);const a=this._canvasSizeInfo;if(a.clientWidth!==i||a.clientHeight!==n||a.devicePixelRatio!==t){let s=t;const o=Math.floor(i*s),l=Math.floor(n*s);this.htmlCanvas.width=o,this.htmlCanvas.height=l;const[u,c]=this.getDrawingBufferSize();(u!==o||c!==l)&&(s=Math.min(u/i,c/n),this.htmlCanvas.width=Math.floor(i*s),this.htmlCanvas.height=Math.floor(n*s),_e.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=n,this._canvasSizeInfo.devicePixelRatio=t}}getDrawingBufferSize(){const t=this.device.gl;if(!t)throw new Error("canvas size");return[t.drawingBufferWidth,t.drawingBufferHeight]}_setAutoCreatedCanvasId(t){var e;((e=this.htmlCanvas)==null?void 0:e.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}}st(CP,"pageLoaded",wtt());function wtt(){return tS()||typeof window>"u"?Promise.resolve():new Promise(r=>{window.addEventListener("load",()=>r())})}function Stt(r){if(typeof r=="string"){const t=document.getElementById(r);if(!t&&!tS())throw new Error(`Accessing '${r}' before page was loaded`);if(!t)throw new Error(`${r} is not an HTML element`);return t}else if(r)return r;return document.body}function Ttt(r){const t=document.getElementById(r);if(!t&&!tS())throw new Error(`Accessing '${r}' before page was loaded`);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}function Att(r){const{width:t,height:e}=r,i=document.createElement("canvas");return i.id="lumagl-auto-created-canvas",i.width=t||1,i.height=e||1,i.style.width=Number.isFinite(t)?`${t}px`:"100%",i.style.height=Number.isFinite(e)?`${e}px`:"100%",i}function Ctt(r,t,e,i,n){const a=r,s=j3(a[0],t,e);let o=X3(a[1],t,i,n),l=j3(a[0]+1,t,e);const u=l===e-1?l:l-1;l=X3(a[1]+1,t,i,n);let c;return n?(l=l===0?l:l+1,c=o,o=l):c=l===i-1?l:l-1,{x:s,y:o,width:Math.max(u-s+1,1),height:Math.max(c-o+1,1)}}function j3(r,t,e){return Math.min(Math.round(r*t),e-1)}function X3(r,t,e,i){return i?Math.max(0,e-1-Math.round(r*t)):Math.min(Math.round(r*t),e-1)}const Ql=class Ql extends xi{constructor(e,i,n=Ql.defaultProps){super(e,i,n);st(this,"dimension");st(this,"format");st(this,"width");st(this,"height");st(this,"depth");st(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=e.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};st(Ql,"defaultProps",{...xi.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),st(Ql,"COPY_SRC",1),st(Ql,"COPY_DST",2),st(Ql,"TEXTURE_BINDING",4),st(Ql,"STORAGE_BINDING",8),st(Ql,"RENDER_ATTACHMENT",16);let eo=Ql;const Fw=class Fw extends xi{get[Symbol.toStringTag](){return"TextureView"}constructor(t,e){super(t,e,Fw.defaultProps)}};st(Fw,"defaultProps",{...xi.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let vb=Fw;function Ett(r,t,e){let i="";const n=t.split(/\r?\n/),a=r.slice().sort((s,o)=>s.lineNum-o.lineNum);switch((e==null?void 0:e.showSourceCode)||"no"){case"all":let s=0;for(let o=1;o<=n.length;o++)for(i+=m8(n[o-1],o,e);a.length>s&&a[s].lineNum===o;){const l=a[s++];i+=Z3(l,n,l.lineNum,{...e,inlineSource:!1})}return i;case"issues":case"no":for(const o of r)i+=Z3(o,n,o.lineNum,{inlineSource:(e==null?void 0:e.showSourceCode)!=="no"});return i}}function Z3(r,t,e,i){if(i!=null&&i.inlineSource){const n=Itt(t,e),a=r.linePos>0?`${" ".repeat(r.linePos+5)}^^^
`:"";return`
${n}${a}${r.type.toUpperCase()}: ${r.message}

`}return i!=null&&i.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${r.type.toUpperCase()}: ${r.message}</b></div>`:`${r.type.toUpperCase()}: ${r.message}`}function Itt(r,t,e){let i="";for(let n=t-2;n<=t;n++){const a=r[n-1];a!==void 0&&(i+=m8(a,t,e))}return i}function m8(r,t,e){const i=e!=null&&e.html?Ptt(r):r;return`${Mtt(String(t),4)}: ${i}${e!=null&&e.html?"<br/>":`
`}`}function Mtt(r,t){let e="";for(let i=r.length;i<t;++i)e+=" ";return e+r}function Ptt(r){return r.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function y8(r,t){return{name:Rtt(r,t),language:"glsl",version:Dtt(r)}}function Rtt(r,t="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(r);return i?i[1]:t}function Dtt(r){let t=100;const e=r.match(/[^\s]+/g);if(e&&e.length>=2&&e[0]==="#version"){const i=parseInt(e[1],10);Number.isFinite(i)&&(t=i)}return t}const Bw=class Bw extends xi{constructor(e,i){super(e,{id:Ltt(i),...i},Bw.defaultProps);st(this,"stage");st(this,"source");st(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(e=this.props.debug){switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const i=await this.getCompilationInfo();this.props.debug==="warnings"&&(i==null?void 0:i.length)===0||this._displayShaderLog(i)}_displayShaderLog(e){var u;if(typeof document>"u"||!(document!=null&&document.createElement))return;const i=y8(this.source).name,n=`${this.stage} ${i}`;let a=Ett(e,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(a+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`
<h1>Shader Compilation Error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${a}
</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o);const l=document.getElementsByClassName("luma-compiler-log-error");(u=l[0])!=null&&u.scrollIntoView&&l[0].scrollIntoView(),o.onclick=()=>{const c=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(c)}}};st(Bw,"defaultProps",{...xi.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let mb=Bw;function Ltt(r){return y8(r.source).name||r.id||Kf(`unnamed ${r.stage}-shader`)}const zw=class zw extends xi{get[Symbol.toStringTag](){return"Sampler"}constructor(t,e){super(t,e,zw.defaultProps)}};st(zw,"defaultProps",{...xi.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let yb=zw;const Vw=class Vw extends xi{constructor(e,i={}){super(e,i,Vw.defaultProps);st(this,"width");st(this,"height");st(this,"colorAttachments",[]);st(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(e){let i=!e;if(e){const[n,a]=Array.isArray(e)?e:[e.width,e.height];i=i||a!==this.height||n!==this.width,this.width=n,this.height=a}i&&(_e.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(i=>{if(typeof i=="string"){const n=this.createColorTexture(i);return this.attachResource(n),n.view}return i instanceof eo?i.view:i});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const i=this.createDepthStencilTexture(e);this.attachResource(i),this.depthStencilAttachment=i.view}else e instanceof eo?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e){return this.device.createTexture({id:"color-attachment",usage:eo.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}createDepthStencilTexture(e){return this.device.createTexture({id:"depth-stencil-attachment",usage:eo.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,i){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const a=this.device._createTexture({...this.colorAttachments[n].props,width:e,height:i});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=a.view,this.attachResource(a.view)}if(this.depthStencilAttachment){const n=this.device._createTexture({...this.depthStencilAttachment.props,width:e,height:i});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}}};st(Vw,"defaultProps",{...xi.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let _b=Vw;const Uw=class Uw extends xi{constructor(e,i){super(e,i,Uw.defaultProps);st(this,"shaderLayout");st(this,"bufferLayout");st(this,"linkStatus","pending");st(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(e){throw new Error("Use uniform blocks")}};st(Uw,"defaultProps",{...xi.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let ng=Uw;const $w=class $w extends xi{get[Symbol.toStringTag](){return"RenderPass"}constructor(t,e){super(t,e,$w.defaultProps)}};st($w,"defaultProps",{...xi.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let PE=$w;const Ww=class Ww extends xi{constructor(e,i){super(e,i,Ww.defaultProps);st(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};st(Ww,"defaultProps",{...xi.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let xb=Ww;const Hw=class Hw extends xi{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,e){super(t,e,Hw.defaultProps)}};st(Hw,"defaultProps",{...xi.defaultProps,measureExecutionTime:void 0});let RE=Hw;const Gw=class Gw extends xi{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,e){super(t,e,Gw.defaultProps)}};st(Gw,"defaultProps",{...xi.defaultProps});let DE=Gw;function ktt(r){const[t,e]=Ntt[r],i=t==="i32"||t==="u32",n=t!=="u32",a=Ftt[t]*e,s=Ott(t,e);return{dataType:t,components:e,defaultVertexFormat:s,byteLength:a,integer:i,signed:n}}function Ott(r,t){let e;switch(r){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return t===1?e:`${e}x${t}`}const Ntt={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Ftt={f32:4,f16:2,i32:4,u32:4};function _8(r){let t;r.endsWith("-webgl")&&(r.replace("-webgl",""),t=!0);const[e,i]=r.split("x"),n=e,a=i?parseInt(i):1,s=g8(n),o={type:n,components:a,byteLength:s.byteLength*a,integer:s.integer,signed:s.signed,normalized:s.normalized};return t&&(o.webglOnly=!0),o}function x8(r,t){const e={};for(const i of r.attributes)e[i.name]=ztt(r,t,i.name);return e}function Btt(r,t,e=16){const i=x8(r,t),n=new Array(e).fill(null);for(const a of Object.values(i))n[a.location]=a;return n}function ztt(r,t,e){const i=Vtt(r,e),n=Utt(t,e);if(!i)return null;const a=ktt(i.type),s=(n==null?void 0:n.vertexFormat)||a.defaultVertexFormat,o=_8(s);return{attributeName:(n==null?void 0:n.attributeName)||i.name,bufferName:(n==null?void 0:n.bufferName)||i.name,location:i.location,shaderType:i.type,shaderDataType:a.dataType,shaderComponents:a.components,vertexFormat:s,bufferDataType:o.type,bufferComponents:o.components,normalized:o.normalized,integer:a.integer,stepMode:(n==null?void 0:n.stepMode)||i.stepMode,byteOffset:(n==null?void 0:n.byteOffset)||0,byteStride:(n==null?void 0:n.byteStride)||0}}function Vtt(r,t){const e=r.attributes.find(i=>i.name===t);return e||_e.warn(`shader layout attribute "${t}" not present in shader`),e||null}function Utt(r,t){$tt(r);let e=Wtt(r,t);return e||(e=Htt(r,t),e)?e:(_e.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function $tt(r){for(const t of r)(t.attributes&&t.format||!t.attributes&&!t.format)&&_e.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Wtt(r,t){for(const e of r)if(e.format&&e.name===t)return{attributeName:e.name,bufferName:t,stepMode:e.stepMode,vertexFormat:e.format,byteOffset:0,byteStride:e.byteStride||0};return null}function Htt(r,t){var e;for(const i of r){let n=i.byteStride;if(typeof i.byteStride!="number")for(const s of i.attributes||[]){const o=_8(s.format);n+=o.byteLength}const a=(e=i.attributes)==null?void 0:e.find(s=>s.attribute===t);if(a)return{attributeName:a.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:a.format,byteOffset:a.byteOffset,byteStride:n}}return null}function Gtt(r,t){const e={...r,attributes:r.attributes.map(i=>({...i}))};for(const i of(t==null?void 0:t.attributes)||[]){const n=e.attributes.find(a=>a.name===i.name);n?(n.type=i.type||n.type,n.stepMode=i.stepMode||n.stepMode):_e.warn(`shader layout attribute ${i.name} not present in shader`)}return e}const jw=class jw extends xi{constructor(e,i){super(e,i,jw.defaultProps);st(this,"maxVertexAttributes");st(this,"attributeInfos");st(this,"indexBuffer",null);st(this,"attributes");this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=Btt(i.renderPipeline.shaderLayout,i.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(e,i){throw new Error("constant attributes not supported")}};st(jw,"defaultProps",{...xi.defaultProps,renderPipeline:null});let LE=jw;const Xw=class Xw extends xi{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,e){super(t,e,Xw.defaultProps)}};st(Xw,"defaultProps",{...xi.defaultProps,layout:void 0,buffers:{}});let kE=Xw;const Zw=class Zw extends xi{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,e){super(t,e,Zw.defaultProps)}};st(Zw,"defaultProps",{...xi.defaultProps,type:void 0,count:void 0});let OE=Zw;const jtt={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function Xtt(r){const t=jtt[r];return Di(r),t}function Ztt(r,t){switch(t){case 1:return r;case 2:return r+r%2;default:return r+(4-r%4)%4}}let Z0;function b8(r){return(!Z0||Z0.byteLength<r)&&(Z0=new ArrayBuffer(r)),Z0}function qtt(r,t){const e=b8(r.BYTES_PER_ELEMENT*t);return new r(e,0,t)}function Ytt(r){const{target:t,source:e,start:i=0,count:n=1}=r,a=e.length,s=n*a;let o=0;for(let l=i;o<a;o++)t[l++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(i+o,i,i+o),o*=2):(t.copyWithin(i+o,i,i+s-o),o=s);return r.target}const q3=1024;class Ktt{constructor(t){st(this,"layout",{});st(this,"byteLength");let e=0;for(const[n,a]of Object.entries(t)){const s=Xtt(a),{type:o,components:l}=s;e=Ztt(e,l);const u=e;e+=l,this.layout[n]={type:o,size:l,offset:u}}e+=(4-e%4)%4;const i=e*4;this.byteLength=Math.max(i,q3)}getData(t){const e=Math.max(this.byteLength,q3),i=b8(e),n={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[a,s]of Object.entries(t)){const o=this.layout[a];if(!o){_e.warn(`Supplied uniform value ${a} not present in uniform block layout`)();continue}const{type:l,size:u,offset:c}=o,h=n[l];if(u===1){if(typeof s!="number"&&typeof s!="boolean"){_e.warn(`Supplied value for single component uniform ${a} is not a number: ${s}`)();continue}h[c]=Number(s)}else{const p=wy(s);if(!p){_e.warn(`Supplied value for multi component / array uniform ${a} is not a numeric array: ${s}`)();continue}h.set(p,c)}}return new Uint8Array(i)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}}function Jtt(r,t,e=16){if(r!==t)return!1;const i=wy(r);if(!i)return!1;const n=wy(t);if(n&&i.length===n.length){for(let a=0;a<i.length;++a)if(n[a]!==i[a])return!1}return!0}function Qtt(r){const t=wy(r);return t?t.slice():r}class tet{constructor(t){st(this,"name");st(this,"uniforms",{});st(this,"modifiedUniforms",{});st(this,"modified",!0);st(this,"bindingLayout",{});st(this,"needsRedraw","initialized");var e;if(this.name=t==null?void 0:t.name,t!=null&&t.name&&(t!=null&&t.shaderLayout)){const i=(e=t==null?void 0:t.shaderLayout.bindings)==null?void 0:e.find(a=>a.type==="uniform"&&a.name===(t==null?void 0:t.name));if(!i)throw new Error(t==null?void 0:t.name);const n=i;for(const a of n.uniforms||[])this.bindingLayout[a.name]=a}}setUniforms(t){for(const[e,i]of Object.entries(t))this._setUniform(e,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${e}=${i}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,e){Jtt(this.uniforms[t],e)||(this.uniforms[t]=Qtt(e),this.modifiedUniforms[t]=!0,this.modified=!0)}}class eet{constructor(t){st(this,"uniformBlocks",new Map);st(this,"uniformBufferLayouts",new Map);st(this,"uniformBuffers",new Map);for(const[e,i]of Object.entries(t)){const n=e,a=new Ktt(i.uniformTypes||{});this.uniformBufferLayouts.set(n,a);const s=new tet({name:e});s.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(n,s)}}destroy(){for(const t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(const[e,i]of Object.entries(t))this.uniformBlocks.get(e).setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t).byteLength}getUniformBufferData(t){const e=this.uniformBlocks.get(t).getAllUniforms();return this.uniformBufferLayouts.get(t).getData(e)}createUniformBuffer(t,e,i){i&&this.setUniforms(i);const n=this.getUniformBufferByteLength(e),a=t.createBuffer({usage:rn.UNIFORM|rn.COPY_DST,byteLength:n}),s=this.getUniformBufferData(e);return a.write(s),a}getManagedUniformBuffer(t,e){if(!this.uniformBuffers.get(e)){const i=this.getUniformBufferByteLength(e),n=t.createBuffer({usage:rn.UNIFORM|rn.COPY_DST,byteLength:i});this.uniformBuffers.set(e,n)}return this.uniformBuffers.get(e)}updateUniformBuffers(){let t=!1;for(const e of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(e);t||(t=i)}return t&&_e.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){const e=this.uniformBlocks.get(t),i=this.uniformBuffers.get(t);let n=!1;if(i&&e.needsRedraw){n||(n=e.needsRedraw);const a=this.getUniformBufferData(t);this.uniformBuffers.get(t).write(a);const o=this.uniformBlocks.get(t).getAllUniforms();_e.log(4,`Writing to uniform buffer ${String(t)}`,a,o)()}return n}}function w8(r){const t=ArrayBuffer.isView(r)?r.constructor:r;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function S8(r){switch(r){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(r)}}function ret(r,t,e){if(!t||t>4)throw new Error(`size ${t}`);const i=t;let n=w8(r);if(n==="uint8"&&e&&i===1)return"unorm8-webgl";if(n==="uint8"&&e&&i===3)return"unorm8x3-webgl";if(n==="uint8"||n==="sint8"){if(i===1||i===3)throw new Error(`size: ${t}`);return e&&(n=n.replace("int","norm")),`${n}x${i}`}if(n==="uint16"||n==="sint16"){if(i===1||i===3)throw new Error(`size: ${t}`);return e&&(n=n.replace("int","norm")),`${n}x${i}`}return i===1?n:`${n}x${i}`}function iet(r){return wy(r)!==null||typeof r=="number"||typeof r=="boolean"}function EP(r){const t={bindings:{},uniforms:{}};return Object.keys(r).forEach(e=>{const i=r[e];iet(i)?t.uniforms[e]=i:t.bindings[e]=i}),t}function net(r,t,e){const{removedProps:i={},deprecatedProps:n={},replacedProps:a={}}=e;for(const o in i)if(o in t){const u=i[o]?`${r}.${i[o]}`:"N/A";_e.removed(`${r}.${o}`,u)()}for(const o in n)if(o in t){const l=n[o];_e.deprecated(`${r}.${o}`,`${r}.${l}`)()}let s=null;for(const[o,l]of Object.entries(a))o in t&&(_e.deprecated(`${r}.${o}`,`${r}.${l}`)(),s=s||Object.assign({},t),s[l]=t[o],delete s[o]);return s||t}let aet="";async function set(r,t){return await new Promise((e,i)=>{try{const n=new Image;n.onload=()=>e(n),n.onerror=()=>i(new Error(`Could not load image ${r}.`)),n.crossOrigin=(t==null?void 0:t.crossOrigin)||"anonymous",n.src=r.startsWith("http")?r:aet+r}catch(n){i(n)}})}async function T8(r,t){const e=document.getElementsByTagName("head")[0];if(!e)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",r),t&&(i.id=t),new Promise((n,a)=>{i.onload=n,i.onerror=s=>a(new Error(`Unable to load script '${r}': ${s}`)),e.appendChild(i)})}function NE(r,t,e){if(r===t)return!0;if(!e||!r||!t)return!1;if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let i=0;i<r.length;i++)if(!NE(r[i],t[i],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof r=="object"&&typeof t=="object"){const i=Object.keys(r),n=Object.keys(t);if(i.length!==n.length)return!1;for(const a of i)if(!t.hasOwnProperty(a)||!NE(r[a],t[a],e-1))return!1;return!0}return!1}function oet(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function uet(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}class cet{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}let bu=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(t){throw new Error("Cannot evaluate node")}evaluateString(t){return this.evaluate(t).toString()}search(t){}searchBlock(t,e){if(t){e(bb.instance);for(const i of t)i instanceof Array?this.searchBlock(i,e):i.search(e);e(wb.instance)}}};class bb extends bu{}bb.instance=new bb;class wb extends bu{}wb.instance=new wb;class Wi extends bu{constructor(){super()}}let FE=class extends Wi{constructor(t,e,i,n,a,s){super(),this.calls=new Set,this.name=t,this.args=e,this.returnType=i,this.body=n,this.startLine=a,this.endLine=s}get astNodeType(){return"function"}search(t){this.searchBlock(this.body,t)}};class het extends Wi{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}class fet extends Wi{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class det extends Wi{constructor(t){super(),this.body=t}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}class pet extends Wi{constructor(t,e,i,n){super(),this.init=t,this.condition=e,this.increment=i,this.body=n}get astNodeType(){return"for"}search(t){var e,i,n;(e=this.init)===null||e===void 0||e.search(t),(i=this.condition)===null||i===void 0||i.search(t),(n=this.increment)===null||n===void 0||n.search(t),this.searchBlock(this.body,t)}}class rf extends Wi{constructor(t,e,i,n,a){super(),this.name=t,this.type=e,this.storage=i,this.access=n,this.value=a}get astNodeType(){return"var"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class A8 extends Wi{constructor(t,e,i){super(),this.name=t,this.type=e,this.value=i}get astNodeType(){return"override"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class BE extends Wi{constructor(t,e,i,n,a){super(),this.name=t,this.type=e,this.storage=i,this.access=n,this.value=a}get astNodeType(){return"let"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class Y3 extends Wi{constructor(t,e,i,n,a){super(),this.name=t,this.type=e,this.storage=i,this.access=n,this.value=a}get astNodeType(){return"const"}evaluate(t){return this.value.evaluate(t)}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}var ag;(function(r){r.increment="++",r.decrement="--"})(ag||(ag={}));(function(r){function t(e){const i=e;if(i=="parse")throw new Error("Invalid value for IncrementOperator");return r[i]}r.parse=t})(ag||(ag={}));class get extends Wi{constructor(t,e){super(),this.operator=t,this.variable=e}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}var Sy;(function(r){r.assign="=",r.addAssign="+=",r.subtractAssin="-=",r.multiplyAssign="*=",r.divideAssign="/=",r.moduloAssign="%=",r.andAssign="&=",r.orAssign="|=",r.xorAssign="^=",r.shiftLeftAssign="<<=",r.shiftRightAssign=">>="})(Sy||(Sy={}));(function(r){function t(e){const i=e;if(i=="parse")throw new Error("Invalid value for AssignOperator");return i}r.parse=t})(Sy||(Sy={}));class vet extends Wi{constructor(t,e,i){super(),this.operator=t,this.variable=e,this.value=i}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class C8 extends Wi{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"call"}search(t){for(const e of this.args)e.search(t);t(this)}}class met extends Wi{constructor(t,e){super(),this.body=t,this.continuing=e}get astNodeType(){return"loop"}}class yet extends Wi{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"body"}}class _et extends Wi{constructor(t,e,i,n){super(),this.condition=t,this.body=e,this.elseif=i,this.else=n}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class xet extends Wi{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class bet extends Wi{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class wet extends Wi{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class Tet extends Wi{constructor(t,e){super(),this.severity=t,this.rule=e}get astNodeType(){return"diagnostic"}}class E8 extends Wi{constructor(t,e){super(),this.name=t,this.type=e}get astNodeType(){return"alias"}}class Aet extends Wi{constructor(){super()}get astNodeType(){return"discard"}}class Cet extends Wi{constructor(){super()}get astNodeType(){return"break"}}class Eet extends Wi{constructor(){super()}get astNodeType(){return"continue"}}class Jf extends Wi{constructor(t){super(),this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Zh extends Jf{constructor(t,e,i,n){super(t),this.members=e,this.startLine=i,this.endLine=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let e=0;e<this.members.length;e++)if(this.members[e].name==t)return e;return-1}}class I8 extends Jf{constructor(t,e,i){super(t),this.format=e,this.access=i}get astNodeType(){return"template"}}class Iet extends Jf{constructor(t,e,i,n){super(t),this.storage=e,this.type=i,this.access=n}get astNodeType(){return"pointer"}}class M8 extends Jf{constructor(t,e,i,n){super(t),this.attributes=e,this.format=i,this.count=n}get astNodeType(){return"array"}get isArray(){return!0}}class Dm extends Jf{constructor(t,e,i){super(t),this.format=e,this.access=i}get astNodeType(){return"sampler"}}class Cl extends bu{constructor(){super()}}class Met extends Cl{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Ep extends Cl{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const e of this.args)e.search(t)}evaluate(t){return this.args[0].evaluate(t)}}class P8 extends Cl{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"callExpr"}evaluate(t){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(t));case"acos":return Math.acos(this.args[0].evaluate(t));case"acosh":return Math.acosh(this.args[0].evaluate(t));case"asin":return Math.asin(this.args[0].evaluate(t));case"asinh":return Math.asinh(this.args[0].evaluate(t));case"atan":return Math.atan(this.args[0].evaluate(t));case"atan2":return Math.atan2(this.args[0].evaluate(t),this.args[1].evaluate(t));case"atanh":return Math.atanh(this.args[0].evaluate(t));case"ceil":return Math.ceil(this.args[0].evaluate(t));case"clamp":return Math.min(Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t)),this.args[2].evaluate(t));case"cos":return Math.cos(this.args[0].evaluate(t));case"degrees":return this.args[0].evaluate(t)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(t)-this.args[1].evaluate(t),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(t));case"exp2":return Math.pow(2,this.args[0].evaluate(t));case"floor":return Math.floor(this.args[0].evaluate(t));case"fma":return this.args[0].evaluate(t)*this.args[1].evaluate(t)+this.args[2].evaluate(t);case"fract":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(t));case"log":return Math.log(this.args[0].evaluate(t));case"log2":return Math.log2(this.args[0].evaluate(t));case"max":return Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t));case"min":return Math.min(this.args[0].evaluate(t),this.args[1].evaluate(t));case"mix":return this.args[0].evaluate(t)*(1-this.args[2].evaluate(t))+this.args[1].evaluate(t)*this.args[2].evaluate(t);case"modf":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"pow":return Math.pow(this.args[0].evaluate(t),this.args[1].evaluate(t));case"radians":return this.args[0].evaluate(t)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(t));case"sign":return Math.sign(this.args[0].evaluate(t));case"sin":return Math.sin(this.args[0].evaluate(t));case"sinh":return Math.sinh(this.args[0].evaluate(t));case"saturate":return Math.min(Math.max(this.args[0].evaluate(t),0),1);case"smoothstep":return this.args[0].evaluate(t)*this.args[0].evaluate(t)*(3-2*this.args[0].evaluate(t));case"sqrt":return Math.sqrt(this.args[0].evaluate(t));case"step":return this.args[0].evaluate(t)<this.args[1].evaluate(t)?0:1;case"tan":return Math.tan(this.args[0].evaluate(t));case"tanh":return Math.tanh(this.args[0].evaluate(t));case"trunc":return Math.trunc(this.args[0].evaluate(t));default:throw new Error("Non const function: "+this.name)}}search(t){for(const e of this.args)e.search(t);t(this)}}class zE extends Cl{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}evaluate(t){const e=t.constants.get(this.name);if(!e)throw new Error("Cannot evaluate node");return e.evaluate(t)}}class K3 extends Cl{constructor(t,e){super(),this.name=t,this.initializer=e}get astNodeType(){return"constExpr"}evaluate(t){var e,i;if(this.initializer instanceof Ep){const n=(e=this.postfix)===null||e===void 0?void 0:e.evaluateString(t),a=(i=this.initializer.type)===null||i===void 0?void 0:i.name,s=t.structs.get(a),o=s==null?void 0:s.getMemberIndex(n);return o!==void 0&&o!=-1?this.initializer.args[o].evaluate(t):this.initializer.evaluate(t)}return this.initializer.evaluate(t)}search(t){this.initializer.search(t)}}class J3 extends Cl{constructor(t){super(),this.value=t}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class Pet extends Cl{constructor(t,e){super(),this.type=t,this.value=e}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class Q3 extends Cl{constructor(t){super(),this.contents=t}get astNodeType(){return"groupExpr"}evaluate(t){return this.contents[0].evaluate(t)}search(t){this.searchBlock(this.contents,t)}}class Ret extends Cl{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class R8 extends Cl{constructor(){super()}}class Det extends R8{constructor(t,e){super(),this.operator=t,this.right=e}get astNodeType(){return"unaryOp"}evaluate(t){switch(this.operator){case"+":return this.right.evaluate(t);case"-":return-this.right.evaluate(t);case"!":return this.right.evaluate(t)?0:1;case"~":return~this.right.evaluate(t);default:throw new Error("Unknown unary operator: "+this.operator)}}search(t){this.right.search(t)}}class Ko extends R8{constructor(t,e,i){super(),this.operator=t,this.left=e,this.right=i}get astNodeType(){return"binaryOp"}evaluate(t){switch(this.operator){case"+":return this.left.evaluate(t)+this.right.evaluate(t);case"-":return this.left.evaluate(t)-this.right.evaluate(t);case"*":return this.left.evaluate(t)*this.right.evaluate(t);case"/":return this.left.evaluate(t)/this.right.evaluate(t);case"%":return this.left.evaluate(t)%this.right.evaluate(t);case"==":return this.left.evaluate(t)==this.right.evaluate(t)?1:0;case"!=":return this.left.evaluate(t)!=this.right.evaluate(t)?1:0;case"<":return this.left.evaluate(t)<this.right.evaluate(t)?1:0;case">":return this.left.evaluate(t)>this.right.evaluate(t)?1:0;case"<=":return this.left.evaluate(t)<=this.right.evaluate(t)?1:0;case">=":return this.left.evaluate(t)>=this.right.evaluate(t)?1:0;case"&&":return this.left.evaluate(t)&&this.right.evaluate(t)?1:0;case"||":return this.left.evaluate(t)||this.right.evaluate(t)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(t){this.left.search(t),this.right.search(t)}}class D8 extends bu{constructor(){super()}}class Let extends D8{constructor(t,e){super(),this.selector=t,this.body=e}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class ket extends D8{constructor(t){super(),this.body=t}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class Oet extends bu{constructor(t,e,i){super(),this.name=t,this.type=e,this.attributes=i}get astNodeType(){return"argument"}}class Net extends bu{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class Fet extends bu{constructor(t,e,i){super(),this.name=t,this.type=e,this.attributes=i}get astNodeType(){return"member"}}let Bet=class extends bu{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}};var Wt,Bt;(function(r){r[r.token=0]="token",r[r.keyword=1]="keyword",r[r.reserved=2]="reserved"})(Bt||(Bt={}));class zt{constructor(t,e,i){this.name=t,this.type=e,this.rule=i}toString(){return this.name}}class mt{}Wt=mt;mt.none=new zt("",Bt.reserved,"");mt.eof=new zt("EOF",Bt.token,"");mt.reserved={asm:new zt("asm",Bt.reserved,"asm"),bf16:new zt("bf16",Bt.reserved,"bf16"),do:new zt("do",Bt.reserved,"do"),enum:new zt("enum",Bt.reserved,"enum"),f16:new zt("f16",Bt.reserved,"f16"),f64:new zt("f64",Bt.reserved,"f64"),handle:new zt("handle",Bt.reserved,"handle"),i8:new zt("i8",Bt.reserved,"i8"),i16:new zt("i16",Bt.reserved,"i16"),i64:new zt("i64",Bt.reserved,"i64"),mat:new zt("mat",Bt.reserved,"mat"),premerge:new zt("premerge",Bt.reserved,"premerge"),regardless:new zt("regardless",Bt.reserved,"regardless"),typedef:new zt("typedef",Bt.reserved,"typedef"),u8:new zt("u8",Bt.reserved,"u8"),u16:new zt("u16",Bt.reserved,"u16"),u64:new zt("u64",Bt.reserved,"u64"),unless:new zt("unless",Bt.reserved,"unless"),using:new zt("using",Bt.reserved,"using"),vec:new zt("vec",Bt.reserved,"vec"),void:new zt("void",Bt.reserved,"void")};mt.keywords={array:new zt("array",Bt.keyword,"array"),atomic:new zt("atomic",Bt.keyword,"atomic"),bool:new zt("bool",Bt.keyword,"bool"),f32:new zt("f32",Bt.keyword,"f32"),i32:new zt("i32",Bt.keyword,"i32"),mat2x2:new zt("mat2x2",Bt.keyword,"mat2x2"),mat2x3:new zt("mat2x3",Bt.keyword,"mat2x3"),mat2x4:new zt("mat2x4",Bt.keyword,"mat2x4"),mat3x2:new zt("mat3x2",Bt.keyword,"mat3x2"),mat3x3:new zt("mat3x3",Bt.keyword,"mat3x3"),mat3x4:new zt("mat3x4",Bt.keyword,"mat3x4"),mat4x2:new zt("mat4x2",Bt.keyword,"mat4x2"),mat4x3:new zt("mat4x3",Bt.keyword,"mat4x3"),mat4x4:new zt("mat4x4",Bt.keyword,"mat4x4"),ptr:new zt("ptr",Bt.keyword,"ptr"),sampler:new zt("sampler",Bt.keyword,"sampler"),sampler_comparison:new zt("sampler_comparison",Bt.keyword,"sampler_comparison"),struct:new zt("struct",Bt.keyword,"struct"),texture_1d:new zt("texture_1d",Bt.keyword,"texture_1d"),texture_2d:new zt("texture_2d",Bt.keyword,"texture_2d"),texture_2d_array:new zt("texture_2d_array",Bt.keyword,"texture_2d_array"),texture_3d:new zt("texture_3d",Bt.keyword,"texture_3d"),texture_cube:new zt("texture_cube",Bt.keyword,"texture_cube"),texture_cube_array:new zt("texture_cube_array",Bt.keyword,"texture_cube_array"),texture_multisampled_2d:new zt("texture_multisampled_2d",Bt.keyword,"texture_multisampled_2d"),texture_storage_1d:new zt("texture_storage_1d",Bt.keyword,"texture_storage_1d"),texture_storage_2d:new zt("texture_storage_2d",Bt.keyword,"texture_storage_2d"),texture_storage_2d_array:new zt("texture_storage_2d_array",Bt.keyword,"texture_storage_2d_array"),texture_storage_3d:new zt("texture_storage_3d",Bt.keyword,"texture_storage_3d"),texture_depth_2d:new zt("texture_depth_2d",Bt.keyword,"texture_depth_2d"),texture_depth_2d_array:new zt("texture_depth_2d_array",Bt.keyword,"texture_depth_2d_array"),texture_depth_cube:new zt("texture_depth_cube",Bt.keyword,"texture_depth_cube"),texture_depth_cube_array:new zt("texture_depth_cube_array",Bt.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new zt("texture_depth_multisampled_2d",Bt.keyword,"texture_depth_multisampled_2d"),texture_external:new zt("texture_external",Bt.keyword,"texture_external"),u32:new zt("u32",Bt.keyword,"u32"),vec2:new zt("vec2",Bt.keyword,"vec2"),vec3:new zt("vec3",Bt.keyword,"vec3"),vec4:new zt("vec4",Bt.keyword,"vec4"),bitcast:new zt("bitcast",Bt.keyword,"bitcast"),block:new zt("block",Bt.keyword,"block"),break:new zt("break",Bt.keyword,"break"),case:new zt("case",Bt.keyword,"case"),continue:new zt("continue",Bt.keyword,"continue"),continuing:new zt("continuing",Bt.keyword,"continuing"),default:new zt("default",Bt.keyword,"default"),diagnostic:new zt("diagnostic",Bt.keyword,"diagnostic"),discard:new zt("discard",Bt.keyword,"discard"),else:new zt("else",Bt.keyword,"else"),enable:new zt("enable",Bt.keyword,"enable"),fallthrough:new zt("fallthrough",Bt.keyword,"fallthrough"),false:new zt("false",Bt.keyword,"false"),fn:new zt("fn",Bt.keyword,"fn"),for:new zt("for",Bt.keyword,"for"),function:new zt("function",Bt.keyword,"function"),if:new zt("if",Bt.keyword,"if"),let:new zt("let",Bt.keyword,"let"),const:new zt("const",Bt.keyword,"const"),loop:new zt("loop",Bt.keyword,"loop"),while:new zt("while",Bt.keyword,"while"),private:new zt("private",Bt.keyword,"private"),read:new zt("read",Bt.keyword,"read"),read_write:new zt("read_write",Bt.keyword,"read_write"),return:new zt("return",Bt.keyword,"return"),requires:new zt("requires",Bt.keyword,"requires"),storage:new zt("storage",Bt.keyword,"storage"),switch:new zt("switch",Bt.keyword,"switch"),true:new zt("true",Bt.keyword,"true"),alias:new zt("alias",Bt.keyword,"alias"),type:new zt("type",Bt.keyword,"type"),uniform:new zt("uniform",Bt.keyword,"uniform"),var:new zt("var",Bt.keyword,"var"),override:new zt("override",Bt.keyword,"override"),workgroup:new zt("workgroup",Bt.keyword,"workgroup"),write:new zt("write",Bt.keyword,"write"),r8unorm:new zt("r8unorm",Bt.keyword,"r8unorm"),r8snorm:new zt("r8snorm",Bt.keyword,"r8snorm"),r8uint:new zt("r8uint",Bt.keyword,"r8uint"),r8sint:new zt("r8sint",Bt.keyword,"r8sint"),r16uint:new zt("r16uint",Bt.keyword,"r16uint"),r16sint:new zt("r16sint",Bt.keyword,"r16sint"),r16float:new zt("r16float",Bt.keyword,"r16float"),rg8unorm:new zt("rg8unorm",Bt.keyword,"rg8unorm"),rg8snorm:new zt("rg8snorm",Bt.keyword,"rg8snorm"),rg8uint:new zt("rg8uint",Bt.keyword,"rg8uint"),rg8sint:new zt("rg8sint",Bt.keyword,"rg8sint"),r32uint:new zt("r32uint",Bt.keyword,"r32uint"),r32sint:new zt("r32sint",Bt.keyword,"r32sint"),r32float:new zt("r32float",Bt.keyword,"r32float"),rg16uint:new zt("rg16uint",Bt.keyword,"rg16uint"),rg16sint:new zt("rg16sint",Bt.keyword,"rg16sint"),rg16float:new zt("rg16float",Bt.keyword,"rg16float"),rgba8unorm:new zt("rgba8unorm",Bt.keyword,"rgba8unorm"),rgba8unorm_srgb:new zt("rgba8unorm_srgb",Bt.keyword,"rgba8unorm_srgb"),rgba8snorm:new zt("rgba8snorm",Bt.keyword,"rgba8snorm"),rgba8uint:new zt("rgba8uint",Bt.keyword,"rgba8uint"),rgba8sint:new zt("rgba8sint",Bt.keyword,"rgba8sint"),bgra8unorm:new zt("bgra8unorm",Bt.keyword,"bgra8unorm"),bgra8unorm_srgb:new zt("bgra8unorm_srgb",Bt.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new zt("rgb10a2unorm",Bt.keyword,"rgb10a2unorm"),rg11b10float:new zt("rg11b10float",Bt.keyword,"rg11b10float"),rg32uint:new zt("rg32uint",Bt.keyword,"rg32uint"),rg32sint:new zt("rg32sint",Bt.keyword,"rg32sint"),rg32float:new zt("rg32float",Bt.keyword,"rg32float"),rgba16uint:new zt("rgba16uint",Bt.keyword,"rgba16uint"),rgba16sint:new zt("rgba16sint",Bt.keyword,"rgba16sint"),rgba16float:new zt("rgba16float",Bt.keyword,"rgba16float"),rgba32uint:new zt("rgba32uint",Bt.keyword,"rgba32uint"),rgba32sint:new zt("rgba32sint",Bt.keyword,"rgba32sint"),rgba32float:new zt("rgba32float",Bt.keyword,"rgba32float"),static_assert:new zt("static_assert",Bt.keyword,"static_assert")};mt.tokens={decimal_float_literal:new zt("decimal_float_literal",Bt.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new zt("hex_float_literal",Bt.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new zt("int_literal",Bt.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new zt("uint_literal",Bt.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new zt("ident",Bt.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new zt("and",Bt.token,"&"),and_and:new zt("and_and",Bt.token,"&&"),arrow:new zt("arrow ",Bt.token,"->"),attr:new zt("attr",Bt.token,"@"),forward_slash:new zt("forward_slash",Bt.token,"/"),bang:new zt("bang",Bt.token,"!"),bracket_left:new zt("bracket_left",Bt.token,"["),bracket_right:new zt("bracket_right",Bt.token,"]"),brace_left:new zt("brace_left",Bt.token,"{"),brace_right:new zt("brace_right",Bt.token,"}"),colon:new zt("colon",Bt.token,":"),comma:new zt("comma",Bt.token,","),equal:new zt("equal",Bt.token,"="),equal_equal:new zt("equal_equal",Bt.token,"=="),not_equal:new zt("not_equal",Bt.token,"!="),greater_than:new zt("greater_than",Bt.token,">"),greater_than_equal:new zt("greater_than_equal",Bt.token,">="),shift_right:new zt("shift_right",Bt.token,">>"),less_than:new zt("less_than",Bt.token,"<"),less_than_equal:new zt("less_than_equal",Bt.token,"<="),shift_left:new zt("shift_left",Bt.token,"<<"),modulo:new zt("modulo",Bt.token,"%"),minus:new zt("minus",Bt.token,"-"),minus_minus:new zt("minus_minus",Bt.token,"--"),period:new zt("period",Bt.token,"."),plus:new zt("plus",Bt.token,"+"),plus_plus:new zt("plus_plus",Bt.token,"++"),or:new zt("or",Bt.token,"|"),or_or:new zt("or_or",Bt.token,"||"),paren_left:new zt("paren_left",Bt.token,"("),paren_right:new zt("paren_right",Bt.token,")"),semicolon:new zt("semicolon",Bt.token,";"),star:new zt("star",Bt.token,"*"),tilde:new zt("tilde",Bt.token,"~"),underscore:new zt("underscore",Bt.token,"_"),xor:new zt("xor",Bt.token,"^"),plus_equal:new zt("plus_equal",Bt.token,"+="),minus_equal:new zt("minus_equal",Bt.token,"-="),times_equal:new zt("times_equal",Bt.token,"*="),division_equal:new zt("division_equal",Bt.token,"/="),modulo_equal:new zt("modulo_equal",Bt.token,"%="),and_equal:new zt("and_equal",Bt.token,"&="),or_equal:new zt("or_equal",Bt.token,"|="),xor_equal:new zt("xor_equal",Bt.token,"^="),shift_right_equal:new zt("shift_right_equal",Bt.token,">>="),shift_left_equal:new zt("shift_left_equal",Bt.token,"<<=")};mt.simpleTokens={"@":Wt.tokens.attr,"{":Wt.tokens.brace_left,"}":Wt.tokens.brace_right,":":Wt.tokens.colon,",":Wt.tokens.comma,"(":Wt.tokens.paren_left,")":Wt.tokens.paren_right,";":Wt.tokens.semicolon};mt.literalTokens={"&":Wt.tokens.and,"&&":Wt.tokens.and_and,"->":Wt.tokens.arrow,"/":Wt.tokens.forward_slash,"!":Wt.tokens.bang,"[":Wt.tokens.bracket_left,"]":Wt.tokens.bracket_right,"=":Wt.tokens.equal,"==":Wt.tokens.equal_equal,"!=":Wt.tokens.not_equal,">":Wt.tokens.greater_than,">=":Wt.tokens.greater_than_equal,">>":Wt.tokens.shift_right,"<":Wt.tokens.less_than,"<=":Wt.tokens.less_than_equal,"<<":Wt.tokens.shift_left,"%":Wt.tokens.modulo,"-":Wt.tokens.minus,"--":Wt.tokens.minus_minus,".":Wt.tokens.period,"+":Wt.tokens.plus,"++":Wt.tokens.plus_plus,"|":Wt.tokens.or,"||":Wt.tokens.or_or,"*":Wt.tokens.star,"~":Wt.tokens.tilde,_:Wt.tokens.underscore,"^":Wt.tokens.xor,"+=":Wt.tokens.plus_equal,"-=":Wt.tokens.minus_equal,"*=":Wt.tokens.times_equal,"/=":Wt.tokens.division_equal,"%=":Wt.tokens.modulo_equal,"&=":Wt.tokens.and_equal,"|=":Wt.tokens.or_equal,"^=":Wt.tokens.xor_equal,">>=":Wt.tokens.shift_right_equal,"<<=":Wt.tokens.shift_left_equal};mt.regexTokens={decimal_float_literal:Wt.tokens.decimal_float_literal,hex_float_literal:Wt.tokens.hex_float_literal,int_literal:Wt.tokens.int_literal,uint_literal:Wt.tokens.uint_literal,ident:Wt.tokens.ident};mt.storage_class=[Wt.keywords.function,Wt.keywords.private,Wt.keywords.workgroup,Wt.keywords.uniform,Wt.keywords.storage];mt.access_mode=[Wt.keywords.read,Wt.keywords.write,Wt.keywords.read_write];mt.sampler_type=[Wt.keywords.sampler,Wt.keywords.sampler_comparison];mt.sampled_texture_type=[Wt.keywords.texture_1d,Wt.keywords.texture_2d,Wt.keywords.texture_2d_array,Wt.keywords.texture_3d,Wt.keywords.texture_cube,Wt.keywords.texture_cube_array];mt.multisampled_texture_type=[Wt.keywords.texture_multisampled_2d];mt.storage_texture_type=[Wt.keywords.texture_storage_1d,Wt.keywords.texture_storage_2d,Wt.keywords.texture_storage_2d_array,Wt.keywords.texture_storage_3d];mt.depth_texture_type=[Wt.keywords.texture_depth_2d,Wt.keywords.texture_depth_2d_array,Wt.keywords.texture_depth_cube,Wt.keywords.texture_depth_cube_array,Wt.keywords.texture_depth_multisampled_2d];mt.texture_external_type=[Wt.keywords.texture_external];mt.any_texture_type=[...Wt.sampled_texture_type,...Wt.multisampled_texture_type,...Wt.storage_texture_type,...Wt.depth_texture_type,...Wt.texture_external_type];mt.texel_format=[Wt.keywords.r8unorm,Wt.keywords.r8snorm,Wt.keywords.r8uint,Wt.keywords.r8sint,Wt.keywords.r16uint,Wt.keywords.r16sint,Wt.keywords.r16float,Wt.keywords.rg8unorm,Wt.keywords.rg8snorm,Wt.keywords.rg8uint,Wt.keywords.rg8sint,Wt.keywords.r32uint,Wt.keywords.r32sint,Wt.keywords.r32float,Wt.keywords.rg16uint,Wt.keywords.rg16sint,Wt.keywords.rg16float,Wt.keywords.rgba8unorm,Wt.keywords.rgba8unorm_srgb,Wt.keywords.rgba8snorm,Wt.keywords.rgba8uint,Wt.keywords.rgba8sint,Wt.keywords.bgra8unorm,Wt.keywords.bgra8unorm_srgb,Wt.keywords.rgb10a2unorm,Wt.keywords.rg11b10float,Wt.keywords.rg32uint,Wt.keywords.rg32sint,Wt.keywords.rg32float,Wt.keywords.rgba16uint,Wt.keywords.rgba16sint,Wt.keywords.rgba16float,Wt.keywords.rgba32uint,Wt.keywords.rgba32sint,Wt.keywords.rgba32float];mt.const_literal=[Wt.tokens.int_literal,Wt.tokens.uint_literal,Wt.tokens.decimal_float_literal,Wt.tokens.hex_float_literal,Wt.keywords.true,Wt.keywords.false];mt.literal_or_ident=[Wt.tokens.ident,Wt.tokens.int_literal,Wt.tokens.uint_literal,Wt.tokens.decimal_float_literal,Wt.tokens.hex_float_literal];mt.element_count_expression=[Wt.tokens.int_literal,Wt.tokens.uint_literal,Wt.tokens.ident];mt.template_types=[Wt.keywords.vec2,Wt.keywords.vec3,Wt.keywords.vec4,Wt.keywords.mat2x2,Wt.keywords.mat2x3,Wt.keywords.mat2x4,Wt.keywords.mat3x2,Wt.keywords.mat3x3,Wt.keywords.mat3x4,Wt.keywords.mat4x2,Wt.keywords.mat4x3,Wt.keywords.mat4x4,Wt.keywords.atomic,Wt.keywords.bitcast,...Wt.any_texture_type];mt.attribute_name=[Wt.tokens.ident,Wt.keywords.block,Wt.keywords.diagnostic];mt.assignment_operators=[Wt.tokens.equal,Wt.tokens.plus_equal,Wt.tokens.minus_equal,Wt.tokens.times_equal,Wt.tokens.division_equal,Wt.tokens.modulo_equal,Wt.tokens.and_equal,Wt.tokens.or_equal,Wt.tokens.xor_equal,Wt.tokens.shift_right_equal,Wt.tokens.shift_left_equal];mt.increment_operators=[Wt.tokens.plus_plus,Wt.tokens.minus_minus];class tO{constructor(t,e,i){this.type=t,this.lexeme=e,this.line=i}toString(){return this.lexeme}isTemplateType(){return mt.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==mt.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class zet{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new tO(mt.eof,"",this._line)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}const e=mt.simpleTokens[t];if(e)return this._addToken(e),!0;let i=mt.none;const n=this._isAlpha(t),a=t==="_";if(this._isAlphaNumeric(t)){let s=this._peekAhead();for(;this._isAlphaNumeric(s);)t+=this._advance(),s=this._peekAhead()}if(n){const s=mt.keywords[t];if(s)return this._addToken(s),!0}if(n||a)return this._addToken(mt.tokens.ident),!0;for(;;){let s=this._findType(t);const o=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(o=="=")return this._current++,t+=o,this._addToken(mt.tokens.minus_equal),!0;if(o=="-")return this._current++,t+=o,this._addToken(mt.tokens.minus_minus),!0;const l=this._tokens.length-1;if((mt.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==mt.tokens.paren_right)&&o!=">")return this._addToken(s),!0}if(t==">"&&(o==">"||o=="=")){let l=!1,u=this._tokens.length-1;for(let c=0;c<5&&u>=0&&mt.assignment_operators.indexOf(this._tokens[u].type)===-1;++c,--u)if(this._tokens[u].type===mt.tokens.less_than){u>0&&this._tokens[u-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(s),!0}if(s===mt.none){let l=t,u=0;const c=2;for(let h=0;h<c;++h)if(l+=this._peekAhead(h),s=this._findType(l),s!==mt.none){u=h;break}if(s===mt.none)return i===mt.none?!1:(this._current--,this._addToken(i),!0);t=l,this._current+=u+1}if(i=s,this._isAtEnd())break;t+=this._advance()}return i===mt.none?!1:(this._addToken(i),!0)}_findType(t){for(const i in mt.regexTokens){const n=mt.regexTokens[i];if(this._match(t,n.rule))return n}const e=mt.literalTokens[t];return e||mt.none}_match(t,e){const i=e.exec(t);return i&&i.index==0&&i[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}_isAlphaNumeric(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t=="_"||t>="0"&&t<="9"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let e=this._source[this._current];return t=t||0,t++,this._current+=t,e}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const e=this._source.substring(this._start,this._current);this._tokens.push(new tO(t,e,this._line))}}class Vet{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new cet,this._deferArrayCountEval=[]}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const e=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;e.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const n=i.arrayType,a=i.countNode;if(a instanceof zE){const o=a.name,l=this._context.constants.get(o);if(l)try{const u=l.evaluate(this._context);n.count=u}catch{}}}this._deferArrayCountEval.length=0}return e}_initialize(t){if(t)if(typeof t=="string"){const e=new zet(t);this._tokens=e.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_error(t,e){return{token:t,message:e,toString:function(){return`${e}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==mt.eof}_match(t){if(t instanceof zt)return this._check(t)?(this._advance(),!0):!1;for(let e=0,i=t.length;e<i;++e){const n=t[e];if(this._check(n))return this._advance(),!0}return!1}_consume(t,e){if(this._check(t))return this._advance();throw this._error(this._peek(),e)}_check(t){if(this._isAtEnd())return!1;const e=this._peek();if(t instanceof Array){const i=e.type;return t.indexOf(i)!=-1}return e.type==t}_advance(){var t,e;return this._currentLine=(e=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&e!==void 0?e:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(mt.tokens.semicolon)&&!this._isAtEnd(););if(this._match(mt.keywords.alias)){const e=this._type_alias();return this._consume(mt.tokens.semicolon,"Expected ';'"),e}if(this._match(mt.keywords.diagnostic)){const e=this._diagnostic();return this._consume(mt.tokens.semicolon,"Expected ';'"),e}if(this._match(mt.keywords.requires)){const e=this._requires_directive();return this._consume(mt.tokens.semicolon,"Expected ';'"),e}if(this._match(mt.keywords.enable)){const e=this._enable_directive();return this._consume(mt.tokens.semicolon,"Expected ';'"),e}const t=this._attribute();if(this._check(mt.keywords.var)){const e=this._global_variable_decl();return e!=null&&(e.attributes=t),this._consume(mt.tokens.semicolon,"Expected ';'."),e}if(this._check(mt.keywords.override)){const e=this._override_variable_decl();return e!=null&&(e.attributes=t),this._consume(mt.tokens.semicolon,"Expected ';'."),e}if(this._check(mt.keywords.let)){const e=this._global_let_decl();return e!=null&&(e.attributes=t),this._consume(mt.tokens.semicolon,"Expected ';'."),e}if(this._check(mt.keywords.const)){const e=this._global_const_decl();return e!=null&&(e.attributes=t),this._consume(mt.tokens.semicolon,"Expected ';'."),e}if(this._check(mt.keywords.struct)){const e=this._struct_decl();return e!=null&&(e.attributes=t),e}if(this._check(mt.keywords.fn)){const e=this._function_decl();return e!=null&&(e.attributes=t),e}return null}_function_decl(){if(!this._match(mt.keywords.fn))return null;const t=this._currentLine,e=this._consume(mt.tokens.ident,"Expected function name.").toString();this._consume(mt.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(mt.tokens.paren_right))do{if(this._check(mt.tokens.paren_right))break;const o=this._attribute(),l=this._consume(mt.tokens.ident,"Expected argument name.").toString();this._consume(mt.tokens.colon,"Expected ':' for argument type.");const u=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=u,i.push(new Oet(l,c,o)))}while(this._match(mt.tokens.comma));this._consume(mt.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(mt.tokens.arrow)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}const a=this._compound_statement(),s=this._currentLine;return new FE(e,i,n,a,t,s)}_compound_statement(){const t=[];for(this._consume(mt.tokens.brace_left,"Expected '{' for block.");!this._check(mt.tokens.brace_right);){const e=this._statement();e!==null&&t.push(e)}return this._consume(mt.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(mt.tokens.semicolon)&&!this._isAtEnd(););if(this._check(mt.tokens.attr)&&this._attribute(),this._check(mt.keywords.if))return this._if_statement();if(this._check(mt.keywords.switch))return this._switch_statement();if(this._check(mt.keywords.loop))return this._loop_statement();if(this._check(mt.keywords.for))return this._for_statement();if(this._check(mt.keywords.while))return this._while_statement();if(this._check(mt.keywords.continuing))return this._continuing_statement();if(this._check(mt.keywords.static_assert))return this._static_assert_statement();if(this._check(mt.tokens.brace_left))return this._compound_statement();let t=null;return this._check(mt.keywords.return)?t=this._return_statement():this._check([mt.keywords.var,mt.keywords.let,mt.keywords.const])?t=this._variable_statement():this._match(mt.keywords.discard)?t=new Aet:this._match(mt.keywords.break)?t=new Cet:this._match(mt.keywords.continue)?t=new Eet:t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),t!=null&&this._consume(mt.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(mt.keywords.static_assert))return null;const t=this._optional_paren_expression();return new het(t)}_while_statement(){if(!this._match(mt.keywords.while))return null;const t=this._optional_paren_expression();this._check(mt.tokens.attr)&&this._attribute();const e=this._compound_statement();return new fet(t,e)}_continuing_statement(){if(!this._match(mt.keywords.continuing))return null;const t=this._compound_statement();return new det(t)}_for_statement(){if(!this._match(mt.keywords.for))return null;this._consume(mt.tokens.paren_left,"Expected '('.");const t=this._check(mt.tokens.semicolon)?null:this._for_init();this._consume(mt.tokens.semicolon,"Expected ';'.");const e=this._check(mt.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(mt.tokens.semicolon,"Expected ';'.");const i=this._check(mt.tokens.paren_right)?null:this._for_increment();this._consume(mt.tokens.paren_right,"Expected ')'."),this._check(mt.tokens.attr)&&this._attribute();const n=this._compound_statement();return new pet(t,e,i,n)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(mt.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let e=null;return this._match(mt.tokens.equal)&&(e=this._short_circuit_or_expression()),new rf(t.name,t.type,t.storage,t.access,e)}if(this._match(mt.keywords.let)){const t=this._consume(mt.tokens.ident,"Expected name for let.").toString();let e=null;if(this._match(mt.tokens.colon)){const n=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=n)}this._consume(mt.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return new BE(t,e,null,null,i)}if(this._match(mt.keywords.const)){const t=this._consume(mt.tokens.ident,"Expected name for const.").toString();let e=null;if(this._match(mt.tokens.colon)){const n=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=n)}this._consume(mt.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return new Y3(t,e,null,null,i)}return null}_increment_decrement_statement(){const t=this._current,e=this._unary_expression();if(e==null)return null;if(!this._check(mt.increment_operators))return this._current=t,null;const i=this._consume(mt.increment_operators,"Expected increment operator");return new get(i.type===mt.tokens.plus_plus?ag.increment:ag.decrement,e)}_assignment_statement(){let t=null;if(this._check(mt.tokens.brace_right))return null;let e=this._match(mt.tokens.underscore);if(e||(t=this._unary_expression()),!e&&t==null)return null;const i=this._consume(mt.assignment_operators,"Expected assignment operator."),n=this._short_circuit_or_expression();return new vet(Sy.parse(i.lexeme),t,n)}_func_call_statement(){if(!this._check(mt.tokens.ident))return null;const t=this._current,e=this._consume(mt.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=t,null):new C8(e.lexeme,i)}_loop_statement(){if(!this._match(mt.keywords.loop))return null;this._check(mt.tokens.attr)&&this._attribute(),this._consume(mt.tokens.brace_left,"Expected '{' for loop.");const t=[];let e=this._statement();for(;e!==null;){if(Array.isArray(e))for(let n of e)t.push(n);else t.push(e);e=this._statement()}let i=null;return this._match(mt.keywords.continuing)&&(i=this._compound_statement()),this._consume(mt.tokens.brace_right,"Expected '}' for loop."),new met(t,i)}_switch_statement(){if(!this._match(mt.keywords.switch))return null;const t=this._optional_paren_expression();this._check(mt.tokens.attr)&&this._attribute(),this._consume(mt.tokens.brace_left,"Expected '{' for switch.");const e=this._switch_body();if(e==null||e.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(mt.tokens.brace_right,"Expected '}' for switch."),new yet(t,e)}_switch_body(){const t=[];if(this._match(mt.keywords.case)){const e=this._case_selectors();this._match(mt.tokens.colon),this._check(mt.tokens.attr)&&this._attribute(),this._consume(mt.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(mt.tokens.brace_right,"Exected '}' for switch case."),t.push(new Let(e,i))}if(this._match(mt.keywords.default)){this._match(mt.tokens.colon),this._check(mt.tokens.attr)&&this._attribute(),this._consume(mt.tokens.brace_left,"Exected '{' for switch default.");const e=this._case_body();this._consume(mt.tokens.brace_right,"Exected '}' for switch default."),t.push(new ket(e))}if(this._check([mt.keywords.default,mt.keywords.case])){const e=this._switch_body();t.push(e[0])}return t}_case_selectors(){const t=[this._shift_expression()];for(;this._match(mt.tokens.comma);)t.push(this._shift_expression());return t}_case_body(){if(this._match(mt.keywords.fallthrough))return this._consume(mt.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const e=this._case_body();return e.length==0?t:[...t,e[0]]}_if_statement(){if(!this._match(mt.keywords.if))return null;const t=this._optional_paren_expression();this._check(mt.tokens.attr)&&this._attribute();const e=this._compound_statement();let i=[];this._match_elseif()&&(this._check(mt.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let n=null;return this._match(mt.keywords.else)&&(this._check(mt.tokens.attr)&&this._attribute(),n=this._compound_statement()),new _et(t,e,i,n)}_match_elseif(){return this._tokens[this._current].type===mt.keywords.else&&this._tokens[this._current+1].type===mt.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(t=[]){const e=this._optional_paren_expression(),i=this._compound_statement();return t.push(new Net(e,i)),this._match_elseif()&&(this._check(mt.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(mt.keywords.return))return null;const t=this._short_circuit_or_expression();return new xet(t)}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(mt.tokens.or_or);)t=new Ko(this._previous().toString(),t,this._short_circuit_and_expr());return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(mt.tokens.and_and);)t=new Ko(this._previous().toString(),t,this._inclusive_or_expression());return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(mt.tokens.or);)t=new Ko(this._previous().toString(),t,this._exclusive_or_expression());return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(mt.tokens.xor);)t=new Ko(this._previous().toString(),t,this._and_expression());return t}_and_expression(){let t=this._equality_expression();for(;this._match(mt.tokens.and);)t=new Ko(this._previous().toString(),t,this._equality_expression());return t}_equality_expression(){const t=this._relational_expression();return this._match([mt.tokens.equal_equal,mt.tokens.not_equal])?new Ko(this._previous().toString(),t,this._relational_expression()):t}_relational_expression(){let t=this._shift_expression();for(;this._match([mt.tokens.less_than,mt.tokens.greater_than,mt.tokens.less_than_equal,mt.tokens.greater_than_equal]);)t=new Ko(this._previous().toString(),t,this._shift_expression());return t}_shift_expression(){let t=this._additive_expression();for(;this._match([mt.tokens.shift_left,mt.tokens.shift_right]);)t=new Ko(this._previous().toString(),t,this._additive_expression());return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([mt.tokens.plus,mt.tokens.minus]);)t=new Ko(this._previous().toString(),t,this._multiplicative_expression());return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([mt.tokens.star,mt.tokens.forward_slash,mt.tokens.modulo]);)t=new Ko(this._previous().toString(),t,this._unary_expression());return t}_unary_expression(){return this._match([mt.tokens.minus,mt.tokens.bang,mt.tokens.tilde,mt.tokens.star,mt.tokens.and])?new Det(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),e=this._postfix_expression();return e&&(t.postfix=e),t}_postfix_expression(){if(this._match(mt.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(mt.tokens.bracket_right,"Expected ']'.");const e=new Ret(t),i=this._postfix_expression();return i&&(e.postfix=i),e}if(this._match(mt.tokens.period)){const t=this._consume(mt.tokens.ident,"Expected member name."),e=this._postfix_expression(),i=new Met(t.lexeme);return e&&(i.postfix=e),i}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_primary_expression(){if(this._match(mt.tokens.ident)){const i=this._previous().toString();if(this._check(mt.tokens.paren_left)){const n=this._argument_expression_list(),a=this._getStruct(i);return a!=null?new Ep(a,n):new P8(i,n)}if(this._context.constants.has(i)){const n=this._context.constants.get(i);return new K3(i,n.value)}return new zE(i)}if(this._match(mt.const_literal))return new J3(parseFloat(this._previous().toString()));if(this._check(mt.tokens.paren_left))return this._paren_expression();if(this._match(mt.keywords.bitcast)){this._consume(mt.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(mt.tokens.greater_than,"Expected '>'.");const n=this._paren_expression();return new Pet(i,n)}const t=this._type_decl(),e=this._argument_expression_list();return new Ep(t,e)}_argument_expression_list(){if(!this._match(mt.tokens.paren_left))return null;const t=[];do{if(this._check(mt.tokens.paren_right))break;const e=this._short_circuit_or_expression();t.push(e)}while(this._match(mt.tokens.comma));return this._consume(mt.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(mt.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(mt.tokens.paren_right),new Q3([t])}_paren_expression(){this._consume(mt.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(mt.tokens.paren_right,"Expected ')'."),new Q3([t])}_struct_decl(){if(!this._match(mt.keywords.struct))return null;const t=this._currentLine,e=this._consume(mt.tokens.ident,"Expected name for struct.").toString();this._consume(mt.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(mt.tokens.brace_right);){const s=this._attribute(),o=this._consume(mt.tokens.ident,"Expected variable name.").toString();this._consume(mt.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=l),this._check(mt.tokens.brace_right)?this._match(mt.tokens.comma):this._consume(mt.tokens.comma,"Expected ',' for struct member."),i.push(new Fet(o,u,s))}this._consume(mt.tokens.brace_right,"Expected '}' after struct body.");const n=this._currentLine,a=new Zh(e,i,t,n);return this._context.structs.set(e,a),a}_global_variable_decl(){const t=this._variable_decl();return t&&this._match(mt.tokens.equal)&&(t.value=this._const_expression()),t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(mt.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){if(!this._match(mt.keywords.const))return null;const t=this._consume(mt.tokens.ident,"Expected variable name");let e=null;if(this._match(mt.tokens.colon)){const a=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=a)}let i=null;if(this._match(mt.tokens.equal)){const a=this._short_circuit_or_expression();if(a instanceof Ep)i=a;else if(a instanceof K3&&a.initializer instanceof Ep)i=a.initializer;else try{const s=a.evaluate(this._context);i=new J3(s)}catch{i=a}}const n=new Y3(t.toString(),e,"","",i);return this._context.constants.set(n.name,n),n}_global_let_decl(){if(!this._match(mt.keywords.let))return null;const t=this._consume(mt.tokens.ident,"Expected variable name");let e=null;if(this._match(mt.tokens.colon)){const n=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=n)}let i=null;return this._match(mt.tokens.equal)&&(i=this._const_expression()),new BE(t.toString(),e,"","",i)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(mt.keywords.var))return null;let t="",e="";this._match(mt.tokens.less_than)&&(t=this._consume(mt.storage_class,"Expected storage_class.").toString(),this._match(mt.tokens.comma)&&(e=this._consume(mt.access_mode,"Expected access_mode.").toString()),this._consume(mt.tokens.greater_than,"Expected '>'."));const i=this._consume(mt.tokens.ident,"Expected variable name");let n=null;if(this._match(mt.tokens.colon)){const a=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=a)}return new rf(i.toString(),n,t,e,null)}_override_decl(){if(!this._match(mt.keywords.override))return null;const t=this._consume(mt.tokens.ident,"Expected variable name");let e=null;if(this._match(mt.tokens.colon)){const i=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=i)}return new A8(t.toString(),e,null)}_diagnostic(){this._consume(mt.tokens.paren_left,"Expected '('");const t=this._consume(mt.tokens.ident,"Expected severity control name.");this._consume(mt.tokens.comma,"Expected ','");const e=this._consume(mt.tokens.ident,"Expected diagnostic rule name.");return this._consume(mt.tokens.paren_right,"Expected ')'"),new Tet(t.toString(),e.toString())}_enable_directive(){const t=this._consume(mt.tokens.ident,"identity expected.");return new bet(t.toString())}_requires_directive(){const t=[this._consume(mt.tokens.ident,"identity expected.").toString()];for(;this._match(mt.tokens.comma);){const e=this._consume(mt.tokens.ident,"identity expected.");t.push(e.toString())}return new wet(t)}_type_alias(){const t=this._consume(mt.tokens.ident,"identity expected.");this._consume(mt.tokens.equal,"Expected '=' for type alias.");let e=this._type_decl();if(e===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);const i=new E8(t.toString(),e);return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([mt.tokens.ident,...mt.texel_format,mt.keywords.bool,mt.keywords.f32,mt.keywords.i32,mt.keywords.u32])){const i=this._advance(),n=i.toString();return this._context.structs.has(n)?this._context.structs.get(n):this._context.aliases.has(n)?this._context.aliases.get(n).type:new Jf(i.toString())}let t=this._texture_sampler_types();if(t)return t;if(this._check(mt.template_types)){let i=this._advance().toString(),n=null,a=null;return this._match(mt.tokens.less_than)&&(n=this._type_decl(),a=null,this._match(mt.tokens.comma)&&(a=this._consume(mt.access_mode,"Expected access_mode for pointer").toString()),this._consume(mt.tokens.greater_than,"Expected '>' for type.")),new I8(i,n,a)}if(this._match(mt.keywords.ptr)){let i=this._previous().toString();this._consume(mt.tokens.less_than,"Expected '<' for pointer.");const n=this._consume(mt.storage_class,"Expected storage_class for pointer");this._consume(mt.tokens.comma,"Expected ',' for pointer.");const a=this._type_decl();let s=null;return this._match(mt.tokens.comma)&&(s=this._consume(mt.access_mode,"Expected access_mode for pointer").toString()),this._consume(mt.tokens.greater_than,"Expected '>' for pointer."),new Iet(i,n.toString(),a,s)}const e=this._attribute();if(this._match(mt.keywords.array)){let i=null,n=-1;const a=this._previous();let s=null;if(this._match(mt.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let l="";if(this._match(mt.tokens.comma)){s=this._shift_expression();try{l=s.evaluate(this._context).toString(),s=null}catch{l="1"}}this._consume(mt.tokens.greater_than,"Expected '>' for array."),n=l?parseInt(l):0}const o=new M8(a.toString(),e,i,n);return s&&this._deferArrayCountEval.push({arrayType:o,countNode:s}),o}return null}_texture_sampler_types(){if(this._match(mt.sampler_type))return new Dm(this._previous().toString(),null,null);if(this._match(mt.depth_texture_type))return new Dm(this._previous().toString(),null,null);if(this._match(mt.sampled_texture_type)||this._match(mt.multisampled_texture_type)){const t=this._previous();this._consume(mt.tokens.less_than,"Expected '<' for sampler type.");const e=this._type_decl();return this._consume(mt.tokens.greater_than,"Expected '>' for sampler type."),new Dm(t.toString(),e,null)}if(this._match(mt.storage_texture_type)){const t=this._previous();this._consume(mt.tokens.less_than,"Expected '<' for sampler type.");const e=this._consume(mt.texel_format,"Invalid texel format.").toString();this._consume(mt.tokens.comma,"Expected ',' after texel format.");const i=this._consume(mt.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(mt.tokens.greater_than,"Expected '>' for sampler type."),new Dm(t.toString(),e,i)}return null}_attribute(){let t=[];for(;this._match(mt.tokens.attr);){const e=this._consume(mt.attribute_name,"Expected attribute name"),i=new Bet(e.toString(),null);if(this._match(mt.tokens.paren_left)){if(i.value=this._consume(mt.literal_or_ident,"Expected attribute value").toString(),this._check(mt.tokens.comma)){this._advance();do{const n=this._consume(mt.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(n)}while(this._match(mt.tokens.comma))}this._consume(mt.tokens.paren_right,"Expected ')'")}t.push(i)}return t.length==0?null:t}}class Gp{constructor(t,e){this.name=t,this.attributes=e,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class eO{constructor(t,e,i){this.name=t,this.type=e,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class q0 extends Gp{constructor(t,e){super(t,e),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class dA extends Gp{constructor(t,e){super(t,e),this.count=0,this.stride=0}get isArray(){return!0}}class rO extends Gp{constructor(t,e,i,n){super(t,i),this.format=e,this.access=n}get isTemplate(){return!0}}var oc;(function(r){r[r.Uniform=0]="Uniform",r[r.Storage=1]="Storage",r[r.Texture=2]="Texture",r[r.Sampler=3]="Sampler",r[r.StorageTexture=4]="StorageTexture"})(oc||(oc={}));class Y0{constructor(t,e,i,n,a,s,o){this.name=t,this.type=e,this.group=i,this.binding=n,this.attributes=a,this.resourceType=s,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Uet{constructor(t,e){this.name=t,this.type=e}}class K0{constructor(t,e){this.align=t,this.size=e}}class $et{constructor(t,e,i,n){this.name=t,this.type=e,this.locationType=i,this.location=n,this.interpolation=null}}class iO{constructor(t,e,i,n){this.name=t,this.type=e,this.locationType=i,this.location=n}}class Wet{constructor(t,e,i,n){this.name=t,this.type=e,this.attributes=i,this.id=n}}class Het{constructor(t,e){this.name=t,this.type=e}}class Get{constructor(t,e=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=e}}class jet{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class Xet{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class tu{constructor(t){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new jet,this.functions=[],this._types=new Map,this._functions=new Map,t&&this.update(t)}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}update(t){const i=new Vet().parse(t);for(const n of i)n instanceof FE&&this._functions.set(n.name,new Xet(n));for(const n of i)if(n instanceof Zh){const a=this._getTypeInfo(n,null);a instanceof q0&&this.structs.push(a)}for(const n of i){if(n instanceof E8){this.aliases.push(this._getAliasInfo(n));continue}if(n instanceof A8){const a=n,s=this._getAttributeNum(a.attributes,"id",0),o=a.type!=null?this._getTypeInfo(a.type,a.attributes):null;this.overrides.push(new Wet(a.name,o,a.attributes,s));continue}if(this._isUniformVar(n)){const a=n,s=this._getAttributeNum(a.attributes,"group",0),o=this._getAttributeNum(a.attributes,"binding",0),l=this._getTypeInfo(a.type,a.attributes),u=new Y0(a.name,l,s,o,a.attributes,oc.Uniform,a.access);this.uniforms.push(u);continue}if(this._isStorageVar(n)){const a=n,s=this._getAttributeNum(a.attributes,"group",0),o=this._getAttributeNum(a.attributes,"binding",0),l=this._getTypeInfo(a.type,a.attributes),u=this._isStorageTexture(l),c=new Y0(a.name,l,s,o,a.attributes,u?oc.StorageTexture:oc.Storage,a.access);this.storage.push(c);continue}if(this._isTextureVar(n)){const a=n,s=this._getAttributeNum(a.attributes,"group",0),o=this._getAttributeNum(a.attributes,"binding",0),l=this._getTypeInfo(a.type,a.attributes),u=this._isStorageTexture(l),c=new Y0(a.name,l,s,o,a.attributes,u?oc.StorageTexture:oc.Texture,a.access);u?this.storage.push(c):this.textures.push(c);continue}if(this._isSamplerVar(n)){const a=n,s=this._getAttributeNum(a.attributes,"group",0),o=this._getAttributeNum(a.attributes,"binding",0),l=this._getTypeInfo(a.type,a.attributes),u=new Y0(a.name,l,s,o,a.attributes,oc.Sampler,a.access);this.samplers.push(u);continue}if(n instanceof FE){const a=this._getAttribute(n,"vertex"),s=this._getAttribute(n,"fragment"),o=this._getAttribute(n,"compute"),l=a||s||o,u=new Get(n.name,l==null?void 0:l.name);u.startLine=n.startLine,u.endLine=n.endLine,this.functions.push(u),this._functions.get(n.name).info=u,l?(this._functions.get(n.name).inUse=!0,u.inUse=!0,u.resources=this._findResources(n,!!l),u.inputs=this._getInputs(n.args),u.outputs=this._getOutputs(n.returnType),this.entry[l.name].push(u)):(u.arguments=n.args.map(c=>new Het(c.name,this._getTypeInfo(c.type,c.attributes))),u.returnType=n.returnType?this._getTypeInfo(n.returnType,n.attributes):null);continue}}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(a=>{var s;if(a.astNodeType==="varExpr"){const o=a;for(const l of this.overrides)o.name==l.name&&((s=n.info)===null||s===void 0||s.overrides.push(l))}});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const e of t.members)this._markStructsInUse(e.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const e=this._getAlias(t.name);e&&this._markStructsInUse(e)}}_addCalls(t,e){var i;for(const n of t.calls){const a=(i=this._functions.get(n.name))===null||i===void 0?void 0:i.info;a&&e.add(a)}}findResource(t,e){for(const i of this.uniforms)if(i.group==t&&i.binding==e)return i;for(const i of this.storage)if(i.group==t&&i.binding==e)return i;for(const i of this.textures)if(i.group==t&&i.binding==e)return i;for(const i of this.samplers)if(i.group==t&&i.binding==e)return i;return null}_findResource(t){for(const e of this.uniforms)if(e.name==t)return e;for(const e of this.storage)if(e.name==t)return e;for(const e of this.textures)if(e.name==t)return e;for(const e of this.samplers)if(e.name==t)return e;return null}_markStructsFromAST(t){const e=this._getTypeInfo(t,null);this._markStructsInUse(e)}_findResources(t,e){const i=[],n=this,a=[];return t.search(s=>{if(s instanceof bb)a.push({});else if(s instanceof wb)a.pop();else if(s instanceof rf){const o=s;e&&o.type!==null&&this._markStructsFromAST(o.type),a.length>0&&(a[a.length-1][o.name]=o)}else if(s instanceof Ep){const o=s;e&&o.type!==null&&this._markStructsFromAST(o.type)}else if(s instanceof BE){const o=s;e&&o.type!==null&&this._markStructsFromAST(o.type),a.length>0&&(a[a.length-1][o.name]=o)}else if(s instanceof zE){const o=s;if(a.length>0&&a[a.length-1][o.name])return;const l=n._findResource(o.name);l&&i.push(l)}else if(s instanceof P8){const o=s,l=n._functions.get(o.name);l&&(e&&(l.inUse=!0),t.calls.add(l.node),l.resources===null&&(l.resources=n._findResources(l.node,e)),i.push(...l.resources))}else if(s instanceof C8){const o=s,l=n._functions.get(o.name);l&&(e&&(l.inUse=!0),t.calls.add(l.node),l.resources===null&&(l.resources=n._findResources(l.node,e)),i.push(...l.resources))}}),[...new Map(i.map(s=>[s.name,s])).values()]}getBindGroups(){const t=[];function e(i,n){i>=t.length&&(t.length=i+1),t[i]===void 0&&(t[i]=[]),n>=t[i].length&&(t[i].length=n+1)}for(const i of this.uniforms){e(i.group,i.binding);const n=t[i.group];n[i.binding]=i}for(const i of this.storage){e(i.group,i.binding);const n=t[i.group];n[i.binding]=i}for(const i of this.textures){e(i.group,i.binding);const n=t[i.group];n[i.binding]=i}for(const i of this.samplers){e(i.group,i.binding);const n=t[i.group];n[i.binding]=i}return t}_getOutputs(t,e=void 0){if(e===void 0&&(e=[]),t instanceof Zh)this._getStructOutputs(t,e);else{const i=this._getOutputInfo(t);i!==null&&e.push(i)}return e}_getStructOutputs(t,e){for(const i of t.members)if(i.type instanceof Zh)this._getStructOutputs(i.type,e);else{const n=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(n!==null){const a=this._getTypeInfo(i.type,i.type.attributes),s=this._parseInt(n.value),o=new iO(i.name,a,n.name,s);e.push(o)}}}_getOutputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const i=this._getTypeInfo(t,t.attributes),n=this._parseInt(e.value);return new iO("",i,e.name,n)}return null}_getInputs(t,e=void 0){e===void 0&&(e=[]);for(const i of t)if(i.type instanceof Zh)this._getStructInputs(i.type,e);else{const n=this._getInputInfo(i);n!==null&&e.push(n)}return e}_getStructInputs(t,e){for(const i of t.members)if(i.type instanceof Zh)this._getStructInputs(i.type,e);else{const n=this._getInputInfo(i);n!==null&&e.push(n)}}_getInputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const i=this._getAttribute(t,"interpolation"),n=this._getTypeInfo(t.type,t.attributes),a=this._parseInt(e.value),s=new $et(t.name,n,e.name,a);return i!==null&&(s.interpolation=this._parseString(i.value)),s}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const e=parseInt(t);return isNaN(e)?t:e}_getAlias(t){for(const e of this.aliases)if(e.name==t)return e.type;return null}_getAliasInfo(t){return new Uet(t.name,this._getTypeInfo(t.type,null))}_getTypeInfo(t,e){if(this._types.has(t))return this._types.get(t);if(t instanceof M8){const n=t,a=n.format?this._getTypeInfo(n.format,n.attributes):null,s=new dA(n.name,e);return s.format=a,s.count=n.count,this._types.set(t,s),this._updateTypeInfo(s),s}if(t instanceof Zh){const n=t,a=new q0(n.name,e);a.startLine=n.startLine,a.endLine=n.endLine;for(const s of n.members){const o=this._getTypeInfo(s.type,s.attributes);a.members.push(new eO(s.name,o,s.attributes))}return this._types.set(t,a),this._updateTypeInfo(a),a}if(t instanceof Dm){const n=t,a=n.format instanceof Jf,s=n.format?a?this._getTypeInfo(n.format,null):new Gp(n.format,null):null,o=new rO(n.name,s,e,n.access);return this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof I8){const n=t,a=n.format?this._getTypeInfo(n.format,null):null,s=new rO(n.name,a,e,n.access);return this._types.set(t,s),this._updateTypeInfo(s),s}const i=new Gp(t.name,e);return this._types.set(t,i),this._updateTypeInfo(i),i}_updateTypeInfo(t){var e,i;const n=this._getTypeSize(t);if(t.size=(e=n==null?void 0:n.size)!==null&&e!==void 0?e:0,t instanceof dA&&t.format){const a=this._getTypeSize(t.format);t.stride=(i=a==null?void 0:a.size)!==null&&i!==void 0?i:0,this._updateTypeInfo(t.format)}t instanceof q0&&this._updateStructInfo(t)}_updateStructInfo(t){var e;let i=0,n=0,a=0,s=0;for(let o=0,l=t.members.length;o<l;++o){const u=t.members[o],c=this._getTypeSize(u);if(!c)continue;(e=this._getAlias(u.type.name))!==null&&e!==void 0||u.type;const h=c.align,p=c.size;i=this._roundUp(h,i+n),n=p,a=i,s=Math.max(s,h),u.offset=i,u.size=p,this._updateTypeInfo(u.type)}t.size=this._roundUp(s,a+n),t.align=s}_getTypeSize(t){var e,i;if(t==null)return null;const n=this._getAttributeNum(t.attributes,"size",0),a=this._getAttributeNum(t.attributes,"align",0);if(t instanceof eO&&(t=t.type),t instanceof Gp){const s=this._getAlias(t.name);s!==null&&(t=s)}{const s=tu._typeInfo[t.name];if(s!==void 0){const o=((e=t.format)===null||e===void 0?void 0:e.name)==="f16"?2:1;return new K0(Math.max(a,s.align/o),Math.max(n,s.size/o))}}{const s=tu._typeInfo[t.name.substring(0,t.name.length-1)];if(s){const o=t.name[t.name.length-1]==="h"?2:1;return new K0(Math.max(a,s.align/o),Math.max(n,s.size/o))}}if(t instanceof dA){let s=t,o=8,l=8;const u=this._getTypeSize(s.format);u!==null&&(l=u.size,o=u.align);const c=s.count,h=this._getAttributeNum((i=t==null?void 0:t.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(o,l));return l=c*h,n&&(l=n),new K0(Math.max(a,o),Math.max(n,l))}if(t instanceof q0){let s=0,o=0,l=0,u=0,c=0;for(const h of t.members){const p=this._getTypeSize(h.type);p!==null&&(s=Math.max(p.align,s),l=this._roundUp(p.align,l+u),u=p.size,c=l)}return o=this._roundUp(s,c+u),new K0(Math.max(a,s),Math.max(n,o))}return null}_isUniformVar(t){return t instanceof rf&&t.storage=="uniform"}_isStorageVar(t){return t instanceof rf&&t.storage=="storage"}_isTextureVar(t){return t instanceof rf&&t.type!==null&&tu._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof rf&&t.type!==null&&tu._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,e){const i=t;if(!i||!i.attributes)return null;const n=i.attributes;for(let a of n)if(a.name==e)return a;return null}_getAttributeNum(t,e,i){if(t===null)return i;for(let n of t)if(n.name==e){let a=n!==null&&n.value!==null?n.value:i;return a instanceof Array&&(a=a[0]),typeof a=="number"?a:typeof a=="string"?parseInt(a):i}return i}_roundUp(t,e){return Math.ceil(e/t)*t}}tu._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};tu._textureTypes=mt.any_texture_type.map(r=>r.name);tu._samplerTypes=mt.sampler_type.map(r=>r.name);function Zet(r){var a;const t={attributes:[],bindings:[]};let e;try{e=qet(r)}catch(s){return _e.error(s.message)(),t}for(const s of e.uniforms){const o=[];for(const l of((a=s.type)==null?void 0:a.members)||[])o.push({name:l.name,type:nO(l.type)});t.bindings.push({type:"uniform",name:s.name,location:s.binding,group:s.group,members:o})}const i=e.entry.vertex[0],n=(i==null?void 0:i.inputs.length)||0;for(let s=0;s<n;s++){const o=i.inputs[s];if(o.locationType==="location"){const l=nO(o.type);t.attributes.push({name:o.name,location:Number(o.location),type:l})}}return t}function nO(r){return r.format?`${r.name}<${r.format.name}>`:r.name}function qet(r){try{return new tu(r)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw typeof t=="object"&&(t!=null&&t.message)&&(e+=`: ${t.message} `),typeof t=="object"&&(t!=null&&t.token)&&(e+=t.token.line||""),new Error(e,{cause:t})}}const Yet=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,Ket={name:"fp32",vs:Yet},Jet=[0,1,1,1],Qet=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,trt=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,aO={name:"picking",vs:Qet,fs:trt,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:Jet},getUniforms:ert};function ert(r={},t){const e={};if(r.highlightedObjectColor!==void 0)if(r.highlightedObjectColor===null)e.isHighlightActive=!1;else{e.isHighlightActive=!0;const i=r.highlightedObjectColor.slice(0,3);e.highlightedObjectColor=i}if(r.highlightColor){const i=Array.from(r.highlightColor,n=>n/255);Number.isFinite(i[3])||(i[3]=1),e.highlightColor=i}return r.isActive!==void 0&&(e.isActive=!!r.isActive,e.isAttribute=!!r.isAttribute),r.useFloatColors!==void 0&&(e.useFloatColors=!!r.useFloatColors),e}function L8(r,t=[],e=0){const i=Math.fround(r),n=r-i;return t[e]=i,t[e+1]=n,t}function rrt(r){return r-Math.fround(r)}function irt(r){const t=new Float32Array(32);for(let e=0;e<4;++e)for(let i=0;i<4;++i){const n=e*4+i;L8(r[i*4+e],t,n*2)}return t}const nrt=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,art={ONE:1};function srt(){return art}const ort={name:"fp64-arithmetic",vs:nrt,getUniforms:srt,fp64ify:L8,fp64LowPart:rrt,fp64ifyMatrix4:irt},lrt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...lrt}};const ja=globalThis.mathgl.config;function urt(r,{precision:t=ja.precision}={}){return r=crt(r),`${parseFloat(r.toPrecision(t))}`}function Of(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function dc(r,t,e){return frt(r,i=>Math.max(t,Math.min(e,i)))}function sg(r,t,e){return Of(r)?r.map((i,n)=>sg(i,t[n],e)):e*t+(1-e)*r}function nu(r,t,e){const i=ja.EPSILON;e&&(ja.EPSILON=e);try{if(r===t)return!0;if(Of(r)&&Of(t)){if(r.length!==t.length)return!1;for(let n=0;n<r.length;++n)if(!nu(r[n],t[n]))return!1;return!0}return r&&r.equals?r.equals(t):t&&t.equals?t.equals(r):typeof r=="number"&&typeof t=="number"?Math.abs(r-t)<=ja.EPSILON*Math.max(1,Math.abs(r),Math.abs(t)):!1}finally{ja.EPSILON=i}}function crt(r){return Math.round(r/ja.EPSILON)*ja.EPSILON}function hrt(r){return r.clone?r.clone():new Array(r.length)}function frt(r,t,e){if(Of(r)){const i=r;e=e||hrt(i);for(let n=0;n<e.length&&n<i.length;++n){const a=typeof r=="number"?r:r[n];e[n]=t(a,n,e)}return e}return t(r)}class IP extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,e=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=t[i+e];return this.check()}toArray(t=[],e=0){for(let i=0;i<this.ELEMENTS;++i)t[e+i]=this[i];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Of(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ja)}formatString(t){let e="";for(let i=0;i<this.ELEMENTS;++i)e+=(i>0?", ":"")+urt(this[i],t);return`${t.printTypes?this.constructor.name:""}[${e}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!nu(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,i){if(i===void 0)return this.lerp(this,t,e);for(let n=0;n<this.ELEMENTS;++n){const a=t[n],s=typeof e=="number"?e:e[n];this[n]=a+i*(s-a)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t[i]),e[i]);return this.check()}add(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]+=e[i];return this.check()}subtract(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]-=e[i];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(ja.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t),e);return this.check()}get elements(){return this}}function drt(r,t){if(r.length!==t)return!1;for(let e=0;e<r.length;++e)if(!Number.isFinite(r[e]))return!1;return!0}function Ci(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function Km(r,t,e=""){if(ja.debug&&!drt(r,t))throw new Error(`math.gl: ${e} some fields set to invalid numbers'`);return r}function Ty(r,t){if(!r)throw new Error(`math.gl assertion ${t}`)}class k8 extends IP{get x(){return this[0]}set x(t){this[0]=Ci(t)}get y(){return this[1]}set y(t){this[1]=Ci(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let i=0;i<this.ELEMENTS;++i){const n=this[i]-t[i];e+=n*n}return Ci(e)}dot(t){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*t[i];return Ci(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]*=e[i];return this.check()}divide(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Ty(t>=0&&t<this.ELEMENTS,"index is out of range"),Ci(this[t])}setComponent(t,e){return Ty(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}const Jm=1e-6;let Bo=typeof Float32Array<"u"?Float32Array:Array;function prt(){const r=new Bo(2);return Bo!=Float32Array&&(r[0]=0,r[1]=0),r}function sO(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function grt(r,t){return r[0]=-t[0],r[1]=-t[1],r}function O8(r,t,e,i){const n=t[0],a=t[1];return r[0]=n+i*(e[0]-n),r[1]=a+i*(e[1]-a),r}function vrt(r,t,e){const i=t[0],n=t[1];return r[0]=e[0]*i+e[3]*n+e[6],r[1]=e[1]*i+e[4]*n+e[7],r}function mrt(r,t,e){const i=t[0],n=t[1];return r[0]=e[0]*i+e[4]*n+e[12],r[1]=e[1]*i+e[5]*n+e[13],r}(function(){const r=prt();return function(t,e,i,n,a,s){let o,l;for(e||(e=2),i||(i=0),n?l=Math.min(n*e+i,t.length):l=t.length,o=i;o<l;o+=e)r[0]=t[o],r[1]=t[o+1],a(r,r,s),t[o]=r[0],t[o+1]=r[1];return t}})();function yrt(r,t,e){const i=t[0],n=t[1],a=e[3]*i+e[7]*n||1;return r[0]=(e[0]*i+e[4]*n)/a,r[1]=(e[1]*i+e[5]*n)/a,r}function N8(r,t,e){const i=t[0],n=t[1],a=t[2],s=e[3]*i+e[7]*n+e[11]*a||1;return r[0]=(e[0]*i+e[4]*n+e[8]*a)/s,r[1]=(e[1]*i+e[5]*n+e[9]*a)/s,r[2]=(e[2]*i+e[6]*n+e[10]*a)/s,r}function _rt(r,t,e){const i=t[0],n=t[1];return r[0]=e[0]*i+e[2]*n,r[1]=e[1]*i+e[3]*n,r[2]=t[2],r}function xrt(r,t,e){const i=t[0],n=t[1];return r[0]=e[0]*i+e[2]*n,r[1]=e[1]*i+e[3]*n,r[2]=t[2],r[3]=t[3],r}function F8(r,t,e){const i=t[0],n=t[1],a=t[2];return r[0]=e[0]*i+e[3]*n+e[6]*a,r[1]=e[1]*i+e[4]*n+e[7]*a,r[2]=e[2]*i+e[5]*n+e[8]*a,r[3]=t[3],r}function B8(){const r=new Bo(3);return Bo!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function brt(r){const t=r[0],e=r[1],i=r[2];return Math.sqrt(t*t+e*e+i*i)}function oO(r,t,e){const i=new Bo(3);return i[0]=r,i[1]=t,i[2]=e,i}function wrt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function Srt(r){const t=r[0],e=r[1],i=r[2];return t*t+e*e+i*i}function Trt(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function Art(r,t){const e=t[0],i=t[1],n=t[2];let a=e*e+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a,r}function z8(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function R1(r,t,e){const i=t[0],n=t[1],a=t[2],s=e[0],o=e[1],l=e[2];return r[0]=n*l-a*o,r[1]=a*s-i*l,r[2]=i*o-n*s,r}function Crt(r,t,e,i){const n=t[0],a=t[1],s=t[2];return r[0]=n+i*(e[0]-n),r[1]=a+i*(e[1]-a),r[2]=s+i*(e[2]-s),r}function MP(r,t,e){const i=t[0],n=t[1],a=t[2];let s=e[3]*i+e[7]*n+e[11]*a+e[15];return s=s||1,r[0]=(e[0]*i+e[4]*n+e[8]*a+e[12])/s,r[1]=(e[1]*i+e[5]*n+e[9]*a+e[13])/s,r[2]=(e[2]*i+e[6]*n+e[10]*a+e[14])/s,r}function V8(r,t,e){const i=t[0],n=t[1],a=t[2];return r[0]=i*e[0]+n*e[3]+a*e[6],r[1]=i*e[1]+n*e[4]+a*e[7],r[2]=i*e[2]+n*e[5]+a*e[8],r}function U8(r,t,e){const i=e[0],n=e[1],a=e[2],s=e[3],o=t[0],l=t[1],u=t[2];let c=n*u-a*l,h=a*o-i*u,p=i*l-n*o,v=n*p-a*h,y=a*c-i*p,x=i*h-n*c;const w=s*2;return c*=w,h*=w,p*=w,v*=2,y*=2,x*=2,r[0]=o+c+v,r[1]=l+h+y,r[2]=u+p+x,r}function Ert(r,t,e,i){const n=[],a=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),r[0]=a[0]+e[0],r[1]=a[1]+e[1],r[2]=a[2]+e[2],r}function Irt(r,t,e,i){const n=[],a=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),r[0]=a[0]+e[0],r[1]=a[1]+e[1],r[2]=a[2]+e[2],r}function Mrt(r,t,e,i){const n=[],a=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],r[0]=a[0]+e[0],r[1]=a[1]+e[1],r[2]=a[2]+e[2],r}function Prt(r,t){const e=r[0],i=r[1],n=r[2],a=t[0],s=t[1],o=t[2],l=Math.sqrt((e*e+i*i+n*n)*(a*a+s*s+o*o)),u=l&&z8(r,t)/l;return Math.acos(Math.min(Math.max(u,-1),1))}const $8=wrt,W8=brt,pA=Srt;(function(){const r=B8();return function(t,e,i,n,a,s){let o,l;for(e||(e=3),i||(i=0),n?l=Math.min(n*e+i,t.length):l=t.length,o=i;o<l;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],a(r,r,s),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2];return t}})();const gA=[0,0,0];let J0;class Ge extends k8{static get ZERO(){return J0||(J0=new Ge(0,0,0),Object.freeze(J0)),J0}constructor(t=0,e=0,i=0){super(-0,-0,-0),arguments.length===1&&Of(t)?this.copy(t):(ja.debug&&(Ci(t),Ci(e),Ci(i)),this[0]=t,this[1]=e,this[2]=i)}set(t,e,i){return this[0]=t,this[1]=e,this[2]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return ja.debug&&(Ci(t.x),Ci(t.y),Ci(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Ci(t)}angle(t){return Prt(this,t)}cross(t){return R1(this,this,t),this.check()}rotateX({radians:t,origin:e=gA}){return Ert(this,this,e,t),this.check()}rotateY({radians:t,origin:e=gA}){return Irt(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=gA}){return Mrt(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return MP(this,this,t),this.check()}transformAsVector(t){return N8(this,this,t),this.check()}transformByMatrix3(t){return V8(this,this,t),this.check()}transformByMatrix2(t){return _rt(this,this,t),this.check()}transformByQuaternion(t){return U8(this,this,t),this.check()}}let Q0;class PP extends k8{static get ZERO(){return Q0||(Q0=new PP(0,0,0,0),Object.freeze(Q0)),Q0}constructor(t=0,e=0,i=0,n=0){super(-0,-0,-0,-0),Of(t)&&arguments.length===1?this.copy(t):(ja.debug&&(Ci(t),Ci(e),Ci(i),Ci(n)),this[0]=t,this[1]=e,this[2]=i,this[3]=n)}set(t,e,i,n){return this[0]=t,this[1]=e,this[2]=i,this[3]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return ja.debug&&(Ci(t.x),Ci(t.y),Ci(t.z),Ci(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=Ci(t)}get w(){return this[3]}set w(t){this[3]=Ci(t)}transform(t){return MP(this,this,t),this.check()}transformByMatrix3(t){return F8(this,this,t),this.check()}transformByMatrix2(t){return xrt(this,this,t),this.check()}transformByQuaternion(t){return U8(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class H8 extends IP{toString(){let t="[";if(ja.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let i=0;i<this.RANK;++i)t+=` ${this[i*this.RANK+e]}`}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=` ${this[e]}`}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,i){return this[e*this.RANK+t]=Ci(i),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const i=t*this.RANK;for(let n=0;n<this.RANK;++n)e[n]=this[i+n];return e}setColumn(t,e){const i=t*this.RANK;for(let n=0;n<this.RANK;++n)this[i+n]=e[n];return this}}function Rrt(){const r=new Bo(9);return Bo!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Drt(r,t){if(r===t){const e=t[1],i=t[2],n=t[5];r[1]=t[3],r[2]=t[6],r[3]=e,r[5]=t[7],r[6]=i,r[7]=n}else r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8];return r}function Lrt(r,t){const e=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=c*s-o*u,p=-c*a+o*l,v=u*a-s*l;let y=e*h+i*p+n*v;return y?(y=1/y,r[0]=h*y,r[1]=(-c*i+n*u)*y,r[2]=(o*i-n*s)*y,r[3]=p*y,r[4]=(c*e-n*l)*y,r[5]=(-o*e+n*a)*y,r[6]=v*y,r[7]=(-u*e+i*l)*y,r[8]=(s*e-i*a)*y,r):null}function krt(r){const t=r[0],e=r[1],i=r[2],n=r[3],a=r[4],s=r[5],o=r[6],l=r[7],u=r[8];return t*(u*a-s*l)+e*(-u*n+s*o)+i*(l*n-a*o)}function lO(r,t,e){const i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],p=e[0],v=e[1],y=e[2],x=e[3],w=e[4],T=e[5],E=e[6],M=e[7],L=e[8];return r[0]=p*i+v*s+y*u,r[1]=p*n+v*o+y*c,r[2]=p*a+v*l+y*h,r[3]=x*i+w*s+T*u,r[4]=x*n+w*o+T*c,r[5]=x*a+w*l+T*h,r[6]=E*i+M*s+L*u,r[7]=E*n+M*o+L*c,r[8]=E*a+M*l+L*h,r}function Ort(r,t,e){const i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],p=e[0],v=e[1];return r[0]=i,r[1]=n,r[2]=a,r[3]=s,r[4]=o,r[5]=l,r[6]=p*i+v*s+u,r[7]=p*n+v*o+c,r[8]=p*a+v*l+h,r}function Nrt(r,t,e){const i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],p=Math.sin(e),v=Math.cos(e);return r[0]=v*i+p*s,r[1]=v*n+p*o,r[2]=v*a+p*l,r[3]=v*s-p*i,r[4]=v*o-p*n,r[5]=v*l-p*a,r[6]=u,r[7]=c,r[8]=h,r}function uO(r,t,e){const i=e[0],n=e[1];return r[0]=i*t[0],r[1]=i*t[1],r[2]=i*t[2],r[3]=n*t[3],r[4]=n*t[4],r[5]=n*t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function Frt(r,t){const e=t[0],i=t[1],n=t[2],a=t[3],s=e+e,o=i+i,l=n+n,u=e*s,c=i*s,h=i*o,p=n*s,v=n*o,y=n*l,x=a*s,w=a*o,T=a*l;return r[0]=1-h-y,r[3]=c-T,r[6]=p+w,r[1]=c+T,r[4]=1-u-y,r[7]=v-x,r[2]=p-w,r[5]=v+x,r[8]=1-u-h,r}var VE;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(VE||(VE={}));const Brt=Object.freeze([1,0,0,0,1,0,0,0,1]);class Jn extends H8{static get IDENTITY(){return Vrt()}static get ZERO(){return zrt()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return VE}constructor(t,...e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):e.length>0?this.copy([t,...e]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(Brt)}fromObject(t){return this.check()}fromQuaternion(t){return Frt(this,t),this.check()}set(t,e,i,n,a,s,o,l,u){return this[0]=t,this[1]=e,this[2]=i,this[3]=n,this[4]=a,this[5]=s,this[6]=o,this[7]=l,this[8]=u,this.check()}setRowMajor(t,e,i,n,a,s,o,l,u){return this[0]=t,this[1]=n,this[2]=o,this[3]=e,this[4]=a,this[5]=l,this[6]=i,this[7]=s,this[8]=u,this.check()}determinant(){return krt(this)}transpose(){return Drt(this,this),this.check()}invert(){return Lrt(this,this),this.check()}multiplyLeft(t){return lO(this,t,this),this.check()}multiplyRight(t){return lO(this,this,t),this.check()}rotate(t){return Nrt(this,this,t),this.check()}scale(t){return Array.isArray(t)?uO(this,this,t):uO(this,this,[t,t]),this.check()}translate(t){return Ort(this,this,t),this.check()}transform(t,e){let i;switch(t.length){case 2:i=vrt(e||[-0,-0],t,this);break;case 3:i=V8(e||[-0,-0,-0],t,this);break;case 4:i=F8(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Km(i,t.length),i}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let tx,ex=null;function zrt(){return tx||(tx=new Jn([0,0,0,0,0,0,0,0,0]),Object.freeze(tx)),tx}function Vrt(){return ex||(ex=new Jn,Object.freeze(ex)),ex}function Urt(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function $rt(r,t){if(r===t){const e=t[1],i=t[2],n=t[3],a=t[6],s=t[7],o=t[11];r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=e,r[6]=t[9],r[7]=t[13],r[8]=i,r[9]=a,r[11]=t[14],r[12]=n,r[13]=s,r[14]=o}else r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15];return r}function UE(r,t){const e=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],p=t[10],v=t[11],y=t[12],x=t[13],w=t[14],T=t[15],E=e*o-i*s,M=e*l-n*s,L=e*u-a*s,F=i*l-n*o,O=i*u-a*o,U=n*u-a*l,W=c*x-h*y,H=c*w-p*y,j=c*T-v*y,Y=h*w-p*x,tt=h*T-v*x,it=p*T-v*w;let lt=E*it-M*tt+L*Y+F*j-O*H+U*W;return lt?(lt=1/lt,r[0]=(o*it-l*tt+u*Y)*lt,r[1]=(n*tt-i*it-a*Y)*lt,r[2]=(x*U-w*O+T*F)*lt,r[3]=(p*O-h*U-v*F)*lt,r[4]=(l*j-s*it-u*H)*lt,r[5]=(e*it-n*j+a*H)*lt,r[6]=(w*L-y*U-T*M)*lt,r[7]=(c*U-p*L+v*M)*lt,r[8]=(s*tt-o*j+u*W)*lt,r[9]=(i*j-e*tt-a*W)*lt,r[10]=(y*O-x*L+T*E)*lt,r[11]=(h*L-c*O-v*E)*lt,r[12]=(o*H-s*Y-l*W)*lt,r[13]=(e*Y-i*H+n*W)*lt,r[14]=(x*M-y*F-w*E)*lt,r[15]=(c*F-h*M+p*E)*lt,r):null}function Wrt(r){const t=r[0],e=r[1],i=r[2],n=r[3],a=r[4],s=r[5],o=r[6],l=r[7],u=r[8],c=r[9],h=r[10],p=r[11],v=r[12],y=r[13],x=r[14],w=r[15],T=t*s-e*a,E=t*o-i*a,M=e*o-i*s,L=u*y-c*v,F=u*x-h*v,O=c*x-h*y,U=t*O-e*F+i*L,W=a*O-s*F+o*L,H=u*M-c*E+h*T,j=v*M-y*E+x*T;return l*U-n*W+w*H-p*j}function wf(r,t,e){const i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],p=t[9],v=t[10],y=t[11],x=t[12],w=t[13],T=t[14],E=t[15];let M=e[0],L=e[1],F=e[2],O=e[3];return r[0]=M*i+L*o+F*h+O*x,r[1]=M*n+L*l+F*p+O*w,r[2]=M*a+L*u+F*v+O*T,r[3]=M*s+L*c+F*y+O*E,M=e[4],L=e[5],F=e[6],O=e[7],r[4]=M*i+L*o+F*h+O*x,r[5]=M*n+L*l+F*p+O*w,r[6]=M*a+L*u+F*v+O*T,r[7]=M*s+L*c+F*y+O*E,M=e[8],L=e[9],F=e[10],O=e[11],r[8]=M*i+L*o+F*h+O*x,r[9]=M*n+L*l+F*p+O*w,r[10]=M*a+L*u+F*v+O*T,r[11]=M*s+L*c+F*y+O*E,M=e[12],L=e[13],F=e[14],O=e[15],r[12]=M*i+L*o+F*h+O*x,r[13]=M*n+L*l+F*p+O*w,r[14]=M*a+L*u+F*v+O*T,r[15]=M*s+L*c+F*y+O*E,r}function Sb(r,t,e){const i=e[0],n=e[1],a=e[2];let s,o,l,u,c,h,p,v,y,x,w,T;return t===r?(r[12]=t[0]*i+t[4]*n+t[8]*a+t[12],r[13]=t[1]*i+t[5]*n+t[9]*a+t[13],r[14]=t[2]*i+t[6]*n+t[10]*a+t[14],r[15]=t[3]*i+t[7]*n+t[11]*a+t[15]):(s=t[0],o=t[1],l=t[2],u=t[3],c=t[4],h=t[5],p=t[6],v=t[7],y=t[8],x=t[9],w=t[10],T=t[11],r[0]=s,r[1]=o,r[2]=l,r[3]=u,r[4]=c,r[5]=h,r[6]=p,r[7]=v,r[8]=y,r[9]=x,r[10]=w,r[11]=T,r[12]=s*i+c*n+y*a+t[12],r[13]=o*i+h*n+x*a+t[13],r[14]=l*i+p*n+w*a+t[14],r[15]=u*i+v*n+T*a+t[15]),r}function RP(r,t,e){const i=e[0],n=e[1],a=e[2];return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r[4]=t[4]*n,r[5]=t[5]*n,r[6]=t[6]*n,r[7]=t[7]*n,r[8]=t[8]*a,r[9]=t[9]*a,r[10]=t[10]*a,r[11]=t[11]*a,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function Hrt(r,t,e,i){let n=i[0],a=i[1],s=i[2],o=Math.sqrt(n*n+a*a+s*s),l,u,c,h,p,v,y,x,w,T,E,M,L,F,O,U,W,H,j,Y,tt,it,lt,ht;return o<Jm?null:(o=1/o,n*=o,a*=o,s*=o,u=Math.sin(e),l=Math.cos(e),c=1-l,h=t[0],p=t[1],v=t[2],y=t[3],x=t[4],w=t[5],T=t[6],E=t[7],M=t[8],L=t[9],F=t[10],O=t[11],U=n*n*c+l,W=a*n*c+s*u,H=s*n*c-a*u,j=n*a*c-s*u,Y=a*a*c+l,tt=s*a*c+n*u,it=n*s*c+a*u,lt=a*s*c-n*u,ht=s*s*c+l,r[0]=h*U+x*W+M*H,r[1]=p*U+w*W+L*H,r[2]=v*U+T*W+F*H,r[3]=y*U+E*W+O*H,r[4]=h*j+x*Y+M*tt,r[5]=p*j+w*Y+L*tt,r[6]=v*j+T*Y+F*tt,r[7]=y*j+E*Y+O*tt,r[8]=h*it+x*lt+M*ht,r[9]=p*it+w*lt+L*ht,r[10]=v*it+T*lt+F*ht,r[11]=y*it+E*lt+O*ht,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)}function G8(r,t,e){const i=Math.sin(e),n=Math.cos(e),a=t[4],s=t[5],o=t[6],l=t[7],u=t[8],c=t[9],h=t[10],p=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=a*n+u*i,r[5]=s*n+c*i,r[6]=o*n+h*i,r[7]=l*n+p*i,r[8]=u*n-a*i,r[9]=c*n-s*i,r[10]=h*n-o*i,r[11]=p*n-l*i,r}function Grt(r,t,e){const i=Math.sin(e),n=Math.cos(e),a=t[0],s=t[1],o=t[2],l=t[3],u=t[8],c=t[9],h=t[10],p=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=a*n-u*i,r[1]=s*n-c*i,r[2]=o*n-h*i,r[3]=l*n-p*i,r[8]=a*i+u*n,r[9]=s*i+c*n,r[10]=o*i+h*n,r[11]=l*i+p*n,r}function j8(r,t,e){const i=Math.sin(e),n=Math.cos(e),a=t[0],s=t[1],o=t[2],l=t[3],u=t[4],c=t[5],h=t[6],p=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=a*n+u*i,r[1]=s*n+c*i,r[2]=o*n+h*i,r[3]=l*n+p*i,r[4]=u*n-a*i,r[5]=c*n-s*i,r[6]=h*n-o*i,r[7]=p*n-l*i,r}function jrt(r,t){const e=t[0],i=t[1],n=t[2],a=t[4],s=t[5],o=t[6],l=t[8],u=t[9],c=t[10];return r[0]=Math.sqrt(e*e+i*i+n*n),r[1]=Math.sqrt(a*a+s*s+o*o),r[2]=Math.sqrt(l*l+u*u+c*c),r}function Xrt(r,t){const e=t[0],i=t[1],n=t[2],a=t[3],s=e+e,o=i+i,l=n+n,u=e*s,c=i*s,h=i*o,p=n*s,v=n*o,y=n*l,x=a*s,w=a*o,T=a*l;return r[0]=1-h-y,r[1]=c+T,r[2]=p-w,r[3]=0,r[4]=c-T,r[5]=1-u-y,r[6]=v+x,r[7]=0,r[8]=p+w,r[9]=v-x,r[10]=1-u-h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Zrt(r,t,e,i,n,a,s){const o=1/(e-t),l=1/(n-i),u=1/(a-s);return r[0]=a*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a*2*l,r[6]=0,r[7]=0,r[8]=(e+t)*o,r[9]=(n+i)*l,r[10]=(s+a)*u,r[11]=-1,r[12]=0,r[13]=0,r[14]=s*a*2*u,r[15]=0,r}function qrt(r,t,e,i,n){const a=1/Math.tan(t/2);if(r[0]=a/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0){const s=1/(i-n);r[10]=(n+i)*s,r[14]=2*n*i*s}else r[10]=-1,r[14]=-2*i;return r}const Yrt=qrt;function Krt(r,t,e,i,n,a,s){const o=1/(t-e),l=1/(i-n),u=1/(a-s);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*l,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*u,r[11]=0,r[12]=(t+e)*o,r[13]=(n+i)*l,r[14]=(s+a)*u,r[15]=1,r}const Jrt=Krt;function Qrt(r,t,e,i){let n,a,s,o,l,u,c,h,p,v;const y=t[0],x=t[1],w=t[2],T=i[0],E=i[1],M=i[2],L=e[0],F=e[1],O=e[2];return Math.abs(y-L)<Jm&&Math.abs(x-F)<Jm&&Math.abs(w-O)<Jm?Urt(r):(h=y-L,p=x-F,v=w-O,n=1/Math.sqrt(h*h+p*p+v*v),h*=n,p*=n,v*=n,a=E*v-M*p,s=M*h-T*v,o=T*p-E*h,n=Math.sqrt(a*a+s*s+o*o),n?(n=1/n,a*=n,s*=n,o*=n):(a=0,s=0,o=0),l=p*o-v*s,u=v*a-h*o,c=h*s-p*a,n=Math.sqrt(l*l+u*u+c*c),n?(n=1/n,l*=n,u*=n,c*=n):(l=0,u=0,c=0),r[0]=a,r[1]=l,r[2]=h,r[3]=0,r[4]=s,r[5]=u,r[6]=p,r[7]=0,r[8]=o,r[9]=c,r[10]=v,r[11]=0,r[12]=-(a*y+s*x+o*w),r[13]=-(l*y+u*x+c*w),r[14]=-(h*y+p*x+v*w),r[15]=1,r)}function tit(){const r=new Bo(4);return Bo!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function eit(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function DP(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}function rit(r){const t=r[0],e=r[1],i=r[2],n=r[3];return Math.sqrt(t*t+e*e+i*i+n*n)}function iit(r){const t=r[0],e=r[1],i=r[2],n=r[3];return t*t+e*e+i*i+n*n}function nit(r,t){const e=t[0],i=t[1],n=t[2],a=t[3];let s=e*e+i*i+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),r[0]=e*s,r[1]=i*s,r[2]=n*s,r[3]=a*s,r}function ait(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]}function sit(r,t,e,i){const n=t[0],a=t[1],s=t[2],o=t[3];return r[0]=n+i*(e[0]-n),r[1]=a+i*(e[1]-a),r[2]=s+i*(e[2]-s),r[3]=o+i*(e[3]-o),r}function wg(r,t,e){const i=t[0],n=t[1],a=t[2],s=t[3];return r[0]=e[0]*i+e[4]*n+e[8]*a+e[12]*s,r[1]=e[1]*i+e[5]*n+e[9]*a+e[13]*s,r[2]=e[2]*i+e[6]*n+e[10]*a+e[14]*s,r[3]=e[3]*i+e[7]*n+e[11]*a+e[15]*s,r}function oit(r,t,e){const i=t[0],n=t[1],a=t[2],s=e[0],o=e[1],l=e[2],u=e[3],c=u*i+o*a-l*n,h=u*n+l*i-s*a,p=u*a+s*n-o*i,v=-s*i-o*n-l*a;return r[0]=c*u+v*-s+h*-l-p*-o,r[1]=h*u+v*-o+p*-s-c*-l,r[2]=p*u+v*-l+c*-o-h*-s,r[3]=t[3],r}(function(){const r=tit();return function(t,e,i,n,a,s){let o,l;for(e||(e=4),i||(i=0),n?l=Math.min(n*e+i,t.length):l=t.length,o=i;o<l;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],r[3]=t[o+3],a(r,r,s),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2],t[o+3]=r[3];return t}})();var $E;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})($E||($E={}));const lit=45*Math.PI/180,uit=1,vA=.1,mA=500,cit=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class wa extends H8{static get IDENTITY(){return fit()}static get ZERO(){return hit()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return $E}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,i,n,a,s,o,l,u,c,h,p,v,y,x,w){return this[0]=t,this[1]=e,this[2]=i,this[3]=n,this[4]=a,this[5]=s,this[6]=o,this[7]=l,this[8]=u,this[9]=c,this[10]=h,this[11]=p,this[12]=v,this[13]=y,this[14]=x,this[15]=w,this.check()}setRowMajor(t,e,i,n,a,s,o,l,u,c,h,p,v,y,x,w){return this[0]=t,this[1]=a,this[2]=u,this[3]=v,this[4]=e,this[5]=s,this[6]=c,this[7]=y,this[8]=i,this[9]=o,this[10]=h,this[11]=x,this[12]=n,this[13]=l,this[14]=p,this[15]=w,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(cit)}fromObject(t){return this.check()}fromQuaternion(t){return Xrt(this,t),this.check()}frustum(t){const{left:e,right:i,bottom:n,top:a,near:s=vA,far:o=mA}=t;return o===1/0?dit(this,e,i,n,a,s):Zrt(this,e,i,n,a,s,o),this.check()}lookAt(t){const{eye:e,center:i=[0,0,0],up:n=[0,1,0]}=t;return Qrt(this,e,i,n),this.check()}ortho(t){const{left:e,right:i,bottom:n,top:a,near:s=vA,far:o=mA}=t;return Jrt(this,e,i,n,a,s,o),this.check()}orthographic(t){const{fovy:e=lit,aspect:i=uit,focalDistance:n=1,near:a=vA,far:s=mA}=t;cO(e);const o=e/2,l=n*Math.tan(o),u=l*i;return this.ortho({left:-u,right:u,bottom:-l,top:l,near:a,far:s})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:i=1,near:n=.1,far:a=500}=t;return cO(e),Yrt(this,e,i,n,a),this.check()}determinant(){return Wrt(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),n=1/i[0],a=1/i[1],s=1/i[2];return t[0]=this[0]*n,t[1]=this[1]*a,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*a,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*a,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),n=1/i[0],a=1/i[1],s=1/i[2];return t[0]=this[0]*n,t[1]=this[1]*a,t[2]=this[2]*s,t[3]=this[4]*n,t[4]=this[5]*a,t[5]=this[6]*s,t[6]=this[8]*n,t[7]=this[9]*a,t[8]=this[10]*s,t}transpose(){return $rt(this,this),this.check()}invert(){return UE(this,this),this.check()}multiplyLeft(t){return wf(this,t,this),this.check()}multiplyRight(t){return wf(this,this,t),this.check()}rotateX(t){return G8(this,this,t),this.check()}rotateY(t){return Grt(this,this,t),this.check()}rotateZ(t){return j8(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return Hrt(this,this,t,e),this.check()}scale(t){return RP(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return Sb(this,this,t),this.check()}transform(t,e){return t.length===4?(e=wg(e||[-0,-0,-0,-0],t,this),Km(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:i}=t;let n;switch(i){case 2:n=mrt(e||[-0,-0],t,this);break;case 3:n=MP(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Km(n,t.length),n}transformAsVector(t,e){let i;switch(t.length){case 2:i=yrt(e||[-0,-0],t,this);break;case 3:i=N8(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Km(i,t.length),i}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,i){return this.identity().translate([t,e,i])}}let rx,ix;function hit(){return rx||(rx=new wa([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(rx)),rx}function fit(){return ix||(ix=new wa,Object.freeze(ix)),ix}function cO(r){if(r>Math.PI*2)throw Error("expected radians")}function dit(r,t,e,i,n,a){const s=2*a/(e-t),o=2*a/(n-i),l=(e+t)/(e-t),u=(n+i)/(n-i),c=-1,h=-1,p=-2*a;return r[0]=s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=l,r[9]=u,r[10]=c,r[11]=h,r[12]=0,r[13]=0,r[14]=p,r[15]=0,r}function hO(){const r=new Bo(4);return Bo!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function pit(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function X8(r,t,e){e=e*.5;const i=Math.sin(e);return r[0]=i*t[0],r[1]=i*t[1],r[2]=i*t[2],r[3]=Math.cos(e),r}function fO(r,t,e){const i=t[0],n=t[1],a=t[2],s=t[3],o=e[0],l=e[1],u=e[2],c=e[3];return r[0]=i*c+s*o+n*u-a*l,r[1]=n*c+s*l+a*o-i*u,r[2]=a*c+s*u+i*l-n*o,r[3]=s*c-i*o-n*l-a*u,r}function git(r,t,e){e*=.5;const i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(e),l=Math.cos(e);return r[0]=i*l+s*o,r[1]=n*l+a*o,r[2]=a*l-n*o,r[3]=s*l-i*o,r}function vit(r,t,e){e*=.5;const i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(e),l=Math.cos(e);return r[0]=i*l-a*o,r[1]=n*l+s*o,r[2]=a*l+i*o,r[3]=s*l-n*o,r}function mit(r,t,e){e*=.5;const i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(e),l=Math.cos(e);return r[0]=i*l+n*o,r[1]=n*l-i*o,r[2]=a*l+s*o,r[3]=s*l-a*o,r}function yit(r,t){const e=t[0],i=t[1],n=t[2];return r[0]=e,r[1]=i,r[2]=n,r[3]=Math.sqrt(Math.abs(1-e*e-i*i-n*n)),r}function D1(r,t,e,i){const n=t[0],a=t[1],s=t[2],o=t[3];let l=e[0],u=e[1],c=e[2],h=e[3],p,v,y,x,w;return p=n*l+a*u+s*c+o*h,p<0&&(p=-p,l=-l,u=-u,c=-c,h=-h),1-p>Jm?(v=Math.acos(p),w=Math.sin(v),y=Math.sin((1-i)*v)/w,x=Math.sin(i*v)/w):(y=1-i,x=i),r[0]=y*n+x*l,r[1]=y*a+x*u,r[2]=y*s+x*c,r[3]=y*o+x*h,r}function _it(r,t){const e=t[0],i=t[1],n=t[2],a=t[3],s=e*e+i*i+n*n+a*a,o=s?1/s:0;return r[0]=-e*o,r[1]=-i*o,r[2]=-n*o,r[3]=a*o,r}function xit(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r}function Z8(r,t){const e=t[0]+t[4]+t[8];let i;if(e>0)i=Math.sqrt(e+1),r[3]=.5*i,i=.5/i,r[0]=(t[5]-t[7])*i,r[1]=(t[6]-t[2])*i,r[2]=(t[1]-t[3])*i;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);const a=(n+1)%3,s=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[a*3+a]-t[s*3+s]+1),r[n]=.5*i,i=.5/i,r[3]=(t[a*3+s]-t[s*3+a])*i,r[a]=(t[a*3+n]+t[n*3+a])*i,r[s]=(t[s*3+n]+t[n*3+s])*i}return r}const bit=eit,wit=DP,Sit=ait,Tit=sit,Ait=rit,Cit=iit,q8=nit,Eit=function(){const r=B8(),t=oO(1,0,0),e=oO(0,1,0);return function(i,n,a){const s=z8(n,a);return s<-.999999?(R1(r,t,n),W8(r)<1e-6&&R1(r,e,n),Art(r,r),X8(i,r,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(R1(r,n,a),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=1+s,q8(i,i))}}();(function(){const r=hO(),t=hO();return function(e,i,n,a,s,o){return D1(r,i,s,o),D1(t,n,a,o),D1(e,r,t,2*o*(1-o)),e}})();(function(){const r=Rrt();return function(t,e,i,n){return r[0]=i[0],r[3]=i[1],r[6]=i[2],r[1]=n[0],r[4]=n[1],r[7]=n[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],q8(t,Z8(t,r))}})();const Iit=[0,0,0,1];class dO extends IP{constructor(t=0,e=0,i=0,n=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,i,n)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,i,n){return this[0]=t,this[1]=e,this[2]=i,this[3]=n,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return Z8(this,t),this.check()}fromAxisRotation(t,e){return X8(this,t,e),this.check()}identity(){return pit(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=Ci(t)}get y(){return this[1]}set y(t){this[1]=Ci(t)}get z(){return this[2]}set z(t){this[2]=Ci(t)}get w(){return this[3]}set w(t){this[3]=Ci(t)}len(){return Ait(this)}lengthSquared(){return Cit(this)}dot(t){return Sit(this,t)}rotationTo(t,e){return Eit(this,t,e),this.check()}add(t){return bit(this,this,t),this.check()}calculateW(){return yit(this,this),this.check()}conjugate(){return xit(this,this),this.check()}invert(){return _it(this,this),this.check()}lerp(t,e,i){return i===void 0?this.lerp(this,t,e):(Tit(this,t,e,i),this.check())}multiplyRight(t){return fO(this,this,t),this.check()}multiplyLeft(t){return fO(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return git(this,this,t),this.check()}rotateY(t){return vit(this,this,t),this.check()}rotateZ(t){return mit(this,this,t),this.check()}scale(t){return wit(this,this,t),this.check()}slerp(t,e,i){let n,a,s;switch(arguments.length){case 1:({start:n=Iit,target:a,ratio:s}=t);break;case 2:n=this,a=t,s=e;break;default:n=t,a=e,s=i}return D1(this,n,a,s),this.check()}transformVector4(t,e=new PP){return oit(e,t,this),Km(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const Mit=1e-15,Pit=1e-20,pO=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,Rit={lightSources:{}};function yA(r={}){const{color:t=[0,0,0],intensity:e=1}=r;return t.map(i=>i*e/255)}function Dit({ambientLight:r,pointLights:t=[],directionalLights:e=[]}){const i={};return r?i["lighting_uAmbientLight.color"]=yA(r):i["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((n,a)=>{i[`lighting_uPointLight[${a}].color`]=yA(n),i[`lighting_uPointLight[${a}].position`]=n.position,i[`lighting_uPointLight[${a}].attenuation`]=n.attenuation||[1,0,0]}),i.lighting_uPointLightCount=t.length,e.forEach((n,a)=>{i[`lighting_uDirectionalLight[${a}].color`]=yA(n),i[`lighting_uDirectionalLight[${a}].direction`]=n.direction}),i.lighting_uDirectionalLightCount=e.length,i}function Y8(r=Rit){var t,e;if("lightSources"in r){const{ambientLight:i,pointLights:n,directionalLights:a}=r.lightSources||{};return i||n&&n.length>0||a&&a.length>0?Object.assign({},Dit({ambientLight:i,pointLights:n,directionalLights:a}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in r){const i={pointLights:[],directionalLights:[]};for(const n of r.lights||[])switch(n.type){case"ambient":i.ambientLight=n;break;case"directional":(t=i.directionalLights)==null||t.push(n);break;case"point":(e=i.pointLights)==null||e.push(n);break}return Y8({lightSources:i})}return{}}const Lit={name:"lights",vs:pO,fs:pO,getUniforms:Y8,defines:{MAX_LIGHTS:3}},kit=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,Oit={};function Nit(r){const{ambient:t=.35,diffuse:e=.6,shininess:i=32,specularColor:n=[30,30,30]}=r;return{lighting_uAmbient:t,lighting_uDiffuse:e,lighting_uShininess:i,lighting_uSpecularColor:n.map(a=>a/255)}}function Fit(r=Oit){if(!("material"in r))return{};const{material:t}=r;return t?Nit(t):{lighting_uEnabled:!1}}const Bit={name:"gouraud-lighting",dependencies:[Lit],vs:kit,defines:{LIGHTING_VERTEX:1},getUniforms:Fit},K8="#define SMOOTH_EDGE_RADIUS 0.5",zit=`
${K8}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Vit=`
${K8}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Uit={name:"geometry",vs:zit,fs:Vit},Qr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Qr,"IDENTITY",{get:()=>(Wr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Po={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Nf={common:0,meters:1,pixels:2},WE={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},$it=Object.keys(Qr).map(r=>`const int COORDINATE_SYSTEM_${r} = ${Qr[r]};`).join(""),Wit=Object.keys(Po).map(r=>`const int PROJECTION_MODE_${r} = ${Po[r]};`).join(""),Hit=Object.keys(Nf).map(r=>`const int UNIT_${r.toUpperCase()} = ${Nf[r]};`).join(""),Git=`${$it}
${Wit}
${Hit}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function jit(r,t){if(r===t)return!0;if(Array.isArray(r)){const e=r.length;if(!t||t.length!==e)return!1;for(let i=0;i<e;i++)if(r[i]!==t[i])return!1;return!0}return!1}function m_(r){let t={},e;return i=>{for(const n in i)if(!jit(i[n],t[n])){e=r(i),t=i;break}return e}}const gO=[0,0,0,0],Xit=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],J8=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Zit=[0,0,0],Q8=[0,0,0],qit=m_(Jit);function t$(r,t,e=Q8){e.length<3&&(e=[e[0],e[1],0]);let i=e,n,a=!0;switch(t===Qr.LNGLAT_OFFSETS||t===Qr.METER_OFFSETS?n=e:n=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case Po.WEB_MERCATOR:(t===Qr.LNGLAT||t===Qr.CARTESIAN)&&(n=[0,0,0],a=!1);break;case Po.WEB_MERCATOR_AUTO_OFFSET:t===Qr.LNGLAT?i=n:t===Qr.CARTESIAN&&(i=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],n=r.unprojectPosition(i),i[0]-=e[0],i[1]-=e[1],i[2]-=e[2]);break;case Po.IDENTITY:i=r.position.map(Math.fround),i[2]=i[2]||0;break;case Po.GLOBE:a=!1,n=null;break;default:a=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:a}}function Yit(r,t,e){const{viewMatrixUncentered:i,projectionMatrix:n}=r;let{viewMatrix:a,viewProjectionMatrix:s}=r,o=gO,l=gO,u=r.cameraPosition;const{geospatialOrigin:c,shaderCoordinateOrigin:h,offsetMode:p}=t$(r,t,e);return p&&(l=r.projectPosition(c||h),u=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],l[3]=1,o=wg([],l,s),a=i||a,s=wf([],n,a),s=wf([],s,Xit)),{viewMatrix:a,viewProjectionMatrix:s,projectionCenter:o,originCommon:l,cameraPosCommon:u,shaderCoordinateOrigin:h,geospatialOrigin:c}}function Kit({viewport:r,devicePixelRatio:t=1,modelMatrix:e=null,coordinateSystem:i=Qr.DEFAULT,coordinateOrigin:n=Q8,autoWrapLongitude:a=!1}){i===Qr.DEFAULT&&(i=r.isGeospatial?Qr.LNGLAT:Qr.CARTESIAN);const s=qit({viewport:r,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:n});return s.project_uWrapLongitude=a,s.project_uModelMatrix=e||J8,s}function Jit({viewport:r,devicePixelRatio:t,coordinateSystem:e,coordinateOrigin:i}){const{projectionCenter:n,viewProjectionMatrix:a,originCommon:s,cameraPosCommon:o,shaderCoordinateOrigin:l,geospatialOrigin:u}=Yit(r,e,i),c=r.getDistanceScales(),h=[r.width*t,r.height*t],p=wg([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,v={project_uCoordinateSystem:e,project_uProjectionMode:r.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:s.slice(0,3),project_uCenter:n,project_uPseudoMeters:!!r._pseudoMeters,project_uViewportSize:h,project_uDevicePixelRatio:t,project_uFocalDistance:p,project_uCommonUnitsPerMeter:c.unitsPerMeter,project_uCommonUnitsPerWorldUnit:c.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Zit,project_uScale:r.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:a,project_uModelMatrix:J8,project_uCameraPosition:o};if(u){const y=r.getDistanceScales(u);switch(e){case Qr.METER_OFFSETS:v.project_uCommonUnitsPerWorldUnit=y.unitsPerMeter,v.project_uCommonUnitsPerWorldUnit2=y.unitsPerMeter2;break;case Qr.LNGLAT:case Qr.LNGLAT_OFFSETS:r._pseudoMeters||(v.project_uCommonUnitsPerMeter=y.unitsPerMeter),v.project_uCommonUnitsPerWorldUnit=y.unitsPerDegree,v.project_uCommonUnitsPerWorldUnit2=y.unitsPerDegree2;break;case Qr.CARTESIAN:v.project_uCommonUnitsPerWorldUnit=[1,1,y.unitsPerMeter[2]],v.project_uCommonUnitsPerWorldUnit2=[0,0,y.unitsPerMeter2[2]];break}}return v}const Qit={};function tnt(r=Qit){return"viewport"in r?Kit(r):{}}const LP={name:"project",dependencies:[Ket,Uit],vs:Git,getUniforms:tnt},ent=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,y_={name:"project32",dependencies:[LP],vs:ent};function rnt(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function jp(r,t){const e=wg([],t,r);return DP(e,e,1/e[3]),e}function vO(r,t){const e=r%t;return e<0?t+e:e}function HE(r,t,e){return r<t?t:r>e?e:r}function int(r){return Math.log(r)*Math.LOG2E}const kP=Math.log2||int;function fu(r,t){if(!r)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Ro=Math.PI,e$=Ro/4,io=Ro/180,GE=180/Ro,og=512,Tb=4003e4,nx=85.051129,nnt=1.5;function ant(r){return kP(r)}function lg(r){const[t,e]=r;fu(Number.isFinite(t)),fu(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const i=t*io,n=e*io,a=og*(i+Ro)/(2*Ro),s=og*(Ro+Math.log(Math.tan(e$+n*.5)))/(2*Ro);return[a,s]}function ug(r){const[t,e]=r,i=t/og*(2*Ro)-Ro,n=2*(Math.atan(Math.exp(e/og*(2*Ro)-Ro))-e$);return[i*GE,n*GE]}function snt(r){const{latitude:t}=r;fu(Number.isFinite(t));const e=Math.cos(t*io);return ant(Tb*e)-9}function _A(r){const t=Math.cos(r*io);return og/Tb/t}function jE(r){const{latitude:t,longitude:e,highPrecision:i=!1}=r;fu(Number.isFinite(t)&&Number.isFinite(e));const n=og,a=Math.cos(t*io),s=n/360,o=s/a,l=n/Tb/a,u={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[s,o,l],degreesPerUnit:[1/s,1/o,1/l]};if(i){const c=io*Math.tan(t*io)/a,h=s*c/2,p=n/Tb*c,v=p/o*l;u.unitsPerDegree2=[0,h,p],u.unitsPerMeter2=[v,0,v]}return u}function r$(r,t){const[e,i,n]=r,[a,s,o]=t,{unitsPerMeter:l,unitsPerMeter2:u}=jE({longitude:e,latitude:i,highPrecision:!0}),c=lg(r);c[0]+=a*(l[0]+u[0]*s),c[1]+=s*(l[1]+u[1]*s);const h=ug(c),p=(n||0)+(o||0);return Number.isFinite(n)||Number.isFinite(o)?[h[0],h[1],p]:h}function ont(r){const{height:t,pitch:e,bearing:i,altitude:n,scale:a,center:s}=r,o=rnt();Sb(o,o,[0,0,-n]),G8(o,o,-e*io),j8(o,o,i*io);const l=a/t;return RP(o,o,[l,l,l]),s&&Sb(o,o,Trt([],s)),o}function lnt(r){const{width:t,height:e,altitude:i,pitch:n=0,offset:a,center:s,scale:o,nearZMultiplier:l=1,farZMultiplier:u=1}=r;let{fovy:c=Ab(nnt)}=r;i!==void 0&&(c=Ab(i));const h=c*io,p=n*io,v=i$(c);let y=v;s&&(y+=s[2]*o/Math.cos(p)/e);const x=h*(.5+(a?a[1]:0)/e),w=Math.sin(x)*y/Math.sin(HE(Math.PI/2-p-x,.01,Math.PI-.01)),T=Math.sin(p)*w+y,E=y*10,M=Math.min(T*u,E);return{fov:h,aspect:t/e,focalDistance:v,near:l,far:M}}function Ab(r){return 2*Math.atan(.5/r)*GE}function i$(r){return .5/Math.tan(.5*r*io)}function n$(r,t){const[e,i,n=0]=r;return fu(Number.isFinite(e)&&Number.isFinite(i)&&Number.isFinite(n)),jp(t,[e,i,n,1])}function OP(r,t,e=0){const[i,n,a]=r;if(fu(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(a))return jp(t,[i,n,a,1]);const s=jp(t,[i,n,0,1]),o=jp(t,[i,n,1,1]),l=s[2],u=o[2],c=l===u?0:((e||0)-l)/(u-l);return O8([],s,o,c)}function unt(r){const{width:t,height:e,bounds:i,minExtent:n=0,maxZoom:a=24,offset:s=[0,0]}=r,[[o,l],[u,c]]=i,h=cnt(r.padding),p=lg([o,HE(c,-nx,nx)]),v=lg([u,HE(l,-nx,nx)]),y=[Math.max(Math.abs(v[0]-p[0]),n),Math.max(Math.abs(v[1]-p[1]),n)],x=[t-h.left-h.right-Math.abs(s[0])*2,e-h.top-h.bottom-Math.abs(s[1])*2];fu(x[0]>0&&x[1]>0);const w=x[0]/y[0],T=x[1]/y[1],E=(h.right-h.left)/2/w,M=(h.top-h.bottom)/2/T,L=[(v[0]+p[0])/2+E,(v[1]+p[1])/2+M],F=ug(L),O=Math.min(a,kP(Math.abs(Math.min(w,T))));return fu(Number.isFinite(O)),{longitude:F[0],latitude:F[1],zoom:O}}function cnt(r=0){return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(fu(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const mO=Math.PI/180;function hnt(r,t=0){const{width:e,height:i,unproject:n}=r,a={targetZ:t},s=n([0,i],a),o=n([e,i],a);let l,u;const c=r.fovy?.5*r.fovy*mO:Math.atan(.5/r.altitude),h=(90-r.pitch)*mO;return c>h-.01?(l=yO(r,0,t),u=yO(r,e,t)):(l=n([0,0],a),u=n([e,0],a)),[s,o,u,l]}function yO(r,t,e){const{pixelUnprojectionMatrix:i}=r,n=jp(i,[t,0,1,1]),a=jp(i,[t,r.height,1,1]),o=(e*r.distanceScales.unitsPerMeter[2]-n[2])/(a[2]-n[2]),l=O8([],n,a,o),u=ug(l);return u.push(e),u}const _O=512;function fnt(r){const{width:t,height:e,pitch:i=0}=r;let{longitude:n,latitude:a,zoom:s,bearing:o=0}=r;(n<-180||n>180)&&(n=vO(n+180,360)-180),(o<-180||o>180)&&(o=vO(o+180,360)-180);const l=kP(e/_O);if(s<=l)s=l,a=0;else{const u=e/2/Math.pow(2,s),c=ug([0,u])[1];if(a<c)a=c;else{const h=ug([0,_O-u])[1];a>h&&(a=h)}}return{width:t,height:e,longitude:n,latitude:a,zoom:s,pitch:i,bearing:o}}const dnt=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,pnt=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,gnt=m_(xnt),vnt=m_(bnt),mnt=[0,0,0,1],ynt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function _nt(r,t){const[e,i,n]=r,a=OP([e,i,n],t);return Number.isFinite(n)?a:[a[0],a[1],0]}function xnt({viewport:r,center:t}){return new wa(r.viewProjectionMatrix).invert().transform(t)}function bnt({viewport:r,shadowMatrices:t}){const e=[],i=r.pixelUnprojectionMatrix,n=r.isGeospatial?void 0:1,a=[[0,0,n],[r.width,0,n],[0,r.height,n],[r.width,r.height,n],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(s=>_nt(s,i));for(const s of t){const o=s.clone().translate(new Ge(r.center).negate()),l=a.map(c=>o.transform(c)),u=new wa().ortho({left:Math.min(...l.map(c=>c[0])),right:Math.max(...l.map(c=>c[0])),bottom:Math.min(...l.map(c=>c[1])),top:Math.max(...l.map(c=>c[1])),near:Math.min(...l.map(c=>-c[2])),far:Math.max(...l.map(c=>-c[2]))});e.push(u.multiplyRight(s))}return e}function wnt(r,t){const{shadowEnabled:e=!0}=r;if(!e||!r.shadowMatrices||!r.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};const i={shadow_uDrawShadowMap:!!r.drawToShadowMap,shadow_uUseShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,shadow_uColor:r.shadowColor||mnt,shadow_uLightId:r.shadowLightId||0,shadow_uLightCount:r.shadowMatrices.length},n=gnt({viewport:r.viewport,center:t.project_uCenter}),a=[],s=vnt({shadowMatrices:r.shadowMatrices,viewport:r.viewport}).slice();for(let o=0;o<r.shadowMatrices.length;o++){const l=s[o],u=l.clone().translate(new Ge(r.viewport.center).negate());t.project_uCoordinateSystem===Qr.LNGLAT&&t.project_uProjectionMode===Po.WEB_MERCATOR?(s[o]=u,a[o]=n):(s[o]=l.clone().multiplyRight(ynt),a[o]=u.transform(n))}for(let o=0;o<s.length;o++)i[`shadow_uViewProjectionMatrices[${o}]`]=s[o],i[`shadow_uProjectCenters[${o}]`]=a[o];for(let o=0;o<2;o++)i[`shadow_uShadowMap${o}`]=r.shadowMaps&&r.shadowMaps[o]||r.dummyShadowMap;return i}const xO={name:"shadow",dependencies:[LP],vs:dnt,fs:pnt,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(r={},t={})=>"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?wnt(r,t):{}},__={...aO,defaultUniforms:{...aO.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},Snt=[LP],Tnt=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Ant(){const r=pb.getDefaultShaderAssembler();for(const t of Snt)r.addDefaultModule(t);for(const t of Tnt)r.addShaderHook(t);return r}const Cnt=[255,255,255],Ent=1;let Int=0;class Mnt{constructor(t={}){this.type="ambient";const{color:e=Cnt}=t,{intensity:i=Ent}=t;this.id=t.id||`ambient-${Int++}`,this.color=e,this.intensity=i}}const Pnt=[255,255,255],Rnt=1,Dnt=[0,0,-1];let Lnt=0;class bO{constructor(t={}){this.type="directional";const{color:e=Pnt}=t,{intensity:i=Rnt}=t,{direction:n=Dnt}=t,{_shadow:a=!1}=t;this.id=t.id||`directional-${Lnt++}`,this.color=e,this.intensity=i,this.type="directional",this.direction=new Ge(n).normalize().toArray(),this.shadow=a}getProjectedLight(t){return this}}class knt{constructor(t,e={id:"pass"}){const{id:i}=e;this.id=i,this.device=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class NP extends knt{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){const[e,i]=this.device.canvasContext.getDrawingBufferSize(),n=t.clearCanvas??!0,a=t.clearColor??(n?[0,0,0,0]:!1),s=n?1:!1,o=n?0:!1,l=t.colorMask??15,u={viewport:[0,0,e,i]};t.colorMask&&(u.colorMask=l),t.scissorRect&&(u.scissorRect=t.scissorRect);const c=this.device.beginRenderPass({framebuffer:t.target,parameters:u,clearColor:a,clearDepth:s,clearStencil:o});try{return this._drawLayers(c,t)}finally{c.end()}}_drawLayers(t,e){const{target:i,moduleParameters:n,viewports:a,views:s,onViewportActive:o,clearStack:l=!0}=e;e.pass=e.pass||"unknown",l&&(this._lastRenderIndex=-1);const u=[];for(const c of a){const h=s&&s[c.id];o==null||o(c);const p=this._getDrawLayerParams(c,e),v=c.subViewports||[c];for(const y of v){const x=this._drawLayersInViewport(t,{target:i,moduleParameters:n,viewport:y,view:h,pass:e.pass,layers:e.layers},p);u.push(x)}}return u}_getDrawLayerParams(t,{layers:e,pass:i,isPicking:n=!1,layerFilter:a,cullRect:s,effects:o,moduleParameters:l},u=!1){var y;const c=[],h=a$(this._lastRenderIndex+1),p={layer:e[0],viewport:t,isPicking:n,renderPass:i,cullRect:s},v={};for(let x=0;x<e.length;x++){const w=e[x],T=this._shouldDrawLayer(w,p,a,v),E={shouldDrawLayer:T};T&&!u&&(E.layerRenderIndex=h(w,T),E.moduleParameters=this._getModuleParameters(w,o,i,l),E.layerParameters={...(y=w.context.deck)==null?void 0:y.props.parameters,...this.getLayerParameters(w,x,t)}),c[x]=E}return c}_drawLayersInViewport(t,{layers:e,moduleParameters:i,pass:n,target:a,viewport:s,view:o},l){const u=Ont(this.device,{moduleParameters:i,target:a,viewport:s});if(o&&o.props.clear){const h=o.props.clear===!0?{color:!0,depth:!0}:o.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:u},()=>this.device.clearWebGL(h))}const c={totalCount:e.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:u});for(let h=0;h<e.length;h++){const p=e[h],{shouldDrawLayer:v,layerRenderIndex:y,moduleParameters:x,layerParameters:w}=l[h];if(v&&p.props.pickable&&c.pickableCount++,p.isComposite)c.compositeCount++;else if(v){c.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,y),x.viewport=s,p.context.renderPass=t;try{p._drawLayer({renderPass:t,moduleParameters:x,uniforms:{layerIndex:y},parameters:w})}catch(T){p.raiseError(T,`drawing ${p} to ${n}`)}}}return c}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,i){return t.props.parameters}_shouldDrawLayer(t,e,i,n){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let s=t.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(e))return!1;e.layer=s,s=s.parent}if(i){const o=e.layer.id;if(o in n||(n[o]=i(e)),!n[o])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,i,n){var o,l;const a=this.device.canvasContext.cssToDeviceRatio(),s=Object.assign(Object.create(((o=t.internalState)==null?void 0:o.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,picking:{isActive:0},devicePixelRatio:a});if(e)for(const u of e)Object.assign(s,(l=u.getModuleParameters)==null?void 0:l.call(u,t));return Object.assign(s,this.getModuleParameters(t,e),n)}}function a$(r=0,t={}){const e={},i=(n,a)=>{const s=n.props._offset,o=n.id,l=n.parent&&n.parent.id;let u;if(l&&!(l in t)&&i(n.parent,!1),l in e){const c=e[l]=e[l]||a$(t[l],t);u=c(n,a),e[o]=c}else Number.isFinite(s)?(u=s+(t[l]||0),e[o]=null):u=r;return a&&u>=r&&(r=u+1),t[o]=u,u};return i}function Ont(r,{moduleParameters:t,target:e,viewport:i}){const n=t&&t.devicePixelRatio||r.canvasContext.cssToDeviceRatio(),[,a]=r.canvasContext.getDrawingBufferSize(),s=e?e.height:a,o=i;return[o.x*n,s-(o.y+o.height)*n,o.width*n,o.height*n]}class Nnt extends NP{constructor(t,e){super(t,e),this.shadowMap=t.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=t.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(t){const e=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),n=t.viewports[0],a=n.width*i,s=n.height*i,o=[1,1,1,1];(a!==e.width||s!==e.height)&&e.resize({width:a,height:s}),super.render({...t,clearColor:o,target:e,pass:"shadow"})}getLayerParameters(t,e,i){return{...t.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const Fnt={color:[255,255,255],intensity:1},wO=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Bnt=[0,0,0,200/255];class s${constructor(t={}){this.id="lighting-effect",this.shadowColor=Bnt,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;const{device:e,deck:i}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(e),i._addDefaultShaderModule(xO),this.dummyShadowMap=e.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const e in t){const i=t[e];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:e,viewports:i,onViewportActive:n,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:t,layerFilter:e,viewports:i,onViewportActive:n,views:a,moduleParameters:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:t})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:t}))},e}cleanup(t){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(xO))}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const i=new wa().lookAt({eye:new Ge(e.direction).negate()});t.push(i)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const i=new Nnt(t);this.shadowPasses[e]=i,this.shadowMaps[e]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:i}=this;!t&&e.length===0&&i.length===0&&(this.ambientLight=new Mnt(Fnt),this.directionalLights.push(new bO(wO[0]),new bO(wO[1])))}}class znt{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,{size:i=1,type:n,padding:a=0,copy:s=!1,initialize:o=!1,maxCount:l}){const u=n||t&&t.constructor||Float32Array,c=e*i+a;if(ArrayBuffer.isView(t)){if(c<=t.length)return t;if(c*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new u(t.buffer,0,c)}let h=1/0;l&&(h=l*i+a);const p=this._allocate(u,c,o,h);return t&&s?p.set(t):o||p.fill(0,0,4),this._release(t),p}release(t){this._release(t)}_allocate(t,e,i,n){let a=Math.max(Math.ceil(e*this.opts.overAlloc),1);a>n&&(a=n);const s=this._pool,o=t.BYTES_PER_ELEMENT*a,l=s.findIndex(u=>u.byteLength>=o);if(l>=0){const u=new t(s.splice(l,1)[0],0,a);return i&&u.fill(0),u}return new t(a)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:i}=t,{byteLength:n}=i,a=e.findIndex(s=>s.byteLength>=n);a<0?e.push(i):(a>0||e.length<this.opts.poolSize)&&e.splice(a,0,i),e.length>this.opts.poolSize&&e.shift()}}const cg=new znt;function Lm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Vnt(r){return[r[12],r[13],r[14]]}function Unt(r){return{left:Xd(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:Xd(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:Xd(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:Xd(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:Xd(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:Xd(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const SO=new Ge;function Xd(r,t,e,i){SO.set(r,t,e);const n=SO.len();return{distance:i/n,normal:new Ge(-r/n,-t/n,-e/n)}}function $nt(r){return r-Math.fround(r)}let jv;function xA(r,t){const{size:e=1,startIndex:i=0}=t,n=t.endIndex!==void 0?t.endIndex:r.length,a=(n-i)/e;jv=cg.allocate(jv,a,{type:Float32Array,size:e*2});let s=i,o=0;for(;s<n;){for(let l=0;l<e;l++){const u=r[s++];jv[o+l]=u,jv[o+l+e]=$nt(u)}o+=e*2}return jv.subarray(0,a*e*2)}function Wnt(r){let t=null,e=!1;for(const i of r)i&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}const Hnt=Math.PI/180,Gnt=Lm(),TO=[0,0,0],jnt={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Xnt({width:r,height:t,orthographic:e,fovyRadians:i,focalDistance:n,padding:a,near:s,far:o}){const l=r/t,u=e?new wa().orthographic({fovy:i,aspect:l,focalDistance:n,near:s,far:o}):new wa().perspective({fovy:i,aspect:l,near:s,far:o});if(a){const{left:c=0,right:h=0,top:p=0,bottom:v=0}=a,y=dc((c+r-h)/2,0,r)-r/2,x=dc((p+t-v)/2,0,t)-t/2;u[8]-=y*2/r,u[9]+=x*2/t}return u}class eS{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||jnt,this.focalDistance=t.focalDistance||1,this.position=t.position||TO,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:i}=t;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Po.WEB_MERCATOR:Po.WEB_MERCATOR_AUTO_OFFSET:Po.IDENTITY}equals(t){return t instanceof eS?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&nu(t.projectionMatrix,this.projectionMatrix)&&nu(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:e=!0}={}){const i=this.projectPosition(t),n=n$(i,this.pixelProjectionMatrix),[a,s]=n,o=e?s:this.height-s;return t.length===2?[a,o]:[a,o,n[2]]}unproject(t,{topLeft:e=!0,targetZ:i}={}){const[n,a,s]=t,o=e?a:this.height-a,l=i&&i*this.distanceScales.unitsPerMeter[2],u=OP([n,o,s],this.pixelUnprojectionMatrix,l),[c,h,p]=this.unprojectPosition(u);return Number.isFinite(s)?[c,h,p]:Number.isFinite(i)?[c,h,i]:[c,h]}projectPosition(t){const[e,i]=this.projectFlat(t),n=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,i,n]}unprojectPosition(t){const[e,i]=this.unprojectFlat(t),n=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,i,n]}projectFlat(t){if(this.isGeospatial){const e=lg(t);return e[1]=dc(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?ug(t):t}getBounds(t={}){const e={targetZ:t.z||0},i=this.unproject([0,0],e),n=this.unproject([this.width,0],e),a=this.unproject([0,this.height],e),s=this.unproject([this.width,this.height],e);return[Math.min(i[0],n[0],a[0],s[0]),Math.min(i[1],n[1],a[1],s[1]),Math.max(i[0],n[0],a[0],s[0]),Math.max(i[1],n[1],a[1],s[1])]}getDistanceScales(t){return t?jE({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:e,width:i=1,height:n=1}){return t<this.x+this.width&&this.x<t+i&&e<this.y+this.height&&this.y<e+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Unt(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,i=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=snt({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||jE({latitude:i,longitude:e}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:a,modelMatrix:s}=t;let o=TO;if(a&&(o=s?new wa(s).transformAsVector(a,[]):a),this.isGeospatial){const l=this.projectPosition([e,i,0]);this.center=new Ge(o).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(o)}_initMatrices(t){const{viewMatrix:e=Gnt,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:a,fovy:s=75,near:o=.1,far:l=1e3,padding:u=null,focalDistance:c=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new wa().multiplyRight(e).translate(new Ge(this.center).negate()),this.projectionMatrix=i||Xnt({width:this.width,height:this.height,orthographic:n,fovyRadians:a||s*Hnt,focalDistance:c,padding:u,near:o,far:l});const h=Lm();wf(h,h,this.projectionMatrix),wf(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=UE([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Vnt(this.viewMatrixInverse);const p=Lm(),v=Lm();RP(p,p,[this.width/2,-this.height/2,1]),Sb(p,p,[1,-1,0]),wf(v,p,this.viewProjectionMatrix),this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=UE(Lm(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Wr.warn("Pixel project matrix not invertible")()}}eS.displayName="Viewport";const FP=eS;class Ay extends FP{constructor(t={}){const{latitude:e=0,longitude:i=0,zoom:n=0,pitch:a=0,bearing:s=0,nearZMultiplier:o=.1,farZMultiplier:l=1.01,nearZ:u,farZ:c,orthographic:h=!1,projectionMatrix:p,repeat:v=!1,worldOffset:y=0,position:x,padding:w,legacyMeterSizes:T=!1}=t;let{width:E,height:M,altitude:L=1.5}=t;const F=Math.pow(2,n);E=E||1,M=M||1;let O,U=null;if(p)L=p[5]/2,O=Ab(L);else{t.fovy?(O=t.fovy,L=i$(O)):O=Ab(L);let H;if(w){const{top:j=0,bottom:Y=0}=w;H=[0,dc((j+M-Y)/2,0,M)-M/2]}U=lnt({width:E,height:M,scale:F,center:x&&[0,0,x[2]*_A(e)],offset:H,pitch:a,fovy:O,nearZMultiplier:o,farZMultiplier:l}),Number.isFinite(u)&&(U.near=u),Number.isFinite(c)&&(U.far=c)}let W=ont({height:M,pitch:a,bearing:s,scale:F,altitude:L});y&&(W=new wa().translate([512*y,0,0]).multiplyLeft(W)),super({...t,width:E,height:M,viewMatrix:W,longitude:i,latitude:e,zoom:n,...U,fovy:O,focalDistance:L}),this.latitude=e,this.longitude=i,this.zoom=n,this.pitch=a,this.bearing=s,this.altitude=L,this.fovy=O,this.orthographic=h,this._subViewports=v?[]:null,this._pseudoMeters=T,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),i=Math.ceil((t[2]-180)/360);for(let n=e;n<=i;n++){const a=n?new Ay({...this,worldOffset:n}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,i]=this.projectFlat(t),n=(t[2]||0)*_A(t[1]);return[e,i,n]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,i]=this.unprojectFlat(t),n=(t[2]||0)/_A(i);return[e,i,n]}addMetersToLngLat(t,e){return r$(t,e)}panByPosition(t,e){const i=OP(e,this.pixelUnprojectionMatrix),n=this.projectFlat(t),a=sO([],n,grt([],i)),s=sO([],this.center,a),[o,l]=this.unprojectFlat(s);return{longitude:o,latitude:l}}getBounds(t={}){const e=hnt(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t,e={}){const{width:i,height:n}=this,{longitude:a,latitude:s,zoom:o}=unt({width:i,height:n,bounds:t,...e});return new Ay({width:i,height:n,longitude:a,latitude:s,zoom:o})}}Ay.displayName="WebMercatorViewport";const Cy=Ay,AO=[0,0,0];function bA(r,t,e=!1){const i=t.projectPosition(r);if(e&&t instanceof Cy){const[n,a,s=0]=r,o=t.getDistanceScales([n,a]);i[2]=s*o.unitsPerMeter[2]}return i}function Znt(r){const{viewport:t,modelMatrix:e,coordinateOrigin:i}=r;let{coordinateSystem:n,fromCoordinateSystem:a,fromCoordinateOrigin:s}=r;return n===Qr.DEFAULT&&(n=t.isGeospatial?Qr.LNGLAT:Qr.CARTESIAN),a===void 0&&(a=n),s===void 0&&(s=i),{viewport:t,coordinateSystem:n,coordinateOrigin:i,modelMatrix:e,fromCoordinateSystem:a,fromCoordinateOrigin:s}}function o$(r,{viewport:t,modelMatrix:e,coordinateSystem:i,coordinateOrigin:n,offsetMode:a}){let[s,o,l=0]=r;switch(e&&([s,o,l]=wg([],[s,o,l,1],e)),i){case Qr.LNGLAT:return bA([s,o,l],t,a);case Qr.LNGLAT_OFFSETS:return bA([s+n[0],o+n[1],l+(n[2]||0)],t,a);case Qr.METER_OFFSETS:return bA(r$(n,[s,o,l]),t,a);case Qr.CARTESIAN:default:return t.isGeospatial?[s+n[0],o+n[1],l+n[2]]:t.projectPosition([s,o,l])}}function qnt(r,t){const{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:a,fromCoordinateSystem:s,fromCoordinateOrigin:o}=Znt(t),{autoOffset:l=!0}=t,{geospatialOrigin:u=AO,shaderCoordinateOrigin:c=AO,offsetMode:h=!1}=l?t$(e,i,n):{},p=o$(r,{viewport:e,modelMatrix:a,coordinateSystem:s,coordinateOrigin:o,offsetMode:h});if(h){const v=e.projectPosition(u||c);$8(p,p,v)}return p}let Ynt=1,Knt=1;class l${constructor(){st(this,"time",0);st(this,"channels",new Map);st(this,"animations",new Map);st(this,"playing",!1);st(this,"lastEngineTime",-1)}addChannel(t){const{delay:e=0,duration:i=Number.POSITIVE_INFINITY,rate:n=1,repeat:a=1}=t,s=Ynt++,o={time:0,delay:e,duration:i,rate:n,repeat:a};return this._setChannelTime(o,this.time),this.channels.set(s,o),s}removeChannel(t){this.channels.delete(t);for(const[e,i]of this.animations)i.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const n of e)this._setChannelTime(n,this.time);const i=this.animations.values();for(const n of i){const{animation:a,channel:s}=n;a.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const i=Knt++;return this.animations.set(i,{animation:t,channel:e}),t.setTime(this.getTime(e)),i}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const i=e-t.delay,n=t.duration*t.repeat;i>=n?t.time=t.duration*t.rate:(t.time=Math.max(0,i)%t.duration,t.time*=t.rate)}}let Jnt=0;const Qnt={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:r=>console.error(r),stats:Hp.stats.get(`animation-loop-${Jnt++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class tat{constructor(t){st(this,"device",null);st(this,"canvas",null);st(this,"props");st(this,"animationProps",null);st(this,"timeline",null);st(this,"stats");st(this,"cpuTime");st(this,"gpuTime");st(this,"frameRate");st(this,"display");st(this,"needsRedraw","initialized");st(this,"_initialized",!1);st(this,"_running",!1);st(this,"_animationFrameId",null);st(this,"_nextFramePromise",null);st(this,"_resolveNextFrame",null);st(this,"_cpuStartTime",0);if(this.props={...Qnt,...t},t=this.props,!t.device)throw new Error("No device provided");const{useDevicePixels:e=!0}=this.props;this.stats=t.stats||new p_({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport,autoResizeDrawingBuffer:t.autoResizeDrawingBuffer,useDevicePixels:e}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),"autoResizeDrawingBuffer"in t&&(this.props.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer||!1),"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){const e=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(e),e}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var t;return(t=this.device)!=null&&t.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=oet(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(uet(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,e;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(e=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:e.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:t,height:e,aspect:i}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var t;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((t=this.device.canvasContext)==null?void 0:t.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(e);const i=this.props.onAddHTML(e);i&&(e.innerHTML=i)}}_getSizeAndAspect(){var a,s,o,l;if(!this.device)return{width:1,height:1,aspect:1};const[t,e]=((s=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:s.getPixelSize())||[1,1];let i=1;const n=(l=(o=this.device)==null?void 0:o.canvasContext)==null?void 0:l.canvas;return n&&n.clientHeight?i=n.clientWidth/n.clientHeight:t>0&&e>0&&(i=t/e),{width:t,height:e,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var t,e;this.props.autoResizeDrawingBuffer&&((e=(t=this.device)==null?void 0:t.canvasContext)==null||e.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}}class CO{constructor(t){st(this,"id");st(this,"userData",{});st(this,"topology");st(this,"bufferLayout",[]);st(this,"vertexCount");st(this,"indices");st(this,"attributes");this.id=t.id||Kf("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&Di(this.indices.usage===rn.INDEX)}destroy(){var t;(t=this.indices)==null||t.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(t){return t.byteLength/12}}function eat(r,t){if(t instanceof CO)return t;const e=rat(r,t),{attributes:i,bufferLayout:n}=iat(r,t);return new CO({topology:t.topology||"triangle-list",bufferLayout:n,vertexCount:t.vertexCount,indices:e,attributes:i})}function rat(r,t){if(!t.indices)return;const e=t.indices.value;return r.createBuffer({usage:rn.INDEX,data:e})}function iat(r,t){const e=[],i={};for(const[a,s]of Object.entries(t.attributes)){let o=a;switch(a){case"POSITION":o="positions";break;case"NORMAL":o="normals";break;case"TEXCOORD_0":o="texCoords";break;case"COLOR_0":o="colors";break}i[o]=r.createBuffer({data:s.value,id:`${a}-buffer`});const{value:l,size:u,normalized:c}=s;e.push({name:o,format:ret(l,u,c)})}const n=t._calculateVertexCount(t.attributes,t.indices);return{attributes:i,bufferLayout:e,vertexCount:n}}class nat{constructor(t){st(this,"modules");st(this,"moduleUniforms");st(this,"moduleBindings");st(this,"moduleUniformsChanged");const e=Qw(Object.values(t).filter(i=>i.dependencies));for(const i of e)t[i.name]=i;_e.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(const[i,n]of Object.entries(t)){const a=i;this.moduleUniforms[a]=n.defaultUniforms||{},this.moduleBindings[a]={}}}destroy(){}setProps(t){var e;for(const i of Object.keys(t)){const n=i,a=t[n],s=this.modules[n];if(!s){_e.warn(`Module ${i} not found`)();continue}const o=this.moduleUniforms[n],l=this.moduleBindings[n],u=((e=s.getUniforms)==null?void 0:e.call(s,a,o))||a,{uniforms:c,bindings:h}=EP(u);this.moduleUniforms[n]={...o,...c},this.moduleBindings[n]={...l,...h}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const t={};for(const e of Object.values(this.moduleBindings))Object.assign(t,e);return t}getDebugTable(){var e;const t={};for(const[i,n]of Object.entries(this.moduleUniforms))for(const[a,s]of Object.entries(n))t[`${i}.${a}`]={type:(e=this.modules[i].uniformTypes)==null?void 0:e[a],value:String(s)};return t}}const qw=class qw{constructor(t){st(this,"device");st(this,"_hashCounter",0);st(this,"_hashes",{});st(this,"_renderPipelineCache",{});st(this,"_computePipelineCache",{});this.device=t}static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new qw(t),t._lumaData.defaultPipelineFactory}createRenderPipeline(t){const e={...ng.defaultProps,...t},i=this._hashRenderPipeline(e);if(!this._renderPipelineCache[i]){const n=this.device.createRenderPipeline({...e,id:e.id?`${e.id}-cached`:void 0});n.hash=i,this._renderPipelineCache[i]={pipeline:n,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(t){const e={...xb.defaultProps,...t},i=this._hashComputePipeline(e);if(!this._computePipelineCache[i]){const n=this.device.createComputePipeline({...e,id:e.id?`${e.id}-cached`:void 0});n.hash=i,this._computePipelineCache[i]={pipeline:n,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(t){const e=t.hash,i=t instanceof xb?this._computePipelineCache:this._renderPipelineCache;i[e].useCount--,i[e].useCount===0&&(i[e].pipeline.destroy(),delete i[e])}_hashComputePipeline(t){return`${this._getHash(t.shader.source)}`}_hashRenderPipeline(t){const e=this._getHash(t.vs.source),i=t.fs?this._getHash(t.fs.source):0,n="-",a=this._getHash(JSON.stringify(t.bufferLayout));switch(this.device.type){case"webgl":return`${e}/${i}V${n}BL${a}`;default:const s=this._getHash(JSON.stringify(t.parameters));return`${e}/${i}V${n}T${t.topology}P${s}BL${a}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}};st(qw,"defaultProps",{...ng.defaultProps});let XE=qw;const Yw=class Yw{constructor(t){st(this,"device");st(this,"_cache",{});this.device=t}static getDefaultShaderFactory(t){var e;return(e=t._lumaData).defaultShaderFactory||(e.defaultShaderFactory=new Yw(t)),t._lumaData.defaultShaderFactory}createShader(t){const e=this._hashShader(t);let i=this._cache[e];if(!i){const n=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[e]=i={shader:n,useCount:0}}return i.useCount++,i.shader}release(t){const e=this._hashShader(t),i=this._cache[e];i&&(i.useCount--,i.useCount===0&&(delete this._cache[e],i.shader.destroy()))}_hashShader(t){return`${t.stage}:${t.source}`}};st(Yw,"defaultProps",{...mb.defaultProps});let ZE=Yw;function aat(r,t){var n;const e={},i="Values";if(r.attributes.length===0&&!((n=r.varyings)!=null&&n.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const a of r.attributes)if(a){const s=`${a.location} ${a.name}: ${a.type}`;e[`in ${s}`]={[i]:a.stepMode||"vertex"}}for(const a of r.varyings||[]){const s=`${a.location} ${a.name}`;e[`out ${s}`]={[i]:JSON.stringify(a.accessor)}}return e}let zn=null,wA=null;function sat(r,{id:t,minimap:e,opaque:i,top:n="0",left:a="0",rgbaScale:s=1}){zn||(zn=document.createElement("canvas"),zn.id=t,zn.title=t,zn.style.zIndex="100",zn.style.position="absolute",zn.style.top=n,zn.style.left=a,zn.style.border="blue 1px solid",zn.style.transform="scaleY(-1)",document.body.appendChild(zn),wA=zn.getContext("2d")),(zn.width!==r.width||zn.height!==r.height)&&(zn.width=r.width/2,zn.height=r.height/2,zn.style.width="400px",zn.style.height="400px");const o=r.device.readPixelsToArrayWebGL(r),l=wA.createImageData(r.width,r.height),u=0;for(let c=0;c<o.length;c+=4)l.data[u+c+0]=o[c+0]*s,l.data[u+c+1]=o[c+1]*s,l.data[u+c+2]=o[c+2]*s,l.data[u+c+3]=i?255:o[c+3]*s;wA.putImageData(l,0,0)}const Zd=2,oat=1e4;var rg;let au=(rg=class{constructor(t,e){st(this,"device");st(this,"id");st(this,"source");st(this,"vs");st(this,"fs");st(this,"pipelineFactory");st(this,"shaderFactory");st(this,"userData",{});st(this,"parameters");st(this,"topology");st(this,"bufferLayout");st(this,"isInstanced");st(this,"instanceCount",0);st(this,"vertexCount");st(this,"indexBuffer",null);st(this,"bufferAttributes",{});st(this,"constantAttributes",{});st(this,"bindings",{});st(this,"uniforms",{});st(this,"vertexArray");st(this,"transformFeedback",null);st(this,"pipeline");st(this,"shaderInputs");st(this,"_uniformStore");st(this,"_attributeInfos",{});st(this,"_gpuGeometry",null);st(this,"_getModuleUniforms");st(this,"props");st(this,"_pipelineNeedsUpdate","newly created");st(this,"_needsRedraw","initializing");st(this,"_destroyed",!1);st(this,"_lastDrawTimestamp",-1);st(this,"_lastLogTime",0);st(this,"_logOpen",!1);st(this,"_drawCount",0);var o,l,u,c;this.props={...rg.defaultProps,...e},e=this.props,this.id=e.id||Kf("model"),this.device=t,Object.assign(this.userData,e.userData);const i=Object.fromEntries(((o=this.props.modules)==null?void 0:o.map(h=>[h.name,h]))||[]);this.setShaderInputs(e.shaderInputs||new nat(i));const n=lat(t),a=(((l=this.props.modules)==null?void 0:l.length)>0?this.props.modules:(u=this.shaderInputs)==null?void 0:u.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(c=this.props).shaderLayout||(c.shaderLayout=Zet(this.props.source));const{source:h,getUniforms:p}=this.props.shaderAssembler.assembleShader({platformInfo:n,...this.props,modules:a});this.source=h,this._getModuleUniforms=p}else{const{vs:h,fs:p,getUniforms:v}=this.props.shaderAssembler.assembleShaderPair({platformInfo:n,...this.props,modules:a});this.vs=h,this.fs=p,this._getModuleUniforms=v}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,e.geometry&&this.setGeometry(e.geometry),this.pipelineFactory=e.pipelineFactory||XE.getDefaultPipelineFactory(this.device),this.shaderFactory=e.shaderFactory||ZE.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in e&&(this.isInstanced=e.isInstanced),e.instanceCount&&this.setInstanceCount(e.instanceCount),e.vertexCount&&this.setVertexCount(e.vertexCount),e.indexBuffer&&this.setIndexBuffer(e.indexBuffer),e.attributes&&this.setAttributes(e.attributes),e.constantAttributes&&this.setConstantAttributes(e.constantAttributes),e.bindings&&this.setBindings(e.bindings),e.uniforms&&this.setUniforms(e.uniforms),e.moduleSettings&&this.updateModuleSettings(e.moduleSettings),e.transformFeedback&&(this.transformFeedback=e.transformFeedback),Object.seal(this)}destroy(){var t;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(t=this._gpuGeometry)==null||t.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||(this._needsRedraw=t)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){this.predraw();let e;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),gb(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:i}=this.vertexArray,n=i?i.byteLength/(i.indexType==="uint32"?4:2):void 0;e=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:n,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(t),e?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",e}setGeometry(t){var i;(i=this._gpuGeometry)==null||i.destroy();const e=t&&eat(this.device,t);e&&(this.setTopology(e.topology||"triangle-list"),this.bufferLayout=EO(e.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(e)),this._gpuGeometry=e}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){this.bufferLayout=this._gpuGeometry?EO(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){NE(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new eet(this.shaderInputs.modules);for(const e of Object.keys(this.shaderInputs.modules)){const i=this._uniformStore.getManagedUniformBuffer(this.device,e);this.bindings[`${e}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,e){t.indices&&_e.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[i,n]of Object.entries(t)){const a=this.bufferLayout.find(l=>IO(l).includes(i));if(!a){_e.warn(`Model(${this.id}): Missing layout for buffer "${i}".`)();continue}const s=IO(a);let o=!1;for(const l of s){const u=this._attributeInfos[l];u&&(this.vertexArray.setBuffer(u.location,n),o=!0)}!o&&!((e==null?void 0:e.disableWarnings)??this.props.disableWarnings)&&_e.warn(`Model(${this.id}): Ignoring buffer "${n.id}" for unknown attribute "${i}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,e){for(const[i,n]of Object.entries(t)){const a=this._attributeInfos[i];a?this.vertexArray.setConstantWebGL(a.location,n):((e==null?void 0:e.disableWarnings)??this.props.disableWarnings)||_e.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(t){gb(t)||(this.pipeline.setUniformsWebGL(t),Object.assign(this.uniforms,t)),this.setNeedsRedraw("uniforms")}updateModuleSettings(t){const{bindings:e,uniforms:i}=EP(this._getModuleUniforms(t));Object.assign(this.bindings,e),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let t=0;for(const e of Object.values(this.bindings))e instanceof vb?t=Math.max(t,e.texture.updateTimestamp):e instanceof rn||e instanceof eo?t=Math.max(t,e.updateTimestamp):e instanceof yb||(t=Math.max(t,e.buffer.updateTimestamp));return t}_setGeometryAttributes(t){const e={...t.attributes};for(const[i]of Object.entries(e))!this.pipeline.shaderLayout.attributes.find(n=>n.name===i)&&i!=="positions"&&delete e[i];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(e,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=t),this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,e=null;this.pipeline&&(_e.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,e=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let n=null;this.source?n=i:this.fs&&(n=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:i,fs:n}),this._attributeInfos=x8(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),e&&this.shaderFactory.release(e)}return this.pipeline}_logDrawCallStart(){const t=_e.level>3?0:oat;_e.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,_e.group(Zd,`>>> DRAWING MODEL ${this.id}`,{collapsed:_e.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const t=aat(this.pipeline.shaderLayout,this.id);_e.table(Zd,t)();const e=this.shaderInputs.getDebugTable();for(const[n,a]of Object.entries(this.uniforms))e[n]={value:a};_e.table(Zd,e)();const i=this._getAttributeDebugTable();_e.table(Zd,this._attributeInfos)(),_e.table(Zd,i)(),_e.groupEnd(Zd)(),this._logOpen=!1}}_logFramebuffer(t){const e=_e.get("framebuffer");if(this._drawCount++,!e||this._drawCount++>3&&this._drawCount%60)return;const i=t.props.framebuffer;i&&sat(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const t={};for(const[e,i]of Object.entries(this._attributeInfos))t[i.location]={name:e,type:i.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[i.location],i.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:e}=this.vertexArray,i=e.indexType==="uint32"?new Uint32Array(e.debugData):new Uint16Array(e.debugData);t.indices={name:"indices",type:e.indexType,values:i.toString()}}return t}_getBufferOrConstantValues(t,e){const i=S8(e);return(t instanceof rn?new i(t.debugData):t).toString()}},st(rg,"defaultProps",{...ng.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:pb.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0}),rg);function EO(r,t){const e=[...r];for(const i of t){const n=e.findIndex(a=>a.name===i.name);n<0?e.push(i):e[n]=i}return e}function lat(r){return{type:r.type,shaderLanguage:r.info.shadingLanguage,shaderLanguageVersion:r.info.shadingLanguageVersion,gpu:r.info.gpu,features:r.features}}function IO(r){var t;return r.attributes?(t=r.attributes)==null?void 0:t.map(e=>e.attribute):[r.name]}class Ey{constructor(t,e=au.defaultProps){st(this,"device");st(this,"model");st(this,"transformFeedback");Di(Ey.isSupported(t),"BufferTransform not yet implemented on WebGPU"),this.device=t,this.model=new au(this.device,{id:e.id||"buffer-transform-model",fs:e.fs||itt(),topology:e.topology||"point-list",...e}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:e.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(t){var e;return((e=t==null?void 0:t.info)==null?void 0:e.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){const e=this.device.beginRenderPass(t);this.model.draw(e),e.end()}update(...t){console.warn("TextureTransform#update() not implemented")}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){const e=this.getBuffer(t);if(e instanceof rn)return e.readAsync();const{buffer:i,byteOffset:n=0,byteLength:a=i.byteLength}=e;return i.readAsync(n,a)}}class hg{constructor(t){st(this,"id");st(this,"topology");st(this,"vertexCount");st(this,"indices");st(this,"attributes");st(this,"userData",{});const{attributes:e={},indices:i=null,vertexCount:n=null}=t;this.id=t.id||Kf("geometry"),this.topology=t.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[a,s]of Object.entries(e)){const o=ArrayBuffer.isView(s)?{value:s}:s;Di(ArrayBuffer.isView(o.value),`${this._print(a)}: must be typed array or object with value as typed array`),(a==="POSITION"||a==="positions")&&!o.size&&(o.size=3),a==="indices"?(Di(!this.indices),this.indices=o):this.attributes[a]=o}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=n||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,e){return this}_calculateVertexCount(t,e){if(e)return e.value.length;let i=1/0;for(const n of Object.values(t)){const{value:a,size:s,constant:o}=n;!o&&a&&s>=1&&(i=Math.min(i,a.length/s))}return Di(Number.isFinite(i)),i}}const uat={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class u$ extends NP{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:e,views:i,viewports:n,onViewportActive:a,pickingFBO:s,deviceRect:{x:o,y:l,width:u,height:c},cullRect:h,effects:p,pass:v="picking",pickZ:y,moduleParameters:x}){this.pickZ=y;const w=this._resetColorEncoder(y),T=[o,l,u,c],E=super.render({target:s,layers:t,layerFilter:e,views:i,viewports:n,onViewportActive:a,cullRect:h,effects:p==null?void 0:p.filter(L=>L.useInPicking),pass:v,isPicking:!0,moduleParameters:x,clearColor:[0,0,0,0],colorMask:15,scissorRect:T});return this._colorEncoderState=null,{decodePickingColor:w&&hat.bind(null,w),stats:E}}shouldDrawLayer(t){const{pickable:e,operation:i}=t.props;return e&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(t,e,i){const n={depthMask:!0,depthTest:!0,depthRange:[0,1],...t.props.parameters},{pickable:a,operation:s}=t.props;return!this._colorEncoderState||s.includes("terrain")?n.blend=!1:a&&s.includes("draw")&&(Object.assign(n,uat),n.blend=!0,n.blendColor=cat(this._colorEncoderState,t,i)),n}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function cat(r,t,e){const{byLayer:i,byAlpha:n}=r;let a,s=i.get(t);return s?(s.viewports.push(e),a=s.a):(a=i.size+1,a<=255?(s={a,layer:t,viewports:[e]},i.set(t,s),n[a]=s):(Wr.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function hat(r,t){const e=r.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const bp={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Cb=Symbol.for("component"),Mc=Symbol.for("propTypes"),SA=Symbol.for("deprecatedProps"),Xp=Symbol.for("asyncPropDefaults"),Ff=Symbol.for("asyncPropOriginal"),pc=Symbol.for("asyncPropResolved");function rS(r,t=()=>!0){return Array.isArray(r)?c$(r,t,[]):t(r)?[r]:[]}function c$(r,t,e){let i=-1;for(;++i<r.length;){const n=r[i];Array.isArray(n)?c$(n,t,e):t(n)&&e.push(n)}return e}function fat({target:r,source:t,start:e=0,count:i=1}){const n=t.length,a=i*n;let s=0;for(let o=e;s<n;s++)r[o++]=t[s];for(;s<a;)s<a-s?(r.copyWithin(e+s,e,e+s),s*=2):(r.copyWithin(e+s,e,e+a-s),s=a);return r}class dat{constructor(t,e,i){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=i,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const i=++this._loadCount;let n=t;typeof t=="string"&&(n=fb(t)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const a of this._subscribers)a.onChange(this.getData())}}class pat{constructor(t){var e;this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:(e=t.device)==null?void 0:e.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:e,forceUpdate:i=!1,persistent:n=!0}){let a=this._resources[t];a?a.setData(e,i):(a=new dat(t,e,this._context),this._resources[t]=a),a.persistent=n}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const e=this._consumers[t];if(e){for(const i in e){const n=e[i],a=this._resources[n.resourceId];a&&a.unsubscribe(n)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:e,consumerId:i,requestId:n="default"}){const{_resources:a,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),a[t]||this.add({resourceId:t,data:null,persistent:!1}));const o=a[t];if(this._track(i,n,o,e),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,i,n){const a=this._consumers,s=a[t]=a[t]||{};let o=s[e];const l=o&&o.resourceId&&this._resources[o.resourceId];l&&(l.unsubscribe(o),this.prune()),i&&(o?(o.onChange=n,o.resourceId=i.id):o={onChange:n,resourceId:i.id},s[e]=o,i.subscribe(o))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const gat="layerManager.setLayers",vat="layerManager.activateViewport";class mat{constructor(t,e){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=o=>{xa(vat,this,o),o&&(this.context.viewport=o)};const{deck:i,stats:n,viewport:a,timeline:s}=e||{};this.layers=[],this.resourceManager=new pat({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t==null?void 0:t.gl,deck:i,shaderAssembler:Ant(),defaultShaderModules:[],renderPass:void 0,stats:n||new p_({id:"deck.gl"}),viewport:a||new FP({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new l$,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const n=i.getNeedsRedraw(t);e=e||n}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(e=>t.find(i=>e.id.indexOf(i)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){xa(gat,this,e,t),this._lastRenderedLayers=t;const i=rS(t,Boolean);for(const n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){const{defaultShaderModules:e}=this.context;e.find(i=>i.name===t.name)||(e.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){const{defaultShaderModules:e}=this.context,i=e.findIndex(n=>n.name===t.name);i>=0&&(e.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(t,e,i){i.raiseError(e,`${t} of ${i}`)}_updateLayers(t,e){const i={};for(const s of t)i[s.id]?Wr.warn(`Multiple old layers with same id ${s.id}`)():i[s.id]=s;if(this._defaultShaderModulesChanged){for(const s of t)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const n=[];this._updateSublayersRecursively(e,i,n),this._finalizeOldLayers(i);let a=!1;for(const s of n)if(s.hasUniformTransition()){a=`Uniform transition in ${s}`;break}this._needsUpdate=a,this.layers=n}_updateSublayersRecursively(t,e,i){for(const n of t){n.context=this.context;const a=e[n.id];a===null&&Wr.warn(`Multiple new layers with same id ${n.id}`)(),e[n.id]=null;let s=null;try{this._debug&&a!==n&&n.validateProps(),a?(this._transferLayerState(a,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),s=n.isComposite?n.getSubLayers():null}catch(o){this._handleError("matching",o,n)}s&&this._updateSublayersRecursively(s,e,i)}}_finalizeOldLayers(t){for(const e in t){const i=t[e];i&&this._finalizeLayer(i)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=bp.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=bp.MATCHED,e!==t&&(t.lifecycle=bp.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=bp.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=bp.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function As(r,t,e){if(r===t)return!0;if(!e||!r||!t)return!1;if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let i=0;i<r.length;i++)if(!As(r[i],t[i],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof r=="object"&&typeof t=="object"){const i=Object.keys(r),n=Object.keys(t);if(i.length!==n.length)return!1;for(const a of i)if(!t.hasOwnProperty(a)||!As(r[a],t[a],e-1))return!1;return!0}return!1}class yat{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,i=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(i):i}getViewport(t){return this._viewportMap[t]}unproject(t,e){const i=this.getViewports(),n={x:t[0],y:t[1]};for(let a=i.length-1;a>=0;--a){const s=i[a];if(s.containsPixel(n)){const o=t.slice();return o[0]-=s.x,o[1]-=s.y,s.unproject(o,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=rS(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!As(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Wr.warn("missing `viewState` or `initialViewState`")()}_createController(t,e){const i=e.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>{var s;return(s=this.getView(t.id))==null?void 0:s.makeViewport({viewState:a,width:this.width,height:this.height})}})}_updateController(t,e,i,n){const a=t.controller;if(a&&i){const s={...e,...a,id:t.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!n||n.constructor!==a.type)&&(n=this._createController(t,s)),n&&n.setProps(s),n}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=t.length;n--;){const a=t[n],s=this.getViewState(a),o=a.makeViewport({viewState:s,width:this.width,height:this.height});let l=e[a.id];const u=!!a.controller;u&&!l&&(i=!0),(i||!u)&&l&&(l.finalize(),l=null),this.controllers[a.id]=this._updateController(a,s,o,l),o&&this._viewports.unshift(o)}for(const n in e){const a=e[n];a&&!this.controllers[n]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((i,n)=>!t[n].equals(e[n]))}}const _at=/([0-9]+\.?[0-9]*)(%|px)/;function Hu(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const t=_at.exec(r);if(t&&t.length>=3){const e=t[2]==="%",i=parseFloat(t[1]);return{position:e?i/100:i,relative:e}}default:throw new Error(`Could not parse position string ${r}`)}}function Gu(r,t){return r.relative?Math.round(r.position*t):r.position}let xat=class{constructor(t){const{id:e,x:i=0,y:n=0,width:a="100%",height:s="100%",padding:o=null}=t;this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=Hu(i),this._y=Hu(n),this._width=Hu(a),this._height=Hu(s),this._padding=o&&{left:Hu(o.left||0),right:Hu(o.right||0),top:Hu(o.top||0),bottom:Hu(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.ViewportType===t.ViewportType&&As(this.props,t.props,2)}makeViewport({width:t,height:e,viewState:i}){i=this.filterViewState(i);const n=this.getDimensions({width:t,height:e});return!n.height||!n.width?null:new this.ViewportType({...i,...this.props,...n})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const i in this.props.viewState)i!=="id"&&(e[i]=this.props.viewState[i]);return e}return t}getDimensions({width:t,height:e}){const i={x:Gu(this._x,t),y:Gu(this._y,e),width:Gu(this._width,t),height:Gu(this._height,e)};return this._padding&&(i.padding={left:Gu(this._padding.left,t),top:Gu(this._padding.top,e),right:Gu(this._padding.right,t),bottom:Gu(this._padding.bottom,e)}),i}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}};class iS{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){var e,i;this.cancel(),this.settings=t,this._inProgress=!0,(i=(e=this.settings).onStart)==null||i.call(e,this)}end(){var t,e;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(t=this.settings).onEnd)==null||e.call(t,this))}cancel(){var t,e;this._inProgress&&((e=(t=this.settings).onInterrupt)==null||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var t,e;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:n}=this;this._handle=i.addChannel({delay:i.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(t=this.settings).onUpdate)==null||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const MO=()=>{},qE={BREAK:1,SNAP_TO_END:2,IGNORE:3},bat=r=>r,wat=qE.BREAK;class Sat{constructor(t){this._onTransitionUpdate=e=>{const{time:i,settings:{interpolator:n,startProps:a,endProps:s,duration:o,easing:l}}=e,u=l(i/o),c=n.interpolateProps(a,s,u);this.propsInTransition=this.getControllerState({...this.props,...c}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new iS(t.timeline),this.onViewStateChange=t.onViewStateChange||MO,this.onStateChange=t.onStateChange||MO}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const i=this.props;if(this.props=t,!i||this._shouldIgnoreViewportChange(i,t))return!1;if(this._isTransitionEnabled(t)){let n=i;if(this.transition.inProgress){const{interruption:a,endProps:s}=this.transition.settings;n={...i,...a===qE.SNAP_TO_END?s:this.propsInTransition||i}}this._triggerTransition(n,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:i}=t;return(e>0||e==="auto")&&!!i}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===qE.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const i=this.getControllerState(t),n=this.getControllerState(e).shortestPathFrom(i),a=e.transitionInterpolator,s=a.getDuration?a.getDuration(t,e):e.transitionDuration;if(s===0)return;const o=a.initializeProps(t,n);this.propsInTransition={};const l={duration:s,easing:e.transitionEasing||bat,interpolator:a,interruption:e.transitionInterruption||wat,startProps:o.start,endProps:o.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(e)}}}function Kn(r,t){if(!r)throw new Error(t||"deck.gl: assertion failed.")}class Tat{constructor(t){const{compare:e,extract:i,required:n}=t;this._propsToCompare=e,this._propsToExtract=i||e,this._requiredProps=n}arePropsEqual(t,e){for(const i of this._propsToCompare)if(!(i in t)||!(i in e)||!nu(t[i],e[i]))return!1;return!0}initializeProps(t,e){const i={},n={};for(const a of this._propsToExtract)(a in t||a in e)&&(i[a]=t[a],n[a]=e[a]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const i=t[e];Kn(Number.isFinite(i)||Array.isArray(i),`${e} is required for transition`)})}}const Aat=["longitude","latitude","zoom","bearing","pitch"],Cat=["longitude","latitude","zoom"];class h$ extends Tat{constructor(t={}){const e=Array.isArray(t)?t:t.transitionProps,i=Array.isArray(t)?{}:t;i.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:Aat,required:Cat},super(i.transitionProps),this.opts=i}initializeProps(t,e){const i=super.initializeProps(t,e),{makeViewport:n,around:a}=this.opts;if(n&&a){const s=n(t),o=n(e),l=s.unproject(a);i.start.around=a,Object.assign(i.end,{around:o.project(l),aroundPosition:l,width:e.width,height:e.height})}return i}interpolateProps(t,e,i){const n={};for(const a of this._propsToExtract)n[a]=sg(t[a]||0,e[a]||0,i);if(e.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...e,...n});Object.assign(n,a.panByPosition(e.aroundPosition,sg(t.around,e.around,i)))}return n}}const ju={transitionDuration:0},Eat=300,ax=r=>1-(1-r)*(1-r),qd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},bh={};class Iat{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Sat({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){var t;for(const e in this._events)this._events[e]&&((t=this.eventManager)==null||t.off(e,this.handleEvent));this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return e?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:i}=this.props,{offsetCenter:n}=t;return[n.x-e,n.y-i]}isPointInBounds(t,e){const{width:i,height:n}=this.props;if(e&&e.handled)return!1;const a=t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=n;return a&&e&&e.stopPropagation(),a}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?Eat:0;const{scrollZoom:i=!0,dragPan:n=!0,dragRotate:a=!0,doubleClickZoom:s=!0,touchZoom:o=!0,touchRotate:l=!1,keyboard:u=!0}=t,c=!!this.onViewStateChange;this.toggleEvents(qd.WHEEL,c&&i),this.toggleEvents(qd.PAN,c),this.toggleEvents(qd.PINCH,c&&(o||l)),this.toggleEvents(qd.TRIPLE_PAN,c&&l),this.toggleEvents(qd.DOUBLE_TAP,c&&s),this.toggleEvents(qd.KEYBOARD,c&&u),this.scrollZoom=i,this.dragPan=n,this.dragRotate=a,this.doubleClickZoom=s,this.touchZoom=o,this.touchRotate=l,this.keyboard=u}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(i=>{this._events[i]!==e&&(this._events[i]=e,e?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(t,e=null,i={}){const n={...t.getViewportProps(),...e},a=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(i),a){const s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:s,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let i=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const n=this.controllerState[i?"panStart":"rotateStart"]({pos:e});return this._panMove=i,this.updateViewport(n,ju,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),i=this.controllerState.pan({pos:e});return this.updateViewport(i,ju,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const i=this.getCenter(t),n=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],a=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:ax},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),i=this.controllerState.rotate({pos:e});return this.updateViewport(i,ju,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const i=this.getCenter(t),n=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],a=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:ax},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:i=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=t;let s=2/(1+Math.exp(-Math.abs(a*i)));a<0&&s!==0&&(s=1/s);const o=this.controllerState.zoom({pos:e,scale:s});return this.updateViewport(o,{...this._getTransitionProps({around:e}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.rotateStart({pos:e});return this.updateViewport(i,ju,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const i=this.controllerState.rotate({pos:e});return this.updateViewport(i,ju,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const i=this.getCenter(t),n=[i[0],i[1]+=t.velocityY*e/2],a=this.controllerState.rotate({pos:n});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:ax},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return bh._startPinchRotation=t.rotation,bh._lastPinchEvent=t,this.updateViewport(i,ju,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:i}=t,n=this.getCenter(t);e=e.zoom({pos:n,scale:i})}if(this.touchRotate){const{rotation:i}=t;e=e.rotate({deltaAngleX:bh._startPinchRotation-i})}return this.updateViewport(e,ju,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),bh._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:i}=bh;if(this.touchZoom&&e&&i&&t.scale!==i.scale){const n=this.getCenter(t);let a=this.controllerState.rotateEnd();const s=Math.log2(t.scale),o=(s-Math.log2(i.scale))/(t.deltaTime-i.deltaTime),l=Math.pow(2,s+o*e/2);a=a.zoom({pos:n,scale:l}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:e,transitionEasing:ax},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return bh._startPinchRotation=null,bh._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.isFunctionKeyPressed(t),n=this.controllerState.zoom({pos:e,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:a,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let l;const u={};switch(t.srcEvent.code){case"Minus":l=e?o.zoomOut(i).zoomOut(i):o.zoomOut(i),u.isZooming=!0;break;case"Equal":l=e?o.zoomIn(i).zoomIn(i):o.zoomIn(i),u.isZooming=!0;break;case"ArrowLeft":e?(l=o.rotateLeft(a),u.isRotating=!0):(l=o.moveLeft(n),u.isPanning=!0);break;case"ArrowRight":e?(l=o.rotateRight(a),u.isRotating=!0):(l=o.moveRight(n),u.isPanning=!0);break;case"ArrowUp":e?(l=o.rotateUp(s),u.isRotating=!0):(l=o.moveUp(n),u.isPanning=!0);break;case"ArrowDown":e?(l=o.rotateDown(s),u.isRotating=!0):(l=o.moveDown(n),u.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),u),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?ju:t?{...e,transitionInterpolator:new h$({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class Mat{constructor(t,e){this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const PO=5,Pat=1.2;class Rat extends Mat{constructor(t){const{width:e,height:i,latitude:n,longitude:a,zoom:s,bearing:o=0,pitch:l=0,altitude:u=1.5,position:c=[0,0,0],maxZoom:h=20,minZoom:p=0,maxPitch:v=60,minPitch:y=0,startPanLngLat:x,startZoomLngLat:w,startRotatePos:T,startBearing:E,startPitch:M,startZoom:L,normalize:F=!0}=t;Kn(Number.isFinite(a)),Kn(Number.isFinite(n)),Kn(Number.isFinite(s)),super({width:e,height:i,latitude:n,longitude:a,zoom:s,bearing:o,pitch:l,altitude:u,maxZoom:h,minZoom:p,maxPitch:v,minPitch:y,normalize:F,position:c},{startPanLngLat:x,startZoomLngLat:w,startRotatePos:T,startBearing:E,startPitch:M,startZoom:L}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:e}){const i=this.getState().startPanLngLat||this._unproject(e);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,t);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:i=0}){const{startRotatePos:n,startBearing:a,startPitch:s}=this.getState();if(!n||a===void 0||s===void 0)return this;let o;return t?o=this._getNewRotation(t,n,s,a):o={bearing:a+e,pitch:s+i},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:e,scale:i}){let{startZoom:n,startZoomLngLat:a}=this.getState();if(a||(n=this.getViewportProps().zoom,a=this._unproject(e)||this._unproject(t)),!a)return this;const{maxZoom:s,minZoom:o}=this.getViewportProps();let l=n+Math.log2(i);l=dc(l,o,s);const u=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...u.panByPosition(a,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:a}=i;return Math.abs(n-e.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(a-e.longitude)>180&&(i.longitude=a<0?a+360:a-360),i}applyConstraints(t){const{maxZoom:e,minZoom:i,zoom:n}=t;t.zoom=dc(n,i,e);const{maxPitch:a,minPitch:s,pitch:o}=t;t.pitch=dc(o,s,a);const{normalize:l=!0}=t;return l&&Object.assign(t,fnt(t)),t}_zoomFromCenter(t){const{width:e,height:i}=this.getViewportProps();return this.zoom({pos:[e/2,i/2],scale:t})}_panFromCenter(t){const{width:e,height:i}=this.getViewportProps();return this.pan({startPos:[e/2,i/2],pos:[e/2+t[0],i/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,i,n){const a=t[0]-e[0],s=t[1]-e[1],o=t[1],l=e[1],{width:u,height:c}=this.getViewportProps(),h=a/u;let p=0;s>0?Math.abs(c-l)>PO&&(p=s/(l-c)*Pat):s<0&&l>PO&&(p=1-o/l),p=dc(p,-1,1);const{minPitch:v,maxPitch:y}=this.getViewportProps(),x=n+180*h;let w=i;return p>0?w=i+p*(y-i):p<0&&(w=i-p*(v-i)),{pitch:w,bearing:x}}}class Dat extends Iat{constructor(){super(...arguments),this.ControllerState=Rat,this.transition={transitionDuration:300,transitionInterpolator:new h$({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}let f$=class extends xat{constructor(t={}){super(t)}get ViewportType(){return Cy}get ControllerType(){return Dat}};f$.displayName="MapView";const Lat=f$,kat=new s$;function Oat(r,t){const e=r.order??1/0,i=t.order??1/0;return e-i}class Nat{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(i=>i.id===t.id)){const i=e.findIndex(n=>Oat(n,t)>0);i<0?e.push(t):e.splice(i,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(As(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const n of this.effects)e[n.id]=n;const i=[];for(const n of t){const a=e[n.id];let s=n;a&&a!==n?a.setProps?(a.setProps(n.props),s=a):a.cleanup(this._context):a||n.setup(this._context),i.push(s),delete e[n.id]}for(const n in e)e[n].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),t.some(n=>n instanceof s$)||this._resolvedEffects.push(kat),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Fat extends NP{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const Bat="deckRenderer.renderLayers";class zat{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Fat(t),this.pickLayersPass=new u$(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};i.effects&&this._preRender(i.effects,i);const n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const a=e.render({...i,target:n});i.effects&&this._postRender(i.effects,i),this.renderCount++,xa(Bat,this,a,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const i of t)e.preRenderStats[i.id]=i.preRender(e),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this,e=this.device.canvasContext.getDrawingBufferSize();t.length===0&&[0,1].map(i=>{const n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[n]}))});for(const i of t)i.resize(e)}_postRender(t,e){const{renderBuffers:i}=this,n={...e,inputBuffer:i[0],swapBuffer:i[1]};for(const a of t)if(a.postRender){n.target=a.id===this.lastPostProcessEffect?e.target:void 0;const s=a.postRender(n);n.inputBuffer=s,n.swapBuffer=s===i[0]?i[1]:i[0]}}}const Vat={pickedColor:null,pickedObjectIndex:-1};function Uat({pickedColors:r,decodePickingColor:t,deviceX:e,deviceY:i,deviceRadius:n,deviceRect:a}){const{x:s,y:o,width:l,height:u}=a;let c=n*n,h=-1,p=0;for(let v=0;v<u;v++){const y=v+o-i,x=y*y;if(x>c)p+=4*l;else for(let w=0;w<l;w++){if(r[p+3]-1>=0){const E=w+s-e,M=E*E+x;M<=c&&(c=M,h=p)}p+=4}}if(h>=0){const v=r.slice(h,h+4),y=t(v);if(y){const x=Math.floor(h/4/l),w=h/4-x*l;return{...y,pickedColor:v,pickedX:s+w,pickedY:o+x}}Wr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Vat}function $at({pickedColors:r,decodePickingColor:t}){const e=new Map;if(r){for(let i=0;i<r.length;i+=4)if(r[i+3]-1>=0){const a=r.slice(i,i+4),s=a.join(",");if(!e.has(s)){const o=t(a);o?e.set(s,{...o,color:a}):Wr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(e.values())}function d$({pickInfo:r,viewports:t,pixelRatio:e,x:i,y:n,z:a}){let s=t[0];t.length>1&&(s=Hat((r==null?void 0:r.pickedViewports)||t,{x:i,y:n}));let o;if(s){const l=[i-s.x,n-s.y];a!==void 0&&(l[2]=a),o=s.unproject(l)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:i,y:n,pixel:[i,n],coordinate:o,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:e}}function Wat(r){const{pickInfo:t,lastPickedInfo:e,mode:i,layers:n}=r,{pickedColor:a,pickedLayer:s,pickedObjectIndex:o}=t,l=s?[s]:[];if(i==="hover"){const h=e.index,p=e.layerId,v=s?s.props.id:null;if(v!==p||o!==h){if(v!==p){const y=n.find(x=>x.props.id===p);y&&l.unshift(y)}e.layerId=v,e.index=o,e.info=null}}const u=d$(r),c=new Map;return c.set(null,u),l.forEach(h=>{let p={...u};h===s&&(p.color=a,p.index=o,p.picked=!0),p=p$({layer:h,info:p,mode:i});const v=p.layer;h===s&&i==="hover"&&(e.info=p),c.set(v.id,p),i==="hover"&&v.updateAutoHighlight(p)}),c}function p$({layer:r,info:t,mode:e}){for(;r&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=r,t=r.getPickingInfo({info:t,mode:e,sourceLayer:i}),r=r.parent}return t}function Hat(r,t){for(let e=r.length-1;e>=0;e--){const i=r[e];if(i.containsPixel(t))return i}return r[0]}class Gat{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new u$(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:i,viewports:n},a=this.lastPickedInfo.info){const s=a&&a.layer&&a.layer.id,o=a&&a.viewport&&a.viewport.id,l=s?i.find(p=>p.id===s):null,u=o&&n.find(p=>p.id===o)||n[0],c=u&&u.unproject([t-u.x,e-u.y]);return{...a,...{x:t,y:e,viewport:u,coordinate:c,layer:l}}}_resizeBuffer(){var e,i;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const n=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=n}const{canvas:t}=this.device.getCanvasContext();(e=this.pickingFBO)==null||e.resize({width:t.width,height:t.height}),(i=this.depthFBO)==null||i.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return e.length?e:null}_pickClosestObject({layers:t,views:e,viewports:i,x:n,y:a,radius:s=0,depth:o=1,mode:l="query",unproject3D:u,onViewportActive:c,effects:h}){const p=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(t);if(!v||i.length===0)return{result:[],emptyInfo:d$({viewports:i,x:n,y:a,pixelRatio:p})};this._resizeBuffer();const y=this.device.canvasContext.cssToDevicePixels([n,a],!0),x=[y.x+Math.floor(y.width/2),y.y+Math.floor(y.height/2)],w=Math.round(s*p),{width:T,height:E}=this.pickingFBO,M=this._getPickingRect({deviceX:x[0],deviceY:x[1],deviceRadius:w,deviceWidth:T,deviceHeight:E}),L={x:n-s,y:a-s,width:s*2+1,height:s*2+1};let F;const O=[],U=new Set;for(let W=0;W<o;W++){let H;if(M){const Y=this._drawAndSample({layers:v,views:e,viewports:i,onViewportActive:c,deviceRect:M,cullRect:L,effects:h,pass:`picking:${l}`});H=Uat({...Y,deviceX:x[0],deviceY:x[1],deviceRadius:w,deviceRect:M})}else H={pickedColor:null,pickedObjectIndex:-1};let j;if(H.pickedLayer&&u&&this.depthFBO){const{pickedColors:Y}=this._drawAndSample({layers:[H.pickedLayer],views:e,viewports:i,onViewportActive:c,deviceRect:{x:H.pickedX,y:H.pickedY,width:1,height:1},cullRect:L,effects:h,pass:`picking:${l}:z`},!0);Y[3]&&(j=Y[0])}H.pickedLayer&&W+1<o&&(U.add(H.pickedLayer),H.pickedLayer.disablePickingIndex(H.pickedObjectIndex)),F=Wat({pickInfo:H,lastPickedInfo:this.lastPickedInfo,mode:l,layers:v,viewports:i,x:n,y:a,z:j,pixelRatio:p});for(const Y of F.values())Y.layer&&O.push(Y);if(!H.pickedColor)break}for(const W of U)W.restorePickingColors();return{result:O,emptyInfo:F.get(null)}}_pickVisibleObjects({layers:t,views:e,viewports:i,x:n,y:a,width:s=1,height:o=1,mode:l="query",maxObjects:u=null,onViewportActive:c,effects:h}){const p=this._getPickable(t);if(!p||i.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),y=this.device.canvasContext.cssToDevicePixels([n,a],!0),x=y.x,w=y.y+y.height,T=this.device.canvasContext.cssToDevicePixels([n+s,a+o],!0),E=T.x+T.width,M=T.y,L={x,y:M,width:E-x,height:w-M},F=this._drawAndSample({layers:p,views:e,viewports:i,onViewportActive:c,deviceRect:L,cullRect:{x:n,y:a,width:s,height:o},effects:h,pass:`picking:${l}`}),O=$at(F),U=new Map,W=[],H=Number.isFinite(u);for(let j=0;j<O.length&&!(H&&W.length>=u);j++){const Y=O[j];let tt={color:Y.pickedColor,layer:null,index:Y.pickedObjectIndex,picked:!0,x:n,y:a,pixelRatio:v};tt=p$({layer:Y.pickedLayer,info:tt,mode:l});const it=tt.layer.id;U.has(it)||U.set(it,new Set);const lt=U.get(it),ht=tt.object??tt.index;lt.has(ht)||(lt.add(ht),W.push(tt))}return W}_drawAndSample({layers:t,views:e,viewports:i,onViewportActive:n,deviceRect:a,cullRect:s,effects:o,pass:l},u=!1){const c=u?this.depthFBO:this.pickingFBO,h={layers:t,layerFilter:this.layerFilter,views:e,viewports:i,onViewportActive:n,pickingFBO:c,deviceRect:a,cullRect:s,effects:o,pass:l,pickZ:u,preRenderStats:{}};for(const E of o)E.useInPicking&&(h.preRenderStats[E.id]=E.preRender(h));const{decodePickingColor:p}=this.pickLayersPass.render(h),{x:v,y,width:x,height:w}=a,T=new(u?Float32Array:Uint8Array)(x*w*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:v,sourceY:y,sourceWidth:x,sourceHeight:w,target:T}),{pickedColors:T,decodePickingColor:p}}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:i,deviceWidth:n,deviceHeight:a}){const s=Math.max(0,t-i),o=Math.max(0,e-i),l=Math.min(n,t+i+1)-s,u=Math.min(a,e+i+1)-o;return l<=0||u<=0?null:{x:s,y:o,width:l,height:u}}}const jat={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Xat="top-left",RO="__root";class Zat{constructor({deck:t,parentElement:e}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=e}getWidgets(){return this.resolvedWidgets}setProps(t){t.widgets&&!As(t.widgets,this.widgets,1)&&this._setWidgets(t.widgets)}finalize(){for(const t of this.getWidgets())this._remove(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(e=>e.id===t.id)||(this._add(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}_setWidgets(t){const e={};for(const i of this.resolvedWidgets)e[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)e[i.id]=null,this.resolvedWidgets.push(i);for(let i of t){const n=e[i.id];n?n.viewId!==i.viewId||n.placement!==i.placement?(this._remove(n),this._add(i)):i!==n&&(n.setProps(i.props),i=n):this._add(i),e[i.id]=null,this.resolvedWidgets.push(i)}for(const i in e){const n=e[i];n&&this._remove(n)}this.widgets=t}_add(t){const{viewId:e=null,placement:i=Xat}=t,n=t.onAdd({deck:this.deck,viewId:e});n&&this._getContainer(e,i).append(n),t._element=n}_remove(t){t.onRemove(),t._element&&t._element.remove(),t._element=void 0}_getContainer(t,e){var s;const i=t||RO;let n=this.containers[i];n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",(s=this.parentElement)==null||s.append(n),this.containers[i]=n);let a=n.querySelector(`.${e}`);return a||(a=document.createElement("div"),a.className=e,a.style.position="absolute",a.style.zIndex="2",Object.assign(a.style,jat[e]),n.append(a)),a}_updateContainers(){const t=this.deck.width,e=this.deck.height;for(const i in this.containers){const n=this.lastViewports[i]||null,a=i===RO||n,s=this.containers[i];a?(s.style.display="block",s.style.left=`${n?n.x:0}px`,s.style.top=`${n?n.y:0}px`,s.style.width=`${n?n.width:t}px`,s.style.height=`${n?n.height:e}px`):s.style.display="none"}}onRedraw({viewports:t,layers:e}){var a,s;const i=t.reduce((o,l)=>(o[l.id]=l,o),{}),{lastViewports:n}=this;for(const o of this.getWidgets()){const{viewId:l}=o;if(l){const u=i[l];u&&(o.onViewportChange&&!u.equals(n[l])&&o.onViewportChange(u),(a=o.onRedraw)==null||a.call(o,{viewports:[u],layers:e}))}else{if(o.onViewportChange)for(const u of t)u.equals(n[u.id])||o.onViewportChange(u);(s=o.onRedraw)==null||s.call(o,{viewports:t,layers:e})}}this.lastViewports=i,this._updateContainers()}onHover(t,e){var i,n;for(const a of this.getWidgets()){const{viewId:s}=a;(!s||s===((i=t.viewport)==null?void 0:i.id))&&((n=a.onHover)==null||n.call(a,t,e))}}onEvent(t,e){var n,a;const i=WE[e.type];if(i)for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((n=t.viewport)==null?void 0:n.id))&&((a=s[i.handler])==null||a.call(s,t,e))}}}const qat={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Yat{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:t}){const e=document.createElement("div");return e.className="deck-tooltip",Object.assign(e.style,qat),this.deck=t,this.element=e,e}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(t){var e;this.isVisible&&t.id===((e=this.lastViewport)==null?void 0:e.id)&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){const{deck:e}=this,i=e&&e.props.getTooltip;if(!i)return;const n=i(t);this.lastViewport=t.viewport,this.setTooltip(n,t.x,t.y)}setTooltip(t,e,i){const n=this.element;if(n){if(typeof t=="string")n.innerText=t;else if(t)t.text&&(n.innerText=t.text),t.html&&(n.innerHTML=t.html),t.className&&(n.className=t.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform=`translate(${e}px, ${i}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(n.style,t.style)}}}var Ip;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.R16_EXT=33322]="R16_EXT",r[r.RG16_EXT=33324]="RG16_EXT",r[r.RGB16_EXT=32852]="RGB16_EXT",r[r.RGBA16_EXT=32859]="RGBA16_EXT",r[r.R16_SNORM_EXT=36760]="R16_SNORM_EXT",r[r.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",r[r.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",r[r.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",r[r.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",r[r.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",r[r.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",r[r.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",r[r.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",r[r.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",r[r.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",r[r.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",r[r.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",r[r.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",r[r.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",r[r.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",r[r.LINE_WEBGL=6913]="LINE_WEBGL",r[r.FILL_WEBGL=6914]="FILL_WEBGL",r[r.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",r[r.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",r[r.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",r[r.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",r[r.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",r[r.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",r[r.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",r[r.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",r[r.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",r[r.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",r[r.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",r[r.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",r[r.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",r[r.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",r[r.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",r[r.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",r[r.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",r[r.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",r[r.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",r[r.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",r[r.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",r[r.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",r[r.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",r[r.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Ip||(Ip={}));const BP={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},_n=(r,t,e)=>t?r.enable(e):r.disable(e),DO=(r,t,e)=>r.hint(e,t),ws=(r,t,e)=>r.pixelStorei(e,t),LO=(r,t,e)=>{const i=e===36006?36009:36008;return r.bindFramebuffer(i,t)},Xv=(r,t,e)=>{const n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[e];r.bindBuffer(n,t)};function TA(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}const Kat={3042:_n,32773:(r,t)=>r.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,t)=>r.clearColor(...t),3107:(r,t)=>r.colorMask(...t),2884:_n,2885:(r,t)=>r.cullFace(t),2929:_n,2931:(r,t)=>r.clearDepth(t),2932:(r,t)=>r.depthFunc(t),2928:(r,t)=>r.depthRange(...t),2930:(r,t)=>r.depthMask(t),3024:_n,35723:DO,35725:(r,t)=>r.useProgram(t),36007:(r,t)=>r.bindRenderbuffer(36161,t),36389:(r,t)=>{var e;return(e=r.bindTransformFeedback)==null?void 0:e.call(r,36386,t)},34229:(r,t)=>r.bindVertexArray(t),36006:LO,36010:LO,34964:Xv,36662:Xv,36663:Xv,35053:Xv,35055:Xv,2886:(r,t)=>r.frontFace(t),33170:DO,2849:(r,t)=>r.lineWidth(t),32823:_n,32824:"polygonOffset",10752:"polygonOffset",35977:_n,32926:_n,32928:_n,32938:"sampleCoverage",32939:"sampleCoverage",3089:_n,3088:(r,t)=>r.scissor(...t),2960:_n,2961:(r,t)=>r.clearStencil(t),2968:(r,t)=>r.stencilMaskSeparate(1028,t),36005:(r,t)=>r.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,t)=>r.viewport(...t),34383:_n,10754:_n,12288:_n,12289:_n,12290:_n,12291:_n,12292:_n,12293:_n,12294:_n,12295:_n,3333:ws,3317:ws,37440:ws,37441:ws,37443:ws,3330:ws,3332:ws,3331:ws,3314:ws,32878:ws,3316:ws,3315:ws,32877:ws,framebuffer:(r,t)=>{const e=t&&"handle"in t?t.handle:t;return r.bindFramebuffer(36160,e)},blend:(r,t)=>t?r.enable(3042):r.disable(3042),blendColor:(r,t)=>r.blendColor(...t),blendEquation:(r,t)=>{const e=typeof t=="number"?[t,t]:t;r.blendEquationSeparate(...e)},blendFunc:(r,t)=>{const e=(t==null?void 0:t.length)===2?[...t,...t]:t;r.blendFuncSeparate(...e)},clearColor:(r,t)=>r.clearColor(...t),clearDepth:(r,t)=>r.clearDepth(t),clearStencil:(r,t)=>r.clearStencil(t),colorMask:(r,t)=>r.colorMask(...t),cull:(r,t)=>t?r.enable(2884):r.disable(2884),cullFace:(r,t)=>r.cullFace(t),depthTest:(r,t)=>t?r.enable(2929):r.disable(2929),depthFunc:(r,t)=>r.depthFunc(t),depthMask:(r,t)=>r.depthMask(t),depthRange:(r,t)=>r.depthRange(...t),dither:(r,t)=>t?r.enable(3024):r.disable(3024),derivativeHint:(r,t)=>{r.hint(35723,t)},frontFace:(r,t)=>r.frontFace(t),mipmapHint:(r,t)=>r.hint(33170,t),lineWidth:(r,t)=>r.lineWidth(t),polygonOffsetFill:(r,t)=>t?r.enable(32823):r.disable(32823),polygonOffset:(r,t)=>r.polygonOffset(...t),sampleCoverage:(r,t)=>r.sampleCoverage(...t),scissorTest:(r,t)=>t?r.enable(3089):r.disable(3089),scissor:(r,t)=>r.scissor(...t),stencilTest:(r,t)=>t?r.enable(2960):r.disable(2960),stencilMask:(r,t)=>{t=TA(t)?t:[t,t];const[e,i]=t;r.stencilMaskSeparate(1028,e),r.stencilMaskSeparate(1029,i)},stencilFunc:(r,t)=>{t=TA(t)&&t.length===3?[...t,...t]:t;const[e,i,n,a,s,o]=t;r.stencilFuncSeparate(1028,e,i,n),r.stencilFuncSeparate(1029,a,s,o)},stencilOp:(r,t)=>{t=TA(t)&&t.length===3?[...t,...t]:t;const[e,i,n,a,s,o]=t;r.stencilOpSeparate(1028,e,i,n),r.stencilOpSeparate(1029,a,s,o)},viewport:(r,t)=>r.viewport(...t)};function tn(r,t,e){return t[r]!==void 0?t[r]:e[r]}const Jat={blendEquation:(r,t,e)=>r.blendEquationSeparate(tn(32777,t,e),tn(34877,t,e)),blendFunc:(r,t,e)=>r.blendFuncSeparate(tn(32969,t,e),tn(32968,t,e),tn(32971,t,e),tn(32970,t,e)),polygonOffset:(r,t,e)=>r.polygonOffset(tn(32824,t,e),tn(10752,t,e)),sampleCoverage:(r,t,e)=>r.sampleCoverage(tn(32938,t,e),tn(32939,t,e)),stencilFuncFront:(r,t,e)=>r.stencilFuncSeparate(1028,tn(2962,t,e),tn(2967,t,e),tn(2963,t,e)),stencilFuncBack:(r,t,e)=>r.stencilFuncSeparate(1029,tn(34816,t,e),tn(36003,t,e),tn(36004,t,e)),stencilOpFront:(r,t,e)=>r.stencilOpSeparate(1028,tn(2964,t,e),tn(2965,t,e),tn(2966,t,e)),stencilOpBack:(r,t,e)=>r.stencilOpSeparate(1029,tn(34817,t,e),tn(34818,t,e),tn(34819,t,e))},kO={enable:(r,t)=>r({[t]:!0}),disable:(r,t)=>r({[t]:!1}),pixelStorei:(r,t,e)=>r({[t]:e}),hint:(r,t,e)=>r({[t]:e}),useProgram:(r,t)=>r({35725:t}),bindRenderbuffer:(r,t,e)=>r({36007:e}),bindTransformFeedback:(r,t,e)=>r({36389:e}),bindVertexArray:(r,t)=>r({34229:t}),bindFramebuffer:(r,t,e)=>{switch(t){case 36160:return r({36006:e,36010:e});case 36009:return r({36006:e});case 36008:return r({36010:e});default:return null}},bindBuffer:(r,t,e)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return i?r({[i]:e}):{valueChanged:!0}},blendColor:(r,t,e,i,n)=>r({32773:new Float32Array([t,e,i,n])}),blendEquation:(r,t)=>r({32777:t,34877:t}),blendEquationSeparate:(r,t,e)=>r({32777:t,34877:e}),blendFunc:(r,t,e)=>r({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(r,t,e,i,n)=>r({32969:t,32968:e,32971:i,32970:n}),clearColor:(r,t,e,i,n)=>r({3106:new Float32Array([t,e,i,n])}),clearDepth:(r,t)=>r({2931:t}),clearStencil:(r,t)=>r({2961:t}),colorMask:(r,t,e,i,n)=>r({3107:[t,e,i,n]}),cullFace:(r,t)=>r({2885:t}),depthFunc:(r,t)=>r({2932:t}),depthRange:(r,t,e)=>r({2928:new Float32Array([t,e])}),depthMask:(r,t)=>r({2930:t}),frontFace:(r,t)=>r({2886:t}),lineWidth:(r,t)=>r({2849:t}),polygonOffset:(r,t,e)=>r({32824:t,10752:e}),sampleCoverage:(r,t,e)=>r({32938:t,32939:e}),scissor:(r,t,e,i,n)=>r({3088:new Int32Array([t,e,i,n])}),stencilMask:(r,t)=>r({2968:t,36005:t}),stencilMaskSeparate:(r,t,e)=>r({[t===1028?2968:36005]:e}),stencilFunc:(r,t,e,i)=>r({2962:t,2967:e,2963:i,34816:t,36003:e,36004:i}),stencilFuncSeparate:(r,t,e,i,n)=>r({[t===1028?2962:34816]:e,[t===1028?2967:36003]:i,[t===1028?2963:36004]:n}),stencilOp:(r,t,e,i)=>r({2964:t,2965:e,2966:i,34817:t,34818:e,34819:i}),stencilOpSeparate:(r,t,e,i,n)=>r({[t===1028?2964:34817]:e,[t===1028?2965:34818]:i,[t===1028?2966:34819]:n}),viewport:(r,t,e,i,n)=>r({2978:[t,e,i,n]})},Jo=(r,t)=>r.isEnabled(t),OO={3042:Jo,2884:Jo,2929:Jo,3024:Jo,32823:Jo,32926:Jo,32928:Jo,3089:Jo,2960:Jo,35977:Jo},Qat=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Sg(r,t){if(est(t))return;const e={};for(const n in t){const a=Number(n),s=Kat[n];s&&(typeof s=="string"?e[s]=!0:s(r,t[n],a))}const i=r.state&&r.state.cache;if(i)for(const n in e){const a=Jat[n];a(r,t,i)}}function g$(r,t=BP){if(typeof t=="number"){const n=t,a=OO[n];return a?a(r,n):r.getParameter(n)}const e=Array.isArray(t)?t:Object.keys(t),i={};for(const n of e){const a=OO[n];i[n]=a?a(r,Number(n)):r.getParameter(Number(n))}return i}function tst(r){Sg(r,BP)}function est(r){for(const t in r)return!1;return!0}function rst(r,t){if(r===t)return!0;const e=Array.isArray(r)||ArrayBuffer.isView(r),i=Array.isArray(t)||ArrayBuffer.isView(t);if(e&&i&&r.length===t.length){for(let n=0;n<r.length;++n)if(r[n]!==t[n])return!1;return!0}return!1}class ist{constructor(t,{copyState:e=!1,log:i=()=>{}}={}){st(this,"gl");st(this,"program",null);st(this,"stateStack",[]);st(this,"enable",!0);st(this,"cache");st(this,"log");this.gl=t,this.cache=e?g$(t):Object.assign({},BP),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){Di(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];Sg(this.gl,t),this.stateStack.pop()}_updateCache(t){let e=!1,i;const n=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const a in t){Di(a!==void 0);const s=t[a],o=this.cache[a];rst(s,o)||(e=!0,i=o,n&&!(a in n)&&(n[a]=o),this.cache[a]=s)}return{valueChanged:e,oldValue:i}}}function Bf(r){return r.state}function v$(r,t){const{enable:e=!0,copyState:i}=t;if(Di(i!==void 0),!r.state){r.state=new ist(r,{copyState:i}),ast(r);for(const a in kO){const s=kO[a];nst(r,a,s)}NO(r,"getParameter"),NO(r,"isEnabled")}const n=Bf(r);return n.enable=e,r}function nS(r){let t=Bf(r);t||(v$(r,{copyState:!1}),t=Bf(r)),t.push()}function Iy(r){const t=Bf(r);Di(t),t.pop()}function NO(r,t){const e=r[t].bind(r);r[t]=function(n){if(n===void 0||Qat.has(n))return e(n);const a=Bf(r);return n in a.cache||(a.cache[n]=e(n)),a.enable?a.cache[n]:e(n)},Object.defineProperty(r[t],"name",{value:`${t}-from-cache`,configurable:!1})}function nst(r,t,e){if(!r[t])return;const i=r[t].bind(r);r[t]=function(...a){const s=Bf(r),{valueChanged:o,oldValue:l}=e(s._updateCache,...a);return o&&i(...a),l},Object.defineProperty(r[t],"name",{value:`${t}-to-cache`,configurable:!1})}function ast(r){const t=r.useProgram.bind(r);r.useProgram=function(i){const n=Bf(r);n.program!==i&&(t(i),n.program=i)}}const sst={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function ost(r,t){t={...sst,...t};let e=null;const i=a=>e=a.statusMessage||e;r.addEventListener("webglcontextcreationerror",i,!1);let n=null;if(n||(n=r.getContext("webgl2",t)),r.removeEventListener("webglcontextcreationerror",i,!1),!n)throw new Error(`Failed to create WebGL context: ${e||"Unknown error"}`);if(t.onContextLost){const{onContextLost:a}=t;r.addEventListener("webglcontextlost",s=>a(s),!1)}if(t.onContextRestored){const{onContextRestored:a}=t;r.addEventListener("webglcontextrestored",s=>a(s),!1)}return n}function Fc(r,t,e){return e[t]===void 0&&(e[t]=r.getExtension(t)||null),e[t]}function lst(r,t){const e=r.getParameter(7936),i=r.getParameter(7937);Fc(r,"WEBGL_debug_renderer_info",t);const n=t.WEBGL_debug_renderer_info,a=r.getParameter(n?n.UNMASKED_VENDOR_WEBGL:7936),s=r.getParameter(n?n.UNMASKED_RENDERER_WEBGL:7937),o=a||e,l=s||i,u=r.getParameter(7938),c=m$(o,l),h=ust(o,l),p=cst(o,l);return{type:"webgl",gpu:c,gpuType:p,gpuBackend:h,vendor:o,renderer:l,version:u,shadingLanguage:"glsl",shadingLanguageVersion:300}}function m$(r,t){return/NVIDIA/i.exec(r)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(r)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(r)||/Apple/i.exec(t)?"apple":/AMD/i.exec(r)||/AMD/i.exec(t)||/ATI/i.exec(r)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(r)||/SwiftShader/i.exec(t)?"software":"unknown"}function ust(r,t){return/Metal/i.exec(r)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(r)||/ANGLE/i.exec(t)?"opengl":"unknown"}function cst(r,t){if(/SwiftShader/i.exec(r)||/SwiftShader/i.exec(t))return"cpu";switch(m$(r,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function y$(r){switch(r){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(r))}const ga="texture-compression-bc",yi="texture-compression-astc",Qo="texture-compression-etc2",hst="texture-compression-etc1-webgl",sx="texture-compression-pvrtc-webgl",AA="texture-compression-atc-webgl",Zv="float32-renderable-webgl",CA="float16-renderable-webgl",fst="rgb9e5ufloat_renderable-webgl",EA="snorm8-renderable-webgl",qv="norm16-renderable-webgl",IA="snorm16-renderable-webgl",ox="float32-filterable",FO="float16-filterable-webgl",km="WEBGL_compressed_texture_s3tc",Om="WEBGL_compressed_texture_s3tc_srgb",Mp="EXT_texture_compression_rgtc",Pp="EXT_texture_compression_bptc",dst="WEBGL_compressed_texture_etc",pst="WEBGL_compressed_texture_astc",gst="WEBGL_compressed_texture_etc1",vst="WEBGL_compressed_texture_pvrtc",mst="WEBGL_compressed_texture_atc",BO="EXT_texture_norm16",zO="EXT_render_snorm",yst="EXT_color_buffer_float",zP={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[zO],"norm16-renderable-webgl":[BO],"snorm16-renderable-webgl":[BO,zO],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[km,Om,Mp,Pp],"texture-compression-bc5-webgl":[Mp],"texture-compression-bc7-webgl":[Pp],"texture-compression-etc2":[dst],"texture-compression-astc":[pst],"texture-compression-etc1-webgl":[gst],"texture-compression-pvrtc-webgl":[vst],"texture-compression-atc-webgl":[mst]};function _st(r){return r in zP}function xst(r,t,e){return(zP[t]||[]).every(n=>Fc(r,n,e))}const aS={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:EA},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:EA},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:CA,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:qv,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:IA},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:EA},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:CA,filter:FO,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:qv},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:IA},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Zv,filter:ox},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:fst},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Zv,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:qv},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:qv},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Zv,filter:ox,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:CA,filter:FO},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:qv,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:IA},"rgb32float-webgl":{gl:34837,render:Zv,filter:ox,gl2ext:yst,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Zv,filter:ox,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:km,f:ga},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Om,f:ga},"bc1-rgba-unorm":{gl:33777,x:km,f:ga},"bc1-rgba-unorm-srgb":{gl:35916,x:Om,f:ga},"bc2-rgba-unorm":{gl:33778,x:km,f:ga},"bc2-rgba-unorm-srgb":{gl:35918,x:Om,f:ga},"bc3-rgba-unorm":{gl:33779,x:km,f:ga},"bc3-rgba-unorm-srgb":{gl:35919,x:Om,f:ga},"bc4-r-unorm":{gl:36283,x:Mp,f:ga},"bc4-r-snorm":{gl:36284,x:Mp,f:ga},"bc5-rg-unorm":{gl:36285,x:Mp,f:ga},"bc5-rg-snorm":{gl:36286,x:Mp,f:ga},"bc6h-rgb-ufloat":{gl:36495,x:Pp,f:ga},"bc6h-rgb-float":{gl:36494,x:Pp,f:ga},"bc7-rgba-unorm":{gl:36492,x:Pp,f:ga},"bc7-rgba-unorm-srgb":{gl:36493,x:Pp,f:ga},"etc2-rgb8unorm":{gl:37492,f:Qo},"etc2-rgb8unorm-srgb":{gl:37494,f:Qo},"etc2-rgb8a1unorm":{gl:37496,f:Qo},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Qo},"etc2-rgba8unorm":{gl:37493,f:Qo},"etc2-rgba8unorm-srgb":{gl:37495,f:Qo},"eac-r11unorm":{gl:37488,f:Qo},"eac-r11snorm":{gl:37489,f:Qo},"eac-rg11unorm":{gl:37490,f:Qo},"eac-rg11snorm":{gl:37491,f:Qo},"astc-4x4-unorm":{gl:37808,f:yi},"astc-4x4-unorm-srgb":{gl:37840,f:yi},"astc-5x4-unorm":{gl:37809,f:yi},"astc-5x4-unorm-srgb":{gl:37841,f:yi},"astc-5x5-unorm":{gl:37810,f:yi},"astc-5x5-unorm-srgb":{gl:37842,f:yi},"astc-6x5-unorm":{gl:37811,f:yi},"astc-6x5-unorm-srgb":{gl:37843,f:yi},"astc-6x6-unorm":{gl:37812,f:yi},"astc-6x6-unorm-srgb":{gl:37844,f:yi},"astc-8x5-unorm":{gl:37813,f:yi},"astc-8x5-unorm-srgb":{gl:37845,f:yi},"astc-8x6-unorm":{gl:37814,f:yi},"astc-8x6-unorm-srgb":{gl:37846,f:yi},"astc-8x8-unorm":{gl:37815,f:yi},"astc-8x8-unorm-srgb":{gl:37847,f:yi},"astc-10x5-unorm":{gl:37819,f:yi},"astc-10x5-unorm-srgb":{gl:37851,f:yi},"astc-10x6-unorm":{gl:37817,f:yi},"astc-10x6-unorm-srgb":{gl:37849,f:yi},"astc-10x8-unorm":{gl:37818,f:yi},"astc-10x8-unorm-srgb":{gl:37850,f:yi},"astc-10x10-unorm":{gl:37819,f:yi},"astc-10x10-unorm-srgb":{gl:37851,f:yi},"astc-12x10-unorm":{gl:37820,f:yi},"astc-12x10-unorm-srgb":{gl:37852,f:yi},"astc-12x12-unorm":{gl:37821,f:yi},"astc-12x12-unorm-srgb":{gl:37853,f:yi},"pvrtc-rgb4unorm-webgl":{gl:35840,f:sx},"pvrtc-rgba4unorm-webgl":{gl:35842,f:sx},"pvrtc-rbg2unorm-webgl":{gl:35841,f:sx},"pvrtc-rgba2unorm-webgl":{gl:35843,f:sx},"etc1-rbg-unorm-webgl":{gl:36196,f:hst},"atc-rgb-unorm-webgl":{gl:35986,f:AA},"atc-rgba-unorm-webgl":{gl:35986,f:AA},"atc-rgbai-unorm-webgl":{gl:34798,f:AA}},bst={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},wst={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function VP(r,t,e){const i=aS[t];if(!i||i.gl===void 0)return!1;const n=i.x||i.gl2ext;return n?!!Fc(r,n,e):!0}function _$(r){const t=aS[r],e=t==null?void 0:t.gl;if(e===void 0)throw new Error(`Unsupported texture format ${r}`);return e}function Sst(r,t,e){if(!VP(r,t,e)||t.startsWith("depth")||t.startsWith("stencil"))return!1;try{if(v8(t).signed)return!1}catch{return!1}return t.endsWith("32float")?!!Fc(r,"OES_texture_float_linear, extensions",e):t.endsWith("16float")?!!Fc(r,"OES_texture_half_float_linear, extensions",e):!0}function Tst(r,t,e){return!(!VP(r,t,e)||typeof t=="number")}function Eb(r){var n;const t=aS[r],e=_$(r),i=v8(r);return{format:e,dataFormat:(t==null?void 0:t.dataFormat)||Cst(i.format,i.integer,i.normalized,e),type:i.dataType?y$(i.dataType):((n=t==null?void 0:t.types)==null?void 0:n[0])||5121,compressed:i.compressed}}function Ast(r){const t=aS[r];if(!(t!=null&&t.attachment))throw new Error(`${r} is not a depth stencil format`);return t.attachment}function VO(r){const t=Eb(r),e=bst[t.dataFormat]||4,i=wst[t.type]||1;return e*i}function Cst(r,t,e,i){if(i===6408||i===6407)return i;switch(r){case"r":return t&&!e?36244:6403;case"rg":return t&&!e?33320:33319;case"rgb":return t&&!e?36248:6407;case"rgba":return t&&!e?36249:6408;default:return 6408}}const UO={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Est extends _tt{constructor(e,i,n){super([],n);st(this,"gl");st(this,"extensions");st(this,"testedFeatures",new Set);this.gl=e,this.extensions=i,Fc(e,"EXT_color_buffer_float",i)}*[Symbol.iterator](){const e=this.getFeatures();for(const i of e)this.has(i)&&(yield i);return[]}has(e){return this.disabledFeatures[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),_st(e)&&xst(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(i=>i!=="polygon-mode-webgl");for(const i of e)this.has(i)}getFeatures(){return[...Object.keys(UO),...Object.keys(zP)]}getWebGLFeature(e){const i=UO[e];return typeof i=="string"?!!Fc(this.gl,i,this.extensions):!!i}}class Ist extends ytt{constructor(e){super();st(this,"gl");st(this,"limits",{});this.gl=e}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]}}function gc(r,t,e){if(Mst(t))return e(r);const{nocatch:i=!0}=t;nS(r),Sg(r,t);let n;if(i)n=e(r),Iy(r);else try{n=e(r)}finally{Iy(r)}return n}function Mst(r){for(const t in r)return!1;return!0}function Pst(r,t,e,i){if(gb(t))return i(r);const n=r;nS(n.gl);try{return Rst(r,t),Sg(n.gl,e),i(r)}finally{Iy(n.gl)}}function Rst(r,t){const e=r,{gl:i}=e;if(t.cullMode)switch(t.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(t.frontFace&&i.frontFace(Sf("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&r.features.has("depth-clip-control")&&i.enable(34383),t.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&r.features.has("provoking-vertex-webgl")){const a=e.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=Sf("provokingVertex",t.provokingVertex,{first:36429,last:36430});a==null||a.provokingVertexWEBGL(s)}if((t.polygonMode||t.polygonOffsetLine)&&r.features.has("polygon-mode-webgl")){if(t.polygonMode){const a=e.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=Sf("polygonMode",t.polygonMode,{fill:6914,line:6913});a==null||a.polygonModeWEBGL(1028,s),a==null||a.polygonModeWEBGL(1029,s)}t.polygonOffsetLine&&i.enable(10754)}if(r.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&i.enable(12288),t.clipDistance1&&i.enable(12289),t.clipDistance2&&i.enable(12290),t.clipDistance3&&i.enable(12291),t.clipDistance4&&i.enable(12292),t.clipDistance5&&i.enable(12293),t.clipDistance6&&i.enable(12294),t.clipDistance7&&i.enable(12295)),t.depthWriteEnabled!==void 0&&i.depthMask(Lst("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(YE("depthCompare",t.depthCompare))),t.stencilWriteMask){const n=t.stencilWriteMask;i.stencilMaskSeparate(1028,n),i.stencilMaskSeparate(1029,n)}if(t.stencilReadMask&&_e.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const n=t.stencilReadMask||4294967295,a=YE("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,a,0,n),i.stencilFuncSeparate(1029,a,0,n)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const n=MA("stencilPassOperation",t.stencilPassOperation),a=MA("stencilFailOperation",t.stencilFailOperation),s=MA("stencilDepthFailOperation",t.stencilDepthFailOperation);i.stencilOpSeparate(1028,a,s,n),i.stencilOpSeparate(1029,a,s,n)}if(t.blendColorOperation||t.blendAlphaOperation){i.enable(3042);const n=$O("blendColorOperation",t.blendColorOperation||"add"),a=$O("blendAlphaOperation",t.blendAlphaOperation||"add");i.blendEquationSeparate(n,a);const s=lx("blendColorSrcFactor",t.blendColorSrcFactor||"one"),o=lx("blendColorDstFactor",t.blendColorDstFactor||"zero"),l=lx("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),u=lx("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");i.blendFuncSeparate(s,o,l,u)}}function YE(r,t){return Sf(r,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function MA(r,t){return Sf(r,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function $O(r,t){return Sf(r,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function lx(r,t){return Sf(r,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Dst(r,t){return`Illegal parameter ${t} for ${r}`}function Sf(r,t,e){if(!(t in e))throw new Error(Dst(r,t));return e[t]}function Lst(r,t){return t}function x$(r){const t={};return r.addressModeU&&(t[10242]=PA(r.addressModeU)),r.addressModeV&&(t[10243]=PA(r.addressModeV)),r.addressModeW&&(t[32882]=PA(r.addressModeW)),r.magFilter&&(t[10240]=b$(r.magFilter)),(r.minFilter||r.mipmapFilter)&&(t[10241]=kst(r.minFilter||"linear",r.mipmapFilter)),r.lodMinClamp!==void 0&&(t[33082]=r.lodMinClamp),r.lodMaxClamp!==void 0&&(t[33083]=r.lodMaxClamp),r.type==="comparison-sampler"&&(t[34892]=34894),r.compare&&(t[34893]=YE("compare",r.compare)),r.maxAnisotropy&&(t[34046]=r.maxAnisotropy),t}function PA(r){switch(r){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function b$(r){switch(r){case"nearest":return 9728;case"linear":return 9729}}function kst(r,t){if(!t)return b$(r);switch(r){case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class Pc extends rn{constructor(e,i={}){super(e,i);st(this,"device");st(this,"gl");st(this,"handle");st(this,"glTarget");st(this,"glUsage");st(this,"glIndexType",5123);st(this,"byteLength");st(this,"bytesUsed");this.device=e,this.gl=this.device.gl;const n=typeof i=="object"?i.handle:void 0;this.handle=n||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Ost(this.props.usage),this.glUsage=Nst(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,i.data?this._initWithData(i.data,i.byteOffset,i.byteLength):this._initWithByteLength(i.byteLength||0)}_initWithData(e,i=0,n=e.byteLength+i){const a=this.glTarget;this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,n,this.glUsage),this.gl.bufferSubData(a,i,e),this.gl.bindBuffer(a,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,i,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){Di(e>=0);let i=e;e===0&&(i=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,i=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,i,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,i,e.byteLength)}async readAsync(e=0,i){return this.readSyncWebGL(e,i)}readSyncWebGL(e=0,i){i=i??this.byteLength-e;const n=new Uint8Array(i),a=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,a,i),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,i),n}}function Ost(r){return r&rn.INDEX?34963:r&rn.VERTEX?34962:r&rn.UNIFORM?35345:34962}function Nst(r){return r&rn.INDEX||r&rn.VERTEX?35044:r&rn.UNIFORM?35048:35044}class KE extends yb{constructor(e,i){super(e,i);st(this,"device");st(this,"handle");st(this,"parameters");this.device=e,this.parameters=x$(i),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[i,n]of Object.entries(e)){const a=Number(i);switch(a){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,a,n);break;default:this.device.gl.samplerParameteri(this.handle,a,n);break}}}}class Rp extends vb{constructor(e,i){super(e,{...eo.defaultProps,...i});st(this,"device");st(this,"gl");st(this,"handle");st(this,"texture");this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=i.texture}}const Fst={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},by=class by extends eo{constructor(e,i){var n;super(e,{...Fst,format:"rgba8unorm",...i});st(this,"MAX_ATTRIBUTES");st(this,"device");st(this,"gl");st(this,"handle");st(this,"sampler");st(this,"view");st(this,"glFormat");st(this,"type");st(this,"dataFormat");st(this,"mipmaps");st(this,"target");st(this,"textureUnit");st(this,"loaded",!1);st(this,"_video");this.device=e,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=Bst(this.props),this.loaded=!1,typeof((n=this.props)==null?void 0:n.data)=="string"&&Object.assign(this.props,{data:set(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(e){return new Rp(this.device,{...e,texture:this})}initialize(e={}){if(this.props.dimension==="cube")return this.initializeCube(e);let i=e.data;if(i instanceof Promise)return i.then(T=>this.initialize(Object.assign({},e,{pixels:T,data:T}))),this;const n=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement;if(n&&i.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,i.addEventListener("loadeddata",()=>this.initialize(e)),this;const{parameters:a={}}=e,{pixels:s=null,pixelStore:o={},textureUnit:l=void 0,mipmaps:u=!0}=e;i||(i=s);let{width:c,height:h,dataFormat:p,type:v,compressed:y=!1}=e;const{depth:x=0}=e,w=_$(e.format);return{width:c,height:h,compressed:y,dataFormat:p,type:v}=this._deduceParameters({format:e.format,type:v,dataFormat:p,compressed:y,data:i,width:c,height:h}),this.width=c,this.height=h,this.glFormat=w,this.type=v,this.dataFormat=p,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=u,this.setImageData({data:i,width:c,height:h,depth:x,format:e.format,type:v,dataFormat:p,parameters:o,compressed:y}),this.setSampler(e.sampler),this._setSamplerParameters(a),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),u&&this.device.isTextureFormatFilterable(e.format)&&this.generateMipmap(),n&&(this._video={video:i,parameters:a,lastTime:i.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?i.currentTime:-1}),this}initializeCube(e){const{mipmaps:i=!0,parameters:n={}}=e;return this.setCubeMapImageData(e).then(()=>{this.loaded=!0,i&&this.generateMipmap(e),this.setSampler(e.sampler),this._setSamplerParameters(n)}),this}setSampler(e={}){let i;e instanceof KE?(this.sampler=e,i=e.props):(this.sampler=new KE(this.device,e),i=e);const n=x$(i);return this._setSamplerParameters(n),this}resize(e){const{height:i,width:n,mipmaps:a=!1}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:a}):this}update(){if(this._video){const{video:e,parameters:i,lastTime:n}=this._video;if(n===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:i}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}generateMipmap(e={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),gc(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(e){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(e);this.trackDeallocatedMemory("Texture");const{target:i=this.target,pixels:n=null,level:a=0,glFormat:s=this.glFormat,offset:o=0,parameters:l={}}=e;let{data:u=null,type:c=this.type,width:h=this.width,height:p=this.height,dataFormat:v=this.dataFormat,compressed:y=!1}=e;u||(u=n),{type:c,dataFormat:v,compressed:y,width:h,height:p}=this._deduceParameters({format:this.props.format,type:c,dataFormat:v,compressed:y,data:u,width:h,height:p});const{gl:x}=this;x.bindTexture(this.target,this.handle);let w=null;if({data:u,dataType:w}=this._getDataType({data:u,compressed:y}),gc(this.gl,l,()=>{switch(w){case"null":x.texImage2D(i,a,s,h,p,0,v,c,u);break;case"typed-array":x.texImage2D(i,a,s,h,p,0,v,c,u,o);break;case"buffer":this.device.gl.bindBuffer(35052,u.handle||u),this.device.gl.texImage2D(i,a,s,h,p,0,v,c,o),this.device.gl.bindBuffer(35052,null);break;case"browser-object":x.texImage2D(i,a,s,h,p,0,v,c,u);break;case"compressed":for(const[T,E]of u.entries())x.compressedTexImage2D(i,T,E.format,E.width,E.height,0,E.data);break;default:Di(!1,"Unknown image data type")}}),u&&u.byteLength)this.trackAllocatedMemory(u.byteLength,"Texture");else{const T=VO(this.props.format);this.trackAllocatedMemory(this.width*this.height*T,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:i=null,data:n=null,x:a=0,y:s=0,width:o=this.width,height:l=this.height,level:u=0,glFormat:c=this.glFormat,type:h=this.type,dataFormat:p=this.dataFormat,compressed:v=!1,offset:y=0,parameters:x={}}){if({type:h,dataFormat:p,compressed:v,width:o,height:l}=this._deduceParameters({format:this.props.format,type:h,dataFormat:p,compressed:v,data:n,width:o,height:l}),Di(this.depth===1,"texSubImage not supported for 3D textures"),n||(n=i),n&&n.data){const w=n;n=w.data,o=w.shape[0],l=w.shape[1]}n instanceof Pc&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),gc(this.gl,x,()=>{v?this.gl.compressedTexSubImage2D(e,u,a,s,o,l,c,n):n===null?this.gl.texSubImage2D(e,u,a,s,o,l,p,h,null):ArrayBuffer.isView(n)?this.gl.texSubImage2D(e,u,a,s,o,l,p,h,n,y):typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,n),this.device.gl.texSubImage2D(e,u,a,s,o,l,p,h,y),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(e,u,a,s,o,l,p,h,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return _e.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){const{gl:i}=this;return e!==void 0&&(this.textureUnit=e,i.activeTexture(33984+e)),i.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:i}=this;return e!==void 0&&(this.textureUnit=e,i.activeTexture(33984+e)),i.bindTexture(this.target,null),e}_getDataType({data:e,compressed:i=!1}){return i?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Pc?{data:e.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&e instanceof WebGLBuffer?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:i,data:n}=e;let{width:a,height:s,dataFormat:o,type:l,compressed:u}=e;const c=Eb(i);return o=o||c.dataFormat,l=l||c.type,u=u||c.compressed,{width:a,height:s}=this._deduceImageSize(n,a,s),{dataFormat:o,type:l,compressed:u,width:a,height:s,format:i,data:n}}_deduceImageSize(e,i,n){let a;return typeof ImageData<"u"&&e instanceof ImageData?a={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?a={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?a={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?a={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?a={width:e.videoWidth,height:e.videoHeight}:e?a={width:i,height:n}:a={width:i>=0?i:1,height:n>=0?n:1},Di(a,"Could not deduced texture size"),Di(i===void 0||a.width===i,"Deduced texture width does not match supplied width"),Di(n===void 0||a.height===n,"Deduced texture height does not match supplied height"),a}async setCubeMapImageData(e){const{gl:i}=this,{width:n,height:a,pixels:s,data:o,format:l=6408,type:u=5121}=e,c=s||o,h=await Promise.all(by.FACES.map(p=>{const v=c[p];return Promise.all(Array.isArray(v)?v:[v])}));this.bind(),by.FACES.forEach((p,v)=>{h[v].length>1&&this.props.mipmaps!==!1&&_e.warn(`${this.id} has mipmap and multiple LODs.`)(),h[v].forEach((y,x)=>{n&&a?i.texImage2D(p,x,l,n,a,0,l,u,y):i.texImage2D(p,x,l,l,u,y)})}),this.unbind()}setImageDataForFace(e){const{face:i,width:n,height:a,pixels:s,data:o,format:l=6408,type:u=5121}=e,{gl:c}=this,h=s||o;return this.bind(),h instanceof Promise?h.then(p=>this.setImageDataForFace(Object.assign({},e,{face:i,data:p,pixels:p}))):this.width||this.height?c.texImage2D(i,0,l,n,a,0,l,u,h):c.texImage2D(i,0,l,l,u,h),this}setImageData3D(e){const{level:i=0,dataFormat:n,format:a,type:s,width:o,height:l,depth:u=1,offset:c=0,data:h,parameters:p={}}=e;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const v=Eb(a);if(gc(this.gl,p,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,i,v.format,o,l,u,0,v.dataFormat,v.type,h),h instanceof Pc&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,i,n,o,l,u,0,a,s,c))}),h&&h.byteLength)this.trackAllocatedMemory(h.byteLength,"Texture");else{const y=VO(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*y,"Texture")}return this.loaded=!0,this}_setSamplerParameters(e){if(!gb(e)){zst(e),this.gl.bindTexture(this.target,this.handle);for(const[i,n]of Object.entries(e)){const a=Number(i),s=n;switch(a){case 33082:case 33083:this.gl.texParameterf(this.target,a,s);break;default:this.gl.texParameteri(this.target,a,s);break}}this.gl.bindTexture(this.target,null)}}};st(by,"FACES",[34069,34070,34071,34072,34073,34074]);let pl=by;function Bst(r){switch(r.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(r.dimension)}}function zst(r){_e.log(1,"texture sampler parameters",r)()}class Qm extends _b{constructor(e,i){super(e,i);st(this,"device");st(this,"gl");st(this,"handle");const n=i.handle===null;if(this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),!n){e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const a=this.gl.bindFramebuffer(36160,this.handle);for(let s=0;s<this.colorAttachments.length;++s){const o=this.colorAttachments[s],l=36064+s;o&&this._attachOne(l,o)}if(this.depthStencilAttachment&&this._attachOne(Ast(this.depthStencilAttachment.props.format),this.depthStencilAttachment),i.check!==!1){const s=this.gl.checkFramebufferStatus(36160);if(s!==36053)throw new Error(`Framebuffer ${Ust(s)}`)}this.gl.bindFramebuffer(36160,a)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(e){return new pl(this.device,{id:`${this.id}-depth-stencil`,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,i){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight);for(const n of this.colorAttachments)n.texture.resize({width:e,height:i});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:e,height:i}),this}_attachOne(e,i){if(Array.isArray(i)){const[n,a=0,s=0]=i;return this._attachTexture(e,n,a,s),n}if(i instanceof pl)return this._attachTexture(e,i,0,0),i;if(i instanceof Rp){const n=i;return this._attachTexture(e,n.texture,n.props.baseMipLevel,n.props.baseArrayLayer),i.texture}throw new Error("attach")}_attachTexture(e,i,n,a){const{gl:s}=this.device;switch(s.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:s.framebufferTextureLayer(36160,e,i.target,a,n);break;case 34067:const o=Vst(n);s.framebufferTexture2D(36160,e,o,i.handle,a);break;case 3553:s.framebufferTexture2D(36160,e,3553,i.handle,a);break;default:Di(!1,"Illegal texture type")}s.bindTexture(i.target,null)}}function Vst(r){return r<34069?r+34069:r}function Ust(r){switch(r){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${r}`}}class $st extends CP{constructor(e,i){super(i);st(this,"device");st(this,"presentationSize");st(this,"_framebuffer",null);this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Qm(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const i=this.getDevicePixelRatio(e==null?void 0:e.useDevicePixels);this.setDevicePixelRatio(i,e);return}}commit(){}}const Wst={spector:_e.get("spector")||_e.get("spectorjs")},Hst="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",Gst=1;let _i=null,WO=!1;async function jst(r){if(!globalThis.SPECTOR)try{await T8(Hst)}catch(t){_e.warn(String(t))}}function Xst(r){if(r={...Wst,...r},!(r!=null&&r.spector)||(!_i&&globalThis.SPECTOR&&(_e.probe(Gst,"SPECTOR found and initialized")(),_i=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=_i)),!_i))return null;if(WO||(WO=!0,_i.spyCanvases(),_i==null||_i.onCaptureStarted.add(t=>_e.info("Spector capture started:",t)()),_i==null||_i.onCapture.add(t=>{_e.info("Spector capture complete:",t)(),_i==null||_i.getResultUI(),_i==null||_i.resultView.display(),_i==null||_i.resultView.addCapture(t)})),r!=null&&r.canvas){if(typeof r.spector=="string"&&r.spector!==r.canvas.id)return _i;_i==null||_i.startCapture(r==null?void 0:r.canvas,500),new Promise(t=>setTimeout(t,2e3)).then(t=>{_e.info("Spector capture stopped after 2 seconds")(),_i==null||_i.stopCapture()})}return _i}const Zst="https://unpkg.com/webgl-debug@2.0.1/index.js";function w$(r){return r.luma=r.luma||{},r.luma}async function qst(){qc()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await T8(Zst))}function Yst(r,t={}){return r?t.debug?Jst(r,t):Kst(r):null}function Kst(r){const t=w$(r);return t.realContext?t.realContext:r}function Jst(r,t){if(!globalThis.WebGLDebugUtils)return _e.warn("webgl-debug not loaded")(),r;const e=w$(r);if(e.debugContext)return e.debugContext;globalThis.WebGLDebugUtils.init({...Ip,...r});const i=globalThis.WebGLDebugUtils.makeDebugContext(r,Qst.bind(null,t),tot.bind(null,t));for(const s in Ip)!(s in i)&&typeof Ip[s]=="number"&&(i[s]=Ip[s]);class n{}Object.setPrototypeOf(i,Object.getPrototypeOf(r)),Object.setPrototypeOf(n,i);const a=Object.create(n);return e.realContext=r,e.debugContext=a,a.debug=!0,a}function RA(r,t){t=Array.from(t).map(i=>i===void 0?"undefined":i);let e=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,t);return e=`${e.slice(0,100)}${e.length>100?"...":""}`,`gl.${r}(${e})`}function Qst(r,t,e,i){i=Array.from(i).map(o=>o===void 0?"undefined":o);const n=globalThis.WebGLDebugUtils.glEnumToString(t),a=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,i),s=`${n} in gl.${e}(${a})`;_e.error(s)();debugger;if(r.throwOnError)throw new Error(s)}function tot(r,t,e){let i="";if(_e.level>=1&&(i=RA(t,e),_e.log(1,i)()),r.break&&r.break.length>0&&(i=i||RA(t,e),r.break.every(a=>i.indexOf(a)!==-1)))debugger;for(const n of e)if(n===void 0){if(i=i||RA(t,e),r.throwOnError)throw new Error(`Undefined argument: ${i}`);_e.error(`Undefined argument: ${i}`)();debugger}}function eot(r){const t=r.split(/\r?\n/),e=[];for(const i of t){if(i.length<=1)continue;const n=i.split(":");if(n.length===2){const[h,p]=n;e.push({message:p.trim(),type:HO(h),lineNum:0,linePos:0});continue}const[a,s,o,...l]=n;let u=parseInt(o,10);isNaN(u)&&(u=0);let c=parseInt(s,10);isNaN(c)&&(c=0),e.push({message:l.join(":").trim(),type:HO(a),lineNum:u,linePos:c})}return e}function HO(r){const t=["warning","error","info"],e=r.toLowerCase();return t.includes(e)?e:"info"}class rot extends mb{constructor(e,i){super(e,i);st(this,"device");st(this,"handle");switch(this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return eot(e)}getTranslatedSource(){const i=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return i==null?void 0:i.getTranslatedShaderSource(this.handle)}async _compile(e){e=(a=>a.startsWith("#version ")?a:`#version 100
${a}`)(e);const{gl:n}=this.device;if(n.shaderSource(this.handle,e),n.compileShader(this.handle),_e.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}_e.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),_e.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async a=>await new Promise(s=>setTimeout(s,a));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const iot=256,not=1024,aot=16384,DA=6144,sot=[1,2,4,8];class oot extends PE{constructor(e,i){super(e,i);st(this,"device");st(this,"glParameters");this.device=e,nS(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Iy(this.device.gl)}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const i={...this.glParameters};this.props.framebuffer&&(i.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(i.depthMask=!this.props.depthReadOnly),i.stencilMask=this.props.stencilReadOnly?0:1,i[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(i.viewport=e.viewport.slice(0,4),i.depthRange=[e.viewport[4],e.viewport[5]]):i.viewport=e.viewport),e.scissorRect&&(i.scissorTest=!0,i.scissor=e.scissorRect),e.blendConstant&&(i.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(i.colorMask=sot.map(n=>!!(n&e.colorMask))),this.glParameters=i,Sg(this.device.gl,i)}beginOcclusionQuery(e){const i=this.props.occlusionQuerySet;i==null||i.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;e==null||e.endOcclusionQuery()}clear(){const e={...this.glParameters};let i=0;this.props.clearColor!==!1&&(i|=aot,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(i|=iot,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(i|=not,e.clearStencil=this.props.clearStencil),i!==0&&gc(this.device.gl,e,()=>{this.device.gl.clear(i)})}clearColorBuffer(e=0,i=[0,0,0,0]){gc(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(i.constructor){case Int32Array:this.device.gl.clearBufferiv(DA,e,i);break;case Uint32Array:this.device.gl.clearBufferuiv(DA,e,i);break;case Float32Array:default:this.device.gl.clearBufferfv(DA,e,i);break}})}}const lot="Failed to deduce GL constant from typed array";function uot(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(lot)}}function JE(r,t){const{clamped:e=!0}=t||{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const cot={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},hot={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ty{constructor(...t){st(this,"offset");st(this,"stride");st(this,"type");st(this,"size");st(this,"divisor");st(this,"normalized");st(this,"integer");st(this,"buffer");st(this,"index");t.forEach(e=>this._assign(e)),Object.freeze(this)}static getBytesPerElement(t){return JE(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return Di(t.size),JE(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(...t){return new ty(cot,...t)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ty.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ty.getBytesPerVertex(this)}_assign(t={}){return t=net("Accessor",t,hot),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalize!==void 0&&(this.normalized=t.normalize),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function fot(r){return dot.includes(r)}const dot=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],S$={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function T$(r){const t=S$[r];if(!t)throw new Error("uniform");const[e,i,,n]=t;return{format:n,components:i,glType:e}}function pot(r){const t=S$[r];if(!t)throw new Error("attribute");const[,e,,i,n]=t;return{attributeType:i,vertexFormat:n,components:e}}function got(r,t){const e={attributes:[],bindings:[]};e.attributes=vot(r,t);const i=_ot(r,t);for(const o of i){const l=o.uniforms.map(u=>({name:u.name,format:u.format,byteOffset:u.byteOffset,byteStride:u.byteStride,arrayLength:u.arrayLength}));e.bindings.push({type:"uniform",name:o.name,location:o.location,visibility:(o.vertex?1:0)&(o.fragment?2:0),minBindingSize:o.byteLength,uniforms:l})}const n=yot(r,t);let a=0;for(const o of n)if(fot(o.type)){const{viewDimension:l,sampleType:u}=bot(o.type);e.bindings.push({type:"texture",name:o.name,location:a,viewDimension:l,sampleType:u}),o.textureUnit=a,a+=1}n.length&&(e.uniforms=n);const s=mot(r,t);return s!=null&&s.length&&(e.varyings=s),e}function vot(r,t){const e=[],i=r.getProgramParameter(t,35721);for(let n=0;n<i;n++){const a=r.getActiveAttrib(t,n);if(!a)throw new Error("activeInfo");const{name:s,type:o}=a,l=r.getAttribLocation(t,s);if(l>=0){const{attributeType:u}=pot(o),c=/instance/i.test(s)?"instance":"vertex";e.push({name:s,location:l,stepMode:c,type:u})}}return e.sort((n,a)=>n.location-a.location),e}function mot(r,t){const e=[],i=r.getProgramParameter(t,35971);for(let n=0;n<i;n++){const a=r.getTransformFeedbackVarying(t,n);if(!a)throw new Error("activeInfo");const{name:s,type:o,size:l}=a,{glType:u,components:c}=T$(o),h=new ty({type:u,size:l*c}),p={location:n,name:s,accessor:h};e.push(p)}return e.sort((n,a)=>n.location-a.location),e}function yot(r,t){const e=[],i=r.getProgramParameter(t,35718);for(let n=0;n<i;n++){const a=r.getActiveUniform(t,n);if(!a)throw new Error("activeInfo");const{name:s,size:o,type:l}=a,{name:u,isArray:c}=wot(s);let h=r.getUniformLocation(t,u);const p={location:h,name:u,size:o,type:l,isArray:c};if(e.push(p),p.size>1)for(let v=0;v<p.size;v++){const y=`${u}[${v}]`;h=r.getUniformLocation(t,y);const x={...p,name:y,location:h};e.push(x)}}return e}function _ot(r,t){const e=(a,s)=>r.getActiveUniformBlockParameter(t,a,s),i=[],n=r.getProgramParameter(t,35382);for(let a=0;a<n;a++){const s={name:r.getActiveUniformBlockName(t,a)||"",location:e(a,35391),byteLength:e(a,35392),vertex:e(a,35396),fragment:e(a,35398),uniformCount:e(a,35394),uniforms:[]},o=e(a,35395)||[],l=r.getActiveUniforms(t,o,35383),u=r.getActiveUniforms(t,o,35384),c=r.getActiveUniforms(t,o,35387),h=r.getActiveUniforms(t,o,35388);for(let p=0;p<s.uniformCount;++p){const v=r.getActiveUniform(t,o[p]);if(!v)throw new Error("activeInfo");s.uniforms.push({name:v.name,format:T$(l[p]).format,type:l[p],arrayLength:u[p],byteOffset:c[p],byteStride:h[p]})}i.push(s)}return i.sort((a,s)=>a.location-s.location),i}const xot={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function bot(r){const t=xot[r];if(!t)throw new Error("sampler");const[e,i]=t;return{viewDimension:e,sampleType:i}}function wot(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/.exec(r);if(!e||e.length<2)throw new Error(`Failed to parse GLSL uniform name ${r}`);return{name:e[1],length:e[2]?1:0,isArray:!!e[2]}}function Sot(r,t,e,i){const n=r;let a=i;a===!0&&(a=1),a===!1&&(a=0);const s=typeof a=="number"?[a]:a;switch(e){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return r.uniform1i(t,i);case 5126:return r.uniform1fv(t,s);case 35664:return r.uniform2fv(t,s);case 35665:return r.uniform3fv(t,s);case 35666:return r.uniform4fv(t,s);case 5124:return r.uniform1iv(t,s);case 35667:return r.uniform2iv(t,s);case 35668:return r.uniform3iv(t,s);case 35669:return r.uniform4iv(t,s);case 35670:return r.uniform1iv(t,s);case 35671:return r.uniform2iv(t,s);case 35672:return r.uniform3iv(t,s);case 35673:return r.uniform4iv(t,s);case 5125:return n.uniform1uiv(t,s,1);case 36294:return n.uniform2uiv(t,s,2);case 36295:return n.uniform3uiv(t,s,3);case 36296:return n.uniform4uiv(t,s,4);case 35674:return r.uniformMatrix2fv(t,!1,s);case 35675:return r.uniformMatrix3fv(t,!1,s);case 35676:return r.uniformMatrix4fv(t,!1,s);case 35685:return n.uniformMatrix2x3fv(t,!1,s);case 35686:return n.uniformMatrix2x4fv(t,!1,s);case 35687:return n.uniformMatrix3x2fv(t,!1,s);case 35688:return n.uniformMatrix3x4fv(t,!1,s);case 35689:return n.uniformMatrix4x2fv(t,!1,s);case 35690:return n.uniformMatrix4x3fv(t,!1,s)}throw new Error("Illegal uniform")}function Tot(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(r)}}function Aot(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(r)}}const GO=4;class Cot extends ng{constructor(e,i){super(e,i);st(this,"device");st(this,"handle");st(this,"vs");st(this,"fs");st(this,"introspectedLayout");st(this,"uniforms",{});st(this,"bindings",{});st(this,"varyings",null);st(this,"_uniformCount",0);st(this,"_uniformSetters",{});this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=i.vs,this.fs=i.fs;const{varyings:n,bufferMode:a=35981}=i;switch(n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,a)),this._linkShaders(),_e.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=got(this.device.gl,this.handle),_e.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=Gtt(this.introspectedLayout,i.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":_e.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,i){for(const[n,a]of Object.entries(e)){const s=this.shaderLayout.bindings.find(o=>o.name===n)||this.shaderLayout.bindings.find(o=>o.name===`${n}Uniforms`);if(!s){const o=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");i!=null&&i.disableWarnings||_e.warn(`Unknown binding "${n}" in render pipeline "${this.id}", expected one of ${o}`)();continue}switch(a||_e.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(a instanceof Pc)&&!(a.buffer instanceof Pc))throw new Error("buffer value");break;case"texture":if(!(a instanceof Rp||a instanceof pl||a instanceof Qm))throw new Error("texture value");break;case"sampler":_e.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(s.type)}this.bindings[n]=a}}draw(e){var w;const{renderPass:i,parameters:n=this.props.parameters,topology:a=this.props.topology,vertexArray:s,vertexCount:o,instanceCount:l,isInstanced:u=!1,firstVertex:c=0,transformFeedback:h}=e,p=Tot(a),v=!!s.indexBuffer,y=(w=s.indexBuffer)==null?void 0:w.glIndexType;if(this.linkStatus!=="success")return _e.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||o===0)return _e.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(o===0)return _e.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),s.bindBeforeRender(i),h&&h.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const x=i;return Pst(this.device,n,x.glParameters,()=>{v&&u?this.device.gl.drawElementsInstanced(p,o||0,y,c,l||0):v?this.device.gl.drawElements(p,o||0,y,c):u?this.device.gl.drawArraysInstanced(p,c,o||0,l||0):this.device.gl.drawArrays(p,c,o||0),h&&h.end()}),s.unbindAfterRender(i),!0}setUniformsWebGL(e){const{bindings:i}=EP(e);Object.keys(i).forEach(n=>{_e.warn(`Unsupported value "${JSON.stringify(i[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),_e.time(GO,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),_e.timeEnd(GO,`linkProgram for ${this.id}`)(),_e.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}_e.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),_e.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const i=this._getLinkStatus();this._reportLinkStatus(i)}_reportLinkStatus(e){var i;switch(e){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((i=this.fs)==null?void 0:i.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${e}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async a=>await new Promise(s=>setTimeout(s,a));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const[,i]of Object.entries(this.bindings))i instanceof pl&&(i.update(),e=e&&i.loaded);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let i=0,n=0;for(const a of this.shaderLayout.bindings){const s=this.bindings[a.name]||this.bindings[a.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${a.name} in ${this.id}`);switch(a.type){case"uniform":const{name:o}=a,l=e.getUniformBlockIndex(this.handle,o);if(l===4294967295)throw new Error(`Invalid uniform block name ${o}`);e.uniformBlockBinding(this.handle,n,l),s instanceof Pc?e.bindBufferBase(35345,n,s.handle):e.bindBufferRange(35345,n,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),n+=1;break;case"texture":if(!(s instanceof Rp||s instanceof pl||s instanceof Qm))throw new Error("texture");let u;if(s instanceof Rp)u=s.texture;else if(s instanceof pl)u=s;else if(s instanceof Qm&&s.colorAttachments[0]instanceof Rp)_e.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),u=s.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+i),e.bindTexture(u.target,u.handle),i+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${a.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:i,location:n,type:a,textureUnit:s}=e,o=this.uniforms[i]??s;o!==void 0&&Sot(this.device.gl,n,a,o)}}}class Eot extends DE{constructor(e){super(e,{});st(this,"device");st(this,"commands",[]);this.device=e}submitCommands(e=this.commands){for(const i of e)switch(i.name){case"copy-buffer-to-buffer":Iot(this.device,i.options);break;case"copy-buffer-to-texture":Mot(this.device,i.options);break;case"copy-texture-to-buffer":Pot(this.device,i.options);break;case"copy-texture-to-texture":Rot(this.device,i.options);break}}}function Iot(r,t){const e=t.source,i=t.destination;r.gl.bindBuffer(36662,e.handle),r.gl.bindBuffer(36663,i.handle),r.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),r.gl.bindBuffer(36662,null),r.gl.bindBuffer(36663,null)}function Mot(r,t){throw new Error("Not implemented")}function Pot(r,t){const{source:e,mipLevel:i=0,aspect:n="all",width:a=t.source.width,height:s=t.source.height,depthOrArrayLayers:o=0,origin:l=[0,0],destination:u,byteOffset:c=0,bytesPerRow:h,rowsPerImage:p}=t;if(n!=="all")throw new Error("not supported");if(i!==0||o!==0||h||p)throw new Error("not implemented");const{framebuffer:v,destroyFramebuffer:y}=A$(e);let x;try{const w=u,T=a||v.width,E=s||v.height,M=Eb(v.texture.props.format),L=M.dataFormat,F=M.type;r.gl.bindBuffer(35051,w.handle),x=r.gl.bindFramebuffer(36160,v.handle),r.gl.readPixels(l[0],l[1],T,E,L,F,c)}finally{r.gl.bindBuffer(35051,null),x!==void 0&&r.gl.bindFramebuffer(36160,x),y&&v.destroy()}}function Rot(r,t){const{source:e,destinationMipLevel:i=0,origin:n=[0,0],destinationOrigin:a=[0,0],destination:s}=t;let{width:o=t.destination.width,height:l=t.destination.height}=t;const{framebuffer:u,destroyFramebuffer:c}=A$(e),[h,p]=n,[v,y,x]=a,w=r.gl.bindFramebuffer(36160,u.handle);let T=null,E;if(s instanceof pl)T=s,o=Number.isFinite(o)?o:T.width,l=Number.isFinite(l)?l:T.height,T.bind(0),E=T.target;else throw new Error("invalid destination");switch(E){case 3553:case 34067:r.gl.copyTexSubImage2D(E,i,v,y,h,p,o,l);break;case 35866:case 32879:r.gl.copyTexSubImage3D(E,i,v,y,x,h,p,o,l);break}T&&T.unbind(),r.gl.bindFramebuffer(36160,w),c&&u.destroy()}function A$(r){if(r instanceof eo){const{width:t,height:e,id:i}=r;return{framebuffer:r.device.createFramebuffer({id:`framebuffer-for-${i}`,width:t,height:e,colorAttachments:[r]}),destroyFramebuffer:!0}}return{framebuffer:r,destroyFramebuffer:!1}}class Dot extends RE{constructor(e,i){super(e,i);st(this,"device");st(this,"commandBuffer");this.device=e,this.commandBuffer=new Eot(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,i,n){}}class UP extends LE{constructor(e,i){super(e,i);st(this,"device");st(this,"handle");st(this,"buffer",null);st(this,"bufferValue",null);this.device=e,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(e){return aK()==="Chrome"}destroy(){var e;super.destroy(),this.buffer&&((e=this.buffer)==null||e.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const i=e;if(i&&i.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,i?i.handle:null),this.indexBuffer=i,this.device.gl.bindVertexArray(null)}setBuffer(e,i){const n=i;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:a,type:s,stride:o,offset:l,normalized:u,integer:c,divisor:h}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),c?this.device.gl.vertexAttribIPointer(e,a,s,o,l):this.device.gl.vertexAttribPointer(e,a,s,u,o,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,h||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,i){this._enable(e,!1),this.attributes[e]=i}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const i=this.attributes[e];ArrayBuffer.isView(i)&&this.device.setConstantAttributeWebGL(e,i)}}_getAccessor(e){const i=this.attributeInfos[e];if(!i)throw new Error(`Unknown attribute location ${e}`);const n=y$(i.bufferDataType);return{size:i.bufferComponents,type:n,stride:i.byteStride,offset:i.byteOffset,normalized:i.normalized,integer:i.integer,divisor:i.stepMode==="instance"?1:0}}_enable(e,i=!0){const a=UP.isConstantAttributeZeroSupported(this.device)||e!==0;(i||a)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),i?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,i){const n=Lot(i),a=n.byteLength*e,s=n.length*e;if(this.buffer&&a!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${a} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:a}),o=o||!kot(n,this.bufferValue),o){const l=qtt(i.constructor,s);Ytt({target:l,source:n,start:0,count:s}),this.buffer.write(l),this.bufferValue=i}return this.buffer}}function Lot(r){return Array.isArray(r)?new Float32Array(r):r}function kot(r,t){if(!r||!t||r.length!==t.length||r.constructor!==t.constructor)return!1;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0}class Oot extends kE{constructor(e,i){super(e,i);st(this,"device");st(this,"gl");st(this,"handle");st(this,"layout");st(this,"buffers",{});st(this,"unusedBuffers",{});st(this,"bindOnUse",!0);st(this,"_bound",!1);this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,i.buffers&&this.setBuffers(i.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Aot(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const i in e)this.setBuffer(i,e[i])})}setBuffer(e,i){const n=this._getVaryingIndex(e),{buffer:a,byteLength:s,byteOffset:o}=this._getBufferRange(i);if(n<0){this.unusedBuffers[e]=a,_e.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[n]={buffer:a,byteLength:s,byteOffset:o},this.bindOnUse||this._bindBuffer(n,a,o,s)}getBuffer(e){if(jO(e))return this.buffers[e]||null;const i=this._getVaryingIndex(e);return i>=0?this.buffers[i]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let i;return this._bound?i=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,i=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),i}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Pc)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:i,byteOffset:n=0,byteLength:a=e.buffer.byteLength}=e;return{buffer:i,byteOffset:n,byteLength:a}}_getVaryingIndex(e){if(jO(e))return Number(e);for(const i of this.layout.varyings)if(e===i.name)return i.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:i,byteLength:n,byteOffset:a}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),i,a,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,i,n=0,a){const s=i&&i.handle;!s||a===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,n,a)}}function jO(r){return typeof r=="number"?Number.isInteger(r):/^\d+$/.test(r)}class Not extends OE{constructor(e,i){super(e,i);st(this,"device");st(this,"handle");st(this,"target",null);st(this,"_queryPending",!1);st(this,"_pollingPromise",null);if(this.device=e,i.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e!=null&&e.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((n,a)=>{const s=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):i++>e?(a("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}function C$(r){switch(r){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Di(!1),0}}function Fot(r){switch(r){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Di(!1),0}}function Bot(r,t){var w,T;const{sourceX:e=0,sourceY:i=0,sourceFormat:n=6408,sourceAttachment:a=36064}=t||{};let{target:s=null,sourceWidth:o,sourceHeight:l,sourceType:u}=t||{};const{framebuffer:c,deleteFramebuffer:h}=E$(r);Di(c);const{gl:p,handle:v}=c;o=o||c.width,l=l||c.height;const y=a-36064;u=u||((T=(w=c.colorAttachments[y])==null?void 0:w.texture)==null?void 0:T.type)||5121,s=Uot(s,u,n,o,l),u=u||uot(s);const x=p.bindFramebuffer(36160,v);return p.readPixels(e,i,o,l,n,u,s),p.bindFramebuffer(36160,x||null),h&&c.destroy(),s}function zot(r,t){const{target:e,sourceX:i=0,sourceY:n=0,sourceFormat:a=6408,targetByteOffset:s=0}=t||{};let{sourceWidth:o,sourceHeight:l,sourceType:u}=t||{};const{framebuffer:c,deleteFramebuffer:h}=E$(r);Di(c),o=o||c.width,l=l||c.height;const p=c;u=u||5121;let v=e;if(!v){const x=C$(a),w=Fot(u),T=s+o*l*x*w;v=p.device.createBuffer({byteLength:T})}const y=r.device.createCommandEncoder();return y.copyTextureToBuffer({source:r,width:o,height:l,origin:[i,n],destination:v,byteOffset:s}),y.destroy(),h&&c.destroy(),v}function E$(r){return r instanceof _b?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:Vot(r),deleteFramebuffer:!0}}function Vot(r,t){const{device:e,width:i,height:n,id:a}=r;return e.createFramebuffer({...t,id:`framebuffer-for-${a}`,width:i,height:n,colorAttachments:[r]})}function Uot(r,t,e,i,n){if(r)return r;t=t||5121;const a=JE(t,{clamped:!1}),s=C$(e);return new a(i*n*s)}const $ot=256,Wot=1024,Hot=16384,Got="clear: bad arguments";function jot(r,t){const{framebuffer:e=null,color:i=null,depth:n=null,stencil:a=null}=t||{},s={};e&&(s.framebuffer=e);let o=0;i&&(o|=Hot,i!==!0&&(s.clearColor=i)),n&&(o|=$ot,n!==!0&&(s.clearDepth=n)),a&&(o|=Wot,n!==!0&&(s.clearStencil=n)),Di(o!==0,Got);const l=r.gl;gc(l,s,()=>{l.clear(o)})}const Yv=1,uf=class uf extends ig{constructor(e){var l,u;super({...e,id:e.id||Kf("webgl-device")});st(this,"type","webgl");st(this,"handle");st(this,"features");st(this,"limits");st(this,"info");st(this,"canvasContext");st(this,"lost");st(this,"_resolveContextLost");st(this,"renderPass",null);st(this,"gl");st(this,"debug",!1);st(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});st(this,"_extensions",{});st(this,"_polyfilled",!1);st(this,"spectorJS");st(this,"_constants");const i=(l=e.gl)==null?void 0:l.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);const n=((u=e.gl)==null?void 0:u.canvas)||e.canvas;this.canvasContext=new $st(this,{...e,canvas:n}),this.lost=new Promise(c=>{this._resolveContextLost=c});let a=e.gl||null;if(a||(a=ost(this.canvasContext.canvas,{...e,onContextLost:c=>{var h;return(h=this._resolveContextLost)==null?void 0:h.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!a)throw new Error("WebGL context creation failed");this.handle=a,this.gl=a,this.gl.device=this,this.gl._version=2,e.spector&&(this.spectorJS=Xst({...this.props,canvas:this.handle.canvas})),this.info=lst(this.gl,this._extensions),this.limits=new Ist(this.gl),this.features=new Est(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:s=!0,copyState:o=!1}=e;v$(this.gl,{enable:s,copyState:o,log:(...c)=>_e.log(1,...c)()}),e.debug&&(this.gl=Yst(this.gl,{...e,throwOnError:!0}),this.debug=!0,_e.level=Math.max(_e.level,1),_e.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(e){if(e instanceof uf)return e;if((e==null?void 0:e.device)instanceof ig)return e.device;if(!Xot(e))throw new Error("Invalid WebGL2RenderingContext");return new uf({gl:e})}static async create(e={}){var o;_e.groupCollapsed(Yv,"WebGLDevice created")();const i=[];e.debug&&i.push(qst()),e.spector&&i.push(jst()),typeof e.canvas=="string"&&i.push(CP.pageLoaded);const n=await Promise.allSettled(i);for(const l of n)l.status==="rejected"&&_e.error(`Failed to initialize debug libraries ${l.reason}`)();if(_e.probe(Yv+1,"DOM is loaded")(),(o=e.gl)!=null&&o.device)return _e.warn("reattaching existing device")(),uf.attach(e.gl);const a=new uf(e),s=`Created ${a.type}${a.debug?" debug":""} context: ${a.info.vendor}, ${a.info.renderer} for canvas: ${a.canvasContext.id}`;return _e.probe(Yv,s)(),_e.table(Yv,a.info)(),_e.groupEnd(Yv)(),a}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(e){return VP(this.gl,e,this._extensions)}isTextureFormatFilterable(e){return Sst(this.gl,e,this._extensions)}isTextureFormatRenderable(e){return Tst(this.gl,e,this._extensions)}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const i=this._getBufferProps(e);return new Pc(this,i)}_createTexture(e){return new pl(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new KE(this,e)}createShader(e){return new rot(this,e)}createFramebuffer(e){return new Qm(this,e)}createVertexArray(e){return new UP(this,e)}createTransformFeedback(e){return new Oot(this,e)}createQuerySet(e){return new Not(this,e)}createRenderPipeline(e){return new Cot(this,e)}beginRenderPass(e){return new oot(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(e){return new Dot(this,e)}submit(){var e;(e=this.renderPass)==null||e.end(),this.renderPass=null}readPixelsToArrayWebGL(e,i){return Bot(e,i)}readPixelsToBufferWebGL(e,i){return zot(e,i)}setParametersWebGL(e){Sg(this.gl,e)}getParametersWebGL(e){return g$(this.gl,e)}withParametersWebGL(e,i){return gc(this.gl,e,i)}clearWebGL(e){jot(this,e)}resetWebGL(){_e.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),tst(this.gl)}loseDevice(){var a;let e=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(e=!0,n.loseContext()),(a=this._resolveContextLost)==null||a.call(this,{reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){nS(this.gl)}popState(){Iy(this.gl)}setSpectorMetadata(e,i){e.__SPECTOR_Metadata=i}getGLKey(e,i){i=i||this.gl2||this.gl;const n=Number(e);for(const a in i)if(i[a]===n)return`GL.${a}`;return String(e)}setConstantAttributeWebGL(e,i){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const a=this._constants[e];switch(a&&Kot(a,i)&&_e.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=i,i.constructor){case Float32Array:Zot(this,e,i);break;case Int32Array:qot(this,e,i);break;case Uint32Array:Yot(this,e,i);break;default:Di(!1)}}getExtension(e){return Fc(this.gl,e,this._extensions),this._extensions}};st(uf,"type","webgl");let ey=uf;function Xot(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}function Zot(r,t,e){switch(e.length){case 1:r.gl.vertexAttrib1fv(t,e);break;case 2:r.gl.vertexAttrib2fv(t,e);break;case 3:r.gl.vertexAttrib3fv(t,e);break;case 4:r.gl.vertexAttrib4fv(t,e);break;default:Di(!1)}}function qot(r,t,e){r.gl.vertexAttribI4iv(t,e)}function Yot(r,t,e){r.gl.vertexAttribI4uiv(t,e)}function Kot(r,t){if(!r||!t||r.length!==t.length||r.constructor!==t.constructor)return!1;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0}var I$={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(r){(function(t,e,i,n){var a=["","webkit","Moz","MS","ms","o"],s=e.createElement("div"),o="function",l=Math.round,u=Math.abs,c=Date.now;function h(ut,ft,Et){return setTimeout(M(ut,Et),ft)}function p(ut,ft,Et){return Array.isArray(ut)?(v(ut,Et[ft],Et),!0):!1}function v(ut,ft,Et){var jt;if(ut)if(ut.forEach)ut.forEach(ft,Et);else if(ut.length!==n)for(jt=0;jt<ut.length;)ft.call(Et,ut[jt],jt,ut),jt++;else for(jt in ut)ut.hasOwnProperty(jt)&&ft.call(Et,ut[jt],jt,ut)}function y(ut,ft,Et){var jt="DEPRECATED METHOD: "+ft+`
`+Et+` AT 
`;return function(){var ue=new Error("get-stack-trace"),Ne=ue&&ue.stack?ue.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Sr=t.console&&(t.console.warn||t.console.log);return Sr&&Sr.call(t.console,jt,Ne),ut.apply(this,arguments)}}var x;typeof Object.assign!="function"?x=function(ft){if(ft===n||ft===null)throw new TypeError("Cannot convert undefined or null to object");for(var Et=Object(ft),jt=1;jt<arguments.length;jt++){var ue=arguments[jt];if(ue!==n&&ue!==null)for(var Ne in ue)ue.hasOwnProperty(Ne)&&(Et[Ne]=ue[Ne])}return Et}:x=Object.assign;var w=y(function(ft,Et,jt){for(var ue=Object.keys(Et),Ne=0;Ne<ue.length;)(!jt||jt&&ft[ue[Ne]]===n)&&(ft[ue[Ne]]=Et[ue[Ne]]),Ne++;return ft},"extend","Use `assign`."),T=y(function(ft,Et){return w(ft,Et,!0)},"merge","Use `assign`.");function E(ut,ft,Et){var jt=ft.prototype,ue;ue=ut.prototype=Object.create(jt),ue.constructor=ut,ue._super=jt,Et&&x(ue,Et)}function M(ut,ft){return function(){return ut.apply(ft,arguments)}}function L(ut,ft){return typeof ut==o?ut.apply(ft&&ft[0]||n,ft):ut}function F(ut,ft){return ut===n?ft:ut}function O(ut,ft,Et){v(j(ft),function(jt){ut.addEventListener(jt,Et,!1)})}function U(ut,ft,Et){v(j(ft),function(jt){ut.removeEventListener(jt,Et,!1)})}function W(ut,ft){for(;ut;){if(ut==ft)return!0;ut=ut.parentNode}return!1}function H(ut,ft){return ut.indexOf(ft)>-1}function j(ut){return ut.trim().split(/\s+/g)}function Y(ut,ft,Et){if(ut.indexOf&&!Et)return ut.indexOf(ft);for(var jt=0;jt<ut.length;){if(Et&&ut[jt][Et]==ft||!Et&&ut[jt]===ft)return jt;jt++}return-1}function tt(ut){return Array.prototype.slice.call(ut,0)}function it(ut,ft,Et){for(var jt=[],ue=[],Ne=0;Ne<ut.length;){var Sr=ft?ut[Ne][ft]:ut[Ne];Y(ue,Sr)<0&&jt.push(ut[Ne]),ue[Ne]=Sr,Ne++}return Et&&(ft?jt=jt.sort(function(Ki,An){return Ki[ft]>An[ft]}):jt=jt.sort()),jt}function lt(ut,ft){for(var Et,jt,ue=ft[0].toUpperCase()+ft.slice(1),Ne=0;Ne<a.length;){if(Et=a[Ne],jt=Et?Et+ue:ft,jt in ut)return jt;Ne++}return n}var ht=1;function Tt(){return ht++}function Ot(ut){var ft=ut.ownerDocument||ut;return ft.defaultView||ft.parentWindow||t}var Rt=/mobile|tablet|ip(ad|hone|od)|android/i,Ut="ontouchstart"in t,Jt=lt(t,"PointerEvent")!==n,ne=Ut&&Rt.test(navigator.userAgent),se="touch",ce="pen",ye="mouse",Qe="kinect",sr=25,ke=1,Ce=2,Ee=4,Ie=8,Se=1,Fe=2,Rr=4,tr=8,Vr=16,_r=Fe|Rr,Xr=tr|Vr,Hi=_r|Xr,wi=["x","y"],qt=["clientX","clientY"];function Ur(ut,ft){var Et=this;this.manager=ut,this.callback=ft,this.element=ut.element,this.target=ut.options.inputTarget,this.domHandler=function(jt){L(ut.options.enable,[ut])&&Et.handler(jt)},this.init()}Ur.prototype={handler:function(){},init:function(){this.evEl&&O(this.element,this.evEl,this.domHandler),this.evTarget&&O(this.target,this.evTarget,this.domHandler),this.evWin&&O(Ot(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&U(this.element,this.evEl,this.domHandler),this.evTarget&&U(this.target,this.evTarget,this.domHandler),this.evWin&&U(Ot(this.element),this.evWin,this.domHandler)}};function wn(ut){var ft,Et=ut.options.inputClass;return Et?ft=Et:Jt?ft=Ca:ne?ft=Mt:Ut?ft=Qt:ft=fr,new ft(ut,Gr)}function Gr(ut,ft,Et){var jt=Et.pointers.length,ue=Et.changedPointers.length,Ne=ft&ke&&jt-ue===0,Sr=ft&(Ee|Ie)&&jt-ue===0;Et.isFirst=!!Ne,Et.isFinal=!!Sr,Ne&&(ut.session={}),Et.eventType=ft,$r(ut,Et),ut.emit("hammer.input",Et),ut.recognize(Et),ut.session.prevInput=Et}function $r(ut,ft){var Et=ut.session,jt=ft.pointers,ue=jt.length;Et.firstInput||(Et.firstInput=Ka(ft)),ue>1&&!Et.firstMultiple?Et.firstMultiple=Ka(ft):ue===1&&(Et.firstMultiple=!1);var Ne=Et.firstInput,Sr=Et.firstMultiple,Fi=Sr?Sr.center:Ne.center,Ki=ft.center=Ml(jt);ft.timeStamp=c(),ft.deltaTime=ft.timeStamp-Ne.timeStamp,ft.angle=de(Fi,Ki),ft.distance=Ja(Fi,Ki),Ya(Et,ft),ft.offsetDirection=gs(ft.deltaX,ft.deltaY);var An=uo(ft.deltaTime,ft.deltaX,ft.deltaY);ft.overallVelocityX=An.x,ft.overallVelocityY=An.y,ft.overallVelocity=u(An.x)>u(An.y)?An.x:An.y,ft.scale=Sr?Si(Sr.pointers,jt):1,ft.rotation=Sr?Qa(Sr.pointers,jt):0,ft.maxPointers=Et.prevInput?ft.pointers.length>Et.prevInput.maxPointers?ft.pointers.length:Et.prevInput.maxPointers:ft.pointers.length,Wo(Et,ft);var Ia=ut.element;W(ft.srcEvent.target,Ia)&&(Ia=ft.srcEvent.target),ft.target=Ia}function Ya(ut,ft){var Et=ft.center,jt=ut.offsetDelta||{},ue=ut.prevDelta||{},Ne=ut.prevInput||{};(ft.eventType===ke||Ne.eventType===Ee)&&(ue=ut.prevDelta={x:Ne.deltaX||0,y:Ne.deltaY||0},jt=ut.offsetDelta={x:Et.x,y:Et.y}),ft.deltaX=ue.x+(Et.x-jt.x),ft.deltaY=ue.y+(Et.y-jt.y)}function Wo(ut,ft){var Et=ut.lastInterval||ft,jt=ft.timeStamp-Et.timeStamp,ue,Ne,Sr,Fi;if(ft.eventType!=Ie&&(jt>sr||Et.velocity===n)){var Ki=ft.deltaX-Et.deltaX,An=ft.deltaY-Et.deltaY,Ia=uo(jt,Ki,An);Ne=Ia.x,Sr=Ia.y,ue=u(Ia.x)>u(Ia.y)?Ia.x:Ia.y,Fi=gs(Ki,An),ut.lastInterval=ft}else ue=Et.velocity,Ne=Et.velocityX,Sr=Et.velocityY,Fi=Et.direction;ft.velocity=ue,ft.velocityX=Ne,ft.velocityY=Sr,ft.direction=Fi}function Ka(ut){for(var ft=[],Et=0;Et<ut.pointers.length;)ft[Et]={clientX:l(ut.pointers[Et].clientX),clientY:l(ut.pointers[Et].clientY)},Et++;return{timeStamp:c(),pointers:ft,center:Ml(ft),deltaX:ut.deltaX,deltaY:ut.deltaY}}function Ml(ut){var ft=ut.length;if(ft===1)return{x:l(ut[0].clientX),y:l(ut[0].clientY)};for(var Et=0,jt=0,ue=0;ue<ft;)Et+=ut[ue].clientX,jt+=ut[ue].clientY,ue++;return{x:l(Et/ft),y:l(jt/ft)}}function uo(ut,ft,Et){return{x:ft/ut||0,y:Et/ut||0}}function gs(ut,ft){return ut===ft?Se:u(ut)>=u(ft)?ut<0?Fe:Rr:ft<0?tr:Vr}function Ja(ut,ft,Et){Et||(Et=wi);var jt=ft[Et[0]]-ut[Et[0]],ue=ft[Et[1]]-ut[Et[1]];return Math.sqrt(jt*jt+ue*ue)}function de(ut,ft,Et){Et||(Et=wi);var jt=ft[Et[0]]-ut[Et[0]],ue=ft[Et[1]]-ut[Et[1]];return Math.atan2(ue,jt)*180/Math.PI}function Qa(ut,ft){return de(ft[1],ft[0],qt)+de(ut[1],ut[0],qt)}function Si(ut,ft){return Ja(ft[0],ft[1],qt)/Ja(ut[0],ut[1],qt)}var co={mousedown:ke,mousemove:Ce,mouseup:Ee},vs="mousedown",ge="mousemove mouseup";function fr(){this.evEl=vs,this.evWin=ge,this.pressed=!1,Ur.apply(this,arguments)}E(fr,Ur,{handler:function(ft){var Et=co[ft.type];Et&ke&&ft.button===0&&(this.pressed=!0),Et&Ce&&ft.which!==1&&(Et=Ee),this.pressed&&(Et&Ee&&(this.pressed=!1),this.callback(this.manager,Et,{pointers:[ft],changedPointers:[ft],pointerType:ye,srcEvent:ft}))}});var ur={pointerdown:ke,pointermove:Ce,pointerup:Ee,pointercancel:Ie,pointerout:Ie},Sn={2:se,3:ce,4:ye,5:Qe},Aa="pointerdown",dr="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Aa="MSPointerDown",dr="MSPointerMove MSPointerUp MSPointerCancel");function Ca(){this.evEl=Aa,this.evWin=dr,Ur.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}E(Ca,Ur,{handler:function(ft){var Et=this.store,jt=!1,ue=ft.type.toLowerCase().replace("ms",""),Ne=ur[ue],Sr=Sn[ft.pointerType]||ft.pointerType,Fi=Sr==se,Ki=Y(Et,ft.pointerId,"pointerId");Ne&ke&&(ft.button===0||Fi)?Ki<0&&(Et.push(ft),Ki=Et.length-1):Ne&(Ee|Ie)&&(jt=!0),!(Ki<0)&&(Et[Ki]=ft,this.callback(this.manager,Ne,{pointers:Et,changedPointers:[ft],pointerType:Sr,srcEvent:ft}),jt&&Et.splice(Ki,1))}});var yt={touchstart:ke,touchmove:Ce,touchend:Ee,touchcancel:Ie},Q="touchstart",rt="touchstart touchmove touchend touchcancel";function ct(){this.evTarget=Q,this.evWin=rt,this.started=!1,Ur.apply(this,arguments)}E(ct,Ur,{handler:function(ft){var Et=yt[ft.type];if(Et===ke&&(this.started=!0),!!this.started){var jt=xt.call(this,ft,Et);Et&(Ee|Ie)&&jt[0].length-jt[1].length===0&&(this.started=!1),this.callback(this.manager,Et,{pointers:jt[0],changedPointers:jt[1],pointerType:se,srcEvent:ft})}}});function xt(ut,ft){var Et=tt(ut.touches),jt=tt(ut.changedTouches);return ft&(Ee|Ie)&&(Et=it(Et.concat(jt),"identifier",!0)),[Et,jt]}var wt={touchstart:ke,touchmove:Ce,touchend:Ee,touchcancel:Ie},Nt="touchstart touchmove touchend touchcancel";function Mt(){this.evTarget=Nt,this.targetIds={},Ur.apply(this,arguments)}E(Mt,Ur,{handler:function(ft){var Et=wt[ft.type],jt=At.call(this,ft,Et);jt&&this.callback(this.manager,Et,{pointers:jt[0],changedPointers:jt[1],pointerType:se,srcEvent:ft})}});function At(ut,ft){var Et=tt(ut.touches),jt=this.targetIds;if(ft&(ke|Ce)&&Et.length===1)return jt[Et[0].identifier]=!0,[Et,Et];var ue,Ne,Sr=tt(ut.changedTouches),Fi=[],Ki=this.target;if(Ne=Et.filter(function(An){return W(An.target,Ki)}),ft===ke)for(ue=0;ue<Ne.length;)jt[Ne[ue].identifier]=!0,ue++;for(ue=0;ue<Sr.length;)jt[Sr[ue].identifier]&&Fi.push(Sr[ue]),ft&(Ee|Ie)&&delete jt[Sr[ue].identifier],ue++;if(Fi.length)return[it(Ne.concat(Fi),"identifier",!0),Fi]}var Dt=2500,Yt=25;function Qt(){Ur.apply(this,arguments);var ut=M(this.handler,this);this.touch=new Mt(this.manager,ut),this.mouse=new fr(this.manager,ut),this.primaryTouch=null,this.lastTouches=[]}E(Qt,Ur,{handler:function(ft,Et,jt){var ue=jt.pointerType==se,Ne=jt.pointerType==ye;if(!(Ne&&jt.sourceCapabilities&&jt.sourceCapabilities.firesTouchEvents)){if(ue)ie.call(this,Et,jt);else if(Ne&&ar.call(this,jt))return;this.callback(ft,Et,jt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ie(ut,ft){ut&ke?(this.primaryTouch=ft.changedPointers[0].identifier,Xe.call(this,ft)):ut&(Ee|Ie)&&Xe.call(this,ft)}function Xe(ut){var ft=ut.changedPointers[0];if(ft.identifier===this.primaryTouch){var Et={x:ft.clientX,y:ft.clientY};this.lastTouches.push(Et);var jt=this.lastTouches,ue=function(){var Ne=jt.indexOf(Et);Ne>-1&&jt.splice(Ne,1)};setTimeout(ue,Dt)}}function ar(ut){for(var ft=ut.srcEvent.clientX,Et=ut.srcEvent.clientY,jt=0;jt<this.lastTouches.length;jt++){var ue=this.lastTouches[jt],Ne=Math.abs(ft-ue.x),Sr=Math.abs(Et-ue.y);if(Ne<=Yt&&Sr<=Yt)return!0}return!1}var Oe=lt(s.style,"touchAction"),qe=Oe!==n,or="compute",Hr="auto",Zr="manipulation",yr="none",xr="pan-x",Ni="pan-y",Kr=na();function Ii(ut,ft){this.manager=ut,this.set(ft)}Ii.prototype={set:function(ut){ut==or&&(ut=this.compute()),qe&&this.manager.element.style&&Kr[ut]&&(this.manager.element.style[Oe]=ut),this.actions=ut.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ut=[];return v(this.manager.recognizers,function(ft){L(ft.options.enable,[ft])&&(ut=ut.concat(ft.getTouchAction()))}),an(ut.join(" "))},preventDefaults:function(ut){var ft=ut.srcEvent,Et=ut.offsetDirection;if(this.manager.session.prevented){ft.preventDefault();return}var jt=this.actions,ue=H(jt,yr)&&!Kr[yr],Ne=H(jt,Ni)&&!Kr[Ni],Sr=H(jt,xr)&&!Kr[xr];if(ue){var Fi=ut.pointers.length===1,Ki=ut.distance<2,An=ut.deltaTime<250;if(Fi&&Ki&&An)return}if(!(Sr&&Ne)&&(ue||Ne&&Et&_r||Sr&&Et&Xr))return this.preventSrc(ft)},preventSrc:function(ut){this.manager.session.prevented=!0,ut.preventDefault()}};function an(ut){if(H(ut,yr))return yr;var ft=H(ut,xr),Et=H(ut,Ni);return ft&&Et?yr:ft||Et?ft?xr:Ni:H(ut,Zr)?Zr:Hr}function na(){if(!qe)return!1;var ut={},ft=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Et){ut[Et]=ft?t.CSS.supports("touch-action",Et):!0}),ut}var Pl=1,sn=2,Ea=4,Ps=8,Ar=Ps,ho=16,Wn=32;function pi(ut){this.options=x({},this.defaults,ut||{}),this.id=Tt(),this.manager=null,this.options.enable=F(this.options.enable,!0),this.state=Pl,this.simultaneous={},this.requireFail=[]}pi.prototype={defaults:{},set:function(ut){return x(this.options,ut),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ut){if(p(ut,"recognizeWith",this))return this;var ft=this.simultaneous;return ut=Tn(ut,this),ft[ut.id]||(ft[ut.id]=ut,ut.recognizeWith(this)),this},dropRecognizeWith:function(ut){return p(ut,"dropRecognizeWith",this)?this:(ut=Tn(ut,this),delete this.simultaneous[ut.id],this)},requireFailure:function(ut){if(p(ut,"requireFailure",this))return this;var ft=this.requireFail;return ut=Tn(ut,this),Y(ft,ut)===-1&&(ft.push(ut),ut.requireFailure(this)),this},dropRequireFailure:function(ut){if(p(ut,"dropRequireFailure",this))return this;ut=Tn(ut,this);var ft=Y(this.requireFail,ut);return ft>-1&&this.requireFail.splice(ft,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ut){return!!this.simultaneous[ut.id]},emit:function(ut){var ft=this,Et=this.state;function jt(ue){ft.manager.emit(ue,ut)}Et<Ps&&jt(ft.options.event+kn(Et)),jt(ft.options.event),ut.additionalEvent&&jt(ut.additionalEvent),Et>=Ps&&jt(ft.options.event+kn(Et))},tryEmit:function(ut){if(this.canEmit())return this.emit(ut);this.state=Wn},canEmit:function(){for(var ut=0;ut<this.requireFail.length;){if(!(this.requireFail[ut].state&(Wn|Pl)))return!1;ut++}return!0},recognize:function(ut){var ft=x({},ut);if(!L(this.options.enable,[this,ft])){this.reset(),this.state=Wn;return}this.state&(Ar|ho|Wn)&&(this.state=Pl),this.state=this.process(ft),this.state&(sn|Ea|Ps|ho)&&this.tryEmit(ft)},process:function(ut){},getTouchAction:function(){},reset:function(){}};function kn(ut){return ut&ho?"cancel":ut&Ps?"end":ut&Ea?"move":ut&sn?"start":""}function ld(ut){return ut==Vr?"down":ut==tr?"up":ut==Fe?"left":ut==Rr?"right":""}function Tn(ut,ft){var Et=ft.manager;return Et?Et.get(ut):ut}function ii(){pi.apply(this,arguments)}E(ii,pi,{defaults:{pointers:1},attrTest:function(ut){var ft=this.options.pointers;return ft===0||ut.pointers.length===ft},process:function(ut){var ft=this.state,Et=ut.eventType,jt=ft&(sn|Ea),ue=this.attrTest(ut);return jt&&(Et&Ie||!ue)?ft|ho:jt||ue?Et&Ee?ft|Ps:ft&sn?ft|Ea:sn:Wn}});function fo(){ii.apply(this,arguments),this.pX=null,this.pY=null}E(fo,ii,{defaults:{event:"pan",threshold:10,pointers:1,direction:Hi},getTouchAction:function(){var ut=this.options.direction,ft=[];return ut&_r&&ft.push(Ni),ut&Xr&&ft.push(xr),ft},directionTest:function(ut){var ft=this.options,Et=!0,jt=ut.distance,ue=ut.direction,Ne=ut.deltaX,Sr=ut.deltaY;return ue&ft.direction||(ft.direction&_r?(ue=Ne===0?Se:Ne<0?Fe:Rr,Et=Ne!=this.pX,jt=Math.abs(ut.deltaX)):(ue=Sr===0?Se:Sr<0?tr:Vr,Et=Sr!=this.pY,jt=Math.abs(ut.deltaY))),ut.direction=ue,Et&&jt>ft.threshold&&ue&ft.direction},attrTest:function(ut){return ii.prototype.attrTest.call(this,ut)&&(this.state&sn||!(this.state&sn)&&this.directionTest(ut))},emit:function(ut){this.pX=ut.deltaX,this.pY=ut.deltaY;var ft=ld(ut.direction);ft&&(ut.additionalEvent=this.options.event+ft),this._super.emit.call(this,ut)}});function Rs(){ii.apply(this,arguments)}E(Rs,ii,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[yr]},attrTest:function(ut){return this._super.attrTest.call(this,ut)&&(Math.abs(ut.scale-1)>this.options.threshold||this.state&sn)},emit:function(ut){if(ut.scale!==1){var ft=ut.scale<1?"in":"out";ut.additionalEvent=this.options.event+ft}this._super.emit.call(this,ut)}});function si(){pi.apply(this,arguments),this._timer=null,this._input=null}E(si,pi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Hr]},process:function(ut){var ft=this.options,Et=ut.pointers.length===ft.pointers,jt=ut.distance<ft.threshold,ue=ut.deltaTime>ft.time;if(this._input=ut,!jt||!Et||ut.eventType&(Ee|Ie)&&!ue)this.reset();else if(ut.eventType&ke)this.reset(),this._timer=h(function(){this.state=Ar,this.tryEmit()},ft.time,this);else if(ut.eventType&Ee)return Ar;return Wn},reset:function(){clearTimeout(this._timer)},emit:function(ut){this.state===Ar&&(ut&&ut.eventType&Ee?this.manager.emit(this.options.event+"up",ut):(this._input.timeStamp=c(),this.manager.emit(this.options.event,this._input)))}});function Br(){ii.apply(this,arguments)}E(Br,ii,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[yr]},attrTest:function(ut){return this._super.attrTest.call(this,ut)&&(Math.abs(ut.rotation)>this.options.threshold||this.state&sn)}});function ms(){ii.apply(this,arguments)}E(ms,ii,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:_r|Xr,pointers:1},getTouchAction:function(){return fo.prototype.getTouchAction.call(this)},attrTest:function(ut){var ft=this.options.direction,Et;return ft&(_r|Xr)?Et=ut.overallVelocity:ft&_r?Et=ut.overallVelocityX:ft&Xr&&(Et=ut.overallVelocityY),this._super.attrTest.call(this,ut)&&ft&ut.offsetDirection&&ut.distance>this.options.threshold&&ut.maxPointers==this.options.pointers&&u(Et)>this.options.velocity&&ut.eventType&Ee},emit:function(ut){var ft=ld(ut.offsetDirection);ft&&this.manager.emit(this.options.event+ft,ut),this.manager.emit(this.options.event,ut)}});function oi(){pi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}E(oi,pi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Zr]},process:function(ut){var ft=this.options,Et=ut.pointers.length===ft.pointers,jt=ut.distance<ft.threshold,ue=ut.deltaTime<ft.time;if(this.reset(),ut.eventType&ke&&this.count===0)return this.failTimeout();if(jt&&ue&&Et){if(ut.eventType!=Ee)return this.failTimeout();var Ne=this.pTime?ut.timeStamp-this.pTime<ft.interval:!0,Sr=!this.pCenter||Ja(this.pCenter,ut.center)<ft.posThreshold;this.pTime=ut.timeStamp,this.pCenter=ut.center,!Sr||!Ne?this.count=1:this.count+=1,this._input=ut;var Fi=this.count%ft.taps;if(Fi===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=Ar,this.tryEmit()},ft.interval,this),sn):Ar}return Wn},failTimeout:function(){return this._timer=h(function(){this.state=Wn},this.options.interval,this),Wn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ar&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function aa(ut,ft){return ft=ft||{},ft.recognizers=F(ft.recognizers,aa.defaults.preset),new ts(ut,ft)}aa.VERSION="2.0.7",aa.defaults={domEvents:!1,touchAction:or,enable:!0,inputTarget:null,inputClass:null,preset:[[Br,{enable:!1}],[Rs,{enable:!1},["rotate"]],[ms,{direction:_r}],[fo,{direction:_r},["swipe"]],[oi],[oi,{event:"doubletap",taps:2},["tap"]],[si]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var sa=1,Au=2;function ts(ut,ft){this.options=x({},aa.defaults,ft||{}),this.options.inputTarget=this.options.inputTarget||ut,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ut,this.input=wn(this),this.touchAction=new Ii(this,this.options.touchAction),Qc(this,!0),v(this.options.recognizers,function(Et){var jt=this.add(new Et[0](Et[1]));Et[2]&&jt.recognizeWith(Et[2]),Et[3]&&jt.requireFailure(Et[3])},this)}ts.prototype={set:function(ut){return x(this.options,ut),ut.touchAction&&this.touchAction.update(),ut.inputTarget&&(this.input.destroy(),this.input.target=ut.inputTarget,this.input.init()),this},stop:function(ut){this.session.stopped=ut?Au:sa},recognize:function(ut){var ft=this.session;if(!ft.stopped){this.touchAction.preventDefaults(ut);var Et,jt=this.recognizers,ue=ft.curRecognizer;(!ue||ue&&ue.state&Ar)&&(ue=ft.curRecognizer=null);for(var Ne=0;Ne<jt.length;)Et=jt[Ne],ft.stopped!==Au&&(!ue||Et==ue||Et.canRecognizeWith(ue))?Et.recognize(ut):Et.reset(),!ue&&Et.state&(sn|Ea|Ps)&&(ue=ft.curRecognizer=Et),Ne++}},get:function(ut){if(ut instanceof pi)return ut;for(var ft=this.recognizers,Et=0;Et<ft.length;Et++)if(ft[Et].options.event==ut)return ft[Et];return null},add:function(ut){if(p(ut,"add",this))return this;var ft=this.get(ut.options.event);return ft&&this.remove(ft),this.recognizers.push(ut),ut.manager=this,this.touchAction.update(),ut},remove:function(ut){if(p(ut,"remove",this))return this;if(ut=this.get(ut),ut){var ft=this.recognizers,Et=Y(ft,ut);Et!==-1&&(ft.splice(Et,1),this.touchAction.update())}return this},on:function(ut,ft){if(ut!==n&&ft!==n){var Et=this.handlers;return v(j(ut),function(jt){Et[jt]=Et[jt]||[],Et[jt].push(ft)}),this}},off:function(ut,ft){if(ut!==n){var Et=this.handlers;return v(j(ut),function(jt){ft?Et[jt]&&Et[jt].splice(Y(Et[jt],ft),1):delete Et[jt]}),this}},emit:function(ut,ft){this.options.domEvents&&th(ut,ft);var Et=this.handlers[ut]&&this.handlers[ut].slice();if(!(!Et||!Et.length)){ft.type=ut,ft.preventDefault=function(){ft.srcEvent.preventDefault()};for(var jt=0;jt<Et.length;)Et[jt](ft),jt++}},destroy:function(){this.element&&Qc(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Qc(ut,ft){var Et=ut.element;if(Et.style){var jt;v(ut.options.cssProps,function(ue,Ne){jt=lt(Et.style,Ne),ft?(ut.oldCssProps[jt]=Et.style[jt],Et.style[jt]=ue):Et.style[jt]=ut.oldCssProps[jt]||""}),ft||(ut.oldCssProps={})}}function th(ut,ft){var Et=e.createEvent("Event");Et.initEvent(ut,!0,!0),Et.gesture=ft,ft.target.dispatchEvent(Et)}x(aa,{INPUT_START:ke,INPUT_MOVE:Ce,INPUT_END:Ee,INPUT_CANCEL:Ie,STATE_POSSIBLE:Pl,STATE_BEGAN:sn,STATE_CHANGED:Ea,STATE_ENDED:Ps,STATE_RECOGNIZED:Ar,STATE_CANCELLED:ho,STATE_FAILED:Wn,DIRECTION_NONE:Se,DIRECTION_LEFT:Fe,DIRECTION_RIGHT:Rr,DIRECTION_UP:tr,DIRECTION_DOWN:Vr,DIRECTION_HORIZONTAL:_r,DIRECTION_VERTICAL:Xr,DIRECTION_ALL:Hi,Manager:ts,Input:Ur,TouchAction:Ii,TouchInput:Mt,MouseInput:fr,PointerEventInput:Ca,TouchMouseInput:Qt,SingleTouchInput:ct,Recognizer:pi,AttrRecognizer:ii,Tap:oi,Pan:fo,Swipe:ms,Pinch:Rs,Rotate:Br,Press:si,on:O,off:U,each:v,merge:T,extend:w,assign:x,inherit:E,bindFn:M,prefixed:lt});var Cu=typeof t<"u"?t:typeof self<"u"?self:{};Cu.Hammer=aa,typeof n=="function"&&n.amd?n(function(){return aa}):r.exports?r.exports=aa:t[i]=aa})(window,document,"Hammer")})(I$);var x_=I$.exports;const Jot=Kw(x_),tl=tK({__proto__:null,default:Jot},[x_]),M$=1,P$=2,QE=4,Qot={mousedown:M$,mousemove:P$,mouseup:QE};function tlt(r,t){for(let e=0;e<r.length;e++)if(t(r[e]))return!0;return!1}function elt(r){const t=r.prototype.handler;r.prototype.handler=function(i){const n=this.store;i.button>0&&i.type==="pointerdown"&&(tlt(n,a=>a.pointerId===i.pointerId)||n.push(i)),t.call(this,i)}}function rlt(r){r.prototype.handler=function(e){let i=Qot[e.type];i&M$&&e.button>=0&&(this.pressed=!0),i&P$&&e.buttons===0&&(i=QE),this.pressed&&(i&QE&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}elt(x_.PointerEventInput);rlt(x_.MouseInput);const ilt=x_.Manager;class sS{constructor(t,e,i){this.element=t,this.callback=e,this.options={enable:!0,...i}}}const nlt=tl?[[tl.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[tl.Rotate,{enable:!1}],[tl.Pinch,{enable:!1}],[tl.Swipe,{enable:!1}],[tl.Pan,{threshold:0,enable:!1}],[tl.Press,{enable:!1}],[tl.Tap,{event:"doubletap",taps:2,enable:!1}],[tl.Tap,{event:"anytap",enable:!1}],[tl.Tap,{enable:!1}]]:null,XO={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},alt={doubletap:["tap"]},slt={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},$P={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},olt={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},ZO={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},llt=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Dp=typeof window<"u"?window:global;let tI=!1;try{const r={get passive(){return tI=!0,!0}};Dp.addEventListener("test",null,r),Dp.removeEventListener("test",null)}catch{tI=!1}const ult=llt.indexOf("firefox")!==-1,{WHEEL_EVENTS:clt}=$P,qO="wheel",YO=4.000244140625,hlt=40,flt=.25;class dlt extends sS{constructor(t,e,i){super(t,e,i),this.handleEvent=n=>{if(!this.options.enable)return;let a=n.deltaY;Dp.WheelEvent&&(ult&&n.deltaMode===Dp.WheelEvent.DOM_DELTA_PIXEL&&(a/=Dp.devicePixelRatio),n.deltaMode===Dp.WheelEvent.DOM_DELTA_LINE&&(a*=hlt)),a!==0&&a%YO===0&&(a=Math.floor(a/YO)),n.shiftKey&&a&&(a=a*flt),this.callback({type:qO,center:{x:n.clientX,y:n.clientY},delta:-a,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(clt),this.events.forEach(n=>t.addEventListener(n,this.handleEvent,tI?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===qO&&(this.options.enable=e)}}const{MOUSE_EVENTS:plt}=$P,KO="pointermove",JO="pointerover",QO="pointerout",tN="pointerenter",eN="pointerleave";class glt extends sS{constructor(t,e,i){super(t,e,i),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(plt),this.events.forEach(a=>t.addEventListener(a,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===KO&&(this.enableMoveEvent=e),t===JO&&(this.enableOverEvent=e),t===QO&&(this.enableOutEvent=e),t===tN&&(this.enableEnterEvent=e),t===eN&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(JO,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(QO,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(tN,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(eN,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit(KO,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:vlt}=$P,rN="keydown",iN="keyup";class mlt extends sS{constructor(t,e,i){super(t,e,i),this.handleEvent=n=>{const a=n.target||n.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:rN,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:iN,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(vlt),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(n=>t.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===rN&&(this.enableDownEvent=e),t===iN&&(this.enableUpEvent=e)}}const nN="contextmenu";class ylt extends sS{constructor(t,e,i){super(t,e,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:nN,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===nN&&(this.options.enable=e)}}const aN=1,eI=2,sN=4,_lt={pointerdown:aN,pointermove:eI,pointerup:sN,mousedown:aN,mousemove:eI,mouseup:sN},xlt=0,blt=1,wlt=2,Slt=1,Tlt=2,Alt=4;function Clt(r){const t=_lt[r.srcEvent.type];if(!t)return null;const{buttons:e,button:i}=r.srcEvent;let n=!1,a=!1,s=!1;return t===eI?(n=!!(e&Slt),a=!!(e&Alt),s=!!(e&Tlt)):(n=i===xlt,a=i===blt,s=i===wlt),{leftButton:n,middleButton:a,rightButton:s}}function Elt(r,t){const e=r.center;if(!e)return null;const i=t.getBoundingClientRect(),n=i.width/t.offsetWidth||1,a=i.height/t.offsetHeight||1,s={x:(e.x-i.left-t.clientLeft)/n,y:(e.y-i.top-t.clientTop)/a};return{center:e,offsetCenter:s}}const LA={srcElement:"root",priority:0};class Ilt{constructor(t){this.handleEvent=e=>{if(this.isEmpty())return;const i=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==i.rootElement;){if(this._emit(i,n),i.handled)return;n=n.parentNode}this._emit(i,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,i,n=!1,a=!1){const{handlers:s,handlersByElement:o}=this;let l=LA;typeof i=="string"||i&&i.addEventListener?l={...LA,srcElement:i}:i&&(l={...LA,...i});let u=o.get(l.srcElement);u||(u=[],o.set(l.srcElement,u));const c={type:t,handler:e,srcElement:l.srcElement,priority:l.priority};n&&(c.once=!0),a&&(c.passive=!0),s.push(c),this._active=this._active||!c.passive;let h=u.length-1;for(;h>=0&&!(u[h].priority>=c.priority);)h--;u.splice(h+1,0,c)}remove(t,e){const{handlers:i,handlersByElement:n}=this;for(let a=i.length-1;a>=0;a--){const s=i[a];if(s.type===t&&s.handler===e){i.splice(a,1);const o=n.get(s.srcElement);o.splice(o.indexOf(s),1),o.length===0&&n.delete(s.srcElement)}}this._active=i.some(a=>!a.passive)}_emit(t,e){const i=this.handlersByElement.get(e);if(i){let n=!1;const a=()=>{t.handled=!0},s=()=>{t.handled=!0,n=!0},o=[];for(let l=0;l<i.length;l++){const{type:u,handler:c,once:h}=i[l];if(c({...t,type:u,stopPropagation:a,stopImmediatePropagation:s}),h&&o.push(i[l]),n)break}for(let l=0;l<o.length;l++){const{type:u,handler:c}=o[l];this.remove(u,c)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...Clt(t),...Elt(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const Mlt={events:null,recognizers:null,recognizerOptions:{},Manager:ilt,touchAction:"none",tabIndex:0};class Plt{constructor(t=null,e){this._onBasicInput=n=>{const{srcEvent:a}=n,s=slt[a.type];s&&this.manager.emit(s,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...Mlt,...e},this.events=new Map,this.setElement(t);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,i=e.Manager;this.manager=new i(t,{touchAction:e.touchAction,recognizers:e.recognizers||nlt}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(XO).forEach(n=>{const a=this.manager.get(n);a&&XO[n].forEach(s=>{a.recognizeWith(s)})});for(const n in e.recognizerOptions){const a=this.manager.get(n);if(a){const s=e.recognizerOptions[n];delete s.enable,a.set(s)}}this.wheelInput=new dlt(t,this._onOtherEvent,{enable:!1}),this.moveInput=new glt(t,this._onOtherEvent,{enable:!1}),this.keyInput=new mlt(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new ylt(t,this._onOtherEvent,{enable:!1});for(const[n,a]of this.events)a.isEmpty()||(this._toggleRecognizer(a.recognizerName,!0),this.manager.on(n,a.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,i){this._addEventHandler(t,e,i,!1)}once(t,e,i){this._addEventHandler(t,e,i,!0)}watch(t,e,i){this._addEventHandler(t,e,i,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:i}=this;if(!i)return;const n=i.get(t);if(n&&n.options.enable!==e){n.set({enable:e});const a=alt[t];a&&!this.options.recognizers&&a.forEach(s=>{const o=i.get(s);e?(o.requireFailure(t),n.dropRequireFailure(s)):o.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,i,n,a){if(typeof t!="string"){i=e;for(const c in t)this._addEventHandler(c,t[c],i,n,a);return}const{manager:s,events:o}=this,l=ZO[t]||t;let u=o.get(l);u||(u=new Ilt(this),o.set(l,u),u.recognizerName=olt[l]||l,s&&s.on(l,u.handleEvent)),u.add(t,e,i,n,a),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const s in t)this._removeEventHandler(s,t[s]);return}const{events:i}=this,n=ZO[t]||t,a=i.get(n);if(a&&(a.remove(t,e),a.isEmpty())){const{recognizerName:s}=a;let o=!1;for(const l of i.values())if(l.recognizerName===s&&!l.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}}function Xu(){}const Rlt=({isDragging:r})=>r?"grabbing":"grab",R$={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Xu,onWebGLInitialized:Xu,onResize:Xu,onViewStateChange:Xu,onInteractionStateChange:Xu,onBeforeRender:Xu,onAfterRender:Xu,onLoad:Xu,onError:r=>Wr.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Rlt,getTooltip:null,debug:!1,drawPickingColors:!1};class WP{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new p_({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:n}=this;if(i.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(i.leftButton||i.rightButton)return;{const a=i.offsetCenter;if(!a)return;n.x=a.x,n.y=a.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=i},this._onEvent=i=>{const n=WE[i.type],a=i.offsetCenter;if(!n||!a||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:s,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:l}=o,u=l&&(l[n.handler]||l.props[n.handler]),c=this.props[n.handler];let h=!1;u&&(h=u.call(l,o,i)),h||(c==null||c(o,i),this.widgetManager.onEvent(o,i))},this._onPointerDown=i=>{const n=i.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo},this.props={...R$,...t},t=this.props,t.viewState&&t.initialViewState&&Wr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device?this.device=t.device:t.gl&&(t.gl instanceof WebGLRenderingContext&&Wr.error("WebGL1 context not supported.")(),this.device=ey.attach(t.gl));let e=this.device;e||(Hp.registerDevices([ey]),e=Hp.createDevice({...t.deviceProps,canvas:this._createCanvas(t)})),this.animationLoop=this._createAnimationLoop(e,t),this.setProps(t),t._typedArrayManagerProps&&cg.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,i,n,a,s,o,l,u,c;(t=this.animationLoop)==null||t.stop(),(e=this.animationLoop)==null||e.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(i=this.layerManager)==null||i.finalize(),this.layerManager=null,(n=this.viewManager)==null||n.finalize(),this.viewManager=null,(a=this.effectManager)==null||a.finalize(),this.effectManager=null,(s=this.deckRenderer)==null||s.finalize(),this.deckRenderer=null,(o=this.deckPicker)==null||o.finalize(),this.deckPicker=null,(l=this.eventManager)==null||l.destroy(),this.eventManager=null,(u=this.widgetManager)==null||u.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((c=this.canvas.parentElement)==null||c.removeChild(this.canvas),this.canvas=null)}setProps(t){var i;this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Wr.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Wr.removed("onLayerClick","onClick")(),t.initialViewState&&!As(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(i=this.animationLoop)==null||i.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e),this.widgetManager.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(t),n=this.layerManager.needsRedraw(t),a=this.effectManager.needsRedraw(t),s=this.deckRenderer.needsRedraw(t);return e=e||i||n||a||s,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return Kn(this.viewManager),this.viewManager.views}getViewports(t){return Kn(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const i in t)this.layerManager.resourceManager.add({resourceId:i,data:t[i],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){var e;(e=this.layerManager)==null||e.removeDefaultShaderModule(t)}_pick(t,e,i){Kn(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(e).timeStart();const a=this.deckPicker[t]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(e).timeEnd(),a}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),Kn(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){var n;if(!this.canvas)return;const{width:e,height:i}=t;if(e||e===0){const a=Number.isFinite(e)?`${e}px`:e;this.canvas.style.width=a}if(i||i===0){const a=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=((n=t.style)==null?void 0:n.position)||"absolute",this.canvas.style.height=a}}_updateCanvasSize(){var n,a;const{canvas:t}=this;if(!t)return;const e=t.clientWidth??t.width,i=t.clientHeight??t.height;(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,(n=this.viewManager)==null||n.setProps({width:e,height:i}),(a=this.layerManager)==null||a.activateViewport(this.getViewports()[0]),this.props.onResize({width:e,height:i}))}_createAnimationLoop(t,e){const{gl:i,onError:n,useDevicePixels:a}=e;return new tat({device:t,useDevicePixels:a,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:s=>this._setDevice(s.device),onRender:this._onRenderFrame.bind(this),onError:n})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:t}=this.props,e=Array.isArray(t)?t:t?[t]:[new Lat({id:"default-view"})];return e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){var e,i,n;const{_pickRequest:t}=this;if(t.event){const{result:a,emptyInfo:s}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=a.length>0;let o=s,l=!1;for(const u of a)o=u,l=((e=u.layer)==null?void 0:e.onHover(u,t.event))||l;l||((n=(i=this.props).onHover)==null||n.call(i,o,t.event),this.widgetManager.onHover(o,t.event)),t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){var n,a;if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=(n=this.device.canvasContext)==null?void 0:n.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof ey&&this.props.onWebGLInitialized(this.device.gl);const e=new l$;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new Plt(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in WE)this.eventManager.on(s,this._onEvent);this.viewManager=new yat({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new mat(this.device,{deck:this,stats:this.stats,viewport:i,timeline:e}),this.effectManager=new Nat({deck:this,device:this.device}),this.deckRenderer=new zat(this.device),this.deckPicker=new Gat(this.device),this.widgetManager=new Zat({deck:this,parentElement:(a=this.canvas)==null?void 0:a.parentElement}),this.widgetManager.addDefault(new Yat),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){var s;const{device:i,gl:n}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:n});const a={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e};(s=this.deckRenderer)==null||s.renderLayers(a),a.pass==="screen"&&this.widgetManager.onRedraw({viewports:a.viewports,layers:a.layers}),this.props.onAfterRender({device:i,gl:n})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Wr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const i=Hp.stats.get("Memory Usage");t.bufferMemory=i.get("Buffer Memory").count,t.textureMemory=i.get("Texture Memory").count,t.renderbufferMemory=i.get("Renderbuffer Memory").count,t.gpuMemory=i.get("GPU Memory").count}}WP.defaultProps=R$;WP.VERSION=u8;const Dlt=WP;function Llt(r){switch(r){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return S8(r)}}const klt=w8;function ux(r,t){return{attribute:r,format:t.size>1?`${t.type}x${t.size}`:t.type,byteOffset:t.offset||0}}function ff(r){return r.stride||r.size*r.bytesPerElement}function Olt(r,t){return r.type===t.type&&r.size===t.size&&ff(r)===ff(t)&&(r.offset||0)===(t.offset||0)}function rI(r,t){t.offset&&Wr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=ff(r),i=t.vertexOffset!==void 0?t.vertexOffset:r.vertexOffset||0,n=t.elementOffset||0,a=i*e+n*r.bytesPerElement+(r.offset||0);return{...t,offset:a,stride:e}}function Nlt(r,t){const e=rI(r,t);return{high:e,low:{...e,offset:e.offset+r.size*4}}}class Flt{constructor(t,e,i){this._buffer=null,this.device=t,this.id=e.id||"",this.size=e.size||1;const n=e.logicalType||e.type,a=n==="float64";let{defaultValue:s}=e;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let o;a?o="float32":!n&&e.isIndexed?o="uint32":o=n||"float32";let l=Llt(n||o);this.doublePrecision=a,a&&e.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...e,defaultType:l,defaultValue:s,logicalType:n,type:o,normalized:o.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*ff(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),cg.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,e=null){const i={};if(this.state.constant){const n=this.value;if(e){const a=rI(this.getAccessor(),e),s=a.offset/n.BYTES_PER_ELEMENT,o=a.size||this.size;i[t]=n.subarray(s,s+o)}else i[t]=n}else i[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${t}64Low`]=i[t]:i[`${t}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(t=this.id,e=null){const i=this.getAccessor(),n=[],a={name:this.id,byteStride:ff(i),attributes:n};if(this.doublePrecision){const s=Nlt(i,e||{});n.push(ux(t,{...i,...s.high}),ux(`${t}64Low`,{...i,...s.low}))}else if(e){const s=rI(i,e);n.push(ux(t,{...i,...s}))}else n.push(ux(t,i));return a}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:i,size:n}=this,a=i*n;if(e&&a&&e.length>=a){const s=new Array(n).fill(1/0),o=new Array(n).fill(-1/0);for(let l=0;l<a;)for(let u=0;u<n;u++){const c=e[l++];c<s[u]&&(s[u]=c),c>o[u]&&(o[u]=c)}t=[s,o]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let i;ArrayBuffer.isView(t)?i={value:t}:t instanceof rn?i={buffer:t}:i=t;const n={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)n.type="float32";else{const s=klt(i.value);n.type=n.normalized?s.replace("int","norm"):s}n.bytesPerElement=i.value.BYTES_PER_ELEMENT,n.stride=ff(n)}if(e.bounds=null,i.constant){let a=i.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!e.constant||!this._areValuesEqual(a,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=ArrayBuffer.isView(a)?a:new Float32Array(a)}else if(i.buffer){const a=i.buffer;e.externalBuffer=a,e.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let a=i.value;e.externalBuffer=null,e.constant=!1,this.value=a;let{buffer:s}=this;const o=ff(n),l=(n.vertexOffset||0)*o;if(this.doublePrecision&&a instanceof Float64Array&&(a=xA(a,n)),this.settings.isIndexed){const c=this.settings.defaultType;a.constructor!==c&&(a=new c(a))}const u=a.byteLength+l+o*2;(!s||s.byteLength<u)&&(s=this._createBuffer(u)),s.write(a,l)}return this.setAccessor(n),!0}updateSubBuffer(t={}){this.state.bounds=null;const e=this.value,{startOffset:i=0,endOffset:n}=t;this.buffer.write(this.doublePrecision&&e instanceof Float64Array?xA(e,{size:this.size,startIndex:i,endIndex:n}):e.subarray(i,n),i*e.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,e=!1){const{state:i}=this,n=i.allocatedValue,a=cg.allocate(n,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=a;const{byteOffset:s}=this;let{buffer:o}=this;return(!o||o.byteLength<a.byteLength+s)&&(o=this._createBuffer(a.byteLength+s),e&&n&&o.write(n instanceof Float64Array?xA(n,this):n,s)),i.allocatedValue=a,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=e.BYTES_PER_ELEMENT<4),n)throw new Error(`Attribute ${this.id} does not support ${e.constructor.name}`);!(e instanceof i)&&this.settings.normalized&&!("normalized"in t)&&Wr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(e=>e/255);case"unorm16":return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,i){const{defaultValue:n,size:a}=this.settings;if(Number.isFinite(t))return e[i]=t,e;if(!t){let s=a;for(;--s>=0;)e[i+s]=n[s];return e}switch(a){case 4:e[i+3]=Number.isFinite(t[3])?t[3]:n[3];case 3:e[i+2]=Number.isFinite(t[2])?t[2]:n[2];case 2:e[i+1]=Number.isFinite(t[1])?t[1]:n[1];case 1:e[i+0]=Number.isFinite(t[0])?t[0]:n[0];break;default:let s=a;for(;--s>=0;)e[i+s]=Number.isFinite(t[s])?t[s]:n[s]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:i}=this;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}_createBuffer(t){var n;this._buffer&&this._buffer.destroy();const{isIndexed:e,type:i}=this.settings;return this._buffer=this.device.createBuffer({...(n=this._buffer)==null?void 0:n.props,id:this.id,usage:e?rn.INDEX:rn.VERTEX,indexType:e?i:void 0,byteLength:t}),this._buffer}}const oN=[],lN=[];function oS(r,t=0,e=1/0){let i=oN;const n={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?i=r:r.length>0&&(lN.length=r.length,i=lN):i=oN,(t>0||Number.isFinite(e))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,e),n.index=t-1),{iterable:i,objectInfo:n}}function D$(r){return r&&r[Symbol.asyncIterator]}function L$(r,t){const{size:e,stride:i,offset:n,startIndices:a,nested:s}=t,o=r.BYTES_PER_ELEMENT,l=i?i/o:e,u=n?n/o:0,c=Math.floor((r.length-u)/l);return(h,{index:p,target:v})=>{if(!a){const T=p*l+u;for(let E=0;E<e;E++)v[E]=r[T+E];return v}const y=a[p],x=a[p+1]||c;let w;if(s){w=new Array(x-y);for(let T=y;T<x;T++){const E=T*l+u;v=new Array(e);for(let M=0;M<e;M++)v[M]=r[E+M];w[T-y]=v}}else if(l===e)w=r.subarray(y*e+u,x*e+u);else{w=new r.constructor((x-y)*e);let T=0;for(let E=y;E<x;E++){const M=E*l+u;for(let L=0;L<e;L++)w[T++]=r[M+L]}}return w}}const Blt=[],L1=[[0,1/0]];function zlt(r,t){if(r===L1||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return r;const e=[],i=r.length;let n=0;for(let a=0;a<i;a++){const s=r[a];s[1]<t[0]?(e.push(s),n=a+1):s[0]>t[1]?e.push(s):t=[Math.min(s[0],t[0]),Math.max(s[1],t[1])]}return e.splice(n,0,t),e}const Vlt={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function k$(r,t){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const e=r.type||"interpolation";return{...Vlt[e],...t,...r,type:e}}class O$ extends Flt{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:L1}),this.constant=!1,this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var e;(e=this.state).layoutChanged||(e.layoutChanged=!Olt(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,i=this.settings.transition,n=Array.isArray(e)?t[e.find(a=>t[a])]:t[e];return k$(n,i)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:i=0,endRow:n=1/0}=e;this.state.updateRanges=zlt(this.state.updateRanges,[i,n])}else this.state.updateRanges=L1}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Blt}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(t,e.updateRanges!==L1),!0):!1}updateBuffer({numInstances:t,data:e,props:i,context:n}){if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:s,noAlloc:o}}=this;let l=!0;if(s){for(const[u,c]of a)s.call(n,this,{data:e,startRow:u,endRow:c,props:i,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[u,c]of a){const h=Number.isFinite(u)?this.getVertexOffset(u):0,p=Number.isFinite(c)?this.getVertexOffset(c):o||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:h,endOffset:p})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:i,settings:n}=this;if(!t)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===t)return this.clearNeedsUpdate(),!0;if(i.binaryValue=t,this.setNeedsRedraw(),n.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const s=t;Kn(ArrayBuffer.isView(s.value),`invalid ${n.accessor}`);const o=!!s.size&&s.size!==this.size;return i.binaryAccessor=L$(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:e,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getValue(){const t=this.settings.shaderAttributes,e=super.getValue();if(!t)return e;for(const i in t)Object.assign(e,super.getValue(i,t[i]));return e}getBufferLayout(t){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:n}=this.settings;if(n==="dynamic"?i.stepMode=t?t.isInstanced?"instance":"vertex":"instance":i.stepMode=n??"vertex",!e)return i;for(const a in e){const s=super._getBufferLayout(a,e[a]);i.attributes.push(...s.attributes)}return i}_autoUpdater(t,{data:e,startRow:i,endRow:n,props:a,numInstances:s}){if(t.constant)return;const{settings:o,state:l,value:u,size:c,startIndices:h}=t,{accessor:p,transform:v}=o,y=l.binaryAccessor||(typeof p=="function"?p:a[p]);Kn(typeof y=="function",`accessor "${p}" is not a function`);let x=t.getVertexOffset(i);const{iterable:w,objectInfo:T}=oS(e,i,n);for(const E of w){T.index++;let M=y(E,T);if(v&&(M=v.call(this,M)),h){const L=(T.index<h.length-1?h[T.index+1]:s)-h[T.index];if(M&&Array.isArray(M[0])){let F=x;for(const O of M)t._normalizeValue(O,u,F),F+=c}else M&&M.length>c?u.set(M,x):(t._normalizeValue(M,T.target,0),fat({target:u,source:T.target,start:x,count:L}));x+=L*c}else t._normalizeValue(M,u,x),x+=c}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let i=!0;switch(e){case 4:i=i&&Number.isFinite(t[3]);case 3:i=i&&Number.isFinite(t[2]);case 2:i=i&&Number.isFinite(t[1]);case 1:i=i&&Number.isFinite(t[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function kA(r){const{source:t,target:e,start:i=0,size:n,getData:a}=r,s=r.end||e.length,o=t.length,l=s-i;if(o>l){e.set(t.subarray(0,l),i);return}if(e.set(t,i),!a)return;let u=o;for(;u<l;){const c=a(u,t);for(let h=0;h<n;h++)e[i+u]=c[h]||0,u++}}function Ult({source:r,target:t,size:e,getData:i,sourceStartIndices:n,targetStartIndices:a}){if(!n||!a)return kA({source:r,target:t,size:e,getData:i}),t;let s=0,o=0;const l=i&&((c,h)=>i(c+o,h)),u=Math.min(n.length,a.length);for(let c=1;c<u;c++){const h=n[c]*e,p=a[c]*e;kA({source:r.subarray(s,h),target:t,start:o,end:p,size:e,getData:l}),s=h,o=p}return o<t.length&&kA({source:[],target:t,start:o,size:e,getData:l}),t}function $lt(r){const{device:t,settings:e,value:i}=r,n=new O$(t,e);return n.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:e.normalized}),n}function N$(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${r}"`)}}function F$(r){switch(r){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function B$(r){r.push(r.shift())}function Wlt(r,t){const{doublePrecision:e,settings:i,value:n,size:a}=r,s=e&&n instanceof Float64Array?2:1;let o=0;const{shaderAttributes:l}=r.settings;if(l)for(const u of Object.values(l))o=Math.max(o,u.vertexOffset??0);return(i.noAlloc?n.length:(t+o)*a)*s}function z$({device:r,source:t,target:e}){return(!e||e.byteLength<t.byteLength)&&(e==null||e.destroy(),e=r.createBuffer({byteLength:t.byteLength,usage:t.usage})),e}function V$({device:r,buffer:t,attribute:e,fromLength:i,toLength:n,fromStartIndices:a,getData:s=o=>o}){const o=e.doublePrecision&&e.value instanceof Float64Array?2:1,l=e.size*o,u=e.byteOffset,c=e.settings.bytesPerElement<4?u/e.settings.bytesPerElement*4:u,h=e.startIndices,p=a&&h,v=e.isConstant;if(!p&&t&&i>=n)return t;const y=e.value instanceof Float64Array?Float32Array:e.value.constructor,x=v?e.value:new y(e.getBuffer().readSyncWebGL(u,n*y.BYTES_PER_ELEMENT).buffer);if(e.settings.normalized&&!v){const M=s;s=(L,F)=>e.normalizeConstant(M(L,F))}const w=v?(M,L)=>s(x,L):(M,L)=>s(x.subarray(M+u,M+u+l),L),T=t?new Float32Array(t.readSyncWebGL(c,i*4).buffer):new Float32Array(0),E=new Float32Array(n);return Ult({source:T,target:E,sourceStartIndices:a,targetStartIndices:h,size:l,getData:w}),(!t||t.byteLength<E.byteLength+c)&&(t==null||t.destroy(),t=r.createBuffer({byteLength:E.byteLength+c,usage:35050})),t.write(E,c),t}class U${constructor({device:t,attribute:e,timeline:i}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new iS(i),this.attribute=e,this.attributeInTransition=$lt(e),this.currentStartIndices=e.startIndices}get inProgress(){return this.transition.inProgress}start(t,e,i=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Wlt(this.attribute,e),this.transition.start({...t,duration:i})}update(){const t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const t of this.buffers)t.destroy();this.buffers.length=0}}class Hlt extends U${constructor({device:t,attribute:e,timeline:i}){super({device:t,attribute:e,timeline:i}),this.type="interpolation",this.transform=Xlt(t,e)}start(t,e){const i=this.currentLength,n=this.currentStartIndices;if(super.start(t,e,t.duration),t.duration<=0){this.transition.cancel();return}const{buffers:a,attribute:s}=this;B$(a),a[0]=V$({device:this.device,buffer:a[0],attribute:s,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:t.enter}),a[1]=z$({device:this.device,source:a[0],target:a[1]}),this.setBuffer(a[1]);const{transform:o}=this,l=o.model;let u=Math.floor(this.currentLength/s.size);$$(s)&&(u/=2),l.setVertexCount(u),s.isConstant?(l.setAttributes({aFrom:a[0]}),l.setConstantAttributes({aTo:s.value})):l.setAttributes({aFrom:a[0],aTo:s.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:a[1]})}onUpdate(){const{duration:t,easing:e}=this.settings,{time:i}=this.transition;let n=i/t;e&&(n=e(n));const{model:a}=this.transform;a.setUniforms({time:n}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Glt=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,jlt=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function $$(r){return r.doublePrecision&&r.value instanceof Float64Array}function Xlt(r,t){const e=t.size,i=N$(e),n=F$(e),a=t.getBufferLayout();return $$(t)?new Ey(r,{vs:jlt,bufferLayout:[{name:"aFrom",byteStride:8*e,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*e}]},{name:"aTo",byteStride:8*e,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*e}]}],modules:[ort],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:e},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Ey(r,{vs:Glt,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:a.attributes[0].format}],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class Zlt extends U${constructor({device:t,attribute:e,timeline:i}){super({device:t,attribute:e,timeline:i}),this.type="spring",this.texture=Jlt(t),this.framebuffer=Qlt(t,this.texture),this.transform=Klt(t,e)}start(t,e){const i=this.currentLength,n=this.currentStartIndices;super.start(t,e);const{buffers:a,attribute:s}=this;for(let l=0;l<2;l++)a[l]=V$({device:this.device,buffer:a[l],attribute:s,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:t.enter});a[2]=z$({device:this.device,source:a[0],target:a[2]}),this.setBuffer(a[1]);const{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?o.setConstantAttributes({aTo:s.value}):o.setAttributes({aTo:s.getBuffer()})}onUpdate(){const{buffers:t,transform:e,framebuffer:i,transition:n}=this,a=this.settings;e.model.setAttributes({aPrev:t[0],aCur:t[1]}),e.transformFeedback.setBuffers({vNext:t[2]}),e.model.setUniforms({stiffness:a.stiffness,damping:a.damping}),e.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),B$(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||n.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const qlt=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Ylt=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Klt(r,t){const e=N$(t.size),i=F$(t.size);return new Ey(r,{vs:qlt,fs:Ylt,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:e},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Jlt(r){return r.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Qlt(r,t){return r.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}const tut={interpolation:Hlt,spring:Zlt};class eut{constructor(t,{id:e,timeline:i}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=e,this.device=t,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:i}){this.numInstances=i||1;for(const n in t){const a=t[n],s=a.getTransitionSetting(e);s&&this._updateAttribute(n,a,s)}for(const n in this.transitions){const a=t[n];(!a||!a.getTransitionSetting(e))&&this._removeTransition(n)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const i=this.transitions[e];i.inProgress&&(t[e]=i.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,e,i){const n=this.transitions[t];let a=!n||n.type!==i.type;if(a){n&&this._removeTransition(t);const s=tut[i.type];s?this.transitions[t]=new s({attribute:e,timeline:this.timeline,device:this.device}):(Wr.error(`unsupported transition type '${i.type}'`)(),a=!1)}(a||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(i,this.numInstances))}}const uN="attributeManager.invalidate",rut="attributeManager.updateStart",iut="attributeManager.updateEnd",nut="attribute.updateStart",aut="attribute.allocate",sut="attribute.updateEnd";class out{constructor(t,{id:e="attribute-manager",stats:i,timeline:n}={}){this.mergeBoundsMemoized=m_(Wnt),this.id=e,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new eut(t,{id:`${e}-transitions`,timeline:n}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const i=this._invalidateTrigger(t,e);xa(uN,this,t,i)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);xa(uN,this,"all")}update({data:t,numInstances:e,startIndices:i=null,transitions:n,props:a={},buffers:s={},context:o={}}){let l=!1;xa(rut,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const u in this.attributes){const c=this.attributes[u],h=c.settings.accessor;c.startIndices=i,c.numInstances=e,a[u]&&Wr.removed(`props.${u}`,`data.attributes.${u}`)(),c.setExternalBuffer(s[u])||c.setBinaryValue(typeof h=="string"?s[h]:void 0,t.startIndices)||typeof h=="string"&&!s[h]&&c.setConstantValue(a[h])||c.needsUpdate()&&(l=!0,this._updateAttribute({attribute:c,numInstances:e,data:t,props:a,context:o})),this.needsRedraw=this.needsRedraw||c.needsRedraw()}l&&xa(iut,this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:n})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){const e=t.map(i=>{var n;return(n=this.attributes[i])==null?void 0:n.getBounds()});return this.mergeBoundsMemoized(e)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(const a in e){const s=e[a];s.needsRedraw(t)&&!i.hasAttribute(a)&&(n[a]=s)}return n}getBufferLayouts(t){return Object.values(this.getAttributes()).map(e=>e.getBufferLayout(t))}_add(t,e){for(const i in t){const n=t[i],a={...n,id:i,size:n.isIndexed&&1||n.size||1,...e};this.attributes[i]=new O$(this.device,a)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(n=>{t[n]||(t[n]=[]),t[n].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:i,updateTriggers:n}=this,a=n[t];return a&&a.forEach(s=>{const o=i[s];o&&o.setNeedsUpdate(o.id,e)}),a}_updateAttribute(t){const{attribute:e,numInstances:i}=t;if(xa(nut,e),e.constant){e.setConstantValue(e.value);return}e.allocate(i)&&xa(aut,e,i),e.updateBuffer(t)&&(this.needsRedraw=!0,xa(sut,e,i))}}class lut extends iS{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:i,duration:n,easing:a}}=this,s=a(t/n);this._value=sg(e,i,s)}}const cN=1e-5;function hN(r,t,e,i,n){const a=t-r,o=(e-t)*n,l=-a*i;return o+l+a+t}function uut(r,t,e,i,n){if(Array.isArray(e)){const a=[];for(let s=0;s<e.length;s++)a[s]=hN(r[s],t[s],e[s],i,n);return a}return hN(r,t,e,i,n)}function fN(r,t){if(Array.isArray(r)){let e=0;for(let i=0;i<r.length;i++){const n=r[i]-t[i];e+=n*n}return Math.sqrt(e)}return Math.abs(r-t)}class cut extends iS{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:i,stiffness:n}=this.settings,{_prevValue:a=t,_currValue:s=t}=this;let o=uut(a,s,e,i,n);const l=fN(o,e),u=fN(o,s);l<cN&&u<cN&&(o=e,this.end()),this._prevValue=s,this._currValue=o}}const hut={interpolation:lut,spring:cut};class fut{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,i,n){const{transitions:a}=this;if(a.has(t)){const l=a.get(t),{value:u=l.settings.fromValue}=l;e=u,this.remove(t)}if(n=k$(n),!n)return;const s=hut[n.type];if(!s){Wr.error(`unsupported transition type '${n.type}'`)();return}const o=new s(this.timeline);o.start({...n,fromValue:e,toValue:i}),a.set(t,o)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,i]of this.transitions)i.update(),t[e]=i.value,i.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function dut(r){const t=r[Mc];for(const e in t){const i=t[e],{validate:n}=i;if(n&&!n(r[e],i))throw new Error(`Invalid prop ${e}: ${r[e]}`)}}function put(r,t){const e=W$({newProps:r,oldProps:t,propTypes:r[Mc],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=vut(r,t);let n=!1;return i||(n=mut(r,t)),{dataChanged:i,propsChanged:e,updateTriggersChanged:n,extensionsChanged:yut(r,t),transitionsChanged:gut(r,t)}}function gut(r,t){if(!r.transitions)return!1;const e={},i=r[Mc];let n=!1;for(const a in r.transitions){const s=i[a],o=s&&s.type;(o==="number"||o==="color"||o==="array")&&iI(r[a],t[a],s)&&(e[a]=!0,n=!0)}return n?e:!1}function W$({newProps:r,oldProps:t,ignoreProps:e={},propTypes:i={},triggerName:n="props"}){if(t===r)return!1;if(typeof r!="object"||r===null)return`${n} changed shallowly`;if(typeof t!="object"||t===null)return`${n} changed shallowly`;for(const a of Object.keys(r))if(!(a in e)){if(!(a in t))return`${n}.${a} added`;const s=iI(r[a],t[a],i[a]);if(s)return`${n}.${a} ${s}`}for(const a of Object.keys(t))if(!(a in e)){if(!(a in r))return`${n}.${a} dropped`;if(!Object.hasOwnProperty.call(r,a)){const s=iI(r[a],t[a],i[a]);if(s)return`${n}.${a} ${s}`}}return!1}function iI(r,t,e){let i=e&&e.equal;return i&&!i(r,t,e)||!i&&(i=r&&t&&r.equals,i&&!i.call(r,t))?"changed deeply":!i&&t!==r?"changed shallowly":null}function vut(r,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:i,_dataDiff:n}=r;return i?i(r.data,t.data)||(e="Data comparator detected a change"):r.data!==t.data&&(e="A new data container was supplied"),e&&n&&(e=n(r.data,t.data)||e),e}function mut(r,t){if(t===null)return{all:!0};if("all"in r.updateTriggers&&dN(r,t,"all"))return{all:!0};const e={};let i=!1;for(const n in r.updateTriggers)n!=="all"&&dN(r,t,n)&&(e[n]=!0,i=!0);return i?e:!1}function yut(r,t){if(t===null)return!0;const e=t.extensions,{extensions:i}=r;if(i===e)return!1;if(!e||!i||i.length!==e.length)return!0;for(let n=0;n<i.length;n++)if(!i[n].equals(e[n]))return!0;return!1}function dN(r,t,e){let i=r.updateTriggers[e];i=i??{};let n=t.updateTriggers[e];return n=n??{},W$({oldProps:n,newProps:i,triggerName:e})}const _ut="count(): argument not an object",xut="count(): argument not a container";function but(r){if(!Sut(r))throw new Error(_ut);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(wut(r))return Object.keys(r).length;throw new Error(xut)}function wut(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function Sut(r){return r!==null&&typeof r=="object"}function pN(r,t){if(!t)return r;const e={...r,...t};if("defines"in t&&(e.defines={...r.defines,...t.defines}),"modules"in t&&(e.modules=(r.modules||[]).concat(t.modules),t.modules.some(i=>i.name==="project64"))){const i=e.modules.findIndex(n=>n.name==="project32");i>=0&&e.modules.splice(i,1)}if("inject"in t)if(!r.inject)e.inject=t.inject;else{const i={...r.inject};for(const n in t.inject)i[n]=(i[n]||"")+t.inject[n];e.inject=i}return e}const Tut={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},nI={};function Aut(r,t,e,i){if(e instanceof eo)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let n=null;e.compressed&&(n={minFilter:"linear",mipmapFilter:e.data.length>1?"nearest":"linear"});const a=t.createTexture({...e,sampler:{...Tut,...n,...i}});return nI[a.id]=r,a}function Cut(r,t){!t||!(t instanceof eo)||nI[t.id]===r&&(t.delete(),delete nI[t.id])}const Eut={boolean:{validate(r,t){return!0},equal(r,t,e){return!!r==!!t}},number:{validate(r,t){return Number.isFinite(r)&&(!("max"in t)||r<=t.max)&&(!("min"in t)||r>=t.min)}},color:{validate(r,t){return t.optional&&!r||aI(r)&&(r.length===3||r.length===4)},equal(r,t,e){return As(r,t,1)}},accessor:{validate(r,t){const e=Ib(r);return e==="function"||e===Ib(t.value)},equal(r,t,e){return typeof t=="function"?!0:As(r,t,1)}},array:{validate(r,t){return t.optional&&!r||aI(r)},equal(r,t,e){const{compare:i}=e,n=Number.isInteger(i)?i:i?1:0;return i?As(r,t,n):r===t}},object:{equal(r,t,e){if(e.ignore)return!0;const{compare:i}=e,n=Number.isInteger(i)?i:i?1:0;return i?As(r,t,n):r===t}},function:{validate(r,t){return t.optional&&!r||typeof r=="function"},equal(r,t,e){return!e.compare&&e.ignore!==!1||r===t}},data:{transform:(r,t,e)=>{if(!r)return r;const{dataTransform:i}=e.props;return i?i(r):typeof r.shape=="string"&&r.shape.endsWith("-table")&&Array.isArray(r.data)?r.data:r}},image:{transform:(r,t,e)=>{const i=e.context;return!i||!i.device?null:Aut(e.id,i.device,r,{...t.parameters,...e.props.textureParameters})},release:(r,t,e)=>{Cut(e.id,r)}}};function Iut(r){const t={},e={},i={};for(const[n,a]of Object.entries(r)){const s=a==null?void 0:a.deprecatedFor;if(s)i[n]=Array.isArray(s)?s:[s];else{const o=Mut(n,a);t[n]=o,e[n]=o.value}}return{propTypes:t,defaultProps:e,deprecatedProps:i}}function Mut(r,t){switch(Ib(t)){case"object":return Kv(r,t);case"array":return Kv(r,{type:"array",value:t,compare:!1});case"boolean":return Kv(r,{type:"boolean",value:t});case"number":return Kv(r,{type:"number",value:t});case"function":return Kv(r,{type:"function",value:t,compare:!0});default:return{name:r,type:"unknown",value:t}}}function Kv(r,t){return"type"in t?{name:r,...Eut[t.type],...t}:"value"in t?{name:r,type:Ib(t.value),...t}:{name:r,type:"object",value:t}}function aI(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function Ib(r){return aI(r)?"array":r===null?"null":typeof r}function Put(r,t){let e;for(let a=t.length-1;a>=0;a--){const s=t[a];"extensions"in s&&(e=s.extensions)}const i=sI(r.constructor,e),n=Object.create(i);n[Cb]=r,n[Ff]={},n[pc]={};for(let a=0;a<t.length;++a){const s=t[a];for(const o in s)n[o]=s[o]}return Object.freeze(n),n}const Rut="_mergedDefaultProps";function sI(r,t){if(!(r instanceof G$.constructor))return{};let e=Rut;if(t)for(const n of t){const a=n.constructor;a&&(e+=`:${a.extensionName||a.name}`)}const i=H$(r,e);return i||(r[e]=Dut(r,t||[]))}function Dut(r,t){if(!r.prototype)return null;const i=Object.getPrototypeOf(r),n=sI(i),a=H$(r,"defaultProps")||{},s=Iut(a),o=Object.assign(Object.create(null),n,s.defaultProps),l=Object.assign(Object.create(null),n==null?void 0:n[Mc],s.propTypes),u=Object.assign(Object.create(null),n==null?void 0:n[SA],s.deprecatedProps);for(const c of t){const h=sI(c.constructor);h&&(Object.assign(o,h),Object.assign(l,h[Mc]),Object.assign(u,h[SA]))}return Lut(o,r),Out(o,l),kut(o,u),o[Mc]=l,o[SA]=u,t.length===0&&!HP(r,"_propTypes")&&(r._propTypes=l),o}function Lut(r,t){const e=Fut(t);Object.defineProperties(r,{id:{writable:!0,value:e}})}function kut(r,t){for(const e in t)Object.defineProperty(r,e,{enumerable:!1,set(i){const n=`${this.id}: ${e}`;for(const a of t[e])HP(this,a)||(this[a]=i);Wr.deprecated(n,t[e].join("/"))()}})}function Out(r,t){const e={},i={};for(const n in t){const a=t[n],{name:s,value:o}=a;a.async&&(e[s]=o,i[s]=Nut(s))}r[Xp]=e,r[Ff]={},Object.defineProperties(r,i)}function Nut(r){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||D$(t)?this[Ff][r]=t:this[pc][r]=t},get(){if(this[pc]){if(r in this[pc])return this[pc][r]||this[Xp][r];if(r in this[Ff]){const t=this[Cb]&&this[Cb].internalState;if(t&&t.hasAsyncProp(r))return t.getAsyncProp(r)||this[Xp][r]}}return this[Xp][r]}}}function HP(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function H$(r,t){return HP(r,t)&&r[t]}function Fut(r){const t=r.componentName;return t||Wr.warn(`${r.name}.componentName not specified`)(),t||r.name}let But=0;class GP{constructor(...t){this.props=Put(this,t),this.id=this.props.id,this.count=But++}clone(t){const{props:e}=this,i={};for(const n in e[Xp])n in e[pc]?i[n]=e[pc][n]:n in e[Ff]&&(i[n]=e[Ff][n]);return new this.constructor({...e,...i,...t})}}GP.componentName="Component";GP.defaultProps={};const G$=GP,zut=Object.freeze({});class Vut{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||zut}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[Cb]||this.component;const e=t[pc]||{},i=t[Ff]||t,n=t[Xp]||{};for(const a in e){const s=e[a];this._createAsyncPropData(a,n[a]),this._updateAsyncProp(a,s),e[a]=this.getAsyncProp(a)}for(const a in i){const s=i[a];this._createAsyncPropData(a,n[a]),this._updateAsyncProp(a,s)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(D$(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const i=this.asyncProps[t];return e===i.resolvedValue||e===i.lastValue?!1:(i.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const i=this.asyncProps[t];i&&(e=this._postProcessValue(i,e),i.resolvedValue=e,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(t,e,i){const n=this.asyncProps[t];n&&i>=n.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=e,n.resolvedLoadCount=i,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const i=this.asyncProps[t];if(i){i.pendingLoadCount++;const n=i.pendingLoadCount;e.then(a=>{this.component&&(a=this._postProcessValue(i,a),this._setAsyncPropValue(t,a,n),this._onResolve(t,a))}).catch(a=>{this._onError(t,a)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const i=this.asyncProps[t];if(!i)return;i.pendingLoadCount++;const n=i.pendingLoadCount;let a=[],s=0;for await(const o of e){if(!this.component)return;const{dataTransform:l}=this.component.props;l?a=l(o,a):a=a.concat(o),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:s,endRow:a.length}]}),s=a.length,this._setAsyncPropValue(t,a,n)}this._onResolve(t,a)}_postProcessValue(t,e){const i=t.type;return i&&this.component&&(i.release&&i.release(t.resolvedValue,i,this.component),i.transform)?i.transform(e,i,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const n=this.component&&this.component.props[Mc];this.asyncProps[t]={type:n&&n[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class Uut extends Vut{constructor({attributeManager:t,layer:e}){super(e),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const i=this.layer,n=i==null?void 0:i.props.fetch;return n?n(e,{propName:t,layer:i}):super._fetch(t,e)}_onResolve(t,e){const i=this.layer;if(i){const n=i.props.onDataLoad;t==="data"&&n&&n(e,{propName:t,layer:i})}}_onError(t,e){const i=this.layer;i&&i.raiseError(e,`loading ${t} of ${this.layer}`)}}const $ut="layer.changeFlag",Wut="layer.initialize",Hut="layer.update",Gut="layer.finalize",jut="layer.matched",gN=2**24-1,Xut=Object.freeze([]),Zut=m_(({oldViewport:r,viewport:t})=>r.equals(t));let el=new Uint8ClampedArray(0);const qut={data:{type:"data",value:Xut,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,{propName:t,layer:e,loaders:i,loadOptions:n,signal:a})=>{const{resourceManager:s}=e.context;n=n||e.getLoadOptions(),i=i||e.props.loaders,a&&(n={...n,fetch:{...n==null?void 0:n.fetch,signal:a}});let o=s.contains(r);return!o&&!n&&(s.add({resourceId:r,data:fb(r,i),persistent:!1}),o=!0),o?s.subscribe({resourceId:r,onChange:l=>{var u;return(u=e.internalState)==null?void 0:u.reloadAsyncProp(t,l)},consumerId:e.id,requestId:t}):fb(r,i,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Qr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:r})=>[0,-r*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};let jP=class extends G${constructor(){super(...arguments),this.internalState=null,this.lifecycle=bp.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){Kn(this.internalState);const e=this.internalState.viewport||this.context.viewport,i=o$(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,a,s]=n$(i,e.pixelProjectionMatrix);return t.length===2?[n,a]:[n,a,s]}unproject(t){return Kn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){Kn(this.internalState);const i=this.internalState.viewport||this.context.viewport;return qnt(t,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}setShaderModuleProps(...t){for(const e of this.getModels())e.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===Qr.DEFAULT||t===Qr.LNGLAT||t===Qr.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){Kn(t instanceof Uint8Array);const[e,i,n]=t;return e+i*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:but(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){t=pN(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const e of this.props.extensions)t=pN(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:i}=t.changeFlags;if(i&&e)if(Array.isArray(i))for(const n of i)e.invalidateAll(n);else e.invalidateAll();if(e){const{props:n}=t,a=this.internalState.hasPickingBuffer,s=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(a!==s){this.internalState.hasPickingBuffer=s;const{pickingColors:o,instancePickingColors:l}=e.attributes,u=o||l;u&&(s&&u.constant&&(u.constant=!1,e.invalidate(u.id)),!u.value&&!s&&(u.constant=!0,u.value=[0,0,0]))}}}finalizeState(t){for(const i of this.getModels())i.destroy();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo({info:t,mode:e,sourceLayer:i}){const{index:n}=t;return n>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[n]),t}raiseError(t,e){var i,n,a,s;e&&(t=new Error(`${e}: ${t.message}`,{cause:t})),(n=(i=this.props).onError)!=null&&n.call(i,t)||(s=(a=this.context)==null?void 0:a.onError)==null||s.call(a,t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)==null?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!Zut({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){let e=!1;for(const i in t)t[i].layoutChanged()&&(e=!0);for(const i of this.getModels())this._setModelAttributes(i,t,e)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,i=this.getNumInstances(),n=this.getStartIndices();t.update({data:e.data,numInstances:i,startIndices:n,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const a=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(a)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),i=Object.create(this.props);for(const n in e)Object.defineProperty(i,n,{value:e[n]});return i}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const i=Math.floor(el.length/4);if(this.internalState.usesPickingColorCache=!0,i<e){e>gN&&Wr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),el=cg.allocate(el,e,{size:4,copy:!0,maxCount:Math.max(e,gN)});const n=Math.floor(el.length/4),a=[];for(let s=i;s<n;s++)this.encodePickingColor(s,a),el[s*4+0]=a[0],el[s*4+1]=a[1],el[s*4+2]=a[2]}t.value=el.subarray(0,e*4)}_setModelAttributes(t,e,i=!1){var o;if(!Object.keys(e).length)return;if(i){const l=this.getAttributeManager();t.setBufferLayout(l.getBufferLayouts(t)),e=l.getAttributes()}const n=((o=t.userData)==null?void 0:o.excludeAttributes)||{},a={},s={};for(const l in e){if(n[l])continue;const u=e[l].getValue();for(const c in u){const h=u[c];h instanceof rn?e[l].settings.isIndexed?t.setIndexBuffer(h):a[c]=h:h&&(s[c]=h)}}t.setAttributes(a),t.setConstantAttributes(s)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,a=i||n,s=a&&e.attributes&&e.attributes[a.id];if(s&&s.value){const o=s.value,l=this.encodePickingColor(t);for(let u=0;u<e.length;u++){const c=a.getVertexOffset(u);o[c]===l[0]&&o[c+1]===l[1]&&o[c+2]===l[2]&&this._disablePickingIndex(u)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,n=e||i;if(!n)return;const a=n.getVertexOffset(t),s=n.getVertexOffset(t+1);n.buffer.write(new Uint8Array(s-a),a)}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,i=t||e;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==el.buffer&&(i.value=el.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Kn(!this.internalState),Kn(Number.isFinite(this.props.coordinateSystem)),xa(Wut,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Uut({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Wr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new fut(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){xa(jut,this,this===t);const{state:e,internalState:i}=t;this!==t&&(this.internalState=i,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(xa(Hut,this,t),!t)return;const e=this.props,i=this.context,n=this.internalState,a=i.viewport,s=this._updateUniformTransition();n.propsInTransition=s,i.viewport=n.viewport||a,this.props=s;try{const o=this._getUpdateParams(),l=this.getModels();if(i.device)this.updateState(o);else try{this.updateState(o)}catch{}for(const c of this.props.extensions)c.updateState.call(this,o,c);const u=this.getModels()[0]!==l[0];this._postUpdate(o,u)}finally{i.viewport=a,this.props=e,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){xa(Gut,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,moduleParameters:e=null,uniforms:i={},parameters:n={}}){this._updateAttributeTransition();const a=this.props,s=this.context;this.props=this.internalState.propsInTransition||a;const o=this.props.opacity;i.opacity=Math.pow(o,1/2.2);try{if(e){const{isActive:c,isAttribute:h}=e.picking;this.setModuleParameters(e),this.setShaderModuleProps({picking:{isActive:c,isAttribute:h}})}const{getPolygonOffset:l}=this.props,u=l&&l(i)||[0,0];s.device.setParametersWebGL({polygonOffset:u});for(const c of this.getModels())c.setParameters(n);s.device.withParametersWebGL(n,()=>{const c={renderPass:t,moduleParameters:e,uniforms:i,parameters:n,context:s};for(const h of this.props.extensions)h.draw.call(this,c,h);this.draw(c)})}finally{this.props=a}}getChangeFlags(){var t;return(t=this.internalState)==null?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const n in t)if(t[n]){let a=!1;switch(n){case"dataChanged":const s=t[n],o=e[n];s&&Array.isArray(o)&&(e.dataChanged=Array.isArray(s)?o.concat(s):s,a=!0);default:e[n]||(e[n]=t[n],a=!0)}a&&xa($ut,this,n,t)}const i=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=i,e.somethingChanged=i||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){var n;const i=put(t,e);if(i.updateTriggersChanged)for(const a in i.updateTriggersChanged)i.updateTriggersChanged[a]&&this.invalidateAttribute(a);if(i.transitionsChanged)for(const a in i.transitionsChanged)this.internalState.uniformTransitions.add(a,e[a],t[a],(n=t.transitions)==null?void 0:n[a]);return this.setChangeFlags(i)}validateProps(){dut(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={highlightedObjectColor:t.picked?t.color:null},{highlightColor:i}=this.props;t.picked&&typeof i=="function"&&(e.highlightColor=i(t)),this.setShaderModuleProps({picking:e}),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new out(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:i,oldProps:n}=t;this.setNeedsRedraw(),this._updateAttributes();const a=this.state.model;a!=null&&a.isInstanced&&a.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:o,highlightColor:l}=i;if(e||n.autoHighlight!==s||n.highlightedObjectIndex!==o||n.highlightColor!==l){const u={};Array.isArray(l)&&(u.highlightColor=l),(e||n.autoHighlight!==s||o!==n.highlightedObjectIndex)&&(u.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:u})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),n=i?i.getNeedsRedraw(t):!1;if(e=e||n,e)for(const a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};jP.defaultProps=qut;jP.layerName="Layer";const Tg=jP,Yut="compositeLayer.renderLayers";class j$ extends Tg{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id&&(t.object=e.__source.object,t.index=e.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:i}=this.props;return i&&i[t]&&i[t].type||e}getSubLayerRow(t,e,i){return t.__source={parent:this,object:e,index:i},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(e.index=i.__source.index,t(i.__source.object,e)):t(i,n)}return t}getSubLayerProps(t={}){var U;const{opacity:e,pickable:i,visible:n,parameters:a,getPolygonOffset:s,highlightedObjectIndex:o,autoHighlight:l,highlightColor:u,coordinateSystem:c,coordinateOrigin:h,wrapLongitude:p,positionFormat:v,modelMatrix:y,extensions:x,fetch:w,operation:T,_subLayerProps:E}=this.props,M={id:"",updateTriggers:{},opacity:e,pickable:i,visible:n,parameters:a,getPolygonOffset:s,highlightedObjectIndex:o,autoHighlight:l,highlightColor:u,coordinateSystem:c,coordinateOrigin:h,wrapLongitude:p,positionFormat:v,modelMatrix:y,extensions:x,fetch:w,operation:T},L=E&&t.id&&E[t.id],F=L&&L.updateTriggers,O=t.id||"sublayer";if(L){const W=this.props[Mc],H=t.type?t.type._propTypes:{};for(const j in L){const Y=H[j]||W[j];Y&&Y.type==="accessor"&&(L[j]=this.getSubLayerAccessor(L[j]))}}Object.assign(M,t,L),M.id=`${this.props.id}-${O}`,M.updateTriggers={all:(U=this.props.updateTriggers)==null?void 0:U.all,...t.updateTriggers,...F};for(const W of x){const H=W.getSubLayerProps.call(this,W);H&&Object.assign(M,H,{updateTriggers:Object.assign(M.updateTriggers,H.updateTriggers)})}return M}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let i=this.internalState.subLayers;const n=!i||this.needsUpdate();if(n){const a=this.renderLayers();i=rS(a,Boolean),this.internalState.subLayers=i}xa(Yut,this,n,i);for(const a of i)a.parent=this}}j$.layerName="CompositeLayer";const XP=j$,cx=Math.PI/180,vN=180/Math.PI,k1=6370972,Lp=256;function Kut(){const r=Lp/k1,t=Math.PI/180*Lp;return{unitsPerMeter:[r,r,r],unitsPerMeter2:[0,0,0],metersPerUnit:[1/r,1/r,1/r],unitsPerDegree:[t,t,r],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/r]}}class Jut extends FP{constructor(t={}){const{latitude:e=0,longitude:i=0,zoom:n=0,nearZMultiplier:a=.1,farZMultiplier:s=2,resolution:o=10}=t;let{height:l,altitude:u=1.5}=t;l=l||1,u=Math.max(.75,u);const c=new wa().lookAt({eye:[0,-u,0],up:[0,0,1]}),h=Math.pow(2,n);c.rotateX(e*cx),c.rotateZ(-i*cx),c.scale(h/l);const p=Math.atan(.5/u),v=Lp*2*h/l;super({...t,height:l,viewMatrix:c,longitude:i,latitude:e,zoom:n,distanceScales:Kut(),fovyRadians:p*2,focalDistance:u,near:a,far:Math.min(2,1/v+1)*u*s}),this.latitude=e,this.longitude=i,this.resolution=o}get projectionMode(){return Po.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const e={targetZ:t.z||0},i=this.unproject([0,this.height/2],e),n=this.unproject([this.width/2,0],e),a=this.unproject([this.width,this.height/2],e),s=this.unproject([this.width/2,this.height],e);return a[0]<this.longitude&&(a[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],a[0],n[0],s[0]),Math.min(i[1],a[1],n[1],s[1]),Math.max(i[0],a[0],n[0],s[0]),Math.max(i[1],a[1],n[1],s[1])]}unproject(t,{topLeft:e=!0,targetZ:i}={}){const[n,a,s]=t,o=e?a:this.height-a,{pixelUnprojectionMatrix:l}=this;let u;if(Number.isFinite(s))u=OA(l,[n,o,s,1]);else{const v=OA(l,[n,o,-1,1]),y=OA(l,[n,o,1,1]),x=((i||0)/k1+1)*Lp,w=pA($8([],v,y)),T=pA(v),E=pA(y),L=4*((4*T*E-(w-T-E)**2)/16)/w,F=Math.sqrt(T-L),O=Math.sqrt(Math.max(0,x*x-L)),U=(F-O)/Math.sqrt(w);u=Crt([],v,y,U)}const[c,h,p]=this.unprojectPosition(u);return Number.isFinite(s)?[c,h,p]:Number.isFinite(i)?[c,h,i]:[c,h]}projectPosition(t){const[e,i,n=0]=t,a=e*cx,s=i*cx,o=Math.cos(s),l=(n/k1+1)*Lp;return[Math.sin(a)*o*l,-Math.cos(a)*o*l,Math.sin(s)*l]}unprojectPosition(t){const[e,i,n]=t,a=W8(t),s=Math.asin(n/a),l=Math.atan2(e,-i)*vN,u=s*vN,c=(a/Lp-1)*k1;return[l,u,c]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,e){const i=this.unproject(e);return{longitude:t[0]-i[0]+this.longitude,latitude:t[1]-i[1]+this.latitude}}}function OA(r,t){const e=wg([],t,r);return DP(e,e,1/e[3]),e}class ZP{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(t){t&&(this.opts=t)}equals(t){return this===t?!0:this.constructor===t.constructor&&As(this.opts,t.opts,1)}getShaders(t){return null}getSubLayerProps(t){const{defaultProps:e}=t.constructor,i={updateTriggers:{}};for(const n in e)if(n in this.props){const a=e[n],s=this.props[n];i[n]=s,a&&a.type==="accessor"&&(i.updateTriggers[n]=this.props.updateTriggers[n],typeof s=="function"&&(i[n]=this.getSubLayerAccessor(s)))}return i}initializeState(t,e){}updateState(t,e){}onNeedsRedraw(t){}getNeedsPickingBuffer(t){return!1}draw(t,e){}finalizeState(t,e){}}ZP.defaultProps={};ZP.extensionName="LayerExtension";const Qut=ZP;class X${constructor(t){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:e={}}=t;this.typedArrayManager=cg,this.attributes={},this._attributeDefs=e,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:e,buffers:i={},getGeometry:n,geometryBuffer:a,positionFormat:s,dataChanged:o,normalize:l=!0}=this.opts;if(this.data=e,this.getGeometry=n,this.positionSize=a&&a.size||(s==="XY"?2:3),this.buffers=i,this.normalize=l,a&&(Kn(e.startIndices),this.getGeometry=this.getGeometryFromBuffer(a),l||(i.vertexPositions=a)),this.geometryBuffer=i.vertexPositions,Array.isArray(o))for(const u of o)this._rebuildGeometry(u);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:e}){this._rebuildGeometry({startRow:t,endRow:e})}getGeometryFromBuffer(t){const e=t.value||t;return ArrayBuffer.isView(e)?L$(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,e){const{attributes:i,buffers:n,_attributeDefs:a,typedArrayManager:s}=this;for(const o in a)if(o in n)s.release(i[o]),i[o]=null;else{const l=a[o];l.copy=e,i[o]=s.allocate(i[o],t,l)}}_forEachGeometry(t,e,i){const{data:n,getGeometry:a}=this,{iterable:s,objectInfo:o}=oS(n,e,i);for(const l of s){o.index++;const u=a?a(l,o):null;t(u,o.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:e,vertexStarts:i,instanceCount:n}=this;const{data:a,geometryBuffer:s}=this,{startRow:o=0,endRow:l=1/0}=t||{},u={};if(t||(e=[0],i=[0]),this.normalize||!s)this._forEachGeometry((h,p)=>{const v=h&&this.normalizeGeometry(h);u[p]=v,i[p+1]=i[p]+(v?this.getGeometrySize(v):0)},o,l),n=i[i.length-1];else if(i=a.startIndices,n=i[a.length]||0,ArrayBuffer.isView(s))n=n||s.length/this.positionSize;else if(s instanceof rn){const h=this.positionSize*4;n=n||s.byteLength/h}else if(s.buffer){const h=s.stride||this.positionSize*4;n=n||s.buffer.byteLength/h}else if(s.value){const h=s.value,p=s.stride/h.BYTES_PER_ELEMENT||this.positionSize;n=n||h.length/p}this._allocate(n,!!t),this.indexStarts=e,this.vertexStarts=i,this.instanceCount=n;const c={};this._forEachGeometry((h,p)=>{const v=u[p]||h;c.vertexStart=i[p],c.indexStart=e[p];const y=p<i.length-1?i[p+1]:n;c.geometrySize=y-i[p],c.geometryIndex=p,this.updateGeometryAttributes(v,c)},o,l),this.vertexCount=e[e.length-1]}}function vc(r,t,e={}){const i={type:"Feature"};return(e.id===0||e.id)&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.properties=t||{},i.geometry=r,i}function b_(r,t,e={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<n[n.length-1].length;a++)if(n[n.length-1][a]!==n[0][a])throw new Error("First and last Position are not equivalent.")}return vc({type:"Polygon",coordinates:r},t,e)}function tct(r,t,e={}){if(r.length<2)throw new Error("coordinates must be an array of two or more positions");return vc({type:"LineString",coordinates:r},t,e)}function mN(r,t={}){const e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=r,e}function ect(r,t,e={}){return vc({type:"MultiLineString",coordinates:r},t,e)}function lS(r,t,e={}){return vc({type:"MultiPolygon",coordinates:r},t,e)}function rct(r){return r.type==="Feature"?r.geometry:r}function Mb(r,t){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function ict(r,t,e){var i=r.length,n=kp(r[0],t),a=[],s,o,l;let u,c;for(e||(e=[]),s=1;s<i;s++){for(u=r[s-1],c=r[s],o=l=kp(c,t);;)if(n|o){if(n&o)break;n?(u=oI(u,c,n,t),n=kp(u,t)):(c=oI(u,c,o,t),o=kp(c,t))}else{a.push(u),o!==l?(a.push(c),s<i-1&&(e.push(a),a=[])):s===i-1&&a.push(c);break}n=l}return a.length&&e.push(a),e}function nct(r,t){var e,i,n,a,s,o,l;for(i=1;i<=8;i*=2){for(e=[],n=r[r.length-1],a=!(kp(n,t)&i),s=0;s<r.length;s++)o=r[s],l=!(kp(o,t)&i),l!==a&&e.push(oI(n,o,i,t)),l&&e.push(o),n=o,a=l;if(r=e,!r.length)break}return e}function oI(r,t,e,i){return e&8?[r[0]+(t[0]-r[0])*(i[3]-r[1])/(t[1]-r[1]),i[3]]:e&4?[r[0]+(t[0]-r[0])*(i[1]-r[1])/(t[1]-r[1]),i[1]]:e&2?[i[2],r[1]+(t[1]-r[1])*(i[2]-r[0])/(t[0]-r[0])]:e&1?[i[0],r[1]+(t[1]-r[1])*(i[0]-r[0])/(t[0]-r[0])]:null}function kp(r,t){var e=0;return r[0]<t[0]?e|=1:r[0]>t[2]&&(e|=2),r[1]<t[1]?e|=4:r[1]>t[3]&&(e|=8),e}function act(r,t){const e=rct(r),i=e.type,n=r.type==="Feature"?r.properties:{};let a=e.coordinates;switch(i){case"LineString":case"MultiLineString":{const s=[];return i==="LineString"&&(a=[a]),a.forEach(o=>{ict(o,t,s)}),s.length===1?tct(s[0],n):ect(s,n)}case"Polygon":return b_(yN(a,t),n);case"MultiPolygon":return lS(a.map(s=>yN(s,t)),n);default:throw new Error("geometry "+i+" not supported")}}function yN(r,t){const e=[];for(const i of r){const n=nct(i,t);n.length>0&&((n[0][0]!==n[n.length-1][0]||n[0][1]!==n[n.length-1][1])&&n.push(n[0]),n.length>=4&&e.push(n))}return e}var NA=act;function sct(r,t={}){const e=Number(r[0]),i=Number(r[1]),n=Number(r[2]),a=Number(r[3]);if(r.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const s=[e,i];return b_([[s,[n,i],[n,a],[e,a],s]],t.properties,{bbox:r,id:t.id})}var oct=sct;/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function lct(r,t){var e={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},i,n,a,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(u){return function(c){return l([u,c])}}function l(u){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,n&&(a=u[0]&2?n.return:u[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,u[1])).done)return a;switch(n=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,n=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(a=e.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){e.label=u[1];break}if(u[0]===6&&e.label<a[1]){e.label=a[1],a=u;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(u);break}a[2]&&e.ops.pop(),e.trys.pop();continue}u=t.call(r,e)}catch(c){u=[6,c],n=0}finally{i=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Bc=function(){function r(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}return r}();function uct(r,t){return r>t?1:r<t?-1:0}function fc(r,t,e){for(var i=new Bc(null,null),n=i,a=i;;){var s=e(r,t.key);if(s<0){if(t.left===null)break;if(e(r,t.left.key)<0){var o=t.left;if(t.left=o.right,o.right=t,t=o,t.left===null)break}a.left=t,a=t,t=t.left}else if(s>0){if(t.right===null)break;if(e(r,t.right.key)>0){var o=t.right;if(t.right=o.left,o.left=t,t=o,t.right===null)break}n.right=t,n=t,t=t.right}else break}return n.right=t.left,a.left=t.right,t.left=i.right,t.right=i.left,t}function FA(r,t,e,i){var n=new Bc(r,t);if(e===null)return n.left=n.right=null,n;e=fc(r,e,i);var a=i(r,e.key);return a<0?(n.left=e.left,n.right=e,e.left=null):a>=0&&(n.right=e.right,n.left=e,e.right=null),n}function _N(r,t,e){var i=null,n=null;if(t){t=fc(r,t,e);var a=e(t.key,r);a===0?(i=t.left,n=t.right):a<0?(n=t.right,t.right=null,i=t):(i=t.left,t.left=null,n=t)}return{left:i,right:n}}function cct(r,t,e){return t===null?r:(r===null||(t=fc(r.key,t,e),t.left=r),t)}function lI(r,t,e,i,n){if(r){i(""+t+(e?" ":" ")+n(r)+`
`);var a=t+(e?"    ":"   ");r.left&&lI(r.left,a,!1,i,n),r.right&&lI(r.right,a,!0,i,n)}}var qP=function(){function r(t){t===void 0&&(t=uct),this._root=null,this._size=0,this._comparator=t}return r.prototype.insert=function(t,e){return this._size++,this._root=FA(t,e,this._root,this._comparator)},r.prototype.add=function(t,e){var i=new Bc(t,e);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var n=this._comparator,a=fc(t,this._root,n),s=n(t,a.key);return s===0?this._root=a:(s<0?(i.left=a.left,i.right=a,a.left=null):s>0&&(i.right=a.right,i.left=a,a.right=null),this._size++,this._root=i),this._root},r.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},r.prototype._remove=function(t,e,i){var n;if(e===null)return null;e=fc(t,e,i);var a=i(t,e.key);return a===0?(e.left===null?n=e.right:(n=fc(t,e.left,i),n.right=e.right),this._size--,n):e},r.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=fc(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},r.prototype.findStatic=function(t){for(var e=this._root,i=this._comparator;e;){var n=i(t,e.key);if(n===0)return e;n<0?e=e.left:e=e.right}return null},r.prototype.find=function(t){return this._root&&(this._root=fc(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},r.prototype.contains=function(t){for(var e=this._root,i=this._comparator;e;){var n=i(t,e.key);if(n===0)return!0;n<0?e=e.left:e=e.right}return!1},r.prototype.forEach=function(t,e){for(var i=this._root,n=[],a=!1;!a;)i!==null?(n.push(i),i=i.left):n.length!==0?(i=n.pop(),t.call(e,i),i=i.right):a=!0;return this},r.prototype.range=function(t,e,i,n){for(var a=[],s=this._comparator,o=this._root,l;a.length!==0||o;)if(o)a.push(o),o=o.left;else{if(o=a.pop(),l=s(o.key,e),l>0)break;if(s(o.key,t)>=0&&i.call(n,o))return this;o=o.right}return this},r.prototype.keys=function(){var t=[];return this.forEach(function(e){var i=e.key;return t.push(i)}),t},r.prototype.values=function(){var t=[];return this.forEach(function(e){var i=e.data;return t.push(i)}),t},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},r.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},r.prototype.at=function(t){for(var e=this._root,i=!1,n=0,a=[];!i;)if(e)a.push(e),e=e.left;else if(a.length>0){if(e=a.pop(),n===t)return e;n++,e=e.right}else i=!0;return null},r.prototype.next=function(t){var e=this._root,i=null;if(t.right){for(i=t.right;i.left;)i=i.left;return i}for(var n=this._comparator;e;){var a=n(t.key,e.key);if(a===0)break;a<0?(i=e,e=e.left):e=e.right}return i},r.prototype.prev=function(t){var e=this._root,i=null;if(t.left!==null){for(i=t.left;i.right;)i=i.right;return i}for(var n=this._comparator;e;){var a=n(t.key,e.key);if(a===0)break;a<0?e=e.left:(i=e,e=e.right)}return i},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return fct(this._root)},r.prototype.load=function(t,e,i){e===void 0&&(e=[]),i===void 0&&(i=!1);var n=t.length,a=this._comparator;if(i&&hI(t,e,0,n-1,a),this._root===null)this._root=uI(t,e,0,n),this._size=n;else{var s=dct(this.toList(),hct(t,e),a);n=this._size+n,this._root=cI({head:s},0,n)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(t){t===void 0&&(t=function(i){return String(i.key)});var e=[];return lI(this._root,"",!0,function(i){return e.push(i)},t),e.join("")},r.prototype.update=function(t,e,i){var n=this._comparator,a=_N(t,this._root,n),s=a.left,o=a.right;n(t,e)<0?o=FA(e,i,o,n):s=FA(e,i,s,n),this._root=cct(s,o,n)},r.prototype.split=function(t){return _N(t,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var t,e,i;return lct(this,function(n){switch(n.label){case 0:t=this._root,e=[],i=!1,n.label=1;case 1:return i?[3,6]:t===null?[3,2]:(e.push(t),t=t.left,[3,5]);case 2:return e.length===0?[3,4]:(t=e.pop(),[4,t]);case 3:return n.sent(),t=t.right,[3,5];case 4:i=!0,n.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function uI(r,t,e,i){var n=i-e;if(n>0){var a=e+Math.floor(n/2),s=r[a],o=t[a],l=new Bc(s,o);return l.left=uI(r,t,e,a),l.right=uI(r,t,a+1,i),l}return null}function hct(r,t){for(var e=new Bc(null,null),i=e,n=0;n<r.length;n++)i=i.next=new Bc(r[n],t[n]);return i.next=null,e.next}function fct(r){for(var t=r,e=[],i=!1,n=new Bc(null,null),a=n;!i;)t?(e.push(t),t=t.left):e.length>0?(t=a=a.next=e.pop(),t=t.right):i=!0;return a.next=null,n.next}function cI(r,t,e){var i=e-t;if(i>0){var n=t+Math.floor(i/2),a=cI(r,t,n),s=r.head;return s.left=a,r.head=r.head.next,s.right=cI(r,n+1,e),s}return null}function dct(r,t,e){for(var i=new Bc(null,null),n=i,a=r,s=t;a!==null&&s!==null;)e(a.key,s.key)<0?(n.next=a,a=a.next):(n.next=s,s=s.next),n=n.next;return a!==null?n.next=a:s!==null&&(n.next=s),i.next}function hI(r,t,e,i,n){if(!(e>=i)){for(var a=r[e+i>>1],s=e-1,o=i+1;;){do s++;while(n(r[s],a)<0);do o--;while(n(r[o],a)>0);if(s>=o)break;var l=r[s];r[s]=r[o],r[o]=l,l=t[s],t[s]=t[o],t[o]=l}hI(r,t,e,o,n),hI(r,t,o+1,i,n)}}const su=11102230246251565e-32,va=134217729,pct=(3+8*su)*su;function BA(r,t,e,i,n){let a,s,o,l,u=t[0],c=i[0],h=0,p=0;c>u==c>-u?(a=u,u=t[++h]):(a=c,c=i[++p]);let v=0;if(h<r&&p<e)for(c>u==c>-u?(s=u+a,o=a-(s-u),u=t[++h]):(s=c+a,o=a-(s-c),c=i[++p]),a=s,o!==0&&(n[v++]=o);h<r&&p<e;)c>u==c>-u?(s=a+u,l=s-a,o=a-(s-l)+(u-l),u=t[++h]):(s=a+c,l=s-a,o=a-(s-l)+(c-l),c=i[++p]),a=s,o!==0&&(n[v++]=o);for(;h<r;)s=a+u,l=s-a,o=a-(s-l)+(u-l),u=t[++h],a=s,o!==0&&(n[v++]=o);for(;p<e;)s=a+c,l=s-a,o=a-(s-l)+(c-l),c=i[++p],a=s,o!==0&&(n[v++]=o);return(a!==0||v===0)&&(n[v++]=a),v}function gct(r,t){let e=t[0];for(let i=1;i<r;i++)e+=t[i];return e}function w_(r){return new Float64Array(r)}const vct=(3+16*su)*su,mct=(2+12*su)*su,yct=(9+64*su)*su*su,Yd=w_(4),xN=w_(8),bN=w_(12),wN=w_(16),Ba=w_(4);function _ct(r,t,e,i,n,a,s){let o,l,u,c,h,p,v,y,x,w,T,E,M,L,F,O,U,W;const H=r-n,j=e-n,Y=t-a,tt=i-a;L=H*tt,p=va*H,v=p-(p-H),y=H-v,p=va*tt,x=p-(p-tt),w=tt-x,F=y*w-(L-v*x-y*x-v*w),O=Y*j,p=va*Y,v=p-(p-Y),y=Y-v,p=va*j,x=p-(p-j),w=j-x,U=y*w-(O-v*x-y*x-v*w),T=F-U,h=F-T,Yd[0]=F-(T+h)+(h-U),E=L+T,h=E-L,M=L-(E-h)+(T-h),T=M-O,h=M-T,Yd[1]=M-(T+h)+(h-O),W=E+T,h=W-E,Yd[2]=E-(W-h)+(T-h),Yd[3]=W;let it=gct(4,Yd),lt=mct*s;if(it>=lt||-it>=lt||(h=r-H,o=r-(H+h)+(h-n),h=e-j,u=e-(j+h)+(h-n),h=t-Y,l=t-(Y+h)+(h-a),h=i-tt,c=i-(tt+h)+(h-a),o===0&&l===0&&u===0&&c===0)||(lt=yct*s+pct*Math.abs(it),it+=H*c+tt*o-(Y*u+j*l),it>=lt||-it>=lt))return it;L=o*tt,p=va*o,v=p-(p-o),y=o-v,p=va*tt,x=p-(p-tt),w=tt-x,F=y*w-(L-v*x-y*x-v*w),O=l*j,p=va*l,v=p-(p-l),y=l-v,p=va*j,x=p-(p-j),w=j-x,U=y*w-(O-v*x-y*x-v*w),T=F-U,h=F-T,Ba[0]=F-(T+h)+(h-U),E=L+T,h=E-L,M=L-(E-h)+(T-h),T=M-O,h=M-T,Ba[1]=M-(T+h)+(h-O),W=E+T,h=W-E,Ba[2]=E-(W-h)+(T-h),Ba[3]=W;const ht=BA(4,Yd,4,Ba,xN);L=H*c,p=va*H,v=p-(p-H),y=H-v,p=va*c,x=p-(p-c),w=c-x,F=y*w-(L-v*x-y*x-v*w),O=Y*u,p=va*Y,v=p-(p-Y),y=Y-v,p=va*u,x=p-(p-u),w=u-x,U=y*w-(O-v*x-y*x-v*w),T=F-U,h=F-T,Ba[0]=F-(T+h)+(h-U),E=L+T,h=E-L,M=L-(E-h)+(T-h),T=M-O,h=M-T,Ba[1]=M-(T+h)+(h-O),W=E+T,h=W-E,Ba[2]=E-(W-h)+(T-h),Ba[3]=W;const Tt=BA(ht,xN,4,Ba,bN);L=o*c,p=va*o,v=p-(p-o),y=o-v,p=va*c,x=p-(p-c),w=c-x,F=y*w-(L-v*x-y*x-v*w),O=l*u,p=va*l,v=p-(p-l),y=l-v,p=va*u,x=p-(p-u),w=u-x,U=y*w-(O-v*x-y*x-v*w),T=F-U,h=F-T,Ba[0]=F-(T+h)+(h-U),E=L+T,h=E-L,M=L-(E-h)+(T-h),T=M-O,h=M-T,Ba[1]=M-(T+h)+(h-O),W=E+T,h=W-E,Ba[2]=E-(W-h)+(T-h),Ba[3]=W;const Ot=BA(Tt,bN,4,Ba,wN);return wN[Ot-1]}function xct(r,t,e,i,n,a){const s=(t-a)*(e-n),o=(r-n)*(i-a),l=s-o,u=Math.abs(s+o);return Math.abs(l)>=vct*u?l:-_ct(r,t,e,i,n,a,u)}const Jv=(r,t)=>r.ll.x<=t.x&&t.x<=r.ur.x&&r.ll.y<=t.y&&t.y<=r.ur.y,fI=(r,t)=>{if(t.ur.x<r.ll.x||r.ur.x<t.ll.x||t.ur.y<r.ll.y||r.ur.y<t.ll.y)return null;const e=r.ll.x<t.ll.x?t.ll.x:r.ll.x,i=r.ur.x<t.ur.x?r.ur.x:t.ur.x,n=r.ll.y<t.ll.y?t.ll.y:r.ll.y,a=r.ur.y<t.ur.y?r.ur.y:t.ur.y;return{ll:{x:e,y:n},ur:{x:i,y:a}}};let mc=Number.EPSILON;mc===void 0&&(mc=Math.pow(2,-52));const bct=mc*mc,SN=(r,t)=>{if(-mc<r&&r<mc&&-mc<t&&t<mc)return 0;const e=r-t;return e*e<bct*r*t?0:r<t?-1:1};class wct{constructor(){this.reset()}reset(){this.xRounder=new TN,this.yRounder=new TN}round(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}class TN{constructor(){this.tree=new qP,this.round(0)}round(t){const e=this.tree.add(t),i=this.tree.prev(e);if(i!==null&&SN(e.key,i.key)===0)return this.tree.remove(t),i.key;const n=this.tree.next(e);return n!==null&&SN(e.key,n.key)===0?(this.tree.remove(t),n.key):t}}const My=new wct,O1=(r,t)=>r.x*t.y-r.y*t.x,Z$=(r,t)=>r.x*t.x+r.y*t.y,AN=(r,t,e)=>{const i=xct(r.x,r.y,t.x,t.y,e.x,e.y);return i>0?-1:i<0?1:0},Pb=r=>Math.sqrt(Z$(r,r)),Sct=(r,t,e)=>{const i={x:t.x-r.x,y:t.y-r.y},n={x:e.x-r.x,y:e.y-r.y};return O1(n,i)/Pb(n)/Pb(i)},Tct=(r,t,e)=>{const i={x:t.x-r.x,y:t.y-r.y},n={x:e.x-r.x,y:e.y-r.y};return Z$(n,i)/Pb(n)/Pb(i)},CN=(r,t,e)=>t.y===0?null:{x:r.x+t.x/t.y*(e-r.y),y:e},EN=(r,t,e)=>t.x===0?null:{x:e,y:r.y+t.y/t.x*(e-r.x)},Act=(r,t,e,i)=>{if(t.x===0)return EN(e,i,r.x);if(i.x===0)return EN(r,t,e.x);if(t.y===0)return CN(e,i,r.y);if(i.y===0)return CN(r,t,e.y);const n=O1(t,i);if(n==0)return null;const a={x:e.x-r.x,y:e.y-r.y},s=O1(a,t)/n,o=O1(a,i)/n,l=r.x+o*t.x,u=e.x+s*i.x,c=r.y+o*t.y,h=e.y+s*i.y,p=(l+u)/2,v=(c+h)/2;return{x:p,y:v}};class qs{static compare(t,e){const i=qs.comparePoints(t.point,e.point);return i!==0?i:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:Rc.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}constructor(t,e){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let i=0,n=e.length;i<n;i++){const a=e[i];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const i=this.point.events[e];if(i.segment.consumedBy===void 0)for(let n=e+1;n<t;n++){const a=this.point.events[n];a.consumedBy===void 0&&i.otherSE.point.events===a.otherSE.point.events&&i.segment.consume(a.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,i=this.point.events.length;e<i;e++){const n=this.point.events[e];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}getLeftmostComparator(t){const e=new Map,i=n=>{const a=n.otherSE;e.set(n,{sine:Sct(this.point,t.point,a.point),cosine:Tct(this.point,t.point,a.point)})};return(n,a)=>{e.has(n)||i(n),e.has(a)||i(a);const{sine:s,cosine:o}=e.get(n),{sine:l,cosine:u}=e.get(a);return s>=0&&l>=0?o<u?1:o>u?-1:0:s<0&&l<0?o<u?-1:o>u?1:0:l<s?-1:l>s?1:0}}}let Cct=0;class Rc{static compare(t,e){const i=t.leftSE.point.x,n=e.leftSE.point.x,a=t.rightSE.point.x,s=e.rightSE.point.x;if(s<i)return 1;if(a<n)return-1;const o=t.leftSE.point.y,l=e.leftSE.point.y,u=t.rightSE.point.y,c=e.rightSE.point.y;if(i<n){if(l<o&&l<u)return 1;if(l>o&&l>u)return-1;const h=t.comparePoint(e.leftSE.point);if(h<0)return 1;if(h>0)return-1;const p=e.comparePoint(t.rightSE.point);return p!==0?p:-1}if(i>n){if(o<l&&o<c)return-1;if(o>l&&o>c)return 1;const h=e.comparePoint(t.leftSE.point);if(h!==0)return h;const p=t.comparePoint(e.rightSE.point);return p<0?1:p>0?-1:1}if(o<l)return-1;if(o>l)return 1;if(a<s){const h=e.comparePoint(t.rightSE.point);if(h!==0)return h}if(a>s){const h=t.comparePoint(e.rightSE.point);if(h<0)return 1;if(h>0)return-1}if(a!==s){const h=u-o,p=a-i,v=c-l,y=s-n;if(h>p&&v<y)return 1;if(h<p&&v>y)return-1}return a>s?1:a<s||u<c?-1:u>c?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,i,n){this.id=++Cct,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=i,this.windings=n}static fromRing(t,e,i){let n,a,s;const o=qs.comparePoints(t,e);if(o<0)n=t,a=e,s=1;else if(o>0)n=e,a=t,s=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const l=new qs(n,!0),u=new qs(a,!1);return new Rc(l,u,[i],[s])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const e=this.leftSE.point,i=this.rightSE.point,n=this.vector();if(e.x===i.x)return t.x===e.x?0:t.x<e.x?1:-1;const a=(t.y-e.y)/n.y,s=e.x+a*n.x;if(t.x===s)return 0;const o=(t.x-e.x)/n.x,l=e.y+o*n.y;return t.y===l?0:t.y<l?-1:1}getIntersection(t){const e=this.bbox(),i=t.bbox(),n=fI(e,i);if(n===null)return null;const a=this.leftSE.point,s=this.rightSE.point,o=t.leftSE.point,l=t.rightSE.point,u=Jv(e,o)&&this.comparePoint(o)===0,c=Jv(i,a)&&t.comparePoint(a)===0,h=Jv(e,l)&&this.comparePoint(l)===0,p=Jv(i,s)&&t.comparePoint(s)===0;if(c&&u)return p&&!h?s:!p&&h?l:null;if(c)return h&&a.x===l.x&&a.y===l.y?null:a;if(u)return p&&s.x===o.x&&s.y===o.y?null:o;if(p&&h)return null;if(p)return s;if(h)return l;const v=Act(a,this.vector(),o,t.vector());return v===null||!Jv(n,v)?null:My.round(v.x,v.y)}split(t){const e=[],i=t.events!==void 0,n=new qs(t,!0),a=new qs(t,!1),s=this.rightSE;this.replaceRightSE(a),e.push(a),e.push(n);const o=new Rc(n,s,this.rings.slice(),this.windings.slice());return qs.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),qs.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(n.checkForConsuming(),a.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,i=this.windings.length;e<i;e++)this.windings[e]*=-1}consume(t){let e=this,i=t;for(;e.consumedBy;)e=e.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const n=Rc.compare(e,i);if(n!==0){if(n>0){const a=e;e=i,i=a}if(e.prev===i){const a=e;e=i,i=a}for(let a=0,s=i.rings.length;a<s;a++){const o=i.rings[a],l=i.windings[a],u=e.rings.indexOf(o);u===-1?(e.rings.push(o),e.windings.push(l)):e.windings[u]+=l}i.rings=null,i.windings=null,i.consumedBy=e,i.leftSE.consumedBy=e.leftSE,i.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,i=this._afterState.windings,n=this._afterState.multiPolys;for(let o=0,l=this.rings.length;o<l;o++){const u=this.rings[o],c=this.windings[o],h=e.indexOf(u);h===-1?(e.push(u),i.push(c)):i[h]+=c}const a=[],s=[];for(let o=0,l=e.length;o<l;o++){if(i[o]===0)continue;const u=e[o],c=u.poly;if(s.indexOf(c)===-1)if(u.isExterior)a.push(c);else{s.indexOf(c)===-1&&s.push(c);const h=a.indexOf(u.poly);h!==-1&&a.splice(h,1)}}for(let o=0,l=a.length;o<l;o++){const u=a[o].multiPoly;n.indexOf(u)===-1&&n.push(u)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(Do.type){case"union":{const i=t.length===0,n=e.length===0;this._isInResult=i!==n;break}case"intersection":{let i,n;t.length<e.length?(i=t.length,n=e.length):(i=e.length,n=t.length),this._isInResult=n===Do.numMultiPolys&&i<n;break}case"xor":{const i=Math.abs(t.length-e.length);this._isInResult=i%2===1;break}case"difference":{const i=n=>n.length===1&&n[0].isSubject;this._isInResult=i(t)!==i(e);break}default:throw new Error(`Unrecognized operation type found ${Do.type}`)}return this._isInResult}}class IN{constructor(t,e,i){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=i,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const n=My.round(t[0][0],t[0][1]);this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};let a=n;for(let s=1,o=t.length;s<o;s++){if(typeof t[s][0]!="number"||typeof t[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let l=My.round(t[s][0],t[s][1]);l.x===a.x&&l.y===a.y||(this.segments.push(Rc.fromRing(a,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),a=l)}(n.x!==a.x||n.y!==a.y)&&this.segments.push(Rc.fromRing(a,n,this))}getSweepEvents(){const t=[];for(let e=0,i=this.segments.length;e<i;e++){const n=this.segments[e];t.push(n.leftSE),t.push(n.rightSE)}return t}}class Ect{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new IN(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,n=t.length;i<n;i++){const a=new IN(t[i],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,i=this.interiorRings.length;e<i;e++){const n=this.interiorRings[e].getSweepEvents();for(let a=0,s=n.length;a<s;a++)t.push(n[a])}return t}}class MN{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let i=0,n=t.length;i<n;i++){const a=new Ect(t[i],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const n=this.polys[e].getSweepEvents();for(let a=0,s=n.length;a<s;a++)t.push(n[a])}return t}}class Rb{static factory(t){const e=[];for(let i=0,n=t.length;i<n;i++){const a=t[i];if(!a.isInResult()||a.ringOut)continue;let s=null,o=a.leftSE,l=a.rightSE;const u=[o],c=o.point,h=[];for(;s=o,o=l,u.push(o),o.point!==c;)for(;;){const p=o.getAvailableLinkedEvents();if(p.length===0){const x=u[0].point,w=u[u.length-1].point;throw new Error(`Unable to complete output ring starting at [${x.x}, ${x.y}]. Last matching segment found ends at [${w.x}, ${w.y}].`)}if(p.length===1){l=p[0].otherSE;break}let v=null;for(let x=0,w=h.length;x<w;x++)if(h[x].point===o.point){v=x;break}if(v!==null){const x=h.splice(v)[0],w=u.splice(x.index);w.unshift(w[0].otherSE),e.push(new Rb(w.reverse()));continue}h.push({index:u.length,point:o.point});const y=o.getLeftmostComparator(s);l=p.sort(y)[0].otherSE;break}e.push(new Rb(u))}return e}constructor(t){this.events=t;for(let e=0,i=t.length;e<i;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const e=[t];for(let u=1,c=this.events.length-1;u<c;u++){const h=this.events[u].point,p=this.events[u+1].point;AN(h,t,p)!==0&&(e.push(h),t=h)}if(e.length===1)return null;const i=e[0],n=e[1];AN(i,t,n)===0&&e.shift(),e.push(e[0]);const a=this.isExteriorRing()?1:-1,s=this.isExteriorRing()?0:e.length-1,o=this.isExteriorRing()?e.length:-1,l=[];for(let u=s;u!=o;u+=a)l.push([e[u].x,e[u].y]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let n=1,a=this.events.length;n<a;n++){const s=this.events[n];qs.compare(t,s)>0&&(t=s)}let e=t.segment.prevInResult(),i=e?e.prevInResult():null;for(;;){if(!e)return null;if(!i)return e.ringOut;if(i.ringOut!==e.ringOut)return i.ringOut.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut.enclosingRing();e=i.prevInResult(),i=e?e.prevInResult():null}}}class PN{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(let e=0,i=this.interiorRings.length;e<i;e++){const n=this.interiorRings[e].getGeom();n!==null&&t.push(n)}return t}}class Ict{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const n=this.polys[e].getGeom();n!==null&&t.push(n)}return t}_composePolys(t){const e=[];for(let i=0,n=t.length;i<n;i++){const a=t[i];if(!a.poly)if(a.isExteriorRing())e.push(new PN(a));else{const s=a.enclosingRing();s.poly||e.push(new PN(s)),s.poly.addInterior(a)}}return e}}class Mct{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Rc.compare;this.queue=t,this.tree=new qP(e),this.segments=[]}process(t){const e=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),i;const n=t.isLeft?this.tree.add(e):this.tree.find(e);if(!n)throw new Error(`Unable to find segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] in SweepLine tree.`);let a=n,s=n,o,l;for(;o===void 0;)a=this.tree.prev(a),a===null?o=null:a.key.consumedBy===void 0&&(o=a.key);for(;l===void 0;)s=this.tree.next(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);if(t.isLeft){let u=null;if(o){const h=o.getIntersection(e);if(h!==null&&(e.isAnEndpoint(h)||(u=h),!o.isAnEndpoint(h))){const p=this._splitSafely(o,h);for(let v=0,y=p.length;v<y;v++)i.push(p[v])}}let c=null;if(l){const h=l.getIntersection(e);if(h!==null&&(e.isAnEndpoint(h)||(c=h),!l.isAnEndpoint(h))){const p=this._splitSafely(l,h);for(let v=0,y=p.length;v<y;v++)i.push(p[v])}}if(u!==null||c!==null){let h=null;u===null?h=c:c===null?h=u:h=qs.comparePoints(u,c)<=0?u:c,this.queue.remove(e.rightSE),i.push(e.rightSE);const p=e.split(h);for(let v=0,y=p.length;v<y;v++)i.push(p[v])}i.length>0?(this.tree.remove(e),i.push(t)):(this.segments.push(e),e.prev=o)}else{if(o&&l){const u=o.getIntersection(l);if(u!==null){if(!o.isAnEndpoint(u)){const c=this._splitSafely(o,u);for(let h=0,p=c.length;h<p;h++)i.push(c[h])}if(!l.isAnEndpoint(u)){const c=this._splitSafely(l,u);for(let h=0,p=c.length;h<p;h++)i.push(c[h])}}}this.tree.remove(e)}return i}_splitSafely(t,e){this.tree.remove(t);const i=t.rightSE;this.queue.remove(i);const n=t.split(e);return n.push(i),t.consumedBy===void 0&&this.tree.add(t),n}}const RN=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Pct=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Rct{run(t,e,i){Do.type=t,My.reset();const n=[new MN(e,!0)];for(let h=0,p=i.length;h<p;h++)n.push(new MN(i[h],!1));if(Do.numMultiPolys=n.length,Do.type==="difference"){const h=n[0];let p=1;for(;p<n.length;)fI(n[p].bbox,h.bbox)!==null?p++:n.splice(p,1)}if(Do.type==="intersection")for(let h=0,p=n.length;h<p;h++){const v=n[h];for(let y=h+1,x=n.length;y<x;y++)if(fI(v.bbox,n[y].bbox)===null)return[]}const a=new qP(qs.compare);for(let h=0,p=n.length;h<p;h++){const v=n[h].getSweepEvents();for(let y=0,x=v.length;y<x;y++)if(a.insert(v[y]),a.size>RN)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const s=new Mct(a);let o=a.size,l=a.pop();for(;l;){const h=l.key;if(a.size===o){const v=h.segment;throw new Error(`Unable to pop() ${h.isLeft?"left":"right"} SweepEvent [${h.point.x}, ${h.point.y}] from segment #${v.id} [${v.leftSE.point.x}, ${v.leftSE.point.y}] -> [${v.rightSE.point.x}, ${v.rightSE.point.y}] from queue.`)}if(a.size>RN)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(s.segments.length>Pct)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const p=s.process(h);for(let v=0,y=p.length;v<y;v++){const x=p[v];x.consumedBy===void 0&&a.insert(x)}o=a.size,l=a.pop()}My.reset();const u=Rb.factory(s.segments);return new Ict(u).getGeom()}}const Do=new Rct,Dct=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return Do.run("union",r,e)},Lct=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return Do.run("intersection",r,e)},kct=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return Do.run("xor",r,e)},Oct=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return Do.run("difference",r,e)};var Nct={union:Dct,intersection:Lct,xor:kct,difference:Oct};function Fct(r,t){var e,i,n,a,s,o,l,u,c,h,p=0,v=r.type==="FeatureCollection",y=r.type==="Feature",x=v?r.features.length:1;for(e=0;e<x;e++){for(o=v?r.features[e].geometry:y?r.geometry:r,u=v?r.features[e].properties:y?r.properties:{},c=v?r.features[e].bbox:y?r.bbox:void 0,h=v?r.features[e].id:y?r.id:void 0,l=o?o.type==="GeometryCollection":!1,s=l?o.geometries.length:1,n=0;n<s;n++){if(a=l?o.geometries[n]:o,a===null){if(t(null,p,u,c,h)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(a,p,u,c,h)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<a.geometries.length;i++)if(t(a.geometries[i],p,u,c,h)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}p++}}function Bct(r,t={}){const e=[];if(Fct(r,n=>{e.push(n.coordinates)}),e.length<2)throw new Error("Must have at least 2 geometries");const i=Nct.union(e[0],...e.slice(1));return i.length===0?null:i.length===1?b_(i[0],t.properties):lS(i,t.properties)}var DN=Bct;const zct=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,Vct=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Uct=1024,$ct=4,LN=()=>{},kN={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Wct={x:0,y:0,width:0,height:0};function Hct(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function Gct(r,t,e,i){const n=Math.min(e/t.width,i/t.height),a=Math.floor(t.width*n),s=Math.floor(t.height*n);return n===1?{data:t,width:a,height:s}:(r.canvas.height=s,r.canvas.width=a,r.clearRect(0,0,a,s),r.drawImage(t,0,0,t.width,t.height,0,0,a,s),{data:r.canvas,width:a,height:s})}function Py(r){return r&&(r.id||r.url)}function jct(r,t,e,i){const{width:n,height:a,device:s}=r,o=s.createTexture({format:"rgba8unorm",width:t,height:e,sampler:i}),l=s.createCommandEncoder();return l.copyTextureToTexture({source:r,destination:o,width:n,height:a}),l.finish(),r.destroy(),o}function ON(r,t,e){for(let i=0;i<t.length;i++){const{icon:n,xOffset:a}=t[i],s=Py(n);r[s]={...n,x:a,y:e}}}function Xct({icons:r,buffer:t,mapping:e={},xOffset:i=0,yOffset:n=0,rowHeight:a=0,canvasWidth:s}){let o=[];for(let l=0;l<r.length;l++){const u=r[l],c=Py(u);if(!e[c]){const{height:h,width:p}=u;i+p+t>s&&(ON(e,o,n),i=0,n=a+n+t,a=0,o=[]),o.push({icon:u,xOffset:i}),i=i+p+t,a=Math.max(a,h)}}return o.length>0&&ON(e,o,n),{mapping:e,rowHeight:a,xOffset:i,yOffset:n,canvasWidth:s,canvasHeight:Hct(a+n+t)}}function Zct(r,t,e){if(!r||!t)return null;e=e||{};const i={},{iterable:n,objectInfo:a}=oS(r);for(const s of n){a.index++;const o=t(s,a),l=Py(o);if(!o)throw new Error("Icon is missing.");if(!o.url)throw new Error("Icon url is missing.");!i[l]&&(!e[l]||o.url!==e[l].url)&&(i[l]={...o,source:s,sourceIndex:a.index})}return i}class qct{constructor(t,{onUpdate:e=LN,onError:i=LN}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=$ct,this._canvasWidth=Uct,this._canvasHeight=0,this._canvas=null,this.device=t,this.onUpdate=e,this.onError=i}finalize(){var t;(t=this._texture)==null||t.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const e=this._autoPacking?Py(t):t;return this._mapping[e]||Wct}setProps({loadOptions:t,autoPacking:e,iconAtlas:i,iconMapping:n,textureParameters:a}){var s;t&&(this._loadOptions=t),e!==void 0&&(this._autoPacking=e),n&&(this._mapping=n),i&&((s=this._texture)==null||s.delete(),this._texture=null,this._externalTexture=i),a&&(this._textureParameters=a)}get isLoaded(){return this._pendingCount===0}packIcons(t,e){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(Zct(t,e,this._mapping)||{});if(i.length>0){const{mapping:n,xOffset:a,yOffset:s,rowHeight:o,canvasHeight:l}=Xct({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=o,this._mapping=n,this._xOffset=a,this._yOffset=s,this._canvasHeight=l,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||kN})),this._texture.height!==this._canvasHeight&&(this._texture=jct(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||kN)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(t){const e=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of t)this._pendingCount++,fb(i.url,this._loadOptions).then(n=>{const a=Py(i),s=this._mapping[a],{x:o,y:l,width:u,height:c}=s,{data:h,width:p,height:v}=Gct(e,n,u,c);this._texture.setSubImageData({data:h,x:o+(u-p)/2,y:l+(c-v)/2,width:p,height:v}),s.width=p,s.height=v,this._texture.generateMipmap(),this.onUpdate()}).catch(n=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:n})}).finally(()=>{this._pendingCount--})}}const q$=[0,0,0,255],Yct={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:r=>r.position},getIcon:{type:"accessor",value:r=>r.icon},getColor:{type:"accessor",value:q$},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class YP extends Tg{getShaders(){return super.getShaders({vs:zct,fs:Vct,modules:[y_,__]})}initializeState(){this.state={iconManager:new qct(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:q$},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){var v;super.updateState(t);const{props:e,oldProps:i,changeFlags:n}=t,a=this.getAttributeManager(),{iconAtlas:s,iconMapping:o,data:l,getIcon:u,textureParameters:c}=e,{iconManager:h}=this.state;if(typeof s=="string")return;const p=s||this.internalState.isAsyncPropLoading("iconAtlas");h.setProps({loadOptions:e.loadOptions,autoPacking:!p,iconAtlas:s,iconMapping:p?o:null,textureParameters:c}),p?i.iconMapping!==e.iconMapping&&a.invalidate("getIcon"):(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&h.packIcons(l,u),n.extensionsChanged&&((v=this.state.model)==null||v.destroy(),this.state.model=this._getModel(),a.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:e,sizeMinPixels:i,sizeMaxPixels:n,sizeUnits:a,billboard:s,alphaCutoff:o}=this.props,{iconManager:l}=this.state,u=l.getTexture();if(u){const c=this.state.model;c.setBindings({iconsTexture:u}),c.setUniforms(t),c.setUniforms({iconsTextureDim:[u.width,u.height],sizeUnits:Nf[a],sizeScale:e,sizeMinPixels:i,sizeMaxPixels:n,billboard:s,alphaCutoff:o}),c.draw(this.context.renderPass)}}_getModel(){const t=[-1,-1,1,-1,-1,1,1,1];return new au(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new hg({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){var i;const e=(i=this.getCurrentLayer())==null?void 0:i.props.onIconError;e?e(t):Wr.error(t.error.message)()}getInstanceOffset(t){const{width:e,height:i,anchorX:n=e/2,anchorY:a=i/2}=this.state.iconManager.getIconMapping(t);return[e/2-n,i/2-a]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const{x:e,y:i,width:n,height:a}=this.state.iconManager.getIconMapping(t);return[e,i,n,a]}}YP.defaultProps=Yct;YP.layerName="IconLayer";const Y$=YP,Kct=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Jct=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,NN=[0,0,0,255],Qct={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:r=>r.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:NN},getLineColor:{type:"accessor",value:NN},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class KP extends Tg{getShaders(){return super.getShaders({vs:Kct,fs:Jct,modules:[y_,__]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){var e;super.updateState(t),t.changeFlags.extensionsChanged&&((e=this.state.model)==null||e.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{radiusUnits:e,radiusScale:i,radiusMinPixels:n,radiusMaxPixels:a,stroked:s,filled:o,billboard:l,antialiasing:u,lineWidthUnits:c,lineWidthScale:h,lineWidthMinPixels:p,lineWidthMaxPixels:v}=this.props,y=this.state.model;y.setUniforms(t),y.setUniforms({stroked:s?1:0,filled:o,billboard:l,antialiasing:u,radiusUnits:Nf[e],radiusScale:i,radiusMinPixels:n,radiusMaxPixels:a,lineWidthUnits:Nf[c],lineWidthScale:h,lineWidthMinPixels:p,lineWidthMaxPixels:v}),y.draw(this.context.renderPass)}_getModel(){const t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new au(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new hg({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}KP.defaultProps=Qct;KP.layerName="ScatterplotLayer";const tht=KP,K$={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function J$(r,t,e={}){return eht(r,e)!==t?(rht(r,e),!0):!1}function eht(r,t={}){return Math.sign(Lb(r,t))}const Db={x:0,y:1,z:2};function Lb(r,t={}){const{start:e=0,end:i=r.length,plane:n="xy"}=t,a=t.size||2;let s=0;const o=Db[n[0]],l=Db[n[1]];for(let u=e,c=i-a;u<i;u+=a)s+=(r[u+o]-r[c+o])*(r[u+l]+r[c+l]),c=u;return s/2}function rht(r,t){const{start:e=0,end:i=r.length,size:n=2}=t,a=(i-e)/n,s=Math.floor(a/2);for(let o=0;o<s;++o){const l=e+o*n,u=e+(a-1-o)*n;for(let c=0;c<n;++c){const h=r[l+c];r[l+c]=r[u+c],r[u+c]=h}}}function iht(r,t,e=2,i,n="xy"){const a=t&&t.length,s=a?t[0]*e:r.length;let o=Q$(r,0,s,e,!0,i&&i[0],n);const l=[];if(!o||o.next===o.prev)return l;let u,c,h,p,v,y,x;if(a&&(o=lht(r,t,o,e,i,n)),r.length>80*e){p=c=r[0],v=h=r[1];for(let w=e;w<s;w+=e)y=r[w],x=r[w+1],y<p&&(p=y),x<v&&(v=x),y>c&&(c=y),x>h&&(h=x);u=Math.max(c-p,h-v),u=u!==0?32767/u:0}return Ry(o,l,e,p,v,u,0),l}function Q$(r,t,e,i,n,a,s){let o,l;a===void 0&&(a=Lb(r,{start:t,end:e,size:i,plane:s}));let u=Db[s[0]],c=Db[s[1]];if(n===a<0)for(o=t;o<e;o+=i)l=FN(o,r[o+u],r[o+c],l);else for(o=e-i;o>=t;o-=i)l=FN(o,r[o+u],r[o+c],l);return l&&uS(l,l.next)&&(Ly(l),l=l.next),l}function zf(r,t){if(!r)return r;t||(t=r);let e=r,i;do if(i=!1,!e.steiner&&(uS(e,e.next)||Zi(e.prev,e,e.next)===0)){if(Ly(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Ry(r,t,e,i,n,a,s){if(!r)return;!s&&a&&dht(r,i,n,a);let o=r,l,u;for(;r.prev!==r.next;){if(l=r.prev,u=r.next,a?aht(r,i,n,a):nht(r)){t.push(l.i/e|0),t.push(r.i/e|0),t.push(u.i/e|0),Ly(r),r=u.next,o=u.next;continue}if(r=u,r===o){s?s===1?(r=sht(zf(r),t,e),Ry(r,t,e,i,n,a,2)):s===2&&oht(r,t,e,i,n,a):Ry(zf(r),t,e,i,n,a,1);break}}}function nht(r){const t=r.prev,e=r,i=r.next;if(Zi(t,e,i)>=0)return!1;const n=t.x,a=e.x,s=i.x,o=t.y,l=e.y,u=i.y,c=n<a?n<s?n:s:a<s?a:s,h=o<l?o<u?o:u:l<u?l:u,p=n>a?n>s?n:s:a>s?a:s,v=o>l?o>u?o:u:l>u?l:u;let y=i.next;for(;y!==t;){if(y.x>=c&&y.x<=p&&y.y>=h&&y.y<=v&&Op(n,o,a,l,s,u,y.x,y.y)&&Zi(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function aht(r,t,e,i){const n=r.prev,a=r,s=r.next;if(Zi(n,a,s)>=0)return!1;const o=n.x,l=a.x,u=s.x,c=n.y,h=a.y,p=s.y,v=o<l?o<u?o:u:l<u?l:u,y=c<h?c<p?c:p:h<p?h:p,x=o>l?o>u?o:u:l>u?l:u,w=c>h?c>p?c:p:h>p?h:p,T=dI(v,y,t,e,i),E=dI(x,w,t,e,i);let M=r.prevZ,L=r.nextZ;for(;M&&M.z>=T&&L&&L.z<=E;){if(M.x>=v&&M.x<=x&&M.y>=y&&M.y<=w&&M!==n&&M!==s&&Op(o,c,l,h,u,p,M.x,M.y)&&Zi(M.prev,M,M.next)>=0||(M=M.prevZ,L.x>=v&&L.x<=x&&L.y>=y&&L.y<=w&&L!==n&&L!==s&&Op(o,c,l,h,u,p,L.x,L.y)&&Zi(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;M&&M.z>=T;){if(M.x>=v&&M.x<=x&&M.y>=y&&M.y<=w&&M!==n&&M!==s&&Op(o,c,l,h,u,p,M.x,M.y)&&Zi(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;L&&L.z<=E;){if(L.x>=v&&L.x<=x&&L.y>=y&&L.y<=w&&L!==n&&L!==s&&Op(o,c,l,h,u,p,L.x,L.y)&&Zi(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function sht(r,t,e){let i=r;do{const n=i.prev,a=i.next.next;!uS(n,a)&&tW(n,i,i.next,a)&&Dy(n,a)&&Dy(a,n)&&(t.push(n.i/e|0),t.push(i.i/e|0),t.push(a.i/e|0),Ly(i),Ly(i.next),i=r=a),i=i.next}while(i!==r);return zf(i)}function oht(r,t,e,i,n,a){let s=r;do{let o=s.next.next;for(;o!==s.prev;){if(s.i!==o.i&&vht(s,o)){let l=eW(s,o);s=zf(s,s.next),l=zf(l,l.next),Ry(s,t,e,i,n,a,0),Ry(l,t,e,i,n,a,0);return}o=o.next}s=s.next}while(s!==r)}function lht(r,t,e,i,n,a){const s=[];let o,l,u,c,h;for(o=0,l=t.length;o<l;o++)u=t[o]*i,c=o<l-1?t[o+1]*i:r.length,h=Q$(r,u,c,i,!1,n&&n[o+1],a),h===h.next&&(h.steiner=!0),s.push(ght(h));for(s.sort(uht),o=0;o<s.length;o++)e=cht(s[o],e);return e}function uht(r,t){return r.x-t.x}function cht(r,t){const e=hht(r,t);if(!e)return t;const i=eW(e,r);return zf(i,i.next),zf(e,e.next)}function hht(r,t){let e=t;const i=r.x,n=r.y;let a=-1/0,s;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){const p=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(p<=i&&p>a&&(a=p,s=e.x<e.next.x?e:e.next,p===i))return s}e=e.next}while(e!==t);if(!s)return null;const o=s,l=s.x,u=s.y;let c=1/0,h;e=s;do i>=e.x&&e.x>=l&&i!==e.x&&Op(n<u?i:a,n,l,u,n<u?a:i,n,e.x,e.y)&&(h=Math.abs(n-e.y)/(i-e.x),Dy(e,r)&&(h<c||h===c&&(e.x>s.x||e.x===s.x&&fht(s,e)))&&(s=e,c=h)),e=e.next;while(e!==o);return s}function fht(r,t){return Zi(r.prev,r,t.prev)<0&&Zi(t.next,r,r.next)<0}function dht(r,t,e,i){let n=r;do n.z===0&&(n.z=dI(n.x,n.y,t,e,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,pht(n)}function pht(r){let t,e,i=1,n,a,s,o,l,u;do{for(a=r,r=null,u=null,n=0;a;){for(n++,o=a,s=0,e=0;e<i&&(s++,o=o.nextZ,!!o);e++);for(l=i;s>0||l>0&&o;)s!==0&&(l===0||!o||a.z<=o.z)?(t=a,a=a.nextZ,s--):(t=o,o=o.nextZ,l--),u?u.nextZ=t:r=t,t.prevZ=u,u=t;a=o}u.nextZ=null,i*=2}while(n>1);return r}function dI(r,t,e,i,n){return r=(r-e)*n|0,t=(t-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function ght(r){let t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Op(r,t,e,i,n,a,s,o){return(n-s)*(t-o)>=(r-s)*(a-o)&&(r-s)*(i-o)>=(e-s)*(t-o)&&(e-s)*(a-o)>=(n-s)*(i-o)}function vht(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!mht(r,t)&&(Dy(r,t)&&Dy(t,r)&&yht(r,t)&&(Zi(r.prev,r,t.prev)||Zi(r,t.prev,t))||uS(r,t)&&Zi(r.prev,r,r.next)>0&&Zi(t.prev,t,t.next)>0)}function Zi(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function uS(r,t){return r.x===t.x&&r.y===t.y}function tW(r,t,e,i){const n=fx(Zi(r,t,e)),a=fx(Zi(r,t,i)),s=fx(Zi(e,i,r)),o=fx(Zi(e,i,t));return!!(n!==a&&s!==o||n===0&&hx(r,e,t)||a===0&&hx(r,i,t)||s===0&&hx(e,r,i)||o===0&&hx(e,t,i))}function hx(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function fx(r){return r>0?1:r<0?-1:0}function mht(r,t){let e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&tW(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Dy(r,t){return Zi(r.prev,r,r.next)<0?Zi(r,t,r.next)>=0&&Zi(r,r.prev,t)>=0:Zi(r,t,r.prev)<0||Zi(r,r.next,t)<0}function yht(r,t){let e=r,i=!1;const n=(r.x+t.x)/2,a=(r.y+t.y)/2;do e.y>a!=e.next.y>a&&e.next.y!==e.y&&n<(e.next.x-e.x)*(a-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function eW(r,t){const e=new pI(r.i,r.x,r.y),i=new pI(t.i,t.x,t.y),n=r.next,a=t.prev;return r.next=t,t.prev=r,e.next=n,n.prev=e,i.next=e,e.prev=i,a.next=i,i.prev=a,i}function FN(r,t,e,i){const n=new pI(r,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Ly(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}class pI{constructor(t,e,i){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=i}}function Lo(r,t){const e=t.length,i=r.length;if(i>0){let n=!0;for(let a=0;a<e;a++)if(r[i-e+a]!==t[a]){n=!1;break}if(n)return!1}for(let n=0;n<e;n++)r[i+n]=t[n];return!0}function gI(r,t){const e=t.length;for(let i=0;i<e;i++)r[i]=t[i]}function ky(r,t,e,i,n=[]){const a=i+t*e;for(let s=0;s<e;s++)n[s]=r[a+s];return n}function vI(r,t,e,i,n=[]){let a,s;if(e&8)a=(i[3]-r[1])/(t[1]-r[1]),s=3;else if(e&4)a=(i[1]-r[1])/(t[1]-r[1]),s=1;else if(e&2)a=(i[2]-r[0])/(t[0]-r[0]),s=2;else if(e&1)a=(i[0]-r[0])/(t[0]-r[0]),s=0;else return null;for(let o=0;o<r.length;o++)n[o]=(s&1)===o?i[s]:a*(t[o]-r[o])+r[o];return n}function N1(r,t){let e=0;return r[0]<t[0]?e|=1:r[0]>t[2]&&(e|=2),r[1]<t[1]?e|=4:r[1]>t[3]&&(e|=8),e}function rW(r,t){const{size:e=2,broken:i=!1,gridResolution:n=10,gridOffset:a=[0,0],startIndex:s=0,endIndex:o=r.length}=t||{},l=(o-s)/e;let u=[];const c=[u],h=ky(r,0,e,s);let p,v;const y=nW(h,n,a,[]),x=[];Lo(u,h);for(let w=1;w<l;w++){for(p=ky(r,w,e,s,p),v=N1(p,y);v;){vI(h,p,v,y,x);const T=N1(x,y);T&&(vI(h,x,T,y,x),v=T),Lo(u,x),gI(h,x),xht(y,n,v),i&&u.length>e&&(u=[],c.push(u),Lo(u,h)),v=N1(p,y)}Lo(u,p),gI(h,p)}return i?c:c[0]}const BN=0,_ht=1;function iW(r,t=null,e){if(!r.length)return[];const{size:i=2,gridResolution:n=10,gridOffset:a=[0,0],edgeTypes:s=!1}=e||{},o=[],l=[{pos:r,types:s?new Array(r.length/i).fill(_ht):null,holes:t||[]}],u=[[],[]];let c=[];for(;l.length;){const{pos:h,types:p,holes:v}=l.shift();bht(h,i,v[0]||h.length,u),c=nW(u[0],n,a,c);const y=N1(u[1],c);if(y){let x=zN(h,p,i,0,v[0]||h.length,c,y);const w={pos:x[0].pos,types:x[0].types,holes:[]},T={pos:x[1].pos,types:x[1].types,holes:[]};l.push(w,T);for(let E=0;E<v.length;E++)x=zN(h,p,i,v[E],v[E+1]||h.length,c,y),x[0]&&(w.holes.push(w.pos.length),w.pos=dx(w.pos,x[0].pos),s&&(w.types=dx(w.types,x[0].types))),x[1]&&(T.holes.push(T.pos.length),T.pos=dx(T.pos,x[1].pos),s&&(T.types=dx(T.types,x[1].types)))}else{const x={positions:h};s&&(x.edgeTypes=p),v.length&&(x.holeIndices=v),o.push(x)}}return o}function zN(r,t,e,i,n,a,s){const o=(n-i)/e,l=[],u=[],c=[],h=[],p=[];let v,y,x;const w=ky(r,o-1,e,i);let T=Math.sign(s&8?w[1]-a[3]:w[0]-a[2]),E=t&&t[o-1],M=0,L=0;for(let F=0;F<o;F++)v=ky(r,F,e,i,v),y=Math.sign(s&8?v[1]-a[3]:v[0]-a[2]),x=t&&t[i/e+F],y&&T&&T!==y&&(vI(w,v,s,a,p),Lo(l,p)&&c.push(E),Lo(u,p)&&h.push(E)),y<=0?(Lo(l,v)&&c.push(x),M-=y):c.length&&(c[c.length-1]=BN),y>=0?(Lo(u,v)&&h.push(x),L+=y):h.length&&(h[h.length-1]=BN),gI(w,v),T=y,E=x;return[M?{pos:l,types:t&&c}:null,L?{pos:u,types:t&&h}:null]}function nW(r,t,e,i){const n=Math.floor((r[0]-e[0])/t)*t+e[0],a=Math.floor((r[1]-e[1])/t)*t+e[1];return i[0]=n,i[1]=a,i[2]=n+t,i[3]=a+t,i}function xht(r,t,e){e&8?(r[1]+=t,r[3]+=t):e&4?(r[1]-=t,r[3]-=t):e&2?(r[0]+=t,r[2]+=t):e&1&&(r[0]-=t,r[2]-=t)}function bht(r,t,e,i){let n=1/0,a=-1/0,s=1/0,o=-1/0;for(let l=0;l<e;l+=t){const u=r[l],c=r[l+1];n=u<n?u:n,a=u>a?u:a,s=c<s?c:s,o=c>o?c:o}return i[0][0]=n,i[0][1]=s,i[1][0]=a,i[1][1]=o,i}function dx(r,t){for(let e=0;e<t.length;e++)r.push(t[e]);return r}const wht=85.051129;function Sht(r,t){const{size:e=2,startIndex:i=0,endIndex:n=r.length,normalize:a=!0}=t||{},s=r.slice(i,n);aW(s,e,0,n-i);const o=rW(s,{size:e,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(a)for(const l of o)sW(l,e);return o}function Tht(r,t=null,e){const{size:i=2,normalize:n=!0,edgeTypes:a=!1}=e||{};t=t||[];const s=[],o=[];let l=0,u=0;for(let h=0;h<=t.length;h++){const p=t[h]||r.length,v=u,y=Aht(r,i,l,p);for(let x=y;x<p;x++)s[u++]=r[x];for(let x=l;x<y;x++)s[u++]=r[x];aW(s,i,v,u),Cht(s,i,v,u,e==null?void 0:e.maxLatitude),l=p,o[h]=u}o.pop();const c=iW(s,o,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:a});if(n)for(const h of c)sW(h.positions,i);return c}function Aht(r,t,e,i){let n=-1,a=-1;for(let s=e+1;s<i;s+=t){const o=Math.abs(r[s]);o>n&&(n=o,a=s-1)}return a}function Cht(r,t,e,i,n=wht){const a=r[e],s=r[i-t];if(Math.abs(a-s)>180){const o=ky(r,0,t,e);o[0]+=Math.round((s-a)/360)*360,Lo(r,o),o[1]=Math.sign(o[1])*n,Lo(r,o),o[0]=a,Lo(r,o)}}function aW(r,t,e,i){let n=r[0],a;for(let s=e;s<i;s+=t){a=r[s];const o=a-n;(o>180||o<-180)&&(a-=Math.round(o/360)*360),r[s]=n=a}}function sW(r,t){let e;const i=r.length/t;for(let a=0;a<i&&(e=r[a*t],(e+180)%360===0);a++);const n=-Math.round(e/360)*360;if(n!==0)for(let a=0;a<i;a++)r[a*t]+=n}function Eht(r,t,e,i){let n;if(Array.isArray(r[0])){const a=r.length*t;n=new Array(a);for(let s=0;s<r.length;s++)for(let o=0;o<t;o++)n[s*t+o]=r[s][o]||0}else n=r;return e?rW(n,{size:t,gridResolution:e}):i?Sht(n,{size:t}):n}const Iht=1,Mht=2,zA=4;class Pht extends X${constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?Eht(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(VN(t)){let i=0;for(const n of t)i+=this.getGeometrySize(n);return i}const e=this.getPathLength(t);return e<2?0:this.isClosed(t)?e<3?0:e+2:e}updateGeometryAttributes(t,e){if(e.geometrySize!==0)if(t&&VN(t))for(const i of t){const n=this.getGeometrySize(i);e.geometrySize=n,this.updateGeometryAttributes(i,e),e.vertexStart+=n}else this._updateSegmentTypes(t,e),this._updatePositions(t,e)}_updateSegmentTypes(t,e){const i=this.attributes.segmentTypes,n=t?this.isClosed(t):!1,{vertexStart:a,geometrySize:s}=e;i.fill(0,a,a+s),n?(i[a]=zA,i[a+s-2]=zA):(i[a]+=Iht,i[a+s-2]+=Mht),i[a+s-1]=zA}_updatePositions(t,e){const{positions:i}=this.attributes;if(!i||!t)return;const{vertexStart:n,geometrySize:a}=e,s=new Array(3);for(let o=n,l=0;l<a;o++,l++)this.getPointOnPath(t,l,s),i[o*3]=s[0],i[o*3+1]=s[1],i[o*3+2]=s[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,e,i=[]){const{positionSize:n}=this;e*n>=t.length&&(e+=1-t.length/n);const a=e*n;return i[0]=t[a],i[1]=t[a+1],i[2]=n===3&&t[a+2]||0,i}isClosed(t){if(!this.normalize)return!!this.opts.loop;const{positionSize:e}=this,i=t.length-e;return t[0]===t[i]&&t[1]===t[i+1]&&(e===2||t[2]===t[i+2])}}function VN(r){return Array.isArray(r[0])}const Rht=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Dht=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,oW=[0,0,0,255],Lht={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:r=>r.path},getColor:{type:"accessor",value:oW},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},VA={enter:(r,t)=>t.length?t.subarray(t.length-r.length):r};class JP extends Tg{getShaders(){return super.getShaders({vs:Rht,fs:Dht,modules:[y_,__]})}get wrapLongitude(){return!1}getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:VA,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:VA,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:VA,defaultValue:oW},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:n,target:a})=>this.encodePickingColor(i&&i.__source?i.__source.index:n,a)}}),this.setState({pathTesselator:new Pht({fp64:this.use64bitPositions()})})}updateState(t){var s;super.updateState(t);const{props:e,changeFlags:i}=t,n=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:o}=this.state,l=e.data.attributes||{};o.updateGeometry({data:e.data,geometryBuffer:l.getPath,buffers:l,normalize:!e._pathType,loop:e._pathType==="loop",getGeometry:e.getPath,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),i.dataChanged||n.invalidateAll()}i.extensionsChanged&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),n.invalidateAll())}getPickingInfo(t){const e=super.getPickingInfo(t),{index:i}=e,n=this.props.data;return n[0]&&n[0].__source&&(e.object=n.find(a=>a.__source.index===i)),e}disablePickingIndex(t){const e=this.props.data;if(e[0]&&e[0].__source)for(let i=0;i<e.length;i++)e[i].__source.index===t&&this._disablePickingIndex(i);else super.disablePickingIndex(t)}draw({uniforms:t}){const{jointRounded:e,capRounded:i,billboard:n,miterLimit:a,widthUnits:s,widthScale:o,widthMinPixels:l,widthMaxPixels:u}=this.props,c=this.state.model;c.setUniforms(t),c.setUniforms({jointType:Number(e),capType:Number(i),billboard:n,widthUnits:Nf[s],widthScale:o,miterLimit:a,widthMinPixels:l,widthMaxPixels:u}),c.draw(this.context.renderPass)}_getModel(){const t=[0,1,2,1,4,2,1,3,4,3,5,4],e=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new au(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new hg({topology:"triangle-list",attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(e),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateSegmentTypes(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("segmentTypes")}}JP.defaultProps=Lht;JP.layerName="PathLayer";const kht=JP;var QP={exports:{}};QP.exports=cS;QP.exports.default=cS;function cS(r,t,e){e=e||2;var i=t&&t.length,n=i?t[0]*e:r.length,a=lW(r,0,n,e,!0),s=[];if(!a||a.next===a.prev)return s;var o,l,u,c,h,p,v;if(i&&(a=zht(r,t,a,e)),r.length>80*e){o=u=r[0],l=c=r[1];for(var y=e;y<n;y+=e)h=r[y],p=r[y+1],h<o&&(o=h),p<l&&(l=p),h>u&&(u=h),p>c&&(c=p);v=Math.max(u-o,c-l),v=v!==0?32767/v:0}return Oy(a,s,e,o,l,v,0),s}function lW(r,t,e,i,n){var a,s;if(n===_I(r,t,e,i)>0)for(a=t;a<e;a+=i)s=UN(a,r[a],r[a+1],s);else for(a=e-i;a>=t;a-=i)s=UN(a,r[a],r[a+1],s);return s&&hS(s,s.next)&&(Fy(s),s=s.next),s}function Vf(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(hS(e,e.next)||qi(e.prev,e,e.next)===0)){if(Fy(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Oy(r,t,e,i,n,a,s){if(r){!s&&a&&Hht(r,i,n,a);for(var o=r,l,u;r.prev!==r.next;){if(l=r.prev,u=r.next,a?Nht(r,i,n,a):Oht(r)){t.push(l.i/e|0),t.push(r.i/e|0),t.push(u.i/e|0),Fy(r),r=u.next,o=u.next;continue}if(r=u,r===o){s?s===1?(r=Fht(Vf(r),t,e),Oy(r,t,e,i,n,a,2)):s===2&&Bht(r,t,e,i,n,a):Oy(Vf(r),t,e,i,n,a,1);break}}}}function Oht(r){var t=r.prev,e=r,i=r.next;if(qi(t,e,i)>=0)return!1;for(var n=t.x,a=e.x,s=i.x,o=t.y,l=e.y,u=i.y,c=n<a?n<s?n:s:a<s?a:s,h=o<l?o<u?o:u:l<u?l:u,p=n>a?n>s?n:s:a>s?a:s,v=o>l?o>u?o:u:l>u?l:u,y=i.next;y!==t;){if(y.x>=c&&y.x<=p&&y.y>=h&&y.y<=v&&Np(n,o,a,l,s,u,y.x,y.y)&&qi(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Nht(r,t,e,i){var n=r.prev,a=r,s=r.next;if(qi(n,a,s)>=0)return!1;for(var o=n.x,l=a.x,u=s.x,c=n.y,h=a.y,p=s.y,v=o<l?o<u?o:u:l<u?l:u,y=c<h?c<p?c:p:h<p?h:p,x=o>l?o>u?o:u:l>u?l:u,w=c>h?c>p?c:p:h>p?h:p,T=mI(v,y,t,e,i),E=mI(x,w,t,e,i),M=r.prevZ,L=r.nextZ;M&&M.z>=T&&L&&L.z<=E;){if(M.x>=v&&M.x<=x&&M.y>=y&&M.y<=w&&M!==n&&M!==s&&Np(o,c,l,h,u,p,M.x,M.y)&&qi(M.prev,M,M.next)>=0||(M=M.prevZ,L.x>=v&&L.x<=x&&L.y>=y&&L.y<=w&&L!==n&&L!==s&&Np(o,c,l,h,u,p,L.x,L.y)&&qi(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;M&&M.z>=T;){if(M.x>=v&&M.x<=x&&M.y>=y&&M.y<=w&&M!==n&&M!==s&&Np(o,c,l,h,u,p,M.x,M.y)&&qi(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;L&&L.z<=E;){if(L.x>=v&&L.x<=x&&L.y>=y&&L.y<=w&&L!==n&&L!==s&&Np(o,c,l,h,u,p,L.x,L.y)&&qi(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function Fht(r,t,e){var i=r;do{var n=i.prev,a=i.next.next;!hS(n,a)&&uW(n,i,i.next,a)&&Ny(n,a)&&Ny(a,n)&&(t.push(n.i/e|0),t.push(i.i/e|0),t.push(a.i/e|0),Fy(i),Fy(i.next),i=r=a),i=i.next}while(i!==r);return Vf(i)}function Bht(r,t,e,i,n,a){var s=r;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&Xht(s,o)){var l=cW(s,o);s=Vf(s,s.next),l=Vf(l,l.next),Oy(s,t,e,i,n,a,0),Oy(l,t,e,i,n,a,0);return}o=o.next}s=s.next}while(s!==r)}function zht(r,t,e,i){var n=[],a,s,o,l,u;for(a=0,s=t.length;a<s;a++)o=t[a]*i,l=a<s-1?t[a+1]*i:r.length,u=lW(r,o,l,i,!1),u===u.next&&(u.steiner=!0),n.push(jht(u));for(n.sort(Vht),a=0;a<n.length;a++)e=Uht(n[a],e);return e}function Vht(r,t){return r.x-t.x}function Uht(r,t){var e=$ht(r,t);if(!e)return t;var i=cW(e,r);return Vf(i,i.next),Vf(e,e.next)}function $ht(r,t){var e=t,i=r.x,n=r.y,a=-1/0,s;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var o=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(o<=i&&o>a&&(a=o,s=e.x<e.next.x?e:e.next,o===i))return s}e=e.next}while(e!==t);if(!s)return null;var l=s,u=s.x,c=s.y,h=1/0,p;e=s;do i>=e.x&&e.x>=u&&i!==e.x&&Np(n<c?i:a,n,u,c,n<c?a:i,n,e.x,e.y)&&(p=Math.abs(n-e.y)/(i-e.x),Ny(e,r)&&(p<h||p===h&&(e.x>s.x||e.x===s.x&&Wht(s,e)))&&(s=e,h=p)),e=e.next;while(e!==l);return s}function Wht(r,t){return qi(r.prev,r,t.prev)<0&&qi(t.next,r,r.next)<0}function Hht(r,t,e,i){var n=r;do n.z===0&&(n.z=mI(n.x,n.y,t,e,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,Ght(n)}function Ght(r){var t,e,i,n,a,s,o,l,u=1;do{for(e=r,r=null,a=null,s=0;e;){for(s++,i=e,o=0,t=0;t<u&&(o++,i=i.nextZ,!!i);t++);for(l=u;o>0||l>0&&i;)o!==0&&(l===0||!i||e.z<=i.z)?(n=e,e=e.nextZ,o--):(n=i,i=i.nextZ,l--),a?a.nextZ=n:r=n,n.prevZ=a,a=n;e=i}a.nextZ=null,u*=2}while(s>1);return r}function mI(r,t,e,i,n){return r=(r-e)*n|0,t=(t-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function jht(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Np(r,t,e,i,n,a,s,o){return(n-s)*(t-o)>=(r-s)*(a-o)&&(r-s)*(i-o)>=(e-s)*(t-o)&&(e-s)*(a-o)>=(n-s)*(i-o)}function Xht(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!Zht(r,t)&&(Ny(r,t)&&Ny(t,r)&&qht(r,t)&&(qi(r.prev,r,t.prev)||qi(r,t.prev,t))||hS(r,t)&&qi(r.prev,r,r.next)>0&&qi(t.prev,t,t.next)>0)}function qi(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function hS(r,t){return r.x===t.x&&r.y===t.y}function uW(r,t,e,i){var n=gx(qi(r,t,e)),a=gx(qi(r,t,i)),s=gx(qi(e,i,r)),o=gx(qi(e,i,t));return!!(n!==a&&s!==o||n===0&&px(r,e,t)||a===0&&px(r,i,t)||s===0&&px(e,r,i)||o===0&&px(e,t,i))}function px(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function gx(r){return r>0?1:r<0?-1:0}function Zht(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&uW(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Ny(r,t){return qi(r.prev,r,r.next)<0?qi(r,t,r.next)>=0&&qi(r,r.prev,t)>=0:qi(r,t,r.prev)<0||qi(r,r.next,t)<0}function qht(r,t){var e=r,i=!1,n=(r.x+t.x)/2,a=(r.y+t.y)/2;do e.y>a!=e.next.y>a&&e.next.y!==e.y&&n<(e.next.x-e.x)*(a-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function cW(r,t){var e=new yI(r.i,r.x,r.y),i=new yI(t.i,t.x,t.y),n=r.next,a=t.prev;return r.next=t,t.prev=r,e.next=n,n.prev=e,i.next=e,e.prev=i,a.next=i,i.prev=a,i}function UN(r,t,e,i){var n=new yI(r,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Fy(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function yI(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}cS.deviation=function(r,t,e,i){var n=t&&t.length,a=n?t[0]*e:r.length,s=Math.abs(_I(r,0,a,e));if(n)for(var o=0,l=t.length;o<l;o++){var u=t[o]*e,c=o<l-1?t[o+1]*e:r.length;s-=Math.abs(_I(r,u,c,e))}var h=0;for(o=0;o<i.length;o+=3){var p=i[o]*e,v=i[o+1]*e,y=i[o+2]*e;h+=Math.abs((r[p]-r[y])*(r[v+1]-r[p+1])-(r[p]-r[v])*(r[y+1]-r[p+1]))}return s===0&&h===0?0:Math.abs((h-s)/s)};function _I(r,t,e,i){for(var n=0,a=t,s=e-i;a<e;a+=i)n+=(r[s]-r[a])*(r[a+1]+r[s+1]),s=a;return n}cS.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,n=0;n<r.length;n++){for(var a=0;a<r[n].length;a++)for(var s=0;s<t;s++)e.vertices.push(r[n][a][s]);n>0&&(i+=r[n-1].length,e.holes.push(i))}return e};var Yht=QP.exports;const hW=Kw(Yht),vx=K$.CLOCKWISE,$N=K$.COUNTER_CLOCKWISE,yc={isClosed:!0};function Kht(r){if(r=r&&r.positions||r,!Array.isArray(r)&&!ArrayBuffer.isView(r))throw new Error("invalid polygon")}function Nm(r){return"positions"in r?r.positions:r}function F1(r){return"holeIndices"in r?r.holeIndices:null}function Jht(r){return Array.isArray(r[0])}function Qht(r){return r.length>=1&&r[0].length>=2&&Number.isFinite(r[0][0])}function tft(r){const t=r[0],e=r[r.length-1];return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function eft(r,t,e,i){for(let n=0;n<t;n++)if(r[e+n]!==r[i-t+n])return!1;return!0}function WN(r,t,e,i,n){let a=t;const s=e.length;for(let o=0;o<s;o++)for(let l=0;l<i;l++)r[a++]=e[o][l]||0;if(!tft(e))for(let o=0;o<i;o++)r[a++]=e[0][o]||0;return yc.start=t,yc.end=a,yc.size=i,J$(r,n,yc),a}function HN(r,t,e,i,n=0,a,s){a=a||e.length;const o=a-n;if(o<=0)return t;let l=t;for(let u=0;u<o;u++)r[l++]=e[n+u];if(!eft(e,i,n,a))for(let u=0;u<i;u++)r[l++]=e[n+u];return yc.start=t,yc.end=l,yc.size=i,J$(r,s,yc),l}function rft(r,t){Kht(r);const e=[],i=[];if("positions"in r){const{positions:n,holeIndices:a}=r;if(a){let s=0;for(let o=0;o<=a.length;o++)s=HN(e,s,n,t,a[o-1],a[o],o===0?vx:$N),i.push(s);return i.pop(),{positions:e,holeIndices:i}}r=n}if(!Jht(r))return HN(e,0,r,t,0,e.length,vx),e;if(!Qht(r)){let n=0;for(const[a,s]of r.entries())n=WN(e,n,s,t,a===0?vx:$N),i.push(n);return i.pop(),{positions:e,holeIndices:i}}return WN(e,0,r,t,vx),e}function UA(r,t,e){const i=r.length/3;let n=0;for(let a=0;a<i;a++){const s=(a+1)%i;n+=r[a*3+t]*r[s*3+e],n-=r[s*3+t]*r[a*3+e]}return Math.abs(n/2)}function GN(r,t,e,i){const n=r.length/3;for(let a=0;a<n;a++){const s=a*3,o=r[s+0],l=r[s+1],u=r[s+2];r[s+t]=o,r[s+e]=l,r[s+i]=u}}function ift(r,t,e,i){let n=F1(r);n&&(n=n.map(o=>o/t));let a=Nm(r);const s=i&&t===3;if(e){const o=a.length;a=a.slice();const l=[];for(let u=0;u<o;u+=t){l[0]=a[u],l[1]=a[u+1],s&&(l[2]=a[u+2]);const c=e(l);a[u]=c[0],a[u+1]=c[1],s&&(a[u+2]=c[2])}}if(s){const o=UA(a,0,1),l=UA(a,0,2),u=UA(a,1,2);if(!o&&!l&&!u)return[];o>l&&o>u||(l>u?(e||(a=a.slice()),GN(a,0,2,1)):(e||(a=a.slice()),GN(a,2,0,1)))}return hW(a,n,t)}class nft extends X${constructor(t){const{fp64:e,IndexType:i=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:e?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(t){const{attributes:e}=this;return t==="indices"?e.indices&&e.indices.subarray(0,this.vertexCount):e[t]}updateGeometry(t){super.updateGeometry(t);const e=this.buffers.indices;if(e)this.vertexCount=(e.value||e).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(t){if(this.normalize){const e=rft(t,this.positionSize);return this.opts.resolution?iW(Nm(e),F1(e),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?Tht(Nm(e),F1(e),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):e}return t}getGeometrySize(t){if(jN(t)){let e=0;for(const i of t)e+=this.getGeometrySize(i);return e}return Nm(t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):null}updateGeometryAttributes(t,e){if(t&&jN(t))for(const i of t){const n=this.getGeometrySize(i);e.geometrySize=n,this.updateGeometryAttributes(i,e),e.vertexStart+=n,e.indexStart=this.indexStarts[e.geometryIndex+1]}else{const i=t;this._updateIndices(i,e),this._updatePositions(i,e),this._updateVertexValid(i,e)}}_updateIndices(t,{geometryIndex:e,vertexStart:i,indexStart:n}){const{attributes:a,indexStarts:s,typedArrayManager:o}=this;let l=a.indices;if(!l||!t)return;let u=n;const c=ift(t,this.positionSize,this.opts.preproject,this.opts.full3d);l=o.allocate(l,n+c.length,{copy:!0});for(let h=0;h<c.length;h++)l[u++]=c[h]+i;s[e+1]=n+c.length,a.indices=l}_updatePositions(t,{vertexStart:e,geometrySize:i}){const{attributes:{positions:n},positionSize:a}=this;if(!n||!t)return;const s=Nm(t);for(let o=e,l=0;l<i;o++,l++){const u=s[l*a],c=s[l*a+1],h=a>2?s[l*a+2]:0;n[o*3]=u,n[o*3+1]=c,n[o*3+2]=h}}_updateVertexValid(t,{vertexStart:e,geometrySize:i}){const{positionSize:n}=this,a=this.attributes.vertexValid,s=t&&F1(t);if(t&&t.edgeTypes?a.set(t.edgeTypes,e):a.fill(1,e,e+i),s)for(let o=0;o<s.length;o++)a[e+s[o]/n-1]=0;a[e+i-1]=0}}function jN(r){return Array.isArray(r)&&r.length>0&&!Number.isFinite(r[0])}const fW=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,aft=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${fW}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,sft=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${fW}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,oft=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,kb=[0,0,0,255],lft={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:r=>r.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:kb},getLineColor:{type:"accessor",value:kb},material:!0},mx={enter:(r,t)=>t.length?t.subarray(t.length-r.length):r};class tR extends Tg{getShaders(t){return super.getShaders({vs:t==="top"?aft:sft,fs:oft,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[y_,Bit,__]})}get wrapLongitude(){return!1}getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["vertexPositions"])}initializeState(){const{viewport:t}=this.context;let{coordinateSystem:e}=this.props;const{_full3d:i}=this.props;t.isGeospatial&&e===Qr.DEFAULT&&(e=Qr.LNGLAT);let n;e===Qr.LNGLAT&&(i?n=t.projectPosition.bind(t):n=t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new nft({preproject:n,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const a=this.getAttributeManager(),s=!0;a.remove(["instancePickingColors"]),a.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:mx,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,stepMode:"dynamic",transition:mx,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:mx,accessor:"getFillColor",defaultValue:kb},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:mx,accessor:"getLineColor",defaultValue:kb},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(o,{index:l,target:u})=>this.encodePickingColor(o&&o.__source?o.__source.index:l,u)}})}getPickingInfo(t){const e=super.getPickingInfo(t),{index:i}=e,n=this.props.data;return n[0]&&n[0].__source&&(e.object=n.find(a=>a.__source.index===i)),e}disablePickingIndex(t){const e=this.props.data;if(e[0]&&e[0].__source)for(let i=0;i<e.length;i++)e[i].__source.index===t&&this._disablePickingIndex(i);else super.disablePickingIndex(t)}draw({uniforms:t}){const{extruded:e,filled:i,wireframe:n,elevationScale:a}=this.props,{topModel:s,sideModel:o,wireframeModel:l,polygonTesselator:u}=this.state,c={...t,extruded:!!e,elevationScale:a};l&&n&&(l.setInstanceCount(u.instanceCount-1),l.setUniforms(c),l.draw(this.context.renderPass)),o&&i&&(o.setInstanceCount(u.instanceCount-1),o.setUniforms(c),o.draw(this.context.renderPass)),s&&i&&(s.setVertexCount(u.vertexCount),s.setUniforms(c),s.draw(this.context.renderPass))}updateState(t){var o;super.updateState(t),this.updateGeometry(t);const{props:e,oldProps:i,changeFlags:n}=t,a=this.getAttributeManager();(n.extensionsChanged||e.filled!==i.filled||e.extruded!==i.extruded)&&((o=this.state.models)==null||o.forEach(l=>l.destroy()),this.setState(this._getModels()),a.invalidateAll())}updateGeometry({props:t,oldProps:e,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:a}=this.state,s=t.data.attributes||{};a.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:s.getPolygon,buffers:s,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:t._full3d}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:t,filled:e,extruded:i}=this.props;let n,a,s;if(e){const o=this.getShaders("top");o.defines.NON_INSTANCED_MODEL=1;const l=this.getAttributeManager().getBufferLayouts({isInstanced:!1});n=new au(this.context.device,{...o,id:`${t}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:l,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){const o=this.getAttributeManager().getBufferLayouts({isInstanced:!0});a=new au(this.context.device,{...this.getShaders("side"),id:`${t}-side`,bufferLayout:o,uniforms:{isWireframe:!1},geometry:new hg({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),s=new au(this.context.device,{...this.getShaders("side"),id:`${t}-wireframe`,bufferLayout:o,uniforms:{isWireframe:!0},geometry:new hg({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[a,s,n].filter(Boolean),topModel:n,sideModel:a,wireframeModel:s}}calculateIndices(t){const{polygonTesselator:e}=this.state;t.startIndices=e.indexStarts,t.value=e.get("indices")}calculatePositions(t){const{polygonTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}}tR.defaultProps=lft;tR.layerName="SolidPolygonLayer";const uft=tR;function cft({data:r,getIndex:t,dataRange:e,replace:i}){const{startRow:n=0,endRow:a=1/0}=e,s=r.length;let o=s,l=s;for(let p=0;p<s;p++){const v=t(r[p]);if(o>p&&v>=n&&(o=p),v>=a){l=p;break}}let u=o;const h=l-o!==i.length?r.slice(l):void 0;for(let p=0;p<i.length;p++)r[u++]=i[p];if(h){for(let p=0;p<h.length;p++)r[u++]=h[p];r.length=u}return{startRow:o,endRow:o+i.length}}function hft(r,t){if(!r)return null;const e="startIndices"in r?r.startIndices[t]:t,i=r.featureIds.value[e];return e!==-1?fft(r,i,e):null}function fft(r,t,e){const i={properties:{...r.properties[t]}};for(const n in r.numericProps)i.properties[n]=r.numericProps[n].value[e];return i}function dft(r,t){const e={points:null,lines:null,polygons:null};for(const i in e){const n=r[i].globalFeatureIds.value;e[i]=new Uint8ClampedArray(n.length*4);const a=[];for(let s=0;s<n.length;s++)t(n[s],a),e[i][s*4+0]=a[0],e[i][s*4+1]=a[1],e[i][s*4+2]=a[2],e[i][s*4+3]=255}return e}const pft=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,$A=192/256,XN=[],gft={getIconOffsets:{type:"accessor",value:r=>r.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class eR extends Y${getShaders(){return{...super.getShaders(),fs:pft}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,{index:i,target:n})=>this.encodePickingColor(i,n)}})}updateState(t){super.updateState(t);const{props:e,oldProps:i}=t;let{outlineColor:n}=e;n!==i.outlineColor&&(n=n.map(a=>a/255),n[3]=Number.isFinite(n[3])?n[3]:1,this.setState({outlineColor:n})),!e.sdf&&e.outlineWidth&&Wr.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(t){const{sdf:e,smoothing:i,outlineWidth:n}=this.props,{outlineColor:a}=this.state,s=n?Math.max(i,$A*(1-n)):-1;if(t.uniforms={...t.uniforms,sdfBuffer:$A,outlineBuffer:s,gamma:i,sdf:!!e,outlineColor:a},super.draw(t),e&&n){const{iconManager:o}=this.state,l=o.getTexture(),u=this.state.model;l&&(u.setUniforms({outlineBuffer:$A}),u.draw(this.context.renderPass))}}getInstanceOffset(t){return t?Array.from(t).flatMap(e=>super.getInstanceOffset(e)):XN}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap(e=>super.getInstanceIconFrame(e)):XN}}eR.defaultProps=gft;eR.layerName="MultiIconLayer";const vft=eR,ry=1e20;class mft{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:n=.25,fontFamily:a="sans-serif",fontWeight:s="normal",fontStyle:o="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=i;const l=this.size=t+e*4,u=this._createCanvas(l),c=this.ctx=u.getContext("2d",{willReadFrequently:!0});c.font=`${o} ${s} ${t}px ${a}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:a,actualBoundingBoxRight:s}=this.ctx.measureText(t),o=Math.ceil(i),l=0,u=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-a))),c=Math.min(this.size-this.buffer,o+Math.ceil(n)),h=u+2*this.buffer,p=c+2*this.buffer,v=Math.max(h*p,0),y=new Uint8ClampedArray(v),x={data:y,width:h,height:p,glyphWidth:u,glyphHeight:c,glyphTop:o,glyphLeft:l,glyphAdvance:e};if(u===0||c===0)return x;const{ctx:w,buffer:T,gridInner:E,gridOuter:M}=this;w.clearRect(T,T,u,c),w.fillText(t,T,T+o);const L=w.getImageData(T,T,u,c);M.fill(ry,0,v),E.fill(0,0,v);for(let F=0;F<c;F++)for(let O=0;O<u;O++){const U=L.data[4*(F*u+O)+3]/255;if(U===0)continue;const W=(F+T)*h+O+T;if(U===1)M[W]=0,E[W]=ry;else{const H=.5-U;M[W]=H>0?H*H:0,E[W]=H<0?H*H:0}}ZN(M,0,0,h,p,h,this.f,this.v,this.z),ZN(E,T,T,u,c,h,this.f,this.v,this.z);for(let F=0;F<v;F++){const O=Math.sqrt(M[F])-Math.sqrt(E[F]);y[F]=Math.round(255-255*(O/this.radius+this.cutoff))}return x}}function ZN(r,t,e,i,n,a,s,o,l){for(let u=t;u<t+i;u++)qN(r,e*a+u,a,n,s,o,l);for(let u=e;u<e+n;u++)qN(r,u*a+t,1,i,s,o,l)}function qN(r,t,e,i,n,a,s){a[0]=0,s[0]=-ry,s[1]=ry,n[0]=r[t];for(let o=1,l=0,u=0;o<i;o++){n[o]=r[t+o*e];const c=o*o;do{const h=a[l];u=(n[o]-n[h]+c-h*h)/(o-h)/2}while(u<=s[l]&&--l>-1);l++,a[l]=o,s[l]=u,s[l+1]=ry}for(let o=0,l=0;o<i;o++){for(;s[l+1]<o;)l++;const u=a[l],c=o-u;r[t+o*e]=n[u]+c*c}}const yft=32,_ft=[];function xft(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function bft({characterSet:r,getFontWidth:t,fontHeight:e,buffer:i,maxCanvasWidth:n,mapping:a={},xOffset:s=0,yOffset:o=0}){let l=0,u=s;const c=e+i*2;for(const h of r)if(!a[h]){const p=t(h);u+p+i*2>n&&(u=0,l++),a[h]={x:u+i,y:o+l*c+i,width:p,height:c,layoutWidth:p,layoutHeight:e},u+=p+i*2}return{mapping:a,xOffset:u,yOffset:o+l*c,canvasHeight:xft(o+(l+1)*c)}}function dW(r,t,e,i){var a;let n=0;for(let s=t;s<e;s++){const o=r[s];n+=((a=i[o])==null?void 0:a.layoutWidth)||0}return n}function pW(r,t,e,i,n,a){let s=t,o=0;for(let l=t;l<e;l++){const u=dW(r,l,l+1,n);o+u>i&&(s<l&&a.push(l),s=l,o=0),o+=u}return o}function wft(r,t,e,i,n,a){let s=t,o=t,l=t,u=0;for(let c=t;c<e;c++)if((r[c]===" "||r[c+1]===" "||c+1===e)&&(l=c+1),l>o){let h=dW(r,o,l,n);u+h>i&&(s<o&&(a.push(o),s=o,u=0),h>i&&(h=pW(r,o,l,i,n,a),s=a[a.length-1])),o=l,u+=h}return u}function Sft(r,t,e,i,n=0,a){a===void 0&&(a=r.length);const s=[];return t==="break-all"?pW(r,n,a,e,i,s):wft(r,n,a,e,i,s),s}function Tft(r,t,e,i,n,a){let s=0,o=0;for(let l=t;l<e;l++){const u=r[l],c=i[u];c?(o||(o=c.layoutHeight),n[l]=s+c.layoutWidth/2,s+=c.layoutWidth):(Wr.warn(`Missing character: ${u} (${u.codePointAt(0)})`)(),n[l]=s,s+=yft)}a[0]=s,a[1]=o}function Aft(r,t,e,i,n){var w;const a=Array.from(r),s=a.length,o=new Array(s),l=new Array(s),u=new Array(s),c=(e==="break-word"||e==="break-all")&&isFinite(i)&&i>0,h=[0,0],p=[0,0];let v=0,y=0,x=0;for(let T=0;T<=s;T++){const E=a[T];if((E===`
`||T===s)&&(x=T),x>y){const M=c?Sft(a,e,i,n,y,x):_ft;for(let L=0;L<=M.length;L++){const F=L===0?y:M[L-1],O=L<M.length?M[L]:x;Tft(a,F,O,n,o,p);for(let U=F;U<O;U++){const W=a[U],H=((w=n[W])==null?void 0:w.layoutOffsetY)||0;l[U]=v+p[1]/2+H,u[U]=p[0]}v=v+p[1]*t,h[0]=Math.max(h[0],p[0])}y=x}E===`
`&&(o[y]=0,l[y]=0,u[y]=0,y++)}return h[1]=v,{x:o,y:l,rowWidth:u,size:h}}function Cft({value:r,length:t,stride:e,offset:i,startIndices:n,characterSet:a}){const s=r.BYTES_PER_ELEMENT,o=e?e/s:1,l=i?i/s:0,u=n[t]||Math.ceil((r.length-l)/o),c=a&&new Set,h=new Array(t);let p=r;if(o>1||l>0){const v=r.constructor;p=new v(u);for(let y=0;y<u;y++)p[y]=r[y*o+l]}for(let v=0;v<t;v++){const y=n[v],x=n[v+1]||u,w=p.subarray(y,x);h[v]=String.fromCodePoint.apply(null,w),c&&w.forEach(c.add,c)}if(c)for(const v of c)a.add(String.fromCodePoint(v));return{texts:h,characterCount:u}}class gW{constructor(t=5){this._cache={},this._order=[],this.limit=t}get(t){const e=this._cache[t];return e&&(this._deleteOrder(t),this._appendOrder(t)),e}set(t,e){this._cache[t]?(this.delete(t),this._cache[t]=e,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=e,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){const e=this._order.indexOf(t);e>=0&&this._order.splice(e,1)}_appendOrder(t){this._order.push(t)}}function Eft(){const r=[];for(let t=32;t<128;t++)r.push(String.fromCharCode(t));return r}const Zp={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:Eft(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},YN=1024,KN=.9,JN=1.2,vW=3;let Ob=new gW(vW);function Ift(r,t){let e;typeof t=="string"?e=new Set(Array.from(t)):e=new Set(t);const i=Ob.get(r);if(!i)return e;for(const n in i.mapping)e.has(n)&&e.delete(n);return e}function Mft(r,t){for(let e=0;e<r.length;e++)t.data[4*e+3]=r[e]}function QN(r,t,e,i){r.font=`${i} ${e}px ${t}`,r.fillStyle="#000",r.textBaseline="alphabetic",r.textAlign="left"}function Pft(r){Wr.assert(Number.isFinite(r)&&r>=vW,"Invalid cache limit"),Ob=new gW(r)}class Rft{constructor(){this.props={...Zp}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:t,buffer:e}=this.props;return(t*JN+e*2)/t}setProps(t={}){Object.assign(this.props,t),this._key=this._getKey();const e=Ift(this._key,this.props.characterSet),i=Ob.get(this._key);if(i&&e.size===0){this._atlas!==i&&(this._atlas=i);return}const n=this._generateFontAtlas(e,i);this._atlas=n,Ob.set(this._key,n)}_generateFontAtlas(t,e){const{fontFamily:i,fontWeight:n,fontSize:a,buffer:s,sdf:o,radius:l,cutoff:u}=this.props;let c=e&&e.data;c||(c=document.createElement("canvas"),c.width=YN);const h=c.getContext("2d",{willReadFrequently:!0});QN(h,i,a,n);const{mapping:p,canvasHeight:v,xOffset:y,yOffset:x}=bft({getFontWidth:w=>h.measureText(w).width,fontHeight:a*JN,buffer:s,characterSet:t,maxCanvasWidth:YN,...e&&{mapping:e.mapping,xOffset:e.xOffset,yOffset:e.yOffset}});if(c.height!==v){const w=h.getImageData(0,0,c.width,c.height);c.height=v,h.putImageData(w,0,0)}if(QN(h,i,a,n),o){const w=new mft({fontSize:a,buffer:s,radius:l,cutoff:u,fontFamily:i,fontWeight:`${n}`});for(const T of t){const{data:E,width:M,height:L,glyphTop:F}=w.draw(T);p[T].width=M,p[T].layoutOffsetY=a*KN-F;const O=h.createImageData(M,L);Mft(E,O),h.putImageData(O,p[T].x,p[T].y)}}else for(const w of t)h.fillText(w,p[w].x,p[w].y+s+a*KN);return{xOffset:y,yOffset:x,mapping:p,data:c,width:c.width,height:c.height}}_getKey(){const{fontFamily:t,fontWeight:e,fontSize:i,buffer:n,sdf:a,radius:s,cutoff:o}=this.props;return a?`${t} ${e} ${i} ${n} ${s} ${o}`:`${t} ${e} ${i} ${n}`}}const Dft=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Lft=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,kft={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:r=>r.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class rR extends Tg{getShaders(){return super.getShaders({vs:Dft,fs:Lft,modules:[y_,__]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){var i;super.updateState(t);const{changeFlags:e}=t;e.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{billboard:e,sizeScale:i,sizeUnits:n,sizeMinPixels:a,sizeMaxPixels:s,getLineWidth:o}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]);const u=this.state.model;u.setUniforms(t),u.setUniforms({billboard:e,stroked:!!o,padding:l,sizeUnits:Nf[n],sizeScale:i,sizeMinPixels:a,sizeMaxPixels:s}),u.draw(this.context.renderPass)}_getModel(){const t=[0,0,1,0,1,1,0,1];return new au(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new hg({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}}rR.defaultProps=kft;rR.layerName="TextBackgroundLayer";const Oft=rR,tF={start:1,middle:0,end:-1},eF={top:1,center:0,bottom:-1},WA=[0,0,0,255],Nft=1,Fft={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:WA},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Zp.characterSet},fontFamily:Zp.fontFamily,fontWeight:Zp.fontWeight,lineHeight:Nft,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:WA},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:r=>r.text},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:WA},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class iR extends XP{constructor(){super(...arguments),this.getBoundingRect=(t,e)=>{let{size:[i,n]}=this.transformParagraph(t,e);const{fontSize:a}=this.state.fontAtlasManager.props;i/=a,n/=a;const{getTextAnchor:s,getAlignmentBaseline:o}=this.props,l=tF[typeof s=="function"?s(t,e):s],u=eF[typeof o=="function"?o(t,e):o];return[(l-1)*i/2,(u-1)*n/2,i,n]},this.getIconOffsets=(t,e)=>{const{getTextAnchor:i,getAlignmentBaseline:n}=this.props,{x:a,y:s,rowWidth:o,size:[l,u]}=this.transformParagraph(t,e),c=tF[typeof i=="function"?i(t,e):i],h=eF[typeof n=="function"?n(t,e):n],p=a.length,v=new Array(p*2);let y=0;for(let x=0;x<p;x++){const w=(1-c)*(l-o[x])/2;v[y++]=(c-1)*l/2+w+a[x],v[y++]=(h-1)*u/2+s[x]}return v}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new Rft},this.props.maxWidth>0&&Wr.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(t){const{props:e,oldProps:i,changeFlags:n}=t;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||e.lineHeight!==i.lineHeight||e.wordBreak!==i.wordBreak||e.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:t,fontFamily:e,fontWeight:i}=this.props,{fontAtlasManager:n,characterSet:a}=this.state,s={...t,characterSet:a,fontFamily:e,fontWeight:i};if(!n.mapping)return n.setProps(s),!0;for(const o in s)if(s[o]!==n.props[o])return n.setProps(s),!0;return!1}_updateText(){var l;const{data:t,characterSet:e}=this.props,i=(l=t.attributes)==null?void 0:l.getText;let{getText:n}=this.props,a=t.startIndices,s;const o=e==="auto"&&new Set;if(i&&a){const{texts:u,characterCount:c}=Cft({...ArrayBuffer.isView(i)?{value:i}:i,length:t.length,startIndices:a,characterSet:o});s=c,n=(h,{index:p})=>u[p]}else{const{iterable:u,objectInfo:c}=oS(t);a=[0],s=0;for(const h of u){c.index++;const p=Array.from(n(h,c)||"");o&&p.forEach(o.add,o),s+=p.length,a.push(s)}}this.setState({getText:n,startIndices:a,numInstances:s,characterSet:o||e})}transformParagraph(t,e){const{fontAtlasManager:i}=this.state,n=i.mapping,a=this.state.getText,{wordBreak:s,lineHeight:o,maxWidth:l}=this.props,u=a(t,e)||"";return Aft(u,o,s,l*i.props.fontSize,n)}renderLayers(){const{startIndices:t,numInstances:e,getText:i,fontAtlasManager:{scale:n,atlas:a,mapping:s},styleVersion:o}=this.state,{data:l,_dataDiff:u,getPosition:c,getColor:h,getSize:p,getAngle:v,getPixelOffset:y,getBackgroundColor:x,getBorderColor:w,getBorderWidth:T,backgroundPadding:E,background:M,billboard:L,fontSettings:F,outlineWidth:O,outlineColor:U,sizeScale:W,sizeUnits:H,sizeMinPixels:j,sizeMaxPixels:Y,transitions:tt,updateTriggers:it}=this.props,lt=this.getSubLayerClass("characters",vft),ht=this.getSubLayerClass("background",Oft);return[M&&new ht({getFillColor:x,getLineColor:w,getLineWidth:T,padding:E,getPosition:c,getSize:p,getAngle:v,getPixelOffset:y,billboard:L,sizeScale:W,sizeUnits:H,sizeMinPixels:j,sizeMaxPixels:Y,transitions:tt&&{getPosition:tt.getPosition,getAngle:tt.getAngle,getSize:tt.getSize,getFillColor:tt.getBackgroundColor,getLineColor:tt.getBorderColor,getLineWidth:tt.getBorderWidth,getPixelOffset:tt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:it.getPosition,getAngle:it.getAngle,getSize:it.getSize,getFillColor:it.getBackgroundColor,getLineColor:it.getBorderColor,getLineWidth:it.getBorderWidth,getPixelOffset:it.getPixelOffset,getBoundingRect:{getText:it.getText,getTextAnchor:it.getTextAnchor,getAlignmentBaseline:it.getAlignmentBaseline,styleVersion:o}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:u,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new lt({sdf:F.sdf,smoothing:Number.isFinite(F.smoothing)?F.smoothing:Zp.smoothing,outlineWidth:O/(F.radius||Zp.radius),outlineColor:U,iconAtlas:a,iconMapping:s,getPosition:c,getColor:h,getSize:p,getAngle:v,getPixelOffset:y,billboard:L,sizeScale:W*n,sizeUnits:H,sizeMinPixels:j*n,sizeMaxPixels:Y*n,transitions:tt&&{getPosition:tt.getPosition,getAngle:tt.getAngle,getColor:tt.getColor,getSize:tt.getSize,getPixelOffset:tt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:it.getText,getPosition:it.getPosition,getAngle:it.getAngle,getColor:it.getColor,getSize:it.getSize,getPixelOffset:it.getPixelOffset,getIconOffsets:{getTextAnchor:it.getTextAnchor,getAlignmentBaseline:it.getAlignmentBaseline,styleVersion:o}}}),{data:l,_dataDiff:u,startIndices:t,numInstances:e,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(t){Pft(t)}}iR.defaultProps=Fft;iR.layerName="TextLayer";const Bft=iR,B1={circle:{type:tht,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Y$,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Bft,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},z1={type:kht,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},xI={type:uft,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Qv({type:r,props:t}){const e={};for(const i in t)e[i]=r.defaultProps[t[i]];return e}function HA(r,t){const{transitions:e,updateTriggers:i}=r.props,n={updateTriggers:{},transitions:e&&{getPosition:e.geometry}};for(const a in t){const s=t[a];let o=r.props[a];a.startsWith("get")&&(o=r.getSubLayerAccessor(o),n.updateTriggers[s]=i[a],e&&(n.transitions[s]=e[a])),n[s]=o}return n}function zft(r){if(Array.isArray(r))return r;switch(Wr.assert(r.type,"GeoJSON does not have type"),r.type){case"Feature":return[r];case"FeatureCollection":return Wr.assert(Array.isArray(r.features),"GeoJSON does not have features array"),r.features;default:return[{geometry:r}]}}function rF(r,t,e={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:a=r.length}=e;for(let s=n;s<a;s++){const o=r[s],{geometry:l}=o;if(l)if(l.type==="GeometryCollection"){Wr.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:u}=l;for(let c=0;c<u.length;c++){const h=u[c];iF(h,i,t,o,s)}}else iF(l,i,t,o,s)}return i}function iF(r,t,e,i,n){const{type:a,coordinates:s}=r,{pointFeatures:o,lineFeatures:l,polygonFeatures:u,polygonOutlineFeatures:c}=t;if(!Uft(a,s)){Wr.warn(`${a} coordinates are malformed`)();return}switch(a){case"Point":o.push(e({geometry:r},i,n));break;case"MultiPoint":s.forEach(h=>{o.push(e({geometry:{type:"Point",coordinates:h}},i,n))});break;case"LineString":l.push(e({geometry:r},i,n));break;case"MultiLineString":s.forEach(h=>{l.push(e({geometry:{type:"LineString",coordinates:h}},i,n))});break;case"Polygon":u.push(e({geometry:r},i,n)),s.forEach(h=>{c.push(e({geometry:{type:"LineString",coordinates:h}},i,n))});break;case"MultiPolygon":s.forEach(h=>{u.push(e({geometry:{type:"Polygon",coordinates:h}},i,n)),h.forEach(p=>{c.push(e({geometry:{type:"LineString",coordinates:p}},i,n))})});break}}const Vft={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Uft(r,t){let e=Vft[r];for(Wr.assert(e,`Unknown GeoJSON type ${r}`);t&&--e>0;)t=t[0];return t&&Number.isFinite(t[0])}function mW(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function yx(r){return r.geometry.coordinates}function $ft(r,t){const e=mW(),{pointFeatures:i,lineFeatures:n,polygonFeatures:a,polygonOutlineFeatures:s}=r;return e.points.data=i,e.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),e.points.getPosition=yx,e.lines.data=n,e.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),e.lines.getPath=yx,e.polygons.data=a,e.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),e.polygons.getPolygon=yx,e.polygonsOutline.data=s,e.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),e.polygonsOutline.getPath=yx,e}function Wft(r,t){const e=mW(),{points:i,lines:n,polygons:a}=r,s=dft(r,t);return e.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:s.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},e.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:4,value:s.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},e.lines._pathType="open",e.polygons.data={length:a.polygonIndices.value.length-1,startIndices:a.polygonIndices.value,attributes:{...a.attributes,getPolygon:a.positions,pickingColors:{size:4,value:s.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},e.polygons._normalize=!1,a.triangles&&(e.polygons.data.attributes.indices=a.triangles.value),e.polygonsOutline.data={length:a.primitivePolygonIndices.value.length-1,startIndices:a.primitivePolygonIndices.value,attributes:{...a.attributes,getPath:a.positions,instancePickingColors:{size:4,value:s.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},e.polygonsOutline._pathType="open",e}const Hft=["points","linestrings","polygons"],Gft={...Qv(B1.circle),...Qv(B1.icon),...Qv(B1.text),...Qv(z1),...Qv(xI),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:r=>r.properties.icon},getText:{type:"accessor",value:r=>r.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class nR extends XP{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:t,changeFlags:e}){if(!e.dataChanged)return;const{data:i}=this.props,n=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:n}),n?this._updateStateBinary({props:t,changeFlags:e}):this._updateStateJSON({props:t,changeFlags:e})}_updateStateBinary({props:t,changeFlags:e}){const i=Wft(t.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:t,changeFlags:e}){const i=zft(t.data),n=this.getSubLayerRow.bind(this);let a={};const s={};if(Array.isArray(e.dataChanged)){const l=this.state.features;for(const u in l)a[u]=l[u].slice(),s[u]=[];for(const u of e.dataChanged){const c=rF(i,n,u);for(const h in l)s[h].push(cft({data:a[h],getIndex:p=>p.__source.index,dataRange:u,replace:c[h]}))}}else a=rF(i,n);const o=$ft(a,s);this.setState({features:a,featuresDiff:s,layerProps:o})}getPickingInfo(t){const e=super.getPickingInfo(t),{index:i,sourceLayer:n}=e;return e.featureType=Hft.find(a=>n.id.startsWith(`${this.id}-${a}-`)),i>=0&&n.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(e.index=this.props.data.points.globalFeatureIds.value[i]),e}_updateAutoHighlight(t){const e=`${this.id}-points-`,i=t.featureType==="points";for(const n of this.getSubLayers())n.id.startsWith(e)===i&&n.updateAutoHighlight(t)}_renderPolygonLayer(){var s;const{extruded:t,wireframe:e}=this.props,{layerProps:i}=this.state,n="polygons-fill",a=this.shouldRenderSubLayer(n,(s=i.polygons)==null?void 0:s.data)&&this.getSubLayerClass(n,xI.type);if(a){const o=HA(this,xI.props),l=t&&e;return l||delete o.getLineColor,o.updateTriggers.lineColors=l,new a(o,this.getSubLayerProps({id:n,updateTriggers:o.updateTriggers}),i.polygons)}return null}_renderLineLayers(){var l,u;const{extruded:t,stroked:e}=this.props,{layerProps:i}=this.state,n="polygons-stroke",a="linestrings",s=!t&&e&&this.shouldRenderSubLayer(n,(l=i.polygonsOutline)==null?void 0:l.data)&&this.getSubLayerClass(n,z1.type),o=this.shouldRenderSubLayer(a,(u=i.lines)==null?void 0:u.data)&&this.getSubLayerClass(a,z1.type);if(s||o){const c=HA(this,z1.props);return[s&&new s(c,this.getSubLayerProps({id:n,updateTriggers:c.updateTriggers}),i.polygonsOutline),o&&new o(c,this.getSubLayerProps({id:a,updateTriggers:c.updateTriggers}),i.lines)]}return null}_renderPointLayers(){var o;const{pointType:t}=this.props,{layerProps:e,binary:i}=this.state;let{highlightedObjectIndex:n}=this.props;!i&&Number.isFinite(n)&&(n=e.points.data.findIndex(l=>l.__source.index===n));const a=new Set(t.split("+")),s=[];for(const l of a){const u=`points-${l}`,c=B1[l],h=c&&this.shouldRenderSubLayer(u,(o=e.points)==null?void 0:o.data)&&this.getSubLayerClass(u,c.type);if(h){const p=HA(this,c.props);let v=e.points;if(l==="text"&&i){const{instancePickingColors:y,...x}=v.data.attributes;v={...v,data:{...v.data,attributes:x}}}s.push(new h(p,this.getSubLayerProps({id:u,updateTriggers:p.updateTriggers,highlightedObjectIndex:n}),v))}}return s}renderLayers(){const{extruded:t}=this.props,e=this._renderPolygonLayer(),i=this._renderLineLayers(),n=this._renderPointLayers();return[!t&&e,i,n,t&&e]}getSubLayerAccessor(t){const{binary:e}=this.state;return!e||typeof t!="function"?super.getSubLayerAccessor(t):(i,n)=>{const{data:a,index:s}=n,o=hft(a,s);return t(o,n)}}}nR.layerName="GeoJsonLayer";nR.defaultProps=Gft;const fS=nR;class jft{constructor(t){this.index=t,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(t){this._bbox||(this._bbox=t,"west"in t?this.boundingBox=[[t.west,t.south],[t.east,t.north]]:this.boundingBox=[[t.left,t.top],[t.right,t.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const t=this.content?this.content.byteLength:0;return Number.isFinite(t)||console.error("byteLength not defined in tile data"),t}async _loadData({getData:t,requestScheduler:e,onLoad:i,onError:n}){const{index:a,id:s,bbox:o,userData:l,zoom:u}=this,c=this._loaderId;this._abortController=new AbortController;const{signal:h}=this._abortController,p=await e.scheduleRequest(this,x=>x.isSelected?1:-1);if(!p){this._isCancelled=!0;return}if(this._isCancelled){p.done();return}let v=null,y;try{v=await t({index:a,id:s,bbox:o,userData:l,zoom:u,signal:h})}catch(x){y=x||!0}finally{p.done()}if(c===this._loaderId){if(this._loader=void 0,this.content=v,this._isCancelled&&!v){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,y?n(y,this):i(this)}}loadData(t){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(t),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var t;this.isLoaded||(this._isCancelled=!0,(t=this._abortController)==null||t.abort())}}const ba={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},nF=new Ge,Xft=new Ge;class aR{constructor(t=[0,0,0],e=[0,0,0],i){i=i||nF.copy(t).add(e).scale(.5),this.center=new Ge(i),this.halfDiagonal=new Ge(e).subtract(this.center),this.minimum=new Ge(t),this.maximum=new Ge(e)}clone(){return new aR(this.minimum,this.maximum,this.center)}equals(t){return this===t||!!t&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){const{halfDiagonal:e}=this,i=Xft.from(t.normal),n=e.x*Math.abs(i.x)+e.y*Math.abs(i.y)+e.z*Math.abs(i.z),a=this.center.dot(i)+t.distance;return a-n>0?ba.INSIDE:a+n<0?ba.OUTSIDE:ba.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=nF.from(t).subtract(this.center),{halfDiagonal:i}=this;let n=0,a;return a=Math.abs(e.x)-i.x,a>0&&(n+=a*a),a=Math.abs(e.y)-i.y,a>0&&(n+=a*a),a=Math.abs(e.z)-i.z,a>0&&(n+=a*a),n}}const tm=new Ge,aF=new Ge;class sR{constructor(t=[0,0,0],e=0){this.radius=-0,this.center=new Ge,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=tm.from(e),this.center=new Ge().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new sR(this.center,this.radius)}union(t){const e=this.center,i=this.radius,n=t.center,a=t.radius,s=tm.copy(n).subtract(e),o=s.magnitude();if(i>=o+a)return this.clone();if(a>=o+i)return t.clone();const l=(i+o+a)*.5;return aF.copy(s).scale((-i+l)/o).add(e),this.center.copy(aF),this.radius=l,this}expand(t){const i=tm.from(t).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(t){this.center.transform(t);const e=jrt(tm,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const i=tm.from(t).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(t){const e=this.center,i=this.radius,a=t.normal.dot(e)+t.distance;return a<-i?ba.OUTSIDE:a<i?ba.INTERSECTING:ba.INSIDE}}const Zft=new Ge,qft=new Ge,_x=new Ge,xx=new Ge,bx=new Ge,Yft=new Ge,Kft=new Ge,jl={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class oR{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){this.center=new Ge().from(t),this.halfAxes=new Jn(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new Ge(t).len(),new Ge(e).len(),new Ge(i).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new Ge(t).normalize(),a=new Ge(e).normalize(),s=new Ge(i).normalize();return new dO().fromMatrix3(new Jn([...n,...a,...s]))}fromCenterHalfSizeQuaternion(t,e,i){const n=new dO(i),a=new Jn().fromQuaternion(n);return a[0]=a[0]*e[0],a[1]=a[1]*e[0],a[2]=a[2]*e[0],a[3]=a[3]*e[1],a[4]=a[4]*e[1],a[5]=a[5]*e[1],a[6]=a[6]*e[2],a[7]=a[7]*e[2],a[8]=a[8]*e[2],this.center=new Ge().from(t),this.halfAxes=a,this}clone(){return new oR(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new sR){const e=this.halfAxes,i=e.getColumn(0,_x),n=e.getColumn(1,xx),a=e.getColumn(2,bx),s=Zft.copy(i).add(n).add(a);return t.center.copy(this.center),t.radius=s.magnitude(),t}intersectPlane(t){const e=this.center,i=t.normal,n=this.halfAxes,a=i.x,s=i.y,o=i.z,l=Math.abs(a*n[jl.COLUMN0ROW0]+s*n[jl.COLUMN0ROW1]+o*n[jl.COLUMN0ROW2])+Math.abs(a*n[jl.COLUMN1ROW0]+s*n[jl.COLUMN1ROW1]+o*n[jl.COLUMN1ROW2])+Math.abs(a*n[jl.COLUMN2ROW0]+s*n[jl.COLUMN2ROW1]+o*n[jl.COLUMN2ROW2]),u=i.dot(e)+t.distance;return u<=-l?ba.OUTSIDE:u>=l?ba.INSIDE:ba.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=qft.from(t).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,_x),a=i.getColumn(1,xx),s=i.getColumn(2,bx),o=n.magnitude(),l=a.magnitude(),u=s.magnitude();n.normalize(),a.normalize(),s.normalize();let c=0,h;return h=Math.abs(e.dot(n))-o,h>0&&(c+=h*h),h=Math.abs(e.dot(a))-l,h>0&&(c+=h*h),h=Math.abs(e.dot(s))-u,h>0&&(c+=h*h),c}computePlaneDistances(t,e,i=[-0,-0]){let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;const s=this.center,o=this.halfAxes,l=o.getColumn(0,_x),u=o.getColumn(1,xx),c=o.getColumn(2,bx),h=Yft.copy(l).add(u).add(c).add(s),p=Kft.copy(h).subtract(t);let v=e.dot(p);return n=Math.min(v,n),a=Math.max(v,a),h.copy(s).add(l).add(u).subtract(c),p.copy(h).subtract(t),v=e.dot(p),n=Math.min(v,n),a=Math.max(v,a),h.copy(s).add(l).subtract(u).add(c),p.copy(h).subtract(t),v=e.dot(p),n=Math.min(v,n),a=Math.max(v,a),h.copy(s).add(l).subtract(u).subtract(c),p.copy(h).subtract(t),v=e.dot(p),n=Math.min(v,n),a=Math.max(v,a),s.copy(h).subtract(l).add(u).add(c),p.copy(h).subtract(t),v=e.dot(p),n=Math.min(v,n),a=Math.max(v,a),s.copy(h).subtract(l).add(u).subtract(c),p.copy(h).subtract(t),v=e.dot(p),n=Math.min(v,n),a=Math.max(v,a),s.copy(h).subtract(l).subtract(u).add(c),p.copy(h).subtract(t),v=e.dot(p),n=Math.min(v,n),a=Math.max(v,a),s.copy(h).subtract(l).subtract(u).subtract(c),p.copy(h).subtract(t),v=e.dot(p),n=Math.min(v,n),a=Math.max(v,a),i[0]=n,i[1]=a,i}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,_x);e.transformAsPoint(t);const i=this.halfAxes.getColumn(1,xx);i.transformAsPoint(t);const n=this.halfAxes.getColumn(2,bx);return n.transformAsPoint(t),this.halfAxes=new Jn([...e,...i,...n]),this}getTransform(){throw new Error("not implemented")}}const sF=new Ge,oF=new Ge;class By{constructor(t=[0,0,1],e=0){this.normal=new Ge,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return Ty(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=sF.from(t),this.normal.from(e).normalize();const i=-this.normal.dot(t);return this.distance=i,this}fromCoefficients(t,e,i,n){return this.normal.set(t,e,i),Ty(nu(this.normal.len(),1)),this.distance=n,this}clone(){return new By(this.normal,this.distance)}equals(t){return nu(this.distance,t.distance)&&nu(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=oF.copy(this.normal).transformAsVector(t).normalize(),i=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(i,e)}projectPointOntoPlane(t,e=[0,0,0]){const i=sF.from(t),n=this.getPointDistance(i),a=oF.copy(this.normal).scale(n);return i.subtract(a).to(e)}}const lF=[new Ge([1,0,0]),new Ge([0,1,0]),new Ge([0,0,1])],uF=new Ge,Jft=new Ge;class eu{constructor(t=[]){this.planes=t}fromBoundingSphere(t){this.planes.length=2*lF.length;const e=t.center,i=t.radius;let n=0;for(const a of lF){let s=this.planes[n],o=this.planes[n+1];s||(s=this.planes[n]=new By),o||(o=this.planes[n+1]=new By);const l=uF.copy(a).scale(-i).add(e);s.fromPointNormal(l,a);const u=uF.copy(a).scale(i).add(e),c=Jft.copy(a).negate();o.fromPointNormal(u,c),n+=2}return this}computeVisibility(t){let e=ba.INSIDE;for(const i of this.planes)switch(t.intersectPlane(i)){case ba.OUTSIDE:return ba.OUTSIDE;case ba.INTERSECTING:e=ba.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(Ty(Number.isFinite(e),"parentPlaneMask is required."),e===eu.MASK_OUTSIDE||e===eu.MASK_INSIDE)return e;let i=eu.MASK_INSIDE;const n=this.planes;for(let a=0;a<this.planes.length;++a){const s=a<31?1<<a:0;if(a<31&&!(e&s))continue;const o=n[a],l=t.intersectPlane(o);if(l===ba.OUTSIDE)return eu.MASK_OUTSIDE;l===ba.INTERSECTING&&(i|=s)}return i}}eu.MASK_OUTSIDE=4294967295;eu.MASK_INSIDE=0;eu.MASK_INDETERMINATE=2147483647;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;new Ge;const ol=new Jn,Qft=new Jn,tdt=new Jn,Sx=new Jn,cF=new Jn;function edt(r,t={}){const e=Pit,i=10;let n=0,a=0;const s=Qft,o=tdt;s.identity(),o.copy(r);const l=e*rdt(o);for(;a<i&&idt(o)>l;)ndt(o,Sx),cF.copy(Sx).transpose(),o.multiplyRight(Sx),o.multiplyLeft(cF),s.multiplyRight(Sx),++n>2&&(++a,n=0);return t.unitary=s.toTarget(t.unitary),t.diagonal=o.toTarget(t.diagonal),t}function rdt(r){let t=0;for(let e=0;e<9;++e){const i=r[e];t+=i*i}return Math.sqrt(t)}const bI=[1,0,0],wI=[2,2,1];function idt(r){let t=0;for(let e=0;e<3;++e){const i=r[ol.getElementIndex(wI[e],bI[e])];t+=2*i*i}return Math.sqrt(t)}function ndt(r,t){const e=Mit;let i=0,n=1;for(let u=0;u<3;++u){const c=Math.abs(r[ol.getElementIndex(wI[u],bI[u])]);c>i&&(n=u,i=c)}const a=bI[n],s=wI[n];let o=1,l=0;if(Math.abs(r[ol.getElementIndex(s,a)])>e){const u=r[ol.getElementIndex(s,s)],c=r[ol.getElementIndex(a,a)],h=r[ol.getElementIndex(s,a)],p=(u-c)/2/h;let v;p<0?v=-1/(-p+Math.sqrt(1+p*p)):v=1/(p+Math.sqrt(1+p*p)),o=1/Math.sqrt(1+v*v),l=v*o}return Jn.IDENTITY.to(t),t[ol.getElementIndex(a,a)]=t[ol.getElementIndex(s,s)]=o,t[ol.getElementIndex(s,a)]=l,t[ol.getElementIndex(a,s)]=-l,t}const Zu=new Ge,adt=new Ge,sdt=new Ge,odt=new Ge,ldt=new Ge,udt=new Jn,cdt={diagonal:new Jn,unitary:new Jn};function hdt(r,t=new oR){if(!r||r.length===0)return t.halfAxes=new Jn([0,0,0,0,0,0,0,0,0]),t.center=new Ge,t;const e=r.length,i=new Ge(0,0,0);for(const H of r)i.add(H);const n=1/e;i.multiplyByScalar(n);let a=0,s=0,o=0,l=0,u=0,c=0;for(const H of r){const j=Zu.copy(H).subtract(i);a+=j.x*j.x,s+=j.x*j.y,o+=j.x*j.z,l+=j.y*j.y,u+=j.y*j.z,c+=j.z*j.z}a*=n,s*=n,o*=n,l*=n,u*=n,c*=n;const h=udt;h[0]=a,h[1]=s,h[2]=o,h[3]=s,h[4]=l,h[5]=u,h[6]=o,h[7]=u,h[8]=c;const{unitary:p}=edt(h,cdt),v=t.halfAxes.copy(p);let y=v.getColumn(0,sdt),x=v.getColumn(1,odt),w=v.getColumn(2,ldt),T=-Number.MAX_VALUE,E=-Number.MAX_VALUE,M=-Number.MAX_VALUE,L=Number.MAX_VALUE,F=Number.MAX_VALUE,O=Number.MAX_VALUE;for(const H of r)Zu.copy(H),T=Math.max(Zu.dot(y),T),E=Math.max(Zu.dot(x),E),M=Math.max(Zu.dot(w),M),L=Math.min(Zu.dot(y),L),F=Math.min(Zu.dot(x),F),O=Math.min(Zu.dot(w),O);y=y.multiplyByScalar(.5*(L+T)),x=x.multiplyByScalar(.5*(F+E)),w=w.multiplyByScalar(.5*(O+M)),t.center.copy(y).add(x).add(w);const U=adt.set(T-L,E-F,M-O).multiplyByScalar(.5),W=new Jn([U[0],0,0,0,U[1],0,0,0,U[2]]);return t.halfAxes.multiplyRight(W),t}const Fp=512,hF=3,yW=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],_W=yW.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),fdt=_W.concat([[.25,.5],[.75,.5]]);class Bp{constructor(t,e,i){this.x=t,this.y=e,this.z=i}get children(){if(!this._children){const t=this.x*2,e=this.y*2,i=this.z+1;this._children=[new Bp(t,e,i),new Bp(t,e+1,i),new Bp(t+1,e,i),new Bp(t+1,e+1,i)]}return this._children}update(t){const{viewport:e,cullingVolume:i,elevationBounds:n,minZ:a,maxZ:s,bounds:o,offset:l,project:u}=t,c=this.getBoundingVolume(n,l,u);if(o&&!this.insideBounds(o)||i.computeVisibility(c)<0)return!1;if(!this.childVisible){let{z:p}=this;if(p<s&&p>=a){const v=c.distanceTo(e.cameraPosition)*e.scale/e.height;p+=Math.floor(Math.log2(v))}if(p>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const p of this.children)p.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(const e of this._children)e.getSelected(t);return t}insideBounds([t,e,i,n]){const a=Math.pow(2,this.z),s=Fp/a;return this.x*s<i&&this.y*s<n&&(this.x+1)*s>t&&(this.y+1)*s>e}getBoundingVolume(t,e,i){if(i){const l=this.z<1?fdt:this.z<2?_W:yW,u=[];for(const c of l){const h=TI(this.x+c[0],this.y+c[1],this.z);h[2]=t[0],u.push(i(h)),t[0]!==t[1]&&(h[2]=t[1],u.push(i(h)))}return hdt(u)}const n=Math.pow(2,this.z),a=Fp/n,s=this.x*a+e*Fp,o=Fp-(this.y+1)*a;return new aR([s,o,t[0]],[s+a,o+a,t[1]])}}function ddt(r,t,e,i){const n=r instanceof Jut&&r.resolution?r.projectPosition:null,a=Object.values(r.getFrustumPlanes()).map(({normal:v,distance:y})=>new By(v.clone().negate(),y)),s=new eu(a),o=r.distanceScales.unitsPerMeter[2],l=e&&e[0]*o||0,u=e&&e[1]*o||0,c=r instanceof Cy&&r.pitch<=60?t:0;if(i){const[v,y,x,w]=i,T=lg([v,w]),E=lg([x,y]);i=[T[0],Fp-T[1],E[0],Fp-E[1]]}const h=new Bp(0,0,0),p={viewport:r,project:n,cullingVolume:s,elevationBounds:[l,u],minZ:c,maxZ:t,bounds:i,offset:0};if(h.update(p),r instanceof Cy&&r.subViewports&&r.subViewports.length>1){for(p.offset=-1;h.update(p)&&!(--p.offset<-hF););for(p.offset=1;h.update(p)&&!(++p.offset>hF););}return h.getSelected()}const du=512,pdt=[-1/0,-1/0,1/0,1/0],xW={type:"object",value:null,validate:(r,t)=>t.optional&&r===null||typeof r=="string"||Array.isArray(r)&&r.every(e=>typeof e=="string"),equal:(r,t)=>{if(r===t)return!0;if(!Array.isArray(r)||!Array.isArray(t))return!1;const e=r.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(r[i]!==t[i])return!1;return!0}};function bW(r,t){const e=[t.transformAsPoint([r[0],r[1]]),t.transformAsPoint([r[2],r[1]]),t.transformAsPoint([r[0],r[3]]),t.transformAsPoint([r[2],r[3]])];return[Math.min(...e.map(n=>n[0])),Math.min(...e.map(n=>n[1])),Math.max(...e.map(n=>n[0])),Math.max(...e.map(n=>n[1]))]}function gdt(r){return Math.abs(r.split("").reduce((t,e)=>(t<<5)-t+e.charCodeAt(0)|0,0))}function Nb(r,t){if(!r||!r.length)return null;const{index:e,id:i}=t;if(Array.isArray(r)){const a=gdt(i)%r.length;r=r[a]}let n=r;for(const a of Object.keys(e)){const s=new RegExp(`{${a}}`,"g");n=n.replace(s,String(e[a]))}return Number.isInteger(e.y)&&Number.isInteger(e.z)&&(n=n.replace(/\{-y\}/g,String(Math.pow(2,e.z)-e.y-1))),n}function vdt(r,t,e){let i;if(t&&t.length===2){const[n,a]=t,s=r.getBounds({z:n}),o=r.getBounds({z:a});i=[Math.min(s[0],o[0]),Math.min(s[1],o[1]),Math.max(s[2],o[2]),Math.max(s[3],o[3])]}else i=r.getBounds();return r.isGeospatial?[Math.max(i[0],e[0]),Math.max(i[1],e[1]),Math.min(i[2],e[2]),Math.min(i[3],e[3])]:[Math.max(Math.min(i[0],e[2]),e[0]),Math.max(Math.min(i[1],e[3]),e[1]),Math.min(Math.max(i[2],e[0]),e[2]),Math.min(Math.max(i[3],e[1]),e[3])]}function mdt({viewport:r,z:t,cullRect:e}){return(r.subViewports||[r]).map(n=>SI(n,t||0,e))}function SI(r,t,e){if(!Array.isArray(t)){const a=e.x-r.x,s=e.y-r.y,{width:o,height:l}=e,u={targetZ:t},c=r.unproject([a,s],u),h=r.unproject([a+o,s],u),p=r.unproject([a,s+l],u),v=r.unproject([a+o,s+l],u);return[Math.min(c[0],h[0],p[0],v[0]),Math.min(c[1],h[1],p[1],v[1]),Math.max(c[0],h[0],p[0],v[0]),Math.max(c[1],h[1],p[1],v[1])]}const i=SI(r,t[0],e),n=SI(r,t[1],e);return[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[2],n[2]),Math.max(i[3],n[3])]}function ydt(r,t,e){return e?bW(r,e).map(n=>n*t/du):r.map(i=>i*t/du)}function lR(r,t){return Math.pow(2,r)*du/t}function TI(r,t,e){const i=lR(e,du),n=r/i*360-180,a=Math.PI-2*Math.PI*t/i,s=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[n,s]}function fF(r,t,e,i){const n=lR(e,i);return[r/n*du,t/n*du]}function _dt(r,t,e,i,n=du){if(r.isGeospatial){const[u,c]=TI(t,e,i),[h,p]=TI(t+1,e+1,i);return{west:u,north:c,east:h,south:p}}const[a,s]=fF(t,e,i,n),[o,l]=fF(t+1,e+1,i,n);return{left:a,top:s,right:o,bottom:l}}function xdt(r,t,e,i,n){const a=vdt(r,null,i),s=lR(t,e),[o,l,u,c]=ydt(a,s,n),h=[];for(let p=Math.floor(o);p<u;p++)for(let v=Math.floor(l);v<c;v++)h.push({x:p,y:v,z:t});return h}function bdt({viewport:r,maxZoom:t,minZoom:e,zRange:i,extent:n,tileSize:a=du,modelMatrix:s,modelMatrixInverse:o,zoomOffset:l=0}){let u=r.isGeospatial?Math.round(r.zoom+Math.log2(du/a))+l:Math.ceil(r.zoom)+l;if(typeof e=="number"&&Number.isFinite(e)&&u<e){if(!n)return[];u=e}typeof t=="number"&&Number.isFinite(t)&&u>t&&(u=t);let c=n;return s&&o&&n&&!r.isGeospatial&&(c=bW(n,s)),r.isGeospatial?ddt(r,u,i,n):xdt(r,u,a,c||pdt,o)}function wdt(r){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(r)}function Sdt(r){return Number.isFinite(r.west)&&Number.isFinite(r.north)&&Number.isFinite(r.east)&&Number.isFinite(r.south)}function Tdt(r){let t={},e;return i=>{for(const n in i)if(!Adt(i[n],t[n])){e=r(i),t=i;break}return e}}function Adt(r,t){if(r===t)return!0;if(Array.isArray(r)){const e=r.length;if(!t||t.length!==e)return!1;for(let i=0;i<e;i++)if(r[i]!==t[i])return!1;return!0}return!1}const dF=1,dS=2,Cdt="never",Edt="no-overlap",uR="best-available",Idt=5,Mdt={[uR]:Ddt,[Edt]:Ldt,[Cdt]:()=>{}},Pdt={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class Rdt{constructor(t){this._getCullBounds=Tdt(mdt),this.opts={...Pdt,...t},this.setOptions(this.opts),this.onTileLoad=e=>{var i,n;(n=(i=this.opts).onTileLoad)==null||n.call(i,e),this.opts.maxCacheByteSize!=null&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this._requestScheduler=new HK({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new wa,this._modelMatrixInverse=new wa}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(t=>t.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(t=>t.needsReload)}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(const t of this._cache.values())t.isLoading&&t.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const t of this._cache.keys()){const e=this._cache.get(t);!this._selectedTiles||!this._selectedTiles.includes(e)?this._cache.delete(t):e.setNeedsReload()}}update(t,{zRange:e,modelMatrix:i}={zRange:null,modelMatrix:null}){const n=i?new wa(i):new wa,a=!n.equals(this._modelMatrix);if(!this._viewport||!t.equals(this._viewport)||!nu(this._zRange,e)||a){a&&(this._modelMatrixInverse=n.clone().invert(),this._modelMatrix=n),this._viewport=t,this._zRange=e;const o=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:e,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=o.map(l=>this._getTile(l,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(o=>this._getTile(o.index,!0)));const s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(t,e){if(!t.isVisible)return!1;if(e&&this._viewport){const i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:e}),{bbox:n}=t;for(const[a,s,o,l]of i){let u;if("west"in n)u=n.west<o&&n.east>a&&n.south<l&&n.north>s;else{const c=Math.min(n.top,n.bottom),h=Math.max(n.top,n.bottom);u=n.left<o&&n.right>a&&c<l&&h>s}if(u)return!0}return!1}return!0}getTileIndices({viewport:t,maxZoom:e,minZoom:i,zRange:n,modelMatrix:a,modelMatrixInverse:s}){const{tileSize:o,extent:l,zoomOffset:u}=this.opts;return bdt({viewport:t,maxZoom:e,minZoom:i,zRange:n,tileSize:o,extent:l,modelMatrix:a,modelMatrixInverse:s,zoomOffset:u})}getTileId(t){return`${t.x}-${t.y}-${t.z}`}getTileZoom(t){return t.z}getTileMetadata(t){const{tileSize:e}=this.opts;return{bbox:_dt(this._viewport,t.x,t.y,t.z,e)}}getParentIndex(t){const e=Math.floor(t.x/2),i=Math.floor(t.y/2),n=t.z-1;return{x:e,y:i,z:n}}updateTileStates(){const t=this.opts.refinementStrategy||uR,e=new Array(this._cache.size);let i=0;for(const n of this._cache.values())e[i++]=n.isVisible,n.isSelected=!1,n.isVisible=!1;for(const n of this._selectedTiles)n.isSelected=!0,n.isVisible=!0;(typeof t=="function"?t:Mdt[t])(Array.from(this._cache.values())),i=0;for(const n of this._cache.values())if(e[i++]!==n.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:t=0}=this.opts,e=[];let i=0;for(const n of this._cache.values())n.isLoading&&(i++,!n.isSelected&&!n.isVisible&&e.push(n));for(;t>0&&i>t&&e.length>0;)e.shift().abort(),i--}_rebuildTree(){const{_cache:t}=this;for(const e of t.values())e.parent=null,e.children&&(e.children.length=0);for(const e of t.values()){const i=this._getNearestAncestor(e);e.parent=i,i!=null&&i.children&&i.children.push(e)}}_resizeCache(){var s,o;const{_cache:t,opts:e}=this,i=e.maxCacheSize??(e.maxCacheByteSize!=null?1/0:Idt*this.selectedTiles.length),n=e.maxCacheByteSize??1/0;if(t.size>i||this._cacheByteSize>n){for(const[l,u]of t)if(!u.isVisible&&!u.isSelected&&(this._cacheByteSize-=e.maxCacheByteSize!=null?u.byteLength:0,t.delete(l),(o=(s=this.opts).onTileUnload)==null||o.call(s,u)),t.size<=i&&this._cacheByteSize<=n)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((l,u)=>l.zoom-u.zoom),this._dirty=!1)}_getTile(t,e){const i=this.getTileId(t);let n=this._cache.get(i),a=!1;return!n&&e?(n=new jft(t),Object.assign(n,this.getTileMetadata(n.index)),Object.assign(n,{id:i,zoom:this.getTileZoom(n.index)}),a=!0,this._cache.set(i,n),this._dirty=!0):n&&n.needsReload&&(a=!0),n&&a&&n.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),n}_getNearestAncestor(t){const{_minZoom:e=0}=this;let i=t.index;for(;this.getTileZoom(i)>e;){i=this.getParentIndex(i);const n=this._getTile(i);if(n)return n}return null}}function Ddt(r){for(const t of r)t.state=0;for(const t of r)t.isSelected&&!wW(t)&&cR(t);for(const t of r)t.isVisible=!!(t.state&dS)}function Ldt(r){for(const e of r)e.state=0;for(const e of r)e.isSelected&&wW(e);const t=Array.from(r).sort((e,i)=>e.zoom-i.zoom);for(const e of t)if(e.isVisible=!!(e.state&dS),e.children&&(e.isVisible||e.state&dF))for(const i of e.children)i.state=dF;else e.isSelected&&cR(e)}function wW(r){let t=r;for(;t;){if(t.isLoaded||t.content)return t.state|=dS,!0;t=t.parent}return!1}function cR(r){for(const t of r.children)t.isLoaded||t.content?t.state|=dS:cR(t)}const kdt={TilesetClass:Rdt,data:{type:"data",value:[]},dataComparator:xW.equal,renderSubLayers:{type:"function",value:r=>new fS(r)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:r=>console.error(r)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:uR,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class hR extends XP{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var t,e;(e=(t=this.state)==null?void 0:t.tileset)==null||e.finalize()}get isLoaded(){var t,e,i;return!!((i=(e=(t=this.state)==null?void 0:t.tileset)==null?void 0:e.selectedTiles)!=null&&i.every(n=>n.isLoaded&&n.layers&&n.layers.every(a=>a.isLoaded)))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({changeFlags:t}){let{tileset:e}=this.state;const i=t.propsOrDataChanged||t.updateTriggersChanged,n=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);e?i&&(e.setOptions(this._getTilesetOptions()),n?e.reloadAll():e.tiles.forEach(a=>{a.layers=null})):(e=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:e})),this._updateTileset()}_getTilesetOptions(){const{tileSize:t,maxCacheSize:e,maxCacheByteSize:i,refinementStrategy:n,extent:a,maxZoom:s,minZoom:o,maxRequests:l,debounceTime:u,zoomOffset:c}=this.props;return{maxCacheSize:e,maxCacheByteSize:i,maxZoom:s,minZoom:o,tileSize:t,refinementStrategy:n,extent:a,maxRequests:l,debounceTime:u,zoomOffset:c,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const t=this.state.tileset,{zRange:e,modelMatrix:i}=this.props,n=t.update(this.context.viewport,{zRange:e,modelMatrix:i}),{isLoaded:a}=t,s=this.state.isLoaded!==a,o=this.state.frameNumber!==n;a&&(s||o)&&this._onViewportLoad(),o&&this.setState({frameNumber:n}),this.state.isLoaded=a}_onViewportLoad(){const{tileset:t}=this.state,{onViewportLoad:e}=this.props;e&&e(t.selectedTiles)}_onTileLoad(t){this.props.onTileLoad(t),t.layers=null,this.setNeedsUpdate()}_onTileError(t,e){this.props.onTileError(t),e.layers=null,this.setNeedsUpdate()}_onTileUnload(t){this.props.onTileUnload(t)}getTileData(t){const{data:e,getTileData:i,fetch:n}=this.props,{signal:a}=t;return t.url=typeof e=="string"||Array.isArray(e)?Nb(e,t):null,i?i(t):n&&t.url?n(t.url,{propName:"data",layer:this,signal:a}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getSubLayerPropsByTile(t){return null}getPickingInfo(t){const e=t.sourceLayer,i=e.props.tile,n=t.info;return n.picked&&(n.tile=i),n.sourceTile=i,n.sourceTileSubLayer=e,n}_updateAutoHighlight(t){t.sourceTileSubLayer.updateAutoHighlight(t)}renderLayers(){return this.state.tileset.tiles.map(t=>{const e=this.getSubLayerPropsByTile(t);if(!(!t.isLoaded&&!t.content))if(t.layers)e&&t.layers[0]&&Object.keys(e).some(i=>t.layers[0].props[i]!==e[i])&&(t.layers=t.layers.map(i=>i.clone(e)));else{const i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:t.id,updateTriggers:this.props.updateTriggers}),data:t.content,_offset:0,tile:t});t.layers=rS(i,Boolean).map(n=>n.clone({tile:t,...e}))}return t.layers})}filterSubLayer({layer:t,cullRect:e}){const{tile:i}=t.props;return this.state.tileset.isTileVisible(i,e)}}hR.defaultProps=kdt;hR.layerName="TileLayer";const Odt=hR,Ndt={clipBounds:[0,0,1,1],clipByInstance:void 0},SW=`
uniform vec4 clip_bounds;
bool clip_isInBounds(vec2 position) {
return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,Fdt={name:"clip-vs",vs:SW},Bdt={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
if (clip_isVisible < 0.5) discard;
`},zdt={name:"clip-fs",fs:SW},Vdt={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
if (!clip_isInBounds(clip_commonPosition)) discard;
`};class fR extends Qut{getShaders(){let t="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(t=!!this.props.clipByInstance),this.state.clipByInstance=t,t?{modules:[Fdt],inject:Bdt}:{modules:[zdt],inject:Vdt}}draw({uniforms:t}){const{clipBounds:e}=this.props;if(this.state.clipByInstance)t.clip_bounds=e;else{const i=this.projectPosition([e[0],e[1],0]),n=this.projectPosition([e[2],e[3],0]);t.clip_bounds=[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[0],n[0]),Math.max(i[1],n[1])]}}}fR.defaultProps=Ndt;fR.extensionName="ClipExtension";const TW=fR;function Udt(r,t,e){const i=$dt(r),n=Object.keys(i).filter(a=>i[a]!==Array);return Wdt(r,{propArrayTypes:i,...t},{numericPropKeys:e&&e.numericPropKeys||n,PositionDataType:e?e.PositionDataType:Float32Array,triangulate:e?e.triangulate:!0})}function $dt(r){const t={};for(const e of r)if(e.properties)for(const i in e.properties){const n=e.properties[i];t[i]=qdt(n,t[i])}return t}function Wdt(r,t,e){const{pointPositionsCount:i,pointFeaturesCount:n,linePositionsCount:a,linePathsCount:s,lineFeaturesCount:o,polygonPositionsCount:l,polygonObjectsCount:u,polygonRingsCount:c,polygonFeaturesCount:h,propArrayTypes:p,coordLength:v}=t,{numericPropKeys:y=[],PositionDataType:x=Float32Array,triangulate:w=!0}=e,T=r[0]&&"id"in r[0],E=r.length>65535?Uint32Array:Uint16Array,M={type:"Point",positions:new x(i*v),globalFeatureIds:new E(i),featureIds:n>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},L={type:"LineString",pathIndices:a>65535?new Uint32Array(s+1):new Uint16Array(s+1),positions:new x(a*v),globalFeatureIds:new E(a),featureIds:o>65535?new Uint32Array(a):new Uint16Array(a),numericProps:{},properties:[],fields:[]},F={type:"Polygon",polygonIndices:l>65535?new Uint32Array(u+1):new Uint16Array(u+1),primitivePolygonIndices:l>65535?new Uint32Array(c+1):new Uint16Array(c+1),positions:new x(l*v),globalFeatureIds:new E(l),featureIds:h>65535?new Uint32Array(l):new Uint16Array(l),numericProps:{},properties:[],fields:[]};w&&(F.triangles=[]);for(const U of[M,L,F])for(const W of y){const H=p[W];U.numericProps[W]=new H(U.positions.length/v)}L.pathIndices[s]=a,F.polygonIndices[u]=l,F.primitivePolygonIndices[c]=l;const O={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const U of r){const W=U.geometry,H=U.properties||{};switch(W.type){case"Point":Hdt(W,M,O,v,H),M.properties.push(jA(H,y)),T&&M.fields.push({id:U.id}),O.pointFeature++;break;case"LineString":Gdt(W,L,O,v,H),L.properties.push(jA(H,y)),T&&L.fields.push({id:U.id}),O.lineFeature++;break;case"Polygon":jdt(W,F,O,v,H),F.properties.push(jA(H,y)),T&&F.fields.push({id:U.id}),O.polygonFeature++;break;default:throw new Error("Invalid geometry type")}O.feature++}return Zdt(M,L,F,v)}function Hdt(r,t,e,i,n){t.positions.set(r.data,e.pointPosition*i);const a=r.data.length/i;dR(t,n,e.pointPosition,a),t.globalFeatureIds.fill(e.feature,e.pointPosition,e.pointPosition+a),t.featureIds.fill(e.pointFeature,e.pointPosition,e.pointPosition+a),e.pointPosition+=a}function Gdt(r,t,e,i,n){t.positions.set(r.data,e.linePosition*i);const a=r.data.length/i;dR(t,n,e.linePosition,a),t.globalFeatureIds.fill(e.feature,e.linePosition,e.linePosition+a),t.featureIds.fill(e.lineFeature,e.linePosition,e.linePosition+a);for(let s=0,o=r.indices.length;s<o;++s){const l=r.indices[s],u=s===o-1?r.data.length:r.indices[s+1];t.pathIndices[e.linePath++]=e.linePosition,e.linePosition+=(u-l)/i}}function jdt(r,t,e,i,n){t.positions.set(r.data,e.polygonPosition*i);const a=r.data.length/i;dR(t,n,e.polygonPosition,a),t.globalFeatureIds.fill(e.feature,e.polygonPosition,e.polygonPosition+a),t.featureIds.fill(e.polygonFeature,e.polygonPosition,e.polygonPosition+a);for(let s=0,o=r.indices.length;s<o;++s){const l=e.polygonPosition;t.polygonIndices[e.polygonObject++]=l;const u=r.areas[s],c=r.indices[s],h=r.indices[s+1];for(let v=0,y=c.length;v<y;++v){const x=c[v],w=v===y-1?h===void 0?r.data.length:h[0]:c[v+1];t.primitivePolygonIndices[e.polygonRing++]=e.polygonPosition,e.polygonPosition+=(w-x)/i}const p=e.polygonPosition;Xdt(t,u,c,{startPosition:l,endPosition:p,coordLength:i})}}function Xdt(r,t,e,{startPosition:i,endPosition:n,coordLength:a}){if(!r.triangles)return;const s=i*a,o=n*a,l=r.positions.subarray(s,o),u=e[0],c=e.slice(1).map(p=>(p-u)/a),h=iht(l,c,a,t);for(let p=0,v=h.length;p<v;++p)r.triangles.push(i+h[p])}function GA(r,t){const e={};for(const i in r)e[i]={value:r[i],size:t};return e}function Zdt(r,t,e,i){const n={shape:"binary-feature-collection",points:{...r,positions:{value:r.positions,size:i},globalFeatureIds:{value:r.globalFeatureIds,size:1},featureIds:{value:r.featureIds,size:1},numericProps:GA(r.numericProps,1)},lines:{...t,positions:{value:t.positions,size:i},pathIndices:{value:t.pathIndices,size:1},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:GA(t.numericProps,1)},polygons:{...e,positions:{value:e.positions,size:i},polygonIndices:{value:e.polygonIndices,size:1},primitivePolygonIndices:{value:e.primitivePolygonIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:GA(e.numericProps,1)}};return n.polygons&&e.triangles&&(n.polygons.triangles={value:new Uint32Array(e.triangles),size:1}),n}function dR(r,t,e,i){for(const n in r.numericProps)if(n in t){const a=t[n];r.numericProps[n].fill(a,e,e+i)}}function jA(r,t){const e={};for(const i in r)t.includes(i)||(e[i]=r[i]);return e}function qdt(r,t){return t===Array||!Number.isFinite(r)?Array:t===Float64Array||Math.fround(r)!==r?Float64Array:Float32Array}function pF(r,t){const e=t==null?void 0:t.globalFeatureId;return e!==void 0?Ydt(r,e):Kdt(r,t==null?void 0:t.type)}function Ydt(r,t){const e=AW(r);for(const i of e){let n=0,a=i.featureIds.value[0];for(let s=0;s<i.featureIds.value.length;s++){const o=i.featureIds.value[s];if(o!==a){if(t===i.globalFeatureIds.value[n])return Fb(i,n,s);n=s,a=o}}if(t===i.globalFeatureIds.value[n])return Fb(i,n,i.featureIds.value.length)}throw new Error(`featureId:${t} not found`)}function Kdt(r,t){const e=AW(r);return Qdt(e)}function Jdt(r,t,e){switch(r.type){case"Point":return ipt(r,t,e);case"LineString":return rpt(r,t,e);case"Polygon":return CW(r,t,e);default:const i=r;throw new Error(`Unsupported geometry type: ${i==null?void 0:i.type}`)}}function AW(r,t){const e=[];return r.points&&(r.points.type="Point",e.push(r.points)),r.lines&&(r.lines.type="LineString",e.push(r.lines)),r.polygons&&(r.polygons.type="Polygon",e.push(r.polygons)),e}function Qdt(r){const t=[];for(const e of r){if(e.featureIds.value.length===0)continue;let i=0,n=e.featureIds.value[0];for(let a=0;a<e.featureIds.value.length;a++){const s=e.featureIds.value[a];s!==n&&(t.push(Fb(e,i,a)),i=a,n=s)}t.push(Fb(e,i,e.featureIds.value.length))}return t}function Fb(r,t,e){const i=Jdt(r,t,e),n=ept(r,t),a=tpt(r,t);return{type:"Feature",geometry:i,properties:n,...a}}function tpt(r,t=0,e){return r.fields&&r.fields[r.featureIds.value[t]]}function ept(r,t=0,e){const i=Object.assign({},r.properties[r.featureIds.value[t]]);for(const n in r.numericProps)i[n]=r.numericProps[n].value[t];return i}function CW(r,t=-1/0,e=1/0){const{positions:i}=r,n=r.polygonIndices.value.filter(l=>l>=t&&l<=e),a=r.primitivePolygonIndices.value.filter(l=>l>=t&&l<=e);if(!(n.length>2)){const l=[];for(let u=0;u<a.length-1;u++){const c=a[u],h=a[u+1],p=Bb(i,c,h);l.push(p)}return{type:"Polygon",coordinates:l}}const o=[];for(let l=0;l<n.length-1;l++){const u=n[l],c=n[l+1],h=CW(r,u,c).coordinates;o.push(h)}return{type:"MultiPolygon",coordinates:o}}function rpt(r,t=-1/0,e=1/0){const{positions:i}=r,n=r.pathIndices.value.filter(o=>o>=t&&o<=e);if(!(n.length>2))return{type:"LineString",coordinates:Bb(i,n[0],n[1])};const s=[];for(let o=0;o<n.length-1;o++){const l=Bb(i,n[o],n[o+1]);s.push(l)}return{type:"MultiLineString",coordinates:s}}function ipt(r,t,e){const{positions:i}=r,n=Bb(i,t,e);return n.length>1?{type:"MultiPoint",coordinates:n}:{type:"Point",coordinates:n[0]}}function Bb(r,t,e){t=t||0,e=e||r.value.length/r.size;const i=[];for(let n=t;n<e;n++){const a=Array();for(let s=n*r.size;s<(n+1)*r.size;s++)a.push(Number(r.value[s]));i.push(a)}return i}var pR={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */pR.read=function(r,t,e,i,n){var a,s,o=n*8-i-1,l=(1<<o)-1,u=l>>1,c=-7,h=e?n-1:0,p=e?-1:1,v=r[t+h];for(h+=p,a=v&(1<<-c)-1,v>>=-c,c+=o;c>0;a=a*256+r[t+h],h+=p,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=i;c>0;s=s*256+r[t+h],h+=p,c-=8);if(a===0)a=1-u;else{if(a===l)return s?NaN:(v?-1:1)*(1/0);s=s+Math.pow(2,i),a=a-u}return(v?-1:1)*s*Math.pow(2,a-i)};pR.write=function(r,t,e,i,n,a){var s,o,l,u=a*8-n-1,c=(1<<u)-1,h=c>>1,p=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=i?0:a-1,y=i?1:-1,x=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),s+h>=1?t+=p/l:t+=p*Math.pow(2,1-h),t*l>=2&&(s++,l/=2),s+h>=c?(o=0,s=c):s+h>=1?(o=(t*l-1)*Math.pow(2,n),s=s+h):(o=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;r[e+v]=o&255,v+=y,o/=256,n-=8);for(s=s<<n|o,u+=n;u>0;r[e+v]=s&255,v+=y,s/=256,u-=8);r[e+v-y]|=x*128};var npt=ai,Tx=pR;function ai(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}ai.Varint=0;ai.Fixed64=1;ai.Bytes=2;ai.Fixed32=5;var AI=65536*65536,gF=1/AI,apt=12,EW=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");ai.prototype={destroy:function(){this.buf=null},readFields:function(r,t,e){for(e=e||this.length;this.pos<e;){var i=this.readVarint(),n=i>>3,a=this.pos;this.type=i&7,r(n,t,this),this.pos===a&&this.skip(i)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=Ax(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=mF(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Ax(this.buf,this.pos)+Ax(this.buf,this.pos+4)*AI;return this.pos+=8,r},readSFixed64:function(){var r=Ax(this.buf,this.pos)+mF(this.buf,this.pos+4)*AI;return this.pos+=8,r},readFloat:function(){var r=Tx.read(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Tx.read(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t=this.buf,e,i;return i=t[this.pos++],e=i&127,i<128||(i=t[this.pos++],e|=(i&127)<<7,i<128)||(i=t[this.pos++],e|=(i&127)<<14,i<128)||(i=t[this.pos++],e|=(i&127)<<21,i<128)?e:(i=t[this.pos],e|=(i&15)<<28,spt(e,r,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2===1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=apt&&EW?xpt(this.buf,t,r):_pt(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==ai.Bytes)return r.push(this.readVarint(t));var e=Xl(this);for(r=r||[];this.pos<e;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==ai.Bytes)return r.push(this.readSVarint());var t=Xl(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==ai.Bytes)return r.push(this.readBoolean());var t=Xl(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==ai.Bytes)return r.push(this.readFloat());var t=Xl(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==ai.Bytes)return r.push(this.readDouble());var t=Xl(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==ai.Bytes)return r.push(this.readFixed32());var t=Xl(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==ai.Bytes)return r.push(this.readSFixed32());var t=Xl(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==ai.Bytes)return r.push(this.readFixed64());var t=Xl(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==ai.Bytes)return r.push(this.readSFixed64());var t=Xl(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=r&7;if(t===ai.Varint)for(;this.buf[this.pos++]>127;);else if(t===ai.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ai.Fixed32)this.pos+=4;else if(t===ai.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Jd(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Jd(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Jd(this.buf,r&-1,this.pos),Jd(this.buf,Math.floor(r*gF),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Jd(this.buf,r&-1,this.pos),Jd(this.buf,Math.floor(r*gF),this.pos+4),this.pos+=8},writeVarint:function(r){if(r=+r||0,r>268435455||r<0){opt(r,this);return}this.realloc(4),this.buf[this.pos++]=r&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=r>>>7&127)))},writeSVarint:function(r){this.writeVarint(r<0?-r*2-1:r*2)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(r.length*4),this.pos++;var t=this.pos;this.pos=bpt(this.buf,r,this.pos);var e=this.pos-t;e>=128&&vF(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(r){this.realloc(4),Tx.write(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Tx.write(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var e=0;e<t;e++)this.buf[this.pos++]=r[e]},writeRawMessage:function(r,t){this.pos++;var e=this.pos;r(t,this);var i=this.pos-e;i>=128&&vF(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeMessage:function(r,t,e){this.writeTag(r,ai.Bytes),this.writeRawMessage(t,e)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,cpt,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,hpt,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,ppt,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,fpt,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,dpt,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,gpt,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,vpt,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,mpt,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,ypt,t)},writeBytesField:function(r,t){this.writeTag(r,ai.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,ai.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,ai.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,ai.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,ai.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,ai.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,ai.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,ai.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,ai.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,ai.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};function spt(r,t,e){var i=e.buf,n,a;if(a=i[e.pos++],n=(a&112)>>4,a<128||(a=i[e.pos++],n|=(a&127)<<3,a<128)||(a=i[e.pos++],n|=(a&127)<<10,a<128)||(a=i[e.pos++],n|=(a&127)<<17,a<128)||(a=i[e.pos++],n|=(a&127)<<24,a<128)||(a=i[e.pos++],n|=(a&1)<<31,a<128))return Kd(r,n,t);throw new Error("Expected varint not more than 10 bytes")}function Xl(r){return r.type===ai.Bytes?r.readVarint()+r.pos:r.pos+1}function Kd(r,t,e){return e?t*4294967296+(r>>>0):(t>>>0)*4294967296+(r>>>0)}function opt(r,t){var e,i;if(r>=0?(e=r%4294967296|0,i=r/4294967296|0):(e=~(-r%4294967296),i=~(-r/4294967296),e^4294967295?e=e+1|0:(e=0,i=i+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),lpt(e,i,t),upt(i,t)}function lpt(r,t,e){e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos]=r&127}function upt(r,t){var e=(r&7)<<4;t.buf[t.pos++]|=e|((r>>>=3)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127)))))}function vF(r,t,e){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));e.realloc(i);for(var n=e.pos-1;n>=r;n--)e.buf[n+i]=e.buf[n]}function cpt(r,t){for(var e=0;e<r.length;e++)t.writeVarint(r[e])}function hpt(r,t){for(var e=0;e<r.length;e++)t.writeSVarint(r[e])}function fpt(r,t){for(var e=0;e<r.length;e++)t.writeFloat(r[e])}function dpt(r,t){for(var e=0;e<r.length;e++)t.writeDouble(r[e])}function ppt(r,t){for(var e=0;e<r.length;e++)t.writeBoolean(r[e])}function gpt(r,t){for(var e=0;e<r.length;e++)t.writeFixed32(r[e])}function vpt(r,t){for(var e=0;e<r.length;e++)t.writeSFixed32(r[e])}function mpt(r,t){for(var e=0;e<r.length;e++)t.writeFixed64(r[e])}function ypt(r,t){for(var e=0;e<r.length;e++)t.writeSFixed64(r[e])}function Ax(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+r[t+3]*16777216}function Jd(r,t,e){r[e]=t,r[e+1]=t>>>8,r[e+2]=t>>>16,r[e+3]=t>>>24}function mF(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}function _pt(r,t,e){for(var i="",n=t;n<e;){var a=r[n],s=null,o=a>239?4:a>223?3:a>191?2:1;if(n+o>e)break;var l,u,c;o===1?a<128&&(s=a):o===2?(l=r[n+1],(l&192)===128&&(s=(a&31)<<6|l&63,s<=127&&(s=null))):o===3?(l=r[n+1],u=r[n+2],(l&192)===128&&(u&192)===128&&(s=(a&15)<<12|(l&63)<<6|u&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):o===4&&(l=r[n+1],u=r[n+2],c=r[n+3],(l&192)===128&&(u&192)===128&&(c&192)===128&&(s=(a&15)<<18|(l&63)<<12|(u&63)<<6|c&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,o=1):s>65535&&(s-=65536,i+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),i+=String.fromCharCode(s),n+=o}return i}function xpt(r,t,e){return EW.decode(r.subarray(t,e))}function bpt(r,t,e){for(var i=0,n,a;i<t.length;i++){if(n=t.charCodeAt(i),n>55295&&n<57344)if(a)if(n<56320){r[e++]=239,r[e++]=191,r[e++]=189,a=n;continue}else n=a-55296<<10|n-56320|65536,a=null;else{n>56319||i+1===t.length?(r[e++]=239,r[e++]=191,r[e++]=189):a=n;continue}else a&&(r[e++]=239,r[e++]=191,r[e++]=189,a=null);n<128?r[e++]=n:(n<2048?r[e++]=n>>6|192:(n<65536?r[e++]=n>>12|224:(r[e++]=n>>18|240,r[e++]=n>>12&63|128),r[e++]=n>>6&63|128),r[e++]=n&63|128)}return e}const gR=Kw(npt);function wpt(r){let t=0;for(let e=0,i=r.length-1,n,a;e<r.length;i=e++)n=r[e],a=r[i],t+=(a[0]-n[0])*(n[1]+a[1]);return t}function IW(r,t){if(Array.isArray(r[0])){for(const i of r)IW(i,t);return}const e=r;e[0]/=t,e[1]/=t}function Spt(r,t){for(let e=0;e<r.length;++e)r[e]/=t}function MW(r,t,e){if(typeof r[0][0]!="number"){for(const s of r)MW(s,t,e);return}const i=e*Math.pow(2,t.z),n=e*t.x,a=e*t.y;for(let s=0;s<r.length;s++){const o=r[s];o[0]=(o[0]+n)*360/i-180;const l=180-(o[1]+a)*360/i;o[1]=360/Math.PI*Math.atan(Math.exp(l*Math.PI/180))-90}}function Tpt(r,t,e){const{x:i,y:n,z:a}=t,s=e*Math.pow(2,a),o=e*i,l=e*n;for(let u=0,c=r.length;u<c;u+=2){r[u]=(r[u]+o)*360/s-180;const h=180-(r[u+1]+l)*360/s;r[u+1]=360/Math.PI*Math.atan(Math.exp(h*Math.PI/180))-90}}function Apt(r){const t=r.length;if(t<=1)return[r];const e=[];let i,n;for(let a=0;a<t;a++){const s=wpt(r[a]);s!==0&&(n===void 0&&(n=s<0),n===s<0?(i&&e.push(i),i=[r[a]]):i&&i.push(r[a]))}return i&&e.push(i),e}function Cpt(r){const t=r.indices.length,e="Polygon";if(t<=1)return{type:e,data:r.data,areas:[[Lb(r.data)]],indices:[r.indices]};const i=[],n=[];let a=[],s=[],o,l=0;for(let u,c=0,h;c<t;c++){h=r.indices[c]-l,u=r.indices[c+1]-l||r.data.length;const p=r.data.slice(h,u),v=Lb(p);if(v===0){const y=r.data.slice(0,h),x=r.data.slice(u);r.data=y.concat(x),l+=u-h;continue}o===void 0&&(o=v<0),o===v<0?(s.length&&(i.push(a),n.push(s)),s=[h],a=[v]):(a.push(v),s.push(h))}return a&&i.push(a),s.length&&n.push(s),{type:e,areas:i,indices:n,data:r.data}}class zb{constructor(t,e,i,n,a,s){st(this,"properties");st(this,"extent");st(this,"type");st(this,"id");st(this,"_pbf");st(this,"_geometry");st(this,"_keys");st(this,"_values");st(this,"_geometryInfo");this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=t,this._geometry=-1,this._keys=n,this._values=a,this._geometryInfo=s,t.readFields(Ept,this,e)}toGeoJSONFeature(t,e){const i=this.loadGeometry();switch(t){case"wgs84":return yF(this,i,n=>MW(n,e,this.extent));default:return yF(this,i,IW)}}toBinaryFeature(t,e){const i=this.loadFlatGeometry();switch(t){case"wgs84":return this._toBinaryCoordinates(i,n=>Tpt(n,e,this.extent));default:return this._toBinaryCoordinates(i,Spt)}}bbox(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let i=1,n=0,a=0,s=0,o=1/0,l=-1/0,u=1/0,c=-1/0;for(;t.pos<e;){if(n<=0){const h=t.readVarint();i=h&7,n=h>>3}if(n--,i===1||i===2)a+=t.readSVarint(),s+=t.readSVarint(),a<o&&(o=a),a>l&&(l=a),s<u&&(u=s),s>c&&(c=s);else if(i!==7)throw new Error(`unknown command ${i}`)}return[o,u,l,c]}_toBinaryCoordinates(t,e){let i;e(t.data,this.extent);const n=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=t.indices.length,i={type:"Point",...t};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=t.indices.length,this._geometryInfo.linePositionsCount+=t.data.length/n,i={type:"LineString",...t};break;case 3:i=Cpt(t),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;for(const s of i.indices)this._geometryInfo.polygonRingsCount+=s.length;this._geometryInfo.polygonPositionsCount+=i.data.length/n;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}const a={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(a.id=this.id),a}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let i=1,n=0,a=0,s=0;const o=[];let l;for(;t.pos<e;){if(n<=0){const u=t.readVarint();i=u&7,n=u>>3}switch(n--,i){case 1:case 2:a+=t.readSVarint(),s+=t.readSVarint(),i===1&&(l&&o.push(l),l=[]),l&&l.push([a,s]);break;case 7:l&&l.push(l[0].slice());break;default:throw new Error(`unknown command ${i}`)}}return l&&o.push(l),o}loadFlatGeometry(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let i=1,n,a=0,s=0,o=0,l=0;const u=[],c=[];for(;t.pos<e;)if(a<=0&&(n=t.readVarint(),i=n&7,a=n>>3),a--,i===1||i===2)s+=t.readSVarint(),o+=t.readSVarint(),i===1&&u.push(l),c.push(s,o),l+=2;else if(i===7){if(l>0){const h=u[u.length-1];c.push(c[h],c[h+1]),l+=2}}else throw new Error(`unknown command ${i}`);return{data:c,indices:u}}}st(zb,"types",["Unknown","Point","LineString","Polygon"]);function yF(r,t,e){let i=zb.types[r.type],n,a,s;switch(r.type){case 1:const l=[];for(n=0;n<t.length;n++)l[n]=t[n][0];s=l,e(s,r.extent);break;case 2:for(s=t,n=0;n<s.length;n++)e(s[n],r.extent);break;case 3:for(s=Apt(t),n=0;n<s.length;n++)for(a=0;a<s[n].length;a++)e(s[n][a],r.extent);break;default:throw new Error("illegal vector tile type")}s.length===1?s=s[0]:i=`Multi${i}`;const o={type:"Feature",geometry:{type:i,coordinates:s},properties:r.properties};return r.id!==null&&(o.properties||(o.properties={}),o.properties.id=r.id),o}function Ept(r,t,e){t&&e&&(r===1?t.id=e.readVarint():r===2?Ipt(e,t):r===3?t.type=e.readVarint():r===4&&(t._geometry=e.pos))}function Ipt(r,t){const e=r.readVarint()+r.pos;for(;r.pos<e;){const i=t._keys[r.readVarint()],n=t._values[r.readVarint()];t.properties[i]=n}}let Mpt=class{constructor(t,e){st(this,"version");st(this,"name");st(this,"extent");st(this,"length");st(this,"_pbf");st(this,"_keys");st(this,"_values");st(this,"_features");this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ppt,this,e),this.length=this._features.length}getGeoJSONFeature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const e=this._pbf.readVarint()+this._pbf.pos;return new zb(this._pbf,e,this.extent,this._keys,this._values)}getBinaryFeature(t,e){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const i=this._pbf.readVarint()+this._pbf.pos;return new zb(this._pbf,i,this.extent,this._keys,this._values,e)}};function Ppt(r,t,e){t&&e&&(r===15?t.version=e.readVarint():r===1?t.name=e.readString():r===5?t.extent=e.readVarint():r===2?t._features.push(e.pos):r===3?t._keys.push(e.readString()):r===4&&t._values.push(Rpt(e)))}function Rpt(r){let t=null;const e=r.readVarint()+r.pos;for(;r.pos<e;){const i=r.readVarint()>>3;t=i===1?r.readString():i===2?r.readFloat():i===3?r.readDouble():i===4?r.readVarint64():i===5?r.readVarint():i===6?r.readSVarint():i===7?r.readBoolean():null}return t}class PW{constructor(t,e){st(this,"layers");this.layers=t.readFields(Dpt,{},e)}}function Dpt(r,t,e){if(r===3&&e){const i=new Mpt(e,e.readVarint()+e.pos);i.length&&t&&(t[i.name]=i)}}function _F(r,t){var n,a;const e=kpt(t),i=((n=t==null?void 0:t.gis)==null?void 0:n.format)||((a=t==null?void 0:t.mvt)==null?void 0:a.shape)||(t==null?void 0:t.shape);switch(i){case"columnar-table":return{shape:"columnar-table",data:XA(r,e)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:xF(r,e)};case"geojson":return xF(r,e);case"binary-geometry":return XA(r,e);case"binary":return XA(r,e);default:throw new Error(i||"undefined shape")}}function XA(r,t){const[e,i]=Lpt(r,t),n=Udt(e,i);return n.byteLength=r.byteLength,n}function Lpt(r,t){const e=[],i={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(r.byteLength<=0)return[e,i];const n=new PW(new gR(r));return(t&&Array.isArray(t.layers)?t.layers:Object.keys(n.layers)).forEach(s=>{const o=n.layers[s];if(o)for(let l=0;l<o.length;l++){const u=o.getBinaryFeature(l,i),c=Npt(u,t,s);e.push(c)}}),[e,i]}function xF(r,t){if(r.byteLength<=0)return[];const e=[],i=new PW(new gR(r));return(Array.isArray(t.layers)?t.layers:Object.keys(i.layers)).forEach(a=>{const s=i.layers[a];if(s)for(let o=0;o<s.length;o++){const l=s.getGeoJSONFeature(o),u=Opt(l,t,a);e.push(u)}}),e}function kpt(r){var t;if(!(r!=null&&r.mvt))throw new Error("mvt options required");if(((t=r.mvt)==null?void 0:t.coordinates)==="wgs84"&&!r.mvt.tileIndex)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return r.gis&&UU.warn('MVTLoader: "options.gis" is deprecated, use "options.mvt.shape" instead')(),r.mvt}function Opt(r,t,e){const i=r.toGeoJSONFeature(t.coordinates||"local",t.tileIndex);return t.layerProperty&&(i.properties||(i.properties={}),i.properties[t.layerProperty]=e),i}function Npt(r,t,e){const i=r.toBinaryFeature(t.coordinates||"local",t.tileIndex);return t.layerProperty&&i.properties&&(i.properties[t.layerProperty]=e),i}const Fpt="4.3.1",RW={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:Fpt,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...RW});const Bpt={Point:DW,MultiPoint:zpt,LineString:LW,MultiLineString:Vpt,Polygon:kW,MultiPolygon:Upt};function DW([r,t],[e,i],n){const a=sg(e[0],i[0],r),s=sg(e[1],i[1],t);return n.unprojectFlat([a,s])}function vR(r,t,e){return r.map(i=>DW(i,t,e))}function zpt(r,t,e){return vR(r,t,e)}function LW(r,t,e){return vR(r,t,e)}function Vpt(r,t,e){return r.map(i=>LW(i,t,e))}function kW(r,t,e){return r.map(i=>vR(i,t,e))}function Upt(r,t,e){return r.map(i=>kW(i,t,e))}function $pt(r,t,e){const i=e.projectFlat([t.west,t.north]),n=e.projectFlat([t.east,t.south]),a=[i,n];return{...r,coordinates:Bpt[r.type](r.coordinates,a,e)}}const Wpt=["points","lines","polygons"];function Hpt(r,t,e,i){for(const n of Wpt){const a=r[n]&&Gpt(r[n],t,e,i);if(a>=0)return a}return-1}function Gpt(r,t,e,i){const n=r.featureIds.value;if(!n.length)return-1;let a=0,s=n[n.length-1]+1;if(i){const l=jpt(r,i);if(l)a=l[0],s=l[1]+1;else return-1}let o=-1;if(t in r.numericProps){const l=r.numericProps[t].value.findIndex((u,c)=>u===e&&n[c]>=a&&n[c]<s);return l>=0?r.globalFeatureIds.value[l]:-1}else t?o=bF(r.properties,l=>l[t]===e,a,s):r.fields&&(o=bF(r.fields,l=>l.id===e,a,s));return o>=0?Xpt(r,o):-1}function jpt(r,t){if(!r.__layers){const e={},{properties:i}=r;for(let n=0;n<i.length;n++){const{layerName:a}=i[n];a&&(e[a]?e[a][1]=n:e[a]=[n,n])}r.__layers=e}return r.__layers[t]}function Xpt(r,t){if(!r.__ids){const e=[],i=r.featureIds.value,n=r.globalFeatureIds.value;for(let a=0;a<i.length;a++)e[i[a]]=n[a];r.__ids=e}return r.__ids[t]}function bF(r,t,e,i){for(let n=e;n<i;n++)if(t(r[n],n))return n;return-1}const ZA=512,Zpt={...fS.defaultProps,data:xW,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[RW],binary:!0};class mR extends Odt{initializeState(){super.initializeState();const t=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:t,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var t;return!!((t=this.state)!=null&&t.data&&super.isLoaded)}updateState({props:t,oldProps:e,context:i,changeFlags:n}){var s;n.dataChanged&&this._updateTileData(),(s=this.state)!=null&&s.data&&(super.updateState({props:t,oldProps:e,context:i,changeFlags:n}),this._setWGS84PropertyForTiles());const{highlightColor:a}=t;a!==e.highlightColor&&Array.isArray(a)&&this.setState({highlightColor:a})}async _updateTileData(){let t=this.props.data,e=null;if(typeof t=="string"&&!wdt(t)){const{onDataLoad:i,fetch:n}=this.props;this.setState({data:null,tileJSON:null});try{e=await n(t,{propName:"data",layer:this,loaders:[]})}catch(a){this.raiseError(a,"loading TileJSON"),t=null}i&&i(e,{propName:"data",layer:this})}else t&&typeof t=="object"&&"tilejson"in t&&(e=t);e&&(t=e.tiles),this.setState({data:t,tileJSON:e})}_getTilesetOptions(){const t=super._getTilesetOptions(),e=this.state.tileJSON,{minZoom:i,maxZoom:n}=this.props;return e&&(Number.isFinite(e.minzoom)&&e.minzoom>i&&(t.minZoom=e.minzoom),Number.isFinite(e.maxzoom)&&(!Number.isFinite(n)||e.maxzoom<n)&&(t.maxZoom=e.maxzoom)),t}renderLayers(){var t;return(t=this.state)!=null&&t.data?super.renderLayers():null}getTileData(t){const{data:e,binary:i}=this.state,{index:n,signal:a}=t,s=Nb(e,t);if(!s)return Promise.reject("Invalid URL");let o=this.getLoadOptions();const{fetch:l}=this.props;return o={...o,mimeType:"application/x-protobuf",mvt:{...o==null?void 0:o.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:n},gis:i?{format:"binary"}:{}},l(s,{propName:"data",layer:this,loadOptions:o,signal:a})}renderSubLayers(t){const{x:e,y:i,z:n}=t.tile.index,a=Math.pow(2,n),s=ZA/a,o=-s,l=ZA*e/a,u=ZA*(1-i/a),c=new wa().scale([s,o,1]);t.autoHighlight=!1,this.context.viewport.resolution||(t.modelMatrix=c,t.coordinateOrigin=[l,u,0],t.coordinateSystem=Qr.CARTESIAN,t.extensions=[...t.extensions||[],new TW]);const h=super.renderSubLayers(t);return this.state.binary&&!(h instanceof fS)&&Wr.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),h}_updateAutoHighlight(t){const{uniqueIdProperty:e}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:n}=this.state,a=t.object;let s=null,o=null;a&&(s=qA(a,e),o=wF(a));let{highlightColor:l}=this.props;typeof l=="function"&&(l=l(t)),(i!==s||n!==o)&&this.setState({highlightColor:l,hoveredFeatureId:s,hoveredFeatureLayerName:o})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(t){const e=super.getPickingInfo(t);if(this.state.binary&&e.index!==-1){const{data:i}=t.sourceLayer.props;e.object=pF(i,{globalFeatureId:e.index})}return e.object&&!this._isWGS84()&&(e.object=TF(e.object,e.tile.bbox,this.context.viewport)),e}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){const{hoveredFeatureId:e,hoveredFeatureLayerName:i,binary:n}=this.state,{uniqueIdProperty:a,highlightedFeatureId:s}=this.props,o=t.content,l=SF(s);if(!(SF(e)||l))return-1;const c=l?s:e;return Array.isArray(o)?o.findIndex(h=>{const p=qA(h,a)===c,v=l||wF(h)===i;return p&&v}):o&&n?Hpt(o,a,c,l?"":i):-1}_pickObjects(t){const{deck:e,viewport:i}=this.context,n=i.width,a=i.height,s=i.x,o=i.y,l=[this.id];return e.pickObjects({x:s,y:o,width:n,height:a,layerIds:l,maxObjects:t})}getRenderedFeatures(t=null){const e=this._pickObjects(t),i=new Set,n=[];for(const a of e){const s=qA(a.object,this.props.uniqueIdProperty);s===void 0?n.push(a.object):i.has(s)||(i.add(s),n.push(a.object))}return n}_setWGS84PropertyForTiles(){const t="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(t)||Object.defineProperty(i,t,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];const{bbox:n}=i;if(i._contentWGS84===void 0&&Sdt(n)){const a=this.state.binary?pF(i.content):i.content;i._contentWGS84=a.map(s=>TF(s,n,this.context.viewport))}return i._contentWGS84}})})}}mR.layerName="MVTLayer";mR.defaultProps=Zpt;const OW=mR;function qA(r,t){if(r.properties&&t)return r.properties[t];if("id"in r)return r.id}function wF(r){var t;return((t=r.properties)==null?void 0:t.layerName)||null}function SF(r){return r!=null&&r!==""}function TF(r,t,e){const i={...r,geometry:{type:r.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>$pt(r.geometry,t,e).coordinates}),i}const qpt=512,Ypt=.5;function NW(r,t,e){const i=t.type===2?t.readVarint()+t.pos:t.pos+1;return e.value=new r(t.buf.buffer.slice(t.pos,i)),t.pos=i,e.value}class yR{static read(t,e){return t.readFields(yR._readField,{key:"",value:null},e)}static _readField(t,e,i){t===1?e.key=i.readString():t===2&&(e.value=i.readString())}}class Ag{static read(t,e){return t.readFields(Ag._readField,{},e)}static _readField(t,e,i){if(t===1){const{key:n,value:a}=yR.read(i,i.readVarint()+i.pos);e[n]=a}}}class S_{static read(t,e){const{value:i,size:n}=t.readFields(S_._readField,{value:[],size:0},e);return{value:i,size:n}}static _readField(t,e,i){t===1?NW(Float64Array,i,e):t===2&&(e.size=i.readVarint(!0))}}class Js{static read(t,e){const{value:i,size:n}=t.readFields(Js._readField,{value:[],size:0},e);return{value:new Uint32Array(i),size:n}}static _readField(t,e,i){t===1?i.readPackedVarint(e.value):t===2&&(e.size=i.readVarint(!0))}}class T_{static read(t,e){return t.readFields(T_._readField,{id:0},e)}static _readField(t,e,i){t===1&&(e.id=i.readVarint())}}class _R{static read(t,e){return t.readFields(_R._readField,{value:[]},e)}static _readField(t,e,i){t===1&&NW(Float64Array,i,e)}}class Cg{static read(t,e){return t.readFields(Cg._readField,{key:"",value:null},e)}static _readField(t,e,i){t===1?e.key=i.readString():t===2&&(e.value=_R.read(i,i.readVarint()+i.pos))}}class xR{static read(t,e){return t.readFields(xR._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},e)}static _readField(t,e,i){if(t===1)e.positions=S_.read(i,i.readVarint()+i.pos);else if(t===2)e.globalFeatureIds=Js.read(i,i.readVarint()+i.pos);else if(t===3)e.featureIds=Js.read(i,i.readVarint()+i.pos);else if(t===4)e.properties.push(Ag.read(i,i.readVarint()+i.pos));else if(t===5){const n=Cg.read(i,i.readVarint()+i.pos);e.numericProps[n.key]=n.value}else t===6&&e.fields.push(T_.read(i,i.readVarint()+i.pos))}}class bR{static read(t,e){return t.readFields(bR._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},e)}static _readField(t,e,i){if(t===1)e.positions=S_.read(i,i.readVarint()+i.pos);else if(t===2)e.pathIndices=Js.read(i,i.readVarint()+i.pos);else if(t===3)e.globalFeatureIds=Js.read(i,i.readVarint()+i.pos);else if(t===4)e.featureIds=Js.read(i,i.readVarint()+i.pos);else if(t===5)e.properties.push(Ag.read(i,i.readVarint()+i.pos));else if(t===6){const n=Cg.read(i,i.readVarint()+i.pos);e.numericProps[n.key]=n.value}else t===7&&e.fields.push(T_.read(i,i.readVarint()+i.pos))}}class wR{static read(t,e){return t.readFields(wR._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},e)}static _readField(t,e,i){if(t===1)e.positions=S_.read(i,i.readVarint()+i.pos);else if(t===2)e.polygonIndices=Js.read(i,i.readVarint()+i.pos);else if(t===3)e.globalFeatureIds=Js.read(i,i.readVarint()+i.pos);else if(t===4)e.featureIds=Js.read(i,i.readVarint()+i.pos);else if(t===5)e.primitivePolygonIndices=Js.read(i,i.readVarint()+i.pos);else if(t===6)e.triangles=Js.read(i,i.readVarint()+i.pos);else if(t===7)e.properties.push(Ag.read(i,i.readVarint()+i.pos));else if(t===8){const n=Cg.read(i,i.readVarint()+i.pos);e.numericProps[n.key]=n.value}else t===9&&e.fields.push(T_.read(i,i.readVarint()+i.pos))}}let Kpt=class FW{static read(t,e){return t.readFields(FW._readField,{points:null,lines:null,polygons:null},e)}static _readField(t,e,i){t===1?e.points=xR.read(i,i.readVarint()+i.pos):t===2?e.lines=bR.read(i,i.readVarint()+i.pos):t===3&&(e.polygons=wR.read(i,i.readVarint()+i.pos))}};function BW(r,t){const e=new gR(r);return t.read(e)}function Jpt(r,t){return`https://unpkg.com/@deck.gl/carto@${t}/dist/${r}-worker.js`}const Qpt=r=>r!==null&&typeof r=="object",tgt=r=>Qpt(r)&&r.constructor==={}.constructor;function egt(r,t){var e,i,n;(i=(e=r==null?void 0:r.fetch)==null?void 0:e.headers)!=null&&i.Authorization||(r.fetch={...r.fetch,headers:{...(n=r.fetch)==null?void 0:n.headers,Authorization:`Bearer ${t}`}})}function rgt(r,t){const e={};for(const{geoid:i,...n}of t.properties)i in e?Wr.warn("Duplicate geoid key in boundary mapping, using first occurance")():e[i]=n;for(const i of["points","lines","polygons"]){const n=r[i];if(n.positions.value.length===0)continue;n.properties=n.properties.map(({geoid:u})=>e[u]);const{positions:a,globalFeatureIds:s}=n;let o=null;i==="lines"&&(o=n.pathIndices.value),i==="polygons"&&(o=n.polygonIndices.value);const l=a.value.length/a.size;for(const u in t.numericProps){const c=t.numericProps[u].value,h=c.constructor,p=new h(l);if(n.numericProps[u]={value:p,size:1},o)for(let v=0;v<o.length-1;v++){const y=o[v],x=o[v+1],w=s.value[y];p.fill(c[w],y,x)}else for(let v=0;v<l;v++){const y=s.value[v];p[v]=c[y]}}}return r}const AF={type:"object",value:null,validate:(r,t)=>t.optional&&r===null||typeof r=="object"&&Array.isArray(r.tiles)&&r.tiles.every(e=>typeof e=="string"),equal:(r,t)=>As(r,t,2),async:!0};class SR{static read(t,e){return t.readFields(SR._readField,{properties:[],numericProps:{}},e)}static _readField(t,e,i){if(t===1)e.properties.push(Ag.read(i,i.readVarint()+i.pos));else if(t===2){const n=Cg.read(i,i.readVarint()+i.pos);e.numericProps[n.key]=n.value}}}const igt={name:"CARTO Properties Tile",version:"1",id:"cartoPropertiesTile",module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-properties-tile"],category:"geometry",worker:!1,parse:async(r,t)=>CF(r),parseSync:CF,options:{}};function CF(r,t){return r?BW(r,SR):null}const ngt=igt,zW="9.0.36",VW="cartoVectorTile",agt={cartoVectorTile:{workerUrl:Jpt(VW,zW)}},sgt={name:"CARTO Vector Tile",version:zW,id:VW,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(r,t)=>EF(r),parseSync:EF,worker:!0,options:agt};function ogt(r,t,{startPosition:e,endPosition:i,indices:n}){const a=r.positions.size,s=e*a,o=i*a,l=r.positions.value.subarray(s,o),u=n.slice(1).map(h=>h-e),c=hW(l,u,a);for(let h=0,p=c.length;h<p;++h)t.push(e+c[h])}function lgt(r){const{polygonIndices:t,primitivePolygonIndices:e}=r,i=[];let n=0;for(let a=0;a<t.value.length-1;a++){const s=t.value[a],o=t.value[a+1],l=e.value.indexOf(o),u=e.value.subarray(n,l);n=l,ogt(r,i,{startPosition:s,endPosition:o,indices:u})}r.triangles={value:new Uint32Array(i),size:1}}function EF(r,t){if(!r)return null;const e=BW(r,Kpt);return e.polygons&&!e.polygons.triangles&&lgt(e.polygons),e}const ugt=sgt;t8([ngt,ugt]);const cgt={...OW.defaultProps,data:AF,dataComparator:AF.equal,tileSize:qpt};class TR extends OW{constructor(...t){super(...t)}initializeState(){super.initializeState(),this.setState({binary:!0})}updateState(t){const{props:e}=t;if(e.data){super.updateState(t);const n=new URL(e.data.tiles[0]).searchParams.get("formatTiles")==="mvt";this.setState({mvt:n})}}getLoadOptions(){const t=super.getLoadOptions()||{},e=this.props.data;return egt(t,e.accessToken),t.gis={format:"binary"},t}async getTileData(t){const e=this.props.data,{tiles:i,properties_tiles:n}=e,a=Nb(i,t);if(!a)return Promise.reject("Invalid URL");const s=this.getLoadOptions(),{fetch:o}=this.props,{signal:l}=t,u=o(a,{propName:"data",layer:this,loadOptions:s,signal:l});if(!n)return await u;const c=Nb(n,t);if(!c)return Promise.reject("Invalid properties URL");const h=o(c,{propName:"data",layer:this,loadOptions:s,signal:l}),[p,v]=await Promise.all([u,h]);return p?v?rgt(p,v):p:null}renderSubLayers(t){if(t.data===null)return null;if(this.state.mvt)return super.renderSubLayers(t);const e=t.tile.bbox,{west:i,south:n,east:a,north:s}=e,o=[new TW,...t.extensions||[]],l={clipBounds:[i,n,a,s]},u=p=>{var v,y,x;return{[p]:{...l,...(v=t==null?void 0:t._subLayerProps)==null?void 0:v[p],extensions:[...o,...((x=(y=t==null?void 0:t._subLayerProps)==null?void 0:y[p])==null?void 0:x.extensions)||[]]}}},c={...t,autoHighlight:!1,_subLayerProps:{...t._subLayerProps,...u("polygons-fill"),...u("polygons-stroke"),...u("linestrings")}};return new fS(c)}_isWGS84(){return this.state.mvt?super._isWGS84():!0}}TR.layerName="VectorTileLayer";TR.defaultProps=cgt;const hgt=TR;class fgt extends Error{constructor(t,e,i,n){let a="Failed to connect";i&&(a="Server returned: ",i.status===400?a+="Bad request":i.status===401||i.status===403?a+="Unauthorized access":i.status===404?a+="Not found":a+="Error",a+=` (${i.status}):`),a+=` ${t.message||t}`;let s=`${e.requestType} API request failed`;s+=`
${a}`;for(const o of Object.keys(e))o!=="requestType"&&(s+=`
${dgt(o)}: ${e[o]}`);s+=`
`,super(s),this.name="CartoAPIError",this.response=i,this.responseJson=n,this.error=t,this.errorContext=e}}function dgt(r){return r.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())}const pgt="https://basemaps.cartocdn.com/gl/{basemap}-gl-style/style.json";function Qd(r){return pgt.replace("{basemap}",r)}const ggt={VOYAGER:Qd("voyager"),POSITRON:Qd("positron"),DARK_MATTER:Qd("dark-matter"),VOYAGER_NOLABELS:Qd("voyager-nolabels"),POSITRON_NOLABELS:Qd("positron-nolabels"),DARK_MATTER_NOLABELS:Qd("dark-matter-nolabels")},vgt="https://gcp-us-east1.api.carto.com",mgt="deck-gl-carto",ygt="3.4",UW=7e3;function _gt(...r){return r.map(t=>t.endsWith("/")?t.slice(0,-1):t).join("/")}function xgt(r,t,e,...i){return _gt(r,t,e,...i)}function bgt({apiBaseUrl:r,connectionName:t,endpoint:e}){return xgt(r,"v3","maps",t,e)}const wgt={v:ygt,deckglVersion:u8},Sgt={Accept:"application/json","Content-Type":"application/json"},Cx=new Map;async function YA({baseUrl:r,parameters:t={},headers:e={},errorContext:i,maxLengthURL:n=UW}){t={...wgt,...t},r=Cgt(r,Object.keys(t));const a=Tgt(r,t,e);if(Cx.has(a))return Cx.get(a);const s=Agt(r,t),o={...Sgt,...e},l=s.length>n?fetch(r,{method:"POST",body:JSON.stringify(t),headers:o}):fetch(s,{headers:o});let u,c;const h=l.then(p=>(u=p,u.json())).then(p=>{if(c=p,!u||!u.ok)throw new Error(p.error);return p}).catch(p=>{throw Cx.delete(a),new fgt(p,i,u,c)});return Cx.set(a,h),h}function Tgt(r,t,e){const i=Object.entries(t).sort(([a],[s])=>a>s?1:-1),n=Object.entries(e).sort(([a],[s])=>a>s?1:-1);return JSON.stringify({baseUrl:r,parameters:i,headers:n})}function Agt(r,t){const e=new URL(r);for(const[i,n]of Object.entries(t))tgt(n)||Array.isArray(n)?e.searchParams.set(i,JSON.stringify(n)):e.searchParams.set(i,n.toString());return e.toString()}function Cgt(r,t){const e=new URL(r);for(const i of t)e.searchParams.has(i)&&e.searchParams.delete(i);return e.toString()}const Egt={apiBaseUrl:vgt,clientId:mgt,format:"tilejson",headers:{},maxLengthURL:UW};async function Igt(r,t,e){const{accessToken:i,connectionName:n,cache:a,...s}=t,o={...Egt,accessToken:i,connectionName:n,endpoint:r};for(const T in s)s[T]&&(o[T]=s[T]);const l=bgt(o),{clientId:u,maxLengthURL:c,format:h}=o,p={Authorization:`Bearer ${t.accessToken}`,...t.headers},v={client:u,...e},y={requestType:"Map instantiation",connection:t.connectionName,type:r,source:JSON.stringify(v,void 0,2)},w=(await YA({baseUrl:l,parameters:v,headers:p,errorContext:y,maxLengthURL:c}))[h].url[0];if(a&&(a.value=parseInt(new URL(w).searchParams.get("cache")||"",10)),y.requestType="Map data",h==="tilejson"){const T=await YA({baseUrl:w,headers:p,errorContext:y,maxLengthURL:c});return i&&(T.accessToken=i),T}return await YA({baseUrl:w,headers:p,errorContext:y,maxLengthURL:c})}const Mgt=async function(r){const{columns:t,filters:e,spatialDataColumn:i="geom",tableName:n,tileResolution:a=Ypt}=r,s={name:n,spatialDataColumn:i,spatialDataType:"geo",tileResolution:a.toString()};return t&&(s.columns=t.join(",")),e&&(s.filters=e),Igt("table",r,s)};let Pgt="carto-api-client";function Rgt(){return Pgt}var Uf;(function(r){r.IN="in",r.BETWEEN="between",r.CLOSED_OPEN="closed_open",r.TIME="time",r.STRING_SEARCH="stringSearch"})(Uf||(Uf={}));const Dgt=new Set(Object.values(Uf)),Lgt=r=>Dgt.has(r);function kgt(r,t){if(!t)return{};const e={};for(const i in t)for(const n in t[i]){if(!Lgt(n))continue;const a=t[i][n],s=!r||!(a!=null&&a.owner)||(a==null?void 0:a.owner)!==r;a&&s&&(e[i]||(e[i]={}),e[i][n]=a)}return e}function lc(r){return Array.isArray(r)?r.map(t=>lc(t)):typeof r!="object"?r:Object.entries(r).reduce((t,[e,i])=>(t[e.toLowerCase()]=typeof i=="object"&&i?lc(i):i,t),{})}function qu(r,t){if(!r)throw new Error(t)}class _c extends Error{constructor(t){super(`${_c.NAME}: ${t}`),this.name=_c.NAME}static is(t){var e;return t instanceof _c||((e=t.message)==null?void 0:e.includes(_c.NAME))}}_c.NAME="InvalidColumnError";function Ogt(r){for(const t in r)return!1;return!0}function CI(r,{column:t,type:e,values:i,owner:n}){r[t]||(r[t]={});const a={values:i,owner:n};return r[t][e]=a,r}function $W(r,{column:t,owner:e}){const i=r[t];if(!i)return r;if(e)for(const a of Object.values(Uf)){var n;e===((n=i[a])==null?void 0:n.owner)&&delete i[a]}return(!e||Ogt(i))&&delete r[t],r}function Ngt(r){for(const t of Object.keys(r))delete r[t];return r}function Fgt(r){if(!zgt(r))return Bgt(oct(r).geometry)}function Bgt(r){return r&&Vgt(r)||void 0}function zgt(r){const[t,e,i,n]=r;return i-t>179.5*2&&n-e>85.05*2}function Vgt(r){const t=[-180,-90,180,90],e=em(NA(r,t).geometry),i=IF(r,360),n=IF(r,-360);let a=e;if(a&&i){const s=em(NA(i,t).geometry);if(s){const o=mN([vc(a),vc(s)]),l=DN(o);a=l?em(l.geometry):a}}if(a&&n){const s=em(NA(n,t).geometry);if(s){const o=mN([vc(a),vc(s)]),l=DN(o);a=l?em(l.geometry):a}}return a}function WW(r){const t=r.filter(e=>e.length>0);return t.length>0?t:null}function Ugt(r){const t=r.map(WW).filter(e=>e);return t.length>0?t:null}function em(r){if(!r)return null;if(Hgt(r)){const t=WW(r.coordinates);return t?b_(t).geometry:null}if(Ggt(r)){const t=Ugt(r.coordinates);return t?lS(t).geometry:null}return null}function $gt(r,t){return r.map(e=>[e[0]+t,e[1]])}function HW(r,t){return r.map(e=>$gt(e,t))}function Wgt(r,t){return r.map(e=>HW(e,t))}function IF(r,t){if(r&&Mb(r)==="Polygon"){const e=HW(r.coordinates,t);return b_(e).geometry}else if(r&&Mb(r)==="MultiPolygon"){const e=Wgt(r.coordinates,t);return lS(e).geometry}else return null}function Hgt(r){return Mb(r)==="Polygon"}function Ggt(r){return Mb(r)==="MultiPolygon"}function $a(){return $a=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)({}).hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},$a.apply(null,arguments)}function wh(r,t){if(r==null)return{};var e={};for(var i in r)if({}.hasOwnProperty.call(r,i)){if(t.includes(i))continue;e[i]=r[i]}return e}const jgt="https://gcp-us-east1.api.carto.com",GW="geom";var Vb;(function(r){r.TABLE="table",r.QUERY="query",r.TILESET="tileset"})(Vb||(Vb={}));var Ub;(function(r){r.V1="v1",r.V2="v2",r.V3="v3"})(Ub||(Ub={}));function Xgt({response:r,data:t}){var e,i;if(t.error==="Column not found")throw new _c(`${t.error} ${t.column_name}`);if((e=t.error)!=null&&e.includes("Missing columns"))throw new _c(t.error);switch(r.status){case 401:throw new Error("Unauthorized access. Invalid credentials");case 403:throw new Error("Forbidden access to the requested data");default:const n=t&&t.error&&typeof t.error=="string"?t.error:JSON.stringify((t==null?void 0:t.hint)||((i=t.error)==null?void 0:i[0]));throw new Error(n)}}async function Zgt({url:r,accessToken:t,opts:e}){let i,n;const a=(e==null?void 0:e.method)==="POST";try{var s;i=await fetch(r.toString(),$a({headers:$a({Authorization:`Bearer ${t}`},a&&{"Content-Type":"application/json"})},a&&{method:e==null?void 0:e.method,body:e==null?void 0:e.body},{signal:e==null||(s=e.abortController)==null?void 0:s.signal},e==null?void 0:e.otherOptions)),n=await i.json()}catch(o){throw o.name==="AbortError"?o:new Error(`Failed request: ${o}`)}return i.ok||Xgt({response:i,data:n}),n}const MF=["category","histogram","formula","timeseries","range","scatterplot","table"],{V3:qgt}=Ub,Ygt=2048;function Sh(r){qu(r.source,"executeModel: missing source"),qu(r.model,"executeModel: missing model"),qu(r.params,"executeModel: missing params"),qu(MF.includes(r.model),`executeModel: model provided isn't valid. Available models: ${MF.join(", ")}`);const{model:t,source:e,params:i,opts:n}=r,{type:a,apiVersion:s,apiBaseUrl:o,accessToken:l,connectionName:u,clientId:c}=e;qu(o,"executeModel: missing apiBaseUrl"),qu(l,"executeModel: missing accessToken"),qu(s===qgt,"executeModel: SQL Model API requires CARTO 3+"),qu(a!==Vb.TILESET,"executeModel: Tilesets not supported");let h=`${o}/v3/sql/${u}/model/${t}`;const{filters:p,filtersLogicalOperator:v="and",data:y}=e,x=e.queryParameters?JSON.stringify(e.queryParameters):"",w={type:a,client:c,source:y,params:JSON.stringify(i),queryParameters:x,filters:JSON.stringify(p),filtersLogicalOperator:v},T=e.spatialFilter?{[e.geoColumn?e.geoColumn:GW]:e.spatialFilter}:void 0;T&&(w.spatialFilters=JSON.stringify(T));const E=h+"?"+new URLSearchParams(w).toString(),M=E.length<=Ygt;return M?h=E:(w.params=i,w.filters=p,w.queryParameters=e.queryParameters,T&&(w.spatialFilters=T)),Zgt({url:h,accessToken:e.accessToken,opts:$a({},n,{method:M?"GET":"POST"},!M&&{body:JSON.stringify(w)})})}const Kgt=["filterOwner","spatialFilter","abortController"],Jgt=["filterOwner","spatialFilter","abortController","operationExp"],Qgt=["filterOwner","spatialFilter","abortController"],tvt=["filterOwner","spatialFilter","abortController"],evt=["filterOwner","spatialFilter","abortController"],rvt=["filterOwner","spatialFilter","abortController"],ivt=["filterOwner","abortController","spatialFilter"];class pS{constructor(t){this.props=void 0,this.props=$a({},pS.defaultProps,t)}_getModelSource(t){const e=this.props;return{apiVersion:e.apiVersion,apiBaseUrl:e.apiBaseUrl,clientId:e.clientId,accessToken:e.accessToken,connectionName:e.connectionName,filters:kgt(t,e.filters),filtersLogicalOperator:e.filtersLogicalOperator,geoColumn:e.geoColumn}}async getCategories(t){const{filterOwner:e,spatialFilter:i,abortController:n}=t,a=wh(t,Kgt),{column:s,operation:o,operationColumn:l}=a;return Sh({model:"category",source:$a({},this.getModelSource(e),{spatialFilter:i}),params:{column:s,operation:o,operationColumn:l||s},opts:{abortController:n}}).then(u=>lc(u.rows))}async getFormula(t){const{filterOwner:e,spatialFilter:i,abortController:n,operationExp:a}=t,s=wh(t,Jgt),{column:o,operation:l}=s;return Sh({model:"formula",source:$a({},this.getModelSource(e),{spatialFilter:i}),params:{column:o??"*",operation:l,operationExp:a},opts:{abortController:n}}).then(u=>lc(u.rows[0]))}async getHistogram(t){const{filterOwner:e,spatialFilter:i,abortController:n}=t,a=wh(t,Qgt),{column:s,operation:o,ticks:l}=a,u=await Sh({model:"histogram",source:$a({},this.getModelSource(e),{spatialFilter:i}),params:{column:s,operation:o,ticks:l},opts:{abortController:n}}).then(c=>lc(c.rows));if(u.length){const c=Array(l.length+1).fill(0);return u.forEach(({tick:h,value:p})=>c[h]=p),c}return[]}async getRange(t){const{filterOwner:e,spatialFilter:i,abortController:n}=t,a=wh(t,tvt),{column:s}=a;return Sh({model:"range",source:$a({},this.getModelSource(e),{spatialFilter:i}),params:{column:s},opts:{abortController:n}}).then(o=>lc(o.rows[0]))}async getScatter(t){const{filterOwner:e,spatialFilter:i,abortController:n}=t,a=wh(t,evt),{xAxisColumn:s,xAxisJoinOperation:o,yAxisColumn:l,yAxisJoinOperation:u}=a,c=500;return Sh({model:"scatterplot",source:$a({},this.getModelSource(e),{spatialFilter:i}),params:{xAxisColumn:s,xAxisJoinOperation:o,yAxisColumn:l,yAxisJoinOperation:u,limit:c},opts:{abortController:n}}).then(h=>lc(h.rows)).then(h=>h.map(({x:p,y:v})=>[p,v]))}async getTable(t){const{filterOwner:e,spatialFilter:i,abortController:n}=t,a=wh(t,rvt),{columns:s,sortBy:o,sortDirection:l,offset:u=0,limit:c=10}=a;return Sh({model:"table",source:$a({},this.getModelSource(e),{spatialFilter:i}),params:{column:s,sortBy:o,sortDirection:l,limit:c,offset:u},opts:{abortController:n}}).then(h=>{var p,v,y,x;return{rows:(p=h.rows)!=null?p:h.ROWS,totalCount:(v=(y=h.metadata)==null?void 0:y.total)!=null?v:(x=h.METADATA)==null?void 0:x.TOTAL}})}async getTimeSeries(t){const{filterOwner:e,abortController:i,spatialFilter:n}=t,a=wh(t,ivt),{column:s,operationColumn:o,joinOperation:l,operation:u,stepSize:c,stepMultiplier:h,splitByCategory:p,splitByCategoryLimit:v,splitByCategoryValues:y}=a;return Sh({model:"timeseries",source:$a({},this.getModelSource(e),{spatialFilter:n}),params:{column:s,stepSize:c,stepMultiplier:h,operationColumn:o||s,joinOperation:l,operation:u,splitByCategory:p,splitByCategoryLimit:v,splitByCategoryValues:y},opts:{abortController:i}}).then(x=>{var w;return{rows:lc(x.rows),categories:(w=x.metadata)==null?void 0:w.categories}})}}pS.defaultProps={apiVersion:Ub.V3,apiBaseUrl:jgt,clientId:Rgt(),filters:{},filtersLogicalOperator:"and",geoColumn:GW};class nvt extends pS{getModelSource(t){return $a({},super._getModelSource(t),{type:Vb.TABLE,data:this.props.tableName})}}async function avt(r){svt(r);const t=await Mgt(r);return $a({},t,{widgetSource:new nvt(r)})}function svt(r){typeof deck<"u"&&deck&&deck.VERSION&&(r.clientId||(r.clientId="deck-gl-carto"))}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var EI=function(r,t){return EI=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])},EI(r,t)};function Vt(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");EI(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var ovt=function(){function r(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1}return r}(),lvt=function(){function r(){this.browser=new ovt,this.node=!1,this.wxa=!1,this.worker=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1,this.transformSupported=!1,this.transform3dSupported=!1,this.hasGlobalWindow=typeof window<"u"}return r}(),qh=new lvt;typeof wx=="object"&&typeof wx.getSystemInfoSync=="function"?(qh.wxa=!0,qh.touchEventsSupported=!0):typeof document>"u"&&typeof self<"u"?qh.worker=!0:typeof navigator>"u"||navigator.userAgent.indexOf("Node.js")===0?(qh.node=!0,qh.svgSupported=!0):uvt(navigator.userAgent,qh);function uvt(r,t){var e=t.browser,i=r.match(/Firefox\/([\d.]+)/),n=r.match(/MSIE\s([\d.]+)/)||r.match(/Trident\/.+?rv:(([\d.]+))/),a=r.match(/Edge?\/([\d.]+)/),s=/micromessenger/i.test(r);i&&(e.firefox=!0,e.version=i[1]),n&&(e.ie=!0,e.version=n[1]),a&&(e.edge=!0,e.version=a[1],e.newEdge=+a[1].split(".")[0]>18),s&&(e.weChat=!0),t.svgSupported=typeof SVGRect<"u",t.touchEventsSupported="ontouchstart"in window&&!e.ie&&!e.edge,t.pointerEventsSupported="onpointerdown"in window&&(e.edge||e.ie&&+e.version>=11),t.domSupported=typeof document<"u";var o=document.documentElement.style;t.transform3dSupported=(e.ie&&"transition"in o||e.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in o)&&!("OTransition"in o),t.transformSupported=t.transform3dSupported||e.ie&&+e.version>=9}const Or=qh;var AR=12,jW="sans-serif",zc=AR+"px "+jW,cvt=20,hvt=100,fvt="007LLmW'55;N0500LLLLLLLLLL00NNNLzWW\\\\WQb\\0FWLg\\bWb\\WQ\\WrWWQ000CL5LLFLL0LL**F*gLLLL5F0LF\\FFF5.5N";function dvt(r){var t={};if(typeof JSON>"u")return t;for(var e=0;e<r.length;e++){var i=String.fromCharCode(e+32),n=(r.charCodeAt(e)-cvt)/hvt;t[i]=n}return t}var pvt=dvt(fvt),Vc={createCanvas:function(){return typeof document<"u"&&document.createElement("canvas")},measureText:function(){var r,t;return function(e,i){if(!r){var n=Vc.createCanvas();r=n&&n.getContext("2d")}if(r)return t!==i&&(t=r.font=i||zc),r.measureText(e);e=e||"",i=i||zc;var a=/((?:\d+)?\.?\d*)px/.exec(i),s=a&&+a[1]||AR,o=0;if(i.indexOf("mono")>=0)o=s*e.length;else for(var l=0;l<e.length;l++){var u=pvt[e[l]];o+=u==null?s:u*s}return{width:o}}}(),loadImage:function(r,t,e){var i=new Image;return i.onload=t,i.onerror=e,i.src=r,i}},XW=bl(["Function","RegExp","Date","Error","CanvasGradient","CanvasPattern","Image","Canvas"],function(r,t){return r["[object "+t+"]"]=!0,r},{}),ZW=bl(["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64"],function(r,t){return r["[object "+t+"Array]"]=!0,r},{}),Eg=Object.prototype.toString,gS=Array.prototype,gvt=gS.forEach,vvt=gS.filter,CR=gS.slice,mvt=gS.map,PF=(function(){}).constructor,Ex=PF?PF.prototype:null,ER="__proto__",yvt=2311;function qW(){return yvt++}function IR(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];typeof console<"u"&&console.error.apply(console,r)}function Ze(r){if(r==null||typeof r!="object")return r;var t=r,e=Eg.call(r);if(e==="[object Array]"){if(!iy(r)){t=[];for(var i=0,n=r.length;i<n;i++)t[i]=Ze(r[i])}}else if(ZW[e]){if(!iy(r)){var a=r.constructor;if(a.from)t=a.from(r);else{t=new a(r.length);for(var i=0,n=r.length;i<n;i++)t[i]=r[i]}}}else if(!XW[e]&&!iy(r)&&!fg(r)){t={};for(var s in r)r.hasOwnProperty(s)&&s!==ER&&(t[s]=Ze(r[s]))}return t}function cr(r,t,e){if(!je(t)||!je(r))return e?Ze(t):r;for(var i in t)if(t.hasOwnProperty(i)&&i!==ER){var n=r[i],a=t[i];je(a)&&je(n)&&!Kt(a)&&!Kt(n)&&!fg(a)&&!fg(n)&&!RF(a)&&!RF(n)&&!iy(a)&&!iy(n)?cr(n,a,e):(e||!(i in r))&&(r[i]=Ze(t[i]))}return r}function MR(r,t){for(var e=r[0],i=1,n=r.length;i<n;i++)e=cr(e,r[i],t);return e}function Zt(r,t){if(Object.assign)Object.assign(r,t);else for(var e in t)t.hasOwnProperty(e)&&e!==ER&&(r[e]=t[e]);return r}function We(r,t,e){for(var i=br(t),n=0;n<i.length;n++){var a=i[n];(e?t[a]!=null:r[a]==null)&&(r[a]=t[a])}return r}function pr(r,t){if(r){if(r.indexOf)return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e}return-1}function _vt(r,t){var e=r.prototype;function i(){}i.prototype=t.prototype,r.prototype=new i;for(var n in e)e.hasOwnProperty(n)&&(r.prototype[n]=e[n]);r.prototype.constructor=r,r.superClass=t}function yn(r,t,e){if(r="prototype"in r?r.prototype:r,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames)for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var a=i[n];a!=="constructor"&&(e?t[a]!=null:r[a]==null)&&(r[a]=t[a])}else We(r,t,e)}function Sa(r){return!r||typeof r=="string"?!1:typeof r.length=="number"}function J(r,t,e){if(r&&t)if(r.forEach&&r.forEach===gvt)r.forEach(t,e);else if(r.length===+r.length)for(var i=0,n=r.length;i<n;i++)t.call(e,r[i],i,r);else for(var a in r)r.hasOwnProperty(a)&&t.call(e,r[a],a,r)}function te(r,t,e){if(!r)return[];if(!t)return PR(r);if(r.map&&r.map===mvt)return r.map(t,e);for(var i=[],n=0,a=r.length;n<a;n++)i.push(t.call(e,r[n],n,r));return i}function bl(r,t,e,i){if(r&&t){for(var n=0,a=r.length;n<a;n++)e=t.call(i,e,r[n],n,r);return e}}function ti(r,t,e){if(!r)return[];if(!t)return PR(r);if(r.filter&&r.filter===vvt)return r.filter(t,e);for(var i=[],n=0,a=r.length;n<a;n++)t.call(e,r[n],n,r)&&i.push(r[n]);return i}function xvt(r,t,e){if(r&&t){for(var i=0,n=r.length;i<n;i++)if(t.call(e,r[i],i,r))return r[i]}}function br(r){if(!r)return[];if(Object.keys)return Object.keys(r);var t=[];for(var e in r)r.hasOwnProperty(e)&&t.push(e);return t}function bvt(r,t){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];return function(){return r.apply(t,e.concat(CR.call(arguments)))}}var we=Ex&&Ve(Ex.bind)?Ex.call.bind(Ex.bind):bvt;function nr(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){return r.apply(this,t.concat(CR.call(arguments)))}}function Kt(r){return Array.isArray?Array.isArray(r):Eg.call(r)==="[object Array]"}function Ve(r){return typeof r=="function"}function ve(r){return typeof r=="string"}function II(r){return Eg.call(r)==="[object String]"}function Fr(r){return typeof r=="number"}function je(r){var t=typeof r;return t==="function"||!!r&&t==="object"}function RF(r){return!!XW[Eg.call(r)]}function hs(r){return!!ZW[Eg.call(r)]}function fg(r){return typeof r=="object"&&typeof r.nodeType=="number"&&typeof r.ownerDocument=="object"}function vS(r){return r.colorStops!=null}function wvt(r){return r.image!=null}function Svt(r){return Eg.call(r)==="[object RegExp]"}function zy(r){return r!==r}function Un(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];for(var e=0,i=r.length;e<i;e++)if(r[e]!=null)return r[e]}function ir(r,t){return r??t}function _l(r,t,e){return r??t??e}function PR(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return CR.apply(r,t)}function RR(r){if(typeof r=="number")return[r,r,r,r];var t=r.length;return t===2?[r[0],r[1],r[0],r[1]]:t===3?[r[0],r[1],r[2],r[1]]:r}function Za(r,t){if(!r)throw new Error(t)}function ko(r){return r==null?null:typeof r.trim=="function"?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var YW="__ec_primitive__";function $b(r){r[YW]=!0}function iy(r){return r[YW]}var Tvt=function(){function r(){this.data={}}return r.prototype.delete=function(t){var e=this.has(t);return e&&delete this.data[t],e},r.prototype.has=function(t){return this.data.hasOwnProperty(t)},r.prototype.get=function(t){return this.data[t]},r.prototype.set=function(t,e){return this.data[t]=e,this},r.prototype.keys=function(){return br(this.data)},r.prototype.forEach=function(t){var e=this.data;for(var i in e)e.hasOwnProperty(i)&&t(e[i],i)},r}(),KW=typeof Map=="function";function Avt(){return KW?new Map:new Tvt}var Cvt=function(){function r(t){var e=Kt(t);this.data=Avt();var i=this;t instanceof r?t.each(n):t&&J(t,n);function n(a,s){e?i.set(a,s):i.set(s,a)}}return r.prototype.hasKey=function(t){return this.data.has(t)},r.prototype.get=function(t){return this.data.get(t)},r.prototype.set=function(t,e){return this.data.set(t,e),e},r.prototype.each=function(t,e){this.data.forEach(function(i,n){t.call(e,i,n)})},r.prototype.keys=function(){var t=this.data.keys();return KW?Array.from(t):t},r.prototype.removeKey=function(t){this.data.delete(t)},r}();function Re(r){return new Cvt(r)}function Wb(r,t){for(var e=new r.constructor(r.length+t.length),i=0;i<r.length;i++)e[i]=r[i];for(var n=r.length,i=0;i<t.length;i++)e[i+n]=t[i];return e}function mS(r,t){var e;if(Object.create)e=Object.create(r);else{var i=function(){};i.prototype=r,e=new i}return t&&Zt(e,t),e}function JW(r){var t=r.style;t.webkitUserSelect="none",t.userSelect="none",t.webkitTapHighlightColor="rgba(0,0,0,0)",t["-webkit-touch-callout"]="none"}function Ae(r,t){return r.hasOwnProperty(t)}function nn(){}var V1=180/Math.PI;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var MI=function(r,t){return MI=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])},MI(r,t)};function bi(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");MI(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Qf(r,t){return r==null&&(r=0),t==null&&(t=0),[r,t]}function Ua(r,t){return r[0]=t[0],r[1]=t[1],r}function ou(r){return[r[0],r[1]]}function Evt(r,t,e){return r[0]=t,r[1]=e,r}function DF(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function PI(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r}function df(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r}function RI(r){return Math.sqrt(Ivt(r))}function Ivt(r){return r[0]*r[0]+r[1]*r[1]}function U1(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r}function Ig(r,t){var e=RI(t);return e===0?(r[0]=0,r[1]=0):(r[0]=t[0]/e,r[1]=t[1]/e),r}function DI(r,t){return Math.sqrt((r[0]-t[0])*(r[0]-t[0])+(r[1]-t[1])*(r[1]-t[1]))}var xc=DI;function Mvt(r,t){return(r[0]-t[0])*(r[0]-t[0])+(r[1]-t[1])*(r[1]-t[1])}var Tf=Mvt;function $1(r,t,e,i){return r[0]=t[0]+i*(e[0]-t[0]),r[1]=t[1]+i*(e[1]-t[1]),r}function Qn(r,t,e){var i=t[0],n=t[1];return r[0]=e[0]*i+e[2]*n+e[4],r[1]=e[1]*i+e[3]*n+e[5],r}function bc(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r}function wc(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r}var tp=function(){function r(t,e){this.target=t,this.topTarget=e&&e.topTarget}return r}(),Pvt=function(){function r(t){this.handler=t,t.on("mousedown",this._dragStart,this),t.on("mousemove",this._drag,this),t.on("mouseup",this._dragEnd,this)}return r.prototype._dragStart=function(t){for(var e=t.target;e&&!e.draggable;)e=e.parent||e.__hostTarget;e&&(this._draggingTarget=e,e.dragging=!0,this._x=t.offsetX,this._y=t.offsetY,this.handler.dispatchToElement(new tp(e,t),"dragstart",t.event))},r.prototype._drag=function(t){var e=this._draggingTarget;if(e){var i=t.offsetX,n=t.offsetY,a=i-this._x,s=n-this._y;this._x=i,this._y=n,e.drift(a,s,t),this.handler.dispatchToElement(new tp(e,t),"drag",t.event);var o=this.handler.findHover(i,n,e).target,l=this._dropTarget;this._dropTarget=o,e!==o&&(l&&o!==l&&this.handler.dispatchToElement(new tp(l,t),"dragleave",t.event),o&&o!==l&&this.handler.dispatchToElement(new tp(o,t),"dragenter",t.event))}},r.prototype._dragEnd=function(t){var e=this._draggingTarget;e&&(e.dragging=!1),this.handler.dispatchToElement(new tp(e,t),"dragend",t.event),this._dropTarget&&this.handler.dispatchToElement(new tp(this._dropTarget,t),"drop",t.event),this._draggingTarget=null,this._dropTarget=null},r}();const Rvt=Pvt;var Dvt=function(){function r(t){t&&(this._$eventProcessor=t)}return r.prototype.on=function(t,e,i,n){this._$handlers||(this._$handlers={});var a=this._$handlers;if(typeof e=="function"&&(n=i,i=e,e=null),!i||!t)return this;var s=this._$eventProcessor;e!=null&&s&&s.normalizeQuery&&(e=s.normalizeQuery(e)),a[t]||(a[t]=[]);for(var o=0;o<a[t].length;o++)if(a[t][o].h===i)return this;var l={h:i,query:e,ctx:n||this,callAtLast:i.zrEventfulCallAtLast},u=a[t].length-1,c=a[t][u];return c&&c.callAtLast?a[t].splice(u,0,l):a[t].push(l),this},r.prototype.isSilent=function(t){var e=this._$handlers;return!e||!e[t]||!e[t].length},r.prototype.off=function(t,e){var i=this._$handlers;if(!i)return this;if(!t)return this._$handlers={},this;if(e){if(i[t]){for(var n=[],a=0,s=i[t].length;a<s;a++)i[t][a].h!==e&&n.push(i[t][a]);i[t]=n}i[t]&&i[t].length===0&&delete i[t]}else delete i[t];return this},r.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!this._$handlers)return this;var n=this._$handlers[t],a=this._$eventProcessor;if(n)for(var s=e.length,o=n.length,l=0;l<o;l++){var u=n[l];if(!(a&&a.filter&&u.query!=null&&!a.filter(t,u.query)))switch(s){case 0:u.h.call(u.ctx);break;case 1:u.h.call(u.ctx,e[0]);break;case 2:u.h.call(u.ctx,e[0],e[1]);break;default:u.h.apply(u.ctx,e);break}}return a&&a.afterTrigger&&a.afterTrigger(t),this},r.prototype.triggerWithContext=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!this._$handlers)return this;var n=this._$handlers[t],a=this._$eventProcessor;if(n)for(var s=e.length,o=e[s-1],l=n.length,u=0;u<l;u++){var c=n[u];if(!(a&&a.filter&&c.query!=null&&!a.filter(t,c.query)))switch(s){case 0:c.h.call(o);break;case 1:c.h.call(o,e[0]);break;case 2:c.h.call(o,e[0],e[1]);break;default:c.h.apply(o,e.slice(1,s-1));break}}return a&&a.afterTrigger&&a.afterTrigger(t),this},r}();const so=Dvt;var Lvt=Math.log(2);function LI(r,t,e,i,n,a){var s=i+"-"+n,o=r.length;if(a.hasOwnProperty(s))return a[s];if(t===1){var l=Math.round(Math.log((1<<o)-1&~n)/Lvt);return r[e][l]}for(var u=i|1<<e,c=e+1;i&1<<c;)c++;for(var h=0,p=0,v=0;p<o;p++){var y=1<<p;y&n||(h+=(v%2?-1:1)*r[e][p]*LI(r,t-1,c,u,n|y,a),v++)}return a[s]=h,h}function LF(r,t){var e=[[r[0],r[1],1,0,0,0,-t[0]*r[0],-t[0]*r[1]],[0,0,0,r[0],r[1],1,-t[1]*r[0],-t[1]*r[1]],[r[2],r[3],1,0,0,0,-t[2]*r[2],-t[2]*r[3]],[0,0,0,r[2],r[3],1,-t[3]*r[2],-t[3]*r[3]],[r[4],r[5],1,0,0,0,-t[4]*r[4],-t[4]*r[5]],[0,0,0,r[4],r[5],1,-t[5]*r[4],-t[5]*r[5]],[r[6],r[7],1,0,0,0,-t[6]*r[6],-t[6]*r[7]],[0,0,0,r[6],r[7],1,-t[7]*r[6],-t[7]*r[7]]],i={},n=LI(e,8,0,0,0,i);if(n!==0){for(var a=[],s=0;s<8;s++)for(var o=0;o<8;o++)a[o]==null&&(a[o]=0),a[o]+=((s+o)%2?-1:1)*LI(e,7,s===0?1:0,1<<s,1<<o,i)/n*t[s];return function(l,u,c){var h=u*a[6]+c*a[7]+1;l[0]=(u*a[0]+c*a[1]+a[2])/h,l[1]=(u*a[3]+c*a[4]+a[5])/h}}}var kF="___zrEVENTSAVED",KA=[];function kvt(r,t,e,i,n){return kI(KA,t,i,n,!0)&&kI(r,e,KA[0],KA[1])}function kI(r,t,e,i,n){if(t.getBoundingClientRect&&Or.domSupported&&!QW(t)){var a=t[kF]||(t[kF]={}),s=Ovt(t,a),o=Nvt(s,a,n);if(o)return o(r,e,i),!0}return!1}function Ovt(r,t){var e=t.markers;if(e)return e;e=t.markers=[];for(var i=["left","right"],n=["top","bottom"],a=0;a<4;a++){var s=document.createElement("div"),o=s.style,l=a%2,u=(a>>1)%2;o.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",i[l]+":0",n[u]+":0",i[1-l]+":auto",n[1-u]+":auto",""].join("!important;"),r.appendChild(s),e.push(s)}return e}function Nvt(r,t,e){for(var i=e?"invTrans":"trans",n=t[i],a=t.srcCoords,s=[],o=[],l=!0,u=0;u<4;u++){var c=r[u].getBoundingClientRect(),h=2*u,p=c.left,v=c.top;s.push(p,v),l=l&&a&&p===a[h]&&v===a[h+1],o.push(r[u].offsetLeft,r[u].offsetTop)}return l&&n?n:(t.srcCoords=s,t[i]=e?LF(o,s):LF(s,o))}function QW(r){return r.nodeName.toUpperCase()==="CANVAS"}var Fvt=/([&<>"'])/g,Bvt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Ga(r){return r==null?"":(r+"").replace(Fvt,function(t,e){return Bvt[e]})}var zvt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,JA=[],Vvt=Or.browser.firefox&&+Or.browser.version.split(".")[0]<39;function OI(r,t,e,i){return e=e||{},i?OF(r,t,e):Vvt&&t.layerX!=null&&t.layerX!==t.offsetX?(e.zrX=t.layerX,e.zrY=t.layerY):t.offsetX!=null?(e.zrX=t.offsetX,e.zrY=t.offsetY):OF(r,t,e),e}function OF(r,t,e){if(Or.domSupported&&r.getBoundingClientRect){var i=t.clientX,n=t.clientY;if(QW(r)){var a=r.getBoundingClientRect();e.zrX=i-a.left,e.zrY=n-a.top;return}else if(kI(JA,r,i,n)){e.zrX=JA[0],e.zrY=JA[1];return}}e.zrX=e.zrY=0}function DR(r){return r||window.event}function Gs(r,t,e){if(t=DR(t),t.zrX!=null)return t;var i=t.type,n=i&&i.indexOf("touch")>=0;if(n){var s=i!=="touchend"?t.targetTouches[0]:t.changedTouches[0];s&&OI(r,s,t,e)}else{OI(r,t,t,e);var a=Uvt(t);t.zrDelta=a?a/120:-(t.detail||0)/3}var o=t.button;return t.which==null&&o!==void 0&&zvt.test(t.type)&&(t.which=o&1?1:o&2?3:o&4?2:0),t}function Uvt(r){var t=r.wheelDelta;if(t)return t;var e=r.deltaX,i=r.deltaY;if(e==null||i==null)return t;var n=Math.abs(i!==0?i:e),a=i>0?-1:i<0?1:e>0?-1:1;return 3*n*a}function NI(r,t,e,i){r.addEventListener(t,e,i)}function $vt(r,t,e,i){r.removeEventListener(t,e,i)}var pu=function(r){r.preventDefault(),r.stopPropagation(),r.cancelBubble=!0};function NF(r){return r.which===2||r.which===3}var Wvt=function(){function r(){this._track=[]}return r.prototype.recognize=function(t,e,i){return this._doTrack(t,e,i),this._recognize(t)},r.prototype.clear=function(){return this._track.length=0,this},r.prototype._doTrack=function(t,e,i){var n=t.touches;if(n){for(var a={points:[],touches:[],target:e,event:t},s=0,o=n.length;s<o;s++){var l=n[s],u=OI(i,l,{});a.points.push([u.zrX,u.zrY]),a.touches.push(l)}this._track.push(a)}},r.prototype._recognize=function(t){for(var e in QA)if(QA.hasOwnProperty(e)){var i=QA[e](this._track,t);if(i)return i}},r}();function FF(r){var t=r[1][0]-r[0][0],e=r[1][1]-r[0][1];return Math.sqrt(t*t+e*e)}function Hvt(r){return[(r[0][0]+r[1][0])/2,(r[0][1]+r[1][1])/2]}var QA={pinch:function(r,t){var e=r.length;if(e){var i=(r[e-1]||{}).points,n=(r[e-2]||{}).points||i;if(n&&n.length>1&&i&&i.length>1){var a=FF(i)/FF(n);!isFinite(a)&&(a=1),t.pinchScale=a;var s=Hvt(i);return t.pinchX=s[0],t.pinchY=s[1],{type:"pinch",target:r[0].target,event:t}}}}};function Es(){return[1,0,0,1,0,0]}function yS(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r}function LR(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function lu(r,t,e){var i=t[0]*e[0]+t[2]*e[1],n=t[1]*e[0]+t[3]*e[1],a=t[0]*e[2]+t[2]*e[3],s=t[1]*e[2]+t[3]*e[3],o=t[0]*e[4]+t[2]*e[5]+t[4],l=t[1]*e[4]+t[3]*e[5]+t[5];return r[0]=i,r[1]=n,r[2]=a,r[3]=s,r[4]=o,r[5]=l,r}function wl(r,t,e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4]+e[0],r[5]=t[5]+e[1],r}function td(r,t,e,i){i===void 0&&(i=[0,0]);var n=t[0],a=t[2],s=t[4],o=t[1],l=t[3],u=t[5],c=Math.sin(e),h=Math.cos(e);return r[0]=n*h+o*c,r[1]=-n*c+o*h,r[2]=a*h+l*c,r[3]=-a*c+h*l,r[4]=h*(s-i[0])+c*(u-i[1])+i[0],r[5]=h*(u-i[1])-c*(s-i[0])+i[1],r}function kR(r,t,e){var i=e[0],n=e[1];return r[0]=t[0]*i,r[1]=t[1]*n,r[2]=t[2]*i,r[3]=t[3]*n,r[4]=t[4]*i,r[5]=t[5]*n,r}function Mg(r,t){var e=t[0],i=t[2],n=t[4],a=t[1],s=t[3],o=t[5],l=e*s-a*i;return l?(l=1/l,r[0]=s*l,r[1]=-a*l,r[2]=-i*l,r[3]=e*l,r[4]=(i*o-s*n)*l,r[5]=(a*n-e*o)*l,r):null}function Gvt(r){var t=Es();return LR(t,r),t}var jvt=function(){function r(t,e){this.x=t||0,this.y=e||0}return r.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},r.prototype.clone=function(){return new r(this.x,this.y)},r.prototype.set=function(t,e){return this.x=t,this.y=e,this},r.prototype.equal=function(t){return t.x===this.x&&t.y===this.y},r.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},r.prototype.scale=function(t){this.x*=t,this.y*=t},r.prototype.scaleAndAdd=function(t,e){this.x+=t.x*e,this.y+=t.y*e},r.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},r.prototype.dot=function(t){return this.x*t.x+this.y*t.y},r.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},r.prototype.normalize=function(){var t=this.len();return this.x/=t,this.y/=t,this},r.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},r.prototype.distanceSquare=function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},r.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},r.prototype.transform=function(t){if(t){var e=this.x,i=this.y;return this.x=t[0]*e+t[2]*i+t[4],this.y=t[1]*e+t[3]*i+t[5],this}},r.prototype.toArray=function(t){return t[0]=this.x,t[1]=this.y,t},r.prototype.fromArray=function(t){this.x=t[0],this.y=t[1]},r.set=function(t,e,i){t.x=e,t.y=i},r.copy=function(t,e){t.x=e.x,t.y=e.y},r.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},r.lenSquare=function(t){return t.x*t.x+t.y*t.y},r.dot=function(t,e){return t.x*e.x+t.y*e.y},r.add=function(t,e,i){t.x=e.x+i.x,t.y=e.y+i.y},r.sub=function(t,e,i){t.x=e.x-i.x,t.y=e.y-i.y},r.scale=function(t,e,i){t.x=e.x*i,t.y=e.y*i},r.scaleAndAdd=function(t,e,i,n){t.x=e.x+i.x*n,t.y=e.y+i.y*n},r.lerp=function(t,e,i,n){var a=1-n;t.x=a*e.x+n*i.x,t.y=a*e.y+n*i.y},r}();const lr=jvt;var Ix=Math.min,Mx=Math.max,Th=new lr,Ah=new lr,Ch=new lr,Eh=new lr,rm=new lr,im=new lr,Xvt=function(){function r(t,e,i,n){i<0&&(t=t+i,i=-i),n<0&&(e=e+n,n=-n),this.x=t,this.y=e,this.width=i,this.height=n}return r.prototype.union=function(t){var e=Ix(t.x,this.x),i=Ix(t.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=Mx(t.x+t.width,this.x+this.width)-e:this.width=t.width,isFinite(this.y)&&isFinite(this.height)?this.height=Mx(t.y+t.height,this.y+this.height)-i:this.height=t.height,this.x=e,this.y=i},r.prototype.applyTransform=function(t){r.applyTransform(this,this,t)},r.prototype.calculateTransform=function(t){var e=this,i=t.width/e.width,n=t.height/e.height,a=Es();return wl(a,a,[-e.x,-e.y]),kR(a,a,[i,n]),wl(a,a,[t.x,t.y]),a},r.prototype.intersect=function(t,e){if(!t)return!1;t instanceof r||(t=r.create(t));var i=this,n=i.x,a=i.x+i.width,s=i.y,o=i.y+i.height,l=t.x,u=t.x+t.width,c=t.y,h=t.y+t.height,p=!(a<l||u<n||o<c||h<s);if(e){var v=1/0,y=0,x=Math.abs(a-l),w=Math.abs(u-n),T=Math.abs(o-c),E=Math.abs(h-s),M=Math.min(x,w),L=Math.min(T,E);a<l||u<n?M>y&&(y=M,x<w?lr.set(im,-x,0):lr.set(im,w,0)):M<v&&(v=M,x<w?lr.set(rm,x,0):lr.set(rm,-w,0)),o<c||h<s?L>y&&(y=L,T<E?lr.set(im,0,-T):lr.set(im,0,E)):M<v&&(v=M,T<E?lr.set(rm,0,T):lr.set(rm,0,-E))}return e&&lr.copy(e,p?rm:im),p},r.prototype.contain=function(t,e){var i=this;return t>=i.x&&t<=i.x+i.width&&e>=i.y&&e<=i.y+i.height},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.copy=function(t){r.copy(this,t)},r.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},r.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},r.prototype.isZero=function(){return this.width===0||this.height===0},r.create=function(t){return new r(t.x,t.y,t.width,t.height)},r.copy=function(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},r.applyTransform=function(t,e,i){if(!i){t!==e&&r.copy(t,e);return}if(i[1]<1e-5&&i[1]>-1e-5&&i[2]<1e-5&&i[2]>-1e-5){var n=i[0],a=i[3],s=i[4],o=i[5];t.x=e.x*n+s,t.y=e.y*a+o,t.width=e.width*n,t.height=e.height*a,t.width<0&&(t.x+=t.width,t.width=-t.width),t.height<0&&(t.y+=t.height,t.height=-t.height);return}Th.x=Ch.x=e.x,Th.y=Eh.y=e.y,Ah.x=Eh.x=e.x+e.width,Ah.y=Ch.y=e.y+e.height,Th.transform(i),Eh.transform(i),Ah.transform(i),Ch.transform(i),t.x=Ix(Th.x,Ah.x,Ch.x,Eh.x),t.y=Ix(Th.y,Ah.y,Ch.y,Eh.y);var l=Mx(Th.x,Ah.x,Ch.x,Eh.x),u=Mx(Th.y,Ah.y,Ch.y,Eh.y);t.width=l-t.x,t.height=u-t.y},r}();const hr=Xvt;var tH="silent";function Zvt(r,t,e){return{type:r,event:e,target:t.target,topTarget:t.topTarget,cancelBubble:!1,offsetX:e.zrX,offsetY:e.zrY,gestureEvent:e.gestureEvent,pinchX:e.pinchX,pinchY:e.pinchY,pinchScale:e.pinchScale,wheelDelta:e.zrDelta,zrByTouch:e.zrByTouch,which:e.which,stop:qvt}}function qvt(){pu(this.event)}var Yvt=function(r){bi(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.handler=null,e}return t.prototype.dispose=function(){},t.prototype.setCursor=function(){},t}(so),nm=function(){function r(t,e){this.x=t,this.y=e}return r}(),Kvt=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],t2=new hr(0,0,0,0),eH=function(r){bi(t,r);function t(e,i,n,a,s){var o=r.call(this)||this;return o._hovered=new nm(0,0),o.storage=e,o.painter=i,o.painterRoot=a,o._pointerSize=s,n=n||new Yvt,o.proxy=null,o.setHandlerProxy(n),o._draggingMgr=new Rvt(o),o}return t.prototype.setHandlerProxy=function(e){this.proxy&&this.proxy.dispose(),e&&(J(Kvt,function(i){e.on&&e.on(i,this[i],this)},this),e.handler=this),this.proxy=e},t.prototype.mousemove=function(e){var i=e.zrX,n=e.zrY,a=rH(this,i,n),s=this._hovered,o=s.target;o&&!o.__zr&&(s=this.findHover(s.x,s.y),o=s.target);var l=this._hovered=a?new nm(i,n):this.findHover(i,n),u=l.target,c=this.proxy;c.setCursor&&c.setCursor(u?u.cursor:"default"),o&&u!==o&&this.dispatchToElement(s,"mouseout",e),this.dispatchToElement(l,"mousemove",e),u&&u!==o&&this.dispatchToElement(l,"mouseover",e)},t.prototype.mouseout=function(e){var i=e.zrEventControl;i!=="only_globalout"&&this.dispatchToElement(this._hovered,"mouseout",e),i!=="no_globalout"&&this.trigger("globalout",{type:"globalout",event:e})},t.prototype.resize=function(){this._hovered=new nm(0,0)},t.prototype.dispatch=function(e,i){var n=this[e];n&&n.call(this,i)},t.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},t.prototype.setCursorStyle=function(e){var i=this.proxy;i.setCursor&&i.setCursor(e)},t.prototype.dispatchToElement=function(e,i,n){e=e||{};var a=e.target;if(!(a&&a.silent)){for(var s="on"+i,o=Zvt(i,e,n);a&&(a[s]&&(o.cancelBubble=!!a[s].call(a,o)),a.trigger(i,o),a=a.__hostTarget?a.__hostTarget:a.parent,!o.cancelBubble););o.cancelBubble||(this.trigger(i,o),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer(function(l){typeof l[s]=="function"&&l[s].call(l,o),l.trigger&&l.trigger(i,o)}))}},t.prototype.findHover=function(e,i,n){var a=this.storage.getDisplayList(),s=new nm(e,i);if(BF(a,s,e,i,n),this._pointerSize&&!s.target){for(var o=[],l=this._pointerSize,u=l/2,c=new hr(e-u,i-u,l,l),h=a.length-1;h>=0;h--){var p=a[h];p!==n&&!p.ignore&&!p.ignoreCoarsePointer&&(!p.parent||!p.parent.ignoreCoarsePointer)&&(t2.copy(p.getBoundingRect()),p.transform&&t2.applyTransform(p.transform),t2.intersect(c)&&o.push(p))}if(o.length)for(var v=4,y=Math.PI/12,x=Math.PI*2,w=0;w<u;w+=v)for(var T=0;T<x;T+=y){var E=e+w*Math.cos(T),M=i+w*Math.sin(T);if(BF(o,s,E,M,n),s.target)return s}}return s},t.prototype.processGesture=function(e,i){this._gestureMgr||(this._gestureMgr=new Wvt);var n=this._gestureMgr;i==="start"&&n.clear();var a=n.recognize(e,this.findHover(e.zrX,e.zrY,null).target,this.proxy.dom);if(i==="end"&&n.clear(),a){var s=a.type;e.gestureEvent=s;var o=new nm;o.target=a.target,this.dispatchToElement(o,s,a.event)}},t}(so);J(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(r){eH.prototype[r]=function(t){var e=t.zrX,i=t.zrY,n=rH(this,e,i),a,s;if((r!=="mouseup"||!n)&&(a=this.findHover(e,i),s=a.target),r==="mousedown")this._downEl=s,this._downPoint=[t.zrX,t.zrY],this._upEl=s;else if(r==="mouseup")this._upEl=s;else if(r==="click"){if(this._downEl!==this._upEl||!this._downPoint||xc(this._downPoint,[t.zrX,t.zrY])>4)return;this._downPoint=null}this.dispatchToElement(a,r,t)}});function Jvt(r,t,e){if(r[r.rectHover?"rectContain":"contain"](t,e)){for(var i=r,n=void 0,a=!1;i;){if(i.ignoreClip&&(a=!0),!a){var s=i.getClipPath();if(s&&!s.contain(t,e))return!1}i.silent&&(n=!0);var o=i.__hostTarget;i=o||i.parent}return n?tH:!0}return!1}function BF(r,t,e,i,n){for(var a=r.length-1;a>=0;a--){var s=r[a],o=void 0;if(s!==n&&!s.ignore&&(o=Jvt(s,e,i))&&(!t.topTarget&&(t.topTarget=s),o!==tH)){t.target=s;break}}}function rH(r,t,e){var i=r.painter;return t<0||t>i.getWidth()||e<0||e>i.getHeight()}const Qvt=eH;var iH=32,am=7;function tmt(r){for(var t=0;r>=iH;)t|=r&1,r>>=1;return r+t}function zF(r,t,e,i){var n=t+1;if(n===e)return 1;if(i(r[n++],r[t])<0){for(;n<e&&i(r[n],r[n-1])<0;)n++;emt(r,t,n)}else for(;n<e&&i(r[n],r[n-1])>=0;)n++;return n-t}function emt(r,t,e){for(e--;t<e;){var i=r[t];r[t++]=r[e],r[e--]=i}}function VF(r,t,e,i,n){for(i===t&&i++;i<e;i++){for(var a=r[i],s=t,o=i,l;s<o;)l=s+o>>>1,n(a,r[l])<0?o=l:s=l+1;var u=i-s;switch(u){case 3:r[s+3]=r[s+2];case 2:r[s+2]=r[s+1];case 1:r[s+1]=r[s];break;default:for(;u>0;)r[s+u]=r[s+u-1],u--}r[s]=a}}function e2(r,t,e,i,n,a){var s=0,o=0,l=1;if(a(r,t[e+n])>0){for(o=i-n;l<o&&a(r,t[e+n+l])>0;)s=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o),s+=n,l+=n}else{for(o=n+1;l<o&&a(r,t[e+n-l])<=0;)s=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o);var u=s;s=n-l,l=n-u}for(s++;s<l;){var c=s+(l-s>>>1);a(r,t[e+c])>0?s=c+1:l=c}return l}function r2(r,t,e,i,n,a){var s=0,o=0,l=1;if(a(r,t[e+n])<0){for(o=n+1;l<o&&a(r,t[e+n-l])<0;)s=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o);var u=s;s=n-l,l=n-u}else{for(o=i-n;l<o&&a(r,t[e+n+l])>=0;)s=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o),s+=n,l+=n}for(s++;s<l;){var c=s+(l-s>>>1);a(r,t[e+c])<0?l=c:s=c+1}return l}function rmt(r,t){var e=am,i,n,a=0,s=[];i=[],n=[];function o(v,y){i[a]=v,n[a]=y,a+=1}function l(){for(;a>1;){var v=a-2;if(v>=1&&n[v-1]<=n[v]+n[v+1]||v>=2&&n[v-2]<=n[v]+n[v-1])n[v-1]<n[v+1]&&v--;else if(n[v]>n[v+1])break;c(v)}}function u(){for(;a>1;){var v=a-2;v>0&&n[v-1]<n[v+1]&&v--,c(v)}}function c(v){var y=i[v],x=n[v],w=i[v+1],T=n[v+1];n[v]=x+T,v===a-3&&(i[v+1]=i[v+2],n[v+1]=n[v+2]),a--;var E=r2(r[w],r,y,x,0,t);y+=E,x-=E,x!==0&&(T=e2(r[y+x-1],r,w,T,T-1,t),T!==0&&(x<=T?h(y,x,w,T):p(y,x,w,T)))}function h(v,y,x,w){var T=0;for(T=0;T<y;T++)s[T]=r[v+T];var E=0,M=x,L=v;if(r[L++]=r[M++],--w===0){for(T=0;T<y;T++)r[L+T]=s[E+T];return}if(y===1){for(T=0;T<w;T++)r[L+T]=r[M+T];r[L+w]=s[E];return}for(var F=e,O,U,W;;){O=0,U=0,W=!1;do if(t(r[M],s[E])<0){if(r[L++]=r[M++],U++,O=0,--w===0){W=!0;break}}else if(r[L++]=s[E++],O++,U=0,--y===1){W=!0;break}while((O|U)<F);if(W)break;do{if(O=r2(r[M],s,E,y,0,t),O!==0){for(T=0;T<O;T++)r[L+T]=s[E+T];if(L+=O,E+=O,y-=O,y<=1){W=!0;break}}if(r[L++]=r[M++],--w===0){W=!0;break}if(U=e2(s[E],r,M,w,0,t),U!==0){for(T=0;T<U;T++)r[L+T]=r[M+T];if(L+=U,M+=U,w-=U,w===0){W=!0;break}}if(r[L++]=s[E++],--y===1){W=!0;break}F--}while(O>=am||U>=am);if(W)break;F<0&&(F=0),F+=2}if(e=F,e<1&&(e=1),y===1){for(T=0;T<w;T++)r[L+T]=r[M+T];r[L+w]=s[E]}else{if(y===0)throw new Error;for(T=0;T<y;T++)r[L+T]=s[E+T]}}function p(v,y,x,w){var T=0;for(T=0;T<w;T++)s[T]=r[x+T];var E=v+y-1,M=w-1,L=x+w-1,F=0,O=0;if(r[L--]=r[E--],--y===0){for(F=L-(w-1),T=0;T<w;T++)r[F+T]=s[T];return}if(w===1){for(L-=y,E-=y,O=L+1,F=E+1,T=y-1;T>=0;T--)r[O+T]=r[F+T];r[L]=s[M];return}for(var U=e;;){var W=0,H=0,j=!1;do if(t(s[M],r[E])<0){if(r[L--]=r[E--],W++,H=0,--y===0){j=!0;break}}else if(r[L--]=s[M--],H++,W=0,--w===1){j=!0;break}while((W|H)<U);if(j)break;do{if(W=y-r2(s[M],r,v,y,y-1,t),W!==0){for(L-=W,E-=W,y-=W,O=L+1,F=E+1,T=W-1;T>=0;T--)r[O+T]=r[F+T];if(y===0){j=!0;break}}if(r[L--]=s[M--],--w===1){j=!0;break}if(H=w-e2(r[E],s,0,w,w-1,t),H!==0){for(L-=H,M-=H,w-=H,O=L+1,F=M+1,T=0;T<H;T++)r[O+T]=s[F+T];if(w<=1){j=!0;break}}if(r[L--]=r[E--],--y===0){j=!0;break}U--}while(W>=am||H>=am);if(j)break;U<0&&(U=0),U+=2}if(e=U,e<1&&(e=1),w===1){for(L-=y,E-=y,O=L+1,F=E+1,T=y-1;T>=0;T--)r[O+T]=r[F+T];r[L]=s[M]}else{if(w===0)throw new Error;for(F=L-(w-1),T=0;T<w;T++)r[F+T]=s[T]}}return{mergeRuns:l,forceMergeRuns:u,pushRun:o}}function W1(r,t,e,i){e||(e=0),i||(i=r.length);var n=i-e;if(!(n<2)){var a=0;if(n<iH){a=zF(r,e,i,t),VF(r,e,i,e+a,t);return}var s=rmt(r,t),o=tmt(n);do{if(a=zF(r,e,i,t),a<o){var l=n;l>o&&(l=o),VF(r,e,e+l,e+a,t),a=l}s.pushRun(e,a),s.mergeRuns(),n-=a,e+=a}while(n!==0);s.forceMergeRuns()}}var Ts=1,Fm=2,wp=4,UF=!1;function i2(){UF||(UF=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}function $F(r,t){return r.zlevel===t.zlevel?r.z===t.z?r.z2-t.z2:r.z-t.z:r.zlevel-t.zlevel}var imt=function(){function r(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=$F}return r.prototype.traverse=function(t,e){for(var i=0;i<this._roots.length;i++)this._roots[i].traverse(t,e)},r.prototype.getDisplayList=function(t,e){e=e||!1;var i=this._displayList;return(t||!i.length)&&this.updateDisplayList(e),i},r.prototype.updateDisplayList=function(t){this._displayListLen=0;for(var e=this._roots,i=this._displayList,n=0,a=e.length;n<a;n++)this._updateAndAddDisplayable(e[n],null,t);i.length=this._displayListLen,W1(i,$F)},r.prototype._updateAndAddDisplayable=function(t,e,i){if(!(t.ignore&&!i)){t.beforeUpdate(),t.update(),t.afterUpdate();var n=t.getClipPath();if(t.ignoreClip)e=null;else if(n){e?e=e.slice():e=[];for(var a=n,s=t;a;)a.parent=s,a.updateTransform(),e.push(a),s=a,a=a.getClipPath()}if(t.childrenRef){for(var o=t.childrenRef(),l=0;l<o.length;l++){var u=o[l];t.__dirty&&(u.__dirty|=Ts),this._updateAndAddDisplayable(u,e,i)}t.__dirty=0}else{var c=t;e&&e.length?c.__clipPaths=e:c.__clipPaths&&c.__clipPaths.length>0&&(c.__clipPaths=[]),isNaN(c.z)&&(i2(),c.z=0),isNaN(c.z2)&&(i2(),c.z2=0),isNaN(c.zlevel)&&(i2(),c.zlevel=0),this._displayList[this._displayListLen++]=c}var h=t.getDecalElement&&t.getDecalElement();h&&this._updateAndAddDisplayable(h,e,i);var p=t.getTextGuideLine();p&&this._updateAndAddDisplayable(p,e,i);var v=t.getTextContent();v&&this._updateAndAddDisplayable(v,e,i)}},r.prototype.addRoot=function(t){t.__zr&&t.__zr.storage===this||this._roots.push(t)},r.prototype.delRoot=function(t){if(t instanceof Array){for(var e=0,i=t.length;e<i;e++)this.delRoot(t[e]);return}var n=pr(this._roots,t);n>=0&&this._roots.splice(n,1)},r.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},r.prototype.getRoots=function(){return this._roots},r.prototype.dispose=function(){this._displayList=null,this._roots=null},r}();const nmt=imt;var nH;nH=Or.hasGlobalWindow&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(r){return setTimeout(r,16)};const FI=nH;var H1={linear:function(r){return r},quadraticIn:function(r){return r*r},quadraticOut:function(r){return r*(2-r)},quadraticInOut:function(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)},cubicIn:function(r){return r*r*r},cubicOut:function(r){return--r*r*r+1},cubicInOut:function(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)},quarticIn:function(r){return r*r*r*r},quarticOut:function(r){return 1- --r*r*r*r},quarticInOut:function(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)},quinticIn:function(r){return r*r*r*r*r},quinticOut:function(r){return--r*r*r*r*r+1},quinticInOut:function(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)},sinusoidalIn:function(r){return 1-Math.cos(r*Math.PI/2)},sinusoidalOut:function(r){return Math.sin(r*Math.PI/2)},sinusoidalInOut:function(r){return .5*(1-Math.cos(Math.PI*r))},exponentialIn:function(r){return r===0?0:Math.pow(1024,r-1)},exponentialOut:function(r){return r===1?1:1-Math.pow(2,-10*r)},exponentialInOut:function(r){return r===0?0:r===1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)},circularIn:function(r){return 1-Math.sqrt(1-r*r)},circularOut:function(r){return Math.sqrt(1- --r*r)},circularInOut:function(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)},elasticIn:function(r){var t,e=.1,i=.4;return r===0?0:r===1?1:(!e||e<1?(e=1,t=i/4):t=i*Math.asin(1/e)/(2*Math.PI),-(e*Math.pow(2,10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/i)))},elasticOut:function(r){var t,e=.1,i=.4;return r===0?0:r===1?1:(!e||e<1?(e=1,t=i/4):t=i*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*r)*Math.sin((r-t)*(2*Math.PI)/i)+1)},elasticInOut:function(r){var t,e=.1,i=.4;return r===0?0:r===1?1:(!e||e<1?(e=1,t=i/4):t=i*Math.asin(1/e)/(2*Math.PI),(r*=2)<1?-.5*(e*Math.pow(2,10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/i)):e*Math.pow(2,-10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/i)*.5+1)},backIn:function(r){var t=1.70158;return r*r*((t+1)*r-t)},backOut:function(r){var t=1.70158;return--r*r*((t+1)*r+t)+1},backInOut:function(r){var t=2.5949095;return(r*=2)<1?.5*(r*r*((t+1)*r-t)):.5*((r-=2)*r*((t+1)*r+t)+2)},bounceIn:function(r){return 1-H1.bounceOut(1-r)},bounceOut:function(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},bounceInOut:function(r){return r<.5?H1.bounceIn(r*2)*.5:H1.bounceOut(r*2-1)*.5+.5}};const aH=H1;var Px=Math.pow,Dc=Math.sqrt,Hb=1e-8,sH=1e-4,WF=Dc(3),Rx=1/3,fl=Qf(),Ys=Qf(),qp=Qf();function Sc(r){return r>-Hb&&r<Hb}function oH(r){return r>Hb||r<-Hb}function Pn(r,t,e,i,n){var a=1-n;return a*a*(a*r+3*n*t)+n*n*(n*i+3*a*e)}function HF(r,t,e,i,n){var a=1-n;return 3*(((t-r)*a+2*(e-t)*n)*a+(i-e)*n*n)}function Gb(r,t,e,i,n,a){var s=i+3*(t-e)-r,o=3*(e-t*2+r),l=3*(t-r),u=r-n,c=o*o-3*s*l,h=o*l-9*s*u,p=l*l-3*o*u,v=0;if(Sc(c)&&Sc(h))if(Sc(o))a[0]=0;else{var y=-l/o;y>=0&&y<=1&&(a[v++]=y)}else{var x=h*h-4*c*p;if(Sc(x)){var w=h/c,y=-o/s+w,T=-w/2;y>=0&&y<=1&&(a[v++]=y),T>=0&&T<=1&&(a[v++]=T)}else if(x>0){var E=Dc(x),M=c*o+1.5*s*(-h+E),L=c*o+1.5*s*(-h-E);M<0?M=-Px(-M,Rx):M=Px(M,Rx),L<0?L=-Px(-L,Rx):L=Px(L,Rx);var y=(-o-(M+L))/(3*s);y>=0&&y<=1&&(a[v++]=y)}else{var F=(2*c*o-3*s*h)/(2*Dc(c*c*c)),O=Math.acos(F)/3,U=Dc(c),W=Math.cos(O),y=(-o-2*U*W)/(3*s),T=(-o+U*(W+WF*Math.sin(O)))/(3*s),H=(-o+U*(W-WF*Math.sin(O)))/(3*s);y>=0&&y<=1&&(a[v++]=y),T>=0&&T<=1&&(a[v++]=T),H>=0&&H<=1&&(a[v++]=H)}}return v}function lH(r,t,e,i,n){var a=6*e-12*t+6*r,s=9*t+3*i-3*r-9*e,o=3*t-3*r,l=0;if(Sc(s)){if(oH(a)){var u=-o/a;u>=0&&u<=1&&(n[l++]=u)}}else{var c=a*a-4*s*o;if(Sc(c))n[0]=-a/(2*s);else if(c>0){var h=Dc(c),u=(-a+h)/(2*s),p=(-a-h)/(2*s);u>=0&&u<=1&&(n[l++]=u),p>=0&&p<=1&&(n[l++]=p)}}return l}function Uc(r,t,e,i,n,a){var s=(t-r)*n+r,o=(e-t)*n+t,l=(i-e)*n+e,u=(o-s)*n+s,c=(l-o)*n+o,h=(c-u)*n+u;a[0]=r,a[1]=s,a[2]=u,a[3]=h,a[4]=h,a[5]=c,a[6]=l,a[7]=i}function uH(r,t,e,i,n,a,s,o,l,u,c){var h,p=.005,v=1/0,y,x,w,T;fl[0]=l,fl[1]=u;for(var E=0;E<1;E+=.05)Ys[0]=Pn(r,e,n,s,E),Ys[1]=Pn(t,i,a,o,E),w=Tf(fl,Ys),w<v&&(h=E,v=w);v=1/0;for(var M=0;M<32&&!(p<sH);M++)y=h-p,x=h+p,Ys[0]=Pn(r,e,n,s,y),Ys[1]=Pn(t,i,a,o,y),w=Tf(Ys,fl),y>=0&&w<v?(h=y,v=w):(qp[0]=Pn(r,e,n,s,x),qp[1]=Pn(t,i,a,o,x),T=Tf(qp,fl),x<=1&&T<v?(h=x,v=T):p*=.5);return c&&(c[0]=Pn(r,e,n,s,h),c[1]=Pn(t,i,a,o,h)),Dc(v)}function amt(r,t,e,i,n,a,s,o,l){for(var u=r,c=t,h=0,p=1/l,v=1;v<=l;v++){var y=v*p,x=Pn(r,e,n,s,y),w=Pn(t,i,a,o,y),T=x-u,E=w-c;h+=Math.sqrt(T*T+E*E),u=x,c=w}return h}function Vn(r,t,e,i){var n=1-i;return n*(n*r+2*i*t)+i*i*e}function BI(r,t,e,i){return 2*((1-i)*(t-r)+i*(e-t))}function smt(r,t,e,i,n){var a=r-2*t+e,s=2*(t-r),o=r-i,l=0;if(Sc(a)){if(oH(s)){var u=-o/s;u>=0&&u<=1&&(n[l++]=u)}}else{var c=s*s-4*a*o;if(Sc(c)){var u=-s/(2*a);u>=0&&u<=1&&(n[l++]=u)}else if(c>0){var h=Dc(c),u=(-s+h)/(2*a),p=(-s-h)/(2*a);u>=0&&u<=1&&(n[l++]=u),p>=0&&p<=1&&(n[l++]=p)}}return l}function cH(r,t,e){var i=r+e-2*t;return i===0?.5:(r-t)/i}function Vy(r,t,e,i,n){var a=(t-r)*i+r,s=(e-t)*i+t,o=(s-a)*i+a;n[0]=r,n[1]=a,n[2]=o,n[3]=o,n[4]=s,n[5]=e}function hH(r,t,e,i,n,a,s,o,l){var u,c=.005,h=1/0;fl[0]=s,fl[1]=o;for(var p=0;p<1;p+=.05){Ys[0]=Vn(r,e,n,p),Ys[1]=Vn(t,i,a,p);var v=Tf(fl,Ys);v<h&&(u=p,h=v)}h=1/0;for(var y=0;y<32&&!(c<sH);y++){var x=u-c,w=u+c;Ys[0]=Vn(r,e,n,x),Ys[1]=Vn(t,i,a,x);var v=Tf(Ys,fl);if(x>=0&&v<h)u=x,h=v;else{qp[0]=Vn(r,e,n,w),qp[1]=Vn(t,i,a,w);var T=Tf(qp,fl);w<=1&&T<h?(u=w,h=T):c*=.5}}return l&&(l[0]=Vn(r,e,n,u),l[1]=Vn(t,i,a,u)),Dc(h)}function omt(r,t,e,i,n,a,s){for(var o=r,l=t,u=0,c=1/s,h=1;h<=s;h++){var p=h*c,v=Vn(r,e,n,p),y=Vn(t,i,a,p),x=v-o,w=y-l;u+=Math.sqrt(x*x+w*w),o=v,l=y}return u}var lmt=/cubic-bezier\(([0-9,\.e ]+)\)/;function OR(r){var t=r&&lmt.exec(r);if(t){var e=t[1].split(","),i=+ko(e[0]),n=+ko(e[1]),a=+ko(e[2]),s=+ko(e[3]);if(isNaN(i+n+a+s))return;var o=[];return function(l){return l<=0?0:l>=1?1:Gb(0,i,a,1,l,o)&&Pn(0,n,s,1,o[0])}}}var umt=function(){function r(t){this._inited=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=t.life||1e3,this._delay=t.delay||0,this.loop=t.loop||!1,this.onframe=t.onframe||nn,this.ondestroy=t.ondestroy||nn,this.onrestart=t.onrestart||nn,t.easing&&this.setEasing(t.easing)}return r.prototype.step=function(t,e){if(this._inited||(this._startTime=t+this._delay,this._inited=!0),this._paused){this._pausedTime+=e;return}var i=this._life,n=t-this._startTime-this._pausedTime,a=n/i;a<0&&(a=0),a=Math.min(a,1);var s=this.easingFunc,o=s?s(a):a;if(this.onframe(o),a===1)if(this.loop){var l=n%i;this._startTime=t-l,this._pausedTime=0,this.onrestart()}else return!0;return!1},r.prototype.pause=function(){this._paused=!0},r.prototype.resume=function(){this._paused=!1},r.prototype.setEasing=function(t){this.easing=t,this.easingFunc=Ve(t)?t:aH[t]||OR(t)},r}();const cmt=umt;var fH=function(){function r(t){this.value=t}return r}(),hmt=function(){function r(){this._len=0}return r.prototype.insert=function(t){var e=new fH(t);return this.insertEntry(e),e},r.prototype.insertEntry=function(t){this.head?(this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t):this.head=this.tail=t,this._len++},r.prototype.remove=function(t){var e=t.prev,i=t.next;e?e.next=i:this.head=i,i?i.prev=e:this.tail=e,t.next=t.prev=null,this._len--},r.prototype.len=function(){return this._len},r.prototype.clear=function(){this.head=this.tail=null,this._len=0},r}(),fmt=function(){function r(t){this._list=new hmt,this._maxSize=10,this._map={},this._maxSize=t}return r.prototype.put=function(t,e){var i=this._list,n=this._map,a=null;if(n[t]==null){var s=i.len(),o=this._lastRemovedEntry;if(s>=this._maxSize&&s>0){var l=i.head;i.remove(l),delete n[l.key],a=l.value,this._lastRemovedEntry=l}o?o.value=e:o=new fH(e),o.key=t,i.insertEntry(o),n[t]=o}return a},r.prototype.get=function(t){var e=this._map[t],i=this._list;if(e!=null)return e!==i.tail&&(i.remove(e),i.insertEntry(e)),e.value},r.prototype.clear=function(){this._list.clear(),this._map={}},r.prototype.len=function(){return this._list.len()},r}();const A_=fmt;var GF={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function No(r){return r=Math.round(r),r<0?0:r>255?255:r}function dmt(r){return r=Math.round(r),r<0?0:r>360?360:r}function Uy(r){return r<0?0:r>1?1:r}function n2(r){var t=r;return t.length&&t.charAt(t.length-1)==="%"?No(parseFloat(t)/100*255):No(parseInt(t,10))}function Af(r){var t=r;return t.length&&t.charAt(t.length-1)==="%"?Uy(parseFloat(t)/100):Uy(parseFloat(t))}function a2(r,t,e){return e<0?e+=1:e>1&&(e-=1),e*6<1?r+(t-r)*e*6:e*2<1?t:e*3<2?r+(t-r)*(2/3-e)*6:r}function Tc(r,t,e){return r+(t-r)*e}function Hs(r,t,e,i,n){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function zI(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}var dH=new A_(20),Dx=null;function ep(r,t){Dx&&zI(Dx,t),Dx=dH.put(r,Dx||t.slice())}function Is(r,t){if(r){t=t||[];var e=dH.get(r);if(e)return zI(t,e);r=r+"";var i=r.replace(/ /g,"").toLowerCase();if(i in GF)return zI(t,GF[i]),ep(r,t),t;var n=i.length;if(i.charAt(0)==="#"){if(n===4||n===5){var a=parseInt(i.slice(1,4),16);if(!(a>=0&&a<=4095)){Hs(t,0,0,0,1);return}return Hs(t,(a&3840)>>4|(a&3840)>>8,a&240|(a&240)>>4,a&15|(a&15)<<4,n===5?parseInt(i.slice(4),16)/15:1),ep(r,t),t}else if(n===7||n===9){var a=parseInt(i.slice(1,7),16);if(!(a>=0&&a<=16777215)){Hs(t,0,0,0,1);return}return Hs(t,(a&16711680)>>16,(a&65280)>>8,a&255,n===9?parseInt(i.slice(7),16)/255:1),ep(r,t),t}return}var s=i.indexOf("("),o=i.indexOf(")");if(s!==-1&&o+1===n){var l=i.substr(0,s),u=i.substr(s+1,o-(s+1)).split(","),c=1;switch(l){case"rgba":if(u.length!==4)return u.length===3?Hs(t,+u[0],+u[1],+u[2],1):Hs(t,0,0,0,1);c=Af(u.pop());case"rgb":if(u.length>=3)return Hs(t,n2(u[0]),n2(u[1]),n2(u[2]),u.length===3?c:Af(u[3])),ep(r,t),t;Hs(t,0,0,0,1);return;case"hsla":if(u.length!==4){Hs(t,0,0,0,1);return}return u[3]=Af(u[3]),VI(u,t),ep(r,t),t;case"hsl":if(u.length!==3){Hs(t,0,0,0,1);return}return VI(u,t),ep(r,t),t;default:return}}Hs(t,0,0,0,1)}}function VI(r,t){var e=(parseFloat(r[0])%360+360)%360/360,i=Af(r[1]),n=Af(r[2]),a=n<=.5?n*(i+1):n+i-n*i,s=n*2-a;return t=t||[],Hs(t,No(a2(s,a,e+1/3)*255),No(a2(s,a,e)*255),No(a2(s,a,e-1/3)*255),1),r.length===4&&(t[3]=r[3]),t}function pmt(r){if(r){var t=r[0]/255,e=r[1]/255,i=r[2]/255,n=Math.min(t,e,i),a=Math.max(t,e,i),s=a-n,o=(a+n)/2,l,u;if(s===0)l=0,u=0;else{o<.5?u=s/(a+n):u=s/(2-a-n);var c=((a-t)/6+s/2)/s,h=((a-e)/6+s/2)/s,p=((a-i)/6+s/2)/s;t===a?l=p-h:e===a?l=1/3+c-p:i===a&&(l=2/3+h-c),l<0&&(l+=1),l>1&&(l-=1)}var v=[l*360,u,o];return r[3]!=null&&v.push(r[3]),v}}function UI(r,t){var e=Is(r);if(e){for(var i=0;i<3;i++)t<0?e[i]=e[i]*(1-t)|0:e[i]=(255-e[i])*t+e[i]|0,e[i]>255?e[i]=255:e[i]<0&&(e[i]=0);return uu(e,e.length===4?"rgba":"rgb")}}function s2(r,t,e){if(!(!(t&&t.length)||!(r>=0&&r<=1))){e=e||[];var i=r*(t.length-1),n=Math.floor(i),a=Math.ceil(i),s=t[n],o=t[a],l=i-n;return e[0]=No(Tc(s[0],o[0],l)),e[1]=No(Tc(s[1],o[1],l)),e[2]=No(Tc(s[2],o[2],l)),e[3]=Uy(Tc(s[3],o[3],l)),e}}function gmt(r,t,e){if(!(!(t&&t.length)||!(r>=0&&r<=1))){var i=r*(t.length-1),n=Math.floor(i),a=Math.ceil(i),s=Is(t[n]),o=Is(t[a]),l=i-n,u=uu([No(Tc(s[0],o[0],l)),No(Tc(s[1],o[1],l)),No(Tc(s[2],o[2],l)),Uy(Tc(s[3],o[3],l))],"rgba");return e?{color:u,leftIndex:n,rightIndex:a,value:i}:u}}function ny(r,t,e,i){var n=Is(r);if(r)return n=pmt(n),t!=null&&(n[0]=dmt(t)),e!=null&&(n[1]=Af(e)),i!=null&&(n[2]=Af(i)),uu(VI(n),"rgba")}function jb(r,t){var e=Is(r);if(e&&t!=null)return e[3]=Uy(t),uu(e,"rgba")}function uu(r,t){if(!(!r||!r.length)){var e=r[0]+","+r[1]+","+r[2];return(t==="rgba"||t==="hsva"||t==="hsla")&&(e+=","+r[3]),t+"("+e+")"}}function Xb(r,t){var e=Is(r);return e?(.299*e[0]+.587*e[1]+.114*e[2])*e[3]/255+(1-e[3])*t:0}var jF=new A_(100);function $I(r){if(ve(r)){var t=jF.get(r);return t||(t=UI(r,-.1),jF.put(r,t)),t}else if(vS(r)){var e=Zt({},r);return e.colorStops=te(r.colorStops,function(i){return{offset:i.offset,color:UI(i.color,-.1)}}),e}return r}var Zb=Math.round;function $y(r){var t;if(!r||r==="transparent")r="none";else if(typeof r=="string"&&r.indexOf("rgba")>-1){var e=Is(r);e&&(r="rgb("+e[0]+","+e[1]+","+e[2]+")",t=e[3])}return{color:r,opacity:t??1}}var XF=1e-4;function Ac(r){return r<XF&&r>-XF}function Lx(r){return Zb(r*1e3)/1e3}function WI(r){return Zb(r*1e4)/1e4}function vmt(r){return"matrix("+Lx(r[0])+","+Lx(r[1])+","+Lx(r[2])+","+Lx(r[3])+","+WI(r[4])+","+WI(r[5])+")"}var mmt={left:"start",right:"end",center:"middle",middle:"middle"};function ymt(r,t,e){return e==="top"?r+=t/2:e==="bottom"&&(r-=t/2),r}function _mt(r){return r&&(r.shadowBlur||r.shadowOffsetX||r.shadowOffsetY)}function xmt(r){var t=r.style,e=r.getGlobalScale();return[t.shadowColor,(t.shadowBlur||0).toFixed(2),(t.shadowOffsetX||0).toFixed(2),(t.shadowOffsetY||0).toFixed(2),e[0],e[1]].join(",")}function pH(r){return r&&!!r.image}function bmt(r){return r&&!!r.svgElement}function NR(r){return pH(r)||bmt(r)}function gH(r){return r.type==="linear"}function vH(r){return r.type==="radial"}function mH(r){return r&&(r.type==="linear"||r.type==="radial")}function _S(r){return"url(#"+r+")"}function yH(r){var t=r.getGlobalScale(),e=Math.max(t[0],t[1]);return Math.max(Math.ceil(Math.log(e)/Math.log(10)),1)}function _H(r){var t=r.x||0,e=r.y||0,i=(r.rotation||0)*V1,n=ir(r.scaleX,1),a=ir(r.scaleY,1),s=r.skewX||0,o=r.skewY||0,l=[];return(t||e)&&l.push("translate("+t+"px,"+e+"px)"),i&&l.push("rotate("+i+")"),(n!==1||a!==1)&&l.push("scale("+n+","+a+")"),(s||o)&&l.push("skew("+Zb(s*V1)+"deg, "+Zb(o*V1)+"deg)"),l.join(" ")}var wmt=function(){return Or.hasGlobalWindow&&Ve(window.btoa)?function(r){return window.btoa(unescape(encodeURIComponent(r)))}:typeof Buffer<"u"?function(r){return Buffer.from(r).toString("base64")}:function(r){return null}}(),HI=Array.prototype.slice;function Kl(r,t,e){return(t-r)*e+r}function o2(r,t,e,i){for(var n=t.length,a=0;a<n;a++)r[a]=Kl(t[a],e[a],i);return r}function Smt(r,t,e,i){for(var n=t.length,a=n&&t[0].length,s=0;s<n;s++){r[s]||(r[s]=[]);for(var o=0;o<a;o++)r[s][o]=Kl(t[s][o],e[s][o],i)}return r}function kx(r,t,e,i){for(var n=t.length,a=0;a<n;a++)r[a]=t[a]+e[a]*i;return r}function ZF(r,t,e,i){for(var n=t.length,a=n&&t[0].length,s=0;s<n;s++){r[s]||(r[s]=[]);for(var o=0;o<a;o++)r[s][o]=t[s][o]+e[s][o]*i}return r}function Tmt(r,t){for(var e=r.length,i=t.length,n=e>i?t:r,a=Math.min(e,i),s=n[a-1]||{color:[0,0,0,0],offset:0},o=a;o<Math.max(e,i);o++)n.push({offset:s.offset,color:s.color.slice()})}function Amt(r,t,e){var i=r,n=t;if(!(!i.push||!n.push)){var a=i.length,s=n.length;if(a!==s){var o=a>s;if(o)i.length=s;else for(var l=a;l<s;l++)i.push(e===1?n[l]:HI.call(n[l]))}for(var u=i[0]&&i[0].length,l=0;l<i.length;l++)if(e===1)isNaN(i[l])&&(i[l]=n[l]);else for(var c=0;c<u;c++)isNaN(i[l][c])&&(i[l][c]=n[l][c])}}function ay(r){if(Sa(r)){var t=r.length;if(Sa(r[0])){for(var e=[],i=0;i<t;i++)e.push(HI.call(r[i]));return e}return HI.call(r)}return r}function G1(r){return r[0]=Math.floor(r[0])||0,r[1]=Math.floor(r[1])||0,r[2]=Math.floor(r[2])||0,r[3]=r[3]==null?1:r[3],"rgba("+r.join(",")+")"}function Cmt(r){return Sa(r&&r[0])?2:1}var Ox=0,j1=1,xH=2,Bm=3,GI=4,jI=5,qF=6;function YF(r){return r===GI||r===jI}function Nx(r){return r===j1||r===xH}var sm=[0,0,0,0],Emt=function(){function r(t){this.keyframes=[],this.discrete=!1,this._invalid=!1,this._needsSort=!1,this._lastFr=0,this._lastFrP=0,this.propName=t}return r.prototype.isFinished=function(){return this._finished},r.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},r.prototype.needsAnimate=function(){return this.keyframes.length>=1},r.prototype.getAdditiveTrack=function(){return this._additiveTrack},r.prototype.addKeyframe=function(t,e,i){this._needsSort=!0;var n=this.keyframes,a=n.length,s=!1,o=qF,l=e;if(Sa(e)){var u=Cmt(e);o=u,(u===1&&!Fr(e[0])||u===2&&!Fr(e[0][0]))&&(s=!0)}else if(Fr(e)&&!zy(e))o=Ox;else if(ve(e))if(!isNaN(+e))o=Ox;else{var c=Is(e);c&&(l=c,o=Bm)}else if(vS(e)){var h=Zt({},l);h.colorStops=te(e.colorStops,function(v){return{offset:v.offset,color:Is(v.color)}}),gH(e)?o=GI:vH(e)&&(o=jI),l=h}a===0?this.valType=o:(o!==this.valType||o===qF)&&(s=!0),this.discrete=this.discrete||s;var p={time:t,value:l,rawValue:e,percent:0};return i&&(p.easing=i,p.easingFunc=Ve(i)?i:aH[i]||OR(i)),n.push(p),p},r.prototype.prepare=function(t,e){var i=this.keyframes;this._needsSort&&i.sort(function(x,w){return x.time-w.time});for(var n=this.valType,a=i.length,s=i[a-1],o=this.discrete,l=Nx(n),u=YF(n),c=0;c<a;c++){var h=i[c],p=h.value,v=s.value;h.percent=h.time/t,o||(l&&c!==a-1?Amt(p,v,n):u&&Tmt(p.colorStops,v.colorStops))}if(!o&&n!==jI&&e&&this.needsAnimate()&&e.needsAnimate()&&n===e.valType&&!e._finished){this._additiveTrack=e;for(var y=i[0].value,c=0;c<a;c++)n===Ox?i[c].additiveValue=i[c].value-y:n===Bm?i[c].additiveValue=kx([],i[c].value,y,-1):Nx(n)&&(i[c].additiveValue=n===j1?kx([],i[c].value,y,-1):ZF([],i[c].value,y,-1))}},r.prototype.step=function(t,e){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var i=this._additiveTrack!=null,n=i?"additiveValue":"value",a=this.valType,s=this.keyframes,o=s.length,l=this.propName,u=a===Bm,c,h=this._lastFr,p=Math.min,v,y;if(o===1)v=y=s[0];else{if(e<0)c=0;else if(e<this._lastFrP){var x=p(h+1,o-1);for(c=x;c>=0&&!(s[c].percent<=e);c--);c=p(c,o-2)}else{for(c=h;c<o&&!(s[c].percent>e);c++);c=p(c-1,o-2)}y=s[c+1],v=s[c]}if(v&&y){this._lastFr=c,this._lastFrP=e;var w=y.percent-v.percent,T=w===0?1:p((e-v.percent)/w,1);y.easingFunc&&(T=y.easingFunc(T));var E=i?this._additiveValue:u?sm:t[l];if((Nx(a)||u)&&!E&&(E=this._additiveValue=[]),this.discrete)t[l]=T<1?v.rawValue:y.rawValue;else if(Nx(a))a===j1?o2(E,v[n],y[n],T):Smt(E,v[n],y[n],T);else if(YF(a)){var M=v[n],L=y[n],F=a===GI;t[l]={type:F?"linear":"radial",x:Kl(M.x,L.x,T),y:Kl(M.y,L.y,T),colorStops:te(M.colorStops,function(U,W){var H=L.colorStops[W];return{offset:Kl(U.offset,H.offset,T),color:G1(o2([],U.color,H.color,T))}}),global:L.global},F?(t[l].x2=Kl(M.x2,L.x2,T),t[l].y2=Kl(M.y2,L.y2,T)):t[l].r=Kl(M.r,L.r,T)}else if(u)o2(E,v[n],y[n],T),i||(t[l]=G1(E));else{var O=Kl(v[n],y[n],T);i?this._additiveValue=O:t[l]=O}i&&this._addToTarget(t)}}},r.prototype._addToTarget=function(t){var e=this.valType,i=this.propName,n=this._additiveValue;e===Ox?t[i]=t[i]+n:e===Bm?(Is(t[i],sm),kx(sm,sm,n,1),t[i]=G1(sm)):e===j1?kx(t[i],t[i],n,1):e===xH&&ZF(t[i],t[i],n,1)},r}(),FR=function(){function r(t,e,i,n){if(this._tracks={},this._trackKeys=[],this._maxTime=0,this._started=0,this._clip=null,this._target=t,this._loop=e,e&&n){IR("Can' use additive animation on looped animation.");return}this._additiveAnimators=n,this._allowDiscrete=i}return r.prototype.getMaxTime=function(){return this._maxTime},r.prototype.getDelay=function(){return this._delay},r.prototype.getLoop=function(){return this._loop},r.prototype.getTarget=function(){return this._target},r.prototype.changeTarget=function(t){this._target=t},r.prototype.when=function(t,e,i){return this.whenWithKeys(t,e,br(e),i)},r.prototype.whenWithKeys=function(t,e,i,n){for(var a=this._tracks,s=0;s<i.length;s++){var o=i[s],l=a[o];if(!l){l=a[o]=new Emt(o);var u=void 0,c=this._getAdditiveTrack(o);if(c){var h=c.keyframes,p=h[h.length-1];u=p&&p.value,c.valType===Bm&&u&&(u=G1(u))}else u=this._target[o];if(u==null)continue;t>0&&l.addKeyframe(0,ay(u),n),this._trackKeys.push(o)}l.addKeyframe(t,ay(e[o]),n)}return this._maxTime=Math.max(this._maxTime,t),this},r.prototype.pause=function(){this._clip.pause(),this._paused=!0},r.prototype.resume=function(){this._clip.resume(),this._paused=!1},r.prototype.isPaused=function(){return!!this._paused},r.prototype.duration=function(t){return this._maxTime=t,this._force=!0,this},r.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var t=this._doneCbs;if(t)for(var e=t.length,i=0;i<e;i++)t[i].call(this)},r.prototype._abortedCallback=function(){this._setTracksFinished();var t=this.animation,e=this._abortedCbs;if(t&&t.removeClip(this._clip),this._clip=null,e)for(var i=0;i<e.length;i++)e[i].call(this)},r.prototype._setTracksFinished=function(){for(var t=this._tracks,e=this._trackKeys,i=0;i<e.length;i++)t[e[i]].setFinished()},r.prototype._getAdditiveTrack=function(t){var e,i=this._additiveAnimators;if(i)for(var n=0;n<i.length;n++){var a=i[n].getTrack(t);a&&(e=a)}return e},r.prototype.start=function(t){if(!(this._started>0)){this._started=1;for(var e=this,i=[],n=this._maxTime||0,a=0;a<this._trackKeys.length;a++){var s=this._trackKeys[a],o=this._tracks[s],l=this._getAdditiveTrack(s),u=o.keyframes,c=u.length;if(o.prepare(n,l),o.needsAnimate())if(!this._allowDiscrete&&o.discrete){var h=u[c-1];h&&(e._target[o.propName]=h.rawValue),o.setFinished()}else i.push(o)}if(i.length||this._force){var p=new cmt({life:n,loop:this._loop,delay:this._delay||0,onframe:function(v){e._started=2;var y=e._additiveAnimators;if(y){for(var x=!1,w=0;w<y.length;w++)if(y[w]._clip){x=!0;break}x||(e._additiveAnimators=null)}for(var w=0;w<i.length;w++)i[w].step(e._target,v);var T=e._onframeCbs;if(T)for(var w=0;w<T.length;w++)T[w](e._target,v)},ondestroy:function(){e._doneCallback()}});this._clip=p,this.animation&&this.animation.addClip(p),t&&p.setEasing(t)}else this._doneCallback();return this}},r.prototype.stop=function(t){if(this._clip){var e=this._clip;t&&e.onframe(1),this._abortedCallback()}},r.prototype.delay=function(t){return this._delay=t,this},r.prototype.during=function(t){return t&&(this._onframeCbs||(this._onframeCbs=[]),this._onframeCbs.push(t)),this},r.prototype.done=function(t){return t&&(this._doneCbs||(this._doneCbs=[]),this._doneCbs.push(t)),this},r.prototype.aborted=function(t){return t&&(this._abortedCbs||(this._abortedCbs=[]),this._abortedCbs.push(t)),this},r.prototype.getClip=function(){return this._clip},r.prototype.getTrack=function(t){return this._tracks[t]},r.prototype.getTracks=function(){var t=this;return te(this._trackKeys,function(e){return t._tracks[e]})},r.prototype.stopTracks=function(t,e){if(!t.length||!this._clip)return!0;for(var i=this._tracks,n=this._trackKeys,a=0;a<t.length;a++){var s=i[t[a]];s&&!s.isFinished()&&(e?s.step(this._target,1):this._started===1&&s.step(this._target,0),s.setFinished())}for(var o=!0,a=0;a<n.length;a++)if(!i[n[a]].isFinished()){o=!1;break}return o&&this._abortedCallback(),o},r.prototype.saveTo=function(t,e,i){if(t){e=e||this._trackKeys;for(var n=0;n<e.length;n++){var a=e[n],s=this._tracks[a];if(!(!s||s.isFinished())){var o=s.keyframes,l=o[i?0:o.length-1];l&&(t[a]=ay(l.rawValue))}}}},r.prototype.__changeFinalValue=function(t,e){e=e||br(t);for(var i=0;i<e.length;i++){var n=e[i],a=this._tracks[n];if(a){var s=a.keyframes;if(s.length>1){var o=s.pop();a.addKeyframe(o.time,t[n]),a.prepare(this._maxTime,a.getAdditiveTrack())}}}},r}();function zp(){return new Date().getTime()}var Imt=function(r){bi(t,r);function t(e){var i=r.call(this)||this;return i._running=!1,i._time=0,i._pausedTime=0,i._pauseStart=0,i._paused=!1,e=e||{},i.stage=e.stage||{},i}return t.prototype.addClip=function(e){e.animation&&this.removeClip(e),this._head?(this._tail.next=e,e.prev=this._tail,e.next=null,this._tail=e):this._head=this._tail=e,e.animation=this},t.prototype.addAnimator=function(e){e.animation=this;var i=e.getClip();i&&this.addClip(i)},t.prototype.removeClip=function(e){if(e.animation){var i=e.prev,n=e.next;i?i.next=n:this._head=n,n?n.prev=i:this._tail=i,e.next=e.prev=e.animation=null}},t.prototype.removeAnimator=function(e){var i=e.getClip();i&&this.removeClip(i),e.animation=null},t.prototype.update=function(e){for(var i=zp()-this._pausedTime,n=i-this._time,a=this._head;a;){var s=a.next,o=a.step(i,n);o&&(a.ondestroy(),this.removeClip(a)),a=s}this._time=i,e||(this.trigger("frame",n),this.stage.update&&this.stage.update())},t.prototype._startLoop=function(){var e=this;this._running=!0;function i(){e._running&&(FI(i),!e._paused&&e.update())}FI(i)},t.prototype.start=function(){this._running||(this._time=zp(),this._pausedTime=0,this._startLoop())},t.prototype.stop=function(){this._running=!1},t.prototype.pause=function(){this._paused||(this._pauseStart=zp(),this._paused=!0)},t.prototype.resume=function(){this._paused&&(this._pausedTime+=zp()-this._pauseStart,this._paused=!1)},t.prototype.clear=function(){for(var e=this._head;e;){var i=e.next;e.prev=e.next=e.animation=null,e=i}this._head=this._tail=null},t.prototype.isFinished=function(){return this._head==null},t.prototype.animate=function(e,i){i=i||{},this.start();var n=new FR(e,i.loop);return this.addAnimator(n),n},t}(so);const Mmt=Imt;var Pmt=300,l2=Or.domSupported,u2=function(){var r=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],t=["touchstart","touchend","touchmove"],e={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},i=te(r,function(n){var a=n.replace("mouse","pointer");return e.hasOwnProperty(a)?a:n});return{mouse:r,touch:t,pointer:i}}(),KF={mouse:["mousemove","mouseup"],pointer:["pointermove","pointerup"]},JF=!1;function XI(r){var t=r.pointerType;return t==="pen"||t==="touch"}function Rmt(r){r.touching=!0,r.touchTimer!=null&&(clearTimeout(r.touchTimer),r.touchTimer=null),r.touchTimer=setTimeout(function(){r.touching=!1,r.touchTimer=null},700)}function c2(r){r&&(r.zrByTouch=!0)}function Dmt(r,t){return Gs(r.dom,new Lmt(r,t),!0)}function bH(r,t){for(var e=t,i=!1;e&&e.nodeType!==9&&!(i=e.domBelongToZr||e!==t&&e===r.painterRoot);)e=e.parentNode;return i}var Lmt=function(){function r(t,e){this.stopPropagation=nn,this.stopImmediatePropagation=nn,this.preventDefault=nn,this.type=e.type,this.target=this.currentTarget=t.dom,this.pointerType=e.pointerType,this.clientX=e.clientX,this.clientY=e.clientY}return r}(),Eo={mousedown:function(r){r=Gs(this.dom,r),this.__mayPointerCapture=[r.zrX,r.zrY],this.trigger("mousedown",r)},mousemove:function(r){r=Gs(this.dom,r);var t=this.__mayPointerCapture;t&&(r.zrX!==t[0]||r.zrY!==t[1])&&this.__togglePointerCapture(!0),this.trigger("mousemove",r)},mouseup:function(r){r=Gs(this.dom,r),this.__togglePointerCapture(!1),this.trigger("mouseup",r)},mouseout:function(r){r=Gs(this.dom,r);var t=r.toElement||r.relatedTarget;bH(this,t)||(this.__pointerCapturing&&(r.zrEventControl="no_globalout"),this.trigger("mouseout",r))},wheel:function(r){JF=!0,r=Gs(this.dom,r),this.trigger("mousewheel",r)},mousewheel:function(r){JF||(r=Gs(this.dom,r),this.trigger("mousewheel",r))},touchstart:function(r){r=Gs(this.dom,r),c2(r),this.__lastTouchMoment=new Date,this.handler.processGesture(r,"start"),Eo.mousemove.call(this,r),Eo.mousedown.call(this,r)},touchmove:function(r){r=Gs(this.dom,r),c2(r),this.handler.processGesture(r,"change"),Eo.mousemove.call(this,r)},touchend:function(r){r=Gs(this.dom,r),c2(r),this.handler.processGesture(r,"end"),Eo.mouseup.call(this,r),+new Date-+this.__lastTouchMoment<Pmt&&Eo.click.call(this,r)},pointerdown:function(r){Eo.mousedown.call(this,r)},pointermove:function(r){XI(r)||Eo.mousemove.call(this,r)},pointerup:function(r){Eo.mouseup.call(this,r)},pointerout:function(r){XI(r)||Eo.mouseout.call(this,r)}};J(["click","dblclick","contextmenu"],function(r){Eo[r]=function(t){t=Gs(this.dom,t),this.trigger(r,t)}});var ZI={pointermove:function(r){XI(r)||ZI.mousemove.call(this,r)},pointerup:function(r){ZI.mouseup.call(this,r)},mousemove:function(r){this.trigger("mousemove",r)},mouseup:function(r){var t=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",r),t&&(r.zrEventControl="only_globalout",this.trigger("mouseout",r))}};function kmt(r,t){var e=t.domHandlers;Or.pointerEventsSupported?J(u2.pointer,function(i){X1(t,i,function(n){e[i].call(r,n)})}):(Or.touchEventsSupported&&J(u2.touch,function(i){X1(t,i,function(n){e[i].call(r,n),Rmt(t)})}),J(u2.mouse,function(i){X1(t,i,function(n){n=DR(n),t.touching||e[i].call(r,n)})}))}function Omt(r,t){Or.pointerEventsSupported?J(KF.pointer,e):Or.touchEventsSupported||J(KF.mouse,e);function e(i){function n(a){a=DR(a),bH(r,a.target)||(a=Dmt(r,a),t.domHandlers[i].call(r,a))}X1(t,i,n,{capture:!0})}}function X1(r,t,e,i){r.mounted[t]=e,r.listenerOpts[t]=i,NI(r.domTarget,t,e,i)}function h2(r){var t=r.mounted;for(var e in t)t.hasOwnProperty(e)&&$vt(r.domTarget,e,t[e],r.listenerOpts[e]);r.mounted={}}var QF=function(){function r(t,e){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=t,this.domHandlers=e}return r}(),Nmt=function(r){bi(t,r);function t(e,i){var n=r.call(this)||this;return n.__pointerCapturing=!1,n.dom=e,n.painterRoot=i,n._localHandlerScope=new QF(e,Eo),l2&&(n._globalHandlerScope=new QF(document,ZI)),kmt(n,n._localHandlerScope),n}return t.prototype.dispose=function(){h2(this._localHandlerScope),l2&&h2(this._globalHandlerScope)},t.prototype.setCursor=function(e){this.dom.style&&(this.dom.style.cursor=e||"default")},t.prototype.__togglePointerCapture=function(e){if(this.__mayPointerCapture=null,l2&&+this.__pointerCapturing^+e){this.__pointerCapturing=e;var i=this._globalHandlerScope;e?Omt(this,i):h2(i)}},t}(so);const Fmt=Nmt;var wH=1;Or.hasGlobalWindow&&(wH=Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1));var qb=wH,qI=.4,YI="#333",KI="#ccc",Bmt="#eee",tB=yS,eB=5e-5;function Ih(r){return r>eB||r<-eB}var Mh=[],rp=[],f2=Es(),d2=Math.abs,zmt=function(){function r(){}return r.prototype.getLocalTransform=function(t){return r.getLocalTransform(this,t)},r.prototype.setPosition=function(t){this.x=t[0],this.y=t[1]},r.prototype.setScale=function(t){this.scaleX=t[0],this.scaleY=t[1]},r.prototype.setSkew=function(t){this.skewX=t[0],this.skewY=t[1]},r.prototype.setOrigin=function(t){this.originX=t[0],this.originY=t[1]},r.prototype.needLocalTransform=function(){return Ih(this.rotation)||Ih(this.x)||Ih(this.y)||Ih(this.scaleX-1)||Ih(this.scaleY-1)||Ih(this.skewX)||Ih(this.skewY)},r.prototype.updateTransform=function(){var t=this.parent&&this.parent.transform,e=this.needLocalTransform(),i=this.transform;if(!(e||t)){i&&(tB(i),this.invTransform=null);return}i=i||Es(),e?this.getLocalTransform(i):tB(i),t&&(e?lu(i,t,i):LR(i,t)),this.transform=i,this._resolveGlobalScaleRatio(i)},r.prototype._resolveGlobalScaleRatio=function(t){var e=this.globalScaleRatio;if(e!=null&&e!==1){this.getGlobalScale(Mh);var i=Mh[0]<0?-1:1,n=Mh[1]<0?-1:1,a=((Mh[0]-i)*e+i)/Mh[0]||0,s=((Mh[1]-n)*e+n)/Mh[1]||0;t[0]*=a,t[1]*=a,t[2]*=s,t[3]*=s}this.invTransform=this.invTransform||Es(),Mg(this.invTransform,t)},r.prototype.getComputedTransform=function(){for(var t=this,e=[];t;)e.push(t),t=t.parent;for(;t=e.pop();)t.updateTransform();return this.transform},r.prototype.setLocalTransform=function(t){if(t){var e=t[0]*t[0]+t[1]*t[1],i=t[2]*t[2]+t[3]*t[3],n=Math.atan2(t[1],t[0]),a=Math.PI/2+n-Math.atan2(t[3],t[2]);i=Math.sqrt(i)*Math.cos(a),e=Math.sqrt(e),this.skewX=a,this.skewY=0,this.rotation=-n,this.x=+t[4],this.y=+t[5],this.scaleX=e,this.scaleY=i,this.originX=0,this.originY=0}},r.prototype.decomposeTransform=function(){if(this.transform){var t=this.parent,e=this.transform;t&&t.transform&&(t.invTransform=t.invTransform||Es(),lu(rp,t.invTransform,e),e=rp);var i=this.originX,n=this.originY;(i||n)&&(f2[4]=i,f2[5]=n,lu(rp,e,f2),rp[4]-=i,rp[5]-=n,e=rp),this.setLocalTransform(e)}},r.prototype.getGlobalScale=function(t){var e=this.transform;return t=t||[],e?(t[0]=Math.sqrt(e[0]*e[0]+e[1]*e[1]),t[1]=Math.sqrt(e[2]*e[2]+e[3]*e[3]),e[0]<0&&(t[0]=-t[0]),e[3]<0&&(t[1]=-t[1]),t):(t[0]=1,t[1]=1,t)},r.prototype.transformCoordToLocal=function(t,e){var i=[t,e],n=this.invTransform;return n&&Qn(i,i,n),i},r.prototype.transformCoordToGlobal=function(t,e){var i=[t,e],n=this.transform;return n&&Qn(i,i,n),i},r.prototype.getLineScale=function(){var t=this.transform;return t&&d2(t[0]-1)>1e-10&&d2(t[3]-1)>1e-10?Math.sqrt(d2(t[0]*t[3]-t[2]*t[1])):1},r.prototype.copyTransform=function(t){SH(this,t)},r.getLocalTransform=function(t,e){e=e||[];var i=t.originX||0,n=t.originY||0,a=t.scaleX,s=t.scaleY,o=t.anchorX,l=t.anchorY,u=t.rotation||0,c=t.x,h=t.y,p=t.skewX?Math.tan(t.skewX):0,v=t.skewY?Math.tan(-t.skewY):0;if(i||n||o||l){var y=i+o,x=n+l;e[4]=-y*a-p*x*s,e[5]=-x*s-v*y*a}else e[4]=e[5]=0;return e[0]=a,e[3]=s,e[1]=v*a,e[2]=p*s,u&&td(e,e,u),e[4]+=i+c,e[5]+=n+h,e},r.initDefaultProps=function(){var t=r.prototype;t.scaleX=t.scaleY=t.globalScaleRatio=1,t.x=t.y=t.originX=t.originY=t.skewX=t.skewY=t.rotation=t.anchorX=t.anchorY=0}(),r}(),Sl=["x","y","originX","originY","anchorX","anchorY","rotation","scaleX","scaleY","skewX","skewY"];function SH(r,t){for(var e=0;e<Sl.length;e++){var i=Sl[e];r[i]=t[i]}}const ru=zmt;var rB={};function Ms(r,t){t=t||zc;var e=rB[t];e||(e=rB[t]=new A_(500));var i=e.get(r);return i==null&&(i=Vc.measureText(r,t).width,e.put(r,i)),i}function iB(r,t,e,i){var n=Ms(r,t),a=xS(t),s=zm(0,n,e),o=Sp(0,a,i),l=new hr(s,o,n,a);return l}function C_(r,t,e,i){var n=((r||"")+"").split(`
`),a=n.length;if(a===1)return iB(n[0],t,e,i);for(var s=new hr(0,0,0,0),o=0;o<n.length;o++){var l=iB(n[o],t,e,i);o===0?s.copy(l):s.union(l)}return s}function zm(r,t,e){return e==="right"?r-=t:e==="center"&&(r-=t/2),r}function Sp(r,t,e){return e==="middle"?r-=t/2:e==="bottom"&&(r-=t),r}function xS(r){return Ms("",r)}function zo(r,t){return typeof r=="string"?r.lastIndexOf("%")>=0?parseFloat(r)/100*t:parseFloat(r):r}function Yb(r,t,e){var i=t.position||"inside",n=t.distance!=null?t.distance:5,a=e.height,s=e.width,o=a/2,l=e.x,u=e.y,c="left",h="top";if(i instanceof Array)l+=zo(i[0],e.width),u+=zo(i[1],e.height),c=null,h=null;else switch(i){case"left":l-=n,u+=o,c="right",h="middle";break;case"right":l+=n+s,u+=o,h="middle";break;case"top":l+=s/2,u-=n,c="center",h="bottom";break;case"bottom":l+=s/2,u+=a+n,c="center";break;case"inside":l+=s/2,u+=o,c="center",h="middle";break;case"insideLeft":l+=n,u+=o,h="middle";break;case"insideRight":l+=s-n,u+=o,c="right",h="middle";break;case"insideTop":l+=s/2,u+=n,c="center";break;case"insideBottom":l+=s/2,u+=a-n,c="center",h="bottom";break;case"insideTopLeft":l+=n,u+=n;break;case"insideTopRight":l+=s-n,u+=n,c="right";break;case"insideBottomLeft":l+=n,u+=a-n,h="bottom";break;case"insideBottomRight":l+=s-n,u+=a-n,c="right",h="bottom";break}return r=r||{},r.x=l,r.y=u,r.align=c,r.verticalAlign=h,r}var p2="__zr_normal__",g2=Sl.concat(["ignore"]),Vmt=bl(Sl,function(r,t){return r[t]=!0,r},{ignore:!1}),ip={},Umt=new hr(0,0,0,0),BR=function(){function r(t){this.id=qW(),this.animators=[],this.currentStates=[],this.states={},this._init(t)}return r.prototype._init=function(t){this.attr(t)},r.prototype.drift=function(t,e,i){switch(this.draggable){case"horizontal":e=0;break;case"vertical":t=0;break}var n=this.transform;n||(n=this.transform=[1,0,0,1,0,0]),n[4]+=t,n[5]+=e,this.decomposeTransform(),this.markRedraw()},r.prototype.beforeUpdate=function(){},r.prototype.afterUpdate=function(){},r.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},r.prototype.updateInnerText=function(t){var e=this._textContent;if(e&&(!e.ignore||t)){this.textConfig||(this.textConfig={});var i=this.textConfig,n=i.local,a=e.innerTransformable,s=void 0,o=void 0,l=!1;a.parent=n?this:null;var u=!1;if(a.copyTransform(e),i.position!=null){var c=Umt;i.layoutRect?c.copy(i.layoutRect):c.copy(this.getBoundingRect()),n||c.applyTransform(this.transform),this.calculateTextPosition?this.calculateTextPosition(ip,i,c):Yb(ip,i,c),a.x=ip.x,a.y=ip.y,s=ip.align,o=ip.verticalAlign;var h=i.origin;if(h&&i.rotation!=null){var p=void 0,v=void 0;h==="center"?(p=c.width*.5,v=c.height*.5):(p=zo(h[0],c.width),v=zo(h[1],c.height)),u=!0,a.originX=-a.x+p+(n?0:c.x),a.originY=-a.y+v+(n?0:c.y)}}i.rotation!=null&&(a.rotation=i.rotation);var y=i.offset;y&&(a.x+=y[0],a.y+=y[1],u||(a.originX=-y[0],a.originY=-y[1]));var x=i.inside==null?typeof i.position=="string"&&i.position.indexOf("inside")>=0:i.inside,w=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={}),T=void 0,E=void 0,M=void 0;x&&this.canBeInsideText()?(T=i.insideFill,E=i.insideStroke,(T==null||T==="auto")&&(T=this.getInsideTextFill()),(E==null||E==="auto")&&(E=this.getInsideTextStroke(T),M=!0)):(T=i.outsideFill,E=i.outsideStroke,(T==null||T==="auto")&&(T=this.getOutsideFill()),(E==null||E==="auto")&&(E=this.getOutsideStroke(T),M=!0)),T=T||"#000",(T!==w.fill||E!==w.stroke||M!==w.autoStroke||s!==w.align||o!==w.verticalAlign)&&(l=!0,w.fill=T,w.stroke=E,w.autoStroke=M,w.align=s,w.verticalAlign=o,e.setDefaultTextStyle(w)),e.__dirty|=Ts,l&&e.dirtyStyle(!0)}},r.prototype.canBeInsideText=function(){return!0},r.prototype.getInsideTextFill=function(){return"#fff"},r.prototype.getInsideTextStroke=function(t){return"#000"},r.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?KI:YI},r.prototype.getOutsideStroke=function(t){var e=this.__zr&&this.__zr.getBackgroundColor(),i=typeof e=="string"&&Is(e);i||(i=[255,255,255,1]);for(var n=i[3],a=this.__zr.isDarkMode(),s=0;s<3;s++)i[s]=i[s]*n+(a?0:255)*(1-n);return i[3]=1,uu(i,"rgba")},r.prototype.traverse=function(t,e){},r.prototype.attrKV=function(t,e){t==="textConfig"?this.setTextConfig(e):t==="textContent"?this.setTextContent(e):t==="clipPath"?this.setClipPath(e):t==="extra"?(this.extra=this.extra||{},Zt(this.extra,e)):this[t]=e},r.prototype.hide=function(){this.ignore=!0,this.markRedraw()},r.prototype.show=function(){this.ignore=!1,this.markRedraw()},r.prototype.attr=function(t,e){if(typeof t=="string")this.attrKV(t,e);else if(je(t))for(var i=t,n=br(i),a=0;a<n.length;a++){var s=n[a];this.attrKV(s,t[s])}return this.markRedraw(),this},r.prototype.saveCurrentToNormalState=function(t){this._innerSaveToNormal(t);for(var e=this._normalState,i=0;i<this.animators.length;i++){var n=this.animators[i],a=n.__fromStateTransition;if(!(n.getLoop()||a&&a!==p2)){var s=n.targetName,o=s?e[s]:e;n.saveTo(o)}}},r.prototype._innerSaveToNormal=function(t){var e=this._normalState;e||(e=this._normalState={}),t.textConfig&&!e.textConfig&&(e.textConfig=this.textConfig),this._savePrimaryToNormal(t,e,g2)},r.prototype._savePrimaryToNormal=function(t,e,i){for(var n=0;n<i.length;n++){var a=i[n];t[a]!=null&&!(a in e)&&(e[a]=this[a])}},r.prototype.hasState=function(){return this.currentStates.length>0},r.prototype.getState=function(t){return this.states[t]},r.prototype.ensureState=function(t){var e=this.states;return e[t]||(e[t]={}),e[t]},r.prototype.clearStates=function(t){this.useState(p2,!1,t)},r.prototype.useState=function(t,e,i,n){var a=t===p2,s=this.hasState();if(!(!s&&a)){var o=this.currentStates,l=this.stateTransition;if(!(pr(o,t)>=0&&(e||o.length===1))){var u;if(this.stateProxy&&!a&&(u=this.stateProxy(t)),u||(u=this.states&&this.states[t]),!u&&!a){IR("State "+t+" not exists.");return}a||this.saveCurrentToNormalState(u);var c=!!(u&&u.hoverLayer||n);c&&this._toggleHoverLayerFlag(!0),this._applyStateObj(t,u,this._normalState,e,!i&&!this.__inHover&&l&&l.duration>0,l);var h=this._textContent,p=this._textGuide;return h&&h.useState(t,e,i,c),p&&p.useState(t,e,i,c),a?(this.currentStates=[],this._normalState={}):e?this.currentStates.push(t):this.currentStates=[t],this._updateAnimationTargets(),this.markRedraw(),!c&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Ts),u}}},r.prototype.useStates=function(t,e,i){if(!t.length)this.clearStates();else{var n=[],a=this.currentStates,s=t.length,o=s===a.length;if(o){for(var l=0;l<s;l++)if(t[l]!==a[l]){o=!1;break}}if(o)return;for(var l=0;l<s;l++){var u=t[l],c=void 0;this.stateProxy&&(c=this.stateProxy(u,t)),c||(c=this.states[u]),c&&n.push(c)}var h=n[s-1],p=!!(h&&h.hoverLayer||i);p&&this._toggleHoverLayerFlag(!0);var v=this._mergeStates(n),y=this.stateTransition;this.saveCurrentToNormalState(v),this._applyStateObj(t.join(","),v,this._normalState,!1,!e&&!this.__inHover&&y&&y.duration>0,y);var x=this._textContent,w=this._textGuide;x&&x.useStates(t,e,p),w&&w.useStates(t,e,p),this._updateAnimationTargets(),this.currentStates=t.slice(),this.markRedraw(),!p&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Ts)}},r.prototype.isSilent=function(){for(var t=this.silent,e=this.parent;!t&&e;){if(e.silent){t=!0;break}e=e.parent}return t},r.prototype._updateAnimationTargets=function(){for(var t=0;t<this.animators.length;t++){var e=this.animators[t];e.targetName&&e.changeTarget(this[e.targetName])}},r.prototype.removeState=function(t){var e=pr(this.currentStates,t);if(e>=0){var i=this.currentStates.slice();i.splice(e,1),this.useStates(i)}},r.prototype.replaceState=function(t,e,i){var n=this.currentStates.slice(),a=pr(n,t),s=pr(n,e)>=0;a>=0?s?n.splice(a,1):n[a]=e:i&&!s&&n.push(e),this.useStates(n)},r.prototype.toggleState=function(t,e){e?this.useState(t,!0):this.removeState(t)},r.prototype._mergeStates=function(t){for(var e={},i,n=0;n<t.length;n++){var a=t[n];Zt(e,a),a.textConfig&&(i=i||{},Zt(i,a.textConfig))}return i&&(e.textConfig=i),e},r.prototype._applyStateObj=function(t,e,i,n,a,s){var o=!(e&&n);e&&e.textConfig?(this.textConfig=Zt({},n?this.textConfig:i.textConfig),Zt(this.textConfig,e.textConfig)):o&&i.textConfig&&(this.textConfig=i.textConfig);for(var l={},u=!1,c=0;c<g2.length;c++){var h=g2[c],p=a&&Vmt[h];e&&e[h]!=null?p?(u=!0,l[h]=e[h]):this[h]=e[h]:o&&i[h]!=null&&(p?(u=!0,l[h]=i[h]):this[h]=i[h])}if(!a)for(var c=0;c<this.animators.length;c++){var v=this.animators[c],y=v.targetName;v.getLoop()||v.__changeFinalValue(y?(e||i)[y]:e||i)}u&&this._transitionState(t,l,s)},r.prototype._attachComponent=function(t){if(!(t.__zr&&!t.__hostTarget)&&t!==this){var e=this.__zr;e&&t.addSelfToZr(e),t.__zr=e,t.__hostTarget=this}},r.prototype._detachComponent=function(t){t.__zr&&t.removeSelfFromZr(t.__zr),t.__zr=null,t.__hostTarget=null},r.prototype.getClipPath=function(){return this._clipPath},r.prototype.setClipPath=function(t){this._clipPath&&this._clipPath!==t&&this.removeClipPath(),this._attachComponent(t),this._clipPath=t,this.markRedraw()},r.prototype.removeClipPath=function(){var t=this._clipPath;t&&(this._detachComponent(t),this._clipPath=null,this.markRedraw())},r.prototype.getTextContent=function(){return this._textContent},r.prototype.setTextContent=function(t){var e=this._textContent;e!==t&&(e&&e!==t&&this.removeTextContent(),t.innerTransformable=new ru,this._attachComponent(t),this._textContent=t,this.markRedraw())},r.prototype.setTextConfig=function(t){this.textConfig||(this.textConfig={}),Zt(this.textConfig,t),this.markRedraw()},r.prototype.removeTextConfig=function(){this.textConfig=null,this.markRedraw()},r.prototype.removeTextContent=function(){var t=this._textContent;t&&(t.innerTransformable=null,this._detachComponent(t),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},r.prototype.getTextGuideLine=function(){return this._textGuide},r.prototype.setTextGuideLine=function(t){this._textGuide&&this._textGuide!==t&&this.removeTextGuideLine(),this._attachComponent(t),this._textGuide=t,this.markRedraw()},r.prototype.removeTextGuideLine=function(){var t=this._textGuide;t&&(this._detachComponent(t),this._textGuide=null,this.markRedraw())},r.prototype.markRedraw=function(){this.__dirty|=Ts;var t=this.__zr;t&&(this.__inHover?t.refreshHover():t.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},r.prototype.dirty=function(){this.markRedraw()},r.prototype._toggleHoverLayerFlag=function(t){this.__inHover=t;var e=this._textContent,i=this._textGuide;e&&(e.__inHover=t),i&&(i.__inHover=t)},r.prototype.addSelfToZr=function(t){if(this.__zr!==t){this.__zr=t;var e=this.animators;if(e)for(var i=0;i<e.length;i++)t.animation.addAnimator(e[i]);this._clipPath&&this._clipPath.addSelfToZr(t),this._textContent&&this._textContent.addSelfToZr(t),this._textGuide&&this._textGuide.addSelfToZr(t)}},r.prototype.removeSelfFromZr=function(t){if(this.__zr){this.__zr=null;var e=this.animators;if(e)for(var i=0;i<e.length;i++)t.animation.removeAnimator(e[i]);this._clipPath&&this._clipPath.removeSelfFromZr(t),this._textContent&&this._textContent.removeSelfFromZr(t),this._textGuide&&this._textGuide.removeSelfFromZr(t)}},r.prototype.animate=function(t,e,i){var n=t?this[t]:this,a=new FR(n,e,i);return t&&(a.targetName=t),this.addAnimator(a,t),a},r.prototype.addAnimator=function(t,e){var i=this.__zr,n=this;t.during(function(){n.updateDuringAnimation(e)}).done(function(){var a=n.animators,s=pr(a,t);s>=0&&a.splice(s,1)}),this.animators.push(t),i&&i.animation.addAnimator(t),i&&i.wakeUp()},r.prototype.updateDuringAnimation=function(t){this.markRedraw()},r.prototype.stopAnimation=function(t,e){for(var i=this.animators,n=i.length,a=[],s=0;s<n;s++){var o=i[s];!t||t===o.scope?o.stop(e):a.push(o)}return this.animators=a,this},r.prototype.animateTo=function(t,e,i){v2(this,t,e,i)},r.prototype.animateFrom=function(t,e,i){v2(this,t,e,i,!0)},r.prototype._transitionState=function(t,e,i,n){for(var a=v2(this,e,i,n),s=0;s<a.length;s++)a[s].__fromStateTransition=t},r.prototype.getBoundingRect=function(){return null},r.prototype.getPaintRect=function(){return null},r.initDefaultProps=function(){var t=r.prototype;t.type="element",t.name="",t.ignore=t.silent=t.isGroup=t.draggable=t.dragging=t.ignoreClip=t.__inHover=!1,t.__dirty=Ts;function e(i,n,a,s){Object.defineProperty(t,i,{get:function(){if(!this[n]){var l=this[n]=[];o(this,l)}return this[n]},set:function(l){this[a]=l[0],this[s]=l[1],this[n]=l,o(this,l)}});function o(l,u){Object.defineProperty(u,0,{get:function(){return l[a]},set:function(c){l[a]=c}}),Object.defineProperty(u,1,{get:function(){return l[s]},set:function(c){l[s]=c}})}}Object.defineProperty&&(e("position","_legacyPos","x","y"),e("scale","_legacyScale","scaleX","scaleY"),e("origin","_legacyOrigin","originX","originY"))}(),r}();yn(BR,so);yn(BR,ru);function v2(r,t,e,i,n){e=e||{};var a=[];TH(r,"",r,t,e,i,a,n);var s=a.length,o=!1,l=e.done,u=e.aborted,c=function(){o=!0,s--,s<=0&&(o?l&&l():u&&u())},h=function(){s--,s<=0&&(o?l&&l():u&&u())};s||l&&l(),a.length>0&&e.during&&a[0].during(function(y,x){e.during(x)});for(var p=0;p<a.length;p++){var v=a[p];c&&v.done(c),h&&v.aborted(h),e.force&&v.duration(e.duration),v.start(e.easing)}return a}function m2(r,t,e){for(var i=0;i<e;i++)r[i]=t[i]}function $mt(r){return Sa(r[0])}function Wmt(r,t,e){if(Sa(t[e]))if(Sa(r[e])||(r[e]=[]),hs(t[e])){var i=t[e].length;r[e].length!==i&&(r[e]=new t[e].constructor(i),m2(r[e],t[e],i))}else{var n=t[e],a=r[e],s=n.length;if($mt(n))for(var o=n[0].length,l=0;l<s;l++)a[l]?m2(a[l],n[l],o):a[l]=Array.prototype.slice.call(n[l]);else m2(a,n,s);a.length=n.length}else r[e]=t[e]}function Hmt(r,t){return r===t||Sa(r)&&Sa(t)&&Gmt(r,t)}function Gmt(r,t){var e=r.length;if(e!==t.length)return!1;for(var i=0;i<e;i++)if(r[i]!==t[i])return!1;return!0}function TH(r,t,e,i,n,a,s,o){for(var l=br(i),u=n.duration,c=n.delay,h=n.additive,p=n.setToFinal,v=!je(a),y=r.animators,x=[],w=0;w<l.length;w++){var T=l[w],E=i[T];if(E!=null&&e[T]!=null&&(v||a[T]))if(je(E)&&!Sa(E)&&!vS(E)){if(t){o||(e[T]=E,r.updateDuringAnimation(t));continue}TH(r,T,e[T],E,n,a&&a[T],s,o)}else x.push(T);else o||(e[T]=E,r.updateDuringAnimation(t),x.push(T))}var M=x.length;if(!h&&M)for(var L=0;L<y.length;L++){var F=y[L];if(F.targetName===t){var O=F.stopTracks(x);if(O){var U=pr(y,F);y.splice(U,1)}}}if(n.force||(x=ti(x,function(Y){return!Hmt(i[Y],e[Y])}),M=x.length),M>0||n.force&&!s.length){var W=void 0,H=void 0,j=void 0;if(o){H={},p&&(W={});for(var L=0;L<M;L++){var T=x[L];H[T]=e[T],p?W[T]=i[T]:e[T]=i[T]}}else if(p){j={};for(var L=0;L<M;L++){var T=x[L];j[T]=ay(e[T]),Wmt(e,i,T)}}var F=new FR(e,!1,!1,h?ti(y,function(tt){return tt.targetName===t}):null);F.targetName=t,n.scope&&(F.scope=n.scope),p&&W&&F.whenWithKeys(0,W,x),j&&F.whenWithKeys(0,j,x),F.whenWithKeys(u??500,o?H:i,x).delay(c||0),r.addAnimator(F,t),s.push(F)}}const AH=BR;var CH=function(r){bi(t,r);function t(e){var i=r.call(this)||this;return i.isGroup=!0,i._children=[],i.attr(e),i}return t.prototype.childrenRef=function(){return this._children},t.prototype.children=function(){return this._children.slice()},t.prototype.childAt=function(e){return this._children[e]},t.prototype.childOfName=function(e){for(var i=this._children,n=0;n<i.length;n++)if(i[n].name===e)return i[n]},t.prototype.childCount=function(){return this._children.length},t.prototype.add=function(e){return e&&e!==this&&e.parent!==this&&(this._children.push(e),this._doAdd(e)),this},t.prototype.addBefore=function(e,i){if(e&&e!==this&&e.parent!==this&&i&&i.parent===this){var n=this._children,a=n.indexOf(i);a>=0&&(n.splice(a,0,e),this._doAdd(e))}return this},t.prototype.replace=function(e,i){var n=pr(this._children,e);return n>=0&&this.replaceAt(i,n),this},t.prototype.replaceAt=function(e,i){var n=this._children,a=n[i];if(e&&e!==this&&e.parent!==this&&e!==a){n[i]=e,a.parent=null;var s=this.__zr;s&&a.removeSelfFromZr(s),this._doAdd(e)}return this},t.prototype._doAdd=function(e){e.parent&&e.parent.remove(e),e.parent=this;var i=this.__zr;i&&i!==e.__zr&&e.addSelfToZr(i),i&&i.refresh()},t.prototype.remove=function(e){var i=this.__zr,n=this._children,a=pr(n,e);return a<0?this:(n.splice(a,1),e.parent=null,i&&e.removeSelfFromZr(i),i&&i.refresh(),this)},t.prototype.removeAll=function(){for(var e=this._children,i=this.__zr,n=0;n<e.length;n++){var a=e[n];i&&a.removeSelfFromZr(i),a.parent=null}return e.length=0,this},t.prototype.eachChild=function(e,i){for(var n=this._children,a=0;a<n.length;a++){var s=n[a];e.call(i,s,a)}return this},t.prototype.traverse=function(e,i){for(var n=0;n<this._children.length;n++){var a=this._children[n],s=e.call(i,a);a.isGroup&&!s&&a.traverse(e,i)}return this},t.prototype.addSelfToZr=function(e){r.prototype.addSelfToZr.call(this,e);for(var i=0;i<this._children.length;i++){var n=this._children[i];n.addSelfToZr(e)}},t.prototype.removeSelfFromZr=function(e){r.prototype.removeSelfFromZr.call(this,e);for(var i=0;i<this._children.length;i++){var n=this._children[i];n.removeSelfFromZr(e)}},t.prototype.getBoundingRect=function(e){for(var i=new hr(0,0,0,0),n=e||this._children,a=[],s=null,o=0;o<n.length;o++){var l=n[o];if(!(l.ignore||l.invisible)){var u=l.getBoundingRect(),c=l.getLocalTransform(a);c?(hr.applyTransform(i,u,c),s=s||i.clone(),s.union(i)):(s=s||u.clone(),s.union(u))}}return s||i},t}(AH);CH.prototype.type="group";const Ke=CH;/*!
* ZRender, a high performance 2d drawing library.
*
* Copyright (c) 2013, Baidu Inc.
* All rights reserved.
*
* LICENSE
* https://github.com/ecomfe/zrender/blob/master/LICENSE.txt
*/var Z1={},EH={};function jmt(r){delete EH[r]}function Xmt(r){if(!r)return!1;if(typeof r=="string")return Xb(r,1)<qI;if(r.colorStops){for(var t=r.colorStops,e=0,i=t.length,n=0;n<i;n++)e+=Xb(t[n].color,1);return e/=i,e<qI}return!1}var Zmt=function(){function r(t,e,i){var n=this;this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,i=i||{},this.dom=e,this.id=t;var a=new nmt,s=i.renderer||"canvas";Z1[s]||(s=br(Z1)[0]),i.useDirtyRect=i.useDirtyRect==null?!1:i.useDirtyRect;var o=new Z1[s](e,a,i,t),l=i.ssr||o.ssrOnly;this.storage=a,this.painter=o;var u=!Or.node&&!Or.worker&&!l?new Fmt(o.getViewportRoot(),o.root):null,c=i.useCoarsePointer,h=c==null||c==="auto"?Or.touchEventsSupported:!!c,p=44,v;h&&(v=ir(i.pointerSize,p)),this.handler=new Qvt(a,o,u,o.root,v),this.animation=new Mmt({stage:{update:l?null:function(){return n._flush(!0)}}}),l||this.animation.start()}return r.prototype.add=function(t){this._disposed||!t||(this.storage.addRoot(t),t.addSelfToZr(this),this.refresh())},r.prototype.remove=function(t){this._disposed||!t||(this.storage.delRoot(t),t.removeSelfFromZr(this),this.refresh())},r.prototype.configLayer=function(t,e){this._disposed||(this.painter.configLayer&&this.painter.configLayer(t,e),this.refresh())},r.prototype.setBackgroundColor=function(t){this._disposed||(this.painter.setBackgroundColor&&this.painter.setBackgroundColor(t),this.refresh(),this._backgroundColor=t,this._darkMode=Xmt(t))},r.prototype.getBackgroundColor=function(){return this._backgroundColor},r.prototype.setDarkMode=function(t){this._darkMode=t},r.prototype.isDarkMode=function(){return this._darkMode},r.prototype.refreshImmediately=function(t){this._disposed||(t||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1)},r.prototype.refresh=function(){this._disposed||(this._needsRefresh=!0,this.animation.start())},r.prototype.flush=function(){this._disposed||this._flush(!1)},r.prototype._flush=function(t){var e,i=zp();this._needsRefresh&&(e=!0,this.refreshImmediately(t)),this._needsRefreshHover&&(e=!0,this.refreshHoverImmediately());var n=zp();e?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:n-i})):this._sleepAfterStill>0&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill&&this.animation.stop())},r.prototype.setSleepAfterStill=function(t){this._sleepAfterStill=t},r.prototype.wakeUp=function(){this._disposed||(this.animation.start(),this._stillFrameAccum=0)},r.prototype.refreshHover=function(){this._needsRefreshHover=!0},r.prototype.refreshHoverImmediately=function(){this._disposed||(this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.getType()==="canvas"&&this.painter.refreshHover())},r.prototype.resize=function(t){this._disposed||(t=t||{},this.painter.resize(t.width,t.height),this.handler.resize())},r.prototype.clearAnimation=function(){this._disposed||this.animation.clear()},r.prototype.getWidth=function(){if(!this._disposed)return this.painter.getWidth()},r.prototype.getHeight=function(){if(!this._disposed)return this.painter.getHeight()},r.prototype.setCursorStyle=function(t){this._disposed||this.handler.setCursorStyle(t)},r.prototype.findHover=function(t,e){if(!this._disposed)return this.handler.findHover(t,e)},r.prototype.on=function(t,e,i){return this._disposed||this.handler.on(t,e,i),this},r.prototype.off=function(t,e){this._disposed||this.handler.off(t,e)},r.prototype.trigger=function(t,e){this._disposed||this.handler.trigger(t,e)},r.prototype.clear=function(){if(!this._disposed){for(var t=this.storage.getRoots(),e=0;e<t.length;e++)t[e]instanceof Ke&&t[e].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()}},r.prototype.dispose=function(){this._disposed||(this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,this._disposed=!0,jmt(this.id))},r}();function nB(r,t){var e=new Zmt(qW(),r,t);return EH[e.id]=e,e}function qmt(r,t){Z1[r]=t}var JI;function Ymt(r){if(typeof JI=="function")return JI(r)}function Kmt(r){JI=r}var aB=1e-4,IH=20;function Jmt(r){return r.replace(/^\s+|\s+$/g,"")}function Jr(r,t,e,i){var n=t[0],a=t[1],s=e[0],o=e[1],l=a-n,u=o-s;if(l===0)return u===0?s:(s+o)/2;if(i)if(l>0){if(r<=n)return s;if(r>=a)return o}else{if(r>=n)return s;if(r<=a)return o}else{if(r===n)return s;if(r===a)return o}return(r-n)/l*u+s}function he(r,t){switch(r){case"center":case"middle":r="50%";break;case"left":case"top":r="0%";break;case"right":case"bottom":r="100%";break}return ve(r)?Jmt(r).match(/%$/)?parseFloat(r)/100*t:parseFloat(r):r==null?NaN:+r}function Yi(r,t,e){return t==null&&(t=10),t=Math.min(Math.max(0,t),IH),r=(+r).toFixed(t),e?r:+r}function ro(r){return r.sort(function(t,e){return t-e}),r}function gl(r){if(r=+r,isNaN(r))return 0;if(r>1e-14){for(var t=1,e=0;e<15;e++,t*=10)if(Math.round(r*t)/t===r)return e}return Qmt(r)}function Qmt(r){var t=r.toString().toLowerCase(),e=t.indexOf("e"),i=e>0?+t.slice(e+1):0,n=e>0?e:t.length,a=t.indexOf("."),s=a<0?0:n-1-a;return Math.max(0,s-i)}function MH(r,t){var e=Math.log,i=Math.LN10,n=Math.floor(e(r[1]-r[0])/i),a=Math.round(e(Math.abs(t[1]-t[0]))/i),s=Math.min(Math.max(-n+a,0),20);return isFinite(s)?s:20}function tyt(r,t){var e=bl(r,function(v,y){return v+(isNaN(y)?0:y)},0);if(e===0)return[];for(var i=Math.pow(10,t),n=te(r,function(v){return(isNaN(v)?0:v)/e*i*100}),a=i*100,s=te(n,function(v){return Math.floor(v)}),o=bl(s,function(v,y){return v+y},0),l=te(n,function(v,y){return v-s[y]});o<a;){for(var u=Number.NEGATIVE_INFINITY,c=null,h=0,p=l.length;h<p;++h)l[h]>u&&(u=l[h],c=h);++s[c],l[c]=0,++o}return te(s,function(v){return v/i})}function eyt(r,t){var e=Math.max(gl(r),gl(t)),i=r+t;return e>IH?i:Yi(i,e)}var sB=9007199254740991;function PH(r){var t=Math.PI*2;return(r%t+t)%t}function Wy(r){return r>-aB&&r<aB}var ryt=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d{1,2})(?::(\d{1,2})(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function Tl(r){if(r instanceof Date)return r;if(ve(r)){var t=ryt.exec(r);if(!t)return new Date(NaN);if(t[8]){var e=+t[4]||0;return t[8].toUpperCase()!=="Z"&&(e-=+t[8].slice(0,3)),new Date(Date.UTC(+t[1],+(t[2]||1)-1,+t[3]||1,e,+(t[5]||0),+t[6]||0,t[7]?+t[7].substring(0,3):0))}else return new Date(+t[1],+(t[2]||1)-1,+t[3]||1,+t[4]||0,+(t[5]||0),+t[6]||0,t[7]?+t[7].substring(0,3):0)}else if(r==null)return new Date(NaN);return new Date(Math.round(r))}function iyt(r){return Math.pow(10,zR(r))}function zR(r){if(r===0)return 0;var t=Math.floor(Math.log(r)/Math.LN10);return r/Math.pow(10,t)>=10&&t++,t}function RH(r,t){var e=zR(r),i=Math.pow(10,e),n=r/i,a;return t?n<1.5?a=1:n<2.5?a=2:n<4?a=3:n<7?a=5:a=10:n<1?a=1:n<2?a=2:n<3?a=3:n<5?a=5:a=10,r=a*i,e>=-20?+r.toFixed(e<0?-e:0):r}function y2(r,t){var e=(r.length-1)*t+1,i=Math.floor(e),n=+r[i-1],a=e-i;return a?n+a*(r[i]-n):n}function oB(r){r.sort(function(l,u){return o(l,u,0)?-1:1});for(var t=-1/0,e=1,i=0;i<r.length;){for(var n=r[i].interval,a=r[i].close,s=0;s<2;s++)n[s]<=t&&(n[s]=t,a[s]=s?1:1-e),t=n[s],e=a[s];n[0]===n[1]&&a[0]*a[1]!==1?r.splice(i,1):i++}return r;function o(l,u,c){return l.interval[c]<u.interval[c]||l.interval[c]===u.interval[c]&&(l.close[c]-u.close[c]===(c?-1:1)||!c&&o(l,u,1))}}function gu(r){var t=parseFloat(r);return t==r&&(t!==0||!ve(r)||r.indexOf("x")<=0)?t:NaN}function DH(r){return!isNaN(gu(r))}function LH(){return Math.round(Math.random()*9)}function kH(r,t){return t===0?r:kH(t,r%t)}function lB(r,t){return r==null?t:t==null?r:r*t/kH(r,t)}function jr(r){throw new Error(r)}function uB(r,t,e){return(t-r)*e+r}var OH="series\0",NH="\0_ec_\0";function ri(r){return r instanceof Array?r:r==null?[]:[r]}function $f(r,t,e){if(r){r[t]=r[t]||{},r.emphasis=r.emphasis||{},r.emphasis[t]=r.emphasis[t]||{};for(var i=0,n=e.length;i<n;i++){var a=e[i];!r.emphasis[t].hasOwnProperty(a)&&r[t].hasOwnProperty(a)&&(r.emphasis[t][a]=r[t][a])}}}var cB=["fontStyle","fontWeight","fontSize","fontFamily","rich","tag","color","textBorderColor","textBorderWidth","width","height","lineHeight","align","verticalAlign","baseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","backgroundColor","borderColor","borderWidth","borderRadius","padding"];function Pg(r){return je(r)&&!Kt(r)&&!(r instanceof Date)?r.value:r}function nyt(r){return je(r)&&!(r instanceof Array)}function FH(r,t,e){var i=e==="normalMerge",n=e==="replaceMerge",a=e==="replaceAll";r=r||[],t=(t||[]).slice();var s=Re();J(t,function(l,u){if(!je(l)){t[u]=null;return}});var o=ayt(r,s,e);return(i||n)&&syt(o,r,s,t),i&&oyt(o,t),i||n?lyt(o,t,n):a&&uyt(o,t),cyt(o),o}function ayt(r,t,e){var i=[];if(e==="replaceAll")return i;for(var n=0;n<r.length;n++){var a=r[n];a&&a.id!=null&&t.set(a.id,n),i.push({existing:e==="replaceMerge"||Hy(a)?null:a,newOption:null,keyInfo:null,brandNew:null})}return i}function syt(r,t,e,i){J(i,function(n,a){if(!(!n||n.id==null)){var s=sy(n.id),o=e.get(s);if(o!=null){var l=r[o];Za(!l.newOption,'Duplicated option on id "'+s+'".'),l.newOption=n,l.existing=t[o],i[a]=null}}})}function oyt(r,t){J(t,function(e,i){if(!(!e||e.name==null))for(var n=0;n<r.length;n++){var a=r[n].existing;if(!r[n].newOption&&a&&(a.id==null||e.id==null)&&!Hy(e)&&!Hy(a)&&BH("name",a,e)){r[n].newOption=e,t[i]=null;return}}})}function lyt(r,t,e){J(t,function(i){if(i){for(var n,a=0;(n=r[a])&&(n.newOption||Hy(n.existing)||n.existing&&i.id!=null&&!BH("id",i,n.existing));)a++;n?(n.newOption=i,n.brandNew=e):r.push({newOption:i,brandNew:e,existing:null,keyInfo:null}),a++}})}function uyt(r,t){J(t,function(e){r.push({newOption:e,brandNew:!0,existing:null,keyInfo:null})})}function cyt(r){var t=Re();J(r,function(e){var i=e.existing;i&&t.set(i.id,e)}),J(r,function(e){var i=e.newOption;Za(!i||i.id==null||!t.get(i.id)||t.get(i.id)===e,"id duplicates: "+(i&&i.id)),i&&i.id!=null&&t.set(i.id,e),!e.keyInfo&&(e.keyInfo={})}),J(r,function(e,i){var n=e.existing,a=e.newOption,s=e.keyInfo;if(je(a)){if(s.name=a.name!=null?sy(a.name):n?n.name:OH+i,n)s.id=sy(n.id);else if(a.id!=null)s.id=sy(a.id);else{var o=0;do s.id="\0"+s.name+"\0"+o++;while(t.get(s.id))}t.set(s.id,e)}})}function BH(r,t,e){var i=xn(t[r],null),n=xn(e[r],null);return i!=null&&n!=null&&i===n}function sy(r){return xn(r,"")}function xn(r,t){return r==null?t:ve(r)?r:Fr(r)||II(r)?r+"":t}function VR(r){var t=r.name;return!!(t&&t.indexOf(OH))}function Hy(r){return r&&r.id!=null&&sy(r.id).indexOf(NH)===0}function hyt(r){return NH+r}function fyt(r,t,e){J(r,function(i){var n=i.newOption;je(n)&&(i.keyInfo.mainType=t,i.keyInfo.subType=dyt(t,n,i.existing,e))})}function dyt(r,t,e,i){var n=t.type?t.type:e?e.subType:i.determineSubType(r,t);return n}function pyt(r,t){var e={},i={};return n(r||[],e),n(t||[],i,e),[a(e),a(i)];function n(s,o,l){for(var u=0,c=s.length;u<c;u++){var h=xn(s[u].seriesId,null);if(h==null)return;for(var p=ri(s[u].dataIndex),v=l&&l[h],y=0,x=p.length;y<x;y++){var w=p[y];v&&v[w]?v[w]=null:(o[h]||(o[h]={}))[w]=1}}}function a(s,o){var l=[];for(var u in s)if(s.hasOwnProperty(u)&&s[u]!=null)if(o)l.push(+u);else{var c=a(s[u],!0);c.length&&l.push({seriesId:u,dataIndex:c})}return l}}function Wf(r,t){if(t.dataIndexInside!=null)return t.dataIndexInside;if(t.dataIndex!=null)return Kt(t.dataIndex)?te(t.dataIndex,function(e){return r.indexOfRawIndex(e)}):r.indexOfRawIndex(t.dataIndex);if(t.name!=null)return Kt(t.name)?te(t.name,function(e){return r.indexOfName(e)}):r.indexOfName(t.name)}function Ir(){var r="__ec_inner_"+gyt++;return function(t){return t[r]||(t[r]={})}}var gyt=LH();function oy(r,t,e){var i=UR(t,e),n=i.mainTypeSpecified,a=i.queryOptionMap,s=i.others,o=s,l=e?e.defaultMainType:null;return!n&&l&&a.set(l,{}),a.each(function(u,c){var h=E_(r,c,u,{useDefault:l===c,enableAll:e&&e.enableAll!=null?e.enableAll:!0,enableNone:e&&e.enableNone!=null?e.enableNone:!0});o[c+"Models"]=h.models,o[c+"Model"]=h.models[0]}),o}function UR(r,t){var e;if(ve(r)){var i={};i[r+"Index"]=0,e=i}else e=r;var n=Re(),a={},s=!1;return J(e,function(o,l){if(l==="dataIndex"||l==="dataIndexInside"){a[l]=o;return}var u=l.match(/^(\w+)(Index|Id|Name)$/)||[],c=u[1],h=(u[2]||"").toLowerCase();if(!(!c||!h||t&&t.includeMainTypes&&pr(t.includeMainTypes,c)<0)){s=s||!!c;var p=n.get(c)||n.set(c,{});p[h]=o}}),{mainTypeSpecified:s,queryOptionMap:n,others:a}}var vn={useDefault:!0,enableAll:!1,enableNone:!1},vyt={useDefault:!1,enableAll:!0,enableNone:!0};function E_(r,t,e,i){i=i||vn;var n=e.index,a=e.id,s=e.name,o={models:null,specified:n!=null||a!=null||s!=null};if(!o.specified){var l=void 0;return o.models=i.useDefault&&(l=r.getComponent(t))?[l]:[],o}return n==="none"||n===!1?(Za(i.enableNone,'`"none"` or `false` is not a valid value on index option.'),o.models=[],o):(n==="all"&&(Za(i.enableAll,'`"all"` is not a valid value on index option.'),n=a=s=null),o.models=r.queryComponents({mainType:t,index:n,id:a,name:s}),o)}function zH(r,t,e){r.setAttribute?r.setAttribute(t,e):r[t]=e}function myt(r,t){return r.getAttribute?r.getAttribute(t):r[t]}function yyt(r){return r==="auto"?Or.domSupported?"html":"richText":r||"html"}function QI(r,t){var e=Re(),i=[];return J(r,function(n){var a=t(n);(e.get(a)||(i.push(a),e.set(a,[]))).push(n)}),{keys:i,buckets:e}}function VH(r,t,e,i,n){var a=t==null||t==="auto";if(i==null)return i;if(Fr(i)){var s=uB(e||0,i,n);return Yi(s,a?Math.max(gl(e||0),gl(i)):t)}else{if(ve(i))return n<1?e:i;for(var o=[],l=e,u=i,c=Math.max(l?l.length:0,u.length),h=0;h<c;++h){var p=r.getDimensionInfo(h);if(p&&p.type==="ordinal")o[h]=(n<1&&l?l:u)[h];else{var v=l&&l[h]?l[h]:0,y=u[h],s=uB(v,y,n);o[h]=Yi(s,a?Math.max(gl(v),gl(y)):t)}}return o}}var _yt=".",Ph="___EC__COMPONENT__CONTAINER___",UH="___EC__EXTENDED_CLASS___";function vl(r){var t={main:"",sub:""};if(r){var e=r.split(_yt);t.main=e[0]||"",t.sub=e[1]||""}return t}function xyt(r){Za(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(r),'componentType "'+r+'" illegal')}function byt(r){return!!(r&&r[UH])}function $R(r,t){r.$constructor=r,r.extend=function(e){var i=this,n;return wyt(i)?n=function(a){Vt(s,a);function s(){return a.apply(this,arguments)||this}return s}(i):(n=function(){(e.$constructor||i).apply(this,arguments)},_vt(n,this)),Zt(n.prototype,e),n[UH]=!0,n.extend=this.extend,n.superCall=Ayt,n.superApply=Cyt,n.superClass=i,n}}function wyt(r){return Ve(r)&&/^class\s/.test(Function.prototype.toString.call(r))}function $H(r,t){r.extend=t.extend}var Syt=Math.round(Math.random()*10);function Tyt(r){var t=["__\0is_clz",Syt++].join("_");r.prototype[t]=!0,r.isInstance=function(e){return!!(e&&e[t])}}function Ayt(r,t){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];return this.superClass.prototype[t].apply(r,e)}function Cyt(r,t,e){return this.superClass.prototype[t].apply(r,e)}function bS(r){var t={};r.registerClass=function(i){var n=i.type||i.prototype.type;if(n){xyt(n),i.prototype.type=n;var a=vl(n);if(!a.sub)t[a.main]=i;else if(a.sub!==Ph){var s=e(a);s[a.sub]=i}}return i},r.getClass=function(i,n,a){var s=t[i];if(s&&s[Ph]&&(s=n?s[n]:null),a&&!s)throw new Error(n?"Component "+i+"."+(n||"")+" is used but not imported.":i+".type should be specified.");return s},r.getClassesByMainType=function(i){var n=vl(i),a=[],s=t[n.main];return s&&s[Ph]?J(s,function(o,l){l!==Ph&&a.push(o)}):a.push(s),a},r.hasClass=function(i){var n=vl(i);return!!t[n.main]},r.getAllClassMainTypes=function(){var i=[];return J(t,function(n,a){i.push(a)}),i},r.hasSubTypes=function(i){var n=vl(i),a=t[n.main];return a&&a[Ph]};function e(i){var n=t[i.main];return(!n||!n[Ph])&&(n=t[i.main]={},n[Ph]=!0),n}}function Hf(r,t){for(var e=0;e<r.length;e++)r[e][1]||(r[e][1]=r[e][0]);return t=t||!1,function(i,n,a){for(var s={},o=0;o<r.length;o++){var l=r[o][1];if(!(n&&pr(n,l)>=0||a&&pr(a,l)<0)){var u=i.getShallow(l,t);u!=null&&(s[r[o][0]]=u)}}return s}}var Eyt=[["fill","color"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["opacity"],["shadowColor"]],Iyt=Hf(Eyt),Myt=function(){function r(){}return r.prototype.getAreaStyle=function(t,e){return Iyt(this,t,e)},r}(),tM=new A_(50);function Pyt(r){if(typeof r=="string"){var t=tM.get(r);return t&&t.image}else return r}function WR(r,t,e,i,n){if(r)if(typeof r=="string"){if(t&&t.__zrImageSrc===r||!e)return t;var a=tM.get(r),s={hostEl:e,cb:i,cbPayload:n};return a?(t=a.image,!wS(t)&&a.pending.push(s)):(t=Vc.loadImage(r,hB,hB),t.__zrImageSrc=r,tM.put(r,t.__cachedImgObj={image:t,pending:[s]})),t}else return r;else return t}function hB(){var r=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var t=0;t<r.pending.length;t++){var e=r.pending[t],i=e.cb;i&&i(this,e.cbPayload),e.hostEl.dirty()}r.pending.length=0}function wS(r){return r&&r.width&&r.height}var _2=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function Ryt(r,t,e,i,n){if(!t)return"";var a=(r+"").split(`
`);n=WH(t,e,i,n);for(var s=0,o=a.length;s<o;s++)a[s]=HH(a[s],n);return a.join(`
`)}function WH(r,t,e,i){i=i||{};var n=Zt({},i);n.font=t,e=ir(e,"..."),n.maxIterations=ir(i.maxIterations,2);var a=n.minChar=ir(i.minChar,0);n.cnCharWidth=Ms("",t);var s=n.ascCharWidth=Ms("a",t);n.placeholder=ir(i.placeholder,"");for(var o=r=Math.max(0,r-1),l=0;l<a&&o>=s;l++)o-=s;var u=Ms(e,t);return u>o&&(e="",u=0),o=r-u,n.ellipsis=e,n.ellipsisWidth=u,n.contentWidth=o,n.containerWidth=r,n}function HH(r,t){var e=t.containerWidth,i=t.font,n=t.contentWidth;if(!e)return"";var a=Ms(r,i);if(a<=e)return r;for(var s=0;;s++){if(a<=n||s>=t.maxIterations){r+=t.ellipsis;break}var o=s===0?Dyt(r,n,t.ascCharWidth,t.cnCharWidth):a>0?Math.floor(r.length*n/a):0;r=r.substr(0,o),a=Ms(r,i)}return r===""&&(r=t.placeholder),r}function Dyt(r,t,e,i){for(var n=0,a=0,s=r.length;a<s&&n<t;a++){var o=r.charCodeAt(a);n+=0<=o&&o<=127?e:i}return a}function Lyt(r,t){r!=null&&(r+="");var e=t.overflow,i=t.padding,n=t.font,a=e==="truncate",s=xS(n),o=ir(t.lineHeight,s),l=!!t.backgroundColor,u=t.lineOverflow==="truncate",c=t.width,h;c!=null&&(e==="break"||e==="breakAll")?h=r?GH(r,t.font,c,e==="breakAll",0).lines:[]:h=r?r.split(`
`):[];var p=h.length*o,v=ir(t.height,p);if(p>v&&u){var y=Math.floor(v/o);h=h.slice(0,y)}if(r&&a&&c!=null)for(var x=WH(c,n,t.ellipsis,{minChar:t.truncateMinChar,placeholder:t.placeholder}),w=0;w<h.length;w++)h[w]=HH(h[w],x);for(var T=v,E=0,w=0;w<h.length;w++)E=Math.max(Ms(h[w],n),E);c==null&&(c=E);var M=E;return i&&(T+=i[0]+i[2],M+=i[1]+i[3],c+=i[1]+i[3]),l&&(M=c),{lines:h,height:v,outerWidth:M,outerHeight:T,lineHeight:o,calculatedLineHeight:s,contentWidth:E,contentHeight:p,width:c}}var kyt=function(){function r(){}return r}(),fB=function(){function r(t){this.tokens=[],t&&(this.tokens=t)}return r}(),Oyt=function(){function r(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[]}return r}();function Nyt(r,t){var e=new Oyt;if(r!=null&&(r+=""),!r)return e;for(var i=t.width,n=t.height,a=t.overflow,s=(a==="break"||a==="breakAll")&&i!=null?{width:i,accumWidth:0,breakAll:a==="breakAll"}:null,o=_2.lastIndex=0,l;(l=_2.exec(r))!=null;){var u=l.index;u>o&&x2(e,r.substring(o,u),t,s),x2(e,l[2],t,s,l[1]),o=_2.lastIndex}o<r.length&&x2(e,r.substring(o,r.length),t,s);var c=[],h=0,p=0,v=t.padding,y=a==="truncate",x=t.lineOverflow==="truncate";function w(Rt,Ut,Jt){Rt.width=Ut,Rt.lineHeight=Jt,h+=Jt,p=Math.max(p,Ut)}t:for(var T=0;T<e.lines.length;T++){for(var E=e.lines[T],M=0,L=0,F=0;F<E.tokens.length;F++){var O=E.tokens[F],U=O.styleName&&t.rich[O.styleName]||{},W=O.textPadding=U.padding,H=W?W[1]+W[3]:0,j=O.font=U.font||t.font;O.contentHeight=xS(j);var Y=ir(U.height,O.contentHeight);if(O.innerHeight=Y,W&&(Y+=W[0]+W[2]),O.height=Y,O.lineHeight=_l(U.lineHeight,t.lineHeight,Y),O.align=U&&U.align||t.align,O.verticalAlign=U&&U.verticalAlign||"middle",x&&n!=null&&h+O.lineHeight>n){F>0?(E.tokens=E.tokens.slice(0,F),w(E,L,M),e.lines=e.lines.slice(0,T+1)):e.lines=e.lines.slice(0,T);break t}var tt=U.width,it=tt==null||tt==="auto";if(typeof tt=="string"&&tt.charAt(tt.length-1)==="%")O.percentWidth=tt,c.push(O),O.contentWidth=Ms(O.text,j);else{if(it){var lt=U.backgroundColor,ht=lt&&lt.image;ht&&(ht=Pyt(ht),wS(ht)&&(O.width=Math.max(O.width,ht.width*Y/ht.height)))}var Tt=y&&i!=null?i-L:null;Tt!=null&&Tt<O.width?!it||Tt<H?(O.text="",O.width=O.contentWidth=0):(O.text=Ryt(O.text,Tt-H,j,t.ellipsis,{minChar:t.truncateMinChar}),O.width=O.contentWidth=Ms(O.text,j)):O.contentWidth=Ms(O.text,j)}O.width+=H,L+=O.width,U&&(M=Math.max(M,O.lineHeight))}w(E,L,M)}e.outerWidth=e.width=ir(i,p),e.outerHeight=e.height=ir(n,h),e.contentHeight=h,e.contentWidth=p,v&&(e.outerWidth+=v[1]+v[3],e.outerHeight+=v[0]+v[2]);for(var T=0;T<c.length;T++){var O=c[T],Ot=O.percentWidth;O.width=parseInt(Ot,10)/100*e.width}return e}function x2(r,t,e,i,n){var a=t==="",s=n&&e.rich[n]||{},o=r.lines,l=s.font||e.font,u=!1,c,h;if(i){var p=s.padding,v=p?p[1]+p[3]:0;if(s.width!=null&&s.width!=="auto"){var y=zo(s.width,i.width)+v;o.length>0&&y+i.accumWidth>i.width&&(c=t.split(`
`),u=!0),i.accumWidth=y}else{var x=GH(t,l,i.width,i.breakAll,i.accumWidth);i.accumWidth=x.accumWidth+v,h=x.linesWidths,c=x.lines}}else c=t.split(`
`);for(var w=0;w<c.length;w++){var T=c[w],E=new kyt;if(E.styleName=n,E.text=T,E.isLineHolder=!T&&!a,typeof s.width=="number"?E.width=s.width:E.width=h?h[w]:Ms(T,l),!w&&!u){var M=(o[o.length-1]||(o[0]=new fB)).tokens,L=M.length;L===1&&M[0].isLineHolder?M[0]=E:(T||!L||a)&&M.push(E)}else o.push(new fB([E]))}}function Fyt(r){var t=r.charCodeAt(0);return t>=32&&t<=591||t>=880&&t<=4351||t>=4608&&t<=5119||t>=7680&&t<=8303}var Byt=bl(",&?/;] ".split(""),function(r,t){return r[t]=!0,r},{});function zyt(r){return Fyt(r)?!!Byt[r]:!0}function GH(r,t,e,i,n){for(var a=[],s=[],o="",l="",u=0,c=0,h=0;h<r.length;h++){var p=r.charAt(h);if(p===`
`){l&&(o+=l,c+=u),a.push(o),s.push(c),o="",l="",u=0,c=0;continue}var v=Ms(p,t),y=i?!1:!zyt(p);if(a.length?c+v>e:n+c+v>e){c?(o||l)&&(y?(o||(o=l,l="",u=0,c=u),a.push(o),s.push(c-u),l+=p,u+=v,o="",c=u):(l&&(o+=l,l="",u=0),a.push(o),s.push(c),o=p,c=v)):y?(a.push(l),s.push(u),l=p,u=v):(a.push(p),s.push(v));continue}c+=v,y?(l+=p,u+=v):(l&&(o+=l,l="",u=0),o+=p)}return!a.length&&!o&&(o=r,l="",u=0),l&&(o+=l),o&&(a.push(o),s.push(c)),a.length===1&&(c+=n),{accumWidth:c,lines:a,linesWidths:s}}var eM="__zr_style_"+Math.round(Math.random()*10),Cf={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},SS={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}};Cf[eM]=!0;var dB=["z","z2","invisible"],Vyt=["invisible"],Uyt=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype._init=function(e){for(var i=br(e),n=0;n<i.length;n++){var a=i[n];a==="style"?this.useStyle(e[a]):r.prototype.attrKV.call(this,a,e[a])}this.style||this.useStyle({})},t.prototype.beforeBrush=function(){},t.prototype.afterBrush=function(){},t.prototype.innerBeforeBrush=function(){},t.prototype.innerAfterBrush=function(){},t.prototype.shouldBePainted=function(e,i,n,a){var s=this.transform;if(this.ignore||this.invisible||this.style.opacity===0||this.culling&&$yt(this,e,i)||s&&!s[0]&&!s[3])return!1;if(n&&this.__clipPaths){for(var o=0;o<this.__clipPaths.length;++o)if(this.__clipPaths[o].isZeroArea())return!1}if(a&&this.parent)for(var l=this.parent;l;){if(l.ignore)return!1;l=l.parent}return!0},t.prototype.contain=function(e,i){return this.rectContain(e,i)},t.prototype.traverse=function(e,i){e.call(i,this)},t.prototype.rectContain=function(e,i){var n=this.transformCoordToLocal(e,i),a=this.getBoundingRect();return a.contain(n[0],n[1])},t.prototype.getPaintRect=function(){var e=this._paintRect;if(!this._paintRect||this.__dirty){var i=this.transform,n=this.getBoundingRect(),a=this.style,s=a.shadowBlur||0,o=a.shadowOffsetX||0,l=a.shadowOffsetY||0;e=this._paintRect||(this._paintRect=new hr(0,0,0,0)),i?hr.applyTransform(e,n,i):e.copy(n),(s||o||l)&&(e.width+=s*2+Math.abs(o),e.height+=s*2+Math.abs(l),e.x=Math.min(e.x,e.x+o-s),e.y=Math.min(e.y,e.y+l-s));var u=this.dirtyRectTolerance;e.isZero()||(e.x=Math.floor(e.x-u),e.y=Math.floor(e.y-u),e.width=Math.ceil(e.width+1+u*2),e.height=Math.ceil(e.height+1+u*2))}return e},t.prototype.setPrevPaintRect=function(e){e?(this._prevPaintRect=this._prevPaintRect||new hr(0,0,0,0),this._prevPaintRect.copy(e)):this._prevPaintRect=null},t.prototype.getPrevPaintRect=function(){return this._prevPaintRect},t.prototype.animateStyle=function(e){return this.animate("style",e)},t.prototype.updateDuringAnimation=function(e){e==="style"?this.dirtyStyle():this.markRedraw()},t.prototype.attrKV=function(e,i){e!=="style"?r.prototype.attrKV.call(this,e,i):this.style?this.setStyle(i):this.useStyle(i)},t.prototype.setStyle=function(e,i){return typeof e=="string"?this.style[e]=i:Zt(this.style,e),this.dirtyStyle(),this},t.prototype.dirtyStyle=function(e){e||this.markRedraw(),this.__dirty|=Fm,this._rect&&(this._rect=null)},t.prototype.dirty=function(){this.dirtyStyle()},t.prototype.styleChanged=function(){return!!(this.__dirty&Fm)},t.prototype.styleUpdated=function(){this.__dirty&=~Fm},t.prototype.createStyle=function(e){return mS(Cf,e)},t.prototype.useStyle=function(e){e[eM]||(e=this.createStyle(e)),this.__inHover?this.__hoverStyle=e:this.style=e,this.dirtyStyle()},t.prototype.isStyleObject=function(e){return e[eM]},t.prototype._innerSaveToNormal=function(e){r.prototype._innerSaveToNormal.call(this,e);var i=this._normalState;e.style&&!i.style&&(i.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(e,i,dB)},t.prototype._applyStateObj=function(e,i,n,a,s,o){r.prototype._applyStateObj.call(this,e,i,n,a,s,o);var l=!(i&&a),u;if(i&&i.style?s?a?u=i.style:(u=this._mergeStyle(this.createStyle(),n.style),this._mergeStyle(u,i.style)):(u=this._mergeStyle(this.createStyle(),a?this.style:n.style),this._mergeStyle(u,i.style)):l&&(u=n.style),u)if(s){var c=this.style;if(this.style=this.createStyle(l?{}:c),l)for(var h=br(c),p=0;p<h.length;p++){var v=h[p];v in u&&(u[v]=u[v],this.style[v]=c[v])}for(var y=br(u),p=0;p<y.length;p++){var v=y[p];this.style[v]=this.style[v]}this._transitionState(e,{style:u},o,this.getAnimationStyleProps())}else this.useStyle(u);for(var x=this.__inHover?Vyt:dB,p=0;p<x.length;p++){var v=x[p];i&&i[v]!=null?this[v]=i[v]:l&&n[v]!=null&&(this[v]=n[v])}},t.prototype._mergeStates=function(e){for(var i=r.prototype._mergeStates.call(this,e),n,a=0;a<e.length;a++){var s=e[a];s.style&&(n=n||{},this._mergeStyle(n,s.style))}return n&&(i.style=n),i},t.prototype._mergeStyle=function(e,i){return Zt(e,i),e},t.prototype.getAnimationStyleProps=function(){return SS},t.initDefaultProps=function(){var e=t.prototype;e.type="displayable",e.invisible=!1,e.z=0,e.z2=0,e.zlevel=0,e.culling=!1,e.cursor="pointer",e.rectHover=!1,e.incremental=!1,e._rect=null,e.dirtyRectTolerance=0,e.__dirty=Ts|Fm}(),t}(AH),b2=new hr(0,0,0,0),w2=new hr(0,0,0,0);function $yt(r,t,e){return b2.copy(r.getBoundingRect()),r.transform&&b2.applyTransform(r.transform),w2.width=t,w2.height=e,!b2.intersect(w2)}const ao=Uyt;var ls=Math.min,us=Math.max,S2=Math.sin,T2=Math.cos,Rh=Math.PI*2,Fx=Qf(),Bx=Qf(),zx=Qf();function TS(r,t,e){if(r.length!==0){for(var i=r[0],n=i[0],a=i[0],s=i[1],o=i[1],l=1;l<r.length;l++)i=r[l],n=ls(n,i[0]),a=us(a,i[0]),s=ls(s,i[1]),o=us(o,i[1]);t[0]=n,t[1]=s,e[0]=a,e[1]=o}}function pB(r,t,e,i,n,a){n[0]=ls(r,e),n[1]=ls(t,i),a[0]=us(r,e),a[1]=us(t,i)}var gB=[],vB=[];function Wyt(r,t,e,i,n,a,s,o,l,u){var c=lH,h=Pn,p=c(r,e,n,s,gB);l[0]=1/0,l[1]=1/0,u[0]=-1/0,u[1]=-1/0;for(var v=0;v<p;v++){var y=h(r,e,n,s,gB[v]);l[0]=ls(y,l[0]),u[0]=us(y,u[0])}p=c(t,i,a,o,vB);for(var v=0;v<p;v++){var x=h(t,i,a,o,vB[v]);l[1]=ls(x,l[1]),u[1]=us(x,u[1])}l[0]=ls(r,l[0]),u[0]=us(r,u[0]),l[0]=ls(s,l[0]),u[0]=us(s,u[0]),l[1]=ls(t,l[1]),u[1]=us(t,u[1]),l[1]=ls(o,l[1]),u[1]=us(o,u[1])}function Hyt(r,t,e,i,n,a,s,o){var l=cH,u=Vn,c=us(ls(l(r,e,n),1),0),h=us(ls(l(t,i,a),1),0),p=u(r,e,n,c),v=u(t,i,a,h);s[0]=ls(r,n,p),s[1]=ls(t,a,v),o[0]=us(r,n,p),o[1]=us(t,a,v)}function Gyt(r,t,e,i,n,a,s,o,l){var u=bc,c=wc,h=Math.abs(n-a);if(h%Rh<1e-4&&h>1e-4){o[0]=r-e,o[1]=t-i,l[0]=r+e,l[1]=t+i;return}if(Fx[0]=T2(n)*e+r,Fx[1]=S2(n)*i+t,Bx[0]=T2(a)*e+r,Bx[1]=S2(a)*i+t,u(o,Fx,Bx),c(l,Fx,Bx),n=n%Rh,n<0&&(n=n+Rh),a=a%Rh,a<0&&(a=a+Rh),n>a&&!s?a+=Rh:n<a&&s&&(n+=Rh),s){var p=a;a=n,n=p}for(var v=0;v<a;v+=Math.PI/2)v>n&&(zx[0]=T2(v)*e+r,zx[1]=S2(v)*i+t,u(o,zx,o),c(l,zx,l))}var li={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},Dh=[],Lh=[],rl=[],Yu=[],il=[],nl=[],A2=Math.min,C2=Math.max,kh=Math.cos,Oh=Math.sin,Zl=Math.abs,rM=Math.PI,ac=rM*2,E2=typeof Float32Array<"u",om=[];function I2(r){var t=Math.round(r/rM*1e8)/1e8;return t%2*rM}function HR(r,t){var e=I2(r[0]);e<0&&(e+=ac);var i=e-r[0],n=r[1];n+=i,!t&&n-e>=ac?n=e+ac:t&&e-n>=ac?n=e-ac:!t&&e>n?n=e+(ac-I2(e-n)):t&&e<n&&(n=e-(ac-I2(n-e))),r[0]=e,r[1]=n}var jyt=function(){function r(t){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,t&&(this._saveData=!1),this._saveData&&(this.data=[])}return r.prototype.increaseVersion=function(){this._version++},r.prototype.getVersion=function(){return this._version},r.prototype.setScale=function(t,e,i){i=i||0,i>0&&(this._ux=Zl(i/qb/t)||0,this._uy=Zl(i/qb/e)||0)},r.prototype.setDPR=function(t){this.dpr=t},r.prototype.setContext=function(t){this._ctx=t},r.prototype.getContext=function(){return this._ctx},r.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},r.prototype.reset=function(){this._saveData&&(this._len=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},r.prototype.moveTo=function(t,e){return this._drawPendingPt(),this.addData(li.M,t,e),this._ctx&&this._ctx.moveTo(t,e),this._x0=t,this._y0=e,this._xi=t,this._yi=e,this},r.prototype.lineTo=function(t,e){var i=Zl(t-this._xi),n=Zl(e-this._yi),a=i>this._ux||n>this._uy;if(this.addData(li.L,t,e),this._ctx&&a&&this._ctx.lineTo(t,e),a)this._xi=t,this._yi=e,this._pendingPtDist=0;else{var s=i*i+n*n;s>this._pendingPtDist&&(this._pendingPtX=t,this._pendingPtY=e,this._pendingPtDist=s)}return this},r.prototype.bezierCurveTo=function(t,e,i,n,a,s){return this._drawPendingPt(),this.addData(li.C,t,e,i,n,a,s),this._ctx&&this._ctx.bezierCurveTo(t,e,i,n,a,s),this._xi=a,this._yi=s,this},r.prototype.quadraticCurveTo=function(t,e,i,n){return this._drawPendingPt(),this.addData(li.Q,t,e,i,n),this._ctx&&this._ctx.quadraticCurveTo(t,e,i,n),this._xi=i,this._yi=n,this},r.prototype.arc=function(t,e,i,n,a,s){this._drawPendingPt(),om[0]=n,om[1]=a,HR(om,s),n=om[0],a=om[1];var o=a-n;return this.addData(li.A,t,e,i,i,n,o,0,s?0:1),this._ctx&&this._ctx.arc(t,e,i,n,a,s),this._xi=kh(a)*i+t,this._yi=Oh(a)*i+e,this},r.prototype.arcTo=function(t,e,i,n,a){return this._drawPendingPt(),this._ctx&&this._ctx.arcTo(t,e,i,n,a),this},r.prototype.rect=function(t,e,i,n){return this._drawPendingPt(),this._ctx&&this._ctx.rect(t,e,i,n),this.addData(li.R,t,e,i,n),this},r.prototype.closePath=function(){this._drawPendingPt(),this.addData(li.Z);var t=this._ctx,e=this._x0,i=this._y0;return t&&t.closePath(),this._xi=e,this._yi=i,this},r.prototype.fill=function(t){t&&t.fill(),this.toStatic()},r.prototype.stroke=function(t){t&&t.stroke(),this.toStatic()},r.prototype.len=function(){return this._len},r.prototype.setData=function(t){var e=t.length;!(this.data&&this.data.length===e)&&E2&&(this.data=new Float32Array(e));for(var i=0;i<e;i++)this.data[i]=t[i];this._len=e},r.prototype.appendPath=function(t){t instanceof Array||(t=[t]);for(var e=t.length,i=0,n=this._len,a=0;a<e;a++)i+=t[a].len();E2&&this.data instanceof Float32Array&&(this.data=new Float32Array(n+i));for(var a=0;a<e;a++)for(var s=t[a].data,o=0;o<s.length;o++)this.data[n++]=s[o];this._len=n},r.prototype.addData=function(t,e,i,n,a,s,o,l,u){if(this._saveData){var c=this.data;this._len+arguments.length>c.length&&(this._expandData(),c=this.data);for(var h=0;h<arguments.length;h++)c[this._len++]=arguments[h]}},r.prototype._drawPendingPt=function(){this._pendingPtDist>0&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)},r.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var t=[],e=0;e<this._len;e++)t[e]=this.data[e];this.data=t}},r.prototype.toStatic=function(){if(this._saveData){this._drawPendingPt();var t=this.data;t instanceof Array&&(t.length=this._len,E2&&this._len>11&&(this.data=new Float32Array(t)))}},r.prototype.getBoundingRect=function(){rl[0]=rl[1]=il[0]=il[1]=Number.MAX_VALUE,Yu[0]=Yu[1]=nl[0]=nl[1]=-Number.MAX_VALUE;var t=this.data,e=0,i=0,n=0,a=0,s;for(s=0;s<this._len;){var o=t[s++],l=s===1;switch(l&&(e=t[s],i=t[s+1],n=e,a=i),o){case li.M:e=n=t[s++],i=a=t[s++],il[0]=n,il[1]=a,nl[0]=n,nl[1]=a;break;case li.L:pB(e,i,t[s],t[s+1],il,nl),e=t[s++],i=t[s++];break;case li.C:Wyt(e,i,t[s++],t[s++],t[s++],t[s++],t[s],t[s+1],il,nl),e=t[s++],i=t[s++];break;case li.Q:Hyt(e,i,t[s++],t[s++],t[s],t[s+1],il,nl),e=t[s++],i=t[s++];break;case li.A:var u=t[s++],c=t[s++],h=t[s++],p=t[s++],v=t[s++],y=t[s++]+v;s+=1;var x=!t[s++];l&&(n=kh(v)*h+u,a=Oh(v)*p+c),Gyt(u,c,h,p,v,y,x,il,nl),e=kh(y)*h+u,i=Oh(y)*p+c;break;case li.R:n=e=t[s++],a=i=t[s++];var w=t[s++],T=t[s++];pB(n,a,n+w,a+T,il,nl);break;case li.Z:e=n,i=a;break}bc(rl,rl,il),wc(Yu,Yu,nl)}return s===0&&(rl[0]=rl[1]=Yu[0]=Yu[1]=0),new hr(rl[0],rl[1],Yu[0]-rl[0],Yu[1]-rl[1])},r.prototype._calculateLength=function(){var t=this.data,e=this._len,i=this._ux,n=this._uy,a=0,s=0,o=0,l=0;this._pathSegLen||(this._pathSegLen=[]);for(var u=this._pathSegLen,c=0,h=0,p=0;p<e;){var v=t[p++],y=p===1;y&&(a=t[p],s=t[p+1],o=a,l=s);var x=-1;switch(v){case li.M:a=o=t[p++],s=l=t[p++];break;case li.L:{var w=t[p++],T=t[p++],E=w-a,M=T-s;(Zl(E)>i||Zl(M)>n||p===e-1)&&(x=Math.sqrt(E*E+M*M),a=w,s=T);break}case li.C:{var L=t[p++],F=t[p++],w=t[p++],T=t[p++],O=t[p++],U=t[p++];x=amt(a,s,L,F,w,T,O,U,10),a=O,s=U;break}case li.Q:{var L=t[p++],F=t[p++],w=t[p++],T=t[p++];x=omt(a,s,L,F,w,T,10),a=w,s=T;break}case li.A:var W=t[p++],H=t[p++],j=t[p++],Y=t[p++],tt=t[p++],it=t[p++],lt=it+tt;p+=1,y&&(o=kh(tt)*j+W,l=Oh(tt)*Y+H),x=C2(j,Y)*A2(ac,Math.abs(it)),a=kh(lt)*j+W,s=Oh(lt)*Y+H;break;case li.R:{o=a=t[p++],l=s=t[p++];var ht=t[p++],Tt=t[p++];x=ht*2+Tt*2;break}case li.Z:{var E=o-a,M=l-s;x=Math.sqrt(E*E+M*M),a=o,s=l;break}}x>=0&&(u[h++]=x,c+=x)}return this._pathLen=c,c},r.prototype.rebuildPath=function(t,e){var i=this.data,n=this._ux,a=this._uy,s=this._len,o,l,u,c,h,p,v=e<1,y,x,w=0,T=0,E,M=0,L,F;if(!(v&&(this._pathSegLen||this._calculateLength(),y=this._pathSegLen,x=this._pathLen,E=e*x,!E)))t:for(var O=0;O<s;){var U=i[O++],W=O===1;switch(W&&(u=i[O],c=i[O+1],o=u,l=c),U!==li.L&&M>0&&(t.lineTo(L,F),M=0),U){case li.M:o=u=i[O++],l=c=i[O++],t.moveTo(u,c);break;case li.L:{h=i[O++],p=i[O++];var H=Zl(h-u),j=Zl(p-c);if(H>n||j>a){if(v){var Y=y[T++];if(w+Y>E){var tt=(E-w)/Y;t.lineTo(u*(1-tt)+h*tt,c*(1-tt)+p*tt);break t}w+=Y}t.lineTo(h,p),u=h,c=p,M=0}else{var it=H*H+j*j;it>M&&(L=h,F=p,M=it)}break}case li.C:{var lt=i[O++],ht=i[O++],Tt=i[O++],Ot=i[O++],Rt=i[O++],Ut=i[O++];if(v){var Y=y[T++];if(w+Y>E){var tt=(E-w)/Y;Uc(u,lt,Tt,Rt,tt,Dh),Uc(c,ht,Ot,Ut,tt,Lh),t.bezierCurveTo(Dh[1],Lh[1],Dh[2],Lh[2],Dh[3],Lh[3]);break t}w+=Y}t.bezierCurveTo(lt,ht,Tt,Ot,Rt,Ut),u=Rt,c=Ut;break}case li.Q:{var lt=i[O++],ht=i[O++],Tt=i[O++],Ot=i[O++];if(v){var Y=y[T++];if(w+Y>E){var tt=(E-w)/Y;Vy(u,lt,Tt,tt,Dh),Vy(c,ht,Ot,tt,Lh),t.quadraticCurveTo(Dh[1],Lh[1],Dh[2],Lh[2]);break t}w+=Y}t.quadraticCurveTo(lt,ht,Tt,Ot),u=Tt,c=Ot;break}case li.A:var Jt=i[O++],ne=i[O++],se=i[O++],ce=i[O++],ye=i[O++],Qe=i[O++],sr=i[O++],ke=!i[O++],Ce=se>ce?se:ce,Ee=Zl(se-ce)>.001,Ie=ye+Qe,Se=!1;if(v){var Y=y[T++];w+Y>E&&(Ie=ye+Qe*(E-w)/Y,Se=!0),w+=Y}if(Ee&&t.ellipse?t.ellipse(Jt,ne,se,ce,sr,ye,Ie,ke):t.arc(Jt,ne,Ce,ye,Ie,ke),Se)break t;W&&(o=kh(ye)*se+Jt,l=Oh(ye)*ce+ne),u=kh(Ie)*se+Jt,c=Oh(Ie)*ce+ne;break;case li.R:o=u=i[O],l=c=i[O+1],h=i[O++],p=i[O++];var Fe=i[O++],Rr=i[O++];if(v){var Y=y[T++];if(w+Y>E){var tr=E-w;t.moveTo(h,p),t.lineTo(h+A2(tr,Fe),p),tr-=Fe,tr>0&&t.lineTo(h+Fe,p+A2(tr,Rr)),tr-=Rr,tr>0&&t.lineTo(h+C2(Fe-tr,0),p+Rr),tr-=Fe,tr>0&&t.lineTo(h,p+C2(Rr-tr,0));break t}w+=Y}t.rect(h,p,Fe,Rr);break;case li.Z:if(v){var Y=y[T++];if(w+Y>E){var tt=(E-w)/Y;t.lineTo(u*(1-tt)+o*tt,c*(1-tt)+l*tt);break t}w+=Y}t.closePath(),u=o,c=l}}},r.prototype.clone=function(){var t=new r,e=this.data;return t.data=e.slice?e.slice():Array.prototype.slice.call(e),t._len=this._len,t},r.CMD=li,r.initDefaultProps=function(){var t=r.prototype;t._saveData=!0,t._ux=0,t._uy=0,t._pendingPtDist=0,t._version=0}(),r}();const Al=jyt;function uc(r,t,e,i,n,a,s){if(n===0)return!1;var o=n,l=0,u=r;if(s>t+o&&s>i+o||s<t-o&&s<i-o||a>r+o&&a>e+o||a<r-o&&a<e-o)return!1;if(r!==e)l=(t-i)/(r-e),u=(r*i-e*t)/(r-e);else return Math.abs(a-r)<=o/2;var c=l*a-s+u,h=c*c/(l*l+1);return h<=o/2*o/2}function Xyt(r,t,e,i,n,a,s,o,l,u,c){if(l===0)return!1;var h=l;if(c>t+h&&c>i+h&&c>a+h&&c>o+h||c<t-h&&c<i-h&&c<a-h&&c<o-h||u>r+h&&u>e+h&&u>n+h&&u>s+h||u<r-h&&u<e-h&&u<n-h&&u<s-h)return!1;var p=uH(r,t,e,i,n,a,s,o,u,c,null);return p<=h/2}function jH(r,t,e,i,n,a,s,o,l){if(s===0)return!1;var u=s;if(l>t+u&&l>i+u&&l>a+u||l<t-u&&l<i-u&&l<a-u||o>r+u&&o>e+u&&o>n+u||o<r-u&&o<e-u&&o<n-u)return!1;var c=hH(r,t,e,i,n,a,o,l,null);return c<=u/2}var mB=Math.PI*2;function Cs(r){return r%=mB,r<0&&(r+=mB),r}var lm=Math.PI*2;function Zyt(r,t,e,i,n,a,s,o,l){if(s===0)return!1;var u=s;o-=r,l-=t;var c=Math.sqrt(o*o+l*l);if(c-u>e||c+u<e)return!1;if(Math.abs(i-n)%lm<1e-4)return!0;if(a){var h=i;i=Cs(n),n=Cs(h)}else i=Cs(i),n=Cs(n);i>n&&(n+=lm);var p=Math.atan2(l,o);return p<0&&(p+=lm),p>=i&&p<=n||p+lm>=i&&p+lm<=n}function Jl(r,t,e,i,n,a){if(a>t&&a>i||a<t&&a<i||i===t)return 0;var s=(a-t)/(i-t),o=i<t?1:-1;(s===1||s===0)&&(o=i<t?.5:-.5);var l=s*(e-r)+r;return l===n?1/0:l>n?o:0}var Ku=Al.CMD,Nh=Math.PI*2,qyt=1e-4;function Yyt(r,t){return Math.abs(r-t)<qyt}var Wa=[-1,-1,-1],Xs=[-1,-1];function Kyt(){var r=Xs[0];Xs[0]=Xs[1],Xs[1]=r}function Jyt(r,t,e,i,n,a,s,o,l,u){if(u>t&&u>i&&u>a&&u>o||u<t&&u<i&&u<a&&u<o)return 0;var c=Gb(t,i,a,o,u,Wa);if(c===0)return 0;for(var h=0,p=-1,v=void 0,y=void 0,x=0;x<c;x++){var w=Wa[x],T=w===0||w===1?.5:1,E=Pn(r,e,n,s,w);E<l||(p<0&&(p=lH(t,i,a,o,Xs),Xs[1]<Xs[0]&&p>1&&Kyt(),v=Pn(t,i,a,o,Xs[0]),p>1&&(y=Pn(t,i,a,o,Xs[1]))),p===2?w<Xs[0]?h+=v<t?T:-T:w<Xs[1]?h+=y<v?T:-T:h+=o<y?T:-T:w<Xs[0]?h+=v<t?T:-T:h+=o<v?T:-T)}return h}function Qyt(r,t,e,i,n,a,s,o){if(o>t&&o>i&&o>a||o<t&&o<i&&o<a)return 0;var l=smt(t,i,a,o,Wa);if(l===0)return 0;var u=cH(t,i,a);if(u>=0&&u<=1){for(var c=0,h=Vn(t,i,a,u),p=0;p<l;p++){var v=Wa[p]===0||Wa[p]===1?.5:1,y=Vn(r,e,n,Wa[p]);y<s||(Wa[p]<u?c+=h<t?v:-v:c+=a<h?v:-v)}return c}else{var v=Wa[0]===0||Wa[0]===1?.5:1,y=Vn(r,e,n,Wa[0]);return y<s?0:a<t?v:-v}}function t_t(r,t,e,i,n,a,s,o){if(o-=t,o>e||o<-e)return 0;var l=Math.sqrt(e*e-o*o);Wa[0]=-l,Wa[1]=l;var u=Math.abs(i-n);if(u<1e-4)return 0;if(u>=Nh-1e-4){i=0,n=Nh;var c=a?1:-1;return s>=Wa[0]+r&&s<=Wa[1]+r?c:0}if(i>n){var h=i;i=n,n=h}i<0&&(i+=Nh,n+=Nh);for(var p=0,v=0;v<2;v++){var y=Wa[v];if(y+r>s){var x=Math.atan2(o,y),c=a?1:-1;x<0&&(x=Nh+x),(x>=i&&x<=n||x+Nh>=i&&x+Nh<=n)&&(x>Math.PI/2&&x<Math.PI*1.5&&(c=-c),p+=c)}}return p}function XH(r,t,e,i,n){for(var a=r.data,s=r.len(),o=0,l=0,u=0,c=0,h=0,p,v,y=0;y<s;){var x=a[y++],w=y===1;switch(x===Ku.M&&y>1&&(e||(o+=Jl(l,u,c,h,i,n))),w&&(l=a[y],u=a[y+1],c=l,h=u),x){case Ku.M:c=a[y++],h=a[y++],l=c,u=h;break;case Ku.L:if(e){if(uc(l,u,a[y],a[y+1],t,i,n))return!0}else o+=Jl(l,u,a[y],a[y+1],i,n)||0;l=a[y++],u=a[y++];break;case Ku.C:if(e){if(Xyt(l,u,a[y++],a[y++],a[y++],a[y++],a[y],a[y+1],t,i,n))return!0}else o+=Jyt(l,u,a[y++],a[y++],a[y++],a[y++],a[y],a[y+1],i,n)||0;l=a[y++],u=a[y++];break;case Ku.Q:if(e){if(jH(l,u,a[y++],a[y++],a[y],a[y+1],t,i,n))return!0}else o+=Qyt(l,u,a[y++],a[y++],a[y],a[y+1],i,n)||0;l=a[y++],u=a[y++];break;case Ku.A:var T=a[y++],E=a[y++],M=a[y++],L=a[y++],F=a[y++],O=a[y++];y+=1;var U=!!(1-a[y++]);p=Math.cos(F)*M+T,v=Math.sin(F)*L+E,w?(c=p,h=v):o+=Jl(l,u,p,v,i,n);var W=(i-T)*L/M+T;if(e){if(Zyt(T,E,L,F,F+O,U,t,W,n))return!0}else o+=t_t(T,E,L,F,F+O,U,W,n);l=Math.cos(F+O)*M+T,u=Math.sin(F+O)*L+E;break;case Ku.R:c=l=a[y++],h=u=a[y++];var H=a[y++],j=a[y++];if(p=c+H,v=h+j,e){if(uc(c,h,p,h,t,i,n)||uc(p,h,p,v,t,i,n)||uc(p,v,c,v,t,i,n)||uc(c,v,c,h,t,i,n))return!0}else o+=Jl(p,h,p,v,i,n),o+=Jl(c,v,c,h,i,n);break;case Ku.Z:if(e){if(uc(l,u,c,h,t,i,n))return!0}else o+=Jl(l,u,c,h,i,n);l=c,u=h;break}}return!e&&!Yyt(u,h)&&(o+=Jl(l,u,c,h,i,n)||0),o!==0}function e_t(r,t,e){return XH(r,0,!1,t,e)}function r_t(r,t,e,i){return XH(r,t,!0,e,i)}var Kb=We({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},Cf),i_t={style:We({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},SS.style)},M2=Sl.concat(["invisible","culling","z","z2","zlevel","parent"]),n_t=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype.update=function(){var e=this;r.prototype.update.call(this);var i=this.style;if(i.decal){var n=this._decalEl=this._decalEl||new t;n.buildPath===t.prototype.buildPath&&(n.buildPath=function(l){e.buildPath(l,e.shape)}),n.silent=!0;var a=n.style;for(var s in i)a[s]!==i[s]&&(a[s]=i[s]);a.fill=i.fill?i.decal:null,a.decal=null,a.shadowColor=null,i.strokeFirst&&(a.stroke=null);for(var o=0;o<M2.length;++o)n[M2[o]]=this[M2[o]];n.__dirty|=Ts}else this._decalEl&&(this._decalEl=null)},t.prototype.getDecalElement=function(){return this._decalEl},t.prototype._init=function(e){var i=br(e);this.shape=this.getDefaultShape();var n=this.getDefaultStyle();n&&this.useStyle(n);for(var a=0;a<i.length;a++){var s=i[a],o=e[s];s==="style"?this.style?Zt(this.style,o):this.useStyle(o):s==="shape"?Zt(this.shape,o):r.prototype.attrKV.call(this,s,o)}this.style||this.useStyle({})},t.prototype.getDefaultStyle=function(){return null},t.prototype.getDefaultShape=function(){return{}},t.prototype.canBeInsideText=function(){return this.hasFill()},t.prototype.getInsideTextFill=function(){var e=this.style.fill;if(e!=="none"){if(ve(e)){var i=Xb(e,0);return i>.5?YI:i>.2?Bmt:KI}else if(e)return KI}return YI},t.prototype.getInsideTextStroke=function(e){var i=this.style.fill;if(ve(i)){var n=this.__zr,a=!!(n&&n.isDarkMode()),s=Xb(e,0)<qI;if(a===s)return i}},t.prototype.buildPath=function(e,i,n){},t.prototype.pathUpdated=function(){this.__dirty&=~wp},t.prototype.getUpdatedPathProxy=function(e){return!this.path&&this.createPathProxy(),this.path.beginPath(),this.buildPath(this.path,this.shape,e),this.path},t.prototype.createPathProxy=function(){this.path=new Al(!1)},t.prototype.hasStroke=function(){var e=this.style,i=e.stroke;return!(i==null||i==="none"||!(e.lineWidth>0))},t.prototype.hasFill=function(){var e=this.style,i=e.fill;return i!=null&&i!=="none"},t.prototype.getBoundingRect=function(){var e=this._rect,i=this.style,n=!e;if(n){var a=!1;this.path||(a=!0,this.createPathProxy());var s=this.path;(a||this.__dirty&wp)&&(s.beginPath(),this.buildPath(s,this.shape,!1),this.pathUpdated()),e=s.getBoundingRect()}if(this._rect=e,this.hasStroke()&&this.path&&this.path.len()>0){var o=this._rectStroke||(this._rectStroke=e.clone());if(this.__dirty||n){o.copy(e);var l=i.strokeNoScale?this.getLineScale():1,u=i.lineWidth;if(!this.hasFill()){var c=this.strokeContainThreshold;u=Math.max(u,c??4)}l>1e-10&&(o.width+=u/l,o.height+=u/l,o.x-=u/l/2,o.y-=u/l/2)}return o}return e},t.prototype.contain=function(e,i){var n=this.transformCoordToLocal(e,i),a=this.getBoundingRect(),s=this.style;if(e=n[0],i=n[1],a.contain(e,i)){var o=this.path;if(this.hasStroke()){var l=s.lineWidth,u=s.strokeNoScale?this.getLineScale():1;if(u>1e-10&&(this.hasFill()||(l=Math.max(l,this.strokeContainThreshold)),r_t(o,l/u,e,i)))return!0}if(this.hasFill())return e_t(o,e,i)}return!1},t.prototype.dirtyShape=function(){this.__dirty|=wp,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()},t.prototype.dirty=function(){this.dirtyStyle(),this.dirtyShape()},t.prototype.animateShape=function(e){return this.animate("shape",e)},t.prototype.updateDuringAnimation=function(e){e==="style"?this.dirtyStyle():e==="shape"?this.dirtyShape():this.markRedraw()},t.prototype.attrKV=function(e,i){e==="shape"?this.setShape(i):r.prototype.attrKV.call(this,e,i)},t.prototype.setShape=function(e,i){var n=this.shape;return n||(n=this.shape={}),typeof e=="string"?n[e]=i:Zt(n,e),this.dirtyShape(),this},t.prototype.shapeChanged=function(){return!!(this.__dirty&wp)},t.prototype.createStyle=function(e){return mS(Kb,e)},t.prototype._innerSaveToNormal=function(e){r.prototype._innerSaveToNormal.call(this,e);var i=this._normalState;e.shape&&!i.shape&&(i.shape=Zt({},this.shape))},t.prototype._applyStateObj=function(e,i,n,a,s,o){r.prototype._applyStateObj.call(this,e,i,n,a,s,o);var l=!(i&&a),u;if(i&&i.shape?s?a?u=i.shape:(u=Zt({},n.shape),Zt(u,i.shape)):(u=Zt({},a?this.shape:n.shape),Zt(u,i.shape)):l&&(u=n.shape),u)if(s){this.shape=Zt({},this.shape);for(var c={},h=br(u),p=0;p<h.length;p++){var v=h[p];typeof u[v]=="object"?this.shape[v]=u[v]:c[v]=u[v]}this._transitionState(e,{shape:c},o)}else this.shape=u,this.dirtyShape()},t.prototype._mergeStates=function(e){for(var i=r.prototype._mergeStates.call(this,e),n,a=0;a<e.length;a++){var s=e[a];s.shape&&(n=n||{},this._mergeStyle(n,s.shape))}return n&&(i.shape=n),i},t.prototype.getAnimationStyleProps=function(){return i_t},t.prototype.isZeroArea=function(){return!1},t.extend=function(e){var i=function(a){bi(s,a);function s(o){var l=a.call(this,o)||this;return e.init&&e.init.call(l,o),l}return s.prototype.getDefaultStyle=function(){return Ze(e.style)},s.prototype.getDefaultShape=function(){return Ze(e.shape)},s}(t);for(var n in e)typeof e[n]=="function"&&(i.prototype[n]=e[n]);return i},t.initDefaultProps=function(){var e=t.prototype;e.type="path",e.strokeContainThreshold=5,e.segmentIgnoreThreshold=0,e.subPixelOptimize=!1,e.autoBatch=!1,e.__dirty=Ts|Fm|wp}(),t}(ao);const vr=n_t;var a_t=We({strokeFirst:!0,font:zc,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},Kb),ZH=function(r){bi(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.hasStroke=function(){var e=this.style,i=e.stroke;return i!=null&&i!=="none"&&e.lineWidth>0},t.prototype.hasFill=function(){var e=this.style,i=e.fill;return i!=null&&i!=="none"},t.prototype.createStyle=function(e){return mS(a_t,e)},t.prototype.setBoundingRect=function(e){this._rect=e},t.prototype.getBoundingRect=function(){var e=this.style;if(!this._rect){var i=e.text;i!=null?i+="":i="";var n=C_(i,e.font,e.textAlign,e.textBaseline);if(n.x+=e.x||0,n.y+=e.y||0,this.hasStroke()){var a=e.lineWidth;n.x-=a/2,n.y-=a/2,n.width+=a,n.height+=a}this._rect=n}return this._rect},t.initDefaultProps=function(){var e=t.prototype;e.dirtyRectTolerance=10}(),t}(ao);ZH.prototype.type="tspan";const Gy=ZH;var s_t=We({x:0,y:0},Cf),o_t={style:We({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},SS.style)};function l_t(r){return!!(r&&typeof r!="string"&&r.width&&r.height)}var qH=function(r){bi(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.createStyle=function(e){return mS(s_t,e)},t.prototype._getSize=function(e){var i=this.style,n=i[e];if(n!=null)return n;var a=l_t(i.image)?i.image:this.__image;if(!a)return 0;var s=e==="width"?"height":"width",o=i[s];return o==null?a[e]:a[e]/a[s]*o},t.prototype.getWidth=function(){return this._getSize("width")},t.prototype.getHeight=function(){return this._getSize("height")},t.prototype.getAnimationStyleProps=function(){return o_t},t.prototype.getBoundingRect=function(){var e=this.style;return this._rect||(this._rect=new hr(e.x||0,e.y||0,this.getWidth(),this.getHeight())),this._rect},t}(ao);qH.prototype.type="image";const ia=qH;function u_t(r,t){var e=t.x,i=t.y,n=t.width,a=t.height,s=t.r,o,l,u,c;n<0&&(e=e+n,n=-n),a<0&&(i=i+a,a=-a),typeof s=="number"?o=l=u=c=s:s instanceof Array?s.length===1?o=l=u=c=s[0]:s.length===2?(o=u=s[0],l=c=s[1]):s.length===3?(o=s[0],l=c=s[1],u=s[2]):(o=s[0],l=s[1],u=s[2],c=s[3]):o=l=u=c=0;var h;o+l>n&&(h=o+l,o*=n/h,l*=n/h),u+c>n&&(h=u+c,u*=n/h,c*=n/h),l+u>a&&(h=l+u,l*=a/h,u*=a/h),o+c>a&&(h=o+c,o*=a/h,c*=a/h),r.moveTo(e+o,i),r.lineTo(e+n-l,i),l!==0&&r.arc(e+n-l,i+l,l,-Math.PI/2,0),r.lineTo(e+n,i+a-u),u!==0&&r.arc(e+n-u,i+a-u,u,0,Math.PI/2),r.lineTo(e+c,i+a),c!==0&&r.arc(e+c,i+a-c,c,Math.PI/2,Math.PI),r.lineTo(e,i+o),o!==0&&r.arc(e+o,i+o,o,Math.PI,Math.PI*1.5)}var Vp=Math.round;function YH(r,t,e){if(t){var i=t.x1,n=t.x2,a=t.y1,s=t.y2;r.x1=i,r.x2=n,r.y1=a,r.y2=s;var o=e&&e.lineWidth;return o&&(Vp(i*2)===Vp(n*2)&&(r.x1=r.x2=pf(i,o,!0)),Vp(a*2)===Vp(s*2)&&(r.y1=r.y2=pf(a,o,!0))),r}}function KH(r,t,e){if(t){var i=t.x,n=t.y,a=t.width,s=t.height;r.x=i,r.y=n,r.width=a,r.height=s;var o=e&&e.lineWidth;return o&&(r.x=pf(i,o,!0),r.y=pf(n,o,!0),r.width=Math.max(pf(i+a,o,!1)-r.x,a===0?0:1),r.height=Math.max(pf(n+s,o,!1)-r.y,s===0?0:1)),r}}function pf(r,t,e){if(!t)return r;var i=Vp(r*2);return(i+Vp(t))%2===0?i/2:(i+(e?1:-1))/2}var c_t=function(){function r(){this.x=0,this.y=0,this.width=0,this.height=0}return r}(),h_t={},JH=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new c_t},t.prototype.buildPath=function(e,i){var n,a,s,o;if(this.subPixelOptimize){var l=KH(h_t,i,this.style);n=l.x,a=l.y,s=l.width,o=l.height,l.r=i.r,i=l}else n=i.x,a=i.y,s=i.width,o=i.height;i.r?u_t(e,i):e.rect(n,a,s,o)},t.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height},t}(vr);JH.prototype.type="rect";const Pr=JH;var yB={fill:"#000"},_B=2,f_t={style:We({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},SS.style)},QH=function(r){bi(t,r);function t(e){var i=r.call(this)||this;return i.type="text",i._children=[],i._defaultStyle=yB,i.attr(e),i}return t.prototype.childrenRef=function(){return this._children},t.prototype.update=function(){r.prototype.update.call(this),this.styleChanged()&&this._updateSubTexts();for(var e=0;e<this._children.length;e++){var i=this._children[e];i.zlevel=this.zlevel,i.z=this.z,i.z2=this.z2,i.culling=this.culling,i.cursor=this.cursor,i.invisible=this.invisible}},t.prototype.updateTransform=function(){var e=this.innerTransformable;e?(e.updateTransform(),e.transform&&(this.transform=e.transform)):r.prototype.updateTransform.call(this)},t.prototype.getLocalTransform=function(e){var i=this.innerTransformable;return i?i.getLocalTransform(e):r.prototype.getLocalTransform.call(this,e)},t.prototype.getComputedTransform=function(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),r.prototype.getComputedTransform.call(this)},t.prototype._updateSubTexts=function(){this._childCursor=0,g_t(this.style),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()},t.prototype.addSelfToZr=function(e){r.prototype.addSelfToZr.call(this,e);for(var i=0;i<this._children.length;i++)this._children[i].__zr=e},t.prototype.removeSelfFromZr=function(e){r.prototype.removeSelfFromZr.call(this,e);for(var i=0;i<this._children.length;i++)this._children[i].__zr=null},t.prototype.getBoundingRect=function(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){for(var e=new hr(0,0,0,0),i=this._children,n=[],a=null,s=0;s<i.length;s++){var o=i[s],l=o.getBoundingRect(),u=o.getLocalTransform(n);u?(e.copy(l),e.applyTransform(u),a=a||e.clone(),a.union(e)):(a=a||l.clone(),a.union(l))}this._rect=a||e}return this._rect},t.prototype.setDefaultTextStyle=function(e){this._defaultStyle=e||yB},t.prototype.setTextContent=function(e){},t.prototype._mergeStyle=function(e,i){if(!i)return e;var n=i.rich,a=e.rich||n&&{};return Zt(e,i),n&&a?(this._mergeRich(a,n),e.rich=a):a&&(e.rich=a),e},t.prototype._mergeRich=function(e,i){for(var n=br(i),a=0;a<n.length;a++){var s=n[a];e[s]=e[s]||{},Zt(e[s],i[s])}},t.prototype.getAnimationStyleProps=function(){return f_t},t.prototype._getOrCreateChild=function(e){var i=this._children[this._childCursor];return(!i||!(i instanceof e))&&(i=new e),this._children[this._childCursor++]=i,i.__zr=this.__zr,i.parent=this,i},t.prototype._updatePlainTexts=function(){var e=this.style,i=e.font||zc,n=e.padding,a=CB(e),s=Lyt(a,e),o=P2(e),l=!!e.backgroundColor,u=s.outerHeight,c=s.outerWidth,h=s.contentWidth,p=s.lines,v=s.lineHeight,y=this._defaultStyle,x=e.x||0,w=e.y||0,T=e.align||y.align||"left",E=e.verticalAlign||y.verticalAlign||"top",M=x,L=Sp(w,s.contentHeight,E);if(o||n){var F=zm(x,c,T),O=Sp(w,u,E);o&&this._renderBackground(e,e,F,O,c,u)}L+=v/2,n&&(M=AB(x,T,n),E==="top"?L+=n[0]:E==="bottom"&&(L-=n[2]));for(var U=0,W=!1,H=TB("fill"in e?e.fill:(W=!0,y.fill)),j=SB("stroke"in e?e.stroke:!l&&(!y.autoStroke||W)?(U=_B,y.stroke):null),Y=e.textShadowBlur>0,tt=e.width!=null&&(e.overflow==="truncate"||e.overflow==="break"||e.overflow==="breakAll"),it=s.calculatedLineHeight,lt=0;lt<p.length;lt++){var ht=this._getOrCreateChild(Gy),Tt=ht.createStyle();ht.useStyle(Tt),Tt.text=p[lt],Tt.x=M,Tt.y=L,T&&(Tt.textAlign=T),Tt.textBaseline="middle",Tt.opacity=e.opacity,Tt.strokeFirst=!0,Y&&(Tt.shadowBlur=e.textShadowBlur||0,Tt.shadowColor=e.textShadowColor||"transparent",Tt.shadowOffsetX=e.textShadowOffsetX||0,Tt.shadowOffsetY=e.textShadowOffsetY||0),Tt.stroke=j,Tt.fill=H,j&&(Tt.lineWidth=e.lineWidth||U,Tt.lineDash=e.lineDash,Tt.lineDashOffset=e.lineDashOffset||0),Tt.font=i,bB(Tt,e),L+=v,tt&&ht.setBoundingRect(new hr(zm(Tt.x,e.width,Tt.textAlign),Sp(Tt.y,it,Tt.textBaseline),h,it))}},t.prototype._updateRichTexts=function(){var e=this.style,i=CB(e),n=Nyt(i,e),a=n.width,s=n.outerWidth,o=n.outerHeight,l=e.padding,u=e.x||0,c=e.y||0,h=this._defaultStyle,p=e.align||h.align,v=e.verticalAlign||h.verticalAlign,y=zm(u,s,p),x=Sp(c,o,v),w=y,T=x;l&&(w+=l[3],T+=l[0]);var E=w+a;P2(e)&&this._renderBackground(e,e,y,x,s,o);for(var M=!!e.backgroundColor,L=0;L<n.lines.length;L++){for(var F=n.lines[L],O=F.tokens,U=O.length,W=F.lineHeight,H=F.width,j=0,Y=w,tt=E,it=U-1,lt=void 0;j<U&&(lt=O[j],!lt.align||lt.align==="left");)this._placeToken(lt,e,W,T,Y,"left",M),H-=lt.width,Y+=lt.width,j++;for(;it>=0&&(lt=O[it],lt.align==="right");)this._placeToken(lt,e,W,T,tt,"right",M),H-=lt.width,tt-=lt.width,it--;for(Y+=(a-(Y-w)-(E-tt)-H)/2;j<=it;)lt=O[j],this._placeToken(lt,e,W,T,Y+lt.width/2,"center",M),Y+=lt.width,j++;T+=W}},t.prototype._placeToken=function(e,i,n,a,s,o,l){var u=i.rich[e.styleName]||{};u.text=e.text;var c=e.verticalAlign,h=a+n/2;c==="top"?h=a+e.height/2:c==="bottom"&&(h=a+n-e.height/2);var p=!e.isLineHolder&&P2(u);p&&this._renderBackground(u,i,o==="right"?s-e.width:o==="center"?s-e.width/2:s,h-e.height/2,e.width,e.height);var v=!!u.backgroundColor,y=e.textPadding;y&&(s=AB(s,o,y),h-=e.height/2-y[0]-e.innerHeight/2);var x=this._getOrCreateChild(Gy),w=x.createStyle();x.useStyle(w);var T=this._defaultStyle,E=!1,M=0,L=TB("fill"in u?u.fill:"fill"in i?i.fill:(E=!0,T.fill)),F=SB("stroke"in u?u.stroke:"stroke"in i?i.stroke:!v&&!l&&(!T.autoStroke||E)?(M=_B,T.stroke):null),O=u.textShadowBlur>0||i.textShadowBlur>0;w.text=e.text,w.x=s,w.y=h,O&&(w.shadowBlur=u.textShadowBlur||i.textShadowBlur||0,w.shadowColor=u.textShadowColor||i.textShadowColor||"transparent",w.shadowOffsetX=u.textShadowOffsetX||i.textShadowOffsetX||0,w.shadowOffsetY=u.textShadowOffsetY||i.textShadowOffsetY||0),w.textAlign=o,w.textBaseline="middle",w.font=e.font||zc,w.opacity=_l(u.opacity,i.opacity,1),bB(w,u),F&&(w.lineWidth=_l(u.lineWidth,i.lineWidth,M),w.lineDash=ir(u.lineDash,i.lineDash),w.lineDashOffset=i.lineDashOffset||0,w.stroke=F),L&&(w.fill=L);var U=e.contentWidth,W=e.contentHeight;x.setBoundingRect(new hr(zm(w.x,U,w.textAlign),Sp(w.y,W,w.textBaseline),U,W))},t.prototype._renderBackground=function(e,i,n,a,s,o){var l=e.backgroundColor,u=e.borderWidth,c=e.borderColor,h=l&&l.image,p=l&&!h,v=e.borderRadius,y=this,x,w;if(p||e.lineHeight||u&&c){x=this._getOrCreateChild(Pr),x.useStyle(x.createStyle()),x.style.fill=null;var T=x.shape;T.x=n,T.y=a,T.width=s,T.height=o,T.r=v,x.dirtyShape()}if(p){var E=x.style;E.fill=l||null,E.fillOpacity=ir(e.fillOpacity,1)}else if(h){w=this._getOrCreateChild(ia),w.onload=function(){y.dirtyStyle()};var M=w.style;M.image=l.image,M.x=n,M.y=a,M.width=s,M.height=o}if(u&&c){var E=x.style;E.lineWidth=u,E.stroke=c,E.strokeOpacity=ir(e.strokeOpacity,1),E.lineDash=e.borderDash,E.lineDashOffset=e.borderDashOffset||0,x.strokeContainThreshold=0,x.hasFill()&&x.hasStroke()&&(E.strokeFirst=!0,E.lineWidth*=2)}var L=(x||w).style;L.shadowBlur=e.shadowBlur||0,L.shadowColor=e.shadowColor||"transparent",L.shadowOffsetX=e.shadowOffsetX||0,L.shadowOffsetY=e.shadowOffsetY||0,L.opacity=_l(e.opacity,i.opacity,1)},t.makeFont=function(e){var i="";return e7(e)&&(i=[e.fontStyle,e.fontWeight,t7(e.fontSize),e.fontFamily||"sans-serif"].join(" ")),i&&ko(i)||e.textFont||e.font},t}(ao),d_t={left:!0,right:1,center:1},p_t={top:1,bottom:1,middle:1},xB=["fontStyle","fontWeight","fontSize","fontFamily"];function t7(r){return typeof r=="string"&&(r.indexOf("px")!==-1||r.indexOf("rem")!==-1||r.indexOf("em")!==-1)?r:isNaN(+r)?AR+"px":r+"px"}function bB(r,t){for(var e=0;e<xB.length;e++){var i=xB[e],n=t[i];n!=null&&(r[i]=n)}}function e7(r){return r.fontSize!=null||r.fontFamily||r.fontWeight}function g_t(r){return wB(r),J(r.rich,wB),r}function wB(r){if(r){r.font=QH.makeFont(r);var t=r.align;t==="middle"&&(t="center"),r.align=t==null||d_t[t]?t:"left";var e=r.verticalAlign;e==="center"&&(e="middle"),r.verticalAlign=e==null||p_t[e]?e:"top";var i=r.padding;i&&(r.padding=RR(r.padding))}}function SB(r,t){return r==null||t<=0||r==="transparent"||r==="none"?null:r.image||r.colorStops?"#000":r}function TB(r){return r==null||r==="none"?null:r.image||r.colorStops?"#000":r}function AB(r,t,e){return t==="right"?r-e[1]:t==="center"?r+e[3]/2-e[1]/2:r+e[3]}function CB(r){var t=r.text;return t!=null&&(t+=""),t}function P2(r){return!!(r.backgroundColor||r.lineHeight||r.borderWidth&&r.borderColor)}const Nr=QH;var Je=Ir(),iM=function(r,t,e,i){if(i){var n=Je(i);n.dataIndex=e,n.dataType=t,n.seriesIndex=r,n.ssrType="chart",i.type==="group"&&i.traverse(function(a){var s=Je(a);s.seriesIndex=r,s.dataIndex=e,s.dataType=t,s.ssrType="chart"})}},EB=1,IB={},r7=Ir(),GR=Ir(),jR=0,I_=1,AS=2,qa=["emphasis","blur","select"],jy=["normal","emphasis","blur","select"],Rg=10,v_t=9,Ef="highlight",q1="downplay",ly="select",Y1="unselect",uy="toggleSelect";function np(r){return r!=null&&r!=="none"}function CS(r,t,e){r.onHoverStateChange&&(r.hoverState||0)!==e&&r.onHoverStateChange(t),r.hoverState=e}function i7(r){CS(r,"emphasis",AS)}function n7(r){r.hoverState===AS&&CS(r,"normal",jR)}function XR(r){CS(r,"blur",I_)}function a7(r){r.hoverState===I_&&CS(r,"normal",jR)}function m_t(r){r.selected=!0}function y_t(r){r.selected=!1}function MB(r,t,e){t(r,e)}function wu(r,t,e){MB(r,t,e),r.isGroup&&r.traverse(function(i){MB(i,t,e)})}function Jb(r,t){switch(t){case"emphasis":r.hoverState=AS;break;case"normal":r.hoverState=jR;break;case"blur":r.hoverState=I_;break;case"select":r.selected=!0}}function __t(r,t,e,i){for(var n=r.style,a={},s=0;s<t.length;s++){var o=t[s],l=n[o];a[o]=l??(i&&i[o])}for(var s=0;s<r.animators.length;s++){var u=r.animators[s];u.__fromStateTransition&&u.__fromStateTransition.indexOf(e)<0&&u.targetName==="style"&&u.saveTo(a,t)}return a}function x_t(r,t,e,i){var n=e&&pr(e,"select")>=0,a=!1;if(r instanceof vr){var s=r7(r),o=n&&s.selectFill||s.normalFill,l=n&&s.selectStroke||s.normalStroke;if(np(o)||np(l)){i=i||{};var u=i.style||{};u.fill==="inherit"?(a=!0,i=Zt({},i),u=Zt({},u),u.fill=o):!np(u.fill)&&np(o)?(a=!0,i=Zt({},i),u=Zt({},u),u.fill=$I(o)):!np(u.stroke)&&np(l)&&(a||(i=Zt({},i),u=Zt({},u)),u.stroke=$I(l)),i.style=u}}if(i&&i.z2==null){a||(i=Zt({},i));var c=r.z2EmphasisLift;i.z2=r.z2+(c??Rg)}return i}function b_t(r,t,e){if(e&&e.z2==null){e=Zt({},e);var i=r.z2SelectLift;e.z2=r.z2+(i??v_t)}return e}function w_t(r,t,e){var i=pr(r.currentStates,t)>=0,n=r.style.opacity,a=i?null:__t(r,["opacity"],t,{opacity:1});e=e||{};var s=e.style||{};return s.opacity==null&&(e=Zt({},e),s=Zt({opacity:i?n:a.opacity*.1},s),e.style=s),e}function R2(r,t){var e=this.states[r];if(this.style){if(r==="emphasis")return x_t(this,r,t,e);if(r==="blur")return w_t(this,r,e);if(r==="select")return b_t(this,r,e)}return e}function Gf(r){r.stateProxy=R2;var t=r.getTextContent(),e=r.getTextGuideLine();t&&(t.stateProxy=R2),e&&(e.stateProxy=R2)}function PB(r,t){!u7(r,t)&&!r.__highByOuter&&wu(r,i7)}function RB(r,t){!u7(r,t)&&!r.__highByOuter&&wu(r,n7)}function vu(r,t){r.__highByOuter|=1<<(t||0),wu(r,i7)}function mu(r,t){!(r.__highByOuter&=~(1<<(t||0)))&&wu(r,n7)}function s7(r){wu(r,XR)}function ZR(r){wu(r,a7)}function o7(r){wu(r,m_t)}function l7(r){wu(r,y_t)}function u7(r,t){return r.__highDownSilentOnTouch&&t.zrByTouch}function c7(r){var t=r.getModel(),e=[],i=[];t.eachComponent(function(n,a){var s=GR(a),o=n==="series",l=o?r.getViewOfSeriesModel(a):r.getViewOfComponentModel(a);!o&&i.push(l),s.isBlured&&(l.group.traverse(function(u){a7(u)}),o&&e.push(a)),s.isBlured=!1}),J(i,function(n){n&&n.toggleBlurSeries&&n.toggleBlurSeries(e,!1,t)})}function nM(r,t,e,i){var n=i.getModel();e=e||"coordinateSystem";function a(u,c){for(var h=0;h<c.length;h++){var p=u.getItemGraphicEl(c[h]);p&&ZR(p)}}if(r!=null&&!(!t||t==="none")){var s=n.getSeriesByIndex(r),o=s.coordinateSystem;o&&o.master&&(o=o.master);var l=[];n.eachSeries(function(u){var c=s===u,h=u.coordinateSystem;h&&h.master&&(h=h.master);var p=h&&o?h===o:c;if(!(e==="series"&&!c||e==="coordinateSystem"&&!p||t==="series"&&c)){var v=i.getViewOfSeriesModel(u);if(v.group.traverse(function(w){w.__highByOuter&&c&&t==="self"||XR(w)}),Sa(t))a(u.getData(),t);else if(je(t))for(var y=br(t),x=0;x<y.length;x++)a(u.getData(y[x]),t[y[x]]);l.push(u),GR(u).isBlured=!0}}),n.eachComponent(function(u,c){if(u!=="series"){var h=i.getViewOfComponentModel(c);h&&h.toggleBlurSeries&&h.toggleBlurSeries(l,!0,n)}})}}function aM(r,t,e){if(!(r==null||t==null)){var i=e.getModel().getComponent(r,t);if(i){GR(i).isBlured=!0;var n=e.getViewOfComponentModel(i);!n||!n.focusBlurEnabled||n.group.traverse(function(a){XR(a)})}}}function S_t(r,t,e){var i=r.seriesIndex,n=r.getData(t.dataType);if(n){var a=Wf(n,t);a=(Kt(a)?a[0]:a)||0;var s=n.getItemGraphicEl(a);if(!s)for(var o=n.count(),l=0;!s&&l<o;)s=n.getItemGraphicEl(l++);if(s){var u=Je(s);nM(i,u.focus,u.blurScope,e)}else{var c=r.get(["emphasis","focus"]),h=r.get(["emphasis","blurScope"]);c!=null&&nM(i,c,h,e)}}}function qR(r,t,e,i){var n={focusSelf:!1,dispatchers:null};if(r==null||r==="series"||t==null||e==null)return n;var a=i.getModel().getComponent(r,t);if(!a)return n;var s=i.getViewOfComponentModel(a);if(!s||!s.findHighDownDispatchers)return n;for(var o=s.findHighDownDispatchers(e),l,u=0;u<o.length;u++)if(Je(o[u]).focus==="self"){l=!0;break}return{focusSelf:l,dispatchers:o}}function T_t(r,t,e){var i=Je(r),n=qR(i.componentMainType,i.componentIndex,i.componentHighDownName,e),a=n.dispatchers,s=n.focusSelf;a?(s&&aM(i.componentMainType,i.componentIndex,e),J(a,function(o){return PB(o,t)})):(nM(i.seriesIndex,i.focus,i.blurScope,e),i.focus==="self"&&aM(i.componentMainType,i.componentIndex,e),PB(r,t))}function A_t(r,t,e){c7(e);var i=Je(r),n=qR(i.componentMainType,i.componentIndex,i.componentHighDownName,e).dispatchers;n?J(n,function(a){return RB(a,t)}):RB(r,t)}function C_t(r,t,e){if(oM(t)){var i=t.dataType,n=r.getData(i),a=Wf(n,t);Kt(a)||(a=[a]),r[t.type===uy?"toggleSelect":t.type===ly?"select":"unselect"](a,i)}}function DB(r){var t=r.getAllData();J(t,function(e){var i=e.data,n=e.type;i.eachItemGraphicEl(function(a,s){r.isSelected(s,n)?o7(a):l7(a)})})}function E_t(r){var t=[];return r.eachSeries(function(e){var i=e.getAllData();J(i,function(n){n.data;var a=n.type,s=e.getSelectedDataIndices();if(s.length>0){var o={dataIndex:s,seriesIndex:e.seriesIndex};a!=null&&(o.dataType=a),t.push(o)}})}),t}function If(r,t,e){gf(r,!0),wu(r,Gf),sM(r,t,e)}function I_t(r){gf(r,!1)}function Ui(r,t,e,i){i?I_t(r):If(r,t,e)}function sM(r,t,e){var i=Je(r);t!=null?(i.focus=t,i.blurScope=e):i.focus&&(i.focus=null)}var LB=["emphasis","blur","select"],M_t={itemStyle:"getItemStyle",lineStyle:"getLineStyle",areaStyle:"getAreaStyle"};function ea(r,t,e,i){e=e||"itemStyle";for(var n=0;n<LB.length;n++){var a=LB[n],s=t.getModel([a,e]),o=r.ensureState(a);o.style=i?i(s):s[M_t[e]]()}}function gf(r,t){var e=t===!1,i=r;r.highDownSilentOnTouch&&(i.__highDownSilentOnTouch=r.highDownSilentOnTouch),(!e||i.__highDownDispatcher)&&(i.__highByOuter=i.__highByOuter||0,i.__highDownDispatcher=!e)}function Xy(r){return!!(r&&r.__highDownDispatcher)}function P_t(r,t,e){var i=Je(r);i.componentMainType=t.mainType,i.componentIndex=t.componentIndex,i.componentHighDownName=e}function R_t(r){var t=IB[r];return t==null&&EB<=32&&(t=IB[r]=EB++),t}function oM(r){var t=r.type;return t===ly||t===Y1||t===uy}function kB(r){var t=r.type;return t===Ef||t===q1}function D_t(r){var t=r7(r);t.normalFill=r.style.fill,t.normalStroke=r.style.stroke;var e=r.states.select||{};t.selectFill=e.style&&e.style.fill||null,t.selectStroke=e.style&&e.style.stroke||null}var ap=Al.CMD,L_t=[[],[],[]],OB=Math.sqrt,k_t=Math.atan2;function h7(r,t){if(t){var e=r.data,i=r.len(),n,a,s,o,l,u,c=ap.M,h=ap.C,p=ap.L,v=ap.R,y=ap.A,x=ap.Q;for(s=0,o=0;s<i;){switch(n=e[s++],o=s,a=0,n){case c:a=1;break;case p:a=1;break;case h:a=3;break;case x:a=2;break;case y:var w=t[4],T=t[5],E=OB(t[0]*t[0]+t[1]*t[1]),M=OB(t[2]*t[2]+t[3]*t[3]),L=k_t(-t[1]/M,t[0]/E);e[s]*=E,e[s++]+=w,e[s]*=M,e[s++]+=T,e[s++]*=E,e[s++]*=M,e[s++]+=L,e[s++]+=L,s+=2,o=s;break;case v:u[0]=e[s++],u[1]=e[s++],Qn(u,u,t),e[o++]=u[0],e[o++]=u[1],u[0]+=e[s++],u[1]+=e[s++],Qn(u,u,t),e[o++]=u[0],e[o++]=u[1]}for(l=0;l<a;l++){var F=L_t[l];F[0]=e[s++],F[1]=e[s++],Qn(F,F,t),e[o++]=F[0],e[o++]=F[1]}}r.increaseVersion()}}var D2=Math.sqrt,Vx=Math.sin,Ux=Math.cos,um=Math.PI;function NB(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function lM(r,t){return(r[0]*t[0]+r[1]*t[1])/(NB(r)*NB(t))}function FB(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(lM(r,t))}function BB(r,t,e,i,n,a,s,o,l,u,c){var h=l*(um/180),p=Ux(h)*(r-e)/2+Vx(h)*(t-i)/2,v=-1*Vx(h)*(r-e)/2+Ux(h)*(t-i)/2,y=p*p/(s*s)+v*v/(o*o);y>1&&(s*=D2(y),o*=D2(y));var x=(n===a?-1:1)*D2((s*s*(o*o)-s*s*(v*v)-o*o*(p*p))/(s*s*(v*v)+o*o*(p*p)))||0,w=x*s*v/o,T=x*-o*p/s,E=(r+e)/2+Ux(h)*w-Vx(h)*T,M=(t+i)/2+Vx(h)*w+Ux(h)*T,L=FB([1,0],[(p-w)/s,(v-T)/o]),F=[(p-w)/s,(v-T)/o],O=[(-1*p-w)/s,(-1*v-T)/o],U=FB(F,O);if(lM(F,O)<=-1&&(U=um),lM(F,O)>=1&&(U=0),U<0){var W=Math.round(U/um*1e6)/1e6;U=um*2+W%2*um}c.addData(u,E,M,s,o,L,U,h,a)}var O_t=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/ig,N_t=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function F_t(r){var t=new Al;if(!r)return t;var e=0,i=0,n=e,a=i,s,o=Al.CMD,l=r.match(O_t);if(!l)return t;for(var u=0;u<l.length;u++){for(var c=l[u],h=c.charAt(0),p=void 0,v=c.match(N_t)||[],y=v.length,x=0;x<y;x++)v[x]=parseFloat(v[x]);for(var w=0;w<y;){var T=void 0,E=void 0,M=void 0,L=void 0,F=void 0,O=void 0,U=void 0,W=e,H=i,j=void 0,Y=void 0;switch(h){case"l":e+=v[w++],i+=v[w++],p=o.L,t.addData(p,e,i);break;case"L":e=v[w++],i=v[w++],p=o.L,t.addData(p,e,i);break;case"m":e+=v[w++],i+=v[w++],p=o.M,t.addData(p,e,i),n=e,a=i,h="l";break;case"M":e=v[w++],i=v[w++],p=o.M,t.addData(p,e,i),n=e,a=i,h="L";break;case"h":e+=v[w++],p=o.L,t.addData(p,e,i);break;case"H":e=v[w++],p=o.L,t.addData(p,e,i);break;case"v":i+=v[w++],p=o.L,t.addData(p,e,i);break;case"V":i=v[w++],p=o.L,t.addData(p,e,i);break;case"C":p=o.C,t.addData(p,v[w++],v[w++],v[w++],v[w++],v[w++],v[w++]),e=v[w-2],i=v[w-1];break;case"c":p=o.C,t.addData(p,v[w++]+e,v[w++]+i,v[w++]+e,v[w++]+i,v[w++]+e,v[w++]+i),e+=v[w-2],i+=v[w-1];break;case"S":T=e,E=i,j=t.len(),Y=t.data,s===o.C&&(T+=e-Y[j-4],E+=i-Y[j-3]),p=o.C,W=v[w++],H=v[w++],e=v[w++],i=v[w++],t.addData(p,T,E,W,H,e,i);break;case"s":T=e,E=i,j=t.len(),Y=t.data,s===o.C&&(T+=e-Y[j-4],E+=i-Y[j-3]),p=o.C,W=e+v[w++],H=i+v[w++],e+=v[w++],i+=v[w++],t.addData(p,T,E,W,H,e,i);break;case"Q":W=v[w++],H=v[w++],e=v[w++],i=v[w++],p=o.Q,t.addData(p,W,H,e,i);break;case"q":W=v[w++]+e,H=v[w++]+i,e+=v[w++],i+=v[w++],p=o.Q,t.addData(p,W,H,e,i);break;case"T":T=e,E=i,j=t.len(),Y=t.data,s===o.Q&&(T+=e-Y[j-4],E+=i-Y[j-3]),e=v[w++],i=v[w++],p=o.Q,t.addData(p,T,E,e,i);break;case"t":T=e,E=i,j=t.len(),Y=t.data,s===o.Q&&(T+=e-Y[j-4],E+=i-Y[j-3]),e+=v[w++],i+=v[w++],p=o.Q,t.addData(p,T,E,e,i);break;case"A":M=v[w++],L=v[w++],F=v[w++],O=v[w++],U=v[w++],W=e,H=i,e=v[w++],i=v[w++],p=o.A,BB(W,H,e,i,O,U,M,L,F,p,t);break;case"a":M=v[w++],L=v[w++],F=v[w++],O=v[w++],U=v[w++],W=e,H=i,e+=v[w++],i+=v[w++],p=o.A,BB(W,H,e,i,O,U,M,L,F,p,t);break}}(h==="z"||h==="Z")&&(p=o.Z,t.addData(p),e=n,i=a),s=p}return t.toStatic(),t}var f7=function(r){bi(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.applyTransform=function(e){},t}(vr);function d7(r){return r.setData!=null}function p7(r,t){var e=F_t(r),i=Zt({},t);return i.buildPath=function(n){if(d7(n)){n.setData(e.data);var a=n.getContext();a&&n.rebuildPath(a,1)}else{var a=n;e.rebuildPath(a,1)}},i.applyTransform=function(n){h7(e,n),this.dirtyShape()},i}function g7(r,t){return new f7(p7(r,t))}function B_t(r,t){var e=p7(r,t),i=function(n){bi(a,n);function a(s){var o=n.call(this,s)||this;return o.applyTransform=e.applyTransform,o.buildPath=e.buildPath,o}return a}(f7);return i}function z_t(r,t){for(var e=[],i=r.length,n=0;n<i;n++){var a=r[n];e.push(a.getUpdatedPathProxy(!0))}var s=new vr(t);return s.createPathProxy(),s.buildPath=function(o){if(d7(o)){o.appendPath(e);var l=o.getContext();l&&o.rebuildPath(l,1)}},s}function YR(r,t){t=t||{};var e=new vr;return r.shape&&e.setShape(r.shape),e.setStyle(r.style),t.bakeTransform?h7(e.path,r.getComputedTransform()):t.toLocal?e.setLocalTransform(r.getComputedTransform()):e.copyTransform(r),e.buildPath=r.buildPath,e.applyTransform=e.applyTransform,e.z=r.z,e.z2=r.z2,e.zlevel=r.zlevel,e}var V_t=function(){function r(){this.cx=0,this.cy=0,this.r=0}return r}(),v7=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new V_t},t.prototype.buildPath=function(e,i){e.moveTo(i.cx+i.r,i.cy),e.arc(i.cx,i.cy,i.r,0,Math.PI*2)},t}(vr);v7.prototype.type="circle";const Yc=v7;var U_t=function(){function r(){this.cx=0,this.cy=0,this.rx=0,this.ry=0}return r}(),m7=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new U_t},t.prototype.buildPath=function(e,i){var n=.5522848,a=i.cx,s=i.cy,o=i.rx,l=i.ry,u=o*n,c=l*n;e.moveTo(a-o,s),e.bezierCurveTo(a-o,s-c,a-u,s-l,a,s-l),e.bezierCurveTo(a+u,s-l,a+o,s-c,a+o,s),e.bezierCurveTo(a+o,s+c,a+u,s+l,a,s+l),e.bezierCurveTo(a-u,s+l,a-o,s+c,a-o,s),e.closePath()},t}(vr);m7.prototype.type="ellipse";const KR=m7;var y7=Math.PI,L2=y7*2,Fh=Math.sin,sp=Math.cos,$_t=Math.acos,ma=Math.atan2,zB=Math.abs,cy=Math.sqrt,Vm=Math.max,al=Math.min,Co=1e-4;function W_t(r,t,e,i,n,a,s,o){var l=e-r,u=i-t,c=s-n,h=o-a,p=h*l-c*u;if(!(p*p<Co))return p=(c*(t-a)-h*(r-n))/p,[r+p*l,t+p*u]}function $x(r,t,e,i,n,a,s){var o=r-e,l=t-i,u=(s?a:-a)/cy(o*o+l*l),c=u*l,h=-u*o,p=r+c,v=t+h,y=e+c,x=i+h,w=(p+y)/2,T=(v+x)/2,E=y-p,M=x-v,L=E*E+M*M,F=n-a,O=p*x-y*v,U=(M<0?-1:1)*cy(Vm(0,F*F*L-O*O)),W=(O*M-E*U)/L,H=(-O*E-M*U)/L,j=(O*M+E*U)/L,Y=(-O*E+M*U)/L,tt=W-w,it=H-T,lt=j-w,ht=Y-T;return tt*tt+it*it>lt*lt+ht*ht&&(W=j,H=Y),{cx:W,cy:H,x0:-c,y0:-h,x1:W*(n/F-1),y1:H*(n/F-1)}}function H_t(r){var t;if(Kt(r)){var e=r.length;if(!e)return r;e===1?t=[r[0],r[0],0,0]:e===2?t=[r[0],r[0],r[1],r[1]]:e===3?t=r.concat(r[2]):t=r}else t=[r,r,r,r];return t}function G_t(r,t){var e,i=Vm(t.r,0),n=Vm(t.r0||0,0),a=i>0,s=n>0;if(!(!a&&!s)){if(a||(i=n,n=0),n>i){var o=i;i=n,n=o}var l=t.startAngle,u=t.endAngle;if(!(isNaN(l)||isNaN(u))){var c=t.cx,h=t.cy,p=!!t.clockwise,v=zB(u-l),y=v>L2&&v%L2;if(y>Co&&(v=y),!(i>Co))r.moveTo(c,h);else if(v>L2-Co)r.moveTo(c+i*sp(l),h+i*Fh(l)),r.arc(c,h,i,l,u,!p),n>Co&&(r.moveTo(c+n*sp(u),h+n*Fh(u)),r.arc(c,h,n,u,l,p));else{var x=void 0,w=void 0,T=void 0,E=void 0,M=void 0,L=void 0,F=void 0,O=void 0,U=void 0,W=void 0,H=void 0,j=void 0,Y=void 0,tt=void 0,it=void 0,lt=void 0,ht=i*sp(l),Tt=i*Fh(l),Ot=n*sp(u),Rt=n*Fh(u),Ut=v>Co;if(Ut){var Jt=t.cornerRadius;Jt&&(e=H_t(Jt),x=e[0],w=e[1],T=e[2],E=e[3]);var ne=zB(i-n)/2;if(M=al(ne,T),L=al(ne,E),F=al(ne,x),O=al(ne,w),H=U=Vm(M,L),j=W=Vm(F,O),(U>Co||W>Co)&&(Y=i*sp(u),tt=i*Fh(u),it=n*sp(l),lt=n*Fh(l),v<y7)){var se=W_t(ht,Tt,it,lt,Y,tt,Ot,Rt);if(se){var ce=ht-se[0],ye=Tt-se[1],Qe=Y-se[0],sr=tt-se[1],ke=1/Fh($_t((ce*Qe+ye*sr)/(cy(ce*ce+ye*ye)*cy(Qe*Qe+sr*sr)))/2),Ce=cy(se[0]*se[0]+se[1]*se[1]);H=al(U,(i-Ce)/(ke+1)),j=al(W,(n-Ce)/(ke-1))}}}if(!Ut)r.moveTo(c+ht,h+Tt);else if(H>Co){var Ee=al(T,H),Ie=al(E,H),Se=$x(it,lt,ht,Tt,i,Ee,p),Fe=$x(Y,tt,Ot,Rt,i,Ie,p);r.moveTo(c+Se.cx+Se.x0,h+Se.cy+Se.y0),H<U&&Ee===Ie?r.arc(c+Se.cx,h+Se.cy,H,ma(Se.y0,Se.x0),ma(Fe.y0,Fe.x0),!p):(Ee>0&&r.arc(c+Se.cx,h+Se.cy,Ee,ma(Se.y0,Se.x0),ma(Se.y1,Se.x1),!p),r.arc(c,h,i,ma(Se.cy+Se.y1,Se.cx+Se.x1),ma(Fe.cy+Fe.y1,Fe.cx+Fe.x1),!p),Ie>0&&r.arc(c+Fe.cx,h+Fe.cy,Ie,ma(Fe.y1,Fe.x1),ma(Fe.y0,Fe.x0),!p))}else r.moveTo(c+ht,h+Tt),r.arc(c,h,i,l,u,!p);if(!(n>Co)||!Ut)r.lineTo(c+Ot,h+Rt);else if(j>Co){var Ee=al(x,j),Ie=al(w,j),Se=$x(Ot,Rt,Y,tt,n,-Ie,p),Fe=$x(ht,Tt,it,lt,n,-Ee,p);r.lineTo(c+Se.cx+Se.x0,h+Se.cy+Se.y0),j<W&&Ee===Ie?r.arc(c+Se.cx,h+Se.cy,j,ma(Se.y0,Se.x0),ma(Fe.y0,Fe.x0),!p):(Ie>0&&r.arc(c+Se.cx,h+Se.cy,Ie,ma(Se.y0,Se.x0),ma(Se.y1,Se.x1),!p),r.arc(c,h,n,ma(Se.cy+Se.y1,Se.cx+Se.x1),ma(Fe.cy+Fe.y1,Fe.cx+Fe.x1),p),Ee>0&&r.arc(c+Fe.cx,h+Fe.cy,Ee,ma(Fe.y1,Fe.x1),ma(Fe.y0,Fe.x0),!p))}else r.lineTo(c+Ot,h+Rt),r.arc(c,h,n,u,l,p)}r.closePath()}}}var j_t=function(){function r(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0,this.cornerRadius=0}return r}(),_7=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new j_t},t.prototype.buildPath=function(e,i){G_t(e,i)},t.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0},t}(vr);_7.prototype.type="sector";const fs=_7;var X_t=function(){function r(){this.cx=0,this.cy=0,this.r=0,this.r0=0}return r}(),x7=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new X_t},t.prototype.buildPath=function(e,i){var n=i.cx,a=i.cy,s=Math.PI*2;e.moveTo(n+i.r,a),e.arc(n,a,i.r,0,s,!1),e.moveTo(n+i.r0,a),e.arc(n,a,i.r0,0,s,!0)},t}(vr);x7.prototype.type="ring";const ES=x7;function Z_t(r,t,e,i){var n=[],a=[],s=[],o=[],l,u,c,h;if(i){c=[1/0,1/0],h=[-1/0,-1/0];for(var p=0,v=r.length;p<v;p++)bc(c,c,r[p]),wc(h,h,r[p]);bc(c,c,i[0]),wc(h,h,i[1])}for(var p=0,v=r.length;p<v;p++){var y=r[p];if(e)l=r[p?p-1:v-1],u=r[(p+1)%v];else if(p===0||p===v-1){n.push(ou(r[p]));continue}else l=r[p-1],u=r[p+1];df(a,u,l),U1(a,a,t);var x=DI(y,l),w=DI(y,u),T=x+w;T!==0&&(x/=T,w/=T),U1(s,a,-x),U1(o,a,w);var E=DF([],y,s),M=DF([],y,o);i&&(wc(E,E,c),bc(E,E,h),wc(M,M,c),bc(M,M,h)),n.push(E),n.push(M)}return e&&n.push(n.shift()),n}function b7(r,t,e){var i=t.smooth,n=t.points;if(n&&n.length>=2){if(i){var a=Z_t(n,i,e,t.smoothConstraint);r.moveTo(n[0][0],n[0][1]);for(var s=n.length,o=0;o<(e?s:s-1);o++){var l=a[o*2],u=a[o*2+1],c=n[(o+1)%s];r.bezierCurveTo(l[0],l[1],u[0],u[1],c[0],c[1])}}else{r.moveTo(n[0][0],n[0][1]);for(var o=1,h=n.length;o<h;o++)r.lineTo(n[o][0],n[o][1])}e&&r.closePath()}}var q_t=function(){function r(){this.points=null,this.smooth=0,this.smoothConstraint=null}return r}(),w7=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new q_t},t.prototype.buildPath=function(e,i){b7(e,i,!0)},t}(vr);w7.prototype.type="polygon";const ds=w7;var Y_t=function(){function r(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null}return r}(),S7=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new Y_t},t.prototype.buildPath=function(e,i){b7(e,i,!1)},t}(vr);S7.prototype.type="polyline";const ps=S7;var K_t={},J_t=function(){function r(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}return r}(),T7=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new J_t},t.prototype.buildPath=function(e,i){var n,a,s,o;if(this.subPixelOptimize){var l=YH(K_t,i,this.style);n=l.x1,a=l.y1,s=l.x2,o=l.y2}else n=i.x1,a=i.y1,s=i.x2,o=i.y2;var u=i.percent;u!==0&&(e.moveTo(n,a),u<1&&(s=n*(1-u)+s*u,o=a*(1-u)+o*u),e.lineTo(s,o))},t.prototype.pointAt=function(e){var i=this.shape;return[i.x1*(1-e)+i.x2*e,i.y1*(1-e)+i.y2*e]},t}(vr);T7.prototype.type="line";const $n=T7;var ss=[],Q_t=function(){function r(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1}return r}();function VB(r,t,e){var i=r.cpx2,n=r.cpy2;return i!=null||n!=null?[(e?HF:Pn)(r.x1,r.cpx1,r.cpx2,r.x2,t),(e?HF:Pn)(r.y1,r.cpy1,r.cpy2,r.y2,t)]:[(e?BI:Vn)(r.x1,r.cpx1,r.x2,t),(e?BI:Vn)(r.y1,r.cpy1,r.y2,t)]}var A7=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new Q_t},t.prototype.buildPath=function(e,i){var n=i.x1,a=i.y1,s=i.x2,o=i.y2,l=i.cpx1,u=i.cpy1,c=i.cpx2,h=i.cpy2,p=i.percent;p!==0&&(e.moveTo(n,a),c==null||h==null?(p<1&&(Vy(n,l,s,p,ss),l=ss[1],s=ss[2],Vy(a,u,o,p,ss),u=ss[1],o=ss[2]),e.quadraticCurveTo(l,u,s,o)):(p<1&&(Uc(n,l,c,s,p,ss),l=ss[1],c=ss[2],s=ss[3],Uc(a,u,h,o,p,ss),u=ss[1],h=ss[2],o=ss[3]),e.bezierCurveTo(l,u,c,h,s,o)))},t.prototype.pointAt=function(e){return VB(this.shape,e,!1)},t.prototype.tangentAt=function(e){var i=VB(this.shape,e,!0);return Ig(i,i)},t}(vr);A7.prototype.type="bezier-curve";const IS=A7;var t0t=function(){function r(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return r}(),C7=function(r){bi(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new t0t},t.prototype.buildPath=function(e,i){var n=i.cx,a=i.cy,s=Math.max(i.r,0),o=i.startAngle,l=i.endAngle,u=i.clockwise,c=Math.cos(o),h=Math.sin(o);e.moveTo(c*s+n,h*s+a),e.arc(n,a,s,o,l,!u)},t}(vr);C7.prototype.type="arc";const JR=C7;var e0t=function(r){bi(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="compound",e}return t.prototype._updatePathDirty=function(){for(var e=this.shape.paths,i=this.shapeChanged(),n=0;n<e.length;n++)i=i||e[n].shapeChanged();i&&this.dirtyShape()},t.prototype.beforeBrush=function(){this._updatePathDirty();for(var e=this.shape.paths||[],i=this.getGlobalScale(),n=0;n<e.length;n++)e[n].path||e[n].createPathProxy(),e[n].path.setScale(i[0],i[1],e[n].segmentIgnoreThreshold)},t.prototype.buildPath=function(e,i){for(var n=i.paths||[],a=0;a<n.length;a++)n[a].buildPath(e,n[a].shape,!0)},t.prototype.afterBrush=function(){for(var e=this.shape.paths||[],i=0;i<e.length;i++)e[i].pathUpdated()},t.prototype.getBoundingRect=function(){return this._updatePathDirty.call(this),vr.prototype.getBoundingRect.call(this)},t}(vr);const QR=e0t;var r0t=function(){function r(t){this.colorStops=t||[]}return r.prototype.addColorStop=function(t,e){this.colorStops.push({offset:t,color:e})},r}();const E7=r0t;var i0t=function(r){bi(t,r);function t(e,i,n,a,s,o){var l=r.call(this,s)||this;return l.x=e??0,l.y=i??0,l.x2=n??1,l.y2=a??0,l.type="linear",l.global=o||!1,l}return t}(E7);const M_=i0t;var n0t=function(r){bi(t,r);function t(e,i,n,a,s){var o=r.call(this,a)||this;return o.x=e??.5,o.y=i??.5,o.r=n??.5,o.type="radial",o.global=s||!1,o}return t}(E7);const I7=n0t;var Bh=[0,0],zh=[0,0],Wx=new lr,Hx=new lr,a0t=function(){function r(t,e){this._corners=[],this._axes=[],this._origin=[0,0];for(var i=0;i<4;i++)this._corners[i]=new lr;for(var i=0;i<2;i++)this._axes[i]=new lr;t&&this.fromBoundingRect(t,e)}return r.prototype.fromBoundingRect=function(t,e){var i=this._corners,n=this._axes,a=t.x,s=t.y,o=a+t.width,l=s+t.height;if(i[0].set(a,s),i[1].set(o,s),i[2].set(o,l),i[3].set(a,l),e)for(var u=0;u<4;u++)i[u].transform(e);lr.sub(n[0],i[1],i[0]),lr.sub(n[1],i[3],i[0]),n[0].normalize(),n[1].normalize();for(var u=0;u<2;u++)this._origin[u]=n[u].dot(i[0])},r.prototype.intersect=function(t,e){var i=!0,n=!e;return Wx.set(1/0,1/0),Hx.set(0,0),!this._intersectCheckOneSide(this,t,Wx,Hx,n,1)&&(i=!1,n)||!this._intersectCheckOneSide(t,this,Wx,Hx,n,-1)&&(i=!1,n)||n||lr.copy(e,i?Wx:Hx),i},r.prototype._intersectCheckOneSide=function(t,e,i,n,a,s){for(var o=!0,l=0;l<2;l++){var u=this._axes[l];if(this._getProjMinMaxOnAxis(l,t._corners,Bh),this._getProjMinMaxOnAxis(l,e._corners,zh),Bh[1]<zh[0]||Bh[0]>zh[1]){if(o=!1,a)return o;var c=Math.abs(zh[0]-Bh[1]),h=Math.abs(Bh[0]-zh[1]);Math.min(c,h)>n.len()&&(c<h?lr.scale(n,u,-c*s):lr.scale(n,u,h*s))}else if(i){var c=Math.abs(zh[0]-Bh[1]),h=Math.abs(Bh[0]-zh[1]);Math.min(c,h)<i.len()&&(c<h?lr.scale(i,u,c*s):lr.scale(i,u,-h*s))}}return o},r.prototype._getProjMinMaxOnAxis=function(t,e,i){for(var n=this._axes[t],a=this._origin,s=e[0].dot(n)+a[t],o=s,l=s,u=1;u<e.length;u++){var c=e[u].dot(n)+a[t];o=Math.min(c,o),l=Math.max(c,l)}i[0]=o,i[1]=l},r}();const Qb=a0t;var s0t=[],o0t=function(r){bi(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.notClear=!0,e.incremental=!0,e._displayables=[],e._temporaryDisplayables=[],e._cursor=0,e}return t.prototype.traverse=function(e,i){e.call(i,this)},t.prototype.useStyle=function(){this.style={}},t.prototype.getCursor=function(){return this._cursor},t.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length},t.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1},t.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]},t.prototype.addDisplayable=function(e,i){i?this._temporaryDisplayables.push(e):this._displayables.push(e),this.markRedraw()},t.prototype.addDisplayables=function(e,i){i=i||!1;for(var n=0;n<e.length;n++)this.addDisplayable(e[n],i)},t.prototype.getDisplayables=function(){return this._displayables},t.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables},t.prototype.eachPendingDisplayable=function(e){for(var i=this._cursor;i<this._displayables.length;i++)e&&e(this._displayables[i]);for(var i=0;i<this._temporaryDisplayables.length;i++)e&&e(this._temporaryDisplayables[i])},t.prototype.update=function(){this.updateTransform();for(var e=this._cursor;e<this._displayables.length;e++){var i=this._displayables[e];i.parent=this,i.update(),i.parent=null}for(var e=0;e<this._temporaryDisplayables.length;e++){var i=this._temporaryDisplayables[e];i.parent=this,i.update(),i.parent=null}},t.prototype.getBoundingRect=function(){if(!this._rect){for(var e=new hr(1/0,1/0,-1/0,-1/0),i=0;i<this._displayables.length;i++){var n=this._displayables[i],a=n.getBoundingRect().clone();n.needLocalTransform()&&a.applyTransform(n.getLocalTransform(s0t)),e.union(a)}this._rect=e}return this._rect},t.prototype.contain=function(e,i){var n=this.transformCoordToLocal(e,i),a=this.getBoundingRect();if(a.contain(n[0],n[1]))for(var s=0;s<this._displayables.length;s++){var o=this._displayables[s];if(o.contain(e,i))return!0}return!1},t}(ao);const l0t=o0t;var M7=Ir();function Dg(r,t,e,i,n){var a;if(t&&t.ecModel){var s=t.ecModel.getUpdatePayload();a=s&&s.animation}var o=t&&t.isAnimationEnabled(),l=r==="update";if(o){var u=void 0,c=void 0,h=void 0;i?(u=ir(i.duration,200),c=ir(i.easing,"cubicOut"),h=0):(u=t.getShallow(l?"animationDurationUpdate":"animationDuration"),c=t.getShallow(l?"animationEasingUpdate":"animationEasing"),h=t.getShallow(l?"animationDelayUpdate":"animationDelay")),a&&(a.duration!=null&&(u=a.duration),a.easing!=null&&(c=a.easing),a.delay!=null&&(h=a.delay)),Ve(h)&&(h=h(e,n)),Ve(u)&&(u=u(e));var p={duration:u||0,delay:h,easing:c};return p}else return null}function tD(r,t,e,i,n,a,s){var o=!1,l;Ve(n)?(s=a,a=n,n=null):je(n)&&(a=n.cb,s=n.during,o=n.isFrom,l=n.removeOpt,n=n.dataIndex);var u=r==="leave";u||t.stopAnimation("leave");var c=Dg(r,i,n,u?l||{}:null,i&&i.getAnimationDelayParams?i.getAnimationDelayParams(t,n):null);if(c&&c.duration>0){var h=c.duration,p=c.delay,v=c.easing,y={duration:h,delay:p||0,easing:v,done:a,force:!!a||!!s,setToFinal:!u,scope:r,during:s};o?t.animateFrom(e,y):t.animateTo(e,y)}else t.stopAnimation(),!o&&t.attr(e),s&&s(1),a&&a()}function zr(r,t,e,i,n,a){tD("update",r,t,e,i,n,a)}function Ei(r,t,e,i,n,a){tD("enter",r,t,e,i,n,a)}function Yp(r){if(!r.__zr)return!0;for(var t=0;t<r.animators.length;t++){var e=r.animators[t];if(e.scope==="leave")return!0}return!1}function $c(r,t,e,i,n,a){Yp(r)||tD("leave",r,t,e,i,n,a)}function UB(r,t,e,i){r.removeTextContent(),r.removeTextGuideLine(),$c(r,{style:{opacity:0}},t,e,i)}function Zy(r,t,e){function i(){r.parent&&r.parent.remove(r)}r.isGroup?r.traverse(function(n){n.isGroup||UB(n,t,e,i)}):UB(r,t,e,i)}function Vo(r){M7(r).oldStyle=r.style}function u0t(r){return M7(r).oldStyle}var tw=Math.max,ew=Math.min,uM={};function c0t(r){return vr.extend(r)}var h0t=B_t;function f0t(r,t){return h0t(r,t)}function Uo(r,t){uM[r]=t}function eD(r){if(uM.hasOwnProperty(r))return uM[r]}function MS(r,t,e,i){var n=g7(r,t);return e&&(i==="center"&&(e=R7(e,n.getBoundingRect())),D7(n,e)),n}function P7(r,t,e){var i=new ia({style:{image:r,x:t.x,y:t.y,width:t.width,height:t.height},onload:function(n){if(e==="center"){var a={width:n.width,height:n.height};i.setStyle(R7(t,a))}}});return i}function R7(r,t){var e=t.width/t.height,i=r.height*e,n;i<=r.width?n=r.height:(i=r.width,n=i/e);var a=r.x+r.width/2,s=r.y+r.height/2;return{x:a-i/2,y:s-n/2,width:i,height:n}}var Qs=z_t;function D7(r,t){if(r.applyTransform){var e=r.getBoundingRect(),i=e.calculateTransform(t);r.applyTransform(i)}}function dg(r,t){return YH(r,r,{lineWidth:t}),r}function d0t(r){return KH(r.shape,r.shape,r.style),r}var K1=pf;function Mf(r,t){for(var e=yS([]);r&&r!==t;)lu(e,r.getLocalTransform(),e),r=r.parent;return e}function Fo(r,t,e){return t&&!Sa(t)&&(t=ru.getLocalTransform(t)),e&&(t=Mg([],t)),Qn([],r,t)}function PS(r,t,e){var i=t[4]===0||t[5]===0||t[0]===0?1:Math.abs(2*t[4]/t[0]),n=t[4]===0||t[5]===0||t[2]===0?1:Math.abs(2*t[4]/t[2]),a=[r==="left"?-i:r==="right"?i:0,r==="top"?-n:r==="bottom"?n:0];return a=Fo(a,t,e),Math.abs(a[0])>Math.abs(a[1])?a[0]>0?"right":"left":a[1]>0?"bottom":"top"}function $B(r){return!r.isGroup}function p0t(r){return r.shape!=null}function P_(r,t,e){if(!r||!t)return;function i(s){var o={};return s.traverse(function(l){$B(l)&&l.anid&&(o[l.anid]=l)}),o}function n(s){var o={x:s.x,y:s.y,rotation:s.rotation};return p0t(s)&&(o.shape=Zt({},s.shape)),o}var a=i(r);t.traverse(function(s){if($B(s)&&s.anid){var o=a[s.anid];if(o){var l=n(s);s.attr(n(o)),zr(s,l,e,Je(s).dataIndex)}}})}function L7(r,t){return te(r,function(e){var i=e[0];i=tw(i,t.x),i=ew(i,t.x+t.width);var n=e[1];return n=tw(n,t.y),n=ew(n,t.y+t.height),[i,n]})}function g0t(r,t){var e=tw(r.x,t.x),i=ew(r.x+r.width,t.x+t.width),n=tw(r.y,t.y),a=ew(r.y+r.height,t.y+t.height);if(i>=e&&a>=n)return{x:e,y:n,width:i-e,height:a-n}}function R_(r,t,e){var i=Zt({rectHover:!0},t),n=i.style={strokeNoScale:!0};if(e=e||{x:-1,y:-1,width:2,height:2},r)return r.indexOf("image://")===0?(n.image=r.slice(8),We(n,e),new ia(i)):MS(r.replace("path://",""),i,e,"center")}function Um(r,t,e,i,n){for(var a=0,s=n[n.length-1];a<n.length;a++){var o=n[a];if(k7(r,t,e,i,o[0],o[1],s[0],s[1]))return!0;s=o}}function k7(r,t,e,i,n,a,s,o){var l=e-r,u=i-t,c=s-n,h=o-a,p=k2(c,h,l,u);if(v0t(p))return!1;var v=r-n,y=t-a,x=k2(v,y,l,u)/p;if(x<0||x>1)return!1;var w=k2(v,y,c,h)/p;return!(w<0||w>1)}function k2(r,t,e,i){return r*i-e*t}function v0t(r){return r<=1e-6&&r>=-1e-6}function Lg(r){var t=r.itemTooltipOption,e=r.componentModel,i=r.itemName,n=ve(t)?{formatter:t}:t,a=e.mainType,s=e.componentIndex,o={componentType:a,name:i,$vars:["name"]};o[a+"Index"]=s;var l=r.formatterParamsExtra;l&&J(br(l),function(c){Ae(o,c)||(o[c]=l[c],o.$vars.push(c))});var u=Je(r.el);u.componentMainType=a,u.componentIndex=s,u.tooltipConfig={name:i,option:We({content:i,encodeHTMLContent:!0,formatterParams:o},n)}}function WB(r,t){var e;r.isGroup&&(e=t(r)),e||r.traverse(t)}function Kc(r,t){if(r)if(Kt(r))for(var e=0;e<r.length;e++)WB(r[e],t);else WB(r,t)}Uo("circle",Yc);Uo("ellipse",KR);Uo("sector",fs);Uo("ring",ES);Uo("polygon",ds);Uo("polyline",ps);Uo("rect",Pr);Uo("line",$n);Uo("bezierCurve",IS);Uo("arc",JR);const ed=Object.freeze(Object.defineProperty({__proto__:null,Arc:JR,BezierCurve:IS,BoundingRect:hr,Circle:Yc,CompoundPath:QR,Ellipse:KR,Group:Ke,Image:ia,IncrementalDisplayable:l0t,Line:$n,LinearGradient:M_,OrientedBoundingRect:Qb,Path:vr,Point:lr,Polygon:ds,Polyline:ps,RadialGradient:I7,Rect:Pr,Ring:ES,Sector:fs,Text:Nr,applyTransform:Fo,clipPointsByRect:L7,clipRectByRect:g0t,createIcon:R_,extendPath:f0t,extendShape:c0t,getShapeClass:eD,getTransform:Mf,groupTransition:P_,initProps:Ei,isElementRemoved:Yp,lineLineIntersect:k7,linePolygonIntersect:Um,makeImage:P7,makePath:MS,mergePath:Qs,registerShape:Uo,removeElement:$c,removeElementWithFadeOut:Zy,resizePath:D7,setTooltipConfig:Lg,subPixelOptimize:K1,subPixelOptimizeLine:dg,subPixelOptimizeRect:d0t,transformDirection:PS,traverseElements:Kc,updateProps:zr},Symbol.toStringTag,{value:"Module"}));var RS={};function O7(r,t){for(var e=0;e<qa.length;e++){var i=qa[e],n=t[i],a=r.ensureState(i);a.style=a.style||{},a.style.text=n}var s=r.currentStates.slice();r.clearStates(!0),r.setStyle({text:t.normal}),r.useStates(s,!0)}function cM(r,t,e){var i=r.labelFetcher,n=r.labelDataIndex,a=r.labelDimIndex,s=t.normal,o;i&&(o=i.getFormattedLabel(n,"normal",null,a,s&&s.get("formatter"),e!=null?{interpolatedValue:e}:null)),o==null&&(o=Ve(r.defaultText)?r.defaultText(n,r,e):r.defaultText);for(var l={normal:o},u=0;u<qa.length;u++){var c=qa[u],h=t[c];l[c]=ir(i?i.getFormattedLabel(n,c,null,a,h&&h.get("formatter")):null,o)}return l}function ra(r,t,e,i){e=e||RS;for(var n=r instanceof Nr,a=!1,s=0;s<jy.length;s++){var o=t[jy[s]];if(o&&o.getShallow("show")){a=!0;break}}var l=n?r:r.getTextContent();if(a){n||(l||(l=new Nr,r.setTextContent(l)),r.stateProxy&&(l.stateProxy=r.stateProxy));var u=cM(e,t),c=t.normal,h=!!c.getShallow("show"),p=hi(c,i&&i.normal,e,!1,!n);p.text=u.normal,n||r.setTextConfig(rw(c,e,!1));for(var s=0;s<qa.length;s++){var v=qa[s],o=t[v];if(o){var y=l.ensureState(v),x=!!ir(o.getShallow("show"),h);if(x!==h&&(y.ignore=!x),y.style=hi(o,i&&i[v],e,!0,!n),y.style.text=u[v],!n){var w=r.ensureState(v);w.textConfig=rw(o,e,!0)}}}l.silent=!!c.getShallow("silent"),l.style.x!=null&&(p.x=l.style.x),l.style.y!=null&&(p.y=l.style.y),l.ignore=!h,l.useStyle(p),l.dirty(),e.enableTextSetter&&(kg(l).setLabelText=function(T){var E=cM(e,t,T);O7(l,E)})}else l&&(l.ignore=!0);r.dirty()}function Dn(r,t){t=t||"label";for(var e={normal:r.getModel(t)},i=0;i<qa.length;i++){var n=qa[i];e[n]=r.getModel([n,t])}return e}function hi(r,t,e,i,n){var a={};return m0t(a,r,e,i,n),t&&Zt(a,t),a}function rw(r,t,e){t=t||{};var i={},n,a=r.getShallow("rotate"),s=ir(r.getShallow("distance"),e?null:5),o=r.getShallow("offset");return n=r.getShallow("position")||(e?null:"inside"),n==="outside"&&(n=t.defaultOutsidePosition||"top"),n!=null&&(i.position=n),o!=null&&(i.offset=o),a!=null&&(a*=Math.PI/180,i.rotation=a),s!=null&&(i.distance=s),i.outsideFill=r.get("color")==="inherit"?t.inheritColor||null:"auto",i}function m0t(r,t,e,i,n){e=e||RS;var a=t.ecModel,s=a&&a.option.textStyle,o=y0t(t),l;if(o){l={};for(var u in o)if(o.hasOwnProperty(u)){var c=t.getModel(["rich",u]);XB(l[u]={},c,s,e,i,n,!1,!0)}}l&&(r.rich=l);var h=t.get("overflow");h&&(r.overflow=h);var p=t.get("minMargin");p!=null&&(r.margin=p),XB(r,t,s,e,i,n,!0,!1)}function y0t(r){for(var t;r&&r!==r.ecModel;){var e=(r.option||RS).rich;if(e){t=t||{};for(var i=br(e),n=0;n<i.length;n++){var a=i[n];t[a]=1}}r=r.parentModel}return t}var HB=["fontStyle","fontWeight","fontSize","fontFamily","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY"],GB=["align","lineHeight","width","height","tag","verticalAlign","ellipsis"],jB=["padding","borderWidth","borderRadius","borderDashOffset","backgroundColor","borderColor","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"];function XB(r,t,e,i,n,a,s,o){e=!n&&e||RS;var l=i&&i.inheritColor,u=t.getShallow("color"),c=t.getShallow("textBorderColor"),h=ir(t.getShallow("opacity"),e.opacity);(u==="inherit"||u==="auto")&&(l?u=l:u=null),(c==="inherit"||c==="auto")&&(l?c=l:c=null),a||(u=u||e.color,c=c||e.textBorderColor),u!=null&&(r.fill=u),c!=null&&(r.stroke=c);var p=ir(t.getShallow("textBorderWidth"),e.textBorderWidth);p!=null&&(r.lineWidth=p);var v=ir(t.getShallow("textBorderType"),e.textBorderType);v!=null&&(r.lineDash=v);var y=ir(t.getShallow("textBorderDashOffset"),e.textBorderDashOffset);y!=null&&(r.lineDashOffset=y),!n&&h==null&&!o&&(h=i&&i.defaultOpacity),h!=null&&(r.opacity=h),!n&&!a&&r.fill==null&&i.inheritColor&&(r.fill=i.inheritColor);for(var x=0;x<HB.length;x++){var w=HB[x],T=ir(t.getShallow(w),e[w]);T!=null&&(r[w]=T)}for(var x=0;x<GB.length;x++){var w=GB[x],T=t.getShallow(w);T!=null&&(r[w]=T)}if(r.verticalAlign==null){var E=t.getShallow("baseline");E!=null&&(r.verticalAlign=E)}if(!s||!i.disableBox){for(var x=0;x<jB.length;x++){var w=jB[x],T=t.getShallow(w);T!=null&&(r[w]=T)}var M=t.getShallow("borderType");M!=null&&(r.borderDash=M),(r.backgroundColor==="auto"||r.backgroundColor==="inherit")&&l&&(r.backgroundColor=l),(r.borderColor==="auto"||r.borderColor==="inherit")&&l&&(r.borderColor=l)}}function rD(r,t){var e=t&&t.getModel("textStyle");return ko([r.fontStyle||e&&e.getShallow("fontStyle")||"",r.fontWeight||e&&e.getShallow("fontWeight")||"",(r.fontSize||e&&e.getShallow("fontSize")||12)+"px",r.fontFamily||e&&e.getShallow("fontFamily")||"sans-serif"].join(" "))}var kg=Ir();function N7(r,t,e,i){if(r){var n=kg(r);n.prevValue=n.value,n.value=e;var a=t.normal;n.valueAnimation=a.get("valueAnimation"),n.valueAnimation&&(n.precision=a.get("precision"),n.defaultInterpolatedText=i,n.statesModels=t)}}function F7(r,t,e,i,n){var a=kg(r);if(!a.valueAnimation||a.prevValue===a.value)return;var s=a.defaultInterpolatedText,o=ir(a.interpolatedValue,a.prevValue),l=a.value;function u(c){var h=VH(e,a.precision,o,l,c);a.interpolatedValue=c===1?null:h;var p=cM({labelDataIndex:t,labelFetcher:n,defaultText:s?s(h):h+""},a.statesModels,h);O7(r,p)}r.percent=0,(a.prevValue==null?Ei:zr)(r,{percent:1},i,t,null,u)}var _0t=["textStyle","color"],O2=["fontStyle","fontWeight","fontSize","fontFamily","padding","lineHeight","rich","width","height","overflow"],N2=new Nr,x0t=function(){function r(){}return r.prototype.getTextColor=function(t){var e=this.ecModel;return this.getShallow("color")||(!t&&e?e.get(_0t):null)},r.prototype.getFont=function(){return rD({fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily")},this.ecModel)},r.prototype.getTextRect=function(t){for(var e={text:t,verticalAlign:this.getShallow("verticalAlign")||this.getShallow("baseline")},i=0;i<O2.length;i++)e[O2[i]]=this.getShallow(O2[i]);return N2.useStyle(e),N2.update(),N2.getBoundingRect()},r}();const b0t=x0t;var B7=[["lineWidth","width"],["stroke","color"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","type"],["lineDashOffset","dashOffset"],["lineCap","cap"],["lineJoin","join"],["miterLimit"]],w0t=Hf(B7),S0t=function(){function r(){}return r.prototype.getLineStyle=function(t){return w0t(this,t)},r}(),z7=[["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","borderType"],["lineDashOffset","borderDashOffset"],["lineCap","borderCap"],["lineJoin","borderJoin"],["miterLimit","borderMiterLimit"]],T0t=Hf(z7),A0t=function(){function r(){}return r.prototype.getItemStyle=function(t,e){return T0t(this,t,e)},r}(),rd=function(){function r(t,e,i){this.parentModel=e,this.ecModel=i,this.option=t}return r.prototype.init=function(t,e,i){},r.prototype.mergeOption=function(t,e){cr(this.option,t,!0)},r.prototype.get=function(t,e){return t==null?this.option:this._doGet(this.parsePath(t),!e&&this.parentModel)},r.prototype.getShallow=function(t,e){var i=this.option,n=i==null?i:i[t];if(n==null&&!e){var a=this.parentModel;a&&(n=a.getShallow(t))}return n},r.prototype.getModel=function(t,e){var i=t!=null,n=i?this.parsePath(t):null,a=i?this._doGet(n):this.option;return e=e||this.parentModel&&this.parentModel.getModel(this.resolveParentPath(n)),new r(a,e,this.ecModel)},r.prototype.isEmpty=function(){return this.option==null},r.prototype.restoreData=function(){},r.prototype.clone=function(){var t=this.constructor;return new t(Ze(this.option))},r.prototype.parsePath=function(t){return typeof t=="string"?t.split("."):t},r.prototype.resolveParentPath=function(t){return t},r.prototype.isAnimationEnabled=function(){if(!Or.node&&this.option){if(this.option.animation!=null)return!!this.option.animation;if(this.parentModel)return this.parentModel.isAnimationEnabled()}},r.prototype._doGet=function(t,e){var i=this.option;if(!t)return i;for(var n=0;n<t.length&&!(t[n]&&(i=i&&typeof i=="object"?i[t[n]]:null,i==null));n++);return i==null&&e&&(i=e._doGet(this.resolveParentPath(t),e.parentModel)),i},r}();$R(rd);Tyt(rd);yn(rd,S0t);yn(rd,A0t);yn(rd,Myt);yn(rd,b0t);const fi=rd;var C0t=Math.round(Math.random()*10);function Og(r){return[r||"",C0t++].join("_")}function E0t(r){var t={};r.registerSubTypeDefaulter=function(e,i){var n=vl(e);t[n.main]=i},r.determineSubType=function(e,i){var n=i.type;if(!n){var a=vl(e).main;r.hasSubTypes(e)&&t[a]&&(n=t[a](i))}return n}}function I0t(r,t){r.topologicalTravel=function(a,s,o,l){if(!a.length)return;var u=e(s),c=u.graph,h=u.noEntryList,p={};for(J(a,function(E){p[E]=!0});h.length;){var v=h.pop(),y=c[v],x=!!p[v];x&&(o.call(l,v,y.originalDeps.slice()),delete p[v]),J(y.successor,x?T:w)}J(p,function(){var E="";throw new Error(E)});function w(E){c[E].entryCount--,c[E].entryCount===0&&h.push(E)}function T(E){p[E]=!0,w(E)}};function e(a){var s={},o=[];return J(a,function(l){var u=i(s,l),c=u.originalDeps=t(l),h=n(c,a);u.entryCount=h.length,u.entryCount===0&&o.push(l),J(h,function(p){pr(u.predecessor,p)<0&&u.predecessor.push(p);var v=i(s,p);pr(v.successor,p)<0&&v.successor.push(l)})}),{graph:s,noEntryList:o}}function i(a,s){return a[s]||(a[s]={predecessor:[],successor:[]}),a[s]}function n(a,s){var o=[];return J(a,function(l){pr(s,l)>=0&&o.push(l)}),o}}function Jc(r,t){return cr(cr({},r,!0),t,!0)}const M0t={time:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],monthAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayOfWeekAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},legend:{selector:{all:"All",inverse:"Inv"}},toolbox:{brush:{title:{rect:"Box Select",polygon:"Lasso Select",lineX:"Horizontally Select",lineY:"Vertically Select",keep:"Keep Selections",clear:"Clear Selections"}},dataView:{title:"Data View",lang:["Data View","Close","Refresh"]},dataZoom:{title:{zoom:"Zoom",back:"Zoom Reset"}},magicType:{title:{line:"Switch to Line Chart",bar:"Switch to Bar Chart",stack:"Stack",tiled:"Tile"}},restore:{title:"Restore"},saveAsImage:{title:"Save as Image",lang:["Right Click to Save Image"]}},series:{typeNames:{pie:"Pie chart",bar:"Bar chart",line:"Line chart",scatter:"Scatter plot",effectScatter:"Ripple scatter plot",radar:"Radar chart",tree:"Tree",treemap:"Treemap",boxplot:"Boxplot",candlestick:"Candlestick",k:"K line chart",heatmap:"Heat map",map:"Map",parallel:"Parallel coordinate map",lines:"Line graph",graph:"Relationship graph",sankey:"Sankey diagram",funnel:"Funnel chart",gauge:"Gauge",pictorialBar:"Pictorial bar",themeRiver:"Theme River Map",sunburst:"Sunburst",custom:"Custom chart",chart:"Chart"}},aria:{general:{withTitle:'This is a chart about "{title}"',withoutTitle:"This is a chart"},series:{single:{prefix:"",withName:" with type {seriesType} named {seriesName}.",withoutName:" with type {seriesType}."},multiple:{prefix:". It consists of {seriesCount} series count.",withName:" The {seriesId} series is a {seriesType} representing {seriesName}.",withoutName:" The {seriesId} series is a {seriesType}.",separator:{middle:"",end:""}}},data:{allData:"The data is as follows: ",partialData:"The first {displayCnt} items are: ",withName:"the data for {name} is {value}",withoutName:"{value}",separator:{middle:", ",end:". "}}}},P0t={time:{month:["","","","","","","","","","","",""],monthAbbr:["1","2","3","4","5","6","7","8","9","10","11","12"],dayOfWeek:["","","","","","",""],dayOfWeekAbbr:["","","","","","",""]},legend:{selector:{all:"",inverse:""}},toolbox:{brush:{title:{rect:"",polygon:"",lineX:"",lineY:"",keep:"",clear:""}},dataView:{title:"",lang:["","",""]},dataZoom:{title:{zoom:"",back:""}},magicType:{title:{line:"",bar:"",stack:"",tiled:""}},restore:{title:""},saveAsImage:{title:"",lang:[""]}},series:{typeNames:{pie:"",bar:"",line:"",scatter:"",effectScatter:"",radar:"",tree:"",treemap:"",boxplot:"",candlestick:"K",k:"K",heatmap:"",map:"",parallel:"",lines:"",graph:"",sankey:"",funnel:"",gauge:"",pictorialBar:"",themeRiver:"",sunburst:"",custom:"",chart:""}},aria:{general:{withTitle:"{title}",withoutTitle:""},series:{single:{prefix:"",withName:"{seriesType}{seriesName}",withoutName:"{seriesType}"},multiple:{prefix:"{seriesCount}",withName:"{seriesId}{seriesName}{seriesType}",withoutName:"{seriesId}{seriesType}",separator:{middle:"",end:""}}},data:{allData:"",partialData:"{displayCnt}",withName:"{name}{value}",withoutName:"{value}",separator:{middle:"",end:""}}}};var iw="ZH",iD="EN",Kp=iD,J1={},nD={},V7=Or.domSupported?function(){var r=(document.documentElement.lang||navigator.language||navigator.browserLanguage||Kp).toUpperCase();return r.indexOf(iw)>-1?iw:Kp}():Kp;function U7(r,t){r=r.toUpperCase(),nD[r]=new fi(t),J1[r]=t}function R0t(r){if(ve(r)){var t=J1[r.toUpperCase()]||{};return r===iw||r===iD?Ze(t):cr(Ze(t),Ze(J1[Kp]),!1)}else return cr(Ze(r),Ze(J1[Kp]),!1)}function hM(r){return nD[r]}function D0t(){return nD[Kp]}U7(iD,M0t);U7(iw,P0t);var aD=1e3,sD=aD*60,hy=sD*60,to=hy*24,ZB=to*365,$m={year:"{yyyy}",month:"{MMM}",day:"{d}",hour:"{HH}:{mm}",minute:"{HH}:{mm}",second:"{HH}:{mm}:{ss}",millisecond:"{HH}:{mm}:{ss} {SSS}",none:"{yyyy}-{MM}-{dd} {HH}:{mm}:{ss} {SSS}"},Gx="{yyyy}-{MM}-{dd}",qB={year:"{yyyy}",month:"{yyyy}-{MM}",day:Gx,hour:Gx+" "+$m.hour,minute:Gx+" "+$m.minute,second:Gx+" "+$m.second,millisecond:$m.none},F2=["year","month","day","hour","minute","second","millisecond"],$7=["year","half-year","quarter","month","week","half-week","day","half-day","quarter-day","hour","minute","second","millisecond"];function Ju(r,t){return r+="","0000".substr(0,t-r.length)+r}function Jp(r){switch(r){case"half-year":case"quarter":return"month";case"week":case"half-week":return"day";case"half-day":case"quarter-day":return"hour";default:return r}}function L0t(r){return r===Jp(r)}function k0t(r){switch(r){case"year":case"month":return"day";case"millisecond":return"millisecond";default:return"second"}}function DS(r,t,e,i){var n=Tl(r),a=n[oD(e)](),s=n[Qp(e)]()+1,o=Math.floor((s-1)/3)+1,l=n[LS(e)](),u=n["get"+(e?"UTC":"")+"Day"](),c=n[qy(e)](),h=(c-1)%12+1,p=n[kS(e)](),v=n[OS(e)](),y=n[NS(e)](),x=c>=12?"pm":"am",w=x.toUpperCase(),T=i instanceof fi?i:hM(i||V7)||D0t(),E=T.getModel("time"),M=E.get("month"),L=E.get("monthAbbr"),F=E.get("dayOfWeek"),O=E.get("dayOfWeekAbbr");return(t||"").replace(/{a}/g,x+"").replace(/{A}/g,w+"").replace(/{yyyy}/g,a+"").replace(/{yy}/g,Ju(a%100+"",2)).replace(/{Q}/g,o+"").replace(/{MMMM}/g,M[s-1]).replace(/{MMM}/g,L[s-1]).replace(/{MM}/g,Ju(s,2)).replace(/{M}/g,s+"").replace(/{dd}/g,Ju(l,2)).replace(/{d}/g,l+"").replace(/{eeee}/g,F[u]).replace(/{ee}/g,O[u]).replace(/{e}/g,u+"").replace(/{HH}/g,Ju(c,2)).replace(/{H}/g,c+"").replace(/{hh}/g,Ju(h+"",2)).replace(/{h}/g,h+"").replace(/{mm}/g,Ju(p,2)).replace(/{m}/g,p+"").replace(/{ss}/g,Ju(v,2)).replace(/{s}/g,v+"").replace(/{SSS}/g,Ju(y,3)).replace(/{S}/g,y+"")}function O0t(r,t,e,i,n){var a=null;if(ve(e))a=e;else if(Ve(e))a=e(r.value,t,{level:r.level});else{var s=Zt({},$m);if(r.level>0)for(var o=0;o<F2.length;++o)s[F2[o]]="{primary|"+s[F2[o]]+"}";var l=e?e.inherit===!1?e:We(e,s):s,u=W7(r.value,n);if(l[u])a=l[u];else if(l.inherit){for(var c=$7.indexOf(u),o=c-1;o>=0;--o)if(l[u]){a=l[u];break}a=a||s.none}if(Kt(a)){var h=r.level==null?0:r.level>=0?r.level:a.length+r.level;h=Math.min(h,a.length-1),a=a[h]}}return DS(new Date(r.value),a,n,i)}function W7(r,t){var e=Tl(r),i=e[Qp(t)]()+1,n=e[LS(t)](),a=e[qy(t)](),s=e[kS(t)](),o=e[OS(t)](),l=e[NS(t)](),u=l===0,c=u&&o===0,h=c&&s===0,p=h&&a===0,v=p&&n===1,y=v&&i===1;return y?"year":v?"month":p?"day":h?"hour":c?"minute":u?"second":"millisecond"}function YB(r,t,e){var i=Fr(r)?Tl(r):r;switch(t=t||W7(r,e),t){case"year":return i[oD(e)]();case"half-year":return i[Qp(e)]()>=6?1:0;case"quarter":return Math.floor((i[Qp(e)]()+1)/4);case"month":return i[Qp(e)]();case"day":return i[LS(e)]();case"half-day":return i[qy(e)]()/24;case"hour":return i[qy(e)]();case"minute":return i[kS(e)]();case"second":return i[OS(e)]();case"millisecond":return i[NS(e)]()}}function oD(r){return r?"getUTCFullYear":"getFullYear"}function Qp(r){return r?"getUTCMonth":"getMonth"}function LS(r){return r?"getUTCDate":"getDate"}function qy(r){return r?"getUTCHours":"getHours"}function kS(r){return r?"getUTCMinutes":"getMinutes"}function OS(r){return r?"getUTCSeconds":"getSeconds"}function NS(r){return r?"getUTCMilliseconds":"getMilliseconds"}function N0t(r){return r?"setUTCFullYear":"setFullYear"}function H7(r){return r?"setUTCMonth":"setMonth"}function G7(r){return r?"setUTCDate":"setDate"}function j7(r){return r?"setUTCHours":"setHours"}function X7(r){return r?"setUTCMinutes":"setMinutes"}function Z7(r){return r?"setUTCSeconds":"setSeconds"}function q7(r){return r?"setUTCMilliseconds":"setMilliseconds"}function Y7(r){if(!DH(r))return ve(r)?r:"-";var t=(r+"").split(".");return t[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(t.length>1?"."+t[1]:"")}function K7(r,t){return r=(r||"").toLowerCase().replace(/-(.)/g,function(e,i){return i.toUpperCase()}),t&&r&&(r=r.charAt(0).toUpperCase()+r.slice(1)),r}var Ng=RR;function fM(r,t,e){var i="{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}";function n(c){return c&&ko(c)?c:"-"}function a(c){return!!(c!=null&&!isNaN(c)&&isFinite(c))}var s=t==="time",o=r instanceof Date;if(s||o){var l=s?Tl(r):r;if(isNaN(+l)){if(o)return"-"}else return DS(l,i,e)}if(t==="ordinal")return II(r)?n(r):Fr(r)&&a(r)?r+"":"-";var u=gu(r);return a(u)?Y7(u):II(r)?n(r):typeof r=="boolean"?r+"":"-"}var KB=["a","b","c","d","e","f","g"],B2=function(r,t){return"{"+r+(t??"")+"}"};function J7(r,t,e){Kt(t)||(t=[t]);var i=t.length;if(!i)return"";for(var n=t[0].$vars||[],a=0;a<n.length;a++){var s=KB[a];r=r.replace(B2(s),B2(s,0))}for(var o=0;o<i;o++)for(var l=0;l<n.length;l++){var u=t[o][n[l]];r=r.replace(B2(KB[l],o),e?Ga(u):u)}return r}function F0t(r,t,e){return J(t,function(i,n){r=r.replace("{"+n+"}",e?Ga(i):i)}),r}function B0t(r,t){var e=ve(r)?{color:r,extraCssText:t}:r||{},i=e.color,n=e.type;t=e.extraCssText;var a=e.renderMode||"html";if(!i)return"";if(a==="html")return n==="subItem"?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:'+Ga(i)+";"+(t||"")+'"></span>':'<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:'+Ga(i)+";"+(t||"")+'"></span>';var s=e.markerId||"markerX";return{renderMode:a,content:"{"+s+"|}  ",style:n==="subItem"?{width:4,height:4,borderRadius:2,backgroundColor:i}:{width:10,height:10,borderRadius:5,backgroundColor:i}}}function jf(r,t){return t=t||"transparent",ve(r)?r:je(r)&&r.colorStops&&(r.colorStops[0]||{}).color||t}function nw(r,t){if(t==="_blank"||t==="blank"){var e=window.open();e.opener=null,e.location.href=r}else window.open(r,t)}var Q1=J,Q7=["left","right","top","bottom","width","height"],vf=[["width","left","right"],["height","top","bottom"]];function lD(r,t,e,i,n){var a=0,s=0;i==null&&(i=1/0),n==null&&(n=1/0);var o=0;t.eachChild(function(l,u){var c=l.getBoundingRect(),h=t.childAt(u+1),p=h&&h.getBoundingRect(),v,y;if(r==="horizontal"){var x=c.width+(p?-p.x+c.x:0);v=a+x,v>i||l.newline?(a=0,v=x,s+=o+e,o=c.height):o=Math.max(o,c.height)}else{var w=c.height+(p?-p.y+c.y:0);y=s+w,y>n||l.newline?(a+=o+e,s=0,y=w,o=c.width):o=Math.max(o,c.width)}l.newline||(l.x=a,l.y=s,l.markRedraw(),r==="horizontal"?a=v+e:s=y+e)})}var Pf=lD;nr(lD,"vertical");nr(lD,"horizontal");function z0t(r,t,e){var i=t.width,n=t.height,a=he(r.left,i),s=he(r.top,n),o=he(r.right,i),l=he(r.bottom,n);return(isNaN(a)||isNaN(parseFloat(r.left)))&&(a=0),(isNaN(o)||isNaN(parseFloat(r.right)))&&(o=i),(isNaN(s)||isNaN(parseFloat(r.top)))&&(s=0),(isNaN(l)||isNaN(parseFloat(r.bottom)))&&(l=n),e=Ng(e||0),{width:Math.max(o-a-e[1]-e[3],0),height:Math.max(l-s-e[0]-e[2],0)}}function bn(r,t,e){e=Ng(e||0);var i=t.width,n=t.height,a=he(r.left,i),s=he(r.top,n),o=he(r.right,i),l=he(r.bottom,n),u=he(r.width,i),c=he(r.height,n),h=e[2]+e[0],p=e[1]+e[3],v=r.aspect;switch(isNaN(u)&&(u=i-o-p-a),isNaN(c)&&(c=n-l-h-s),v!=null&&(isNaN(u)&&isNaN(c)&&(v>i/n?u=i*.8:c=n*.8),isNaN(u)&&(u=v*c),isNaN(c)&&(c=u/v)),isNaN(a)&&(a=i-o-u-p),isNaN(s)&&(s=n-l-c-h),r.left||r.right){case"center":a=i/2-u/2-e[3];break;case"right":a=i-u-p;break}switch(r.top||r.bottom){case"middle":case"center":s=n/2-c/2-e[0];break;case"bottom":s=n-c-h;break}a=a||0,s=s||0,isNaN(u)&&(u=i-p-a-(o||0)),isNaN(c)&&(c=n-h-s-(l||0));var y=new hr(a+e[3],s+e[0],u,c);return y.margin=e,y}function FS(r,t,e,i,n,a){var s=!n||!n.hv||n.hv[0],o=!n||!n.hv||n.hv[1],l=n&&n.boundingMode||"all";if(a=a||r,a.x=r.x,a.y=r.y,!s&&!o)return!1;var u;if(l==="raw")u=r.type==="group"?new hr(0,0,+t.width||0,+t.height||0):r.getBoundingRect();else if(u=r.getBoundingRect(),r.needLocalTransform()){var c=r.getLocalTransform();u=u.clone(),u.applyTransform(c)}var h=bn(We({width:u.width,height:u.height},t),e,i),p=s?h.x-u.x:0,v=o?h.y-u.y:0;return l==="raw"?(a.x=p,a.y=v):(a.x+=p,a.y+=v),a===r&&r.markRedraw(),!0}function V0t(r,t){return r[vf[t][0]]!=null||r[vf[t][1]]!=null&&r[vf[t][2]]!=null}function Yy(r){var t=r.layoutMode||r.constructor.layoutMode;return je(t)?t:t?{type:t}:null}function Wc(r,t,e){var i=e&&e.ignoreSize;!Kt(i)&&(i=[i,i]);var n=s(vf[0],0),a=s(vf[1],1);u(vf[0],r,n),u(vf[1],r,a);function s(c,h){var p={},v=0,y={},x=0,w=2;if(Q1(c,function(M){y[M]=r[M]}),Q1(c,function(M){o(t,M)&&(p[M]=y[M]=t[M]),l(p,M)&&v++,l(y,M)&&x++}),i[h])return l(t,c[1])?y[c[2]]=null:l(t,c[2])&&(y[c[1]]=null),y;if(x===w||!v)return y;if(v>=w)return p;for(var T=0;T<c.length;T++){var E=c[T];if(!o(p,E)&&o(r,E)){p[E]=r[E];break}}return p}function o(c,h){return c.hasOwnProperty(h)}function l(c,h){return c[h]!=null&&c[h]!=="auto"}function u(c,h,p){Q1(c,function(v){h[v]=p[v]})}}function Fg(r){return t9({},r)}function t9(r,t){return t&&r&&Q1(Q7,function(e){t.hasOwnProperty(e)&&(r[e]=t[e])}),r}var U0t=Ir(),Bg=function(r){Vt(t,r);function t(e,i,n){var a=r.call(this,e,i,n)||this;return a.uid=Og("ec_cpt_model"),a}return t.prototype.init=function(e,i,n){this.mergeDefaultAndTheme(e,n)},t.prototype.mergeDefaultAndTheme=function(e,i){var n=Yy(this),a=n?Fg(e):{},s=i.getTheme();cr(e,s.get(this.mainType)),cr(e,this.getDefaultOption()),n&&Wc(e,a,n)},t.prototype.mergeOption=function(e,i){cr(this.option,e,!0);var n=Yy(this);n&&Wc(this.option,e,n)},t.prototype.optionUpdated=function(e,i){},t.prototype.getDefaultOption=function(){var e=this.constructor;if(!byt(e))return e.defaultOption;var i=U0t(this);if(!i.defaultOption){for(var n=[],a=e;a;){var s=a.prototype.defaultOption;s&&n.push(s),a=a.superClass}for(var o={},l=n.length-1;l>=0;l--)o=cr(o,n[l],!0);i.defaultOption=o}return i.defaultOption},t.prototype.getReferringComponents=function(e,i){var n=e+"Index",a=e+"Id";return E_(this.ecModel,e,{index:this.get(n,!0),id:this.get(a,!0)},i)},t.prototype.getBoxLayoutParams=function(){var e=this;return{left:e.get("left"),top:e.get("top"),right:e.get("right"),bottom:e.get("bottom"),width:e.get("width"),height:e.get("height")}},t.prototype.getZLevelKey=function(){return""},t.prototype.setZLevel=function(e){this.option.zlevel=e},t.protoInitialize=function(){var e=t.prototype;e.type="component",e.id="",e.name="",e.mainType="",e.subType="",e.componentIndex=0}(),t}(fi);$H(Bg,fi);bS(Bg);E0t(Bg);I0t(Bg,$0t);function $0t(r){var t=[];return J(Bg.getClassesByMainType(r),function(e){t=t.concat(e.dependencies||e.prototype.dependencies||[])}),t=te(t,function(e){return vl(e).main}),r!=="dataset"&&pr(t,"dataset")<=0&&t.unshift("dataset"),t}const kr=Bg;var e9="";typeof navigator<"u"&&(e9=navigator.platform||"");var op="rgba(0, 0, 0, 0.2)";const W0t={darkMode:"auto",colorBy:"series",color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],gradientColor:["#f6efa6","#d88273","#bf444c"],aria:{decal:{decals:[{color:op,dashArrayX:[1,0],dashArrayY:[2,5],symbolSize:1,rotation:Math.PI/6},{color:op,symbol:"circle",dashArrayX:[[8,8],[0,8,8,0]],dashArrayY:[6,0],symbolSize:.8},{color:op,dashArrayX:[1,0],dashArrayY:[4,3],rotation:-Math.PI/4},{color:op,dashArrayX:[[6,6],[0,6,6,0]],dashArrayY:[6,0]},{color:op,dashArrayX:[[1,0],[1,6]],dashArrayY:[1,0,6,0],rotation:Math.PI/4},{color:op,symbol:"triangle",dashArrayX:[[9,9],[0,9,9,0]],dashArrayY:[7,2],symbolSize:.75}]}},textStyle:{fontFamily:e9.match(/^Win/)?"Microsoft YaHei":"sans-serif",fontSize:12,fontStyle:"normal",fontWeight:"normal"},blendMode:null,stateAnimation:{duration:300,easing:"cubicOut"},animation:"auto",animationDuration:1e3,animationDurationUpdate:500,animationEasing:"cubicInOut",animationEasingUpdate:"cubicInOut",animationThreshold:2e3,progressiveThreshold:3e3,progressive:400,hoverLayerThreshold:3e3,useUTC:!1};var r9=Re(["tooltip","label","itemName","itemId","itemGroupId","itemChildGroupId","seriesName"]),oo="original",Ta="arrayRows",lo="objectRows",El="keyedColumns",Lc="typedArray",i9="unknown",xl="column",zg="row",Yn={Must:1,Might:2,Not:3},n9=Ir();function H0t(r){n9(r).datasetMap=Re()}function a9(r,t,e){var i={},n=cD(t);if(!n||!r)return i;var a=[],s=[],o=t.ecModel,l=n9(o).datasetMap,u=n.uid+"_"+e.seriesLayoutBy,c,h;r=r.slice(),J(r,function(x,w){var T=je(x)?x:r[w]={name:x};T.type==="ordinal"&&c==null&&(c=w,h=y(T)),i[T.name]=[]});var p=l.get(u)||l.set(u,{categoryWayDim:h,valueWayDim:0});J(r,function(x,w){var T=x.name,E=y(x);if(c==null){var M=p.valueWayDim;v(i[T],M,E),v(s,M,E),p.valueWayDim+=E}else if(c===w)v(i[T],0,E),v(a,0,E);else{var M=p.categoryWayDim;v(i[T],M,E),v(s,M,E),p.categoryWayDim+=E}});function v(x,w,T){for(var E=0;E<T;E++)x.push(w+E)}function y(x){var w=x.dimsDef;return w?w.length:1}return a.length&&(i.itemName=a),s.length&&(i.seriesName=s),i}function uD(r,t,e){var i={},n=cD(r);if(!n)return i;var a=t.sourceFormat,s=t.dimensionsDefine,o;(a===lo||a===El)&&J(s,function(c,h){(je(c)?c.name:c)==="name"&&(o=h)});var l=function(){for(var c={},h={},p=[],v=0,y=Math.min(5,e);v<y;v++){var x=o9(t.data,a,t.seriesLayoutBy,s,t.startIndex,v);p.push(x);var w=x===Yn.Not;if(w&&c.v==null&&v!==o&&(c.v=v),(c.n==null||c.n===c.v||!w&&p[c.n]===Yn.Not)&&(c.n=v),T(c)&&p[c.n]!==Yn.Not)return c;w||(x===Yn.Might&&h.v==null&&v!==o&&(h.v=v),(h.n==null||h.n===h.v)&&(h.n=v))}function T(E){return E.v!=null&&E.n!=null}return T(c)?c:T(h)?h:null}();if(l){i.value=[l.v];var u=o??l.n;i.itemName=[u],i.seriesName=[u]}return i}function cD(r){var t=r.get("data",!0);if(!t)return E_(r.ecModel,"dataset",{index:r.get("datasetIndex",!0),id:r.get("datasetId",!0)},vn).models[0]}function G0t(r){return!r.get("transform",!0)&&!r.get("fromTransformResult",!0)?[]:E_(r.ecModel,"dataset",{index:r.get("fromDatasetIndex",!0),id:r.get("fromDatasetId",!0)},vn).models}function s9(r,t){return o9(r.data,r.sourceFormat,r.seriesLayoutBy,r.dimensionsDefine,r.startIndex,t)}function o9(r,t,e,i,n,a){var s,o=5;if(hs(r))return Yn.Not;var l,u;if(i){var c=i[a];je(c)?(l=c.name,u=c.type):ve(c)&&(l=c)}if(u!=null)return u==="ordinal"?Yn.Must:Yn.Not;if(t===Ta){var h=r;if(e===zg){for(var p=h[a],v=0;v<(p||[]).length&&v<o;v++)if((s=L(p[n+v]))!=null)return s}else for(var v=0;v<h.length&&v<o;v++){var y=h[n+v];if(y&&(s=L(y[a]))!=null)return s}}else if(t===lo){var x=r;if(!l)return Yn.Not;for(var v=0;v<x.length&&v<o;v++){var w=x[v];if(w&&(s=L(w[l]))!=null)return s}}else if(t===El){var T=r;if(!l)return Yn.Not;var p=T[l];if(!p||hs(p))return Yn.Not;for(var v=0;v<p.length&&v<o;v++)if((s=L(p[v]))!=null)return s}else if(t===oo)for(var E=r,v=0;v<E.length&&v<o;v++){var w=E[v],M=Pg(w);if(!Kt(M))return Yn.Not;if((s=L(M[a]))!=null)return s}function L(F){var O=ve(F);if(F!=null&&Number.isFinite(Number(F))&&F!=="")return O?Yn.Might:Yn.Not;if(O&&F!=="-")return Yn.Must}return Yn.Not}var dM=Re();function j0t(r,t){Za(dM.get(r)==null&&t),dM.set(r,t)}function X0t(r,t,e){var i=dM.get(t);if(!i)return e;var n=i(r);return n?e.concat(n):e}var JB=Ir(),Z0t=Ir(),hD=function(){function r(){}return r.prototype.getColorFromPalette=function(t,e,i){var n=ri(this.get("color",!0)),a=this.get("colorLayer",!0);return l9(this,JB,n,a,t,e,i)},r.prototype.clearColorPalette=function(){Y0t(this,JB)},r}();function pM(r,t,e,i){var n=ri(r.get(["aria","decal","decals"]));return l9(r,Z0t,n,null,t,e,i)}function q0t(r,t){for(var e=r.length,i=0;i<e;i++)if(r[i].length>t)return r[i];return r[e-1]}function l9(r,t,e,i,n,a,s){a=a||r;var o=t(a),l=o.paletteIdx||0,u=o.paletteNameMap=o.paletteNameMap||{};if(u.hasOwnProperty(n))return u[n];var c=s==null||!i?e:q0t(i,s);if(c=c||e,!(!c||!c.length)){var h=c[l];return n&&(u[n]=h),o.paletteIdx=(l+1)%c.length,h}}function Y0t(r,t){t(r).paletteIdx=0,t(r).paletteNameMap={}}var jx,cm,QB,tz="\0_ec_inner",K0t=1,u9=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.init=function(e,i,n,a,s,o){a=a||{},this.option=null,this._theme=new fi(a),this._locale=new fi(s),this._optionManager=o},t.prototype.setOption=function(e,i,n){var a=iz(i);this._optionManager.setOption(e,n,a),this._resetOption(null,a)},t.prototype.resetOption=function(e,i){return this._resetOption(e,iz(i))},t.prototype._resetOption=function(e,i){var n=!1,a=this._optionManager;if(!e||e==="recreate"){var s=a.mountOption(e==="recreate");!this.option||e==="recreate"?QB(this,s):(this.restoreData(),this._mergeOption(s,i)),n=!0}if((e==="timeline"||e==="media")&&this.restoreData(),!e||e==="recreate"||e==="timeline"){var o=a.getTimelineOption(this);o&&(n=!0,this._mergeOption(o,i))}if(!e||e==="recreate"||e==="media"){var l=a.getMediaOption(this);l.length&&J(l,function(u){n=!0,this._mergeOption(u,i)},this)}return n},t.prototype.mergeOption=function(e){this._mergeOption(e,null)},t.prototype._mergeOption=function(e,i){var n=this.option,a=this._componentsMap,s=this._componentsCount,o=[],l=Re(),u=i&&i.replaceMergeMainTypeMap;H0t(this),J(e,function(h,p){h!=null&&(kr.hasClass(p)?p&&(o.push(p),l.set(p,!0)):n[p]=n[p]==null?Ze(h):cr(n[p],h,!0))}),u&&u.each(function(h,p){kr.hasClass(p)&&!l.get(p)&&(o.push(p),l.set(p,!0))}),kr.topologicalTravel(o,kr.getAllClassMainTypes(),c,this);function c(h){var p=X0t(this,h,ri(e[h])),v=a.get(h),y=v?u&&u.get(h)?"replaceMerge":"normalMerge":"replaceAll",x=FH(v,p,y);fyt(x,h,kr),n[h]=null,a.set(h,null),s.set(h,0);var w=[],T=[],E=0,M;J(x,function(L,F){var O=L.existing,U=L.newOption;if(!U)O&&(O.mergeOption({},this),O.optionUpdated({},!1));else{var W=h==="series",H=kr.getClass(h,L.keyInfo.subType,!W);if(!H)return;if(h==="tooltip"){if(M)return;M=!0}if(O&&O.constructor===H)O.name=L.keyInfo.name,O.mergeOption(U,this),O.optionUpdated(U,!1);else{var j=Zt({componentIndex:F},L.keyInfo);O=new H(U,this,this,j),Zt(O,j),L.brandNew&&(O.__requireNewView=!0),O.init(U,this,this),O.optionUpdated(null,!0)}}O?(w.push(O.option),T.push(O),E++):(w.push(void 0),T.push(void 0))},this),n[h]=w,a.set(h,T),s.set(h,E),h==="series"&&jx(this)}this._seriesIndices||jx(this)},t.prototype.getOption=function(){var e=Ze(this.option);return J(e,function(i,n){if(kr.hasClass(n)){for(var a=ri(i),s=a.length,o=!1,l=s-1;l>=0;l--)a[l]&&!Hy(a[l])?o=!0:(a[l]=null,!o&&s--);a.length=s,e[n]=a}}),delete e[tz],e},t.prototype.getTheme=function(){return this._theme},t.prototype.getLocaleModel=function(){return this._locale},t.prototype.setUpdatePayload=function(e){this._payload=e},t.prototype.getUpdatePayload=function(){return this._payload},t.prototype.getComponent=function(e,i){var n=this._componentsMap.get(e);if(n){var a=n[i||0];if(a)return a;if(i==null){for(var s=0;s<n.length;s++)if(n[s])return n[s]}}},t.prototype.queryComponents=function(e){var i=e.mainType;if(!i)return[];var n=e.index,a=e.id,s=e.name,o=this._componentsMap.get(i);if(!o||!o.length)return[];var l;return n!=null?(l=[],J(ri(n),function(u){o[u]&&l.push(o[u])})):a!=null?l=ez("id",a,o):s!=null?l=ez("name",s,o):l=ti(o,function(u){return!!u}),rz(l,e)},t.prototype.findComponents=function(e){var i=e.query,n=e.mainType,a=o(i),s=a?this.queryComponents(a):ti(this._componentsMap.get(n),function(u){return!!u});return l(rz(s,e));function o(u){var c=n+"Index",h=n+"Id",p=n+"Name";return u&&(u[c]!=null||u[h]!=null||u[p]!=null)?{mainType:n,index:u[c],id:u[h],name:u[p]}:null}function l(u){return e.filter?ti(u,e.filter):u}},t.prototype.eachComponent=function(e,i,n){var a=this._componentsMap;if(Ve(e)){var s=i,o=e;a.each(function(h,p){for(var v=0;h&&v<h.length;v++){var y=h[v];y&&o.call(s,p,y,y.componentIndex)}})}else for(var l=ve(e)?a.get(e):je(e)?this.findComponents(e):null,u=0;l&&u<l.length;u++){var c=l[u];c&&i.call(n,c,c.componentIndex)}},t.prototype.getSeriesByName=function(e){var i=xn(e,null);return ti(this._componentsMap.get("series"),function(n){return!!n&&i!=null&&n.name===i})},t.prototype.getSeriesByIndex=function(e){return this._componentsMap.get("series")[e]},t.prototype.getSeriesByType=function(e){return ti(this._componentsMap.get("series"),function(i){return!!i&&i.subType===e})},t.prototype.getSeries=function(){return ti(this._componentsMap.get("series"),function(e){return!!e})},t.prototype.getSeriesCount=function(){return this._componentsCount.get("series")},t.prototype.eachSeries=function(e,i){cm(this),J(this._seriesIndices,function(n){var a=this._componentsMap.get("series")[n];e.call(i,a,n)},this)},t.prototype.eachRawSeries=function(e,i){J(this._componentsMap.get("series"),function(n){n&&e.call(i,n,n.componentIndex)})},t.prototype.eachSeriesByType=function(e,i,n){cm(this),J(this._seriesIndices,function(a){var s=this._componentsMap.get("series")[a];s.subType===e&&i.call(n,s,a)},this)},t.prototype.eachRawSeriesByType=function(e,i,n){return J(this.getSeriesByType(e),i,n)},t.prototype.isSeriesFiltered=function(e){return cm(this),this._seriesIndicesMap.get(e.componentIndex)==null},t.prototype.getCurrentSeriesIndices=function(){return(this._seriesIndices||[]).slice()},t.prototype.filterSeries=function(e,i){cm(this);var n=[];J(this._seriesIndices,function(a){var s=this._componentsMap.get("series")[a];e.call(i,s,a)&&n.push(a)},this),this._seriesIndices=n,this._seriesIndicesMap=Re(n)},t.prototype.restoreData=function(e){jx(this);var i=this._componentsMap,n=[];i.each(function(a,s){kr.hasClass(s)&&n.push(s)}),kr.topologicalTravel(n,kr.getAllClassMainTypes(),function(a){J(i.get(a),function(s){s&&(a!=="series"||!J0t(s,e))&&s.restoreData()})})},t.internalField=function(){jx=function(e){var i=e._seriesIndices=[];J(e._componentsMap.get("series"),function(n){n&&i.push(n.componentIndex)}),e._seriesIndicesMap=Re(i)},cm=function(e){},QB=function(e,i){e.option={},e.option[tz]=K0t,e._componentsMap=Re({series:[]}),e._componentsCount=Re();var n=i.aria;je(n)&&n.enabled==null&&(n.enabled=!0),Q0t(i,e._theme.option),cr(i,W0t,!1),e._mergeOption(i,null)}}(),t}(fi);function J0t(r,t){if(t){var e=t.seriesIndex,i=t.seriesId,n=t.seriesName;return e!=null&&r.componentIndex!==e||i!=null&&r.id!==i||n!=null&&r.name!==n}}function Q0t(r,t){var e=r.color&&!r.colorLayer;J(t,function(i,n){n==="colorLayer"&&e||kr.hasClass(n)||(typeof i=="object"?r[n]=r[n]?cr(r[n],i,!1):Ze(i):r[n]==null&&(r[n]=i))})}function ez(r,t,e){if(Kt(t)){var i=Re();return J(t,function(a){if(a!=null){var s=xn(a,null);s!=null&&i.set(a,!0)}}),ti(e,function(a){return a&&i.get(a[r])})}else{var n=xn(t,null);return ti(e,function(a){return a&&n!=null&&a[r]===n})}}function rz(r,t){return t.hasOwnProperty("subType")?ti(r,function(e){return e&&e.subType===t.subType}):r}function iz(r){var t=Re();return r&&J(ri(r.replaceMerge),function(e){t.set(e,!0)}),{replaceMergeMainTypeMap:t}}yn(u9,hD);const c9=u9;var txt=["getDom","getZr","getWidth","getHeight","getDevicePixelRatio","dispatchAction","isSSR","isDisposed","on","off","getDataURL","getConnectedDataURL","getOption","getId","updateLabelLayout"],ext=function(){function r(t){J(txt,function(e){this[e]=we(t[e],t)},this)}return r}();const h9=ext;var z2={},rxt=function(){function r(){this._coordinateSystems=[]}return r.prototype.create=function(t,e){var i=[];J(z2,function(n,a){var s=n.create(t,e);i=i.concat(s||[])}),this._coordinateSystems=i},r.prototype.update=function(t,e){J(this._coordinateSystems,function(i){i.update&&i.update(t,e)})},r.prototype.getCoordinateSystems=function(){return this._coordinateSystems.slice()},r.register=function(t,e){z2[t]=e},r.get=function(t){return z2[t]},r}();const D_=rxt;var ixt=/^(min|max)?(.+)$/,nxt=function(){function r(t){this._timelineOptions=[],this._mediaList=[],this._currentMediaIndices=[],this._api=t}return r.prototype.setOption=function(t,e,i){t&&(J(ri(t.series),function(s){s&&s.data&&hs(s.data)&&$b(s.data)}),J(ri(t.dataset),function(s){s&&s.source&&hs(s.source)&&$b(s.source)})),t=Ze(t);var n=this._optionBackup,a=axt(t,e,!n);this._newBaseOption=a.baseOption,n?(a.timelineOptions.length&&(n.timelineOptions=a.timelineOptions),a.mediaList.length&&(n.mediaList=a.mediaList),a.mediaDefault&&(n.mediaDefault=a.mediaDefault)):this._optionBackup=a},r.prototype.mountOption=function(t){var e=this._optionBackup;return this._timelineOptions=e.timelineOptions,this._mediaList=e.mediaList,this._mediaDefault=e.mediaDefault,this._currentMediaIndices=[],Ze(t?e.baseOption:this._newBaseOption)},r.prototype.getTimelineOption=function(t){var e,i=this._timelineOptions;if(i.length){var n=t.getComponent("timeline");n&&(e=Ze(i[n.getCurrentIndex()]))}return e},r.prototype.getMediaOption=function(t){var e=this._api.getWidth(),i=this._api.getHeight(),n=this._mediaList,a=this._mediaDefault,s=[],o=[];if(!n.length&&!a)return o;for(var l=0,u=n.length;l<u;l++)sxt(n[l].query,e,i)&&s.push(l);return!s.length&&a&&(s=[-1]),s.length&&!lxt(s,this._currentMediaIndices)&&(o=te(s,function(c){return Ze(c===-1?a.option:n[c].option)})),this._currentMediaIndices=s,o},r}();function axt(r,t,e){var i=[],n,a,s=r.baseOption,o=r.timeline,l=r.options,u=r.media,c=!!r.media,h=!!(l||o||s&&s.timeline);s?(a=s,a.timeline||(a.timeline=o)):((h||c)&&(r.options=r.media=null),a=r),c&&Kt(u)&&J(u,function(v){v&&v.option&&(v.query?i.push(v):n||(n=v))}),p(a),J(l,function(v){return p(v)}),J(i,function(v){return p(v.option)});function p(v){J(t,function(y){y(v,e)})}return{baseOption:a,timelineOptions:l||[],mediaDefault:n,mediaList:i}}function sxt(r,t,e){var i={width:t,height:e,aspectratio:t/e},n=!0;return J(r,function(a,s){var o=s.match(ixt);if(!(!o||!o[1]||!o[2])){var l=o[1],u=o[2].toLowerCase();oxt(i[u],a,l)||(n=!1)}}),n}function oxt(r,t,e){return e==="min"?r>=t:e==="max"?r<=t:r===t}function lxt(r,t){return r.join(",")===t.join(",")}const uxt=nxt;var To=J,Ky=je,nz=["areaStyle","lineStyle","nodeStyle","linkStyle","chordStyle","label","labelLine"];function V2(r){var t=r&&r.itemStyle;if(t)for(var e=0,i=nz.length;e<i;e++){var n=nz[e],a=t.normal,s=t.emphasis;a&&a[n]&&(r[n]=r[n]||{},r[n].normal?cr(r[n].normal,a[n]):r[n].normal=a[n],a[n]=null),s&&s[n]&&(r[n]=r[n]||{},r[n].emphasis?cr(r[n].emphasis,s[n]):r[n].emphasis=s[n],s[n]=null)}}function _a(r,t,e){if(r&&r[t]&&(r[t].normal||r[t].emphasis)){var i=r[t].normal,n=r[t].emphasis;i&&(e?(r[t].normal=r[t].emphasis=null,We(r[t],i)):r[t]=i),n&&(r.emphasis=r.emphasis||{},r.emphasis[t]=n,n.focus&&(r.emphasis.focus=n.focus),n.blurScope&&(r.emphasis.blurScope=n.blurScope))}}function Wm(r){_a(r,"itemStyle"),_a(r,"lineStyle"),_a(r,"areaStyle"),_a(r,"label"),_a(r,"labelLine"),_a(r,"upperLabel"),_a(r,"edgeLabel")}function gn(r,t){var e=Ky(r)&&r[t],i=Ky(e)&&e.textStyle;if(i)for(var n=0,a=cB.length;n<a;n++){var s=cB[n];i.hasOwnProperty(s)&&(e[s]=i[s])}}function js(r){r&&(Wm(r),gn(r,"label"),r.emphasis&&gn(r.emphasis,"label"))}function cxt(r){if(Ky(r)){V2(r),Wm(r),gn(r,"label"),gn(r,"upperLabel"),gn(r,"edgeLabel"),r.emphasis&&(gn(r.emphasis,"label"),gn(r.emphasis,"upperLabel"),gn(r.emphasis,"edgeLabel"));var t=r.markPoint;t&&(V2(t),js(t));var e=r.markLine;e&&(V2(e),js(e));var i=r.markArea;i&&js(i);var n=r.data;if(r.type==="graph"){n=n||r.nodes;var a=r.links||r.edges;if(a&&!hs(a))for(var s=0;s<a.length;s++)js(a[s]);J(r.categories,function(u){Wm(u)})}if(n&&!hs(n))for(var s=0;s<n.length;s++)js(n[s]);if(t=r.markPoint,t&&t.data)for(var o=t.data,s=0;s<o.length;s++)js(o[s]);if(e=r.markLine,e&&e.data)for(var l=e.data,s=0;s<l.length;s++)Kt(l[s])?(js(l[s][0]),js(l[s][1])):js(l[s]);r.type==="gauge"?(gn(r,"axisLabel"),gn(r,"title"),gn(r,"detail")):r.type==="treemap"?(_a(r.breadcrumb,"itemStyle"),J(r.levels,function(u){Wm(u)})):r.type==="tree"&&Wm(r.leaves)}}function ql(r){return Kt(r)?r:r?[r]:[]}function az(r){return(Kt(r)?r[0]:r)||{}}function hxt(r,t){To(ql(r.series),function(i){Ky(i)&&cxt(i)});var e=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","parallelAxis","radar"];t&&e.push("valueAxis","categoryAxis","logAxis","timeAxis"),To(e,function(i){To(ql(r[i]),function(n){n&&(gn(n,"axisLabel"),gn(n.axisPointer,"label"))})}),To(ql(r.parallel),function(i){var n=i&&i.parallelAxisDefault;gn(n,"axisLabel"),gn(n&&n.axisPointer,"label")}),To(ql(r.calendar),function(i){_a(i,"itemStyle"),gn(i,"dayLabel"),gn(i,"monthLabel"),gn(i,"yearLabel")}),To(ql(r.radar),function(i){gn(i,"name"),i.name&&i.axisName==null&&(i.axisName=i.name,delete i.name),i.nameGap!=null&&i.axisNameGap==null&&(i.axisNameGap=i.nameGap,delete i.nameGap)}),To(ql(r.geo),function(i){Ky(i)&&(js(i),To(ql(i.regions),function(n){js(n)}))}),To(ql(r.timeline),function(i){js(i),_a(i,"label"),_a(i,"itemStyle"),_a(i,"controlStyle",!0);var n=i.data;Kt(n)&&J(n,function(a){je(a)&&(_a(a,"label"),_a(a,"itemStyle"))})}),To(ql(r.toolbox),function(i){_a(i,"iconStyle"),To(i.feature,function(n){_a(n,"iconStyle")})}),gn(az(r.axisPointer),"label"),gn(az(r.tooltip).axisPointer,"label")}function fxt(r,t){for(var e=t.split(","),i=r,n=0;n<e.length&&(i=i&&i[e[n]],i!=null);n++);return i}function dxt(r,t,e,i){for(var n=t.split(","),a=r,s,o=0;o<n.length-1;o++)s=n[o],a[s]==null&&(a[s]={}),a=a[s];(i||a[n[o]]==null)&&(a[n[o]]=e)}function sz(r){r&&J(pxt,function(t){t[0]in r&&!(t[1]in r)&&(r[t[1]]=r[t[0]])})}var pxt=[["x","left"],["y","top"],["x2","right"],["y2","bottom"]],gxt=["grid","geo","parallel","legend","toolbox","title","visualMap","dataZoom","timeline"],U2=[["borderRadius","barBorderRadius"],["borderColor","barBorderColor"],["borderWidth","barBorderWidth"]];function hm(r){var t=r&&r.itemStyle;if(t)for(var e=0;e<U2.length;e++){var i=U2[e][1],n=U2[e][0];t[i]!=null&&(t[n]=t[i])}}function oz(r){r&&r.alignTo==="edge"&&r.margin!=null&&r.edgeDistance==null&&(r.edgeDistance=r.margin)}function lz(r){r&&r.downplay&&!r.blur&&(r.blur=r.downplay)}function vxt(r){r&&r.focusNodeAdjacency!=null&&(r.emphasis=r.emphasis||{},r.emphasis.focus==null&&(r.emphasis.focus="adjacency"))}function f9(r,t){if(r)for(var e=0;e<r.length;e++)t(r[e]),r[e]&&f9(r[e].children,t)}function d9(r,t){hxt(r,t),r.series=ri(r.series),J(r.series,function(e){if(je(e)){var i=e.type;if(i==="line")e.clipOverflow!=null&&(e.clip=e.clipOverflow);else if(i==="pie"||i==="gauge"){e.clockWise!=null&&(e.clockwise=e.clockWise),oz(e.label);var n=e.data;if(n&&!hs(n))for(var a=0;a<n.length;a++)oz(n[a]);e.hoverOffset!=null&&(e.emphasis=e.emphasis||{},(e.emphasis.scaleSize=null)&&(e.emphasis.scaleSize=e.hoverOffset))}else if(i==="gauge"){var s=fxt(e,"pointer.color");s!=null&&dxt(e,"itemStyle.color",s)}else if(i==="bar"){hm(e),hm(e.backgroundStyle),hm(e.emphasis);var n=e.data;if(n&&!hs(n))for(var a=0;a<n.length;a++)typeof n[a]=="object"&&(hm(n[a]),hm(n[a]&&n[a].emphasis))}else if(i==="sunburst"){var o=e.highlightPolicy;o&&(e.emphasis=e.emphasis||{},e.emphasis.focus||(e.emphasis.focus=o)),lz(e),f9(e.data,lz)}else i==="graph"||i==="sankey"?vxt(e):i==="map"&&(e.mapType&&!e.map&&(e.map=e.mapType),e.mapLocation&&We(e,e.mapLocation));e.hoverAnimation!=null&&(e.emphasis=e.emphasis||{},e.emphasis&&e.emphasis.scale==null&&(e.emphasis.scale=e.hoverAnimation)),sz(e)}}),r.dataRange&&(r.visualMap=r.dataRange),J(gxt,function(e){var i=r[e];i&&(Kt(i)||(i=[i]),J(i,function(n){sz(n)}))})}function mxt(r){var t=Re();r.eachSeries(function(e){var i=e.get("stack");if(i){var n=t.get(i)||t.set(i,[]),a=e.getData(),s={stackResultDimension:a.getCalculationInfo("stackResultDimension"),stackedOverDimension:a.getCalculationInfo("stackedOverDimension"),stackedDimension:a.getCalculationInfo("stackedDimension"),stackedByDimension:a.getCalculationInfo("stackedByDimension"),isStackedByIndex:a.getCalculationInfo("isStackedByIndex"),data:a,seriesModel:e};if(!s.stackedDimension||!(s.isStackedByIndex||s.stackedByDimension))return;n.length&&a.setCalculationInfo("stackedOnSeries",n[n.length-1].seriesModel),n.push(s)}}),t.each(yxt)}function yxt(r){J(r,function(t,e){var i=[],n=[NaN,NaN],a=[t.stackResultDimension,t.stackedOverDimension],s=t.data,o=t.isStackedByIndex,l=t.seriesModel.get("stackStrategy")||"samesign";s.modify(a,function(u,c,h){var p=s.get(t.stackedDimension,h);if(isNaN(p))return n;var v,y;o?y=s.getRawIndex(h):v=s.get(t.stackedByDimension,h);for(var x=NaN,w=e-1;w>=0;w--){var T=r[w];if(o||(y=T.data.rawIndexOf(T.stackedByDimension,v)),y>=0){var E=T.data.getByRawIndex(T.stackResultDimension,y);if(l==="all"||l==="positive"&&E>0||l==="negative"&&E<0||l==="samesign"&&p>=0&&E>0||l==="samesign"&&p<=0&&E<0){p=eyt(p,E),x=E;break}}}return i[0]=p,i[1]=x,i})})}var BS=function(){function r(t){this.data=t.data||(t.sourceFormat===El?{}:[]),this.sourceFormat=t.sourceFormat||i9,this.seriesLayoutBy=t.seriesLayoutBy||xl,this.startIndex=t.startIndex||0,this.dimensionsDetectedCount=t.dimensionsDetectedCount,this.metaRawOption=t.metaRawOption;var e=this.dimensionsDefine=t.dimensionsDefine;if(e)for(var i=0;i<e.length;i++){var n=e[i];n.type==null&&s9(this,i)===Yn.Must&&(n.type="ordinal")}}return r}();function fD(r){return r instanceof BS}function gM(r,t,e){e=e||p9(r);var i=t.seriesLayoutBy,n=xxt(r,e,i,t.sourceHeader,t.dimensions),a=new BS({data:r,sourceFormat:e,seriesLayoutBy:i,dimensionsDefine:n.dimensionsDefine,startIndex:n.startIndex,dimensionsDetectedCount:n.dimensionsDetectedCount,metaRawOption:Ze(t)});return a}function dD(r){return new BS({data:r,sourceFormat:hs(r)?Lc:oo})}function _xt(r){return new BS({data:r.data,sourceFormat:r.sourceFormat,seriesLayoutBy:r.seriesLayoutBy,dimensionsDefine:Ze(r.dimensionsDefine),startIndex:r.startIndex,dimensionsDetectedCount:r.dimensionsDetectedCount})}function p9(r){var t=i9;if(hs(r))t=Lc;else if(Kt(r)){r.length===0&&(t=Ta);for(var e=0,i=r.length;e<i;e++){var n=r[e];if(n!=null){if(Kt(n)||hs(n)){t=Ta;break}else if(je(n)){t=lo;break}}}}else if(je(r)){for(var a in r)if(Ae(r,a)&&Sa(r[a])){t=El;break}}return t}function xxt(r,t,e,i,n){var a,s;if(!r)return{dimensionsDefine:uz(n),startIndex:s,dimensionsDetectedCount:a};if(t===Ta){var o=r;i==="auto"||i==null?cz(function(u){u!=null&&u!=="-"&&(ve(u)?s==null&&(s=1):s=0)},e,o,10):s=Fr(i)?i:i?1:0,!n&&s===1&&(n=[],cz(function(u,c){n[c]=u!=null?u+"":""},e,o,1/0)),a=n?n.length:e===zg?o.length:o[0]?o[0].length:null}else if(t===lo)n||(n=bxt(r));else if(t===El)n||(n=[],J(r,function(u,c){n.push(c)}));else if(t===oo){var l=Pg(r[0]);a=Kt(l)&&l.length||1}return{startIndex:s,dimensionsDefine:uz(n),dimensionsDetectedCount:a}}function bxt(r){for(var t=0,e;t<r.length&&!(e=r[t++]););if(e)return br(e)}function uz(r){if(r){var t=Re();return te(r,function(e,i){e=je(e)?e:{name:e};var n={name:e.name,displayName:e.displayName,type:e.type};if(n.name==null)return n;n.name+="",n.displayName==null&&(n.displayName=n.name);var a=t.get(n.name);return a?n.name+="-"+a.count++:t.set(n.name,{count:1}),n})}}function cz(r,t,e,i){if(t===zg)for(var n=0;n<e.length&&n<i;n++)r(e[n]?e[n][0]:null,n);else for(var a=e[0]||[],n=0;n<a.length&&n<i;n++)r(a[n],n)}function g9(r){var t=r.sourceFormat;return t===lo||t===El}var Vh,Uh,$h,hz,fz,v9=function(){function r(t,e){var i=fD(t)?t:dD(t);this._source=i;var n=this._data=i.data;i.sourceFormat===Lc&&(this._offset=0,this._dimSize=e,this._data=n),fz(this,n,i)}return r.prototype.getSource=function(){return this._source},r.prototype.count=function(){return 0},r.prototype.getItem=function(t,e){},r.prototype.appendData=function(t){},r.prototype.clean=function(){},r.protoInitialize=function(){var t=r.prototype;t.pure=!1,t.persistent=!0}(),r.internalField=function(){var t;fz=function(s,o,l){var u=l.sourceFormat,c=l.seriesLayoutBy,h=l.startIndex,p=l.dimensionsDefine,v=hz[pD(u,c)];if(Zt(s,v),u===Lc)s.getItem=e,s.count=n,s.fillStorage=i;else{var y=m9(u,c);s.getItem=we(y,null,o,h,p);var x=y9(u,c);s.count=we(x,null,o,h,p)}};var e=function(s,o){s=s-this._offset,o=o||[];for(var l=this._data,u=this._dimSize,c=u*s,h=0;h<u;h++)o[h]=l[c+h];return o},i=function(s,o,l,u){for(var c=this._data,h=this._dimSize,p=0;p<h;p++){for(var v=u[p],y=v[0]==null?1/0:v[0],x=v[1]==null?-1/0:v[1],w=o-s,T=l[p],E=0;E<w;E++){var M=c[E*h+p];T[s+E]=M,M<y&&(y=M),M>x&&(x=M)}v[0]=y,v[1]=x}},n=function(){return this._data?this._data.length/this._dimSize:0};hz=(t={},t[Ta+"_"+xl]={pure:!0,appendData:a},t[Ta+"_"+zg]={pure:!0,appendData:function(){throw new Error('Do not support appendData when set seriesLayoutBy: "row".')}},t[lo]={pure:!0,appendData:a},t[El]={pure:!0,appendData:function(s){var o=this._data;J(s,function(l,u){for(var c=o[u]||(o[u]=[]),h=0;h<(l||[]).length;h++)c.push(l[h])})}},t[oo]={appendData:a},t[Lc]={persistent:!1,pure:!0,appendData:function(s){this._data=s},clean:function(){this._offset+=this.count(),this._data=null}},t);function a(s){for(var o=0;o<s.length;o++)this._data.push(s[o])}}(),r}(),dz=function(r,t,e,i){return r[i]},wxt=(Vh={},Vh[Ta+"_"+xl]=function(r,t,e,i){return r[i+t]},Vh[Ta+"_"+zg]=function(r,t,e,i,n){i+=t;for(var a=n||[],s=r,o=0;o<s.length;o++){var l=s[o];a[o]=l?l[i]:null}return a},Vh[lo]=dz,Vh[El]=function(r,t,e,i,n){for(var a=n||[],s=0;s<e.length;s++){var o=e[s].name,l=r[o];a[s]=l?l[i]:null}return a},Vh[oo]=dz,Vh);function m9(r,t){var e=wxt[pD(r,t)];return e}var pz=function(r,t,e){return r.length},Sxt=(Uh={},Uh[Ta+"_"+xl]=function(r,t,e){return Math.max(0,r.length-t)},Uh[Ta+"_"+zg]=function(r,t,e){var i=r[0];return i?Math.max(0,i.length-t):0},Uh[lo]=pz,Uh[El]=function(r,t,e){var i=e[0].name,n=r[i];return n?n.length:0},Uh[oo]=pz,Uh);function y9(r,t){var e=Sxt[pD(r,t)];return e}var $2=function(r,t,e){return r[t]},Txt=($h={},$h[Ta]=$2,$h[lo]=function(r,t,e){return r[e]},$h[El]=$2,$h[oo]=function(r,t,e){var i=Pg(r);return i instanceof Array?i[t]:i},$h[Lc]=$2,$h);function _9(r){var t=Txt[r];return t}function pD(r,t){return r===Ta?r+"_"+t:r}function pg(r,t,e){if(r){var i=r.getRawDataItem(t);if(i!=null){var n=r.getStore(),a=n.getSource().sourceFormat;if(e!=null){var s=r.getDimensionIndex(e),o=n.getDimensionProperty(s);return _9(a)(i,s,o)}else{var l=i;return a===oo&&(l=Pg(i)),l}}}}var Axt=/\{@(.+?)\}/g,zS=function(){function r(){}return r.prototype.getDataParams=function(t,e){var i=this.getData(e),n=this.getRawValue(t,e),a=i.getRawIndex(t),s=i.getName(t),o=i.getRawDataItem(t),l=i.getItemVisual(t,"style"),u=l&&l[i.getItemVisual(t,"drawType")||"fill"],c=l&&l.stroke,h=this.mainType,p=h==="series",v=i.userOutput&&i.userOutput.get();return{componentType:h,componentSubType:this.subType,componentIndex:this.componentIndex,seriesType:p?this.subType:null,seriesIndex:this.seriesIndex,seriesId:p?this.id:null,seriesName:p?this.name:null,name:s,dataIndex:a,data:o,dataType:e,value:n,color:u,borderColor:c,dimensionNames:v?v.fullDimensions:null,encode:v?v.encode:null,$vars:["seriesName","name","value"]}},r.prototype.getFormattedLabel=function(t,e,i,n,a,s){e=e||"normal";var o=this.getData(i),l=this.getDataParams(t,i);if(s&&(l.value=s.interpolatedValue),n!=null&&Kt(l.value)&&(l.value=l.value[n]),!a){var u=o.getItemModel(t);a=u.get(e==="normal"?["label","formatter"]:[e,"label","formatter"])}if(Ve(a))return l.status=e,l.dimensionIndex=n,a(l);if(ve(a)){var c=J7(a,l);return c.replace(Axt,function(h,p){var v=p.length,y=p;y.charAt(0)==="["&&y.charAt(v-1)==="]"&&(y=+y.slice(1,v-1));var x=pg(o,t,y);if(s&&Kt(s.interpolatedValue)){var w=o.getDimensionIndex(y);w>=0&&(x=s.interpolatedValue[w])}return x!=null?x+"":""})}},r.prototype.getRawValue=function(t,e){return pg(this.getData(e),t)},r.prototype.formatTooltip=function(t,e,i){},r}();function gz(r){var t,e;return je(r)?r.type&&(e=r):t=r,{text:t,frag:e}}function fy(r){return new Cxt(r)}var Cxt=function(){function r(t){t=t||{},this._reset=t.reset,this._plan=t.plan,this._count=t.count,this._onDirty=t.onDirty,this._dirty=!0}return r.prototype.perform=function(t){var e=this._upstream,i=t&&t.skip;if(this._dirty&&e){var n=this.context;n.data=n.outputData=e.context.outputData}this.__pipeline&&(this.__pipeline.currentTask=this);var a;this._plan&&!i&&(a=this._plan(this.context));var s=c(this._modBy),o=this._modDataCount||0,l=c(t&&t.modBy),u=t&&t.modDataCount||0;(s!==l||o!==u)&&(a="reset");function c(E){return!(E>=1)&&(E=1),E}var h;(this._dirty||a==="reset")&&(this._dirty=!1,h=this._doReset(i)),this._modBy=l,this._modDataCount=u;var p=t&&t.step;if(e?this._dueEnd=e._outputDueEnd:this._dueEnd=this._count?this._count(this.context):1/0,this._progress){var v=this._dueIndex,y=Math.min(p!=null?this._dueIndex+p:1/0,this._dueEnd);if(!i&&(h||v<y)){var x=this._progress;if(Kt(x))for(var w=0;w<x.length;w++)this._doProgress(x[w],v,y,l,u);else this._doProgress(x,v,y,l,u)}this._dueIndex=y;var T=this._settedOutputEnd!=null?this._settedOutputEnd:y;this._outputDueEnd=T}else this._dueIndex=this._outputDueEnd=this._settedOutputEnd!=null?this._settedOutputEnd:this._dueEnd;return this.unfinished()},r.prototype.dirty=function(){this._dirty=!0,this._onDirty&&this._onDirty(this.context)},r.prototype._doProgress=function(t,e,i,n,a){vz.reset(e,i,n,a),this._callingProgress=t,this._callingProgress({start:e,end:i,count:i-e,next:vz.next},this.context)},r.prototype._doReset=function(t){this._dueIndex=this._outputDueEnd=this._dueEnd=0,this._settedOutputEnd=null;var e,i;!t&&this._reset&&(e=this._reset(this.context),e&&e.progress&&(i=e.forceFirstProgress,e=e.progress),Kt(e)&&!e.length&&(e=null)),this._progress=e,this._modBy=this._modDataCount=null;var n=this._downstream;return n&&n.dirty(),i},r.prototype.unfinished=function(){return this._progress&&this._dueIndex<this._dueEnd},r.prototype.pipe=function(t){(this._downstream!==t||this._dirty)&&(this._downstream=t,t._upstream=this,t.dirty())},r.prototype.dispose=function(){this._disposed||(this._upstream&&(this._upstream._downstream=null),this._downstream&&(this._downstream._upstream=null),this._dirty=!1,this._disposed=!0)},r.prototype.getUpstream=function(){return this._upstream},r.prototype.getDownstream=function(){return this._downstream},r.prototype.setOutputEnd=function(t){this._outputDueEnd=this._settedOutputEnd=t},r}(),vz=function(){var r,t,e,i,n,a={reset:function(l,u,c,h){t=l,r=u,e=c,i=h,n=Math.ceil(i/e),a.next=e>1&&i>0?o:s}};return a;function s(){return t<r?t++:null}function o(){var l=t%n*e+Math.ceil(t/n),u=t>=r?null:l<i?l:t;return t++,u}}();function kc(r,t){var e=t&&t.type;return e==="ordinal"?r:(e==="time"&&!Fr(r)&&r!=null&&r!=="-"&&(r=+Tl(r)),r==null||r===""?NaN:Number(r))}var Ext=Re({number:function(r){return parseFloat(r)},time:function(r){return+Tl(r)},trim:function(r){return ve(r)?ko(r):r}});function x9(r){return Ext.get(r)}var b9={lt:function(r,t){return r<t},lte:function(r,t){return r<=t},gt:function(r,t){return r>t},gte:function(r,t){return r>=t}},Ixt=function(){function r(t,e){if(!Fr(e)){var i="";jr(i)}this._opFn=b9[t],this._rvalFloat=gu(e)}return r.prototype.evaluate=function(t){return Fr(t)?this._opFn(t,this._rvalFloat):this._opFn(gu(t),this._rvalFloat)},r}(),w9=function(){function r(t,e){var i=t==="desc";this._resultLT=i?1:-1,e==null&&(e=i?"min":"max"),this._incomparable=e==="min"?-1/0:1/0}return r.prototype.evaluate=function(t,e){var i=Fr(t)?t:gu(t),n=Fr(e)?e:gu(e),a=isNaN(i),s=isNaN(n);if(a&&(i=this._incomparable),s&&(n=this._incomparable),a&&s){var o=ve(t),l=ve(e);o&&(i=l?t:0),l&&(n=o?e:0)}return i<n?this._resultLT:i>n?-this._resultLT:0},r}(),Mxt=function(){function r(t,e){this._rval=e,this._isEQ=t,this._rvalTypeof=typeof e,this._rvalFloat=gu(e)}return r.prototype.evaluate=function(t){var e=t===this._rval;if(!e){var i=typeof t;i!==this._rvalTypeof&&(i==="number"||this._rvalTypeof==="number")&&(e=gu(t)===this._rvalFloat)}return this._isEQ?e:!e},r}();function Pxt(r,t){return r==="eq"||r==="ne"?new Mxt(r==="eq",t):Ae(b9,r)?new Ixt(r,t):null}var Rxt=function(){function r(){}return r.prototype.getRawData=function(){throw new Error("not supported")},r.prototype.getRawDataItem=function(t){throw new Error("not supported")},r.prototype.cloneRawData=function(){},r.prototype.getDimensionInfo=function(t){},r.prototype.cloneAllDimensionInfo=function(){},r.prototype.count=function(){},r.prototype.retrieveValue=function(t,e){},r.prototype.retrieveValueFromItem=function(t,e){},r.prototype.convertValue=function(t,e){return kc(t,e)},r}();function Dxt(r,t){var e=new Rxt,i=r.data,n=e.sourceFormat=r.sourceFormat,a=r.startIndex,s="";r.seriesLayoutBy!==xl&&jr(s);var o=[],l={},u=r.dimensionsDefine;if(u)J(u,function(x,w){var T=x.name,E={index:w,name:T,displayName:x.displayName};if(o.push(E),T!=null){var M="";Ae(l,T)&&jr(M),l[T]=E}});else for(var c=0;c<r.dimensionsDetectedCount;c++)o.push({index:c});var h=m9(n,xl);t.__isBuiltIn&&(e.getRawDataItem=function(x){return h(i,a,o,x)},e.getRawData=we(Lxt,null,r)),e.cloneRawData=we(kxt,null,r);var p=y9(n,xl);e.count=we(p,null,i,a,o);var v=_9(n);e.retrieveValue=function(x,w){var T=h(i,a,o,x);return y(T,w)};var y=e.retrieveValueFromItem=function(x,w){if(x!=null){var T=o[w];if(T)return v(x,w,T.name)}};return e.getDimensionInfo=we(Oxt,null,o,l),e.cloneAllDimensionInfo=we(Nxt,null,o),e}function Lxt(r){var t=r.sourceFormat;if(!gD(t)){var e="";jr(e)}return r.data}function kxt(r){var t=r.sourceFormat,e=r.data;if(!gD(t)){var i="";jr(i)}if(t===Ta){for(var n=[],a=0,s=e.length;a<s;a++)n.push(e[a].slice());return n}else if(t===lo){for(var n=[],a=0,s=e.length;a<s;a++)n.push(Zt({},e[a]));return n}}function Oxt(r,t,e){if(e!=null){if(Fr(e)||!isNaN(e)&&!Ae(t,e))return r[e];if(Ae(t,e))return t[e]}}function Nxt(r){return Ze(r)}var S9=Re();function Fxt(r){r=Ze(r);var t=r.type,e="";t||jr(e);var i=t.split(":");i.length!==2&&jr(e);var n=!1;i[0]==="echarts"&&(t=i[1],n=!0),r.__isBuiltIn=n,S9.set(t,r)}function Bxt(r,t,e){var i=ri(r),n=i.length,a="";n||jr(a);for(var s=0,o=n;s<o;s++){var l=i[s];t=zxt(l,t),s!==o-1&&(t.length=Math.max(t.length,1))}return t}function zxt(r,t,e,i){var n="";t.length||jr(n),je(r)||jr(n);var a=r.type,s=S9.get(a);s||jr(n);var o=te(t,function(u){return Dxt(u,s)}),l=ri(s.transform({upstream:o[0],upstreamList:o,config:Ze(r.config)}));return te(l,function(u,c){var h="";je(u)||jr(h),u.data||jr(h);var p=p9(u.data);gD(p)||jr(h);var v,y=t[0];if(y&&c===0&&!u.dimensions){var x=y.startIndex;x&&(u.data=y.data.slice(0,x).concat(u.data)),v={seriesLayoutBy:xl,sourceHeader:x,dimensions:y.metaRawOption.dimensions}}else v={seriesLayoutBy:xl,sourceHeader:0,dimensions:u.dimensions};return gM(u.data,v,null)})}function gD(r){return r===Ta||r===lo}var VS="undefined",Vxt=typeof Uint32Array===VS?Array:Uint32Array,Uxt=typeof Uint16Array===VS?Array:Uint16Array,T9=typeof Int32Array===VS?Array:Int32Array,mz=typeof Float64Array===VS?Array:Float64Array,A9={float:mz,int:T9,ordinal:Array,number:Array,time:mz},W2;function fm(r){return r>65535?Vxt:Uxt}function lp(){return[1/0,-1/0]}function $xt(r){var t=r.constructor;return t===Array?r.slice():new t(r)}function yz(r,t,e,i,n){var a=A9[e||"float"];if(n){var s=r[t],o=s&&s.length;if(o!==i){for(var l=new a(i),u=0;u<o;u++)l[u]=s[u];r[t]=l}}else r[t]=new a(i)}var vM=function(){function r(){this._chunks=[],this._rawExtent=[],this._extent=[],this._count=0,this._rawCount=0,this._calcDimNameToIdx=Re()}return r.prototype.initData=function(t,e,i){this._provider=t,this._chunks=[],this._indices=null,this.getRawIndex=this._getRawIdxIdentity;var n=t.getSource(),a=this.defaultDimValueGetter=W2[n.sourceFormat];this._dimValueGetter=i||a,this._rawExtent=[],g9(n),this._dimensions=te(e,function(s){return{type:s.type,property:s.property}}),this._initDataFromProvider(0,t.count())},r.prototype.getProvider=function(){return this._provider},r.prototype.getSource=function(){return this._provider.getSource()},r.prototype.ensureCalculationDimension=function(t,e){var i=this._calcDimNameToIdx,n=this._dimensions,a=i.get(t);if(a!=null){if(n[a].type===e)return a}else a=n.length;return n[a]={type:e},i.set(t,a),this._chunks[a]=new A9[e||"float"](this._rawCount),this._rawExtent[a]=lp(),a},r.prototype.collectOrdinalMeta=function(t,e){var i=this._chunks[t],n=this._dimensions[t],a=this._rawExtent,s=n.ordinalOffset||0,o=i.length;s===0&&(a[t]=lp());for(var l=a[t],u=s;u<o;u++){var c=i[u]=e.parseAndCollect(i[u]);isNaN(c)||(l[0]=Math.min(c,l[0]),l[1]=Math.max(c,l[1]))}n.ordinalMeta=e,n.ordinalOffset=o,n.type="ordinal"},r.prototype.getOrdinalMeta=function(t){var e=this._dimensions[t],i=e.ordinalMeta;return i},r.prototype.getDimensionProperty=function(t){var e=this._dimensions[t];return e&&e.property},r.prototype.appendData=function(t){var e=this._provider,i=this.count();e.appendData(t);var n=e.count();return e.persistent||(n+=i),i<n&&this._initDataFromProvider(i,n,!0),[i,n]},r.prototype.appendValues=function(t,e){for(var i=this._chunks,n=this._dimensions,a=n.length,s=this._rawExtent,o=this.count(),l=o+Math.max(t.length,e||0),u=0;u<a;u++){var c=n[u];yz(i,u,c.type,l,!0)}for(var h=[],p=o;p<l;p++)for(var v=p-o,y=0;y<a;y++){var c=n[y],x=W2.arrayRows.call(this,t[v]||h,c.property,v,y);i[y][p]=x;var w=s[y];x<w[0]&&(w[0]=x),x>w[1]&&(w[1]=x)}return this._rawCount=this._count=l,{start:o,end:l}},r.prototype._initDataFromProvider=function(t,e,i){for(var n=this._provider,a=this._chunks,s=this._dimensions,o=s.length,l=this._rawExtent,u=te(s,function(E){return E.property}),c=0;c<o;c++){var h=s[c];l[c]||(l[c]=lp()),yz(a,c,h.type,e,i)}if(n.fillStorage)n.fillStorage(t,e,a,l);else for(var p=[],v=t;v<e;v++){p=n.getItem(v,p);for(var y=0;y<o;y++){var x=a[y],w=this._dimValueGetter(p,u[y],v,y);x[v]=w;var T=l[y];w<T[0]&&(T[0]=w),w>T[1]&&(T[1]=w)}}!n.persistent&&n.clean&&n.clean(),this._rawCount=this._count=e,this._extent=[]},r.prototype.count=function(){return this._count},r.prototype.get=function(t,e){if(!(e>=0&&e<this._count))return NaN;var i=this._chunks[t];return i?i[this.getRawIndex(e)]:NaN},r.prototype.getValues=function(t,e){var i=[],n=[];if(e==null){e=t,t=[];for(var a=0;a<this._dimensions.length;a++)n.push(a)}else n=t;for(var a=0,s=n.length;a<s;a++)i.push(this.get(n[a],e));return i},r.prototype.getByRawIndex=function(t,e){if(!(e>=0&&e<this._rawCount))return NaN;var i=this._chunks[t];return i?i[e]:NaN},r.prototype.getSum=function(t){var e=this._chunks[t],i=0;if(e)for(var n=0,a=this.count();n<a;n++){var s=this.get(t,n);isNaN(s)||(i+=s)}return i},r.prototype.getMedian=function(t){var e=[];this.each([t],function(a){isNaN(a)||e.push(a)});var i=e.sort(function(a,s){return a-s}),n=this.count();return n===0?0:n%2===1?i[(n-1)/2]:(i[n/2]+i[n/2-1])/2},r.prototype.indexOfRawIndex=function(t){if(t>=this._rawCount||t<0)return-1;if(!this._indices)return t;var e=this._indices,i=e[t];if(i!=null&&i<this._count&&i===t)return t;for(var n=0,a=this._count-1;n<=a;){var s=(n+a)/2|0;if(e[s]<t)n=s+1;else if(e[s]>t)a=s-1;else return s}return-1},r.prototype.indicesOfNearest=function(t,e,i){var n=this._chunks,a=n[t],s=[];if(!a)return s;i==null&&(i=1/0);for(var o=1/0,l=-1,u=0,c=0,h=this.count();c<h;c++){var p=this.getRawIndex(c),v=e-a[p],y=Math.abs(v);y<=i&&((y<o||y===o&&v>=0&&l<0)&&(o=y,l=v,u=0),v===l&&(s[u++]=c))}return s.length=u,s},r.prototype.getIndices=function(){var t,e=this._indices;if(e){var i=e.constructor,n=this._count;if(i===Array){t=new i(n);for(var a=0;a<n;a++)t[a]=e[a]}else t=new i(e.buffer,0,n)}else{var i=fm(this._rawCount);t=new i(this.count());for(var a=0;a<t.length;a++)t[a]=a}return t},r.prototype.filter=function(t,e){if(!this._count)return this;for(var i=this.clone(),n=i.count(),a=fm(i._rawCount),s=new a(n),o=[],l=t.length,u=0,c=t[0],h=i._chunks,p=0;p<n;p++){var v=void 0,y=i.getRawIndex(p);if(l===0)v=e(p);else if(l===1){var x=h[c][y];v=e(x,p)}else{for(var w=0;w<l;w++)o[w]=h[t[w]][y];o[w]=p,v=e.apply(null,o)}v&&(s[u++]=y)}return u<n&&(i._indices=s),i._count=u,i._extent=[],i._updateGetRawIdx(),i},r.prototype.selectRange=function(t){var e=this.clone(),i=e._count;if(!i)return this;var n=br(t),a=n.length;if(!a)return this;var s=e.count(),o=fm(e._rawCount),l=new o(s),u=0,c=n[0],h=t[c][0],p=t[c][1],v=e._chunks,y=!1;if(!e._indices){var x=0;if(a===1){for(var w=v[n[0]],T=0;T<i;T++){var E=w[T];(E>=h&&E<=p||isNaN(E))&&(l[u++]=x),x++}y=!0}else if(a===2){for(var w=v[n[0]],M=v[n[1]],L=t[n[1]][0],F=t[n[1]][1],T=0;T<i;T++){var E=w[T],O=M[T];(E>=h&&E<=p||isNaN(E))&&(O>=L&&O<=F||isNaN(O))&&(l[u++]=x),x++}y=!0}}if(!y)if(a===1)for(var T=0;T<s;T++){var U=e.getRawIndex(T),E=v[n[0]][U];(E>=h&&E<=p||isNaN(E))&&(l[u++]=U)}else for(var T=0;T<s;T++){for(var W=!0,U=e.getRawIndex(T),H=0;H<a;H++){var j=n[H],E=v[j][U];(E<t[j][0]||E>t[j][1])&&(W=!1)}W&&(l[u++]=e.getRawIndex(T))}return u<s&&(e._indices=l),e._count=u,e._extent=[],e._updateGetRawIdx(),e},r.prototype.map=function(t,e){var i=this.clone(t);return this._updateDims(i,t,e),i},r.prototype.modify=function(t,e){this._updateDims(this,t,e)},r.prototype._updateDims=function(t,e,i){for(var n=t._chunks,a=[],s=e.length,o=t.count(),l=[],u=t._rawExtent,c=0;c<e.length;c++)u[e[c]]=lp();for(var h=0;h<o;h++){for(var p=t.getRawIndex(h),v=0;v<s;v++)l[v]=n[e[v]][p];l[s]=h;var y=i&&i.apply(null,l);if(y!=null){typeof y!="object"&&(a[0]=y,y=a);for(var c=0;c<y.length;c++){var x=e[c],w=y[c],T=u[x],E=n[x];E&&(E[p]=w),w<T[0]&&(T[0]=w),w>T[1]&&(T[1]=w)}}}},r.prototype.lttbDownSample=function(t,e){var i=this.clone([t],!0),n=i._chunks,a=n[t],s=this.count(),o=0,l=Math.floor(1/e),u=this.getRawIndex(0),c,h,p,v=new(fm(this._rawCount))(Math.min((Math.ceil(s/l)+2)*2,s));v[o++]=u;for(var y=1;y<s-1;y+=l){for(var x=Math.min(y+l,s-1),w=Math.min(y+l*2,s),T=(w+x)/2,E=0,M=x;M<w;M++){var L=this.getRawIndex(M),F=a[L];isNaN(F)||(E+=F)}E/=w-x;var O=y,U=Math.min(y+l,s),W=y-1,H=a[u];c=-1,p=O;for(var j=-1,Y=0,M=O;M<U;M++){var L=this.getRawIndex(M),F=a[L];if(isNaN(F)){Y++,j<0&&(j=L);continue}h=Math.abs((W-T)*(F-H)-(W-M)*(E-H)),h>c&&(c=h,p=L)}Y>0&&Y<U-O&&(v[o++]=Math.min(j,p),p=Math.max(j,p)),v[o++]=p,u=p}return v[o++]=this.getRawIndex(s-1),i._count=o,i._indices=v,i.getRawIndex=this._getRawIdx,i},r.prototype.downSample=function(t,e,i,n){for(var a=this.clone([t],!0),s=a._chunks,o=[],l=Math.floor(1/e),u=s[t],c=this.count(),h=a._rawExtent[t]=lp(),p=new(fm(this._rawCount))(Math.ceil(c/l)),v=0,y=0;y<c;y+=l){l>c-y&&(l=c-y,o.length=l);for(var x=0;x<l;x++){var w=this.getRawIndex(y+x);o[x]=u[w]}var T=i(o),E=this.getRawIndex(Math.min(y+n(o,T)||0,c-1));u[E]=T,T<h[0]&&(h[0]=T),T>h[1]&&(h[1]=T),p[v++]=E}return a._count=v,a._indices=p,a._updateGetRawIdx(),a},r.prototype.each=function(t,e){if(this._count)for(var i=t.length,n=this._chunks,a=0,s=this.count();a<s;a++){var o=this.getRawIndex(a);switch(i){case 0:e(a);break;case 1:e(n[t[0]][o],a);break;case 2:e(n[t[0]][o],n[t[1]][o],a);break;default:for(var l=0,u=[];l<i;l++)u[l]=n[t[l]][o];u[l]=a,e.apply(null,u)}}},r.prototype.getDataExtent=function(t){var e=this._chunks[t],i=lp();if(!e)return i;var n=this.count(),a=!this._indices,s;if(a)return this._rawExtent[t].slice();if(s=this._extent[t],s)return s.slice();s=i;for(var o=s[0],l=s[1],u=0;u<n;u++){var c=this.getRawIndex(u),h=e[c];h<o&&(o=h),h>l&&(l=h)}return s=[o,l],this._extent[t]=s,s},r.prototype.getRawDataItem=function(t){var e=this.getRawIndex(t);if(this._provider.persistent)return this._provider.getItem(e);for(var i=[],n=this._chunks,a=0;a<n.length;a++)i.push(n[a][e]);return i},r.prototype.clone=function(t,e){var i=new r,n=this._chunks,a=t&&bl(t,function(o,l){return o[l]=!0,o},{});if(a)for(var s=0;s<n.length;s++)i._chunks[s]=a[s]?$xt(n[s]):n[s];else i._chunks=n;return this._copyCommonProps(i),e||(i._indices=this._cloneIndices()),i._updateGetRawIdx(),i},r.prototype._copyCommonProps=function(t){t._count=this._count,t._rawCount=this._rawCount,t._provider=this._provider,t._dimensions=this._dimensions,t._extent=Ze(this._extent),t._rawExtent=Ze(this._rawExtent)},r.prototype._cloneIndices=function(){if(this._indices){var t=this._indices.constructor,e=void 0;if(t===Array){var i=this._indices.length;e=new t(i);for(var n=0;n<i;n++)e[n]=this._indices[n]}else e=new t(this._indices);return e}return null},r.prototype._getRawIdxIdentity=function(t){return t},r.prototype._getRawIdx=function(t){return t<this._count&&t>=0?this._indices[t]:-1},r.prototype._updateGetRawIdx=function(){this.getRawIndex=this._indices?this._getRawIdx:this._getRawIdxIdentity},r.internalField=function(){function t(e,i,n,a){return kc(e[a],this._dimensions[a])}W2={arrayRows:t,objectRows:function(e,i,n,a){return kc(e[i],this._dimensions[a])},keyedColumns:t,original:function(e,i,n,a){var s=e&&(e.value==null?e:e.value);return kc(s instanceof Array?s[a]:s,this._dimensions[a])},typedArray:function(e,i,n,a){return e[a]}}}(),r}(),C9=function(){function r(t){this._sourceList=[],this._storeList=[],this._upstreamSignList=[],this._versionSignBase=0,this._dirty=!0,this._sourceHost=t}return r.prototype.dirty=function(){this._setLocalSource([],[]),this._storeList=[],this._dirty=!0},r.prototype._setLocalSource=function(t,e){this._sourceList=t,this._upstreamSignList=e,this._versionSignBase++,this._versionSignBase>9e10&&(this._versionSignBase=0)},r.prototype._getVersionSign=function(){return this._sourceHost.uid+"_"+this._versionSignBase},r.prototype.prepareSource=function(){this._isDirty()&&(this._createSource(),this._dirty=!1)},r.prototype._createSource=function(){this._setLocalSource([],[]);var t=this._sourceHost,e=this._getUpstreamSourceManagers(),i=!!e.length,n,a;if(Xx(t)){var s=t,o=void 0,l=void 0,u=void 0;if(i){var c=e[0];c.prepareSource(),u=c.getSource(),o=u.data,l=u.sourceFormat,a=[c._getVersionSign()]}else o=s.get("data",!0),l=hs(o)?Lc:oo,a=[];var h=this._getSourceMetaRawOption()||{},p=u&&u.metaRawOption||{},v=ir(h.seriesLayoutBy,p.seriesLayoutBy)||null,y=ir(h.sourceHeader,p.sourceHeader),x=ir(h.dimensions,p.dimensions),w=v!==p.seriesLayoutBy||!!y!=!!p.sourceHeader||x;n=w?[gM(o,{seriesLayoutBy:v,sourceHeader:y,dimensions:x},l)]:[]}else{var T=t;if(i){var E=this._applyTransform(e);n=E.sourceList,a=E.upstreamSignList}else{var M=T.get("source",!0);n=[gM(M,this._getSourceMetaRawOption(),null)],a=[]}}this._setLocalSource(n,a)},r.prototype._applyTransform=function(t){var e=this._sourceHost,i=e.get("transform",!0),n=e.get("fromTransformResult",!0);if(n!=null){var a="";t.length!==1&&xz(a)}var s,o=[],l=[];return J(t,function(u){u.prepareSource();var c=u.getSource(n||0),h="";n!=null&&!c&&xz(h),o.push(c),l.push(u._getVersionSign())}),i?s=Bxt(i,o,{datasetIndex:e.componentIndex}):n!=null&&(s=[_xt(o[0])]),{sourceList:s,upstreamSignList:l}},r.prototype._isDirty=function(){if(this._dirty)return!0;for(var t=this._getUpstreamSourceManagers(),e=0;e<t.length;e++){var i=t[e];if(i._isDirty()||this._upstreamSignList[e]!==i._getVersionSign())return!0}},r.prototype.getSource=function(t){t=t||0;var e=this._sourceList[t];if(!e){var i=this._getUpstreamSourceManagers();return i[0]&&i[0].getSource(t)}return e},r.prototype.getSharedDataStore=function(t){var e=t.makeStoreSchema();return this._innerGetDataStore(e.dimensions,t.source,e.hash)},r.prototype._innerGetDataStore=function(t,e,i){var n=0,a=this._storeList,s=a[n];s||(s=a[n]={});var o=s[i];if(!o){var l=this._getUpstreamSourceManagers()[0];Xx(this._sourceHost)&&l?o=l._innerGetDataStore(t,e,i):(o=new vM,o.initData(new v9(e,t.length),t)),s[i]=o}return o},r.prototype._getUpstreamSourceManagers=function(){var t=this._sourceHost;if(Xx(t)){var e=cD(t);return e?[e.getSourceManager()]:[]}else return te(G0t(t),function(i){return i.getSourceManager()})},r.prototype._getSourceMetaRawOption=function(){var t=this._sourceHost,e,i,n;if(Xx(t))e=t.get("seriesLayoutBy",!0),i=t.get("sourceHeader",!0),n=t.get("dimensions",!0);else if(!this._getUpstreamSourceManagers().length){var a=t;e=a.get("seriesLayoutBy",!0),i=a.get("sourceHeader",!0),n=a.get("dimensions",!0)}return{seriesLayoutBy:e,sourceHeader:i,dimensions:n}},r}();function _z(r){var t=r.option.transform;t&&$b(r.option.transform)}function Xx(r){return r.mainType==="series"}function xz(r){throw new Error(r)}var E9="line-height:1";function I9(r,t){var e=r.color||"#6e7079",i=r.fontSize||12,n=r.fontWeight||"400",a=r.color||"#464646",s=r.fontSize||14,o=r.fontWeight||"900";return t==="html"?{nameStyle:"font-size:"+Ga(i+"")+"px;color:"+Ga(e)+";font-weight:"+Ga(n+""),valueStyle:"font-size:"+Ga(s+"")+"px;color:"+Ga(a)+";font-weight:"+Ga(o+"")}:{nameStyle:{fontSize:i,fill:e,fontWeight:n},valueStyle:{fontSize:s,fill:a,fontWeight:o}}}var Wxt=[0,10,20,30],Hxt=["",`
`,`

`,`


`];function Ln(r,t){return t.type=r,t}function mM(r){return r.type==="section"}function M9(r){return mM(r)?Gxt:jxt}function P9(r){if(mM(r)){var t=0,e=r.blocks.length,i=e>1||e>0&&!r.noHeader;return J(r.blocks,function(n){var a=P9(n);a>=t&&(t=a+ +(i&&(!a||mM(n)&&!n.noHeader)))}),t}return 0}function Gxt(r,t,e,i){var n=t.noHeader,a=Xxt(P9(t)),s=[],o=t.blocks||[];Za(!o||Kt(o)),o=o||[];var l=r.orderMode;if(t.sortBlocks&&l){o=o.slice();var u={valueAsc:"asc",valueDesc:"desc"};if(Ae(u,l)){var c=new w9(u[l],null);o.sort(function(y,x){return c.evaluate(y.sortParam,x.sortParam)})}else l==="seriesDesc"&&o.reverse()}J(o,function(y,x){var w=t.valueFormatter,T=M9(y)(w?Zt(Zt({},r),{valueFormatter:w}):r,y,x>0?a.html:0,i);T!=null&&s.push(T)});var h=r.renderMode==="richText"?s.join(a.richText):yM(s.join(""),n?e:a.html);if(n)return h;var p=fM(t.header,"ordinal",r.useUTC),v=I9(i,r.renderMode).nameStyle;return r.renderMode==="richText"?R9(r,p,v)+a.richText+h:yM('<div style="'+v+";"+E9+';">'+Ga(p)+"</div>"+h,e)}function jxt(r,t,e,i){var n=r.renderMode,a=t.noName,s=t.noValue,o=!t.markerType,l=t.name,u=r.useUTC,c=t.valueFormatter||r.valueFormatter||function(L){return L=Kt(L)?L:[L],te(L,function(F,O){return fM(F,Kt(v)?v[O]:v,u)})};if(!(a&&s)){var h=o?"":r.markupStyleCreator.makeTooltipMarker(t.markerType,t.markerColor||"#333",n),p=a?"":fM(l,"ordinal",u),v=t.valueType,y=s?[]:c(t.value,t.dataIndex),x=!o||!a,w=!o&&a,T=I9(i,n),E=T.nameStyle,M=T.valueStyle;return n==="richText"?(o?"":h)+(a?"":R9(r,p,E))+(s?"":Yxt(r,y,x,w,M)):yM((o?"":h)+(a?"":Zxt(p,!o,E))+(s?"":qxt(y,x,w,M)),e)}}function bz(r,t,e,i,n,a){if(r){var s=M9(r),o={useUTC:n,renderMode:e,orderMode:i,markupStyleCreator:t,valueFormatter:r.valueFormatter};return s(o,r,0,a)}}function Xxt(r){return{html:Wxt[r],richText:Hxt[r]}}function yM(r,t){var e='<div style="clear:both"></div>',i="margin: "+t+"px 0 0";return'<div style="'+i+";"+E9+';">'+r+e+"</div>"}function Zxt(r,t,e){var i=t?"margin-left:2px":"";return'<span style="'+e+";"+i+'">'+Ga(r)+"</span>"}function qxt(r,t,e,i){var n=e?"10px":"20px",a=t?"float:right;margin-left:"+n:"";return r=Kt(r)?r:[r],'<span style="'+a+";"+i+'">'+te(r,function(s){return Ga(s)}).join("&nbsp;&nbsp;")+"</span>"}function R9(r,t,e){return r.markupStyleCreator.wrapRichTextStyle(t,e)}function Yxt(r,t,e,i,n){var a=[n],s=i?10:20;return e&&a.push({padding:[0,0,0,s],align:"right"}),r.markupStyleCreator.wrapRichTextStyle(Kt(t)?t.join("  "):t,a)}function D9(r,t){var e=r.getData().getItemVisual(t,"style"),i=e[r.visualDrawType];return jf(i)}function L9(r,t){var e=r.get("padding");return e??(t==="richText"?[8,10]:10)}var H2=function(){function r(){this.richTextStyles={},this._nextStyleNameId=LH()}return r.prototype._generateStyleName=function(){return"__EC_aUTo_"+this._nextStyleNameId++},r.prototype.makeTooltipMarker=function(t,e,i){var n=i==="richText"?this._generateStyleName():null,a=B0t({color:e,type:t,renderMode:i,markerId:n});return ve(a)?a:(this.richTextStyles[n]=a.style,a.content)},r.prototype.wrapRichTextStyle=function(t,e){var i={};Kt(e)?J(e,function(a){return Zt(i,a)}):Zt(i,e);var n=this._generateStyleName();return this.richTextStyles[n]=i,"{"+n+"|"+t+"}"},r}();function k9(r){var t=r.series,e=r.dataIndex,i=r.multipleSeries,n=t.getData(),a=n.mapDimensionsAll("defaultedTooltip"),s=a.length,o=t.getRawValue(e),l=Kt(o),u=D9(t,e),c,h,p,v;if(s>1||l&&!s){var y=Kxt(o,t,e,a,u);c=y.inlineValues,h=y.inlineValueTypes,p=y.blocks,v=y.inlineValues[0]}else if(s){var x=n.getDimensionInfo(a[0]);v=c=pg(n,e,a[0]),h=x.type}else v=c=l?o[0]:o;var w=VR(t),T=w&&t.name||"",E=n.getName(e),M=i?T:E;return Ln("section",{header:T,noHeader:i||!w,sortParam:v,blocks:[Ln("nameValue",{markerType:"item",markerColor:u,name:M,noName:!ko(M),value:c,valueType:h,dataIndex:e})].concat(p||[])})}function Kxt(r,t,e,i,n){var a=t.getData(),s=bl(r,function(h,p,v){var y=a.getDimensionInfo(v);return h=h||y&&y.tooltip!==!1&&y.displayName!=null},!1),o=[],l=[],u=[];i.length?J(i,function(h){c(pg(a,e,h),h)}):J(r,c);function c(h,p){var v=a.getDimensionInfo(p);!v||v.otherDims.tooltip===!1||(s?u.push(Ln("nameValue",{markerType:"subItem",markerColor:n,name:v.displayName,value:h,valueType:v.type})):(o.push(h),l.push(v.type)))}return{inlineValues:o,inlineValueTypes:l,blocks:u}}var Qu=Ir();function Zx(r,t){return r.getName(t)||r.getId(t)}var tb="__universalTransitionEnabled",US=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e._selectedDataIndicesMap={},e}return t.prototype.init=function(e,i,n){this.seriesIndex=this.componentIndex,this.dataTask=fy({count:Qxt,reset:t1t}),this.dataTask.context={model:this},this.mergeDefaultAndTheme(e,n);var a=Qu(this).sourceManager=new C9(this);a.prepareSource();var s=this.getInitialData(e,n);Sz(s,this),this.dataTask.context.data=s,Qu(this).dataBeforeProcessed=s,wz(this),this._initSelectedMapFromData(s)},t.prototype.mergeDefaultAndTheme=function(e,i){var n=Yy(this),a=n?Fg(e):{},s=this.subType;kr.hasClass(s)&&(s+="Series"),cr(e,i.getTheme().get(this.subType)),cr(e,this.getDefaultOption()),$f(e,"label",["show"]),this.fillDataTextStyle(e.data),n&&Wc(e,a,n)},t.prototype.mergeOption=function(e,i){e=cr(this.option,e,!0),this.fillDataTextStyle(e.data);var n=Yy(this);n&&Wc(this.option,e,n);var a=Qu(this).sourceManager;a.dirty(),a.prepareSource();var s=this.getInitialData(e,i);Sz(s,this),this.dataTask.dirty(),this.dataTask.context.data=s,Qu(this).dataBeforeProcessed=s,wz(this),this._initSelectedMapFromData(s)},t.prototype.fillDataTextStyle=function(e){if(e&&!hs(e))for(var i=["show"],n=0;n<e.length;n++)e[n]&&e[n].label&&$f(e[n],"label",i)},t.prototype.getInitialData=function(e,i){},t.prototype.appendData=function(e){var i=this.getRawData();i.appendData(e.data)},t.prototype.getData=function(e){var i=_M(this);if(i){var n=i.context.data;return e==null||!n.getLinkedData?n:n.getLinkedData(e)}else return Qu(this).data},t.prototype.getAllData=function(){var e=this.getData();return e&&e.getLinkedDataAll?e.getLinkedDataAll():[{data:e}]},t.prototype.setData=function(e){var i=_M(this);if(i){var n=i.context;n.outputData=e,i!==this.dataTask&&(n.data=e)}Qu(this).data=e},t.prototype.getEncode=function(){var e=this.get("encode",!0);if(e)return Re(e)},t.prototype.getSourceManager=function(){return Qu(this).sourceManager},t.prototype.getSource=function(){return this.getSourceManager().getSource()},t.prototype.getRawData=function(){return Qu(this).dataBeforeProcessed},t.prototype.getColorBy=function(){var e=this.get("colorBy");return e||"series"},t.prototype.isColorBySeries=function(){return this.getColorBy()==="series"},t.prototype.getBaseAxis=function(){var e=this.coordinateSystem;return e&&e.getBaseAxis&&e.getBaseAxis()},t.prototype.formatTooltip=function(e,i,n){return k9({series:this,dataIndex:e,multipleSeries:i})},t.prototype.isAnimationEnabled=function(){var e=this.ecModel;if(Or.node&&!(e&&e.ssr))return!1;var i=this.getShallow("animation");return i&&this.getData().count()>this.getShallow("animationThreshold")&&(i=!1),!!i},t.prototype.restoreData=function(){this.dataTask.dirty()},t.prototype.getColorFromPalette=function(e,i,n){var a=this.ecModel,s=hD.prototype.getColorFromPalette.call(this,e,i,n);return s||(s=a.getColorFromPalette(e,i,n)),s},t.prototype.coordDimToDataDim=function(e){return this.getRawData().mapDimensionsAll(e)},t.prototype.getProgressive=function(){return this.get("progressive")},t.prototype.getProgressiveThreshold=function(){return this.get("progressiveThreshold")},t.prototype.select=function(e,i){this._innerSelect(this.getData(i),e)},t.prototype.unselect=function(e,i){var n=this.option.selectedMap;if(n){var a=this.option.selectedMode,s=this.getData(i);if(a==="series"||n==="all"){this.option.selectedMap={},this._selectedDataIndicesMap={};return}for(var o=0;o<e.length;o++){var l=e[o],u=Zx(s,l);n[u]=!1,this._selectedDataIndicesMap[u]=-1}}},t.prototype.toggleSelect=function(e,i){for(var n=[],a=0;a<e.length;a++)n[0]=e[a],this.isSelected(e[a],i)?this.unselect(n,i):this.select(n,i)},t.prototype.getSelectedDataIndices=function(){if(this.option.selectedMap==="all")return[].slice.call(this.getData().getIndices());for(var e=this._selectedDataIndicesMap,i=br(e),n=[],a=0;a<i.length;a++){var s=e[i[a]];s>=0&&n.push(s)}return n},t.prototype.isSelected=function(e,i){var n=this.option.selectedMap;if(!n)return!1;var a=this.getData(i);return(n==="all"||n[Zx(a,e)])&&!a.getItemModel(e).get(["select","disabled"])},t.prototype.isUniversalTransitionEnabled=function(){if(this[tb])return!0;var e=this.option.universalTransition;return e?e===!0?!0:e&&e.enabled:!1},t.prototype._innerSelect=function(e,i){var n,a,s=this.option,o=s.selectedMode,l=i.length;if(!(!o||!l)){if(o==="series")s.selectedMap="all";else if(o==="multiple"){je(s.selectedMap)||(s.selectedMap={});for(var u=s.selectedMap,c=0;c<l;c++){var h=i[c],p=Zx(e,h);u[p]=!0,this._selectedDataIndicesMap[p]=e.getRawIndex(h)}}else if(o==="single"||o===!0){var v=i[l-1],p=Zx(e,v);s.selectedMap=(n={},n[p]=!0,n),this._selectedDataIndicesMap=(a={},a[p]=e.getRawIndex(v),a)}}},t.prototype._initSelectedMapFromData=function(e){if(!this.option.selectedMap){var i=[];e.hasItemOption&&e.each(function(n){var a=e.getRawDataItem(n);a&&a.selected&&i.push(n)}),i.length>0&&this._innerSelect(e,i)}},t.registerClass=function(e){return kr.registerClass(e)},t.protoInitialize=function(){var e=t.prototype;e.type="series.__base__",e.seriesIndex=0,e.ignoreStyleOnData=!1,e.hasSymbolVisual=!1,e.defaultSymbol="circle",e.visualStyleAccessPath="itemStyle",e.visualDrawType="fill"}(),t}(kr);yn(US,zS);yn(US,hD);$H(US,kr);function wz(r){var t=r.name;VR(r)||(r.name=Jxt(r)||t)}function Jxt(r){var t=r.getRawData(),e=t.mapDimensionsAll("seriesName"),i=[];return J(e,function(n){var a=t.getDimensionInfo(n);a.displayName&&i.push(a.displayName)}),i.join(" ")}function Qxt(r){return r.model.getRawData().count()}function t1t(r){var t=r.model;return t.setData(t.getRawData().cloneShallow()),e1t}function e1t(r,t){t.outputData&&r.end>t.outputData.count()&&t.model.getRawData().cloneShallow(t.outputData)}function Sz(r,t){J(Wb(r.CHANGABLE_METHODS,r.DOWNSAMPLE_METHODS),function(e){r.wrapMethod(e,nr(r1t,t))})}function r1t(r,t){var e=_M(r);return e&&e.setOutputEnd((t||this).count()),t}function _M(r){var t=(r.ecModel||{}).scheduler,e=t&&t.getPipeline(r.uid);if(e){var i=e.currentTask;if(i){var n=i.agentStubMap;n&&(i=n.get(r.uid))}return i}}const Li=US;var vD=function(){function r(){this.group=new Ke,this.uid=Og("viewComponent")}return r.prototype.init=function(t,e){},r.prototype.render=function(t,e,i,n){},r.prototype.dispose=function(t,e){},r.prototype.updateView=function(t,e,i,n){},r.prototype.updateLayout=function(t,e,i,n){},r.prototype.updateVisual=function(t,e,i,n){},r.prototype.toggleBlurSeries=function(t,e,i){},r.prototype.eachRendered=function(t){var e=this.group;e&&e.traverse(t)},r}();$R(vD);bS(vD);const $i=vD;function Vg(){var r=Ir();return function(t){var e=r(t),i=t.pipelineContext,n=!!e.large,a=!!e.progressiveRender,s=e.large=!!(i&&i.large),o=e.progressiveRender=!!(i&&i.progressiveRender);return(n!==s||a!==o)&&"reset"}}var O9=Ir(),i1t=Vg(),mD=function(){function r(){this.group=new Ke,this.uid=Og("viewChart"),this.renderTask=fy({plan:n1t,reset:a1t}),this.renderTask.context={view:this}}return r.prototype.init=function(t,e){},r.prototype.render=function(t,e,i,n){},r.prototype.highlight=function(t,e,i,n){var a=t.getData(n&&n.dataType);a&&Az(a,n,"emphasis")},r.prototype.downplay=function(t,e,i,n){var a=t.getData(n&&n.dataType);a&&Az(a,n,"normal")},r.prototype.remove=function(t,e){this.group.removeAll()},r.prototype.dispose=function(t,e){},r.prototype.updateView=function(t,e,i,n){this.render(t,e,i,n)},r.prototype.updateLayout=function(t,e,i,n){this.render(t,e,i,n)},r.prototype.updateVisual=function(t,e,i,n){this.render(t,e,i,n)},r.prototype.eachRendered=function(t){Kc(this.group,t)},r.markUpdateMethod=function(t,e){O9(t).updateMethod=e},r.protoInitialize=function(){var t=r.prototype;t.type="chart"}(),r}();function Tz(r,t,e){r&&Xy(r)&&(t==="emphasis"?vu:mu)(r,e)}function Az(r,t,e){var i=Wf(r,t),n=t&&t.highlightKey!=null?R_t(t.highlightKey):null;i!=null?J(ri(i),function(a){Tz(r.getItemGraphicEl(a),e,n)}):r.eachItemGraphicEl(function(a){Tz(a,e,n)})}$R(mD);bS(mD);function n1t(r){return i1t(r.model)}function a1t(r){var t=r.model,e=r.ecModel,i=r.api,n=r.payload,a=t.pipelineContext.progressiveRender,s=r.view,o=n&&O9(n).updateMethod,l=a?"incrementalPrepareRender":o&&s[o]?o:"render";return l!=="render"&&s[l](t,e,i,n),s1t[l]}var s1t={incrementalPrepareRender:{progress:function(r,t){t.view.incrementalRender(r,t.model,t.ecModel,t.api,t.payload)}},render:{forceFirstProgress:!0,progress:function(r,t){t.view.render(t.model,t.ecModel,t.api,t.payload)}}};const di=mD;var aw="\0__throttleOriginMethod",Cz="\0__throttleRate",Ez="\0__throttleType";function yD(r,t,e){var i,n=0,a=0,s=null,o,l,u,c;t=t||0;function h(){a=new Date().getTime(),s=null,r.apply(l,u||[])}var p=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];i=new Date().getTime(),l=this,u=v;var x=c||t,w=c||e;c=null,o=i-(w?n:a)-x,clearTimeout(s),w?s=setTimeout(h,x):o>=0?h():s=setTimeout(h,-o),n=i};return p.clear=function(){s&&(clearTimeout(s),s=null)},p.debounceNextCall=function(v){c=v},p}function Ug(r,t,e,i){var n=r[t];if(n){var a=n[aw]||n,s=n[Ez],o=n[Cz];if(o!==e||s!==i){if(e==null||!i)return r[t]=a;n=r[t]=yD(a,e,i==="debounce"),n[aw]=a,n[Ez]=i,n[Cz]=e}return n}}function Jy(r,t){var e=r[t];e&&e[aw]&&(e.clear&&e.clear(),r[t]=e[aw])}var Iz=Ir(),Mz={itemStyle:Hf(z7,!0),lineStyle:Hf(B7,!0)},o1t={lineStyle:"stroke",itemStyle:"fill"};function N9(r,t){var e=r.visualStyleMapper||Mz[t];return e||(console.warn("Unknown style type '"+t+"'."),Mz.itemStyle)}function F9(r,t){var e=r.visualDrawType||o1t[t];return e||(console.warn("Unknown style type '"+t+"'."),"fill")}var l1t={createOnAllSeries:!0,performRawSeries:!0,reset:function(r,t){var e=r.getData(),i=r.visualStyleAccessPath||"itemStyle",n=r.getModel(i),a=N9(r,i),s=a(n),o=n.getShallow("decal");o&&(e.setVisual("decal",o),o.dirty=!0);var l=F9(r,i),u=s[l],c=Ve(u)?u:null,h=s.fill==="auto"||s.stroke==="auto";if(!s[l]||c||h){var p=r.getColorFromPalette(r.name,null,t.getSeriesCount());s[l]||(s[l]=p,e.setVisual("colorFromPalette",!0)),s.fill=s.fill==="auto"||Ve(s.fill)?p:s.fill,s.stroke=s.stroke==="auto"||Ve(s.stroke)?p:s.stroke}if(e.setVisual("style",s),e.setVisual("drawType",l),!t.isSeriesFiltered(r)&&c)return e.setVisual("colorFromPalette",!1),{dataEach:function(v,y){var x=r.getDataParams(y),w=Zt({},s);w[l]=c(x),v.setItemVisual(y,"style",w)}}}},dm=new fi,u1t={createOnAllSeries:!0,performRawSeries:!0,reset:function(r,t){if(!(r.ignoreStyleOnData||t.isSeriesFiltered(r))){var e=r.getData(),i=r.visualStyleAccessPath||"itemStyle",n=N9(r,i),a=e.getVisual("drawType");return{dataEach:e.hasItemOption?function(s,o){var l=s.getRawDataItem(o);if(l&&l[i]){dm.option=l[i];var u=n(dm),c=s.ensureUniqueItemVisual(o,"style");Zt(c,u),dm.option.decal&&(s.setItemVisual(o,"decal",dm.option.decal),dm.option.decal.dirty=!0),a in u&&s.setItemVisual(o,"colorFromPalette",!1)}}:null}}}},c1t={performRawSeries:!0,overallReset:function(r){var t=Re();r.eachSeries(function(e){var i=e.getColorBy();if(!e.isColorBySeries()){var n=e.type+"-"+i,a=t.get(n);a||(a={},t.set(n,a)),Iz(e).scope=a}}),r.eachSeries(function(e){if(!(e.isColorBySeries()||r.isSeriesFiltered(e))){var i=e.getRawData(),n={},a=e.getData(),s=Iz(e).scope,o=e.visualStyleAccessPath||"itemStyle",l=F9(e,o);a.each(function(u){var c=a.getRawIndex(u);n[c]=u}),i.each(function(u){var c=n[u],h=a.getItemVisual(c,"colorFromPalette");if(h){var p=a.ensureUniqueItemVisual(c,"style"),v=i.getName(u)||u+"",y=i.count();p[l]=e.getColorFromPalette(v,s,y)}})}})}},qx=Math.PI;function h1t(r,t){t=t||{},We(t,{text:"loading",textColor:"#000",fontSize:12,fontWeight:"normal",fontStyle:"normal",fontFamily:"sans-serif",maskColor:"rgba(255, 255, 255, 0.8)",showSpinner:!0,color:"#5470c6",spinnerRadius:10,lineWidth:5,zlevel:0});var e=new Ke,i=new Pr({style:{fill:t.maskColor},zlevel:t.zlevel,z:1e4});e.add(i);var n=new Nr({style:{text:t.text,fill:t.textColor,fontSize:t.fontSize,fontWeight:t.fontWeight,fontStyle:t.fontStyle,fontFamily:t.fontFamily},zlevel:t.zlevel,z:10001}),a=new Pr({style:{fill:"none"},textContent:n,textConfig:{position:"right",distance:10},zlevel:t.zlevel,z:10001});e.add(a);var s;return t.showSpinner&&(s=new JR({shape:{startAngle:-qx/2,endAngle:-qx/2+.1,r:t.spinnerRadius},style:{stroke:t.color,lineCap:"round",lineWidth:t.lineWidth},zlevel:t.zlevel,z:10001}),s.animateShape(!0).when(1e3,{endAngle:qx*3/2}).start("circularInOut"),s.animateShape(!0).when(1e3,{startAngle:qx*3/2}).delay(300).start("circularInOut"),e.add(s)),e.resize=function(){var o=n.getBoundingRect().width,l=t.showSpinner?t.spinnerRadius:0,u=(r.getWidth()-l*2-(t.showSpinner&&o?10:0)-o)/2-(t.showSpinner&&o?0:5+o/2)+(t.showSpinner?0:o/2)+(o?0:l),c=r.getHeight()/2;t.showSpinner&&s.setShape({cx:u,cy:c}),a.setShape({x:u-l,y:c-l,width:l*2,height:l*2}),i.setShape({x:0,y:0,width:r.getWidth(),height:r.getHeight()})},e.resize(),e}var f1t=function(){function r(t,e,i,n){this._stageTaskMap=Re(),this.ecInstance=t,this.api=e,i=this._dataProcessorHandlers=i.slice(),n=this._visualHandlers=n.slice(),this._allHandlers=i.concat(n)}return r.prototype.restoreData=function(t,e){t.restoreData(e),this._stageTaskMap.each(function(i){var n=i.overallTask;n&&n.dirty()})},r.prototype.getPerformArgs=function(t,e){if(t.__pipeline){var i=this._pipelineMap.get(t.__pipeline.id),n=i.context,a=!e&&i.progressiveEnabled&&(!n||n.progressiveRender)&&t.__idxInPipeline>i.blockIndex,s=a?i.step:null,o=n&&n.modDataCount,l=o!=null?Math.ceil(o/s):null;return{step:s,modBy:l,modDataCount:o}}},r.prototype.getPipeline=function(t){return this._pipelineMap.get(t)},r.prototype.updateStreamModes=function(t,e){var i=this._pipelineMap.get(t.uid),n=t.getData(),a=n.count(),s=i.progressiveEnabled&&e.incrementalPrepareRender&&a>=i.threshold,o=t.get("large")&&a>=t.get("largeThreshold"),l=t.get("progressiveChunkMode")==="mod"?a:null;t.pipelineContext=i.context={progressiveRender:s,modDataCount:l,large:o}},r.prototype.restorePipelines=function(t){var e=this,i=e._pipelineMap=Re();t.eachSeries(function(n){var a=n.getProgressive(),s=n.uid;i.set(s,{id:s,head:null,tail:null,threshold:n.getProgressiveThreshold(),progressiveEnabled:a&&!(n.preventIncremental&&n.preventIncremental()),blockIndex:-1,step:Math.round(a||700),count:0}),e._pipe(n,n.dataTask)})},r.prototype.prepareStageTasks=function(){var t=this._stageTaskMap,e=this.api.getModel(),i=this.api;J(this._allHandlers,function(n){var a=t.get(n.uid)||t.set(n.uid,{}),s="";Za(!(n.reset&&n.overallReset),s),n.reset&&this._createSeriesStageTask(n,a,e,i),n.overallReset&&this._createOverallStageTask(n,a,e,i)},this)},r.prototype.prepareView=function(t,e,i,n){var a=t.renderTask,s=a.context;s.model=e,s.ecModel=i,s.api=n,a.__block=!t.incrementalPrepareRender,this._pipe(e,a)},r.prototype.performDataProcessorTasks=function(t,e){this._performStageTasks(this._dataProcessorHandlers,t,e,{block:!0})},r.prototype.performVisualTasks=function(t,e,i){this._performStageTasks(this._visualHandlers,t,e,i)},r.prototype._performStageTasks=function(t,e,i,n){n=n||{};var a=!1,s=this;J(t,function(l,u){if(!(n.visualType&&n.visualType!==l.visualType)){var c=s._stageTaskMap.get(l.uid),h=c.seriesTaskMap,p=c.overallTask;if(p){var v,y=p.agentStubMap;y.each(function(w){o(n,w)&&(w.dirty(),v=!0)}),v&&p.dirty(),s.updatePayload(p,i);var x=s.getPerformArgs(p,n.block);y.each(function(w){w.perform(x)}),p.perform(x)&&(a=!0)}else h&&h.each(function(w,T){o(n,w)&&w.dirty();var E=s.getPerformArgs(w,n.block);E.skip=!l.performRawSeries&&e.isSeriesFiltered(w.context.model),s.updatePayload(w,i),w.perform(E)&&(a=!0)})}});function o(l,u){return l.setDirty&&(!l.dirtyMap||l.dirtyMap.get(u.__pipeline.id))}this.unfinished=a||this.unfinished},r.prototype.performSeriesTasks=function(t){var e;t.eachSeries(function(i){e=i.dataTask.perform()||e}),this.unfinished=e||this.unfinished},r.prototype.plan=function(){this._pipelineMap.each(function(t){var e=t.tail;do{if(e.__block){t.blockIndex=e.__idxInPipeline;break}e=e.getUpstream()}while(e)})},r.prototype.updatePayload=function(t,e){e!=="remain"&&(t.context.payload=e)},r.prototype._createSeriesStageTask=function(t,e,i,n){var a=this,s=e.seriesTaskMap,o=e.seriesTaskMap=Re(),l=t.seriesType,u=t.getTargetSeries;t.createOnAllSeries?i.eachRawSeries(c):l?i.eachRawSeriesByType(l,c):u&&u(i,n).each(c);function c(h){var p=h.uid,v=o.set(p,s&&s.get(p)||fy({plan:m1t,reset:y1t,count:x1t}));v.context={model:h,ecModel:i,api:n,useClearVisual:t.isVisual&&!t.isLayout,plan:t.plan,reset:t.reset,scheduler:a},a._pipe(h,v)}},r.prototype._createOverallStageTask=function(t,e,i,n){var a=this,s=e.overallTask=e.overallTask||fy({reset:d1t});s.context={ecModel:i,api:n,overallReset:t.overallReset,scheduler:a};var o=s.agentStubMap,l=s.agentStubMap=Re(),u=t.seriesType,c=t.getTargetSeries,h=!0,p=!1,v="";Za(!t.createOnAllSeries,v),u?i.eachRawSeriesByType(u,y):c?c(i,n).each(y):(h=!1,J(i.getSeries(),y));function y(x){var w=x.uid,T=l.set(w,o&&o.get(w)||(p=!0,fy({reset:p1t,onDirty:v1t})));T.context={model:x,overallProgress:h},T.agent=s,T.__block=h,a._pipe(x,T)}p&&s.dirty()},r.prototype._pipe=function(t,e){var i=t.uid,n=this._pipelineMap.get(i);!n.head&&(n.head=e),n.tail&&n.tail.pipe(e),n.tail=e,e.__idxInPipeline=n.count++,e.__pipeline=n},r.wrapStageHandler=function(t,e){return Ve(t)&&(t={overallReset:t,seriesType:b1t(t)}),t.uid=Og("stageHandler"),e&&(t.visualType=e),t},r}();function d1t(r){r.overallReset(r.ecModel,r.api,r.payload)}function p1t(r){return r.overallProgress&&g1t}function g1t(){this.agent.dirty(),this.getDownstream().dirty()}function v1t(){this.agent&&this.agent.dirty()}function m1t(r){return r.plan?r.plan(r.model,r.ecModel,r.api,r.payload):null}function y1t(r){r.useClearVisual&&r.data.clearAllVisual();var t=r.resetDefines=ri(r.reset(r.model,r.ecModel,r.api,r.payload));return t.length>1?te(t,function(e,i){return B9(i)}):_1t}var _1t=B9(0);function B9(r){return function(t,e){var i=e.data,n=e.resetDefines[r];if(n&&n.dataEach)for(var a=t.start;a<t.end;a++)n.dataEach(i,a);else n&&n.progress&&n.progress(t,i)}}function x1t(r){return r.data.count()}function b1t(r){sw=null;try{r(Qy,z9)}catch{}return sw}var Qy={},z9={},sw;V9(Qy,c9);V9(z9,h9);Qy.eachSeriesByType=Qy.eachRawSeriesByType=function(r){sw=r};Qy.eachComponent=function(r){r.mainType==="series"&&r.subType&&(sw=r.subType)};function V9(r,t){for(var e in t.prototype)r[e]=nn}const U9=f1t;var Pz=["#37A2DA","#32C5E9","#67E0E3","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#E062AE","#E690D1","#e7bcf3","#9d96f5","#8378EA","#96BFFF"];const w1t={color:Pz,colorLayer:[["#37A2DA","#ffd85c","#fd7b5f"],["#37A2DA","#67E0E3","#FFDB5C","#ff9f7f","#E062AE","#9d96f5"],["#37A2DA","#32C5E9","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#e7bcf3","#8378EA","#96BFFF"],Pz]};var Va="#B9B8CE",Rz="#100C2A",Yx=function(){return{axisLine:{lineStyle:{color:Va}},splitLine:{lineStyle:{color:"#484753"}},splitArea:{areaStyle:{color:["rgba(255,255,255,0.02)","rgba(255,255,255,0.05)"]}},minorSplitLine:{lineStyle:{color:"#20203B"}}}},Dz=["#4992ff","#7cffb2","#fddd60","#ff6e76","#58d9f9","#05c091","#ff8a45","#8d48e3","#dd79ff"],$9={darkMode:!0,color:Dz,backgroundColor:Rz,axisPointer:{lineStyle:{color:"#817f91"},crossStyle:{color:"#817f91"},label:{color:"#fff"}},legend:{textStyle:{color:Va}},textStyle:{color:Va},title:{textStyle:{color:"#EEF1FA"},subtextStyle:{color:"#B9B8CE"}},toolbox:{iconStyle:{borderColor:Va}},dataZoom:{borderColor:"#71708A",textStyle:{color:Va},brushStyle:{color:"rgba(135,163,206,0.3)"},handleStyle:{color:"#353450",borderColor:"#C5CBE3"},moveHandleStyle:{color:"#B0B6C3",opacity:.3},fillerColor:"rgba(135,163,206,0.2)",emphasis:{handleStyle:{borderColor:"#91B7F2",color:"#4D587D"},moveHandleStyle:{color:"#636D9A",opacity:.7}},dataBackground:{lineStyle:{color:"#71708A",width:1},areaStyle:{color:"#71708A"}},selectedDataBackground:{lineStyle:{color:"#87A3CE"},areaStyle:{color:"#87A3CE"}}},visualMap:{textStyle:{color:Va}},timeline:{lineStyle:{color:Va},label:{color:Va},controlStyle:{color:Va,borderColor:Va}},calendar:{itemStyle:{color:Rz},dayLabel:{color:Va},monthLabel:{color:Va},yearLabel:{color:Va}},timeAxis:Yx(),logAxis:Yx(),valueAxis:Yx(),categoryAxis:Yx(),line:{symbol:"circle"},graph:{color:Dz},gauge:{title:{color:Va},axisLine:{lineStyle:{color:[[1,"rgba(207,212,219,0.2)"]]}},axisLabel:{color:Va},detail:{color:"#EEF1FA"}},candlestick:{itemStyle:{color:"#f64e56",color0:"#54ea92",borderColor:"#f64e56",borderColor0:"#54ea92"}}};$9.categoryAxis.splitLine.show=!1;const S1t=$9;var T1t=function(){function r(){}return r.prototype.normalizeQuery=function(t){var e={},i={},n={};if(ve(t)){var a=vl(t);e.mainType=a.main||null,e.subType=a.sub||null}else{var s=["Index","Name","Id"],o={name:1,dataIndex:1,dataType:1};J(t,function(l,u){for(var c=!1,h=0;h<s.length;h++){var p=s[h],v=u.lastIndexOf(p);if(v>0&&v===u.length-p.length){var y=u.slice(0,v);y!=="data"&&(e.mainType=y,e[p.toLowerCase()]=l,c=!0)}}o.hasOwnProperty(u)&&(i[u]=l,c=!0),c||(n[u]=l)})}return{cptQuery:e,dataQuery:i,otherQuery:n}},r.prototype.filter=function(t,e){var i=this.eventInfo;if(!i)return!0;var n=i.targetEl,a=i.packedEvent,s=i.model,o=i.view;if(!s||!o)return!0;var l=e.cptQuery,u=e.dataQuery;return c(l,s,"mainType")&&c(l,s,"subType")&&c(l,s,"index","componentIndex")&&c(l,s,"name")&&c(l,s,"id")&&c(u,a,"name")&&c(u,a,"dataIndex")&&c(u,a,"dataType")&&(!o.filterForExposedEvent||o.filterForExposedEvent(t,e.otherQuery,n,a));function c(h,p,v,y){return h[v]==null||p[y||v]===h[v]}},r.prototype.afterTrigger=function(){this.eventInfo=null},r}(),xM=["symbol","symbolSize","symbolRotate","symbolOffset"],Lz=xM.concat(["symbolKeepAspect"]),A1t={createOnAllSeries:!0,performRawSeries:!0,reset:function(r,t){var e=r.getData();if(r.legendIcon&&e.setVisual("legendIcon",r.legendIcon),!r.hasSymbolVisual)return;for(var i={},n={},a=!1,s=0;s<xM.length;s++){var o=xM[s],l=r.get(o);Ve(l)?(a=!0,n[o]=l):i[o]=l}if(i.symbol=i.symbol||r.defaultSymbol,e.setVisual(Zt({legendIcon:r.legendIcon||i.symbol,symbolKeepAspect:r.get("symbolKeepAspect")},i)),t.isSeriesFiltered(r))return;var u=br(n);function c(h,p){for(var v=r.getRawValue(p),y=r.getDataParams(p),x=0;x<u.length;x++){var w=u[x];h.setItemVisual(p,w,n[w](v,y))}}return{dataEach:a?c:null}}},C1t={createOnAllSeries:!0,performRawSeries:!0,reset:function(r,t){if(!r.hasSymbolVisual||t.isSeriesFiltered(r))return;var e=r.getData();function i(n,a){for(var s=n.getItemModel(a),o=0;o<Lz.length;o++){var l=Lz[o],u=s.getShallow(l,!0);u!=null&&n.setItemVisual(a,l,u)}}return{dataEach:e.hasItemOption?i:null}}};function _D(r,t,e){switch(e){case"color":var i=r.getItemVisual(t,"style");return i[r.getVisual("drawType")];case"opacity":return r.getItemVisual(t,"style").opacity;case"symbol":case"symbolSize":case"liftZ":return r.getItemVisual(t,e)}}function L_(r,t){switch(t){case"color":var e=r.getVisual("style");return e[r.getVisual("drawType")];case"opacity":return r.getVisual("style").opacity;case"symbol":case"symbolSize":case"liftZ":return r.getVisual(t)}}function W9(r,t,e,i){switch(e){case"color":var n=r.ensureUniqueItemVisual(t,"style");n[r.getVisual("drawType")]=i,r.setItemVisual(t,"colorFromPalette",!1);break;case"opacity":r.ensureUniqueItemVisual(t,"style").opacity=i;break;case"symbol":case"symbolSize":case"liftZ":r.setItemVisual(t,e,i);break}}function H9(r,t){function e(i,n){var a=[];return i.eachComponent({mainType:"series",subType:r,query:n},function(s){a.push(s.seriesIndex)}),a}J([[r+"ToggleSelect","toggleSelect"],[r+"Select","select"],[r+"UnSelect","unselect"]],function(i){t(i[0],function(n,a,s){n=Zt({},n),s.dispatchAction(Zt(n,{type:i[1],seriesIndex:e(a,n)}))})})}function up(r,t,e,i,n){var a=r+t;e.isSilent(a)||i.eachComponent({mainType:"series",subType:"pie"},function(s){for(var o=s.seriesIndex,l=s.option.selectedMap,u=n.selected,c=0;c<u.length;c++)if(u[c].seriesIndex===o){var h=s.getData(),p=Wf(h,n.fromActionPayload);e.trigger(a,{type:a,seriesId:s.id,name:Kt(p)?h.getName(p[0]):h.getName(p),selected:ve(l)?l:Zt({},l)})}})}function E1t(r,t,e){r.on("selectchanged",function(i){var n=e.getModel();i.isFromClick?(up("map","selectchanged",t,n,i),up("pie","selectchanged",t,n,i)):i.fromAction==="select"?(up("map","selected",t,n,i),up("pie","selected",t,n,i)):i.fromAction==="unselect"&&(up("map","unselected",t,n,i),up("pie","unselected",t,n,i))})}function mf(r,t,e){for(var i;r&&!(t(r)&&(i=r,e));)r=r.__hostTarget||r.parent;return i}var I1t=Math.round(Math.random()*9),M1t=typeof Object.defineProperty=="function",P1t=function(){function r(){this._id="__ec_inner_"+I1t++}return r.prototype.get=function(t){return this._guard(t)[this._id]},r.prototype.set=function(t,e){var i=this._guard(t);return M1t?Object.defineProperty(i,this._id,{value:e,enumerable:!1,configurable:!0}):i[this._id]=e,this},r.prototype.delete=function(t){return this.has(t)?(delete this._guard(t)[this._id],!0):!1},r.prototype.has=function(t){return!!this._guard(t)[this._id]},r.prototype._guard=function(t){if(t!==Object(t))throw TypeError("Value of WeakMap is not a non-null object.");return t},r}();const R1t=P1t;var D1t=vr.extend({type:"triangle",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(r,t){var e=t.cx,i=t.cy,n=t.width/2,a=t.height/2;r.moveTo(e,i-a),r.lineTo(e+n,i+a),r.lineTo(e-n,i+a),r.closePath()}}),L1t=vr.extend({type:"diamond",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(r,t){var e=t.cx,i=t.cy,n=t.width/2,a=t.height/2;r.moveTo(e,i-a),r.lineTo(e+n,i),r.lineTo(e,i+a),r.lineTo(e-n,i),r.closePath()}}),k1t=vr.extend({type:"pin",shape:{x:0,y:0,width:0,height:0},buildPath:function(r,t){var e=t.x,i=t.y,n=t.width/5*3,a=Math.max(n,t.height),s=n/2,o=s*s/(a-s),l=i-a+s+o,u=Math.asin(o/s),c=Math.cos(u)*s,h=Math.sin(u),p=Math.cos(u),v=s*.6,y=s*.7;r.moveTo(e-c,l+o),r.arc(e,l,s,Math.PI-u,Math.PI*2+u),r.bezierCurveTo(e+c-h*v,l+o+p*v,e,i-y,e,i),r.bezierCurveTo(e,i-y,e-c+h*v,l+o+p*v,e-c,l+o),r.closePath()}}),O1t=vr.extend({type:"arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(r,t){var e=t.height,i=t.width,n=t.x,a=t.y,s=i/3*2;r.moveTo(n,a),r.lineTo(n+s,a+e),r.lineTo(n,a+e/4*3),r.lineTo(n-s,a+e),r.lineTo(n,a),r.closePath()}}),N1t={line:$n,rect:Pr,roundRect:Pr,square:Pr,circle:Yc,diamond:L1t,pin:k1t,arrow:O1t,triangle:D1t},F1t={line:function(r,t,e,i,n){n.x1=r,n.y1=t+i/2,n.x2=r+e,n.y2=t+i/2},rect:function(r,t,e,i,n){n.x=r,n.y=t,n.width=e,n.height=i},roundRect:function(r,t,e,i,n){n.x=r,n.y=t,n.width=e,n.height=i,n.r=Math.min(e,i)/4},square:function(r,t,e,i,n){var a=Math.min(e,i);n.x=r,n.y=t,n.width=a,n.height=a},circle:function(r,t,e,i,n){n.cx=r+e/2,n.cy=t+i/2,n.r=Math.min(e,i)/2},diamond:function(r,t,e,i,n){n.cx=r+e/2,n.cy=t+i/2,n.width=e,n.height=i},pin:function(r,t,e,i,n){n.x=r+e/2,n.y=t+i/2,n.width=e,n.height=i},arrow:function(r,t,e,i,n){n.x=r+e/2,n.y=t+i/2,n.width=e,n.height=i},triangle:function(r,t,e,i,n){n.cx=r+e/2,n.cy=t+i/2,n.width=e,n.height=i}},ow={};J(N1t,function(r,t){ow[t]=new r});var B1t=vr.extend({type:"symbol",shape:{symbolType:"",x:0,y:0,width:0,height:0},calculateTextPosition:function(r,t,e){var i=Yb(r,t,e),n=this.shape;return n&&n.symbolType==="pin"&&t.position==="inside"&&(i.y=e.y+e.height*.4),i},buildPath:function(r,t,e){var i=t.symbolType;if(i!=="none"){var n=ow[i];n||(i="rect",n=ow[i]),F1t[i](t.x,t.y,t.width,t.height,n.shape),n.buildPath(r,n.shape,e)}}});function z1t(r,t){if(this.type!=="image"){var e=this.style;this.__isEmptyBrush?(e.stroke=r,e.fill=t||"#fff",e.lineWidth=2):this.shape.symbolType==="line"?e.stroke=r:e.fill=r,this.markRedraw()}}function mn(r,t,e,i,n,a,s){var o=r.indexOf("empty")===0;o&&(r=r.substr(5,1).toLowerCase()+r.substr(6));var l;return r.indexOf("image://")===0?l=P7(r.slice(8),new hr(t,e,i,n),s?"center":"cover"):r.indexOf("path://")===0?l=MS(r.slice(7),{},new hr(t,e,i,n),s?"center":"cover"):l=new B1t({shape:{symbolType:r,x:t,y:e,width:i,height:n}}),l.__isEmptyBrush=o,l.setColor=z1t,a&&l.setColor(a),l}function $g(r){return Kt(r)||(r=[+r,+r]),[r[0]||0,r[1]||0]}function id(r,t){if(r!=null)return Kt(r)||(r=[r,r]),[he(r[0],t[0])||0,he(ir(r[1],r[0]),t[1])||0]}function yf(r){return isFinite(r)}function V1t(r,t,e){var i=t.x==null?0:t.x,n=t.x2==null?1:t.x2,a=t.y==null?0:t.y,s=t.y2==null?0:t.y2;t.global||(i=i*e.width+e.x,n=n*e.width+e.x,a=a*e.height+e.y,s=s*e.height+e.y),i=yf(i)?i:0,n=yf(n)?n:1,a=yf(a)?a:0,s=yf(s)?s:0;var o=r.createLinearGradient(i,a,n,s);return o}function U1t(r,t,e){var i=e.width,n=e.height,a=Math.min(i,n),s=t.x==null?.5:t.x,o=t.y==null?.5:t.y,l=t.r==null?.5:t.r;t.global||(s=s*i+e.x,o=o*n+e.y,l=l*a),s=yf(s)?s:.5,o=yf(o)?o:.5,l=l>=0&&yf(l)?l:.5;var u=r.createRadialGradient(s,o,0,s,o,l);return u}function bM(r,t,e){for(var i=t.type==="radial"?U1t(r,t,e):V1t(r,t,e),n=t.colorStops,a=0;a<n.length;a++)i.addColorStop(n[a].offset,n[a].color);return i}function $1t(r,t){if(r===t||!r&&!t)return!1;if(!r||!t||r.length!==t.length)return!0;for(var e=0;e<r.length;e++)if(r[e]!==t[e])return!0;return!1}function Kx(r){return parseInt(r,10)}function Up(r,t,e){var i=["width","height"][t],n=["clientWidth","clientHeight"][t],a=["paddingLeft","paddingTop"][t],s=["paddingRight","paddingBottom"][t];if(e[i]!=null&&e[i]!=="auto")return parseFloat(e[i]);var o=document.defaultView.getComputedStyle(r);return(r[n]||Kx(o[i])||Kx(r.style[i]))-(Kx(o[a])||0)-(Kx(o[s])||0)|0}function W1t(r,t){return!r||r==="solid"||!(t>0)?null:r==="dashed"?[4*t,2*t]:r==="dotted"?[t]:Fr(r)?[r]:Kt(r)?r:null}function xD(r){var t=r.style,e=t.lineDash&&t.lineWidth>0&&W1t(t.lineDash,t.lineWidth),i=t.lineDashOffset;if(e){var n=t.strokeNoScale&&r.getLineScale?r.getLineScale():1;n&&n!==1&&(e=te(e,function(a){return a/n}),i/=n)}return[e,i]}var H1t=new Al(!0);function lw(r){var t=r.stroke;return!(t==null||t==="none"||!(r.lineWidth>0))}function kz(r){return typeof r=="string"&&r!=="none"}function uw(r){var t=r.fill;return t!=null&&t!=="none"}function Oz(r,t){if(t.fillOpacity!=null&&t.fillOpacity!==1){var e=r.globalAlpha;r.globalAlpha=t.fillOpacity*t.opacity,r.fill(),r.globalAlpha=e}else r.fill()}function Nz(r,t){if(t.strokeOpacity!=null&&t.strokeOpacity!==1){var e=r.globalAlpha;r.globalAlpha=t.strokeOpacity*t.opacity,r.stroke(),r.globalAlpha=e}else r.stroke()}function wM(r,t,e){var i=WR(t.image,t.__image,e);if(wS(i)){var n=r.createPattern(i,t.repeat||"repeat");if(typeof DOMMatrix=="function"&&n&&n.setTransform){var a=new DOMMatrix;a.translateSelf(t.x||0,t.y||0),a.rotateSelf(0,0,(t.rotation||0)*V1),a.scaleSelf(t.scaleX||1,t.scaleY||1),n.setTransform(a)}return n}}function G1t(r,t,e,i){var n,a=lw(e),s=uw(e),o=e.strokePercent,l=o<1,u=!t.path;(!t.silent||l)&&u&&t.createPathProxy();var c=t.path||H1t,h=t.__dirty;if(!i){var p=e.fill,v=e.stroke,y=s&&!!p.colorStops,x=a&&!!v.colorStops,w=s&&!!p.image,T=a&&!!v.image,E=void 0,M=void 0,L=void 0,F=void 0,O=void 0;(y||x)&&(O=t.getBoundingRect()),y&&(E=h?bM(r,p,O):t.__canvasFillGradient,t.__canvasFillGradient=E),x&&(M=h?bM(r,v,O):t.__canvasStrokeGradient,t.__canvasStrokeGradient=M),w&&(L=h||!t.__canvasFillPattern?wM(r,p,t):t.__canvasFillPattern,t.__canvasFillPattern=L),T&&(F=h||!t.__canvasStrokePattern?wM(r,v,t):t.__canvasStrokePattern,t.__canvasStrokePattern=L),y?r.fillStyle=E:w&&(L?r.fillStyle=L:s=!1),x?r.strokeStyle=M:T&&(F?r.strokeStyle=F:a=!1)}var U=t.getGlobalScale();c.setScale(U[0],U[1],t.segmentIgnoreThreshold);var W,H;r.setLineDash&&e.lineDash&&(n=xD(t),W=n[0],H=n[1]);var j=!0;(u||h&wp)&&(c.setDPR(r.dpr),l?c.setContext(null):(c.setContext(r),j=!1),c.reset(),t.buildPath(c,t.shape,i),c.toStatic(),t.pathUpdated()),j&&c.rebuildPath(r,l?o:1),W&&(r.setLineDash(W),r.lineDashOffset=H),i||(e.strokeFirst?(a&&Nz(r,e),s&&Oz(r,e)):(s&&Oz(r,e),a&&Nz(r,e))),W&&r.setLineDash([])}function j1t(r,t,e){var i=t.__image=WR(e.image,t.__image,t,t.onload);if(!(!i||!wS(i))){var n=e.x||0,a=e.y||0,s=t.getWidth(),o=t.getHeight(),l=i.width/i.height;if(s==null&&o!=null?s=o*l:o==null&&s!=null?o=s/l:s==null&&o==null&&(s=i.width,o=i.height),e.sWidth&&e.sHeight){var u=e.sx||0,c=e.sy||0;r.drawImage(i,u,c,e.sWidth,e.sHeight,n,a,s,o)}else if(e.sx&&e.sy){var u=e.sx,c=e.sy,h=s-u,p=o-c;r.drawImage(i,u,c,h,p,n,a,s,o)}else r.drawImage(i,n,a,s,o)}}function X1t(r,t,e){var i,n=e.text;if(n!=null&&(n+=""),n){r.font=e.font||zc,r.textAlign=e.textAlign,r.textBaseline=e.textBaseline;var a=void 0,s=void 0;r.setLineDash&&e.lineDash&&(i=xD(t),a=i[0],s=i[1]),a&&(r.setLineDash(a),r.lineDashOffset=s),e.strokeFirst?(lw(e)&&r.strokeText(n,e.x,e.y),uw(e)&&r.fillText(n,e.x,e.y)):(uw(e)&&r.fillText(n,e.x,e.y),lw(e)&&r.strokeText(n,e.x,e.y)),a&&r.setLineDash([])}}var Fz=["shadowBlur","shadowOffsetX","shadowOffsetY"],Bz=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function G9(r,t,e,i,n){var a=!1;if(!i&&(e=e||{},t===e))return!1;if(i||t.opacity!==e.opacity){cs(r,n),a=!0;var s=Math.max(Math.min(t.opacity,1),0);r.globalAlpha=isNaN(s)?Cf.opacity:s}(i||t.blend!==e.blend)&&(a||(cs(r,n),a=!0),r.globalCompositeOperation=t.blend||Cf.blend);for(var o=0;o<Fz.length;o++){var l=Fz[o];(i||t[l]!==e[l])&&(a||(cs(r,n),a=!0),r[l]=r.dpr*(t[l]||0))}return(i||t.shadowColor!==e.shadowColor)&&(a||(cs(r,n),a=!0),r.shadowColor=t.shadowColor||Cf.shadowColor),a}function zz(r,t,e,i,n){var a=t_(t,n.inHover),s=i?null:e&&t_(e,n.inHover)||{};if(a===s)return!1;var o=G9(r,a,s,i,n);if((i||a.fill!==s.fill)&&(o||(cs(r,n),o=!0),kz(a.fill)&&(r.fillStyle=a.fill)),(i||a.stroke!==s.stroke)&&(o||(cs(r,n),o=!0),kz(a.stroke)&&(r.strokeStyle=a.stroke)),(i||a.opacity!==s.opacity)&&(o||(cs(r,n),o=!0),r.globalAlpha=a.opacity==null?1:a.opacity),t.hasStroke()){var l=a.lineWidth,u=l/(a.strokeNoScale&&t.getLineScale?t.getLineScale():1);r.lineWidth!==u&&(o||(cs(r,n),o=!0),r.lineWidth=u)}for(var c=0;c<Bz.length;c++){var h=Bz[c],p=h[0];(i||a[p]!==s[p])&&(o||(cs(r,n),o=!0),r[p]=a[p]||h[1])}return o}function Z1t(r,t,e,i,n){return G9(r,t_(t,n.inHover),e&&t_(e,n.inHover),i,n)}function j9(r,t){var e=t.transform,i=r.dpr||1;e?r.setTransform(i*e[0],i*e[1],i*e[2],i*e[3],i*e[4],i*e[5]):r.setTransform(i,0,0,i,0,0)}function q1t(r,t,e){for(var i=!1,n=0;n<r.length;n++){var a=r[n];i=i||a.isZeroArea(),j9(t,a),t.beginPath(),a.buildPath(t,a.shape),t.clip()}e.allClipped=i}function Y1t(r,t){return r&&t?r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]||r[3]!==t[3]||r[4]!==t[4]||r[5]!==t[5]:!(!r&&!t)}var Vz=1,Uz=2,$z=3,Wz=4;function K1t(r){var t=uw(r),e=lw(r);return!(r.lineDash||!(+t^+e)||t&&typeof r.fill!="string"||e&&typeof r.stroke!="string"||r.strokePercent<1||r.strokeOpacity<1||r.fillOpacity<1)}function cs(r,t){t.batchFill&&r.fill(),t.batchStroke&&r.stroke(),t.batchFill="",t.batchStroke=""}function t_(r,t){return t&&r.__hoverStyle||r.style}function X9(r,t){_f(r,t,{inHover:!1,viewWidth:0,viewHeight:0},!0)}function _f(r,t,e,i){var n=t.transform;if(!t.shouldBePainted(e.viewWidth,e.viewHeight,!1,!1)){t.__dirty&=~Ts,t.__isRendered=!1;return}var a=t.__clipPaths,s=e.prevElClipPaths,o=!1,l=!1;if((!s||$1t(a,s))&&(s&&s.length&&(cs(r,e),r.restore(),l=o=!0,e.prevElClipPaths=null,e.allClipped=!1,e.prevEl=null),a&&a.length&&(cs(r,e),r.save(),q1t(a,r,e),o=!0),e.prevElClipPaths=a),e.allClipped){t.__isRendered=!1;return}t.beforeBrush&&t.beforeBrush(),t.innerBeforeBrush();var u=e.prevEl;u||(l=o=!0);var c=t instanceof vr&&t.autoBatch&&K1t(t.style);o||Y1t(n,u.transform)?(cs(r,e),j9(r,t)):c||cs(r,e);var h=t_(t,e.inHover);t instanceof vr?(e.lastDrawType!==Vz&&(l=!0,e.lastDrawType=Vz),zz(r,t,u,l,e),(!c||!e.batchFill&&!e.batchStroke)&&r.beginPath(),G1t(r,t,h,c),c&&(e.batchFill=h.fill||"",e.batchStroke=h.stroke||"")):t instanceof Gy?(e.lastDrawType!==$z&&(l=!0,e.lastDrawType=$z),zz(r,t,u,l,e),X1t(r,t,h)):t instanceof ia?(e.lastDrawType!==Uz&&(l=!0,e.lastDrawType=Uz),Z1t(r,t,u,l,e),j1t(r,t,h)):t.getTemporalDisplayables&&(e.lastDrawType!==Wz&&(l=!0,e.lastDrawType=Wz),J1t(r,t,e)),c&&i&&cs(r,e),t.innerAfterBrush(),t.afterBrush&&t.afterBrush(),e.prevEl=t,t.__dirty=0,t.__isRendered=!0}function J1t(r,t,e){var i=t.getDisplayables(),n=t.getTemporalDisplayables();r.save();var a={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:e.viewWidth,viewHeight:e.viewHeight,inHover:e.inHover},s,o;for(s=t.getCursor(),o=i.length;s<o;s++){var l=i[s];l.beforeBrush&&l.beforeBrush(),l.innerBeforeBrush(),_f(r,l,a,s===o-1),l.innerAfterBrush(),l.afterBrush&&l.afterBrush(),a.prevEl=l}for(var u=0,c=n.length;u<c;u++){var l=n[u];l.beforeBrush&&l.beforeBrush(),l.innerBeforeBrush(),_f(r,l,a,u===c-1),l.innerAfterBrush(),l.afterBrush&&l.afterBrush(),a.prevEl=l}t.clearTemporalDisplayables(),t.notClear=!0,r.restore()}var G2=new R1t,Hz=new A_(100),Gz=["symbol","symbolSize","symbolKeepAspect","color","backgroundColor","dashArrayX","dashArrayY","maxTileWidth","maxTileHeight"];function gg(r,t){if(r==="none")return null;var e=t.getDevicePixelRatio(),i=t.getZr(),n=i.painter.type==="svg";r.dirty&&G2.delete(r);var a=G2.get(r);if(a)return a;var s=We(r,{symbol:"rect",symbolSize:1,symbolKeepAspect:!0,color:"rgba(0, 0, 0, 0.2)",backgroundColor:null,dashArrayX:5,dashArrayY:5,rotation:0,maxTileWidth:512,maxTileHeight:512});s.backgroundColor==="none"&&(s.backgroundColor=null);var o={repeat:"repeat"};return l(o),o.rotation=s.rotation,o.scaleX=o.scaleY=n?1:1/e,G2.set(r,o),r.dirty=!1,o;function l(u){for(var c=[e],h=!0,p=0;p<Gz.length;++p){var v=s[Gz[p]];if(v!=null&&!Kt(v)&&!ve(v)&&!Fr(v)&&typeof v!="boolean"){h=!1;break}c.push(v)}var y;if(h){y=c.join(",")+(n?"-svg":"");var x=Hz.get(y);x&&(n?u.svgElement=x:u.image=x)}var w=q9(s.dashArrayX),T=Q1t(s.dashArrayY),E=Z9(s.symbol),M=tbt(w),L=Y9(T),F=!n&&Vc.createCanvas(),O=n&&{tag:"g",attrs:{},key:"dcl",children:[]},U=H(),W;F&&(F.width=U.width*e,F.height=U.height*e,W=F.getContext("2d")),j(),h&&Hz.put(y,F||O),u.image=F,u.svgElement=O,u.svgWidth=U.width,u.svgHeight=U.height;function H(){for(var Y=1,tt=0,it=M.length;tt<it;++tt)Y=lB(Y,M[tt]);for(var lt=1,tt=0,it=E.length;tt<it;++tt)lt=lB(lt,E[tt].length);Y*=lt;var ht=L*M.length*E.length;return{width:Math.max(1,Math.min(Y,s.maxTileWidth)),height:Math.max(1,Math.min(ht,s.maxTileHeight))}}function j(){W&&(W.clearRect(0,0,F.width,F.height),s.backgroundColor&&(W.fillStyle=s.backgroundColor,W.fillRect(0,0,F.width,F.height)));for(var Y=0,tt=0;tt<T.length;++tt)Y+=T[tt];if(Y<=0)return;for(var it=-L,lt=0,ht=0,Tt=0;it<U.height;){if(lt%2===0){for(var Ot=ht/2%E.length,Rt=0,Ut=0,Jt=0;Rt<U.width*2;){for(var ne=0,tt=0;tt<w[Tt].length;++tt)ne+=w[Tt][tt];if(ne<=0)break;if(Ut%2===0){var se=(1-s.symbolSize)*.5,ce=Rt+w[Tt][Ut]*se,ye=it+T[lt]*se,Qe=w[Tt][Ut]*s.symbolSize,sr=T[lt]*s.symbolSize,ke=Jt/2%E[Ot].length;Ce(ce,ye,Qe,sr,E[Ot][ke])}Rt+=w[Tt][Ut],++Jt,++Ut,Ut===w[Tt].length&&(Ut=0)}++Tt,Tt===w.length&&(Tt=0)}it+=T[lt],++ht,++lt,lt===T.length&&(lt=0)}function Ce(Ee,Ie,Se,Fe,Rr){var tr=n?1:e,Vr=mn(Rr,Ee*tr,Ie*tr,Se*tr,Fe*tr,s.color,s.symbolKeepAspect);if(n){var _r=i.painter.renderOneToVNode(Vr);_r&&O.children.push(_r)}else X9(W,Vr)}}}}function Z9(r){if(!r||r.length===0)return[["rect"]];if(ve(r))return[[r]];for(var t=!0,e=0;e<r.length;++e)if(!ve(r[e])){t=!1;break}if(t)return Z9([r]);for(var i=[],e=0;e<r.length;++e)ve(r[e])?i.push([r[e]]):i.push(r[e]);return i}function q9(r){if(!r||r.length===0)return[[0,0]];if(Fr(r)){var t=Math.ceil(r);return[[t,t]]}for(var e=!0,i=0;i<r.length;++i)if(!Fr(r[i])){e=!1;break}if(e)return q9([r]);for(var n=[],i=0;i<r.length;++i)if(Fr(r[i])){var t=Math.ceil(r[i]);n.push([t,t])}else{var t=te(r[i],function(o){return Math.ceil(o)});t.length%2===1?n.push(t.concat(t)):n.push(t)}return n}function Q1t(r){if(!r||typeof r=="object"&&r.length===0)return[0,0];if(Fr(r)){var t=Math.ceil(r);return[t,t]}var e=te(r,function(i){return Math.ceil(i)});return r.length%2?e.concat(e):e}function tbt(r){return te(r,function(t){return Y9(t)})}function Y9(r){for(var t=0,e=0;e<r.length;++e)t+=r[e];return r.length%2===1?t*2:t}function ebt(r,t){r.eachRawSeries(function(e){if(!r.isSeriesFiltered(e)){var i=e.getData();i.hasItemVisual()&&i.each(function(s){var o=i.getItemVisual(s,"decal");if(o){var l=i.ensureUniqueItemVisual(s,"style");l.decal=gg(o,t)}});var n=i.getVisual("decal");if(n){var a=i.getVisual("style");a.decal=gg(n,t)}}})}var rbt=new so;const Io=rbt;var K9={};function ibt(r,t){K9[r]=t}function nbt(r){return K9[r]}var abt=1,sbt=800,obt=900,lbt=1e3,ubt=2e3,cbt=5e3,J9=1e3,hbt=1100,bD=2e3,Q9=3e3,fbt=4e3,$S=4500,dbt=4600,pbt=5e3,gbt=6e3,tG=7e3,vbt={PROCESSOR:{FILTER:lbt,SERIES_FILTER:sbt,STATISTIC:cbt},VISUAL:{LAYOUT:J9,PROGRESSIVE_LAYOUT:hbt,GLOBAL:bD,CHART:Q9,POST_CHART_LAYOUT:dbt,COMPONENT:fbt,BRUSH:pbt,CHART_ITEM:$S,ARIA:gbt,DECAL:tG}},ya="__flagInMainProcess",os="__pendingUpdate",j2="__needsUpdateStatus",jz=/^[a-zA-Z0-9_]+$/,X2="__connectUpdateStatus",Xz=0,mbt=1,ybt=2;function eG(r){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.isDisposed()){this.id;return}return iG(this,r,t)}}function rG(r){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return iG(this,r,t)}}function iG(r,t,e){return e[0]=e[0]&&e[0].toLowerCase(),so.prototype[t].apply(r,e)}var nG=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(so),aG=nG.prototype;aG.on=rG("on");aG.off=rG("off");var cp,Z2,Jx,tc,q2,Y2,K2,pm,gm,Zz,qz,J2,Yz,Qx,Kz,sG,Vs,Jz,oG=function(r){Vt(t,r);function t(e,i,n){var a=r.call(this,new T1t)||this;a._chartsViews=[],a._chartsMap={},a._componentsViews=[],a._componentsMap={},a._pendingActions=[],n=n||{},ve(i)&&(i=lG[i]),a._dom=e;var s="canvas",o="auto",l=!1;n.ssr&&Kmt(function(p){var v=Je(p),y=v.dataIndex;if(y!=null){var x=Re();return x.set("series_index",v.seriesIndex),x.set("data_index",y),v.ssrType&&x.set("ssr_type",v.ssrType),x}});var u=a._zr=nB(e,{renderer:n.renderer||s,devicePixelRatio:n.devicePixelRatio,width:n.width,height:n.height,ssr:n.ssr,useDirtyRect:ir(n.useDirtyRect,l),useCoarsePointer:ir(n.useCoarsePointer,o),pointerSize:n.pointerSize});a._ssr=n.ssr,a._throttledZrFlush=yD(we(u.flush,u),17),i=Ze(i),i&&d9(i,!0),a._theme=i,a._locale=R0t(n.locale||V7),a._coordSysMgr=new D_;var c=a._api=Kz(a);function h(p,v){return p.__prio-v.__prio}return W1(hw,h),W1(SM,h),a._scheduler=new U9(a,c,SM,hw),a._messageCenter=new nG,a._initEvents(),a.resize=we(a.resize,a),u.animation.on("frame",a._onframe,a),Zz(u,a),qz(u,a),$b(a),a}return t.prototype._onframe=function(){if(!this._disposed){Jz(this);var e=this._scheduler;if(this[os]){var i=this[os].silent;this[ya]=!0;try{cp(this),tc.update.call(this,null,this[os].updateParams)}catch(l){throw this[ya]=!1,this[os]=null,l}this._zr.flush(),this[ya]=!1,this[os]=null,pm.call(this,i),gm.call(this,i)}else if(e.unfinished){var n=abt,a=this._model,s=this._api;e.unfinished=!1;do{var o=+new Date;e.performSeriesTasks(a),e.performDataProcessorTasks(a),Y2(this,a),e.performVisualTasks(a),Qx(this,this._model,s,"remain",{}),n-=+new Date-o}while(n>0&&e.unfinished);e.unfinished||this._zr.flush()}}},t.prototype.getDom=function(){return this._dom},t.prototype.getId=function(){return this.id},t.prototype.getZr=function(){return this._zr},t.prototype.isSSR=function(){return this._ssr},t.prototype.setOption=function(e,i,n){if(!this[ya]){if(this._disposed){this.id;return}var a,s,o;if(je(i)&&(n=i.lazyUpdate,a=i.silent,s=i.replaceMerge,o=i.transition,i=i.notMerge),this[ya]=!0,!this._model||i){var l=new uxt(this._api),u=this._theme,c=this._model=new c9;c.scheduler=this._scheduler,c.ssr=this._ssr,c.init(null,null,null,u,this._locale,l)}this._model.setOption(e,{replaceMerge:s},TM);var h={seriesTransition:o,optionChanged:!0};if(n)this[os]={silent:a,updateParams:h},this[ya]=!1,this.getZr().wakeUp();else{try{cp(this),tc.update.call(this,null,h)}catch(p){throw this[os]=null,this[ya]=!1,p}this._ssr||this._zr.flush(),this[os]=null,this[ya]=!1,pm.call(this,a),gm.call(this,a)}}},t.prototype.setTheme=function(){},t.prototype.getModel=function(){return this._model},t.prototype.getOption=function(){return this._model&&this._model.getOption()},t.prototype.getWidth=function(){return this._zr.getWidth()},t.prototype.getHeight=function(){return this._zr.getHeight()},t.prototype.getDevicePixelRatio=function(){return this._zr.painter.dpr||Or.hasGlobalWindow&&window.devicePixelRatio||1},t.prototype.getRenderedCanvas=function(e){return this.renderToCanvas(e)},t.prototype.renderToCanvas=function(e){e=e||{};var i=this._zr.painter;return i.getRenderedCanvas({backgroundColor:e.backgroundColor||this._model.get("backgroundColor"),pixelRatio:e.pixelRatio||this.getDevicePixelRatio()})},t.prototype.renderToSVGString=function(e){e=e||{};var i=this._zr.painter;return i.renderToString({useViewBox:e.useViewBox})},t.prototype.getSvgDataURL=function(){if(Or.svgSupported){var e=this._zr,i=e.storage.getDisplayList();return J(i,function(n){n.stopAnimation(null,!0)}),e.painter.toDataURL()}},t.prototype.getDataURL=function(e){if(this._disposed){this.id;return}e=e||{};var i=e.excludeComponents,n=this._model,a=[],s=this;J(i,function(l){n.eachComponent({mainType:l},function(u){var c=s._componentsMap[u.__viewId];c.group.ignore||(a.push(c),c.group.ignore=!0)})});var o=this._zr.painter.getType()==="svg"?this.getSvgDataURL():this.renderToCanvas(e).toDataURL("image/"+(e&&e.type||"png"));return J(a,function(l){l.group.ignore=!1}),o},t.prototype.getConnectedDataURL=function(e){if(this._disposed){this.id;return}var i=e.type==="svg",n=this.group,a=Math.min,s=Math.max,o=1/0;if(Qz[n]){var l=o,u=o,c=-o,h=-o,p=[],v=e&&e.pixelRatio||this.getDevicePixelRatio();J(py,function(M,L){if(M.group===n){var F=i?M.getZr().painter.getSvgDom().innerHTML:M.renderToCanvas(Ze(e)),O=M.getDom().getBoundingClientRect();l=a(O.left,l),u=a(O.top,u),c=s(O.right,c),h=s(O.bottom,h),p.push({dom:F,left:O.left,top:O.top})}}),l*=v,u*=v,c*=v,h*=v;var y=c-l,x=h-u,w=Vc.createCanvas(),T=nB(w,{renderer:i?"svg":"canvas"});if(T.resize({width:y,height:x}),i){var E="";return J(p,function(M){var L=M.left-l,F=M.top-u;E+='<g transform="translate('+L+","+F+')">'+M.dom+"</g>"}),T.painter.getSvgRoot().innerHTML=E,e.connectedBackgroundColor&&T.painter.setBackgroundColor(e.connectedBackgroundColor),T.refreshImmediately(),T.painter.toDataURL()}else return e.connectedBackgroundColor&&T.add(new Pr({shape:{x:0,y:0,width:y,height:x},style:{fill:e.connectedBackgroundColor}})),J(p,function(M){var L=new ia({style:{x:M.left*v-l,y:M.top*v-u,image:M.dom}});T.add(L)}),T.refreshImmediately(),w.toDataURL("image/"+(e&&e.type||"png"))}else return this.getDataURL(e)},t.prototype.convertToPixel=function(e,i){return q2(this,"convertToPixel",e,i)},t.prototype.convertFromPixel=function(e,i){return q2(this,"convertFromPixel",e,i)},t.prototype.containPixel=function(e,i){if(this._disposed){this.id;return}var n=this._model,a,s=oy(n,e);return J(s,function(o,l){l.indexOf("Models")>=0&&J(o,function(u){var c=u.coordinateSystem;if(c&&c.containPoint)a=a||!!c.containPoint(i);else if(l==="seriesModels"){var h=this._chartsMap[u.__viewId];h&&h.containPoint&&(a=a||h.containPoint(i,u))}},this)},this),!!a},t.prototype.getVisual=function(e,i){var n=this._model,a=oy(n,e,{defaultMainType:"series"}),s=a.seriesModel,o=s.getData(),l=a.hasOwnProperty("dataIndexInside")?a.dataIndexInside:a.hasOwnProperty("dataIndex")?o.indexOfRawIndex(a.dataIndex):null;return l!=null?_D(o,l,i):L_(o,i)},t.prototype.getViewOfComponentModel=function(e){return this._componentsMap[e.__viewId]},t.prototype.getViewOfSeriesModel=function(e){return this._chartsMap[e.__viewId]},t.prototype._initEvents=function(){var e=this;J(_bt,function(i){var n=function(a){var s=e.getModel(),o=a.target,l,u=i==="globalout";if(u?l={}:o&&mf(o,function(y){var x=Je(y);if(x&&x.dataIndex!=null){var w=x.dataModel||s.getSeriesByIndex(x.seriesIndex);return l=w&&w.getDataParams(x.dataIndex,x.dataType,o)||{},!0}else if(x.eventData)return l=Zt({},x.eventData),!0},!0),l){var c=l.componentType,h=l.componentIndex;(c==="markLine"||c==="markPoint"||c==="markArea")&&(c="series",h=l.seriesIndex);var p=c&&h!=null&&s.getComponent(c,h),v=p&&e[p.mainType==="series"?"_chartsMap":"_componentsMap"][p.__viewId];l.event=a,l.type=i,e._$eventProcessor.eventInfo={targetEl:o,packedEvent:l,model:p,view:v},e.trigger(i,l)}};n.zrEventfulCallAtLast=!0,e._zr.on(i,n,e)}),J(dy,function(i,n){e._messageCenter.on(n,function(a){this.trigger(n,a)},e)}),J(["selectchanged"],function(i){e._messageCenter.on(i,function(n){this.trigger(i,n)},e)}),E1t(this._messageCenter,this,this._api)},t.prototype.isDisposed=function(){return this._disposed},t.prototype.clear=function(){if(this._disposed){this.id;return}this.setOption({series:[]},!0)},t.prototype.dispose=function(){if(this._disposed){this.id;return}this._disposed=!0;var e=this.getDom();e&&zH(this.getDom(),SD,"");var i=this,n=i._api,a=i._model;J(i._componentsViews,function(s){s.dispose(a,n)}),J(i._chartsViews,function(s){s.dispose(a,n)}),i._zr.dispose(),i._dom=i._model=i._chartsMap=i._componentsMap=i._chartsViews=i._componentsViews=i._scheduler=i._api=i._zr=i._throttledZrFlush=i._theme=i._coordSysMgr=i._messageCenter=null,delete py[i.id]},t.prototype.resize=function(e){if(!this[ya]){if(this._disposed){this.id;return}this._zr.resize(e);var i=this._model;if(this._loadingFX&&this._loadingFX.resize(),!!i){var n=i.resetOption("media"),a=e&&e.silent;this[os]&&(a==null&&(a=this[os].silent),n=!0,this[os]=null),this[ya]=!0;try{n&&cp(this),tc.update.call(this,{type:"resize",animation:Zt({duration:0},e&&e.animation)})}catch(s){throw this[ya]=!1,s}this[ya]=!1,pm.call(this,a),gm.call(this,a)}}},t.prototype.showLoading=function(e,i){if(this._disposed){this.id;return}if(je(e)&&(i=e,e=""),e=e||"default",this.hideLoading(),!!AM[e]){var n=AM[e](this._api,i),a=this._zr;this._loadingFX=n,a.add(n)}},t.prototype.hideLoading=function(){if(this._disposed){this.id;return}this._loadingFX&&this._zr.remove(this._loadingFX),this._loadingFX=null},t.prototype.makeActionFromEvent=function(e){var i=Zt({},e);return i.type=dy[e.type],i},t.prototype.dispatchAction=function(e,i){if(this._disposed){this.id;return}if(je(i)||(i={silent:!!i}),!!cw[e.type]&&this._model){if(this[ya]){this._pendingActions.push(e);return}var n=i.silent;K2.call(this,e,n);var a=i.flush;a?this._zr.flush():a!==!1&&Or.browser.weChat&&this._throttledZrFlush(),pm.call(this,n),gm.call(this,n)}},t.prototype.updateLabelLayout=function(){Io.trigger("series:layoutlabels",this._model,this._api,{updatedSeries:[]})},t.prototype.appendData=function(e){if(this._disposed){this.id;return}var i=e.seriesIndex,n=this.getModel(),a=n.getSeriesByIndex(i);a.appendData(e),this._scheduler.unfinished=!0,this.getZr().wakeUp()},t.internalField=function(){cp=function(h){var p=h._scheduler;p.restorePipelines(h._model),p.prepareStageTasks(),Z2(h,!0),Z2(h,!1),p.plan()},Z2=function(h,p){for(var v=h._model,y=h._scheduler,x=p?h._componentsViews:h._chartsViews,w=p?h._componentsMap:h._chartsMap,T=h._zr,E=h._api,M=0;M<x.length;M++)x[M].__alive=!1;p?v.eachComponent(function(O,U){O!=="series"&&L(U)}):v.eachSeries(L);function L(O){var U=O.__requireNewView;O.__requireNewView=!1;var W="_ec_"+O.id+"_"+O.type,H=!U&&w[W];if(!H){var j=vl(O.type),Y=p?$i.getClass(j.main,j.sub):di.getClass(j.sub);H=new Y,H.init(v,E),w[W]=H,x.push(H),T.add(H.group)}O.__viewId=H.__id=W,H.__alive=!0,H.__model=O,H.group.__ecComponentInfo={mainType:O.mainType,index:O.componentIndex},!p&&y.prepareView(H,O,v,E)}for(var M=0;M<x.length;){var F=x[M];F.__alive?M++:(!p&&F.renderTask.dispose(),T.remove(F.group),F.dispose(v,E),x.splice(M,1),w[F.__id]===F&&delete w[F.__id],F.__id=F.group.__ecComponentInfo=null)}},Jx=function(h,p,v,y,x){var w=h._model;if(w.setUpdatePayload(v),!y){J([].concat(h._componentsViews).concat(h._chartsViews),F);return}var T={};T[y+"Id"]=v[y+"Id"],T[y+"Index"]=v[y+"Index"],T[y+"Name"]=v[y+"Name"];var E={mainType:y,query:T};x&&(E.subType=x);var M=v.excludeSeriesId,L;M!=null&&(L=Re(),J(ri(M),function(O){var U=xn(O,null);U!=null&&L.set(U,!0)})),w&&w.eachComponent(E,function(O){var U=L&&L.get(O.id)!=null;if(!U)if(kB(v))if(O instanceof Li)v.type===Ef&&!v.notBlur&&!O.get(["emphasis","disabled"])&&S_t(O,v,h._api);else{var W=qR(O.mainType,O.componentIndex,v.name,h._api),H=W.focusSelf,j=W.dispatchers;v.type===Ef&&H&&!v.notBlur&&aM(O.mainType,O.componentIndex,h._api),j&&J(j,function(Y){v.type===Ef?vu(Y):mu(Y)})}else oM(v)&&O instanceof Li&&(C_t(O,v,h._api),DB(O),Vs(h))},h),w&&w.eachComponent(E,function(O){var U=L&&L.get(O.id)!=null;U||F(h[y==="series"?"_chartsMap":"_componentsMap"][O.__viewId])},h);function F(O){O&&O.__alive&&O[p]&&O[p](O.__model,w,h._api,v)}},tc={prepareAndUpdate:function(h){cp(this),tc.update.call(this,h,{optionChanged:h.newOption!=null})},update:function(h,p){var v=this._model,y=this._api,x=this._zr,w=this._coordSysMgr,T=this._scheduler;if(v){v.setUpdatePayload(h),T.restoreData(v,h),T.performSeriesTasks(v),w.create(v,y),T.performDataProcessorTasks(v,h),Y2(this,v),w.update(v,y),e(v),T.performVisualTasks(v,h),J2(this,v,y,h,p);var E=v.get("backgroundColor")||"transparent",M=v.get("darkMode");x.setBackgroundColor(E),M!=null&&M!=="auto"&&x.setDarkMode(M),Io.trigger("afterupdate",v,y)}},updateTransform:function(h){var p=this,v=this._model,y=this._api;if(v){v.setUpdatePayload(h);var x=[];v.eachComponent(function(T,E){if(T!=="series"){var M=p.getViewOfComponentModel(E);if(M&&M.__alive)if(M.updateTransform){var L=M.updateTransform(E,v,y,h);L&&L.update&&x.push(M)}else x.push(M)}});var w=Re();v.eachSeries(function(T){var E=p._chartsMap[T.__viewId];if(E.updateTransform){var M=E.updateTransform(T,v,y,h);M&&M.update&&w.set(T.uid,1)}else w.set(T.uid,1)}),e(v),this._scheduler.performVisualTasks(v,h,{setDirty:!0,dirtyMap:w}),Qx(this,v,y,h,{},w),Io.trigger("afterupdate",v,y)}},updateView:function(h){var p=this._model;p&&(p.setUpdatePayload(h),di.markUpdateMethod(h,"updateView"),e(p),this._scheduler.performVisualTasks(p,h,{setDirty:!0}),J2(this,p,this._api,h,{}),Io.trigger("afterupdate",p,this._api))},updateVisual:function(h){var p=this,v=this._model;v&&(v.setUpdatePayload(h),v.eachSeries(function(y){y.getData().clearAllVisual()}),di.markUpdateMethod(h,"updateVisual"),e(v),this._scheduler.performVisualTasks(v,h,{visualType:"visual",setDirty:!0}),v.eachComponent(function(y,x){if(y!=="series"){var w=p.getViewOfComponentModel(x);w&&w.__alive&&w.updateVisual(x,v,p._api,h)}}),v.eachSeries(function(y){var x=p._chartsMap[y.__viewId];x.updateVisual(y,v,p._api,h)}),Io.trigger("afterupdate",v,this._api))},updateLayout:function(h){tc.update.call(this,h)}},q2=function(h,p,v,y){if(h._disposed){h.id;return}for(var x=h._model,w=h._coordSysMgr.getCoordinateSystems(),T,E=oy(x,v),M=0;M<w.length;M++){var L=w[M];if(L[p]&&(T=L[p](x,E,y))!=null)return T}},Y2=function(h,p){var v=h._chartsMap,y=h._scheduler;p.eachSeries(function(x){y.updateStreamModes(x,v[x.__viewId])})},K2=function(h,p){var v=this,y=this.getModel(),x=h.type,w=h.escapeConnect,T=cw[x],E=T.actionInfo,M=(E.update||"update").split(":"),L=M.pop(),F=M[0]!=null&&vl(M[0]);this[ya]=!0;var O=[h],U=!1;h.batch&&(U=!0,O=te(h.batch,function(lt){return lt=We(Zt({},lt),h),lt.batch=null,lt}));var W=[],H,j=oM(h),Y=kB(h);if(Y&&c7(this._api),J(O,function(lt){if(H=T.action(lt,v._model,v._api),H=H||Zt({},lt),H.type=E.event||H.type,W.push(H),Y){var ht=UR(h),Tt=ht.queryOptionMap,Ot=ht.mainTypeSpecified,Rt=Ot?Tt.keys()[0]:"series";Jx(v,L,lt,Rt),Vs(v)}else j?(Jx(v,L,lt,"series"),Vs(v)):F&&Jx(v,L,lt,F.main,F.sub)}),L!=="none"&&!Y&&!j&&!F)try{this[os]?(cp(this),tc.update.call(this,h),this[os]=null):tc[L].call(this,h)}catch(lt){throw this[ya]=!1,lt}if(U?H={type:E.event||x,escapeConnect:w,batch:W}:H=W[0],this[ya]=!1,!p){var tt=this._messageCenter;if(tt.trigger(H.type,H),j){var it={type:"selectchanged",escapeConnect:w,selected:E_t(y),isFromClick:h.isFromClick||!1,fromAction:h.type,fromActionPayload:h};tt.trigger(it.type,it)}}},pm=function(h){for(var p=this._pendingActions;p.length;){var v=p.shift();K2.call(this,v,h)}},gm=function(h){!h&&this.trigger("updated")},Zz=function(h,p){h.on("rendered",function(v){p.trigger("rendered",v),h.animation.isFinished()&&!p[os]&&!p._scheduler.unfinished&&!p._pendingActions.length&&p.trigger("finished")})},qz=function(h,p){h.on("mouseover",function(v){var y=v.target,x=mf(y,Xy);x&&(T_t(x,v,p._api),Vs(p))}).on("mouseout",function(v){var y=v.target,x=mf(y,Xy);x&&(A_t(x,v,p._api),Vs(p))}).on("click",function(v){var y=v.target,x=mf(y,function(E){return Je(E).dataIndex!=null},!0);if(x){var w=x.selected?"unselect":"select",T=Je(x);p._api.dispatchAction({type:w,dataType:T.dataType,dataIndexInside:T.dataIndex,seriesIndex:T.seriesIndex,isFromClick:!0})}})};function e(h){h.clearColorPalette(),h.eachSeries(function(p){p.clearColorPalette()})}function i(h){var p=[],v=[],y=!1;if(h.eachComponent(function(E,M){var L=M.get("zlevel")||0,F=M.get("z")||0,O=M.getZLevelKey();y=y||!!O,(E==="series"?v:p).push({zlevel:L,z:F,idx:M.componentIndex,type:E,key:O})}),y){var x=p.concat(v),w,T;W1(x,function(E,M){return E.zlevel===M.zlevel?E.z-M.z:E.zlevel-M.zlevel}),J(x,function(E){var M=h.getComponent(E.type,E.idx),L=E.zlevel,F=E.key;w!=null&&(L=Math.max(w,L)),F?(L===w&&F!==T&&L++,T=F):T&&(L===w&&L++,T=""),w=L,M.setZLevel(L)})}}J2=function(h,p,v,y,x){i(p),Yz(h,p,v,y,x),J(h._chartsViews,function(w){w.__alive=!1}),Qx(h,p,v,y,x),J(h._chartsViews,function(w){w.__alive||w.remove(p,v)})},Yz=function(h,p,v,y,x,w){J(w||h._componentsViews,function(T){var E=T.__model;u(E,T),T.render(E,p,v,y),o(E,T),c(E,T)})},Qx=function(h,p,v,y,x,w){var T=h._scheduler;x=Zt(x||{},{updatedSeries:p.getSeries()}),Io.trigger("series:beforeupdate",p,v,x);var E=!1;p.eachSeries(function(M){var L=h._chartsMap[M.__viewId];L.__alive=!0;var F=L.renderTask;T.updatePayload(F,y),u(M,L),w&&w.get(M.uid)&&F.dirty(),F.perform(T.getPerformArgs(F))&&(E=!0),L.group.silent=!!M.get("silent"),s(M,L),DB(M)}),T.unfinished=E||T.unfinished,Io.trigger("series:layoutlabels",p,v,x),Io.trigger("series:transition",p,v,x),p.eachSeries(function(M){var L=h._chartsMap[M.__viewId];o(M,L),c(M,L)}),a(h,p),Io.trigger("series:afterupdate",p,v,x)},Vs=function(h){h[j2]=!0,h.getZr().wakeUp()},Jz=function(h){h[j2]&&(h.getZr().storage.traverse(function(p){Yp(p)||n(p)}),h[j2]=!1)};function n(h){for(var p=[],v=h.currentStates,y=0;y<v.length;y++){var x=v[y];x==="emphasis"||x==="blur"||x==="select"||p.push(x)}h.selected&&h.states.select&&p.push("select"),h.hoverState===AS&&h.states.emphasis?p.push("emphasis"):h.hoverState===I_&&h.states.blur&&p.push("blur"),h.useStates(p)}function a(h,p){var v=h._zr,y=v.storage,x=0;y.traverse(function(w){w.isGroup||x++}),x>p.get("hoverLayerThreshold")&&!Or.node&&!Or.worker&&p.eachSeries(function(w){if(!w.preventUsingHoverLayer){var T=h._chartsMap[w.__viewId];T.__alive&&T.eachRendered(function(E){E.states.emphasis&&(E.states.emphasis.hoverLayer=!0)})}})}function s(h,p){var v=h.get("blendMode")||null;p.eachRendered(function(y){y.isGroup||(y.style.blend=v)})}function o(h,p){if(!h.preventAutoZ){var v=h.get("z")||0,y=h.get("zlevel")||0;p.eachRendered(function(x){return l(x,v,y,-1/0),!0})}}function l(h,p,v,y){var x=h.getTextContent(),w=h.getTextGuideLine(),T=h.isGroup;if(T)for(var E=h.childrenRef(),M=0;M<E.length;M++)y=Math.max(l(E[M],p,v,y),y);else h.z=p,h.zlevel=v,y=Math.max(h.z2,y);if(x&&(x.z=p,x.zlevel=v,isFinite(y)&&(x.z2=y+2)),w){var L=h.textGuideLineConfig;w.z=p,w.zlevel=v,isFinite(y)&&(w.z2=y+(L&&L.showAbove?1:-1))}return y}function u(h,p){p.eachRendered(function(v){if(!Yp(v)){var y=v.getTextContent(),x=v.getTextGuideLine();v.stateTransition&&(v.stateTransition=null),y&&y.stateTransition&&(y.stateTransition=null),x&&x.stateTransition&&(x.stateTransition=null),v.hasState()?(v.prevStates=v.currentStates,v.clearStates()):v.prevStates&&(v.prevStates=null)}})}function c(h,p){var v=h.getModel("stateAnimation"),y=h.isAnimationEnabled(),x=v.get("duration"),w=x>0?{duration:x,delay:v.get("delay"),easing:v.get("easing")}:null;p.eachRendered(function(T){if(T.states&&T.states.emphasis){if(Yp(T))return;if(T instanceof vr&&D_t(T),T.__dirty){var E=T.prevStates;E&&T.useStates(E)}if(y){T.stateTransition=w;var M=T.getTextContent(),L=T.getTextGuideLine();M&&(M.stateTransition=w),L&&(L.stateTransition=w)}T.__dirty&&n(T)}})}Kz=function(h){return new(function(p){Vt(v,p);function v(){return p!==null&&p.apply(this,arguments)||this}return v.prototype.getCoordinateSystems=function(){return h._coordSysMgr.getCoordinateSystems()},v.prototype.getComponentByElement=function(y){for(;y;){var x=y.__ecComponentInfo;if(x!=null)return h._model.getComponent(x.mainType,x.index);y=y.parent}},v.prototype.enterEmphasis=function(y,x){vu(y,x),Vs(h)},v.prototype.leaveEmphasis=function(y,x){mu(y,x),Vs(h)},v.prototype.enterBlur=function(y){s7(y),Vs(h)},v.prototype.leaveBlur=function(y){ZR(y),Vs(h)},v.prototype.enterSelect=function(y){o7(y),Vs(h)},v.prototype.leaveSelect=function(y){l7(y),Vs(h)},v.prototype.getModel=function(){return h.getModel()},v.prototype.getViewOfComponentModel=function(y){return h.getViewOfComponentModel(y)},v.prototype.getViewOfSeriesModel=function(y){return h.getViewOfSeriesModel(y)},v}(h9))(h)},sG=function(h){function p(v,y){for(var x=0;x<v.length;x++){var w=v[x];w[X2]=y}}J(dy,function(v,y){h._messageCenter.on(y,function(x){if(Qz[h.group]&&h[X2]!==Xz){if(x&&x.escapeConnect)return;var w=h.makeActionFromEvent(x),T=[];J(py,function(E){E!==h&&E.group===h.group&&T.push(E)}),p(T,Xz),J(T,function(E){E[X2]!==mbt&&E.dispatchAction(w)}),p(T,ybt)}})})}}(),t}(so),wD=oG.prototype;wD.on=eG("on");wD.off=eG("off");wD.one=function(r,t,e){var i=this;function n(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];t&&t.apply&&t.apply(this,a),i.off(r,n)}this.on.call(this,r,n,e)};var _bt=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","globalout","contextmenu"];var cw={},dy={},SM=[],TM=[],hw=[],lG={},AM={},py={},Qz={},xbt=+new Date-0,SD="_echarts_instance_";function bbt(r,t,e){var i=!(e&&e.ssr);if(i){var n=wbt(r);if(n)return n}var a=new oG(r,t,e);return a.id="ec_"+xbt++,py[a.id]=a,i&&zH(r,SD,a.id),sG(a),Io.trigger("afterinit",a),a}function wbt(r){return py[myt(r,SD)]}function uG(r,t){lG[r]=t}function cG(r){pr(TM,r)<0&&TM.push(r)}function hG(r,t){AD(SM,r,t,ubt)}function Sbt(r){TD("afterinit",r)}function Tbt(r){TD("afterupdate",r)}function TD(r,t){Io.on(r,t)}function Il(r,t,e){Ve(t)&&(e=t,t="");var i=je(r)?r.type:[r,r={event:t}][0];r.event=(r.event||i).toLowerCase(),t=r.event,!dy[t]&&(Za(jz.test(i)&&jz.test(t)),cw[i]||(cw[i]={action:e,actionInfo:r}),dy[t]=i)}function Abt(r,t){D_.register(r,t)}function Cbt(r,t){AD(hw,r,t,J9,"layout")}function nd(r,t){AD(hw,r,t,Q9,"visual")}var t5=[];function AD(r,t,e,i,n){if((Ve(t)||je(t))&&(e=t,t=i),!(pr(t5,e)>=0)){t5.push(e);var a=U9.wrapStageHandler(e,n);a.__prio=t,a.__raw=e,r.push(a)}}function fG(r,t){AM[r]=t}function Ebt(r,t,e){var i=nbt("registerMap");i&&i(r,t,e)}var Ibt=Fxt;nd(bD,l1t);nd($S,u1t);nd($S,c1t);nd(bD,A1t);nd($S,C1t);nd(tG,ebt);cG(d9);hG(obt,mxt);fG("default",h1t);Il({type:Ef,event:Ef,update:Ef},nn);Il({type:q1,event:q1,update:q1},nn);Il({type:ly,event:ly,update:ly},nn);Il({type:Y1,event:Y1,update:Y1},nn);Il({type:uy,event:uy,update:uy},nn);uG("light",w1t);uG("dark",S1t);var e5=[],Mbt={registerPreprocessor:cG,registerProcessor:hG,registerPostInit:Sbt,registerPostUpdate:Tbt,registerUpdateLifecycle:TD,registerAction:Il,registerCoordinateSystem:Abt,registerLayout:Cbt,registerVisual:nd,registerTransform:Ibt,registerLoading:fG,registerMap:Ebt,registerImpl:ibt,PRIORITY:vbt,ComponentModel:kr,ComponentView:$i,SeriesModel:Li,ChartView:di,registerComponentModel:function(r){kr.registerClass(r)},registerComponentView:function(r){$i.registerClass(r)},registerSeriesModel:function(r){Li.registerClass(r)},registerChartView:function(r){di.registerClass(r)},registerSubTypeDefaulter:function(r,t){kr.registerSubTypeDefaulter(r,t)},registerPainter:function(r,t){qmt(r,t)}};function gr(r){if(Kt(r)){J(r,function(t){gr(t)});return}pr(e5,r)>=0||(e5.push(r),Ve(r)&&(r={install:r}),r.install(Mbt))}function vm(r){return r==null?0:r.length||1}function r5(r){return r}var Pbt=function(){function r(t,e,i,n,a,s){this._old=t,this._new=e,this._oldKeyGetter=i||r5,this._newKeyGetter=n||r5,this.context=a,this._diffModeMultiple=s==="multiple"}return r.prototype.add=function(t){return this._add=t,this},r.prototype.update=function(t){return this._update=t,this},r.prototype.updateManyToOne=function(t){return this._updateManyToOne=t,this},r.prototype.updateOneToMany=function(t){return this._updateOneToMany=t,this},r.prototype.updateManyToMany=function(t){return this._updateManyToMany=t,this},r.prototype.remove=function(t){return this._remove=t,this},r.prototype.execute=function(){this[this._diffModeMultiple?"_executeMultiple":"_executeOneToOne"]()},r.prototype._executeOneToOne=function(){var t=this._old,e=this._new,i={},n=new Array(t.length),a=new Array(e.length);this._initIndexMap(t,null,n,"_oldKeyGetter"),this._initIndexMap(e,i,a,"_newKeyGetter");for(var s=0;s<t.length;s++){var o=n[s],l=i[o],u=vm(l);if(u>1){var c=l.shift();l.length===1&&(i[o]=l[0]),this._update&&this._update(c,s)}else u===1?(i[o]=null,this._update&&this._update(l,s)):this._remove&&this._remove(s)}this._performRestAdd(a,i)},r.prototype._executeMultiple=function(){var t=this._old,e=this._new,i={},n={},a=[],s=[];this._initIndexMap(t,i,a,"_oldKeyGetter"),this._initIndexMap(e,n,s,"_newKeyGetter");for(var o=0;o<a.length;o++){var l=a[o],u=i[l],c=n[l],h=vm(u),p=vm(c);if(h>1&&p===1)this._updateManyToOne&&this._updateManyToOne(c,u),n[l]=null;else if(h===1&&p>1)this._updateOneToMany&&this._updateOneToMany(c,u),n[l]=null;else if(h===1&&p===1)this._update&&this._update(c,u),n[l]=null;else if(h>1&&p>1)this._updateManyToMany&&this._updateManyToMany(c,u),n[l]=null;else if(h>1)for(var v=0;v<h;v++)this._remove&&this._remove(u[v]);else this._remove&&this._remove(u)}this._performRestAdd(s,n)},r.prototype._performRestAdd=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],a=e[n],s=vm(a);if(s>1)for(var o=0;o<s;o++)this._add&&this._add(a[o]);else s===1&&this._add&&this._add(a);e[n]=null}},r.prototype._initIndexMap=function(t,e,i,n){for(var a=this._diffModeMultiple,s=0;s<t.length;s++){var o="_ec_"+this[n](t[s],s);if(a||(i[s]=o),!!e){var l=e[o],u=vm(l);u===0?(e[o]=s,a&&i.push(o)):u===1?e[o]=[l,s]:l.push(s)}}},r}();const yu=Pbt;var Rbt=function(){function r(t,e){this._encode=t,this._schema=e}return r.prototype.get=function(){return{fullDimensions:this._getFullDimensionNames(),encode:this._encode}},r.prototype._getFullDimensionNames=function(){return this._cachedDimNames||(this._cachedDimNames=this._schema?this._schema.makeOutputDimensionNames():[]),this._cachedDimNames},r}();function Dbt(r,t){var e={},i=e.encode={},n=Re(),a=[],s=[],o={};J(r.dimensions,function(p){var v=r.getDimensionInfo(p),y=v.coordDim;if(y){var x=v.coordDimIndex;Q2(i,y)[x]=p,v.isExtraCoord||(n.set(y,1),Lbt(v.type)&&(a[0]=p),Q2(o,y)[x]=r.getDimensionIndex(v.name)),v.defaultTooltip&&s.push(p)}r9.each(function(w,T){var E=Q2(i,T),M=v.otherDims[T];M!=null&&M!==!1&&(E[M]=v.name)})});var l=[],u={};n.each(function(p,v){var y=i[v];u[v]=y[0],l=l.concat(y)}),e.dataDimsOnCoord=l,e.dataDimIndicesOnCoord=te(l,function(p){return r.getDimensionInfo(p).storeDimIndex}),e.encodeFirstDimNotExtra=u;var c=i.label;c&&c.length&&(a=c.slice());var h=i.tooltip;return h&&h.length?s=h.slice():s.length||(s=a.slice()),i.defaultedLabel=a,i.defaultedTooltip=s,e.userOutput=new Rbt(o,t),e}function Q2(r,t){return r.hasOwnProperty(t)||(r[t]=[]),r[t]}function fw(r){return r==="category"?"ordinal":r==="time"?"time":"float"}function Lbt(r){return!(r==="ordinal"||r==="time")}var kbt=function(){function r(t){this.otherDims={},t!=null&&Zt(this,t)}return r}();const eb=kbt;var Obt=Ir(),Nbt={float:"f",int:"i",ordinal:"o",number:"n",time:"t"},dG=function(){function r(t){this.dimensions=t.dimensions,this._dimOmitted=t.dimensionOmitted,this.source=t.source,this._fullDimCount=t.fullDimensionCount,this._updateDimOmitted(t.dimensionOmitted)}return r.prototype.isDimensionOmitted=function(){return this._dimOmitted},r.prototype._updateDimOmitted=function(t){this._dimOmitted=t,t&&(this._dimNameMap||(this._dimNameMap=vG(this.source)))},r.prototype.getSourceDimensionIndex=function(t){return ir(this._dimNameMap.get(t),-1)},r.prototype.getSourceDimension=function(t){var e=this.source.dimensionsDefine;if(e)return e[t]},r.prototype.makeStoreSchema=function(){for(var t=this._fullDimCount,e=g9(this.source),i=!mG(t),n="",a=[],s=0,o=0;s<t;s++){var l=void 0,u=void 0,c=void 0,h=this.dimensions[o];if(h&&h.storeDimIndex===s)l=e?h.name:null,u=h.type,c=h.ordinalMeta,o++;else{var p=this.getSourceDimension(s);p&&(l=e?p.name:null,u=p.type)}a.push({property:l,type:u,ordinalMeta:c}),e&&l!=null&&(!h||!h.isCalculationCoord)&&(n+=i?l.replace(/\`/g,"`1").replace(/\$/g,"`2"):l),n+="$",n+=Nbt[u]||"f",c&&(n+=c.uid),n+="$"}var v=this.source,y=[v.seriesLayoutBy,v.startIndex,n].join("$$");return{dimensions:a,hash:y}},r.prototype.makeOutputDimensionNames=function(){for(var t=[],e=0,i=0;e<this._fullDimCount;e++){var n=void 0,a=this.dimensions[i];if(a&&a.storeDimIndex===e)a.isCalculationCoord||(n=a.name),i++;else{var s=this.getSourceDimension(e);s&&(n=s.name)}t.push(n)}return t},r.prototype.appendCalculationDimension=function(t){this.dimensions.push(t),t.isCalculationCoord=!0,this._fullDimCount++,this._updateDimOmitted(!0)},r}();function pG(r){return r instanceof dG}function gG(r){for(var t=Re(),e=0;e<(r||[]).length;e++){var i=r[e],n=je(i)?i.name:i;n!=null&&t.get(n)==null&&t.set(n,e)}return t}function vG(r){var t=Obt(r);return t.dimNameMap||(t.dimNameMap=gG(r.dimensionsDefine))}function mG(r){return r>30}var mm=je,ec=te,Fbt=typeof Int32Array>"u"?Array:Int32Array,Bbt="e\0\0",i5=-1,zbt=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_dimSummary","userOutput","_rawData","_dimValueGetter","_nameDimIdx","_idDimIdx","_nameRepeatCount"],Vbt=["_approximateExtent"],n5,t1,ym,_m,tC,e1,eC,Ubt=function(){function r(t,e){this.type="list",this._dimOmitted=!1,this._nameList=[],this._idList=[],this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._approximateExtent={},this._calculationInfo={},this.hasItemOption=!1,this.TRANSFERABLE_METHODS=["cloneShallow","downSample","lttbDownSample","map"],this.CHANGABLE_METHODS=["filterSelf","selectRange"],this.DOWNSAMPLE_METHODS=["downSample","lttbDownSample"];var i,n=!1;pG(t)?(i=t.dimensions,this._dimOmitted=t.isDimensionOmitted(),this._schema=t):(n=!0,i=t),i=i||["x","y"];for(var a={},s=[],o={},l=!1,u={},c=0;c<i.length;c++){var h=i[c],p=ve(h)?new eb({name:h}):h instanceof eb?h:new eb(h),v=p.name;p.type=p.type||"float",p.coordDim||(p.coordDim=v,p.coordDimIndex=0);var y=p.otherDims=p.otherDims||{};s.push(v),a[v]=p,u[v]!=null&&(l=!0),p.createInvertedIndices&&(o[v]=[]),y.itemName===0&&(this._nameDimIdx=c),y.itemId===0&&(this._idDimIdx=c),n&&(p.storeDimIndex=c)}if(this.dimensions=s,this._dimInfos=a,this._initGetDimensionInfo(l),this.hostModel=e,this._invertedIndicesMap=o,this._dimOmitted){var x=this._dimIdxToName=Re();J(s,function(w){x.set(a[w].storeDimIndex,w)})}}return r.prototype.getDimension=function(t){var e=this._recognizeDimIndex(t);if(e==null)return t;if(e=t,!this._dimOmitted)return this.dimensions[e];var i=this._dimIdxToName.get(e);if(i!=null)return i;var n=this._schema.getSourceDimension(e);if(n)return n.name},r.prototype.getDimensionIndex=function(t){var e=this._recognizeDimIndex(t);if(e!=null)return e;if(t==null)return-1;var i=this._getDimInfo(t);return i?i.storeDimIndex:this._dimOmitted?this._schema.getSourceDimensionIndex(t):-1},r.prototype._recognizeDimIndex=function(t){if(Fr(t)||t!=null&&!isNaN(t)&&!this._getDimInfo(t)&&(!this._dimOmitted||this._schema.getSourceDimensionIndex(t)<0))return+t},r.prototype._getStoreDimIndex=function(t){var e=this.getDimensionIndex(t);return e},r.prototype.getDimensionInfo=function(t){return this._getDimInfo(this.getDimension(t))},r.prototype._initGetDimensionInfo=function(t){var e=this._dimInfos;this._getDimInfo=t?function(i){return e.hasOwnProperty(i)?e[i]:void 0}:function(i){return e[i]}},r.prototype.getDimensionsOnCoord=function(){return this._dimSummary.dataDimsOnCoord.slice()},r.prototype.mapDimension=function(t,e){var i=this._dimSummary;if(e==null)return i.encodeFirstDimNotExtra[t];var n=i.encode[t];return n?n[e]:null},r.prototype.mapDimensionsAll=function(t){var e=this._dimSummary,i=e.encode[t];return(i||[]).slice()},r.prototype.getStore=function(){return this._store},r.prototype.initData=function(t,e,i){var n=this,a;if(t instanceof vM&&(a=t),!a){var s=this.dimensions,o=fD(t)||Sa(t)?new v9(t,s.length):t;a=new vM;var l=ec(s,function(u){return{type:n._dimInfos[u].type,property:u}});a.initData(o,l,i)}this._store=a,this._nameList=(e||[]).slice(),this._idList=[],this._nameRepeatCount={},this._doInit(0,a.count()),this._dimSummary=Dbt(this,this._schema),this.userOutput=this._dimSummary.userOutput},r.prototype.appendData=function(t){var e=this._store.appendData(t);this._doInit(e[0],e[1])},r.prototype.appendValues=function(t,e){var i=this._store.appendValues(t,e.length),n=i.start,a=i.end,s=this._shouldMakeIdFromName();if(this._updateOrdinalMeta(),e)for(var o=n;o<a;o++){var l=o-n;this._nameList[o]=e[l],s&&eC(this,o)}},r.prototype._updateOrdinalMeta=function(){for(var t=this._store,e=this.dimensions,i=0;i<e.length;i++){var n=this._dimInfos[e[i]];n.ordinalMeta&&t.collectOrdinalMeta(n.storeDimIndex,n.ordinalMeta)}},r.prototype._shouldMakeIdFromName=function(){var t=this._store.getProvider();return this._idDimIdx==null&&t.getSource().sourceFormat!==Lc&&!t.fillStorage},r.prototype._doInit=function(t,e){if(!(t>=e)){var i=this._store,n=i.getProvider();this._updateOrdinalMeta();var a=this._nameList,s=this._idList,o=n.getSource().sourceFormat,l=o===oo;if(l&&!n.pure)for(var u=[],c=t;c<e;c++){var h=n.getItem(c,u);if(!this.hasItemOption&&nyt(h)&&(this.hasItemOption=!0),h){var p=h.name;a[c]==null&&p!=null&&(a[c]=xn(p,null));var v=h.id;s[c]==null&&v!=null&&(s[c]=xn(v,null))}}if(this._shouldMakeIdFromName())for(var c=t;c<e;c++)eC(this,c);n5(this)}},r.prototype.getApproximateExtent=function(t){return this._approximateExtent[t]||this._store.getDataExtent(this._getStoreDimIndex(t))},r.prototype.setApproximateExtent=function(t,e){e=this.getDimension(e),this._approximateExtent[e]=t.slice()},r.prototype.getCalculationInfo=function(t){return this._calculationInfo[t]},r.prototype.setCalculationInfo=function(t,e){mm(t)?Zt(this._calculationInfo,t):this._calculationInfo[t]=e},r.prototype.getName=function(t){var e=this.getRawIndex(t),i=this._nameList[e];return i==null&&this._nameDimIdx!=null&&(i=ym(this,this._nameDimIdx,e)),i==null&&(i=""),i},r.prototype._getCategory=function(t,e){var i=this._store.get(t,e),n=this._store.getOrdinalMeta(t);return n?n.categories[i]:i},r.prototype.getId=function(t){return t1(this,this.getRawIndex(t))},r.prototype.count=function(){return this._store.count()},r.prototype.get=function(t,e){var i=this._store,n=this._dimInfos[t];if(n)return i.get(n.storeDimIndex,e)},r.prototype.getByRawIndex=function(t,e){var i=this._store,n=this._dimInfos[t];if(n)return i.getByRawIndex(n.storeDimIndex,e)},r.prototype.getIndices=function(){return this._store.getIndices()},r.prototype.getDataExtent=function(t){return this._store.getDataExtent(this._getStoreDimIndex(t))},r.prototype.getSum=function(t){return this._store.getSum(this._getStoreDimIndex(t))},r.prototype.getMedian=function(t){return this._store.getMedian(this._getStoreDimIndex(t))},r.prototype.getValues=function(t,e){var i=this,n=this._store;return Kt(t)?n.getValues(ec(t,function(a){return i._getStoreDimIndex(a)}),e):n.getValues(t)},r.prototype.hasValue=function(t){for(var e=this._dimSummary.dataDimIndicesOnCoord,i=0,n=e.length;i<n;i++)if(isNaN(this._store.get(e[i],t)))return!1;return!0},r.prototype.indexOfName=function(t){for(var e=0,i=this._store.count();e<i;e++)if(this.getName(e)===t)return e;return-1},r.prototype.getRawIndex=function(t){return this._store.getRawIndex(t)},r.prototype.indexOfRawIndex=function(t){return this._store.indexOfRawIndex(t)},r.prototype.rawIndexOf=function(t,e){var i=t&&this._invertedIndicesMap[t],n=i[e];return n==null||isNaN(n)?i5:n},r.prototype.indicesOfNearest=function(t,e,i){return this._store.indicesOfNearest(this._getStoreDimIndex(t),e,i)},r.prototype.each=function(t,e,i){Ve(t)&&(i=e,e=t,t=[]);var n=i||this,a=ec(_m(t),this._getStoreDimIndex,this);this._store.each(a,n?we(e,n):e)},r.prototype.filterSelf=function(t,e,i){Ve(t)&&(i=e,e=t,t=[]);var n=i||this,a=ec(_m(t),this._getStoreDimIndex,this);return this._store=this._store.filter(a,n?we(e,n):e),this},r.prototype.selectRange=function(t){var e=this,i={},n=br(t);return J(n,function(a){var s=e._getStoreDimIndex(a);i[s]=t[a]}),this._store=this._store.selectRange(i),this},r.prototype.mapArray=function(t,e,i){Ve(t)&&(i=e,e=t,t=[]),i=i||this;var n=[];return this.each(t,function(){n.push(e&&e.apply(this,arguments))},i),n},r.prototype.map=function(t,e,i,n){var a=i||n||this,s=ec(_m(t),this._getStoreDimIndex,this),o=e1(this);return o._store=this._store.map(s,a?we(e,a):e),o},r.prototype.modify=function(t,e,i,n){var a=i||n||this,s=ec(_m(t),this._getStoreDimIndex,this);this._store.modify(s,a?we(e,a):e)},r.prototype.downSample=function(t,e,i,n){var a=e1(this);return a._store=this._store.downSample(this._getStoreDimIndex(t),e,i,n),a},r.prototype.lttbDownSample=function(t,e){var i=e1(this);return i._store=this._store.lttbDownSample(this._getStoreDimIndex(t),e),i},r.prototype.getRawDataItem=function(t){return this._store.getRawDataItem(t)},r.prototype.getItemModel=function(t){var e=this.hostModel,i=this.getRawDataItem(t);return new fi(i,e,e&&e.ecModel)},r.prototype.diff=function(t){var e=this;return new yu(t?t.getStore().getIndices():[],this.getStore().getIndices(),function(i){return t1(t,i)},function(i){return t1(e,i)})},r.prototype.getVisual=function(t){var e=this._visual;return e&&e[t]},r.prototype.setVisual=function(t,e){this._visual=this._visual||{},mm(t)?Zt(this._visual,t):this._visual[t]=e},r.prototype.getItemVisual=function(t,e){var i=this._itemVisuals[t],n=i&&i[e];return n??this.getVisual(e)},r.prototype.hasItemVisual=function(){return this._itemVisuals.length>0},r.prototype.ensureUniqueItemVisual=function(t,e){var i=this._itemVisuals,n=i[t];n||(n=i[t]={});var a=n[e];return a==null&&(a=this.getVisual(e),Kt(a)?a=a.slice():mm(a)&&(a=Zt({},a)),n[e]=a),a},r.prototype.setItemVisual=function(t,e,i){var n=this._itemVisuals[t]||{};this._itemVisuals[t]=n,mm(e)?Zt(n,e):n[e]=i},r.prototype.clearAllVisual=function(){this._visual={},this._itemVisuals=[]},r.prototype.setLayout=function(t,e){mm(t)?Zt(this._layout,t):this._layout[t]=e},r.prototype.getLayout=function(t){return this._layout[t]},r.prototype.getItemLayout=function(t){return this._itemLayouts[t]},r.prototype.setItemLayout=function(t,e,i){this._itemLayouts[t]=i?Zt(this._itemLayouts[t]||{},e):e},r.prototype.clearItemLayouts=function(){this._itemLayouts.length=0},r.prototype.setItemGraphicEl=function(t,e){var i=this.hostModel&&this.hostModel.seriesIndex;iM(i,this.dataType,t,e),this._graphicEls[t]=e},r.prototype.getItemGraphicEl=function(t){return this._graphicEls[t]},r.prototype.eachItemGraphicEl=function(t,e){J(this._graphicEls,function(i,n){i&&t&&t.call(e,i,n)})},r.prototype.cloneShallow=function(t){return t||(t=new r(this._schema?this._schema:ec(this.dimensions,this._getDimInfo,this),this.hostModel)),tC(t,this),t._store=this._store,t},r.prototype.wrapMethod=function(t,e){var i=this[t];Ve(i)&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(t),this[t]=function(){var n=i.apply(this,arguments);return e.apply(this,[n].concat(PR(arguments)))})},r.internalField=function(){n5=function(t){var e=t._invertedIndicesMap;J(e,function(i,n){var a=t._dimInfos[n],s=a.ordinalMeta,o=t._store;if(s){i=e[n]=new Fbt(s.categories.length);for(var l=0;l<i.length;l++)i[l]=i5;for(var l=0;l<o.count();l++)i[o.get(a.storeDimIndex,l)]=l}})},ym=function(t,e,i){return xn(t._getCategory(e,i),null)},t1=function(t,e){var i=t._idList[e];return i==null&&t._idDimIdx!=null&&(i=ym(t,t._idDimIdx,e)),i==null&&(i=Bbt+e),i},_m=function(t){return Kt(t)||(t=t!=null?[t]:[]),t},e1=function(t){var e=new r(t._schema?t._schema:ec(t.dimensions,t._getDimInfo,t),t.hostModel);return tC(e,t),e},tC=function(t,e){J(zbt.concat(e.__wrappedMethods||[]),function(i){e.hasOwnProperty(i)&&(t[i]=e[i])}),t.__wrappedMethods=e.__wrappedMethods,J(Vbt,function(i){t[i]=Ze(e[i])}),t._calculationInfo=Zt({},e._calculationInfo)},eC=function(t,e){var i=t._nameList,n=t._idList,a=t._nameDimIdx,s=t._idDimIdx,o=i[e],l=n[e];if(o==null&&a!=null&&(i[e]=o=ym(t,a,e)),l==null&&s!=null&&(n[e]=l=ym(t,s,e)),l==null&&o!=null){var u=t._nameRepeatCount,c=u[o]=(u[o]||0)+1;l=o,c>1&&(l+="__ec__"+c),n[e]=l}}}(),r}();const Xa=Ubt;function k_(r,t){fD(r)||(r=dD(r)),t=t||{};var e=t.coordDimensions||[],i=t.dimensionsDefine||r.dimensionsDefine||[],n=Re(),a=[],s=Wbt(r,e,i,t.dimensionsCount),o=t.canOmitUnusedDimensions&&mG(s),l=i===r.dimensionsDefine,u=l?vG(r):gG(i),c=t.encodeDefine;!c&&t.encodeDefaulter&&(c=t.encodeDefaulter(r,s));for(var h=Re(c),p=new T9(s),v=0;v<p.length;v++)p[v]=-1;function y(H){var j=p[H];if(j<0){var Y=i[H],tt=je(Y)?Y:{name:Y},it=new eb,lt=tt.name;lt!=null&&u.get(lt)!=null&&(it.name=it.displayName=lt),tt.type!=null&&(it.type=tt.type),tt.displayName!=null&&(it.displayName=tt.displayName);var ht=a.length;return p[H]=ht,it.storeDimIndex=H,a.push(it),it}return a[j]}if(!o)for(var v=0;v<s;v++)y(v);h.each(function(H,j){var Y=ri(H).slice();if(Y.length===1&&!ve(Y[0])&&Y[0]<0){h.set(j,!1);return}var tt=h.set(j,[]);J(Y,function(it,lt){var ht=ve(it)?u.get(it):it;ht!=null&&ht<s&&(tt[lt]=ht,w(y(ht),j,lt))})});var x=0;J(e,function(H){var j,Y,tt,it;if(ve(H))j=H,it={};else{it=H,j=it.name;var lt=it.ordinalMeta;it.ordinalMeta=null,it=Zt({},it),it.ordinalMeta=lt,Y=it.dimsDef,tt=it.otherDims,it.name=it.coordDim=it.coordDimIndex=it.dimsDef=it.otherDims=null}var ht=h.get(j);if(ht!==!1){if(ht=ri(ht),!ht.length)for(var Tt=0;Tt<(Y&&Y.length||1);Tt++){for(;x<s&&y(x).coordDim!=null;)x++;x<s&&ht.push(x++)}J(ht,function(Ot,Rt){var Ut=y(Ot);if(l&&it.type!=null&&(Ut.type=it.type),w(We(Ut,it),j,Rt),Ut.name==null&&Y){var Jt=Y[Rt];!je(Jt)&&(Jt={name:Jt}),Ut.name=Ut.displayName=Jt.name,Ut.defaultTooltip=Jt.defaultTooltip}tt&&We(Ut.otherDims,tt)})}});function w(H,j,Y){r9.get(j)!=null?H.otherDims[j]=Y:(H.coordDim=j,H.coordDimIndex=Y,n.set(j,!0))}var T=t.generateCoord,E=t.generateCoordCount,M=E!=null;E=T?E||1:0;var L=T||"value";function F(H){H.name==null&&(H.name=H.coordDim)}if(o)J(a,function(H){F(H)}),a.sort(function(H,j){return H.storeDimIndex-j.storeDimIndex});else for(var O=0;O<s;O++){var U=y(O),W=U.coordDim;W==null&&(U.coordDim=Hbt(L,n,M),U.coordDimIndex=0,(!T||E<=0)&&(U.isExtraCoord=!0),E--),F(U),U.type==null&&(s9(r,O)===Yn.Must||U.isExtraCoord&&(U.otherDims.itemName!=null||U.otherDims.seriesName!=null))&&(U.type="ordinal")}return $bt(a),new dG({source:r,dimensions:a,fullDimensionCount:s,dimensionOmitted:o})}function $bt(r){for(var t=Re(),e=0;e<r.length;e++){var i=r[e],n=i.name,a=t.get(n)||0;a>0&&(i.name=n+(a-1)),a++,t.set(n,a)}}function Wbt(r,t,e,i){var n=Math.max(r.dimensionsDetectedCount||1,t.length,e.length,i||0);return J(t,function(a){var s;je(a)&&(s=a.dimsDef)&&(n=Math.max(n,s.length))}),n}function Hbt(r,t,e){if(e||t.hasKey(r)){for(var i=0;t.hasKey(r+i);)i++;r+=i}return t.set(r,!0),r}var Gbt=function(){function r(t){this.coordSysDims=[],this.axisMap=Re(),this.categoryAxisMap=Re(),this.coordSysName=t}return r}();function jbt(r){var t=r.get("coordinateSystem"),e=new Gbt(t),i=Xbt[t];if(i)return i(r,e,e.axisMap,e.categoryAxisMap),e}var Xbt={cartesian2d:function(r,t,e,i){var n=r.getReferringComponents("xAxis",vn).models[0],a=r.getReferringComponents("yAxis",vn).models[0];t.coordSysDims=["x","y"],e.set("x",n),e.set("y",a),hp(n)&&(i.set("x",n),t.firstCategoryDimIndex=0),hp(a)&&(i.set("y",a),t.firstCategoryDimIndex==null&&(t.firstCategoryDimIndex=1))},singleAxis:function(r,t,e,i){var n=r.getReferringComponents("singleAxis",vn).models[0];t.coordSysDims=["single"],e.set("single",n),hp(n)&&(i.set("single",n),t.firstCategoryDimIndex=0)},polar:function(r,t,e,i){var n=r.getReferringComponents("polar",vn).models[0],a=n.findAxisModel("radiusAxis"),s=n.findAxisModel("angleAxis");t.coordSysDims=["radius","angle"],e.set("radius",a),e.set("angle",s),hp(a)&&(i.set("radius",a),t.firstCategoryDimIndex=0),hp(s)&&(i.set("angle",s),t.firstCategoryDimIndex==null&&(t.firstCategoryDimIndex=1))},geo:function(r,t,e,i){t.coordSysDims=["lng","lat"]},parallel:function(r,t,e,i){var n=r.ecModel,a=n.getComponent("parallel",r.get("parallelIndex")),s=t.coordSysDims=a.dimensions.slice();J(a.parallelAxisIndex,function(o,l){var u=n.getComponent("parallelAxis",o),c=s[l];e.set(c,u),hp(u)&&(i.set(c,u),t.firstCategoryDimIndex==null&&(t.firstCategoryDimIndex=l))})}};function hp(r){return r.get("type")==="category"}function Zbt(r,t,e){e=e||{};var i=e.byIndex,n=e.stackedCoordDimension,a,s,o;qbt(t)?a=t:(s=t.schema,a=s.dimensions,o=t.store);var l=!!(r&&r.get("stack")),u,c,h,p;if(J(a,function(E,M){ve(E)&&(a[M]=E={name:E}),l&&!E.isExtraCoord&&(!i&&!u&&E.ordinalMeta&&(u=E),!c&&E.type!=="ordinal"&&E.type!=="time"&&(!n||n===E.coordDim)&&(c=E))}),c&&!i&&!u&&(i=!0),c){h="__\0ecstackresult_"+r.id,p="__\0ecstackedover_"+r.id,u&&(u.createInvertedIndices=!0);var v=c.coordDim,y=c.type,x=0;J(a,function(E){E.coordDim===v&&x++});var w={name:h,coordDim:v,coordDimIndex:x,type:y,isExtraCoord:!0,isCalculationCoord:!0,storeDimIndex:a.length},T={name:p,coordDim:p,coordDimIndex:x+1,type:y,isExtraCoord:!0,isCalculationCoord:!0,storeDimIndex:a.length+1};s?(o&&(w.storeDimIndex=o.ensureCalculationDimension(p,y),T.storeDimIndex=o.ensureCalculationDimension(h,y)),s.appendCalculationDimension(w),s.appendCalculationDimension(T)):(a.push(w),a.push(T))}return{stackedDimension:c&&c.name,stackedByDimension:u&&u.name,isStackedByIndex:i,stackedOverDimension:p,stackResultDimension:h}}function qbt(r){return!pG(r.schema)}function Hc(r,t){return!!t&&t===r.getCalculationInfo("stackedDimension")}function yG(r,t){return Hc(r,t)?r.getCalculationInfo("stackResultDimension"):t}function Ybt(r,t){var e=r.get("coordinateSystem"),i=D_.get(e),n;return t&&t.coordSysDims&&(n=te(t.coordSysDims,function(a){var s={name:a},o=t.axisMap.get(a);if(o){var l=o.get("type");s.type=fw(l)}return s})),n||(n=i&&(i.getDimensionsInfo?i.getDimensionsInfo():i.dimensions.slice())||["x","y"]),n}function Kbt(r,t,e){var i,n;return e&&J(r,function(a,s){var o=a.coordDim,l=e.categoryAxisMap.get(o);l&&(i==null&&(i=s),a.ordinalMeta=l.getOrdinalMeta(),t&&(a.createInvertedIndices=!0)),a.otherDims.itemName!=null&&(n=!0)}),!n&&i!=null&&(r[i].otherDims.itemName=0),i}function Su(r,t,e){e=e||{};var i=t.getSourceManager(),n,a=!1;r?(a=!0,n=dD(r)):(n=i.getSource(),a=n.sourceFormat===oo);var s=jbt(t),o=Ybt(t,s),l=e.useEncodeDefaulter,u=Ve(l)?l:l?nr(a9,o,t):null,c={coordDimensions:o,generateCoord:e.generateCoord,encodeDefine:t.getEncode(),encodeDefaulter:u,canOmitUnusedDimensions:!a},h=k_(n,c),p=Kbt(h.dimensions,e.createInvertedIndices,s),v=a?null:i.getSharedDataStore(h),y=Zbt(t,{schema:h,store:v}),x=new Xa(h,t);x.setCalculationInfo(y);var w=p!=null&&Jbt(n)?function(T,E,M,L){return L===p?M:this.defaultDimValueGetter(T,E,M,L)}:null;return x.hasItemOption=!1,x.initData(a?n:v,null,w),x}function Jbt(r){if(r.sourceFormat===oo){var t=Qbt(r.data||[]);return!Kt(Pg(t))}}function Qbt(r){for(var t=0;t<r.length&&r[t]==null;)t++;return r[t]}var _G=function(){function r(t){this._setting=t||{},this._extent=[1/0,-1/0]}return r.prototype.getSetting=function(t){return this._setting[t]},r.prototype.unionExtent=function(t){var e=this._extent;t[0]<e[0]&&(e[0]=t[0]),t[1]>e[1]&&(e[1]=t[1])},r.prototype.unionExtentFromData=function(t,e){this.unionExtent(t.getApproximateExtent(e))},r.prototype.getExtent=function(){return this._extent.slice()},r.prototype.setExtent=function(t,e){var i=this._extent;isNaN(t)||(i[0]=t),isNaN(e)||(i[1]=e)},r.prototype.isInExtentRange=function(t){return this._extent[0]<=t&&this._extent[1]>=t},r.prototype.isBlank=function(){return this._isBlank},r.prototype.setBlank=function(t){this._isBlank=t},r}();bS(_G);const Tu=_G;var twt=0,ewt=function(){function r(t){this.categories=t.categories||[],this._needCollect=t.needCollect,this._deduplication=t.deduplication,this.uid=++twt}return r.createByAxisModel=function(t){var e=t.option,i=e.data,n=i&&te(i,rwt);return new r({categories:n,needCollect:!n,deduplication:e.dedplication!==!1})},r.prototype.getOrdinal=function(t){return this._getOrCreateMap().get(t)},r.prototype.parseAndCollect=function(t){var e,i=this._needCollect;if(!ve(t)&&!i)return t;if(i&&!this._deduplication)return e=this.categories.length,this.categories[e]=t,e;var n=this._getOrCreateMap();return e=n.get(t),e==null&&(i?(e=this.categories.length,this.categories[e]=t,n.set(t,e)):e=NaN),e},r.prototype._getOrCreateMap=function(){return this._map||(this._map=Re(this.categories))},r}();function rwt(r){return je(r)&&r.value!=null?r.value:r+""}const CM=ewt;function EM(r){return r.type==="interval"||r.type==="log"}function iwt(r,t,e,i){var n={},a=r[1]-r[0],s=n.interval=RH(a/t,!0);e!=null&&s<e&&(s=n.interval=e),i!=null&&s>i&&(s=n.interval=i);var o=n.intervalPrecision=xG(s),l=n.niceTickExtent=[Yi(Math.ceil(r[0]/s)*s,o),Yi(Math.floor(r[1]/s)*s,o)];return nwt(l,r),n}function rC(r){var t=Math.pow(10,zR(r)),e=r/t;return e?e===2?e=3:e===3?e=5:e*=2:e=1,Yi(e*t)}function xG(r){return gl(r)+2}function a5(r,t,e){r[t]=Math.max(Math.min(r[t],e[1]),e[0])}function nwt(r,t){!isFinite(r[0])&&(r[0]=t[0]),!isFinite(r[1])&&(r[1]=t[1]),a5(r,0,t),a5(r,1,t),r[0]>r[1]&&(r[0]=r[1])}function WS(r,t){return r>=t[0]&&r<=t[1]}function HS(r,t){return t[1]===t[0]?.5:(r-t[0])/(t[1]-t[0])}function GS(r,t){return r*(t[1]-t[0])+t[0]}var bG=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;i.type="ordinal";var n=i.getSetting("ordinalMeta");return n||(n=new CM({})),Kt(n)&&(n=new CM({categories:te(n,function(a){return je(a)?a.value:a})})),i._ordinalMeta=n,i._extent=i.getSetting("extent")||[0,n.categories.length-1],i}return t.prototype.parse=function(e){return e==null?NaN:ve(e)?this._ordinalMeta.getOrdinal(e):Math.round(e)},t.prototype.contain=function(e){return e=this.parse(e),WS(e,this._extent)&&this._ordinalMeta.categories[e]!=null},t.prototype.normalize=function(e){return e=this._getTickNumber(this.parse(e)),HS(e,this._extent)},t.prototype.scale=function(e){return e=Math.round(GS(e,this._extent)),this.getRawOrdinalNumber(e)},t.prototype.getTicks=function(){for(var e=[],i=this._extent,n=i[0];n<=i[1];)e.push({value:n}),n++;return e},t.prototype.getMinorTicks=function(e){},t.prototype.setSortInfo=function(e){if(e==null){this._ordinalNumbersByTick=this._ticksByOrdinalNumber=null;return}for(var i=e.ordinalNumbers,n=this._ordinalNumbersByTick=[],a=this._ticksByOrdinalNumber=[],s=0,o=this._ordinalMeta.categories.length,l=Math.min(o,i.length);s<l;++s){var u=i[s];n[s]=u,a[u]=s}for(var c=0;s<o;++s){for(;a[c]!=null;)c++;n.push(c),a[c]=s}},t.prototype._getTickNumber=function(e){var i=this._ticksByOrdinalNumber;return i&&e>=0&&e<i.length?i[e]:e},t.prototype.getRawOrdinalNumber=function(e){var i=this._ordinalNumbersByTick;return i&&e>=0&&e<i.length?i[e]:e},t.prototype.getLabel=function(e){if(!this.isBlank()){var i=this.getRawOrdinalNumber(e.value),n=this._ordinalMeta.categories[i];return n==null?"":n+""}},t.prototype.count=function(){return this._extent[1]-this._extent[0]+1},t.prototype.unionExtentFromData=function(e,i){this.unionExtent(e.getApproximateExtent(i))},t.prototype.isInExtentRange=function(e){return e=this._getTickNumber(e),this._extent[0]<=e&&this._extent[1]>=e},t.prototype.getOrdinalMeta=function(){return this._ordinalMeta},t.prototype.calcNiceTicks=function(){},t.prototype.calcNiceExtent=function(){},t.type="ordinal",t}(Tu);Tu.registerClass(bG);const CD=bG;var Wh=Yi,wG=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="interval",e._interval=0,e._intervalPrecision=2,e}return t.prototype.parse=function(e){return e},t.prototype.contain=function(e){return WS(e,this._extent)},t.prototype.normalize=function(e){return HS(e,this._extent)},t.prototype.scale=function(e){return GS(e,this._extent)},t.prototype.setExtent=function(e,i){var n=this._extent;isNaN(e)||(n[0]=parseFloat(e)),isNaN(i)||(n[1]=parseFloat(i))},t.prototype.unionExtent=function(e){var i=this._extent;e[0]<i[0]&&(i[0]=e[0]),e[1]>i[1]&&(i[1]=e[1]),this.setExtent(i[0],i[1])},t.prototype.getInterval=function(){return this._interval},t.prototype.setInterval=function(e){this._interval=e,this._niceExtent=this._extent.slice(),this._intervalPrecision=xG(e)},t.prototype.getTicks=function(e){var i=this._interval,n=this._extent,a=this._niceExtent,s=this._intervalPrecision,o=[];if(!i)return o;var l=1e4;n[0]<a[0]&&(e?o.push({value:Wh(a[0]-i,s)}):o.push({value:n[0]}));for(var u=a[0];u<=a[1]&&(o.push({value:u}),u=Wh(u+i,s),u!==o[o.length-1].value);)if(o.length>l)return[];var c=o.length?o[o.length-1].value:a[1];return n[1]>c&&(e?o.push({value:Wh(c+i,s)}):o.push({value:n[1]})),o},t.prototype.getMinorTicks=function(e){for(var i=this.getTicks(!0),n=[],a=this.getExtent(),s=1;s<i.length;s++){for(var o=i[s],l=i[s-1],u=0,c=[],h=o.value-l.value,p=h/e;u<e-1;){var v=Wh(l.value+(u+1)*p);v>a[0]&&v<a[1]&&c.push(v),u++}n.push(c)}return n},t.prototype.getLabel=function(e,i){if(e==null)return"";var n=i&&i.precision;n==null?n=gl(e.value)||0:n==="auto"&&(n=this._intervalPrecision);var a=Wh(e.value,n,!0);return Y7(a)},t.prototype.calcNiceTicks=function(e,i,n){e=e||5;var a=this._extent,s=a[1]-a[0];if(isFinite(s)){s<0&&(s=-s,a.reverse());var o=iwt(a,e,i,n);this._intervalPrecision=o.intervalPrecision,this._interval=o.interval,this._niceExtent=o.niceTickExtent}},t.prototype.calcNiceExtent=function(e){var i=this._extent;if(i[0]===i[1])if(i[0]!==0){var n=Math.abs(i[0]);e.fixMax||(i[1]+=n/2),i[0]-=n/2}else i[1]=1;var a=i[1]-i[0];isFinite(a)||(i[0]=0,i[1]=1),this.calcNiceTicks(e.splitNumber,e.minInterval,e.maxInterval);var s=this._interval;e.fixMin||(i[0]=Wh(Math.floor(i[0]/s)*s)),e.fixMax||(i[1]=Wh(Math.ceil(i[1]/s)*s))},t.prototype.setNiceExtent=function(e,i){this._niceExtent=[e,i]},t.type="interval",t}(Tu);Tu.registerClass(wG);const Gc=wG;var SG=typeof Float32Array<"u",awt=SG?Float32Array:Array;function ml(r){return Kt(r)?SG?new Float32Array(r):r:new awt(r)}var IM="__ec_stack_";function ED(r){return r.get("stack")||IM+r.seriesIndex}function ID(r){return r.dim+r.index}function swt(r){var t=[],e=r.axis,i="axis0";if(e.type==="category"){for(var n=e.getBandWidth(),a=0;a<r.count;a++)t.push(We({bandWidth:n,axisKey:i,stackId:IM+a},r));for(var s=CG(t),o=[],a=0;a<r.count;a++){var l=s[i][IM+a];l.offsetCenter=l.offset+l.width/2,o.push(l)}return o}}function TG(r,t){var e=[];return t.eachSeriesByType(r,function(i){MG(i)&&e.push(i)}),e}function owt(r){var t={};J(r,function(l){var u=l.coordinateSystem,c=u.getBaseAxis();if(!(c.type!=="time"&&c.type!=="value"))for(var h=l.getData(),p=c.dim+"_"+c.index,v=h.getDimensionIndex(h.mapDimension(c.dim)),y=h.getStore(),x=0,w=y.count();x<w;++x){var T=y.get(v,x);t[p]?t[p].push(T):t[p]=[T]}});var e={};for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if(n){n.sort(function(l,u){return l-u});for(var a=null,s=1;s<n.length;++s){var o=n[s]-n[s-1];o>0&&(a=a===null?o:Math.min(a,o))}e[i]=a}}return e}function AG(r){var t=owt(r),e=[];return J(r,function(i){var n=i.coordinateSystem,a=n.getBaseAxis(),s=a.getExtent(),o;if(a.type==="category")o=a.getBandWidth();else if(a.type==="value"||a.type==="time"){var l=a.dim+"_"+a.index,u=t[l],c=Math.abs(s[1]-s[0]),h=a.scale.getExtent(),p=Math.abs(h[1]-h[0]);o=u?c/p*u:c}else{var v=i.getData();o=Math.abs(s[1]-s[0])/v.count()}var y=he(i.get("barWidth"),o),x=he(i.get("barMaxWidth"),o),w=he(i.get("barMinWidth")||(PG(i)?.5:1),o),T=i.get("barGap"),E=i.get("barCategoryGap");e.push({bandWidth:o,barWidth:y,barMaxWidth:x,barMinWidth:w,barGap:T,barCategoryGap:E,axisKey:ID(a),stackId:ED(i)})}),CG(e)}function CG(r){var t={};J(r,function(i,n){var a=i.axisKey,s=i.bandWidth,o=t[a]||{bandWidth:s,remainedWidth:s,autoWidthCount:0,categoryGap:null,gap:"20%",stacks:{}},l=o.stacks;t[a]=o;var u=i.stackId;l[u]||o.autoWidthCount++,l[u]=l[u]||{width:0,maxWidth:0};var c=i.barWidth;c&&!l[u].width&&(l[u].width=c,c=Math.min(o.remainedWidth,c),o.remainedWidth-=c);var h=i.barMaxWidth;h&&(l[u].maxWidth=h);var p=i.barMinWidth;p&&(l[u].minWidth=p);var v=i.barGap;v!=null&&(o.gap=v);var y=i.barCategoryGap;y!=null&&(o.categoryGap=y)});var e={};return J(t,function(i,n){e[n]={};var a=i.stacks,s=i.bandWidth,o=i.categoryGap;if(o==null){var l=br(a).length;o=Math.max(35-l*4,15)+"%"}var u=he(o,s),c=he(i.gap,1),h=i.remainedWidth,p=i.autoWidthCount,v=(h-u)/(p+(p-1)*c);v=Math.max(v,0),J(a,function(T){var E=T.maxWidth,M=T.minWidth;if(T.width){var L=T.width;E&&(L=Math.min(L,E)),M&&(L=Math.max(L,M)),T.width=L,h-=L+c*L,p--}else{var L=v;E&&E<L&&(L=Math.min(E,h)),M&&M>L&&(L=M),L!==v&&(T.width=L,h-=L+c*L,p--)}}),v=(h-u)/(p+(p-1)*c),v=Math.max(v,0);var y=0,x;J(a,function(T,E){T.width||(T.width=v),x=T,y+=T.width*(1+c)}),x&&(y-=x.width*c);var w=-y/2;J(a,function(T,E){e[n][E]=e[n][E]||{bandWidth:s,offset:w,width:T.width},w+=T.width*(1+c)})}),e}function lwt(r,t,e){if(r&&t){var i=r[ID(t)];return i!=null&&e!=null?i[ED(e)]:i}}function EG(r,t){var e=TG(r,t),i=AG(e);J(e,function(n){var a=n.getData(),s=n.coordinateSystem,o=s.getBaseAxis(),l=ED(n),u=i[ID(o)][l],c=u.offset,h=u.width;a.setLayout({bandWidth:u.bandWidth,offset:c,size:h})})}function IG(r){return{seriesType:r,plan:Vg(),reset:function(t){if(MG(t)){var e=t.getData(),i=t.coordinateSystem,n=i.getBaseAxis(),a=i.getOtherAxis(n),s=e.getDimensionIndex(e.mapDimension(a.dim)),o=e.getDimensionIndex(e.mapDimension(n.dim)),l=t.get("showBackground",!0),u=e.mapDimension(a.dim),c=e.getCalculationInfo("stackResultDimension"),h=Hc(e,u)&&!!e.getCalculationInfo("stackedOnSeries"),p=a.isHorizontal(),v=uwt(n,a),y=PG(t),x=t.get("barMinHeight")||0,w=c&&e.getDimensionIndex(c),T=e.getLayout("size"),E=e.getLayout("offset");return{progress:function(M,L){for(var F=M.count,O=y&&ml(F*3),U=y&&l&&ml(F*3),W=y&&ml(F),H=i.master.getRect(),j=p?H.width:H.height,Y,tt=L.getStore(),it=0;(Y=M.next())!=null;){var lt=tt.get(h?w:s,Y),ht=tt.get(o,Y),Tt=v,Ot=void 0;h&&(Ot=+lt-tt.get(s,Y));var Rt=void 0,Ut=void 0,Jt=void 0,ne=void 0;if(p){var se=i.dataToPoint([lt,ht]);if(h){var ce=i.dataToPoint([Ot,ht]);Tt=ce[0]}Rt=Tt,Ut=se[1]+E,Jt=se[0]-Tt,ne=T,Math.abs(Jt)<x&&(Jt=(Jt<0?-1:1)*x)}else{var se=i.dataToPoint([ht,lt]);if(h){var ce=i.dataToPoint([ht,Ot]);Tt=ce[1]}Rt=se[0]+E,Ut=Tt,Jt=T,ne=se[1]-Tt,Math.abs(ne)<x&&(ne=(ne<=0?-1:1)*x)}y?(O[it]=Rt,O[it+1]=Ut,O[it+2]=p?Jt:ne,U&&(U[it]=p?H.x:Rt,U[it+1]=p?Ut:H.y,U[it+2]=j),W[Y]=Y):L.setItemLayout(Y,{x:Rt,y:Ut,width:Jt,height:ne}),it+=3}y&&L.setLayout({largePoints:O,largeDataIndices:W,largeBackgroundPoints:U,valueAxisHorizontal:p})}}}}}}function MG(r){return r.coordinateSystem&&r.coordinateSystem.type==="cartesian2d"}function PG(r){return r.pipelineContext&&r.pipelineContext.large}function uwt(r,t){var e=t.model.get("startValue");return e||(e=0),t.toGlobalCoord(t.dataToCoord(t.type==="log"?e>0?e:1:e))}var cwt=function(r,t,e,i){for(;e<i;){var n=e+i>>>1;r[n][1]<t?e=n+1:i=n}return e},RG=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i.type="time",i}return t.prototype.getLabel=function(e){var i=this.getSetting("useUTC");return DS(e.value,qB[k0t(Jp(this._minLevelUnit))]||qB.second,i,this.getSetting("locale"))},t.prototype.getFormattedLabel=function(e,i,n){var a=this.getSetting("useUTC"),s=this.getSetting("locale");return O0t(e,i,n,s,a)},t.prototype.getTicks=function(){var e=this._interval,i=this._extent,n=[];if(!e)return n;n.push({value:i[0],level:0});var a=this.getSetting("useUTC"),s=mwt(this._minLevelUnit,this._approxInterval,a,i);return n=n.concat(s),n.push({value:i[1],level:0}),n},t.prototype.calcNiceExtent=function(e){var i=this._extent;if(i[0]===i[1]&&(i[0]-=to,i[1]+=to),i[1]===-1/0&&i[0]===1/0){var n=new Date;i[1]=+new Date(n.getFullYear(),n.getMonth(),n.getDate()),i[0]=i[1]-to}this.calcNiceTicks(e.splitNumber,e.minInterval,e.maxInterval)},t.prototype.calcNiceTicks=function(e,i,n){e=e||10;var a=this._extent,s=a[1]-a[0];this._approxInterval=s/e,i!=null&&this._approxInterval<i&&(this._approxInterval=i),n!=null&&this._approxInterval>n&&(this._approxInterval=n);var o=r1.length,l=Math.min(cwt(r1,this._approxInterval,0,o),o-1);this._interval=r1[l][1],this._minLevelUnit=r1[Math.max(l-1,0)][0]},t.prototype.parse=function(e){return Fr(e)?e:+Tl(e)},t.prototype.contain=function(e){return WS(this.parse(e),this._extent)},t.prototype.normalize=function(e){return HS(this.parse(e),this._extent)},t.prototype.scale=function(e){return GS(e,this._extent)},t.type="time",t}(Gc),r1=[["second",aD],["minute",sD],["hour",hy],["quarter-day",hy*6],["half-day",hy*12],["day",to*1.2],["half-week",to*3.5],["week",to*7],["month",to*31],["quarter",to*95],["half-year",ZB/2],["year",ZB]];function hwt(r,t,e,i){var n=Tl(t),a=Tl(e),s=function(y){return YB(n,y,i)===YB(a,y,i)},o=function(){return s("year")},l=function(){return o()&&s("month")},u=function(){return l()&&s("day")},c=function(){return u()&&s("hour")},h=function(){return c()&&s("minute")},p=function(){return h()&&s("second")},v=function(){return p()&&s("millisecond")};switch(r){case"year":return o();case"month":return l();case"day":return u();case"hour":return c();case"minute":return h();case"second":return p();case"millisecond":return v()}}function fwt(r,t){return r/=to,r>16?16:r>7.5?7:r>3.5?4:r>1.5?2:1}function dwt(r){var t=30*to;return r/=t,r>6?6:r>3?3:r>2?2:1}function pwt(r){return r/=hy,r>12?12:r>6?6:r>3.5?4:r>2?2:1}function s5(r,t){return r/=t?sD:aD,r>30?30:r>20?20:r>15?15:r>10?10:r>5?5:r>2?2:1}function gwt(r){return RH(r,!0)}function vwt(r,t,e){var i=new Date(r);switch(Jp(t)){case"year":case"month":i[H7(e)](0);case"day":i[G7(e)](1);case"hour":i[j7(e)](0);case"minute":i[X7(e)](0);case"second":i[Z7(e)](0),i[q7(e)](0)}return i.getTime()}function mwt(r,t,e,i){var n=1e4,a=$7,s=0;function o(j,Y,tt,it,lt,ht,Tt){for(var Ot=new Date(Y),Rt=Y,Ut=Ot[it]();Rt<tt&&Rt<=i[1];)Tt.push({value:Rt}),Ut+=j,Ot[lt](Ut),Rt=Ot.getTime();Tt.push({value:Rt,notAdd:!0})}function l(j,Y,tt){var it=[],lt=!Y.length;if(!hwt(Jp(j),i[0],i[1],e)){lt&&(Y=[{value:vwt(new Date(i[0]),j,e)},{value:i[1]}]);for(var ht=0;ht<Y.length-1;ht++){var Tt=Y[ht].value,Ot=Y[ht+1].value;if(Tt!==Ot){var Rt=void 0,Ut=void 0,Jt=void 0,ne=!1;switch(j){case"year":Rt=Math.max(1,Math.round(t/to/365)),Ut=oD(e),Jt=N0t(e);break;case"half-year":case"quarter":case"month":Rt=dwt(t),Ut=Qp(e),Jt=H7(e);break;case"week":case"half-week":case"day":Rt=fwt(t),Ut=LS(e),Jt=G7(e),ne=!0;break;case"half-day":case"quarter-day":case"hour":Rt=pwt(t),Ut=qy(e),Jt=j7(e);break;case"minute":Rt=s5(t,!0),Ut=kS(e),Jt=X7(e);break;case"second":Rt=s5(t,!1),Ut=OS(e),Jt=Z7(e);break;case"millisecond":Rt=gwt(t),Ut=NS(e),Jt=q7(e);break}o(Rt,Tt,Ot,Ut,Jt,ne,it),j==="year"&&tt.length>1&&ht===0&&tt.unshift({value:tt[0].value-Rt})}}for(var ht=0;ht<it.length;ht++)tt.push(it[ht]);return it}}for(var u=[],c=[],h=0,p=0,v=0;v<a.length&&s++<n;++v){var y=Jp(a[v]);if(L0t(a[v])){l(a[v],u[u.length-1]||[],c);var x=a[v+1]?Jp(a[v+1]):null;if(y!==x){if(c.length){p=h,c.sort(function(j,Y){return j.value-Y.value});for(var w=[],T=0;T<c.length;++T){var E=c[T].value;(T===0||c[T-1].value!==E)&&(w.push(c[T]),E>=i[0]&&E<=i[1]&&h++)}var M=(i[1]-i[0])/t;if(h>M*1.5&&p>M/1.5||(u.push(w),h>M||r===a[v]))break}c=[]}}}for(var L=ti(te(u,function(j){return ti(j,function(Y){return Y.value>=i[0]&&Y.value<=i[1]&&!Y.notAdd})}),function(j){return j.length>0}),F=[],O=L.length-1,v=0;v<L.length;++v)for(var U=L[v],W=0;W<U.length;++W)F.push({value:U[W].value,level:O-v});F.sort(function(j,Y){return j.value-Y.value});for(var H=[],v=0;v<F.length;++v)(v===0||F[v].value!==F[v-1].value)&&H.push(F[v]);return H}Tu.registerClass(RG);const DG=RG;var o5=Tu.prototype,gy=Gc.prototype,ywt=Yi,_wt=Math.floor,xwt=Math.ceil,i1=Math.pow,Ao=Math.log,MD=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="log",e.base=10,e._originalScale=new Gc,e._interval=0,e}return t.prototype.getTicks=function(e){var i=this._originalScale,n=this._extent,a=i.getExtent(),s=gy.getTicks.call(this,e);return te(s,function(o){var l=o.value,u=Yi(i1(this.base,l));return u=l===n[0]&&this._fixMin?n1(u,a[0]):u,u=l===n[1]&&this._fixMax?n1(u,a[1]):u,{value:u}},this)},t.prototype.setExtent=function(e,i){var n=Ao(this.base);e=Ao(Math.max(0,e))/n,i=Ao(Math.max(0,i))/n,gy.setExtent.call(this,e,i)},t.prototype.getExtent=function(){var e=this.base,i=o5.getExtent.call(this);i[0]=i1(e,i[0]),i[1]=i1(e,i[1]);var n=this._originalScale,a=n.getExtent();return this._fixMin&&(i[0]=n1(i[0],a[0])),this._fixMax&&(i[1]=n1(i[1],a[1])),i},t.prototype.unionExtent=function(e){this._originalScale.unionExtent(e);var i=this.base;e[0]=Ao(e[0])/Ao(i),e[1]=Ao(e[1])/Ao(i),o5.unionExtent.call(this,e)},t.prototype.unionExtentFromData=function(e,i){this.unionExtent(e.getApproximateExtent(i))},t.prototype.calcNiceTicks=function(e){e=e||10;var i=this._extent,n=i[1]-i[0];if(!(n===1/0||n<=0)){var a=iyt(n),s=e/n*a;for(s<=.5&&(a*=10);!isNaN(a)&&Math.abs(a)<1&&Math.abs(a)>0;)a*=10;var o=[Yi(xwt(i[0]/a)*a),Yi(_wt(i[1]/a)*a)];this._interval=a,this._niceExtent=o}},t.prototype.calcNiceExtent=function(e){gy.calcNiceExtent.call(this,e),this._fixMin=e.fixMin,this._fixMax=e.fixMax},t.prototype.parse=function(e){return e},t.prototype.contain=function(e){return e=Ao(e)/Ao(this.base),WS(e,this._extent)},t.prototype.normalize=function(e){return e=Ao(e)/Ao(this.base),HS(e,this._extent)},t.prototype.scale=function(e){return e=GS(e,this._extent),i1(this.base,e)},t.type="log",t}(Tu),LG=MD.prototype;LG.getMinorTicks=gy.getMinorTicks;LG.getLabel=gy.getLabel;function n1(r,t){return ywt(r,gl(t))}Tu.registerClass(MD);const bwt=MD;var wwt=function(){function r(t,e,i){this._prepareParams(t,e,i)}return r.prototype._prepareParams=function(t,e,i){i[1]<i[0]&&(i=[NaN,NaN]),this._dataMin=i[0],this._dataMax=i[1];var n=this._isOrdinal=t.type==="ordinal";this._needCrossZero=t.type==="interval"&&e.getNeedCrossZero&&e.getNeedCrossZero();var a=e.get("min",!0);a==null&&(a=e.get("startValue",!0));var s=this._modelMinRaw=a;Ve(s)?this._modelMinNum=a1(t,s({min:i[0],max:i[1]})):s!=="dataMin"&&(this._modelMinNum=a1(t,s));var o=this._modelMaxRaw=e.get("max",!0);if(Ve(o)?this._modelMaxNum=a1(t,o({min:i[0],max:i[1]})):o!=="dataMax"&&(this._modelMaxNum=a1(t,o)),n)this._axisDataLen=e.getCategories().length;else{var l=e.get("boundaryGap"),u=Kt(l)?l:[l||0,l||0];typeof u[0]=="boolean"||typeof u[1]=="boolean"?this._boundaryGapInner=[0,0]:this._boundaryGapInner=[zo(u[0],1),zo(u[1],1)]}},r.prototype.calculate=function(){var t=this._isOrdinal,e=this._dataMin,i=this._dataMax,n=this._axisDataLen,a=this._boundaryGapInner,s=t?null:i-e||Math.abs(e),o=this._modelMinRaw==="dataMin"?e:this._modelMinNum,l=this._modelMaxRaw==="dataMax"?i:this._modelMaxNum,u=o!=null,c=l!=null;o==null&&(o=t?n?0:NaN:e-a[0]*s),l==null&&(l=t?n?n-1:NaN:i+a[1]*s),(o==null||!isFinite(o))&&(o=NaN),(l==null||!isFinite(l))&&(l=NaN);var h=zy(o)||zy(l)||t&&!n;this._needCrossZero&&(o>0&&l>0&&!u&&(o=0),o<0&&l<0&&!c&&(l=0));var p=this._determinedMin,v=this._determinedMax;return p!=null&&(o=p,u=!0),v!=null&&(l=v,c=!0),{min:o,max:l,minFixed:u,maxFixed:c,isBlank:h}},r.prototype.modifyDataMinMax=function(t,e){this[Twt[t]]=e},r.prototype.setDeterminedMinMax=function(t,e){var i=Swt[t];this[i]=e},r.prototype.freeze=function(){this.frozen=!0},r}(),Swt={min:"_determinedMin",max:"_determinedMax"},Twt={min:"_dataMin",max:"_dataMax"};function kG(r,t,e){var i=r.rawExtentInfo;return i||(i=new wwt(r,t,e),r.rawExtentInfo=i,i)}function a1(r,t){return t==null?null:zy(t)?NaN:r.parse(t)}function OG(r,t){var e=r.type,i=kG(r,t,r.getExtent()).calculate();r.setBlank(i.isBlank);var n=i.min,a=i.max,s=t.ecModel;if(s&&e==="time"){var o=TG("bar",s),l=!1;if(J(o,function(h){l=l||h.getBaseAxis()===t.axis}),l){var u=AG(o),c=Awt(n,a,t,u);n=c.min,a=c.max}}return{extent:[n,a],fixMin:i.minFixed,fixMax:i.maxFixed}}function Awt(r,t,e,i){var n=e.axis.getExtent(),a=n[1]-n[0],s=lwt(i,e.axis);if(s===void 0)return{min:r,max:t};var o=1/0;J(s,function(v){o=Math.min(v.offset,o)});var l=-1/0;J(s,function(v){l=Math.max(v.offset+v.width,l)}),o=Math.abs(o),l=Math.abs(l);var u=o+l,c=t-r,h=1-(o+l)/a,p=c/h-c;return t+=p*(l/u),r-=p*(o/u),{min:r,max:t}}function vg(r,t){var e=t,i=OG(r,e),n=i.extent,a=e.get("splitNumber");r instanceof bwt&&(r.base=e.get("logBase"));var s=r.type,o=e.get("interval"),l=s==="interval"||s==="time";r.setExtent(n[0],n[1]),r.calcNiceExtent({splitNumber:a,fixMin:i.fixMin,fixMax:i.fixMax,minInterval:l?e.get("minInterval"):null,maxInterval:l?e.get("maxInterval"):null}),o!=null&&r.setInterval&&r.setInterval(o)}function jS(r,t){if(t=t||r.get("type"),t)switch(t){case"category":return new CD({ordinalMeta:r.getOrdinalMeta?r.getOrdinalMeta():r.getCategories(),extent:[1/0,-1/0]});case"time":return new DG({locale:r.ecModel.getLocaleModel(),useUTC:r.ecModel.get("useUTC")});default:return new(Tu.getClass(t)||Gc)}}function Cwt(r){var t=r.scale.getExtent(),e=t[0],i=t[1];return!(e>0&&i>0||e<0&&i<0)}function Wg(r){var t=r.getLabelModel().get("formatter"),e=r.type==="category"?r.scale.getExtent()[0]:null;return r.scale.type==="time"?function(i){return function(n,a){return r.scale.getFormattedLabel(n,a,i)}}(t):ve(t)?function(i){return function(n){var a=r.scale.getLabel(n),s=i.replace("{value}",a??"");return s}}(t):Ve(t)?function(i){return function(n,a){return e!=null&&(a=n.value-e),i(PD(r,n),a,n.level!=null?{level:n.level}:null)}}(t):function(i){return r.scale.getLabel(i)}}function PD(r,t){return r.type==="category"?r.scale.getLabel(t):t.value}function Ewt(r){var t=r.model,e=r.scale;if(!(!t.get(["axisLabel","show"])||e.isBlank())){var i,n,a=e.getExtent();e instanceof CD?n=e.count():(i=e.getTicks(),n=i.length);var s=r.getLabelModel(),o=Wg(r),l,u=1;n>40&&(u=Math.ceil(n/40));for(var c=0;c<n;c+=u){var h=i?i[c]:{value:a[0]+c},p=o(h,c),v=s.getTextRect(p),y=Iwt(v,s.get("rotate")||0);l?l.union(y):l=y}return l}}function Iwt(r,t){var e=t*Math.PI/180,i=r.width,n=r.height,a=i*Math.abs(Math.cos(e))+Math.abs(n*Math.sin(e)),s=i*Math.abs(Math.sin(e))+Math.abs(n*Math.cos(e)),o=new hr(r.x,r.y,a,s);return o}function RD(r){var t=r.get("interval");return t??"auto"}function NG(r){return r.type==="category"&&RD(r.getLabelModel())===0}function dw(r,t){var e={};return J(r.mapDimensionsAll(t),function(i){e[yG(r,i)]=!0}),br(e)}function Mwt(r,t,e){t&&J(dw(t,e),function(i){var n=t.getApproximateExtent(i);n[0]<r[0]&&(r[0]=n[0]),n[1]>r[1]&&(r[1]=n[1])})}var O_=function(){function r(){}return r.prototype.getNeedCrossZero=function(){var t=this.option;return!t.scale},r.prototype.getCoordSysModel=function(){},r}(),Pwt=1e-8;function l5(r,t){return Math.abs(r-t)<Pwt}function nf(r,t,e){var i=0,n=r[0];if(!n)return!1;for(var a=1;a<r.length;a++){var s=r[a];i+=Jl(n[0],n[1],s[0],s[1],t,e),n=s}var o=r[0];return(!l5(n[0],o[0])||!l5(n[1],o[1]))&&(i+=Jl(n[0],n[1],o[0],o[1],t,e)),i!==0}var Rwt=[];function iC(r,t){for(var e=0;e<r.length;e++)Qn(r[e],r[e],t)}function u5(r,t,e,i){for(var n=0;n<r.length;n++){var a=r[n];i&&(a=i.project(a)),a&&isFinite(a[0])&&isFinite(a[1])&&(bc(t,t,a),wc(e,e,a))}}function Dwt(r){for(var t=0,e=0,i=0,n=r.length,a=r[n-1][0],s=r[n-1][1],o=0;o<n;o++){var l=r[o][0],u=r[o][1],c=a*u-l*s;t+=c,e+=(a+l)*c,i+=(s+u)*c,a=l,s=u}return t?[e/t/3,i/t/3,t]:[r[0][0]||0,r[0][1]||0]}var FG=function(){function r(t){this.name=t}return r.prototype.setCenter=function(t){this._center=t},r.prototype.getCenter=function(){var t=this._center;return t||(t=this._center=this.calcCenter()),t},r}(),c5=function(){function r(t,e){this.type="polygon",this.exterior=t,this.interiors=e}return r}(),h5=function(){function r(t){this.type="linestring",this.points=t}return r}(),BG=function(r){Vt(t,r);function t(e,i,n){var a=r.call(this,e)||this;return a.type="geoJSON",a.geometries=i,a._center=n&&[n[0],n[1]],a}return t.prototype.calcCenter=function(){for(var e=this.geometries,i,n=0,a=0;a<e.length;a++){var s=e[a],o=s.exterior,l=o&&o.length;l>n&&(i=s,n=l)}if(i)return Dwt(i.exterior);var u=this.getBoundingRect();return[u.x+u.width/2,u.y+u.height/2]},t.prototype.getBoundingRect=function(e){var i=this._rect;if(i&&!e)return i;var n=[1/0,1/0],a=[-1/0,-1/0],s=this.geometries;return J(s,function(o){o.type==="polygon"?u5(o.exterior,n,a,e):J(o.points,function(l){u5(l,n,a,e)})}),isFinite(n[0])&&isFinite(n[1])&&isFinite(a[0])&&isFinite(a[1])||(n[0]=n[1]=a[0]=a[1]=0),i=new hr(n[0],n[1],a[0]-n[0],a[1]-n[1]),e||(this._rect=i),i},t.prototype.contain=function(e){var i=this.getBoundingRect(),n=this.geometries;if(!i.contain(e[0],e[1]))return!1;t:for(var a=0,s=n.length;a<s;a++){var o=n[a];if(o.type==="polygon"){var l=o.exterior,u=o.interiors;if(nf(l,e[0],e[1])){for(var c=0;c<(u?u.length:0);c++)if(nf(u[c],e[0],e[1]))continue t;return!0}}}return!1},t.prototype.transformTo=function(e,i,n,a){var s=this.getBoundingRect(),o=s.width/s.height;n?a||(a=n/o):n=o*a;for(var l=new hr(e,i,n,a),u=s.calculateTransform(l),c=this.geometries,h=0;h<c.length;h++){var p=c[h];p.type==="polygon"?(iC(p.exterior,u),J(p.interiors,function(v){iC(v,u)})):J(p.points,function(v){iC(v,u)})}s=this._rect,s.copy(l),this._center=[s.x+s.width/2,s.y+s.height/2]},t.prototype.cloneShallow=function(e){e==null&&(e=this.name);var i=new t(e,this.geometries,this._center);return i._rect=this._rect,i.transformTo=null,i},t}(FG),Lwt=function(r){Vt(t,r);function t(e,i){var n=r.call(this,e)||this;return n.type="geoSVG",n._elOnlyForCalculate=i,n}return t.prototype.calcCenter=function(){for(var e=this._elOnlyForCalculate,i=e.getBoundingRect(),n=[i.x+i.width/2,i.y+i.height/2],a=yS(Rwt),s=e;s&&!s.isGeoSVGGraphicRoot;)lu(a,s.getLocalTransform(),a),s=s.parent;return Mg(a,a),Qn(n,n,a),n},t}(FG);function kwt(r){if(!r.UTF8Encoding)return r;var t=r,e=t.UTF8Scale;e==null&&(e=1024);var i=t.features;return J(i,function(n){var a=n.geometry,s=a.encodeOffsets,o=a.coordinates;if(s)switch(a.type){case"LineString":a.coordinates=zG(o,s,e);break;case"Polygon":nC(o,s,e);break;case"MultiLineString":nC(o,s,e);break;case"MultiPolygon":J(o,function(l,u){return nC(l,s[u],e)})}}),t.UTF8Encoding=!1,t}function nC(r,t,e){for(var i=0;i<r.length;i++)r[i]=zG(r[i],t[i],e)}function zG(r,t,e){for(var i=[],n=t[0],a=t[1],s=0;s<r.length;s+=2){var o=r.charCodeAt(s)-64,l=r.charCodeAt(s+1)-64;o=o>>1^-(o&1),l=l>>1^-(l&1),o+=n,l+=a,n=o,a=l,i.push([o/e,l/e])}return i}function Owt(r,t){return r=kwt(r),te(ti(r.features,function(e){return e.geometry&&e.properties&&e.geometry.coordinates.length>0}),function(e){var i=e.properties,n=e.geometry,a=[];switch(n.type){case"Polygon":var s=n.coordinates;a.push(new c5(s[0],s.slice(1)));break;case"MultiPolygon":J(n.coordinates,function(l){l[0]&&a.push(new c5(l[0],l.slice(1)))});break;case"LineString":a.push(new h5([n.coordinates]));break;case"MultiLineString":a.push(new h5(n.coordinates))}var o=new BG(i[t||"name"],a,i.cp);return o.properties=i,o})}var e_=Ir();function VG(r,t){var e=te(t,function(i){return r.scale.parse(i)});return r.type==="time"&&e.length>0&&(e.sort(),e.unshift(e[0]),e.push(e[e.length-1])),e}function Nwt(r){var t=r.getLabelModel().get("customValues");if(t){var e=Wg(r);return{labels:VG(r,t).map(function(i){var n={value:i};return{formattedLabel:e(n),rawLabel:r.scale.getLabel(n),tickValue:i}})}}return r.type==="category"?Bwt(r):Vwt(r)}function Fwt(r,t){var e=r.getTickModel().get("customValues");return e?{ticks:VG(r,e)}:r.type==="category"?zwt(r,t):{ticks:te(r.scale.getTicks(),function(i){return i.value})}}function Bwt(r){var t=r.getLabelModel(),e=UG(r,t);return!t.get("show")||r.scale.isBlank()?{labels:[],labelCategoryInterval:e.labelCategoryInterval}:e}function UG(r,t){var e=$G(r,"labels"),i=RD(t),n=WG(e,i);if(n)return n;var a,s;return Ve(i)?a=jG(r,i):(s=i==="auto"?Uwt(r):i,a=GG(r,s)),HG(e,i,{labels:a,labelCategoryInterval:s})}function zwt(r,t){var e=$G(r,"ticks"),i=RD(t),n=WG(e,i);if(n)return n;var a,s;if((!t.get("show")||r.scale.isBlank())&&(a=[]),Ve(i))a=jG(r,i,!0);else if(i==="auto"){var o=UG(r,r.getLabelModel());s=o.labelCategoryInterval,a=te(o.labels,function(l){return l.tickValue})}else s=i,a=GG(r,s,!0);return HG(e,i,{ticks:a,tickCategoryInterval:s})}function Vwt(r){var t=r.scale.getTicks(),e=Wg(r);return{labels:te(t,function(i,n){return{level:i.level,formattedLabel:e(i,n),rawLabel:r.scale.getLabel(i),tickValue:i.value}})}}function $G(r,t){return e_(r)[t]||(e_(r)[t]=[])}function WG(r,t){for(var e=0;e<r.length;e++)if(r[e].key===t)return r[e].value}function HG(r,t,e){return r.push({key:t,value:e}),e}function Uwt(r){var t=e_(r).autoInterval;return t??(e_(r).autoInterval=r.calculateCategoryInterval())}function $wt(r){var t=Wwt(r),e=Wg(r),i=(t.axisRotate-t.labelRotate)/180*Math.PI,n=r.scale,a=n.getExtent(),s=n.count();if(a[1]-a[0]<1)return 0;var o=1;s>40&&(o=Math.max(1,Math.floor(s/40)));for(var l=a[0],u=r.dataToCoord(l+1)-r.dataToCoord(l),c=Math.abs(u*Math.cos(i)),h=Math.abs(u*Math.sin(i)),p=0,v=0;l<=a[1];l+=o){var y=0,x=0,w=C_(e({value:l}),t.font,"center","top");y=w.width*1.3,x=w.height*1.3,p=Math.max(p,y,7),v=Math.max(v,x,7)}var T=p/c,E=v/h;isNaN(T)&&(T=1/0),isNaN(E)&&(E=1/0);var M=Math.max(0,Math.floor(Math.min(T,E))),L=e_(r.model),F=r.getExtent(),O=L.lastAutoInterval,U=L.lastTickCount;return O!=null&&U!=null&&Math.abs(O-M)<=1&&Math.abs(U-s)<=1&&O>M&&L.axisExtent0===F[0]&&L.axisExtent1===F[1]?M=O:(L.lastTickCount=s,L.lastAutoInterval=M,L.axisExtent0=F[0],L.axisExtent1=F[1]),M}function Wwt(r){var t=r.getLabelModel();return{axisRotate:r.getRotate?r.getRotate():r.isHorizontal&&!r.isHorizontal()?90:0,labelRotate:t.get("rotate")||0,font:t.getFont()}}function GG(r,t,e){var i=Wg(r),n=r.scale,a=n.getExtent(),s=r.getLabelModel(),o=[],l=Math.max((t||0)+1,1),u=a[0],c=n.count();u!==0&&l>1&&c/l>2&&(u=Math.round(Math.ceil(u/l)*l));var h=NG(r),p=s.get("showMinLabel")||h,v=s.get("showMaxLabel")||h;p&&u!==a[0]&&x(a[0]);for(var y=u;y<=a[1];y+=l)x(y);v&&y-l!==a[1]&&x(a[1]);function x(w){var T={value:w};o.push(e?w:{formattedLabel:i(T),rawLabel:n.getLabel(T),tickValue:w})}return o}function jG(r,t,e){var i=r.scale,n=Wg(r),a=[];return J(i.getTicks(),function(s){var o=i.getLabel(s),l=s.value;t(s.value,o)&&a.push(e?l:{formattedLabel:n(s),rawLabel:o,tickValue:l})}),a}var f5=[0,1],Hwt=function(){function r(t,e,i){this.onBand=!1,this.inverse=!1,this.dim=t,this.scale=e,this._extent=i||[0,0]}return r.prototype.contain=function(t){var e=this._extent,i=Math.min(e[0],e[1]),n=Math.max(e[0],e[1]);return t>=i&&t<=n},r.prototype.containData=function(t){return this.scale.contain(t)},r.prototype.getExtent=function(){return this._extent.slice()},r.prototype.getPixelPrecision=function(t){return MH(t||this.scale.getExtent(),this._extent)},r.prototype.setExtent=function(t,e){var i=this._extent;i[0]=t,i[1]=e},r.prototype.dataToCoord=function(t,e){var i=this._extent,n=this.scale;return t=n.normalize(t),this.onBand&&n.type==="ordinal"&&(i=i.slice(),d5(i,n.count())),Jr(t,f5,i,e)},r.prototype.coordToData=function(t,e){var i=this._extent,n=this.scale;this.onBand&&n.type==="ordinal"&&(i=i.slice(),d5(i,n.count()));var a=Jr(t,i,f5,e);return this.scale.scale(a)},r.prototype.pointToData=function(t,e){},r.prototype.getTicksCoords=function(t){t=t||{};var e=t.tickModel||this.getTickModel(),i=Fwt(this,e),n=i.ticks,a=te(n,function(o){return{coord:this.dataToCoord(this.scale.type==="ordinal"?this.scale.getRawOrdinalNumber(o):o),tickValue:o}},this),s=e.get("alignWithLabel");return Gwt(this,a,s,t.clamp),a},r.prototype.getMinorTicksCoords=function(){if(this.scale.type==="ordinal")return[];var t=this.model.getModel("minorTick"),e=t.get("splitNumber");e>0&&e<100||(e=5);var i=this.scale.getMinorTicks(e),n=te(i,function(a){return te(a,function(s){return{coord:this.dataToCoord(s),tickValue:s}},this)},this);return n},r.prototype.getViewLabels=function(){return Nwt(this).labels},r.prototype.getLabelModel=function(){return this.model.getModel("axisLabel")},r.prototype.getTickModel=function(){return this.model.getModel("axisTick")},r.prototype.getBandWidth=function(){var t=this._extent,e=this.scale.getExtent(),i=e[1]-e[0]+(this.onBand?1:0);i===0&&(i=1);var n=Math.abs(t[1]-t[0]);return Math.abs(n)/i},r.prototype.calculateCategoryInterval=function(){return $wt(this)},r}();function d5(r,t){var e=r[1]-r[0],i=t,n=e/i/2;r[0]+=n,r[1]-=n}function Gwt(r,t,e,i){var n=t.length;if(!r.onBand||e||!n)return;var a=r.getExtent(),s,o;if(n===1)t[0].coord=a[0],s=t[1]={coord:a[1]};else{var l=t[n-1].tickValue-t[0].tickValue,u=(t[n-1].coord-t[0].coord)/l;J(t,function(v){v.coord-=u/2});var c=r.scale.getExtent();o=1+c[1]-t[n-1].tickValue,s={coord:t[n-1].coord+u*o},t.push(s)}var h=a[0]>a[1];p(t[0].coord,a[0])&&(i?t[0].coord=a[0]:t.shift()),i&&p(a[0],t[0].coord)&&t.unshift({coord:a[0]}),p(a[1],s.coord)&&(i?s.coord=a[1]:t.pop()),i&&p(s.coord,a[1])&&t.push({coord:a[1]});function p(v,y){return v=Yi(v),y=Yi(y),h?v>y:v<y}}const $o=Hwt;var xm=Math.PI*2,Hh=Al.CMD,jwt=["top","right","bottom","left"];function Xwt(r,t,e,i,n){var a=e.width,s=e.height;switch(r){case"top":i.set(e.x+a/2,e.y-t),n.set(0,-1);break;case"bottom":i.set(e.x+a/2,e.y+s+t),n.set(0,1);break;case"left":i.set(e.x-t,e.y+s/2),n.set(-1,0);break;case"right":i.set(e.x+a+t,e.y+s/2),n.set(1,0);break}}function Zwt(r,t,e,i,n,a,s,o,l){s-=r,o-=t;var u=Math.sqrt(s*s+o*o);s/=u,o/=u;var c=s*e+r,h=o*e+t;if(Math.abs(i-n)%xm<1e-4)return l[0]=c,l[1]=h,u-e;if(a){var p=i;i=Cs(n),n=Cs(p)}else i=Cs(i),n=Cs(n);i>n&&(n+=xm);var v=Math.atan2(o,s);if(v<0&&(v+=xm),v>=i&&v<=n||v+xm>=i&&v+xm<=n)return l[0]=c,l[1]=h,u-e;var y=e*Math.cos(i)+r,x=e*Math.sin(i)+t,w=e*Math.cos(n)+r,T=e*Math.sin(n)+t,E=(y-s)*(y-s)+(x-o)*(x-o),M=(w-s)*(w-s)+(T-o)*(T-o);return E<M?(l[0]=y,l[1]=x,Math.sqrt(E)):(l[0]=w,l[1]=T,Math.sqrt(M))}function pw(r,t,e,i,n,a,s,o){var l=n-r,u=a-t,c=e-r,h=i-t,p=Math.sqrt(c*c+h*h);c/=p,h/=p;var v=l*c+u*h,y=v/p;o&&(y=Math.min(Math.max(y,0),1)),y*=p;var x=s[0]=r+y*c,w=s[1]=t+y*h;return Math.sqrt((x-n)*(x-n)+(w-a)*(w-a))}function XG(r,t,e,i,n,a,s){e<0&&(r=r+e,e=-e),i<0&&(t=t+i,i=-i);var o=r+e,l=t+i,u=s[0]=Math.min(Math.max(n,r),o),c=s[1]=Math.min(Math.max(a,t),l);return Math.sqrt((u-n)*(u-n)+(c-a)*(c-a))}var Mo=[];function qwt(r,t,e){var i=XG(t.x,t.y,t.width,t.height,r.x,r.y,Mo);return e.set(Mo[0],Mo[1]),i}function Ywt(r,t,e){for(var i=0,n=0,a=0,s=0,o,l,u=1/0,c=t.data,h=r.x,p=r.y,v=0;v<c.length;){var y=c[v++];v===1&&(i=c[v],n=c[v+1],a=i,s=n);var x=u;switch(y){case Hh.M:a=c[v++],s=c[v++],i=a,n=s;break;case Hh.L:x=pw(i,n,c[v],c[v+1],h,p,Mo,!0),i=c[v++],n=c[v++];break;case Hh.C:x=uH(i,n,c[v++],c[v++],c[v++],c[v++],c[v],c[v+1],h,p,Mo),i=c[v++],n=c[v++];break;case Hh.Q:x=hH(i,n,c[v++],c[v++],c[v],c[v+1],h,p,Mo),i=c[v++],n=c[v++];break;case Hh.A:var w=c[v++],T=c[v++],E=c[v++],M=c[v++],L=c[v++],F=c[v++];v+=1;var O=!!(1-c[v++]);o=Math.cos(L)*E+w,l=Math.sin(L)*M+T,v<=1&&(a=o,s=l);var U=(h-w)*M/E+w;x=Zwt(w,T,M,L,L+F,O,U,p,Mo),i=Math.cos(L+F)*E+w,n=Math.sin(L+F)*M+T;break;case Hh.R:a=i=c[v++],s=n=c[v++];var W=c[v++],H=c[v++];x=XG(a,s,W,H,h,p,Mo);break;case Hh.Z:x=pw(i,n,a,s,h,p,Mo,!0),i=a,n=s;break}x<u&&(u=x,e.set(Mo[0],Mo[1]))}return u}var Oo=new lr,ci=new lr,en=new lr,yl=new lr,dl=new lr;function p5(r,t){if(r){var e=r.getTextGuideLine(),i=r.getTextContent();if(i&&e){var n=r.textGuideLineConfig||{},a=[[0,0],[0,0],[0,0]],s=n.candidates||jwt,o=i.getBoundingRect().clone();o.applyTransform(i.getComputedTransform());var l=1/0,u=n.anchor,c=r.getComputedTransform(),h=c&&Mg([],c),p=t.get("length2")||0;u&&en.copy(u);for(var v=0;v<s.length;v++){var y=s[v];Xwt(y,0,o,Oo,yl),lr.scaleAndAdd(ci,Oo,yl,p),ci.transform(h);var x=r.getBoundingRect(),w=u?u.distance(ci):r instanceof vr?Ywt(ci,r.path,en):qwt(ci,x,en);w<l&&(l=w,ci.transform(c),en.transform(c),en.toArray(a[0]),ci.toArray(a[1]),Oo.toArray(a[2]))}ZG(a,t.get("minTurnAngle")),e.setShape({points:a})}}}var gw=[],Ha=new lr;function ZG(r,t){if(t<=180&&t>0){t=t/180*Math.PI,Oo.fromArray(r[0]),ci.fromArray(r[1]),en.fromArray(r[2]),lr.sub(yl,Oo,ci),lr.sub(dl,en,ci);var e=yl.len(),i=dl.len();if(!(e<.001||i<.001)){yl.scale(1/e),dl.scale(1/i);var n=yl.dot(dl),a=Math.cos(t);if(a<n){var s=pw(ci.x,ci.y,en.x,en.y,Oo.x,Oo.y,gw,!1);Ha.fromArray(gw),Ha.scaleAndAdd(dl,s/Math.tan(Math.PI-t));var o=en.x!==ci.x?(Ha.x-ci.x)/(en.x-ci.x):(Ha.y-ci.y)/(en.y-ci.y);if(isNaN(o))return;o<0?lr.copy(Ha,ci):o>1&&lr.copy(Ha,en),Ha.toArray(r[1])}}}}function Kwt(r,t,e){if(e<=180&&e>0){e=e/180*Math.PI,Oo.fromArray(r[0]),ci.fromArray(r[1]),en.fromArray(r[2]),lr.sub(yl,ci,Oo),lr.sub(dl,en,ci);var i=yl.len(),n=dl.len();if(!(i<.001||n<.001)){yl.scale(1/i),dl.scale(1/n);var a=yl.dot(t),s=Math.cos(e);if(a<s){var o=pw(ci.x,ci.y,en.x,en.y,Oo.x,Oo.y,gw,!1);Ha.fromArray(gw);var l=Math.PI/2,u=Math.acos(dl.dot(t)),c=l+u-e;if(c>=l)lr.copy(Ha,en);else{Ha.scaleAndAdd(dl,o/Math.tan(Math.PI/2-c));var h=en.x!==ci.x?(Ha.x-ci.x)/(en.x-ci.x):(Ha.y-ci.y)/(en.y-ci.y);if(isNaN(h))return;h<0?lr.copy(Ha,ci):h>1&&lr.copy(Ha,en)}Ha.toArray(r[1])}}}}function aC(r,t,e,i){var n=e==="normal",a=n?r:r.ensureState(e);a.ignore=t;var s=i.get("smooth");s&&s===!0&&(s=.3),a.shape=a.shape||{},s>0&&(a.shape.smooth=s);var o=i.getModel("lineStyle").getLineStyle();n?r.useStyle(o):a.style=o}function Jwt(r,t){var e=t.smooth,i=t.points;if(i)if(r.moveTo(i[0][0],i[0][1]),e>0&&i.length>=3){var n=xc(i[0],i[1]),a=xc(i[1],i[2]);if(!n||!a){r.lineTo(i[1][0],i[1][1]),r.lineTo(i[2][0],i[2][1]);return}var s=Math.min(n,a)*e,o=$1([],i[1],i[0],s/n),l=$1([],i[1],i[2],s/a),u=$1([],o,l,.5);r.bezierCurveTo(o[0],o[1],o[0],o[1],u[0],u[1]),r.bezierCurveTo(l[0],l[1],l[0],l[1],i[2][0],i[2][1])}else for(var c=1;c<i.length;c++)r.lineTo(i[c][0],i[c][1])}function DD(r,t,e){var i=r.getTextGuideLine(),n=r.getTextContent();if(!n){i&&r.removeTextGuideLine();return}for(var a=t.normal,s=a.get("show"),o=n.ignore,l=0;l<jy.length;l++){var u=jy[l],c=t[u],h=u==="normal";if(c){var p=c.get("show"),v=h?o:ir(n.states[u]&&n.states[u].ignore,o);if(v||!ir(p,s)){var y=h?i:i&&i.states[u];y&&(y.ignore=!0),i&&aC(i,!0,u,c);continue}i||(i=new ps,r.setTextGuideLine(i),!h&&(o||!s)&&aC(i,!0,"normal",t.normal),r.stateProxy&&(i.stateProxy=r.stateProxy)),aC(i,!1,u,c)}}if(i){We(i.style,e),i.style.fill=null;var x=a.get("showAbove"),w=r.textGuideLineConfig=r.textGuideLineConfig||{};w.showAbove=x||!1,i.buildPath=Jwt}}function LD(r,t){t=t||"labelLine";for(var e={normal:r.getModel(t)},i=0;i<qa.length;i++){var n=qa[i];e[n]=r.getModel([n,t])}return e}function qG(r){for(var t=[],e=0;e<r.length;e++){var i=r[e];if(!i.defaultAttr.ignore){var n=i.label,a=n.getComputedTransform(),s=n.getBoundingRect(),o=!a||a[1]<1e-5&&a[2]<1e-5,l=n.style.margin||0,u=s.clone();u.applyTransform(a),u.x-=l/2,u.y-=l/2,u.width+=l,u.height+=l;var c=o?new Qb(s,a):null;t.push({label:n,labelLine:i.labelLine,rect:u,localRect:s,obb:c,priority:i.priority,defaultAttr:i.defaultAttr,layoutOption:i.computedLayoutOption,axisAligned:o,transform:a})}}return t}function YG(r,t,e,i,n,a){var s=r.length;if(s<2)return;r.sort(function(W,H){return W.rect[t]-H.rect[t]});for(var o=0,l,u=!1,c=0,h=0;h<s;h++){var p=r[h],v=p.rect;l=v[t]-o,l<0&&(v[t]-=l,p.label[t]-=l,u=!0);var y=Math.max(-l,0);c+=y,o=v[t]+v[e]}c>0&&a&&F(-c/s,0,s);var x=r[0],w=r[s-1],T,E;M(),T<0&&O(-T,.8),E<0&&O(E,.8),M(),L(T,E,1),L(E,T,-1),M(),T<0&&U(-T),E<0&&U(E);function M(){T=x.rect[t]-i,E=n-w.rect[t]-w.rect[e]}function L(W,H,j){if(W<0){var Y=Math.min(H,-W);if(Y>0){F(Y*j,0,s);var tt=Y+W;tt<0&&O(-tt*j,1)}else O(-W*j,1)}}function F(W,H,j){W!==0&&(u=!0);for(var Y=H;Y<j;Y++){var tt=r[Y],it=tt.rect;it[t]+=W,tt.label[t]+=W}}function O(W,H){for(var j=[],Y=0,tt=1;tt<s;tt++){var it=r[tt-1].rect,lt=Math.max(r[tt].rect[t]-it[t]-it[e],0);j.push(lt),Y+=lt}if(Y){var ht=Math.min(Math.abs(W)/Y,H);if(W>0)for(var tt=0;tt<s-1;tt++){var Tt=j[tt]*ht;F(Tt,0,tt+1)}else for(var tt=s-1;tt>0;tt--){var Tt=j[tt-1]*ht;F(-Tt,tt,s)}}}function U(W){var H=W<0?-1:1;W=Math.abs(W);for(var j=Math.ceil(W/(s-1)),Y=0;Y<s-1;Y++)if(H>0?F(j,0,Y+1):F(-j,s-Y-1,s),W-=j,W<=0)return}return u}function Qwt(r,t,e,i){return YG(r,"x","width",t,e,i)}function KG(r,t,e,i){return YG(r,"y","height",t,e,i)}function JG(r){var t=[];r.sort(function(x,w){return w.priority-x.priority});var e=new hr(0,0,0,0);function i(x){if(!x.ignore){var w=x.ensureState("emphasis");w.ignore==null&&(w.ignore=!1)}x.ignore=!0}for(var n=0;n<r.length;n++){var a=r[n],s=a.axisAligned,o=a.localRect,l=a.transform,u=a.label,c=a.labelLine;e.copy(a.rect),e.width-=.1,e.height-=.1,e.x+=.05,e.y+=.05;for(var h=a.obb,p=!1,v=0;v<t.length;v++){var y=t[v];if(e.intersect(y.rect)){if(s&&y.axisAligned){p=!0;break}if(y.obb||(y.obb=new Qb(y.localRect,y.transform)),h||(h=new Qb(o,l)),h.intersect(y.obb)){p=!0;break}}}p?(i(u),c&&i(c)):(u.attr("ignore",a.defaultAttr.ignore),c&&c.attr("ignore",a.defaultAttr.labelGuideIgnore),t.push(a))}}function tSt(r){if(r){for(var t=[],e=0;e<r.length;e++)t.push(r[e].slice());return t}}function eSt(r,t){var e=r.label,i=t&&t.getTextGuideLine();return{dataIndex:r.dataIndex,dataType:r.dataType,seriesIndex:r.seriesModel.seriesIndex,text:r.label.style.text,rect:r.hostRect,labelRect:r.rect,align:e.style.align,verticalAlign:e.style.verticalAlign,labelLinePoints:tSt(i&&i.shape.points)}}var g5=["align","verticalAlign","width","height","fontSize"],za=new ru,sC=Ir(),rSt=Ir();function s1(r,t,e){for(var i=0;i<e.length;i++){var n=e[i];t[n]!=null&&(r[n]=t[n])}}var o1=["x","y","rotation"],iSt=function(){function r(){this._labelList=[],this._chartViewList=[]}return r.prototype.clearLabels=function(){this._labelList=[],this._chartViewList=[]},r.prototype._addLabel=function(t,e,i,n,a){var s=n.style,o=n.__hostTarget,l=o.textConfig||{},u=n.getComputedTransform(),c=n.getBoundingRect().plain();hr.applyTransform(c,c,u),u?za.setLocalTransform(u):(za.x=za.y=za.rotation=za.originX=za.originY=0,za.scaleX=za.scaleY=1),za.rotation=Cs(za.rotation);var h=n.__hostTarget,p;if(h){p=h.getBoundingRect().plain();var v=h.getComputedTransform();hr.applyTransform(p,p,v)}var y=p&&h.getTextGuideLine();this._labelList.push({label:n,labelLine:y,seriesModel:i,dataIndex:t,dataType:e,layoutOption:a,computedLayoutOption:null,rect:c,hostRect:p,priority:p?p.width*p.height:0,defaultAttr:{ignore:n.ignore,labelGuideIgnore:y&&y.ignore,x:za.x,y:za.y,scaleX:za.scaleX,scaleY:za.scaleY,rotation:za.rotation,style:{x:s.x,y:s.y,align:s.align,verticalAlign:s.verticalAlign,width:s.width,height:s.height,fontSize:s.fontSize},cursor:n.cursor,attachedPos:l.position,attachedRot:l.rotation}})},r.prototype.addLabelsOfSeries=function(t){var e=this;this._chartViewList.push(t);var i=t.__model,n=i.get("labelLayout");(Ve(n)||br(n).length)&&t.group.traverse(function(a){if(a.ignore)return!0;var s=a.getTextContent(),o=Je(a);s&&!s.disableLabelLayout&&e._addLabel(o.dataIndex,o.dataType,i,s,n)})},r.prototype.updateLayoutConfig=function(t){var e=t.getWidth(),i=t.getHeight();function n(M,L){return function(){p5(M,L)}}for(var a=0;a<this._labelList.length;a++){var s=this._labelList[a],o=s.label,l=o.__hostTarget,u=s.defaultAttr,c=void 0;Ve(s.layoutOption)?c=s.layoutOption(eSt(s,l)):c=s.layoutOption,c=c||{},s.computedLayoutOption=c;var h=Math.PI/180;l&&l.setTextConfig({local:!1,position:c.x!=null||c.y!=null?null:u.attachedPos,rotation:c.rotate!=null?c.rotate*h:u.attachedRot,offset:[c.dx||0,c.dy||0]});var p=!1;if(c.x!=null?(o.x=he(c.x,e),o.setStyle("x",0),p=!0):(o.x=u.x,o.setStyle("x",u.style.x)),c.y!=null?(o.y=he(c.y,i),o.setStyle("y",0),p=!0):(o.y=u.y,o.setStyle("y",u.style.y)),c.labelLinePoints){var v=l.getTextGuideLine();v&&(v.setShape({points:c.labelLinePoints}),p=!1)}var y=sC(o);y.needsUpdateLabelLine=p,o.rotation=c.rotate!=null?c.rotate*h:u.rotation,o.scaleX=u.scaleX,o.scaleY=u.scaleY;for(var x=0;x<g5.length;x++){var w=g5[x];o.setStyle(w,c[w]!=null?c[w]:u.style[w])}if(c.draggable){if(o.draggable=!0,o.cursor="move",l){var T=s.seriesModel;if(s.dataIndex!=null){var E=s.seriesModel.getData(s.dataType);T=E.getItemModel(s.dataIndex)}o.on("drag",n(l,T.getModel("labelLine")))}}else o.off("drag"),o.cursor=u.cursor}},r.prototype.layout=function(t){var e=t.getWidth(),i=t.getHeight(),n=qG(this._labelList),a=ti(n,function(l){return l.layoutOption.moveOverlap==="shiftX"}),s=ti(n,function(l){return l.layoutOption.moveOverlap==="shiftY"});Qwt(a,0,e),KG(s,0,i);var o=ti(n,function(l){return l.layoutOption.hideOverlap});JG(o)},r.prototype.processLabelsOverall=function(){var t=this;J(this._chartViewList,function(e){var i=e.__model,n=e.ignoreLabelLineUpdate,a=i.isAnimationEnabled();e.group.traverse(function(s){if(s.ignore&&!s.forceLabelAnimation)return!0;var o=!n,l=s.getTextContent();!o&&l&&(o=sC(l).needsUpdateLabelLine),o&&t._updateLabelLine(s,i),a&&t._animateLabels(s,i)})})},r.prototype._updateLabelLine=function(t,e){var i=t.getTextContent(),n=Je(t),a=n.dataIndex;if(i&&a!=null){var s=e.getData(n.dataType),o=s.getItemModel(a),l={},u=s.getItemVisual(a,"style");if(u){var c=s.getVisual("drawType");l.stroke=u[c]}var h=o.getModel("labelLine");DD(t,LD(o),l),p5(t,h)}},r.prototype._animateLabels=function(t,e){var i=t.getTextContent(),n=t.getTextGuideLine();if(i&&(t.forceLabelAnimation||!i.ignore&&!i.invisible&&!t.disableLabelAnimation&&!Yp(t))){var a=sC(i),s=a.oldLayout,o=Je(t),l=o.dataIndex,u={x:i.x,y:i.y,rotation:i.rotation},c=e.getData(o.dataType);if(s){i.attr(s);var p=t.prevStates;p&&(pr(p,"select")>=0&&i.attr(a.oldLayoutSelect),pr(p,"emphasis")>=0&&i.attr(a.oldLayoutEmphasis)),zr(i,u,e,l)}else if(i.attr(u),!kg(i).valueAnimation){var h=ir(i.style.opacity,1);i.style.opacity=0,Ei(i,{style:{opacity:h}},e,l)}if(a.oldLayout=u,i.states.select){var v=a.oldLayoutSelect={};s1(v,u,o1),s1(v,i.states.select,o1)}if(i.states.emphasis){var y=a.oldLayoutEmphasis={};s1(y,u,o1),s1(y,i.states.emphasis,o1)}F7(i,l,c,e,e)}if(n&&!n.ignore&&!n.invisible){var a=rSt(n),s=a.oldLayout,x={points:n.shape.points};s?(n.attr({shape:s}),zr(n,{shape:x},e)):(n.setShape(x),n.style.strokePercent=0,Ei(n,{style:{strokePercent:1}},e)),a.oldLayout=x}},r}();const nSt=iSt;var oC=Ir();function aSt(r){r.registerUpdateLifecycle("series:beforeupdate",function(t,e,i){var n=oC(e).labelManager;n||(n=oC(e).labelManager=new nSt),n.clearLabels()}),r.registerUpdateLifecycle("series:layoutlabels",function(t,e,i){var n=oC(e).labelManager;i.updatedSeries.forEach(function(a){n.addLabelsOfSeries(e.getViewOfSeriesModel(a))}),n.updateLayoutConfig(e),n.layout(e),n.processLabelsOverall()})}var lC=Math.sin,uC=Math.cos,QG=Math.PI,Gh=Math.PI*2,sSt=180/QG,oSt=function(){function r(){}return r.prototype.reset=function(t){this._start=!0,this._d=[],this._str="",this._p=Math.pow(10,t||4)},r.prototype.moveTo=function(t,e){this._add("M",t,e)},r.prototype.lineTo=function(t,e){this._add("L",t,e)},r.prototype.bezierCurveTo=function(t,e,i,n,a,s){this._add("C",t,e,i,n,a,s)},r.prototype.quadraticCurveTo=function(t,e,i,n){this._add("Q",t,e,i,n)},r.prototype.arc=function(t,e,i,n,a,s){this.ellipse(t,e,i,i,0,n,a,s)},r.prototype.ellipse=function(t,e,i,n,a,s,o,l){var u=o-s,c=!l,h=Math.abs(u),p=Ac(h-Gh)||(c?u>=Gh:-u>=Gh),v=u>0?u%Gh:u%Gh+Gh,y=!1;p?y=!0:Ac(h)?y=!1:y=v>=QG==!!c;var x=t+i*uC(s),w=e+n*lC(s);this._start&&this._add("M",x,w);var T=Math.round(a*sSt);if(p){var E=1/this._p,M=(c?1:-1)*(Gh-E);this._add("A",i,n,T,1,+c,t+i*uC(s+M),e+n*lC(s+M)),E>.01&&this._add("A",i,n,T,0,+c,x,w)}else{var L=t+i*uC(o),F=e+n*lC(o);this._add("A",i,n,T,+y,+c,L,F)}},r.prototype.rect=function(t,e,i,n){this._add("M",t,e),this._add("l",i,0),this._add("l",0,n),this._add("l",-i,0),this._add("Z")},r.prototype.closePath=function(){this._d.length>0&&this._add("Z")},r.prototype._add=function(t,e,i,n,a,s,o,l,u){for(var c=[],h=this._p,p=1;p<arguments.length;p++){var v=arguments[p];if(isNaN(v)){this._invalid=!0;return}c.push(Math.round(v*h)/h)}this._d.push(t+c.join(" ")),this._start=t==="Z"},r.prototype.generateStr=function(){this._str=this._invalid?"":this._d.join(""),this._d=[]},r.prototype.getStr=function(){return this._str},r}();const tj=oSt;var vy="none",lSt=Math.round;function uSt(r){var t=r.fill;return t!=null&&t!==vy}function cSt(r){var t=r.stroke;return t!=null&&t!==vy}var MM=["lineCap","miterLimit","lineJoin"],hSt=te(MM,function(r){return"stroke-"+r.toLowerCase()});function fSt(r,t,e,i){var n=t.opacity==null?1:t.opacity;if(e instanceof ia){r("opacity",n);return}if(uSt(t)){var a=$y(t.fill);r("fill",a.color);var s=t.fillOpacity!=null?t.fillOpacity*a.opacity*n:a.opacity*n;(i||s<1)&&r("fill-opacity",s)}else r("fill",vy);if(cSt(t)){var o=$y(t.stroke);r("stroke",o.color);var l=t.strokeNoScale?e.getLineScale():1,u=l?(t.lineWidth||0)/l:0,c=t.strokeOpacity!=null?t.strokeOpacity*o.opacity*n:o.opacity*n,h=t.strokeFirst;if((i||u!==1)&&r("stroke-width",u),(i||h)&&r("paint-order",h?"stroke":"fill"),(i||c<1)&&r("stroke-opacity",c),t.lineDash){var p=xD(e),v=p[0],y=p[1];v&&(y=lSt(y||0),r("stroke-dasharray",v.join(",")),(y||i)&&r("stroke-dashoffset",y))}else i&&r("stroke-dasharray",vy);for(var x=0;x<MM.length;x++){var w=MM[x];if(i||t[w]!==Kb[w]){var T=t[w]||Kb[w];T&&r(hSt[x],T)}}}else i&&r("stroke",vy)}var ej="http://www.w3.org/2000/svg",rj="http://www.w3.org/1999/xlink",dSt="http://www.w3.org/2000/xmlns/",pSt="http://www.w3.org/XML/1998/namespace",v5="ecmeta_";function ij(r){return document.createElementNS(ej,r)}function Rn(r,t,e,i,n){return{tag:r,attrs:e||{},children:i,text:n,key:t}}function gSt(r,t){var e=[];if(t)for(var i in t){var n=t[i],a=i;n!==!1&&(n!==!0&&n!=null&&(a+='="'+n+'"'),e.push(a))}return"<"+r+" "+e.join(" ")+">"}function vSt(r){return"</"+r+">"}function kD(r,t){t=t||{};var e=t.newline?`
`:"";function i(n){var a=n.children,s=n.tag,o=n.attrs,l=n.text;return gSt(s,o)+(s!=="style"?Ga(l):l||"")+(a?""+e+te(a,function(u){return i(u)}).join(e)+e:"")+vSt(s)}return i(r)}function mSt(r,t,e){e=e||{};var i=e.newline?`
`:"",n=" {"+i,a=i+"}",s=te(br(r),function(l){return l+n+te(br(r[l]),function(u){return u+":"+r[l][u]+";"}).join(i)+a}).join(i),o=te(br(t),function(l){return"@keyframes "+l+n+te(br(t[l]),function(u){return u+n+te(br(t[l][u]),function(c){var h=t[l][u][c];return c==="d"&&(h='path("'+h+'")'),c+":"+h+";"}).join(i)+a}).join(i)+a}).join(i);return!s&&!o?"":["<![CDATA[",s,o,"]]>"].join(i)}function PM(r){return{zrId:r,shadowCache:{},patternCache:{},gradientCache:{},clipPathCache:{},defs:{},cssNodes:{},cssAnims:{},cssStyleCache:{},cssAnimIdx:0,shadowIdx:0,gradientIdx:0,patternIdx:0,clipPathIdx:0}}function m5(r,t,e,i){return Rn("svg","root",{width:r,height:t,xmlns:ej,"xmlns:xlink":rj,version:"1.1",baseProfile:"full",viewBox:i?"0 0 "+r+" "+t:!1},e)}var ySt=0;function nj(){return ySt++}var y5={cubicIn:"0.32,0,0.67,0",cubicOut:"0.33,1,0.68,1",cubicInOut:"0.65,0,0.35,1",quadraticIn:"0.11,0,0.5,0",quadraticOut:"0.5,1,0.89,1",quadraticInOut:"0.45,0,0.55,1",quarticIn:"0.5,0,0.75,0",quarticOut:"0.25,1,0.5,1",quarticInOut:"0.76,0,0.24,1",quinticIn:"0.64,0,0.78,0",quinticOut:"0.22,1,0.36,1",quinticInOut:"0.83,0,0.17,1",sinusoidalIn:"0.12,0,0.39,0",sinusoidalOut:"0.61,1,0.88,1",sinusoidalInOut:"0.37,0,0.63,1",exponentialIn:"0.7,0,0.84,0",exponentialOut:"0.16,1,0.3,1",exponentialInOut:"0.87,0,0.13,1",circularIn:"0.55,0,1,0.45",circularOut:"0,0.55,0.45,1",circularInOut:"0.85,0,0.15,1"},Yh="transform-origin";function _St(r,t,e){var i=Zt({},r.shape);Zt(i,t),r.buildPath(e,i);var n=new tj;return n.reset(yH(r)),e.rebuildPath(n,1),n.generateStr(),n.getStr()}function xSt(r,t){var e=t.originX,i=t.originY;(e||i)&&(r[Yh]=e+"px "+i+"px")}var bSt={fill:"fill",opacity:"opacity",lineWidth:"stroke-width",lineDashOffset:"stroke-dashoffset"};function aj(r,t){var e=t.zrId+"-ani-"+t.cssAnimIdx++;return t.cssAnims[e]=r,e}function wSt(r,t,e){var i=r.shape.paths,n={},a,s;if(J(i,function(l){var u=PM(e.zrId);u.animation=!0,XS(l,{},u,!0);var c=u.cssAnims,h=u.cssNodes,p=br(c),v=p.length;if(v){s=p[v-1];var y=c[s];for(var x in y){var w=y[x];n[x]=n[x]||{d:""},n[x].d+=w.d||""}for(var T in h){var E=h[T].animation;E.indexOf(s)>=0&&(a=E)}}}),!!a){t.d=!1;var o=aj(n,e);return a.replace(s,o)}}function _5(r){return ve(r)?y5[r]?"cubic-bezier("+y5[r]+")":OR(r)?r:"":""}function XS(r,t,e,i){var n=r.animators,a=n.length,s=[];if(r instanceof QR){var o=wSt(r,t,e);if(o)s.push(o);else if(!a)return}else if(!a)return;for(var l={},u=0;u<a;u++){var c=n[u],h=[c.getMaxTime()/1e3+"s"],p=_5(c.getClip().easing),v=c.getDelay();p?h.push(p):h.push("linear"),v&&h.push(v/1e3+"s"),c.getLoop()&&h.push("infinite");var y=h.join(" ");l[y]=l[y]||[y,[]],l[y][1].push(c)}function x(E){var M=E[1],L=M.length,F={},O={},U={},W="animation-timing-function";function H(Ce,Ee,Ie){for(var Se=Ce.getTracks(),Fe=Ce.getMaxTime(),Rr=0;Rr<Se.length;Rr++){var tr=Se[Rr];if(tr.needsAnimate()){var Vr=tr.keyframes,_r=tr.propName;if(Ie&&(_r=Ie(_r)),_r)for(var Xr=0;Xr<Vr.length;Xr++){var Hi=Vr[Xr],wi=Math.round(Hi.time/Fe*100)+"%",qt=_5(Hi.easing),Ur=Hi.rawValue;(ve(Ur)||Fr(Ur))&&(Ee[wi]=Ee[wi]||{},Ee[wi][_r]=Hi.rawValue,qt&&(Ee[wi][W]=qt))}}}}for(var j=0;j<L;j++){var Y=M[j],tt=Y.targetName;tt?tt==="shape"&&H(Y,O):!i&&H(Y,F)}for(var it in F){var lt={};SH(lt,r),Zt(lt,F[it]);var ht=_H(lt),Tt=F[it][W];U[it]=ht?{transform:ht}:{},xSt(U[it],lt),Tt&&(U[it][W]=Tt)}var Ot,Rt=!0;for(var it in O){U[it]=U[it]||{};var Ut=!Ot,Tt=O[it][W];Ut&&(Ot=new Al);var Jt=Ot.len();Ot.reset(),U[it].d=_St(r,O[it],Ot);var ne=Ot.len();if(!Ut&&Jt!==ne){Rt=!1;break}Tt&&(U[it][W]=Tt)}if(!Rt)for(var it in U)delete U[it].d;if(!i)for(var j=0;j<L;j++){var Y=M[j],tt=Y.targetName;tt==="style"&&H(Y,U,function(Se){return bSt[Se]})}for(var se=br(U),ce=!0,ye,j=1;j<se.length;j++){var Qe=se[j-1],sr=se[j];if(U[Qe][Yh]!==U[sr][Yh]){ce=!1;break}ye=U[Qe][Yh]}if(ce&&ye){for(var it in U)U[it][Yh]&&delete U[it][Yh];t[Yh]=ye}if(ti(se,function(Ce){return br(U[Ce]).length>0}).length){var ke=aj(U,e);return ke+" "+E[0]+" both"}}for(var w in l){var o=x(l[w]);o&&s.push(o)}if(s.length){var T=e.zrId+"-cls-"+nj();e.cssNodes["."+T]={animation:s.join(",")},t.class=T}}function SSt(r,t,e){if(!r.ignore)if(r.isSilent()){var i={"pointer-events":"none"};x5(i,t,e,!0)}else{var n=r.states.emphasis&&r.states.emphasis.style?r.states.emphasis.style:{},a=n.fill;if(!a){var s=r.style&&r.style.fill,o=r.states.select&&r.states.select.style&&r.states.select.style.fill,l=r.currentStates.indexOf("select")>=0&&o||s;l&&(a=$I(l))}var u=n.lineWidth;if(u){var c=!n.strokeNoScale&&r.transform?r.transform[0]:1;u=u/c}var i={cursor:"pointer"};a&&(i.fill=a),n.stroke&&(i.stroke=n.stroke),u&&(i["stroke-width"]=u),x5(i,t,e,!0)}}function x5(r,t,e,i){var n=JSON.stringify(r),a=e.cssStyleCache[n];a||(a=e.zrId+"-cls-"+nj(),e.cssStyleCache[n]=a,e.cssNodes["."+a+(i?":hover":"")]=r),t.class=t.class?t.class+" "+a:a}var r_=Math.round;function sj(r){return r&&ve(r.src)}function oj(r){return r&&Ve(r.toDataURL)}function OD(r,t,e,i){fSt(function(n,a){var s=n==="fill"||n==="stroke";s&&mH(a)?uj(t,r,n,i):s&&NR(a)?cj(e,r,n,i):s&&a==="none"?r[n]="transparent":r[n]=a},t,e,!1),PSt(e,r,i)}function ND(r,t){var e=Ymt(t);e&&(e.each(function(i,n){i!=null&&(r[(v5+n).toLowerCase()]=i+"")}),t.isSilent()&&(r[v5+"silent"]="true"))}function b5(r){return Ac(r[0]-1)&&Ac(r[1])&&Ac(r[2])&&Ac(r[3]-1)}function TSt(r){return Ac(r[4])&&Ac(r[5])}function FD(r,t,e){if(t&&!(TSt(t)&&b5(t))){var i=e?10:1e4;r.transform=b5(t)?"translate("+r_(t[4]*i)/i+" "+r_(t[5]*i)/i+")":vmt(t)}}function w5(r,t,e){for(var i=r.points,n=[],a=0;a<i.length;a++)n.push(r_(i[a][0]*e)/e),n.push(r_(i[a][1]*e)/e);t.points=n.join(" ")}function S5(r){return!r.smooth}function ASt(r){var t=te(r,function(e){return typeof e=="string"?[e,e]:e});return function(e,i,n){for(var a=0;a<t.length;a++){var s=t[a],o=e[s[0]];o!=null&&(i[s[1]]=r_(o*n)/n)}}}var CSt={circle:[ASt(["cx","cy","r"])],polyline:[w5,S5],polygon:[w5,S5]};function ESt(r){for(var t=r.animators,e=0;e<t.length;e++)if(t[e].targetName==="shape")return!0;return!1}function lj(r,t){var e=r.style,i=r.shape,n=CSt[r.type],a={},s=t.animation,o="path",l=r.style.strokePercent,u=t.compress&&yH(r)||4;if(n&&!t.willUpdate&&!(n[1]&&!n[1](i))&&!(s&&ESt(r))&&!(l<1)){o=r.type;var c=Math.pow(10,u);n[0](i,a,c)}else{var h=!r.path||r.shapeChanged();r.path||r.createPathProxy();var p=r.path;h&&(p.beginPath(),r.buildPath(p,r.shape),r.pathUpdated());var v=p.getVersion(),y=r,x=y.__svgPathBuilder;(y.__svgPathVersion!==v||!x||l!==y.__svgPathStrokePercent)&&(x||(x=y.__svgPathBuilder=new tj),x.reset(u),p.rebuildPath(x,l),x.generateStr(),y.__svgPathVersion=v,y.__svgPathStrokePercent=l),a.d=x.getStr()}return FD(a,r.transform),OD(a,e,r,t),ND(a,r),t.animation&&XS(r,a,t),t.emphasis&&SSt(r,a,t),Rn(o,r.id+"",a)}function ISt(r,t){var e=r.style,i=e.image;if(i&&!ve(i)&&(sj(i)?i=i.src:oj(i)&&(i=i.toDataURL())),!!i){var n=e.x||0,a=e.y||0,s=e.width,o=e.height,l={href:i,width:s,height:o};return n&&(l.x=n),a&&(l.y=a),FD(l,r.transform),OD(l,e,r,t),ND(l,r),t.animation&&XS(r,l,t),Rn("image",r.id+"",l)}}function MSt(r,t){var e=r.style,i=e.text;if(i!=null&&(i+=""),!(!i||isNaN(e.x)||isNaN(e.y))){var n=e.font||zc,a=e.x||0,s=ymt(e.y||0,xS(n),e.textBaseline),o=mmt[e.textAlign]||e.textAlign,l={"dominant-baseline":"central","text-anchor":o};if(e7(e)){var u="",c=e.fontStyle,h=t7(e.fontSize);if(!parseFloat(h))return;var p=e.fontFamily||jW,v=e.fontWeight;u+="font-size:"+h+";font-family:"+p+";",c&&c!=="normal"&&(u+="font-style:"+c+";"),v&&v!=="normal"&&(u+="font-weight:"+v+";"),l.style=u}else l.style="font: "+n;return i.match(/\s/)&&(l["xml:space"]="preserve"),a&&(l.x=a),s&&(l.y=s),FD(l,r.transform),OD(l,e,r,t),ND(l,r),t.animation&&XS(r,l,t),Rn("text",r.id+"",l,void 0,i)}}function T5(r,t){if(r instanceof vr)return lj(r,t);if(r instanceof ia)return ISt(r,t);if(r instanceof Gy)return MSt(r,t)}function PSt(r,t,e){var i=r.style;if(_mt(i)){var n=xmt(r),a=e.shadowCache,s=a[n];if(!s){var o=r.getGlobalScale(),l=o[0],u=o[1];if(!l||!u)return;var c=i.shadowOffsetX||0,h=i.shadowOffsetY||0,p=i.shadowBlur,v=$y(i.shadowColor),y=v.opacity,x=v.color,w=p/2/l,T=p/2/u,E=w+" "+T;s=e.zrId+"-s"+e.shadowIdx++,e.defs[s]=Rn("filter",s,{id:s,x:"-100%",y:"-100%",width:"300%",height:"300%"},[Rn("feDropShadow","",{dx:c/l,dy:h/u,stdDeviation:E,"flood-color":x,"flood-opacity":y})]),a[n]=s}t.filter=_S(s)}}function uj(r,t,e,i){var n=r[e],a,s={gradientUnits:n.global?"userSpaceOnUse":"objectBoundingBox"};if(gH(n))a="linearGradient",s.x1=n.x,s.y1=n.y,s.x2=n.x2,s.y2=n.y2;else if(vH(n))a="radialGradient",s.cx=ir(n.x,.5),s.cy=ir(n.y,.5),s.r=ir(n.r,.5);else return;for(var o=n.colorStops,l=[],u=0,c=o.length;u<c;++u){var h=WI(o[u].offset)*100+"%",p=o[u].color,v=$y(p),y=v.color,x=v.opacity,w={offset:h};w["stop-color"]=y,x<1&&(w["stop-opacity"]=x),l.push(Rn("stop",u+"",w))}var T=Rn(a,"",s,l),E=kD(T),M=i.gradientCache,L=M[E];L||(L=i.zrId+"-g"+i.gradientIdx++,M[E]=L,s.id=L,i.defs[L]=Rn(a,L,s,l)),t[e]=_S(L)}function cj(r,t,e,i){var n=r.style[e],a=r.getBoundingRect(),s={},o=n.repeat,l=o==="no-repeat",u=o==="repeat-x",c=o==="repeat-y",h;if(pH(n)){var p=n.imageWidth,v=n.imageHeight,y=void 0,x=n.image;if(ve(x)?y=x:sj(x)?y=x.src:oj(x)&&(y=x.toDataURL()),typeof Image>"u"){var w="Image width/height must been given explictly in svg-ssr renderer.";Za(p,w),Za(v,w)}else if(p==null||v==null){var T=function(j,Y){if(j){var tt=j.elm,it=p||Y.width,lt=v||Y.height;j.tag==="pattern"&&(u?(lt=1,it/=a.width):c&&(it=1,lt/=a.height)),j.attrs.width=it,j.attrs.height=lt,tt&&(tt.setAttribute("width",it),tt.setAttribute("height",lt))}},E=WR(y,null,r,function(j){l||T(O,j),T(h,j)});E&&E.width&&E.height&&(p=p||E.width,v=v||E.height)}h=Rn("image","img",{href:y,width:p,height:v}),s.width=p,s.height=v}else n.svgElement&&(h=Ze(n.svgElement),s.width=n.svgWidth,s.height=n.svgHeight);if(h){var M,L;l?M=L=1:u?(L=1,M=s.width/a.width):c?(M=1,L=s.height/a.height):s.patternUnits="userSpaceOnUse",M!=null&&!isNaN(M)&&(s.width=M),L!=null&&!isNaN(L)&&(s.height=L);var F=_H(n);F&&(s.patternTransform=F);var O=Rn("pattern","",s,[h]),U=kD(O),W=i.patternCache,H=W[U];H||(H=i.zrId+"-p"+i.patternIdx++,W[U]=H,s.id=H,O=i.defs[H]=Rn("pattern",H,s,[h])),t[e]=_S(H)}}function RSt(r,t,e){var i=e.clipPathCache,n=e.defs,a=i[r.id];if(!a){a=e.zrId+"-c"+e.clipPathIdx++;var s={id:a};i[r.id]=a,n[a]=Rn("clipPath",a,s,[lj(r,e)])}t["clip-path"]=_S(a)}function A5(r){return document.createTextNode(r)}function af(r,t,e){r.insertBefore(t,e)}function C5(r,t){r.removeChild(t)}function E5(r,t){r.appendChild(t)}function hj(r){return r.parentNode}function fj(r){return r.nextSibling}function cC(r,t){r.textContent=t}var I5=58,DSt=120,LSt=Rn("","");function RM(r){return r===void 0}function cl(r){return r!==void 0}function kSt(r,t,e){for(var i={},n=t;n<=e;++n){var a=r[n].key;a!==void 0&&(i[a]=n)}return i}function Hm(r,t){var e=r.key===t.key,i=r.tag===t.tag;return i&&e}function i_(r){var t,e=r.children,i=r.tag;if(cl(i)){var n=r.elm=ij(i);if(BD(LSt,r),Kt(e))for(t=0;t<e.length;++t){var a=e[t];a!=null&&E5(n,i_(a))}else cl(r.text)&&!je(r.text)&&E5(n,A5(r.text))}else r.elm=A5(r.text);return r.elm}function dj(r,t,e,i,n){for(;i<=n;++i){var a=e[i];a!=null&&af(r,i_(a),t)}}function vw(r,t,e,i){for(;e<=i;++e){var n=t[e];if(n!=null)if(cl(n.tag)){var a=hj(n.elm);C5(a,n.elm)}else C5(r,n.elm)}}function BD(r,t){var e,i=t.elm,n=r&&r.attrs||{},a=t.attrs||{};if(n!==a){for(e in a){var s=a[e],o=n[e];o!==s&&(s===!0?i.setAttribute(e,""):s===!1?i.removeAttribute(e):e==="style"?i.style.cssText=s:e.charCodeAt(0)!==DSt?i.setAttribute(e,s):e==="xmlns:xlink"||e==="xmlns"?i.setAttributeNS(dSt,e,s):e.charCodeAt(3)===I5?i.setAttributeNS(pSt,e,s):e.charCodeAt(5)===I5?i.setAttributeNS(rj,e,s):i.setAttribute(e,s))}for(e in n)e in a||i.removeAttribute(e)}}function OSt(r,t,e){for(var i=0,n=0,a=t.length-1,s=t[0],o=t[a],l=e.length-1,u=e[0],c=e[l],h,p,v,y;i<=a&&n<=l;)s==null?s=t[++i]:o==null?o=t[--a]:u==null?u=e[++n]:c==null?c=e[--l]:Hm(s,u)?(Tp(s,u),s=t[++i],u=e[++n]):Hm(o,c)?(Tp(o,c),o=t[--a],c=e[--l]):Hm(s,c)?(Tp(s,c),af(r,s.elm,fj(o.elm)),s=t[++i],c=e[--l]):Hm(o,u)?(Tp(o,u),af(r,o.elm,s.elm),o=t[--a],u=e[++n]):(RM(h)&&(h=kSt(t,i,a)),p=h[u.key],RM(p)?af(r,i_(u),s.elm):(v=t[p],v.tag!==u.tag?af(r,i_(u),s.elm):(Tp(v,u),t[p]=void 0,af(r,v.elm,s.elm))),u=e[++n]);(i<=a||n<=l)&&(i>a?(y=e[l+1]==null?null:e[l+1].elm,dj(r,y,e,n,l)):vw(r,t,i,a))}function Tp(r,t){var e=t.elm=r.elm,i=r.children,n=t.children;r!==t&&(BD(r,t),RM(t.text)?cl(i)&&cl(n)?i!==n&&OSt(e,i,n):cl(n)?(cl(r.text)&&cC(e,""),dj(e,null,n,0,n.length-1)):cl(i)?vw(e,i,0,i.length-1):cl(r.text)&&cC(e,""):r.text!==t.text&&(cl(i)&&vw(e,i,0,i.length-1),cC(e,t.text)))}function NSt(r,t){if(Hm(r,t))Tp(r,t);else{var e=r.elm,i=hj(e);i_(t),i!==null&&(af(i,t.elm,fj(e)),vw(i,[r],0,0))}return t}var FSt=0,BSt=function(){function r(t,e,i){if(this.type="svg",this.refreshHover=M5(),this.configLayer=M5(),this.storage=e,this._opts=i=Zt({},i),this.root=t,this._id="zr"+FSt++,this._oldVNode=m5(i.width,i.height),t&&!i.ssr){var n=this._viewport=document.createElement("div");n.style.cssText="position:relative;overflow:hidden";var a=this._svgDom=this._oldVNode.elm=ij("svg");BD(null,this._oldVNode),n.appendChild(a),t.appendChild(n)}this.resize(i.width,i.height)}return r.prototype.getType=function(){return this.type},r.prototype.getViewportRoot=function(){return this._viewport},r.prototype.getViewportRootOffset=function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},r.prototype.getSvgDom=function(){return this._svgDom},r.prototype.refresh=function(){if(this.root){var t=this.renderToVNode({willUpdate:!0});t.attrs.style="position:absolute;left:0;top:0;user-select:none",NSt(this._oldVNode,t),this._oldVNode=t}},r.prototype.renderOneToVNode=function(t){return T5(t,PM(this._id))},r.prototype.renderToVNode=function(t){t=t||{};var e=this.storage.getDisplayList(!0),i=this._width,n=this._height,a=PM(this._id);a.animation=t.animation,a.willUpdate=t.willUpdate,a.compress=t.compress,a.emphasis=t.emphasis;var s=[],o=this._bgVNode=zSt(i,n,this._backgroundColor,a);o&&s.push(o);var l=t.compress?null:this._mainVNode=Rn("g","main",{},[]);this._paintList(e,a,l?l.children:s),l&&s.push(l);var u=te(br(a.defs),function(p){return a.defs[p]});if(u.length&&s.push(Rn("defs","defs",{},u)),t.animation){var c=mSt(a.cssNodes,a.cssAnims,{newline:!0});if(c){var h=Rn("style","stl",{},[],c);s.push(h)}}return m5(i,n,s,t.useViewBox)},r.prototype.renderToString=function(t){return t=t||{},kD(this.renderToVNode({animation:ir(t.cssAnimation,!0),emphasis:ir(t.cssEmphasis,!0),willUpdate:!1,compress:!0,useViewBox:ir(t.useViewBox,!0)}),{newline:!0})},r.prototype.setBackgroundColor=function(t){this._backgroundColor=t},r.prototype.getSvgRoot=function(){return this._mainVNode&&this._mainVNode.elm},r.prototype._paintList=function(t,e,i){for(var n=t.length,a=[],s=0,o,l,u=0,c=0;c<n;c++){var h=t[c];if(!h.invisible){var p=h.__clipPaths,v=p&&p.length||0,y=l&&l.length||0,x=void 0;for(x=Math.max(v-1,y-1);x>=0&&!(p&&l&&p[x]===l[x]);x--);for(var w=y-1;w>x;w--)s--,o=a[s-1];for(var T=x+1;T<v;T++){var E={};RSt(p[T],E,e);var M=Rn("g","clip-g-"+u++,E,[]);(o?o.children:i).push(M),a[s++]=M,o=M}l=p;var L=T5(h,e);L&&(o?o.children:i).push(L)}}},r.prototype.resize=function(t,e){var i=this._opts,n=this.root,a=this._viewport;if(t!=null&&(i.width=t),e!=null&&(i.height=e),n&&a&&(a.style.display="none",t=Up(n,0,i),e=Up(n,1,i),a.style.display=""),this._width!==t||this._height!==e){if(this._width=t,this._height=e,a){var s=a.style;s.width=t+"px",s.height=e+"px"}if(NR(this._backgroundColor))this.refresh();else{var o=this._svgDom;o&&(o.setAttribute("width",t),o.setAttribute("height",e));var l=this._bgVNode&&this._bgVNode.elm;l&&(l.setAttribute("width",t),l.setAttribute("height",e))}}},r.prototype.getWidth=function(){return this._width},r.prototype.getHeight=function(){return this._height},r.prototype.dispose=function(){this.root&&(this.root.innerHTML=""),this._svgDom=this._viewport=this.storage=this._oldVNode=this._bgVNode=this._mainVNode=null},r.prototype.clear=function(){this._svgDom&&(this._svgDom.innerHTML=null),this._oldVNode=null},r.prototype.toDataURL=function(t){var e=this.renderToString(),i="data:image/svg+xml;";return t?(e=wmt(e),e&&i+"base64,"+e):i+"charset=UTF-8,"+encodeURIComponent(e)},r}();function M5(r){return function(){}}function zSt(r,t,e,i){var n;if(e&&e!=="none")if(n=Rn("rect","bg",{width:r,height:t,x:"0",y:"0"}),mH(e))uj({fill:e},n.attrs,"fill",i);else if(NR(e))cj({style:{fill:e},dirty:nn,getBoundingRect:function(){return{width:r,height:t}}},n.attrs,"fill",i);else{var a=$y(e),s=a.color,o=a.opacity;n.attrs.fill=s,o<1&&(n.attrs["fill-opacity"]=o)}return n}const VSt=BSt;function USt(r){r.registerPainter("svg",VSt)}function P5(r,t,e){var i=Vc.createCanvas(),n=t.getWidth(),a=t.getHeight(),s=i.style;return s&&(s.position="absolute",s.left="0",s.top="0",s.width=n+"px",s.height=a+"px",i.setAttribute("data-zr-dom-id",r)),i.width=n*e,i.height=a*e,i}var $St=function(r){bi(t,r);function t(e,i,n){var a=r.call(this)||this;a.motionBlur=!1,a.lastFrameAlpha=.7,a.dpr=1,a.virtual=!1,a.config={},a.incremental=!1,a.zlevel=0,a.maxRepaintRectCount=5,a.__dirty=!0,a.__firstTimePaint=!0,a.__used=!1,a.__drawIndex=0,a.__startIndex=0,a.__endIndex=0,a.__prevStartIndex=null,a.__prevEndIndex=null;var s;n=n||qb,typeof e=="string"?s=P5(e,i,n):je(e)&&(s=e,e=s.id),a.id=e,a.dom=s;var o=s.style;return o&&(JW(s),s.onselectstart=function(){return!1},o.padding="0",o.margin="0",o.borderWidth="0"),a.painter=i,a.dpr=n,a}return t.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex},t.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex},t.prototype.initContext=function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},t.prototype.setUnpainted=function(){this.__firstTimePaint=!0},t.prototype.createBackBuffer=function(){var e=this.dpr;this.domBack=P5("back-"+this.id,this.painter,e),this.ctxBack=this.domBack.getContext("2d"),e!==1&&this.ctxBack.scale(e,e)},t.prototype.createRepaintRects=function(e,i,n,a){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;var s=[],o=this.maxRepaintRectCount,l=!1,u=new hr(0,0,0,0);function c(E){if(!(!E.isFinite()||E.isZero()))if(s.length===0){var M=new hr(0,0,0,0);M.copy(E),s.push(M)}else{for(var L=!1,F=1/0,O=0,U=0;U<s.length;++U){var W=s[U];if(W.intersect(E)){var H=new hr(0,0,0,0);H.copy(W),H.union(E),s[U]=H,L=!0;break}else if(l){u.copy(E),u.union(W);var j=E.width*E.height,Y=W.width*W.height,tt=u.width*u.height,it=tt-j-Y;it<F&&(F=it,O=U)}}if(l&&(s[O].union(E),L=!0),!L){var M=new hr(0,0,0,0);M.copy(E),s.push(M)}l||(l=s.length>=o)}}for(var h=this.__startIndex;h<this.__endIndex;++h){var p=e[h];if(p){var v=p.shouldBePainted(n,a,!0,!0),y=p.__isRendered&&(p.__dirty&Ts||!v)?p.getPrevPaintRect():null;y&&c(y);var x=v&&(p.__dirty&Ts||!p.__isRendered)?p.getPaintRect():null;x&&c(x)}}for(var h=this.__prevStartIndex;h<this.__prevEndIndex;++h){var p=i[h],v=p&&p.shouldBePainted(n,a,!0,!0);if(p&&(!v||!p.__zr)&&p.__isRendered){var y=p.getPrevPaintRect();y&&c(y)}}var w;do{w=!1;for(var h=0;h<s.length;){if(s[h].isZero()){s.splice(h,1);continue}for(var T=h+1;T<s.length;)s[h].intersect(s[T])?(w=!0,s[h].union(s[T]),s.splice(T,1)):T++;h++}}while(w);return this._paintRects=s,s},t.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()},t.prototype.resize=function(e,i){var n=this.dpr,a=this.dom,s=a.style,o=this.domBack;s&&(s.width=e+"px",s.height=i+"px"),a.width=e*n,a.height=i*n,o&&(o.width=e*n,o.height=i*n,n!==1&&this.ctxBack.scale(n,n))},t.prototype.clear=function(e,i,n){var a=this.dom,s=this.ctx,o=a.width,l=a.height;i=i||this.clearColor;var u=this.motionBlur&&!e,c=this.lastFrameAlpha,h=this.dpr,p=this;u&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(a,0,0,o/h,l/h));var v=this.domBack;function y(x,w,T,E){if(s.clearRect(x,w,T,E),i&&i!=="transparent"){var M=void 0;if(vS(i)){var L=i.global||i.__width===T&&i.__height===E;M=L&&i.__canvasGradient||bM(s,i,{x:0,y:0,width:T,height:E}),i.__canvasGradient=M,i.__width=T,i.__height=E}else wvt(i)&&(i.scaleX=i.scaleX||h,i.scaleY=i.scaleY||h,M=wM(s,i,{dirty:function(){p.setUnpainted(),p.painter.refresh()}}));s.save(),s.fillStyle=M||i,s.fillRect(x,w,T,E),s.restore()}u&&(s.save(),s.globalAlpha=c,s.drawImage(v,x,w,T,E),s.restore())}!n||u?y(0,0,o,l):n.length&&J(n,function(x){y(x.x*h,x.y*h,x.width*h,x.height*h)})},t}(so);const hC=$St;var R5=1e5,jh=314159,l1=.01,WSt=.001;function HSt(r){return r?r.__builtin__?!0:!(typeof r.resize!="function"||typeof r.refresh!="function"):!1}function GSt(r,t){var e=document.createElement("div");return e.style.cssText=["position:relative","width:"+r+"px","height:"+t+"px","padding:0","margin:0","border-width:0"].join(";")+";",e}var jSt=function(){function r(t,e,i,n){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";var a=!t.nodeName||t.nodeName.toUpperCase()==="CANVAS";this._opts=i=Zt({},i||{}),this.dpr=i.devicePixelRatio||qb,this._singleCanvas=a,this.root=t;var s=t.style;s&&(JW(t),t.innerHTML=""),this.storage=e;var o=this._zlevelList;this._prevDisplayList=[];var l=this._layers;if(a){var c=t,h=c.width,p=c.height;i.width!=null&&(h=i.width),i.height!=null&&(p=i.height),this.dpr=i.devicePixelRatio||1,c.width=h*this.dpr,c.height=p*this.dpr,this._width=h,this._height=p;var v=new hC(c,this,this.dpr);v.__builtin__=!0,v.initContext(),l[jh]=v,v.zlevel=jh,o.push(jh),this._domRoot=t}else{this._width=Up(t,0,i),this._height=Up(t,1,i);var u=this._domRoot=GSt(this._width,this._height);t.appendChild(u)}}return r.prototype.getType=function(){return"canvas"},r.prototype.isSingleCanvas=function(){return this._singleCanvas},r.prototype.getViewportRoot=function(){return this._domRoot},r.prototype.getViewportRootOffset=function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},r.prototype.refresh=function(t){var e=this.storage.getDisplayList(!0),i=this._prevDisplayList,n=this._zlevelList;this._redrawId=Math.random(),this._paintList(e,i,t,this._redrawId);for(var a=0;a<n.length;a++){var s=n[a],o=this._layers[s];if(!o.__builtin__&&o.refresh){var l=a===0?this._backgroundColor:null;o.refresh(l)}}return this._opts.useDirtyRect&&(this._prevDisplayList=e.slice()),this},r.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(!1))},r.prototype._paintHoverList=function(t){var e=t.length,i=this._hoverlayer;if(i&&i.clear(),!!e){for(var n={inHover:!0,viewWidth:this._width,viewHeight:this._height},a,s=0;s<e;s++){var o=t[s];o.__inHover&&(i||(i=this._hoverlayer=this.getLayer(R5)),a||(a=i.ctx,a.save()),_f(a,o,n,s===e-1))}a&&a.restore()}},r.prototype.getHoverLayer=function(){return this.getLayer(R5)},r.prototype.paintOne=function(t,e){X9(t,e)},r.prototype._paintList=function(t,e,i,n){if(this._redrawId===n){i=i||!1,this._updateLayerStatus(t);var a=this._doPaintList(t,e,i),s=a.finished,o=a.needsRefreshHover;if(this._needsManuallyCompositing&&this._compositeManually(),o&&this._paintHoverList(t),s)this.eachLayer(function(u){u.afterBrush&&u.afterBrush()});else{var l=this;FI(function(){l._paintList(t,e,i,n)})}}},r.prototype._compositeManually=function(){var t=this.getLayer(jh).ctx,e=this._domRoot.width,i=this._domRoot.height;t.clearRect(0,0,e,i),this.eachBuiltinLayer(function(n){n.virtual&&t.drawImage(n.dom,0,0,e,i)})},r.prototype._doPaintList=function(t,e,i){for(var n=this,a=[],s=this._opts.useDirtyRect,o=0;o<this._zlevelList.length;o++){var l=this._zlevelList[o],u=this._layers[l];u.__builtin__&&u!==this._hoverlayer&&(u.__dirty||i)&&a.push(u)}for(var c=!0,h=!1,p=function(x){var w=a[x],T=w.ctx,E=s&&w.createRepaintRects(t,e,v._width,v._height),M=i?w.__startIndex:w.__drawIndex,L=!i&&w.incremental&&Date.now,F=L&&Date.now(),O=w.zlevel===v._zlevelList[0]?v._backgroundColor:null;if(w.__startIndex===w.__endIndex)w.clear(!1,O,E);else if(M===w.__startIndex){var U=t[M];(!U.incremental||!U.notClear||i)&&w.clear(!1,O,E)}M===-1&&(console.error("For some unknown reason. drawIndex is -1"),M=w.__startIndex);var W,H=function(it){var lt={inHover:!1,allClipped:!1,prevEl:null,viewWidth:n._width,viewHeight:n._height};for(W=M;W<w.__endIndex;W++){var ht=t[W];if(ht.__inHover&&(h=!0),n._doPaintEl(ht,w,s,it,lt,W===w.__endIndex-1),L){var Tt=Date.now()-F;if(Tt>15)break}}lt.prevElClipPaths&&T.restore()};if(E)if(E.length===0)W=w.__endIndex;else for(var j=v.dpr,Y=0;Y<E.length;++Y){var tt=E[Y];T.save(),T.beginPath(),T.rect(tt.x*j,tt.y*j,tt.width*j,tt.height*j),T.clip(),H(tt),T.restore()}else T.save(),H(),T.restore();w.__drawIndex=W,w.__drawIndex<w.__endIndex&&(c=!1)},v=this,y=0;y<a.length;y++)p(y);return Or.wxa&&J(this._layers,function(x){x&&x.ctx&&x.ctx.draw&&x.ctx.draw()}),{finished:c,needsRefreshHover:h}},r.prototype._doPaintEl=function(t,e,i,n,a,s){var o=e.ctx;if(i){var l=t.getPaintRect();(!n||l&&l.intersect(n))&&(_f(o,t,a,s),t.setPrevPaintRect(l))}else _f(o,t,a,s)},r.prototype.getLayer=function(t,e){this._singleCanvas&&!this._needsManuallyCompositing&&(t=jh);var i=this._layers[t];return i||(i=new hC("zr_"+t,this,this.dpr),i.zlevel=t,i.__builtin__=!0,this._layerConfig[t]?cr(i,this._layerConfig[t],!0):this._layerConfig[t-l1]&&cr(i,this._layerConfig[t-l1],!0),e&&(i.virtual=e),this.insertLayer(t,i),i.initContext()),i},r.prototype.insertLayer=function(t,e){var i=this._layers,n=this._zlevelList,a=n.length,s=this._domRoot,o=null,l=-1;if(!i[t]&&HSt(e)){if(a>0&&t>n[0]){for(l=0;l<a-1&&!(n[l]<t&&n[l+1]>t);l++);o=i[n[l]]}if(n.splice(l+1,0,t),i[t]=e,!e.virtual)if(o){var u=o.dom;u.nextSibling?s.insertBefore(e.dom,u.nextSibling):s.appendChild(e.dom)}else s.firstChild?s.insertBefore(e.dom,s.firstChild):s.appendChild(e.dom);e.painter||(e.painter=this)}},r.prototype.eachLayer=function(t,e){for(var i=this._zlevelList,n=0;n<i.length;n++){var a=i[n];t.call(e,this._layers[a],a)}},r.prototype.eachBuiltinLayer=function(t,e){for(var i=this._zlevelList,n=0;n<i.length;n++){var a=i[n],s=this._layers[a];s.__builtin__&&t.call(e,s,a)}},r.prototype.eachOtherLayer=function(t,e){for(var i=this._zlevelList,n=0;n<i.length;n++){var a=i[n],s=this._layers[a];s.__builtin__||t.call(e,s,a)}},r.prototype.getLayers=function(){return this._layers},r.prototype._updateLayerStatus=function(t){this.eachBuiltinLayer(function(h,p){h.__dirty=h.__used=!1});function e(h){a&&(a.__endIndex!==h&&(a.__dirty=!0),a.__endIndex=h)}if(this._singleCanvas)for(var i=1;i<t.length;i++){var n=t[i];if(n.zlevel!==t[i-1].zlevel||n.incremental){this._needsManuallyCompositing=!0;break}}var a=null,s=0,o,l;for(l=0;l<t.length;l++){var n=t[l],u=n.zlevel,c=void 0;o!==u&&(o=u,s=0),n.incremental?(c=this.getLayer(u+WSt,this._needsManuallyCompositing),c.incremental=!0,s=1):c=this.getLayer(u+(s>0?l1:0),this._needsManuallyCompositing),c.__builtin__||IR("ZLevel "+u+" has been used by unkown layer "+c.id),c!==a&&(c.__used=!0,c.__startIndex!==l&&(c.__dirty=!0),c.__startIndex=l,c.incremental?c.__drawIndex=-1:c.__drawIndex=l,e(l),a=c),n.__dirty&Ts&&!n.__inHover&&(c.__dirty=!0,c.incremental&&c.__drawIndex<0&&(c.__drawIndex=l))}e(l),this.eachBuiltinLayer(function(h,p){!h.__used&&h.getElementCount()>0&&(h.__dirty=!0,h.__startIndex=h.__endIndex=h.__drawIndex=0),h.__dirty&&h.__drawIndex<0&&(h.__drawIndex=h.__startIndex)})},r.prototype.clear=function(){return this.eachBuiltinLayer(this._clearLayer),this},r.prototype._clearLayer=function(t){t.clear()},r.prototype.setBackgroundColor=function(t){this._backgroundColor=t,J(this._layers,function(e){e.setUnpainted()})},r.prototype.configLayer=function(t,e){if(e){var i=this._layerConfig;i[t]?cr(i[t],e,!0):i[t]=e;for(var n=0;n<this._zlevelList.length;n++){var a=this._zlevelList[n];if(a===t||a===t+l1){var s=this._layers[a];cr(s,i[t],!0)}}}},r.prototype.delLayer=function(t){var e=this._layers,i=this._zlevelList,n=e[t];n&&(n.dom.parentNode.removeChild(n.dom),delete e[t],i.splice(pr(i,t),1))},r.prototype.resize=function(t,e){if(this._domRoot.style){var i=this._domRoot;i.style.display="none";var n=this._opts,a=this.root;if(t!=null&&(n.width=t),e!=null&&(n.height=e),t=Up(a,0,n),e=Up(a,1,n),i.style.display="",this._width!==t||e!==this._height){i.style.width=t+"px",i.style.height=e+"px";for(var s in this._layers)this._layers.hasOwnProperty(s)&&this._layers[s].resize(t,e);this.refresh(!0)}this._width=t,this._height=e}else{if(t==null||e==null)return;this._width=t,this._height=e,this.getLayer(jh).resize(t,e)}return this},r.prototype.clearLayer=function(t){var e=this._layers[t];e&&e.clear()},r.prototype.dispose=function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},r.prototype.getRenderedCanvas=function(t){if(t=t||{},this._singleCanvas&&!this._compositeManually)return this._layers[jh].dom;var e=new hC("image",this,t.pixelRatio||this.dpr);e.initContext(),e.clear(!1,t.backgroundColor||this._backgroundColor);var i=e.ctx;if(t.pixelRatio<=this.dpr){this.refresh();var n=e.dom.width,a=e.dom.height;this.eachLayer(function(h){h.__builtin__?i.drawImage(h.dom,0,0,n,a):h.renderToCanvas&&(i.save(),h.renderToCanvas(i),i.restore())})}else for(var s={inHover:!1,viewWidth:this._width,viewHeight:this._height},o=this.storage.getDisplayList(!0),l=0,u=o.length;l<u;l++){var c=o[l];_f(i,c,s,l===u-1)}return e.dom},r.prototype.getWidth=function(){return this._width},r.prototype.getHeight=function(){return this._height},r}();const XSt=jSt;function ZSt(r){r.registerPainter("canvas",XSt)}var qSt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.getInitialData=function(e){return Su(null,this,{useEncodeDefaulter:!0})},t.prototype.getLegendIcon=function(e){var i=new Ke,n=mn("line",0,e.itemHeight/2,e.itemWidth,0,e.lineStyle.stroke,!1);i.add(n),n.setStyle(e.lineStyle);var a=this.getData().getVisual("symbol"),s=this.getData().getVisual("symbolRotate"),o=a==="none"?"circle":a,l=e.itemHeight*.8,u=mn(o,(e.itemWidth-l)/2,(e.itemHeight-l)/2,l,l,e.itemStyle.fill);i.add(u),u.setStyle(e.itemStyle);var c=e.iconRotate==="inherit"?s:e.iconRotate||0;return u.rotation=c*Math.PI/180,u.setOrigin([e.itemWidth/2,e.itemHeight/2]),o.indexOf("empty")>-1&&(u.style.stroke=u.style.fill,u.style.fill="#fff",u.style.lineWidth=2),i},t.type="series.line",t.dependencies=["grid","polar"],t.defaultOption={z:3,coordinateSystem:"cartesian2d",legendHoverLink:!0,clip:!0,label:{position:"top"},endLabel:{show:!1,valueAnimation:!0,distance:8},lineStyle:{width:2,type:"solid"},emphasis:{scale:!0},step:!1,smooth:!1,smoothMonotone:null,symbol:"emptyCircle",symbolSize:4,symbolRotate:null,showSymbol:!0,showAllSymbol:"auto",connectNulls:!1,sampling:"none",animationEasing:"linear",progressive:0,hoverLayerThreshold:1/0,universalTransition:{divideShape:"clone"},triggerLineEvent:!1},t}(Li);const YSt=qSt;function mg(r,t){var e=r.mapDimensionsAll("defaultedLabel"),i=e.length;if(i===1){var n=pg(r,t,e[0]);return n!=null?n+"":null}else if(i){for(var a=[],s=0;s<e.length;s++)a.push(pg(r,t,e[s]));return a.join(" ")}}function pj(r,t){var e=r.mapDimensionsAll("defaultedLabel");if(!Kt(t))return t+"";for(var i=[],n=0;n<e.length;n++){var a=r.getDimensionIndex(e[n]);a>=0&&i.push(t[a])}return i.join(" ")}var KSt=function(r){Vt(t,r);function t(e,i,n,a){var s=r.call(this)||this;return s.updateData(e,i,n,a),s}return t.prototype._createSymbol=function(e,i,n,a,s){this.removeAll();var o=mn(e,-1,-1,2,2,null,s);o.attr({z2:100,culling:!0,scaleX:a[0]/2,scaleY:a[1]/2}),o.drift=JSt,this._symbolType=e,this.add(o)},t.prototype.stopSymbolAnimation=function(e){this.childAt(0).stopAnimation(null,e)},t.prototype.getSymbolType=function(){return this._symbolType},t.prototype.getSymbolPath=function(){return this.childAt(0)},t.prototype.highlight=function(){vu(this.childAt(0))},t.prototype.downplay=function(){mu(this.childAt(0))},t.prototype.setZ=function(e,i){var n=this.childAt(0);n.zlevel=e,n.z=i},t.prototype.setDraggable=function(e,i){var n=this.childAt(0);n.draggable=e,n.cursor=!i&&e?"move":n.cursor},t.prototype.updateData=function(e,i,n,a){this.silent=!1;var s=e.getItemVisual(i,"symbol")||"circle",o=e.hostModel,l=t.getSymbolSize(e,i),u=s!==this._symbolType,c=a&&a.disableAnimation;if(u){var h=e.getItemVisual(i,"symbolKeepAspect");this._createSymbol(s,e,i,l,h)}else{var p=this.childAt(0);p.silent=!1;var v={scaleX:l[0]/2,scaleY:l[1]/2};c?p.attr(v):zr(p,v,o,i),Vo(p)}if(this._updateCommon(e,i,l,n,a),u){var p=this.childAt(0);if(!c){var v={scaleX:this._sizeX,scaleY:this._sizeY,style:{opacity:p.style.opacity}};p.scaleX=p.scaleY=0,p.style.opacity=0,Ei(p,v,o,i)}}c&&this.childAt(0).stopAnimation("leave")},t.prototype._updateCommon=function(e,i,n,a,s){var o=this.childAt(0),l=e.hostModel,u,c,h,p,v,y,x,w,T;if(a&&(u=a.emphasisItemStyle,c=a.blurItemStyle,h=a.selectItemStyle,p=a.focus,v=a.blurScope,x=a.labelStatesModels,w=a.hoverScale,T=a.cursorStyle,y=a.emphasisDisabled),!a||e.hasItemOption){var E=a&&a.itemModel?a.itemModel:e.getItemModel(i),M=E.getModel("emphasis");u=M.getModel("itemStyle").getItemStyle(),h=E.getModel(["select","itemStyle"]).getItemStyle(),c=E.getModel(["blur","itemStyle"]).getItemStyle(),p=M.get("focus"),v=M.get("blurScope"),y=M.get("disabled"),x=Dn(E),w=M.getShallow("scale"),T=E.getShallow("cursor")}var L=e.getItemVisual(i,"symbolRotate");o.attr("rotation",(L||0)*Math.PI/180||0);var F=id(e.getItemVisual(i,"symbolOffset"),n);F&&(o.x=F[0],o.y=F[1]),T&&o.attr("cursor",T);var O=e.getItemVisual(i,"style"),U=O.fill;if(o instanceof ia){var W=o.style;o.useStyle(Zt({image:W.image,x:W.x,y:W.y,width:W.width,height:W.height},O))}else o.__isEmptyBrush?o.useStyle(Zt({},O)):o.useStyle(O),o.style.decal=null,o.setColor(U,s&&s.symbolInnerColor),o.style.strokeNoScale=!0;var H=e.getItemVisual(i,"liftZ"),j=this._z2;H!=null?j==null&&(this._z2=o.z2,o.z2+=H):j!=null&&(o.z2=j,this._z2=null);var Y=s&&s.useNameLabel;ra(o,x,{labelFetcher:l,labelDataIndex:i,defaultText:tt,inheritColor:U,defaultOpacity:O.opacity});function tt(ht){return Y?e.getName(ht):mg(e,ht)}this._sizeX=n[0]/2,this._sizeY=n[1]/2;var it=o.ensureState("emphasis");it.style=u,o.ensureState("select").style=h,o.ensureState("blur").style=c;var lt=w==null||w===!0?Math.max(1.1,3/this._sizeY):isFinite(w)&&w>0?+w:1;it.scaleX=this._sizeX*lt,it.scaleY=this._sizeY*lt,this.setSymbolScale(1),Ui(this,p,v,y)},t.prototype.setSymbolScale=function(e){this.scaleX=this.scaleY=e},t.prototype.fadeOut=function(e,i,n){var a=this.childAt(0),s=Je(this).dataIndex,o=n&&n.animation;if(this.silent=a.silent=!0,n&&n.fadeLabel){var l=a.getTextContent();l&&$c(l,{style:{opacity:0}},i,{dataIndex:s,removeOpt:o,cb:function(){a.removeTextContent()}})}else a.removeTextContent();$c(a,{style:{opacity:0},scaleX:0,scaleY:0},i,{dataIndex:s,cb:e,removeOpt:o})},t.getSymbolSize=function(e,i){return $g(e.getItemVisual(i,"symbolSize"))},t}(Ke);function JSt(r,t){this.parent.drift(r,t)}const N_=KSt;function fC(r,t,e,i){return t&&!isNaN(t[0])&&!isNaN(t[1])&&!(i.isIgnore&&i.isIgnore(e))&&!(i.clipShape&&!i.clipShape.contain(t[0],t[1]))&&r.getItemVisual(e,"symbol")!=="none"}function D5(r){return r!=null&&!je(r)&&(r={isIgnore:r}),r||{}}function L5(r){var t=r.hostModel,e=t.getModel("emphasis");return{emphasisItemStyle:e.getModel("itemStyle").getItemStyle(),blurItemStyle:t.getModel(["blur","itemStyle"]).getItemStyle(),selectItemStyle:t.getModel(["select","itemStyle"]).getItemStyle(),focus:e.get("focus"),blurScope:e.get("blurScope"),emphasisDisabled:e.get("disabled"),hoverScale:e.get("scale"),labelStatesModels:Dn(t),cursorStyle:t.get("cursor")}}var QSt=function(){function r(t){this.group=new Ke,this._SymbolCtor=t||N_}return r.prototype.updateData=function(t,e){this._progressiveEls=null,e=D5(e);var i=this.group,n=t.hostModel,a=this._data,s=this._SymbolCtor,o=e.disableAnimation,l=L5(t),u={disableAnimation:o},c=e.getSymbolPoint||function(h){return t.getItemLayout(h)};a||i.removeAll(),t.diff(a).add(function(h){var p=c(h);if(fC(t,p,h,e)){var v=new s(t,h,l,u);v.setPosition(p),t.setItemGraphicEl(h,v),i.add(v)}}).update(function(h,p){var v=a.getItemGraphicEl(p),y=c(h);if(!fC(t,y,h,e)){i.remove(v);return}var x=t.getItemVisual(h,"symbol")||"circle",w=v&&v.getSymbolType&&v.getSymbolType();if(!v||w&&w!==x)i.remove(v),v=new s(t,h,l,u),v.setPosition(y);else{v.updateData(t,h,l,u);var T={x:y[0],y:y[1]};o?v.attr(T):zr(v,T,n)}i.add(v),t.setItemGraphicEl(h,v)}).remove(function(h){var p=a.getItemGraphicEl(h);p&&p.fadeOut(function(){i.remove(p)},n)}).execute(),this._getSymbolPoint=c,this._data=t},r.prototype.updateLayout=function(){var t=this,e=this._data;e&&e.eachItemGraphicEl(function(i,n){var a=t._getSymbolPoint(n);i.setPosition(a),i.markRedraw()})},r.prototype.incrementalPrepareUpdate=function(t){this._seriesScope=L5(t),this._data=null,this.group.removeAll()},r.prototype.incrementalUpdate=function(t,e,i){this._progressiveEls=[],i=D5(i);function n(l){l.isGroup||(l.incremental=!0,l.ensureState("emphasis").hoverLayer=!0)}for(var a=t.start;a<t.end;a++){var s=e.getItemLayout(a);if(fC(e,s,a,i)){var o=new this._SymbolCtor(e,a,this._seriesScope);o.traverse(n),o.setPosition(s),this.group.add(o),e.setItemGraphicEl(a,o),this._progressiveEls.push(o)}}},r.prototype.eachRendered=function(t){Kc(this._progressiveEls||this.group,t)},r.prototype.remove=function(t){var e=this.group,i=this._data;i&&t?i.eachItemGraphicEl(function(n){n.fadeOut(function(){e.remove(n)},i.hostModel)}):e.removeAll()},r}();const F_=QSt;function gj(r,t,e){var i=r.getBaseAxis(),n=r.getOtherAxis(i),a=tTt(n,e),s=i.dim,o=n.dim,l=t.mapDimension(o),u=t.mapDimension(s),c=o==="x"||o==="radius"?1:0,h=te(r.dimensions,function(y){return t.mapDimension(y)}),p=!1,v=t.getCalculationInfo("stackResultDimension");return Hc(t,h[0])&&(p=!0,h[0]=v),Hc(t,h[1])&&(p=!0,h[1]=v),{dataDimsForPoint:h,valueStart:a,valueAxisDim:o,baseAxisDim:s,stacked:!!p,valueDim:l,baseDim:u,baseDataOffset:c,stackedOverDimension:t.getCalculationInfo("stackedOverDimension")}}function tTt(r,t){var e=0,i=r.scale.getExtent();return t==="start"?e=i[0]:t==="end"?e=i[1]:Fr(t)&&!isNaN(t)?e=t:i[0]>0?e=i[0]:i[1]<0&&(e=i[1]),e}function vj(r,t,e,i){var n=NaN;r.stacked&&(n=e.get(e.getCalculationInfo("stackedOverDimension"),i)),isNaN(n)&&(n=r.valueStart);var a=r.baseDataOffset,s=[];return s[a]=e.get(r.baseDim,i),s[1-a]=n,t.dataToPoint(s)}function eTt(r,t){var e=[];return t.diff(r).add(function(i){e.push({cmd:"+",idx:i})}).update(function(i,n){e.push({cmd:"=",idx:n,idx1:i})}).remove(function(i){e.push({cmd:"-",idx:i})}).execute(),e}function rTt(r,t,e,i,n,a,s,o){for(var l=eTt(r,t),u=[],c=[],h=[],p=[],v=[],y=[],x=[],w=gj(n,t,s),T=r.getLayout("points")||[],E=t.getLayout("points")||[],M=0;M<l.length;M++){var L=l[M],F=!0,O=void 0,U=void 0;switch(L.cmd){case"=":O=L.idx*2,U=L.idx1*2;var W=T[O],H=T[O+1],j=E[U],Y=E[U+1];(isNaN(W)||isNaN(H))&&(W=j,H=Y),u.push(W,H),c.push(j,Y),h.push(e[O],e[O+1]),p.push(i[U],i[U+1]),x.push(t.getRawIndex(L.idx1));break;case"+":var tt=L.idx,it=w.dataDimsForPoint,lt=n.dataToPoint([t.get(it[0],tt),t.get(it[1],tt)]);U=tt*2,u.push(lt[0],lt[1]),c.push(E[U],E[U+1]);var ht=vj(w,n,t,tt);h.push(ht[0],ht[1]),p.push(i[U],i[U+1]),x.push(t.getRawIndex(tt));break;case"-":F=!1}F&&(v.push(L),y.push(y.length))}y.sort(function(Qe,sr){return x[Qe]-x[sr]});for(var Tt=u.length,Ot=ml(Tt),Rt=ml(Tt),Ut=ml(Tt),Jt=ml(Tt),ne=[],M=0;M<y.length;M++){var se=y[M],ce=M*2,ye=se*2;Ot[ce]=u[ye],Ot[ce+1]=u[ye+1],Rt[ce]=c[ye],Rt[ce+1]=c[ye+1],Ut[ce]=h[ye],Ut[ce+1]=h[ye+1],Jt[ce]=p[ye],Jt[ce+1]=p[ye+1],ne[M]=v[se]}return{current:Ot,next:Rt,stackedOnCurrent:Ut,stackedOnNext:Jt,status:ne}}var rc=Math.min,ic=Math.max;function Rf(r,t){return isNaN(r)||isNaN(t)}function DM(r,t,e,i,n,a,s,o,l){for(var u,c,h,p,v,y,x=e,w=0;w<i;w++){var T=t[x*2],E=t[x*2+1];if(x>=n||x<0)break;if(Rf(T,E)){if(l){x+=a;continue}break}if(x===e)r[a>0?"moveTo":"lineTo"](T,E),h=T,p=E;else{var M=T-u,L=E-c;if(M*M+L*L<.5){x+=a;continue}if(s>0){for(var F=x+a,O=t[F*2],U=t[F*2+1];O===T&&U===E&&w<i;)w++,F+=a,x+=a,O=t[F*2],U=t[F*2+1],T=t[x*2],E=t[x*2+1],M=T-u,L=E-c;var W=w+1;if(l)for(;Rf(O,U)&&W<i;)W++,F+=a,O=t[F*2],U=t[F*2+1];var H=.5,j=0,Y=0,tt=void 0,it=void 0;if(W>=i||Rf(O,U))v=T,y=E;else{j=O-u,Y=U-c;var lt=T-u,ht=O-T,Tt=E-c,Ot=U-E,Rt=void 0,Ut=void 0;if(o==="x"){Rt=Math.abs(lt),Ut=Math.abs(ht);var Jt=j>0?1:-1;v=T-Jt*Rt*s,y=E,tt=T+Jt*Ut*s,it=E}else if(o==="y"){Rt=Math.abs(Tt),Ut=Math.abs(Ot);var ne=Y>0?1:-1;v=T,y=E-ne*Rt*s,tt=T,it=E+ne*Ut*s}else Rt=Math.sqrt(lt*lt+Tt*Tt),Ut=Math.sqrt(ht*ht+Ot*Ot),H=Ut/(Ut+Rt),v=T-j*s*(1-H),y=E-Y*s*(1-H),tt=T+j*s*H,it=E+Y*s*H,tt=rc(tt,ic(O,T)),it=rc(it,ic(U,E)),tt=ic(tt,rc(O,T)),it=ic(it,rc(U,E)),j=tt-T,Y=it-E,v=T-j*Rt/Ut,y=E-Y*Rt/Ut,v=rc(v,ic(u,T)),y=rc(y,ic(c,E)),v=ic(v,rc(u,T)),y=ic(y,rc(c,E)),j=T-v,Y=E-y,tt=T+j*Ut/Rt,it=E+Y*Ut/Rt}r.bezierCurveTo(h,p,v,y,T,E),h=tt,p=it}else r.lineTo(T,E)}u=T,c=E,x+=a}return w}var mj=function(){function r(){this.smooth=0,this.smoothConstraint=!0}return r}(),iTt=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i.type="ec-polyline",i}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new mj},t.prototype.buildPath=function(e,i){var n=i.points,a=0,s=n.length/2;if(i.connectNulls){for(;s>0&&Rf(n[s*2-2],n[s*2-1]);s--);for(;a<s&&Rf(n[a*2],n[a*2+1]);a++);}for(;a<s;)a+=DM(e,n,a,s,s,1,i.smooth,i.smoothMonotone,i.connectNulls)+1},t.prototype.getPointOn=function(e,i){this.path||(this.createPathProxy(),this.buildPath(this.path,this.shape));for(var n=this.path,a=n.data,s=Al.CMD,o,l,u=i==="x",c=[],h=0;h<a.length;){var p=a[h++],v=void 0,y=void 0,x=void 0,w=void 0,T=void 0,E=void 0,M=void 0;switch(p){case s.M:o=a[h++],l=a[h++];break;case s.L:if(v=a[h++],y=a[h++],M=u?(e-o)/(v-o):(e-l)/(y-l),M<=1&&M>=0){var L=u?(y-l)*M+l:(v-o)*M+o;return u?[e,L]:[L,e]}o=v,l=y;break;case s.C:v=a[h++],y=a[h++],x=a[h++],w=a[h++],T=a[h++],E=a[h++];var F=u?Gb(o,v,x,T,e,c):Gb(l,y,w,E,e,c);if(F>0)for(var O=0;O<F;O++){var U=c[O];if(U<=1&&U>=0){var L=u?Pn(l,y,w,E,U):Pn(o,v,x,T,U);return u?[e,L]:[L,e]}}o=T,l=E;break}}},t}(vr),nTt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(mj),yj=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i.type="ec-polygon",i}return t.prototype.getDefaultShape=function(){return new nTt},t.prototype.buildPath=function(e,i){var n=i.points,a=i.stackedOnPoints,s=0,o=n.length/2,l=i.smoothMonotone;if(i.connectNulls){for(;o>0&&Rf(n[o*2-2],n[o*2-1]);o--);for(;s<o&&Rf(n[s*2],n[s*2+1]);s++);}for(;s<o;){var u=DM(e,n,s,o,o,1,i.smooth,l,i.connectNulls);DM(e,a,s+u-1,u,o,-1,i.stackedOnSmooth,l,i.connectNulls),s+=u+1,e.closePath()}},t}(vr);function _j(r,t,e,i,n){var a=r.getArea(),s=a.x,o=a.y,l=a.width,u=a.height,c=e.get(["lineStyle","width"])||2;s-=c/2,o-=c/2,l+=c,u+=c,l=Math.ceil(l),s!==Math.floor(s)&&(s=Math.floor(s),l++);var h=new Pr({shape:{x:s,y:o,width:l,height:u}});if(t){var p=r.getBaseAxis(),v=p.isHorizontal(),y=p.inverse;v?(y&&(h.shape.x+=l),h.shape.width=0):(y||(h.shape.y+=u),h.shape.height=0);var x=Ve(n)?function(w){n(w,h)}:null;Ei(h,{shape:{width:l,height:u,x:s,y:o}},e,null,i,x)}return h}function xj(r,t,e){var i=r.getArea(),n=Yi(i.r0,1),a=Yi(i.r,1),s=new fs({shape:{cx:Yi(r.cx,1),cy:Yi(r.cy,1),r0:n,r:a,startAngle:i.startAngle,endAngle:i.endAngle,clockwise:i.clockwise}});if(t){var o=r.getBaseAxis().dim==="angle";o?s.shape.endAngle=i.startAngle:s.shape.r=n,Ei(s,{shape:{endAngle:i.endAngle,r:a}},e)}return s}function B_(r,t,e,i,n){if(r){if(r.type==="polar")return xj(r,t,e);if(r.type==="cartesian2d")return _j(r,t,e,i,n)}else return null;return null}function ad(r,t){return r.type===t}function k5(r,t){if(r.length===t.length){for(var e=0;e<r.length;e++)if(r[e]!==t[e])return;return!0}}function O5(r){for(var t=1/0,e=1/0,i=-1/0,n=-1/0,a=0;a<r.length;){var s=r[a++],o=r[a++];isNaN(s)||(t=Math.min(s,t),i=Math.max(s,i)),isNaN(o)||(e=Math.min(o,e),n=Math.max(o,n))}return[[t,e],[i,n]]}function N5(r,t){var e=O5(r),i=e[0],n=e[1],a=O5(t),s=a[0],o=a[1];return Math.max(Math.abs(i[0]-s[0]),Math.abs(i[1]-s[1]),Math.abs(n[0]-o[0]),Math.abs(n[1]-o[1]))}function F5(r){return Fr(r)?r:r?.5:0}function aTt(r,t,e){if(!e.valueDim)return[];for(var i=t.count(),n=ml(i*2),a=0;a<i;a++){var s=vj(e,r,t,a);n[a*2]=s[0],n[a*2+1]=s[1]}return n}function nc(r,t,e,i){var n=t.getBaseAxis(),a=n.dim==="x"||n.dim==="radius"?0:1,s=[],o=0,l=[],u=[],c=[],h=[];if(i){for(o=0;o<r.length;o+=2)!isNaN(r[o])&&!isNaN(r[o+1])&&h.push(r[o],r[o+1]);r=h}for(o=0;o<r.length-2;o+=2)switch(c[0]=r[o+2],c[1]=r[o+3],u[0]=r[o],u[1]=r[o+1],s.push(u[0],u[1]),e){case"end":l[a]=c[a],l[1-a]=u[1-a],s.push(l[0],l[1]);break;case"middle":var p=(u[a]+c[a])/2,v=[];l[a]=v[a]=p,l[1-a]=u[1-a],v[1-a]=c[1-a],s.push(l[0],l[1]),s.push(v[0],v[1]);break;default:l[a]=u[a],l[1-a]=c[1-a],s.push(l[0],l[1])}return s.push(r[o++],r[o++]),s}function sTt(r,t){var e=[],i=r.length,n,a;function s(c,h,p){var v=c.coord,y=(p-v)/(h.coord-v),x=gmt(y,[c.color,h.color]);return{coord:p,color:x}}for(var o=0;o<i;o++){var l=r[o],u=l.coord;if(u<0)n=l;else if(u>t){a?e.push(s(a,l,t)):n&&e.push(s(n,l,0),s(n,l,t));break}else n&&(e.push(s(n,l,0)),n=null),e.push(l),a=l}return e}function oTt(r,t,e){var i=r.getVisual("visualMeta");if(!(!i||!i.length||!r.count())&&t.type==="cartesian2d"){for(var n,a,s=i.length-1;s>=0;s--){var o=r.getDimensionInfo(i[s].dimension);if(n=o&&o.coordDim,n==="x"||n==="y"){a=i[s];break}}if(a){var l=t.getAxis(n),u=te(a.stops,function(M){return{coord:l.toGlobalCoord(l.dataToCoord(M.value)),color:M.color}}),c=u.length,h=a.outerColors.slice();c&&u[0].coord>u[c-1].coord&&(u.reverse(),h.reverse());var p=sTt(u,n==="x"?e.getWidth():e.getHeight()),v=p.length;if(!v&&c)return u[0].coord<0?h[1]?h[1]:u[c-1].color:h[0]?h[0]:u[0].color;var y=10,x=p[0].coord-y,w=p[v-1].coord+y,T=w-x;if(T<.001)return"transparent";J(p,function(M){M.offset=(M.coord-x)/T}),p.push({offset:v?p[v-1].offset:.5,color:h[1]||"transparent"}),p.unshift({offset:v?p[0].offset:.5,color:h[0]||"transparent"});var E=new M_(0,0,0,0,p,!0);return E[n]=x,E[n+"2"]=w,E}}}function lTt(r,t,e){var i=r.get("showAllSymbol"),n=i==="auto";if(!(i&&!n)){var a=e.getAxesByScale("ordinal")[0];if(a&&!(n&&uTt(a,t))){var s=t.mapDimension(a.dim),o={};return J(a.getViewLabels(),function(l){var u=a.scale.getRawOrdinalNumber(l.tickValue);o[u]=1}),function(l){return!o.hasOwnProperty(t.get(s,l))}}}}function uTt(r,t){var e=r.getExtent(),i=Math.abs(e[1]-e[0])/r.scale.count();isNaN(i)&&(i=0);for(var n=t.count(),a=Math.max(1,Math.round(n/5)),s=0;s<n;s+=a)if(N_.getSymbolSize(t,s)[r.isHorizontal()?1:0]*1.5>i)return!1;return!0}function cTt(r,t){return isNaN(r)||isNaN(t)}function hTt(r){for(var t=r.length/2;t>0&&cTt(r[t*2-2],r[t*2-1]);t--);return t-1}function B5(r,t){return[r[t*2],r[t*2+1]]}function fTt(r,t,e){for(var i=r.length/2,n=e==="x"?0:1,a,s,o=0,l=-1,u=0;u<i;u++)if(s=r[u*2+n],!(isNaN(s)||isNaN(r[u*2+1-n]))){if(u===0){a=s;continue}if(a<=t&&s>=t||a>=t&&s<=t){l=u;break}o=u,a=s}return{range:[o,l],t:(t-a)/(s-a)}}function bj(r){if(r.get(["endLabel","show"]))return!0;for(var t=0;t<qa.length;t++)if(r.get([qa[t],"endLabel","show"]))return!0;return!1}function dC(r,t,e,i){if(ad(t,"cartesian2d")){var n=i.getModel("endLabel"),a=n.get("valueAnimation"),s=i.getData(),o={lastFrameIndex:0},l=bj(i)?function(v,y){r._endLabelOnDuring(v,y,s,o,a,n,t)}:null,u=t.getBaseAxis().isHorizontal(),c=_j(t,e,i,function(){var v=r._endLabel;v&&e&&o.originalX!=null&&v.attr({x:o.originalX,y:o.originalY})},l);if(!i.get("clip",!0)){var h=c.shape,p=Math.max(h.width,h.height);u?(h.y-=p,h.height+=p*2):(h.x-=p,h.width+=p*2)}return l&&l(1,c),c}else return xj(t,e,i)}function dTt(r,t){var e=t.getBaseAxis(),i=e.isHorizontal(),n=e.inverse,a=i?n?"right":"left":"center",s=i?"middle":n?"top":"bottom";return{normal:{align:r.get("align")||a,verticalAlign:r.get("verticalAlign")||s}}}var pTt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.init=function(){var e=new Ke,i=new F_;this.group.add(i.group),this._symbolDraw=i,this._lineGroup=e},t.prototype.render=function(e,i,n){var a=this,s=e.coordinateSystem,o=this.group,l=e.getData(),u=e.getModel("lineStyle"),c=e.getModel("areaStyle"),h=l.getLayout("points")||[],p=s.type==="polar",v=this._coordSys,y=this._symbolDraw,x=this._polyline,w=this._polygon,T=this._lineGroup,E=!i.ssr&&e.get("animation"),M=!c.isEmpty(),L=c.get("origin"),F=gj(s,l,L),O=M&&aTt(s,l,F),U=e.get("showSymbol"),W=e.get("connectNulls"),H=U&&!p&&lTt(e,l,s),j=this._data;j&&j.eachItemGraphicEl(function(sr,ke){sr.__temp&&(o.remove(sr),j.setItemGraphicEl(ke,null))}),U||y.remove(),o.add(T);var Y=p?!1:e.get("step"),tt;s&&s.getArea&&e.get("clip",!0)&&(tt=s.getArea(),tt.width!=null?(tt.x-=.1,tt.y-=.1,tt.width+=.2,tt.height+=.2):tt.r0&&(tt.r0-=.5,tt.r+=.5)),this._clipShapeForSymbol=tt;var it=oTt(l,s,n)||l.getVisual("style")[l.getVisual("drawType")];if(!(x&&v.type===s.type&&Y===this._step))U&&y.updateData(l,{isIgnore:H,clipShape:tt,disableAnimation:!0,getSymbolPoint:function(sr){return[h[sr*2],h[sr*2+1]]}}),E&&this._initSymbolLabelAnimation(l,s,tt),Y&&(h=nc(h,s,Y,W),O&&(O=nc(O,s,Y,W))),x=this._newPolyline(h),M?w=this._newPolygon(h,O):w&&(T.remove(w),w=this._polygon=null),p||this._initOrUpdateEndLabel(e,s,jf(it)),T.setClipPath(dC(this,s,!0,e));else{M&&!w?w=this._newPolygon(h,O):w&&!M&&(T.remove(w),w=this._polygon=null),p||this._initOrUpdateEndLabel(e,s,jf(it));var lt=T.getClipPath();if(lt){var ht=dC(this,s,!1,e);Ei(lt,{shape:ht.shape},e)}else T.setClipPath(dC(this,s,!0,e));U&&y.updateData(l,{isIgnore:H,clipShape:tt,disableAnimation:!0,getSymbolPoint:function(sr){return[h[sr*2],h[sr*2+1]]}}),(!k5(this._stackedOnPoints,O)||!k5(this._points,h))&&(E?this._doUpdateAnimation(l,O,s,n,Y,L,W):(Y&&(h=nc(h,s,Y,W),O&&(O=nc(O,s,Y,W))),x.setShape({points:h}),w&&w.setShape({points:h,stackedOnPoints:O})))}var Tt=e.getModel("emphasis"),Ot=Tt.get("focus"),Rt=Tt.get("blurScope"),Ut=Tt.get("disabled");if(x.useStyle(We(u.getLineStyle(),{fill:"none",stroke:it,lineJoin:"bevel"})),ea(x,e,"lineStyle"),x.style.lineWidth>0&&e.get(["emphasis","lineStyle","width"])==="bolder"){var Jt=x.getState("emphasis").style;Jt.lineWidth=+x.style.lineWidth+1}Je(x).seriesIndex=e.seriesIndex,Ui(x,Ot,Rt,Ut);var ne=F5(e.get("smooth")),se=e.get("smoothMonotone");if(x.setShape({smooth:ne,smoothMonotone:se,connectNulls:W}),w){var ce=l.getCalculationInfo("stackedOnSeries"),ye=0;w.useStyle(We(c.getAreaStyle(),{fill:it,opacity:.7,lineJoin:"bevel",decal:l.getVisual("style").decal})),ce&&(ye=F5(ce.get("smooth"))),w.setShape({smooth:ne,stackedOnSmooth:ye,smoothMonotone:se,connectNulls:W}),ea(w,e,"areaStyle"),Je(w).seriesIndex=e.seriesIndex,Ui(w,Ot,Rt,Ut)}var Qe=function(sr){a._changePolyState(sr)};l.eachItemGraphicEl(function(sr){sr&&(sr.onHoverStateChange=Qe)}),this._polyline.onHoverStateChange=Qe,this._data=l,this._coordSys=s,this._stackedOnPoints=O,this._points=h,this._step=Y,this._valueOrigin=L,e.get("triggerLineEvent")&&(this.packEventData(e,x),w&&this.packEventData(e,w))},t.prototype.packEventData=function(e,i){Je(i).eventData={componentType:"series",componentSubType:"line",componentIndex:e.componentIndex,seriesIndex:e.seriesIndex,seriesName:e.name,seriesType:"line"}},t.prototype.highlight=function(e,i,n,a){var s=e.getData(),o=Wf(s,a);if(this._changePolyState("emphasis"),!(o instanceof Array)&&o!=null&&o>=0){var l=s.getLayout("points"),u=s.getItemGraphicEl(o);if(!u){var c=l[o*2],h=l[o*2+1];if(isNaN(c)||isNaN(h)||this._clipShapeForSymbol&&!this._clipShapeForSymbol.contain(c,h))return;var p=e.get("zlevel")||0,v=e.get("z")||0;u=new N_(s,o),u.x=c,u.y=h,u.setZ(p,v);var y=u.getSymbolPath().getTextContent();y&&(y.zlevel=p,y.z=v,y.z2=this._polyline.z2+1),u.__temp=!0,s.setItemGraphicEl(o,u),u.stopSymbolAnimation(!0),this.group.add(u)}u.highlight()}else di.prototype.highlight.call(this,e,i,n,a)},t.prototype.downplay=function(e,i,n,a){var s=e.getData(),o=Wf(s,a);if(this._changePolyState("normal"),o!=null&&o>=0){var l=s.getItemGraphicEl(o);l&&(l.__temp?(s.setItemGraphicEl(o,null),this.group.remove(l)):l.downplay())}else di.prototype.downplay.call(this,e,i,n,a)},t.prototype._changePolyState=function(e){var i=this._polygon;Jb(this._polyline,e),i&&Jb(i,e)},t.prototype._newPolyline=function(e){var i=this._polyline;return i&&this._lineGroup.remove(i),i=new iTt({shape:{points:e},segmentIgnoreThreshold:2,z2:10}),this._lineGroup.add(i),this._polyline=i,i},t.prototype._newPolygon=function(e,i){var n=this._polygon;return n&&this._lineGroup.remove(n),n=new yj({shape:{points:e,stackedOnPoints:i},segmentIgnoreThreshold:2}),this._lineGroup.add(n),this._polygon=n,n},t.prototype._initSymbolLabelAnimation=function(e,i,n){var a,s,o=i.getBaseAxis(),l=o.inverse;i.type==="cartesian2d"?(a=o.isHorizontal(),s=!1):i.type==="polar"&&(a=o.dim==="angle",s=!0);var u=e.hostModel,c=u.get("animationDuration");Ve(c)&&(c=c(null));var h=u.get("animationDelay")||0,p=Ve(h)?h(null):h;e.eachItemGraphicEl(function(v,y){var x=v;if(x){var w=[v.x,v.y],T=void 0,E=void 0,M=void 0;if(n)if(s){var L=n,F=i.pointToCoord(w);a?(T=L.startAngle,E=L.endAngle,M=-F[1]/180*Math.PI):(T=L.r0,E=L.r,M=F[0])}else{var O=n;a?(T=O.x,E=O.x+O.width,M=v.x):(T=O.y+O.height,E=O.y,M=v.y)}var U=E===T?0:(M-T)/(E-T);l&&(U=1-U);var W=Ve(h)?h(y):c*U+p,H=x.getSymbolPath(),j=H.getTextContent();x.attr({scaleX:0,scaleY:0}),x.animateTo({scaleX:1,scaleY:1},{duration:200,setToFinal:!0,delay:W}),j&&j.animateFrom({style:{opacity:0}},{duration:300,delay:W}),H.disableLabelAnimation=!0}})},t.prototype._initOrUpdateEndLabel=function(e,i,n){var a=e.getModel("endLabel");if(bj(e)){var s=e.getData(),o=this._polyline,l=s.getLayout("points");if(!l){o.removeTextContent(),this._endLabel=null;return}var u=this._endLabel;u||(u=this._endLabel=new Nr({z2:200}),u.ignoreClip=!0,o.setTextContent(this._endLabel),o.disableLabelAnimation=!0);var c=hTt(l);c>=0&&(ra(o,Dn(e,"endLabel"),{inheritColor:n,labelFetcher:e,labelDataIndex:c,defaultText:function(h,p,v){return v!=null?pj(s,v):mg(s,h)},enableTextSetter:!0},dTt(a,i)),o.textConfig.position=null)}else this._endLabel&&(this._polyline.removeTextContent(),this._endLabel=null)},t.prototype._endLabelOnDuring=function(e,i,n,a,s,o,l){var u=this._endLabel,c=this._polyline;if(u){e<1&&a.originalX==null&&(a.originalX=u.x,a.originalY=u.y);var h=n.getLayout("points"),p=n.hostModel,v=p.get("connectNulls"),y=o.get("precision"),x=o.get("distance")||0,w=l.getBaseAxis(),T=w.isHorizontal(),E=w.inverse,M=i.shape,L=E?T?M.x:M.y+M.height:T?M.x+M.width:M.y,F=(T?x:0)*(E?-1:1),O=(T?0:-x)*(E?-1:1),U=T?"x":"y",W=fTt(h,L,U),H=W.range,j=H[1]-H[0],Y=void 0;if(j>=1){if(j>1&&!v){var tt=B5(h,H[0]);u.attr({x:tt[0]+F,y:tt[1]+O}),s&&(Y=p.getRawValue(H[0]))}else{var tt=c.getPointOn(L,U);tt&&u.attr({x:tt[0]+F,y:tt[1]+O});var it=p.getRawValue(H[0]),lt=p.getRawValue(H[1]);s&&(Y=VH(n,y,it,lt,W.t))}a.lastFrameIndex=H[0]}else{var ht=e===1||a.lastFrameIndex>0?H[0]:0,tt=B5(h,ht);s&&(Y=p.getRawValue(ht)),u.attr({x:tt[0]+F,y:tt[1]+O})}if(s){var Tt=kg(u);typeof Tt.setLabelText=="function"&&Tt.setLabelText(Y)}}},t.prototype._doUpdateAnimation=function(e,i,n,a,s,o,l){var u=this._polyline,c=this._polygon,h=e.hostModel,p=rTt(this._data,e,this._stackedOnPoints,i,this._coordSys,n,this._valueOrigin),v=p.current,y=p.stackedOnCurrent,x=p.next,w=p.stackedOnNext;if(s&&(v=nc(p.current,n,s,l),y=nc(p.stackedOnCurrent,n,s,l),x=nc(p.next,n,s,l),w=nc(p.stackedOnNext,n,s,l)),N5(v,x)>3e3||c&&N5(y,w)>3e3){u.stopAnimation(),u.setShape({points:x}),c&&(c.stopAnimation(),c.setShape({points:x,stackedOnPoints:w}));return}u.shape.__points=p.current,u.shape.points=v;var T={shape:{points:x}};p.current!==v&&(T.shape.__points=p.next),u.stopAnimation(),zr(u,T,h),c&&(c.setShape({points:v,stackedOnPoints:y}),c.stopAnimation(),zr(c,{shape:{stackedOnPoints:w}},h),u.shape.points!==c.shape.points&&(c.shape.points=u.shape.points));for(var E=[],M=p.status,L=0;L<M.length;L++){var F=M[L].cmd;if(F==="="){var O=e.getItemGraphicEl(M[L].idx1);O&&E.push({el:O,ptIdx:L})}}u.animators&&u.animators.length&&u.animators[0].during(function(){c&&c.dirtyShape();for(var U=u.shape.__points,W=0;W<E.length;W++){var H=E[W].el,j=E[W].ptIdx*2;H.x=U[j],H.y=U[j+1],H.markRedraw()}})},t.prototype.remove=function(e){var i=this.group,n=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),n&&n.eachItemGraphicEl(function(a,s){a.__temp&&(i.remove(a),n.setItemGraphicEl(s,null))}),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._endLabel=this._data=null},t.type="line",t}(di);const gTt=pTt;function z_(r,t){return{seriesType:r,plan:Vg(),reset:function(e){var i=e.getData(),n=e.coordinateSystem,a=e.pipelineContext,s=t||a.large;if(n){var o=te(n.dimensions,function(v){return i.mapDimension(v)}).slice(0,2),l=o.length,u=i.getCalculationInfo("stackResultDimension");Hc(i,o[0])&&(o[0]=u),Hc(i,o[1])&&(o[1]=u);var c=i.getStore(),h=i.getDimensionIndex(o[0]),p=i.getDimensionIndex(o[1]);return l&&{progress:function(v,y){for(var x=v.end-v.start,w=s&&ml(x*l),T=[],E=[],M=v.start,L=0;M<v.end;M++){var F=void 0;if(l===1){var O=c.get(h,M);F=n.dataToPoint(O,null,E)}else T[0]=c.get(h,M),T[1]=c.get(p,M),F=n.dataToPoint(T,null,E);s?(w[L++]=F[0],w[L++]=F[1]):y.setItemLayout(M,F.slice())}s&&y.setLayout("points",w)}}}}}}var vTt={average:function(r){for(var t=0,e=0,i=0;i<r.length;i++)isNaN(r[i])||(t+=r[i],e++);return e===0?NaN:t/e},sum:function(r){for(var t=0,e=0;e<r.length;e++)t+=r[e]||0;return t},max:function(r){for(var t=-1/0,e=0;e<r.length;e++)r[e]>t&&(t=r[e]);return isFinite(t)?t:NaN},min:function(r){for(var t=1/0,e=0;e<r.length;e++)r[e]<t&&(t=r[e]);return isFinite(t)?t:NaN},minmax:function(r){for(var t=-1/0,e=-1/0,i=0;i<r.length;i++){var n=r[i],a=Math.abs(n);a>t&&(t=a,e=n)}return isFinite(e)?e:NaN},nearest:function(r){return r[0]}},mTt=function(r){return Math.round(r.length/2)};function wj(r){return{seriesType:r,reset:function(t,e,i){var n=t.getData(),a=t.get("sampling"),s=t.coordinateSystem,o=n.count();if(o>10&&s.type==="cartesian2d"&&a){var l=s.getBaseAxis(),u=s.getOtherAxis(l),c=l.getExtent(),h=i.getDevicePixelRatio(),p=Math.abs(c[1]-c[0])*(h||1),v=Math.round(o/p);if(isFinite(v)&&v>1){a==="lttb"&&t.setData(n.lttbDownSample(n.mapDimension(u.dim),1/v));var y=void 0;ve(a)?y=vTt[a]:Ve(a)&&(y=a),y&&t.setData(n.downSample(n.mapDimension(u.dim),1/v,y,mTt))}}}}}function yTt(r){r.registerChartView(gTt),r.registerSeriesModel(YSt),r.registerLayout(z_("line",!0)),r.registerVisual({seriesType:"line",reset:function(t){var e=t.getData(),i=t.getModel("lineStyle").getLineStyle();i&&!i.stroke&&(i.stroke=e.getVisual("style").fill),e.setVisual("legendLineStyle",i)}}),r.registerProcessor(r.PRIORITY.PROCESSOR.STATISTIC,wj("line"))}var Sj=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(e,i){return Su(null,this,{useEncodeDefaulter:!0})},t.prototype.getMarkerPosition=function(e,i,n){var a=this.coordinateSystem;if(a&&a.clampData){var s=a.clampData(e),o=a.dataToPoint(s);if(n)J(a.getAxes(),function(p,v){if(p.type==="category"&&i!=null){var y=p.getTicksCoords(),x=p.getTickModel().get("alignWithLabel"),w=s[v],T=i[v]==="x1"||i[v]==="y1";if(T&&!x&&(w+=1),y.length<2)return;if(y.length===2){o[v]=p.toGlobalCoord(p.getExtent()[T?1:0]);return}for(var E=void 0,M=void 0,L=1,F=0;F<y.length;F++){var O=y[F].coord,U=F===y.length-1?y[F-1].tickValue+L:y[F].tickValue;if(U===w){M=O;break}else if(U<w)E=O;else if(E!=null&&U>w){M=(O+E)/2;break}F===1&&(L=U-y[0].tickValue)}M==null&&(E?E&&(M=y[y.length-1].coord):M=y[0].coord),o[v]=p.toGlobalCoord(M)}});else{var l=this.getData(),u=l.getLayout("offset"),c=l.getLayout("size"),h=a.getBaseAxis().isHorizontal()?0:1;o[h]+=u+c/2}return o}return[NaN,NaN]},t.type="series.__base_bar__",t.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,barMinHeight:0,barMinAngle:0,large:!1,largeThreshold:400,progressive:3e3,progressiveChunkMode:"mod"},t}(Li);Li.registerClass(Sj);const mw=Sj;var _Tt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(){return Su(null,this,{useEncodeDefaulter:!0,createInvertedIndices:!!this.get("realtimeSort",!0)||null})},t.prototype.getProgressive=function(){return this.get("large")?this.get("progressive"):!1},t.prototype.getProgressiveThreshold=function(){var e=this.get("progressiveThreshold"),i=this.get("largeThreshold");return i>e&&(e=i),e},t.prototype.brushSelector=function(e,i,n){return n.rect(i.getItemLayout(e))},t.type="series.bar",t.dependencies=["grid","polar"],t.defaultOption=Jc(mw.defaultOption,{clip:!0,roundCap:!1,showBackground:!1,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)",borderColor:null,borderWidth:0,borderType:"solid",borderRadius:0,shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,opacity:1},select:{itemStyle:{borderColor:"#212121"}},realtimeSort:!1}),t}(mw);const xTt=_Tt;var bTt=function(){function r(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return r}(),wTt=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i.type="sausage",i}return t.prototype.getDefaultShape=function(){return new bTt},t.prototype.buildPath=function(e,i){var n=i.cx,a=i.cy,s=Math.max(i.r0||0,0),o=Math.max(i.r,0),l=(o-s)*.5,u=s+l,c=i.startAngle,h=i.endAngle,p=i.clockwise,v=Math.PI*2,y=p?h-c<v:c-h<v;y||(c=h-(p?v:-v));var x=Math.cos(c),w=Math.sin(c),T=Math.cos(h),E=Math.sin(h);y?(e.moveTo(x*s+n,w*s+a),e.arc(x*u+n,w*u+a,l,-Math.PI+c,c,!p)):e.moveTo(x*o+n,w*o+a),e.arc(n,a,o,c,h,!p),e.arc(T*u+n,E*u+a,l,h-Math.PI*2,h-Math.PI,!p),s!==0&&e.arc(n,a,s,h,c,p)},t}(vr);const yw=wTt;function STt(r,t){t=t||{};var e=t.isRoundCap;return function(i,n,a){var s=n.position;if(!s||s instanceof Array)return Yb(i,n,a);var o=r(s),l=n.distance!=null?n.distance:5,u=this.shape,c=u.cx,h=u.cy,p=u.r,v=u.r0,y=(p+v)/2,x=u.startAngle,w=u.endAngle,T=(x+w)/2,E=e?Math.abs(p-v)/2:0,M=Math.cos,L=Math.sin,F=c+p*M(x),O=h+p*L(x),U="left",W="top";switch(o){case"startArc":F=c+(v-l)*M(T),O=h+(v-l)*L(T),U="center",W="top";break;case"insideStartArc":F=c+(v+l)*M(T),O=h+(v+l)*L(T),U="center",W="bottom";break;case"startAngle":F=c+y*M(x)+u1(x,l+E,!1),O=h+y*L(x)+c1(x,l+E,!1),U="right",W="middle";break;case"insideStartAngle":F=c+y*M(x)+u1(x,-l+E,!1),O=h+y*L(x)+c1(x,-l+E,!1),U="left",W="middle";break;case"middle":F=c+y*M(T),O=h+y*L(T),U="center",W="middle";break;case"endArc":F=c+(p+l)*M(T),O=h+(p+l)*L(T),U="center",W="bottom";break;case"insideEndArc":F=c+(p-l)*M(T),O=h+(p-l)*L(T),U="center",W="top";break;case"endAngle":F=c+y*M(w)+u1(w,l+E,!0),O=h+y*L(w)+c1(w,l+E,!0),U="left",W="middle";break;case"insideEndAngle":F=c+y*M(w)+u1(w,-l+E,!0),O=h+y*L(w)+c1(w,-l+E,!0),U="right",W="middle";break;default:return Yb(i,n,a)}return i=i||{},i.x=F,i.y=O,i.align=U,i.verticalAlign=W,i}}function TTt(r,t,e,i){if(Fr(i)){r.setTextConfig({rotation:i});return}else if(Kt(t)){r.setTextConfig({rotation:0});return}var n=r.shape,a=n.clockwise?n.startAngle:n.endAngle,s=n.clockwise?n.endAngle:n.startAngle,o=(a+s)/2,l,u=e(t);switch(u){case"startArc":case"insideStartArc":case"middle":case"insideEndArc":case"endArc":l=o;break;case"startAngle":case"insideStartAngle":l=a;break;case"endAngle":case"insideEndAngle":l=s;break;default:r.setTextConfig({rotation:0});return}var c=Math.PI*1.5-l;u==="middle"&&c>Math.PI/2&&c<Math.PI*1.5&&(c-=Math.PI),r.setTextConfig({rotation:c})}function u1(r,t,e){return t*Math.sin(r)*(e?-1:1)}function c1(r,t,e){return t*Math.cos(r)*(e?1:-1)}function xf(r,t,e){var i=r.get("borderRadius");if(i==null)return e?{cornerRadius:0}:null;Kt(i)||(i=[i,i,i,i]);var n=Math.abs(t.r||0-t.r0||0);return{cornerRadius:te(i,function(a){return zo(a,n)})}}var pC=Math.max,gC=Math.min;function ATt(r,t){var e=r.getArea&&r.getArea();if(ad(r,"cartesian2d")){var i=r.getBaseAxis();if(i.type!=="category"||!i.onBand){var n=t.getLayout("bandWidth");i.isHorizontal()?(e.x-=n,e.width+=n*2):(e.y-=n,e.height+=n*2)}}return e}var CTt=function(r){Vt(t,r);function t(){var e=r.call(this)||this;return e.type=t.type,e._isFirstFrame=!0,e}return t.prototype.render=function(e,i,n,a){this._model=e,this._removeOnRenderedListener(n),this._updateDrawMode(e);var s=e.get("coordinateSystem");(s==="cartesian2d"||s==="polar")&&(this._progressiveEls=null,this._isLargeDraw?this._renderLarge(e,i,n):this._renderNormal(e,i,n,a))},t.prototype.incrementalPrepareRender=function(e){this._clear(),this._updateDrawMode(e),this._updateLargeClip(e)},t.prototype.incrementalRender=function(e,i){this._progressiveEls=[],this._incrementalRenderLarge(e,i)},t.prototype.eachRendered=function(e){Kc(this._progressiveEls||this.group,e)},t.prototype._updateDrawMode=function(e){var i=e.pipelineContext.large;(this._isLargeDraw==null||i!==this._isLargeDraw)&&(this._isLargeDraw=i,this._clear())},t.prototype._renderNormal=function(e,i,n,a){var s=this.group,o=e.getData(),l=this._data,u=e.coordinateSystem,c=u.getBaseAxis(),h;u.type==="cartesian2d"?h=c.isHorizontal():u.type==="polar"&&(h=c.dim==="angle");var p=e.isAnimationEnabled()?e:null,v=ETt(e,u);v&&this._enableRealtimeSort(v,o,n);var y=e.get("clip",!0)||v,x=ATt(u,o);s.removeClipPath();var w=e.get("roundCap",!0),T=e.get("showBackground",!0),E=e.getModel("backgroundStyle"),M=E.get("borderRadius")||0,L=[],F=this._backgroundEls,O=a&&a.isInitSort,U=a&&a.type==="changeAxisOrder";function W(Y){var tt=h1[u.type](o,Y),it=kTt(u,h,tt);return it.useStyle(E.getItemStyle()),u.type==="cartesian2d"?it.setShape("r",M):it.setShape("cornerRadius",M),L[Y]=it,it}o.diff(l).add(function(Y){var tt=o.getItemModel(Y),it=h1[u.type](o,Y,tt);if(T&&W(Y),!(!o.hasValue(Y)||!W5[u.type](it))){var lt=!1;y&&(lt=z5[u.type](x,it));var ht=V5[u.type](e,o,Y,it,h,p,c.model,!1,w);v&&(ht.forceLabelAnimation=!0),H5(ht,o,Y,tt,it,e,h,u.type==="polar"),O?ht.attr({shape:it}):v?U5(v,p,ht,it,Y,h,!1,!1):Ei(ht,{shape:it},e,Y),o.setItemGraphicEl(Y,ht),s.add(ht),ht.ignore=lt}}).update(function(Y,tt){var it=o.getItemModel(Y),lt=h1[u.type](o,Y,it);if(T){var ht=void 0;F.length===0?ht=W(tt):(ht=F[tt],ht.useStyle(E.getItemStyle()),u.type==="cartesian2d"?ht.setShape("r",M):ht.setShape("cornerRadius",M),L[Y]=ht);var Tt=h1[u.type](o,Y),Ot=Aj(h,Tt,u);zr(ht,{shape:Ot},p,Y)}var Rt=l.getItemGraphicEl(tt);if(!o.hasValue(Y)||!W5[u.type](lt)){s.remove(Rt);return}var Ut=!1;if(y&&(Ut=z5[u.type](x,lt),Ut&&s.remove(Rt)),Rt?Vo(Rt):Rt=V5[u.type](e,o,Y,lt,h,p,c.model,!!Rt,w),v&&(Rt.forceLabelAnimation=!0),U){var Jt=Rt.getTextContent();if(Jt){var ne=kg(Jt);ne.prevValue!=null&&(ne.prevValue=ne.value)}}else H5(Rt,o,Y,it,lt,e,h,u.type==="polar");O?Rt.attr({shape:lt}):v?U5(v,p,Rt,lt,Y,h,!0,U):zr(Rt,{shape:lt},e,Y,null),o.setItemGraphicEl(Y,Rt),Rt.ignore=Ut,s.add(Rt)}).remove(function(Y){var tt=l.getItemGraphicEl(Y);tt&&Zy(tt,e,Y)}).execute();var H=this._backgroundGroup||(this._backgroundGroup=new Ke);H.removeAll();for(var j=0;j<L.length;++j)H.add(L[j]);s.add(H),this._backgroundEls=L,this._data=o},t.prototype._renderLarge=function(e,i,n){this._clear(),j5(e,this.group),this._updateLargeClip(e)},t.prototype._incrementalRenderLarge=function(e,i){this._removeBackground(),j5(i,this.group,this._progressiveEls,!0)},t.prototype._updateLargeClip=function(e){var i=e.get("clip",!0)&&B_(e.coordinateSystem,!1,e),n=this.group;i?n.setClipPath(i):n.removeClipPath()},t.prototype._enableRealtimeSort=function(e,i,n){var a=this;if(i.count()){var s=e.baseAxis;if(this._isFirstFrame)this._dispatchInitSort(i,e,n),this._isFirstFrame=!1;else{var o=function(l){var u=i.getItemGraphicEl(l),c=u&&u.shape;return c&&Math.abs(s.isHorizontal()?c.height:c.width)||0};this._onRendered=function(){a._updateSortWithinSameData(i,o,s,n)},n.getZr().on("rendered",this._onRendered)}}},t.prototype._dataSort=function(e,i,n){var a=[];return e.each(e.mapDimension(i.dim),function(s,o){var l=n(o);l=l??NaN,a.push({dataIndex:o,mappedValue:l,ordinalNumber:s})}),a.sort(function(s,o){return o.mappedValue-s.mappedValue}),{ordinalNumbers:te(a,function(s){return s.ordinalNumber})}},t.prototype._isOrderChangedWithinSameData=function(e,i,n){for(var a=n.scale,s=e.mapDimension(n.dim),o=Number.MAX_VALUE,l=0,u=a.getOrdinalMeta().categories.length;l<u;++l){var c=e.rawIndexOf(s,a.getRawOrdinalNumber(l)),h=c<0?Number.MIN_VALUE:i(e.indexOfRawIndex(c));if(h>o)return!0;o=h}return!1},t.prototype._isOrderDifferentInView=function(e,i){for(var n=i.scale,a=n.getExtent(),s=Math.max(0,a[0]),o=Math.min(a[1],n.getOrdinalMeta().categories.length-1);s<=o;++s)if(e.ordinalNumbers[s]!==n.getRawOrdinalNumber(s))return!0},t.prototype._updateSortWithinSameData=function(e,i,n,a){if(this._isOrderChangedWithinSameData(e,i,n)){var s=this._dataSort(e,n,i);this._isOrderDifferentInView(s,n)&&(this._removeOnRenderedListener(a),a.dispatchAction({type:"changeAxisOrder",componentType:n.dim+"Axis",axisId:n.index,sortInfo:s}))}},t.prototype._dispatchInitSort=function(e,i,n){var a=i.baseAxis,s=this._dataSort(e,a,function(o){return e.get(e.mapDimension(i.otherAxis.dim),o)});n.dispatchAction({type:"changeAxisOrder",componentType:a.dim+"Axis",isInitSort:!0,axisId:a.index,sortInfo:s})},t.prototype.remove=function(e,i){this._clear(this._model),this._removeOnRenderedListener(i)},t.prototype.dispose=function(e,i){this._removeOnRenderedListener(i)},t.prototype._removeOnRenderedListener=function(e){this._onRendered&&(e.getZr().off("rendered",this._onRendered),this._onRendered=null)},t.prototype._clear=function(e){var i=this.group,n=this._data;e&&e.isAnimationEnabled()&&n&&!this._isLargeDraw?(this._removeBackground(),this._backgroundEls=[],n.eachItemGraphicEl(function(a){Zy(a,e,Je(a).dataIndex)})):i.removeAll(),this._data=null,this._isFirstFrame=!0},t.prototype._removeBackground=function(){this.group.remove(this._backgroundGroup),this._backgroundGroup=null},t.type="bar",t}(di),z5={cartesian2d:function(r,t){var e=t.width<0?-1:1,i=t.height<0?-1:1;e<0&&(t.x+=t.width,t.width=-t.width),i<0&&(t.y+=t.height,t.height=-t.height);var n=r.x+r.width,a=r.y+r.height,s=pC(t.x,r.x),o=gC(t.x+t.width,n),l=pC(t.y,r.y),u=gC(t.y+t.height,a),c=o<s,h=u<l;return t.x=c&&s>n?o:s,t.y=h&&l>a?u:l,t.width=c?0:o-s,t.height=h?0:u-l,e<0&&(t.x+=t.width,t.width=-t.width),i<0&&(t.y+=t.height,t.height=-t.height),c||h},polar:function(r,t){var e=t.r0<=t.r?1:-1;if(e<0){var i=t.r;t.r=t.r0,t.r0=i}var n=gC(t.r,r.r),a=pC(t.r0,r.r0);t.r=n,t.r0=a;var s=n-a<0;if(e<0){var i=t.r;t.r=t.r0,t.r0=i}return s}},V5={cartesian2d:function(r,t,e,i,n,a,s,o,l){var u=new Pr({shape:Zt({},i),z2:1});if(u.__dataIndex=e,u.name="item",a){var c=u.shape,h=n?"height":"width";c[h]=0}return u},polar:function(r,t,e,i,n,a,s,o,l){var u=!n&&l?yw:fs,c=new u({shape:i,z2:1});c.name="item";var h=Tj(n);if(c.calculateTextPosition=STt(h,{isRoundCap:u===yw}),a){var p=c.shape,v=n?"r":"endAngle",y={};p[v]=n?i.r0:i.startAngle,y[v]=i[v],(o?zr:Ei)(c,{shape:y},a)}return c}};function ETt(r,t){var e=r.get("realtimeSort",!0),i=t.getBaseAxis();if(e&&i.type==="category"&&t.type==="cartesian2d")return{baseAxis:i,otherAxis:t.getOtherAxis(i)}}function U5(r,t,e,i,n,a,s,o){var l,u;a?(u={x:i.x,width:i.width},l={y:i.y,height:i.height}):(u={y:i.y,height:i.height},l={x:i.x,width:i.width}),o||(s?zr:Ei)(e,{shape:l},t,n,null);var c=t?r.baseAxis.model:null;(s?zr:Ei)(e,{shape:u},c,n)}function $5(r,t){for(var e=0;e<t.length;e++)if(!isFinite(r[t[e]]))return!0;return!1}var ITt=["x","y","width","height"],MTt=["cx","cy","r","startAngle","endAngle"],W5={cartesian2d:function(r){return!$5(r,ITt)},polar:function(r){return!$5(r,MTt)}},h1={cartesian2d:function(r,t,e){var i=r.getItemLayout(t),n=e?RTt(e,i):0,a=i.width>0?1:-1,s=i.height>0?1:-1;return{x:i.x+a*n/2,y:i.y+s*n/2,width:i.width-a*n,height:i.height-s*n}},polar:function(r,t,e){var i=r.getItemLayout(t);return{cx:i.cx,cy:i.cy,r0:i.r0,r:i.r,startAngle:i.startAngle,endAngle:i.endAngle,clockwise:i.clockwise}}};function PTt(r){return r.startAngle!=null&&r.endAngle!=null&&r.startAngle===r.endAngle}function Tj(r){return function(t){var e=t?"Arc":"Angle";return function(i){switch(i){case"start":case"insideStart":case"end":case"insideEnd":return i+e;default:return i}}}(r)}function H5(r,t,e,i,n,a,s,o){var l=t.getItemVisual(e,"style");if(o){if(!a.get("roundCap")){var c=r.shape,h=xf(i.getModel("itemStyle"),c,!0);Zt(c,h),r.setShape(c)}}else{var u=i.get(["itemStyle","borderRadius"])||0;r.setShape("r",u)}r.useStyle(l);var p=i.getShallow("cursor");p&&r.attr("cursor",p);var v=o?s?n.r>=n.r0?"endArc":"startArc":n.endAngle>=n.startAngle?"endAngle":"startAngle":s?n.height>=0?"bottom":"top":n.width>=0?"right":"left",y=Dn(i);ra(r,y,{labelFetcher:a,labelDataIndex:e,defaultText:mg(a.getData(),e),inheritColor:l.fill,defaultOpacity:l.opacity,defaultOutsidePosition:v});var x=r.getTextContent();if(o&&x){var w=i.get(["label","position"]);r.textConfig.inside=w==="middle"?!0:null,TTt(r,w==="outside"?v:w,Tj(s),i.get(["label","rotate"]))}N7(x,y,a.getRawValue(e),function(E){return pj(t,E)});var T=i.getModel(["emphasis"]);Ui(r,T.get("focus"),T.get("blurScope"),T.get("disabled")),ea(r,i),PTt(n)&&(r.style.fill="none",r.style.stroke="none",J(r.states,function(E){E.style&&(E.style.fill=E.style.stroke="none")}))}function RTt(r,t){var e=r.get(["itemStyle","borderColor"]);if(!e||e==="none")return 0;var i=r.get(["itemStyle","borderWidth"])||0,n=isNaN(t.width)?Number.MAX_VALUE:Math.abs(t.width),a=isNaN(t.height)?Number.MAX_VALUE:Math.abs(t.height);return Math.min(i,n,a)}var DTt=function(){function r(){}return r}(),G5=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i.type="largeBar",i}return t.prototype.getDefaultShape=function(){return new DTt},t.prototype.buildPath=function(e,i){for(var n=i.points,a=this.baseDimIdx,s=1-this.baseDimIdx,o=[],l=[],u=this.barWidth,c=0;c<n.length;c+=3)l[a]=u,l[s]=n[c+2],o[a]=n[c+a],o[s]=n[c+s],e.rect(o[0],o[1],l[0],l[1])},t}(vr);function j5(r,t,e,i){var n=r.getData(),a=n.getLayout("valueAxisHorizontal")?1:0,s=n.getLayout("largeDataIndices"),o=n.getLayout("size"),l=r.getModel("backgroundStyle"),u=n.getLayout("largeBackgroundPoints");if(u){var c=new G5({shape:{points:u},incremental:!!i,silent:!0,z2:0});c.baseDimIdx=a,c.largeDataIndices=s,c.barWidth=o,c.useStyle(l.getItemStyle()),t.add(c),e&&e.push(c)}var h=new G5({shape:{points:n.getLayout("largePoints")},incremental:!!i,ignoreCoarsePointer:!0,z2:1});h.baseDimIdx=a,h.largeDataIndices=s,h.barWidth=o,t.add(h),h.useStyle(n.getVisual("style")),Je(h).seriesIndex=r.seriesIndex,r.get("silent")||(h.on("mousedown",X5),h.on("mousemove",X5)),e&&e.push(h)}var X5=yD(function(r){var t=this,e=LTt(t,r.offsetX,r.offsetY);Je(t).dataIndex=e>=0?e:null},30,!1);function LTt(r,t,e){for(var i=r.baseDimIdx,n=1-i,a=r.shape.points,s=r.largeDataIndices,o=[],l=[],u=r.barWidth,c=0,h=a.length/3;c<h;c++){var p=c*3;if(l[i]=u,l[n]=a[p+2],o[i]=a[p+i],o[n]=a[p+n],l[n]<0&&(o[n]+=l[n],l[n]=-l[n]),t>=o[0]&&t<=o[0]+l[0]&&e>=o[1]&&e<=o[1]+l[1])return s[c]}return-1}function Aj(r,t,e){if(ad(e,"cartesian2d")){var i=t,n=e.getArea();return{x:r?i.x:n.x,y:r?n.y:i.y,width:r?i.width:n.width,height:r?n.height:i.height}}else{var n=e.getArea(),a=t;return{cx:n.cx,cy:n.cy,r0:r?n.r0:a.r0,r:r?n.r:a.r,startAngle:r?a.startAngle:0,endAngle:r?a.endAngle:Math.PI*2}}}function kTt(r,t,e){var i=r.type==="polar"?fs:Pr;return new i({shape:Aj(t,e,r),silent:!0,z2:0})}const OTt=CTt;function NTt(r){r.registerChartView(OTt),r.registerSeriesModel(xTt),r.registerLayout(r.PRIORITY.VISUAL.LAYOUT,nr(EG,"bar")),r.registerLayout(r.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,IG("bar")),r.registerProcessor(r.PRIORITY.PROCESSOR.STATISTIC,wj("bar")),r.registerAction({type:"changeAxisOrder",event:"changeAxisOrder",update:"update"},function(t,e){var i=t.componentType||"series";e.eachComponent({mainType:i,query:t},function(n){t.sortInfo&&n.axis.setCategorySortInfo(t.sortInfo)})})}var Z5=Math.PI*2,f1=Math.PI/180;function Cj(r,t){return bn(r.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function Ej(r,t){var e=Cj(r,t),i=r.get("center"),n=r.get("radius");Kt(n)||(n=[0,n]);var a=he(e.width,t.getWidth()),s=he(e.height,t.getHeight()),o=Math.min(a,s),l=he(n[0],o/2),u=he(n[1],o/2),c,h,p=r.coordinateSystem;if(p){var v=p.dataToPoint(i);c=v[0]||0,h=v[1]||0}else Kt(i)||(i=[i,i]),c=he(i[0],a)+e.x,h=he(i[1],s)+e.y;return{cx:c,cy:h,r0:l,r:u}}function FTt(r,t,e){t.eachSeriesByType(r,function(i){var n=i.getData(),a=n.mapDimension("value"),s=Cj(i,e),o=Ej(i,e),l=o.cx,u=o.cy,c=o.r,h=o.r0,p=-i.get("startAngle")*f1,v=i.get("endAngle"),y=i.get("padAngle")*f1;v=v==="auto"?p-Z5:-v*f1;var x=i.get("minAngle")*f1,w=x+y,T=0;n.each(a,function(Ot){!isNaN(Ot)&&T++});var E=n.getSum(a),M=Math.PI/(E||T)*2,L=i.get("clockwise"),F=i.get("roseType"),O=i.get("stillShowZeroSum"),U=n.getDataExtent(a);U[0]=0;var W=L?1:-1,H=[p,v],j=W*y/2;HR(H,!L),p=H[0],v=H[1];var Y=Ij(i);Y.startAngle=p,Y.endAngle=v,Y.clockwise=L;var tt=Math.abs(v-p),it=tt,lt=0,ht=p;if(n.setLayout({viewRect:s,r:c}),n.each(a,function(Ot,Rt){var Ut;if(isNaN(Ot)){n.setItemLayout(Rt,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:L,cx:l,cy:u,r0:h,r:F?NaN:c});return}F!=="area"?Ut=E===0&&O?M:Ot*M:Ut=tt/T,Ut<w?(Ut=w,it-=w):lt+=Ot;var Jt=ht+W*Ut,ne=0,se=0;y>Ut?(ne=ht+W*Ut/2,se=ne):(ne=ht+j,se=Jt-j),n.setItemLayout(Rt,{angle:Ut,startAngle:ne,endAngle:se,clockwise:L,cx:l,cy:u,r0:h,r:F?Jr(Ot,U,[h,c]):c}),ht=Jt}),it<Z5&&T)if(it<=.001){var Tt=tt/T;n.each(a,function(Ot,Rt){if(!isNaN(Ot)){var Ut=n.getItemLayout(Rt);Ut.angle=Tt;var Jt=0,ne=0;Tt<y?(Jt=p+W*(Rt+1/2)*Tt,ne=Jt):(Jt=p+W*Rt*Tt+j,ne=p+W*(Rt+1)*Tt-j),Ut.startAngle=Jt,Ut.endAngle=ne}})}else M=it/lt,ht=p,n.each(a,function(Ot,Rt){if(!isNaN(Ot)){var Ut=n.getItemLayout(Rt),Jt=Ut.angle===w?w:Ot*M,ne=0,se=0;Jt<y?(ne=ht+W*Jt/2,se=ne):(ne=ht+j,se=ht+W*Jt-j),Ut.startAngle=ne,Ut.endAngle=se,ht+=W*Jt}})})}var Ij=Ir();function V_(r){return{seriesType:r,reset:function(t,e){var i=e.findComponents({mainType:"legend"});if(!(!i||!i.length)){var n=t.getData();n.filterSelf(function(a){for(var s=n.getName(a),o=0;o<i.length;o++)if(!i[o].isSelected(s))return!1;return!0})}}}}var BTt=Math.PI/180;function q5(r,t,e,i,n,a,s,o,l,u){if(r.length<2)return;function c(x){for(var w=x.rB,T=w*w,E=0;E<x.list.length;E++){var M=x.list[E],L=Math.abs(M.label.y-e),F=i+M.len,O=F*F,U=Math.sqrt((1-Math.abs(L*L/T))*O),W=t+(U+M.len2)*n,H=W-M.label.x,j=M.targetTextWidth-H*n;Mj(M,j,!0),M.label.x=W}}function h(x){for(var w={list:[],maxY:0},T={list:[],maxY:0},E=0;E<x.length;E++)if(x[E].labelAlignTo==="none"){var M=x[E],L=M.label.y>e?T:w,F=Math.abs(M.label.y-e);if(F>=L.maxY){var O=M.label.x-t-M.len2*n,U=i+M.len,W=Math.abs(O)<U?Math.sqrt(F*F/(1-O*O/U/U)):U;L.rB=W,L.maxY=F}L.list.push(M)}c(w),c(T)}for(var p=r.length,v=0;v<p;v++)if(r[v].position==="outer"&&r[v].labelAlignTo==="labelLine"){var y=r[v].label.x-u;r[v].linePoints[1][0]+=y,r[v].label.x=u}KG(r,l,l+s)&&h(r)}function zTt(r,t,e,i,n,a,s,o){for(var l=[],u=[],c=Number.MAX_VALUE,h=-Number.MAX_VALUE,p=0;p<r.length;p++){var v=r[p].label;vC(r[p])||(v.x<t?(c=Math.min(c,v.x),l.push(r[p])):(h=Math.max(h,v.x),u.push(r[p])))}for(var p=0;p<r.length;p++){var y=r[p];if(!vC(y)&&y.linePoints){if(y.labelStyleWidth!=null)continue;var v=y.label,x=y.linePoints,w=void 0;y.labelAlignTo==="edge"?v.x<t?w=x[2][0]-y.labelDistance-s-y.edgeDistance:w=s+n-y.edgeDistance-x[2][0]-y.labelDistance:y.labelAlignTo==="labelLine"?v.x<t?w=c-s-y.bleedMargin:w=s+n-h-y.bleedMargin:v.x<t?w=v.x-s-y.bleedMargin:w=s+n-v.x-y.bleedMargin,y.targetTextWidth=w,Mj(y,w)}}q5(u,t,e,i,1,n,a,s,o,h),q5(l,t,e,i,-1,n,a,s,o,c);for(var p=0;p<r.length;p++){var y=r[p];if(!vC(y)&&y.linePoints){var v=y.label,x=y.linePoints,T=y.labelAlignTo==="edge",E=v.style.padding,M=E?E[1]+E[3]:0,L=v.style.backgroundColor?0:M,F=y.rect.width+L,O=x[1][0]-x[2][0];T?v.x<t?x[2][0]=s+y.edgeDistance+F+y.labelDistance:x[2][0]=s+n-y.edgeDistance-F-y.labelDistance:(v.x<t?x[2][0]=v.x+y.labelDistance:x[2][0]=v.x-y.labelDistance,x[1][0]=x[2][0]+O),x[1][1]=x[2][1]=v.y}}}function Mj(r,t,e){if(e===void 0&&(e=!1),r.labelStyleWidth==null){var i=r.label,n=i.style,a=r.rect,s=n.backgroundColor,o=n.padding,l=o?o[1]+o[3]:0,u=n.overflow,c=a.width+(s?0:l);if(t<c||e){var h=a.height;if(u&&u.match("break")){i.setStyle("backgroundColor",null),i.setStyle("width",t-l);var p=i.getBoundingRect();i.setStyle("width",Math.ceil(p.width)),i.setStyle("backgroundColor",s)}else{var v=t-l,y=t<c?v:e?v>r.unconstrainedWidth?null:v:null;i.setStyle("width",y)}var x=i.getBoundingRect();a.width=x.width;var w=(i.style.margin||0)+2.1;a.height=x.height+w,a.y-=(a.height-h)/2}}}function vC(r){return r.position==="center"}function VTt(r){var t=r.getData(),e=[],i,n,a=!1,s=(r.get("minShowLabelAngle")||0)*BTt,o=t.getLayout("viewRect"),l=t.getLayout("r"),u=o.width,c=o.x,h=o.y,p=o.height;function v(O){O.ignore=!0}function y(O){if(!O.ignore)return!0;for(var U in O.states)if(O.states[U].ignore===!1)return!0;return!1}t.each(function(O){var U=t.getItemGraphicEl(O),W=U.shape,H=U.getTextContent(),j=U.getTextGuideLine(),Y=t.getItemModel(O),tt=Y.getModel("label"),it=tt.get("position")||Y.get(["emphasis","label","position"]),lt=tt.get("distanceToLabelLine"),ht=tt.get("alignTo"),Tt=he(tt.get("edgeDistance"),u),Ot=tt.get("bleedMargin"),Rt=Y.getModel("labelLine"),Ut=Rt.get("length");Ut=he(Ut,u);var Jt=Rt.get("length2");if(Jt=he(Jt,u),Math.abs(W.endAngle-W.startAngle)<s){J(H.states,v),H.ignore=!0,j&&(J(j.states,v),j.ignore=!0);return}if(y(H)){var ne=(W.startAngle+W.endAngle)/2,se=Math.cos(ne),ce=Math.sin(ne),ye,Qe,sr,ke;i=W.cx,n=W.cy;var Ce=it==="inside"||it==="inner";if(it==="center")ye=W.cx,Qe=W.cy,ke="center";else{var Ee=(Ce?(W.r+W.r0)/2*se:W.r*se)+i,Ie=(Ce?(W.r+W.r0)/2*ce:W.r*ce)+n;if(ye=Ee+se*3,Qe=Ie+ce*3,!Ce){var Se=Ee+se*(Ut+l-W.r),Fe=Ie+ce*(Ut+l-W.r),Rr=Se+(se<0?-1:1)*Jt,tr=Fe;ht==="edge"?ye=se<0?c+Tt:c+u-Tt:ye=Rr+(se<0?-lt:lt),Qe=tr,sr=[[Ee,Ie],[Se,Fe],[Rr,tr]]}ke=Ce?"center":ht==="edge"?se>0?"right":"left":se>0?"left":"right"}var Vr=Math.PI,_r=0,Xr=tt.get("rotate");if(Fr(Xr))_r=Xr*(Vr/180);else if(it==="center")_r=0;else if(Xr==="radial"||Xr===!0){var Hi=se<0?-ne+Vr:-ne;_r=Hi}else if(Xr==="tangential"&&it!=="outside"&&it!=="outer"){var wi=Math.atan2(se,ce);wi<0&&(wi=Vr*2+wi);var qt=ce>0;qt&&(wi=Vr+wi),_r=wi-Vr}if(a=!!_r,H.x=ye,H.y=Qe,H.rotation=_r,H.setStyle({verticalAlign:"middle"}),Ce){H.setStyle({align:ke});var Gr=H.states.select;Gr&&(Gr.x+=H.x,Gr.y+=H.y)}else{var Ur=H.getBoundingRect().clone();Ur.applyTransform(H.getComputedTransform());var wn=(H.style.margin||0)+2.1;Ur.y-=wn/2,Ur.height+=wn,e.push({label:H,labelLine:j,position:it,len:Ut,len2:Jt,minTurnAngle:Rt.get("minTurnAngle"),maxSurfaceAngle:Rt.get("maxSurfaceAngle"),surfaceNormal:new lr(se,ce),linePoints:sr,textAlign:ke,labelDistance:lt,labelAlignTo:ht,edgeDistance:Tt,bleedMargin:Ot,rect:Ur,unconstrainedWidth:Ur.width,labelStyleWidth:H.style.width})}U.setTextConfig({inside:Ce})}}),!a&&r.get("avoidLabelOverlap")&&zTt(e,i,n,l,u,p,c,h);for(var x=0;x<e.length;x++){var w=e[x],T=w.label,E=w.labelLine,M=isNaN(T.x)||isNaN(T.y);if(T){T.setStyle({align:w.textAlign}),M&&(J(T.states,v),T.ignore=!0);var L=T.states.select;L&&(L.x+=T.x,L.y+=T.y)}if(E){var F=w.linePoints;M||!F?(J(E.states,v),E.ignore=!0):(ZG(F,w.minTurnAngle),Kwt(F,w.surfaceNormal,w.maxSurfaceAngle),E.setShape({points:F}),T.__hostTarget.textGuideLineConfig={anchor:new lr(F[0][0],F[0][1])})}}}var UTt=function(r){Vt(t,r);function t(e,i,n){var a=r.call(this)||this;a.z2=2;var s=new Nr;return a.setTextContent(s),a.updateData(e,i,n,!0),a}return t.prototype.updateData=function(e,i,n,a){var s=this,o=e.hostModel,l=e.getItemModel(i),u=l.getModel("emphasis"),c=e.getItemLayout(i),h=Zt(xf(l.getModel("itemStyle"),c,!0),c);if(isNaN(h.startAngle)){s.setShape(h);return}if(a){s.setShape(h);var p=o.getShallow("animationType");o.ecModel.ssr?(Ei(s,{scaleX:0,scaleY:0},o,{dataIndex:i,isFrom:!0}),s.originX=h.cx,s.originY=h.cy):p==="scale"?(s.shape.r=c.r0,Ei(s,{shape:{r:c.r}},o,i)):n!=null?(s.setShape({startAngle:n,endAngle:n}),Ei(s,{shape:{startAngle:c.startAngle,endAngle:c.endAngle}},o,i)):(s.shape.endAngle=c.startAngle,zr(s,{shape:{endAngle:c.endAngle}},o,i))}else Vo(s),zr(s,{shape:h},o,i);s.useStyle(e.getItemVisual(i,"style")),ea(s,l);var v=(c.startAngle+c.endAngle)/2,y=o.get("selectedOffset"),x=Math.cos(v)*y,w=Math.sin(v)*y,T=l.getShallow("cursor");T&&s.attr("cursor",T),this._updateLabel(o,e,i),s.ensureState("emphasis").shape=Zt({r:c.r+(u.get("scale")&&u.get("scaleSize")||0)},xf(u.getModel("itemStyle"),c)),Zt(s.ensureState("select"),{x,y:w,shape:xf(l.getModel(["select","itemStyle"]),c)}),Zt(s.ensureState("blur"),{shape:xf(l.getModel(["blur","itemStyle"]),c)});var E=s.getTextGuideLine(),M=s.getTextContent();E&&Zt(E.ensureState("select"),{x,y:w}),Zt(M.ensureState("select"),{x,y:w}),Ui(this,u.get("focus"),u.get("blurScope"),u.get("disabled"))},t.prototype._updateLabel=function(e,i,n){var a=this,s=i.getItemModel(n),o=s.getModel("labelLine"),l=i.getItemVisual(n,"style"),u=l&&l.fill,c=l&&l.opacity;ra(a,Dn(s),{labelFetcher:i.hostModel,labelDataIndex:n,inheritColor:u,defaultOpacity:c,defaultText:e.getFormattedLabel(n,"normal")||i.getName(n)});var h=a.getTextContent();a.setTextConfig({position:null,rotation:null}),h.attr({z2:10});var p=e.get(["label","position"]);if(p!=="outside"&&p!=="outer")a.removeTextGuideLine();else{var v=this.getTextGuideLine();v||(v=new ps,this.setTextGuideLine(v)),DD(this,LD(s),{stroke:u,opacity:_l(o.get(["lineStyle","opacity"]),c,1)})}},t}(fs),$Tt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.ignoreLabelLineUpdate=!0,e}return t.prototype.render=function(e,i,n,a){var s=e.getData(),o=this._data,l=this.group,u;if(!o&&s.count()>0){for(var c=s.getItemLayout(0),h=1;isNaN(c&&c.startAngle)&&h<s.count();++h)c=s.getItemLayout(h);c&&(u=c.startAngle)}if(this._emptyCircleSector&&l.remove(this._emptyCircleSector),s.count()===0&&e.get("showEmptyCircle")){var p=Ij(e),v=new fs({shape:Zt(Ej(e,n),p)});v.useStyle(e.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=v,l.add(v)}s.diff(o).add(function(y){var x=new UTt(s,y,u);s.setItemGraphicEl(y,x),l.add(x)}).update(function(y,x){var w=o.getItemGraphicEl(x);w.updateData(s,y,u),w.off("click"),l.add(w),s.setItemGraphicEl(y,w)}).remove(function(y){var x=o.getItemGraphicEl(y);Zy(x,e,y)}).execute(),VTt(e),e.get("animationTypeUpdate")!=="expansion"&&(this._data=s)},t.prototype.dispose=function(){},t.prototype.containPoint=function(e,i){var n=i.getData(),a=n.getItemLayout(0);if(a){var s=e[0]-a.cx,o=e[1]-a.cy,l=Math.sqrt(s*s+o*o);return l<=a.r&&l>=a.r0}},t.type="pie",t}(di);const WTt=$Tt;function Hg(r,t,e){t=Kt(t)&&{coordDimensions:t}||Zt({encodeDefine:r.getEncode()},t);var i=r.getSource(),n=k_(i,t).dimensions,a=new Xa(n,r);return a.initData(i,e),a}var HTt=function(){function r(t,e){this._getDataWithEncodedVisual=t,this._getRawData=e}return r.prototype.getAllNames=function(){var t=this._getRawData();return t.mapArray(t.getName)},r.prototype.containName=function(t){var e=this._getRawData();return e.indexOfName(t)>=0},r.prototype.indexOfName=function(t){var e=this._getDataWithEncodedVisual();return e.indexOfName(t)},r.prototype.getItemVisual=function(t,e){var i=this._getDataWithEncodedVisual();return i.getItemVisual(t,e)},r}();const U_=HTt;var GTt=Ir(),jTt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.init=function(e){r.prototype.init.apply(this,arguments),this.legendVisualProvider=new U_(we(this.getData,this),we(this.getRawData,this)),this._defaultLabelLine(e)},t.prototype.mergeOption=function(){r.prototype.mergeOption.apply(this,arguments)},t.prototype.getInitialData=function(){return Hg(this,{coordDimensions:["value"],encodeDefaulter:nr(uD,this)})},t.prototype.getDataParams=function(e){var i=this.getData(),n=GTt(i),a=n.seats;if(!a){var s=[];i.each(i.mapDimension("value"),function(l){s.push(l)}),a=n.seats=tyt(s,i.hostModel.get("percentPrecision"))}var o=r.prototype.getDataParams.call(this,e);return o.percent=a[e]||0,o.$vars.push("percent"),o},t.prototype._defaultLabelLine=function(e){$f(e,"labelLine",["show"]);var i=e.labelLine,n=e.emphasis.labelLine;i.show=i.show&&e.label.show,n.show=n.show&&e.emphasis.label.show},t.type="series.pie",t.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,endAngle:"auto",padAngle:0,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},t}(Li);const XTt=jTt;function ZTt(r){return{seriesType:r,reset:function(t,e){var i=t.getData();i.filterSelf(function(n){var a=i.mapDimension("value"),s=i.get(a,n);return!(Fr(s)&&!isNaN(s)&&s<0)})}}}function qTt(r){r.registerChartView(WTt),r.registerSeriesModel(XTt),H9("pie",r.registerAction),r.registerLayout(nr(FTt,"pie")),r.registerProcessor(V_("pie")),r.registerProcessor(ZTt("pie"))}var YTt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.getInitialData=function(e,i){return Su(null,this,{useEncodeDefaulter:!0})},t.prototype.getProgressive=function(){var e=this.option.progressive;return e??(this.option.large?5e3:this.get("progressive"))},t.prototype.getProgressiveThreshold=function(){var e=this.option.progressiveThreshold;return e??(this.option.large?1e4:this.get("progressiveThreshold"))},t.prototype.brushSelector=function(e,i,n){return n.point(i.getItemLayout(e))},t.prototype.getZLevelKey=function(){return this.getData().count()>this.getProgressiveThreshold()?this.id:""},t.type="series.scatter",t.dependencies=["grid","polar","geo","singleAxis","calendar"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,symbolSize:10,large:!1,largeThreshold:2e3,itemStyle:{opacity:.8},emphasis:{scale:!0},clip:!0,select:{itemStyle:{borderColor:"#212121"}},universalTransition:{divideShape:"clone"}},t}(Li);const KTt=YTt;var Pj=4,JTt=function(){function r(){}return r}(),QTt=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i._off=0,i.hoverDataIdx=-1,i}return t.prototype.getDefaultShape=function(){return new JTt},t.prototype.reset=function(){this.notClear=!1,this._off=0},t.prototype.buildPath=function(e,i){var n=i.points,a=i.size,s=this.symbolProxy,o=s.shape,l=e.getContext?e.getContext():e,u=l&&a[0]<Pj,c=this.softClipShape,h;if(u){this._ctx=l;return}for(this._ctx=null,h=this._off;h<n.length;){var p=n[h++],v=n[h++];isNaN(p)||isNaN(v)||c&&!c.contain(p,v)||(o.x=p-a[0]/2,o.y=v-a[1]/2,o.width=a[0],o.height=a[1],s.buildPath(e,o,!0))}this.incremental&&(this._off=h,this.notClear=!0)},t.prototype.afterBrush=function(){var e=this.shape,i=e.points,n=e.size,a=this._ctx,s=this.softClipShape,o;if(a){for(o=this._off;o<i.length;){var l=i[o++],u=i[o++];isNaN(l)||isNaN(u)||s&&!s.contain(l,u)||a.fillRect(l-n[0]/2,u-n[1]/2,n[0],n[1])}this.incremental&&(this._off=o,this.notClear=!0)}},t.prototype.findDataIndex=function(e,i){for(var n=this.shape,a=n.points,s=n.size,o=Math.max(s[0],4),l=Math.max(s[1],4),u=a.length/2-1;u>=0;u--){var c=u*2,h=a[c]-o/2,p=a[c+1]-l/2;if(e>=h&&i>=p&&e<=h+o&&i<=p+l)return u}return-1},t.prototype.contain=function(e,i){var n=this.transformCoordToLocal(e,i),a=this.getBoundingRect();if(e=n[0],i=n[1],a.contain(e,i)){var s=this.hoverDataIdx=this.findDataIndex(e,i);return s>=0}return this.hoverDataIdx=-1,!1},t.prototype.getBoundingRect=function(){var e=this._rect;if(!e){for(var i=this.shape,n=i.points,a=i.size,s=a[0],o=a[1],l=1/0,u=1/0,c=-1/0,h=-1/0,p=0;p<n.length;){var v=n[p++],y=n[p++];l=Math.min(v,l),c=Math.max(v,c),u=Math.min(y,u),h=Math.max(y,h)}e=this._rect=new hr(l-s/2,u-o/2,c-l+s,h-u+o)}return e},t}(vr),tAt=function(){function r(){this.group=new Ke}return r.prototype.updateData=function(t,e){this._clear();var i=this._create();i.setShape({points:t.getLayout("points")}),this._setCommon(i,t,e)},r.prototype.updateLayout=function(t){var e=t.getLayout("points");this.group.eachChild(function(i){if(i.startIndex!=null){var n=(i.endIndex-i.startIndex)*2,a=i.startIndex*4*2;e=new Float32Array(e.buffer,a,n)}i.setShape("points",e),i.reset()})},r.prototype.incrementalPrepareUpdate=function(t){this._clear()},r.prototype.incrementalUpdate=function(t,e,i){var n=this._newAdded[0],a=e.getLayout("points"),s=n&&n.shape.points;if(s&&s.length<2e4){var o=s.length,l=new Float32Array(o+a.length);l.set(s),l.set(a,o),n.endIndex=t.end,n.setShape({points:l})}else{this._newAdded=[];var u=this._create();u.startIndex=t.start,u.endIndex=t.end,u.incremental=!0,u.setShape({points:a}),this._setCommon(u,e,i)}},r.prototype.eachRendered=function(t){this._newAdded[0]&&t(this._newAdded[0])},r.prototype._create=function(){var t=new QTt({cursor:"default"});return t.ignoreCoarsePointer=!0,this.group.add(t),this._newAdded.push(t),t},r.prototype._setCommon=function(t,e,i){var n=e.hostModel;i=i||{};var a=e.getVisual("symbolSize");t.setShape("size",a instanceof Array?a:[a,a]),t.softClipShape=i.clipShape||null,t.symbolProxy=mn(e.getVisual("symbol"),0,0,0,0),t.setColor=t.symbolProxy.setColor;var s=t.shape.size[0]<Pj;t.useStyle(n.getModel("itemStyle").getItemStyle(s?["color","shadowBlur","shadowColor"]:["color"]));var o=e.getVisual("style"),l=o&&o.fill;l&&t.setColor(l);var u=Je(t);u.seriesIndex=n.seriesIndex,t.on("mousemove",function(c){u.dataIndex=null;var h=t.hoverDataIdx;h>=0&&(u.dataIndex=h+(t.startIndex||0))})},r.prototype.remove=function(){this._clear()},r.prototype._clear=function(){this._newAdded=[],this.group.removeAll()},r}();const eAt=tAt;var rAt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){var a=e.getData(),s=this._updateSymbolDraw(a,e);s.updateData(a,{clipShape:this._getClipShape(e)}),this._finished=!0},t.prototype.incrementalPrepareRender=function(e,i,n){var a=e.getData(),s=this._updateSymbolDraw(a,e);s.incrementalPrepareUpdate(a),this._finished=!1},t.prototype.incrementalRender=function(e,i,n){this._symbolDraw.incrementalUpdate(e,i.getData(),{clipShape:this._getClipShape(i)}),this._finished=e.end===i.getData().count()},t.prototype.updateTransform=function(e,i,n){var a=e.getData();if(this.group.dirty(),!this._finished||a.count()>1e4)return{update:!0};var s=z_("").reset(e,i,n);s.progress&&s.progress({start:0,end:a.count(),count:a.count()},a),this._symbolDraw.updateLayout(a)},t.prototype.eachRendered=function(e){this._symbolDraw&&this._symbolDraw.eachRendered(e)},t.prototype._getClipShape=function(e){if(e.get("clip",!0)){var i=e.coordinateSystem;return i&&i.getArea&&i.getArea(.1)}},t.prototype._updateSymbolDraw=function(e,i){var n=this._symbolDraw,a=i.pipelineContext,s=a.large;return(!n||s!==this._isLargeDraw)&&(n&&n.remove(),n=this._symbolDraw=s?new eAt:new F_,this._isLargeDraw=s,this.group.removeAll()),this.group.add(n.group),n},t.prototype.remove=function(e,i){this._symbolDraw&&this._symbolDraw.remove(!0),this._symbolDraw=null},t.prototype.dispose=function(){},t.type="scatter",t}(di);const iAt=rAt;var nAt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.type="grid",t.dependencies=["xAxis","yAxis"],t.layoutMode="box",t.defaultOption={show:!1,z:0,left:"10%",top:60,right:"10%",bottom:70,containLabel:!1,backgroundColor:"rgba(0,0,0,0)",borderWidth:1,borderColor:"#ccc"},t}(kr);const aAt=nAt;var LM=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getCoordSysModel=function(){return this.getReferringComponents("grid",vn).models[0]},t.type="cartesian2dAxis",t}(kr);yn(LM,O_);var Rj={show:!0,z:0,inverse:!1,name:"",nameLocation:"end",nameRotate:null,nameTruncate:{maxWidth:null,ellipsis:"...",placeholder:"."},nameTextStyle:{},nameGap:15,silent:!1,triggerEvent:!1,tooltip:{show:!1},axisPointer:{},axisLine:{show:!0,onZero:!0,onZeroAxisIndex:null,lineStyle:{color:"#6E7079",width:1,type:"solid"},symbol:["none","none"],symbolSize:[10,15]},axisTick:{show:!0,inside:!1,length:5,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,showMinLabel:null,showMaxLabel:null,margin:8,fontSize:12},splitLine:{show:!0,lineStyle:{color:["#E0E6F1"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(210,219,238,0.2)"]}}},sAt=cr({boundaryGap:!0,deduplication:null,splitLine:{show:!1},axisTick:{alignWithLabel:!1,interval:"auto"},axisLabel:{interval:"auto"}},Rj),zD=cr({boundaryGap:[0,0],axisLine:{show:"auto"},axisTick:{show:"auto"},splitNumber:5,minorTick:{show:!1,splitNumber:5,length:3,lineStyle:{}},minorSplitLine:{show:!1,lineStyle:{color:"#F4F7FD",width:1}}},Rj),oAt=cr({splitNumber:6,axisLabel:{showMinLabel:!1,showMaxLabel:!1,rich:{primary:{fontWeight:"bold"}}},splitLine:{show:!1}},zD),lAt=We({logBase:10},zD);const Dj={category:sAt,value:zD,time:oAt,log:lAt};var uAt={value:1,category:1,time:1,log:1};function yg(r,t,e,i){J(uAt,function(n,a){var s=cr(cr({},Dj[a],!0),i,!0),o=function(l){Vt(u,l);function u(){var c=l!==null&&l.apply(this,arguments)||this;return c.type=t+"Axis."+a,c}return u.prototype.mergeDefaultAndTheme=function(c,h){var p=Yy(this),v=p?Fg(c):{},y=h.getTheme();cr(c,y.get(a+"Axis")),cr(c,this.getDefaultOption()),c.type=Y5(c),p&&Wc(c,v,p)},u.prototype.optionUpdated=function(){var c=this.option;c.type==="category"&&(this.__ordinalMeta=CM.createByAxisModel(this))},u.prototype.getCategories=function(c){var h=this.option;if(h.type==="category")return c?h.data:this.__ordinalMeta.categories},u.prototype.getOrdinalMeta=function(){return this.__ordinalMeta},u.type=t+"Axis."+a,u.defaultOption=s,u}(e);r.registerComponentModel(o)}),r.registerSubTypeDefaulter(t+"Axis",Y5)}function Y5(r){return r.type||(r.data?"category":"value")}var cAt=function(){function r(t){this.type="cartesian",this._dimList=[],this._axes={},this.name=t||""}return r.prototype.getAxis=function(t){return this._axes[t]},r.prototype.getAxes=function(){return te(this._dimList,function(t){return this._axes[t]},this)},r.prototype.getAxesByScale=function(t){return t=t.toLowerCase(),ti(this.getAxes(),function(e){return e.scale.type===t})},r.prototype.addAxis=function(t){var e=t.dim;this._axes[e]=t,this._dimList.push(e)},r}();const hAt=cAt;var kM=["x","y"];function K5(r){return r.type==="interval"||r.type==="time"}var fAt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="cartesian2d",e.dimensions=kM,e}return t.prototype.calcAffineTransform=function(){this._transform=this._invTransform=null;var e=this.getAxis("x").scale,i=this.getAxis("y").scale;if(!(!K5(e)||!K5(i))){var n=e.getExtent(),a=i.getExtent(),s=this.dataToPoint([n[0],a[0]]),o=this.dataToPoint([n[1],a[1]]),l=n[1]-n[0],u=a[1]-a[0];if(!(!l||!u)){var c=(o[0]-s[0])/l,h=(o[1]-s[1])/u,p=s[0]-n[0]*c,v=s[1]-a[0]*h,y=this._transform=[c,0,0,h,p,v];this._invTransform=Mg([],y)}}},t.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAxis("x")},t.prototype.containPoint=function(e){var i=this.getAxis("x"),n=this.getAxis("y");return i.contain(i.toLocalCoord(e[0]))&&n.contain(n.toLocalCoord(e[1]))},t.prototype.containData=function(e){return this.getAxis("x").containData(e[0])&&this.getAxis("y").containData(e[1])},t.prototype.containZone=function(e,i){var n=this.dataToPoint(e),a=this.dataToPoint(i),s=this.getArea(),o=new hr(n[0],n[1],a[0]-n[0],a[1]-n[1]);return s.intersect(o)},t.prototype.dataToPoint=function(e,i,n){n=n||[];var a=e[0],s=e[1];if(this._transform&&a!=null&&isFinite(a)&&s!=null&&isFinite(s))return Qn(n,e,this._transform);var o=this.getAxis("x"),l=this.getAxis("y");return n[0]=o.toGlobalCoord(o.dataToCoord(a,i)),n[1]=l.toGlobalCoord(l.dataToCoord(s,i)),n},t.prototype.clampData=function(e,i){var n=this.getAxis("x").scale,a=this.getAxis("y").scale,s=n.getExtent(),o=a.getExtent(),l=n.parse(e[0]),u=a.parse(e[1]);return i=i||[],i[0]=Math.min(Math.max(Math.min(s[0],s[1]),l),Math.max(s[0],s[1])),i[1]=Math.min(Math.max(Math.min(o[0],o[1]),u),Math.max(o[0],o[1])),i},t.prototype.pointToData=function(e,i){var n=[];if(this._invTransform)return Qn(n,e,this._invTransform);var a=this.getAxis("x"),s=this.getAxis("y");return n[0]=a.coordToData(a.toLocalCoord(e[0]),i),n[1]=s.coordToData(s.toLocalCoord(e[1]),i),n},t.prototype.getOtherAxis=function(e){return this.getAxis(e.dim==="x"?"y":"x")},t.prototype.getArea=function(e){e=e||0;var i=this.getAxis("x").getGlobalExtent(),n=this.getAxis("y").getGlobalExtent(),a=Math.min(i[0],i[1])-e,s=Math.min(n[0],n[1])-e,o=Math.max(i[0],i[1])-a+e,l=Math.max(n[0],n[1])-s+e;return new hr(a,s,o,l)},t}(hAt),dAt=function(r){Vt(t,r);function t(e,i,n,a,s){var o=r.call(this,e,i,n)||this;return o.index=0,o.type=a||"value",o.position=s||"bottom",o}return t.prototype.isHorizontal=function(){var e=this.position;return e==="top"||e==="bottom"},t.prototype.getGlobalExtent=function(e){var i=this.getExtent();return i[0]=this.toGlobalCoord(i[0]),i[1]=this.toGlobalCoord(i[1]),e&&i[0]>i[1]&&i.reverse(),i},t.prototype.pointToData=function(e,i){return this.coordToData(this.toLocalCoord(e[this.dim==="x"?0:1]),i)},t.prototype.setCategorySortInfo=function(e){if(this.type!=="category")return!1;this.model.option.categorySortInfo=e,this.scale.setSortInfo(e)},t}($o);const pAt=dAt;function OM(r,t,e){e=e||{};var i=r.coordinateSystem,n=t.axis,a={},s=n.getAxesOnZeroOf()[0],o=n.position,l=s?"onZero":o,u=n.dim,c=i.getRect(),h=[c.x,c.x+c.width,c.y,c.y+c.height],p={left:0,right:1,top:0,bottom:1,onZero:2},v=t.get("offset")||0,y=u==="x"?[h[2]-v,h[3]+v]:[h[0]-v,h[1]+v];if(s){var x=s.toGlobalCoord(s.dataToCoord(0));y[p.onZero]=Math.max(Math.min(x,y[1]),y[0])}a.position=[u==="y"?y[p[l]]:h[0],u==="x"?y[p[l]]:h[3]],a.rotation=Math.PI/2*(u==="x"?0:1);var w={top:-1,bottom:1,left:-1,right:1};a.labelDirection=a.tickDirection=a.nameDirection=w[o],a.labelOffset=s?y[p[o]]-y[p.onZero]:0,t.get(["axisTick","inside"])&&(a.tickDirection=-a.tickDirection),Un(e.labelInside,t.get(["axisLabel","inside"]))&&(a.labelDirection=-a.labelDirection);var T=t.get(["axisLabel","rotate"]);return a.labelRotate=l==="top"?-T:T,a.z2=1,a}function J5(r){return r.get("coordinateSystem")==="cartesian2d"}function Q5(r){var t={xAxisModel:null,yAxisModel:null};return J(t,function(e,i){var n=i.replace(/Model$/,""),a=r.getReferringComponents(n,vn).models[0];t[i]=a}),t}var mC=Math.log;function Lj(r,t,e){var i=Gc.prototype,n=i.getTicks.call(e),a=i.getTicks.call(e,!0),s=n.length-1,o=i.getInterval.call(e),l=OG(r,t),u=l.extent,c=l.fixMin,h=l.fixMax;if(r.type==="log"){var p=mC(r.base);u=[mC(u[0])/p,mC(u[1])/p]}r.setExtent(u[0],u[1]),r.calcNiceExtent({splitNumber:s,fixMin:c,fixMax:h});var v=i.getExtent.call(r);c&&(u[0]=v[0]),h&&(u[1]=v[1]);var y=i.getInterval.call(r),x=u[0],w=u[1];if(c&&h)y=(w-x)/s;else if(c)for(w=u[0]+y*s;w<u[1]&&isFinite(w)&&isFinite(u[1]);)y=rC(y),w=u[0]+y*s;else if(h)for(x=u[1]-y*s;x>u[0]&&isFinite(x)&&isFinite(u[0]);)y=rC(y),x=u[1]-y*s;else{var T=r.getTicks().length-1;T>s&&(y=rC(y));var E=y*s;w=Math.ceil(u[1]/y)*y,x=Yi(w-E),x<0&&u[0]>=0?(x=0,w=Yi(E)):w>0&&u[1]<=0&&(w=0,x=-Yi(E))}var M=(n[0].value-a[0].value)/o,L=(n[s].value-a[s].value)/o;i.setExtent.call(r,x+y*M,w+y*L),i.setInterval.call(r,y),(M||L)&&i.setNiceExtent.call(r,x+y,w-y)}var gAt=function(){function r(t,e,i){this.type="grid",this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this.axisPointerEnabled=!0,this.dimensions=kM,this._initCartesian(t,e,i),this.model=t}return r.prototype.getRect=function(){return this._rect},r.prototype.update=function(t,e){var i=this._axesMap;this._updateScale(t,this.model);function n(s){var o,l=br(s),u=l.length;if(u){for(var c=[],h=u-1;h>=0;h--){var p=+l[h],v=s[p],y=v.model,x=v.scale;EM(x)&&y.get("alignTicks")&&y.get("interval")==null?c.push(v):(vg(x,y),EM(x)&&(o=v))}c.length&&(o||(o=c.pop(),vg(o.scale,o.model)),J(c,function(w){Lj(w.scale,w.model,o.scale)}))}}n(i.x),n(i.y);var a={};J(i.x,function(s){t4(i,"y",s,a)}),J(i.y,function(s){t4(i,"x",s,a)}),this.resize(this.model,e)},r.prototype.resize=function(t,e,i){var n=t.getBoxLayoutParams(),a=!i&&t.get("containLabel"),s=bn(n,{width:e.getWidth(),height:e.getHeight()});this._rect=s;var o=this._axesList;l(),a&&(J(o,function(u){if(!u.model.get(["axisLabel","inside"])){var c=Ewt(u);if(c){var h=u.isHorizontal()?"height":"width",p=u.model.get(["axisLabel","margin"]);s[h]-=c[h]+p,u.position==="top"?s.y+=c.height+p:u.position==="left"&&(s.x+=c.width+p)}}}),l()),J(this._coordsList,function(u){u.calcAffineTransform()});function l(){J(o,function(u){var c=u.isHorizontal(),h=c?[0,s.width]:[0,s.height],p=u.inverse?1:0;u.setExtent(h[p],h[1-p]),vAt(u,c?s.x:s.y)})}},r.prototype.getAxis=function(t,e){var i=this._axesMap[t];if(i!=null)return i[e||0]},r.prototype.getAxes=function(){return this._axesList.slice()},r.prototype.getCartesian=function(t,e){if(t!=null&&e!=null){var i="x"+t+"y"+e;return this._coordsMap[i]}je(t)&&(e=t.yAxisIndex,t=t.xAxisIndex);for(var n=0,a=this._coordsList;n<a.length;n++)if(a[n].getAxis("x").index===t||a[n].getAxis("y").index===e)return a[n]},r.prototype.getCartesians=function(){return this._coordsList.slice()},r.prototype.convertToPixel=function(t,e,i){var n=this._findConvertTarget(e);return n.cartesian?n.cartesian.dataToPoint(i):n.axis?n.axis.toGlobalCoord(n.axis.dataToCoord(i)):null},r.prototype.convertFromPixel=function(t,e,i){var n=this._findConvertTarget(e);return n.cartesian?n.cartesian.pointToData(i):n.axis?n.axis.coordToData(n.axis.toLocalCoord(i)):null},r.prototype._findConvertTarget=function(t){var e=t.seriesModel,i=t.xAxisModel||e&&e.getReferringComponents("xAxis",vn).models[0],n=t.yAxisModel||e&&e.getReferringComponents("yAxis",vn).models[0],a=t.gridModel,s=this._coordsList,o,l;if(e)o=e.coordinateSystem,pr(s,o)<0&&(o=null);else if(i&&n)o=this.getCartesian(i.componentIndex,n.componentIndex);else if(i)l=this.getAxis("x",i.componentIndex);else if(n)l=this.getAxis("y",n.componentIndex);else if(a){var u=a.coordinateSystem;u===this&&(o=this._coordsList[0])}return{cartesian:o,axis:l}},r.prototype.containPoint=function(t){var e=this._coordsList[0];if(e)return e.containPoint(t)},r.prototype._initCartesian=function(t,e,i){var n=this,a=this,s={left:!1,right:!1,top:!1,bottom:!1},o={x:{},y:{}},l={x:0,y:0};if(e.eachComponent("xAxis",u("x"),this),e.eachComponent("yAxis",u("y"),this),!l.x||!l.y){this._axesMap={},this._axesList=[];return}this._axesMap=o,J(o.x,function(c,h){J(o.y,function(p,v){var y="x"+h+"y"+v,x=new fAt(y);x.master=n,x.model=t,n._coordsMap[y]=x,n._coordsList.push(x),x.addAxis(c),x.addAxis(p)})});function u(c){return function(h,p){if(yC(h,t)){var v=h.get("position");c==="x"?v!=="top"&&v!=="bottom"&&(v=s.bottom?"top":"bottom"):v!=="left"&&v!=="right"&&(v=s.left?"right":"left"),s[v]=!0;var y=new pAt(c,jS(h),[0,0],h.get("type"),v),x=y.type==="category";y.onBand=x&&h.get("boundaryGap"),y.inverse=h.get("inverse"),h.axis=y,y.model=h,y.grid=a,y.index=p,a._axesList.push(y),o[c][p]=y,l[c]++}}}},r.prototype._updateScale=function(t,e){J(this._axesList,function(n){if(n.scale.setExtent(1/0,-1/0),n.type==="category"){var a=n.model.get("categorySortInfo");n.scale.setSortInfo(a)}}),t.eachSeries(function(n){if(J5(n)){var a=Q5(n),s=a.xAxisModel,o=a.yAxisModel;if(!yC(s,e)||!yC(o,e))return;var l=this.getCartesian(s.componentIndex,o.componentIndex),u=n.getData(),c=l.getAxis("x"),h=l.getAxis("y");i(u,c),i(u,h)}},this);function i(n,a){J(dw(n,a.dim),function(s){a.scale.unionExtentFromData(n,s)})}},r.prototype.getTooltipAxes=function(t){var e=[],i=[];return J(this.getCartesians(),function(n){var a=t!=null&&t!=="auto"?n.getAxis(t):n.getBaseAxis(),s=n.getOtherAxis(a);pr(e,a)<0&&e.push(a),pr(i,s)<0&&i.push(s)}),{baseAxes:e,otherAxes:i}},r.create=function(t,e){var i=[];return t.eachComponent("grid",function(n,a){var s=new r(n,t,e);s.name="grid_"+a,s.resize(n,e,!0),n.coordinateSystem=s,i.push(s)}),t.eachSeries(function(n){if(J5(n)){var a=Q5(n),s=a.xAxisModel,o=a.yAxisModel,l=s.getCoordSysModel(),u=l.coordinateSystem;n.coordinateSystem=u.getCartesian(s.componentIndex,o.componentIndex)}}),i},r.dimensions=kM,r}();function yC(r,t){return r.getCoordSysModel()===t}function t4(r,t,e,i){e.getAxesOnZeroOf=function(){return a?[a]:[]};var n=r[t],a,s=e.model,o=s.get(["axisLine","onZero"]),l=s.get(["axisLine","onZeroAxisIndex"]);if(!o)return;if(l!=null)e4(n[l])&&(a=n[l]);else for(var u in n)if(n.hasOwnProperty(u)&&e4(n[u])&&!i[c(n[u])]){a=n[u];break}a&&(i[c(a)]=!0);function c(h){return h.dim+"_"+h.index}}function e4(r){return r&&r.type!=="category"&&r.type!=="time"&&Cwt(r)}function vAt(r,t){var e=r.getExtent(),i=e[0]+e[1];r.toGlobalCoord=r.dim==="x"?function(n){return n+t}:function(n){return i-n+t},r.toLocalCoord=r.dim==="x"?function(n){return n-t}:function(n){return i-n+t}}const mAt=gAt;var Cc=Math.PI,Df=function(){function r(t,e){this.group=new Ke,this.opt=e,this.axisModel=t,We(e,{labelOffset:0,nameDirection:1,tickDirection:1,labelDirection:1,silent:!0,handleAutoShown:function(){return!0}});var i=new Ke({x:e.position[0],y:e.position[1],rotation:e.rotation});i.updateTransform(),this._transformGroup=i}return r.prototype.hasBuilder=function(t){return!!r4[t]},r.prototype.add=function(t){r4[t](this.opt,this.axisModel,this.group,this._transformGroup)},r.prototype.getGroup=function(){return this.group},r.innerTextLayout=function(t,e,i){var n=PH(e-t),a,s;return Wy(n)?(s=i>0?"top":"bottom",a="center"):Wy(n-Cc)?(s=i>0?"bottom":"top",a="center"):(s="middle",n>0&&n<Cc?a=i>0?"right":"left":a=i>0?"left":"right"),{rotation:n,textAlign:a,textVerticalAlign:s}},r.makeAxisEventDataBase=function(t){var e={componentType:t.mainType,componentIndex:t.componentIndex};return e[t.mainType+"Index"]=t.componentIndex,e},r.isLabelSilent=function(t){var e=t.get("tooltip");return t.get("silent")||!(t.get("triggerEvent")||e&&e.show)},r}(),r4={axisLine:function(r,t,e,i){var n=t.get(["axisLine","show"]);if(n==="auto"&&r.handleAutoShown&&(n=r.handleAutoShown("axisLine")),!!n){var a=t.axis.getExtent(),s=i.transform,o=[a[0],0],l=[a[1],0],u=o[0]>l[0];s&&(Qn(o,o,s),Qn(l,l,s));var c=Zt({lineCap:"round"},t.getModel(["axisLine","lineStyle"]).getLineStyle()),h=new $n({shape:{x1:o[0],y1:o[1],x2:l[0],y2:l[1]},style:c,strokeContainThreshold:r.strokeContainThreshold||5,silent:!0,z2:1});dg(h.shape,h.style.lineWidth),h.anid="line",e.add(h);var p=t.get(["axisLine","symbol"]);if(p!=null){var v=t.get(["axisLine","symbolSize"]);ve(p)&&(p=[p,p]),(ve(v)||Fr(v))&&(v=[v,v]);var y=id(t.get(["axisLine","symbolOffset"])||0,v),x=v[0],w=v[1];J([{rotate:r.rotation+Math.PI/2,offset:y[0],r:0},{rotate:r.rotation-Math.PI/2,offset:y[1],r:Math.sqrt((o[0]-l[0])*(o[0]-l[0])+(o[1]-l[1])*(o[1]-l[1]))}],function(T,E){if(p[E]!=="none"&&p[E]!=null){var M=mn(p[E],-x/2,-w/2,x,w,c.stroke,!0),L=T.r+T.offset,F=u?l:o;M.attr({rotation:T.rotate,x:F[0]+L*Math.cos(r.rotation),y:F[1]-L*Math.sin(r.rotation),silent:!0,z2:11}),e.add(M)}})}}},axisTickLabel:function(r,t,e,i){var n=xAt(e,i,t,r),a=wAt(e,i,t,r);if(_At(t,a,n),bAt(e,i,t,r.tickDirection),t.get(["axisLabel","hideOverlap"])){var s=qG(te(a,function(o){return{label:o,priority:o.z2,defaultAttr:{ignore:o.ignore}}}));JG(s)}},axisName:function(r,t,e,i){var n=Un(r.axisName,t.get("name"));if(n){var a=t.get("nameLocation"),s=r.nameDirection,o=t.getModel("nameTextStyle"),l=t.get("nameGap")||0,u=t.axis.getExtent(),c=u[0]>u[1]?-1:1,h=[a==="start"?u[0]-c*l:a==="end"?u[1]+c*l:(u[0]+u[1])/2,n4(a)?r.labelOffset+s*l:0],p,v=t.get("nameRotate");v!=null&&(v=v*Cc/180);var y;n4(a)?p=Df.innerTextLayout(r.rotation,v??r.rotation,s):(p=yAt(r.rotation,a,v||0,u),y=r.axisNameAvailableWidth,y!=null&&(y=Math.abs(y/Math.sin(p.rotation)),!isFinite(y)&&(y=null)));var x=o.getFont(),w=t.get("nameTruncate",!0)||{},T=w.ellipsis,E=Un(r.nameTruncateMaxWidth,w.maxWidth,y),M=new Nr({x:h[0],y:h[1],rotation:p.rotation,silent:Df.isLabelSilent(t),style:hi(o,{text:n,font:x,overflow:"truncate",width:E,ellipsis:T,fill:o.getTextColor()||t.get(["axisLine","lineStyle","color"]),align:o.get("align")||p.textAlign,verticalAlign:o.get("verticalAlign")||p.textVerticalAlign}),z2:1});if(Lg({el:M,componentModel:t,itemName:n}),M.__fullText=n,M.anid="name",t.get("triggerEvent")){var L=Df.makeAxisEventDataBase(t);L.targetType="axisName",L.name=n,Je(M).eventData=L}i.add(M),M.updateTransform(),e.add(M),M.decomposeTransform()}}};function yAt(r,t,e,i){var n=PH(e-r),a,s,o=i[0]>i[1],l=t==="start"&&!o||t!=="start"&&o;return Wy(n-Cc/2)?(s=l?"bottom":"top",a="center"):Wy(n-Cc*1.5)?(s=l?"top":"bottom",a="center"):(s="middle",n<Cc*1.5&&n>Cc/2?a=l?"left":"right":a=l?"right":"left"),{rotation:n,textAlign:a,textVerticalAlign:s}}function _At(r,t,e){if(!NG(r.axis)){var i=r.get(["axisLabel","showMinLabel"]),n=r.get(["axisLabel","showMaxLabel"]);t=t||[],e=e||[];var a=t[0],s=t[1],o=t[t.length-1],l=t[t.length-2],u=e[0],c=e[1],h=e[e.length-1],p=e[e.length-2];i===!1?(Us(a),Us(u)):i4(a,s)&&(i?(Us(s),Us(c)):(Us(a),Us(u))),n===!1?(Us(o),Us(h)):i4(l,o)&&(n?(Us(l),Us(p)):(Us(o),Us(h)))}}function Us(r){r&&(r.ignore=!0)}function i4(r,t){var e=r&&r.getBoundingRect().clone(),i=t&&t.getBoundingRect().clone();if(!(!e||!i)){var n=yS([]);return td(n,n,-r.rotation),e.applyTransform(lu([],n,r.getLocalTransform())),i.applyTransform(lu([],n,t.getLocalTransform())),e.intersect(i)}}function n4(r){return r==="middle"||r==="center"}function kj(r,t,e,i,n){for(var a=[],s=[],o=[],l=0;l<r.length;l++){var u=r[l].coord;s[0]=u,s[1]=0,o[0]=u,o[1]=e,t&&(Qn(s,s,t),Qn(o,o,t));var c=new $n({shape:{x1:s[0],y1:s[1],x2:o[0],y2:o[1]},style:i,z2:2,autoBatch:!0,silent:!0});dg(c.shape,c.style.lineWidth),c.anid=n+"_"+r[l].tickValue,a.push(c)}return a}function xAt(r,t,e,i){var n=e.axis,a=e.getModel("axisTick"),s=a.get("show");if(s==="auto"&&i.handleAutoShown&&(s=i.handleAutoShown("axisTick")),!(!s||n.scale.isBlank())){for(var o=a.getModel("lineStyle"),l=i.tickDirection*a.get("length"),u=n.getTicksCoords(),c=kj(u,t.transform,l,We(o.getLineStyle(),{stroke:e.get(["axisLine","lineStyle","color"])}),"ticks"),h=0;h<c.length;h++)r.add(c[h]);return c}}function bAt(r,t,e,i){var n=e.axis,a=e.getModel("minorTick");if(!(!a.get("show")||n.scale.isBlank())){var s=n.getMinorTicksCoords();if(s.length)for(var o=a.getModel("lineStyle"),l=i*a.get("length"),u=We(o.getLineStyle(),We(e.getModel("axisTick").getLineStyle(),{stroke:e.get(["axisLine","lineStyle","color"])})),c=0;c<s.length;c++)for(var h=kj(s[c],t.transform,l,u,"minorticks_"+c),p=0;p<h.length;p++)r.add(h[p])}}function wAt(r,t,e,i){var n=e.axis,a=Un(i.axisLabelShow,e.get(["axisLabel","show"]));if(!(!a||n.scale.isBlank())){var s=e.getModel("axisLabel"),o=s.get("margin"),l=n.getViewLabels(),u=(Un(i.labelRotate,s.get("rotate"))||0)*Cc/180,c=Df.innerTextLayout(i.rotation,u,i.labelDirection),h=e.getCategories&&e.getCategories(!0),p=[],v=Df.isLabelSilent(e),y=e.get("triggerEvent");return J(l,function(x,w){var T=n.scale.type==="ordinal"?n.scale.getRawOrdinalNumber(x.tickValue):x.tickValue,E=x.formattedLabel,M=x.rawLabel,L=s;if(h&&h[T]){var F=h[T];je(F)&&F.textStyle&&(L=new fi(F.textStyle,s,e.ecModel))}var O=L.getTextColor()||e.get(["axisLine","lineStyle","color"]),U=n.dataToCoord(T),W=L.getShallow("align",!0)||c.textAlign,H=ir(L.getShallow("alignMinLabel",!0),W),j=ir(L.getShallow("alignMaxLabel",!0),W),Y=L.getShallow("verticalAlign",!0)||L.getShallow("baseline",!0)||c.textVerticalAlign,tt=ir(L.getShallow("verticalAlignMinLabel",!0),Y),it=ir(L.getShallow("verticalAlignMaxLabel",!0),Y),lt=new Nr({x:U,y:i.labelOffset+i.labelDirection*o,rotation:c.rotation,silent:v,z2:10+(x.level||0),style:hi(L,{text:E,align:w===0?H:w===l.length-1?j:W,verticalAlign:w===0?tt:w===l.length-1?it:Y,fill:Ve(O)?O(n.type==="category"?M:n.type==="value"?T+"":T,w):O})});if(lt.anid="label_"+T,y){var ht=Df.makeAxisEventDataBase(e);ht.targetType="axisLabel",ht.value=M,ht.tickIndex=w,n.type==="category"&&(ht.dataIndex=T),Je(lt).eventData=ht}t.add(lt),lt.updateTransform(),p.push(lt),r.add(lt),lt.decomposeTransform()}),p}}const _u=Df;function SAt(r,t){var e={axesInfo:{},seriesInvolved:!1,coordSysAxesInfo:{},coordSysMap:{}};return TAt(e,r,t),e.seriesInvolved&&CAt(e,r),e}function TAt(r,t,e){var i=t.getComponent("tooltip"),n=t.getComponent("axisPointer"),a=n.get("link",!0)||[],s=[];J(e.getCoordinateSystems(),function(o){if(!o.axisPointerEnabled)return;var l=n_(o.model),u=r.coordSysAxesInfo[l]={};r.coordSysMap[l]=o;var c=o.model,h=c.getModel("tooltip",i);if(J(o.getAxes(),nr(x,!1,null)),o.getTooltipAxes&&i&&h.get("show")){var p=h.get("trigger")==="axis",v=h.get(["axisPointer","type"])==="cross",y=o.getTooltipAxes(h.get(["axisPointer","axis"]));(p||v)&&J(y.baseAxes,nr(x,v?"cross":!0,p)),v&&J(y.otherAxes,nr(x,"cross",!1))}function x(w,T,E){var M=E.model.getModel("axisPointer",n),L=M.get("show");if(!(!L||L==="auto"&&!w&&!NM(M))){T==null&&(T=M.get("triggerTooltip")),M=w?AAt(E,h,n,t,w,T):M;var F=M.get("snap"),O=M.get("triggerEmphasis"),U=n_(E.model),W=T||F||E.type==="category",H=r.axesInfo[U]={key:U,axis:E,coordSys:o,axisPointerModel:M,triggerTooltip:T,triggerEmphasis:O,involveSeries:W,snap:F,useHandle:NM(M),seriesModels:[],linkGroup:null};u[U]=H,r.seriesInvolved=r.seriesInvolved||W;var j=EAt(a,E);if(j!=null){var Y=s[j]||(s[j]={axesInfo:{}});Y.axesInfo[U]=H,Y.mapper=a[j].mapper,H.linkGroup=Y}}}})}function AAt(r,t,e,i,n,a){var s=t.getModel("axisPointer"),o=["type","snap","lineStyle","shadowStyle","label","animation","animationDurationUpdate","animationEasingUpdate","z"],l={};J(o,function(p){l[p]=Ze(s.get(p))}),l.snap=r.type!=="category"&&!!a,s.get("type")==="cross"&&(l.type="line");var u=l.label||(l.label={});if(u.show==null&&(u.show=!1),n==="cross"){var c=s.get(["label","show"]);if(u.show=c??!0,!a){var h=l.lineStyle=s.get("crossStyle");h&&We(u,h.textStyle)}}return r.model.getModel("axisPointer",new fi(l,e,i))}function CAt(r,t){t.eachSeries(function(e){var i=e.coordinateSystem,n=e.get(["tooltip","trigger"],!0),a=e.get(["tooltip","show"],!0);!i||n==="none"||n===!1||n==="item"||a===!1||e.get(["axisPointer","show"],!0)===!1||J(r.coordSysAxesInfo[n_(i.model)],function(s){var o=s.axis;i.getAxis(o.dim)===o&&(s.seriesModels.push(e),s.seriesDataCount==null&&(s.seriesDataCount=0),s.seriesDataCount+=e.getData().count())})})}function EAt(r,t){for(var e=t.model,i=t.dim,n=0;n<r.length;n++){var a=r[n]||{};if(_C(a[i+"AxisId"],e.id)||_C(a[i+"AxisIndex"],e.componentIndex)||_C(a[i+"AxisName"],e.name))return n}}function _C(r,t){return r==="all"||Kt(r)&&pr(r,t)>=0||r===t}function IAt(r){var t=VD(r);if(t){var e=t.axisPointerModel,i=t.axis.scale,n=e.option,a=e.get("status"),s=e.get("value");s!=null&&(s=i.parse(s));var o=NM(e);a==null&&(n.status=o?"show":"hide");var l=i.getExtent().slice();l[0]>l[1]&&l.reverse(),(s==null||s>l[1])&&(s=l[1]),s<l[0]&&(s=l[0]),n.value=s,o&&(n.status=t.axis.scale.isBlank()?"hide":"show")}}function VD(r){var t=(r.ecModel.getComponent("axisPointer")||{}).coordSysAxesInfo;return t&&t.axesInfo[n_(r)]}function MAt(r){var t=VD(r);return t&&t.axisPointerModel}function NM(r){return!!r.get(["handle","show"])}function n_(r){return r.type+"||"+r.id}var a4={},PAt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n,a){this.axisPointerClass&&IAt(e),r.prototype.render.apply(this,arguments),this._doUpdateAxisPointerClass(e,n,!0)},t.prototype.updateAxisPointer=function(e,i,n,a){this._doUpdateAxisPointerClass(e,n,!1)},t.prototype.remove=function(e,i){var n=this._axisPointer;n&&n.remove(i)},t.prototype.dispose=function(e,i){this._disposeAxisPointer(i),r.prototype.dispose.apply(this,arguments)},t.prototype._doUpdateAxisPointerClass=function(e,i,n){var a=t.getAxisPointerClass(this.axisPointerClass);if(a){var s=MAt(e);s?(this._axisPointer||(this._axisPointer=new a)).render(e,s,i,n):this._disposeAxisPointer(i)}},t.prototype._disposeAxisPointer=function(e){this._axisPointer&&this._axisPointer.dispose(e),this._axisPointer=null},t.registerAxisPointerClass=function(e,i){a4[e]=i},t.getAxisPointerClass=function(e){return e&&a4[e]},t.type="axis",t}($i);const sd=PAt;var FM=Ir();function Oj(r,t,e,i){var n=e.axis;if(!n.scale.isBlank()){var a=e.getModel("splitArea"),s=a.getModel("areaStyle"),o=s.get("color"),l=i.coordinateSystem.getRect(),u=n.getTicksCoords({tickModel:a,clamp:!0});if(u.length){var c=o.length,h=FM(r).splitAreaColors,p=Re(),v=0;if(h)for(var y=0;y<u.length;y++){var x=h.get(u[y].tickValue);if(x!=null){v=(x+(c-1)*y)%c;break}}var w=n.toGlobalCoord(u[0].coord),T=s.getAreaStyle();o=Kt(o)?o:[o];for(var y=1;y<u.length;y++){var E=n.toGlobalCoord(u[y].coord),M=void 0,L=void 0,F=void 0,O=void 0;n.isHorizontal()?(M=w,L=l.y,F=E-M,O=l.height,w=M+F):(M=l.x,L=w,F=l.width,O=E-L,w=L+O);var U=u[y-1].tickValue;U!=null&&p.set(U,v),t.add(new Pr({anid:U!=null?"area_"+U:null,shape:{x:M,y:L,width:F,height:O},style:We({fill:o[v]},T),autoBatch:!0,silent:!0})),v=(v+1)%c}FM(r).splitAreaColors=p}}}function Nj(r){FM(r).splitAreaColors=null}var RAt=["axisLine","axisTickLabel","axisName"],DAt=["splitArea","splitLine","minorSplitLine"],Fj=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="CartesianAxisPointer",e}return t.prototype.render=function(e,i,n,a){this.group.removeAll();var s=this._axisGroup;if(this._axisGroup=new Ke,this.group.add(this._axisGroup),!!e.get("show")){var o=e.getCoordSysModel(),l=OM(o,e),u=new _u(e,Zt({handleAutoShown:function(h){for(var p=o.coordinateSystem.getCartesians(),v=0;v<p.length;v++)if(EM(p[v].getOtherAxis(e.axis).scale))return!0;return!1}},l));J(RAt,u.add,u),this._axisGroup.add(u.getGroup()),J(DAt,function(h){e.get([h,"show"])&&LAt[h](this,this._axisGroup,e,o)},this);var c=a&&a.type==="changeAxisOrder"&&a.isInitSort;c||P_(s,this._axisGroup,e),r.prototype.render.call(this,e,i,n,a)}},t.prototype.remove=function(){Nj(this)},t.type="cartesianAxis",t}(sd),LAt={splitLine:function(r,t,e,i){var n=e.axis;if(!n.scale.isBlank()){var a=e.getModel("splitLine"),s=a.getModel("lineStyle"),o=s.get("color");o=Kt(o)?o:[o];for(var l=i.coordinateSystem.getRect(),u=n.isHorizontal(),c=0,h=n.getTicksCoords({tickModel:a}),p=[],v=[],y=s.getLineStyle(),x=0;x<h.length;x++){var w=n.toGlobalCoord(h[x].coord);u?(p[0]=w,p[1]=l.y,v[0]=w,v[1]=l.y+l.height):(p[0]=l.x,p[1]=w,v[0]=l.x+l.width,v[1]=w);var T=c++%o.length,E=h[x].tickValue,M=new $n({anid:E!=null?"line_"+h[x].tickValue:null,autoBatch:!0,shape:{x1:p[0],y1:p[1],x2:v[0],y2:v[1]},style:We({stroke:o[T]},y),silent:!0});dg(M.shape,y.lineWidth),t.add(M)}}},minorSplitLine:function(r,t,e,i){var n=e.axis,a=e.getModel("minorSplitLine"),s=a.getModel("lineStyle"),o=i.coordinateSystem.getRect(),l=n.isHorizontal(),u=n.getMinorTicksCoords();if(u.length)for(var c=[],h=[],p=s.getLineStyle(),v=0;v<u.length;v++)for(var y=0;y<u[v].length;y++){var x=n.toGlobalCoord(u[v][y].coord);l?(c[0]=x,c[1]=o.y,h[0]=x,h[1]=o.y+o.height):(c[0]=o.x,c[1]=x,h[0]=o.x+o.width,h[1]=x);var w=new $n({anid:"minor_line_"+u[v][y].tickValue,autoBatch:!0,shape:{x1:c[0],y1:c[1],x2:h[0],y2:h[1]},style:p,silent:!0});dg(w.shape,p.lineWidth),t.add(w)}},splitArea:function(r,t,e,i){Oj(r,t,e,i)}},Bj=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="xAxis",t}(Fj),kAt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=Bj.type,e}return t.type="yAxis",t}(Fj),OAt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="grid",e}return t.prototype.render=function(e,i){this.group.removeAll(),e.get("show")&&this.group.add(new Pr({shape:e.coordinateSystem.getRect(),style:We({fill:e.get("backgroundColor")},e.getItemStyle()),silent:!0,z2:-1}))},t.type="grid",t}($i),s4={offset:0};function zj(r){r.registerComponentView(OAt),r.registerComponentModel(aAt),r.registerCoordinateSystem("cartesian2d",mAt),yg(r,"x",LM,s4),yg(r,"y",LM,s4),r.registerComponentView(Bj),r.registerComponentView(kAt),r.registerPreprocessor(function(t){t.xAxis&&t.yAxis&&!t.grid&&(t.grid={})})}function NAt(r){gr(zj),r.registerSeriesModel(KTt),r.registerChartView(iAt),r.registerLayout(z_("scatter"))}function FAt(r){r.eachSeriesByType("radar",function(t){var e=t.getData(),i=[],n=t.coordinateSystem;if(n){var a=n.getIndicatorAxes();J(a,function(s,o){e.each(e.mapDimension(a[o].dim),function(l,u){i[u]=i[u]||[];var c=n.dataToPoint(l,o);i[u][o]=o4(c)?c:l4(n)})}),e.each(function(s){var o=xvt(i[s],function(l){return o4(l)})||l4(n);i[s].push(o.slice()),e.setItemLayout(s,i[s])})}})}function o4(r){return!isNaN(r[0])&&!isNaN(r[1])}function l4(r){return[r.cx,r.cy]}function BAt(r){var t=r.polar;if(t){Kt(t)||(t=[t]);var e=[];J(t,function(i,n){i.indicator?(i.type&&!i.shape&&(i.shape=i.type),r.radar=r.radar||[],Kt(r.radar)||(r.radar=[r.radar]),r.radar.push(i)):e.push(i)}),r.polar=e}J(r.series,function(i){i&&i.type==="radar"&&i.polarIndex&&(i.radarIndex=i.polarIndex)})}var zAt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){var a=e.coordinateSystem,s=this.group,o=e.getData(),l=this._data;function u(p,v){var y=p.getItemVisual(v,"symbol")||"circle";if(y!=="none"){var x=$g(p.getItemVisual(v,"symbolSize")),w=mn(y,-1,-1,2,2),T=p.getItemVisual(v,"symbolRotate")||0;return w.attr({style:{strokeNoScale:!0},z2:100,scaleX:x[0]/2,scaleY:x[1]/2,rotation:T*Math.PI/180||0}),w}}function c(p,v,y,x,w,T){y.removeAll();for(var E=0;E<v.length-1;E++){var M=u(x,w);M&&(M.__dimIdx=E,p[E]?(M.setPosition(p[E]),ed[T?"initProps":"updateProps"](M,{x:v[E][0],y:v[E][1]},e,w)):M.setPosition(v[E]),y.add(M))}}function h(p){return te(p,function(v){return[a.cx,a.cy]})}o.diff(l).add(function(p){var v=o.getItemLayout(p);if(v){var y=new ds,x=new ps,w={shape:{points:v}};y.shape.points=h(v),x.shape.points=h(v),Ei(y,w,e,p),Ei(x,w,e,p);var T=new Ke,E=new Ke;T.add(x),T.add(y),T.add(E),c(x.shape.points,v,E,o,p,!0),o.setItemGraphicEl(p,T)}}).update(function(p,v){var y=l.getItemGraphicEl(v),x=y.childAt(0),w=y.childAt(1),T=y.childAt(2),E={shape:{points:o.getItemLayout(p)}};E.shape.points&&(c(x.shape.points,E.shape.points,T,o,p,!1),Vo(w),Vo(x),zr(x,E,e),zr(w,E,e),o.setItemGraphicEl(p,y))}).remove(function(p){s.remove(l.getItemGraphicEl(p))}).execute(),o.eachItemGraphicEl(function(p,v){var y=o.getItemModel(v),x=p.childAt(0),w=p.childAt(1),T=p.childAt(2),E=o.getItemVisual(v,"style"),M=E.fill;s.add(p),x.useStyle(We(y.getModel("lineStyle").getLineStyle(),{fill:"none",stroke:M})),ea(x,y,"lineStyle"),ea(w,y,"areaStyle");var L=y.getModel("areaStyle"),F=L.isEmpty()&&L.parentModel.isEmpty();w.ignore=F,J(["emphasis","select","blur"],function(W){var H=y.getModel([W,"areaStyle"]),j=H.isEmpty()&&H.parentModel.isEmpty();w.ensureState(W).ignore=j&&F}),w.useStyle(We(L.getAreaStyle(),{fill:M,opacity:.7,decal:E.decal}));var O=y.getModel("emphasis"),U=O.getModel("itemStyle").getItemStyle();T.eachChild(function(W){if(W instanceof ia){var H=W.style;W.useStyle(Zt({image:H.image,x:H.x,y:H.y,width:H.width,height:H.height},E))}else W.useStyle(E),W.setColor(M),W.style.strokeNoScale=!0;var j=W.ensureState("emphasis");j.style=Ze(U);var Y=o.getStore().get(o.getDimensionIndex(W.__dimIdx),v);(Y==null||isNaN(Y))&&(Y=""),ra(W,Dn(y),{labelFetcher:o.hostModel,labelDataIndex:v,labelDimIndex:W.__dimIdx,defaultText:Y,inheritColor:M,defaultOpacity:E.opacity})}),Ui(p,O.get("focus"),O.get("blurScope"),O.get("disabled"))}),this._data=o},t.prototype.remove=function(){this.group.removeAll(),this._data=null},t.type="radar",t}(di);const VAt=zAt;var UAt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.init=function(e){r.prototype.init.apply(this,arguments),this.legendVisualProvider=new U_(we(this.getData,this),we(this.getRawData,this))},t.prototype.getInitialData=function(e,i){return Hg(this,{generateCoord:"indicator_",generateCoordCount:1/0})},t.prototype.formatTooltip=function(e,i,n){var a=this.getData(),s=this.coordinateSystem,o=s.getIndicatorAxes(),l=this.getData().getName(e),u=l===""?this.name:l,c=D9(this,e);return Ln("section",{header:u,sortBlocks:!0,blocks:te(o,function(h){var p=a.get(a.mapDimension(h.dim),e);return Ln("nameValue",{markerType:"subItem",markerColor:c,name:h.name,value:p,sortParam:p})})})},t.prototype.getTooltipPosition=function(e){if(e!=null){for(var i=this.getData(),n=this.coordinateSystem,a=i.getValues(te(n.dimensions,function(u){return i.mapDimension(u)}),e),s=0,o=a.length;s<o;s++)if(!isNaN(a[s])){var l=n.getIndicatorAxes();return n.coordToPoint(l[s].dataToCoord(a[s]),s)}}},t.type="series.radar",t.dependencies=["radar"],t.defaultOption={z:2,colorBy:"data",coordinateSystem:"radar",legendHoverLink:!0,radarIndex:0,lineStyle:{width:2,type:"solid",join:"round"},label:{position:"top"},symbolSize:8},t}(Li);const $At=UAt;var bm=Dj.value;function d1(r,t){return We({show:t},r)}var WAt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(){var e=this.get("boundaryGap"),i=this.get("splitNumber"),n=this.get("scale"),a=this.get("axisLine"),s=this.get("axisTick"),o=this.get("axisLabel"),l=this.get("axisName"),u=this.get(["axisName","show"]),c=this.get(["axisName","formatter"]),h=this.get("axisNameGap"),p=this.get("triggerEvent"),v=te(this.get("indicator")||[],function(y){y.max!=null&&y.max>0&&!y.min?y.min=0:y.min!=null&&y.min<0&&!y.max&&(y.max=0);var x=l;y.color!=null&&(x=We({color:y.color},l));var w=cr(Ze(y),{boundaryGap:e,splitNumber:i,scale:n,axisLine:a,axisTick:s,axisLabel:o,name:y.text,showName:u,nameLocation:"end",nameGap:h,nameTextStyle:x,triggerEvent:p},!1);if(ve(c)){var T=w.name;w.name=c.replace("{value}",T??"")}else Ve(c)&&(w.name=c(w.name,w));var E=new fi(w,null,this.ecModel);return yn(E,O_.prototype),E.mainType="radar",E.componentIndex=this.componentIndex,E},this);this._indicatorModels=v},t.prototype.getIndicatorModels=function(){return this._indicatorModels},t.type="radar",t.defaultOption={z:0,center:["50%","50%"],radius:"75%",startAngle:90,axisName:{show:!0},boundaryGap:[0,0],splitNumber:5,axisNameGap:15,scale:!1,shape:"polygon",axisLine:cr({lineStyle:{color:"#bbb"}},bm.axisLine),axisLabel:d1(bm.axisLabel,!1),axisTick:d1(bm.axisTick,!1),splitLine:d1(bm.splitLine,!0),splitArea:d1(bm.splitArea,!0),indicator:[]},t}(kr);const HAt=WAt;var GAt=["axisLine","axisTickLabel","axisName"],jAt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){var a=this.group;a.removeAll(),this._buildAxes(e),this._buildSplitLineAndArea(e)},t.prototype._buildAxes=function(e){var i=e.coordinateSystem,n=i.getIndicatorAxes(),a=te(n,function(s){var o=s.model.get("showName")?s.name:"",l=new _u(s.model,{axisName:o,position:[i.cx,i.cy],rotation:s.angle,labelDirection:-1,tickDirection:-1,nameDirection:1});return l});J(a,function(s){J(GAt,s.add,s),this.group.add(s.getGroup())},this)},t.prototype._buildSplitLineAndArea=function(e){var i=e.coordinateSystem,n=i.getIndicatorAxes();if(!n.length)return;var a=e.get("shape"),s=e.getModel("splitLine"),o=e.getModel("splitArea"),l=s.getModel("lineStyle"),u=o.getModel("areaStyle"),c=s.get("show"),h=o.get("show"),p=l.get("color"),v=u.get("color"),y=Kt(p)?p:[p],x=Kt(v)?v:[v],w=[],T=[];function E(ht,Tt,Ot){var Rt=Ot%Tt.length;return ht[Rt]=ht[Rt]||[],Rt}if(a==="circle")for(var M=n[0].getTicksCoords(),L=i.cx,F=i.cy,O=0;O<M.length;O++){if(c){var U=E(w,y,O);w[U].push(new Yc({shape:{cx:L,cy:F,r:M[O].coord}}))}if(h&&O<M.length-1){var U=E(T,x,O);T[U].push(new ES({shape:{cx:L,cy:F,r0:M[O].coord,r:M[O+1].coord}}))}}else for(var W,H=te(n,function(ht,Tt){var Ot=ht.getTicksCoords();return W=W==null?Ot.length-1:Math.min(Ot.length-1,W),te(Ot,function(Rt){return i.coordToPoint(Rt.coord,Tt)})}),j=[],O=0;O<=W;O++){for(var Y=[],tt=0;tt<n.length;tt++)Y.push(H[tt][O]);if(Y[0]&&Y.push(Y[0].slice()),c){var U=E(w,y,O);w[U].push(new ps({shape:{points:Y}}))}if(h&&j){var U=E(T,x,O-1);T[U].push(new ds({shape:{points:Y.concat(j)}}))}j=Y.slice().reverse()}var it=l.getLineStyle(),lt=u.getAreaStyle();J(T,function(ht,Tt){this.group.add(Qs(ht,{style:We({stroke:"none",fill:x[Tt%x.length]},lt),silent:!0}))},this),J(w,function(ht,Tt){this.group.add(Qs(ht,{style:We({fill:"none",stroke:y[Tt%y.length]},it),silent:!0}))},this)},t.type="radar",t}($i);const XAt=jAt;var ZAt=function(r){Vt(t,r);function t(e,i,n){var a=r.call(this,e,i,n)||this;return a.type="value",a.angle=0,a.name="",a}return t}($o);const qAt=ZAt;var YAt=function(){function r(t,e,i){this.dimensions=[],this._model=t,this._indicatorAxes=te(t.getIndicatorModels(),function(n,a){var s="indicator_"+a,o=new qAt(s,new Gc);return o.name=n.get("name"),o.model=n,n.axis=o,this.dimensions.push(s),o},this),this.resize(t,i)}return r.prototype.getIndicatorAxes=function(){return this._indicatorAxes},r.prototype.dataToPoint=function(t,e){var i=this._indicatorAxes[e];return this.coordToPoint(i.dataToCoord(t),e)},r.prototype.coordToPoint=function(t,e){var i=this._indicatorAxes[e],n=i.angle,a=this.cx+t*Math.cos(n),s=this.cy-t*Math.sin(n);return[a,s]},r.prototype.pointToData=function(t){var e=t[0]-this.cx,i=t[1]-this.cy,n=Math.sqrt(e*e+i*i);e/=n,i/=n;for(var a=Math.atan2(-i,e),s=1/0,o,l=-1,u=0;u<this._indicatorAxes.length;u++){var c=this._indicatorAxes[u],h=Math.abs(a-c.angle);h<s&&(o=c,l=u,s=h)}return[l,+(o&&o.coordToData(n))]},r.prototype.resize=function(t,e){var i=t.get("center"),n=e.getWidth(),a=e.getHeight(),s=Math.min(n,a)/2;this.cx=he(i[0],n),this.cy=he(i[1],a),this.startAngle=t.get("startAngle")*Math.PI/180;var o=t.get("radius");(ve(o)||Fr(o))&&(o=[0,o]),this.r0=he(o[0],s),this.r=he(o[1],s),J(this._indicatorAxes,function(l,u){l.setExtent(this.r0,this.r);var c=this.startAngle+u*Math.PI*2/this._indicatorAxes.length;c=Math.atan2(Math.sin(c),Math.cos(c)),l.angle=c},this)},r.prototype.update=function(t,e){var i=this._indicatorAxes,n=this._model;J(i,function(o){o.scale.setExtent(1/0,-1/0)}),t.eachSeriesByType("radar",function(o,l){if(!(o.get("coordinateSystem")!=="radar"||t.getComponent("radar",o.get("radarIndex"))!==n)){var u=o.getData();J(i,function(c){c.scale.unionExtentFromData(u,u.mapDimension(c.dim))})}},this);var a=n.get("splitNumber"),s=new Gc;s.setExtent(0,a),s.setInterval(1),J(i,function(o,l){Lj(o.scale,o.model,s)})},r.prototype.convertToPixel=function(t,e,i){return console.warn("Not implemented."),null},r.prototype.convertFromPixel=function(t,e,i){return console.warn("Not implemented."),null},r.prototype.containPoint=function(t){return console.warn("Not implemented."),!1},r.create=function(t,e){var i=[];return t.eachComponent("radar",function(n){var a=new r(n,t,e);i.push(a),n.coordinateSystem=a}),t.eachSeriesByType("radar",function(n){n.get("coordinateSystem")==="radar"&&(n.coordinateSystem=i[n.get("radarIndex")||0])}),i},r.dimensions=[],r}();const KAt=YAt;function JAt(r){r.registerCoordinateSystem("radar",KAt),r.registerComponentModel(HAt),r.registerComponentView(XAt),r.registerVisual({seriesType:"radar",reset:function(t){var e=t.getData();e.each(function(i){e.setItemVisual(i,"legendIcon","roundRect")}),e.setVisual("legendIcon","roundRect")}})}function QAt(r){gr(JAt),r.registerChartView(VAt),r.registerSeriesModel($At),r.registerLayout(FAt),r.registerProcessor(V_("radar")),r.registerPreprocessor(BAt)}var u4="\0_ec_interaction_mutex";function t2t(r,t,e){var i=UD(r);i[t]=e}function e2t(r,t,e){var i=UD(r),n=i[t];n===e&&(i[t]=null)}function c4(r,t){return!!UD(r)[t]}function UD(r){return r[u4]||(r[u4]={})}Il({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},nn);var r2t=function(r){Vt(t,r);function t(e){var i=r.call(this)||this;i._zr=e;var n=we(i._mousedownHandler,i),a=we(i._mousemoveHandler,i),s=we(i._mouseupHandler,i),o=we(i._mousewheelHandler,i),l=we(i._pinchHandler,i);return i.enable=function(u,c){this.disable(),this._opt=We(Ze(c)||{},{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),u==null&&(u=!0),(u===!0||u==="move"||u==="pan")&&(e.on("mousedown",n),e.on("mousemove",a),e.on("mouseup",s)),(u===!0||u==="scale"||u==="zoom")&&(e.on("mousewheel",o),e.on("pinch",l))},i.disable=function(){e.off("mousedown",n),e.off("mousemove",a),e.off("mouseup",s),e.off("mousewheel",o),e.off("pinch",l)},i}return t.prototype.isDragging=function(){return this._dragging},t.prototype.isPinching=function(){return this._pinching},t.prototype.setPointerChecker=function(e){this.pointerChecker=e},t.prototype.dispose=function(){this.disable()},t.prototype._mousedownHandler=function(e){if(!NF(e)){for(var i=e.target;i;){if(i.draggable)return;i=i.__hostTarget||i.parent}var n=e.offsetX,a=e.offsetY;this.pointerChecker&&this.pointerChecker(e,n,a)&&(this._x=n,this._y=a,this._dragging=!0)}},t.prototype._mousemoveHandler=function(e){if(!(!this._dragging||!rb("moveOnMouseMove",e,this._opt)||e.gestureEvent==="pinch"||c4(this._zr,"globalPan"))){var i=e.offsetX,n=e.offsetY,a=this._x,s=this._y,o=i-a,l=n-s;this._x=i,this._y=n,this._opt.preventDefaultMouseMove&&pu(e.event),Vj(this,"pan","moveOnMouseMove",e,{dx:o,dy:l,oldX:a,oldY:s,newX:i,newY:n,isAvailableBehavior:null})}},t.prototype._mouseupHandler=function(e){NF(e)||(this._dragging=!1)},t.prototype._mousewheelHandler=function(e){var i=rb("zoomOnMouseWheel",e,this._opt),n=rb("moveOnMouseWheel",e,this._opt),a=e.wheelDelta,s=Math.abs(a),o=e.offsetX,l=e.offsetY;if(!(a===0||!i&&!n)){if(i){var u=s>3?1.4:s>1?1.2:1.1,c=a>0?u:1/u;xC(this,"zoom","zoomOnMouseWheel",e,{scale:c,originX:o,originY:l,isAvailableBehavior:null})}if(n){var h=Math.abs(a),p=(a>0?1:-1)*(h>3?.4:h>1?.15:.05);xC(this,"scrollMove","moveOnMouseWheel",e,{scrollDelta:p,originX:o,originY:l,isAvailableBehavior:null})}}},t.prototype._pinchHandler=function(e){if(!c4(this._zr,"globalPan")){var i=e.pinchScale>1?1.1:1/1.1;xC(this,"zoom",null,e,{scale:i,originX:e.pinchX,originY:e.pinchY,isAvailableBehavior:null})}},t}(so);function xC(r,t,e,i,n){r.pointerChecker&&r.pointerChecker(i,n.originX,n.originY)&&(pu(i.event),Vj(r,t,e,i,n))}function Vj(r,t,e,i,n){n.isAvailableBehavior=we(rb,null,e,i),r.trigger(t,n)}function rb(r,t,e){var i=e[r];return!r||i&&(!ve(i)||t.event[i+"Key"])}const $_=r2t;function $D(r,t,e){var i=r.target;i.x+=t,i.y+=e,i.dirty()}function WD(r,t,e,i){var n=r.target,a=r.zoomLimit,s=r.zoom=r.zoom||1;if(s*=t,a){var o=a.min||0,l=a.max||1/0;s=Math.max(Math.min(l,s),o)}var u=s/r.zoom;r.zoom=s,n.x-=(e-n.x)*(u-1),n.y-=(i-n.y)*(u-1),n.scaleX*=u,n.scaleY*=u,n.dirty()}var i2t={axisPointer:1,tooltip:1,brush:1};function ZS(r,t,e){var i=t.getComponentByElement(r.topTarget),n=i&&i.coordinateSystem;return i&&i!==e&&!i2t.hasOwnProperty(i.mainType)&&n&&n.model!==e}function Uj(r){if(ve(r)){var t=new DOMParser;r=t.parseFromString(r,"text/xml")}var e=r;for(e.nodeType===9&&(e=e.firstChild);e.nodeName.toLowerCase()!=="svg"||e.nodeType!==1;)e=e.nextSibling;return e}var bC,_w={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},h4=br(_w),xw={"alignment-baseline":"textBaseline","stop-color":"stopColor"},f4=br(xw),n2t=function(){function r(){this._defs={},this._root=null}return r.prototype.parse=function(t,e){e=e||{};var i=Uj(t);this._defsUsePending=[];var n=new Ke;this._root=n;var a=[],s=i.getAttribute("viewBox")||"",o=parseFloat(i.getAttribute("width")||e.width),l=parseFloat(i.getAttribute("height")||e.height);isNaN(o)&&(o=null),isNaN(l)&&(l=null),Ss(i,n,null,!0,!1);for(var u=i.firstChild;u;)this._parseNode(u,n,a,null,!1,!1),u=u.nextSibling;o2t(this._defs,this._defsUsePending),this._defsUsePending=[];var c,h;if(s){var p=qS(s);p.length>=4&&(c={x:parseFloat(p[0]||0),y:parseFloat(p[1]||0),width:parseFloat(p[2]),height:parseFloat(p[3])})}if(c&&o!=null&&l!=null&&(h=Wj(c,{x:0,y:0,width:o,height:l}),!e.ignoreViewBox)){var v=n;n=new Ke,n.add(v),v.scaleX=v.scaleY=h.scale,v.x=h.x,v.y=h.y}return!e.ignoreRootClip&&o!=null&&l!=null&&n.setClipPath(new Pr({shape:{x:0,y:0,width:o,height:l}})),{root:n,width:o,height:l,viewBoxRect:c,viewBoxTransform:h,named:a}},r.prototype._parseNode=function(t,e,i,n,a,s){var o=t.nodeName.toLowerCase(),l,u=n;if(o==="defs"&&(a=!0),o==="text"&&(s=!0),o==="defs"||o==="switch")l=e;else{if(!a){var c=bC[o];if(c&&Ae(bC,o)){l=c.call(this,t,e);var h=t.getAttribute("name");if(h){var p={name:h,namedFrom:null,svgNodeTagLower:o,el:l};i.push(p),o==="g"&&(u=p)}else n&&i.push({name:n.name,namedFrom:n,svgNodeTagLower:o,el:l});e.add(l)}}var v=d4[o];if(v&&Ae(d4,o)){var y=v.call(this,t),x=t.getAttribute("id");x&&(this._defs[x]=y)}}if(l&&l.isGroup)for(var w=t.firstChild;w;)w.nodeType===1?this._parseNode(w,l,i,u,a,s):w.nodeType===3&&s&&this._parseText(w,l),w=w.nextSibling},r.prototype._parseText=function(t,e){var i=new Gy({style:{text:t.textContent},silent:!0,x:this._textX||0,y:this._textY||0});$s(e,i),Ss(t,i,this._defsUsePending,!1,!1),a2t(i,e);var n=i.style,a=n.fontSize;a&&a<9&&(n.fontSize=9,i.scaleX*=a/9,i.scaleY*=a/9);var s=(n.fontSize||n.fontFamily)&&[n.fontStyle,n.fontWeight,(n.fontSize||12)+"px",n.fontFamily||"sans-serif"].join(" ");n.font=s;var o=i.getBoundingRect();return this._textX+=o.width,e.add(i),i},r.internalField=function(){bC={g:function(t,e){var i=new Ke;return $s(e,i),Ss(t,i,this._defsUsePending,!1,!1),i},rect:function(t,e){var i=new Pr;return $s(e,i),Ss(t,i,this._defsUsePending,!1,!1),i.setShape({x:parseFloat(t.getAttribute("x")||"0"),y:parseFloat(t.getAttribute("y")||"0"),width:parseFloat(t.getAttribute("width")||"0"),height:parseFloat(t.getAttribute("height")||"0")}),i.silent=!0,i},circle:function(t,e){var i=new Yc;return $s(e,i),Ss(t,i,this._defsUsePending,!1,!1),i.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),r:parseFloat(t.getAttribute("r")||"0")}),i.silent=!0,i},line:function(t,e){var i=new $n;return $s(e,i),Ss(t,i,this._defsUsePending,!1,!1),i.setShape({x1:parseFloat(t.getAttribute("x1")||"0"),y1:parseFloat(t.getAttribute("y1")||"0"),x2:parseFloat(t.getAttribute("x2")||"0"),y2:parseFloat(t.getAttribute("y2")||"0")}),i.silent=!0,i},ellipse:function(t,e){var i=new KR;return $s(e,i),Ss(t,i,this._defsUsePending,!1,!1),i.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),rx:parseFloat(t.getAttribute("rx")||"0"),ry:parseFloat(t.getAttribute("ry")||"0")}),i.silent=!0,i},polygon:function(t,e){var i=t.getAttribute("points"),n;i&&(n=v4(i));var a=new ds({shape:{points:n||[]},silent:!0});return $s(e,a),Ss(t,a,this._defsUsePending,!1,!1),a},polyline:function(t,e){var i=t.getAttribute("points"),n;i&&(n=v4(i));var a=new ps({shape:{points:n||[]},silent:!0});return $s(e,a),Ss(t,a,this._defsUsePending,!1,!1),a},image:function(t,e){var i=new ia;return $s(e,i),Ss(t,i,this._defsUsePending,!1,!1),i.setStyle({image:t.getAttribute("xlink:href")||t.getAttribute("href"),x:+t.getAttribute("x"),y:+t.getAttribute("y"),width:+t.getAttribute("width"),height:+t.getAttribute("height")}),i.silent=!0,i},text:function(t,e){var i=t.getAttribute("x")||"0",n=t.getAttribute("y")||"0",a=t.getAttribute("dx")||"0",s=t.getAttribute("dy")||"0";this._textX=parseFloat(i)+parseFloat(a),this._textY=parseFloat(n)+parseFloat(s);var o=new Ke;return $s(e,o),Ss(t,o,this._defsUsePending,!1,!0),o},tspan:function(t,e){var i=t.getAttribute("x"),n=t.getAttribute("y");i!=null&&(this._textX=parseFloat(i)),n!=null&&(this._textY=parseFloat(n));var a=t.getAttribute("dx")||"0",s=t.getAttribute("dy")||"0",o=new Ke;return $s(e,o),Ss(t,o,this._defsUsePending,!1,!0),this._textX+=parseFloat(a),this._textY+=parseFloat(s),o},path:function(t,e){var i=t.getAttribute("d")||"",n=g7(i);return $s(e,n),Ss(t,n,this._defsUsePending,!1,!1),n.silent=!0,n}}}(),r}(),d4={lineargradient:function(r){var t=parseInt(r.getAttribute("x1")||"0",10),e=parseInt(r.getAttribute("y1")||"0",10),i=parseInt(r.getAttribute("x2")||"10",10),n=parseInt(r.getAttribute("y2")||"0",10),a=new M_(t,e,i,n);return p4(r,a),g4(r,a),a},radialgradient:function(r){var t=parseInt(r.getAttribute("cx")||"0",10),e=parseInt(r.getAttribute("cy")||"0",10),i=parseInt(r.getAttribute("r")||"0",10),n=new I7(t,e,i);return p4(r,n),g4(r,n),n}};function p4(r,t){var e=r.getAttribute("gradientUnits");e==="userSpaceOnUse"&&(t.global=!0)}function g4(r,t){for(var e=r.firstChild;e;){if(e.nodeType===1&&e.nodeName.toLocaleLowerCase()==="stop"){var i=e.getAttribute("offset"),n=void 0;i&&i.indexOf("%")>0?n=parseInt(i,10)/100:i?n=parseFloat(i):n=0;var a={};$j(e,a,a);var s=a.stopColor||e.getAttribute("stop-color")||"#000000";t.colorStops.push({offset:n,color:s})}e=e.nextSibling}}function $s(r,t){r&&r.__inheritedStyle&&(t.__inheritedStyle||(t.__inheritedStyle={}),We(t.__inheritedStyle,r.__inheritedStyle))}function v4(r){for(var t=qS(r),e=[],i=0;i<t.length;i+=2){var n=parseFloat(t[i]),a=parseFloat(t[i+1]);e.push([n,a])}return e}function Ss(r,t,e,i,n){var a=t,s=a.__inheritedStyle=a.__inheritedStyle||{},o={};r.nodeType===1&&(c2t(r,t),$j(r,s,o),i||h2t(r,s,o)),a.style=a.style||{},s.fill!=null&&(a.style.fill=m4(a,"fill",s.fill,e)),s.stroke!=null&&(a.style.stroke=m4(a,"stroke",s.stroke,e)),J(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],function(l){s[l]!=null&&(a.style[l]=parseFloat(s[l]))}),J(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],function(l){s[l]!=null&&(a.style[l]=s[l])}),n&&(a.__selfStyle=o),s.lineDash&&(a.style.lineDash=te(qS(s.lineDash),function(l){return parseFloat(l)})),(s.visibility==="hidden"||s.visibility==="collapse")&&(a.invisible=!0),s.display==="none"&&(a.ignore=!0)}function a2t(r,t){var e=t.__selfStyle;if(e){var i=e.textBaseline,n=i;!i||i==="auto"||i==="baseline"?n="alphabetic":i==="before-edge"||i==="text-before-edge"?n="top":i==="after-edge"||i==="text-after-edge"?n="bottom":(i==="central"||i==="mathematical")&&(n="middle"),r.style.textBaseline=n}var a=t.__inheritedStyle;if(a){var s=a.textAlign,o=s;s&&(s==="middle"&&(o="center"),r.style.textAlign=o)}}var s2t=/^url\(\s*#(.*?)\)/;function m4(r,t,e,i){var n=e&&e.match(s2t);if(n){var a=ko(n[1]);i.push([r,t,a]);return}return e==="none"&&(e=null),e}function o2t(r,t){for(var e=0;e<t.length;e++){var i=t[e];i[0].style[i[1]]=r[i[2]]}}var l2t=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function qS(r){return r.match(l2t)||[]}var u2t=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,wC=Math.PI/180;function c2t(r,t){var e=r.getAttribute("transform");if(e){e=e.replace(/,/g," ");var i=[],n=null;e.replace(u2t,function(h,p,v){return i.push(p,v),""});for(var a=i.length-1;a>0;a-=2){var s=i[a],o=i[a-1],l=qS(s);switch(n=n||Es(),o){case"translate":wl(n,n,[parseFloat(l[0]),parseFloat(l[1]||"0")]);break;case"scale":kR(n,n,[parseFloat(l[0]),parseFloat(l[1]||l[0])]);break;case"rotate":td(n,n,-parseFloat(l[0])*wC,[parseFloat(l[1]||"0"),parseFloat(l[2]||"0")]);break;case"skewX":var u=Math.tan(parseFloat(l[0])*wC);lu(n,[1,0,u,1,0,0],n);break;case"skewY":var c=Math.tan(parseFloat(l[0])*wC);lu(n,[1,c,0,1,0,0],n);break;case"matrix":n[0]=parseFloat(l[0]),n[1]=parseFloat(l[1]),n[2]=parseFloat(l[2]),n[3]=parseFloat(l[3]),n[4]=parseFloat(l[4]),n[5]=parseFloat(l[5]);break}}t.setLocalTransform(n)}}var y4=/([^\s:;]+)\s*:\s*([^:;]+)/g;function $j(r,t,e){var i=r.getAttribute("style");if(i){y4.lastIndex=0;for(var n;(n=y4.exec(i))!=null;){var a=n[1],s=Ae(_w,a)?_w[a]:null;s&&(t[s]=n[2]);var o=Ae(xw,a)?xw[a]:null;o&&(e[o]=n[2])}}}function h2t(r,t,e){for(var i=0;i<h4.length;i++){var n=h4[i],a=r.getAttribute(n);a!=null&&(t[_w[n]]=a)}for(var i=0;i<f4.length;i++){var n=f4[i],a=r.getAttribute(n);a!=null&&(e[xw[n]]=a)}}function Wj(r,t){var e=t.width/r.width,i=t.height/r.height,n=Math.min(e,i);return{scale:n,x:-(r.x+r.width/2)*n+(t.x+t.width/2),y:-(r.y+r.height/2)*n+(t.y+t.height/2)}}function f2t(r,t){var e=new n2t;return e.parse(r,t)}var d2t=Re(["rect","circle","line","ellipse","polygon","polyline","path","text","tspan","g"]),p2t=function(){function r(t,e){this.type="geoSVG",this._usedGraphicMap=Re(),this._freedGraphics=[],this._mapName=t,this._parsedXML=Uj(e)}return r.prototype.load=function(){var t=this._firstGraphic;if(!t){t=this._firstGraphic=this._buildGraphic(this._parsedXML),this._freedGraphics.push(t),this._boundingRect=this._firstGraphic.boundingRect.clone();var e=v2t(t.named),i=e.regions,n=e.regionsMap;this._regions=i,this._regionsMap=n}return{boundingRect:this._boundingRect,regions:this._regions,regionsMap:this._regionsMap}},r.prototype._buildGraphic=function(t){var e,i;try{e=t&&f2t(t,{ignoreViewBox:!0,ignoreRootClip:!0})||{},i=e.root,Za(i!=null)}catch(w){throw new Error(`Invalid svg format
`+w.message)}var n=new Ke;n.add(i),n.isGeoSVGGraphicRoot=!0;var a=e.width,s=e.height,o=e.viewBoxRect,l=this._boundingRect;if(!l){var u=void 0,c=void 0,h=void 0,p=void 0;if(a!=null?(u=0,h=a):o&&(u=o.x,h=o.width),s!=null?(c=0,p=s):o&&(c=o.y,p=o.height),u==null||c==null){var v=i.getBoundingRect();u==null&&(u=v.x,h=v.width),c==null&&(c=v.y,p=v.height)}l=this._boundingRect=new hr(u,c,h,p)}if(o){var y=Wj(o,l);i.scaleX=i.scaleY=y.scale,i.x=y.x,i.y=y.y}n.setClipPath(new Pr({shape:l.plain()}));var x=[];return J(e.named,function(w){d2t.get(w.svgNodeTagLower)!=null&&(x.push(w),g2t(w.el))}),{root:n,boundingRect:l,named:x}},r.prototype.useGraphic=function(t){var e=this._usedGraphicMap,i=e.get(t);return i||(i=this._freedGraphics.pop()||this._buildGraphic(this._parsedXML),e.set(t,i),i)},r.prototype.freeGraphic=function(t){var e=this._usedGraphicMap,i=e.get(t);i&&(e.removeKey(t),this._freedGraphics.push(i))},r}();function g2t(r){r.silent=!1,r.isGroup&&r.traverse(function(t){t.silent=!1})}function v2t(r){var t=[],e=Re();return J(r,function(i){if(i.namedFrom==null){var n=new Lwt(i.name,i.el);t.push(n),e.set(i.name,n)}}),{regions:t,regionsMap:e}}var BM=[126,25],_4="",Kh=[[[0,3.5],[7,11.2],[15,11.9],[30,7],[42,.7],[52,.7],[56,7.7],[59,.7],[64,.7],[64,0],[5,0],[0,3.5]],[[13,16.1],[19,14.7],[16,21.7],[11,23.1],[13,16.1]],[[12,32.2],[14,38.5],[15,38.5],[13,32.2],[12,32.2]],[[16,47.6],[12,53.2],[13,53.2],[18,47.6],[16,47.6]],[[6,64.4],[8,70],[9,70],[8,64.4],[6,64.4]],[[23,82.6],[29,79.8],[30,79.8],[25,82.6],[23,82.6]],[[37,70.7],[43,62.3],[44,62.3],[39,70.7],[37,70.7]],[[48,51.1],[51,45.5],[53,45.5],[50,51.1],[48,51.1]],[[51,35],[51,28.7],[53,28.7],[53,35],[51,35]],[[52,22.4],[55,17.5],[56,17.5],[53,22.4],[52,22.4]],[[58,12.6],[62,7],[63,7],[60,12.6],[58,12.6]],[[0,3.5],[0,93.1],[64,93.1],[64,0],[63,0],[63,92.4],[1,92.4],[1,3.5],[0,3.5]]];for(var Xh=0;Xh<Kh.length;Xh++)for(var fp=0;fp<Kh[Xh].length;fp++)Kh[Xh][fp][0]/=10.5,Kh[Xh][fp][1]/=-10.5/.75,Kh[Xh][fp][0]+=BM[0],Kh[Xh][fp][1]+=BM[1];function m2t(r,t){if(r==="china"){for(var e=0;e<t.length;e++)if(t[e].name===_4)return;t.push(new BG(_4,te(Kh,function(i){return{type:"polygon",exterior:i}}),BM))}}var y2t={:[32,80],:[0,-10],:[10,5],:[-10,10],:[5,5]};function _2t(r,t){if(r==="china"){var e=y2t[t.name];if(e){var i=t.getCenter();i[0]+=e[0]/10.5,i[1]+=-e[1]/(10.5/.75),t.setCenter(i)}}}var x2t=[[[123.45165252685547,25.73527164402261],[123.49731445312499,25.73527164402261],[123.49731445312499,25.750734064600884],[123.45165252685547,25.750734064600884],[123.45165252685547,25.73527164402261]]];function b2t(r,t){r==="china"&&t.name===""&&t.geometries.push({type:"polygon",exterior:x2t[0]})}var w2t="name",S2t=function(){function r(t,e,i){this.type="geoJSON",this._parsedMap=Re(),this._mapName=t,this._specialAreas=i,this._geoJSON=A2t(e)}return r.prototype.load=function(t,e){e=e||w2t;var i=this._parsedMap.get(e);if(!i){var n=this._parseToRegions(e);i=this._parsedMap.set(e,{regions:n,boundingRect:T2t(n)})}var a=Re(),s=[];return J(i.regions,function(o){var l=o.name;t&&Ae(t,l)&&(o=o.cloneShallow(l=t[l])),s.push(o),a.set(l,o)}),{regions:s,boundingRect:i.boundingRect||new hr(0,0,0,0),regionsMap:a}},r.prototype._parseToRegions=function(t){var e=this._mapName,i=this._geoJSON,n;try{n=i?Owt(i,t):[]}catch(a){throw new Error(`Invalid geoJson format
`+a.message)}return m2t(e,n),J(n,function(a){var s=a.name;_2t(e,a),b2t(e,a);var o=this._specialAreas&&this._specialAreas[s];o&&a.transformTo(o.left,o.top,o.width,o.height)},this),n},r.prototype.getMapForUser=function(){return{geoJson:this._geoJSON,geoJSON:this._geoJSON,specialAreas:this._specialAreas}},r}();function T2t(r){for(var t,e=0;e<r.length;e++){var i=r[e].getBoundingRect();t=t||i.clone(),t.union(i)}return t}function A2t(r){return ve(r)?typeof JSON<"u"&&JSON.parse?JSON.parse(r):new Function("return ("+r+");")():r}var wm=Re();const xu={registerMap:function(r,t,e){if(t.svg){var i=new p2t(r,t.svg);wm.set(r,i)}else{var n=t.geoJson||t.geoJSON;n&&!t.features?e=t.specialAreas:n=t;var i=new S2t(r,n,e);wm.set(r,i)}},getGeoResource:function(r){return wm.get(r)},getMapForUser:function(r){var t=wm.get(r);return t&&t.type==="geoJSON"&&t.getMapForUser()},load:function(r,t,e){var i=wm.get(r);if(i)return i.load(t,e)}};var HD=["rect","circle","line","ellipse","polygon","polyline","path"],C2t=Re(HD),E2t=Re(HD.concat(["g"])),I2t=Re(HD.concat(["g"])),Hj=Ir();function p1(r){var t=r.getItemStyle(),e=r.get("areaColor");return e!=null&&(t.fill=e),t}function x4(r){var t=r.style;t&&(t.stroke=t.stroke||t.fill,t.fill=null)}var M2t=function(){function r(t){var e=new Ke;this.uid=Og("ec_map_draw"),this._controller=new $_(t.getZr()),this._controllerHost={target:e},this.group=e,e.add(this._regionsGroup=new Ke),e.add(this._svgGroup=new Ke)}return r.prototype.draw=function(t,e,i,n,a){var s=t.mainType==="geo",o=t.getData&&t.getData();s&&e.eachComponent({mainType:"series",subType:"map"},function(T){!o&&T.getHostGeoModel()===t&&(o=T.getData())});var l=t.coordinateSystem,u=this._regionsGroup,c=this.group,h=l.getTransformInfo(),p=h.raw,v=h.roam,y=!u.childAt(0)||a;y?(c.x=v.x,c.y=v.y,c.scaleX=v.scaleX,c.scaleY=v.scaleY,c.dirty()):zr(c,v,t);var x=o&&o.getVisual("visualMeta")&&o.getVisual("visualMeta").length>0,w={api:i,geo:l,mapOrGeoModel:t,data:o,isVisualEncodedByVisualMap:x,isGeo:s,transformInfoRaw:p};l.resourceType==="geoJSON"?this._buildGeoJSON(w):l.resourceType==="geoSVG"&&this._buildSVG(w),this._updateController(t,e,i),this._updateMapSelectHandler(t,u,i,n)},r.prototype._buildGeoJSON=function(t){var e=this._regionsGroupByName=Re(),i=Re(),n=this._regionsGroup,a=t.transformInfoRaw,s=t.mapOrGeoModel,o=t.data,l=t.geo.projection,u=l&&l.stream;function c(v,y){return y&&(v=y(v)),v&&[v[0]*a.scaleX+a.x,v[1]*a.scaleY+a.y]}function h(v){for(var y=[],x=!u&&l&&l.project,w=0;w<v.length;++w){var T=c(v[w],x);T&&y.push(T)}return y}function p(v){return{shape:{points:h(v)}}}n.removeAll(),J(t.geo.regions,function(v){var y=v.name,x=e.get(y),w=i.get(y)||{},T=w.dataIdx,E=w.regionModel;x||(x=e.set(y,new Ke),n.add(x),T=o?o.indexOfName(y):null,E=t.isGeo?s.getRegionModel(y):o?o.getItemModel(T):null,i.set(y,{dataIdx:T,regionModel:E}));var M=[],L=[];J(v.geometries,function(U){if(U.type==="polygon"){var W=[U.exterior].concat(U.interiors||[]);u&&(W=C4(W,u)),J(W,function(j){M.push(new ds(p(j)))})}else{var H=U.points;u&&(H=C4(H,u,!0)),J(H,function(j){L.push(new ps(p(j)))})}});var F=c(v.getCenter(),l&&l.project);function O(U,W){if(U.length){var H=new QR({culling:!0,segmentIgnoreThreshold:1,shape:{paths:U}});x.add(H),b4(t,H,T,E),w4(t,H,y,E,s,T,F),W&&(x4(H),J(H.states,x4))}}O(M),O(L,!0)}),e.each(function(v,y){var x=i.get(y),w=x.dataIdx,T=x.regionModel;S4(t,v,y,T,s,w),T4(t,v,y,T,s),A4(t,v,y,T,s)},this)},r.prototype._buildSVG=function(t){var e=t.geo.map,i=t.transformInfoRaw;this._svgGroup.x=i.x,this._svgGroup.y=i.y,this._svgGroup.scaleX=i.scaleX,this._svgGroup.scaleY=i.scaleY,this._svgResourceChanged(e)&&(this._freeSVG(),this._useSVG(e));var n=this._svgDispatcherMap=Re(),a=!1;J(this._svgGraphicRecord.named,function(s){var o=s.name,l=t.mapOrGeoModel,u=t.data,c=s.svgNodeTagLower,h=s.el,p=u?u.indexOfName(o):null,v=l.getRegionModel(o);if(C2t.get(c)!=null&&h instanceof ao&&b4(t,h,p,v),h instanceof ao&&(h.culling=!0),h.z2EmphasisLift=0,!s.namedFrom&&(I2t.get(c)!=null&&w4(t,h,o,v,l,p,null),S4(t,h,o,v,l,p),T4(t,h,o,v,l),E2t.get(c)!=null)){var y=A4(t,h,o,v,l);y==="self"&&(a=!0);var x=n.get(o)||n.set(o,[]);x.push(h)}},this),this._enableBlurEntireSVG(a,t)},r.prototype._enableBlurEntireSVG=function(t,e){if(t&&e.isGeo){var i=e.mapOrGeoModel.getModel(["blur","itemStyle"]).getItemStyle(),n=i.opacity;this._svgGraphicRecord.root.traverse(function(a){if(!a.isGroup){Gf(a);var s=a.ensureState("blur").style||{};s.opacity==null&&n!=null&&(s.opacity=n),a.ensureState("emphasis")}})}},r.prototype.remove=function(){this._regionsGroup.removeAll(),this._regionsGroupByName=null,this._svgGroup.removeAll(),this._freeSVG(),this._controller.dispose(),this._controllerHost=null},r.prototype.findHighDownDispatchers=function(t,e){if(t==null)return[];var i=e.coordinateSystem;if(i.resourceType==="geoJSON"){var n=this._regionsGroupByName;if(n){var a=n.get(t);return a?[a]:[]}}else if(i.resourceType==="geoSVG")return this._svgDispatcherMap&&this._svgDispatcherMap.get(t)||[]},r.prototype._svgResourceChanged=function(t){return this._svgMapName!==t},r.prototype._useSVG=function(t){var e=xu.getGeoResource(t);if(e&&e.type==="geoSVG"){var i=e.useGraphic(this.uid);this._svgGroup.add(i.root),this._svgGraphicRecord=i,this._svgMapName=t}},r.prototype._freeSVG=function(){var t=this._svgMapName;if(t!=null){var e=xu.getGeoResource(t);e&&e.type==="geoSVG"&&e.freeGraphic(this.uid),this._svgGraphicRecord=null,this._svgDispatcherMap=null,this._svgGroup.removeAll(),this._svgMapName=null}},r.prototype._updateController=function(t,e,i){var n=t.coordinateSystem,a=this._controller,s=this._controllerHost;s.zoomLimit=t.get("scaleLimit"),s.zoom=n.getZoom(),a.enable(t.get("roam")||!1);var o=t.mainType;function l(){var u={type:"geoRoam",componentType:o};return u[o+"Id"]=t.id,u}a.off("pan").on("pan",function(u){this._mouseDownFlag=!1,$D(s,u.dx,u.dy),i.dispatchAction(Zt(l(),{dx:u.dx,dy:u.dy,animation:{duration:0}}))},this),a.off("zoom").on("zoom",function(u){this._mouseDownFlag=!1,WD(s,u.scale,u.originX,u.originY),i.dispatchAction(Zt(l(),{totalZoom:s.zoom,zoom:u.scale,originX:u.originX,originY:u.originY,animation:{duration:0}}))},this),a.setPointerChecker(function(u,c,h){return n.containPoint([c,h])&&!ZS(u,i,t)})},r.prototype.resetForLabelLayout=function(){this.group.traverse(function(t){var e=t.getTextContent();e&&(e.ignore=Hj(e).ignore)})},r.prototype._updateMapSelectHandler=function(t,e,i,n){var a=this;e.off("mousedown"),e.off("click"),t.get("selectedMode")&&(e.on("mousedown",function(){a._mouseDownFlag=!0}),e.on("click",function(s){a._mouseDownFlag&&(a._mouseDownFlag=!1)}))},r}();function b4(r,t,e,i){var n=i.getModel("itemStyle"),a=i.getModel(["emphasis","itemStyle"]),s=i.getModel(["blur","itemStyle"]),o=i.getModel(["select","itemStyle"]),l=p1(n),u=p1(a),c=p1(o),h=p1(s),p=r.data;if(p){var v=p.getItemVisual(e,"style"),y=p.getItemVisual(e,"decal");r.isVisualEncodedByVisualMap&&v.fill&&(l.fill=v.fill),y&&(l.decal=gg(y,r.api))}t.setStyle(l),t.style.strokeNoScale=!0,t.ensureState("emphasis").style=u,t.ensureState("select").style=c,t.ensureState("blur").style=h,Gf(t)}function w4(r,t,e,i,n,a,s){var o=r.data,l=r.isGeo,u=o&&isNaN(o.get(o.mapDimension("value"),a)),c=o&&o.getItemLayout(a);if(l||u||c&&c.showLabel){var h=l?e:a,p=void 0;(!o||a>=0)&&(p=n);var v=s?{normal:{align:"center",verticalAlign:"middle"}}:null;ra(t,Dn(i),{labelFetcher:p,labelDataIndex:h,defaultText:e},v);var y=t.getTextContent();if(y&&(Hj(y).ignore=y.ignore,t.textConfig&&s)){var x=t.getBoundingRect().clone();t.textConfig.layoutRect=x,t.textConfig.position=[(s[0]-x.x)/x.width*100+"%",(s[1]-x.y)/x.height*100+"%"]}t.disableLabelAnimation=!0}else t.removeTextContent(),t.removeTextConfig(),t.disableLabelAnimation=null}function S4(r,t,e,i,n,a){r.data?r.data.setItemGraphicEl(a,t):Je(t).eventData={componentType:"geo",componentIndex:n.componentIndex,geoIndex:n.componentIndex,name:e,region:i&&i.option||{}}}function T4(r,t,e,i,n){r.data||Lg({el:t,componentModel:n,itemName:e,itemTooltipOption:i.get("tooltip")})}function A4(r,t,e,i,n){t.highDownSilentOnTouch=!!n.get("selectedMode");var a=i.getModel("emphasis"),s=a.get("focus");return Ui(t,s,a.get("blurScope"),a.get("disabled")),r.isGeo&&P_t(t,n,e),s}function C4(r,t,e){var i=[],n;function a(){n=[]}function s(){n.length&&(i.push(n),n=[])}var o=t({polygonStart:a,polygonEnd:s,lineStart:a,lineEnd:s,point:function(l,u){isFinite(l)&&isFinite(u)&&n.push([l,u])},sphere:function(){}});return!e&&o.polygonStart(),J(r,function(l){o.lineStart();for(var u=0;u<l.length;u++)o.point(l[u][0],l[u][1]);o.lineEnd()}),!e&&o.polygonEnd(),i}const Gj=M2t;var P2t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n,a){if(!(a&&a.type==="mapToggleSelect"&&a.from===this.uid)){var s=this.group;if(s.removeAll(),!e.getHostGeoModel()){if(this._mapDraw&&a&&a.type==="geoRoam"&&this._mapDraw.resetForLabelLayout(),a&&a.type==="geoRoam"&&a.componentType==="series"&&a.seriesId===e.id){var o=this._mapDraw;o&&s.add(o.group)}else if(e.needsDrawMap){var o=this._mapDraw||new Gj(n);s.add(o.group),o.draw(e,i,n,this,a),this._mapDraw=o}else this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;e.get("showLegendSymbol")&&i.getComponent("legend")&&this._renderSymbols(e,i,n)}}},t.prototype.remove=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null,this.group.removeAll()},t.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null},t.prototype._renderSymbols=function(e,i,n){var a=e.originalData,s=this.group;a.each(a.mapDimension("value"),function(o,l){if(!isNaN(o)){var u=a.getItemLayout(l);if(!(!u||!u.point)){var c=u.point,h=u.offset,p=new Yc({style:{fill:e.getData().getVisual("style").fill},shape:{cx:c[0]+h*9,cy:c[1],r:3},silent:!0,z2:8+(h?0:Rg+1)});if(!h){var v=e.mainSeries.getData(),y=a.getName(l),x=v.indexOfName(y),w=a.getItemModel(l),T=w.getModel("label"),E=v.getItemGraphicEl(x);ra(p,Dn(w),{labelFetcher:{getFormattedLabel:function(M,L){return e.getFormattedLabel(x,L)}},defaultText:y}),p.disableLabelAnimation=!0,T.get("position")||p.setTextConfig({position:"bottom"}),E.onHoverStateChange=function(M){Jb(p,M)}}s.add(p)}}})},t.type="map",t}(di);const R2t=P2t;var D2t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.needsDrawMap=!1,e.seriesGroup=[],e.getTooltipPosition=function(i){if(i!=null){var n=this.getData().getName(i),a=this.coordinateSystem,s=a.getRegion(n);return s&&a.dataToPoint(s.getCenter())}},e}return t.prototype.getInitialData=function(e){for(var i=Hg(this,{coordDimensions:["value"],encodeDefaulter:nr(uD,this)}),n=Re(),a=[],s=0,o=i.count();s<o;s++){var l=i.getName(s);n.set(l,!0)}var u=xu.load(this.getMapType(),this.option.nameMap,this.option.nameProperty);return J(u.regions,function(c){var h=c.name;n.get(h)||a.push(h)}),i.appendValues([],a),i},t.prototype.getHostGeoModel=function(){var e=this.option.geoIndex;return e!=null?this.ecModel.getComponent("geo",e):null},t.prototype.getMapType=function(){return(this.getHostGeoModel()||this).option.map},t.prototype.getRawValue=function(e){var i=this.getData();return i.get(i.mapDimension("value"),e)},t.prototype.getRegionModel=function(e){var i=this.getData();return i.getItemModel(i.indexOfName(e))},t.prototype.formatTooltip=function(e,i,n){for(var a=this.getData(),s=this.getRawValue(e),o=a.getName(e),l=this.seriesGroup,u=[],c=0;c<l.length;c++){var h=l[c].originalData.indexOfName(o),p=a.mapDimension("value");isNaN(l[c].originalData.get(p,h))||u.push(l[c].name)}return Ln("section",{header:u.join(", "),noHeader:!u.length,blocks:[Ln("nameValue",{name:o,value:s})]})},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.getLegendIcon=function(e){var i=e.icon||"roundRect",n=mn(i,0,0,e.itemWidth,e.itemHeight,e.itemStyle.fill);return n.setStyle(e.itemStyle),n.style.stroke="none",i.indexOf("empty")>-1&&(n.style.stroke=n.style.fill,n.style.fill="#fff",n.style.lineWidth=2),n},t.type="series.map",t.dependencies=["geo"],t.layoutMode="box",t.defaultOption={z:2,coordinateSystem:"geo",map:"",left:"center",top:"center",aspectScale:null,showLegendSymbol:!0,boundingCoords:null,center:null,zoom:1,scaleLimit:null,selectedMode:!0,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444",areaColor:"#eee"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{areaColor:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},nameProperty:"name"},t}(Li);const L2t=D2t;function k2t(r,t){var e={};return J(r,function(i){i.each(i.mapDimension("value"),function(n,a){var s="ec-"+i.getName(a);e[s]=e[s]||[],isNaN(n)||e[s].push(n)})}),r[0].map(r[0].mapDimension("value"),function(i,n){for(var a="ec-"+r[0].getName(n),s=0,o=1/0,l=-1/0,u=e[a].length,c=0;c<u;c++)o=Math.min(o,e[a][c]),l=Math.max(l,e[a][c]),s+=e[a][c];var h;return t==="min"?h=o:t==="max"?h=l:t==="average"?h=s/u:h=s,u===0?NaN:h})}function O2t(r){var t={};r.eachSeriesByType("map",function(e){var i=e.getHostGeoModel(),n=i?"o"+i.id:"i"+e.getMapType();(t[n]=t[n]||[]).push(e)}),J(t,function(e,i){for(var n=k2t(te(e,function(s){return s.getData()}),e[0].get("mapValueCalculation")),a=0;a<e.length;a++)e[a].originalData=e[a].getData();for(var a=0;a<e.length;a++)e[a].seriesGroup=e,e[a].needsDrawMap=a===0&&!e[a].getHostGeoModel(),e[a].setData(n.cloneShallow()),e[a].mainSeries=e[0]})}function N2t(r){var t={};r.eachSeriesByType("map",function(e){var i=e.getMapType();if(!(e.getHostGeoModel()||t[i])){var n={};J(e.seriesGroup,function(s){var o=s.coordinateSystem,l=s.originalData;s.get("showLegendSymbol")&&r.getComponent("legend")&&l.each(l.mapDimension("value"),function(u,c){var h=l.getName(c),p=o.getRegion(h);if(!(!p||isNaN(u))){var v=n[h]||0,y=o.dataToPoint(p.getCenter());n[h]=v+1,l.setItemLayout(c,{point:y,offset:v})}})});var a=e.getData();a.each(function(s){var o=a.getName(s),l=a.getItemLayout(s)||{};l.showLabel=!n[o],a.setItemLayout(s,l)}),t[i]=!0}})}var E4=Qn,F2t=function(r){Vt(t,r);function t(e){var i=r.call(this)||this;return i.type="view",i.dimensions=["x","y"],i._roamTransformable=new ru,i._rawTransformable=new ru,i.name=e,i}return t.prototype.setBoundingRect=function(e,i,n,a){return this._rect=new hr(e,i,n,a),this._rect},t.prototype.getBoundingRect=function(){return this._rect},t.prototype.setViewRect=function(e,i,n,a){this._transformTo(e,i,n,a),this._viewRect=new hr(e,i,n,a)},t.prototype._transformTo=function(e,i,n,a){var s=this.getBoundingRect(),o=this._rawTransformable;o.transform=s.calculateTransform(new hr(e,i,n,a));var l=o.parent;o.parent=null,o.decomposeTransform(),o.parent=l,this._updateTransform()},t.prototype.setCenter=function(e,i){e&&(this._center=[he(e[0],i.getWidth()),he(e[1],i.getHeight())],this._updateCenterAndZoom())},t.prototype.setZoom=function(e){e=e||1;var i=this.zoomLimit;i&&(i.max!=null&&(e=Math.min(i.max,e)),i.min!=null&&(e=Math.max(i.min,e))),this._zoom=e,this._updateCenterAndZoom()},t.prototype.getDefaultCenter=function(){var e=this.getBoundingRect(),i=e.x+e.width/2,n=e.y+e.height/2;return[i,n]},t.prototype.getCenter=function(){return this._center||this.getDefaultCenter()},t.prototype.getZoom=function(){return this._zoom||1},t.prototype.getRoamTransform=function(){return this._roamTransformable.getLocalTransform()},t.prototype._updateCenterAndZoom=function(){var e=this._rawTransformable.getLocalTransform(),i=this._roamTransformable,n=this.getDefaultCenter(),a=this.getCenter(),s=this.getZoom();a=Qn([],a,e),n=Qn([],n,e),i.originX=a[0],i.originY=a[1],i.x=n[0]-a[0],i.y=n[1]-a[1],i.scaleX=i.scaleY=s,this._updateTransform()},t.prototype._updateTransform=function(){var e=this._roamTransformable,i=this._rawTransformable;i.parent=e,e.updateTransform(),i.updateTransform(),LR(this.transform||(this.transform=[]),i.transform||Es()),this._rawTransform=i.getLocalTransform(),this.invTransform=this.invTransform||[],Mg(this.invTransform,this.transform),this.decomposeTransform()},t.prototype.getTransformInfo=function(){var e=this._rawTransformable,i=this._roamTransformable,n=new ru;return n.transform=i.transform,n.decomposeTransform(),{roam:{x:n.x,y:n.y,scaleX:n.scaleX,scaleY:n.scaleY},raw:{x:e.x,y:e.y,scaleX:e.scaleX,scaleY:e.scaleY}}},t.prototype.getViewRect=function(){return this._viewRect},t.prototype.getViewRectAfterRoam=function(){var e=this.getBoundingRect().clone();return e.applyTransform(this.transform),e},t.prototype.dataToPoint=function(e,i,n){var a=i?this._rawTransform:this.transform;return n=n||[],a?E4(n,e,a):Ua(n,e)},t.prototype.pointToData=function(e){var i=this.invTransform;return i?E4([],e,i):[e[0],e[1]]},t.prototype.convertToPixel=function(e,i,n){var a=I4(i);return a===this?a.dataToPoint(n):null},t.prototype.convertFromPixel=function(e,i,n){var a=I4(i);return a===this?a.pointToData(n):null},t.prototype.containPoint=function(e){return this.getViewRectAfterRoam().contain(e[0],e[1])},t.dimensions=["x","y"],t}(ru);function I4(r){var t=r.seriesModel;return t?t.coordinateSystem:null}const W_=F2t;var B2t={geoJSON:{aspectScale:.75,invertLongitute:!0},geoSVG:{aspectScale:1,invertLongitute:!1}},jj=["lng","lat"],Xj=function(r){Vt(t,r);function t(e,i,n){var a=r.call(this,e)||this;a.dimensions=jj,a.type="geo",a._nameCoordMap=Re(),a.map=i;var s=n.projection,o=xu.load(i,n.nameMap,n.nameProperty),l=xu.getGeoResource(i);a.resourceType=l?l.type:null;var u=a.regions=o.regions,c=B2t[l.type];a._regionsMap=o.regionsMap,a.regions=o.regions,a.projection=s;var h;if(s)for(var p=0;p<u.length;p++){var v=u[p].getBoundingRect(s);h=h||v.clone(),h.union(v)}else h=o.boundingRect;return a.setBoundingRect(h.x,h.y,h.width,h.height),a.aspectScale=s?1:ir(n.aspectScale,c.aspectScale),a._invertLongitute=s?!1:c.invertLongitute,a}return t.prototype._transformTo=function(e,i,n,a){var s=this.getBoundingRect(),o=this._invertLongitute;s=s.clone(),o&&(s.y=-s.y-s.height);var l=this._rawTransformable;l.transform=s.calculateTransform(new hr(e,i,n,a));var u=l.parent;l.parent=null,l.decomposeTransform(),l.parent=u,o&&(l.scaleY=-l.scaleY),this._updateTransform()},t.prototype.getRegion=function(e){return this._regionsMap.get(e)},t.prototype.getRegionByCoord=function(e){for(var i=this.regions,n=0;n<i.length;n++){var a=i[n];if(a.type==="geoJSON"&&a.contain(e))return i[n]}},t.prototype.addGeoCoord=function(e,i){this._nameCoordMap.set(e,i)},t.prototype.getGeoCoord=function(e){var i=this._regionsMap.get(e);return this._nameCoordMap.get(e)||i&&i.getCenter()},t.prototype.dataToPoint=function(e,i,n){if(ve(e)&&(e=this.getGeoCoord(e)),e){var a=this.projection;return a&&(e=a.project(e)),e&&this.projectedToPoint(e,i,n)}},t.prototype.pointToData=function(e){var i=this.projection;return i&&(e=i.unproject(e)),e&&this.pointToProjected(e)},t.prototype.pointToProjected=function(e){return r.prototype.pointToData.call(this,e)},t.prototype.projectedToPoint=function(e,i,n){return r.prototype.dataToPoint.call(this,e,i,n)},t.prototype.convertToPixel=function(e,i,n){var a=M4(i);return a===this?a.dataToPoint(n):null},t.prototype.convertFromPixel=function(e,i,n){var a=M4(i);return a===this?a.pointToData(n):null},t}(W_);yn(Xj,W_);function M4(r){var t=r.geoModel,e=r.seriesModel;return t?t.coordinateSystem:e?e.coordinateSystem||(e.getReferringComponents("geo",vn).models[0]||{}).coordinateSystem:null}const P4=Xj;function R4(r,t){var e=r.get("boundingCoords");if(e!=null){var i=e[0],n=e[1];if(isFinite(i[0])&&isFinite(i[1])&&isFinite(n[0])&&isFinite(n[1])){var a=this.projection;if(a){var s=i[0],o=i[1],l=n[0],u=n[1];i=[1/0,1/0],n=[-1/0,-1/0];var c=function(O,U,W,H){for(var j=W-O,Y=H-U,tt=0;tt<=100;tt++){var it=tt/100,lt=a.project([O+j*it,U+Y*it]);bc(i,i,lt),wc(n,n,lt)}};c(s,o,l,o),c(l,o,l,u),c(l,u,s,u),c(s,u,l,o)}this.setBoundingRect(i[0],i[1],n[0]-i[0],n[1]-i[1])}}var h=this.getBoundingRect(),p=r.get("layoutCenter"),v=r.get("layoutSize"),y=t.getWidth(),x=t.getHeight(),w=h.width/h.height*this.aspectScale,T=!1,E,M;p&&v&&(E=[he(p[0],y),he(p[1],x)],M=he(v,Math.min(y,x)),!isNaN(E[0])&&!isNaN(E[1])&&!isNaN(M)&&(T=!0));var L;if(T)L={},w>1?(L.width=M,L.height=M/w):(L.height=M,L.width=M*w),L.y=E[1]-L.height/2,L.x=E[0]-L.width/2;else{var F=r.getBoxLayoutParams();F.aspect=w,L=bn(F,{width:y,height:x})}this.setViewRect(L.x,L.y,L.width,L.height),this.setCenter(r.get("center"),t),this.setZoom(r.get("zoom"))}function z2t(r,t){J(t.get("geoCoord"),function(e,i){r.addGeoCoord(i,e)})}var V2t=function(){function r(){this.dimensions=jj}return r.prototype.create=function(t,e){var i=[];function n(s){return{nameProperty:s.get("nameProperty"),aspectScale:s.get("aspectScale"),projection:s.get("projection")}}t.eachComponent("geo",function(s,o){var l=s.get("map"),u=new P4(l+o,l,Zt({nameMap:s.get("nameMap")},n(s)));u.zoomLimit=s.get("scaleLimit"),i.push(u),s.coordinateSystem=u,u.model=s,u.resize=R4,u.resize(s,e)}),t.eachSeries(function(s){var o=s.get("coordinateSystem");if(o==="geo"){var l=s.get("geoIndex")||0;s.coordinateSystem=i[l]}});var a={};return t.eachSeriesByType("map",function(s){if(!s.getHostGeoModel()){var o=s.getMapType();a[o]=a[o]||[],a[o].push(s)}}),J(a,function(s,o){var l=te(s,function(c){return c.get("nameMap")}),u=new P4(o,o,Zt({nameMap:MR(l)},n(s[0])));u.zoomLimit=Un.apply(null,te(s,function(c){return c.get("scaleLimit")})),i.push(u),u.resize=R4,u.resize(s[0],e),J(s,function(c){c.coordinateSystem=u,z2t(u,c)})}),i},r.prototype.getFilledRegions=function(t,e,i,n){for(var a=(t||[]).slice(),s=Re(),o=0;o<a.length;o++)s.set(a[o].name,a[o]);var l=xu.load(e,i,n);return J(l.regions,function(u){var c=u.name;!s.get(c)&&a.push({name:c})}),a},r}(),U2t=new V2t;const Zj=U2t;var $2t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,i,n){var a=xu.getGeoResource(e.map);if(a&&a.type==="geoJSON"){var s=e.itemStyle=e.itemStyle||{};"color"in s||(s.color="#eee")}this.mergeDefaultAndTheme(e,n),$f(e,"label",["show"])},t.prototype.optionUpdated=function(){var e=this,i=this.option;i.regions=Zj.getFilledRegions(i.regions,i.map,i.nameMap,i.nameProperty);var n={};this._optionModelMap=bl(i.regions||[],function(a,s){var o=s.name;return o&&(a.set(o,new fi(s,e,e.ecModel)),s.selected&&(n[o]=!0)),a},Re()),i.selectedMap||(i.selectedMap=n)},t.prototype.getRegionModel=function(e){return this._optionModelMap.get(e)||new fi(null,this,this.ecModel)},t.prototype.getFormattedLabel=function(e,i){var n=this.getRegionModel(e),a=i==="normal"?n.get(["label","formatter"]):n.get(["emphasis","label","formatter"]),s={name:e};if(Ve(a))return s.status=i,a(s);if(ve(a))return a.replace("{a}",e??"")},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.select=function(e){var i=this.option,n=i.selectedMode;if(n){n!=="multiple"&&(i.selectedMap=null);var a=i.selectedMap||(i.selectedMap={});a[e]=!0}},t.prototype.unSelect=function(e){var i=this.option.selectedMap;i&&(i[e]=!1)},t.prototype.toggleSelected=function(e){this[this.isSelected(e)?"unSelect":"select"](e)},t.prototype.isSelected=function(e){var i=this.option.selectedMap;return!!(i&&i[e])},t.type="geo",t.layoutMode="box",t.defaultOption={z:0,show:!0,left:"center",top:"center",aspectScale:null,silent:!1,map:"",boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},regions:[]},t}(kr);const W2t=$2t;function D4(r,t){return r.pointToProjected?r.pointToProjected(t):r.pointToData(t)}function GD(r,t,e,i){var n=r.getZoom(),a=r.getCenter(),s=t.zoom,o=r.projectedToPoint?r.projectedToPoint(a):r.dataToPoint(a);if(t.dx!=null&&t.dy!=null&&(o[0]-=t.dx,o[1]-=t.dy,r.setCenter(D4(r,o),i)),s!=null){if(e){var l=e.min||0,u=e.max||1/0;s=Math.max(Math.min(n*s,u),l)/n}r.scaleX*=s,r.scaleY*=s;var c=(t.originX-r.x)*(s-1),h=(t.originY-r.y)*(s-1);r.x-=c,r.y-=h,r.updateTransform(),r.setCenter(D4(r,o),i),r.setZoom(s*n)}return{center:r.getCenter(),zoom:r.getZoom()}}var H2t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.focusBlurEnabled=!0,e}return t.prototype.init=function(e,i){this._api=i},t.prototype.render=function(e,i,n,a){if(this._model=e,!e.get("show")){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;return}this._mapDraw||(this._mapDraw=new Gj(n));var s=this._mapDraw;s.draw(e,i,n,this,a),s.group.on("click",this._handleRegionClick,this),s.group.silent=e.get("silent"),this.group.add(s.group),this.updateSelectStatus(e,i,n)},t.prototype._handleRegionClick=function(e){var i;mf(e.target,function(n){return(i=Je(n).eventData)!=null},!0),i&&this._api.dispatchAction({type:"geoToggleSelect",geoId:this._model.id,name:i.name})},t.prototype.updateSelectStatus=function(e,i,n){var a=this;this._mapDraw.group.traverse(function(s){var o=Je(s).eventData;if(o)return a._model.isSelected(o.name)?n.enterSelect(s):n.leaveSelect(s),!0})},t.prototype.findHighDownDispatchers=function(e){return this._mapDraw&&this._mapDraw.findHighDownDispatchers(e,this._model)},t.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove()},t.type="geo",t}($i);const G2t=H2t;function j2t(r,t,e){xu.registerMap(r,t,e)}function qj(r){r.registerCoordinateSystem("geo",Zj),r.registerComponentModel(W2t),r.registerComponentView(G2t),r.registerImpl("registerMap",j2t),r.registerImpl("getMap",function(e){return xu.getMapForUser(e)});function t(e,i){i.update="geo:updateSelectStatus",r.registerAction(i,function(n,a){var s={},o=[];return a.eachComponent({mainType:"geo",query:n},function(l){l[e](n.name);var u=l.coordinateSystem;J(u.regions,function(h){s[h.name]=l.isSelected(h.name)||!1});var c=[];J(s,function(h,p){s[p]&&c.push(p)}),o.push({geoIndex:l.componentIndex,name:c})}),{selected:s,allSelected:o,name:n.name}})}t("toggleSelected",{type:"geoToggleSelect",event:"geoselectchanged"}),t("select",{type:"geoSelect",event:"geoselected"}),t("unSelect",{type:"geoUnSelect",event:"geounselected"}),r.registerAction({type:"geoRoam",event:"geoRoam",update:"updateTransform"},function(e,i,n){var a=e.componentType||"series";i.eachComponent({mainType:a,query:e},function(s){var o=s.coordinateSystem;if(o.type==="geo"){var l=GD(o,e,s.get("scaleLimit"),n);s.setCenter&&s.setCenter(l.center),s.setZoom&&s.setZoom(l.zoom),a==="series"&&J(s.seriesGroup,function(u){u.setCenter(l.center),u.setZoom(l.zoom)})}})})}function X2t(r){gr(qj),r.registerChartView(R2t),r.registerSeriesModel(L2t),r.registerLayout(N2t),r.registerProcessor(r.PRIORITY.PROCESSOR.STATISTIC,O2t),H9("map",r.registerAction)}function Z2t(r){var t=r;t.hierNode={defaultAncestor:null,ancestor:t,prelim:0,modifier:0,change:0,shift:0,i:0,thread:null};for(var e=[t],i,n;i=e.pop();)if(n=i.children,i.isExpand&&n.length)for(var a=n.length,s=a-1;s>=0;s--){var o=n[s];o.hierNode={defaultAncestor:null,ancestor:o,prelim:0,modifier:0,change:0,shift:0,i:s,thread:null},e.push(o)}}function q2t(r,t){var e=r.isExpand?r.children:[],i=r.parentNode.children,n=r.hierNode.i?i[r.hierNode.i-1]:null;if(e.length){J2t(r);var a=(e[0].hierNode.prelim+e[e.length-1].hierNode.prelim)/2;n?(r.hierNode.prelim=n.hierNode.prelim+t(r,n),r.hierNode.modifier=r.hierNode.prelim-a):r.hierNode.prelim=a}else n&&(r.hierNode.prelim=n.hierNode.prelim+t(r,n));r.parentNode.hierNode.defaultAncestor=Q2t(r,n,r.parentNode.hierNode.defaultAncestor||i[0],t)}function Y2t(r){var t=r.hierNode.prelim+r.parentNode.hierNode.modifier;r.setLayout({x:t},!0),r.hierNode.modifier+=r.parentNode.hierNode.modifier}function L4(r){return arguments.length?r:rCt}function Gm(r,t){return r-=Math.PI/2,{x:t*Math.cos(r),y:t*Math.sin(r)}}function K2t(r,t){return bn(r.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function J2t(r){for(var t=r.children,e=t.length,i=0,n=0;--e>=0;){var a=t[e];a.hierNode.prelim+=i,a.hierNode.modifier+=i,n+=a.hierNode.change,i+=a.hierNode.shift+n}}function Q2t(r,t,e,i){if(t){for(var n=r,a=r,s=a.parentNode.children[0],o=t,l=n.hierNode.modifier,u=a.hierNode.modifier,c=s.hierNode.modifier,h=o.hierNode.modifier;o=SC(o),a=TC(a),o&&a;){n=SC(n),s=TC(s),n.hierNode.ancestor=r;var p=o.hierNode.prelim+h-a.hierNode.prelim-u+i(o,a);p>0&&(eCt(tCt(o,r,e),r,p),u+=p,l+=p),h+=o.hierNode.modifier,u+=a.hierNode.modifier,l+=n.hierNode.modifier,c+=s.hierNode.modifier}o&&!SC(n)&&(n.hierNode.thread=o,n.hierNode.modifier+=h-l),a&&!TC(s)&&(s.hierNode.thread=a,s.hierNode.modifier+=u-c,e=r)}return e}function SC(r){var t=r.children;return t.length&&r.isExpand?t[t.length-1]:r.hierNode.thread}function TC(r){var t=r.children;return t.length&&r.isExpand?t[0]:r.hierNode.thread}function tCt(r,t,e){return r.hierNode.ancestor.parentNode===t.parentNode?r.hierNode.ancestor:e}function eCt(r,t,e){var i=e/(t.hierNode.i-r.hierNode.i);t.hierNode.change-=i,t.hierNode.shift+=e,t.hierNode.modifier+=e,t.hierNode.prelim+=e,r.hierNode.change+=i}function rCt(r,t){return r.parentNode===t.parentNode?1:2}var iCt=function(){function r(){this.parentPoint=[],this.childPoints=[]}return r}(),nCt=function(r){Vt(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new iCt},t.prototype.buildPath=function(e,i){var n=i.childPoints,a=n.length,s=i.parentPoint,o=n[0],l=n[a-1];if(a===1){e.moveTo(s[0],s[1]),e.lineTo(o[0],o[1]);return}var u=i.orient,c=u==="TB"||u==="BT"?0:1,h=1-c,p=he(i.forkPosition,1),v=[];v[c]=s[c],v[h]=s[h]+(l[h]-s[h])*p,e.moveTo(s[0],s[1]),e.lineTo(v[0],v[1]),e.moveTo(o[0],o[1]),v[c]=o[c],e.lineTo(v[0],v[1]),v[c]=l[c],e.lineTo(v[0],v[1]),e.lineTo(l[0],l[1]);for(var y=1;y<a-1;y++){var x=n[y];e.moveTo(x[0],x[1]),v[c]=x[c],e.lineTo(v[0],v[1])}},t}(vr),aCt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e._mainGroup=new Ke,e}return t.prototype.init=function(e,i){this._controller=new $_(i.getZr()),this._controllerHost={target:this.group},this.group.add(this._mainGroup)},t.prototype.render=function(e,i,n){var a=e.getData(),s=e.layoutInfo,o=this._mainGroup,l=e.get("layout");l==="radial"?(o.x=s.x+s.width/2,o.y=s.y+s.height/2):(o.x=s.x,o.y=s.y),this._updateViewCoordSys(e,n),this._updateController(e,i,n);var u=this._data;a.diff(u).add(function(c){k4(a,c)&&O4(a,c,null,o,e)}).update(function(c,h){var p=u.getItemGraphicEl(h);if(!k4(a,c)){p&&F4(u,h,p,o,e);return}O4(a,c,p,o,e)}).remove(function(c){var h=u.getItemGraphicEl(c);h&&F4(u,c,h,o,e)}).execute(),this._nodeScaleRatio=e.get("nodeScaleRatio"),this._updateNodeAndLinkScale(e),e.get("expandAndCollapse")===!0&&a.eachItemGraphicEl(function(c,h){c.off("click").on("click",function(){n.dispatchAction({type:"treeExpandAndCollapse",seriesId:e.id,dataIndex:h})})}),this._data=a},t.prototype._updateViewCoordSys=function(e,i){var n=e.getData(),a=[];n.each(function(h){var p=n.getItemLayout(h);p&&!isNaN(p.x)&&!isNaN(p.y)&&a.push([+p.x,+p.y])});var s=[],o=[];TS(a,s,o);var l=this._min,u=this._max;o[0]-s[0]===0&&(s[0]=l?l[0]:s[0]-1,o[0]=u?u[0]:o[0]+1),o[1]-s[1]===0&&(s[1]=l?l[1]:s[1]-1,o[1]=u?u[1]:o[1]+1);var c=e.coordinateSystem=new W_;c.zoomLimit=e.get("scaleLimit"),c.setBoundingRect(s[0],s[1],o[0]-s[0],o[1]-s[1]),c.setCenter(e.get("center"),i),c.setZoom(e.get("zoom")),this.group.attr({x:c.x,y:c.y,scaleX:c.scaleX,scaleY:c.scaleY}),this._min=s,this._max=o},t.prototype._updateController=function(e,i,n){var a=this,s=this._controller,o=this._controllerHost,l=this.group;s.setPointerChecker(function(u,c,h){var p=l.getBoundingRect();return p.applyTransform(l.transform),p.contain(c,h)&&!ZS(u,n,e)}),s.enable(e.get("roam")),o.zoomLimit=e.get("scaleLimit"),o.zoom=e.coordinateSystem.getZoom(),s.off("pan").off("zoom").on("pan",function(u){$D(o,u.dx,u.dy),n.dispatchAction({seriesId:e.id,type:"treeRoam",dx:u.dx,dy:u.dy})}).on("zoom",function(u){WD(o,u.scale,u.originX,u.originY),n.dispatchAction({seriesId:e.id,type:"treeRoam",zoom:u.scale,originX:u.originX,originY:u.originY}),a._updateNodeAndLinkScale(e),n.updateLabelLayout()})},t.prototype._updateNodeAndLinkScale=function(e){var i=e.getData(),n=this._getNodeGlobalScale(e);i.eachItemGraphicEl(function(a,s){a.setSymbolScale(n)})},t.prototype._getNodeGlobalScale=function(e){var i=e.coordinateSystem;if(i.type!=="view")return 1;var n=this._nodeScaleRatio,a=i.scaleX||1,s=i.getZoom(),o=(s-1)*n+1;return o/a},t.prototype.dispose=function(){this._controller&&this._controller.dispose(),this._controllerHost=null},t.prototype.remove=function(){this._mainGroup.removeAll(),this._data=null},t.type="tree",t}(di);function k4(r,t){var e=r.getItemLayout(t);return e&&!isNaN(e.x)&&!isNaN(e.y)}function O4(r,t,e,i,n){var a=!e,s=r.tree.getNodeByDataIndex(t),o=s.getModel(),l=s.getVisual("style").fill,u=s.isExpand===!1&&s.children.length!==0?l:"#fff",c=r.tree.root,h=s.parentNode===c?s:s.parentNode||s,p=r.getItemGraphicEl(h.dataIndex),v=h.getLayout(),y=p?{x:p.__oldX,y:p.__oldY,rawX:p.__radialOldRawX,rawY:p.__radialOldRawY}:v,x=s.getLayout();a?(e=new N_(r,t,null,{symbolInnerColor:u,useNameLabel:!0}),e.x=y.x,e.y=y.y):e.updateData(r,t,null,{symbolInnerColor:u,useNameLabel:!0}),e.__radialOldRawX=e.__radialRawX,e.__radialOldRawY=e.__radialRawY,e.__radialRawX=x.rawX,e.__radialRawY=x.rawY,i.add(e),r.setItemGraphicEl(t,e),e.__oldX=e.x,e.__oldY=e.y,zr(e,{x:x.x,y:x.y},n);var w=e.getSymbolPath();if(n.get("layout")==="radial"){var T=c.children[0],E=T.getLayout(),M=T.children.length,L=void 0,F=void 0;if(x.x===E.x&&s.isExpand===!0&&T.children.length){var O={x:(T.children[0].getLayout().x+T.children[M-1].getLayout().x)/2,y:(T.children[0].getLayout().y+T.children[M-1].getLayout().y)/2};L=Math.atan2(O.y-E.y,O.x-E.x),L<0&&(L=Math.PI*2+L),F=O.x<E.x,F&&(L=L-Math.PI)}else L=Math.atan2(x.y-E.y,x.x-E.x),L<0&&(L=Math.PI*2+L),s.children.length===0||s.children.length!==0&&s.isExpand===!1?(F=x.x<E.x,F&&(L=L-Math.PI)):(F=x.x>E.x,F||(L=L-Math.PI));var U=F?"left":"right",W=o.getModel("label"),H=W.get("rotate"),j=H*(Math.PI/180),Y=w.getTextContent();Y&&(w.setTextConfig({position:W.get("position")||U,rotation:H==null?-L:j,origin:"center"}),Y.setStyle("verticalAlign","middle"))}var tt=o.get(["emphasis","focus"]),it=tt==="relative"?Wb(s.getAncestorsIndices(),s.getDescendantIndices()):tt==="ancestor"?s.getAncestorsIndices():tt==="descendant"?s.getDescendantIndices():null;it&&(Je(e).focus=it),sCt(n,s,c,e,y,v,x,i),e.__edge&&(e.onHoverStateChange=function(lt){if(lt!=="blur"){var ht=s.parentNode&&r.getItemGraphicEl(s.parentNode.dataIndex);ht&&ht.hoverState===I_||Jb(e.__edge,lt)}})}function sCt(r,t,e,i,n,a,s,o){var l=t.getModel(),u=r.get("edgeShape"),c=r.get("layout"),h=r.getOrient(),p=r.get(["lineStyle","curveness"]),v=r.get("edgeForkPosition"),y=l.getModel("lineStyle").getLineStyle(),x=i.__edge;if(u==="curve")t.parentNode&&t.parentNode!==e&&(x||(x=i.__edge=new IS({shape:zM(c,h,p,n,n)})),zr(x,{shape:zM(c,h,p,a,s)},r));else if(u==="polyline"&&c==="orthogonal"&&t!==e&&t.children&&t.children.length!==0&&t.isExpand===!0){for(var w=t.children,T=[],E=0;E<w.length;E++){var M=w[E].getLayout();T.push([M.x,M.y])}x||(x=i.__edge=new nCt({shape:{parentPoint:[s.x,s.y],childPoints:[[s.x,s.y]],orient:h,forkPosition:v}})),zr(x,{shape:{parentPoint:[s.x,s.y],childPoints:T}},r)}x&&!(u==="polyline"&&!t.isExpand)&&(x.useStyle(We({strokeNoScale:!0,fill:null},y)),ea(x,l,"lineStyle"),Gf(x),o.add(x))}function N4(r,t,e,i,n){var a=t.tree.root,s=Yj(a,r),o=s.source,l=s.sourceLayout,u=t.getItemGraphicEl(r.dataIndex);if(u){var c=t.getItemGraphicEl(o.dataIndex),h=c.__edge,p=u.__edge||(o.isExpand===!1||o.children.length===1?h:void 0),v=i.get("edgeShape"),y=i.get("layout"),x=i.get("orient"),w=i.get(["lineStyle","curveness"]);p&&(v==="curve"?$c(p,{shape:zM(y,x,w,l,l),style:{opacity:0}},i,{cb:function(){e.remove(p)},removeOpt:n}):v==="polyline"&&i.get("layout")==="orthogonal"&&$c(p,{shape:{parentPoint:[l.x,l.y],childPoints:[[l.x,l.y]]},style:{opacity:0}},i,{cb:function(){e.remove(p)},removeOpt:n}))}}function Yj(r,t){for(var e=t.parentNode===r?t:t.parentNode||t,i;i=e.getLayout(),i==null;)e=e.parentNode===r?e:e.parentNode||e;return{source:e,sourceLayout:i}}function F4(r,t,e,i,n){var a=r.tree.getNodeByDataIndex(t),s=r.tree.root,o=Yj(s,a).sourceLayout,l={duration:n.get("animationDurationUpdate"),easing:n.get("animationEasingUpdate")};$c(e,{x:o.x+1,y:o.y+1},n,{cb:function(){i.remove(e),r.setItemGraphicEl(t,null)},removeOpt:l}),e.fadeOut(null,r.hostModel,{fadeLabel:!0,animation:l}),a.children.forEach(function(u){N4(u,r,i,n,l)}),N4(a,r,i,n,l)}function zM(r,t,e,i,n){var a,s,o,l,u,c,h,p;if(r==="radial"){u=i.rawX,h=i.rawY,c=n.rawX,p=n.rawY;var v=Gm(u,h),y=Gm(u,h+(p-h)*e),x=Gm(c,p+(h-p)*e),w=Gm(c,p);return{x1:v.x||0,y1:v.y||0,x2:w.x||0,y2:w.y||0,cpx1:y.x||0,cpy1:y.y||0,cpx2:x.x||0,cpy2:x.y||0}}else u=i.x,h=i.y,c=n.x,p=n.y,(t==="LR"||t==="RL")&&(a=u+(c-u)*e,s=h,o=c+(u-c)*e,l=p),(t==="TB"||t==="BT")&&(a=u,s=h+(p-h)*e,o=c,l=p+(h-p)*e);return{x1:u,y1:h,x2:c,y2:p,cpx1:a,cpy1:s,cpx2:o,cpy2:l}}const oCt=aCt;var no=Ir();function Kj(r){var t=r.mainData,e=r.datas;e||(e={main:t},r.datasAttr={main:"data"}),r.datas=r.mainData=null,Jj(t,e,r),J(e,function(i){J(t.TRANSFERABLE_METHODS,function(n){i.wrapMethod(n,nr(lCt,r))})}),t.wrapMethod("cloneShallow",nr(cCt,r)),J(t.CHANGABLE_METHODS,function(i){t.wrapMethod(i,nr(uCt,r))}),Za(e[t.dataType]===t)}function lCt(r,t){if(dCt(this)){var e=Zt({},no(this).datas);e[this.dataType]=t,Jj(t,e,r)}else jD(t,this.dataType,no(this).mainData,r);return t}function uCt(r,t){return r.struct&&r.struct.update(),t}function cCt(r,t){return J(no(t).datas,function(e,i){e!==t&&jD(e.cloneShallow(),i,t,r)}),t}function hCt(r){var t=no(this).mainData;return r==null||t==null?t:no(t).datas[r]}function fCt(){var r=no(this).mainData;return r==null?[{data:r}]:te(br(no(r).datas),function(t){return{type:t,data:no(r).datas[t]}})}function dCt(r){return no(r).mainData===r}function Jj(r,t,e){no(r).datas={},J(t,function(i,n){jD(i,n,r,e)})}function jD(r,t,e,i){no(e).datas[t]=r,no(r).mainData=e,r.dataType=t,i.struct&&(r[i.structAttr]=i.struct,i.struct[i.datasAttr[t]]=r),r.getLinkedData=hCt,r.getLinkedDataAll=fCt}var pCt=function(){function r(t,e){this.depth=0,this.height=0,this.dataIndex=-1,this.children=[],this.viewChildren=[],this.isExpand=!1,this.name=t||"",this.hostTree=e}return r.prototype.isRemoved=function(){return this.dataIndex<0},r.prototype.eachNode=function(t,e,i){Ve(t)&&(i=e,e=t,t=null),t=t||{},ve(t)&&(t={order:t});var n=t.order||"preorder",a=this[t.attr||"children"],s;n==="preorder"&&(s=e.call(i,this));for(var o=0;!s&&o<a.length;o++)a[o].eachNode(t,e,i);n==="postorder"&&e.call(i,this)},r.prototype.updateDepthAndHeight=function(t){var e=0;this.depth=t;for(var i=0;i<this.children.length;i++){var n=this.children[i];n.updateDepthAndHeight(t+1),n.height>e&&(e=n.height)}this.height=e+1},r.prototype.getNodeById=function(t){if(this.getId()===t)return this;for(var e=0,i=this.children,n=i.length;e<n;e++){var a=i[e].getNodeById(t);if(a)return a}},r.prototype.contains=function(t){if(t===this)return!0;for(var e=0,i=this.children,n=i.length;e<n;e++){var a=i[e].contains(t);if(a)return a}},r.prototype.getAncestors=function(t){for(var e=[],i=t?this:this.parentNode;i;)e.push(i),i=i.parentNode;return e.reverse(),e},r.prototype.getAncestorsIndices=function(){for(var t=[],e=this;e;)t.push(e.dataIndex),e=e.parentNode;return t.reverse(),t},r.prototype.getDescendantIndices=function(){var t=[];return this.eachNode(function(e){t.push(e.dataIndex)}),t},r.prototype.getValue=function(t){var e=this.hostTree.data;return e.getStore().get(e.getDimensionIndex(t||"value"),this.dataIndex)},r.prototype.setLayout=function(t,e){this.dataIndex>=0&&this.hostTree.data.setItemLayout(this.dataIndex,t,e)},r.prototype.getLayout=function(){return this.hostTree.data.getItemLayout(this.dataIndex)},r.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostTree,i=e.data.getItemModel(this.dataIndex);return i.getModel(t)}},r.prototype.getLevelModel=function(){return(this.hostTree.levelModels||[])[this.depth]},r.prototype.setVisual=function(t,e){this.dataIndex>=0&&this.hostTree.data.setItemVisual(this.dataIndex,t,e)},r.prototype.getVisual=function(t){return this.hostTree.data.getItemVisual(this.dataIndex,t)},r.prototype.getRawIndex=function(){return this.hostTree.data.getRawIndex(this.dataIndex)},r.prototype.getId=function(){return this.hostTree.data.getId(this.dataIndex)},r.prototype.getChildIndex=function(){if(this.parentNode){for(var t=this.parentNode.children,e=0;e<t.length;++e)if(t[e]===this)return e;return-1}return-1},r.prototype.isAncestorOf=function(t){for(var e=t.parentNode;e;){if(e===this)return!0;e=e.parentNode}return!1},r.prototype.isDescendantOf=function(t){return t!==this&&t.isAncestorOf(this)},r}(),gCt=function(){function r(t){this.type="tree",this._nodes=[],this.hostModel=t}return r.prototype.eachNode=function(t,e,i){this.root.eachNode(t,e,i)},r.prototype.getNodeByDataIndex=function(t){var e=this.data.getRawIndex(t);return this._nodes[e]},r.prototype.getNodeById=function(t){return this.root.getNodeById(t)},r.prototype.update=function(){for(var t=this.data,e=this._nodes,i=0,n=e.length;i<n;i++)e[i].dataIndex=-1;for(var i=0,n=t.count();i<n;i++)e[t.getRawIndex(i)].dataIndex=i},r.prototype.clearLayouts=function(){this.data.clearItemLayouts()},r.createTree=function(t,e,i){var n=new r(e),a=[],s=1;o(t);function o(c,h){var p=c.value;s=Math.max(s,Kt(p)?p.length:1),a.push(c);var v=new pCt(xn(c.name,""),n);h?vCt(v,h):n.root=v,n._nodes.push(v);var y=c.children;if(y)for(var x=0;x<y.length;x++)o(y[x],v)}n.root.updateDepthAndHeight(0);var l=k_(a,{coordDimensions:["value"],dimensionsCount:s}).dimensions,u=new Xa(l,e);return u.initData(a),i&&i(u),Kj({mainData:u,struct:n,structAttr:"tree"}),n.update(),n},r}();function vCt(r,t){var e=t.children;r.parentNode!==t&&(e.push(r),r.parentNode=t)}const XD=gCt;function a_(r,t,e){if(r&&pr(t,r.type)>=0){var i=e.getData().tree.root,n=r.targetNode;if(ve(n)&&(n=i.getNodeById(n)),n&&i.contains(n))return{node:n};var a=r.targetNodeId;if(a!=null&&(n=i.getNodeById(a)))return{node:n}}}function Qj(r){for(var t=[];r;)r=r.parentNode,r&&t.push(r);return t.reverse()}function ZD(r,t){var e=Qj(r);return pr(e,t)>=0}function YS(r,t){for(var e=[];r;){var i=r.dataIndex;e.push({name:r.name,dataIndex:i,value:t.getRawValue(i)}),r=r.parentNode}return e.reverse(),e}var mCt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.hasSymbolVisual=!0,e.ignoreStyleOnData=!0,e}return t.prototype.getInitialData=function(e){var i={name:e.name,children:e.data},n=e.leaves||{},a=new fi(n,this,this.ecModel),s=XD.createTree(i,this,o);function o(h){h.wrapMethod("getItemModel",function(p,v){var y=s.getNodeByDataIndex(v);return y&&y.children.length&&y.isExpand||(p.parentModel=a),p})}var l=0;s.eachNode("preorder",function(h){h.depth>l&&(l=h.depth)});var u=e.expandAndCollapse,c=u&&e.initialTreeDepth>=0?e.initialTreeDepth:l;return s.root.eachNode("preorder",function(h){var p=h.hostTree.data.getRawDataItem(h.dataIndex);h.isExpand=p&&p.collapsed!=null?!p.collapsed:h.depth<=c}),s.data},t.prototype.getOrient=function(){var e=this.get("orient");return e==="horizontal"?e="LR":e==="vertical"&&(e="TB"),e},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.formatTooltip=function(e,i,n){for(var a=this.getData().tree,s=a.root.children[0],o=a.getNodeByDataIndex(e),l=o.getValue(),u=o.name;o&&o!==s;)u=o.parentNode.name+"."+u,o=o.parentNode;return Ln("nameValue",{name:u,value:l,noValue:isNaN(l)||l==null})},t.prototype.getDataParams=function(e){var i=r.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(e);return i.treeAncestors=YS(n,this),i.collapsed=!n.isExpand,i},t.type="series.tree",t.layoutMode="box",t.defaultOption={z:2,coordinateSystem:"view",left:"12%",top:"12%",right:"12%",bottom:"12%",layout:"orthogonal",edgeShape:"curve",edgeForkPosition:"50%",roam:!1,nodeScaleRatio:.4,center:null,zoom:1,orient:"LR",symbol:"emptyCircle",symbolSize:7,expandAndCollapse:!0,initialTreeDepth:2,lineStyle:{color:"#ccc",width:1.5,curveness:.5},itemStyle:{color:"lightsteelblue",borderWidth:1.5},label:{show:!0},animationEasing:"linear",animationDuration:700,animationDurationUpdate:500},t}(Li);const yCt=mCt;function _Ct(r,t,e){for(var i=[r],n=[],a;a=i.pop();)if(n.push(a),a.isExpand){var s=a.children;if(s.length)for(var o=0;o<s.length;o++)i.push(s[o])}for(;a=n.pop();)t(a,e)}function Sm(r,t){for(var e=[r],i;i=e.pop();)if(t(i),i.isExpand){var n=i.children;if(n.length)for(var a=n.length-1;a>=0;a--)e.push(n[a])}}function xCt(r,t){r.eachSeriesByType("tree",function(e){bCt(e,t)})}function bCt(r,t){var e=K2t(r,t);r.layoutInfo=e;var i=r.get("layout"),n=0,a=0,s=null;i==="radial"?(n=2*Math.PI,a=Math.min(e.height,e.width)/2,s=L4(function(M,L){return(M.parentNode===L.parentNode?1:2)/M.depth})):(n=e.width,a=e.height,s=L4());var o=r.getData().tree.root,l=o.children[0];if(l){Z2t(o),_Ct(l,q2t,s),o.hierNode.modifier=-l.hierNode.prelim,Sm(l,Y2t);var u=l,c=l,h=l;Sm(l,function(M){var L=M.getLayout().x;L<u.getLayout().x&&(u=M),L>c.getLayout().x&&(c=M),M.depth>h.depth&&(h=M)});var p=u===c?1:s(u,c)/2,v=p-u.getLayout().x,y=0,x=0,w=0,T=0;if(i==="radial")y=n/(c.getLayout().x+p+v),x=a/(h.depth-1||1),Sm(l,function(M){w=(M.getLayout().x+v)*y,T=(M.depth-1)*x;var L=Gm(w,T);M.setLayout({x:L.x,y:L.y,rawX:w,rawY:T},!0)});else{var E=r.getOrient();E==="RL"||E==="LR"?(x=a/(c.getLayout().x+p+v),y=n/(h.depth-1||1),Sm(l,function(M){T=(M.getLayout().x+v)*x,w=E==="LR"?(M.depth-1)*y:n-(M.depth-1)*y,M.setLayout({x:w,y:T},!0)})):(E==="TB"||E==="BT")&&(y=n/(c.getLayout().x+p+v),x=a/(h.depth-1||1),Sm(l,function(M){w=(M.getLayout().x+v)*y,T=E==="TB"?(M.depth-1)*x:a-(M.depth-1)*x,M.setLayout({x:w,y:T},!0)}))}}}function wCt(r){r.eachSeriesByType("tree",function(t){var e=t.getData(),i=e.tree;i.eachNode(function(n){var a=n.getModel(),s=a.getModel("itemStyle").getItemStyle(),o=e.ensureUniqueItemVisual(n.dataIndex,"style");Zt(o,s)})})}function SCt(r){r.registerAction({type:"treeExpandAndCollapse",event:"treeExpandAndCollapse",update:"update"},function(t,e){e.eachComponent({mainType:"series",subType:"tree",query:t},function(i){var n=t.dataIndex,a=i.getData().tree,s=a.getNodeByDataIndex(n);s.isExpand=!s.isExpand})}),r.registerAction({type:"treeRoam",event:"treeRoam",update:"none"},function(t,e,i){e.eachComponent({mainType:"series",subType:"tree",query:t},function(n){var a=n.coordinateSystem,s=GD(a,t,void 0,i);n.setCenter&&n.setCenter(s.center),n.setZoom&&n.setZoom(s.zoom)})})}function TCt(r){r.registerChartView(oCt),r.registerSeriesModel(yCt),r.registerLayout(xCt),r.registerVisual(wCt),SCt(r)}var B4=["treemapZoomToNode","treemapRender","treemapMove"];function ACt(r){for(var t=0;t<B4.length;t++)r.registerAction({type:B4[t],update:"updateView"},nn);r.registerAction({type:"treemapRootToNode",update:"updateView"},function(e,i){i.eachComponent({mainType:"series",subType:"treemap",query:e},n);function n(a,s){var o=["treemapZoomToNode","treemapRootToNode"],l=a_(e,o,a);if(l){var u=a.getViewRoot();u&&(e.direction=ZD(u,l.node)?"rollUp":"drillDown"),a.resetViewRoot(l.node)}}})}function tX(r){var t=r.getData(),e=t.tree,i={};e.eachNode(function(n){for(var a=n;a&&a.depth>1;)a=a.parentNode;var s=pM(r.ecModel,a.name||a.dataIndex+"",i);n.setVisual("decal",s)})}var CCt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.preventUsingHoverLayer=!0,e}return t.prototype.getInitialData=function(e,i){var n={name:e.name,children:e.data};eX(n);var a=e.levels||[],s=this.designatedVisualItemStyle={},o=new fi({itemStyle:s},this,i);a=e.levels=ECt(a,i);var l=te(a||[],function(h){return new fi(h,o,i)},this),u=XD.createTree(n,this,c);function c(h){h.wrapMethod("getItemModel",function(p,v){var y=u.getNodeByDataIndex(v),x=y?l[y.depth]:null;return p.parentModel=x||o,p})}return u.data},t.prototype.optionUpdated=function(){this.resetViewRoot()},t.prototype.formatTooltip=function(e,i,n){var a=this.getData(),s=this.getRawValue(e),o=a.getName(e);return Ln("nameValue",{name:o,value:s})},t.prototype.getDataParams=function(e){var i=r.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(e);return i.treeAncestors=YS(n,this),i.treePathInfo=i.treeAncestors,i},t.prototype.setLayoutInfo=function(e){this.layoutInfo=this.layoutInfo||{},Zt(this.layoutInfo,e)},t.prototype.mapIdToIndex=function(e){var i=this._idIndexMap;i||(i=this._idIndexMap=Re(),this._idIndexMapCount=0);var n=i.get(e);return n==null&&i.set(e,n=this._idIndexMapCount++),n},t.prototype.getViewRoot=function(){return this._viewRoot},t.prototype.resetViewRoot=function(e){e?this._viewRoot=e:e=this._viewRoot;var i=this.getRawData().tree.root;(!e||e!==i&&!i.contains(e))&&(this._viewRoot=i)},t.prototype.enableAriaDecal=function(){tX(this)},t.type="series.treemap",t.layoutMode="box",t.defaultOption={progressive:0,left:"center",top:"middle",width:"80%",height:"80%",sort:!0,clipWindow:"origin",squareRatio:.5*(1+Math.sqrt(5)),leafDepth:null,drillDownIcon:"",zoomToNodeRatio:.32*.32,scaleLimit:null,roam:!0,nodeClick:"zoomToNode",animation:!0,animationDurationUpdate:900,animationEasing:"quinticInOut",breadcrumb:{show:!0,height:22,left:"center",top:"bottom",emptyItemWidth:25,itemStyle:{color:"rgba(0,0,0,0.7)",textStyle:{color:"#fff"}},emphasis:{itemStyle:{color:"rgba(0,0,0,0.9)"}}},label:{show:!0,distance:0,padding:5,position:"inside",color:"#fff",overflow:"truncate"},upperLabel:{show:!1,position:[0,"50%"],height:20,overflow:"truncate",verticalAlign:"middle"},itemStyle:{color:null,colorAlpha:null,colorSaturation:null,borderWidth:0,gapWidth:0,borderColor:"#fff",borderColorSaturation:null},emphasis:{upperLabel:{show:!0,position:[0,"50%"],overflow:"truncate",verticalAlign:"middle"}},visualDimension:0,visualMin:null,visualMax:null,color:[],colorAlpha:null,colorSaturation:null,colorMappingBy:"index",visibleMin:10,childrenVisibleMin:null,levels:[]},t}(Li);function eX(r){var t=0;J(r.children,function(i){eX(i);var n=i.value;Kt(n)&&(n=n[0]),t+=n});var e=r.value;Kt(e)&&(e=e[0]),(e==null||isNaN(e))&&(e=t),e<0&&(e=0),Kt(r.value)?r.value[0]=e:r.value=e}function ECt(r,t){var e=ri(t.get("color")),i=ri(t.get(["aria","decal","decals"]));if(e){r=r||[];var n,a;J(r,function(o){var l=new fi(o),u=l.get("color"),c=l.get("decal");(l.get(["itemStyle","color"])||u&&u!=="none")&&(n=!0),(l.get(["itemStyle","decal"])||c&&c!=="none")&&(a=!0)});var s=r[0]||(r[0]={});return n||(s.color=e.slice()),!a&&i&&(s.decal=i.slice()),r}}const ICt=CCt;var MCt=8,z4=8,AC=5,PCt=function(){function r(t){this.group=new Ke,t.add(this.group)}return r.prototype.render=function(t,e,i,n){var a=t.getModel("breadcrumb"),s=this.group;if(s.removeAll(),!(!a.get("show")||!i)){var o=a.getModel("itemStyle"),l=a.getModel("emphasis"),u=o.getModel("textStyle"),c=l.getModel(["itemStyle","textStyle"]),h={pos:{left:a.get("left"),right:a.get("right"),top:a.get("top"),bottom:a.get("bottom")},box:{width:e.getWidth(),height:e.getHeight()},emptyItemWidth:a.get("emptyItemWidth"),totalWidth:0,renderList:[]};this._prepare(i,h,u),this._renderContent(t,h,o,l,u,c,n),FS(s,h.pos,h.box)}},r.prototype._prepare=function(t,e,i){for(var n=t;n;n=n.parentNode){var a=xn(n.getModel().get("name"),""),s=i.getTextRect(a),o=Math.max(s.width+MCt*2,e.emptyItemWidth);e.totalWidth+=o+z4,e.renderList.push({node:n,text:a,width:o})}},r.prototype._renderContent=function(t,e,i,n,a,s,o){for(var l=0,u=e.emptyItemWidth,c=t.get(["breadcrumb","height"]),h=z0t(e.pos,e.box),p=e.totalWidth,v=e.renderList,y=n.getModel("itemStyle").getItemStyle(),x=v.length-1;x>=0;x--){var w=v[x],T=w.node,E=w.width,M=w.text;p>h.width&&(p-=E-u,E=u,M=null);var L=new ds({shape:{points:RCt(l,0,E,c,x===v.length-1,x===0)},style:We(i.getItemStyle(),{lineJoin:"bevel"}),textContent:new Nr({style:hi(a,{text:M})}),textConfig:{position:"inside"},z2:Rg*1e4,onclick:nr(o,T)});L.disableLabelAnimation=!0,L.getTextContent().ensureState("emphasis").style=hi(s,{text:M}),L.ensureState("emphasis").style=y,Ui(L,n.get("focus"),n.get("blurScope"),n.get("disabled")),this.group.add(L),DCt(L,t,T),l+=E+z4}},r.prototype.remove=function(){this.group.removeAll()},r}();function RCt(r,t,e,i,n,a){var s=[[n?r:r-AC,t],[r+e,t],[r+e,t+i],[n?r:r-AC,t+i]];return!a&&s.splice(2,0,[r+e+AC,t+i/2]),!n&&s.push([r,t+i/2]),s}function DCt(r,t,e){Je(r).eventData={componentType:"series",componentSubType:"treemap",componentIndex:t.componentIndex,seriesIndex:t.seriesIndex,seriesName:t.name,seriesType:"treemap",selfType:"breadcrumb",nodeData:{dataIndex:e&&e.dataIndex,name:e&&e.name},treePathInfo:e&&YS(e,t)}}const LCt=PCt;var kCt=function(){function r(){this._storage=[],this._elExistsMap={}}return r.prototype.add=function(t,e,i,n,a){return this._elExistsMap[t.id]?!1:(this._elExistsMap[t.id]=!0,this._storage.push({el:t,target:e,duration:i,delay:n,easing:a}),!0)},r.prototype.finished=function(t){return this._finishedCallback=t,this},r.prototype.start=function(){for(var t=this,e=this._storage.length,i=function(){e--,e<=0&&(t._storage.length=0,t._elExistsMap={},t._finishedCallback&&t._finishedCallback())},n=0,a=this._storage.length;n<a;n++){var s=this._storage[n];s.el.animateTo(s.target,{duration:s.duration,delay:s.delay,easing:s.easing,setToFinal:!0,done:i,aborted:i})}return this},r}();function OCt(){return new kCt}var VM=Ke,V4=Pr,U4=3,$4="label",W4="upperLabel",NCt=Rg*10,FCt=Rg*2,BCt=Rg*3,Jh=Hf([["fill","color"],["stroke","strokeColor"],["lineWidth","strokeWidth"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),H4=function(r){var t=Jh(r);return t.stroke=t.fill=t.lineWidth=null,t},bw=Ir(),zCt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e._state="ready",e._storage=Tm(),e}return t.prototype.render=function(e,i,n,a){var s=i.findComponents({mainType:"series",subType:"treemap",query:a});if(!(pr(s,e)<0)){this.seriesModel=e,this.api=n,this.ecModel=i;var o=["treemapZoomToNode","treemapRootToNode"],l=a_(a,o,e),u=a&&a.type,c=e.layoutInfo,h=!this._oldTree,p=this._storage,v=u==="treemapRootToNode"&&l&&p?{rootNodeGroup:p.nodeGroup[l.node.getRawIndex()],direction:a.direction}:null,y=this._giveContainerGroup(c),x=e.get("animation"),w=this._doRender(y,e,v);x&&!h&&(!u||u==="treemapZoomToNode"||u==="treemapRootToNode")?this._doAnimation(y,w,e,v):w.renderFinally(),this._resetController(n),this._renderBreadcrumb(e,n,l)}},t.prototype._giveContainerGroup=function(e){var i=this._containerGroup;return i||(i=this._containerGroup=new VM,this._initEvents(i),this.group.add(i)),i.x=e.x,i.y=e.y,i},t.prototype._doRender=function(e,i,n){var a=i.getData().tree,s=this._oldTree,o=Tm(),l=Tm(),u=this._storage,c=[];function h(E,M,L,F){return VCt(i,l,u,n,o,c,E,M,L,F)}x(a.root?[a.root]:[],s&&s.root?[s.root]:[],e,a===s||!s,0);var p=w(u);if(this._oldTree=a,this._storage=l,this._controllerHost){var v=this.seriesModel.layoutInfo,y=a.root.getLayout();y.width===v.width&&y.height===v.height&&(this._controllerHost.zoom=1)}return{lastsForAnimation:o,willDeleteEls:p,renderFinally:T};function x(E,M,L,F,O){F?(M=E,J(E,function(H,j){!H.isRemoved()&&W(j,j)})):new yu(M,E,U,U).add(W).update(W).remove(nr(W,null)).execute();function U(H){return H.getId()}function W(H,j){var Y=H!=null?E[H]:null,tt=j!=null?M[j]:null,it=h(Y,tt,L,O);it&&x(Y&&Y.viewChildren||[],tt&&tt.viewChildren||[],it,F,O+1)}}function w(E){var M=Tm();return E&&J(E,function(L,F){var O=M[F];J(L,function(U){U&&(O.push(U),bw(U).willDelete=!0)})}),M}function T(){J(p,function(E){J(E,function(M){M.parent&&M.parent.remove(M)})}),J(c,function(E){E.invisible=!0,E.dirty()})}},t.prototype._doAnimation=function(e,i,n,a){var s=n.get("animationDurationUpdate"),o=n.get("animationEasing"),l=(Ve(s)?0:s)||0,u=(Ve(o)?null:o)||"cubicOut",c=OCt();J(i.willDeleteEls,function(h,p){J(h,function(v,y){if(!v.invisible){var x=v.parent,w,T=bw(x);if(a&&a.direction==="drillDown")w=x===a.rootNodeGroup?{shape:{x:0,y:0,width:T.nodeWidth,height:T.nodeHeight},style:{opacity:0}}:{style:{opacity:0}};else{var E=0,M=0;T.willDelete||(E=T.nodeWidth/2,M=T.nodeHeight/2),w=p==="nodeGroup"?{x:E,y:M,style:{opacity:0}}:{shape:{x:E,y:M,width:0,height:0},style:{opacity:0}}}w&&c.add(v,w,l,0,u)}})}),J(this._storage,function(h,p){J(h,function(v,y){var x=i.lastsForAnimation[p][y],w={};x&&(v instanceof Ke?x.oldX!=null&&(w.x=v.x,w.y=v.y,v.x=x.oldX,v.y=x.oldY):(x.oldShape&&(w.shape=Zt({},v.shape),v.setShape(x.oldShape)),x.fadein?(v.setStyle("opacity",0),w.style={opacity:1}):v.style.opacity!==1&&(w.style={opacity:1})),c.add(v,w,l,0,u))})},this),this._state="animating",c.finished(we(function(){this._state="ready",i.renderFinally()},this)).start()},t.prototype._resetController=function(e){var i=this._controller,n=this._controllerHost;n||(this._controllerHost={target:this.group},n=this._controllerHost),i||(i=this._controller=new $_(e.getZr()),i.enable(this.seriesModel.get("roam")),n.zoomLimit=this.seriesModel.get("scaleLimit"),n.zoom=this.seriesModel.get("zoom"),i.on("pan",we(this._onPan,this)),i.on("zoom",we(this._onZoom,this)));var a=new hr(0,0,e.getWidth(),e.getHeight());i.setPointerChecker(function(s,o,l){return a.contain(o,l)})},t.prototype._clearController=function(){var e=this._controller;this._controllerHost=null,e&&(e.dispose(),e=null)},t.prototype._onPan=function(e){if(this._state!=="animating"&&(Math.abs(e.dx)>U4||Math.abs(e.dy)>U4)){var i=this.seriesModel.getData().tree.root;if(!i)return;var n=i.getLayout();if(!n)return;this.api.dispatchAction({type:"treemapMove",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:n.x+e.dx,y:n.y+e.dy,width:n.width,height:n.height}})}},t.prototype._onZoom=function(e){var i=e.originX,n=e.originY,a=e.scale;if(this._state!=="animating"){var s=this.seriesModel.getData().tree.root;if(!s)return;var o=s.getLayout();if(!o)return;var l=new hr(o.x,o.y,o.width,o.height),u=null,c=this._controllerHost;u=c.zoomLimit;var h=c.zoom=c.zoom||1;if(h*=a,u){var p=u.min||0,v=u.max||1/0;h=Math.max(Math.min(v,h),p)}var y=h/c.zoom;c.zoom=h;var x=this.seriesModel.layoutInfo;i-=x.x,n-=x.y;var w=Es();wl(w,w,[-i,-n]),kR(w,w,[y,y]),wl(w,w,[i,n]),l.applyTransform(w),this.api.dispatchAction({type:"treemapRender",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:l.x,y:l.y,width:l.width,height:l.height}})}},t.prototype._initEvents=function(e){var i=this;e.on("click",function(n){if(i._state==="ready"){var a=i.seriesModel.get("nodeClick",!0);if(a){var s=i.findTarget(n.offsetX,n.offsetY);if(s){var o=s.node;if(o.getLayout().isLeafRoot)i._rootToNode(s);else if(a==="zoomToNode")i._zoomToNode(s);else if(a==="link"){var l=o.hostTree.data.getItemModel(o.dataIndex),u=l.get("link",!0),c=l.get("target",!0)||"blank";u&&nw(u,c)}}}}},this)},t.prototype._renderBreadcrumb=function(e,i,n){var a=this;n||(n=e.get("leafDepth",!0)!=null?{node:e.getViewRoot()}:this.findTarget(i.getWidth()/2,i.getHeight()/2),n||(n={node:e.getData().tree.root})),(this._breadcrumb||(this._breadcrumb=new LCt(this.group))).render(e,i,n.node,function(s){a._state!=="animating"&&(ZD(e.getViewRoot(),s)?a._rootToNode({node:s}):a._zoomToNode({node:s}))})},t.prototype.remove=function(){this._clearController(),this._containerGroup&&this._containerGroup.removeAll(),this._storage=Tm(),this._state="ready",this._breadcrumb&&this._breadcrumb.remove()},t.prototype.dispose=function(){this._clearController()},t.prototype._zoomToNode=function(e){this.api.dispatchAction({type:"treemapZoomToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:e.node})},t.prototype._rootToNode=function(e){this.api.dispatchAction({type:"treemapRootToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:e.node})},t.prototype.findTarget=function(e,i){var n,a=this.seriesModel.getViewRoot();return a.eachNode({attr:"viewChildren",order:"preorder"},function(s){var o=this._storage.background[s.getRawIndex()];if(o){var l=o.transformCoordToLocal(e,i),u=o.shape;if(u.x<=l[0]&&l[0]<=u.x+u.width&&u.y<=l[1]&&l[1]<=u.y+u.height)n={node:s,offsetX:l[0],offsetY:l[1]};else return!1}},this),n},t.type="treemap",t}(di);function Tm(){return{nodeGroup:[],background:[],content:[]}}function VCt(r,t,e,i,n,a,s,o,l,u){if(!s)return;var c=s.getLayout(),h=r.getData(),p=s.getModel();if(h.setItemGraphicEl(s.dataIndex,null),!c||!c.isInView)return;var v=c.width,y=c.height,x=c.borderWidth,w=c.invisible,T=s.getRawIndex(),E=o&&o.getRawIndex(),M=s.viewChildren,L=c.upperHeight,F=M&&M.length,O=p.getModel("itemStyle"),U=p.getModel(["emphasis","itemStyle"]),W=p.getModel(["blur","itemStyle"]),H=p.getModel(["select","itemStyle"]),j=O.get("borderRadius")||0,Y=ye("nodeGroup",VM);if(!Y)return;if(l.add(Y),Y.x=c.x||0,Y.y=c.y||0,Y.markRedraw(),bw(Y).nodeWidth=v,bw(Y).nodeHeight=y,c.isAboveViewRoot)return Y;var tt=ye("background",V4,u,FCt);tt&&Ut(Y,tt,F&&c.upperLabelHeight);var it=p.getModel("emphasis"),lt=it.get("focus"),ht=it.get("blurScope"),Tt=it.get("disabled"),Ot=lt==="ancestor"?s.getAncestorsIndices():lt==="descendant"?s.getDescendantIndices():lt;if(F)Xy(Y)&&gf(Y,!1),tt&&(gf(tt,!Tt),h.setItemGraphicEl(s.dataIndex,tt),sM(tt,Ot,ht));else{var Rt=ye("content",V4,u,BCt);Rt&&Jt(Y,Rt),tt.disableMorphing=!0,tt&&Xy(tt)&&gf(tt,!1),gf(Y,!Tt),h.setItemGraphicEl(s.dataIndex,Y),sM(Y,Ot,ht)}return Y;function Ut(ke,Ce,Ee){var Ie=Je(Ce);if(Ie.dataIndex=s.dataIndex,Ie.seriesIndex=r.seriesIndex,Ce.setShape({x:0,y:0,width:v,height:y,r:j}),w)ne(Ce);else{Ce.invisible=!1;var Se=s.getVisual("style"),Fe=Se.stroke,Rr=H4(O);Rr.fill=Fe;var tr=Jh(U);tr.fill=U.get("borderColor");var Vr=Jh(W);Vr.fill=W.get("borderColor");var _r=Jh(H);if(_r.fill=H.get("borderColor"),Ee){var Xr=v-2*x;se(Ce,Fe,Se.opacity,{x,y:0,width:Xr,height:L})}else Ce.removeTextContent();Ce.setStyle(Rr),Ce.ensureState("emphasis").style=tr,Ce.ensureState("blur").style=Vr,Ce.ensureState("select").style=_r,Gf(Ce)}ke.add(Ce)}function Jt(ke,Ce){var Ee=Je(Ce);Ee.dataIndex=s.dataIndex,Ee.seriesIndex=r.seriesIndex;var Ie=Math.max(v-2*x,0),Se=Math.max(y-2*x,0);if(Ce.culling=!0,Ce.setShape({x,y:x,width:Ie,height:Se,r:j}),w)ne(Ce);else{Ce.invisible=!1;var Fe=s.getVisual("style"),Rr=Fe.fill,tr=H4(O);tr.fill=Rr,tr.decal=Fe.decal;var Vr=Jh(U),_r=Jh(W),Xr=Jh(H);se(Ce,Rr,Fe.opacity,null),Ce.setStyle(tr),Ce.ensureState("emphasis").style=Vr,Ce.ensureState("blur").style=_r,Ce.ensureState("select").style=Xr,Gf(Ce)}ke.add(Ce)}function ne(ke){!ke.invisible&&a.push(ke)}function se(ke,Ce,Ee,Ie){var Se=p.getModel(Ie?W4:$4),Fe=xn(p.get("name"),null),Rr=Se.getShallow("show");ra(ke,Dn(p,Ie?W4:$4),{defaultText:Rr?Fe:null,inheritColor:Ce,defaultOpacity:Ee,labelFetcher:r,labelDataIndex:s.dataIndex});var tr=ke.getTextContent();if(tr){var Vr=tr.style,_r=RR(Vr.padding||0);Ie&&(ke.setTextConfig({layoutRect:Ie}),tr.disableLabelLayout=!0),tr.beforeUpdate=function(){var Hi=Math.max((Ie?Ie.width:ke.shape.width)-_r[1]-_r[3],0),wi=Math.max((Ie?Ie.height:ke.shape.height)-_r[0]-_r[2],0);(Vr.width!==Hi||Vr.height!==wi)&&tr.setStyle({width:Hi,height:wi})},Vr.truncateMinChar=2,Vr.lineOverflow="truncate",ce(Vr,Ie,c);var Xr=tr.getState("emphasis");ce(Xr?Xr.style:null,Ie,c)}}function ce(ke,Ce,Ee){var Ie=ke?ke.text:null;if(!Ce&&Ee.isLeafRoot&&Ie!=null){var Se=r.get("drillDownIcon",!0);ke.text=Se?Se+" "+Ie:Ie}}function ye(ke,Ce,Ee,Ie){var Se=E!=null&&e[ke][E],Fe=n[ke];return Se?(e[ke][E]=null,Qe(Fe,Se)):w||(Se=new Ce,Se instanceof ao&&(Se.z2=UCt(Ee,Ie)),sr(Fe,Se)),t[ke][T]=Se}function Qe(ke,Ce){var Ee=ke[T]={};Ce instanceof VM?(Ee.oldX=Ce.x,Ee.oldY=Ce.y):Ee.oldShape=Zt({},Ce.shape)}function sr(ke,Ce){var Ee=ke[T]={},Ie=s.parentNode,Se=Ce instanceof Ke;if(Ie&&(!i||i.direction==="drillDown")){var Fe=0,Rr=0,tr=n.background[Ie.getRawIndex()];!i&&tr&&tr.oldShape&&(Fe=tr.oldShape.width,Rr=tr.oldShape.height),Se?(Ee.oldX=0,Ee.oldY=Rr):Ee.oldShape={x:Fe,y:Rr,width:0,height:0}}Ee.fadein=!Se}}function UCt(r,t){return r*NCt+t}const $Ct=zCt;var s_=J,WCt=je,ww=-1,qD=function(){function r(t){var e=t.mappingMethod,i=t.type,n=this.option=Ze(t);this.type=i,this.mappingMethod=e,this._normalizeData=jCt[e];var a=r.visualHandlers[i];this.applyVisual=a.applyVisual,this.getColorMapper=a.getColorMapper,this._normalizedToVisual=a._normalizedToVisual[e],e==="piecewise"?(CC(n),HCt(n)):e==="category"?n.categories?GCt(n):CC(n,!0):(Za(e!=="linear"||n.dataExtent),CC(n))}return r.prototype.mapValueToVisual=function(t){var e=this._normalizeData(t);return this._normalizedToVisual(e,t)},r.prototype.getNormalizer=function(){return we(this._normalizeData,this)},r.listVisualTypes=function(){return br(r.visualHandlers)},r.isValidType=function(t){return r.visualHandlers.hasOwnProperty(t)},r.eachVisual=function(t,e,i){je(t)?J(t,e,i):e.call(i,t)},r.mapVisual=function(t,e,i){var n,a=Kt(t)?[]:je(t)?{}:(n=!0,null);return r.eachVisual(t,function(s,o){var l=e.call(i,s,o);n?a=l:a[o]=l}),a},r.retrieveVisuals=function(t){var e={},i;return t&&s_(r.visualHandlers,function(n,a){t.hasOwnProperty(a)&&(e[a]=t[a],i=!0)}),i?e:null},r.prepareVisualTypes=function(t){if(Kt(t))t=t.slice();else if(WCt(t)){var e=[];s_(t,function(i,n){e.push(n)}),t=e}else return[];return t.sort(function(i,n){return n==="color"&&i!=="color"&&i.indexOf("color")===0?1:-1}),t},r.dependsOn=function(t,e){return e==="color"?!!(t&&t.indexOf(e)===0):t===e},r.findPieceIndex=function(t,e,i){for(var n,a=1/0,s=0,o=e.length;s<o;s++){var l=e[s].value;if(l!=null){if(l===t||ve(l)&&l===t+"")return s;i&&p(l,s)}}for(var s=0,o=e.length;s<o;s++){var u=e[s],c=u.interval,h=u.close;if(c){if(c[0]===-1/0){if(v1(h[1],t,c[1]))return s}else if(c[1]===1/0){if(v1(h[0],c[0],t))return s}else if(v1(h[0],c[0],t)&&v1(h[1],t,c[1]))return s;i&&p(c[0],s),i&&p(c[1],s)}}if(i)return t===1/0?e.length-1:t===-1/0?0:n;function p(v,y){var x=Math.abs(v-t);x<a&&(a=x,n=y)}},r.visualHandlers={color:{applyVisual:Am("color"),getColorMapper:function(){var t=this.option;return we(t.mappingMethod==="category"?function(e,i){return!i&&(e=this._normalizeData(e)),jm.call(this,e)}:function(e,i,n){var a=!!n;return!i&&(e=this._normalizeData(e)),n=s2(e,t.parsedVisual,n),a?n:uu(n,"rgba")},this)},_normalizedToVisual:{linear:function(t){return uu(s2(t,this.option.parsedVisual),"rgba")},category:jm,piecewise:function(t,e){var i=$M.call(this,e);return i==null&&(i=uu(s2(t,this.option.parsedVisual),"rgba")),i},fixed:Qh}},colorHue:g1(function(t,e){return ny(t,e)}),colorSaturation:g1(function(t,e){return ny(t,null,e)}),colorLightness:g1(function(t,e){return ny(t,null,null,e)}),colorAlpha:g1(function(t,e){return jb(t,e)}),decal:{applyVisual:Am("decal"),_normalizedToVisual:{linear:null,category:jm,piecewise:null,fixed:null}},opacity:{applyVisual:Am("opacity"),_normalizedToVisual:UM([0,1])},liftZ:{applyVisual:Am("liftZ"),_normalizedToVisual:{linear:Qh,category:Qh,piecewise:Qh,fixed:Qh}},symbol:{applyVisual:function(t,e,i){var n=this.mapValueToVisual(t);i("symbol",n)},_normalizedToVisual:{linear:G4,category:jm,piecewise:function(t,e){var i=$M.call(this,e);return i==null&&(i=G4.call(this,t)),i},fixed:Qh}},symbolSize:{applyVisual:Am("symbolSize"),_normalizedToVisual:UM([0,1])}},r}();function HCt(r){var t=r.pieceList;r.hasSpecialVisual=!1,J(t,function(e,i){e.originIndex=i,e.visual!=null&&(r.hasSpecialVisual=!0)})}function GCt(r){var t=r.categories,e=r.categoryMap={},i=r.visual;if(s_(t,function(s,o){e[s]=o}),!Kt(i)){var n=[];je(i)?s_(i,function(s,o){var l=e[o];n[l??ww]=s}):n[ww]=i,i=rX(r,n)}for(var a=t.length-1;a>=0;a--)i[a]==null&&(delete e[t[a]],t.pop())}function CC(r,t){var e=r.visual,i=[];je(e)?s_(e,function(a){i.push(a)}):e!=null&&i.push(e);var n={color:1,symbol:1};!t&&i.length===1&&!n.hasOwnProperty(r.type)&&(i[1]=i[0]),rX(r,i)}function g1(r){return{applyVisual:function(t,e,i){var n=this.mapValueToVisual(t);i("color",r(e("color"),n))},_normalizedToVisual:UM([0,1])}}function G4(r){var t=this.option.visual;return t[Math.round(Jr(r,[0,1],[0,t.length-1],!0))]||{}}function Am(r){return function(t,e,i){i(r,this.mapValueToVisual(t))}}function jm(r){var t=this.option.visual;return t[this.option.loop&&r!==ww?r%t.length:r]}function Qh(){return this.option.visual[0]}function UM(r){return{linear:function(t){return Jr(t,r,this.option.visual,!0)},category:jm,piecewise:function(t,e){var i=$M.call(this,e);return i==null&&(i=Jr(t,r,this.option.visual,!0)),i},fixed:Qh}}function $M(r){var t=this.option,e=t.pieceList;if(t.hasSpecialVisual){var i=qD.findPieceIndex(r,e),n=e[i];if(n&&n.visual)return n.visual[this.type]}}function rX(r,t){return r.visual=t,r.type==="color"&&(r.parsedVisual=te(t,function(e){var i=Is(e);return i||[0,0,0,1]})),t}var jCt={linear:function(r){return Jr(r,this.option.dataExtent,[0,1],!0)},piecewise:function(r){var t=this.option.pieceList,e=qD.findPieceIndex(r,t,!0);if(e!=null)return Jr(e,[0,t.length-1],[0,1],!0)},category:function(r){var t=this.option.categories?this.option.categoryMap[r]:r;return t??ww},fixed:nn};function v1(r,t,e){return r?t<=e:t<e}const ta=qD;var XCt="itemStyle",iX=Ir();const ZCt={seriesType:"treemap",reset:function(r){var t=r.getData().tree,e=t.root;e.isRemoved()||nX(e,{},r.getViewRoot().getAncestors(),r)}};function nX(r,t,e,i){var n=r.getModel(),a=r.getLayout(),s=r.hostTree.data;if(!(!a||a.invisible||!a.isInView)){var o=n.getModel(XCt),l=qCt(o,t,i),u=s.ensureUniqueItemVisual(r.dataIndex,"style"),c=o.get("borderColor"),h=o.get("borderColorSaturation"),p;h!=null&&(p=j4(l),c=YCt(h,p)),u.stroke=c;var v=r.viewChildren;if(!v||!v.length)p=j4(l),u.fill=p;else{var y=KCt(r,n,a,o,l,v);J(v,function(x,w){if(x.depth>=e.length||x===e[x.depth]){var T=JCt(n,l,x,w,y,i);nX(x,T,e,i)}})}}}function qCt(r,t,e){var i=Zt({},t),n=e.designatedVisualItemStyle;return J(["color","colorAlpha","colorSaturation"],function(a){n[a]=t[a];var s=r.get(a);n[a]=null,s!=null&&(i[a]=s)}),i}function j4(r){var t=EC(r,"color");if(t){var e=EC(r,"colorAlpha"),i=EC(r,"colorSaturation");return i&&(t=ny(t,null,null,i)),e&&(t=jb(t,e)),t}}function YCt(r,t){return t!=null?ny(t,null,null,r):null}function EC(r,t){var e=r[t];if(e!=null&&e!=="none")return e}function KCt(r,t,e,i,n,a){if(!(!a||!a.length)){var s=IC(t,"color")||n.color!=null&&n.color!=="none"&&(IC(t,"colorAlpha")||IC(t,"colorSaturation"));if(s){var o=t.get("visualMin"),l=t.get("visualMax"),u=e.dataExtent.slice();o!=null&&o<u[0]&&(u[0]=o),l!=null&&l>u[1]&&(u[1]=l);var c=t.get("colorMappingBy"),h={type:s.name,dataExtent:u,visual:s.range};h.type==="color"&&(c==="index"||c==="id")?(h.mappingMethod="category",h.loop=!0):h.mappingMethod="linear";var p=new ta(h);return iX(p).drColorMappingBy=c,p}}}function IC(r,t){var e=r.get(t);return Kt(e)&&e.length?{name:t,range:e}:null}function JCt(r,t,e,i,n,a){var s=Zt({},t);if(n){var o=n.type,l=o==="color"&&iX(n).drColorMappingBy,u=l==="index"?i:l==="id"?a.mapIdToIndex(e.getId()):e.getValue(r.get("visualDimension"));s[o]=n.mapValueToVisual(u)}return s}var o_=Math.max,Sw=Math.min,X4=Un,YD=J,aX=["itemStyle","borderWidth"],QCt=["itemStyle","gapWidth"],tEt=["upperLabel","show"],eEt=["upperLabel","height"];const rEt={seriesType:"treemap",reset:function(r,t,e,i){var n=e.getWidth(),a=e.getHeight(),s=r.option,o=bn(r.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()}),l=s.size||[],u=he(X4(o.width,l[0]),n),c=he(X4(o.height,l[1]),a),h=i&&i.type,p=["treemapZoomToNode","treemapRootToNode"],v=a_(i,p,r),y=h==="treemapRender"||h==="treemapMove"?i.rootRect:null,x=r.getViewRoot(),w=Qj(x);if(h!=="treemapMove"){var T=h==="treemapZoomToNode"?lEt(r,v,x,u,c):y?[y.width,y.height]:[u,c],E=s.sort;E&&E!=="asc"&&E!=="desc"&&(E="desc");var M={squareRatio:s.squareRatio,sort:E,leafDepth:s.leafDepth};x.hostTree.clearLayouts();var L={x:0,y:0,width:T[0],height:T[1],area:T[0]*T[1]};x.setLayout(L),sX(x,M,!1,0),L=x.getLayout(),YD(w,function(O,U){var W=(w[U+1]||x).getValue();O.setLayout(Zt({dataExtent:[W,W],borderWidth:0,upperHeight:0},L))})}var F=r.getData().tree.root;F.setLayout(uEt(o,y,v),!0),r.setLayoutInfo(o),oX(F,new hr(-o.x,-o.y,n,a),w,x,0)}};function sX(r,t,e,i){var n,a;if(!r.isRemoved()){var s=r.getLayout();n=s.width,a=s.height;var o=r.getModel(),l=o.get(aX),u=o.get(QCt)/2,c=lX(o),h=Math.max(l,c),p=l-u,v=h-u;r.setLayout({borderWidth:l,upperHeight:h,upperLabelHeight:c},!0),n=o_(n-2*p,0),a=o_(a-p-v,0);var y=n*a,x=iEt(r,o,y,t,e,i);if(x.length){var w={x:p,y:v,width:n,height:a},T=Sw(n,a),E=1/0,M=[];M.area=0;for(var L=0,F=x.length;L<F;){var O=x[L];M.push(O),M.area+=O.getLayout().area;var U=oEt(M,T,t.squareRatio);U<=E?(L++,E=U):(M.area-=M.pop().getLayout().area,Z4(M,T,w,u,!1),T=Sw(w.width,w.height),M.length=M.area=0,E=1/0)}if(M.length&&Z4(M,T,w,u,!0),!e){var W=o.get("childrenVisibleMin");W!=null&&y<W&&(e=!0)}for(var L=0,F=x.length;L<F;L++)sX(x[L],t,e,i+1)}}}function iEt(r,t,e,i,n,a){var s=r.children||[],o=i.sort;o!=="asc"&&o!=="desc"&&(o=null);var l=i.leafDepth!=null&&i.leafDepth<=a;if(n&&!l)return r.viewChildren=[];s=ti(s,function(v){return!v.isRemoved()}),aEt(s,o);var u=sEt(t,s,o);if(u.sum===0)return r.viewChildren=[];if(u.sum=nEt(t,e,u.sum,o,s),u.sum===0)return r.viewChildren=[];for(var c=0,h=s.length;c<h;c++){var p=s[c].getValue()/u.sum*e;s[c].setLayout({area:p})}return l&&(s.length&&r.setLayout({isLeafRoot:!0},!0),s.length=0),r.viewChildren=s,r.setLayout({dataExtent:u.dataExtent},!0),s}function nEt(r,t,e,i,n){if(!i)return e;for(var a=r.get("visibleMin"),s=n.length,o=s,l=s-1;l>=0;l--){var u=n[i==="asc"?s-l-1:l].getValue();u/e*t<a&&(o=l,e-=u)}return i==="asc"?n.splice(0,s-o):n.splice(o,s-o),e}function aEt(r,t){return t&&r.sort(function(e,i){var n=t==="asc"?e.getValue()-i.getValue():i.getValue()-e.getValue();return n===0?t==="asc"?e.dataIndex-i.dataIndex:i.dataIndex-e.dataIndex:n}),r}function sEt(r,t,e){for(var i=0,n=0,a=t.length;n<a;n++)i+=t[n].getValue();var s=r.get("visualDimension"),o;return!t||!t.length?o=[NaN,NaN]:s==="value"&&e?(o=[t[t.length-1].getValue(),t[0].getValue()],e==="asc"&&o.reverse()):(o=[1/0,-1/0],YD(t,function(l){var u=l.getValue(s);u<o[0]&&(o[0]=u),u>o[1]&&(o[1]=u)})),{sum:i,dataExtent:o}}function oEt(r,t,e){for(var i=0,n=1/0,a=0,s=void 0,o=r.length;a<o;a++)s=r[a].getLayout().area,s&&(s<n&&(n=s),s>i&&(i=s));var l=r.area*r.area,u=t*t*e;return l?o_(u*i/l,l/(u*n)):1/0}function Z4(r,t,e,i,n){var a=t===e.width?0:1,s=1-a,o=["x","y"],l=["width","height"],u=e[o[a]],c=t?r.area/t:0;(n||c>e[l[s]])&&(c=e[l[s]]);for(var h=0,p=r.length;h<p;h++){var v=r[h],y={},x=c?v.getLayout().area/c:0,w=y[l[s]]=o_(c-2*i,0),T=e[o[a]]+e[l[a]]-u,E=h===p-1||T<x?T:x,M=y[l[a]]=o_(E-2*i,0);y[o[s]]=e[o[s]]+Sw(i,w/2),y[o[a]]=u+Sw(i,M/2),u+=E,v.setLayout(y,!0)}e[o[s]]+=c,e[l[s]]-=c}function lEt(r,t,e,i,n){var a=(t||{}).node,s=[i,n];if(!a||a===e)return s;for(var o,l=i*n,u=l*r.option.zoomToNodeRatio;o=a.parentNode;){for(var c=0,h=o.children,p=0,v=h.length;p<v;p++)c+=h[p].getValue();var y=a.getValue();if(y===0)return s;u*=c/y;var x=o.getModel(),w=x.get(aX),T=Math.max(w,lX(x));u+=4*w*w+(3*w+T)*Math.pow(u,.5),u>sB&&(u=sB),a=o}u<l&&(u=l);var E=Math.pow(u/l,.5);return[i*E,n*E]}function uEt(r,t,e){if(t)return{x:t.x,y:t.y};var i={x:0,y:0};if(!e)return i;var n=e.node,a=n.getLayout();if(!a)return i;for(var s=[a.width/2,a.height/2],o=n;o;){var l=o.getLayout();s[0]+=l.x,s[1]+=l.y,o=o.parentNode}return{x:r.width/2-s[0],y:r.height/2-s[1]}}function oX(r,t,e,i,n){var a=r.getLayout(),s=e[n],o=s&&s===r;if(!(s&&!o||n===e.length&&r!==i)){r.setLayout({isInView:!0,invisible:!o&&!t.intersect(a),isAboveViewRoot:o},!0);var l=new hr(t.x-a.x,t.y-a.y,t.width,t.height);YD(r.viewChildren||[],function(u){oX(u,l,e,i,n+1)})}}function lX(r){return r.get(tEt)?r.get(eEt):0}function cEt(r){r.registerSeriesModel(ICt),r.registerChartView($Ct),r.registerVisual(ZCt),r.registerLayout(rEt),ACt(r)}function hEt(r){var t=r.findComponents({mainType:"legend"});!t||!t.length||r.eachSeriesByType("graph",function(e){var i=e.getCategoriesData(),n=e.getGraph(),a=n.data,s=i.mapArray(i.getName);a.filterSelf(function(o){var l=a.getItemModel(o),u=l.getShallow("category");if(u!=null){Fr(u)&&(u=s[u]);for(var c=0;c<t.length;c++)if(!t[c].isSelected(u))return!1}return!0})})}function fEt(r){var t={};r.eachSeriesByType("graph",function(e){var i=e.getCategoriesData(),n=e.getData(),a={};i.each(function(s){var o=i.getName(s);a["ec-"+o]=s;var l=i.getItemModel(s),u=l.getModel("itemStyle").getItemStyle();u.fill||(u.fill=e.getColorFromPalette(o,t)),i.setItemVisual(s,"style",u);for(var c=["symbol","symbolSize","symbolKeepAspect"],h=0;h<c.length;h++){var p=l.getShallow(c[h],!0);p!=null&&i.setItemVisual(s,c[h],p)}}),i.count()&&n.each(function(s){var o=n.getItemModel(s),l=o.getShallow("category");if(l!=null){ve(l)&&(l=a["ec-"+l]);var u=i.getItemVisual(l,"style"),c=n.ensureUniqueItemVisual(s,"style");Zt(c,u);for(var h=["symbol","symbolSize","symbolKeepAspect"],p=0;p<h.length;p++)n.setItemVisual(s,h[p],i.getItemVisual(l,h[p]))}})})}function m1(r){return r instanceof Array||(r=[r,r]),r}function dEt(r){r.eachSeriesByType("graph",function(t){var e=t.getGraph(),i=t.getEdgeData(),n=m1(t.get("edgeSymbol")),a=m1(t.get("edgeSymbolSize"));i.setVisual("fromSymbol",n&&n[0]),i.setVisual("toSymbol",n&&n[1]),i.setVisual("fromSymbolSize",a&&a[0]),i.setVisual("toSymbolSize",a&&a[1]),i.setVisual("style",t.getModel("lineStyle").getLineStyle()),i.each(function(s){var o=i.getItemModel(s),l=e.getEdgeByIndex(s),u=m1(o.getShallow("symbol",!0)),c=m1(o.getShallow("symbolSize",!0)),h=o.getModel("lineStyle").getLineStyle(),p=i.ensureUniqueItemVisual(s,"style");switch(Zt(p,h),p.stroke){case"source":{var v=l.node1.getVisual("style");p.stroke=v&&v.fill;break}case"target":{var v=l.node2.getVisual("style");p.stroke=v&&v.fill;break}}u[0]&&l.setVisual("fromSymbol",u[0]),u[1]&&l.setVisual("toSymbol",u[1]),c[0]&&l.setVisual("fromSymbolSize",c[0]),c[1]&&l.setVisual("toSymbolSize",c[1])})})}var WM="-->",KS=function(r){return r.get("autoCurveness")||null},uX=function(r,t){var e=KS(r),i=20,n=[];if(Fr(e))i=e;else if(Kt(e)){r.__curvenessList=e;return}t>i&&(i=t);var a=i%2?i+2:i+3;n=[];for(var s=0;s<a;s++)n.push((s%2?s+1:s)/10*(s%2?-1:1));r.__curvenessList=n},l_=function(r,t,e){var i=[r.id,r.dataIndex].join("."),n=[t.id,t.dataIndex].join(".");return[e.uid,i,n].join(WM)},cX=function(r){var t=r.split(WM);return[t[0],t[2],t[1]].join(WM)},pEt=function(r,t){var e=l_(r.node1,r.node2,t);return t.__edgeMap[e]},gEt=function(r,t){var e=HM(l_(r.node1,r.node2,t),t),i=HM(l_(r.node2,r.node1,t),t);return e+i},HM=function(r,t){var e=t.__edgeMap;return e[r]?e[r].length:0};function vEt(r){KS(r)&&(r.__curvenessList=[],r.__edgeMap={},uX(r))}function mEt(r,t,e,i){if(KS(e)){var n=l_(r,t,e),a=e.__edgeMap,s=a[cX(n)];a[n]&&!s?a[n].isForward=!0:s&&a[n]&&(s.isForward=!0,a[n].isForward=!1),a[n]=a[n]||[],a[n].push(i)}}function KD(r,t,e,i){var n=KS(t),a=Kt(n);if(!n)return null;var s=pEt(r,t);if(!s)return null;for(var o=-1,l=0;l<s.length;l++)if(s[l]===e){o=l;break}var u=gEt(r,t);uX(t,u),r.lineStyle=r.lineStyle||{};var c=l_(r.node1,r.node2,t),h=t.__curvenessList,p=a||u%2?0:1;if(s.isForward)return h[p+o];var v=cX(c),y=HM(v,t),x=h[o+y+p];return i?a?n&&n[0]===0?(y+p)%2?x:-x:((y%2?0:1)+p)%2?x:-x:(y+p)%2?x:-x:h[o+y+p]}function hX(r){var t=r.coordinateSystem;if(!(t&&t.type!=="view")){var e=r.getGraph();e.eachNode(function(i){var n=i.getModel();i.setLayout([+n.get("x"),+n.get("y")])}),JD(e,r)}}function JD(r,t){r.eachEdge(function(e,i){var n=_l(e.getModel().get(["lineStyle","curveness"]),-KD(e,t,i,!0),0),a=ou(e.node1.getLayout()),s=ou(e.node2.getLayout()),o=[a,s];+n&&o.push([(a[0]+s[0])/2-(a[1]-s[1])*n,(a[1]+s[1])/2-(s[0]-a[0])*n]),e.setLayout(o)})}function yEt(r,t){r.eachSeriesByType("graph",function(e){var i=e.get("layout"),n=e.coordinateSystem;if(n&&n.type!=="view"){var a=e.getData(),s=[];J(n.dimensions,function(p){s=s.concat(a.mapDimensionsAll(p))});for(var o=0;o<a.count();o++){for(var l=[],u=!1,c=0;c<s.length;c++){var h=a.get(s[c],o);isNaN(h)||(u=!0),l.push(h)}u?a.setItemLayout(o,n.dataToPoint(l)):a.setItemLayout(o,[NaN,NaN])}JD(a.graph,e)}else(!i||i==="none")&&hX(e)})}function Xm(r){var t=r.coordinateSystem;if(t.type!=="view")return 1;var e=r.option.nodeScaleRatio,i=t.scaleX,n=t.getZoom(),a=(n-1)*e+1;return a/i}function Zm(r){var t=r.getVisual("symbolSize");return t instanceof Array&&(t=(t[0]+t[1])/2),+t}var q4=Math.PI,MC=[];function QD(r,t,e,i){var n=r.coordinateSystem;if(!(n&&n.type!=="view")){var a=n.getBoundingRect(),s=r.getData(),o=s.graph,l=a.width/2+a.x,u=a.height/2+a.y,c=Math.min(a.width,a.height)/2,h=s.count();if(s.setLayout({cx:l,cy:u}),!!h){if(e){var p=n.pointToData(i),v=p[0],y=p[1],x=[v-l,y-u];Ig(x,x),U1(x,x,c),e.setLayout([l+x[0],u+x[1]],!0);var w=r.get(["circular","rotateLabel"]);fX(e,w,l,u)}_Et[t](r,o,s,c,l,u,h),o.eachEdge(function(T,E){var M=_l(T.getModel().get(["lineStyle","curveness"]),KD(T,r,E),0),L=ou(T.node1.getLayout()),F=ou(T.node2.getLayout()),O,U=(L[0]+F[0])/2,W=(L[1]+F[1])/2;+M&&(M*=3,O=[l*M+U*(1-M),u*M+W*(1-M)]),T.setLayout([L,F,O])})}}}var _Et={value:function(r,t,e,i,n,a,s){var o=0,l=e.getSum("value"),u=Math.PI*2/(l||s);t.eachNode(function(c){var h=c.getValue("value"),p=u*(l?h:1)/2;o+=p,c.setLayout([i*Math.cos(o)+n,i*Math.sin(o)+a]),o+=p})},symbolSize:function(r,t,e,i,n,a,s){var o=0;MC.length=s;var l=Xm(r);t.eachNode(function(h){var p=Zm(h);isNaN(p)&&(p=2),p<0&&(p=0),p*=l;var v=Math.asin(p/2/i);isNaN(v)&&(v=q4/2),MC[h.dataIndex]=v,o+=v*2});var u=(2*q4-o)/s/2,c=0;t.eachNode(function(h){var p=u+MC[h.dataIndex];c+=p,(!h.getLayout()||!h.getLayout().fixed)&&h.setLayout([i*Math.cos(c)+n,i*Math.sin(c)+a]),c+=p})}};function fX(r,t,e,i){var n=r.getGraphicEl();if(n){var a=r.getModel(),s=a.get(["label","rotate"])||0,o=n.getSymbolPath();if(t){var l=r.getLayout(),u=Math.atan2(l[1]-i,l[0]-e);u<0&&(u=Math.PI*2+u);var c=l[0]<e;c&&(u=u-Math.PI);var h=c?"left":"right";o.setTextConfig({rotation:-u,position:h,origin:"center"});var p=o.ensureState("emphasis");Zt(p.textConfig||(p.textConfig={}),{position:h})}else o.setTextConfig({rotation:s*=Math.PI/180})}}function xEt(r){r.eachSeriesByType("graph",function(t){t.get("layout")==="circular"&&QD(t,"symbolSize")})}var dp=PI;function bEt(r,t,e){for(var i=r,n=t,a=e.rect,s=a.width,o=a.height,l=[a.x+s/2,a.y+o/2],u=e.gravity==null?.1:e.gravity,c=0;c<i.length;c++){var h=i[c];h.p||(h.p=Qf(s*(Math.random()-.5)+l[0],o*(Math.random()-.5)+l[1])),h.pp=ou(h.p),h.edges=null}var p=e.friction==null?.6:e.friction,v=p,y,x;return{warmUp:function(){v=p*.8},setFixed:function(w){i[w].fixed=!0},setUnfixed:function(w){i[w].fixed=!1},beforeStep:function(w){y=w},afterStep:function(w){x=w},step:function(w){y&&y(i,n);for(var T=[],E=i.length,M=0;M<n.length;M++){var L=n[M];if(!L.ignoreForceLayout){var F=L.n1,O=L.n2;df(T,O.p,F.p);var U=RI(T)-L.d,W=O.w/(F.w+O.w);isNaN(W)&&(W=0),Ig(T,T),!F.fixed&&dp(F.p,F.p,T,W*U*v),!O.fixed&&dp(O.p,O.p,T,-(1-W)*U*v)}}for(var M=0;M<E;M++){var H=i[M];H.fixed||(df(T,l,H.p),dp(H.p,H.p,T,u*v))}for(var M=0;M<E;M++)for(var F=i[M],j=M+1;j<E;j++){var O=i[j];df(T,O.p,F.p);var U=RI(T);U===0&&(Evt(T,Math.random()-.5,Math.random()-.5),U=1);var Y=(F.rep+O.rep)/U/U;!F.fixed&&dp(F.pp,F.pp,T,Y),!O.fixed&&dp(O.pp,O.pp,T,-Y)}for(var tt=[],M=0;M<E;M++){var H=i[M];H.fixed||(df(tt,H.p,H.pp),dp(H.p,H.p,tt,v),Ua(H.pp,H.p))}v=v*.992;var it=v<.01;x&&x(i,n,it),w&&w(it)}}}function wEt(r){r.eachSeriesByType("graph",function(t){var e=t.coordinateSystem;if(!(e&&e.type!=="view"))if(t.get("layout")==="force"){var i=t.preservedPoints||{},n=t.getGraph(),a=n.data,s=n.edgeData,o=t.getModel("force"),l=o.get("initLayout");t.preservedPoints?a.each(function(M){var L=a.getId(M);a.setItemLayout(M,i[L]||[NaN,NaN])}):!l||l==="none"?hX(t):l==="circular"&&QD(t,"value");var u=a.getDataExtent("value"),c=s.getDataExtent("value"),h=o.get("repulsion"),p=o.get("edgeLength"),v=Kt(h)?h:[h,h],y=Kt(p)?p:[p,p];y=[y[1],y[0]];var x=a.mapArray("value",function(M,L){var F=a.getItemLayout(L),O=Jr(M,u,v);return isNaN(O)&&(O=(v[0]+v[1])/2),{w:O,rep:O,fixed:a.getItemModel(L).get("fixed"),p:!F||isNaN(F[0])||isNaN(F[1])?null:F}}),w=s.mapArray("value",function(M,L){var F=n.getEdgeByIndex(L),O=Jr(M,c,y);isNaN(O)&&(O=(y[0]+y[1])/2);var U=F.getModel(),W=_l(F.getModel().get(["lineStyle","curveness"]),-KD(F,t,L,!0),0);return{n1:x[F.node1.dataIndex],n2:x[F.node2.dataIndex],d:O,curveness:W,ignoreForceLayout:U.get("ignoreForceLayout")}}),T=e.getBoundingRect(),E=bEt(x,w,{rect:T,gravity:o.get("gravity"),friction:o.get("friction")});E.beforeStep(function(M,L){for(var F=0,O=M.length;F<O;F++)M[F].fixed&&Ua(M[F].p,n.getNodeByIndex(F).getLayout())}),E.afterStep(function(M,L,F){for(var O=0,U=M.length;O<U;O++)M[O].fixed||n.getNodeByIndex(O).setLayout(M[O].p),i[a.getId(O)]=M[O].p;for(var O=0,U=L.length;O<U;O++){var W=L[O],H=n.getEdgeByIndex(O),j=W.n1.p,Y=W.n2.p,tt=H.getLayout();tt=tt?tt.slice():[],tt[0]=tt[0]||[],tt[1]=tt[1]||[],Ua(tt[0],j),Ua(tt[1],Y),+W.curveness&&(tt[2]=[(j[0]+Y[0])/2-(j[1]-Y[1])*W.curveness,(j[1]+Y[1])/2-(Y[0]-j[0])*W.curveness]),H.setLayout(tt)}}),t.forceLayout=E,t.preservedPoints=i,E.step()}else t.forceLayout=null})}function SEt(r,t,e){var i=Zt(r.getBoxLayoutParams(),{aspect:e});return bn(i,{width:t.getWidth(),height:t.getHeight()})}function TEt(r,t){var e=[];return r.eachSeriesByType("graph",function(i){var n=i.get("coordinateSystem");if(!n||n==="view"){var a=i.getData(),s=a.mapArray(function(w){var T=a.getItemModel(w);return[+T.get("x"),+T.get("y")]}),o=[],l=[];TS(s,o,l),l[0]-o[0]===0&&(l[0]+=1,o[0]-=1),l[1]-o[1]===0&&(l[1]+=1,o[1]-=1);var u=(l[0]-o[0])/(l[1]-o[1]),c=SEt(i,t,u);isNaN(u)&&(o=[c.x,c.y],l=[c.x+c.width,c.y+c.height]);var h=l[0]-o[0],p=l[1]-o[1],v=c.width,y=c.height,x=i.coordinateSystem=new W_;x.zoomLimit=i.get("scaleLimit"),x.setBoundingRect(o[0],o[1],h,p),x.setViewRect(c.x,c.y,v,y),x.setCenter(i.get("center"),t),x.setZoom(i.get("zoom")),e.push(x)}}),e}var Y4=$n.prototype,PC=IS.prototype,dX=function(){function r(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}return r}();(function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t})(dX);function RC(r){return isNaN(+r.cpx1)||isNaN(+r.cpy1)}var AEt=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i.type="ec-line",i}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new dX},t.prototype.buildPath=function(e,i){RC(i)?Y4.buildPath.call(this,e,i):PC.buildPath.call(this,e,i)},t.prototype.pointAt=function(e){return RC(this.shape)?Y4.pointAt.call(this,e):PC.pointAt.call(this,e)},t.prototype.tangentAt=function(e){var i=this.shape,n=RC(i)?[i.x2-i.x1,i.y2-i.y1]:PC.tangentAt.call(this,e);return Ig(n,n)},t}(vr);const CEt=AEt;var DC=["fromSymbol","toSymbol"];function K4(r){return"_"+r+"Type"}function J4(r,t,e){var i=t.getItemVisual(e,r);if(!i||i==="none")return i;var n=t.getItemVisual(e,r+"Size"),a=t.getItemVisual(e,r+"Rotate"),s=t.getItemVisual(e,r+"Offset"),o=t.getItemVisual(e,r+"KeepAspect"),l=$g(n),u=id(s||0,l);return i+l+u+(a||"")+(o||"")}function Q4(r,t,e){var i=t.getItemVisual(e,r);if(!(!i||i==="none")){var n=t.getItemVisual(e,r+"Size"),a=t.getItemVisual(e,r+"Rotate"),s=t.getItemVisual(e,r+"Offset"),o=t.getItemVisual(e,r+"KeepAspect"),l=$g(n),u=id(s||0,l),c=mn(i,-l[0]/2+u[0],-l[1]/2+u[1],l[0],l[1],null,o);return c.__specifiedRotation=a==null||isNaN(a)?void 0:+a*Math.PI/180||0,c.name=r,c}}function EEt(r){var t=new CEt({name:"line",subPixelOptimize:!0});return GM(t.shape,r),t}function GM(r,t){r.x1=t[0][0],r.y1=t[0][1],r.x2=t[1][0],r.y2=t[1][1],r.percent=1;var e=t[2];e?(r.cpx1=e[0],r.cpy1=e[1]):(r.cpx1=NaN,r.cpy1=NaN)}var IEt=function(r){Vt(t,r);function t(e,i,n){var a=r.call(this)||this;return a._createLine(e,i,n),a}return t.prototype._createLine=function(e,i,n){var a=e.hostModel,s=e.getItemLayout(i),o=EEt(s);o.shape.percent=0,Ei(o,{shape:{percent:1}},a,i),this.add(o),J(DC,function(l){var u=Q4(l,e,i);this.add(u),this[K4(l)]=J4(l,e,i)},this),this._updateCommonStl(e,i,n)},t.prototype.updateData=function(e,i,n){var a=e.hostModel,s=this.childOfName("line"),o=e.getItemLayout(i),l={shape:{}};GM(l.shape,o),zr(s,l,a,i),J(DC,function(u){var c=J4(u,e,i),h=K4(u);if(this[h]!==c){this.remove(this.childOfName(u));var p=Q4(u,e,i);this.add(p)}this[h]=c},this),this._updateCommonStl(e,i,n)},t.prototype.getLinePath=function(){return this.childAt(0)},t.prototype._updateCommonStl=function(e,i,n){var a=e.hostModel,s=this.childOfName("line"),o=n&&n.emphasisLineStyle,l=n&&n.blurLineStyle,u=n&&n.selectLineStyle,c=n&&n.labelStatesModels,h=n&&n.emphasisDisabled,p=n&&n.focus,v=n&&n.blurScope;if(!n||e.hasItemOption){var y=e.getItemModel(i),x=y.getModel("emphasis");o=x.getModel("lineStyle").getLineStyle(),l=y.getModel(["blur","lineStyle"]).getLineStyle(),u=y.getModel(["select","lineStyle"]).getLineStyle(),h=x.get("disabled"),p=x.get("focus"),v=x.get("blurScope"),c=Dn(y)}var w=e.getItemVisual(i,"style"),T=w.stroke;s.useStyle(w),s.style.fill=null,s.style.strokeNoScale=!0,s.ensureState("emphasis").style=o,s.ensureState("blur").style=l,s.ensureState("select").style=u,J(DC,function(O){var U=this.childOfName(O);if(U){U.setColor(T),U.style.opacity=w.opacity;for(var W=0;W<qa.length;W++){var H=qa[W],j=s.getState(H);if(j){var Y=j.style||{},tt=U.ensureState(H),it=tt.style||(tt.style={});Y.stroke!=null&&(it[U.__isEmptyBrush?"stroke":"fill"]=Y.stroke),Y.opacity!=null&&(it.opacity=Y.opacity)}}U.markRedraw()}},this);var E=a.getRawValue(i);ra(this,c,{labelDataIndex:i,labelFetcher:{getFormattedLabel:function(O,U){return a.getFormattedLabel(O,U,e.dataType)}},inheritColor:T||"#000",defaultOpacity:w.opacity,defaultText:(E==null?e.getName(i):isFinite(E)?Yi(E):E)+""});var M=this.getTextContent();if(M){var L=c.normal;M.__align=M.style.align,M.__verticalAlign=M.style.verticalAlign,M.__position=L.get("position")||"middle";var F=L.get("distance");Kt(F)||(F=[F,F]),M.__labelDistance=F}this.setTextConfig({position:null,local:!0,inside:!1}),Ui(this,p,v,h)},t.prototype.highlight=function(){vu(this)},t.prototype.downplay=function(){mu(this)},t.prototype.updateLayout=function(e,i){this.setLinePoints(e.getItemLayout(i))},t.prototype.setLinePoints=function(e){var i=this.childOfName("line");GM(i.shape,e),i.dirty()},t.prototype.beforeUpdate=function(){var e=this,i=e.childOfName("fromSymbol"),n=e.childOfName("toSymbol"),a=e.getTextContent();if(!i&&!n&&(!a||a.ignore))return;for(var s=1,o=this.parent;o;)o.scaleX&&(s/=o.scaleX),o=o.parent;var l=e.childOfName("line");if(!this.__dirty&&!l.__dirty)return;var u=l.shape.percent,c=l.pointAt(0),h=l.pointAt(u),p=df([],h,c);Ig(p,p);function v(j,Y){var tt=j.__specifiedRotation;if(tt==null){var it=l.tangentAt(Y);j.attr("rotation",(Y===1?-1:1)*Math.PI/2-Math.atan2(it[1],it[0]))}else j.attr("rotation",tt)}if(i&&(i.setPosition(c),v(i,0),i.scaleX=i.scaleY=s*u,i.markRedraw()),n&&(n.setPosition(h),v(n,1),n.scaleX=n.scaleY=s*u,n.markRedraw()),a&&!a.ignore){a.x=a.y=0,a.originX=a.originY=0;var y=void 0,x=void 0,w=a.__labelDistance,T=w[0]*s,E=w[1]*s,M=u/2,L=l.tangentAt(M),F=[L[1],-L[0]],O=l.pointAt(M);F[1]>0&&(F[0]=-F[0],F[1]=-F[1]);var U=L[0]<0?-1:1;if(a.__position!=="start"&&a.__position!=="end"){var W=-Math.atan2(L[1],L[0]);h[0]<c[0]&&(W=Math.PI+W),a.rotation=W}var H=void 0;switch(a.__position){case"insideStartTop":case"insideMiddleTop":case"insideEndTop":case"middle":H=-E,x="bottom";break;case"insideStartBottom":case"insideMiddleBottom":case"insideEndBottom":H=E,x="top";break;default:H=0,x="middle"}switch(a.__position){case"end":a.x=p[0]*T+h[0],a.y=p[1]*E+h[1],y=p[0]>.8?"left":p[0]<-.8?"right":"center",x=p[1]>.8?"top":p[1]<-.8?"bottom":"middle";break;case"start":a.x=-p[0]*T+c[0],a.y=-p[1]*E+c[1],y=p[0]>.8?"right":p[0]<-.8?"left":"center",x=p[1]>.8?"bottom":p[1]<-.8?"top":"middle";break;case"insideStartTop":case"insideStart":case"insideStartBottom":a.x=T*U+c[0],a.y=c[1]+H,y=L[0]<0?"right":"left",a.originX=-T*U,a.originY=-H;break;case"insideMiddleTop":case"insideMiddle":case"insideMiddleBottom":case"middle":a.x=O[0],a.y=O[1]+H,y="center",a.originY=-H;break;case"insideEndTop":case"insideEnd":case"insideEndBottom":a.x=-T*U+h[0],a.y=h[1]+H,y=L[0]>=0?"right":"left",a.originX=T*U,a.originY=-H;break}a.scaleX=a.scaleY=s,a.setStyle({verticalAlign:a.__verticalAlign||x,align:a.__align||y})}},t}(Ke);const tL=IEt;var MEt=function(){function r(t){this.group=new Ke,this._LineCtor=t||tL}return r.prototype.updateData=function(t){var e=this;this._progressiveEls=null;var i=this,n=i.group,a=i._lineData;i._lineData=t,a||n.removeAll();var s=tV(t);t.diff(a).add(function(o){e._doAdd(t,o,s)}).update(function(o,l){e._doUpdate(a,t,l,o,s)}).remove(function(o){n.remove(a.getItemGraphicEl(o))}).execute()},r.prototype.updateLayout=function(){var t=this._lineData;t&&t.eachItemGraphicEl(function(e,i){e.updateLayout(t,i)},this)},r.prototype.incrementalPrepareUpdate=function(t){this._seriesScope=tV(t),this._lineData=null,this.group.removeAll()},r.prototype.incrementalUpdate=function(t,e){this._progressiveEls=[];function i(o){!o.isGroup&&!PEt(o)&&(o.incremental=!0,o.ensureState("emphasis").hoverLayer=!0)}for(var n=t.start;n<t.end;n++){var a=e.getItemLayout(n);if(LC(a)){var s=new this._LineCtor(e,n,this._seriesScope);s.traverse(i),this.group.add(s),e.setItemGraphicEl(n,s),this._progressiveEls.push(s)}}},r.prototype.remove=function(){this.group.removeAll()},r.prototype.eachRendered=function(t){Kc(this._progressiveEls||this.group,t)},r.prototype._doAdd=function(t,e,i){var n=t.getItemLayout(e);if(LC(n)){var a=new this._LineCtor(t,e,i);t.setItemGraphicEl(e,a),this.group.add(a)}},r.prototype._doUpdate=function(t,e,i,n,a){var s=t.getItemGraphicEl(i);if(!LC(e.getItemLayout(n))){this.group.remove(s);return}s?s.updateData(e,n,a):s=new this._LineCtor(e,n,a),e.setItemGraphicEl(n,s),this.group.add(s)},r}();function PEt(r){return r.animators&&r.animators.length>0}function tV(r){var t=r.hostModel,e=t.getModel("emphasis");return{lineStyle:t.getModel("lineStyle").getLineStyle(),emphasisLineStyle:e.getModel(["lineStyle"]).getLineStyle(),blurLineStyle:t.getModel(["blur","lineStyle"]).getLineStyle(),selectLineStyle:t.getModel(["select","lineStyle"]).getLineStyle(),emphasisDisabled:e.get("disabled"),blurScope:e.get("blurScope"),focus:e.get("focus"),labelStatesModels:Dn(t)}}function eV(r){return isNaN(r[0])||isNaN(r[1])}function LC(r){return r&&!eV(r[0])&&!eV(r[1])}const eL=MEt;var kC=[],OC=[],NC=[],pp=Vn,FC=Tf,rV=Math.abs;function iV(r,t,e){for(var i=r[0],n=r[1],a=r[2],s=1/0,o,l=e*e,u=.1,c=.1;c<=.9;c+=.1){kC[0]=pp(i[0],n[0],a[0],c),kC[1]=pp(i[1],n[1],a[1],c);var h=rV(FC(kC,t)-l);h<s&&(s=h,o=c)}for(var p=0;p<32;p++){var v=o+u;OC[0]=pp(i[0],n[0],a[0],o),OC[1]=pp(i[1],n[1],a[1],o),NC[0]=pp(i[0],n[0],a[0],v),NC[1]=pp(i[1],n[1],a[1],v);var h=FC(OC,t)-l;if(rV(h)<.01)break;var y=FC(NC,t)-l;u/=2,h<0?y>=0?o=o+u:o=o-u:y>=0?o=o-u:o=o+u}return o}function BC(r,t){var e=[],i=Vy,n=[[],[],[]],a=[[],[]],s=[];t/=2,r.eachEdge(function(o,l){var u=o.getLayout(),c=o.getVisual("fromSymbol"),h=o.getVisual("toSymbol");u.__original||(u.__original=[ou(u[0]),ou(u[1])],u[2]&&u.__original.push(ou(u[2])));var p=u.__original;if(u[2]!=null){if(Ua(n[0],p[0]),Ua(n[1],p[2]),Ua(n[2],p[1]),c&&c!=="none"){var v=Zm(o.node1),y=iV(n,p[0],v*t);i(n[0][0],n[1][0],n[2][0],y,e),n[0][0]=e[3],n[1][0]=e[4],i(n[0][1],n[1][1],n[2][1],y,e),n[0][1]=e[3],n[1][1]=e[4]}if(h&&h!=="none"){var v=Zm(o.node2),y=iV(n,p[1],v*t);i(n[0][0],n[1][0],n[2][0],y,e),n[1][0]=e[1],n[2][0]=e[2],i(n[0][1],n[1][1],n[2][1],y,e),n[1][1]=e[1],n[2][1]=e[2]}Ua(u[0],n[0]),Ua(u[1],n[2]),Ua(u[2],n[1])}else{if(Ua(a[0],p[0]),Ua(a[1],p[1]),df(s,a[1],a[0]),Ig(s,s),c&&c!=="none"){var v=Zm(o.node1);PI(a[0],a[0],s,v*t)}if(h&&h!=="none"){var v=Zm(o.node2);PI(a[1],a[1],s,-v*t)}Ua(u[0],a[0]),Ua(u[1],a[1])}})}function nV(r){return r.type==="view"}var REt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,i){var n=new F_,a=new eL,s=this.group;this._controller=new $_(i.getZr()),this._controllerHost={target:s},s.add(n.group),s.add(a.group),this._symbolDraw=n,this._lineDraw=a,this._firstRender=!0},t.prototype.render=function(e,i,n){var a=this,s=e.coordinateSystem;this._model=e;var o=this._symbolDraw,l=this._lineDraw,u=this.group;if(nV(s)){var c={x:s.x,y:s.y,scaleX:s.scaleX,scaleY:s.scaleY};this._firstRender?u.attr(c):zr(u,c,e)}BC(e.getGraph(),Xm(e));var h=e.getData();o.updateData(h);var p=e.getEdgeData();l.updateData(p),this._updateNodeAndLinkScale(),this._updateController(e,i,n),clearTimeout(this._layoutTimeout);var v=e.forceLayout,y=e.get(["force","layoutAnimation"]);v&&this._startForceLayoutIteration(v,y);var x=e.get("layout");h.graph.eachNode(function(M){var L=M.dataIndex,F=M.getGraphicEl(),O=M.getModel();if(F){F.off("drag").off("dragend");var U=O.get("draggable");U&&F.on("drag",function(H){switch(x){case"force":v.warmUp(),!a._layouting&&a._startForceLayoutIteration(v,y),v.setFixed(L),h.setItemLayout(L,[F.x,F.y]);break;case"circular":h.setItemLayout(L,[F.x,F.y]),M.setLayout({fixed:!0},!0),QD(e,"symbolSize",M,[H.offsetX,H.offsetY]),a.updateLayout(e);break;case"none":default:h.setItemLayout(L,[F.x,F.y]),JD(e.getGraph(),e),a.updateLayout(e);break}}).on("dragend",function(){v&&v.setUnfixed(L)}),F.setDraggable(U,!!O.get("cursor"));var W=O.get(["emphasis","focus"]);W==="adjacency"&&(Je(F).focus=M.getAdjacentDataIndices())}}),h.graph.eachEdge(function(M){var L=M.getGraphicEl(),F=M.getModel().get(["emphasis","focus"]);L&&F==="adjacency"&&(Je(L).focus={edge:[M.dataIndex],node:[M.node1.dataIndex,M.node2.dataIndex]})});var w=e.get("layout")==="circular"&&e.get(["circular","rotateLabel"]),T=h.getLayout("cx"),E=h.getLayout("cy");h.graph.eachNode(function(M){fX(M,w,T,E)}),this._firstRender=!1},t.prototype.dispose=function(){this.remove(),this._controller&&this._controller.dispose(),this._controllerHost=null},t.prototype._startForceLayoutIteration=function(e,i){var n=this;(function a(){e.step(function(s){n.updateLayout(n._model),(n._layouting=!s)&&(i?n._layoutTimeout=setTimeout(a,16):a())})})()},t.prototype._updateController=function(e,i,n){var a=this,s=this._controller,o=this._controllerHost,l=this.group;if(s.setPointerChecker(function(u,c,h){var p=l.getBoundingRect();return p.applyTransform(l.transform),p.contain(c,h)&&!ZS(u,n,e)}),!nV(e.coordinateSystem)){s.disable();return}s.enable(e.get("roam")),o.zoomLimit=e.get("scaleLimit"),o.zoom=e.coordinateSystem.getZoom(),s.off("pan").off("zoom").on("pan",function(u){$D(o,u.dx,u.dy),n.dispatchAction({seriesId:e.id,type:"graphRoam",dx:u.dx,dy:u.dy})}).on("zoom",function(u){WD(o,u.scale,u.originX,u.originY),n.dispatchAction({seriesId:e.id,type:"graphRoam",zoom:u.scale,originX:u.originX,originY:u.originY}),a._updateNodeAndLinkScale(),BC(e.getGraph(),Xm(e)),a._lineDraw.updateLayout(),n.updateLabelLayout()})},t.prototype._updateNodeAndLinkScale=function(){var e=this._model,i=e.getData(),n=Xm(e);i.eachItemGraphicEl(function(a,s){a&&a.setSymbolScale(n)})},t.prototype.updateLayout=function(e){BC(e.getGraph(),Xm(e)),this._symbolDraw.updateLayout(),this._lineDraw.updateLayout()},t.prototype.remove=function(){clearTimeout(this._layoutTimeout),this._layouting=!1,this._layoutTimeout=null,this._symbolDraw&&this._symbolDraw.remove(),this._lineDraw&&this._lineDraw.remove()},t.type="graph",t}(di);const DEt=REt;function gp(r){return"_EC_"+r}var LEt=function(){function r(t){this.type="graph",this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={},this._directed=t||!1}return r.prototype.isDirected=function(){return this._directed},r.prototype.addNode=function(t,e){t=t==null?""+e:""+t;var i=this._nodesMap;if(!i[gp(t)]){var n=new tf(t,e);return n.hostGraph=this,this.nodes.push(n),i[gp(t)]=n,n}},r.prototype.getNodeByIndex=function(t){var e=this.data.getRawIndex(t);return this.nodes[e]},r.prototype.getNodeById=function(t){return this._nodesMap[gp(t)]},r.prototype.addEdge=function(t,e,i){var n=this._nodesMap,a=this._edgesMap;if(Fr(t)&&(t=this.nodes[t]),Fr(e)&&(e=this.nodes[e]),t instanceof tf||(t=n[gp(t)]),e instanceof tf||(e=n[gp(e)]),!(!t||!e)){var s=t.id+"-"+e.id,o=new pX(t,e,i);return o.hostGraph=this,this._directed&&(t.outEdges.push(o),e.inEdges.push(o)),t.edges.push(o),t!==e&&e.edges.push(o),this.edges.push(o),a[s]=o,o}},r.prototype.getEdgeByIndex=function(t){var e=this.edgeData.getRawIndex(t);return this.edges[e]},r.prototype.getEdge=function(t,e){t instanceof tf&&(t=t.id),e instanceof tf&&(e=e.id);var i=this._edgesMap;return this._directed?i[t+"-"+e]:i[t+"-"+e]||i[e+"-"+t]},r.prototype.eachNode=function(t,e){for(var i=this.nodes,n=i.length,a=0;a<n;a++)i[a].dataIndex>=0&&t.call(e,i[a],a)},r.prototype.eachEdge=function(t,e){for(var i=this.edges,n=i.length,a=0;a<n;a++)i[a].dataIndex>=0&&i[a].node1.dataIndex>=0&&i[a].node2.dataIndex>=0&&t.call(e,i[a],a)},r.prototype.breadthFirstTraverse=function(t,e,i,n){if(e instanceof tf||(e=this._nodesMap[gp(e)]),!!e){for(var a=i==="out"?"outEdges":i==="in"?"inEdges":"edges",s=0;s<this.nodes.length;s++)this.nodes[s].__visited=!1;if(!t.call(n,e,null))for(var o=[e];o.length;)for(var l=o.shift(),u=l[a],s=0;s<u.length;s++){var c=u[s],h=c.node1===l?c.node2:c.node1;if(!h.__visited){if(t.call(n,h,l))return;o.push(h),h.__visited=!0}}}},r.prototype.update=function(){for(var t=this.data,e=this.edgeData,i=this.nodes,n=this.edges,a=0,s=i.length;a<s;a++)i[a].dataIndex=-1;for(var a=0,s=t.count();a<s;a++)i[t.getRawIndex(a)].dataIndex=a;e.filterSelf(function(o){var l=n[e.getRawIndex(o)];return l.node1.dataIndex>=0&&l.node2.dataIndex>=0});for(var a=0,s=n.length;a<s;a++)n[a].dataIndex=-1;for(var a=0,s=e.count();a<s;a++)n[e.getRawIndex(a)].dataIndex=a},r.prototype.clone=function(){for(var t=new r(this._directed),e=this.nodes,i=this.edges,n=0;n<e.length;n++)t.addNode(e[n].id,e[n].dataIndex);for(var n=0;n<i.length;n++){var a=i[n];t.addEdge(a.node1.id,a.node2.id,a.dataIndex)}return t},r}(),tf=function(){function r(t,e){this.inEdges=[],this.outEdges=[],this.edges=[],this.dataIndex=-1,this.id=t??"",this.dataIndex=e??-1}return r.prototype.degree=function(){return this.edges.length},r.prototype.inDegree=function(){return this.inEdges.length},r.prototype.outDegree=function(){return this.outEdges.length},r.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostGraph,i=e.data.getItemModel(this.dataIndex);return i.getModel(t)}},r.prototype.getAdjacentDataIndices=function(){for(var t={edge:[],node:[]},e=0;e<this.edges.length;e++){var i=this.edges[e];i.dataIndex<0||(t.edge.push(i.dataIndex),t.node.push(i.node1.dataIndex,i.node2.dataIndex))}return t},r.prototype.getTrajectoryDataIndices=function(){for(var t=Re(),e=Re(),i=0;i<this.edges.length;i++){var n=this.edges[i];if(!(n.dataIndex<0)){t.set(n.dataIndex,!0);for(var a=[n.node1],s=[n.node2],o=0;o<a.length;){var l=a[o];o++,e.set(l.dataIndex,!0);for(var u=0;u<l.inEdges.length;u++)t.set(l.inEdges[u].dataIndex,!0),a.push(l.inEdges[u].node1)}for(o=0;o<s.length;){var c=s[o];o++,e.set(c.dataIndex,!0);for(var u=0;u<c.outEdges.length;u++)t.set(c.outEdges[u].dataIndex,!0),s.push(c.outEdges[u].node2)}}}return{edge:t.keys(),node:e.keys()}},r}(),pX=function(){function r(t,e,i){this.dataIndex=-1,this.node1=t,this.node2=e,this.dataIndex=i??-1}return r.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostGraph,i=e.edgeData.getItemModel(this.dataIndex);return i.getModel(t)}},r.prototype.getAdjacentDataIndices=function(){return{edge:[this.dataIndex],node:[this.node1.dataIndex,this.node2.dataIndex]}},r.prototype.getTrajectoryDataIndices=function(){var t=Re(),e=Re();t.set(this.dataIndex,!0);for(var i=[this.node1],n=[this.node2],a=0;a<i.length;){var s=i[a];a++,e.set(s.dataIndex,!0);for(var o=0;o<s.inEdges.length;o++)t.set(s.inEdges[o].dataIndex,!0),i.push(s.inEdges[o].node1)}for(a=0;a<n.length;){var l=n[a];a++,e.set(l.dataIndex,!0);for(var o=0;o<l.outEdges.length;o++)t.set(l.outEdges[o].dataIndex,!0),n.push(l.outEdges[o].node2)}return{edge:t.keys(),node:e.keys()}},r}();function gX(r,t){return{getValue:function(e){var i=this[r][t];return i.getStore().get(i.getDimensionIndex(e||"value"),this.dataIndex)},setVisual:function(e,i){this.dataIndex>=0&&this[r][t].setItemVisual(this.dataIndex,e,i)},getVisual:function(e){return this[r][t].getItemVisual(this.dataIndex,e)},setLayout:function(e,i){this.dataIndex>=0&&this[r][t].setItemLayout(this.dataIndex,e,i)},getLayout:function(){return this[r][t].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[r][t].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[r][t].getRawIndex(this.dataIndex)}}}yn(tf,gX("hostGraph","data"));yn(pX,gX("hostGraph","edgeData"));const kEt=LEt;function vX(r,t,e,i,n){for(var a=new kEt(i),s=0;s<r.length;s++)a.addNode(Un(r[s].id,r[s].name,s),s);for(var o=[],l=[],u=0,s=0;s<t.length;s++){var c=t[s],h=c.source,p=c.target;a.addEdge(h,p,u)&&(l.push(c),o.push(Un(xn(c.id,null),h+" > "+p)),u++)}var v=e.get("coordinateSystem"),y;if(v==="cartesian2d"||v==="polar")y=Su(r,e);else{var x=D_.get(v),w=x?x.dimensions||[]:[];pr(w,"value")<0&&w.concat(["value"]);var T=k_(r,{coordDimensions:w,encodeDefine:e.getEncode()}).dimensions;y=new Xa(T,e),y.initData(r)}var E=new Xa(["value"],e);return E.initData(l,o),n&&n(y,E),Kj({mainData:y,struct:a,structAttr:"graph",datas:{node:y,edge:E},datasAttr:{node:"data",edge:"edgeData"}}),a.update(),a}var OEt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.init=function(e){r.prototype.init.apply(this,arguments);var i=this;function n(){return i._categoriesData}this.legendVisualProvider=new U_(n,n),this.fillDataTextStyle(e.edges||e.links),this._updateCategoriesData()},t.prototype.mergeOption=function(e){r.prototype.mergeOption.apply(this,arguments),this.fillDataTextStyle(e.edges||e.links),this._updateCategoriesData()},t.prototype.mergeDefaultAndTheme=function(e){r.prototype.mergeDefaultAndTheme.apply(this,arguments),$f(e,"edgeLabel",["show"])},t.prototype.getInitialData=function(e,i){var n=e.edges||e.links||[],a=e.data||e.nodes||[],s=this;if(a&&n){vEt(this);var o=vX(a,n,this,!0,l);return J(o.edges,function(u){mEt(u.node1,u.node2,this,u.dataIndex)},this),o.data}function l(u,c){u.wrapMethod("getItemModel",function(y){var x=s._categoriesModels,w=y.getShallow("category"),T=x[w];return T&&(T.parentModel=y.parentModel,y.parentModel=T),y});var h=fi.prototype.getModel;function p(y,x){var w=h.call(this,y,x);return w.resolveParentPath=v,w}c.wrapMethod("getItemModel",function(y){return y.resolveParentPath=v,y.getModel=p,y});function v(y){if(y&&(y[0]==="label"||y[1]==="label")){var x=y.slice();return y[0]==="label"?x[0]="edgeLabel":y[1]==="label"&&(x[1]="edgeLabel"),x}return y}}},t.prototype.getGraph=function(){return this.getData().graph},t.prototype.getEdgeData=function(){return this.getGraph().edgeData},t.prototype.getCategoriesData=function(){return this._categoriesData},t.prototype.formatTooltip=function(e,i,n){if(n==="edge"){var a=this.getData(),s=this.getDataParams(e,n),o=a.graph.getEdgeByIndex(e),l=a.getName(o.node1.dataIndex),u=a.getName(o.node2.dataIndex),c=[];return l!=null&&c.push(l),u!=null&&c.push(u),Ln("nameValue",{name:c.join(" > "),value:s.value,noValue:s.value==null})}var h=k9({series:this,dataIndex:e,multipleSeries:i});return h},t.prototype._updateCategoriesData=function(){var e=te(this.option.categories||[],function(n){return n.value!=null?n:Zt({value:0},n)}),i=new Xa(["value"],this);i.initData(e),this._categoriesData=i,this._categoriesModels=i.mapArray(function(n){return i.getItemModel(n)})},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.isAnimationEnabled=function(){return r.prototype.isAnimationEnabled.call(this)&&!(this.get("layout")==="force"&&this.get(["force","layoutAnimation"]))},t.type="series.graph",t.dependencies=["grid","polar","geo","singleAxis","calendar"],t.defaultOption={z:2,coordinateSystem:"view",legendHoverLink:!0,layout:null,circular:{rotateLabel:!1},force:{initLayout:null,repulsion:[0,50],gravity:.1,friction:.6,edgeLength:30,layoutAnimation:!0},left:"center",top:"center",symbol:"circle",symbolSize:10,edgeSymbol:["none","none"],edgeSymbolSize:10,edgeLabel:{position:"middle",distance:5},draggable:!1,roam:!1,center:null,zoom:1,nodeScaleRatio:.6,label:{show:!1,formatter:"{b}"},itemStyle:{},lineStyle:{color:"#aaa",width:1,opacity:.5},emphasis:{scale:!0,label:{show:!0}},select:{itemStyle:{borderColor:"#212121"}}},t}(Li);const NEt=OEt;var FEt={type:"graphRoam",event:"graphRoam",update:"none"};function BEt(r){r.registerChartView(DEt),r.registerSeriesModel(NEt),r.registerProcessor(hEt),r.registerVisual(fEt),r.registerVisual(dEt),r.registerLayout(yEt),r.registerLayout(r.PRIORITY.VISUAL.POST_CHART_LAYOUT,xEt),r.registerLayout(wEt),r.registerCoordinateSystem("graphView",{dimensions:W_.dimensions,create:TEt}),r.registerAction({type:"focusNodeAdjacency",event:"focusNodeAdjacency",update:"series:focusNodeAdjacency"},nn),r.registerAction({type:"unfocusNodeAdjacency",event:"unfocusNodeAdjacency",update:"series:unfocusNodeAdjacency"},nn),r.registerAction(FEt,function(t,e,i){e.eachComponent({mainType:"series",query:t},function(n){var a=n.coordinateSystem,s=GD(a,t,void 0,i);n.setCenter&&n.setCenter(s.center),n.setZoom&&n.setZoom(s.zoom)})})}var zEt=function(){function r(){this.angle=0,this.width=10,this.r=10,this.x=0,this.y=0}return r}(),VEt=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i.type="pointer",i}return t.prototype.getDefaultShape=function(){return new zEt},t.prototype.buildPath=function(e,i){var n=Math.cos,a=Math.sin,s=i.r,o=i.width,l=i.angle,u=i.x-n(l)*o*(o>=s/3?1:2),c=i.y-a(l)*o*(o>=s/3?1:2);l=i.angle-Math.PI/2,e.moveTo(u,c),e.lineTo(i.x+n(l)*o,i.y+a(l)*o),e.lineTo(i.x+n(i.angle)*s,i.y+a(i.angle)*s),e.lineTo(i.x-n(l)*o,i.y-a(l)*o),e.lineTo(u,c)},t}(vr);const UEt=VEt;function $Et(r,t){var e=r.get("center"),i=t.getWidth(),n=t.getHeight(),a=Math.min(i,n),s=he(e[0],t.getWidth()),o=he(e[1],t.getHeight()),l=he(r.get("radius"),a/2);return{cx:s,cy:o,r:l}}function y1(r,t){var e=r==null?"":r+"";return t&&(ve(t)?e=t.replace("{value}",e):Ve(t)&&(e=t(r))),e}var WEt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){this.group.removeAll();var a=e.get(["axisLine","lineStyle","color"]),s=$Et(e,n);this._renderMain(e,i,n,a,s),this._data=e.getData()},t.prototype.dispose=function(){},t.prototype._renderMain=function(e,i,n,a,s){var o=this.group,l=e.get("clockwise"),u=-e.get("startAngle")/180*Math.PI,c=-e.get("endAngle")/180*Math.PI,h=e.getModel("axisLine"),p=h.get("roundCap"),v=p?yw:fs,y=h.get("show"),x=h.getModel("lineStyle"),w=x.get("width"),T=[u,c];HR(T,!l),u=T[0],c=T[1];for(var E=c-u,M=u,L=[],F=0;y&&F<a.length;F++){var O=Math.min(Math.max(a[F][0],0),1);c=u+E*O;var U=new v({shape:{startAngle:M,endAngle:c,cx:s.cx,cy:s.cy,clockwise:l,r0:s.r-w,r:s.r},silent:!0});U.setStyle({fill:a[F][1]}),U.setStyle(x.getLineStyle(["color","width"])),L.push(U),M=c}L.reverse(),J(L,function(H){return o.add(H)});var W=function(H){if(H<=0)return a[0][1];var j;for(j=0;j<a.length;j++)if(a[j][0]>=H&&(j===0?0:a[j-1][0])<H)return a[j][1];return a[j-1][1]};this._renderTicks(e,i,n,W,s,u,c,l,w),this._renderTitleAndDetail(e,i,n,W,s),this._renderAnchor(e,s),this._renderPointer(e,i,n,W,s,u,c,l,w)},t.prototype._renderTicks=function(e,i,n,a,s,o,l,u,c){for(var h=this.group,p=s.cx,v=s.cy,y=s.r,x=+e.get("min"),w=+e.get("max"),T=e.getModel("splitLine"),E=e.getModel("axisTick"),M=e.getModel("axisLabel"),L=e.get("splitNumber"),F=E.get("splitNumber"),O=he(T.get("length"),y),U=he(E.get("length"),y),W=o,H=(l-o)/L,j=H/F,Y=T.getModel("lineStyle").getLineStyle(),tt=E.getModel("lineStyle").getLineStyle(),it=T.get("distance"),lt,ht,Tt=0;Tt<=L;Tt++){if(lt=Math.cos(W),ht=Math.sin(W),T.get("show")){var Ot=it?it+c:c,Rt=new $n({shape:{x1:lt*(y-Ot)+p,y1:ht*(y-Ot)+v,x2:lt*(y-O-Ot)+p,y2:ht*(y-O-Ot)+v},style:Y,silent:!0});Y.stroke==="auto"&&Rt.setStyle({stroke:a(Tt/L)}),h.add(Rt)}if(M.get("show")){var Ot=M.get("distance")+it,Ut=y1(Yi(Tt/L*(w-x)+x),M.get("formatter")),Jt=a(Tt/L),ne=lt*(y-O-Ot)+p,se=ht*(y-O-Ot)+v,ce=M.get("rotate"),ye=0;ce==="radial"?(ye=-W+2*Math.PI,ye>Math.PI/2&&(ye+=Math.PI)):ce==="tangential"?ye=-W-Math.PI/2:Fr(ce)&&(ye=ce*Math.PI/180),ye===0?h.add(new Nr({style:hi(M,{text:Ut,x:ne,y:se,verticalAlign:ht<-.8?"top":ht>.8?"bottom":"middle",align:lt<-.4?"left":lt>.4?"right":"center"},{inheritColor:Jt}),silent:!0})):h.add(new Nr({style:hi(M,{text:Ut,x:ne,y:se,verticalAlign:"middle",align:"center"},{inheritColor:Jt}),silent:!0,originX:ne,originY:se,rotation:ye}))}if(E.get("show")&&Tt!==L){var Ot=E.get("distance");Ot=Ot?Ot+c:c;for(var Qe=0;Qe<=F;Qe++){lt=Math.cos(W),ht=Math.sin(W);var sr=new $n({shape:{x1:lt*(y-Ot)+p,y1:ht*(y-Ot)+v,x2:lt*(y-U-Ot)+p,y2:ht*(y-U-Ot)+v},silent:!0,style:tt});tt.stroke==="auto"&&sr.setStyle({stroke:a((Tt+Qe/F)/L)}),h.add(sr),W+=j}W-=j}else W+=H}},t.prototype._renderPointer=function(e,i,n,a,s,o,l,u,c){var h=this.group,p=this._data,v=this._progressEls,y=[],x=e.get(["pointer","show"]),w=e.getModel("progress"),T=w.get("show"),E=e.getData(),M=E.mapDimension("value"),L=+e.get("min"),F=+e.get("max"),O=[L,F],U=[o,l];function W(j,Y){var tt=E.getItemModel(j),it=tt.getModel("pointer"),lt=he(it.get("width"),s.r),ht=he(it.get("length"),s.r),Tt=e.get(["pointer","icon"]),Ot=it.get("offsetCenter"),Rt=he(Ot[0],s.r),Ut=he(Ot[1],s.r),Jt=it.get("keepAspect"),ne;return Tt?ne=mn(Tt,Rt-lt/2,Ut-ht,lt,ht,null,Jt):ne=new UEt({shape:{angle:-Math.PI/2,width:lt,r:ht,x:Rt,y:Ut}}),ne.rotation=-(Y+Math.PI/2),ne.x=s.cx,ne.y=s.cy,ne}function H(j,Y){var tt=w.get("roundCap"),it=tt?yw:fs,lt=w.get("overlap"),ht=lt?w.get("width"):c/E.count(),Tt=lt?s.r-ht:s.r-(j+1)*ht,Ot=lt?s.r:s.r-j*ht,Rt=new it({shape:{startAngle:o,endAngle:Y,cx:s.cx,cy:s.cy,clockwise:u,r0:Tt,r:Ot}});return lt&&(Rt.z2=F-E.get(M,j)%F),Rt}(T||x)&&(E.diff(p).add(function(j){var Y=E.get(M,j);if(x){var tt=W(j,o);Ei(tt,{rotation:-((isNaN(+Y)?U[0]:Jr(Y,O,U,!0))+Math.PI/2)},e),h.add(tt),E.setItemGraphicEl(j,tt)}if(T){var it=H(j,o),lt=w.get("clip");Ei(it,{shape:{endAngle:Jr(Y,O,U,lt)}},e),h.add(it),iM(e.seriesIndex,E.dataType,j,it),y[j]=it}}).update(function(j,Y){var tt=E.get(M,j);if(x){var it=p.getItemGraphicEl(Y),lt=it?it.rotation:o,ht=W(j,lt);ht.rotation=lt,zr(ht,{rotation:-((isNaN(+tt)?U[0]:Jr(tt,O,U,!0))+Math.PI/2)},e),h.add(ht),E.setItemGraphicEl(j,ht)}if(T){var Tt=v[Y],Ot=Tt?Tt.shape.endAngle:o,Rt=H(j,Ot),Ut=w.get("clip");zr(Rt,{shape:{endAngle:Jr(tt,O,U,Ut)}},e),h.add(Rt),iM(e.seriesIndex,E.dataType,j,Rt),y[j]=Rt}}).execute(),E.each(function(j){var Y=E.getItemModel(j),tt=Y.getModel("emphasis"),it=tt.get("focus"),lt=tt.get("blurScope"),ht=tt.get("disabled");if(x){var Tt=E.getItemGraphicEl(j),Ot=E.getItemVisual(j,"style"),Rt=Ot.fill;if(Tt instanceof ia){var Ut=Tt.style;Tt.useStyle(Zt({image:Ut.image,x:Ut.x,y:Ut.y,width:Ut.width,height:Ut.height},Ot))}else Tt.useStyle(Ot),Tt.type!=="pointer"&&Tt.setColor(Rt);Tt.setStyle(Y.getModel(["pointer","itemStyle"]).getItemStyle()),Tt.style.fill==="auto"&&Tt.setStyle("fill",a(Jr(E.get(M,j),O,[0,1],!0))),Tt.z2EmphasisLift=0,ea(Tt,Y),Ui(Tt,it,lt,ht)}if(T){var Jt=y[j];Jt.useStyle(E.getItemVisual(j,"style")),Jt.setStyle(Y.getModel(["progress","itemStyle"]).getItemStyle()),Jt.z2EmphasisLift=0,ea(Jt,Y),Ui(Jt,it,lt,ht)}}),this._progressEls=y)},t.prototype._renderAnchor=function(e,i){var n=e.getModel("anchor"),a=n.get("show");if(a){var s=n.get("size"),o=n.get("icon"),l=n.get("offsetCenter"),u=n.get("keepAspect"),c=mn(o,i.cx-s/2+he(l[0],i.r),i.cy-s/2+he(l[1],i.r),s,s,null,u);c.z2=n.get("showAbove")?1:0,c.setStyle(n.getModel("itemStyle").getItemStyle()),this.group.add(c)}},t.prototype._renderTitleAndDetail=function(e,i,n,a,s){var o=this,l=e.getData(),u=l.mapDimension("value"),c=+e.get("min"),h=+e.get("max"),p=new Ke,v=[],y=[],x=e.isAnimationEnabled(),w=e.get(["pointer","showAbove"]);l.diff(this._data).add(function(T){v[T]=new Nr({silent:!0}),y[T]=new Nr({silent:!0})}).update(function(T,E){v[T]=o._titleEls[E],y[T]=o._detailEls[E]}).execute(),l.each(function(T){var E=l.getItemModel(T),M=l.get(u,T),L=new Ke,F=a(Jr(M,[c,h],[0,1],!0)),O=E.getModel("title");if(O.get("show")){var U=O.get("offsetCenter"),W=s.cx+he(U[0],s.r),H=s.cy+he(U[1],s.r),j=v[T];j.attr({z2:w?0:2,style:hi(O,{x:W,y:H,text:l.getName(T),align:"center",verticalAlign:"middle"},{inheritColor:F})}),L.add(j)}var Y=E.getModel("detail");if(Y.get("show")){var tt=Y.get("offsetCenter"),it=s.cx+he(tt[0],s.r),lt=s.cy+he(tt[1],s.r),ht=he(Y.get("width"),s.r),Tt=he(Y.get("height"),s.r),Ot=e.get(["progress","show"])?l.getItemVisual(T,"style").fill:F,j=y[T],Rt=Y.get("formatter");j.attr({z2:w?0:2,style:hi(Y,{x:it,y:lt,text:y1(M,Rt),width:isNaN(ht)?null:ht,height:isNaN(Tt)?null:Tt,align:"center",verticalAlign:"middle"},{inheritColor:Ot})}),N7(j,{normal:Y},M,function(Jt){return y1(Jt,Rt)}),x&&F7(j,T,l,e,{getFormattedLabel:function(Jt,ne,se,ce,ye,Qe){return y1(Qe?Qe.interpolatedValue:M,Rt)}}),L.add(j)}p.add(L)}),this.group.add(p),this._titleEls=v,this._detailEls=y},t.type="gauge",t}(di);const HEt=WEt;var GEt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.visualStyleAccessPath="itemStyle",e}return t.prototype.getInitialData=function(e,i){return Hg(this,["value"])},t.type="series.gauge",t.defaultOption={z:2,colorBy:"data",center:["50%","50%"],legendHoverLink:!0,radius:"75%",startAngle:225,endAngle:-45,clockwise:!0,min:0,max:100,splitNumber:10,axisLine:{show:!0,roundCap:!1,lineStyle:{color:[[1,"#E6EBF8"]],width:10}},progress:{show:!1,overlap:!0,width:10,roundCap:!1,clip:!0},splitLine:{show:!0,length:10,distance:10,lineStyle:{color:"#63677A",width:3,type:"solid"}},axisTick:{show:!0,splitNumber:5,length:6,distance:10,lineStyle:{color:"#63677A",width:1,type:"solid"}},axisLabel:{show:!0,distance:15,color:"#464646",fontSize:12,rotate:0},pointer:{icon:null,offsetCenter:[0,0],show:!0,showAbove:!0,length:"60%",width:6,keepAspect:!1},anchor:{show:!1,showAbove:!1,size:6,icon:"circle",offsetCenter:[0,0],keepAspect:!1,itemStyle:{color:"#fff",borderWidth:0,borderColor:"#5470c6"}},title:{show:!0,offsetCenter:[0,"20%"],color:"#464646",fontSize:16,valueAnimation:!1},detail:{show:!0,backgroundColor:"rgba(0,0,0,0)",borderWidth:0,borderColor:"#ccc",width:100,height:null,padding:[5,10],offsetCenter:[0,"40%"],color:"#464646",fontSize:30,fontWeight:"bold",lineHeight:30,valueAnimation:!1}},t}(Li);const jEt=GEt;function XEt(r){r.registerChartView(HEt),r.registerSeriesModel(jEt)}var ZEt=["itemStyle","opacity"],qEt=function(r){Vt(t,r);function t(e,i){var n=r.call(this)||this,a=n,s=new ps,o=new Nr;return a.setTextContent(o),n.setTextGuideLine(s),n.updateData(e,i,!0),n}return t.prototype.updateData=function(e,i,n){var a=this,s=e.hostModel,o=e.getItemModel(i),l=e.getItemLayout(i),u=o.getModel("emphasis"),c=o.get(ZEt);c=c??1,n||Vo(a),a.useStyle(e.getItemVisual(i,"style")),a.style.lineJoin="round",n?(a.setShape({points:l.points}),a.style.opacity=0,Ei(a,{style:{opacity:c}},s,i)):zr(a,{style:{opacity:c},shape:{points:l.points}},s,i),ea(a,o),this._updateLabel(e,i),Ui(this,u.get("focus"),u.get("blurScope"),u.get("disabled"))},t.prototype._updateLabel=function(e,i){var n=this,a=this.getTextGuideLine(),s=n.getTextContent(),o=e.hostModel,l=e.getItemModel(i),u=e.getItemLayout(i),c=u.label,h=e.getItemVisual(i,"style"),p=h.fill;ra(s,Dn(l),{labelFetcher:e.hostModel,labelDataIndex:i,defaultOpacity:h.opacity,defaultText:e.getName(i)},{normal:{align:c.textAlign,verticalAlign:c.verticalAlign}}),n.setTextConfig({local:!0,inside:!!c.inside,insideStroke:p,outsideFill:p});var v=c.linePoints;a.setShape({points:v}),n.textGuideLineConfig={anchor:v?new lr(v[0][0],v[0][1]):null},zr(s,{style:{x:c.x,y:c.y}},o,i),s.attr({rotation:c.rotation,originX:c.x,originY:c.y,z2:10}),DD(n,LD(l),{stroke:p})},t}(ds),YEt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.ignoreLabelLineUpdate=!0,e}return t.prototype.render=function(e,i,n){var a=e.getData(),s=this._data,o=this.group;a.diff(s).add(function(l){var u=new qEt(a,l);a.setItemGraphicEl(l,u),o.add(u)}).update(function(l,u){var c=s.getItemGraphicEl(u);c.updateData(a,l),o.add(c),a.setItemGraphicEl(l,c)}).remove(function(l){var u=s.getItemGraphicEl(l);Zy(u,e,l)}).execute(),this._data=a},t.prototype.remove=function(){this.group.removeAll(),this._data=null},t.prototype.dispose=function(){},t.type="funnel",t}(di);const KEt=YEt;var JEt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e){r.prototype.init.apply(this,arguments),this.legendVisualProvider=new U_(we(this.getData,this),we(this.getRawData,this)),this._defaultLabelLine(e)},t.prototype.getInitialData=function(e,i){return Hg(this,{coordDimensions:["value"],encodeDefaulter:nr(uD,this)})},t.prototype._defaultLabelLine=function(e){$f(e,"labelLine",["show"]);var i=e.labelLine,n=e.emphasis.labelLine;i.show=i.show&&e.label.show,n.show=n.show&&e.emphasis.label.show},t.prototype.getDataParams=function(e){var i=this.getData(),n=r.prototype.getDataParams.call(this,e),a=i.mapDimension("value"),s=i.getSum(a);return n.percent=s?+(i.get(a,e)/s*100).toFixed(2):0,n.$vars.push("percent"),n},t.type="series.funnel",t.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",left:80,top:60,right:80,bottom:60,minSize:"0%",maxSize:"100%",sort:"descending",orient:"vertical",gap:0,funnelAlign:"center",label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{show:!0}},select:{itemStyle:{borderColor:"#212121"}}},t}(Li);const QEt=JEt;function tIt(r,t){return bn(r.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function eIt(r,t){for(var e=r.mapDimension("value"),i=r.mapArray(e,function(l){return l}),n=[],a=t==="ascending",s=0,o=r.count();s<o;s++)n[s]=s;return Ve(t)?n.sort(t):t!=="none"&&n.sort(function(l,u){return a?i[l]-i[u]:i[u]-i[l]}),n}function rIt(r){var t=r.hostModel,e=t.get("orient");r.each(function(i){var n=r.getItemModel(i),a=n.getModel("label"),s=a.get("position"),o=n.getModel("labelLine"),l=r.getItemLayout(i),u=l.points,c=s==="inner"||s==="inside"||s==="center"||s==="insideLeft"||s==="insideRight",h,p,v,y;if(c)s==="insideLeft"?(p=(u[0][0]+u[3][0])/2+5,v=(u[0][1]+u[3][1])/2,h="left"):s==="insideRight"?(p=(u[1][0]+u[2][0])/2-5,v=(u[1][1]+u[2][1])/2,h="right"):(p=(u[0][0]+u[1][0]+u[2][0]+u[3][0])/4,v=(u[0][1]+u[1][1]+u[2][1]+u[3][1])/4,h="center"),y=[[p,v],[p,v]];else{var x=void 0,w=void 0,T=void 0,E=void 0,M=o.get("length");s==="left"?(x=(u[3][0]+u[0][0])/2,w=(u[3][1]+u[0][1])/2,T=x-M,p=T-5,h="right"):s==="right"?(x=(u[1][0]+u[2][0])/2,w=(u[1][1]+u[2][1])/2,T=x+M,p=T+5,h="left"):s==="top"?(x=(u[3][0]+u[0][0])/2,w=(u[3][1]+u[0][1])/2,E=w-M,v=E-5,h="center"):s==="bottom"?(x=(u[1][0]+u[2][0])/2,w=(u[1][1]+u[2][1])/2,E=w+M,v=E+5,h="center"):s==="rightTop"?(x=e==="horizontal"?u[3][0]:u[1][0],w=e==="horizontal"?u[3][1]:u[1][1],e==="horizontal"?(E=w-M,v=E-5,h="center"):(T=x+M,p=T+5,h="top")):s==="rightBottom"?(x=u[2][0],w=u[2][1],e==="horizontal"?(E=w+M,v=E+5,h="center"):(T=x+M,p=T+5,h="bottom")):s==="leftTop"?(x=u[0][0],w=e==="horizontal"?u[0][1]:u[1][1],e==="horizontal"?(E=w-M,v=E-5,h="center"):(T=x-M,p=T-5,h="right")):s==="leftBottom"?(x=e==="horizontal"?u[1][0]:u[3][0],w=e==="horizontal"?u[1][1]:u[2][1],e==="horizontal"?(E=w+M,v=E+5,h="center"):(T=x-M,p=T-5,h="right")):(x=(u[1][0]+u[2][0])/2,w=(u[1][1]+u[2][1])/2,e==="horizontal"?(E=w+M,v=E+5,h="center"):(T=x+M,p=T+5,h="left")),e==="horizontal"?(T=x,p=T):(E=w,v=E),y=[[x,w],[T,E]]}l.label={linePoints:y,x:p,y:v,verticalAlign:"middle",textAlign:h,inside:c}})}function iIt(r,t){r.eachSeriesByType("funnel",function(e){var i=e.getData(),n=i.mapDimension("value"),a=e.get("sort"),s=tIt(e,t),o=e.get("orient"),l=s.width,u=s.height,c=eIt(i,a),h=s.x,p=s.y,v=o==="horizontal"?[he(e.get("minSize"),u),he(e.get("maxSize"),u)]:[he(e.get("minSize"),l),he(e.get("maxSize"),l)],y=i.getDataExtent(n),x=e.get("min"),w=e.get("max");x==null&&(x=Math.min(y[0],0)),w==null&&(w=y[1]);var T=e.get("funnelAlign"),E=e.get("gap"),M=o==="horizontal"?l:u,L=(M-E*(i.count()-1))/i.count(),F=function(lt,ht){if(o==="horizontal"){var Tt=i.get(n,lt)||0,Ot=Jr(Tt,[x,w],v,!0),Rt=void 0;switch(T){case"top":Rt=p;break;case"center":Rt=p+(u-Ot)/2;break;case"bottom":Rt=p+(u-Ot);break}return[[ht,Rt],[ht,Rt+Ot]]}var Ut=i.get(n,lt)||0,Jt=Jr(Ut,[x,w],v,!0),ne;switch(T){case"left":ne=h;break;case"center":ne=h+(l-Jt)/2;break;case"right":ne=h+l-Jt;break}return[[ne,ht],[ne+Jt,ht]]};a==="ascending"&&(L=-L,E=-E,o==="horizontal"?h+=l:p+=u,c=c.reverse());for(var O=0;O<c.length;O++){var U=c[O],W=c[O+1],H=i.getItemModel(U);if(o==="horizontal"){var j=H.get(["itemStyle","width"]);j==null?j=L:(j=he(j,l),a==="ascending"&&(j=-j));var Y=F(U,h),tt=F(W,h+j);h+=j+E,i.setItemLayout(U,{points:Y.concat(tt.slice().reverse())})}else{var it=H.get(["itemStyle","height"]);it==null?it=L:(it=he(it,u),a==="ascending"&&(it=-it));var Y=F(U,p),tt=F(W,p+it);p+=it+E,i.setItemLayout(U,{points:Y.concat(tt.slice().reverse())})}}rIt(i)})}function nIt(r){r.registerChartView(KEt),r.registerSeriesModel(QEt),r.registerLayout(iIt),r.registerProcessor(V_("funnel"))}var aIt=.3,sIt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e._dataGroup=new Ke,e._initialized=!1,e}return t.prototype.init=function(){this.group.add(this._dataGroup)},t.prototype.render=function(e,i,n,a){this._progressiveEls=null;var s=this._dataGroup,o=e.getData(),l=this._data,u=e.coordinateSystem,c=u.dimensions,h=sV(e);o.diff(l).add(p).update(v).remove(y).execute();function p(w){var T=aV(o,s,w,c,u);zC(T,o,w,h)}function v(w,T){var E=l.getItemGraphicEl(T),M=mX(o,w,c,u);o.setItemGraphicEl(w,E),zr(E,{shape:{points:M}},e,w),Vo(E),zC(E,o,w,h)}function y(w){var T=l.getItemGraphicEl(w);s.remove(T)}if(!this._initialized){this._initialized=!0;var x=oIt(u,e,function(){setTimeout(function(){s.removeClipPath()})});s.setClipPath(x)}this._data=o},t.prototype.incrementalPrepareRender=function(e,i,n){this._initialized=!0,this._data=null,this._dataGroup.removeAll()},t.prototype.incrementalRender=function(e,i,n){for(var a=i.getData(),s=i.coordinateSystem,o=s.dimensions,l=sV(i),u=this._progressiveEls=[],c=e.start;c<e.end;c++){var h=aV(a,this._dataGroup,c,o,s);h.incremental=!0,zC(h,a,c,l),u.push(h)}},t.prototype.remove=function(){this._dataGroup&&this._dataGroup.removeAll(),this._data=null},t.type="parallel",t}(di);function oIt(r,t,e){var i=r.model,n=r.getRect(),a=new Pr({shape:{x:n.x,y:n.y,width:n.width,height:n.height}}),s=i.get("layout")==="horizontal"?"width":"height";return a.setShape(s,0),Ei(a,{shape:{width:n.width,height:n.height}},t,e),a}function mX(r,t,e,i){for(var n=[],a=0;a<e.length;a++){var s=e[a],o=r.get(r.mapDimension(s),t);lIt(o,i.getAxis(s).type)||n.push(i.dataToPoint(o,s))}return n}function aV(r,t,e,i,n){var a=mX(r,e,i,n),s=new ps({shape:{points:a},z2:10});return t.add(s),r.setItemGraphicEl(e,s),s}function sV(r){var t=r.get("smooth",!0);return t===!0&&(t=aIt),t=gu(t),zy(t)&&(t=0),{smooth:t}}function zC(r,t,e,i){r.useStyle(t.getItemVisual(e,"style")),r.style.fill=null,r.setShape("smooth",i.smooth);var n=t.getItemModel(e),a=n.getModel("emphasis");ea(r,n,"lineStyle"),Ui(r,a.get("focus"),a.get("blurScope"),a.get("disabled"))}function lIt(r,t){return t==="category"?r==null:r==null||isNaN(r)}const uIt=sIt;var cIt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.visualStyleAccessPath="lineStyle",e.visualDrawType="stroke",e}return t.prototype.getInitialData=function(e,i){return Su(null,this,{useEncodeDefaulter:we(hIt,null,this)})},t.prototype.getRawIndicesByActiveState=function(e){var i=this.coordinateSystem,n=this.getData(),a=[];return i.eachActiveState(n,function(s,o){e===s&&a.push(n.getRawIndex(o))}),a},t.type="series.parallel",t.dependencies=["parallel"],t.defaultOption={z:2,coordinateSystem:"parallel",parallelIndex:0,label:{show:!1},inactiveOpacity:.05,activeOpacity:1,lineStyle:{width:1,opacity:.45,type:"solid"},emphasis:{label:{show:!1}},progressive:500,smooth:!1,animationEasing:"linear"},t}(Li);function hIt(r){var t=r.ecModel.getComponent("parallel",r.get("parallelIndex"));if(t){var e={};return J(t.dimensions,function(i){var n=fIt(i);e[i]=n}),e}}function fIt(r){return+r.replace("dim","")}const dIt=cIt;var pIt=["lineStyle","opacity"],gIt={seriesType:"parallel",reset:function(r,t){var e=r.coordinateSystem,i={normal:r.get(["lineStyle","opacity"]),active:r.get("activeOpacity"),inactive:r.get("inactiveOpacity")};return{progress:function(n,a){e.eachActiveState(a,function(s,o){var l=i[s];if(s==="normal"&&a.hasItemOption){var u=a.getItemModel(o).get(pIt,!0);u!=null&&(l=u)}var c=a.ensureUniqueItemVisual(o,"style");c.opacity=l},n.start,n.end)}}}};const vIt=gIt;function mIt(r){yIt(r),_It(r)}function yIt(r){if(!r.parallel){var t=!1;J(r.series,function(e){e&&e.type==="parallel"&&(t=!0)}),t&&(r.parallel=[{}])}}function _It(r){var t=ri(r.parallelAxis);J(t,function(e){if(je(e)){var i=e.parallelIndex||0,n=ri(r.parallel)[i];n&&n.parallelAxisDefault&&cr(e,n.parallelAxisDefault,!1)}})}var xIt=5,bIt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){this._model=e,this._api=n,this._handlers||(this._handlers={},J(wIt,function(a,s){n.getZr().on(s,this._handlers[s]=we(a,this))},this)),Ug(this,"_throttledDispatchExpand",e.get("axisExpandRate"),"fixRate")},t.prototype.dispose=function(e,i){Jy(this,"_throttledDispatchExpand"),J(this._handlers,function(n,a){i.getZr().off(a,n)}),this._handlers=null},t.prototype._throttledDispatchExpand=function(e){this._dispatchExpand(e)},t.prototype._dispatchExpand=function(e){e&&this._api.dispatchAction(Zt({type:"parallelAxisExpand"},e))},t.type="parallel",t}($i),wIt={mousedown:function(r){VC(this,"click")&&(this._mouseDownPoint=[r.offsetX,r.offsetY])},mouseup:function(r){var t=this._mouseDownPoint;if(VC(this,"click")&&t){var e=[r.offsetX,r.offsetY],i=Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2);if(i>xIt)return;var n=this._model.coordinateSystem.getSlidedAxisExpandWindow([r.offsetX,r.offsetY]);n.behavior!=="none"&&this._dispatchExpand({axisExpandWindow:n.axisExpandWindow})}this._mouseDownPoint=null},mousemove:function(r){if(!(this._mouseDownPoint||!VC(this,"mousemove"))){var t=this._model,e=t.coordinateSystem.getSlidedAxisExpandWindow([r.offsetX,r.offsetY]),i=e.behavior;i==="jump"&&this._throttledDispatchExpand.debounceNextCall(t.get("axisExpandDebounce")),this._throttledDispatchExpand(i==="none"?null:{axisExpandWindow:e.axisExpandWindow,animation:i==="jump"?null:{duration:0}})}}};function VC(r,t){var e=r._model;return e.get("axisExpandable")&&e.get("axisExpandTriggerOn")===t}const SIt=bIt;var TIt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){r.prototype.init.apply(this,arguments),this.mergeOption({})},t.prototype.mergeOption=function(e){var i=this.option;e&&cr(i,e,!0),this._initDimensions()},t.prototype.contains=function(e,i){var n=e.get("parallelIndex");return n!=null&&i.getComponent("parallel",n)===this},t.prototype.setAxisExpand=function(e){J(["axisExpandable","axisExpandCenter","axisExpandCount","axisExpandWidth","axisExpandWindow"],function(i){e.hasOwnProperty(i)&&(this.option[i]=e[i])},this)},t.prototype._initDimensions=function(){var e=this.dimensions=[],i=this.parallelAxisIndex=[],n=ti(this.ecModel.queryComponents({mainType:"parallelAxis"}),function(a){return(a.get("parallelIndex")||0)===this.componentIndex},this);J(n,function(a){e.push("dim"+a.get("dim")),i.push(a.componentIndex)})},t.type="parallel",t.dependencies=["parallelAxis"],t.layoutMode="box",t.defaultOption={z:0,left:80,top:60,right:80,bottom:60,layout:"horizontal",axisExpandable:!1,axisExpandCenter:null,axisExpandCount:0,axisExpandWidth:50,axisExpandRate:17,axisExpandDebounce:50,axisExpandSlideTriggerArea:[-.15,.05,.4],axisExpandTriggerOn:"click",parallelAxisDefault:null},t}(kr);const AIt=TIt;var CIt=function(r){Vt(t,r);function t(e,i,n,a,s){var o=r.call(this,e,i,n)||this;return o.type=a||"value",o.axisIndex=s,o}return t.prototype.isHorizontal=function(){return this.coordinateSystem.getModel().get("layout")!=="horizontal"},t}($o);const EIt=CIt;function od(r,t,e,i,n,a){r=r||0;var s=e[1]-e[0];if(n!=null&&(n=vp(n,[0,s])),a!=null&&(a=Math.max(a,n??0)),i==="all"){var o=Math.abs(t[1]-t[0]);o=vp(o,[0,s]),n=a=vp(o,[n,a]),i=0}t[0]=vp(t[0],e),t[1]=vp(t[1],e);var l=UC(t,i);t[i]+=r;var u=n||0,c=e.slice();l.sign<0?c[0]+=u:c[1]-=u,t[i]=vp(t[i],c);var h;return h=UC(t,i),n!=null&&(h.sign!==l.sign||h.span<n)&&(t[1-i]=t[i]+l.sign*n),h=UC(t,i),a!=null&&h.span>a&&(t[1-i]=t[i]+h.sign*a),t}function UC(r,t){var e=r[t]-r[1-t];return{span:Math.abs(e),sign:e>0?-1:e<0?1:t?-1:1}}function vp(r,t){return Math.min(t[1]!=null?t[1]:1/0,Math.max(t[0]!=null?t[0]:-1/0,r))}var $C=J,yX=Math.min,_X=Math.max,oV=Math.floor,IIt=Math.ceil,lV=Yi,MIt=Math.PI,PIt=function(){function r(t,e,i){this.type="parallel",this._axesMap=Re(),this._axesLayout={},this.dimensions=t.dimensions,this._model=t,this._init(t,e,i)}return r.prototype._init=function(t,e,i){var n=t.dimensions,a=t.parallelAxisIndex;$C(n,function(s,o){var l=a[o],u=e.getComponent("parallelAxis",l),c=this._axesMap.set(s,new EIt(s,jS(u),[0,0],u.get("type"),l)),h=c.type==="category";c.onBand=h&&u.get("boundaryGap"),c.inverse=u.get("inverse"),u.axis=c,c.model=u,c.coordinateSystem=u.coordinateSystem=this},this)},r.prototype.update=function(t,e){this._updateAxesFromSeries(this._model,t)},r.prototype.containPoint=function(t){var e=this._makeLayoutInfo(),i=e.axisBase,n=e.layoutBase,a=e.pixelDimIndex,s=t[1-a],o=t[a];return s>=i&&s<=i+e.axisLength&&o>=n&&o<=n+e.layoutLength},r.prototype.getModel=function(){return this._model},r.prototype._updateAxesFromSeries=function(t,e){e.eachSeries(function(i){if(t.contains(i,e)){var n=i.getData();$C(this.dimensions,function(a){var s=this._axesMap.get(a);s.scale.unionExtentFromData(n,n.mapDimension(a)),vg(s.scale,s.model)},this)}},this)},r.prototype.resize=function(t,e){this._rect=bn(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()}),this._layoutAxes()},r.prototype.getRect=function(){return this._rect},r.prototype._makeLayoutInfo=function(){var t=this._model,e=this._rect,i=["x","y"],n=["width","height"],a=t.get("layout"),s=a==="horizontal"?0:1,o=e[n[s]],l=[0,o],u=this.dimensions.length,c=_1(t.get("axisExpandWidth"),l),h=_1(t.get("axisExpandCount")||0,[0,u]),p=t.get("axisExpandable")&&u>3&&u>h&&h>1&&c>0&&o>0,v=t.get("axisExpandWindow"),y;if(v)y=_1(v[1]-v[0],l),v[1]=v[0]+y;else{y=_1(c*(h-1),l);var x=t.get("axisExpandCenter")||oV(u/2);v=[c*x-y/2],v[1]=v[0]+y}var w=(o-y)/(u-h);w<3&&(w=0);var T=[oV(lV(v[0]/c,1))+1,IIt(lV(v[1]/c,1))-1],E=w/c*v[0];return{layout:a,pixelDimIndex:s,layoutBase:e[i[s]],layoutLength:o,axisBase:e[i[1-s]],axisLength:e[n[1-s]],axisExpandable:p,axisExpandWidth:c,axisCollapseWidth:w,axisExpandWindow:v,axisCount:u,winInnerIndices:T,axisExpandWindow0Pos:E}},r.prototype._layoutAxes=function(){var t=this._rect,e=this._axesMap,i=this.dimensions,n=this._makeLayoutInfo(),a=n.layout;e.each(function(s){var o=[0,n.axisLength],l=s.inverse?1:0;s.setExtent(o[l],o[1-l])}),$C(i,function(s,o){var l=(n.axisExpandable?DIt:RIt)(o,n),u={horizontal:{x:l.position,y:n.axisLength},vertical:{x:0,y:l.position}},c={horizontal:MIt/2,vertical:0},h=[u[a].x+t.x,u[a].y+t.y],p=c[a],v=Es();td(v,v,p),wl(v,v,h),this._axesLayout[s]={position:h,rotation:p,transform:v,axisNameAvailableWidth:l.axisNameAvailableWidth,axisLabelShow:l.axisLabelShow,nameTruncateMaxWidth:l.nameTruncateMaxWidth,tickDirection:1,labelDirection:1}},this)},r.prototype.getAxis=function(t){return this._axesMap.get(t)},r.prototype.dataToPoint=function(t,e){return this.axisCoordToPoint(this._axesMap.get(e).dataToCoord(t),e)},r.prototype.eachActiveState=function(t,e,i,n){i==null&&(i=0),n==null&&(n=t.count());var a=this._axesMap,s=this.dimensions,o=[],l=[];J(s,function(w){o.push(t.mapDimension(w)),l.push(a.get(w).model)});for(var u=this.hasAxisBrushed(),c=i;c<n;c++){var h=void 0;if(!u)h="normal";else{h="active";for(var p=t.getValues(o,c),v=0,y=s.length;v<y;v++){var x=l[v].getActiveState(p[v]);if(x==="inactive"){h="inactive";break}}}e(h,c)}},r.prototype.hasAxisBrushed=function(){for(var t=this.dimensions,e=this._axesMap,i=!1,n=0,a=t.length;n<a;n++)e.get(t[n]).model.getActiveState()!=="normal"&&(i=!0);return i},r.prototype.axisCoordToPoint=function(t,e){var i=this._axesLayout[e];return Fo([t,0],i.transform)},r.prototype.getAxisLayout=function(t){return Ze(this._axesLayout[t])},r.prototype.getSlidedAxisExpandWindow=function(t){var e=this._makeLayoutInfo(),i=e.pixelDimIndex,n=e.axisExpandWindow.slice(),a=n[1]-n[0],s=[0,e.axisExpandWidth*(e.axisCount-1)];if(!this.containPoint(t))return{behavior:"none",axisExpandWindow:n};var o=t[i]-e.layoutBase-e.axisExpandWindow0Pos,l,u="slide",c=e.axisCollapseWidth,h=this._model.get("axisExpandSlideTriggerArea"),p=h[0]!=null;if(c)p&&c&&o<a*h[0]?(u="jump",l=o-a*h[2]):p&&c&&o>a*(1-h[0])?(u="jump",l=o-a*(1-h[2])):(l=o-a*h[1])>=0&&(l=o-a*(1-h[1]))<=0&&(l=0),l*=e.axisExpandWidth/c,l?od(l,n,s,"all"):u="none";else{var v=n[1]-n[0],y=s[1]*o/v;n=[_X(0,y-v/2)],n[1]=yX(s[1],n[0]+v),n[0]=n[1]-v}return{axisExpandWindow:n,behavior:u}},r}();function _1(r,t){return yX(_X(r,t[0]),t[1])}function RIt(r,t){var e=t.layoutLength/(t.axisCount-1);return{position:e*r,axisNameAvailableWidth:e,axisLabelShow:!0}}function DIt(r,t){var e=t.layoutLength,i=t.axisExpandWidth,n=t.axisCount,a=t.axisCollapseWidth,s=t.winInnerIndices,o,l=a,u=!1,c;return r<s[0]?(o=r*a,c=a):r<=s[1]?(o=t.axisExpandWindow0Pos+r*i-t.axisExpandWindow[0],l=i,u=!0):(o=e-(n-1-r)*a,c=a),{position:o,axisNameAvailableWidth:l,axisLabelShow:u,nameTruncateMaxWidth:c}}const LIt=PIt;function kIt(r,t){var e=[];return r.eachComponent("parallel",function(i,n){var a=new LIt(i,r,t);a.name="parallel_"+n,a.resize(i,t),i.coordinateSystem=a,a.model=i,e.push(a)}),r.eachSeries(function(i){if(i.get("coordinateSystem")==="parallel"){var n=i.getReferringComponents("parallel",vn).models[0];i.coordinateSystem=n.coordinateSystem}}),e}var OIt={create:kIt};const NIt=OIt;var xX=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.activeIntervals=[],e}return t.prototype.getAreaSelectStyle=function(){return Hf([["fill","color"],["lineWidth","borderWidth"],["stroke","borderColor"],["width","width"],["opacity","opacity"]])(this.getModel("areaSelectStyle"))},t.prototype.setActiveIntervals=function(e){var i=this.activeIntervals=Ze(e);if(i)for(var n=i.length-1;n>=0;n--)ro(i[n])},t.prototype.getActiveState=function(e){var i=this.activeIntervals;if(!i.length)return"normal";if(e==null||isNaN(+e))return"inactive";if(i.length===1){var n=i[0];if(n[0]<=e&&e<=n[1])return"active"}else for(var a=0,s=i.length;a<s;a++)if(i[a][0]<=e&&e<=i[a][1])return"active";return"inactive"},t}(kr);yn(xX,O_);const uV=xX;var Xf=!0,u_=Math.min,_g=Math.max,FIt=Math.pow,BIt=1e4,zIt=6,VIt=6,cV="globalPan",UIt={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},$It={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},hV={brushStyle:{lineWidth:2,stroke:"rgba(210,219,238,0.3)",fill:"#D2DBEE"},transformable:!0,brushMode:"single",removeOnClick:!1},WIt=0,HIt=function(r){Vt(t,r);function t(e){var i=r.call(this)||this;return i._track=[],i._covers=[],i._handlers={},i._zr=e,i.group=new Ke,i._uid="brushController_"+WIt++,J(KIt,function(n,a){this._handlers[a]=we(n,this)},i),i}return t.prototype.enableBrush=function(e){return this._brushType&&this._doDisableBrush(),e.brushType&&this._doEnableBrush(e),this},t.prototype._doEnableBrush=function(e){var i=this._zr;this._enableGlobalPan||t2t(i,cV,this._uid),J(this._handlers,function(n,a){i.on(a,n)}),this._brushType=e.brushType,this._brushOption=cr(Ze(hV),e,!0)},t.prototype._doDisableBrush=function(){var e=this._zr;e2t(e,cV,this._uid),J(this._handlers,function(i,n){e.off(n,i)}),this._brushType=this._brushOption=null},t.prototype.setPanels=function(e){if(e&&e.length){var i=this._panels={};J(e,function(n){i[n.panelId]=Ze(n)})}else this._panels=null;return this},t.prototype.mount=function(e){e=e||{},this._enableGlobalPan=e.enableGlobalPan;var i=this.group;return this._zr.add(i),i.attr({x:e.x||0,y:e.y||0,rotation:e.rotation||0,scaleX:e.scaleX||1,scaleY:e.scaleY||1}),this._transform=i.getLocalTransform(),this},t.prototype.updateCovers=function(e){e=te(e,function(p){return cr(Ze(hV),p,!0)});var i="\0-brush-index-",n=this._covers,a=this._covers=[],s=this,o=this._creatingCover;return new yu(n,e,u,l).add(c).update(c).remove(h).execute(),this;function l(p,v){return(p.id!=null?p.id:i+v)+"-"+p.brushType}function u(p,v){return l(p.__brushOption,v)}function c(p,v){var y=e[p];if(v!=null&&n[v]===o)a[p]=n[v];else{var x=a[p]=v!=null?(n[v].__brushOption=y,n[v]):wX(s,bX(s,y));rL(s,x)}}function h(p){n[p]!==o&&s.group.remove(n[p])}},t.prototype.unmount=function(){return this.enableBrush(!1),jM(this),this._zr.remove(this.group),this},t.prototype.dispose=function(){this.unmount(),this.off()},t}(so);function bX(r,t){var e=JS[t.brushType].createCover(r,t);return e.__brushOption=t,TX(e,t),r.group.add(e),e}function wX(r,t){var e=iL(t);return e.endCreating&&(e.endCreating(r,t),TX(t,t.__brushOption)),t}function SX(r,t){var e=t.__brushOption;iL(t).updateCoverShape(r,t,e.range,e)}function TX(r,t){var e=t.z;e==null&&(e=BIt),r.traverse(function(i){i.z=e,i.z2=e})}function rL(r,t){iL(t).updateCommon(r,t),SX(r,t)}function iL(r){return JS[r.__brushOption.brushType]}function nL(r,t,e){var i=r._panels;if(!i)return Xf;var n,a=r._transform;return J(i,function(s){s.isTargetByCursor(t,e,a)&&(n=s)}),n}function AX(r,t){var e=r._panels;if(!e)return Xf;var i=t.__brushOption.panelId;return i!=null?e[i]:Xf}function jM(r){var t=r._covers,e=t.length;return J(t,function(i){r.group.remove(i)},r),t.length=0,!!e}function Zf(r,t){var e=te(r._covers,function(i){var n=i.__brushOption,a=Ze(n.range);return{brushType:n.brushType,panelId:n.panelId,range:a}});r.trigger("brush",{areas:e,isEnd:!!t.isEnd,removeOnClick:!!t.removeOnClick})}function GIt(r){var t=r._track;if(!t.length)return!1;var e=t[t.length-1],i=t[0],n=e[0]-i[0],a=e[1]-i[1],s=FIt(n*n+a*a,.5);return s>zIt}function CX(r){var t=r.length-1;return t<0&&(t=0),[r[0],r[t]]}function EX(r,t,e,i){var n=new Ke;return n.add(new Pr({name:"main",style:aL(e),silent:!0,draggable:!0,cursor:"move",drift:nr(fV,r,t,n,["n","s","w","e"]),ondragend:nr(Zf,t,{isEnd:!0})})),J(i,function(a){n.add(new Pr({name:a.join(""),style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:nr(fV,r,t,n,a),ondragend:nr(Zf,t,{isEnd:!0})}))}),n}function IX(r,t,e,i){var n=i.brushStyle.lineWidth||0,a=_g(n,VIt),s=e[0][0],o=e[1][0],l=s-n/2,u=o-n/2,c=e[0][1],h=e[1][1],p=c-a+n/2,v=h-a+n/2,y=c-s,x=h-o,w=y+n,T=x+n;Yl(r,t,"main",s,o,y,x),i.transformable&&(Yl(r,t,"w",l,u,a,T),Yl(r,t,"e",p,u,a,T),Yl(r,t,"n",l,u,w,a),Yl(r,t,"s",l,v,w,a),Yl(r,t,"nw",l,u,a,a),Yl(r,t,"ne",p,u,a,a),Yl(r,t,"sw",l,v,a,a),Yl(r,t,"se",p,v,a,a))}function XM(r,t){var e=t.__brushOption,i=e.transformable,n=t.childAt(0);n.useStyle(aL(e)),n.attr({silent:!i,cursor:i?"move":"default"}),J([["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]],function(a){var s=t.childOfName(a.join("")),o=a.length===1?ZM(r,a[0]):XIt(r,a);s&&s.attr({silent:!i,invisible:!i,cursor:i?$It[o]+"-resize":null})})}function Yl(r,t,e,i,n,a,s){var o=t.childOfName(e);o&&o.setShape(qIt(sL(r,t,[[i,n],[i+a,n+s]])))}function aL(r){return We({strokeNoScale:!0},r.brushStyle)}function MX(r,t,e,i){var n=[u_(r,e),u_(t,i)],a=[_g(r,e),_g(t,i)];return[[n[0],a[0]],[n[1],a[1]]]}function jIt(r){return Mf(r.group)}function ZM(r,t){var e={w:"left",e:"right",n:"top",s:"bottom"},i={left:"w",right:"e",top:"n",bottom:"s"},n=PS(e[t],jIt(r));return i[n]}function XIt(r,t){var e=[ZM(r,t[0]),ZM(r,t[1])];return(e[0]==="e"||e[0]==="w")&&e.reverse(),e.join("")}function fV(r,t,e,i,n,a){var s=e.__brushOption,o=r.toRectRange(s.range),l=PX(t,n,a);J(i,function(u){var c=UIt[u];o[c[0]][c[1]]+=l[c[0]]}),s.range=r.fromRectRange(MX(o[0][0],o[1][0],o[0][1],o[1][1])),rL(t,e),Zf(t,{isEnd:!1})}function ZIt(r,t,e,i){var n=t.__brushOption.range,a=PX(r,e,i);J(n,function(s){s[0]+=a[0],s[1]+=a[1]}),rL(r,t),Zf(r,{isEnd:!1})}function PX(r,t,e){var i=r.group,n=i.transformCoordToLocal(t,e),a=i.transformCoordToLocal(0,0);return[n[0]-a[0],n[1]-a[1]]}function sL(r,t,e){var i=AX(r,t);return i&&i!==Xf?i.clipPath(e,r._transform):Ze(e)}function qIt(r){var t=u_(r[0][0],r[1][0]),e=u_(r[0][1],r[1][1]),i=_g(r[0][0],r[1][0]),n=_g(r[0][1],r[1][1]);return{x:t,y:e,width:i-t,height:n-e}}function YIt(r,t,e){if(!(!r._brushType||JIt(r,t.offsetX,t.offsetY))){var i=r._zr,n=r._covers,a=nL(r,t,e);if(!r._dragging)for(var s=0;s<n.length;s++){var o=n[s].__brushOption;if(a&&(a===Xf||o.panelId===a.panelId)&&JS[o.brushType].contain(n[s],e[0],e[1]))return}a&&i.setCursorStyle("crosshair")}}function qM(r){var t=r.event;t.preventDefault&&t.preventDefault()}function YM(r,t,e){return r.childOfName("main").contain(t,e)}function RX(r,t,e,i){var n=r._creatingCover,a=r._creatingPanel,s=r._brushOption,o;if(r._track.push(e.slice()),GIt(r)||n){if(a&&!n){s.brushMode==="single"&&jM(r);var l=Ze(s);l.brushType=dV(l.brushType,a),l.panelId=a===Xf?null:a.panelId,n=r._creatingCover=bX(r,l),r._covers.push(n)}if(n){var u=JS[dV(r._brushType,a)],c=n.__brushOption;c.range=u.getCreatingRange(sL(r,n,r._track)),i&&(wX(r,n),u.updateCommon(r,n)),SX(r,n),o={isEnd:i}}}else i&&s.brushMode==="single"&&s.removeOnClick&&nL(r,t,e)&&jM(r)&&(o={isEnd:i,removeOnClick:!0});return o}function dV(r,t){return r==="auto"?t.defaultBrushType:r}var KIt={mousedown:function(r){if(this._dragging)pV(this,r);else if(!r.target||!r.target.draggable){qM(r);var t=this.group.transformCoordToLocal(r.offsetX,r.offsetY);this._creatingCover=null;var e=this._creatingPanel=nL(this,r,t);e&&(this._dragging=!0,this._track=[t.slice()])}},mousemove:function(r){var t=r.offsetX,e=r.offsetY,i=this.group.transformCoordToLocal(t,e);if(YIt(this,r,i),this._dragging){qM(r);var n=RX(this,r,i,!1);n&&Zf(this,n)}},mouseup:function(r){pV(this,r)}};function pV(r,t){if(r._dragging){qM(t);var e=t.offsetX,i=t.offsetY,n=r.group.transformCoordToLocal(e,i),a=RX(r,t,n,!0);r._dragging=!1,r._track=[],r._creatingCover=null,a&&Zf(r,a)}}function JIt(r,t,e){var i=r._zr;return t<0||t>i.getWidth()||e<0||e>i.getHeight()}var JS={lineX:gV(0),lineY:gV(1),rect:{createCover:function(r,t){function e(i){return i}return EX({toRectRange:e,fromRectRange:e},r,t,[["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]])},getCreatingRange:function(r){var t=CX(r);return MX(t[1][0],t[1][1],t[0][0],t[0][1])},updateCoverShape:function(r,t,e,i){IX(r,t,e,i)},updateCommon:XM,contain:YM},polygon:{createCover:function(r,t){var e=new Ke;return e.add(new ps({name:"main",style:aL(t),silent:!0})),e},getCreatingRange:function(r){return r},endCreating:function(r,t){t.remove(t.childAt(0)),t.add(new ds({name:"main",draggable:!0,drift:nr(ZIt,r,t),ondragend:nr(Zf,r,{isEnd:!0})}))},updateCoverShape:function(r,t,e,i){t.childAt(0).setShape({points:sL(r,t,e)})},updateCommon:XM,contain:YM}};function gV(r){return{createCover:function(t,e){return EX({toRectRange:function(i){var n=[i,[0,100]];return r&&n.reverse(),n},fromRectRange:function(i){return i[r]}},t,e,[[["w"],["e"]],[["n"],["s"]]][r])},getCreatingRange:function(t){var e=CX(t),i=u_(e[0][r],e[1][r]),n=_g(e[0][r],e[1][r]);return[i,n]},updateCoverShape:function(t,e,i,n){var a,s=AX(t,e);if(s!==Xf&&s.getLinearBrushOtherExtent)a=s.getLinearBrushOtherExtent(r);else{var o=t._zr;a=[0,[o.getWidth(),o.getHeight()][1-r]]}var l=[i,a];r&&l.reverse(),IX(t,e,l,n)},updateCommon:XM,contain:YM}}const oL=HIt;function DX(r){return r=lL(r),function(t){return L7(t,r)}}function LX(r,t){return r=lL(r),function(e){var i=t??e,n=i?r.width:r.height,a=i?r.x:r.y;return[a,a+(n||0)]}}function kX(r,t,e){var i=lL(r);return function(n,a){return i.contain(a[0],a[1])&&!ZS(n,t,e)}}function lL(r){return hr.create(r)}var QIt=["axisLine","axisTickLabel","axisName"],tMt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,i){r.prototype.init.apply(this,arguments),(this._brushController=new oL(i.getZr())).on("brush",we(this._onBrush,this))},t.prototype.render=function(e,i,n,a){if(!eMt(e,i,a)){this.axisModel=e,this.api=n,this.group.removeAll();var s=this._axisGroup;if(this._axisGroup=new Ke,this.group.add(this._axisGroup),!!e.get("show")){var o=iMt(e,i),l=o.coordinateSystem,u=e.getAreaSelectStyle(),c=u.width,h=e.axis.dim,p=l.getAxisLayout(h),v=Zt({strokeContainThreshold:c},p),y=new _u(e,v);J(QIt,y.add,y),this._axisGroup.add(y.getGroup()),this._refreshBrushController(v,u,e,o,c,n),P_(s,this._axisGroup,e)}}},t.prototype._refreshBrushController=function(e,i,n,a,s,o){var l=n.axis.getExtent(),u=l[1]-l[0],c=Math.min(30,Math.abs(u)*.1),h=hr.create({x:l[0],y:-s/2,width:u,height:s});h.x-=c,h.width+=2*c,this._brushController.mount({enableGlobalPan:!0,rotation:e.rotation,x:e.position[0],y:e.position[1]}).setPanels([{panelId:"pl",clipPath:DX(h),isTargetByCursor:kX(h,o,a),getLinearBrushOtherExtent:LX(h,0)}]).enableBrush({brushType:"lineX",brushStyle:i,removeOnClick:!0}).updateCovers(rMt(n))},t.prototype._onBrush=function(e){var i=e.areas,n=this.axisModel,a=n.axis,s=te(i,function(o){return[a.coordToData(o.range[0],!0),a.coordToData(o.range[1],!0)]});(!n.option.realtime===e.isEnd||e.removeOnClick)&&this.api.dispatchAction({type:"axisAreaSelect",parallelAxisId:n.id,intervals:s})},t.prototype.dispose=function(){this._brushController.dispose()},t.type="parallelAxis",t}($i);function eMt(r,t,e){return e&&e.type==="axisAreaSelect"&&t.findComponents({mainType:"parallelAxis",query:e})[0]===r}function rMt(r){var t=r.axis;return te(r.activeIntervals,function(e){return{brushType:"lineX",panelId:"pl",range:[t.dataToCoord(e[0],!0),t.dataToCoord(e[1],!0)]}})}function iMt(r,t){return t.getComponent("parallel",r.get("parallelIndex"))}const nMt=tMt;var aMt={type:"axisAreaSelect",event:"axisAreaSelected"};function sMt(r){r.registerAction(aMt,function(t,e){e.eachComponent({mainType:"parallelAxis",query:t},function(i){i.axis.model.setActiveIntervals(t.intervals)})}),r.registerAction("parallelAxisExpand",function(t,e){e.eachComponent({mainType:"parallel",query:t},function(i){i.setAxisExpand(t)})})}var oMt={type:"value",areaSelectStyle:{width:20,borderWidth:1,borderColor:"rgba(160,197,232)",color:"rgba(160,197,232)",opacity:.3},realtime:!0,z:10};function OX(r){r.registerComponentView(SIt),r.registerComponentModel(AIt),r.registerCoordinateSystem("parallel",NIt),r.registerPreprocessor(mIt),r.registerComponentModel(uV),r.registerComponentView(nMt),yg(r,"parallel",uV,oMt),sMt(r)}function lMt(r){gr(OX),r.registerChartView(uIt),r.registerSeriesModel(dIt),r.registerVisual(r.PRIORITY.VISUAL.BRUSH,vIt)}var uMt=function(){function r(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.cpx2=0,this.cpy2=0,this.extent=0}return r}(),cMt=function(r){Vt(t,r);function t(e){return r.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new uMt},t.prototype.buildPath=function(e,i){var n=i.extent;e.moveTo(i.x1,i.y1),e.bezierCurveTo(i.cpx1,i.cpy1,i.cpx2,i.cpy2,i.x2,i.y2),i.orient==="vertical"?(e.lineTo(i.x2+n,i.y2),e.bezierCurveTo(i.cpx2+n,i.cpy2,i.cpx1+n,i.cpy1,i.x1+n,i.y1)):(e.lineTo(i.x2,i.y2+n),e.bezierCurveTo(i.cpx2,i.cpy2+n,i.cpx1,i.cpy1+n,i.x1,i.y1+n)),e.closePath()},t.prototype.highlight=function(){vu(this)},t.prototype.downplay=function(){mu(this)},t}(vr),hMt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e._focusAdjacencyDisabled=!1,e}return t.prototype.render=function(e,i,n){var a=this,s=e.getGraph(),o=this.group,l=e.layoutInfo,u=l.width,c=l.height,h=e.getData(),p=e.getData("edge"),v=e.get("orient");this._model=e,o.removeAll(),o.x=l.x,o.y=l.y,s.eachEdge(function(y){var x=new cMt,w=Je(x);w.dataIndex=y.dataIndex,w.seriesIndex=e.seriesIndex,w.dataType="edge";var T=y.getModel(),E=T.getModel("lineStyle"),M=E.get("curveness"),L=y.node1.getLayout(),F=y.node1.getModel(),O=F.get("localX"),U=F.get("localY"),W=y.node2.getLayout(),H=y.node2.getModel(),j=H.get("localX"),Y=H.get("localY"),tt=y.getLayout(),it,lt,ht,Tt,Ot,Rt,Ut,Jt;x.shape.extent=Math.max(1,tt.dy),x.shape.orient=v,v==="vertical"?(it=(O!=null?O*u:L.x)+tt.sy,lt=(U!=null?U*c:L.y)+L.dy,ht=(j!=null?j*u:W.x)+tt.ty,Tt=Y!=null?Y*c:W.y,Ot=it,Rt=lt*(1-M)+Tt*M,Ut=ht,Jt=lt*M+Tt*(1-M)):(it=(O!=null?O*u:L.x)+L.dx,lt=(U!=null?U*c:L.y)+tt.sy,ht=j!=null?j*u:W.x,Tt=(Y!=null?Y*c:W.y)+tt.ty,Ot=it*(1-M)+ht*M,Rt=lt,Ut=it*M+ht*(1-M),Jt=Tt),x.setShape({x1:it,y1:lt,x2:ht,y2:Tt,cpx1:Ot,cpy1:Rt,cpx2:Ut,cpy2:Jt}),x.useStyle(E.getItemStyle()),vV(x.style,v,y);var ne=""+T.get("value"),se=Dn(T,"edgeLabel");ra(x,se,{labelFetcher:{getFormattedLabel:function(Qe,sr,ke,Ce,Ee,Ie){return e.getFormattedLabel(Qe,sr,"edge",Ce,_l(Ee,se.normal&&se.normal.get("formatter"),ne),Ie)}},labelDataIndex:y.dataIndex,defaultText:ne}),x.setTextConfig({position:"inside"});var ce=T.getModel("emphasis");ea(x,T,"lineStyle",function(Qe){var sr=Qe.getItemStyle();return vV(sr,v,y),sr}),o.add(x),p.setItemGraphicEl(y.dataIndex,x);var ye=ce.get("focus");Ui(x,ye==="adjacency"?y.getAdjacentDataIndices():ye==="trajectory"?y.getTrajectoryDataIndices():ye,ce.get("blurScope"),ce.get("disabled"))}),s.eachNode(function(y){var x=y.getLayout(),w=y.getModel(),T=w.get("localX"),E=w.get("localY"),M=w.getModel("emphasis"),L=w.get(["itemStyle","borderRadius"])||0,F=new Pr({shape:{x:T!=null?T*u:x.x,y:E!=null?E*c:x.y,width:x.dx,height:x.dy,r:L},style:w.getModel("itemStyle").getItemStyle(),z2:10});ra(F,Dn(w),{labelFetcher:{getFormattedLabel:function(U,W){return e.getFormattedLabel(U,W,"node")}},labelDataIndex:y.dataIndex,defaultText:y.id}),F.disableLabelAnimation=!0,F.setStyle("fill",y.getVisual("color")),F.setStyle("decal",y.getVisual("style").decal),ea(F,w),o.add(F),h.setItemGraphicEl(y.dataIndex,F),Je(F).dataType="node";var O=M.get("focus");Ui(F,O==="adjacency"?y.getAdjacentDataIndices():O==="trajectory"?y.getTrajectoryDataIndices():O,M.get("blurScope"),M.get("disabled"))}),h.eachItemGraphicEl(function(y,x){var w=h.getItemModel(x);w.get("draggable")&&(y.drift=function(T,E){a._focusAdjacencyDisabled=!0,this.shape.x+=T,this.shape.y+=E,this.dirty(),n.dispatchAction({type:"dragNode",seriesId:e.id,dataIndex:h.getRawIndex(x),localX:this.shape.x/u,localY:this.shape.y/c})},y.ondragend=function(){a._focusAdjacencyDisabled=!1},y.draggable=!0,y.cursor="move")}),!this._data&&e.isAnimationEnabled()&&o.setClipPath(fMt(o.getBoundingRect(),e,function(){o.removeClipPath()})),this._data=e.getData()},t.prototype.dispose=function(){},t.type="sankey",t}(di);function vV(r,t,e){switch(r.fill){case"source":r.fill=e.node1.getVisual("color"),r.decal=e.node1.getVisual("style").decal;break;case"target":r.fill=e.node2.getVisual("color"),r.decal=e.node2.getVisual("style").decal;break;case"gradient":var i=e.node1.getVisual("color"),n=e.node2.getVisual("color");ve(i)&&ve(n)&&(r.fill=new M_(0,0,+(t==="horizontal"),+(t==="vertical"),[{color:i,offset:0},{color:n,offset:1}]))}}function fMt(r,t,e){var i=new Pr({shape:{x:r.x-10,y:r.y-10,width:0,height:r.height+20}});return Ei(i,{shape:{width:r.width+20}},t,e),i}const dMt=hMt;var pMt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(e,i){var n=e.edges||e.links,a=e.data||e.nodes,s=e.levels;this.levelModels=[];for(var o=this.levelModels,l=0;l<s.length;l++)s[l].depth!=null&&s[l].depth>=0&&(o[s[l].depth]=new fi(s[l],this,i));if(a&&n){var u=vX(a,n,this,!0,c);return u.data}function c(h,p){h.wrapMethod("getItemModel",function(v,y){var x=v.parentModel,w=x.getData().getItemLayout(y);if(w){var T=w.depth,E=x.levelModels[T];E&&(v.parentModel=E)}return v}),p.wrapMethod("getItemModel",function(v,y){var x=v.parentModel,w=x.getGraph().getEdgeByIndex(y),T=w.node1.getLayout();if(T){var E=T.depth,M=x.levelModels[E];M&&(v.parentModel=M)}return v})}},t.prototype.setNodePosition=function(e,i){var n=this.option.data||this.option.nodes,a=n[e];a.localX=i[0],a.localY=i[1]},t.prototype.getGraph=function(){return this.getData().graph},t.prototype.getEdgeData=function(){return this.getGraph().edgeData},t.prototype.formatTooltip=function(e,i,n){function a(v){return isNaN(v)||v==null}if(n==="edge"){var s=this.getDataParams(e,n),o=s.data,l=s.value,u=o.source+" -- "+o.target;return Ln("nameValue",{name:u,value:l,noValue:a(l)})}else{var c=this.getGraph().getNodeByIndex(e),h=c.getLayout().value,p=this.getDataParams(e,n).data.name;return Ln("nameValue",{name:p!=null?p+"":null,value:h,noValue:a(h)})}},t.prototype.optionUpdated=function(){},t.prototype.getDataParams=function(e,i){var n=r.prototype.getDataParams.call(this,e,i);if(n.value==null&&i==="node"){var a=this.getGraph().getNodeByIndex(e),s=a.getLayout().value;n.value=s}return n},t.type="series.sankey",t.defaultOption={z:2,coordinateSystem:"view",left:"5%",top:"5%",right:"20%",bottom:"5%",orient:"horizontal",nodeWidth:20,nodeGap:8,draggable:!0,layoutIterations:32,label:{show:!0,position:"right",fontSize:12},edgeLabel:{show:!1,fontSize:12},levels:[],nodeAlign:"justify",lineStyle:{color:"#314656",opacity:.2,curveness:.5},emphasis:{label:{show:!0},lineStyle:{opacity:.5}},select:{itemStyle:{borderColor:"#212121"}},animationEasing:"linear",animationDuration:1e3},t}(Li);const gMt=pMt;function vMt(r,t){r.eachSeriesByType("sankey",function(e){var i=e.get("nodeWidth"),n=e.get("nodeGap"),a=mMt(e,t);e.layoutInfo=a;var s=a.width,o=a.height,l=e.getGraph(),u=l.nodes,c=l.edges;_Mt(u);var h=ti(u,function(x){return x.getLayout().value===0}),p=h.length!==0?0:e.get("layoutIterations"),v=e.get("orient"),y=e.get("nodeAlign");yMt(u,c,i,n,s,o,p,v,y)})}function mMt(r,t){return bn(r.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function yMt(r,t,e,i,n,a,s,o,l){xMt(r,t,e,n,a,o,l),TMt(r,t,a,n,i,s,o),LMt(r,o)}function _Mt(r){J(r,function(t){var e=Oc(t.outEdges,Tw),i=Oc(t.inEdges,Tw),n=t.getValue()||0,a=Math.max(e,i,n);t.setLayout({value:a},!0)})}function xMt(r,t,e,i,n,a,s){for(var o=[],l=[],u=[],c=[],h=0,p=0;p<t.length;p++)o[p]=1;for(var p=0;p<r.length;p++)l[p]=r[p].inEdges.length,l[p]===0&&u.push(r[p]);for(var v=-1;u.length;){for(var y=0;y<u.length;y++){var x=u[y],w=x.hostGraph.data.getRawDataItem(x.dataIndex),T=w.depth!=null&&w.depth>=0;T&&w.depth>v&&(v=w.depth),x.setLayout({depth:T?w.depth:h},!0),a==="vertical"?x.setLayout({dy:e},!0):x.setLayout({dx:e},!0);for(var E=0;E<x.outEdges.length;E++){var M=x.outEdges[E],L=t.indexOf(M);o[L]=0;var F=M.node2,O=r.indexOf(F);--l[O]===0&&c.indexOf(F)<0&&c.push(F)}}++h,u=c,c=[]}for(var p=0;p<o.length;p++)if(o[p]===1)throw new Error("Sankey is a DAG, the original data has cycle!");var U=v>h-1?v:h-1;s&&s!=="left"&&bMt(r,s,a,U);var W=a==="vertical"?(n-e)/U:(i-e)/U;SMt(r,W,a)}function NX(r){var t=r.hostGraph.data.getRawDataItem(r.dataIndex);return t.depth!=null&&t.depth>=0}function bMt(r,t,e,i){if(t==="right"){for(var n=[],a=r,s=0;a.length;){for(var o=0;o<a.length;o++){var l=a[o];l.setLayout({skNodeHeight:s},!0);for(var u=0;u<l.inEdges.length;u++){var c=l.inEdges[u];n.indexOf(c.node1)<0&&n.push(c.node1)}}a=n,n=[],++s}J(r,function(h){NX(h)||h.setLayout({depth:Math.max(0,i-h.getLayout().skNodeHeight)},!0)})}else t==="justify"&&wMt(r,i)}function wMt(r,t){J(r,function(e){!NX(e)&&!e.outEdges.length&&e.setLayout({depth:t},!0)})}function SMt(r,t,e){J(r,function(i){var n=i.getLayout().depth*t;e==="vertical"?i.setLayout({y:n},!0):i.setLayout({x:n},!0)})}function TMt(r,t,e,i,n,a,s){var o=AMt(r,s);CMt(o,t,e,i,n,s),WC(o,n,e,i,s);for(var l=1;a>0;a--)l*=.99,EMt(o,l,s),WC(o,n,e,i,s),DMt(o,l,s),WC(o,n,e,i,s)}function AMt(r,t){var e=[],i=t==="vertical"?"y":"x",n=QI(r,function(a){return a.getLayout()[i]});return n.keys.sort(function(a,s){return a-s}),J(n.keys,function(a){e.push(n.buckets.get(a))}),e}function CMt(r,t,e,i,n,a){var s=1/0;J(r,function(o){var l=o.length,u=0;J(o,function(h){u+=h.getLayout().value});var c=a==="vertical"?(i-(l-1)*n)/u:(e-(l-1)*n)/u;c<s&&(s=c)}),J(r,function(o){J(o,function(l,u){var c=l.getLayout().value*s;a==="vertical"?(l.setLayout({x:u},!0),l.setLayout({dx:c},!0)):(l.setLayout({y:u},!0),l.setLayout({dy:c},!0))})}),J(t,function(o){var l=+o.getValue()*s;o.setLayout({dy:l},!0)})}function WC(r,t,e,i,n){var a=n==="vertical"?"x":"y";J(r,function(s){s.sort(function(x,w){return x.getLayout()[a]-w.getLayout()[a]});for(var o,l,u,c=0,h=s.length,p=n==="vertical"?"dx":"dy",v=0;v<h;v++)l=s[v],u=c-l.getLayout()[a],u>0&&(o=l.getLayout()[a]+u,n==="vertical"?l.setLayout({x:o},!0):l.setLayout({y:o},!0)),c=l.getLayout()[a]+l.getLayout()[p]+t;var y=n==="vertical"?i:e;if(u=c-t-y,u>0){o=l.getLayout()[a]-u,n==="vertical"?l.setLayout({x:o},!0):l.setLayout({y:o},!0),c=o;for(var v=h-2;v>=0;--v)l=s[v],u=l.getLayout()[a]+l.getLayout()[p]+t-c,u>0&&(o=l.getLayout()[a]-u,n==="vertical"?l.setLayout({x:o},!0):l.setLayout({y:o},!0)),c=l.getLayout()[a]}})}function EMt(r,t,e){J(r.slice().reverse(),function(i){J(i,function(n){if(n.outEdges.length){var a=Oc(n.outEdges,IMt,e)/Oc(n.outEdges,Tw);if(isNaN(a)){var s=n.outEdges.length;a=s?Oc(n.outEdges,MMt,e)/s:0}if(e==="vertical"){var o=n.getLayout().x+(a-jc(n,e))*t;n.setLayout({x:o},!0)}else{var l=n.getLayout().y+(a-jc(n,e))*t;n.setLayout({y:l},!0)}}})})}function IMt(r,t){return jc(r.node2,t)*r.getValue()}function MMt(r,t){return jc(r.node2,t)}function PMt(r,t){return jc(r.node1,t)*r.getValue()}function RMt(r,t){return jc(r.node1,t)}function jc(r,t){return t==="vertical"?r.getLayout().x+r.getLayout().dx/2:r.getLayout().y+r.getLayout().dy/2}function Tw(r){return r.getValue()}function Oc(r,t,e){for(var i=0,n=r.length,a=-1;++a<n;){var s=+t(r[a],e);isNaN(s)||(i+=s)}return i}function DMt(r,t,e){J(r,function(i){J(i,function(n){if(n.inEdges.length){var a=Oc(n.inEdges,PMt,e)/Oc(n.inEdges,Tw);if(isNaN(a)){var s=n.inEdges.length;a=s?Oc(n.inEdges,RMt,e)/s:0}if(e==="vertical"){var o=n.getLayout().x+(a-jc(n,e))*t;n.setLayout({x:o},!0)}else{var l=n.getLayout().y+(a-jc(n,e))*t;n.setLayout({y:l},!0)}}})})}function LMt(r,t){var e=t==="vertical"?"x":"y";J(r,function(i){i.outEdges.sort(function(n,a){return n.node2.getLayout()[e]-a.node2.getLayout()[e]}),i.inEdges.sort(function(n,a){return n.node1.getLayout()[e]-a.node1.getLayout()[e]})}),J(r,function(i){var n=0,a=0;J(i.outEdges,function(s){s.setLayout({sy:n},!0),n+=s.getLayout().dy}),J(i.inEdges,function(s){s.setLayout({ty:a},!0),a+=s.getLayout().dy})})}function kMt(r){r.eachSeriesByType("sankey",function(t){var e=t.getGraph(),i=e.nodes,n=e.edges;if(i.length){var a=1/0,s=-1/0;J(i,function(o){var l=o.getLayout().value;l<a&&(a=l),l>s&&(s=l)}),J(i,function(o){var l=new ta({type:"color",mappingMethod:"linear",dataExtent:[a,s],visual:t.get("color")}),u=l.mapValueToVisual(o.getLayout().value),c=o.getModel().get(["itemStyle","color"]);c!=null?(o.setVisual("color",c),o.setVisual("style",{fill:c})):(o.setVisual("color",u),o.setVisual("style",{fill:u}))})}n.length&&J(n,function(o){var l=o.getModel().get("lineStyle");o.setVisual("style",l)})})}function OMt(r){r.registerChartView(dMt),r.registerSeriesModel(gMt),r.registerLayout(vMt),r.registerVisual(kMt),r.registerAction({type:"dragNode",event:"dragnode",update:"update"},function(t,e){e.eachComponent({mainType:"series",subType:"sankey",query:t},function(i){i.setNodePosition(t.dataIndex,[t.localX,t.localY])})})}var FX=function(){function r(){}return r.prototype.getInitialData=function(t,e){var i,n=e.getComponent("xAxis",this.get("xAxisIndex")),a=e.getComponent("yAxis",this.get("yAxisIndex")),s=n.get("type"),o=a.get("type"),l;s==="category"?(t.layout="horizontal",i=n.getOrdinalMeta(),l=!0):o==="category"?(t.layout="vertical",i=a.getOrdinalMeta(),l=!0):t.layout=t.layout||"horizontal";var u=["x","y"],c=t.layout==="horizontal"?0:1,h=this._baseAxisDim=u[c],p=u[1-c],v=[n,a],y=v[c].get("type"),x=v[1-c].get("type"),w=t.data;if(w&&l){var T=[];J(w,function(L,F){var O;Kt(L)?(O=L.slice(),L.unshift(F)):Kt(L.value)?(O=Zt({},L),O.value=O.value.slice(),L.value.unshift(F)):O=L,T.push(O)}),t.data=T}var E=this.defaultValueDimensions,M=[{name:h,type:fw(y),ordinalMeta:i,otherDims:{tooltip:!1,itemName:0},dimsDef:["base"]},{name:p,type:fw(x),dimsDef:E.slice()}];return Hg(this,{coordDimensions:M,dimensionsCount:E.length+1,encodeDefaulter:nr(a9,M,this)})},r.prototype.getBaseAxis=function(){var t=this._baseAxisDim;return this.ecModel.getComponent(t+"Axis",this.get(t+"AxisIndex")).axis},r}(),BX=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.defaultValueDimensions=[{name:"min",defaultTooltip:!0},{name:"Q1",defaultTooltip:!0},{name:"median",defaultTooltip:!0},{name:"Q3",defaultTooltip:!0},{name:"max",defaultTooltip:!0}],e.visualDrawType="stroke",e}return t.type="series.boxplot",t.dependencies=["xAxis","yAxis","grid"],t.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,boxWidth:[7,50],itemStyle:{color:"#fff",borderWidth:1},emphasis:{scale:!0,itemStyle:{borderWidth:2,shadowBlur:5,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0,0,0,0.2)"}},animationDuration:800},t}(Li);yn(BX,FX,!0);const NMt=BX;var FMt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){var a=e.getData(),s=this.group,o=this._data;this._data||s.removeAll();var l=e.get("layout")==="horizontal"?1:0;a.diff(o).add(function(u){if(a.hasValue(u)){var c=a.getItemLayout(u),h=mV(c,a,u,l,!0);a.setItemGraphicEl(u,h),s.add(h)}}).update(function(u,c){var h=o.getItemGraphicEl(c);if(!a.hasValue(u)){s.remove(h);return}var p=a.getItemLayout(u);h?(Vo(h),zX(p,h,a,u)):h=mV(p,a,u,l),s.add(h),a.setItemGraphicEl(u,h)}).remove(function(u){var c=o.getItemGraphicEl(u);c&&s.remove(c)}).execute(),this._data=a},t.prototype.remove=function(e){var i=this.group,n=this._data;this._data=null,n&&n.eachItemGraphicEl(function(a){a&&i.remove(a)})},t.type="boxplot",t}(di),BMt=function(){function r(){}return r}(),zMt=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i.type="boxplotBoxPath",i}return t.prototype.getDefaultShape=function(){return new BMt},t.prototype.buildPath=function(e,i){var n=i.points,a=0;for(e.moveTo(n[a][0],n[a][1]),a++;a<4;a++)e.lineTo(n[a][0],n[a][1]);for(e.closePath();a<n.length;a++)e.moveTo(n[a][0],n[a][1]),a++,e.lineTo(n[a][0],n[a][1])},t}(vr);function mV(r,t,e,i,n){var a=r.ends,s=new zMt({shape:{points:n?VMt(a,i,r):a}});return zX(r,s,t,e,n),s}function zX(r,t,e,i,n){var a=e.hostModel,s=ed[n?"initProps":"updateProps"];s(t,{shape:{points:r.ends}},a,i),t.useStyle(e.getItemVisual(i,"style")),t.style.strokeNoScale=!0,t.z2=100;var o=e.getItemModel(i),l=o.getModel("emphasis");ea(t,o),Ui(t,l.get("focus"),l.get("blurScope"),l.get("disabled"))}function VMt(r,t,e){return te(r,function(i){return i=i.slice(),i[t]=e.initBaseline,i})}const UMt=FMt;var my=J;function $Mt(r){var t=WMt(r);my(t,function(e){var i=e.seriesModels;i.length&&(HMt(e),my(i,function(n,a){GMt(n,e.boxOffsetList[a],e.boxWidthList[a])}))})}function WMt(r){var t=[],e=[];return r.eachSeriesByType("boxplot",function(i){var n=i.getBaseAxis(),a=pr(e,n);a<0&&(a=e.length,e[a]=n,t[a]={axis:n,seriesModels:[]}),t[a].seriesModels.push(i)}),t}function HMt(r){var t=r.axis,e=r.seriesModels,i=e.length,n=r.boxWidthList=[],a=r.boxOffsetList=[],s=[],o;if(t.type==="category")o=t.getBandWidth();else{var l=0;my(e,function(y){l=Math.max(l,y.getData().count())});var u=t.getExtent();o=Math.abs(u[1]-u[0])/l}my(e,function(y){var x=y.get("boxWidth");Kt(x)||(x=[x,x]),s.push([he(x[0],o)||0,he(x[1],o)||0])});var c=o*.8-2,h=c/i*.3,p=(c-h*(i-1))/i,v=p/2-c/2;my(e,function(y,x){a.push(v),v+=h+p,n.push(Math.min(Math.max(p,s[x][0]),s[x][1]))})}function GMt(r,t,e){var i=r.coordinateSystem,n=r.getData(),a=e/2,s=r.get("layout")==="horizontal"?0:1,o=1-s,l=["x","y"],u=n.mapDimension(l[s]),c=n.mapDimensionsAll(l[o]);if(u==null||c.length<5)return;for(var h=0;h<n.count();h++){var p=n.get(u,h),v=M(p,c[2],h),y=M(p,c[0],h),x=M(p,c[1],h),w=M(p,c[3],h),T=M(p,c[4],h),E=[];L(E,x,!1),L(E,w,!0),E.push(y,x,T,w),F(E,y),F(E,T),F(E,v),n.setItemLayout(h,{initBaseline:v[o],ends:E})}function M(O,U,W){var H=n.get(U,W),j=[];j[s]=O,j[o]=H;var Y;return isNaN(O)||isNaN(H)?Y=[NaN,NaN]:(Y=i.dataToPoint(j),Y[s]+=t),Y}function L(O,U,W){var H=U.slice(),j=U.slice();H[s]+=a,j[s]-=a,W?O.push(H,j):O.push(j,H)}function F(O,U){var W=U.slice(),H=U.slice();W[s]-=a,H[s]+=a,O.push(W,H)}}function jMt(r,t){t=t||{};for(var e=[],i=[],n=t.boundIQR,a=n==="none"||n===0,s=0;s<r.length;s++){var o=ro(r[s].slice()),l=y2(o,.25),u=y2(o,.5),c=y2(o,.75),h=o[0],p=o[o.length-1],v=(n??1.5)*(c-l),y=a?h:Math.max(h,l-v),x=a?p:Math.min(p,c+v),w=t.itemNameFormatter,T=Ve(w)?w({value:s}):ve(w)?w.replace("{value}",s+""):s+"";e.push([T,y,l,u,c,x]);for(var E=0;E<o.length;E++){var M=o[E];if(M<y||M>x){var L=[T,M];i.push(L)}}}return{boxData:e,outliers:i}}var XMt={type:"echarts:boxplot",transform:function(t){var e=t.upstream;if(e.sourceFormat!==Ta){var i="";jr(i)}var n=jMt(e.getRawData(),t.config);return[{dimensions:["ItemName","Low","Q1","Q2","Q3","High"],data:n.boxData},{data:n.outliers}]}};function ZMt(r){r.registerSeriesModel(NMt),r.registerChartView(UMt),r.registerLayout($Mt),r.registerTransform(XMt)}var qMt=["color","borderColor"],YMt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){this.group.removeClipPath(),this._progressiveEls=null,this._updateDrawMode(e),this._isLargeDraw?this._renderLarge(e):this._renderNormal(e)},t.prototype.incrementalPrepareRender=function(e,i,n){this._clear(),this._updateDrawMode(e)},t.prototype.incrementalRender=function(e,i,n,a){this._progressiveEls=[],this._isLargeDraw?this._incrementalRenderLarge(e,i):this._incrementalRenderNormal(e,i)},t.prototype.eachRendered=function(e){Kc(this._progressiveEls||this.group,e)},t.prototype._updateDrawMode=function(e){var i=e.pipelineContext.large;(this._isLargeDraw==null||i!==this._isLargeDraw)&&(this._isLargeDraw=i,this._clear())},t.prototype._renderNormal=function(e){var i=e.getData(),n=this._data,a=this.group,s=i.getLayout("isSimpleBox"),o=e.get("clip",!0),l=e.coordinateSystem,u=l.getArea&&l.getArea();this._data||a.removeAll(),i.diff(n).add(function(c){if(i.hasValue(c)){var h=i.getItemLayout(c);if(o&&yV(u,h))return;var p=HC(h,c,!0);Ei(p,{shape:{points:h.ends}},e,c),GC(p,i,c,s),a.add(p),i.setItemGraphicEl(c,p)}}).update(function(c,h){var p=n.getItemGraphicEl(h);if(!i.hasValue(c)){a.remove(p);return}var v=i.getItemLayout(c);if(o&&yV(u,v)){a.remove(p);return}p?(zr(p,{shape:{points:v.ends}},e,c),Vo(p)):p=HC(v),GC(p,i,c,s),a.add(p),i.setItemGraphicEl(c,p)}).remove(function(c){var h=n.getItemGraphicEl(c);h&&a.remove(h)}).execute(),this._data=i},t.prototype._renderLarge=function(e){this._clear(),_V(e,this.group);var i=e.get("clip",!0)?B_(e.coordinateSystem,!1,e):null;i?this.group.setClipPath(i):this.group.removeClipPath()},t.prototype._incrementalRenderNormal=function(e,i){for(var n=i.getData(),a=n.getLayout("isSimpleBox"),s;(s=e.next())!=null;){var o=n.getItemLayout(s),l=HC(o);GC(l,n,s,a),l.incremental=!0,this.group.add(l),this._progressiveEls.push(l)}},t.prototype._incrementalRenderLarge=function(e,i){_V(i,this.group,this._progressiveEls,!0)},t.prototype.remove=function(e){this._clear()},t.prototype._clear=function(){this.group.removeAll(),this._data=null},t.type="candlestick",t}(di),KMt=function(){function r(){}return r}(),JMt=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i.type="normalCandlestickBox",i}return t.prototype.getDefaultShape=function(){return new KMt},t.prototype.buildPath=function(e,i){var n=i.points;this.__simpleBox?(e.moveTo(n[4][0],n[4][1]),e.lineTo(n[6][0],n[6][1])):(e.moveTo(n[0][0],n[0][1]),e.lineTo(n[1][0],n[1][1]),e.lineTo(n[2][0],n[2][1]),e.lineTo(n[3][0],n[3][1]),e.closePath(),e.moveTo(n[4][0],n[4][1]),e.lineTo(n[5][0],n[5][1]),e.moveTo(n[6][0],n[6][1]),e.lineTo(n[7][0],n[7][1]))},t}(vr);function HC(r,t,e){var i=r.ends;return new JMt({shape:{points:e?QMt(i,r):i},z2:100})}function yV(r,t){for(var e=!0,i=0;i<t.ends.length;i++)if(r.contain(t.ends[i][0],t.ends[i][1])){e=!1;break}return e}function GC(r,t,e,i){var n=t.getItemModel(e);r.useStyle(t.getItemVisual(e,"style")),r.style.strokeNoScale=!0,r.__simpleBox=i,ea(r,n)}function QMt(r,t){return te(r,function(e){return e=e.slice(),e[1]=t.initBaseline,e})}var tPt=function(){function r(){}return r}(),jC=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i.type="largeCandlestickBox",i}return t.prototype.getDefaultShape=function(){return new tPt},t.prototype.buildPath=function(e,i){for(var n=i.points,a=0;a<n.length;)if(this.__sign===n[a++]){var s=n[a++];e.moveTo(s,n[a++]),e.lineTo(s,n[a++])}else a+=3},t}(vr);function _V(r,t,e,i){var n=r.getData(),a=n.getLayout("largePoints"),s=new jC({shape:{points:a},__sign:1,ignoreCoarsePointer:!0});t.add(s);var o=new jC({shape:{points:a},__sign:-1,ignoreCoarsePointer:!0});t.add(o);var l=new jC({shape:{points:a},__sign:0,ignoreCoarsePointer:!0});t.add(l),XC(1,s,r),XC(-1,o,r),XC(0,l,r),i&&(s.incremental=!0,o.incremental=!0),e&&e.push(s,o)}function XC(r,t,e,i){var n=e.get(["itemStyle",r>0?"borderColor":"borderColor0"])||e.get(["itemStyle",r>0?"color":"color0"]);r===0&&(n=e.get(["itemStyle","borderColorDoji"]));var a=e.getModel("itemStyle").getItemStyle(qMt);t.useStyle(a),t.style.fill=null,t.style.stroke=n}const ePt=YMt;var VX=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.defaultValueDimensions=[{name:"open",defaultTooltip:!0},{name:"close",defaultTooltip:!0},{name:"lowest",defaultTooltip:!0},{name:"highest",defaultTooltip:!0}],e}return t.prototype.getShadowDim=function(){return"open"},t.prototype.brushSelector=function(e,i,n){var a=i.getItemLayout(e);return a&&n.rect(a.brushRect)},t.type="series.candlestick",t.dependencies=["xAxis","yAxis","grid"],t.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,clip:!0,itemStyle:{color:"#eb5454",color0:"#47b262",borderColor:"#eb5454",borderColor0:"#47b262",borderColorDoji:null,borderWidth:1},emphasis:{scale:!0,itemStyle:{borderWidth:2}},barMaxWidth:null,barMinWidth:null,barWidth:null,large:!0,largeThreshold:600,progressive:3e3,progressiveThreshold:1e4,progressiveChunkMode:"mod",animationEasing:"linear",animationDuration:300},t}(Li);yn(VX,FX,!0);const rPt=VX;function iPt(r){!r||!Kt(r.series)||J(r.series,function(t){je(t)&&t.type==="k"&&(t.type="candlestick")})}var nPt=["itemStyle","borderColor"],aPt=["itemStyle","borderColor0"],sPt=["itemStyle","borderColorDoji"],oPt=["itemStyle","color"],lPt=["itemStyle","color0"],uPt={seriesType:"candlestick",plan:Vg(),performRawSeries:!0,reset:function(r,t){function e(a,s){return s.get(a>0?oPt:lPt)}function i(a,s){return s.get(a===0?sPt:a>0?nPt:aPt)}if(!t.isSeriesFiltered(r)){var n=r.pipelineContext.large;return!n&&{progress:function(a,s){for(var o;(o=a.next())!=null;){var l=s.getItemModel(o),u=s.getItemLayout(o).sign,c=l.getItemStyle();c.fill=e(u,l),c.stroke=i(u,l)||c.fill;var h=s.ensureUniqueItemVisual(o,"style");Zt(h,c)}}}}}};const cPt=uPt;var hPt={seriesType:"candlestick",plan:Vg(),reset:function(r){var t=r.coordinateSystem,e=r.getData(),i=fPt(r,e),n=0,a=1,s=["x","y"],o=e.getDimensionIndex(e.mapDimension(s[n])),l=te(e.mapDimensionsAll(s[a]),e.getDimensionIndex,e),u=l[0],c=l[1],h=l[2],p=l[3];if(e.setLayout({candleWidth:i,isSimpleBox:i<=1.3}),o<0||l.length<4)return;return{progress:r.pipelineContext.large?y:v};function v(x,w){for(var T,E=w.getStore();(T=x.next())!=null;){var M=E.get(o,T),L=E.get(u,T),F=E.get(c,T),O=E.get(h,T),U=E.get(p,T),W=Math.min(L,F),H=Math.max(L,F),j=Ot(W,M),Y=Ot(H,M),tt=Ot(O,M),it=Ot(U,M),lt=[];Rt(lt,Y,0),Rt(lt,j,1),lt.push(Jt(it),Jt(Y),Jt(tt),Jt(j));var ht=w.getItemModel(T),Tt=!!ht.get(["itemStyle","borderColorDoji"]);w.setItemLayout(T,{sign:xV(E,T,L,F,c,Tt),initBaseline:L>F?Y[a]:j[a],ends:lt,brushRect:Ut(O,U,M)})}function Ot(ne,se){var ce=[];return ce[n]=se,ce[a]=ne,isNaN(se)||isNaN(ne)?[NaN,NaN]:t.dataToPoint(ce)}function Rt(ne,se,ce){var ye=se.slice(),Qe=se.slice();ye[n]=K1(ye[n]+i/2,1,!1),Qe[n]=K1(Qe[n]-i/2,1,!0),ce?ne.push(ye,Qe):ne.push(Qe,ye)}function Ut(ne,se,ce){var ye=Ot(ne,ce),Qe=Ot(se,ce);return ye[n]-=i/2,Qe[n]-=i/2,{x:ye[0],y:ye[1],width:i,height:Qe[1]-ye[1]}}function Jt(ne){return ne[n]=K1(ne[n],1),ne}}function y(x,w){for(var T=ml(x.count*4),E=0,M,L=[],F=[],O,U=w.getStore(),W=!!r.get(["itemStyle","borderColorDoji"]);(O=x.next())!=null;){var H=U.get(o,O),j=U.get(u,O),Y=U.get(c,O),tt=U.get(h,O),it=U.get(p,O);if(isNaN(H)||isNaN(tt)||isNaN(it)){T[E++]=NaN,E+=3;continue}T[E++]=xV(U,O,j,Y,c,W),L[n]=H,L[a]=tt,M=t.dataToPoint(L,null,F),T[E++]=M?M[0]:NaN,T[E++]=M?M[1]:NaN,L[a]=it,M=t.dataToPoint(L,null,F),T[E++]=M?M[1]:NaN}w.setLayout("largePoints",T)}}};function xV(r,t,e,i,n,a){var s;return e>i?s=-1:e<i?s=1:s=a?0:t>0?r.get(n,t-1)<=i?1:-1:1,s}function fPt(r,t){var e=r.getBaseAxis(),i,n=e.type==="category"?e.getBandWidth():(i=e.getExtent(),Math.abs(i[1]-i[0])/t.count()),a=he(ir(r.get("barMaxWidth"),n),n),s=he(ir(r.get("barMinWidth"),1),n),o=r.get("barWidth");return o!=null?he(o,n):Math.max(Math.min(n/2,a),s)}const dPt=hPt;function pPt(r){r.registerChartView(ePt),r.registerSeriesModel(rPt),r.registerPreprocessor(iPt),r.registerVisual(cPt),r.registerLayout(dPt)}function bV(r,t){var e=t.rippleEffectColor||t.color;r.eachChild(function(i){i.attr({z:t.z,zlevel:t.zlevel,style:{stroke:t.brushType==="stroke"?e:null,fill:t.brushType==="fill"?e:null}})})}var gPt=function(r){Vt(t,r);function t(e,i){var n=r.call(this)||this,a=new N_(e,i),s=new Ke;return n.add(a),n.add(s),n.updateData(e,i),n}return t.prototype.stopEffectAnimation=function(){this.childAt(1).removeAll()},t.prototype.startEffectAnimation=function(e){for(var i=e.symbolType,n=e.color,a=e.rippleNumber,s=this.childAt(1),o=0;o<a;o++){var l=mn(i,-1,-1,2,2,n);l.attr({style:{strokeNoScale:!0},z2:99,silent:!0,scaleX:.5,scaleY:.5});var u=-o/a*e.period+e.effectOffset;l.animate("",!0).when(e.period,{scaleX:e.rippleScale/2,scaleY:e.rippleScale/2}).delay(u).start(),l.animateStyle(!0).when(e.period,{opacity:0}).delay(u).start(),s.add(l)}bV(s,e)},t.prototype.updateEffectAnimation=function(e){for(var i=this._effectCfg,n=this.childAt(1),a=["symbolType","period","rippleScale","rippleNumber"],s=0;s<a.length;s++){var o=a[s];if(i[o]!==e[o]){this.stopEffectAnimation(),this.startEffectAnimation(e);return}}bV(n,e)},t.prototype.highlight=function(){vu(this)},t.prototype.downplay=function(){mu(this)},t.prototype.getSymbolType=function(){var e=this.childAt(0);return e&&e.getSymbolType()},t.prototype.updateData=function(e,i){var n=this,a=e.hostModel;this.childAt(0).updateData(e,i);var s=this.childAt(1),o=e.getItemModel(i),l=e.getItemVisual(i,"symbol"),u=$g(e.getItemVisual(i,"symbolSize")),c=e.getItemVisual(i,"style"),h=c&&c.fill,p=o.getModel("emphasis");s.setScale(u),s.traverse(function(w){w.setStyle("fill",h)});var v=id(e.getItemVisual(i,"symbolOffset"),u);v&&(s.x=v[0],s.y=v[1]);var y=e.getItemVisual(i,"symbolRotate");s.rotation=(y||0)*Math.PI/180||0;var x={};x.showEffectOn=a.get("showEffectOn"),x.rippleScale=o.get(["rippleEffect","scale"]),x.brushType=o.get(["rippleEffect","brushType"]),x.period=o.get(["rippleEffect","period"])*1e3,x.effectOffset=i/e.count(),x.z=a.getShallow("z")||0,x.zlevel=a.getShallow("zlevel")||0,x.symbolType=l,x.color=h,x.rippleEffectColor=o.get(["rippleEffect","color"]),x.rippleNumber=o.get(["rippleEffect","number"]),x.showEffectOn==="render"?(this._effectCfg?this.updateEffectAnimation(x):this.startEffectAnimation(x),this._effectCfg=x):(this._effectCfg=null,this.stopEffectAnimation(),this.onHoverStateChange=function(w){w==="emphasis"?x.showEffectOn!=="render"&&n.startEffectAnimation(x):w==="normal"&&x.showEffectOn!=="render"&&n.stopEffectAnimation()}),this._effectCfg=x,Ui(this,p.get("focus"),p.get("blurScope"),p.get("disabled"))},t.prototype.fadeOut=function(e){e&&e()},t}(Ke);const vPt=gPt;var mPt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){this._symbolDraw=new F_(vPt)},t.prototype.render=function(e,i,n){var a=e.getData(),s=this._symbolDraw;s.updateData(a,{clipShape:this._getClipShape(e)}),this.group.add(s.group)},t.prototype._getClipShape=function(e){var i=e.coordinateSystem,n=i&&i.getArea&&i.getArea();return e.get("clip",!0)?n:null},t.prototype.updateTransform=function(e,i,n){var a=e.getData();this.group.dirty();var s=z_("").reset(e,i,n);s.progress&&s.progress({start:0,end:a.count(),count:a.count()},a),this._symbolDraw.updateLayout()},t.prototype._updateGroupTransform=function(e){var i=e.coordinateSystem;i&&i.getRoamTransform&&(this.group.transform=Gvt(i.getRoamTransform()),this.group.decomposeTransform())},t.prototype.remove=function(e,i){this._symbolDraw&&this._symbolDraw.remove(!0)},t.type="effectScatter",t}(di);const yPt=mPt;var _Pt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.getInitialData=function(e,i){return Su(null,this,{useEncodeDefaulter:!0})},t.prototype.brushSelector=function(e,i,n){return n.point(i.getItemLayout(e))},t.type="series.effectScatter",t.dependencies=["grid","polar"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,effectType:"ripple",progressive:0,showEffectOn:"render",clip:!0,rippleEffect:{period:4,scale:2.5,brushType:"fill",number:3},universalTransition:{divideShape:"clone"},symbolSize:10},t}(Li);const xPt=_Pt;function bPt(r){r.registerChartView(yPt),r.registerSeriesModel(xPt),r.registerLayout(z_("effectScatter"))}var wPt=function(r){Vt(t,r);function t(e,i,n){var a=r.call(this)||this;return a.add(a.createLine(e,i,n)),a._updateEffectSymbol(e,i),a}return t.prototype.createLine=function(e,i,n){return new tL(e,i,n)},t.prototype._updateEffectSymbol=function(e,i){var n=e.getItemModel(i),a=n.getModel("effect"),s=a.get("symbolSize"),o=a.get("symbol");Kt(s)||(s=[s,s]);var l=e.getItemVisual(i,"style"),u=a.get("color")||l&&l.stroke,c=this.childAt(1);this._symbolType!==o&&(this.remove(c),c=mn(o,-.5,-.5,1,1,u),c.z2=100,c.culling=!0,this.add(c)),c&&(c.setStyle("shadowColor",u),c.setStyle(a.getItemStyle(["color"])),c.scaleX=s[0],c.scaleY=s[1],c.setColor(u),this._symbolType=o,this._symbolScale=s,this._updateEffectAnimation(e,a,i))},t.prototype._updateEffectAnimation=function(e,i,n){var a=this.childAt(1);if(a){var s=e.getItemLayout(n),o=i.get("period")*1e3,l=i.get("loop"),u=i.get("roundTrip"),c=i.get("constantSpeed"),h=Un(i.get("delay"),function(v){return v/e.count()*o/3});if(a.ignore=!0,this._updateAnimationPoints(a,s),c>0&&(o=this._getLineLength(a)/c*1e3),o!==this._period||l!==this._loop||u!==this._roundTrip){a.stopAnimation();var p=void 0;Ve(h)?p=h(n):p=h,a.__t>0&&(p=-o*a.__t),this._animateSymbol(a,o,p,l,u)}this._period=o,this._loop=l,this._roundTrip=u}},t.prototype._animateSymbol=function(e,i,n,a,s){if(i>0){e.__t=0;var o=this,l=e.animate("",a).when(s?i*2:i,{__t:s?2:1}).delay(n).during(function(){o._updateSymbolPosition(e)});a||l.done(function(){o.remove(e)}),l.start()}},t.prototype._getLineLength=function(e){return xc(e.__p1,e.__cp1)+xc(e.__cp1,e.__p2)},t.prototype._updateAnimationPoints=function(e,i){e.__p1=i[0],e.__p2=i[1],e.__cp1=i[2]||[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2]},t.prototype.updateData=function(e,i,n){this.childAt(0).updateData(e,i,n),this._updateEffectSymbol(e,i)},t.prototype._updateSymbolPosition=function(e){var i=e.__p1,n=e.__p2,a=e.__cp1,s=e.__t<1?e.__t:2-e.__t,o=[e.x,e.y],l=o.slice(),u=Vn,c=BI;o[0]=u(i[0],a[0],n[0],s),o[1]=u(i[1],a[1],n[1],s);var h=e.__t<1?c(i[0],a[0],n[0],s):c(n[0],a[0],i[0],1-s),p=e.__t<1?c(i[1],a[1],n[1],s):c(n[1],a[1],i[1],1-s);e.rotation=-Math.atan2(p,h)-Math.PI/2,(this._symbolType==="line"||this._symbolType==="rect"||this._symbolType==="roundRect")&&(e.__lastT!==void 0&&e.__lastT<e.__t?(e.scaleY=xc(l,o)*1.05,s===1&&(o[0]=l[0]+(o[0]-l[0])/2,o[1]=l[1]+(o[1]-l[1])/2)):e.__lastT===1?e.scaleY=2*xc(i,o):e.scaleY=this._symbolScale[1]),e.__lastT=e.__t,e.ignore=!1,e.x=o[0],e.y=o[1]},t.prototype.updateLayout=function(e,i){this.childAt(0).updateLayout(e,i);var n=e.getItemModel(i).getModel("effect");this._updateEffectAnimation(e,n,i)},t}(Ke);const UX=wPt;var SPt=function(r){Vt(t,r);function t(e,i,n){var a=r.call(this)||this;return a._createPolyline(e,i,n),a}return t.prototype._createPolyline=function(e,i,n){var a=e.getItemLayout(i),s=new ps({shape:{points:a}});this.add(s),this._updateCommonStl(e,i,n)},t.prototype.updateData=function(e,i,n){var a=e.hostModel,s=this.childAt(0),o={shape:{points:e.getItemLayout(i)}};zr(s,o,a,i),this._updateCommonStl(e,i,n)},t.prototype._updateCommonStl=function(e,i,n){var a=this.childAt(0),s=e.getItemModel(i),o=n&&n.emphasisLineStyle,l=n&&n.focus,u=n&&n.blurScope,c=n&&n.emphasisDisabled;if(!n||e.hasItemOption){var h=s.getModel("emphasis");o=h.getModel("lineStyle").getLineStyle(),c=h.get("disabled"),l=h.get("focus"),u=h.get("blurScope")}a.useStyle(e.getItemVisual(i,"style")),a.style.fill=null,a.style.strokeNoScale=!0;var p=a.ensureState("emphasis");p.style=o,Ui(this,l,u,c)},t.prototype.updateLayout=function(e,i){var n=this.childAt(0);n.setShape("points",e.getItemLayout(i))},t}(Ke);const $X=SPt;var TPt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e._lastFrame=0,e._lastFramePercent=0,e}return t.prototype.createLine=function(e,i,n){return new $X(e,i,n)},t.prototype._updateAnimationPoints=function(e,i){this._points=i;for(var n=[0],a=0,s=1;s<i.length;s++){var o=i[s-1],l=i[s];a+=xc(o,l),n.push(a)}if(a===0){this._length=0;return}for(var s=0;s<n.length;s++)n[s]/=a;this._offsets=n,this._length=a},t.prototype._getLineLength=function(){return this._length},t.prototype._updateSymbolPosition=function(e){var i=e.__t<1?e.__t:2-e.__t,n=this._points,a=this._offsets,s=n.length;if(a){var o=this._lastFrame,l;if(i<this._lastFramePercent){var u=Math.min(o+1,s-1);for(l=u;l>=0&&!(a[l]<=i);l--);l=Math.min(l,s-2)}else{for(l=o;l<s&&!(a[l]>i);l++);l=Math.min(l-1,s-2)}var c=(i-a[l])/(a[l+1]-a[l]),h=n[l],p=n[l+1];e.x=h[0]*(1-c)+c*p[0],e.y=h[1]*(1-c)+c*p[1];var v=e.__t<1?p[0]-h[0]:h[0]-p[0],y=e.__t<1?p[1]-h[1]:h[1]-p[1];e.rotation=-Math.atan2(y,v)-Math.PI/2,this._lastFrame=l,this._lastFramePercent=i,e.ignore=!1}},t}(UX);const APt=TPt;var CPt=function(){function r(){this.polyline=!1,this.curveness=0,this.segs=[]}return r}(),EPt=function(r){Vt(t,r);function t(e){var i=r.call(this,e)||this;return i._off=0,i.hoverDataIdx=-1,i}return t.prototype.reset=function(){this.notClear=!1,this._off=0},t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new CPt},t.prototype.buildPath=function(e,i){var n=i.segs,a=i.curveness,s;if(i.polyline)for(s=this._off;s<n.length;){var o=n[s++];if(o>0){e.moveTo(n[s++],n[s++]);for(var l=1;l<o;l++)e.lineTo(n[s++],n[s++])}}else for(s=this._off;s<n.length;){var u=n[s++],c=n[s++],h=n[s++],p=n[s++];if(e.moveTo(u,c),a>0){var v=(u+h)/2-(c-p)*a,y=(c+p)/2-(h-u)*a;e.quadraticCurveTo(v,y,h,p)}else e.lineTo(h,p)}this.incremental&&(this._off=s,this.notClear=!0)},t.prototype.findDataIndex=function(e,i){var n=this.shape,a=n.segs,s=n.curveness,o=this.style.lineWidth;if(n.polyline)for(var l=0,u=0;u<a.length;){var c=a[u++];if(c>0)for(var h=a[u++],p=a[u++],v=1;v<c;v++){var y=a[u++],x=a[u++];if(uc(h,p,y,x,o,e,i))return l}l++}else for(var l=0,u=0;u<a.length;){var h=a[u++],p=a[u++],y=a[u++],x=a[u++];if(s>0){var w=(h+y)/2-(p-x)*s,T=(p+x)/2-(y-h)*s;if(jH(h,p,w,T,y,x,o,e,i))return l}else if(uc(h,p,y,x,o,e,i))return l;l++}return-1},t.prototype.contain=function(e,i){var n=this.transformCoordToLocal(e,i),a=this.getBoundingRect();if(e=n[0],i=n[1],a.contain(e,i)){var s=this.hoverDataIdx=this.findDataIndex(e,i);return s>=0}return this.hoverDataIdx=-1,!1},t.prototype.getBoundingRect=function(){var e=this._rect;if(!e){for(var i=this.shape,n=i.segs,a=1/0,s=1/0,o=-1/0,l=-1/0,u=0;u<n.length;){var c=n[u++],h=n[u++];a=Math.min(c,a),o=Math.max(c,o),s=Math.min(h,s),l=Math.max(h,l)}e=this._rect=new hr(a,s,o,l)}return e},t}(vr),IPt=function(){function r(){this.group=new Ke}return r.prototype.updateData=function(t){this._clear();var e=this._create();e.setShape({segs:t.getLayout("linesPoints")}),this._setCommon(e,t)},r.prototype.incrementalPrepareUpdate=function(t){this.group.removeAll(),this._clear()},r.prototype.incrementalUpdate=function(t,e){var i=this._newAdded[0],n=e.getLayout("linesPoints"),a=i&&i.shape.segs;if(a&&a.length<2e4){var s=a.length,o=new Float32Array(s+n.length);o.set(a),o.set(n,s),i.setShape({segs:o})}else{this._newAdded=[];var l=this._create();l.incremental=!0,l.setShape({segs:n}),this._setCommon(l,e),l.__startIndex=t.start}},r.prototype.remove=function(){this._clear()},r.prototype.eachRendered=function(t){this._newAdded[0]&&t(this._newAdded[0])},r.prototype._create=function(){var t=new EPt({cursor:"default",ignoreCoarsePointer:!0});return this._newAdded.push(t),this.group.add(t),t},r.prototype._setCommon=function(t,e,i){var n=e.hostModel;t.setShape({polyline:n.get("polyline"),curveness:n.get(["lineStyle","curveness"])}),t.useStyle(n.getModel("lineStyle").getLineStyle()),t.style.strokeNoScale=!0;var a=e.getVisual("style");a&&a.stroke&&t.setStyle("stroke",a.stroke),t.setStyle("fill",null);var s=Je(t);s.seriesIndex=n.seriesIndex,t.on("mousemove",function(o){s.dataIndex=null;var l=t.hoverDataIdx;l>0&&(s.dataIndex=l+t.__startIndex)})},r.prototype._clear=function(){this._newAdded=[],this.group.removeAll()},r}();const MPt=IPt;var PPt={seriesType:"lines",plan:Vg(),reset:function(r){var t=r.coordinateSystem;if(t){var e=r.get("polyline"),i=r.pipelineContext.large;return{progress:function(n,a){var s=[];if(i){var o=void 0,l=n.end-n.start;if(e){for(var u=0,c=n.start;c<n.end;c++)u+=r.getLineCoordsCount(c);o=new Float32Array(l+u*2)}else o=new Float32Array(l*4);for(var h=0,p=[],c=n.start;c<n.end;c++){var v=r.getLineCoords(c,s);e&&(o[h++]=v);for(var y=0;y<v;y++)p=t.dataToPoint(s[y],!1,p),o[h++]=p[0],o[h++]=p[1]}a.setLayout("linesPoints",o)}else for(var c=n.start;c<n.end;c++){var x=a.getItemModel(c),v=r.getLineCoords(c,s),w=[];if(e)for(var T=0;T<v;T++)w.push(t.dataToPoint(s[T]));else{w[0]=t.dataToPoint(s[0]),w[1]=t.dataToPoint(s[1]);var E=x.get(["lineStyle","curveness"]);+E&&(w[2]=[(w[0][0]+w[1][0])/2-(w[0][1]-w[1][1])*E,(w[0][1]+w[1][1])/2-(w[1][0]-w[0][0])*E])}a.setItemLayout(c,w)}}}}}};const WX=PPt;var RPt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){var a=e.getData(),s=this._updateLineDraw(a,e),o=e.get("zlevel"),l=e.get(["effect","trailLength"]),u=n.getZr(),c=u.painter.getType()==="svg";c||u.painter.getLayer(o).clear(!0),this._lastZlevel!=null&&!c&&u.configLayer(this._lastZlevel,{motionBlur:!1}),this._showEffect(e)&&l>0&&(c||u.configLayer(o,{motionBlur:!0,lastFrameAlpha:Math.max(Math.min(l/10+.9,1),0)})),s.updateData(a);var h=e.get("clip",!0)&&B_(e.coordinateSystem,!1,e);h?this.group.setClipPath(h):this.group.removeClipPath(),this._lastZlevel=o,this._finished=!0},t.prototype.incrementalPrepareRender=function(e,i,n){var a=e.getData(),s=this._updateLineDraw(a,e);s.incrementalPrepareUpdate(a),this._clearLayer(n),this._finished=!1},t.prototype.incrementalRender=function(e,i,n){this._lineDraw.incrementalUpdate(e,i.getData()),this._finished=e.end===i.getData().count()},t.prototype.eachRendered=function(e){this._lineDraw&&this._lineDraw.eachRendered(e)},t.prototype.updateTransform=function(e,i,n){var a=e.getData(),s=e.pipelineContext;if(!this._finished||s.large||s.progressiveRender)return{update:!0};var o=WX.reset(e,i,n);o.progress&&o.progress({start:0,end:a.count(),count:a.count()},a),this._lineDraw.updateLayout(),this._clearLayer(n)},t.prototype._updateLineDraw=function(e,i){var n=this._lineDraw,a=this._showEffect(i),s=!!i.get("polyline"),o=i.pipelineContext,l=o.large;return(!n||a!==this._hasEffet||s!==this._isPolyline||l!==this._isLargeDraw)&&(n&&n.remove(),n=this._lineDraw=l?new MPt:new eL(s?a?APt:$X:a?UX:tL),this._hasEffet=a,this._isPolyline=s,this._isLargeDraw=l),this.group.add(n.group),n},t.prototype._showEffect=function(e){return!!e.get(["effect","show"])},t.prototype._clearLayer=function(e){var i=e.getZr(),n=i.painter.getType()==="svg";!n&&this._lastZlevel!=null&&i.painter.getLayer(this._lastZlevel).clear(!0)},t.prototype.remove=function(e,i){this._lineDraw&&this._lineDraw.remove(),this._lineDraw=null,this._clearLayer(i)},t.prototype.dispose=function(e,i){this.remove(e,i)},t.type="lines",t}(di);const DPt=RPt;var LPt=typeof Uint32Array>"u"?Array:Uint32Array,kPt=typeof Float64Array>"u"?Array:Float64Array;function wV(r){var t=r.data;t&&t[0]&&t[0][0]&&t[0][0].coord&&(r.data=te(t,function(e){var i=[e[0].coord,e[1].coord],n={coords:i};return e[0].name&&(n.fromName=e[0].name),e[1].name&&(n.toName=e[1].name),MR([n,e[0],e[1]])}))}var OPt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.visualStyleAccessPath="lineStyle",e.visualDrawType="stroke",e}return t.prototype.init=function(e){e.data=e.data||[],wV(e);var i=this._processFlatCoordsArray(e.data);this._flatCoords=i.flatCoords,this._flatCoordsOffset=i.flatCoordsOffset,i.flatCoords&&(e.data=new Float32Array(i.count)),r.prototype.init.apply(this,arguments)},t.prototype.mergeOption=function(e){if(wV(e),e.data){var i=this._processFlatCoordsArray(e.data);this._flatCoords=i.flatCoords,this._flatCoordsOffset=i.flatCoordsOffset,i.flatCoords&&(e.data=new Float32Array(i.count))}r.prototype.mergeOption.apply(this,arguments)},t.prototype.appendData=function(e){var i=this._processFlatCoordsArray(e.data);i.flatCoords&&(this._flatCoords?(this._flatCoords=Wb(this._flatCoords,i.flatCoords),this._flatCoordsOffset=Wb(this._flatCoordsOffset,i.flatCoordsOffset)):(this._flatCoords=i.flatCoords,this._flatCoordsOffset=i.flatCoordsOffset),e.data=new Float32Array(i.count)),this.getRawData().appendData(e.data)},t.prototype._getCoordsFromItemModel=function(e){var i=this.getData().getItemModel(e),n=i.option instanceof Array?i.option:i.getShallow("coords");return n},t.prototype.getLineCoordsCount=function(e){return this._flatCoordsOffset?this._flatCoordsOffset[e*2+1]:this._getCoordsFromItemModel(e).length},t.prototype.getLineCoords=function(e,i){if(this._flatCoordsOffset){for(var n=this._flatCoordsOffset[e*2],a=this._flatCoordsOffset[e*2+1],s=0;s<a;s++)i[s]=i[s]||[],i[s][0]=this._flatCoords[n+s*2],i[s][1]=this._flatCoords[n+s*2+1];return a}else{for(var o=this._getCoordsFromItemModel(e),s=0;s<o.length;s++)i[s]=i[s]||[],i[s][0]=o[s][0],i[s][1]=o[s][1];return o.length}},t.prototype._processFlatCoordsArray=function(e){var i=0;if(this._flatCoords&&(i=this._flatCoords.length),Fr(e[0])){for(var n=e.length,a=new LPt(n),s=new kPt(n),o=0,l=0,u=0,c=0;c<n;){u++;var h=e[c++];a[l++]=o+i,a[l++]=h;for(var p=0;p<h;p++){var v=e[c++],y=e[c++];s[o++]=v,s[o++]=y}}return{flatCoordsOffset:new Uint32Array(a.buffer,0,l),flatCoords:s,count:u}}return{flatCoordsOffset:null,flatCoords:null,count:e.length}},t.prototype.getInitialData=function(e,i){var n=new Xa(["value"],this);return n.hasItemOption=!1,n.initData(e.data,[],function(a,s,o,l){if(a instanceof Array)return NaN;n.hasItemOption=!0;var u=a.value;if(u!=null)return u instanceof Array?u[l]:u}),n},t.prototype.formatTooltip=function(e,i,n){var a=this.getData(),s=a.getItemModel(e),o=s.get("name");if(o)return o;var l=s.get("fromName"),u=s.get("toName"),c=[];return l!=null&&c.push(l),u!=null&&c.push(u),Ln("nameValue",{name:c.join(" > ")})},t.prototype.preventIncremental=function(){return!!this.get(["effect","show"])},t.prototype.getProgressive=function(){var e=this.option.progressive;return e??(this.option.large?1e4:this.get("progressive"))},t.prototype.getProgressiveThreshold=function(){var e=this.option.progressiveThreshold;return e??(this.option.large?2e4:this.get("progressiveThreshold"))},t.prototype.getZLevelKey=function(){var e=this.getModel("effect"),i=e.get("trailLength");return this.getData().count()>this.getProgressiveThreshold()?this.id:e.get("show")&&i>0?i+"":""},t.type="series.lines",t.dependencies=["grid","polar","geo","calendar"],t.defaultOption={coordinateSystem:"geo",z:2,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,symbol:["none","none"],symbolSize:[10,10],geoIndex:0,effect:{show:!1,period:4,constantSpeed:0,symbol:"circle",symbolSize:3,loop:!0,trailLength:.2},large:!1,largeThreshold:2e3,polyline:!1,clip:!0,label:{show:!1,position:"end"},lineStyle:{opacity:.5}},t}(Li);const NPt=OPt;function x1(r){return r instanceof Array||(r=[r,r]),r}var FPt={seriesType:"lines",reset:function(r){var t=x1(r.get("symbol")),e=x1(r.get("symbolSize")),i=r.getData();i.setVisual("fromSymbol",t&&t[0]),i.setVisual("toSymbol",t&&t[1]),i.setVisual("fromSymbolSize",e&&e[0]),i.setVisual("toSymbolSize",e&&e[1]);function n(a,s){var o=a.getItemModel(s),l=x1(o.getShallow("symbol",!0)),u=x1(o.getShallow("symbolSize",!0));l[0]&&a.setItemVisual(s,"fromSymbol",l[0]),l[1]&&a.setItemVisual(s,"toSymbol",l[1]),u[0]&&a.setItemVisual(s,"fromSymbolSize",u[0]),u[1]&&a.setItemVisual(s,"toSymbolSize",u[1])}return{dataEach:i.hasItemOption?n:null}}};const BPt=FPt;function zPt(r){r.registerChartView(DPt),r.registerSeriesModel(NPt),r.registerLayout(WX),r.registerVisual(BPt)}var VPt=256,UPt=function(){function r(){this.blurSize=30,this.pointSize=20,this.maxOpacity=1,this.minOpacity=0,this._gradientPixels={inRange:null,outOfRange:null};var t=Vc.createCanvas();this.canvas=t}return r.prototype.update=function(t,e,i,n,a,s){var o=this._getBrush(),l=this._getGradient(a,"inRange"),u=this._getGradient(a,"outOfRange"),c=this.pointSize+this.blurSize,h=this.canvas,p=h.getContext("2d"),v=t.length;h.width=e,h.height=i;for(var y=0;y<v;++y){var x=t[y],w=x[0],T=x[1],E=x[2],M=n(E);p.globalAlpha=M,p.drawImage(o,w-c,T-c)}if(!h.width||!h.height)return h;for(var L=p.getImageData(0,0,h.width,h.height),F=L.data,O=0,U=F.length,W=this.minOpacity,H=this.maxOpacity,j=H-W;O<U;){var M=F[O+3]/256,Y=Math.floor(M*(VPt-1))*4;if(M>0){var tt=s(M)?l:u;M>0&&(M=M*j+W),F[O++]=tt[Y],F[O++]=tt[Y+1],F[O++]=tt[Y+2],F[O++]=tt[Y+3]*M*256}else O+=4}return p.putImageData(L,0,0),h},r.prototype._getBrush=function(){var t=this._brushCanvas||(this._brushCanvas=Vc.createCanvas()),e=this.pointSize+this.blurSize,i=e*2;t.width=i,t.height=i;var n=t.getContext("2d");return n.clearRect(0,0,i,i),n.shadowOffsetX=i,n.shadowBlur=this.blurSize,n.shadowColor="#000",n.beginPath(),n.arc(-e,e,this.pointSize,0,Math.PI*2,!0),n.closePath(),n.fill(),t},r.prototype._getGradient=function(t,e){for(var i=this._gradientPixels,n=i[e]||(i[e]=new Uint8ClampedArray(256*4)),a=[0,0,0,0],s=0,o=0;o<256;o++)t[e](o/255,!0,a),n[s++]=a[0],n[s++]=a[1],n[s++]=a[2],n[s++]=a[3];return n},r}();const $Pt=UPt;function WPt(r,t,e){var i=r[1]-r[0];t=te(t,function(s){return{interval:[(s.interval[0]-r[0])/i,(s.interval[1]-r[0])/i]}});var n=t.length,a=0;return function(s){var o;for(o=a;o<n;o++){var l=t[o].interval;if(l[0]<=s&&s<=l[1]){a=o;break}}if(o===n)for(o=a-1;o>=0;o--){var l=t[o].interval;if(l[0]<=s&&s<=l[1]){a=o;break}}return o>=0&&o<n&&e[o]}}function HPt(r,t){var e=r[1]-r[0];return t=[(t[0]-r[0])/e,(t[1]-r[0])/e],function(i){return i>=t[0]&&i<=t[1]}}function SV(r){var t=r.dimensions;return t[0]==="lng"&&t[1]==="lat"}var GPt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){var a;i.eachComponent("visualMap",function(o){o.eachTargetSeries(function(l){l===e&&(a=o)})}),this._progressiveEls=null,this.group.removeAll();var s=e.coordinateSystem;s.type==="cartesian2d"||s.type==="calendar"?this._renderOnCartesianAndCalendar(e,n,0,e.getData().count()):SV(s)&&this._renderOnGeo(s,e,a,n)},t.prototype.incrementalPrepareRender=function(e,i,n){this.group.removeAll()},t.prototype.incrementalRender=function(e,i,n,a){var s=i.coordinateSystem;s&&(SV(s)?this.render(i,n,a):(this._progressiveEls=[],this._renderOnCartesianAndCalendar(i,a,e.start,e.end,!0)))},t.prototype.eachRendered=function(e){Kc(this._progressiveEls||this.group,e)},t.prototype._renderOnCartesianAndCalendar=function(e,i,n,a,s){var o=e.coordinateSystem,l=ad(o,"cartesian2d"),u,c,h,p;if(l){var v=o.getAxis("x"),y=o.getAxis("y");u=v.getBandWidth()+.5,c=y.getBandWidth()+.5,h=v.scale.getExtent(),p=y.scale.getExtent()}for(var x=this.group,w=e.getData(),T=e.getModel(["emphasis","itemStyle"]).getItemStyle(),E=e.getModel(["blur","itemStyle"]).getItemStyle(),M=e.getModel(["select","itemStyle"]).getItemStyle(),L=e.get(["itemStyle","borderRadius"]),F=Dn(e),O=e.getModel("emphasis"),U=O.get("focus"),W=O.get("blurScope"),H=O.get("disabled"),j=l?[w.mapDimension("x"),w.mapDimension("y"),w.mapDimension("value")]:[w.mapDimension("time"),w.mapDimension("value")],Y=n;Y<a;Y++){var tt=void 0,it=w.getItemVisual(Y,"style");if(l){var lt=w.get(j[0],Y),ht=w.get(j[1],Y);if(isNaN(w.get(j[2],Y))||isNaN(lt)||isNaN(ht)||lt<h[0]||lt>h[1]||ht<p[0]||ht>p[1])continue;var Tt=o.dataToPoint([lt,ht]);tt=new Pr({shape:{x:Tt[0]-u/2,y:Tt[1]-c/2,width:u,height:c},style:it})}else{if(isNaN(w.get(j[1],Y)))continue;tt=new Pr({z2:1,shape:o.dataToRect([w.get(j[0],Y)]).contentShape,style:it})}if(w.hasItemOption){var Ot=w.getItemModel(Y),Rt=Ot.getModel("emphasis");T=Rt.getModel("itemStyle").getItemStyle(),E=Ot.getModel(["blur","itemStyle"]).getItemStyle(),M=Ot.getModel(["select","itemStyle"]).getItemStyle(),L=Ot.get(["itemStyle","borderRadius"]),U=Rt.get("focus"),W=Rt.get("blurScope"),H=Rt.get("disabled"),F=Dn(Ot)}tt.shape.r=L;var Ut=e.getRawValue(Y),Jt="-";Ut&&Ut[2]!=null&&(Jt=Ut[2]+""),ra(tt,F,{labelFetcher:e,labelDataIndex:Y,defaultOpacity:it.opacity,defaultText:Jt}),tt.ensureState("emphasis").style=T,tt.ensureState("blur").style=E,tt.ensureState("select").style=M,Ui(tt,U,W,H),tt.incremental=s,s&&(tt.states.emphasis.hoverLayer=!0),x.add(tt),w.setItemGraphicEl(Y,tt),this._progressiveEls&&this._progressiveEls.push(tt)}},t.prototype._renderOnGeo=function(e,i,n,a){var s=n.targetVisuals.inRange,o=n.targetVisuals.outOfRange,l=i.getData(),u=this._hmLayer||this._hmLayer||new $Pt;u.blurSize=i.get("blurSize"),u.pointSize=i.get("pointSize"),u.minOpacity=i.get("minOpacity"),u.maxOpacity=i.get("maxOpacity");var c=e.getViewRect().clone(),h=e.getRoamTransform();c.applyTransform(h);var p=Math.max(c.x,0),v=Math.max(c.y,0),y=Math.min(c.width+c.x,a.getWidth()),x=Math.min(c.height+c.y,a.getHeight()),w=y-p,T=x-v,E=[l.mapDimension("lng"),l.mapDimension("lat"),l.mapDimension("value")],M=l.mapArray(E,function(U,W,H){var j=e.dataToPoint([U,W]);return j[0]-=p,j[1]-=v,j.push(H),j}),L=n.getExtent(),F=n.type==="visualMap.continuous"?HPt(L,n.option.range):WPt(L,n.getPieceList(),n.option.selected);u.update(M,w,T,s.color.getNormalizer(),{inRange:s.color.getColorMapper(),outOfRange:o.color.getColorMapper()},F);var O=new ia({style:{width:w,height:T,x:p,y:v,image:u.canvas},silent:!0});this.group.add(O)},t.type="heatmap",t}(di);const jPt=GPt;var XPt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(e,i){return Su(null,this,{generateCoord:"value"})},t.prototype.preventIncremental=function(){var e=D_.get(this.get("coordinateSystem"));if(e&&e.dimensions)return e.dimensions[0]==="lng"&&e.dimensions[1]==="lat"},t.type="series.heatmap",t.dependencies=["grid","geo","calendar"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,geoIndex:0,blurSize:30,pointSize:20,maxOpacity:1,minOpacity:0,select:{itemStyle:{borderColor:"#212121"}}},t}(Li);const ZPt=XPt;function qPt(r){r.registerChartView(jPt),r.registerSeriesModel(ZPt)}var YPt=["itemStyle","borderWidth"],TV=[{xy:"x",wh:"width",index:0,posDesc:["left","right"]},{xy:"y",wh:"height",index:1,posDesc:["top","bottom"]}],ZC=new Yc,KPt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){var a=this.group,s=e.getData(),o=this._data,l=e.coordinateSystem,u=l.getBaseAxis(),c=u.isHorizontal(),h=l.master.getRect(),p={ecSize:{width:n.getWidth(),height:n.getHeight()},seriesModel:e,coordSys:l,coordSysExtent:[[h.x,h.x+h.width],[h.y,h.y+h.height]],isHorizontal:c,valueDim:TV[+c],categoryDim:TV[1-+c]};s.diff(o).add(function(y){if(s.hasValue(y)){var x=CV(s,y),w=AV(s,y,x,p),T=EV(s,p,w);s.setItemGraphicEl(y,T),a.add(T),MV(T,p,w)}}).update(function(y,x){var w=o.getItemGraphicEl(x);if(!s.hasValue(y)){a.remove(w);return}var T=CV(s,y),E=AV(s,y,T,p),M=qX(s,E);w&&M!==w.__pictorialShapeStr&&(a.remove(w),s.setItemGraphicEl(y,null),w=null),w?nRt(w,p,E):w=EV(s,p,E,!0),s.setItemGraphicEl(y,w),w.__pictorialSymbolMeta=E,a.add(w),MV(w,p,E)}).remove(function(y){var x=o.getItemGraphicEl(y);x&&IV(o,y,x.__pictorialSymbolMeta.animationModel,x)}).execute();var v=e.get("clip",!0)?B_(e.coordinateSystem,!1,e):null;return v?a.setClipPath(v):a.removeClipPath(),this._data=s,this.group},t.prototype.remove=function(e,i){var n=this.group,a=this._data;e.get("animation")?a&&a.eachItemGraphicEl(function(s){IV(a,Je(s).dataIndex,e,s)}):n.removeAll()},t.type="pictorialBar",t}(di);function AV(r,t,e,i){var n=r.getItemLayout(t),a=e.get("symbolRepeat"),s=e.get("symbolClip"),o=e.get("symbolPosition")||"start",l=e.get("symbolRotate"),u=(l||0)*Math.PI/180||0,c=e.get("symbolPatternSize")||2,h=e.isAnimationEnabled(),p={dataIndex:t,layout:n,itemModel:e,symbolType:r.getItemVisual(t,"symbol")||"circle",style:r.getItemVisual(t,"style"),symbolClip:s,symbolRepeat:a,symbolRepeatDirection:e.get("symbolRepeatDirection"),symbolPatternSize:c,rotation:u,animationModel:h?e:null,hoverScale:h&&e.get(["emphasis","scale"]),z2:e.getShallow("z",!0)||0};JPt(e,a,n,i,p),QPt(r,t,n,a,s,p.boundingLength,p.pxSign,c,i,p),tRt(e,p.symbolScale,u,i,p);var v=p.symbolSize,y=id(e.get("symbolOffset"),v);return eRt(e,v,n,a,s,y,o,p.valueLineWidth,p.boundingLength,p.repeatCutLength,i,p),p}function JPt(r,t,e,i,n){var a=i.valueDim,s=r.get("symbolBoundingData"),o=i.coordSys.getOtherAxis(i.coordSys.getBaseAxis()),l=o.toGlobalCoord(o.dataToCoord(0)),u=1-+(e[a.wh]<=0),c;if(Kt(s)){var h=[qC(o,s[0])-l,qC(o,s[1])-l];h[1]<h[0]&&h.reverse(),c=h[u]}else s!=null?c=qC(o,s)-l:t?c=i.coordSysExtent[a.index][u]-l:c=e[a.wh];n.boundingLength=c,t&&(n.repeatCutLength=e[a.wh]),n.pxSign=c>0?1:-1}function qC(r,t){return r.toGlobalCoord(r.dataToCoord(r.scale.parse(t)))}function QPt(r,t,e,i,n,a,s,o,l,u){var c=l.valueDim,h=l.categoryDim,p=Math.abs(e[h.wh]),v=r.getItemVisual(t,"symbolSize"),y;Kt(v)?y=v.slice():v==null?y=["100%","100%"]:y=[v,v],y[h.index]=he(y[h.index],p),y[c.index]=he(y[c.index],i?p:Math.abs(a)),u.symbolSize=y;var x=u.symbolScale=[y[0]/o,y[1]/o];x[c.index]*=(l.isHorizontal?-1:1)*s}function tRt(r,t,e,i,n){var a=r.get(YPt)||0;a&&(ZC.attr({scaleX:t[0],scaleY:t[1],rotation:e}),ZC.updateTransform(),a/=ZC.getLineScale(),a*=t[i.valueDim.index]),n.valueLineWidth=a||0}function eRt(r,t,e,i,n,a,s,o,l,u,c,h){var p=c.categoryDim,v=c.valueDim,y=h.pxSign,x=Math.max(t[v.index]+o,0),w=x;if(i){var T=Math.abs(l),E=Un(r.get("symbolMargin"),"15%")+"",M=!1;E.lastIndexOf("!")===E.length-1&&(M=!0,E=E.slice(0,E.length-1));var L=he(E,t[v.index]),F=Math.max(x+L*2,0),O=M?0:L*2,U=DH(i),W=U?i:PV((T+O)/F),H=T-W*x;L=H/2/(M?W:Math.max(W-1,1)),F=x+L*2,O=M?0:L*2,!U&&i!=="fixed"&&(W=u?PV((Math.abs(u)+O)/F):0),w=W*F-O,h.repeatTimes=W,h.symbolMargin=L}var j=y*(w/2),Y=h.pathPosition=[];Y[p.index]=e[p.wh]/2,Y[v.index]=s==="start"?j:s==="end"?l-j:l/2,a&&(Y[0]+=a[0],Y[1]+=a[1]);var tt=h.bundlePosition=[];tt[p.index]=e[p.xy],tt[v.index]=e[v.xy];var it=h.barRectShape=Zt({},e);it[v.wh]=y*Math.max(Math.abs(e[v.wh]),Math.abs(Y[v.index]+j)),it[p.wh]=e[p.wh];var lt=h.clipShape={};lt[p.xy]=-e[p.xy],lt[p.wh]=c.ecSize[p.wh],lt[v.xy]=0,lt[v.wh]=e[v.wh]}function HX(r){var t=r.symbolPatternSize,e=mn(r.symbolType,-t/2,-t/2,t,t);return e.attr({culling:!0}),e.type!=="image"&&e.setStyle({strokeNoScale:!0}),e}function GX(r,t,e,i){var n=r.__pictorialBundle,a=e.symbolSize,s=e.valueLineWidth,o=e.pathPosition,l=t.valueDim,u=e.repeatTimes||0,c=0,h=a[t.valueDim.index]+s+e.symbolMargin*2;for(uL(r,function(x){x.__pictorialAnimationIndex=c,x.__pictorialRepeatTimes=u,c<u?tg(x,null,y(c),e,i):tg(x,null,{scaleX:0,scaleY:0},e,i,function(){n.remove(x)}),c++});c<u;c++){var p=HX(e);p.__pictorialAnimationIndex=c,p.__pictorialRepeatTimes=u,n.add(p);var v=y(c);tg(p,{x:v.x,y:v.y,scaleX:0,scaleY:0},{scaleX:v.scaleX,scaleY:v.scaleY,rotation:v.rotation},e,i)}function y(x){var w=o.slice(),T=e.pxSign,E=x;return(e.symbolRepeatDirection==="start"?T>0:T<0)&&(E=u-1-x),w[l.index]=h*(E-u/2+.5)+o[l.index],{x:w[0],y:w[1],scaleX:e.symbolScale[0],scaleY:e.symbolScale[1],rotation:e.rotation}}}function jX(r,t,e,i){var n=r.__pictorialBundle,a=r.__pictorialMainPath;a?tg(a,null,{x:e.pathPosition[0],y:e.pathPosition[1],scaleX:e.symbolScale[0],scaleY:e.symbolScale[1],rotation:e.rotation},e,i):(a=r.__pictorialMainPath=HX(e),n.add(a),tg(a,{x:e.pathPosition[0],y:e.pathPosition[1],scaleX:0,scaleY:0,rotation:e.rotation},{scaleX:e.symbolScale[0],scaleY:e.symbolScale[1]},e,i))}function XX(r,t,e){var i=Zt({},t.barRectShape),n=r.__pictorialBarRect;n?tg(n,null,{shape:i},t,e):(n=r.__pictorialBarRect=new Pr({z2:2,shape:i,silent:!0,style:{stroke:"transparent",fill:"transparent",lineWidth:0}}),n.disableMorphing=!0,r.add(n))}function ZX(r,t,e,i){if(e.symbolClip){var n=r.__pictorialClipPath,a=Zt({},e.clipShape),s=t.valueDim,o=e.animationModel,l=e.dataIndex;if(n)zr(n,{shape:a},o,l);else{a[s.wh]=0,n=new Pr({shape:a}),r.__pictorialBundle.setClipPath(n),r.__pictorialClipPath=n;var u={};u[s.wh]=e.clipShape[s.wh],ed[i?"updateProps":"initProps"](n,{shape:u},o,l)}}}function CV(r,t){var e=r.getItemModel(t);return e.getAnimationDelayParams=rRt,e.isAnimationEnabled=iRt,e}function rRt(r){return{index:r.__pictorialAnimationIndex,count:r.__pictorialRepeatTimes}}function iRt(){return this.parentModel.isAnimationEnabled()&&!!this.getShallow("animation")}function EV(r,t,e,i){var n=new Ke,a=new Ke;return n.add(a),n.__pictorialBundle=a,a.x=e.bundlePosition[0],a.y=e.bundlePosition[1],e.symbolRepeat?GX(n,t,e):jX(n,t,e),XX(n,e,i),ZX(n,t,e,i),n.__pictorialShapeStr=qX(r,e),n.__pictorialSymbolMeta=e,n}function nRt(r,t,e){var i=e.animationModel,n=e.dataIndex,a=r.__pictorialBundle;zr(a,{x:e.bundlePosition[0],y:e.bundlePosition[1]},i,n),e.symbolRepeat?GX(r,t,e,!0):jX(r,t,e,!0),XX(r,e,!0),ZX(r,t,e,!0)}function IV(r,t,e,i){var n=i.__pictorialBarRect;n&&n.removeTextContent();var a=[];uL(i,function(s){a.push(s)}),i.__pictorialMainPath&&a.push(i.__pictorialMainPath),i.__pictorialClipPath&&(e=null),J(a,function(s){$c(s,{scaleX:0,scaleY:0},e,t,function(){i.parent&&i.parent.remove(i)})}),r.setItemGraphicEl(t,null)}function qX(r,t){return[r.getItemVisual(t.dataIndex,"symbol")||"none",!!t.symbolRepeat,!!t.symbolClip].join(":")}function uL(r,t,e){J(r.__pictorialBundle.children(),function(i){i!==r.__pictorialBarRect&&t.call(e,i)})}function tg(r,t,e,i,n,a){t&&r.attr(t),i.symbolClip&&!n?e&&r.attr(e):e&&ed[n?"updateProps":"initProps"](r,e,i.animationModel,i.dataIndex,a)}function MV(r,t,e){var i=e.dataIndex,n=e.itemModel,a=n.getModel("emphasis"),s=a.getModel("itemStyle").getItemStyle(),o=n.getModel(["blur","itemStyle"]).getItemStyle(),l=n.getModel(["select","itemStyle"]).getItemStyle(),u=n.getShallow("cursor"),c=a.get("focus"),h=a.get("blurScope"),p=a.get("scale");uL(r,function(x){if(x instanceof ia){var w=x.style;x.useStyle(Zt({image:w.image,x:w.x,y:w.y,width:w.width,height:w.height},e.style))}else x.useStyle(e.style);var T=x.ensureState("emphasis");T.style=s,p&&(T.scaleX=x.scaleX*1.1,T.scaleY=x.scaleY*1.1),x.ensureState("blur").style=o,x.ensureState("select").style=l,u&&(x.cursor=u),x.z2=e.z2});var v=t.valueDim.posDesc[+(e.boundingLength>0)],y=r.__pictorialBarRect;y.ignoreClip=!0,ra(y,Dn(n),{labelFetcher:t.seriesModel,labelDataIndex:i,defaultText:mg(t.seriesModel.getData(),i),inheritColor:e.style.fill,defaultOpacity:e.style.opacity,defaultOutsidePosition:v}),Ui(r,c,h,a.get("disabled"))}function PV(r){var t=Math.round(r);return Math.abs(r-t)<1e-4?t:Math.ceil(r)}const aRt=KPt;var sRt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e.defaultSymbol="roundRect",e}return t.prototype.getInitialData=function(e){return e.stack=null,r.prototype.getInitialData.apply(this,arguments)},t.type="series.pictorialBar",t.dependencies=["grid"],t.defaultOption=Jc(mw.defaultOption,{symbol:"circle",symbolSize:null,symbolRotate:null,symbolPosition:null,symbolOffset:null,symbolMargin:null,symbolRepeat:!1,symbolRepeatDirection:"end",symbolClip:!1,symbolBoundingData:null,symbolPatternSize:400,barGap:"-100%",clip:!1,progressive:0,emphasis:{scale:!1},select:{itemStyle:{borderColor:"#212121"}}}),t}(mw);const oRt=sRt;function lRt(r){r.registerChartView(aRt),r.registerSeriesModel(oRt),r.registerLayout(r.PRIORITY.VISUAL.LAYOUT,nr(EG,"pictorialBar")),r.registerLayout(r.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,IG("pictorialBar"))}var uRt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e._layers=[],e}return t.prototype.render=function(e,i,n){var a=e.getData(),s=this,o=this.group,l=e.getLayerSeries(),u=a.getLayout("layoutInfo"),c=u.rect,h=u.boundaryGap;o.x=0,o.y=c.y+h[0];function p(w){return w.name}var v=new yu(this._layersSeries||[],l,p,p),y=[];v.add(we(x,this,"add")).update(we(x,this,"update")).remove(we(x,this,"remove")).execute();function x(w,T,E){var M=s._layers;if(w==="remove"){o.remove(M[T]);return}for(var L=[],F=[],O,U=l[T].indices,W=0;W<U.length;W++){var H=a.getItemLayout(U[W]),j=H.x,Y=H.y0,tt=H.y;L.push(j,Y),F.push(j,Y+tt),O=a.getItemVisual(U[W],"style")}var it,lt=a.getItemLayout(U[0]),ht=e.getModel("label"),Tt=ht.get("margin"),Ot=e.getModel("emphasis");if(w==="add"){var Rt=y[T]=new Ke;it=new yj({shape:{points:L,stackedOnPoints:F,smooth:.4,stackedOnSmooth:.4,smoothConstraint:!1},z2:0}),Rt.add(it),o.add(Rt),e.isAnimationEnabled()&&it.setClipPath(cRt(it.getBoundingRect(),e,function(){it.removeClipPath()}))}else{var Rt=M[E];it=Rt.childAt(0),o.add(Rt),y[T]=Rt,zr(it,{shape:{points:L,stackedOnPoints:F}},e),Vo(it)}ra(it,Dn(e),{labelDataIndex:U[W-1],defaultText:a.getName(U[W-1]),inheritColor:O.fill},{normal:{verticalAlign:"middle"}}),it.setTextConfig({position:null,local:!0});var Ut=it.getTextContent();Ut&&(Ut.x=lt.x-Tt,Ut.y=lt.y0+lt.y/2),it.useStyle(O),a.setItemGraphicEl(T,it),ea(it,e),Ui(it,Ot.get("focus"),Ot.get("blurScope"),Ot.get("disabled"))}this._layersSeries=l,this._layers=y},t.type="themeRiver",t}(di);function cRt(r,t,e){var i=new Pr({shape:{x:r.x-10,y:r.y-10,width:0,height:r.height+20}});return Ei(i,{shape:{x:r.x-50,width:r.width+100,height:r.height+20}},t,e),i}const hRt=uRt;var YC=2,fRt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e){r.prototype.init.apply(this,arguments),this.legendVisualProvider=new U_(we(this.getData,this),we(this.getRawData,this))},t.prototype.fixData=function(e){var i=e.length,n={},a=QI(e,function(p){return n.hasOwnProperty(p[0]+"")||(n[p[0]+""]=-1),p[2]}),s=[];a.buckets.each(function(p,v){s.push({name:v,dataList:p})});for(var o=s.length,l=0;l<o;++l){for(var u=s[l].name,c=0;c<s[l].dataList.length;++c){var h=s[l].dataList[c][0]+"";n[h]=l}for(var h in n)n.hasOwnProperty(h)&&n[h]!==l&&(n[h]=l,e[i]=[h,0,u],i++)}return e},t.prototype.getInitialData=function(e,i){for(var n=this.getReferringComponents("singleAxis",vn).models[0],a=n.get("type"),s=ti(e.data,function(y){return y[2]!==void 0}),o=this.fixData(s||[]),l=[],u=this.nameMap=Re(),c=0,h=0;h<o.length;++h)l.push(o[h][YC]),u.get(o[h][YC])||(u.set(o[h][YC],c),c++);var p=k_(o,{coordDimensions:["single"],dimensionsDefine:[{name:"time",type:fw(a)},{name:"value",type:"float"},{name:"name",type:"ordinal"}],encodeDefine:{single:0,value:1,itemName:2}}).dimensions,v=new Xa(p,this);return v.initData(o),v},t.prototype.getLayerSeries=function(){for(var e=this.getData(),i=e.count(),n=[],a=0;a<i;++a)n[a]=a;var s=e.mapDimension("single"),o=QI(n,function(u){return e.get("name",u)}),l=[];return o.buckets.each(function(u,c){u.sort(function(h,p){return e.get(s,h)-e.get(s,p)}),l.push({name:c,indices:u})}),l},t.prototype.getAxisTooltipData=function(e,i,n){Kt(e)||(e=e?[e]:[]);for(var a=this.getData(),s=this.getLayerSeries(),o=[],l=s.length,u,c=0;c<l;++c){for(var h=Number.MAX_VALUE,p=-1,v=s[c].indices.length,y=0;y<v;++y){var x=a.get(e[0],s[c].indices[y]),w=Math.abs(x-i);w<=h&&(u=x,h=w,p=s[c].indices[y])}o.push(p)}return{dataIndices:o,nestestValue:u}},t.prototype.formatTooltip=function(e,i,n){var a=this.getData(),s=a.getName(e),o=a.get(a.mapDimension("value"),e);return Ln("nameValue",{name:s,value:o})},t.type="series.themeRiver",t.dependencies=["singleAxis"],t.defaultOption={z:2,colorBy:"data",coordinateSystem:"singleAxis",boundaryGap:["10%","10%"],singleAxisIndex:0,animationEasing:"linear",label:{margin:4,show:!0,position:"left",fontSize:11},emphasis:{label:{show:!0}}},t}(Li);const dRt=fRt;function pRt(r,t){r.eachSeriesByType("themeRiver",function(e){var i=e.getData(),n=e.coordinateSystem,a={},s=n.getRect();a.rect=s;var o=e.get("boundaryGap"),l=n.getAxis();if(a.boundaryGap=o,l.orient==="horizontal"){o[0]=he(o[0],s.height),o[1]=he(o[1],s.height);var u=s.height-o[0]-o[1];RV(i,e,u)}else{o[0]=he(o[0],s.width),o[1]=he(o[1],s.width);var c=s.width-o[0]-o[1];RV(i,e,c)}i.setLayout("layoutInfo",a)})}function RV(r,t,e){if(r.count())for(var i=t.coordinateSystem,n=t.getLayerSeries(),a=r.mapDimension("single"),s=r.mapDimension("value"),o=te(n,function(w){return te(w.indices,function(T){var E=i.dataToPoint(r.get(a,T));return E[1]=r.get(s,T),E})}),l=gRt(o),u=l.y0,c=e/l.max,h=n.length,p=n[0].indices.length,v,y=0;y<p;++y){v=u[y]*c,r.setItemLayout(n[0].indices[y],{layerIndex:0,x:o[0][y][0],y0:v,y:o[0][y][1]*c});for(var x=1;x<h;++x)v+=o[x-1][y][1]*c,r.setItemLayout(n[x].indices[y],{layerIndex:x,x:o[x][y][0],y0:v,y:o[x][y][1]*c})}}function gRt(r){for(var t=r.length,e=r[0].length,i=[],n=[],a=0,s=0;s<e;++s){for(var o=0,l=0;l<t;++l)o+=r[l][s][1];o>a&&(a=o),i.push(o)}for(var u=0;u<e;++u)n[u]=(a-i[u])/2;a=0;for(var c=0;c<e;++c){var h=i[c]+n[c];h>a&&(a=h)}return{y0:n,max:a}}function vRt(r){r.registerChartView(hRt),r.registerSeriesModel(dRt),r.registerLayout(pRt),r.registerProcessor(V_("themeRiver"))}var mRt=2,yRt=4,_Rt=function(r){Vt(t,r);function t(e,i,n,a){var s=r.call(this)||this;s.z2=mRt,s.textConfig={inside:!0},Je(s).seriesIndex=i.seriesIndex;var o=new Nr({z2:yRt,silent:e.getModel().get(["label","silent"])});return s.setTextContent(o),s.updateData(!0,e,i,n,a),s}return t.prototype.updateData=function(e,i,n,a,s){this.node=i,i.piece=this,n=n||this._seriesModel,a=a||this._ecModel;var o=this;Je(o).dataIndex=i.dataIndex;var l=i.getModel(),u=l.getModel("emphasis"),c=i.getLayout(),h=Zt({},c);h.label=null;var p=i.getVisual("style");p.lineJoin="bevel";var v=i.getVisual("decal");v&&(p.decal=gg(v,s));var y=xf(l.getModel("itemStyle"),h,!0);Zt(h,y),J(qa,function(E){var M=o.ensureState(E),L=l.getModel([E,"itemStyle"]);M.style=L.getItemStyle();var F=xf(L,h);F&&(M.shape=F)}),e?(o.setShape(h),o.shape.r=c.r0,Ei(o,{shape:{r:c.r}},n,i.dataIndex)):(zr(o,{shape:h},n),Vo(o)),o.useStyle(p),this._updateLabel(n);var x=l.getShallow("cursor");x&&o.attr("cursor",x),this._seriesModel=n||this._seriesModel,this._ecModel=a||this._ecModel;var w=u.get("focus"),T=w==="ancestor"?i.getAncestorsIndices():w==="descendant"?i.getDescendantIndices():w;Ui(this,T,u.get("blurScope"),u.get("disabled"))},t.prototype._updateLabel=function(e){var i=this,n=this.node.getModel(),a=n.getModel("label"),s=this.node.getLayout(),o=s.endAngle-s.startAngle,l=(s.startAngle+s.endAngle)/2,u=Math.cos(l),c=Math.sin(l),h=this,p=h.getTextContent(),v=this.node.dataIndex,y=a.get("minAngle")/180*Math.PI,x=a.get("show")&&!(y!=null&&Math.abs(o)<y);p.ignore=!x,J(jy,function(T){var E=T==="normal"?n.getModel("label"):n.getModel([T,"label"]),M=T==="normal",L=M?p:p.ensureState(T),F=e.getFormattedLabel(v,T);M&&(F=F||i.node.name),L.style=hi(E,{},null,T!=="normal",!0),F&&(L.style.text=F);var O=E.get("show");O!=null&&!M&&(L.ignore=!O);var U=w(E,"position"),W=M?h:h.states[T],H=W.style.fill;W.textConfig={outsideFill:E.get("color")==="inherit"?H:null,inside:U!=="outside"};var j,Y=w(E,"distance")||0,tt=w(E,"align"),it=w(E,"rotate"),lt=Math.PI*.5,ht=Math.PI*1.5,Tt=Cs(it==="tangential"?Math.PI/2-l:l),Ot=Tt>lt&&!Wy(Tt-lt)&&Tt<ht;U==="outside"?(j=s.r+Y,tt=Ot?"right":"left"):!tt||tt==="center"?(o===2*Math.PI&&s.r0===0?j=0:j=(s.r+s.r0)/2,tt="center"):tt==="left"?(j=s.r0+Y,tt=Ot?"right":"left"):tt==="right"&&(j=s.r-Y,tt=Ot?"left":"right"),L.style.align=tt,L.style.verticalAlign=w(E,"verticalAlign")||"middle",L.x=j*u+s.cx,L.y=j*c+s.cy;var Rt=0;it==="radial"?Rt=Cs(-l)+(Ot?Math.PI:0):it==="tangential"?Rt=Cs(Math.PI/2-l)+(Ot?Math.PI:0):Fr(it)&&(Rt=it*Math.PI/180),L.rotation=Cs(Rt)});function w(T,E){var M=T.get(E);return M??a.get(E)}p.dirtyStyle()},t}(fs);const DV=_Rt;var KM="sunburstRootToNode",LV="sunburstHighlight",xRt="sunburstUnhighlight";function bRt(r){r.registerAction({type:KM,update:"updateView"},function(t,e){e.eachComponent({mainType:"series",subType:"sunburst",query:t},i);function i(n,a){var s=a_(t,[KM],n);if(s){var o=n.getViewRoot();o&&(t.direction=ZD(o,s.node)?"rollUp":"drillDown"),n.resetViewRoot(s.node)}}}),r.registerAction({type:LV,update:"none"},function(t,e,i){t=Zt({},t),e.eachComponent({mainType:"series",subType:"sunburst",query:t},n);function n(a){var s=a_(t,[LV],a);s&&(t.dataIndex=s.node.dataIndex)}i.dispatchAction(Zt(t,{type:"highlight"}))}),r.registerAction({type:xRt,update:"updateView"},function(t,e,i){t=Zt({},t),i.dispatchAction(Zt(t,{type:"downplay"}))})}var wRt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n,a){var s=this;this.seriesModel=e,this.api=n,this.ecModel=i;var o=e.getData(),l=o.tree.root,u=e.getViewRoot(),c=this.group,h=e.get("renderLabelForZeroData"),p=[];u.eachNode(function(E){p.push(E)});var v=this._oldChildren||[];y(p,v),T(l,u),this._initEvents(),this._oldChildren=p;function y(E,M){if(E.length===0&&M.length===0)return;new yu(M,E,L,L).add(F).update(F).remove(nr(F,null)).execute();function L(O){return O.getId()}function F(O,U){var W=O==null?null:E[O],H=U==null?null:M[U];x(W,H)}}function x(E,M){if(!h&&E&&!E.getValue()&&(E=null),E!==l&&M!==l){if(M&&M.piece)E?(M.piece.updateData(!1,E,e,i,n),o.setItemGraphicEl(E.dataIndex,M.piece)):w(M);else if(E){var L=new DV(E,e,i,n);c.add(L),o.setItemGraphicEl(E.dataIndex,L)}}}function w(E){E&&E.piece&&(c.remove(E.piece),E.piece=null)}function T(E,M){M.depth>0?(s.virtualPiece?s.virtualPiece.updateData(!1,E,e,i,n):(s.virtualPiece=new DV(E,e,i,n),c.add(s.virtualPiece)),M.piece.off("click"),s.virtualPiece.on("click",function(L){s._rootToNode(M.parentNode)})):s.virtualPiece&&(c.remove(s.virtualPiece),s.virtualPiece=null)}},t.prototype._initEvents=function(){var e=this;this.group.off("click"),this.group.on("click",function(i){var n=!1,a=e.seriesModel.getViewRoot();a.eachNode(function(s){if(!n&&s.piece&&s.piece===i.target){var o=s.getModel().get("nodeClick");if(o==="rootToNode")e._rootToNode(s);else if(o==="link"){var l=s.getModel(),u=l.get("link");if(u){var c=l.get("target",!0)||"_blank";nw(u,c)}}n=!0}})})},t.prototype._rootToNode=function(e){e!==this.seriesModel.getViewRoot()&&this.api.dispatchAction({type:KM,from:this.uid,seriesId:this.seriesModel.id,targetNode:e})},t.prototype.containPoint=function(e,i){var n=i.getData(),a=n.getItemLayout(0);if(a){var s=e[0]-a.cx,o=e[1]-a.cy,l=Math.sqrt(s*s+o*o);return l<=a.r&&l>=a.r0}},t.type="sunburst",t}(di);const SRt=wRt;var TRt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.ignoreStyleOnData=!0,e}return t.prototype.getInitialData=function(e,i){var n={name:e.name,children:e.data};YX(n);var a=this._levelModels=te(e.levels||[],function(l){return new fi(l,this,i)},this),s=XD.createTree(n,this,o);function o(l){l.wrapMethod("getItemModel",function(u,c){var h=s.getNodeByDataIndex(c),p=a[h.depth];return p&&(u.parentModel=p),u})}return s.data},t.prototype.optionUpdated=function(){this.resetViewRoot()},t.prototype.getDataParams=function(e){var i=r.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(e);return i.treePathInfo=YS(n,this),i},t.prototype.getLevelModel=function(e){return this._levelModels&&this._levelModels[e.depth]},t.prototype.getViewRoot=function(){return this._viewRoot},t.prototype.resetViewRoot=function(e){e?this._viewRoot=e:e=this._viewRoot;var i=this.getRawData().tree.root;(!e||e!==i&&!i.contains(e))&&(this._viewRoot=i)},t.prototype.enableAriaDecal=function(){tX(this)},t.type="series.sunburst",t.defaultOption={z:2,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,stillShowZeroSum:!0,nodeClick:"rootToNode",renderLabelForZeroData:!1,label:{rotate:"radial",show:!0,opacity:1,align:"center",position:"inside",distance:5,silent:!0},itemStyle:{borderWidth:1,borderColor:"white",borderType:"solid",shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0.2)",shadowOffsetX:0,shadowOffsetY:0,opacity:1},emphasis:{focus:"descendant"},blur:{itemStyle:{opacity:.2},label:{opacity:.1}},animationType:"expansion",animationDuration:1e3,animationDurationUpdate:500,data:[],sort:"desc"},t}(Li);function YX(r){var t=0;J(r.children,function(i){YX(i);var n=i.value;Kt(n)&&(n=n[0]),t+=n});var e=r.value;Kt(e)&&(e=e[0]),(e==null||isNaN(e))&&(e=t),e<0&&(e=0),Kt(r.value)?r.value[0]=e:r.value=e}const ARt=TRt;var kV=Math.PI/180;function CRt(r,t,e){t.eachSeriesByType(r,function(i){var n=i.get("center"),a=i.get("radius");Kt(a)||(a=[0,a]),Kt(n)||(n=[n,n]);var s=e.getWidth(),o=e.getHeight(),l=Math.min(s,o),u=he(n[0],s),c=he(n[1],o),h=he(a[0],l/2),p=he(a[1],l/2),v=-i.get("startAngle")*kV,y=i.get("minAngle")*kV,x=i.getData().tree.root,w=i.getViewRoot(),T=w.depth,E=i.get("sort");E!=null&&KX(w,E);var M=0;J(w.children,function(Tt){!isNaN(Tt.getValue())&&M++});var L=w.getValue(),F=Math.PI/(L||M)*2,O=w.depth>0,U=w.height-(O?-1:1),W=(p-h)/(U||1),H=i.get("clockwise"),j=i.get("stillShowZeroSum"),Y=H?1:-1,tt=function(Tt,Ot){if(Tt){var Rt=Ot;if(Tt!==x){var Ut=Tt.getValue(),Jt=L===0&&j?F:Ut*F;Jt<y&&(Jt=y),Rt=Ot+Y*Jt;var ne=Tt.depth-T-(O?-1:1),se=h+W*ne,ce=h+W*(ne+1),ye=i.getLevelModel(Tt);if(ye){var Qe=ye.get("r0",!0),sr=ye.get("r",!0),ke=ye.get("radius",!0);ke!=null&&(Qe=ke[0],sr=ke[1]),Qe!=null&&(se=he(Qe,l/2)),sr!=null&&(ce=he(sr,l/2))}Tt.setLayout({angle:Jt,startAngle:Ot,endAngle:Rt,clockwise:H,cx:u,cy:c,r0:se,r:ce})}if(Tt.children&&Tt.children.length){var Ce=0;J(Tt.children,function(Ee){Ce+=tt(Ee,Ot+Ce)})}return Rt-Ot}};if(O){var it=h,lt=h+W,ht=Math.PI*2;x.setLayout({angle:ht,startAngle:v,endAngle:v+ht,clockwise:H,cx:u,cy:c,r0:it,r:lt})}tt(w,v)})}function KX(r,t){var e=r.children||[];r.children=ERt(e,t),e.length&&J(r.children,function(i){KX(i,t)})}function ERt(r,t){if(Ve(t)){var e=te(r,function(n,a){var s=n.getValue();return{params:{depth:n.depth,height:n.height,dataIndex:n.dataIndex,getValue:function(){return s}},index:a}});return e.sort(function(n,a){return t(n.params,a.params)}),te(e,function(n){return r[n.index]})}else{var i=t==="asc";return r.sort(function(n,a){var s=(n.getValue()-a.getValue())*(i?1:-1);return s===0?(n.dataIndex-a.dataIndex)*(i?-1:1):s})}}function IRt(r){var t={};function e(i,n,a){for(var s=i;s&&s.depth>1;)s=s.parentNode;var o=n.getColorFromPalette(s.name||s.dataIndex+"",t);return i.depth>1&&ve(o)&&(o=UI(o,(i.depth-1)/(a-1)*.5)),o}r.eachSeriesByType("sunburst",function(i){var n=i.getData(),a=n.tree;a.eachNode(function(s){var o=s.getModel(),l=o.getModel("itemStyle").getItemStyle();l.fill||(l.fill=e(s,i,a.root.height));var u=n.ensureUniqueItemVisual(s.dataIndex,"style");Zt(u,l)})})}function MRt(r){r.registerChartView(SRt),r.registerSeriesModel(ARt),r.registerLayout(nr(CRt,"sunburst")),r.registerProcessor(nr(V_,"sunburst")),r.registerVisual(IRt),bRt(r)}var OV={color:"fill",borderColor:"stroke"},PRt={symbol:1,symbolSize:1,symbolKeepAspect:1,legendIcon:1,visualMeta:1,liftZ:1,decal:1},cu=Ir(),RRt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(){this.currentZLevel=this.get("zlevel",!0),this.currentZ=this.get("z",!0)},t.prototype.getInitialData=function(e,i){return Su(null,this)},t.prototype.getDataParams=function(e,i,n){var a=r.prototype.getDataParams.call(this,e,i);return n&&(a.info=cu(n).info),a},t.type="series.custom",t.dependencies=["grid","polar","geo","singleAxis","calendar"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,clip:!1},t}(Li);const DRt=RRt;function LRt(r,t){return t=t||[0,0],te(["x","y"],function(e,i){var n=this.getAxis(e),a=t[i],s=r[i]/2;return n.type==="category"?n.getBandWidth():Math.abs(n.dataToCoord(a-s)-n.dataToCoord(a+s))},this)}function kRt(r){var t=r.master.getRect();return{coordSys:{type:"cartesian2d",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:function(e){return r.dataToPoint(e)},size:we(LRt,r)}}}function ORt(r,t){return t=t||[0,0],te([0,1],function(e){var i=t[e],n=r[e]/2,a=[],s=[];return a[e]=i-n,s[e]=i+n,a[1-e]=s[1-e]=t[1-e],Math.abs(this.dataToPoint(a)[e]-this.dataToPoint(s)[e])},this)}function NRt(r){var t=r.getBoundingRect();return{coordSys:{type:"geo",x:t.x,y:t.y,width:t.width,height:t.height,zoom:r.getZoom()},api:{coord:function(e){return r.dataToPoint(e)},size:we(ORt,r)}}}function FRt(r,t){var e=this.getAxis(),i=t instanceof Array?t[0]:t,n=(r instanceof Array?r[0]:r)/2;return e.type==="category"?e.getBandWidth():Math.abs(e.dataToCoord(i-n)-e.dataToCoord(i+n))}function BRt(r){var t=r.getRect();return{coordSys:{type:"singleAxis",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:function(e){return r.dataToPoint(e)},size:we(FRt,r)}}}function zRt(r,t){return t=t||[0,0],te(["Radius","Angle"],function(e,i){var n="get"+e+"Axis",a=this[n](),s=t[i],o=r[i]/2,l=a.type==="category"?a.getBandWidth():Math.abs(a.dataToCoord(s-o)-a.dataToCoord(s+o));return e==="Angle"&&(l=l*Math.PI/180),l},this)}function VRt(r){var t=r.getRadiusAxis(),e=r.getAngleAxis(),i=t.getExtent();return i[0]>i[1]&&i.reverse(),{coordSys:{type:"polar",cx:r.cx,cy:r.cy,r:i[1],r0:i[0]},api:{coord:function(n){var a=t.dataToRadius(n[0]),s=e.dataToAngle(n[1]),o=r.coordToPoint([a,s]);return o.push(a,s*Math.PI/180),o},size:we(zRt,r)}}}function URt(r){var t=r.getRect(),e=r.getRangeInfo();return{coordSys:{type:"calendar",x:t.x,y:t.y,width:t.width,height:t.height,cellWidth:r.getCellWidth(),cellHeight:r.getCellHeight(),rangeInfo:{start:e.start,end:e.end,weeks:e.weeks,dayCount:e.allDay}},api:{coord:function(i,n){return r.dataToPoint(i,n)}}}}function JX(r,t,e,i){return r&&(r.legacy||r.legacy!==!1&&!e&&!i&&t!=="tspan"&&(t==="text"||Ae(r,"text")))}function QX(r,t,e){var i=r,n,a,s;if(t==="text")s=i;else{s={},Ae(i,"text")&&(s.text=i.text),Ae(i,"rich")&&(s.rich=i.rich),Ae(i,"textFill")&&(s.fill=i.textFill),Ae(i,"textStroke")&&(s.stroke=i.textStroke),Ae(i,"fontFamily")&&(s.fontFamily=i.fontFamily),Ae(i,"fontSize")&&(s.fontSize=i.fontSize),Ae(i,"fontStyle")&&(s.fontStyle=i.fontStyle),Ae(i,"fontWeight")&&(s.fontWeight=i.fontWeight),a={type:"text",style:s,silent:!0},n={};var o=Ae(i,"textPosition");e?n.position=o?i.textPosition:"inside":o&&(n.position=i.textPosition),Ae(i,"textPosition")&&(n.position=i.textPosition),Ae(i,"textOffset")&&(n.offset=i.textOffset),Ae(i,"textRotation")&&(n.rotation=i.textRotation),Ae(i,"textDistance")&&(n.distance=i.textDistance)}return NV(s,r),J(s.rich,function(l){NV(l,l)}),{textConfig:n,textContent:a}}function NV(r,t){t&&(t.font=t.textFont||t.font,Ae(t,"textStrokeWidth")&&(r.lineWidth=t.textStrokeWidth),Ae(t,"textAlign")&&(r.align=t.textAlign),Ae(t,"textVerticalAlign")&&(r.verticalAlign=t.textVerticalAlign),Ae(t,"textLineHeight")&&(r.lineHeight=t.textLineHeight),Ae(t,"textWidth")&&(r.width=t.textWidth),Ae(t,"textHeight")&&(r.height=t.textHeight),Ae(t,"textBackgroundColor")&&(r.backgroundColor=t.textBackgroundColor),Ae(t,"textPadding")&&(r.padding=t.textPadding),Ae(t,"textBorderColor")&&(r.borderColor=t.textBorderColor),Ae(t,"textBorderWidth")&&(r.borderWidth=t.textBorderWidth),Ae(t,"textBorderRadius")&&(r.borderRadius=t.textBorderRadius),Ae(t,"textBoxShadowColor")&&(r.shadowColor=t.textBoxShadowColor),Ae(t,"textBoxShadowBlur")&&(r.shadowBlur=t.textBoxShadowBlur),Ae(t,"textBoxShadowOffsetX")&&(r.shadowOffsetX=t.textBoxShadowOffsetX),Ae(t,"textBoxShadowOffsetY")&&(r.shadowOffsetY=t.textBoxShadowOffsetY))}function FV(r,t,e){var i=r;i.textPosition=i.textPosition||e.position||"inside",e.offset!=null&&(i.textOffset=e.offset),e.rotation!=null&&(i.textRotation=e.rotation),e.distance!=null&&(i.textDistance=e.distance);var n=i.textPosition.indexOf("inside")>=0,a=r.fill||"#000";BV(i,t);var s=i.textFill==null;return n?s&&(i.textFill=e.insideFill||"#fff",!i.textStroke&&e.insideStroke&&(i.textStroke=e.insideStroke),!i.textStroke&&(i.textStroke=a),i.textStrokeWidth==null&&(i.textStrokeWidth=2)):(s&&(i.textFill=r.fill||e.outsideFill||"#000"),!i.textStroke&&e.outsideStroke&&(i.textStroke=e.outsideStroke)),i.text=t.text,i.rich=t.rich,J(t.rich,function(o){BV(o,o)}),i}function BV(r,t){t&&(Ae(t,"fill")&&(r.textFill=t.fill),Ae(t,"stroke")&&(r.textStroke=t.fill),Ae(t,"lineWidth")&&(r.textStrokeWidth=t.lineWidth),Ae(t,"font")&&(r.font=t.font),Ae(t,"fontStyle")&&(r.fontStyle=t.fontStyle),Ae(t,"fontWeight")&&(r.fontWeight=t.fontWeight),Ae(t,"fontSize")&&(r.fontSize=t.fontSize),Ae(t,"fontFamily")&&(r.fontFamily=t.fontFamily),Ae(t,"align")&&(r.textAlign=t.align),Ae(t,"verticalAlign")&&(r.textVerticalAlign=t.verticalAlign),Ae(t,"lineHeight")&&(r.textLineHeight=t.lineHeight),Ae(t,"width")&&(r.textWidth=t.width),Ae(t,"height")&&(r.textHeight=t.height),Ae(t,"backgroundColor")&&(r.textBackgroundColor=t.backgroundColor),Ae(t,"padding")&&(r.textPadding=t.padding),Ae(t,"borderColor")&&(r.textBorderColor=t.borderColor),Ae(t,"borderWidth")&&(r.textBorderWidth=t.borderWidth),Ae(t,"borderRadius")&&(r.textBorderRadius=t.borderRadius),Ae(t,"shadowColor")&&(r.textBoxShadowColor=t.shadowColor),Ae(t,"shadowBlur")&&(r.textBoxShadowBlur=t.shadowBlur),Ae(t,"shadowOffsetX")&&(r.textBoxShadowOffsetX=t.shadowOffsetX),Ae(t,"shadowOffsetY")&&(r.textBoxShadowOffsetY=t.shadowOffsetY),Ae(t,"textShadowColor")&&(r.textShadowColor=t.textShadowColor),Ae(t,"textShadowBlur")&&(r.textShadowBlur=t.textShadowBlur),Ae(t,"textShadowOffsetX")&&(r.textShadowOffsetX=t.textShadowOffsetX),Ae(t,"textShadowOffsetY")&&(r.textShadowOffsetY=t.textShadowOffsetY))}var tZ={position:["x","y"],scale:["scaleX","scaleY"],origin:["originX","originY"]},zV=br(tZ);bl(Sl,function(r,t){return r[t]=1,r},{});Sl.join(", ");var Aw=["","style","shape","extra"],xg=Ir();function cL(r,t,e,i,n){var a=r+"Animation",s=Dg(r,i,n)||{},o=xg(t).userDuring;return s.duration>0&&(s.during=o?we(jRt,{el:t,userDuring:o}):null,s.setToFinal=!0,s.scope=r),Zt(s,e[a]),s}function ib(r,t,e,i){i=i||{};var n=i.dataIndex,a=i.isInit,s=i.clearStyle,o=e.isAnimationEnabled(),l=xg(r),u=t.style;l.userDuring=t.during;var c={},h={};if(ZRt(r,t,h),UV("shape",t,h),UV("extra",t,h),!a&&o&&(XRt(r,t,c),VV("shape",r,t,c),VV("extra",r,t,c),qRt(r,t,u,c)),h.style=u,$Rt(r,h,s),HRt(r,t),o)if(a){var p={};J(Aw,function(y){var x=y?t[y]:t;x&&x.enterFrom&&(y&&(p[y]=p[y]||{}),Zt(y?p[y]:p,x.enterFrom))});var v=cL("enter",r,t,e,n);v.duration>0&&r.animateFrom(p,v)}else WRt(r,t,n||0,e,c);eZ(r,t),u?r.dirty():r.markRedraw()}function eZ(r,t){for(var e=xg(r).leaveToProps,i=0;i<Aw.length;i++){var n=Aw[i],a=n?t[n]:t;a&&a.leaveTo&&(e||(e=xg(r).leaveToProps={}),n&&(e[n]=e[n]||{}),Zt(n?e[n]:e,a.leaveTo))}}function QS(r,t,e,i){if(r){var n=r.parent,a=xg(r).leaveToProps;if(a){var s=cL("update",r,t,e,0);s.done=function(){n.remove(r),i&&i()},r.animateTo(a,s)}else n.remove(r),i&&i()}}function Lf(r){return r==="all"}function $Rt(r,t,e){var i=t.style;if(!r.isGroup&&i){if(e){r.useStyle({});for(var n=r.animators,a=0;a<n.length;a++){var s=n[a];s.targetName==="style"&&s.changeTarget(r.style)}}r.setStyle(i)}t&&(t.style=null,t&&r.attr(t),t.style=i)}function WRt(r,t,e,i,n){if(n){var a=cL("update",r,t,i,e);a.duration>0&&r.animateFrom(n,a)}}function HRt(r,t){Ae(t,"silent")&&(r.silent=t.silent),Ae(t,"ignore")&&(r.ignore=t.ignore),r instanceof ao&&Ae(t,"invisible")&&(r.invisible=t.invisible),r instanceof vr&&Ae(t,"autoBatch")&&(r.autoBatch=t.autoBatch)}var ll={},GRt={setTransform:function(r,t){return ll.el[r]=t,this},getTransform:function(r){return ll.el[r]},setShape:function(r,t){var e=ll.el,i=e.shape||(e.shape={});return i[r]=t,e.dirtyShape&&e.dirtyShape(),this},getShape:function(r){var t=ll.el.shape;if(t)return t[r]},setStyle:function(r,t){var e=ll.el,i=e.style;return i&&(i[r]=t,e.dirtyStyle&&e.dirtyStyle()),this},getStyle:function(r){var t=ll.el.style;if(t)return t[r]},setExtra:function(r,t){var e=ll.el.extra||(ll.el.extra={});return e[r]=t,this},getExtra:function(r){var t=ll.el.extra;if(t)return t[r]}};function jRt(){var r=this,t=r.el;if(t){var e=xg(t).userDuring,i=r.userDuring;if(e!==i){r.el=r.userDuring=null;return}ll.el=t,i(GRt)}}function VV(r,t,e,i){var n=e[r];if(n){var a=t[r],s;if(a){var o=e.transition,l=n.transition;if(l)if(!s&&(s=i[r]={}),Lf(l))Zt(s,a);else for(var u=ri(l),c=0;c<u.length;c++){var h=u[c],p=a[h];s[h]=p}else if(Lf(o)||pr(o,r)>=0){!s&&(s=i[r]={});for(var v=br(a),c=0;c<v.length;c++){var h=v[c],p=a[h];YRt(n[h],p)&&(s[h]=p)}}}}}function UV(r,t,e){var i=t[r];if(i)for(var n=e[r]={},a=br(i),s=0;s<a.length;s++){var o=a[s];n[o]=ay(i[o])}}function XRt(r,t,e){for(var i=t.transition,n=Lf(i)?Sl:ri(i||[]),a=0;a<n.length;a++){var s=n[a];if(!(s==="style"||s==="shape"||s==="extra")){var o=r[s];e[s]=o}}}function ZRt(r,t,e){for(var i=0;i<zV.length;i++){var n=zV[i],a=tZ[n],s=t[n];s&&(e[a[0]]=s[0],e[a[1]]=s[1])}for(var i=0;i<Sl.length;i++){var o=Sl[i];t[o]!=null&&(e[o]=t[o])}}function qRt(r,t,e,i){if(e){var n=r.style,a;if(n){var s=e.transition,o=t.transition;if(s&&!Lf(s)){var l=ri(s);!a&&(a=i.style={});for(var u=0;u<l.length;u++){var c=l[u],h=n[c];a[c]=h}}else if(r.getAnimationStyleProps&&(Lf(o)||Lf(s)||pr(o,"style")>=0)){var p=r.getAnimationStyleProps(),v=p?p.style:null;if(v){!a&&(a=i.style={});for(var y=br(e),u=0;u<y.length;u++){var c=y[u];if(v[c]){var h=n[c];a[c]=h}}}}}}}function YRt(r,t){return Sa(r)?r!==t:r!=null&&isFinite(r)}var rZ=Ir(),KRt=["percent","easing","shape","style","extra"];function iZ(r){r.stopAnimation("keyframe"),r.attr(rZ(r))}function Cw(r,t,e){if(!(!e.isAnimationEnabled()||!t)){if(Kt(t)){J(t,function(o){Cw(r,o,e)});return}var i=t.keyframes,n=t.duration;if(e&&n==null){var a=Dg("enter",e,0);n=a&&a.duration}if(!(!i||!n)){var s=rZ(r);J(Aw,function(o){if(!(o&&!r[o])){var l;i.sort(function(u,c){return u.percent-c.percent}),J(i,function(u){var c=r.animators,h=o?u[o]:u;if(h){var p=br(h);if(o||(p=ti(p,function(x){return pr(KRt,x)<0})),!!p.length){l||(l=r.animate(o,t.loop,!0),l.scope="keyframe");for(var v=0;v<c.length;v++)c[v]!==l&&c[v].targetName===l.targetName&&c[v].stopTracks(p);o&&(s[o]=s[o]||{});var y=o?s[o]:s;J(p,function(x){y[x]=((o?r[o]:r)||{})[x]}),l.whenWithKeys(n*u.percent,h,p,u.easing)}}}),l&&l.delay(t.delay||0).duration(n).start(t.easing)}})}}}var hu="emphasis",Ec="normal",hL="blur",fL="select",Xc=[Ec,hu,hL,fL],KC={normal:["itemStyle"],emphasis:[hu,"itemStyle"],blur:[hL,"itemStyle"],select:[fL,"itemStyle"]},JC={normal:["label"],emphasis:[hu,"label"],blur:[hL,"label"],select:[fL,"label"]},JRt=["x","y"],QRt="e\0\0",Ws={normal:{},emphasis:{},blur:{},select:{}},tDt={cartesian2d:kRt,geo:NRt,single:BRt,polar:VRt,calendar:URt};function JM(r){return r instanceof vr}function QM(r){return r instanceof ao}function eDt(r,t){t.copyTransform(r),QM(t)&&QM(r)&&(t.setStyle(r.style),t.z=r.z,t.z2=r.z2,t.zlevel=r.zlevel,t.invisible=r.invisible,t.ignore=r.ignore,JM(t)&&JM(r)&&t.setShape(r.shape))}var rDt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n,a){this._progressiveEls=null;var s=this._data,o=e.getData(),l=this.group,u=$V(e,o,i,n);s||l.removeAll(),o.diff(s).add(function(h){QC(n,null,h,u(h,a),e,l,o)}).remove(function(h){var p=s.getItemGraphicEl(h);p&&QS(p,cu(p).option,e)}).update(function(h,p){var v=s.getItemGraphicEl(p);QC(n,v,h,u(h,a),e,l,o)}).execute();var c=e.get("clip",!0)?B_(e.coordinateSystem,!1,e):null;c?l.setClipPath(c):l.removeClipPath(),this._data=o},t.prototype.incrementalPrepareRender=function(e,i,n){this.group.removeAll(),this._data=null},t.prototype.incrementalRender=function(e,i,n,a,s){var o=i.getData(),l=$V(i,o,n,a),u=this._progressiveEls=[];function c(v){v.isGroup||(v.incremental=!0,v.ensureState("emphasis").hoverLayer=!0)}for(var h=e.start;h<e.end;h++){var p=QC(null,null,h,l(h,s),i,this.group,o);p&&(p.traverse(c),u.push(p))}},t.prototype.eachRendered=function(e){Kc(this._progressiveEls||this.group,e)},t.prototype.filterForExposedEvent=function(e,i,n,a){var s=i.element;if(s==null||n.name===s)return!0;for(;(n=n.__hostTarget||n.parent)&&n!==this.group;)if(n.name===s)return!0;return!1},t.type="custom",t}(di);const iDt=rDt;function dL(r){var t=r.type,e;if(t==="path"){var i=r.shape,n=i.width!=null&&i.height!=null?{x:i.x||0,y:i.y||0,width:i.width,height:i.height}:null,a=sZ(i);e=MS(a,null,n,i.layout||"center"),cu(e).customPathData=a}else if(t==="image")e=new ia({}),cu(e).customImagePath=r.style.image;else if(t==="text")e=new Nr({});else if(t==="group")e=new Ke;else{if(t==="compoundPath")throw new Error('"compoundPath" is not supported yet.');var s=eD(t);if(!s){var o="";jr(o)}e=new s}return cu(e).customGraphicType=t,e.name=r.name,e.z2EmphasisLift=1,e.z2SelectLift=1,e}function pL(r,t,e,i,n,a,s){iZ(t);var o=n&&n.normal.cfg;o&&t.setTextConfig(o),i&&i.transition==null&&(i.transition=JRt);var l=i&&i.style;if(l){if(t.type==="text"){var u=l;Ae(u,"textFill")&&(u.fill=u.textFill),Ae(u,"textStroke")&&(u.stroke=u.textStroke)}var c=void 0,h=JM(t)?l.decal:null;r&&h&&(h.dirty=!0,c=gg(h,r)),l.__decalPattern=c}if(QM(t)&&l){var c=l.__decalPattern;c&&(l.decal=c)}ib(t,i,a,{dataIndex:e,isInit:s,clearStyle:!0}),Cw(t,i.keyframeAnimation,a)}function nZ(r,t,e,i,n){var a=t.isGroup?null:t,s=n&&n[r].cfg;if(a){var o=a.ensureState(r);if(i===!1){var l=a.getState(r);l&&(l.style=null)}else o.style=i||null;s&&(o.textConfig=s),Gf(a)}}function nDt(r,t,e){if(!r.isGroup){var i=r,n=e.currentZ,a=e.currentZLevel;i.z=n,i.zlevel=a;var s=t.z2;s!=null&&(i.z2=s||0);for(var o=0;o<Xc.length;o++)aDt(i,t,Xc[o])}}function aDt(r,t,e){var i=e===Ec,n=i?t:Ew(t,e),a=n?n.z2:null,s;a!=null&&(s=i?r:r.ensureState(e),s.z2=a||0)}function $V(r,t,e,i){var n=r.get("renderItem"),a=r.coordinateSystem,s={};a&&(s=a.prepareCustoms?a.prepareCustoms(a):tDt[a.type](a));for(var o=We({getWidth:i.getWidth,getHeight:i.getHeight,getZr:i.getZr,getDevicePixelRatio:i.getDevicePixelRatio,value:L,style:O,ordinalRawValue:F,styleEmphasis:U,visual:j,barLayout:Y,currentSeriesIndices:tt,font:it},s.api||{}),l={context:{},seriesId:r.id,seriesName:r.name,seriesIndex:r.seriesIndex,coordSys:s.coordSys,dataInsideLength:t.count(),encode:sDt(r.getData())},u,c,h={},p={},v={},y={},x=0;x<Xc.length;x++){var w=Xc[x];v[w]=r.getModel(KC[w]),y[w]=r.getModel(JC[w])}function T(lt){return lt===u?c||(c=t.getItemModel(lt)):t.getItemModel(lt)}function E(lt,ht){return t.hasItemOption?lt===u?h[ht]||(h[ht]=T(lt).getModel(KC[ht])):T(lt).getModel(KC[ht]):v[ht]}function M(lt,ht){return t.hasItemOption?lt===u?p[ht]||(p[ht]=T(lt).getModel(JC[ht])):T(lt).getModel(JC[ht]):y[ht]}return function(lt,ht){return u=lt,c=null,h={},p={},n&&n(We({dataIndexInside:lt,dataIndex:t.getRawIndex(lt),actionType:ht?ht.type:null},l),o)};function L(lt,ht){return ht==null&&(ht=u),t.getStore().get(t.getDimensionIndex(lt||0),ht)}function F(lt,ht){ht==null&&(ht=u),lt=lt||0;var Tt=t.getDimensionInfo(lt);if(!Tt){var Ot=t.getDimensionIndex(lt);return Ot>=0?t.getStore().get(Ot,ht):void 0}var Rt=t.get(Tt.name,ht),Ut=Tt&&Tt.ordinalMeta;return Ut?Ut.categories[Rt]:Rt}function O(lt,ht){ht==null&&(ht=u);var Tt=t.getItemVisual(ht,"style"),Ot=Tt&&Tt.fill,Rt=Tt&&Tt.opacity,Ut=E(ht,Ec).getItemStyle();Ot!=null&&(Ut.fill=Ot),Rt!=null&&(Ut.opacity=Rt);var Jt={inheritColor:ve(Ot)?Ot:"#000"},ne=M(ht,Ec),se=hi(ne,null,Jt,!1,!0);se.text=ne.getShallow("show")?ir(r.getFormattedLabel(ht,Ec),mg(t,ht)):null;var ce=rw(ne,Jt,!1);return H(lt,Ut),Ut=FV(Ut,se,ce),lt&&W(Ut,lt),Ut.legacy=!0,Ut}function U(lt,ht){ht==null&&(ht=u);var Tt=E(ht,hu).getItemStyle(),Ot=M(ht,hu),Rt=hi(Ot,null,null,!0,!0);Rt.text=Ot.getShallow("show")?_l(r.getFormattedLabel(ht,hu),r.getFormattedLabel(ht,Ec),mg(t,ht)):null;var Ut=rw(Ot,null,!0);return H(lt,Tt),Tt=FV(Tt,Rt,Ut),lt&&W(Tt,lt),Tt.legacy=!0,Tt}function W(lt,ht){for(var Tt in ht)Ae(ht,Tt)&&(lt[Tt]=ht[Tt])}function H(lt,ht){lt&&(lt.textFill&&(ht.textFill=lt.textFill),lt.textPosition&&(ht.textPosition=lt.textPosition))}function j(lt,ht){if(ht==null&&(ht=u),Ae(OV,lt)){var Tt=t.getItemVisual(ht,"style");return Tt?Tt[OV[lt]]:null}if(Ae(PRt,lt))return t.getItemVisual(ht,lt)}function Y(lt){if(a.type==="cartesian2d"){var ht=a.getBaseAxis();return swt(We({axis:ht},lt))}}function tt(){return e.getCurrentSeriesIndices()}function it(lt){return rD(lt,e)}}function sDt(r){var t={};return J(r.dimensions,function(e){var i=r.getDimensionInfo(e);if(!i.isExtraCoord){var n=i.coordDim,a=t[n]=t[n]||[];a[i.coordDimIndex]=r.getDimensionIndex(e)}}),t}function QC(r,t,e,i,n,a,s){if(!i){a.remove(t);return}var o=gL(r,t,e,i,n,a);return o&&s.setItemGraphicEl(e,o),o&&Ui(o,i.focus,i.blurScope,i.emphasisDisabled),o}function gL(r,t,e,i,n,a){var s=-1,o=t;t&&aZ(t,i,n)&&(s=pr(a.childrenRef(),t),t=null);var l=!t,u=t;u?u.clearStates():(u=dL(i),o&&eDt(o,u)),i.morph===!1?u.disableMorphing=!0:u.disableMorphing&&(u.disableMorphing=!1),Ws.normal.cfg=Ws.normal.conOpt=Ws.emphasis.cfg=Ws.emphasis.conOpt=Ws.blur.cfg=Ws.blur.conOpt=Ws.select.cfg=Ws.select.conOpt=null,Ws.isLegacy=!1,lDt(u,e,i,n,l,Ws),oDt(u,e,i,n,l),pL(r,u,e,i,Ws,n,l),Ae(i,"info")&&(cu(u).info=i.info);for(var c=0;c<Xc.length;c++){var h=Xc[c];if(h!==Ec){var p=Ew(i,h),v=vL(i,p,h);nZ(h,u,p,v,Ws)}}return nDt(u,i,n),i.type==="group"&&uDt(r,u,e,i,n),s>=0?a.replaceAt(u,s):a.add(u),u}function aZ(r,t,e){var i=cu(r),n=t.type,a=t.shape,s=t.style;return e.isUniversalTransitionEnabled()||n!=null&&n!==i.customGraphicType||n==="path"&&dDt(a)&&sZ(a)!==i.customPathData||n==="image"&&Ae(s,"image")&&s.image!==i.customImagePath}function oDt(r,t,e,i,n){var a=e.clipPath;if(a===!1)r&&r.getClipPath()&&r.removeClipPath();else if(a){var s=r.getClipPath();s&&aZ(s,a,i)&&(s=null),s||(s=dL(a),r.setClipPath(s)),pL(null,s,t,a,null,i,n)}}function lDt(r,t,e,i,n,a){if(!r.isGroup){WV(e,null,a),WV(e,hu,a);var s=a.normal.conOpt,o=a.emphasis.conOpt,l=a.blur.conOpt,u=a.select.conOpt;if(s!=null||o!=null||u!=null||l!=null){var c=r.getTextContent();if(s===!1)c&&r.removeTextContent();else{s=a.normal.conOpt=s||{type:"text"},c?c.clearStates():(c=dL(s),r.setTextContent(c)),pL(null,c,t,s,null,i,n);for(var h=s&&s.style,p=0;p<Xc.length;p++){var v=Xc[p];if(v!==Ec){var y=a[v].conOpt;nZ(v,c,y,vL(s,y,v),null)}}h?c.dirty():c.markRedraw()}}}}function WV(r,t,e){var i=t?Ew(r,t):r,n=t?vL(r,i,hu):r.style,a=r.type,s=i?i.textConfig:null,o=r.textContent,l=o?t?Ew(o,t):o:null;if(n&&(e.isLegacy||JX(n,a,!!s,!!l))){e.isLegacy=!0;var u=QX(n,a,!t);!s&&u.textConfig&&(s=u.textConfig),!l&&u.textContent&&(l=u.textContent)}if(!t&&l){var c=l;!c.type&&(c.type="text")}var h=t?e[t]:e.normal;h.cfg=s,h.conOpt=l}function Ew(r,t){return t?r?r[t]:null:r}function vL(r,t,e){var i=t&&t.style;return i==null&&e===hu&&r&&(i=r.styleEmphasis),i}function uDt(r,t,e,i,n){var a=i.children,s=a?a.length:0,o=i.$mergeChildren,l=o==="byName"||i.diffChildrenByName,u=o===!1;if(!(!s&&!l&&!u)){if(l){hDt({api:r,oldChildren:t.children()||[],newChildren:a||[],dataIndex:e,seriesModel:n,group:t});return}u&&t.removeAll();for(var c=0;c<s;c++){var h=a[c],p=t.childAt(c);h?(h.ignore==null&&(h.ignore=!1),gL(r,p,e,h,n,t)):p.ignore=!0}for(var v=t.childCount()-1;v>=c;v--){var y=t.childAt(v);cDt(t,y,n)}}}function cDt(r,t,e){t&&QS(t,cu(r).option,e)}function hDt(r){new yu(r.oldChildren,r.newChildren,HV,HV,r).add(GV).update(GV).remove(fDt).execute()}function HV(r,t){var e=r&&r.name;return e??QRt+t}function GV(r,t){var e=this.context,i=r!=null?e.newChildren[r]:null,n=t!=null?e.oldChildren[t]:null;gL(e.api,n,e.dataIndex,i,e.seriesModel,e.group)}function fDt(r){var t=this.context,e=t.oldChildren[r];e&&QS(e,cu(e).option,t.seriesModel)}function sZ(r){return r&&(r.pathData||r.d)}function dDt(r){return r&&(Ae(r,"pathData")||Ae(r,"d"))}function pDt(r){r.registerChartView(iDt),r.registerSeriesModel(DRt)}var sf=Ir(),jV=Ze,tE=we,gDt=function(){function r(){this._dragging=!1,this.animationThreshold=15}return r.prototype.render=function(t,e,i,n){var a=e.get("value"),s=e.get("status");if(this._axisModel=t,this._axisPointerModel=e,this._api=i,!(!n&&this._lastValue===a&&this._lastStatus===s)){this._lastValue=a,this._lastStatus=s;var o=this._group,l=this._handle;if(!s||s==="hide"){o&&o.hide(),l&&l.hide();return}o&&o.show(),l&&l.show();var u={};this.makeElOption(u,a,t,e,i);var c=u.graphicKey;c!==this._lastGraphicKey&&this.clear(i),this._lastGraphicKey=c;var h=this._moveAnimation=this.determineAnimation(t,e);if(!o)o=this._group=new Ke,this.createPointerEl(o,u,t,e),this.createLabelEl(o,u,t,e),i.getZr().add(o);else{var p=nr(XV,e,h);this.updatePointerEl(o,u,p),this.updateLabelEl(o,u,p,e)}qV(o,e,!0),this._renderHandle(a)}},r.prototype.remove=function(t){this.clear(t)},r.prototype.dispose=function(t){this.clear(t)},r.prototype.determineAnimation=function(t,e){var i=e.get("animation"),n=t.axis,a=n.type==="category",s=e.get("snap");if(!s&&!a)return!1;if(i==="auto"||i==null){var o=this.animationThreshold;if(a&&n.getBandWidth()>o)return!0;if(s){var l=VD(t).seriesDataCount,u=n.getExtent();return Math.abs(u[0]-u[1])/l>o}return!1}return i===!0},r.prototype.makeElOption=function(t,e,i,n,a){},r.prototype.createPointerEl=function(t,e,i,n){var a=e.pointer;if(a){var s=sf(t).pointerEl=new ed[a.type](jV(e.pointer));t.add(s)}},r.prototype.createLabelEl=function(t,e,i,n){if(e.label){var a=sf(t).labelEl=new Nr(jV(e.label));t.add(a),ZV(a,n)}},r.prototype.updatePointerEl=function(t,e,i){var n=sf(t).pointerEl;n&&e.pointer&&(n.setStyle(e.pointer.style),i(n,{shape:e.pointer.shape}))},r.prototype.updateLabelEl=function(t,e,i,n){var a=sf(t).labelEl;a&&(a.setStyle(e.label.style),i(a,{x:e.label.x,y:e.label.y}),ZV(a,n))},r.prototype._renderHandle=function(t){if(!(this._dragging||!this.updateHandleTransform)){var e=this._axisPointerModel,i=this._api.getZr(),n=this._handle,a=e.getModel("handle"),s=e.get("status");if(!a.get("show")||!s||s==="hide"){n&&i.remove(n),this._handle=null;return}var o;this._handle||(o=!0,n=this._handle=R_(a.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(u){pu(u.event)},onmousedown:tE(this._onHandleDragMove,this,0,0),drift:tE(this._onHandleDragMove,this),ondragend:tE(this._onHandleDragEnd,this)}),i.add(n)),qV(n,e,!1),n.setStyle(a.getItemStyle(null,["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]));var l=a.get("size");Kt(l)||(l=[l,l]),n.scaleX=l[0]/2,n.scaleY=l[1]/2,Ug(this,"_doDispatchAxisPointer",a.get("throttle")||0,"fixRate"),this._moveHandleToValue(t,o)}},r.prototype._moveHandleToValue=function(t,e){XV(this._axisPointerModel,!e&&this._moveAnimation,this._handle,eE(this.getHandleTransform(t,this._axisModel,this._axisPointerModel)))},r.prototype._onHandleDragMove=function(t,e){var i=this._handle;if(i){this._dragging=!0;var n=this.updateHandleTransform(eE(i),[t,e],this._axisModel,this._axisPointerModel);this._payloadInfo=n,i.stopAnimation(),i.attr(eE(n)),sf(i).lastProp=null,this._doDispatchAxisPointer()}},r.prototype._doDispatchAxisPointer=function(){var t=this._handle;if(t){var e=this._payloadInfo,i=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:e.cursorPoint[0],y:e.cursorPoint[1],tooltipOption:e.tooltipOption,axesInfo:[{axisDim:i.axis.dim,axisIndex:i.componentIndex}]})}},r.prototype._onHandleDragEnd=function(){this._dragging=!1;var t=this._handle;if(t){var e=this._axisPointerModel.get("value");this._moveHandleToValue(e),this._api.dispatchAction({type:"hideTip"})}},r.prototype.clear=function(t){this._lastValue=null,this._lastStatus=null;var e=t.getZr(),i=this._group,n=this._handle;e&&i&&(this._lastGraphicKey=null,i&&e.remove(i),n&&e.remove(n),this._group=null,this._handle=null,this._payloadInfo=null),Jy(this,"_doDispatchAxisPointer")},r.prototype.doClear=function(){},r.prototype.buildLabel=function(t,e,i){return i=i||0,{x:t[i],y:t[1-i],width:e[i],height:e[1-i]}},r}();function XV(r,t,e,i){oZ(sf(e).lastProp,i)||(sf(e).lastProp=i,t?zr(e,i,r):(e.stopAnimation(),e.attr(i)))}function oZ(r,t){if(je(r)&&je(t)){var e=!0;return J(t,function(i,n){e=e&&oZ(r[n],i)}),!!e}else return r===t}function ZV(r,t){r[t.get(["label","show"])?"show":"hide"]()}function eE(r){return{x:r.x||0,y:r.y||0,rotation:r.rotation||0}}function qV(r,t,e){var i=t.get("z"),n=t.get("zlevel");r&&r.traverse(function(a){a.type!=="group"&&(i!=null&&(a.z=i),n!=null&&(a.zlevel=n),a.silent=e)})}const mL=gDt;function yL(r){var t=r.get("type"),e=r.getModel(t+"Style"),i;return t==="line"?(i=e.getLineStyle(),i.fill=null):t==="shadow"&&(i=e.getAreaStyle(),i.stroke=null),i}function lZ(r,t,e,i,n){var a=e.get("value"),s=uZ(a,t.axis,t.ecModel,e.get("seriesDataIndices"),{precision:e.get(["label","precision"]),formatter:e.get(["label","formatter"])}),o=e.getModel("label"),l=Ng(o.get("padding")||0),u=o.getFont(),c=C_(s,u),h=n.position,p=c.width+l[1]+l[3],v=c.height+l[0]+l[2],y=n.align;y==="right"&&(h[0]-=p),y==="center"&&(h[0]-=p/2);var x=n.verticalAlign;x==="bottom"&&(h[1]-=v),x==="middle"&&(h[1]-=v/2),vDt(h,p,v,i);var w=o.get("backgroundColor");(!w||w==="auto")&&(w=t.get(["axisLine","lineStyle","color"])),r.label={x:h[0],y:h[1],style:hi(o,{text:s,font:u,fill:o.getTextColor(),padding:l,backgroundColor:w}),z2:10}}function vDt(r,t,e,i){var n=i.getWidth(),a=i.getHeight();r[0]=Math.min(r[0]+t,n)-t,r[1]=Math.min(r[1]+e,a)-e,r[0]=Math.max(r[0],0),r[1]=Math.max(r[1],0)}function uZ(r,t,e,i,n){r=t.scale.parse(r);var a=t.scale.getLabel({value:r},{precision:n.precision}),s=n.formatter;if(s){var o={value:PD(t,{value:r}),axisDimension:t.dim,axisIndex:t.index,seriesData:[]};J(i,function(l){var u=e.getSeriesByIndex(l.seriesIndex),c=l.dataIndexInside,h=u&&u.getDataParams(c);h&&o.seriesData.push(h)}),ve(s)?a=s.replace("{value}",a):Ve(s)&&(a=s(o))}return a}function _L(r,t,e){var i=Es();return td(i,i,e.rotation),wl(i,i,e.position),Fo([r.dataToCoord(t),(e.labelOffset||0)+(e.labelDirection||1)*(e.labelMargin||0)],i)}function cZ(r,t,e,i,n,a){var s=_u.innerTextLayout(e.rotation,0,e.labelDirection);e.labelMargin=n.get(["label","margin"]),lZ(t,i,n,a,{position:_L(i.axis,r,e),align:s.textAlign,verticalAlign:s.textVerticalAlign})}function xL(r,t,e){return e=e||0,{x1:r[e],y1:r[1-e],x2:t[e],y2:t[1-e]}}function hZ(r,t,e){return e=e||0,{x:r[e],y:r[1-e],width:t[e],height:t[1-e]}}function YV(r,t,e,i,n,a){return{cx:r,cy:t,r0:e,r:i,startAngle:n,endAngle:a,clockwise:!0}}var mDt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.makeElOption=function(e,i,n,a,s){var o=n.axis,l=o.grid,u=a.get("type"),c=KV(l,o).getOtherAxis(o).getGlobalExtent(),h=o.toGlobalCoord(o.dataToCoord(i,!0));if(u&&u!=="none"){var p=yL(a),v=yDt[u](o,h,c);v.style=p,e.graphicKey=v.type,e.pointer=v}var y=OM(l.model,n);cZ(i,e,y,n,a,s)},t.prototype.getHandleTransform=function(e,i,n){var a=OM(i.axis.grid.model,i,{labelInside:!1});a.labelMargin=n.get(["handle","margin"]);var s=_L(i.axis,e,a);return{x:s[0],y:s[1],rotation:a.rotation+(a.labelDirection<0?Math.PI:0)}},t.prototype.updateHandleTransform=function(e,i,n,a){var s=n.axis,o=s.grid,l=s.getGlobalExtent(!0),u=KV(o,s).getOtherAxis(s).getGlobalExtent(),c=s.dim==="x"?0:1,h=[e.x,e.y];h[c]+=i[c],h[c]=Math.min(l[1],h[c]),h[c]=Math.max(l[0],h[c]);var p=(u[1]+u[0])/2,v=[p,p];v[c]=h[c];var y=[{verticalAlign:"middle"},{align:"center"}];return{x:h[0],y:h[1],rotation:e.rotation,cursorPoint:v,tooltipOption:y[c]}},t}(mL);function KV(r,t){var e={};return e[t.dim+"AxisIndex"]=t.index,r.getCartesian(e)}var yDt={line:function(r,t,e){var i=xL([t,e[0]],[t,e[1]],JV(r));return{type:"Line",subPixelOptimize:!0,shape:i}},shadow:function(r,t,e){var i=Math.max(1,r.getBandWidth()),n=e[1]-e[0];return{type:"Rect",shape:hZ([t-i/2,e[0]],[i,n],JV(r))}}};function JV(r){return r.dim==="x"?0:1}const _Dt=mDt;var xDt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="axisPointer",t.defaultOption={show:"auto",z:50,type:"line",snap:!1,triggerTooltip:!0,triggerEmphasis:!0,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:"#B9BEC9",width:1,type:"dashed"},shadowStyle:{color:"rgba(210,219,238,0.2)"},label:{show:!0,formatter:null,precision:"auto",margin:3,color:"#fff",padding:[5,7,5,7],backgroundColor:"auto",borderColor:null,borderWidth:0,borderRadius:3},handle:{show:!1,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:"#333",shadowBlur:3,shadowColor:"#aaa",shadowOffsetX:0,shadowOffsetY:2,throttle:40}},t}(kr);const bDt=xDt;var iu=Ir(),wDt=J;function fZ(r,t,e){if(!Or.node){var i=t.getZr();iu(i).records||(iu(i).records={}),SDt(i,t);var n=iu(i).records[r]||(iu(i).records[r]={});n.handler=e}}function SDt(r,t){if(iu(r).initialized)return;iu(r).initialized=!0,e("click",nr(QV,"click")),e("mousemove",nr(QV,"mousemove")),e("globalout",ADt);function e(i,n){r.on(i,function(a){var s=CDt(t);wDt(iu(r).records,function(o){o&&n(o,a,s.dispatchAction)}),TDt(s.pendings,t)})}}function TDt(r,t){var e=r.showTip.length,i=r.hideTip.length,n;e?n=r.showTip[e-1]:i&&(n=r.hideTip[i-1]),n&&(n.dispatchAction=null,t.dispatchAction(n))}function ADt(r,t,e){r.handler("leave",null,e)}function QV(r,t,e,i){t.handler(r,e,i)}function CDt(r){var t={showTip:[],hideTip:[]},e=function(i){var n=t[i.type];n?n.push(i):(i.dispatchAction=e,r.dispatchAction(i))};return{dispatchAction:e,pendings:t}}function tP(r,t){if(!Or.node){var e=t.getZr(),i=(iu(e).records||{})[r];i&&(iu(e).records[r]=null)}}var EDt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){var a=i.getComponent("tooltip"),s=e.get("triggerOn")||a&&a.get("triggerOn")||"mousemove|click";fZ("axisPointer",n,function(o,l,u){s!=="none"&&(o==="leave"||s.indexOf(o)>=0)&&u({type:"updateAxisPointer",currTrigger:o,x:l&&l.offsetX,y:l&&l.offsetY})})},t.prototype.remove=function(e,i){tP("axisPointer",i)},t.prototype.dispose=function(e,i){tP("axisPointer",i)},t.type="axisPointer",t}($i);const IDt=EDt;function dZ(r,t){var e=[],i=r.seriesIndex,n;if(i==null||!(n=t.getSeriesByIndex(i)))return{point:[]};var a=n.getData(),s=Wf(a,r);if(s==null||s<0||Kt(s))return{point:[]};var o=a.getItemGraphicEl(s),l=n.coordinateSystem;if(n.getTooltipPosition)e=n.getTooltipPosition(s)||[];else if(l&&l.dataToPoint)if(r.isStacked){var u=l.getBaseAxis(),c=l.getOtherAxis(u),h=c.dim,p=u.dim,v=h==="x"||h==="radius"?1:0,y=a.mapDimension(p),x=[];x[v]=a.get(y,s),x[1-v]=a.get(a.getCalculationInfo("stackResultDimension"),s),e=l.dataToPoint(x)||[]}else e=l.dataToPoint(a.getValues(te(l.dimensions,function(T){return a.mapDimension(T)}),s))||[];else if(o){var w=o.getBoundingRect().clone();w.applyTransform(o.transform),e=[w.x+w.width/2,w.y+w.height/2]}return{point:e,el:o}}var t6=Ir();function MDt(r,t,e){var i=r.currTrigger,n=[r.x,r.y],a=r,s=r.dispatchAction||we(e.dispatchAction,e),o=t.getComponent("axisPointer").coordSysAxesInfo;if(o){nb(n)&&(n=dZ({seriesIndex:a.seriesIndex,dataIndex:a.dataIndex},t).point);var l=nb(n),u=a.axesInfo,c=o.axesInfo,h=i==="leave"||nb(n),p={},v={},y={list:[],map:{}},x={showPointer:nr(RDt,v),showTooltip:nr(DDt,y)};J(o.coordSysMap,function(T,E){var M=l||T.containPoint(n);J(o.coordSysAxesInfo[E],function(L,F){var O=L.axis,U=NDt(u,L);if(!h&&M&&(!u||U)){var W=U&&U.value;W==null&&!l&&(W=O.pointToData(n)),W!=null&&e6(L,W,x,!1,p)}})});var w={};return J(c,function(T,E){var M=T.linkGroup;M&&!v[E]&&J(M.axesInfo,function(L,F){var O=v[F];if(L!==T&&O){var U=O.value;M.mapper&&(U=T.axis.scale.parse(M.mapper(U,r6(L),r6(T)))),w[T.key]=U}})}),J(w,function(T,E){e6(c[E],T,x,!0,p)}),LDt(v,c,p),kDt(y,n,r,s),ODt(c,s,e),p}}function e6(r,t,e,i,n){var a=r.axis;if(!(a.scale.isBlank()||!a.containData(t))){if(!r.involveSeries){e.showPointer(r,t);return}var s=PDt(t,r),o=s.payloadBatch,l=s.snapToValue;o[0]&&n.seriesIndex==null&&Zt(n,o[0]),!i&&r.snap&&a.containData(l)&&l!=null&&(t=l),e.showPointer(r,t,o),e.showTooltip(r,s,l)}}function PDt(r,t){var e=t.axis,i=e.dim,n=r,a=[],s=Number.MAX_VALUE,o=-1;return J(t.seriesModels,function(l,u){var c=l.getData().mapDimensionsAll(i),h,p;if(l.getAxisTooltipData){var v=l.getAxisTooltipData(c,r,e);p=v.dataIndices,h=v.nestestValue}else{if(p=l.getData().indicesOfNearest(c[0],r,e.type==="category"?.5:null),!p.length)return;h=l.getData().get(c[0],p[0])}if(!(h==null||!isFinite(h))){var y=r-h,x=Math.abs(y);x<=s&&((x<s||y>=0&&o<0)&&(s=x,o=y,n=h,a.length=0),J(p,function(w){a.push({seriesIndex:l.seriesIndex,dataIndexInside:w,dataIndex:l.getData().getRawIndex(w)})}))}}),{payloadBatch:a,snapToValue:n}}function RDt(r,t,e,i){r[t.key]={value:e,payloadBatch:i}}function DDt(r,t,e,i){var n=e.payloadBatch,a=t.axis,s=a.model,o=t.axisPointerModel;if(!(!t.triggerTooltip||!n.length)){var l=t.coordSys.model,u=n_(l),c=r.map[u];c||(c=r.map[u]={coordSysId:l.id,coordSysIndex:l.componentIndex,coordSysType:l.type,coordSysMainType:l.mainType,dataByAxis:[]},r.list.push(c)),c.dataByAxis.push({axisDim:a.dim,axisIndex:s.componentIndex,axisType:s.type,axisId:s.id,value:i,valueLabelOpt:{precision:o.get(["label","precision"]),formatter:o.get(["label","formatter"])},seriesDataIndices:n.slice()})}}function LDt(r,t,e){var i=e.axesInfo=[];J(t,function(n,a){var s=n.axisPointerModel.option,o=r[a];o?(!n.useHandle&&(s.status="show"),s.value=o.value,s.seriesDataIndices=(o.payloadBatch||[]).slice()):!n.useHandle&&(s.status="hide"),s.status==="show"&&i.push({axisDim:n.axis.dim,axisIndex:n.axis.model.componentIndex,value:s.value})})}function kDt(r,t,e,i){if(nb(t)||!r.list.length){i({type:"hideTip"});return}var n=((r.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};i({type:"showTip",escapeConnect:!0,x:t[0],y:t[1],tooltipOption:e.tooltipOption,position:e.position,dataIndexInside:n.dataIndexInside,dataIndex:n.dataIndex,seriesIndex:n.seriesIndex,dataByCoordSys:r.list})}function ODt(r,t,e){var i=e.getZr(),n="axisPointerLastHighlights",a=t6(i)[n]||{},s=t6(i)[n]={};J(r,function(u,c){var h=u.axisPointerModel.option;h.status==="show"&&u.triggerEmphasis&&J(h.seriesDataIndices,function(p){var v=p.seriesIndex+" | "+p.dataIndex;s[v]=p})});var o=[],l=[];J(a,function(u,c){!s[c]&&l.push(u)}),J(s,function(u,c){!a[c]&&o.push(u)}),l.length&&e.dispatchAction({type:"downplay",escapeConnect:!0,notBlur:!0,batch:l}),o.length&&e.dispatchAction({type:"highlight",escapeConnect:!0,notBlur:!0,batch:o})}function NDt(r,t){for(var e=0;e<(r||[]).length;e++){var i=r[e];if(t.axis.dim===i.axisDim&&t.axis.model.componentIndex===i.axisIndex)return i}}function r6(r){var t=r.axis.model,e={},i=e.axisDim=r.axis.dim;return e.axisIndex=e[i+"AxisIndex"]=t.componentIndex,e.axisName=e[i+"AxisName"]=t.name,e.axisId=e[i+"AxisId"]=t.id,e}function nb(r){return!r||r[0]==null||isNaN(r[0])||r[1]==null||isNaN(r[1])}function H_(r){sd.registerAxisPointerClass("CartesianAxisPointer",_Dt),r.registerComponentModel(bDt),r.registerComponentView(IDt),r.registerPreprocessor(function(t){if(t){(!t.axisPointer||t.axisPointer.length===0)&&(t.axisPointer={});var e=t.axisPointer.link;e&&!Kt(e)&&(t.axisPointer.link=[e])}}),r.registerProcessor(r.PRIORITY.PROCESSOR.STATISTIC,function(t,e){t.getComponent("axisPointer").coordSysAxesInfo=SAt(t,e)}),r.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},MDt)}function FDt(r){gr(zj),gr(H_)}var BDt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.makeElOption=function(e,i,n,a,s){var o=n.axis;o.dim==="angle"&&(this.animationThreshold=Math.PI/18);var l=o.polar,u=l.getOtherAxis(o),c=u.getExtent(),h=o.dataToCoord(i),p=a.get("type");if(p&&p!=="none"){var v=yL(a),y=VDt[p](o,l,h,c);y.style=v,e.graphicKey=y.type,e.pointer=y}var x=a.get(["label","margin"]),w=zDt(i,n,a,l,x);lZ(e,n,a,s,w)},t}(mL);function zDt(r,t,e,i,n){var a=t.axis,s=a.dataToCoord(r),o=i.getAngleAxis().getExtent()[0];o=o/180*Math.PI;var l=i.getRadiusAxis().getExtent(),u,c,h;if(a.dim==="radius"){var p=Es();td(p,p,o),wl(p,p,[i.cx,i.cy]),u=Fo([s,-n],p);var v=t.getModel("axisLabel").get("rotate")||0,y=_u.innerTextLayout(o,v*Math.PI/180,-1);c=y.textAlign,h=y.textVerticalAlign}else{var x=l[1];u=i.coordToPoint([x+n,s]);var w=i.cx,T=i.cy;c=Math.abs(u[0]-w)/x<.3?"center":u[0]>w?"left":"right",h=Math.abs(u[1]-T)/x<.3?"middle":u[1]>T?"top":"bottom"}return{position:u,align:c,verticalAlign:h}}var VDt={line:function(r,t,e,i){return r.dim==="angle"?{type:"Line",shape:xL(t.coordToPoint([i[0],e]),t.coordToPoint([i[1],e]))}:{type:"Circle",shape:{cx:t.cx,cy:t.cy,r:e}}},shadow:function(r,t,e,i){var n=Math.max(1,r.getBandWidth()),a=Math.PI/180;return r.dim==="angle"?{type:"Sector",shape:YV(t.cx,t.cy,i[0],i[1],(-e-n/2)*a,(-e+n/2)*a)}:{type:"Sector",shape:YV(t.cx,t.cy,e-n/2,e+n/2,0,Math.PI*2)}}};const UDt=BDt;var $Dt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.findAxisModel=function(e){var i,n=this.ecModel;return n.eachComponent(e,function(a){a.getCoordSysModel()===this&&(i=a)},this),i},t.type="polar",t.dependencies=["radiusAxis","angleAxis"],t.defaultOption={z:0,center:["50%","50%"],radius:"80%"},t}(kr);const WDt=$Dt;var bL=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getCoordSysModel=function(){return this.getReferringComponents("polar",vn).models[0]},t.type="polarAxis",t}(kr);yn(bL,O_);var HDt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="angleAxis",t}(bL),GDt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="radiusAxis",t}(bL),wL=function(r){Vt(t,r);function t(e,i){return r.call(this,"radius",e,i)||this}return t.prototype.pointToData=function(e,i){return this.polar.pointToData(e,i)[this.dim==="radius"?0:1]},t}($o);wL.prototype.dataToRadius=$o.prototype.dataToCoord;wL.prototype.radiusToData=$o.prototype.coordToData;const jDt=wL;var XDt=Ir(),SL=function(r){Vt(t,r);function t(e,i){return r.call(this,"angle",e,i||[0,360])||this}return t.prototype.pointToData=function(e,i){return this.polar.pointToData(e,i)[this.dim==="radius"?0:1]},t.prototype.calculateCategoryInterval=function(){var e=this,i=e.getLabelModel(),n=e.scale,a=n.getExtent(),s=n.count();if(a[1]-a[0]<1)return 0;var o=a[0],l=e.dataToCoord(o+1)-e.dataToCoord(o),u=Math.abs(l),c=C_(o==null?"":o+"",i.getFont(),"center","top"),h=Math.max(c.height,7),p=h/u;isNaN(p)&&(p=1/0);var v=Math.max(0,Math.floor(p)),y=XDt(e.model),x=y.lastAutoInterval,w=y.lastTickCount;return x!=null&&w!=null&&Math.abs(x-v)<=1&&Math.abs(w-s)<=1&&x>v?v=x:(y.lastTickCount=s,y.lastAutoInterval=v),v},t}($o);SL.prototype.dataToAngle=$o.prototype.dataToCoord;SL.prototype.angleToData=$o.prototype.coordToData;const ZDt=SL;var pZ=["radius","angle"],qDt=function(){function r(t){this.dimensions=pZ,this.type="polar",this.cx=0,this.cy=0,this._radiusAxis=new jDt,this._angleAxis=new ZDt,this.axisPointerEnabled=!0,this.name=t||"",this._radiusAxis.polar=this._angleAxis.polar=this}return r.prototype.containPoint=function(t){var e=this.pointToCoord(t);return this._radiusAxis.contain(e[0])&&this._angleAxis.contain(e[1])},r.prototype.containData=function(t){return this._radiusAxis.containData(t[0])&&this._angleAxis.containData(t[1])},r.prototype.getAxis=function(t){var e="_"+t+"Axis";return this[e]},r.prototype.getAxes=function(){return[this._radiusAxis,this._angleAxis]},r.prototype.getAxesByScale=function(t){var e=[],i=this._angleAxis,n=this._radiusAxis;return i.scale.type===t&&e.push(i),n.scale.type===t&&e.push(n),e},r.prototype.getAngleAxis=function(){return this._angleAxis},r.prototype.getRadiusAxis=function(){return this._radiusAxis},r.prototype.getOtherAxis=function(t){var e=this._angleAxis;return t===e?this._radiusAxis:e},r.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAngleAxis()},r.prototype.getTooltipAxes=function(t){var e=t!=null&&t!=="auto"?this.getAxis(t):this.getBaseAxis();return{baseAxes:[e],otherAxes:[this.getOtherAxis(e)]}},r.prototype.dataToPoint=function(t,e){return this.coordToPoint([this._radiusAxis.dataToRadius(t[0],e),this._angleAxis.dataToAngle(t[1],e)])},r.prototype.pointToData=function(t,e){var i=this.pointToCoord(t);return[this._radiusAxis.radiusToData(i[0],e),this._angleAxis.angleToData(i[1],e)]},r.prototype.pointToCoord=function(t){var e=t[0]-this.cx,i=t[1]-this.cy,n=this.getAngleAxis(),a=n.getExtent(),s=Math.min(a[0],a[1]),o=Math.max(a[0],a[1]);n.inverse?s=o-360:o=s+360;var l=Math.sqrt(e*e+i*i);e/=l,i/=l;for(var u=Math.atan2(-i,e)/Math.PI*180,c=u<s?1:-1;u<s||u>o;)u+=c*360;return[l,u]},r.prototype.coordToPoint=function(t){var e=t[0],i=t[1]/180*Math.PI,n=Math.cos(i)*e+this.cx,a=-Math.sin(i)*e+this.cy;return[n,a]},r.prototype.getArea=function(){var t=this.getAngleAxis(),e=this.getRadiusAxis(),i=e.getExtent().slice();i[0]>i[1]&&i.reverse();var n=t.getExtent(),a=Math.PI/180;return{cx:this.cx,cy:this.cy,r0:i[0],r:i[1],startAngle:-n[0]*a,endAngle:-n[1]*a,clockwise:t.inverse,contain:function(s,o){var l=s-this.cx,u=o-this.cy,c=l*l+u*u-1e-4,h=this.r,p=this.r0;return c<=h*h&&c>=p*p}}},r.prototype.convertToPixel=function(t,e,i){var n=i6(e);return n===this?this.dataToPoint(i):null},r.prototype.convertFromPixel=function(t,e,i){var n=i6(e);return n===this?this.pointToData(i):null},r}();function i6(r){var t=r.seriesModel,e=r.polarModel;return e&&e.coordinateSystem||t&&t.coordinateSystem}const YDt=qDt;function KDt(r,t,e){var i=t.get("center"),n=e.getWidth(),a=e.getHeight();r.cx=he(i[0],n),r.cy=he(i[1],a);var s=r.getRadiusAxis(),o=Math.min(n,a)/2,l=t.get("radius");l==null?l=[0,"100%"]:Kt(l)||(l=[0,l]);var u=[he(l[0],o),he(l[1],o)];s.inverse?s.setExtent(u[1],u[0]):s.setExtent(u[0],u[1])}function JDt(r,t){var e=this,i=e.getAngleAxis(),n=e.getRadiusAxis();if(i.scale.setExtent(1/0,-1/0),n.scale.setExtent(1/0,-1/0),r.eachSeries(function(o){if(o.coordinateSystem===e){var l=o.getData();J(dw(l,"radius"),function(u){n.scale.unionExtentFromData(l,u)}),J(dw(l,"angle"),function(u){i.scale.unionExtentFromData(l,u)})}}),vg(i.scale,i.model),vg(n.scale,n.model),i.type==="category"&&!i.onBand){var a=i.getExtent(),s=360/i.scale.count();i.inverse?a[1]+=s:a[1]-=s,i.setExtent(a[0],a[1])}}function QDt(r){return r.mainType==="angleAxis"}function n6(r,t){var e;if(r.type=t.get("type"),r.scale=jS(t),r.onBand=t.get("boundaryGap")&&r.type==="category",r.inverse=t.get("inverse"),QDt(t)){r.inverse=r.inverse!==t.get("clockwise");var i=t.get("startAngle"),n=(e=t.get("endAngle"))!==null&&e!==void 0?e:i+(r.inverse?-360:360);r.setExtent(i,n)}t.axis=r,r.model=t}var tLt={dimensions:pZ,create:function(r,t){var e=[];return r.eachComponent("polar",function(i,n){var a=new YDt(n+"");a.update=JDt;var s=a.getRadiusAxis(),o=a.getAngleAxis(),l=i.findAxisModel("radiusAxis"),u=i.findAxisModel("angleAxis");n6(s,l),n6(o,u),KDt(a,i,t),e.push(a),i.coordinateSystem=a,a.model=i}),r.eachSeries(function(i){if(i.get("coordinateSystem")==="polar"){var n=i.getReferringComponents("polar",vn).models[0];i.coordinateSystem=n.coordinateSystem}}),e}};const eLt=tLt;var rLt=["axisLine","axisLabel","axisTick","minorTick","splitLine","minorSplitLine","splitArea"];function b1(r,t,e){t[1]>t[0]&&(t=t.slice().reverse());var i=r.coordToPoint([t[0],e]),n=r.coordToPoint([t[1],e]);return{x1:i[0],y1:i[1],x2:n[0],y2:n[1]}}function w1(r){var t=r.getRadiusAxis();return t.inverse?0:1}function a6(r){var t=r[0],e=r[r.length-1];t&&e&&Math.abs(Math.abs(t.coord-e.coord)-360)<1e-4&&r.pop()}var iLt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="PolarAxisPointer",e}return t.prototype.render=function(e,i){if(this.group.removeAll(),!!e.get("show")){var n=e.axis,a=n.polar,s=a.getRadiusAxis().getExtent(),o=n.getTicksCoords(),l=n.getMinorTicksCoords(),u=te(n.getViewLabels(),function(c){c=Ze(c);var h=n.scale,p=h.type==="ordinal"?h.getRawOrdinalNumber(c.tickValue):c.tickValue;return c.coord=n.dataToCoord(p),c});a6(u),a6(o),J(rLt,function(c){e.get([c,"show"])&&(!n.scale.isBlank()||c==="axisLine")&&nLt[c](this.group,e,a,o,l,s,u)},this)}},t.type="angleAxis",t}(sd),nLt={axisLine:function(r,t,e,i,n,a){var s=t.getModel(["axisLine","lineStyle"]),o=e.getAngleAxis(),l=Math.PI/180,u=o.getExtent(),c=w1(e),h=c?0:1,p,v=Math.abs(u[1]-u[0])===360?"Circle":"Arc";a[h]===0?p=new ed[v]({shape:{cx:e.cx,cy:e.cy,r:a[c],startAngle:-u[0]*l,endAngle:-u[1]*l,clockwise:o.inverse},style:s.getLineStyle(),z2:1,silent:!0}):p=new ES({shape:{cx:e.cx,cy:e.cy,r:a[c],r0:a[h]},style:s.getLineStyle(),z2:1,silent:!0}),p.style.fill=null,r.add(p)},axisTick:function(r,t,e,i,n,a){var s=t.getModel("axisTick"),o=(s.get("inside")?-1:1)*s.get("length"),l=a[w1(e)],u=te(i,function(c){return new $n({shape:b1(e,[l,l+o],c.coord)})});r.add(Qs(u,{style:We(s.getModel("lineStyle").getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])})}))},minorTick:function(r,t,e,i,n,a){if(n.length){for(var s=t.getModel("axisTick"),o=t.getModel("minorTick"),l=(s.get("inside")?-1:1)*o.get("length"),u=a[w1(e)],c=[],h=0;h<n.length;h++)for(var p=0;p<n[h].length;p++)c.push(new $n({shape:b1(e,[u,u+l],n[h][p].coord)}));r.add(Qs(c,{style:We(o.getModel("lineStyle").getLineStyle(),We(s.getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])}))}))}},axisLabel:function(r,t,e,i,n,a,s){var o=t.getCategories(!0),l=t.getModel("axisLabel"),u=l.get("margin"),c=t.get("triggerEvent");J(s,function(h,p){var v=l,y=h.tickValue,x=a[w1(e)],w=e.coordToPoint([x+u,h.coord]),T=e.cx,E=e.cy,M=Math.abs(w[0]-T)/x<.3?"center":w[0]>T?"left":"right",L=Math.abs(w[1]-E)/x<.3?"middle":w[1]>E?"top":"bottom";if(o&&o[y]){var F=o[y];je(F)&&F.textStyle&&(v=new fi(F.textStyle,l,l.ecModel))}var O=new Nr({silent:_u.isLabelSilent(t),style:hi(v,{x:w[0],y:w[1],fill:v.getTextColor()||t.get(["axisLine","lineStyle","color"]),text:h.formattedLabel,align:M,verticalAlign:L})});if(r.add(O),c){var U=_u.makeAxisEventDataBase(t);U.targetType="axisLabel",U.value=h.rawLabel,Je(O).eventData=U}},this)},splitLine:function(r,t,e,i,n,a){var s=t.getModel("splitLine"),o=s.getModel("lineStyle"),l=o.get("color"),u=0;l=l instanceof Array?l:[l];for(var c=[],h=0;h<i.length;h++){var p=u++%l.length;c[p]=c[p]||[],c[p].push(new $n({shape:b1(e,a,i[h].coord)}))}for(var h=0;h<c.length;h++)r.add(Qs(c[h],{style:We({stroke:l[h%l.length]},o.getLineStyle()),silent:!0,z:t.get("z")}))},minorSplitLine:function(r,t,e,i,n,a){if(n.length){for(var s=t.getModel("minorSplitLine"),o=s.getModel("lineStyle"),l=[],u=0;u<n.length;u++)for(var c=0;c<n[u].length;c++)l.push(new $n({shape:b1(e,a,n[u][c].coord)}));r.add(Qs(l,{style:o.getLineStyle(),silent:!0,z:t.get("z")}))}},splitArea:function(r,t,e,i,n,a){if(i.length){var s=t.getModel("splitArea"),o=s.getModel("areaStyle"),l=o.get("color"),u=0;l=l instanceof Array?l:[l];for(var c=[],h=Math.PI/180,p=-i[0].coord*h,v=Math.min(a[0],a[1]),y=Math.max(a[0],a[1]),x=t.get("clockwise"),w=1,T=i.length;w<=T;w++){var E=w===T?i[0].coord:i[w].coord,M=u++%l.length;c[M]=c[M]||[],c[M].push(new fs({shape:{cx:e.cx,cy:e.cy,r0:v,r:y,startAngle:p,endAngle:-E*h,clockwise:x},silent:!0})),p=-E*h}for(var w=0;w<c.length;w++)r.add(Qs(c[w],{style:We({fill:l[w%l.length]},o.getAreaStyle()),silent:!0}))}}};const aLt=iLt;var sLt=["axisLine","axisTickLabel","axisName"],oLt=["splitLine","splitArea","minorSplitLine"],lLt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="PolarAxisPointer",e}return t.prototype.render=function(e,i){if(this.group.removeAll(),!!e.get("show")){var n=this._axisGroup,a=this._axisGroup=new Ke;this.group.add(a);var s=e.axis,o=s.polar,l=o.getAngleAxis(),u=s.getTicksCoords(),c=s.getMinorTicksCoords(),h=l.getExtent()[0],p=s.getExtent(),v=cLt(o,e,h),y=new _u(e,v);J(sLt,y.add,y),a.add(y.getGroup()),P_(n,a,e),J(oLt,function(x){e.get([x,"show"])&&!s.scale.isBlank()&&uLt[x](this.group,e,o,h,p,u,c)},this)}},t.type="radiusAxis",t}(sd),uLt={splitLine:function(r,t,e,i,n,a){var s=t.getModel("splitLine"),o=s.getModel("lineStyle"),l=o.get("color"),u=0,c=e.getAngleAxis(),h=Math.PI/180,p=c.getExtent(),v=Math.abs(p[1]-p[0])===360?"Circle":"Arc";l=l instanceof Array?l:[l];for(var y=[],x=0;x<a.length;x++){var w=u++%l.length;y[w]=y[w]||[],y[w].push(new ed[v]({shape:{cx:e.cx,cy:e.cy,r:Math.max(a[x].coord,0),startAngle:-p[0]*h,endAngle:-p[1]*h,clockwise:c.inverse}}))}for(var x=0;x<y.length;x++)r.add(Qs(y[x],{style:We({stroke:l[x%l.length],fill:null},o.getLineStyle()),silent:!0}))},minorSplitLine:function(r,t,e,i,n,a,s){if(s.length){for(var o=t.getModel("minorSplitLine"),l=o.getModel("lineStyle"),u=[],c=0;c<s.length;c++)for(var h=0;h<s[c].length;h++)u.push(new Yc({shape:{cx:e.cx,cy:e.cy,r:s[c][h].coord}}));r.add(Qs(u,{style:We({fill:null},l.getLineStyle()),silent:!0}))}},splitArea:function(r,t,e,i,n,a){if(a.length){var s=t.getModel("splitArea"),o=s.getModel("areaStyle"),l=o.get("color"),u=0;l=l instanceof Array?l:[l];for(var c=[],h=a[0].coord,p=1;p<a.length;p++){var v=u++%l.length;c[v]=c[v]||[],c[v].push(new fs({shape:{cx:e.cx,cy:e.cy,r0:h,r:a[p].coord,startAngle:0,endAngle:Math.PI*2},silent:!0})),h=a[p].coord}for(var p=0;p<c.length;p++)r.add(Qs(c[p],{style:We({fill:l[p%l.length]},o.getAreaStyle()),silent:!0}))}}};function cLt(r,t,e){return{position:[r.cx,r.cy],rotation:e/180*Math.PI,labelDirection:-1,tickDirection:-1,nameDirection:1,labelRotate:t.getModel("axisLabel").get("rotate"),z2:1}}const hLt=lLt;function gZ(r){return r.get("stack")||"__ec_stack_"+r.seriesIndex}function vZ(r,t){return t.dim+r.model.componentIndex}function fLt(r,t,e){var i={},n=dLt(ti(t.getSeriesByType(r),function(a){return!t.isSeriesFiltered(a)&&a.coordinateSystem&&a.coordinateSystem.type==="polar"}));t.eachSeriesByType(r,function(a){if(a.coordinateSystem.type==="polar"){var s=a.getData(),o=a.coordinateSystem,l=o.getBaseAxis(),u=vZ(o,l),c=gZ(a),h=n[u][c],p=h.offset,v=h.width,y=o.getOtherAxis(l),x=a.coordinateSystem.cx,w=a.coordinateSystem.cy,T=a.get("barMinHeight")||0,E=a.get("barMinAngle")||0;i[c]=i[c]||[];for(var M=s.mapDimension(y.dim),L=s.mapDimension(l.dim),F=Hc(s,M),O=l.dim!=="radius"||!a.get("roundCap",!0),U=y.model,W=U.get("startValue"),H=y.dataToCoord(W||0),j=0,Y=s.count();j<Y;j++){var tt=s.get(M,j),it=s.get(L,j),lt=tt>=0?"p":"n",ht=H;F&&(i[c][it]||(i[c][it]={p:H,n:H}),ht=i[c][it][lt]);var Tt=void 0,Ot=void 0,Rt=void 0,Ut=void 0;if(y.dim==="radius"){var Jt=y.dataToCoord(tt)-H,ne=l.dataToCoord(it);Math.abs(Jt)<T&&(Jt=(Jt<0?-1:1)*T),Tt=ht,Ot=ht+Jt,Rt=ne-p,Ut=Rt-v,F&&(i[c][it][lt]=Ot)}else{var se=y.dataToCoord(tt,O)-H,ce=l.dataToCoord(it);Math.abs(se)<E&&(se=(se<0?-1:1)*E),Tt=ce+p,Ot=Tt+v,Rt=ht,Ut=ht+se,F&&(i[c][it][lt]=Ut)}s.setItemLayout(j,{cx:x,cy:w,r0:Tt,r:Ot,startAngle:-Rt*Math.PI/180,endAngle:-Ut*Math.PI/180,clockwise:Rt>=Ut})}}})}function dLt(r){var t={};J(r,function(i,n){var a=i.getData(),s=i.coordinateSystem,o=s.getBaseAxis(),l=vZ(s,o),u=o.getExtent(),c=o.type==="category"?o.getBandWidth():Math.abs(u[1]-u[0])/a.count(),h=t[l]||{bandWidth:c,remainedWidth:c,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}},p=h.stacks;t[l]=h;var v=gZ(i);p[v]||h.autoWidthCount++,p[v]=p[v]||{width:0,maxWidth:0};var y=he(i.get("barWidth"),c),x=he(i.get("barMaxWidth"),c),w=i.get("barGap"),T=i.get("barCategoryGap");y&&!p[v].width&&(y=Math.min(h.remainedWidth,y),p[v].width=y,h.remainedWidth-=y),x&&(p[v].maxWidth=x),w!=null&&(h.gap=w),T!=null&&(h.categoryGap=T)});var e={};return J(t,function(i,n){e[n]={};var a=i.stacks,s=i.bandWidth,o=he(i.categoryGap,s),l=he(i.gap,1),u=i.remainedWidth,c=i.autoWidthCount,h=(u-o)/(c+(c-1)*l);h=Math.max(h,0),J(a,function(x,w){var T=x.maxWidth;T&&T<h&&(T=Math.min(T,u),x.width&&(T=Math.min(T,x.width)),u-=T,x.width=T,c--)}),h=(u-o)/(c+(c-1)*l),h=Math.max(h,0);var p=0,v;J(a,function(x,w){x.width||(x.width=h),v=x,p+=x.width*(1+l)}),v&&(p-=v.width*l);var y=-p/2;J(a,function(x,w){e[n][w]=e[n][w]||{offset:y,width:x.width},y+=x.width*(1+l)})}),e}var pLt={startAngle:90,clockwise:!0,splitNumber:12,axisLabel:{rotate:0}},gLt={splitNumber:5},vLt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="polar",t}($i);function mLt(r){gr(H_),sd.registerAxisPointerClass("PolarAxisPointer",UDt),r.registerCoordinateSystem("polar",eLt),r.registerComponentModel(WDt),r.registerComponentView(vLt),yg(r,"angle",HDt,pLt),yg(r,"radius",GDt,gLt),r.registerComponentView(aLt),r.registerComponentView(hLt),r.registerLayout(nr(fLt,"bar"))}function eP(r,t){t=t||{};var e=r.coordinateSystem,i=r.axis,n={},a=i.position,s=i.orient,o=e.getRect(),l=[o.x,o.x+o.width,o.y,o.y+o.height],u={horizontal:{top:l[2],bottom:l[3]},vertical:{left:l[0],right:l[1]}};n.position=[s==="vertical"?u.vertical[a]:l[0],s==="horizontal"?u.horizontal[a]:l[3]];var c={horizontal:0,vertical:1};n.rotation=Math.PI/2*c[s];var h={top:-1,bottom:1,right:1,left:-1};n.labelDirection=n.tickDirection=n.nameDirection=h[a],r.get(["axisTick","inside"])&&(n.tickDirection=-n.tickDirection),Un(t.labelInside,r.get(["axisLabel","inside"]))&&(n.labelDirection=-n.labelDirection);var p=t.rotate;return p==null&&(p=r.get(["axisLabel","rotate"])),n.labelRotation=a==="top"?-p:p,n.z2=1,n}var yLt=["axisLine","axisTickLabel","axisName"],_Lt=["splitArea","splitLine"],xLt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="SingleAxisPointer",e}return t.prototype.render=function(e,i,n,a){var s=this.group;s.removeAll();var o=this._axisGroup;this._axisGroup=new Ke;var l=eP(e),u=new _u(e,l);J(yLt,u.add,u),s.add(this._axisGroup),s.add(u.getGroup()),J(_Lt,function(c){e.get([c,"show"])&&bLt[c](this,this.group,this._axisGroup,e)},this),P_(o,this._axisGroup,e),r.prototype.render.call(this,e,i,n,a)},t.prototype.remove=function(){Nj(this)},t.type="singleAxis",t}(sd),bLt={splitLine:function(r,t,e,i){var n=i.axis;if(!n.scale.isBlank()){var a=i.getModel("splitLine"),s=a.getModel("lineStyle"),o=s.get("color");o=o instanceof Array?o:[o];for(var l=s.get("width"),u=i.coordinateSystem.getRect(),c=n.isHorizontal(),h=[],p=0,v=n.getTicksCoords({tickModel:a}),y=[],x=[],w=0;w<v.length;++w){var T=n.toGlobalCoord(v[w].coord);c?(y[0]=T,y[1]=u.y,x[0]=T,x[1]=u.y+u.height):(y[0]=u.x,y[1]=T,x[0]=u.x+u.width,x[1]=T);var E=new $n({shape:{x1:y[0],y1:y[1],x2:x[0],y2:x[1]},silent:!0});dg(E.shape,l);var M=p++%o.length;h[M]=h[M]||[],h[M].push(E)}for(var L=s.getLineStyle(["color"]),w=0;w<h.length;++w)t.add(Qs(h[w],{style:We({stroke:o[w%o.length]},L),silent:!0}))}},splitArea:function(r,t,e,i){Oj(r,e,i,i)}};const wLt=xLt;var mZ=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getCoordSysModel=function(){return this},t.type="singleAxis",t.layoutMode="box",t.defaultOption={left:"5%",top:"5%",right:"5%",bottom:"5%",type:"value",position:"bottom",orient:"horizontal",axisLine:{show:!0,lineStyle:{width:1,type:"solid"}},tooltip:{show:!0},axisTick:{show:!0,length:6,lineStyle:{width:1}},axisLabel:{show:!0,interval:"auto"},splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.2}}},t}(kr);yn(mZ,O_.prototype);const rE=mZ;var SLt=function(r){Vt(t,r);function t(e,i,n,a,s){var o=r.call(this,e,i,n)||this;return o.type=a||"value",o.position=s||"bottom",o}return t.prototype.isHorizontal=function(){var e=this.position;return e==="top"||e==="bottom"},t.prototype.pointToData=function(e,i){return this.coordinateSystem.pointToData(e)[0]},t}($o);const TLt=SLt;var yZ=["single"],ALt=function(){function r(t,e,i){this.type="single",this.dimension="single",this.dimensions=yZ,this.axisPointerEnabled=!0,this.model=t,this._init(t,e,i)}return r.prototype._init=function(t,e,i){var n=this.dimension,a=new TLt(n,jS(t),[0,0],t.get("type"),t.get("position")),s=a.type==="category";a.onBand=s&&t.get("boundaryGap"),a.inverse=t.get("inverse"),a.orient=t.get("orient"),t.axis=a,a.model=t,a.coordinateSystem=this,this._axis=a},r.prototype.update=function(t,e){t.eachSeries(function(i){if(i.coordinateSystem===this){var n=i.getData();J(n.mapDimensionsAll(this.dimension),function(a){this._axis.scale.unionExtentFromData(n,a)},this),vg(this._axis.scale,this._axis.model)}},this)},r.prototype.resize=function(t,e){this._rect=bn({left:t.get("left"),top:t.get("top"),right:t.get("right"),bottom:t.get("bottom"),width:t.get("width"),height:t.get("height")},{width:e.getWidth(),height:e.getHeight()}),this._adjustAxis()},r.prototype.getRect=function(){return this._rect},r.prototype._adjustAxis=function(){var t=this._rect,e=this._axis,i=e.isHorizontal(),n=i?[0,t.width]:[0,t.height],a=e.inverse?1:0;e.setExtent(n[a],n[1-a]),this._updateAxisTransform(e,i?t.x:t.y)},r.prototype._updateAxisTransform=function(t,e){var i=t.getExtent(),n=i[0]+i[1],a=t.isHorizontal();t.toGlobalCoord=a?function(s){return s+e}:function(s){return n-s+e},t.toLocalCoord=a?function(s){return s-e}:function(s){return n-s+e}},r.prototype.getAxis=function(){return this._axis},r.prototype.getBaseAxis=function(){return this._axis},r.prototype.getAxes=function(){return[this._axis]},r.prototype.getTooltipAxes=function(){return{baseAxes:[this.getAxis()],otherAxes:[]}},r.prototype.containPoint=function(t){var e=this.getRect(),i=this.getAxis(),n=i.orient;return n==="horizontal"?i.contain(i.toLocalCoord(t[0]))&&t[1]>=e.y&&t[1]<=e.y+e.height:i.contain(i.toLocalCoord(t[1]))&&t[0]>=e.y&&t[0]<=e.y+e.height},r.prototype.pointToData=function(t){var e=this.getAxis();return[e.coordToData(e.toLocalCoord(t[e.orient==="horizontal"?0:1]))]},r.prototype.dataToPoint=function(t){var e=this.getAxis(),i=this.getRect(),n=[],a=e.orient==="horizontal"?0:1;return t instanceof Array&&(t=t[0]),n[a]=e.toGlobalCoord(e.dataToCoord(+t)),n[1-a]=a===0?i.y+i.height/2:i.x+i.width/2,n},r.prototype.convertToPixel=function(t,e,i){var n=s6(e);return n===this?this.dataToPoint(i):null},r.prototype.convertFromPixel=function(t,e,i){var n=s6(e);return n===this?this.pointToData(i):null},r}();function s6(r){var t=r.seriesModel,e=r.singleAxisModel;return e&&e.coordinateSystem||t&&t.coordinateSystem}function CLt(r,t){var e=[];return r.eachComponent("singleAxis",function(i,n){var a=new ALt(i,r,t);a.name="single_"+n,a.resize(i,t),i.coordinateSystem=a,e.push(a)}),r.eachSeries(function(i){if(i.get("coordinateSystem")==="singleAxis"){var n=i.getReferringComponents("singleAxis",vn).models[0];i.coordinateSystem=n&&n.coordinateSystem}}),e}var ELt={create:CLt,dimensions:yZ};const ILt=ELt;var o6=["x","y"],MLt=["width","height"],PLt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.makeElOption=function(e,i,n,a,s){var o=n.axis,l=o.coordinateSystem,u=iE(l,1-Iw(o)),c=l.dataToPoint(i)[0],h=a.get("type");if(h&&h!=="none"){var p=yL(a),v=RLt[h](o,c,u);v.style=p,e.graphicKey=v.type,e.pointer=v}var y=eP(n);cZ(i,e,y,n,a,s)},t.prototype.getHandleTransform=function(e,i,n){var a=eP(i,{labelInside:!1});a.labelMargin=n.get(["handle","margin"]);var s=_L(i.axis,e,a);return{x:s[0],y:s[1],rotation:a.rotation+(a.labelDirection<0?Math.PI:0)}},t.prototype.updateHandleTransform=function(e,i,n,a){var s=n.axis,o=s.coordinateSystem,l=Iw(s),u=iE(o,l),c=[e.x,e.y];c[l]+=i[l],c[l]=Math.min(u[1],c[l]),c[l]=Math.max(u[0],c[l]);var h=iE(o,1-l),p=(h[1]+h[0])/2,v=[p,p];return v[l]=c[l],{x:c[0],y:c[1],rotation:e.rotation,cursorPoint:v,tooltipOption:{verticalAlign:"middle"}}},t}(mL),RLt={line:function(r,t,e){var i=xL([t,e[0]],[t,e[1]],Iw(r));return{type:"Line",subPixelOptimize:!0,shape:i}},shadow:function(r,t,e){var i=r.getBandWidth(),n=e[1]-e[0];return{type:"Rect",shape:hZ([t-i/2,e[0]],[i,n],Iw(r))}}};function Iw(r){return r.isHorizontal()?0:1}function iE(r,t){var e=r.getRect();return[e[o6[t]],e[o6[t]]+e[MLt[t]]]}const DLt=PLt;var LLt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="single",t}($i);function kLt(r){gr(H_),sd.registerAxisPointerClass("SingleAxisPointer",DLt),r.registerComponentView(LLt),r.registerComponentView(wLt),r.registerComponentModel(rE),yg(r,"single",rE,rE.defaultOption),r.registerCoordinateSystem("single",ILt)}var OLt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,i,n){var a=Fg(e);r.prototype.init.apply(this,arguments),l6(e,a)},t.prototype.mergeOption=function(e){r.prototype.mergeOption.apply(this,arguments),l6(this.option,e)},t.prototype.getCellSize=function(){return this.option.cellSize},t.type="calendar",t.defaultOption={z:2,left:80,top:60,cellSize:20,orient:"horizontal",splitLine:{show:!0,lineStyle:{color:"#000",width:1,type:"solid"}},itemStyle:{color:"#fff",borderWidth:1,borderColor:"#ccc"},dayLabel:{show:!0,firstDay:0,position:"start",margin:"50%",color:"#000"},monthLabel:{show:!0,position:"start",margin:5,align:"center",formatter:null,color:"#000"},yearLabel:{show:!0,position:null,margin:30,formatter:null,color:"#ccc",fontFamily:"sans-serif",fontWeight:"bolder",fontSize:20}},t}(kr);function l6(r,t){var e=r.cellSize,i;Kt(e)?i=e:i=r.cellSize=[e,e],i.length===1&&(i[1]=i[0]);var n=te([0,1],function(a){return V0t(t,a)&&(i[a]="auto"),i[a]!=null&&i[a]!=="auto"});Wc(r,t,{type:"box",ignoreSize:n})}const NLt=OLt;var FLt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){var a=this.group;a.removeAll();var s=e.coordinateSystem,o=s.getRangeInfo(),l=s.getOrient(),u=i.getLocaleModel();this._renderDayRect(e,o,a),this._renderLines(e,o,l,a),this._renderYearText(e,o,l,a),this._renderMonthText(e,u,l,a),this._renderWeekText(e,u,o,l,a)},t.prototype._renderDayRect=function(e,i,n){for(var a=e.coordinateSystem,s=e.getModel("itemStyle").getItemStyle(),o=a.getCellWidth(),l=a.getCellHeight(),u=i.start.time;u<=i.end.time;u=a.getNextNDay(u,1).time){var c=a.dataToRect([u],!1).tl,h=new Pr({shape:{x:c[0],y:c[1],width:o,height:l},cursor:"default",style:s});n.add(h)}},t.prototype._renderLines=function(e,i,n,a){var s=this,o=e.coordinateSystem,l=e.getModel(["splitLine","lineStyle"]).getLineStyle(),u=e.get(["splitLine","show"]),c=l.lineWidth;this._tlpoints=[],this._blpoints=[],this._firstDayOfMonth=[],this._firstDayPoints=[];for(var h=i.start,p=0;h.time<=i.end.time;p++){y(h.formatedDate),p===0&&(h=o.getDateInfo(i.start.y+"-"+i.start.m));var v=h.date;v.setMonth(v.getMonth()+1),h=o.getDateInfo(v)}y(o.getNextNDay(i.end.time,1).formatedDate);function y(x){s._firstDayOfMonth.push(o.getDateInfo(x)),s._firstDayPoints.push(o.dataToRect([x],!1).tl);var w=s._getLinePointsOfOneWeek(e,x,n);s._tlpoints.push(w[0]),s._blpoints.push(w[w.length-1]),u&&s._drawSplitline(w,l,a)}u&&this._drawSplitline(s._getEdgesPoints(s._tlpoints,c,n),l,a),u&&this._drawSplitline(s._getEdgesPoints(s._blpoints,c,n),l,a)},t.prototype._getEdgesPoints=function(e,i,n){var a=[e[0].slice(),e[e.length-1].slice()],s=n==="horizontal"?0:1;return a[0][s]=a[0][s]-i/2,a[1][s]=a[1][s]+i/2,a},t.prototype._drawSplitline=function(e,i,n){var a=new ps({z2:20,shape:{points:e},style:i});n.add(a)},t.prototype._getLinePointsOfOneWeek=function(e,i,n){for(var a=e.coordinateSystem,s=a.getDateInfo(i),o=[],l=0;l<7;l++){var u=a.getNextNDay(s.time,l),c=a.dataToRect([u.time],!1);o[2*u.day]=c.tl,o[2*u.day+1]=c[n==="horizontal"?"bl":"tr"]}return o},t.prototype._formatterLabel=function(e,i){return ve(e)&&e?F0t(e,i):Ve(e)?e(i):i.nameMap},t.prototype._yearTextPositionControl=function(e,i,n,a,s){var o=i[0],l=i[1],u=["center","bottom"];a==="bottom"?(l+=s,u=["center","top"]):a==="left"?o-=s:a==="right"?(o+=s,u=["center","top"]):l-=s;var c=0;return(a==="left"||a==="right")&&(c=Math.PI/2),{rotation:c,x:o,y:l,style:{align:u[0],verticalAlign:u[1]}}},t.prototype._renderYearText=function(e,i,n,a){var s=e.getModel("yearLabel");if(s.get("show")){var o=s.get("margin"),l=s.get("position");l||(l=n!=="horizontal"?"top":"left");var u=[this._tlpoints[this._tlpoints.length-1],this._blpoints[0]],c=(u[0][0]+u[1][0])/2,h=(u[0][1]+u[1][1])/2,p=n==="horizontal"?0:1,v={top:[c,u[p][1]],bottom:[c,u[1-p][1]],left:[u[1-p][0],h],right:[u[p][0],h]},y=i.start.y;+i.end.y>+i.start.y&&(y=y+"-"+i.end.y);var x=s.get("formatter"),w={start:i.start.y,end:i.end.y,nameMap:y},T=this._formatterLabel(x,w),E=new Nr({z2:30,style:hi(s,{text:T})});E.attr(this._yearTextPositionControl(E,v[l],n,l,o)),a.add(E)}},t.prototype._monthTextPositionControl=function(e,i,n,a,s){var o="left",l="top",u=e[0],c=e[1];return n==="horizontal"?(c=c+s,i&&(o="center"),a==="start"&&(l="bottom")):(u=u+s,i&&(l="middle"),a==="start"&&(o="right")),{x:u,y:c,align:o,verticalAlign:l}},t.prototype._renderMonthText=function(e,i,n,a){var s=e.getModel("monthLabel");if(s.get("show")){var o=s.get("nameMap"),l=s.get("margin"),u=s.get("position"),c=s.get("align"),h=[this._tlpoints,this._blpoints];(!o||ve(o))&&(o&&(i=hM(o)||i),o=i.get(["time","monthAbbr"])||[]);var p=u==="start"?0:1,v=n==="horizontal"?0:1;l=u==="start"?-l:l;for(var y=c==="center",x=0;x<h[p].length-1;x++){var w=h[p][x].slice(),T=this._firstDayOfMonth[x];if(y){var E=this._firstDayPoints[x];w[v]=(E[v]+h[0][x+1][v])/2}var M=s.get("formatter"),L=o[+T.m-1],F={yyyy:T.y,yy:(T.y+"").slice(2),MM:T.m,M:+T.m,nameMap:L},O=this._formatterLabel(M,F),U=new Nr({z2:30,style:Zt(hi(s,{text:O}),this._monthTextPositionControl(w,y,n,u,l))});a.add(U)}}},t.prototype._weekTextPositionControl=function(e,i,n,a,s){var o="center",l="middle",u=e[0],c=e[1],h=n==="start";return i==="horizontal"?(u=u+a+(h?1:-1)*s[0]/2,o=h?"right":"left"):(c=c+a+(h?1:-1)*s[1]/2,l=h?"bottom":"top"),{x:u,y:c,align:o,verticalAlign:l}},t.prototype._renderWeekText=function(e,i,n,a,s){var o=e.getModel("dayLabel");if(o.get("show")){var l=e.coordinateSystem,u=o.get("position"),c=o.get("nameMap"),h=o.get("margin"),p=l.getFirstDayOfWeek();if(!c||ve(c)){c&&(i=hM(c)||i);var v=i.get(["time","dayOfWeekShort"]);c=v||te(i.get(["time","dayOfWeekAbbr"]),function(F){return F[0]})}var y=l.getNextNDay(n.end.time,7-n.lweek).time,x=[l.getCellWidth(),l.getCellHeight()];h=he(h,Math.min(x[1],x[0])),u==="start"&&(y=l.getNextNDay(n.start.time,-(7+n.fweek)).time,h=-h);for(var w=0;w<7;w++){var T=l.getNextNDay(y,w),E=l.dataToRect([T.time],!1).center,M=w;M=Math.abs((w+p)%7);var L=new Nr({z2:30,style:Zt(hi(o,{text:c[M]}),this._weekTextPositionControl(E,a,u,h,x))});s.add(L)}}},t.type="calendar",t}($i);const BLt=FLt;var nE=864e5,zLt=function(){function r(t,e,i){this.type="calendar",this.dimensions=r.dimensions,this.getDimensionsInfo=r.getDimensionsInfo,this._model=t}return r.getDimensionsInfo=function(){return[{name:"time",type:"time"},"value"]},r.prototype.getRangeInfo=function(){return this._rangeInfo},r.prototype.getModel=function(){return this._model},r.prototype.getRect=function(){return this._rect},r.prototype.getCellWidth=function(){return this._sw},r.prototype.getCellHeight=function(){return this._sh},r.prototype.getOrient=function(){return this._orient},r.prototype.getFirstDayOfWeek=function(){return this._firstDayOfWeek},r.prototype.getDateInfo=function(t){t=Tl(t);var e=t.getFullYear(),i=t.getMonth()+1,n=i<10?"0"+i:""+i,a=t.getDate(),s=a<10?"0"+a:""+a,o=t.getDay();return o=Math.abs((o+7-this.getFirstDayOfWeek())%7),{y:e+"",m:n,d:s,day:o,time:t.getTime(),formatedDate:e+"-"+n+"-"+s,date:t}},r.prototype.getNextNDay=function(t,e){return e=e||0,e===0?this.getDateInfo(t):(t=new Date(this.getDateInfo(t).time),t.setDate(t.getDate()+e),this.getDateInfo(t))},r.prototype.update=function(t,e){this._firstDayOfWeek=+this._model.getModel("dayLabel").get("firstDay"),this._orient=this._model.get("orient"),this._lineWidth=this._model.getModel("itemStyle").getItemStyle().lineWidth||0,this._rangeInfo=this._getRangeInfo(this._initRangeOption());var i=this._rangeInfo.weeks||1,n=["width","height"],a=this._model.getCellSize().slice(),s=this._model.getBoxLayoutParams(),o=this._orient==="horizontal"?[i,7]:[7,i];J([0,1],function(h){c(a,h)&&(s[n[h]]=a[h]*o[h])});var l={width:e.getWidth(),height:e.getHeight()},u=this._rect=bn(s,l);J([0,1],function(h){c(a,h)||(a[h]=u[n[h]]/o[h])});function c(h,p){return h[p]!=null&&h[p]!=="auto"}this._sw=a[0],this._sh=a[1]},r.prototype.dataToPoint=function(t,e){Kt(t)&&(t=t[0]),e==null&&(e=!0);var i=this.getDateInfo(t),n=this._rangeInfo,a=i.formatedDate;if(e&&!(i.time>=n.start.time&&i.time<n.end.time+nE))return[NaN,NaN];var s=i.day,o=this._getRangeInfo([n.start.time,a]).nthWeek;return this._orient==="vertical"?[this._rect.x+s*this._sw+this._sw/2,this._rect.y+o*this._sh+this._sh/2]:[this._rect.x+o*this._sw+this._sw/2,this._rect.y+s*this._sh+this._sh/2]},r.prototype.pointToData=function(t){var e=this.pointToDate(t);return e&&e.time},r.prototype.dataToRect=function(t,e){var i=this.dataToPoint(t,e);return{contentShape:{x:i[0]-(this._sw-this._lineWidth)/2,y:i[1]-(this._sh-this._lineWidth)/2,width:this._sw-this._lineWidth,height:this._sh-this._lineWidth},center:i,tl:[i[0]-this._sw/2,i[1]-this._sh/2],tr:[i[0]+this._sw/2,i[1]-this._sh/2],br:[i[0]+this._sw/2,i[1]+this._sh/2],bl:[i[0]-this._sw/2,i[1]+this._sh/2]}},r.prototype.pointToDate=function(t){var e=Math.floor((t[0]-this._rect.x)/this._sw)+1,i=Math.floor((t[1]-this._rect.y)/this._sh)+1,n=this._rangeInfo.range;return this._orient==="vertical"?this._getDateByWeeksAndDay(i,e-1,n):this._getDateByWeeksAndDay(e,i-1,n)},r.prototype.convertToPixel=function(t,e,i){var n=u6(e);return n===this?n.dataToPoint(i):null},r.prototype.convertFromPixel=function(t,e,i){var n=u6(e);return n===this?n.pointToData(i):null},r.prototype.containPoint=function(t){return console.warn("Not implemented."),!1},r.prototype._initRangeOption=function(){var t=this._model.get("range"),e;if(Kt(t)&&t.length===1&&(t=t[0]),Kt(t))e=t;else{var i=t.toString();if(/^\d{4}$/.test(i)&&(e=[i+"-01-01",i+"-12-31"]),/^\d{4}[\/|-]\d{1,2}$/.test(i)){var n=this.getDateInfo(i),a=n.date;a.setMonth(a.getMonth()+1);var s=this.getNextNDay(a,-1);e=[n.formatedDate,s.formatedDate]}/^\d{4}[\/|-]\d{1,2}[\/|-]\d{1,2}$/.test(i)&&(e=[i,i])}if(!e)return t;var o=this._getRangeInfo(e);return o.start.time>o.end.time&&e.reverse(),e},r.prototype._getRangeInfo=function(t){var e=[this.getDateInfo(t[0]),this.getDateInfo(t[1])],i;e[0].time>e[1].time&&(i=!0,e.reverse());var n=Math.floor(e[1].time/nE)-Math.floor(e[0].time/nE)+1,a=new Date(e[0].time),s=a.getDate(),o=e[1].date.getDate();a.setDate(s+n-1);var l=a.getDate();if(l!==o)for(var u=a.getTime()-e[1].time>0?1:-1;(l=a.getDate())!==o&&(a.getTime()-e[1].time)*u>0;)n-=u,a.setDate(l-u);var c=Math.floor((n+e[0].day+6)/7),h=i?-c+1:c-1;return i&&e.reverse(),{range:[e[0].formatedDate,e[1].formatedDate],start:e[0],end:e[1],allDay:n,weeks:c,nthWeek:h,fweek:e[0].day,lweek:e[1].day}},r.prototype._getDateByWeeksAndDay=function(t,e,i){var n=this._getRangeInfo(i);if(t>n.weeks||t===0&&e<n.fweek||t===n.weeks&&e>n.lweek)return null;var a=(t-1)*7-n.fweek+e,s=new Date(n.start.time);return s.setDate(+n.start.d+a),this.getDateInfo(s)},r.create=function(t,e){var i=[];return t.eachComponent("calendar",function(n){var a=new r(n);i.push(a),n.coordinateSystem=a}),t.eachSeries(function(n){n.get("coordinateSystem")==="calendar"&&(n.coordinateSystem=i[n.get("calendarIndex")||0])}),i},r.dimensions=["time","value"],r}();function u6(r){var t=r.calendarModel,e=r.seriesModel,i=t?t.coordinateSystem:e?e.coordinateSystem:null;return i}const VLt=zLt;function ULt(r){r.registerComponentModel(NLt),r.registerComponentView(BLt),r.registerCoordinateSystem("calendar",VLt)}function $Lt(r,t){var e=r.existing;if(t.id=r.keyInfo.id,!t.type&&e&&(t.type=e.type),t.parentId==null){var i=t.parentOption;i?t.parentId=i.id:e&&(t.parentId=e.parentId)}t.parentOption=null}function c6(r,t){var e;return J(t,function(i){r[i]!=null&&r[i]!=="auto"&&(e=!0)}),e}function WLt(r,t,e){var i=Zt({},e),n=r[t],a=e.$action||"merge";a==="merge"?n?(cr(n,i,!0),Wc(n,i,{ignoreSize:!0}),t9(e,n),S1(e,n),S1(e,n,"shape"),S1(e,n,"style"),S1(e,n,"extra"),e.clipPath=n.clipPath):r[t]=i:a==="replace"?r[t]=i:a==="remove"&&n&&(r[t]=null)}var _Z=["transition","enterFrom","leaveTo"],HLt=_Z.concat(["enterAnimation","updateAnimation","leaveAnimation"]);function S1(r,t,e){if(e&&(!r[e]&&t[e]&&(r[e]={}),r=r[e],t=t[e]),!(!r||!t))for(var i=e?_Z:HLt,n=0;n<i.length;n++){var a=i[n];r[a]==null&&t[a]!=null&&(r[a]=t[a])}}function GLt(r,t){if(r&&(r.hv=t.hv=[c6(t,["left","right"]),c6(t,["top","bottom"])],r.type==="group")){var e=r,i=t;e.width==null&&(e.width=i.width=0),e.height==null&&(e.height=i.height=0)}}var jLt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.preventAutoZ=!0,e}return t.prototype.mergeOption=function(e,i){var n=this.option.elements;this.option.elements=null,r.prototype.mergeOption.call(this,e,i),this.option.elements=n},t.prototype.optionUpdated=function(e,i){var n=this.option,a=(i?n:e).elements,s=n.elements=i?[]:n.elements,o=[];this._flatten(a,o,null);var l=FH(s,o,"normalMerge"),u=this._elOptionsToUpdate=[];J(l,function(c,h){var p=c.newOption;p&&(u.push(p),$Lt(c,p),WLt(s,h,p),GLt(s[h],p))},this),n.elements=ti(s,function(c){return c&&delete c.$action,c!=null})},t.prototype._flatten=function(e,i,n){J(e,function(a){if(a){n&&(a.parentOption=n),i.push(a);var s=a.children;s&&s.length&&this._flatten(s,i,a),delete a.children}},this)},t.prototype.useElOptionsToUpdate=function(){var e=this._elOptionsToUpdate;return this._elOptionsToUpdate=null,e},t.type="graphic",t.defaultOption={elements:[]},t}(kr),h6={path:null,compoundPath:null,group:Ke,image:ia,text:Nr},Zs=Ir(),XLt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){this._elMap=Re()},t.prototype.render=function(e,i,n){e!==this._lastGraphicModel&&this._clear(),this._lastGraphicModel=e,this._updateElements(e),this._relocate(e,n)},t.prototype._updateElements=function(e){var i=e.useElOptionsToUpdate();if(i){var n=this._elMap,a=this.group,s=e.get("z"),o=e.get("zlevel");J(i,function(l){var u=xn(l.id,null),c=u!=null?n.get(u):null,h=xn(l.parentId,null),p=h!=null?n.get(h):a,v=l.type,y=l.style;v==="text"&&y&&l.hv&&l.hv[1]&&(y.textVerticalAlign=y.textBaseline=y.verticalAlign=y.align=null);var x=l.textContent,w=l.textConfig;if(y&&JX(y,v,!!w,!!x)){var T=QX(y,v,!0);!w&&T.textConfig&&(w=l.textConfig=T.textConfig),!x&&T.textContent&&(x=T.textContent)}var E=ZLt(l),M=l.$action||"merge",L=M==="merge",F=M==="replace";if(L){var O=!c,U=c;O?U=f6(u,p,l.type,n):(U&&(Zs(U).isNew=!1),iZ(U)),U&&(ib(U,E,e,{isInit:O}),d6(U,l,s,o))}else if(F){ab(c,l,n,e);var W=f6(u,p,l.type,n);W&&(ib(W,E,e,{isInit:!0}),d6(W,l,s,o))}else M==="remove"&&(eZ(c,l),ab(c,l,n,e));var H=n.get(u);if(H&&x)if(L){var j=H.getTextContent();j?j.attr(x):H.setTextContent(new Nr(x))}else F&&H.setTextContent(new Nr(x));if(H){var Y=l.clipPath;if(Y){var tt=Y.type,it=void 0,O=!1;if(L){var lt=H.getClipPath();O=!lt||Zs(lt).type!==tt,it=O?rP(tt):lt}else F&&(O=!0,it=rP(tt));H.setClipPath(it),ib(it,Y,e,{isInit:O}),Cw(it,Y.keyframeAnimation,e)}var ht=Zs(H);H.setTextConfig(w),ht.option=l,qLt(H,e,l),Lg({el:H,componentModel:e,itemName:H.name,itemTooltipOption:l.tooltip}),Cw(H,l.keyframeAnimation,e)}})}},t.prototype._relocate=function(e,i){for(var n=e.option.elements,a=this.group,s=this._elMap,o=i.getWidth(),l=i.getHeight(),u=["x","y"],c=0;c<n.length;c++){var h=n[c],p=xn(h.id,null),v=p!=null?s.get(p):null;if(!(!v||!v.isGroup)){var y=v.parent,x=y===a,w=Zs(v),T=Zs(y);w.width=he(w.option.width,x?o:T.width)||0,w.height=he(w.option.height,x?l:T.height)||0}}for(var c=n.length-1;c>=0;c--){var h=n[c],p=xn(h.id,null),v=p!=null?s.get(p):null;if(v){var y=v.parent,T=Zs(y),E=y===a?{width:o,height:l}:{width:T.width,height:T.height},M={},L=FS(v,h,E,null,{hv:h.hv,boundingMode:h.bounding},M);if(!Zs(v).isNew&&L){for(var F=h.transition,O={},U=0;U<u.length;U++){var W=u[U],H=M[W];F&&(Lf(F)||pr(F,W)>=0)?O[W]=H:v[W]=H}zr(v,O,e,0)}else v.attr(M)}}},t.prototype._clear=function(){var e=this,i=this._elMap;i.each(function(n){ab(n,Zs(n).option,i,e._lastGraphicModel)}),this._elMap=Re()},t.prototype.dispose=function(){this._clear()},t.type="graphic",t}($i);function rP(r){var t=Ae(h6,r)?h6[r]:eD(r),e=new t({});return Zs(e).type=r,e}function f6(r,t,e,i){var n=rP(e);return t.add(n),i.set(r,n),Zs(n).id=r,Zs(n).isNew=!0,n}function ab(r,t,e,i){var n=r&&r.parent;n&&(r.type==="group"&&r.traverse(function(a){ab(a,t,e,i)}),QS(r,t,i),e.removeKey(Zs(r).id))}function d6(r,t,e,i){r.isGroup||J([["cursor",ao.prototype.cursor],["zlevel",i||0],["z",e||0],["z2",0]],function(n){var a=n[0];Ae(t,a)?r[a]=ir(t[a],n[1]):r[a]==null&&(r[a]=n[1])}),J(br(t),function(n){if(n.indexOf("on")===0){var a=t[n];r[n]=Ve(a)?a:null}}),Ae(t,"draggable")&&(r.draggable=t.draggable),t.name!=null&&(r.name=t.name),t.id!=null&&(r.id=t.id)}function ZLt(r){return r=Zt({},r),J(["id","parentId","$action","hv","bounding","textContent","clipPath"].concat(Q7),function(t){delete r[t]}),r}function qLt(r,t,e){var i=Je(r).eventData;!r.silent&&!r.ignore&&!i&&(i=Je(r).eventData={componentType:"graphic",componentIndex:t.componentIndex,name:r.name}),i&&(i.info=e.info)}function YLt(r){r.registerComponentModel(jLt),r.registerComponentView(XLt),r.registerPreprocessor(function(t){var e=t.graphic;Kt(e)?!e[0]||!e[0].elements?t.graphic=[{elements:e}]:t.graphic=[t.graphic[0]]:e&&!e.elements&&(t.graphic=[{elements:[e]}])})}var p6=["x","y","radius","angle","single"],KLt=["cartesian2d","polar","singleAxis"];function JLt(r){var t=r.get("coordinateSystem");return pr(KLt,t)>=0}function Ic(r){return r+"Axis"}function QLt(r,t){var e=Re(),i=[],n=Re();r.eachComponent({mainType:"dataZoom",query:t},function(c){n.get(c.uid)||o(c)});var a;do a=!1,r.eachComponent("dataZoom",s);while(a);function s(c){!n.get(c.uid)&&l(c)&&(o(c),a=!0)}function o(c){n.set(c.uid,!0),i.push(c),u(c)}function l(c){var h=!1;return c.eachTargetAxis(function(p,v){var y=e.get(p);y&&y[v]&&(h=!0)}),h}function u(c){c.eachTargetAxis(function(h,p){(e.get(h)||e.set(h,[]))[p]=!0})}return i}function xZ(r){var t=r.ecModel,e={infoList:[],infoMap:Re()};return r.eachTargetAxis(function(i,n){var a=t.getComponent(Ic(i),n);if(a){var s=a.getCoordSysModel();if(s){var o=s.uid,l=e.infoMap.get(o);l||(l={model:s,axisModels:[]},e.infoList.push(l),e.infoMap.set(o,l)),l.axisModels.push(a)}}}),e}var aE=function(){function r(){this.indexList=[],this.indexMap=[]}return r.prototype.add=function(t){this.indexMap[t]||(this.indexList.push(t),this.indexMap[t]=!0)},r}(),tkt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e._autoThrottle=!0,e._noTarget=!0,e._rangePropMode=["percent","percent"],e}return t.prototype.init=function(e,i,n){var a=g6(e);this.settledOption=a,this.mergeDefaultAndTheme(e,n),this._doInit(a)},t.prototype.mergeOption=function(e){var i=g6(e);cr(this.option,e,!0),cr(this.settledOption,i,!0),this._doInit(i)},t.prototype._doInit=function(e){var i=this.option;this._setDefaultThrottle(e),this._updateRangeUse(e);var n=this.settledOption;J([["start","startValue"],["end","endValue"]],function(a,s){this._rangePropMode[s]==="value"&&(i[a[0]]=n[a[0]]=null)},this),this._resetTarget()},t.prototype._resetTarget=function(){var e=this.get("orient",!0),i=this._targetAxisInfoMap=Re(),n=this._fillSpecifiedTargetAxis(i);n?this._orient=e||this._makeAutoOrientByTargetAxis():(this._orient=e||"horizontal",this._fillAutoTargetAxisByOrient(i,this._orient)),this._noTarget=!0,i.each(function(a){a.indexList.length&&(this._noTarget=!1)},this)},t.prototype._fillSpecifiedTargetAxis=function(e){var i=!1;return J(p6,function(n){var a=this.getReferringComponents(Ic(n),vyt);if(a.specified){i=!0;var s=new aE;J(a.models,function(o){s.add(o.componentIndex)}),e.set(n,s)}},this),i},t.prototype._fillAutoTargetAxisByOrient=function(e,i){var n=this.ecModel,a=!0;if(a){var s=i==="vertical"?"y":"x",o=n.findComponents({mainType:s+"Axis"});l(o,s)}if(a){var o=n.findComponents({mainType:"singleAxis",filter:function(c){return c.get("orient",!0)===i}});l(o,"single")}function l(u,c){var h=u[0];if(h){var p=new aE;if(p.add(h.componentIndex),e.set(c,p),a=!1,c==="x"||c==="y"){var v=h.getReferringComponents("grid",vn).models[0];v&&J(u,function(y){h.componentIndex!==y.componentIndex&&v===y.getReferringComponents("grid",vn).models[0]&&p.add(y.componentIndex)})}}}a&&J(p6,function(u){if(a){var c=n.findComponents({mainType:Ic(u),filter:function(p){return p.get("type",!0)==="category"}});if(c[0]){var h=new aE;h.add(c[0].componentIndex),e.set(u,h),a=!1}}},this)},t.prototype._makeAutoOrientByTargetAxis=function(){var e;return this.eachTargetAxis(function(i){!e&&(e=i)},this),e==="y"?"vertical":"horizontal"},t.prototype._setDefaultThrottle=function(e){if(e.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle){var i=this.ecModel.option;this.option.throttle=i.animation&&i.animationDurationUpdate>0?100:20}},t.prototype._updateRangeUse=function(e){var i=this._rangePropMode,n=this.get("rangeMode");J([["start","startValue"],["end","endValue"]],function(a,s){var o=e[a[0]]!=null,l=e[a[1]]!=null;o&&!l?i[s]="percent":!o&&l?i[s]="value":n?i[s]=n[s]:o&&(i[s]="percent")})},t.prototype.noTarget=function(){return this._noTarget},t.prototype.getFirstTargetAxisModel=function(){var e;return this.eachTargetAxis(function(i,n){e==null&&(e=this.ecModel.getComponent(Ic(i),n))},this),e},t.prototype.eachTargetAxis=function(e,i){this._targetAxisInfoMap.each(function(n,a){J(n.indexList,function(s){e.call(i,a,s)})})},t.prototype.getAxisProxy=function(e,i){var n=this.getAxisModel(e,i);if(n)return n.__dzAxisProxy},t.prototype.getAxisModel=function(e,i){var n=this._targetAxisInfoMap.get(e);if(n&&n.indexMap[i])return this.ecModel.getComponent(Ic(e),i)},t.prototype.setRawRange=function(e){var i=this.option,n=this.settledOption;J([["start","startValue"],["end","endValue"]],function(a){(e[a[0]]!=null||e[a[1]]!=null)&&(i[a[0]]=n[a[0]]=e[a[0]],i[a[1]]=n[a[1]]=e[a[1]])},this),this._updateRangeUse(e)},t.prototype.setCalculatedRange=function(e){var i=this.option;J(["start","startValue","end","endValue"],function(n){i[n]=e[n]})},t.prototype.getPercentRange=function(){var e=this.findRepresentativeAxisProxy();if(e)return e.getDataPercentWindow()},t.prototype.getValueRange=function(e,i){if(e==null&&i==null){var n=this.findRepresentativeAxisProxy();if(n)return n.getDataValueWindow()}else return this.getAxisProxy(e,i).getDataValueWindow()},t.prototype.findRepresentativeAxisProxy=function(e){if(e)return e.__dzAxisProxy;for(var i,n=this._targetAxisInfoMap.keys(),a=0;a<n.length;a++)for(var s=n[a],o=this._targetAxisInfoMap.get(s),l=0;l<o.indexList.length;l++){var u=this.getAxisProxy(s,o.indexList[l]);if(u.hostedBy(this))return u;i||(i=u)}return i},t.prototype.getRangePropMode=function(){return this._rangePropMode.slice()},t.prototype.getOrient=function(){return this._orient},t.type="dataZoom",t.dependencies=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","series","toolbox"],t.defaultOption={z:4,filterMode:"filter",start:0,end:100},t}(kr);function g6(r){var t={};return J(["start","end","startValue","endValue","throttle"],function(e){r.hasOwnProperty(e)&&(t[e]=r[e])}),t}const c_=tkt;var ekt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.select",t}(c_);const rkt=ekt;var ikt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n,a){this.dataZoomModel=e,this.ecModel=i,this.api=n},t.type="dataZoom",t}($i);const TL=ikt;var nkt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.select",t}(TL);const akt=nkt;var Ap=J,v6=ro,skt=function(){function r(t,e,i,n){this._dimName=t,this._axisIndex=e,this.ecModel=n,this._dataZoomModel=i}return r.prototype.hostedBy=function(t){return this._dataZoomModel===t},r.prototype.getDataValueWindow=function(){return this._valueWindow.slice()},r.prototype.getDataPercentWindow=function(){return this._percentWindow.slice()},r.prototype.getTargetSeriesModels=function(){var t=[];return this.ecModel.eachSeries(function(e){if(JLt(e)){var i=Ic(this._dimName),n=e.getReferringComponents(i,vn).models[0];n&&this._axisIndex===n.componentIndex&&t.push(e)}},this),t},r.prototype.getAxisModel=function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},r.prototype.getMinMaxSpan=function(){return Ze(this._minMaxSpan)},r.prototype.calculateDataWindow=function(t){var e=this._dataExtent,i=this.getAxisModel(),n=i.axis.scale,a=this._dataZoomModel.getRangePropMode(),s=[0,100],o=[],l=[],u;Ap(["start","end"],function(p,v){var y=t[p],x=t[p+"Value"];a[v]==="percent"?(y==null&&(y=s[v]),x=n.parse(Jr(y,s,e))):(u=!0,x=x==null?e[v]:n.parse(x),y=Jr(x,e,s)),l[v]=x==null||isNaN(x)?e[v]:x,o[v]=y==null||isNaN(y)?s[v]:y}),v6(l),v6(o);var c=this._minMaxSpan;u?h(l,o,e,s,!1):h(o,l,s,e,!0);function h(p,v,y,x,w){var T=w?"Span":"ValueSpan";od(0,p,y,"all",c["min"+T],c["max"+T]);for(var E=0;E<2;E++)v[E]=Jr(p[E],y,x,!0),w&&(v[E]=n.parse(v[E]))}return{valueWindow:l,percentWindow:o}},r.prototype.reset=function(t){if(t===this._dataZoomModel){var e=this.getTargetSeriesModels();this._dataExtent=okt(this,this._dimName,e),this._updateMinMaxSpan();var i=this.calculateDataWindow(t.settledOption);this._valueWindow=i.valueWindow,this._percentWindow=i.percentWindow,this._setAxisModel()}},r.prototype.filterData=function(t,e){if(t!==this._dataZoomModel)return;var i=this._dimName,n=this.getTargetSeriesModels(),a=t.get("filterMode"),s=this._valueWindow;if(a==="none")return;Ap(n,function(l){var u=l.getData(),c=u.mapDimensionsAll(i);if(c.length){if(a==="weakFilter"){var h=u.getStore(),p=te(c,function(v){return u.getDimensionIndex(v)},u);u.filterSelf(function(v){for(var y,x,w,T=0;T<c.length;T++){var E=h.get(p[T],v),M=!isNaN(E),L=E<s[0],F=E>s[1];if(M&&!L&&!F)return!0;M&&(w=!0),L&&(y=!0),F&&(x=!0)}return w&&y&&x})}else Ap(c,function(v){if(a==="empty")l.setData(u=u.map(v,function(x){return o(x)?x:NaN}));else{var y={};y[v]=s,u.selectRange(y)}});Ap(c,function(v){u.setApproximateExtent(s,v)})}});function o(l){return l>=s[0]&&l<=s[1]}},r.prototype._updateMinMaxSpan=function(){var t=this._minMaxSpan={},e=this._dataZoomModel,i=this._dataExtent;Ap(["min","max"],function(n){var a=e.get(n+"Span"),s=e.get(n+"ValueSpan");s!=null&&(s=this.getAxisModel().axis.scale.parse(s)),s!=null?a=Jr(i[0]+s,i,[0,100],!0):a!=null&&(s=Jr(a,[0,100],i,!0)-i[0]),t[n+"Span"]=a,t[n+"ValueSpan"]=s},this)},r.prototype._setAxisModel=function(){var t=this.getAxisModel(),e=this._percentWindow,i=this._valueWindow;if(e){var n=MH(i,[0,500]);n=Math.min(n,20);var a=t.axis.scale.rawExtentInfo;e[0]!==0&&a.setDeterminedMinMax("min",+i[0].toFixed(n)),e[1]!==100&&a.setDeterminedMinMax("max",+i[1].toFixed(n)),a.freeze()}},r}();function okt(r,t,e){var i=[1/0,-1/0];Ap(e,function(s){Mwt(i,s.getData(),t)});var n=r.getAxisModel(),a=kG(n.axis.scale,n,i).calculate();return[a.min,a.max]}const lkt=skt;var ukt={getTargetSeries:function(r){function t(n){r.eachComponent("dataZoom",function(a){a.eachTargetAxis(function(s,o){var l=r.getComponent(Ic(s),o);n(s,o,l,a)})})}t(function(n,a,s,o){s.__dzAxisProxy=null});var e=[];t(function(n,a,s,o){s.__dzAxisProxy||(s.__dzAxisProxy=new lkt(n,a,o,r),e.push(s.__dzAxisProxy))});var i=Re();return J(e,function(n){J(n.getTargetSeriesModels(),function(a){i.set(a.uid,a)})}),i},overallReset:function(r,t){r.eachComponent("dataZoom",function(e){e.eachTargetAxis(function(i,n){e.getAxisProxy(i,n).reset(e)}),e.eachTargetAxis(function(i,n){e.getAxisProxy(i,n).filterData(e,t)})}),r.eachComponent("dataZoom",function(e){var i=e.findRepresentativeAxisProxy();if(i){var n=i.getDataPercentWindow(),a=i.getDataValueWindow();e.setCalculatedRange({start:n[0],end:n[1],startValue:a[0],endValue:a[1]})}})}};const ckt=ukt;function hkt(r){r.registerAction("dataZoom",function(t,e){var i=QLt(e,t);J(i,function(n){n.setRawRange({start:t.start,end:t.end,startValue:t.startValue,endValue:t.endValue})})})}var m6=!1;function AL(r){m6||(m6=!0,r.registerProcessor(r.PRIORITY.PROCESSOR.FILTER,ckt),hkt(r),r.registerSubTypeDefaulter("dataZoom",function(){return"slider"}))}function fkt(r){r.registerComponentModel(rkt),r.registerComponentView(akt),AL(r)}var Ks=function(){function r(){}return r}(),bZ={};function Cp(r,t){bZ[r]=t}function wZ(r){return bZ[r]}var dkt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(){r.prototype.optionUpdated.apply(this,arguments);var e=this.ecModel;J(this.option.feature,function(i,n){var a=wZ(n);a&&(a.getDefaultOption&&(a.defaultOption=a.getDefaultOption(e)),cr(i,a.defaultOption))})},t.type="toolbox",t.layoutMode={type:"box",ignoreSize:!0},t.defaultOption={show:!0,z:6,orient:"horizontal",left:"right",top:"top",backgroundColor:"transparent",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemSize:15,itemGap:8,showTitle:!0,iconStyle:{borderColor:"#666",color:"none"},emphasis:{iconStyle:{borderColor:"#3E98C5"}},tooltip:{show:!1,position:"bottom"}},t}(kr);const pkt=dkt;function gkt(r,t,e){var i=t.getBoxLayoutParams(),n=t.get("padding"),a={width:e.getWidth(),height:e.getHeight()},s=bn(i,a,n);Pf(t.get("orient"),r,t.get("itemGap"),s.width,s.height),FS(r,i,a,n)}function SZ(r,t){var e=Ng(t.get("padding")),i=t.getItemStyle(["color","opacity"]);return i.fill=t.get("backgroundColor"),r=new Pr({shape:{x:r.x-e[3],y:r.y-e[0],width:r.width+e[1]+e[3],height:r.height+e[0]+e[2],r:t.get("borderRadius")},style:i,silent:!0,z2:-1}),r}var vkt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.render=function(e,i,n,a){var s=this.group;if(s.removeAll(),!e.get("show"))return;var o=+e.get("itemSize"),l=e.get("orient")==="vertical",u=e.get("feature")||{},c=this._features||(this._features={}),h=[];J(u,function(y,x){h.push(x)}),new yu(this._featureNames||[],h).add(p).update(p).remove(nr(p,null)).execute(),this._featureNames=h;function p(y,x){var w=h[y],T=h[x],E=u[w],M=new fi(E,e,e.ecModel),L;if(a&&a.newTitle!=null&&a.featureName===w&&(E.title=a.newTitle),w&&!T){if(mkt(w))L={onclick:M.option.onclick,featureName:w};else{var F=wZ(w);if(!F)return;L=new F}c[w]=L}else if(L=c[T],!L)return;L.uid=Og("toolbox-feature"),L.model=M,L.ecModel=i,L.api=n;var O=L instanceof Ks;if(!w&&T){O&&L.dispose&&L.dispose(i,n);return}if(!M.get("show")||O&&L.unusable){O&&L.remove&&L.remove(i,n);return}v(M,L,w),M.setIconStatus=function(U,W){var H=this.option,j=this.iconPaths;H.iconStatus=H.iconStatus||{},H.iconStatus[U]=W,j[U]&&(W==="emphasis"?vu:mu)(j[U])},L instanceof Ks&&L.render&&L.render(M,i,n,a)}function v(y,x,w){var T=y.getModel("iconStyle"),E=y.getModel(["emphasis","iconStyle"]),M=x instanceof Ks&&x.getIcons?x.getIcons():y.get("icon"),L=y.get("title")||{},F,O;ve(M)?(F={},F[w]=M):F=M,ve(L)?(O={},O[w]=L):O=L;var U=y.iconPaths={};J(F,function(W,H){var j=R_(W,{},{x:-o/2,y:-o/2,width:o,height:o});j.setStyle(T.getItemStyle());var Y=j.ensureState("emphasis");Y.style=E.getItemStyle();var tt=new Nr({style:{text:O[H],align:E.get("textAlign"),borderRadius:E.get("textBorderRadius"),padding:E.get("textPadding"),fill:null,font:rD({fontStyle:E.get("textFontStyle"),fontFamily:E.get("textFontFamily"),fontSize:E.get("textFontSize"),fontWeight:E.get("textFontWeight")},i)},ignore:!0});j.setTextContent(tt),Lg({el:j,componentModel:e,itemName:H,formatterParamsExtra:{title:O[H]}}),j.__title=O[H],j.on("mouseover",function(){var it=E.getItemStyle(),lt=l?e.get("right")==null&&e.get("left")!=="right"?"right":"left":e.get("bottom")==null&&e.get("top")!=="bottom"?"bottom":"top";tt.setStyle({fill:E.get("textFill")||it.fill||it.stroke||"#000",backgroundColor:E.get("textBackgroundColor")}),j.setTextConfig({position:E.get("textPosition")||lt}),tt.ignore=!e.get("showTitle"),n.enterEmphasis(this)}).on("mouseout",function(){y.get(["iconStatus",H])!=="emphasis"&&n.leaveEmphasis(this),tt.hide()}),(y.get(["iconStatus",H])==="emphasis"?vu:mu)(j),s.add(j),j.on("click",we(x.onclick,x,i,n,H)),U[H]=j})}gkt(s,e,n),s.add(SZ(s.getBoundingRect(),e)),l||s.eachChild(function(y){var x=y.__title,w=y.ensureState("emphasis"),T=w.textConfig||(w.textConfig={}),E=y.getTextContent(),M=E&&E.ensureState("emphasis");if(M&&!Ve(M)&&x){var L=M.style||(M.style={}),F=C_(x,Nr.makeFont(L)),O=y.x+s.x,U=y.y+s.y+o,W=!1;U+F.height>n.getHeight()&&(T.position="top",W=!0);var H=W?-5-F.height:o+10;O+F.width/2>n.getWidth()?(T.position=["100%",H],L.align="right"):O-F.width/2<0&&(T.position=[0,H],L.align="left")}})},t.prototype.updateView=function(e,i,n,a){J(this._features,function(s){s instanceof Ks&&s.updateView&&s.updateView(s.model,i,n,a)})},t.prototype.remove=function(e,i){J(this._features,function(n){n instanceof Ks&&n.remove&&n.remove(e,i)}),this.group.removeAll()},t.prototype.dispose=function(e,i){J(this._features,function(n){n instanceof Ks&&n.dispose&&n.dispose(e,i)})},t.type="toolbox",t}($i);function mkt(r){return r.indexOf("my")===0}const ykt=vkt;var _kt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.onclick=function(e,i){var n=this.model,a=n.get("name")||e.get("title.0.text")||"echarts",s=i.getZr().painter.getType()==="svg",o=s?"svg":n.get("type",!0)||"png",l=i.getConnectedDataURL({type:o,backgroundColor:n.get("backgroundColor",!0)||e.get("backgroundColor")||"#fff",connectedBackgroundColor:n.get("connectedBackgroundColor"),excludeComponents:n.get("excludeComponents"),pixelRatio:n.get("pixelRatio")}),u=Or.browser;if(typeof MouseEvent=="function"&&(u.newEdge||!u.ie&&!u.edge)){var c=document.createElement("a");c.download=a+"."+o,c.target="_blank",c.href=l;var h=new MouseEvent("click",{view:document.defaultView,bubbles:!0,cancelable:!1});c.dispatchEvent(h)}else if(window.navigator.msSaveOrOpenBlob||s){var p=l.split(","),v=p[0].indexOf("base64")>-1,y=s?decodeURIComponent(p[1]):p[1];v&&(y=window.atob(y));var x=a+"."+o;if(window.navigator.msSaveOrOpenBlob){for(var w=y.length,T=new Uint8Array(w);w--;)T[w]=y.charCodeAt(w);var E=new Blob([T]);window.navigator.msSaveOrOpenBlob(E,x)}else{var M=document.createElement("iframe");document.body.appendChild(M);var L=M.contentWindow,F=L.document;F.open("image/svg+xml","replace"),F.write(y),F.close(),L.focus(),F.execCommand("SaveAs",!0,x),document.body.removeChild(M)}}else{var O=n.get("lang"),U='<body style="margin:0;"><img src="'+l+'" style="max-width:100%;" title="'+(O&&O[0]||"")+'" /></body>',W=window.open();W.document.write(U),W.document.title=a}},t.getDefaultOption=function(e){var i={show:!0,icon:"M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",title:e.getLocaleModel().get(["toolbox","saveAsImage","title"]),type:"png",connectedBackgroundColor:"#fff",name:"",excludeComponents:["toolbox"],lang:e.getLocaleModel().get(["toolbox","saveAsImage","lang"])};return i},t}(Ks);const xkt=_kt;var y6="__ec_magicType_stack__",bkt=[["line","bar"],["stack"]],wkt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getIcons=function(){var e=this.model,i=e.get("icon"),n={};return J(e.get("type"),function(a){i[a]&&(n[a]=i[a])}),n},t.getDefaultOption=function(e){var i={show:!0,type:[],icon:{line:"M4.1,28.9h7.1l9.3-22l7.4,38l9.7-19.7l3,12.8h14.9M4.1,58h51.4",bar:"M6.7,22.9h10V48h-10V22.9zM24.9,13h10v35h-10V13zM43.2,2h10v46h-10V2zM3.1,58h53.7",stack:"M8.2,38.4l-8.4,4.1l30.6,15.3L60,42.5l-8.1-4.1l-21.5,11L8.2,38.4z M51.9,30l-8.1,4.2l-13.4,6.9l-13.9-6.9L8.2,30l-8.4,4.2l8.4,4.2l22.2,11l21.5-11l8.1-4.2L51.9,30z M51.9,21.7l-8.1,4.2L35.7,30l-5.3,2.8L24.9,30l-8.4-4.1l-8.3-4.2l-8.4,4.2L8.2,30l8.3,4.2l13.9,6.9l13.4-6.9l8.1-4.2l8.1-4.1L51.9,21.7zM30.4,2.2L-0.2,17.5l8.4,4.1l8.3,4.2l8.4,4.2l5.5,2.7l5.3-2.7l8.1-4.2l8.1-4.2l8.1-4.1L30.4,2.2z"},title:e.getLocaleModel().get(["toolbox","magicType","title"]),option:{},seriesIndex:{}};return i},t.prototype.onclick=function(e,i,n){var a=this.model,s=a.get(["seriesIndex",n]);if(_6[n]){var o={series:[]},l=function(h){var p=h.subType,v=h.id,y=_6[n](p,v,h,a);y&&(We(y,h.option),o.series.push(y));var x=h.coordinateSystem;if(x&&x.type==="cartesian2d"&&(n==="line"||n==="bar")){var w=x.getAxesByScale("ordinal")[0];if(w){var T=w.dim,E=T+"Axis",M=h.getReferringComponents(E,vn).models[0],L=M.componentIndex;o[E]=o[E]||[];for(var F=0;F<=L;F++)o[E][L]=o[E][L]||{};o[E][L].boundaryGap=n==="bar"}}};J(bkt,function(h){pr(h,n)>=0&&J(h,function(p){a.setIconStatus(p,"normal")})}),a.setIconStatus(n,"emphasis"),e.eachComponent({mainType:"series",query:s==null?null:{seriesIndex:s}},l);var u,c=n;n==="stack"&&(u=cr({stack:a.option.title.tiled,tiled:a.option.title.stack},a.option.title),a.get(["iconStatus",n])!=="emphasis"&&(c="tiled")),i.dispatchAction({type:"changeMagicType",currentType:c,newOption:o,newTitle:u,featureName:"magicType"})}},t}(Ks),_6={line:function(r,t,e,i){if(r==="bar")return cr({id:t,type:"line",data:e.get("data"),stack:e.get("stack"),markPoint:e.get("markPoint"),markLine:e.get("markLine")},i.get(["option","line"])||{},!0)},bar:function(r,t,e,i){if(r==="line")return cr({id:t,type:"bar",data:e.get("data"),stack:e.get("stack"),markPoint:e.get("markPoint"),markLine:e.get("markLine")},i.get(["option","bar"])||{},!0)},stack:function(r,t,e,i){var n=e.get("stack")===y6;if(r==="line"||r==="bar")return i.setIconStatus("stack",n?"normal":"emphasis"),cr({id:t,stack:n?"":y6},i.get(["option","stack"])||{},!0)}};Il({type:"changeMagicType",event:"magicTypeChanged",update:"prepareAndUpdate"},function(r,t){t.mergeOption(r.newOption)});const Skt=wkt;var tT=new Array(60).join("-"),bg="	";function Tkt(r){var t={},e=[],i=[];return r.eachRawSeries(function(n){var a=n.coordinateSystem;if(a&&(a.type==="cartesian2d"||a.type==="polar")){var s=a.getBaseAxis();if(s.type==="category"){var o=s.dim+"_"+s.index;t[o]||(t[o]={categoryAxis:s,valueAxis:a.getOtherAxis(s),series:[]},i.push({axisDim:s.dim,axisIndex:s.index})),t[o].series.push(n)}else e.push(n)}else e.push(n)}),{seriesGroupByCategoryAxis:t,other:e,meta:i}}function Akt(r){var t=[];return J(r,function(e,i){var n=e.categoryAxis,a=e.valueAxis,s=a.dim,o=[" "].concat(te(e.series,function(v){return v.name})),l=[n.model.getCategories()];J(e.series,function(v){var y=v.getRawData();l.push(v.getRawData().mapArray(y.mapDimension(s),function(x){return x}))});for(var u=[o.join(bg)],c=0;c<l[0].length;c++){for(var h=[],p=0;p<l.length;p++)h.push(l[p][c]);u.push(h.join(bg))}t.push(u.join(`
`))}),t.join(`

`+tT+`

`)}function Ckt(r){return te(r,function(t){var e=t.getRawData(),i=[t.name],n=[];return e.each(e.dimensions,function(){for(var a=arguments.length,s=arguments[a-1],o=e.getName(s),l=0;l<a-1;l++)n[l]=arguments[l];i.push((o?o+bg:"")+n.join(bg))}),i.join(`
`)}).join(`

`+tT+`

`)}function Ekt(r){var t=Tkt(r);return{value:ti([Akt(t.seriesGroupByCategoryAxis),Ckt(t.other)],function(e){return!!e.replace(/[\n\t\s]/g,"")}).join(`

`+tT+`

`),meta:t.meta}}function Mw(r){return r.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Ikt(r){var t=r.slice(0,r.indexOf(`
`));if(t.indexOf(bg)>=0)return!0}var iP=new RegExp("["+bg+"]+","g");function Mkt(r){for(var t=r.split(/\n+/g),e=Mw(t.shift()).split(iP),i=[],n=te(e,function(l){return{name:l,data:[]}}),a=0;a<t.length;a++){var s=Mw(t[a]).split(iP);i.push(s.shift());for(var o=0;o<s.length;o++)n[o]&&(n[o].data[a]=s[o])}return{series:n,categories:i}}function Pkt(r){for(var t=r.split(/\n+/g),e=Mw(t.shift()),i=[],n=0;n<t.length;n++){var a=Mw(t[n]);if(a){var s=a.split(iP),o="",l=void 0,u=!1;isNaN(s[0])?(u=!0,o=s[0],s=s.slice(1),i[n]={name:o,value:[]},l=i[n].value):l=i[n]=[];for(var c=0;c<s.length;c++)l.push(+s[c]);l.length===1&&(u?i[n].value=l[0]:i[n]=l[0])}}return{name:e,data:i}}function Rkt(r,t){var e=r.split(new RegExp(`
*`+tT+`
*`,"g")),i={series:[]};return J(e,function(n,a){if(Ikt(n)){var s=Mkt(n),o=t[a],l=o.axisDim+"Axis";o&&(i[l]=i[l]||[],i[l][o.axisIndex]={data:s.categories},i.series=i.series.concat(s.series))}else{var s=Pkt(n);i.series.push(s)}}),i}var Dkt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.onclick=function(e,i){setTimeout(function(){i.dispatchAction({type:"hideTip"})});var n=i.getDom(),a=this.model;this._dom&&n.removeChild(this._dom);var s=document.createElement("div");s.style.cssText="position:absolute;top:0;bottom:0;left:0;right:0;padding:5px",s.style.backgroundColor=a.get("backgroundColor")||"#fff";var o=document.createElement("h4"),l=a.get("lang")||[];o.innerHTML=l[0]||a.get("title"),o.style.cssText="margin:10px 20px",o.style.color=a.get("textColor");var u=document.createElement("div"),c=document.createElement("textarea");u.style.cssText="overflow:auto";var h=a.get("optionToContent"),p=a.get("contentToOption"),v=Ekt(e);if(Ve(h)){var y=h(i.getOption());ve(y)?u.innerHTML=y:fg(y)&&u.appendChild(y)}else{c.readOnly=a.get("readOnly");var x=c.style;x.cssText="display:block;width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;resize:none;box-sizing:border-box;outline:none",x.color=a.get("textColor"),x.borderColor=a.get("textareaBorderColor"),x.backgroundColor=a.get("textareaColor"),c.value=v.value,u.appendChild(c)}var w=v.meta,T=document.createElement("div");T.style.cssText="position:absolute;bottom:5px;left:0;right:0";var E="float:right;margin-right:20px;border:none;cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px",M=document.createElement("div"),L=document.createElement("div");E+=";background-color:"+a.get("buttonColor"),E+=";color:"+a.get("buttonTextColor");var F=this;function O(){n.removeChild(s),F._dom=null}NI(M,"click",O),NI(L,"click",function(){if(p==null&&h!=null||p!=null&&h==null){O();return}var U;try{Ve(p)?U=p(u,i.getOption()):U=Rkt(c.value,w)}catch(W){throw O(),new Error("Data view format error "+W)}U&&i.dispatchAction({type:"changeDataView",newOption:U}),O()}),M.innerHTML=l[1],L.innerHTML=l[2],L.style.cssText=M.style.cssText=E,!a.get("readOnly")&&T.appendChild(L),T.appendChild(M),s.appendChild(o),s.appendChild(u),s.appendChild(T),u.style.height=n.clientHeight-80+"px",n.appendChild(s),this._dom=s},t.prototype.remove=function(e,i){this._dom&&i.getDom().removeChild(this._dom)},t.prototype.dispose=function(e,i){this.remove(e,i)},t.getDefaultOption=function(e){var i={show:!0,readOnly:!1,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:e.getLocaleModel().get(["toolbox","dataView","title"]),lang:e.getLocaleModel().get(["toolbox","dataView","lang"]),backgroundColor:"#fff",textColor:"#000",textareaColor:"#fff",textareaBorderColor:"#333",buttonColor:"#c23531",buttonTextColor:"#fff"};return i},t}(Ks);function Lkt(r,t){return te(r,function(e,i){var n=t&&t[i];if(je(n)&&!Kt(n)){var a=je(e)&&!Kt(e);a||(e={value:e});var s=n.name!=null&&e.name==null;return e=We(e,n),s&&delete e.name,e}else return e})}Il({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},function(r,t){var e=[];J(r.newOption.series,function(i){var n=t.getSeriesByName(i.name)[0];if(!n)e.push(Zt({type:"scatter"},i));else{var a=n.get("data");e.push({name:i.name,data:Lkt(i.data,a)})}}),t.mergeOption(We({series:e},r.newOption))});const kkt=Dkt;var TZ=J,AZ=Ir();function Okt(r,t){var e=CL(r);TZ(t,function(i,n){for(var a=e.length-1;a>=0;a--){var s=e[a];if(s[n])break}if(a<0){var o=r.queryComponents({mainType:"dataZoom",subType:"select",id:n})[0];if(o){var l=o.getPercentRange();e[0][n]={dataZoomId:n,start:l[0],end:l[1]}}}}),e.push(t)}function Nkt(r){var t=CL(r),e=t[t.length-1];t.length>1&&t.pop();var i={};return TZ(e,function(n,a){for(var s=t.length-1;s>=0;s--)if(n=t[s][a],n){i[a]=n;break}}),i}function Fkt(r){AZ(r).snapshots=null}function Bkt(r){return CL(r).length}function CL(r){var t=AZ(r);return t.snapshots||(t.snapshots=[{}]),t.snapshots}var zkt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.onclick=function(e,i){Fkt(e),i.dispatchAction({type:"restore",from:this.uid})},t.getDefaultOption=function(e){var i={show:!0,icon:"M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5",title:e.getLocaleModel().get(["toolbox","restore","title"])};return i},t}(Ks);Il({type:"restore",event:"restore",update:"prepareAndUpdate"},function(r,t){t.resetOption("recreate")});const Vkt=zkt;var Ukt=["grid","xAxis","yAxis","geo","graph","polar","radiusAxis","angleAxis","bmap"],$kt=function(){function r(t,e,i){var n=this;this._targetInfoList=[];var a=x6(e,t);J(Wkt,function(s,o){(!i||!i.include||pr(i.include,o)>=0)&&s(a,n._targetInfoList)})}return r.prototype.setOutputRanges=function(t,e){return this.matchOutputRanges(t,e,function(i,n,a){if((i.coordRanges||(i.coordRanges=[])).push(n),!i.coordRange){i.coordRange=n;var s=sE[i.brushType](0,a,n);i.__rangeOffset={offset:T6[i.brushType](s.values,i.range,[1,1]),xyMinMax:s.xyMinMax}}}),t},r.prototype.matchOutputRanges=function(t,e,i){J(t,function(n){var a=this.findTargetInfo(n,e);a&&a!==!0&&J(a.coordSyses,function(s){var o=sE[n.brushType](1,s,n.range,!0);i(n,o.values,s,e)})},this)},r.prototype.setInputRanges=function(t,e){J(t,function(i){var n=this.findTargetInfo(i,e);if(i.range=i.range||[],n&&n!==!0){i.panelId=n.panelId;var a=sE[i.brushType](0,n.coordSys,i.coordRange),s=i.__rangeOffset;i.range=s?T6[i.brushType](a.values,s.offset,Hkt(a.xyMinMax,s.xyMinMax)):a.values}},this)},r.prototype.makePanelOpts=function(t,e){return te(this._targetInfoList,function(i){var n=i.getPanelRect();return{panelId:i.panelId,defaultBrushType:e?e(i):null,clipPath:DX(n),isTargetByCursor:kX(n,t,i.coordSysModel),getLinearBrushOtherExtent:LX(n)}})},r.prototype.controlSeries=function(t,e,i){var n=this.findTargetInfo(t,i);return n===!0||n&&pr(n.coordSyses,e.coordinateSystem)>=0},r.prototype.findTargetInfo=function(t,e){for(var i=this._targetInfoList,n=x6(e,t),a=0;a<i.length;a++){var s=i[a],o=t.panelId;if(o){if(s.panelId===o)return s}else for(var l=0;l<b6.length;l++)if(b6[l](n,s))return s}return!0},r}();function nP(r){return r[0]>r[1]&&r.reverse(),r}function x6(r,t){return oy(r,t,{includeMainTypes:Ukt})}var Wkt={grid:function(r,t){var e=r.xAxisModels,i=r.yAxisModels,n=r.gridModels,a=Re(),s={},o={};!e&&!i&&!n||(J(e,function(l){var u=l.axis.grid.model;a.set(u.id,u),s[u.id]=!0}),J(i,function(l){var u=l.axis.grid.model;a.set(u.id,u),o[u.id]=!0}),J(n,function(l){a.set(l.id,l),s[l.id]=!0,o[l.id]=!0}),a.each(function(l){var u=l.coordinateSystem,c=[];J(u.getCartesians(),function(h,p){(pr(e,h.getAxis("x").model)>=0||pr(i,h.getAxis("y").model)>=0)&&c.push(h)}),t.push({panelId:"grid--"+l.id,gridModel:l,coordSysModel:l,coordSys:c[0],coordSyses:c,getPanelRect:w6.grid,xAxisDeclared:s[l.id],yAxisDeclared:o[l.id]})}))},geo:function(r,t){J(r.geoModels,function(e){var i=e.coordinateSystem;t.push({panelId:"geo--"+e.id,geoModel:e,coordSysModel:e,coordSys:i,coordSyses:[i],getPanelRect:w6.geo})})}},b6=[function(r,t){var e=r.xAxisModel,i=r.yAxisModel,n=r.gridModel;return!n&&e&&(n=e.axis.grid.model),!n&&i&&(n=i.axis.grid.model),n&&n===t.gridModel},function(r,t){var e=r.geoModel;return e&&e===t.geoModel}],w6={grid:function(){return this.coordSys.master.getRect().clone()},geo:function(){var r=this.coordSys,t=r.getBoundingRect().clone();return t.applyTransform(Mf(r)),t}},sE={lineX:nr(S6,0),lineY:nr(S6,1),rect:function(r,t,e,i){var n=r?t.pointToData([e[0][0],e[1][0]],i):t.dataToPoint([e[0][0],e[1][0]],i),a=r?t.pointToData([e[0][1],e[1][1]],i):t.dataToPoint([e[0][1],e[1][1]],i),s=[nP([n[0],a[0]]),nP([n[1],a[1]])];return{values:s,xyMinMax:s}},polygon:function(r,t,e,i){var n=[[1/0,-1/0],[1/0,-1/0]],a=te(e,function(s){var o=r?t.pointToData(s,i):t.dataToPoint(s,i);return n[0][0]=Math.min(n[0][0],o[0]),n[1][0]=Math.min(n[1][0],o[1]),n[0][1]=Math.max(n[0][1],o[0]),n[1][1]=Math.max(n[1][1],o[1]),o});return{values:a,xyMinMax:n}}};function S6(r,t,e,i){var n=e.getAxis(["x","y"][r]),a=nP(te([0,1],function(o){return t?n.coordToData(n.toLocalCoord(i[o]),!0):n.toGlobalCoord(n.dataToCoord(i[o]))})),s=[];return s[r]=a,s[1-r]=[NaN,NaN],{values:a,xyMinMax:s}}var T6={lineX:nr(A6,0),lineY:nr(A6,1),rect:function(r,t,e){return[[r[0][0]-e[0]*t[0][0],r[0][1]-e[0]*t[0][1]],[r[1][0]-e[1]*t[1][0],r[1][1]-e[1]*t[1][1]]]},polygon:function(r,t,e){return te(r,function(i,n){return[i[0]-e[0]*t[n][0],i[1]-e[1]*t[n][1]]})}};function A6(r,t,e,i){return[t[0]-i[r]*e[0],t[1]-i[r]*e[1]]}function Hkt(r,t){var e=C6(r),i=C6(t),n=[e[0]/i[0],e[1]/i[1]];return isNaN(n[0])&&(n[0]=1),isNaN(n[1])&&(n[1]=1),n}function C6(r){return r?[r[0][1]-r[0][0],r[1][1]-r[1][0]]:[NaN,NaN]}const EL=$kt;var aP=J,Gkt=hyt("toolbox-dataZoom_"),jkt=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.render=function(e,i,n,a){this._brushController||(this._brushController=new oL(n.getZr()),this._brushController.on("brush",we(this._onBrush,this)).mount()),qkt(e,i,this,a,n),Zkt(e,i)},t.prototype.onclick=function(e,i,n){Xkt[n].call(this)},t.prototype.remove=function(e,i){this._brushController&&this._brushController.unmount()},t.prototype.dispose=function(e,i){this._brushController&&this._brushController.dispose()},t.prototype._onBrush=function(e){var i=e.areas;if(!e.isEnd||!i.length)return;var n={},a=this.ecModel;this._brushController.updateCovers([]);var s=new EL(IL(this.model),a,{include:["grid"]});s.matchOutputRanges(i,a,function(u,c,h){if(h.type==="cartesian2d"){var p=u.brushType;p==="rect"?(o("x",h,c[0]),o("y",h,c[1])):o({lineX:"x",lineY:"y"}[p],h,c)}}),Okt(a,n),this._dispatchZoomAction(n);function o(u,c,h){var p=c.getAxis(u),v=p.model,y=l(u,v,a),x=y.findRepresentativeAxisProxy(v).getMinMaxSpan();(x.minValueSpan!=null||x.maxValueSpan!=null)&&(h=od(0,h.slice(),p.scale.getExtent(),0,x.minValueSpan,x.maxValueSpan)),y&&(n[y.id]={dataZoomId:y.id,startValue:h[0],endValue:h[1]})}function l(u,c,h){var p;return h.eachComponent({mainType:"dataZoom",subType:"select"},function(v){var y=v.getAxisModel(u,c.componentIndex);y&&(p=v)}),p}},t.prototype._dispatchZoomAction=function(e){var i=[];aP(e,function(n,a){i.push(Ze(n))}),i.length&&this.api.dispatchAction({type:"dataZoom",from:this.uid,batch:i})},t.getDefaultOption=function(e){var i={show:!0,filterMode:"filter",icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:e.getLocaleModel().get(["toolbox","dataZoom","title"]),brushStyle:{borderWidth:0,color:"rgba(210,219,238,0.2)"}};return i},t}(Ks),Xkt={zoom:function(){var r=!this._isZoomActive;this.api.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:r})},back:function(){this._dispatchZoomAction(Nkt(this.ecModel))}};function IL(r){var t={xAxisIndex:r.get("xAxisIndex",!0),yAxisIndex:r.get("yAxisIndex",!0),xAxisId:r.get("xAxisId",!0),yAxisId:r.get("yAxisId",!0)};return t.xAxisIndex==null&&t.xAxisId==null&&(t.xAxisIndex="all"),t.yAxisIndex==null&&t.yAxisId==null&&(t.yAxisIndex="all"),t}function Zkt(r,t){r.setIconStatus("back",Bkt(t)>1?"emphasis":"normal")}function qkt(r,t,e,i,n){var a=e._isZoomActive;i&&i.type==="takeGlobalCursor"&&(a=i.key==="dataZoomSelect"?i.dataZoomSelectActive:!1),e._isZoomActive=a,r.setIconStatus("zoom",a?"emphasis":"normal");var s=new EL(IL(r),t,{include:["grid"]}),o=s.makePanelOpts(n,function(l){return l.xAxisDeclared&&!l.yAxisDeclared?"lineX":!l.xAxisDeclared&&l.yAxisDeclared?"lineY":"rect"});e._brushController.setPanels(o).enableBrush(a&&o.length?{brushType:"auto",brushStyle:r.getModel("brushStyle").getItemStyle()}:!1)}j0t("dataZoom",function(r){var t=r.getComponent("toolbox",0),e=["feature","dataZoom"];if(!t||t.get(e)==null)return;var i=t.getModel(e),n=[],a=IL(i),s=oy(r,a);aP(s.xAxisModels,function(l){return o(l,"xAxis","xAxisIndex")}),aP(s.yAxisModels,function(l){return o(l,"yAxis","yAxisIndex")});function o(l,u,c){var h=l.componentIndex,p={type:"select",$fromToolbox:!0,filterMode:i.get("filterMode",!0)||"filter",id:Gkt+u+h};p[c]=h,n.push(p)}return n});const Ykt=jkt;function Kkt(r){r.registerComponentModel(pkt),r.registerComponentView(ykt),Cp("saveAsImage",xkt),Cp("magicType",Skt),Cp("dataView",kkt),Cp("dataZoom",Ykt),Cp("restore",Vkt),gr(fkt)}var Jkt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="tooltip",t.dependencies=["axisPointer"],t.defaultOption={z:60,show:!0,showContent:!0,trigger:"item",triggerOn:"mousemove|click",alwaysShowContent:!1,displayMode:"single",renderMode:"auto",confine:null,showDelay:0,hideDelay:100,transitionDuration:.4,enterable:!1,backgroundColor:"#fff",shadowBlur:10,shadowColor:"rgba(0, 0, 0, .2)",shadowOffsetX:1,shadowOffsetY:2,borderRadius:4,borderWidth:1,padding:null,extraCssText:"",axisPointer:{type:"line",axis:"auto",animation:"auto",animationDurationUpdate:200,animationEasingUpdate:"exponentialOut",crossStyle:{color:"#999",width:1,type:"dashed",textStyle:{}}},textStyle:{color:"#666",fontSize:14}},t}(kr);const Qkt=Jkt;function CZ(r){var t=r.get("confine");return t!=null?!!t:r.get("renderMode")==="richText"}function EZ(r){if(Or.domSupported){for(var t=document.documentElement.style,e=0,i=r.length;e<i;e++)if(r[e]in t)return r[e]}}var IZ=EZ(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),t3t=EZ(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);function MZ(r,t){if(!r)return t;t=K7(t,!0);var e=r.indexOf(t);return r=e===-1?t:"-"+r.slice(0,e)+"-"+t,r.toLowerCase()}function e3t(r,t){var e=r.currentStyle||document.defaultView&&document.defaultView.getComputedStyle(r);return e?t?e[t]:e:null}var r3t=MZ(t3t,"transition"),ML=MZ(IZ,"transform"),i3t="position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;"+(Or.transform3dSupported?"will-change:transform;":"");function n3t(r){return r=r==="left"?"right":r==="right"?"left":r==="top"?"bottom":"top",r}function a3t(r,t,e){if(!ve(e)||e==="inside")return"";var i=r.get("backgroundColor"),n=r.get("borderWidth");t=jf(t);var a=n3t(e),s=Math.max(Math.round(n)*1.5,6),o="",l=ML+":",u;pr(["left","right"],a)>-1?(o+="top:50%",l+="translateY(-50%) rotate("+(u=a==="left"?-225:-45)+"deg)"):(o+="left:50%",l+="translateX(-50%) rotate("+(u=a==="top"?225:45)+"deg)");var c=u*Math.PI/180,h=s+n,p=h*Math.abs(Math.cos(c))+h*Math.abs(Math.sin(c)),v=Math.round(((p-Math.SQRT2*n)/2+Math.SQRT2*n-(p-h)/2)*100)/100;o+=";"+a+":-"+v+"px";var y=t+" solid "+n+"px;",x=["position:absolute;width:"+s+"px;height:"+s+"px;z-index:-1;",o+";"+l+";","border-bottom:"+y,"border-right:"+y,"background-color:"+i+";"];return'<div style="'+x.join("")+'"></div>'}function s3t(r,t){var e="cubic-bezier(0.23,1,0.32,1)",i=" "+r/2+"s "+e,n="opacity"+i+",visibility"+i;return t||(i=" "+r+"s "+e,n+=Or.transformSupported?","+ML+i:",left"+i+",top"+i),r3t+":"+n}function E6(r,t,e){var i=r.toFixed(0)+"px",n=t.toFixed(0)+"px";if(!Or.transformSupported)return e?"top:"+n+";left:"+i+";":[["top",n],["left",i]];var a=Or.transform3dSupported,s="translate"+(a?"3d":"")+"("+i+","+n+(a?",0":"")+")";return e?"top:0;left:0;"+ML+":"+s+";":[["top",0],["left",0],[IZ,s]]}function o3t(r){var t=[],e=r.get("fontSize"),i=r.getTextColor();i&&t.push("color:"+i),t.push("font:"+r.getFont()),e&&t.push("line-height:"+Math.round(e*3/2)+"px");var n=r.get("textShadowColor"),a=r.get("textShadowBlur")||0,s=r.get("textShadowOffsetX")||0,o=r.get("textShadowOffsetY")||0;return n&&a&&t.push("text-shadow:"+s+"px "+o+"px "+a+"px "+n),J(["decoration","align"],function(l){var u=r.get(l);u&&t.push("text-"+l+":"+u)}),t.join(";")}function l3t(r,t,e){var i=[],n=r.get("transitionDuration"),a=r.get("backgroundColor"),s=r.get("shadowBlur"),o=r.get("shadowColor"),l=r.get("shadowOffsetX"),u=r.get("shadowOffsetY"),c=r.getModel("textStyle"),h=L9(r,"html"),p=l+"px "+u+"px "+s+"px "+o;return i.push("box-shadow:"+p),t&&n&&i.push(s3t(n,e)),a&&i.push("background-color:"+a),J(["width","color","radius"],function(v){var y="border-"+v,x=K7(y),w=r.get(x);w!=null&&i.push(y+":"+w+(v==="color"?"":"px"))}),i.push(o3t(c)),h!=null&&i.push("padding:"+Ng(h).join("px ")+"px"),i.join(";")+";"}function I6(r,t,e,i,n){var a=t&&t.painter;if(e){var s=a&&a.getViewportRoot();s&&kvt(r,s,e,i,n)}else{r[0]=i,r[1]=n;var o=a&&a.getViewportRootOffset();o&&(r[0]+=o.offsetLeft,r[1]+=o.offsetTop)}r[2]=r[0]/t.getWidth(),r[3]=r[1]/t.getHeight()}var u3t=function(){function r(t,e){if(this._show=!1,this._styleCoord=[0,0,0,0],this._enterable=!0,this._alwaysShowContent=!1,this._firstShow=!0,this._longHide=!0,Or.wxa)return null;var i=document.createElement("div");i.domBelongToZr=!0,this.el=i;var n=this._zr=t.getZr(),a=e.appendTo,s=a&&(ve(a)?document.querySelector(a):fg(a)?a:Ve(a)&&a(t.getDom()));I6(this._styleCoord,n,s,t.getWidth()/2,t.getHeight()/2),(s||t.getDom()).appendChild(i),this._api=t,this._container=s;var o=this;i.onmouseenter=function(){o._enterable&&(clearTimeout(o._hideTimeout),o._show=!0),o._inContent=!0},i.onmousemove=function(l){if(l=l||window.event,!o._enterable){var u=n.handler,c=n.painter.getViewportRoot();Gs(c,l,!0),u.dispatch("mousemove",l)}},i.onmouseleave=function(){o._inContent=!1,o._enterable&&o._show&&o.hideLater(o._hideDelay)}}return r.prototype.update=function(t){if(!this._container){var e=this._api.getDom(),i=e3t(e,"position"),n=e.style;n.position!=="absolute"&&i!=="absolute"&&(n.position="relative")}var a=t.get("alwaysShowContent");a&&this._moveIfResized(),this._alwaysShowContent=a,this.el.className=t.get("className")||""},r.prototype.show=function(t,e){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var i=this.el,n=i.style,a=this._styleCoord;i.innerHTML?n.cssText=i3t+l3t(t,!this._firstShow,this._longHide)+E6(a[0],a[1],!0)+("border-color:"+jf(e)+";")+(t.get("extraCssText")||"")+(";pointer-events:"+(this._enterable?"auto":"none")):n.display="none",this._show=!0,this._firstShow=!1,this._longHide=!1},r.prototype.setContent=function(t,e,i,n,a){var s=this.el;if(t==null){s.innerHTML="";return}var o="";if(ve(a)&&i.get("trigger")==="item"&&!CZ(i)&&(o=a3t(i,n,a)),ve(t))s.innerHTML=t+o;else if(t){s.innerHTML="",Kt(t)||(t=[t]);for(var l=0;l<t.length;l++)fg(t[l])&&t[l].parentNode!==s&&s.appendChild(t[l]);if(o&&s.childNodes.length){var u=document.createElement("div");u.innerHTML=o,s.appendChild(u)}}},r.prototype.setEnterable=function(t){this._enterable=t},r.prototype.getSize=function(){var t=this.el;return[t.offsetWidth,t.offsetHeight]},r.prototype.moveTo=function(t,e){var i=this._styleCoord;if(I6(i,this._zr,this._container,t,e),i[0]!=null&&i[1]!=null){var n=this.el.style,a=E6(i[0],i[1]);J(a,function(s){n[s[0]]=s[1]})}},r.prototype._moveIfResized=function(){var t=this._styleCoord[2],e=this._styleCoord[3];this.moveTo(t*this._zr.getWidth(),e*this._zr.getHeight())},r.prototype.hide=function(){var t=this,e=this.el.style;e.visibility="hidden",e.opacity="0",Or.transform3dSupported&&(e.willChange=""),this._show=!1,this._longHideTimeout=setTimeout(function(){return t._longHide=!0},500)},r.prototype.hideLater=function(t){this._show&&!(this._inContent&&this._enterable)&&!this._alwaysShowContent&&(t?(this._hideDelay=t,this._show=!1,this._hideTimeout=setTimeout(we(this.hide,this),t)):this.hide())},r.prototype.isShow=function(){return this._show},r.prototype.dispose=function(){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var t=this.el.parentNode;t&&t.removeChild(this.el),this.el=this._container=null},r}();const c3t=u3t;var h3t=function(){function r(t){this._show=!1,this._styleCoord=[0,0,0,0],this._alwaysShowContent=!1,this._enterable=!0,this._zr=t.getZr(),P6(this._styleCoord,this._zr,t.getWidth()/2,t.getHeight()/2)}return r.prototype.update=function(t){var e=t.get("alwaysShowContent");e&&this._moveIfResized(),this._alwaysShowContent=e},r.prototype.show=function(){this._hideTimeout&&clearTimeout(this._hideTimeout),this.el.show(),this._show=!0},r.prototype.setContent=function(t,e,i,n,a){var s=this;je(t)&&jr(""),this.el&&this._zr.remove(this.el);var o=i.getModel("textStyle");this.el=new Nr({style:{rich:e.richTextStyles,text:t,lineHeight:22,borderWidth:1,borderColor:n,textShadowColor:o.get("textShadowColor"),fill:i.get(["textStyle","color"]),padding:L9(i,"richText"),verticalAlign:"top",align:"left"},z:i.get("z")}),J(["backgroundColor","borderRadius","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"],function(u){s.el.style[u]=i.get(u)}),J(["textShadowBlur","textShadowOffsetX","textShadowOffsetY"],function(u){s.el.style[u]=o.get(u)||0}),this._zr.add(this.el);var l=this;this.el.on("mouseover",function(){l._enterable&&(clearTimeout(l._hideTimeout),l._show=!0),l._inContent=!0}),this.el.on("mouseout",function(){l._enterable&&l._show&&l.hideLater(l._hideDelay),l._inContent=!1})},r.prototype.setEnterable=function(t){this._enterable=t},r.prototype.getSize=function(){var t=this.el,e=this.el.getBoundingRect(),i=M6(t.style);return[e.width+i.left+i.right,e.height+i.top+i.bottom]},r.prototype.moveTo=function(t,e){var i=this.el;if(i){var n=this._styleCoord;P6(n,this._zr,t,e),t=n[0],e=n[1];var a=i.style,s=sc(a.borderWidth||0),o=M6(a);i.x=t+s+o.left,i.y=e+s+o.top,i.markRedraw()}},r.prototype._moveIfResized=function(){var t=this._styleCoord[2],e=this._styleCoord[3];this.moveTo(t*this._zr.getWidth(),e*this._zr.getHeight())},r.prototype.hide=function(){this.el&&this.el.hide(),this._show=!1},r.prototype.hideLater=function(t){this._show&&!(this._inContent&&this._enterable)&&!this._alwaysShowContent&&(t?(this._hideDelay=t,this._show=!1,this._hideTimeout=setTimeout(we(this.hide,this),t)):this.hide())},r.prototype.isShow=function(){return this._show},r.prototype.dispose=function(){this._zr.remove(this.el)},r}();function sc(r){return Math.max(0,r)}function M6(r){var t=sc(r.shadowBlur||0),e=sc(r.shadowOffsetX||0),i=sc(r.shadowOffsetY||0);return{left:sc(t-e),right:sc(t+e),top:sc(t-i),bottom:sc(t+i)}}function P6(r,t,e,i){r[0]=e,r[1]=i,r[2]=r[0]/t.getWidth(),r[3]=r[1]/t.getHeight()}const f3t=h3t;var d3t=new Pr({shape:{x:-1,y:-1,width:2,height:2}}),p3t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,i){if(!(Or.node||!i.getDom())){var n=e.getComponent("tooltip"),a=this._renderMode=yyt(n.get("renderMode"));this._tooltipContent=a==="richText"?new f3t(i):new c3t(i,{appendTo:n.get("appendToBody",!0)?"body":n.get("appendTo",!0)})}},t.prototype.render=function(e,i,n){if(!(Or.node||!n.getDom())){this.group.removeAll(),this._tooltipModel=e,this._ecModel=i,this._api=n;var a=this._tooltipContent;a.update(e),a.setEnterable(e.get("enterable")),this._initGlobalListener(),this._keepShow(),this._renderMode!=="richText"&&e.get("transitionDuration")?Ug(this,"_updatePosition",50,"fixRate"):Jy(this,"_updatePosition")}},t.prototype._initGlobalListener=function(){var e=this._tooltipModel,i=e.get("triggerOn");fZ("itemTooltip",this._api,we(function(n,a,s){i!=="none"&&(i.indexOf(n)>=0?this._tryShow(a,s):n==="leave"&&this._hide(s))},this))},t.prototype._keepShow=function(){var e=this._tooltipModel,i=this._ecModel,n=this._api,a=e.get("triggerOn");if(this._lastX!=null&&this._lastY!=null&&a!=="none"&&a!=="click"){var s=this;clearTimeout(this._refreshUpdateTimeout),this._refreshUpdateTimeout=setTimeout(function(){!n.isDisposed()&&s.manuallyShowTip(e,i,n,{x:s._lastX,y:s._lastY,dataByCoordSys:s._lastDataByCoordSys})})}},t.prototype.manuallyShowTip=function(e,i,n,a){if(!(a.from===this.uid||Or.node||!n.getDom())){var s=R6(a,n);this._ticket="";var o=a.dataByCoordSys,l=y3t(a,i,n);if(l){var u=l.el.getBoundingRect().clone();u.applyTransform(l.el.transform),this._tryShow({offsetX:u.x+u.width/2,offsetY:u.y+u.height/2,target:l.el,position:a.position,positionDefault:"bottom"},s)}else if(a.tooltip&&a.x!=null&&a.y!=null){var c=d3t;c.x=a.x,c.y=a.y,c.update(),Je(c).tooltipConfig={name:null,option:a.tooltip},this._tryShow({offsetX:a.x,offsetY:a.y,target:c},s)}else if(o)this._tryShow({offsetX:a.x,offsetY:a.y,position:a.position,dataByCoordSys:o,tooltipOption:a.tooltipOption},s);else if(a.seriesIndex!=null){if(this._manuallyAxisShowTip(e,i,n,a))return;var h=dZ(a,i),p=h.point[0],v=h.point[1];p!=null&&v!=null&&this._tryShow({offsetX:p,offsetY:v,target:h.el,position:a.position,positionDefault:"bottom"},s)}else a.x!=null&&a.y!=null&&(n.dispatchAction({type:"updateAxisPointer",x:a.x,y:a.y}),this._tryShow({offsetX:a.x,offsetY:a.y,position:a.position,target:n.getZr().findHover(a.x,a.y).target},s))}},t.prototype.manuallyHideTip=function(e,i,n,a){var s=this._tooltipContent;this._tooltipModel&&s.hideLater(this._tooltipModel.get("hideDelay")),this._lastX=this._lastY=this._lastDataByCoordSys=null,a.from!==this.uid&&this._hide(R6(a,n))},t.prototype._manuallyAxisShowTip=function(e,i,n,a){var s=a.seriesIndex,o=a.dataIndex,l=i.getComponent("axisPointer").coordSysAxesInfo;if(!(s==null||o==null||l==null)){var u=i.getSeriesByIndex(s);if(u){var c=u.getData(),h=Cm([c.getItemModel(o),u,(u.coordinateSystem||{}).model],this._tooltipModel);if(h.get("trigger")==="axis")return n.dispatchAction({type:"updateAxisPointer",seriesIndex:s,dataIndex:o,position:a.position}),!0}}},t.prototype._tryShow=function(e,i){var n=e.target,a=this._tooltipModel;if(a){this._lastX=e.offsetX,this._lastY=e.offsetY;var s=e.dataByCoordSys;if(s&&s.length)this._showAxisTooltip(s,e);else if(n){var o=Je(n);if(o.ssrType==="legend")return;this._lastDataByCoordSys=null;var l,u;mf(n,function(c){if(Je(c).dataIndex!=null)return l=c,!0;if(Je(c).tooltipConfig!=null)return u=c,!0},!0),l?this._showSeriesItemTooltip(e,l,i):u?this._showComponentItemTooltip(e,u,i):this._hide(i)}else this._lastDataByCoordSys=null,this._hide(i)}},t.prototype._showOrMove=function(e,i){var n=e.get("showDelay");i=we(i,this),clearTimeout(this._showTimout),n>0?this._showTimout=setTimeout(i,n):i()},t.prototype._showAxisTooltip=function(e,i){var n=this._ecModel,a=this._tooltipModel,s=[i.offsetX,i.offsetY],o=Cm([i.tooltipOption],a),l=this._renderMode,u=[],c=Ln("section",{blocks:[],noHeader:!0}),h=[],p=new H2;J(e,function(E){J(E.dataByAxis,function(M){var L=n.getComponent(M.axisDim+"Axis",M.axisIndex),F=M.value;if(!(!L||F==null)){var O=uZ(F,L.axis,n,M.seriesDataIndices,M.valueLabelOpt),U=Ln("section",{header:O,noHeader:!ko(O),sortBlocks:!0,blocks:[]});c.blocks.push(U),J(M.seriesDataIndices,function(W){var H=n.getSeriesByIndex(W.seriesIndex),j=W.dataIndexInside,Y=H.getDataParams(j);if(!(Y.dataIndex<0)){Y.axisDim=M.axisDim,Y.axisIndex=M.axisIndex,Y.axisType=M.axisType,Y.axisId=M.axisId,Y.axisValue=PD(L.axis,{value:F}),Y.axisValueLabel=O,Y.marker=p.makeTooltipMarker("item",jf(Y.color),l);var tt=gz(H.formatTooltip(j,!0,null)),it=tt.frag;if(it){var lt=Cm([H],a).get("valueFormatter");U.blocks.push(lt?Zt({valueFormatter:lt},it):it)}tt.text&&h.push(tt.text),u.push(Y)}})}})}),c.blocks.reverse(),h.reverse();var v=i.position,y=o.get("order"),x=bz(c,p,l,y,n.get("useUTC"),o.get("textStyle"));x&&h.unshift(x);var w=l==="richText"?`

`:"<br/>",T=h.join(w);this._showOrMove(o,function(){this._updateContentNotChangedOnAxis(e,u)?this._updatePosition(o,v,s[0],s[1],this._tooltipContent,u):this._showTooltipContent(o,T,u,Math.random()+"",s[0],s[1],v,null,p)})},t.prototype._showSeriesItemTooltip=function(e,i,n){var a=this._ecModel,s=Je(i),o=s.seriesIndex,l=a.getSeriesByIndex(o),u=s.dataModel||l,c=s.dataIndex,h=s.dataType,p=u.getData(h),v=this._renderMode,y=e.positionDefault,x=Cm([p.getItemModel(c),u,l&&(l.coordinateSystem||{}).model],this._tooltipModel,y?{position:y}:null),w=x.get("trigger");if(!(w!=null&&w!=="item")){var T=u.getDataParams(c,h),E=new H2;T.marker=E.makeTooltipMarker("item",jf(T.color),v);var M=gz(u.formatTooltip(c,!1,h)),L=x.get("order"),F=x.get("valueFormatter"),O=M.frag,U=O?bz(F?Zt({valueFormatter:F},O):O,E,v,L,a.get("useUTC"),x.get("textStyle")):M.text,W="item_"+u.name+"_"+c;this._showOrMove(x,function(){this._showTooltipContent(x,U,T,W,e.offsetX,e.offsetY,e.position,e.target,E)}),n({type:"showTip",dataIndexInside:c,dataIndex:p.getRawIndex(c),seriesIndex:o,from:this.uid})}},t.prototype._showComponentItemTooltip=function(e,i,n){var a=this._renderMode==="html",s=Je(i),o=s.tooltipConfig,l=o.option||{},u=l.encodeHTMLContent;if(ve(l)){var c=l;l={content:c,formatter:c},u=!0}u&&a&&l.content&&(l=Ze(l),l.content=Ga(l.content));var h=[l],p=this._ecModel.getComponent(s.componentMainType,s.componentIndex);p&&h.push(p),h.push({formatter:l.content});var v=e.positionDefault,y=Cm(h,this._tooltipModel,v?{position:v}:null),x=y.get("content"),w=Math.random()+"",T=new H2;this._showOrMove(y,function(){var E=Ze(y.get("formatterParams")||{});this._showTooltipContent(y,x,E,w,e.offsetX,e.offsetY,e.position,i,T)}),n({type:"showTip",from:this.uid})},t.prototype._showTooltipContent=function(e,i,n,a,s,o,l,u,c){if(this._ticket="",!(!e.get("showContent")||!e.get("show"))){var h=this._tooltipContent;h.setEnterable(e.get("enterable"));var p=e.get("formatter");l=l||e.get("position");var v=i,y=this._getNearestPoint([s,o],n,e.get("trigger"),e.get("borderColor")),x=y.color;if(p)if(ve(p)){var w=e.ecModel.get("useUTC"),T=Kt(n)?n[0]:n,E=T&&T.axisType&&T.axisType.indexOf("time")>=0;v=p,E&&(v=DS(T.axisValue,v,w)),v=J7(v,n,!0)}else if(Ve(p)){var M=we(function(L,F){L===this._ticket&&(h.setContent(F,c,e,x,l),this._updatePosition(e,l,s,o,h,n,u))},this);this._ticket=a,v=p(n,a,M)}else v=p;h.setContent(v,c,e,x,l),h.show(e,x),this._updatePosition(e,l,s,o,h,n,u)}},t.prototype._getNearestPoint=function(e,i,n,a){if(n==="axis"||Kt(i))return{color:a||(this._renderMode==="html"?"#fff":"none")};if(!Kt(i))return{color:a||i.color||i.borderColor}},t.prototype._updatePosition=function(e,i,n,a,s,o,l){var u=this._api.getWidth(),c=this._api.getHeight();i=i||e.get("position");var h=s.getSize(),p=e.get("align"),v=e.get("verticalAlign"),y=l&&l.getBoundingRect().clone();if(l&&y.applyTransform(l.transform),Ve(i)&&(i=i([n,a],o,s.el,y,{viewSize:[u,c],contentSize:h.slice()})),Kt(i))n=he(i[0],u),a=he(i[1],c);else if(je(i)){var x=i;x.width=h[0],x.height=h[1];var w=bn(x,{width:u,height:c});n=w.x,a=w.y,p=null,v=null}else if(ve(i)&&l){var T=m3t(i,y,h,e.get("borderWidth"));n=T[0],a=T[1]}else{var T=g3t(n,a,s,u,c,p?null:20,v?null:20);n=T[0],a=T[1]}if(p&&(n-=D6(p)?h[0]/2:p==="right"?h[0]:0),v&&(a-=D6(v)?h[1]/2:v==="bottom"?h[1]:0),CZ(e)){var T=v3t(n,a,s,u,c);n=T[0],a=T[1]}s.moveTo(n,a)},t.prototype._updateContentNotChangedOnAxis=function(e,i){var n=this._lastDataByCoordSys,a=this._cbParamsList,s=!!n&&n.length===e.length;return s&&J(n,function(o,l){var u=o.dataByAxis||[],c=e[l]||{},h=c.dataByAxis||[];s=s&&u.length===h.length,s&&J(u,function(p,v){var y=h[v]||{},x=p.seriesDataIndices||[],w=y.seriesDataIndices||[];s=s&&p.value===y.value&&p.axisType===y.axisType&&p.axisId===y.axisId&&x.length===w.length,s&&J(x,function(T,E){var M=w[E];s=s&&T.seriesIndex===M.seriesIndex&&T.dataIndex===M.dataIndex}),a&&J(p.seriesDataIndices,function(T){var E=T.seriesIndex,M=i[E],L=a[E];M&&L&&L.data!==M.data&&(s=!1)})})}),this._lastDataByCoordSys=e,this._cbParamsList=i,!!s},t.prototype._hide=function(e){this._lastDataByCoordSys=null,e({type:"hideTip",from:this.uid})},t.prototype.dispose=function(e,i){Or.node||!i.getDom()||(Jy(this,"_updatePosition"),this._tooltipContent.dispose(),tP("itemTooltip",i))},t.type="tooltip",t}($i);function Cm(r,t,e){var i=t.ecModel,n;e?(n=new fi(e,i,i),n=new fi(t.option,n,i)):n=t;for(var a=r.length-1;a>=0;a--){var s=r[a];s&&(s instanceof fi&&(s=s.get("tooltip",!0)),ve(s)&&(s={formatter:s}),s&&(n=new fi(s,n,i)))}return n}function R6(r,t){return r.dispatchAction||we(t.dispatchAction,t)}function g3t(r,t,e,i,n,a,s){var o=e.getSize(),l=o[0],u=o[1];return a!=null&&(r+l+a+2>i?r-=l+a:r+=a),s!=null&&(t+u+s>n?t-=u+s:t+=s),[r,t]}function v3t(r,t,e,i,n){var a=e.getSize(),s=a[0],o=a[1];return r=Math.min(r+s,i)-s,t=Math.min(t+o,n)-o,r=Math.max(r,0),t=Math.max(t,0),[r,t]}function m3t(r,t,e,i){var n=e[0],a=e[1],s=Math.ceil(Math.SQRT2*i)+8,o=0,l=0,u=t.width,c=t.height;switch(r){case"inside":o=t.x+u/2-n/2,l=t.y+c/2-a/2;break;case"top":o=t.x+u/2-n/2,l=t.y-a-s;break;case"bottom":o=t.x+u/2-n/2,l=t.y+c+s;break;case"left":o=t.x-n-s,l=t.y+c/2-a/2;break;case"right":o=t.x+u+s,l=t.y+c/2-a/2}return[o,l]}function D6(r){return r==="center"||r==="middle"}function y3t(r,t,e){var i=UR(r).queryOptionMap,n=i.keys()[0];if(!(!n||n==="series")){var a=E_(t,n,i.get(n),{useDefault:!1,enableAll:!1,enableNone:!1}),s=a.models[0];if(s){var o=e.getViewOfComponentModel(s),l;if(o.group.traverse(function(u){var c=Je(u).tooltipConfig;if(c&&c.name===r.name)return l=u,!0}),l)return{componentMainType:n,componentIndex:s.componentIndex,el:l}}}}const _3t=p3t;function x3t(r){gr(H_),r.registerComponentModel(Qkt),r.registerComponentView(_3t),r.registerAction({type:"showTip",event:"showTip",update:"tooltip:manuallyShowTip"},nn),r.registerAction({type:"hideTip",event:"hideTip",update:"tooltip:manuallyHideTip"},nn)}var b3t=["rect","polygon","keep","clear"];function w3t(r,t){var e=ri(r?r.brush:[]);if(e.length){var i=[];J(e,function(l){var u=l.hasOwnProperty("toolbox")?l.toolbox:[];u instanceof Array&&(i=i.concat(u))});var n=r&&r.toolbox;Kt(n)&&(n=n[0]),n||(n={feature:{}},r.toolbox=[n]);var a=n.feature||(n.feature={}),s=a.brush||(a.brush={}),o=s.type||(s.type=[]);o.push.apply(o,i),S3t(o),t&&!o.length&&o.push.apply(o,b3t)}}function S3t(r){var t={};J(r,function(e){t[e]=1}),r.length=0,J(t,function(e,i){r.push(i)})}var L6=J;function k6(r){if(r){for(var t in r)if(r.hasOwnProperty(t))return!0}}function sP(r,t,e){var i={};return L6(t,function(a){var s=i[a]=n();L6(r[a],function(o,l){if(ta.isValidType(l)){var u={type:l,visual:o};e&&e(u,a),s[l]=new ta(u),l==="opacity"&&(u=Ze(u),u.type="colorAlpha",s.__hidden.__alphaForOpacity=new ta(u))}})}),i;function n(){var a=function(){};a.prototype.__hidden=a.prototype;var s=new a;return s}}function PZ(r,t,e){var i;J(e,function(n){t.hasOwnProperty(n)&&k6(t[n])&&(i=!0)}),i&&J(e,function(n){t.hasOwnProperty(n)&&k6(t[n])?r[n]=Ze(t[n]):delete r[n]})}function T3t(r,t,e,i,n,a){var s={};J(r,function(h){var p=ta.prepareVisualTypes(t[h]);s[h]=p});var o;function l(h){return _D(e,o,h)}function u(h,p){W9(e,o,h,p)}a==null?e.each(c):e.each([a],c);function c(h,p){o=a==null?h:p;var v=e.getRawDataItem(o);if(!(v&&v.visualMap===!1))for(var y=i.call(n,h),x=t[y],w=s[y],T=0,E=w.length;T<E;T++){var M=w[T];x[M]&&x[M].applyVisual(h,l,u)}}}function A3t(r,t,e,i){var n={};return J(r,function(a){var s=ta.prepareVisualTypes(t[a]);n[a]=s}),{progress:function(s,o){var l;i!=null&&(l=o.getDimensionIndex(i));function u(F){return _D(o,h,F)}function c(F,O){W9(o,h,F,O)}for(var h,p=o.getStore();(h=s.next())!=null;){var v=o.getRawDataItem(h);if(!(v&&v.visualMap===!1))for(var y=i!=null?p.get(l,h):h,x=e(y),w=t[x],T=n[x],E=0,M=T.length;E<M;E++){var L=T[E];w[L]&&w[L].applyVisual(y,u,c)}}}}}function C3t(r){var t=r.brushType,e={point:function(i){return O6[t].point(i,e,r)},rect:function(i){return O6[t].rect(i,e,r)}};return e}var O6={lineX:N6(0),lineY:N6(1),rect:{point:function(r,t,e){return r&&e.boundingRect.contain(r[0],r[1])},rect:function(r,t,e){return r&&e.boundingRect.intersect(r)}},polygon:{point:function(r,t,e){return r&&e.boundingRect.contain(r[0],r[1])&&nf(e.range,r[0],r[1])},rect:function(r,t,e){var i=e.range;if(!r||i.length<=1)return!1;var n=r.x,a=r.y,s=r.width,o=r.height,l=i[0];if(nf(i,n,a)||nf(i,n+s,a)||nf(i,n,a+o)||nf(i,n+s,a+o)||hr.create(r).contain(l[0],l[1])||Um(n,a,n+s,a,i)||Um(n,a,n,a+o,i)||Um(n+s,a,n+s,a+o,i)||Um(n,a+o,n+s,a+o,i))return!0}}};function N6(r){var t=["x","y"],e=["width","height"];return{point:function(i,n,a){if(i){var s=a.range,o=i[r];return Em(o,s)}},rect:function(i,n,a){if(i){var s=a.range,o=[i[t[r]],i[t[r]]+i[e[r]]];return o[1]<o[0]&&o.reverse(),Em(o[0],s)||Em(o[1],s)||Em(s[0],o)||Em(s[1],o)}}}}function Em(r,t){return t[0]<=r&&r<=t[1]}var F6=["inBrush","outOfBrush"],oE="__ecBrushSelect",oP="__ecInBrushSelectEvent";function RZ(r){r.eachComponent({mainType:"brush"},function(t){var e=t.brushTargetManager=new EL(t.option,r);e.setInputRanges(t.areas,r)})}function E3t(r,t,e){var i=[],n,a;r.eachComponent({mainType:"brush"},function(s){e&&e.type==="takeGlobalCursor"&&s.setBrushOption(e.key==="brush"?e.brushOption:{brushType:!1})}),RZ(r),r.eachComponent({mainType:"brush"},function(s,o){var l={brushId:s.id,brushIndex:o,brushName:s.name,areas:Ze(s.areas),selected:[]};i.push(l);var u=s.option,c=u.brushLink,h=[],p=[],v=[],y=!1;o||(n=u.throttleType,a=u.throttleDelay);var x=te(s.areas,function(F){var O=R3t[F.brushType],U=We({boundingRect:O?O(F):void 0},F);return U.selectors=C3t(U),U}),w=sP(s.option,F6,function(F){F.mappingMethod="fixed"});Kt(c)&&J(c,function(F){h[F]=1});function T(F){return c==="all"||!!h[F]}function E(F){return!!F.length}r.eachSeries(function(F,O){var U=v[O]=[];F.subType==="parallel"?M(F,O):L(F,O,U)});function M(F,O){var U=F.coordinateSystem;y=y||U.hasAxisBrushed(),T(O)&&U.eachActiveState(F.getData(),function(W,H){W==="active"&&(p[H]=1)})}function L(F,O,U){if(!(!F.brushSelector||P3t(s,O))&&(J(x,function(H){s.brushTargetManager.controlSeries(H,F,r)&&U.push(H),y=y||E(U)}),T(O)&&E(U))){var W=F.getData();W.each(function(H){B6(F,U,W,H)&&(p[H]=1)})}}r.eachSeries(function(F,O){var U={seriesId:F.id,seriesIndex:O,seriesName:F.name,dataIndex:[]};l.selected.push(U);var W=v[O],H=F.getData(),j=T(O)?function(Y){return p[Y]?(U.dataIndex.push(H.getRawIndex(Y)),"inBrush"):"outOfBrush"}:function(Y){return B6(F,W,H,Y)?(U.dataIndex.push(H.getRawIndex(Y)),"inBrush"):"outOfBrush"};(T(O)?y:E(W))&&T3t(F6,w,H,j)})}),I3t(t,n,a,i,e)}function I3t(r,t,e,i,n){if(n){var a=r.getZr();if(!a[oP]){a[oE]||(a[oE]=M3t);var s=Ug(a,oE,e,t);s(r,i)}}}function M3t(r,t){if(!r.isDisposed()){var e=r.getZr();e[oP]=!0,r.dispatchAction({type:"brushSelect",batch:t}),e[oP]=!1}}function B6(r,t,e,i){for(var n=0,a=t.length;n<a;n++){var s=t[n];if(r.brushSelector(i,e,s.selectors,s))return!0}}function P3t(r,t){var e=r.option.seriesIndex;return e!=null&&e!=="all"&&(Kt(e)?pr(e,t)<0:t!==e)}var R3t={rect:function(r){return z6(r.range)},polygon:function(r){for(var t,e=r.range,i=0,n=e.length;i<n;i++){t=t||[[1/0,-1/0],[1/0,-1/0]];var a=e[i];a[0]<t[0][0]&&(t[0][0]=a[0]),a[0]>t[0][1]&&(t[0][1]=a[0]),a[1]<t[1][0]&&(t[1][0]=a[1]),a[1]>t[1][1]&&(t[1][1]=a[1])}return t&&z6(t)}};function z6(r){return new hr(r[0][0],r[1][0],r[0][1]-r[0][0],r[1][1]-r[1][0])}var D3t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,i){this.ecModel=e,this.api=i,this.model,(this._brushController=new oL(i.getZr())).on("brush",we(this._onBrush,this)).mount()},t.prototype.render=function(e,i,n,a){this.model=e,this._updateController(e,i,n,a)},t.prototype.updateTransform=function(e,i,n,a){RZ(i),this._updateController(e,i,n,a)},t.prototype.updateVisual=function(e,i,n,a){this.updateTransform(e,i,n,a)},t.prototype.updateView=function(e,i,n,a){this._updateController(e,i,n,a)},t.prototype._updateController=function(e,i,n,a){(!a||a.$from!==e.id)&&this._brushController.setPanels(e.brushTargetManager.makePanelOpts(n)).enableBrush(e.brushOption).updateCovers(e.areas.slice())},t.prototype.dispose=function(){this._brushController.dispose()},t.prototype._onBrush=function(e){var i=this.model.id,n=this.model.brushTargetManager.setOutputRanges(e.areas,this.ecModel);(!e.isEnd||e.removeOnClick)&&this.api.dispatchAction({type:"brush",brushId:i,areas:Ze(n),$from:i}),e.isEnd&&this.api.dispatchAction({type:"brushEnd",brushId:i,areas:Ze(n),$from:i})},t.type="brush",t}($i);const L3t=D3t;var k3t="#ddd",O3t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.areas=[],e.brushOption={},e}return t.prototype.optionUpdated=function(e,i){var n=this.option;!i&&PZ(n,e,["inBrush","outOfBrush"]);var a=n.inBrush=n.inBrush||{};n.outOfBrush=n.outOfBrush||{color:k3t},a.hasOwnProperty("liftZ")||(a.liftZ=5)},t.prototype.setAreas=function(e){e&&(this.areas=te(e,function(i){return V6(this.option,i)},this))},t.prototype.setBrushOption=function(e){this.brushOption=V6(this.option,e),this.brushType=this.brushOption.brushType},t.type="brush",t.dependencies=["geo","grid","xAxis","yAxis","parallel","series"],t.defaultOption={seriesIndex:"all",brushType:"rect",brushMode:"single",transformable:!0,brushStyle:{borderWidth:1,color:"rgba(210,219,238,0.3)",borderColor:"#D2DBEE"},throttleType:"fixRate",throttleDelay:0,removeOnClick:!0,z:1e4},t}(kr);function V6(r,t){return cr({brushType:r.brushType,brushMode:r.brushMode,transformable:r.transformable,brushStyle:new fi(r.brushStyle).getItemStyle(),removeOnClick:r.removeOnClick,z:r.z},t,!0)}const N3t=O3t;var F3t=["rect","polygon","lineX","lineY","keep","clear"],B3t=function(r){Vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.render=function(e,i,n){var a,s,o;i.eachComponent({mainType:"brush"},function(l){a=l.brushType,s=l.brushOption.brushMode||"single",o=o||!!l.areas.length}),this._brushType=a,this._brushMode=s,J(e.get("type",!0),function(l){e.setIconStatus(l,(l==="keep"?s==="multiple":l==="clear"?o:l===a)?"emphasis":"normal")})},t.prototype.updateView=function(e,i,n){this.render(e,i,n)},t.prototype.getIcons=function(){var e=this.model,i=e.get("icon",!0),n={};return J(e.get("type",!0),function(a){i[a]&&(n[a]=i[a])}),n},t.prototype.onclick=function(e,i,n){var a=this._brushType,s=this._brushMode;n==="clear"?(i.dispatchAction({type:"axisAreaSelect",intervals:[]}),i.dispatchAction({type:"brush",command:"clear",areas:[]})):i.dispatchAction({type:"takeGlobalCursor",key:"brush",brushOption:{brushType:n==="keep"?a:a===n?!1:n,brushMode:n==="keep"?s==="multiple"?"single":"multiple":s}})},t.getDefaultOption=function(e){var i={show:!0,type:F3t.slice(),icon:{rect:"M7.3,34.7 M0.4,10V-0.2h9.8 M89.6,10V-0.2h-9.8 M0.4,60v10.2h9.8 M89.6,60v10.2h-9.8 M12.3,22.4V10.5h13.1 M33.6,10.5h7.8 M49.1,10.5h7.8 M77.5,22.4V10.5h-13 M12.3,31.1v8.2 M77.7,31.1v8.2 M12.3,47.6v11.9h13.1 M33.6,59.5h7.6 M49.1,59.5 h7.7 M77.5,47.6v11.9h-13",polygon:"M55.2,34.9c1.7,0,3.1,1.4,3.1,3.1s-1.4,3.1-3.1,3.1 s-3.1-1.4-3.1-3.1S53.5,34.9,55.2,34.9z M50.4,51c1.7,0,3.1,1.4,3.1,3.1c0,1.7-1.4,3.1-3.1,3.1c-1.7,0-3.1-1.4-3.1-3.1 C47.3,52.4,48.7,51,50.4,51z M55.6,37.1l1.5-7.8 M60.1,13.5l1.6-8.7l-7.8,4 M59,19l-1,5.3 M24,16.1l6.4,4.9l6.4-3.3 M48.5,11.6 l-5.9,3.1 M19.1,12.8L9.7,5.1l1.1,7.7 M13.4,29.8l1,7.3l6.6,1.6 M11.6,18.4l1,6.1 M32.8,41.9 M26.6,40.4 M27.3,40.2l6.1,1.6 M49.9,52.1l-5.6-7.6l-4.9-1.2",lineX:"M15.2,30 M19.7,15.6V1.9H29 M34.8,1.9H40.4 M55.3,15.6V1.9H45.9 M19.7,44.4V58.1H29 M34.8,58.1H40.4 M55.3,44.4 V58.1H45.9 M12.5,20.3l-9.4,9.6l9.6,9.8 M3.1,29.9h16.5 M62.5,20.3l9.4,9.6L62.3,39.7 M71.9,29.9H55.4",lineY:"M38.8,7.7 M52.7,12h13.2v9 M65.9,26.6V32 M52.7,46.3h13.2v-9 M24.9,12H11.8v9 M11.8,26.6V32 M24.9,46.3H11.8v-9 M48.2,5.1l-9.3-9l-9.4,9.2 M38.9-3.9V12 M48.2,53.3l-9.3,9l-9.4-9.2 M38.9,62.3V46.4",keep:"M4,10.5V1h10.3 M20.7,1h6.1 M33,1h6.1 M55.4,10.5V1H45.2 M4,17.3v6.6 M55.6,17.3v6.6 M4,30.5V40h10.3 M20.7,40 h6.1 M33,40h6.1 M55.4,30.5V40H45.2 M21,18.9h62.9v48.6H21V18.9z",clear:"M22,14.7l30.9,31 M52.9,14.7L22,45.7 M4.7,16.8V4.2h13.1 M26,4.2h7.8 M41.6,4.2h7.8 M70.3,16.8V4.2H57.2 M4.7,25.9v8.6 M70.3,25.9v8.6 M4.7,43.2v12.6h13.1 M26,55.8h7.8 M41.6,55.8h7.8 M70.3,43.2v12.6H57.2"},title:e.getLocaleModel().get(["toolbox","brush","title"])};return i},t}(Ks);const z3t=B3t;function V3t(r){r.registerComponentView(L3t),r.registerComponentModel(N3t),r.registerPreprocessor(w3t),r.registerVisual(r.PRIORITY.VISUAL.BRUSH,E3t),r.registerAction({type:"brush",event:"brush",update:"updateVisual"},function(t,e){e.eachComponent({mainType:"brush",query:t},function(i){i.setAreas(t.areas)})}),r.registerAction({type:"brushSelect",event:"brushSelected",update:"none"},nn),r.registerAction({type:"brushEnd",event:"brushEnd",update:"none"},nn),Cp("brush",z3t)}var U3t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.layoutMode={type:"box",ignoreSize:!0},e}return t.type="title",t.defaultOption={z:6,show:!0,text:"",target:"blank",subtext:"",subtarget:"blank",left:0,top:0,backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,padding:5,itemGap:10,textStyle:{fontSize:18,fontWeight:"bold",color:"#464646"},subtextStyle:{fontSize:12,color:"#6E7079"}},t}(kr),$3t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,i,n){if(this.group.removeAll(),!!e.get("show")){var a=this.group,s=e.getModel("textStyle"),o=e.getModel("subtextStyle"),l=e.get("textAlign"),u=ir(e.get("textBaseline"),e.get("textVerticalAlign")),c=new Nr({style:hi(s,{text:e.get("text"),fill:s.getTextColor()},{disableBox:!0}),z2:10}),h=c.getBoundingRect(),p=e.get("subtext"),v=new Nr({style:hi(o,{text:p,fill:o.getTextColor(),y:h.height+e.get("itemGap"),verticalAlign:"top"},{disableBox:!0}),z2:10}),y=e.get("link"),x=e.get("sublink"),w=e.get("triggerEvent",!0);c.silent=!y&&!w,v.silent=!x&&!w,y&&c.on("click",function(){nw(y,"_"+e.get("target"))}),x&&v.on("click",function(){nw(x,"_"+e.get("subtarget"))}),Je(c).eventData=Je(v).eventData=w?{componentType:"title",componentIndex:e.componentIndex}:null,a.add(c),p&&a.add(v);var T=a.getBoundingRect(),E=e.getBoxLayoutParams();E.width=T.width,E.height=T.height;var M=bn(E,{width:n.getWidth(),height:n.getHeight()},e.get("padding"));l||(l=e.get("left")||e.get("right"),l==="middle"&&(l="center"),l==="right"?M.x+=M.width:l==="center"&&(M.x+=M.width/2)),u||(u=e.get("top")||e.get("bottom"),u==="center"&&(u="middle"),u==="bottom"?M.y+=M.height:u==="middle"&&(M.y+=M.height/2),u=u||"top"),a.x=M.x,a.y=M.y,a.markRedraw();var L={align:l,verticalAlign:u};c.setStyle(L),v.setStyle(L),T=a.getBoundingRect();var F=M.margin,O=e.getItemStyle(["color","opacity"]);O.fill=e.get("backgroundColor");var U=new Pr({shape:{x:T.x-F[3],y:T.y-F[0],width:T.width+F[1]+F[3],height:T.height+F[0]+F[2],r:e.get("borderRadius")},style:O,subPixelOptimize:!0,silent:!0});a.add(U)}},t.type="title",t}($i);function W3t(r){r.registerComponentModel(U3t),r.registerComponentView($3t)}var H3t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.layoutMode="box",e}return t.prototype.init=function(e,i,n){this.mergeDefaultAndTheme(e,n),this._initData()},t.prototype.mergeOption=function(e){r.prototype.mergeOption.apply(this,arguments),this._initData()},t.prototype.setCurrentIndex=function(e){e==null&&(e=this.option.currentIndex);var i=this._data.count();this.option.loop?e=(e%i+i)%i:(e>=i&&(e=i-1),e<0&&(e=0)),this.option.currentIndex=e},t.prototype.getCurrentIndex=function(){return this.option.currentIndex},t.prototype.isIndexMax=function(){return this.getCurrentIndex()>=this._data.count()-1},t.prototype.setPlayState=function(e){this.option.autoPlay=!!e},t.prototype.getPlayState=function(){return!!this.option.autoPlay},t.prototype._initData=function(){var e=this.option,i=e.data||[],n=e.axisType,a=this._names=[],s;n==="category"?(s=[],J(i,function(u,c){var h=xn(Pg(u),""),p;je(u)?(p=Ze(u),p.value=c):p=c,s.push(p),a.push(h)})):s=i;var o={category:"ordinal",time:"time",value:"number"}[n]||"number",l=this._data=new Xa([{name:"value",type:o}],this);l.initData(s,a)},t.prototype.getData=function(){return this._data},t.prototype.getCategories=function(){if(this.get("axisType")==="category")return this._names.slice()},t.type="timeline",t.defaultOption={z:4,show:!0,axisType:"time",realtime:!0,left:"20%",top:null,right:"20%",bottom:0,width:null,height:40,padding:5,controlPosition:"left",autoPlay:!1,rewind:!1,loop:!0,playInterval:2e3,currentIndex:0,itemStyle:{},label:{color:"#000"},data:[]},t}(kr);const U6=H3t;var DZ=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="timeline.slider",t.defaultOption=Jc(U6.defaultOption,{backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,orient:"horizontal",inverse:!1,tooltip:{trigger:"item"},symbol:"circle",symbolSize:12,lineStyle:{show:!0,width:2,color:"#DAE1F5"},label:{position:"auto",show:!0,interval:"auto",rotate:0,color:"#A4B1D7"},itemStyle:{color:"#A4B1D7",borderWidth:1},checkpointStyle:{symbol:"circle",symbolSize:15,color:"#316bf3",borderColor:"#fff",borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0, 0, 0, 0.3)",animation:!0,animationDuration:300,animationEasing:"quinticInOut"},controlStyle:{show:!0,showPlayBtn:!0,showPrevBtn:!0,showNextBtn:!0,itemSize:24,itemGap:12,position:"left",playIcon:"path://M31.6,53C17.5,53,6,41.5,6,27.4S17.5,1.8,31.6,1.8C45.7,1.8,57.2,13.3,57.2,27.4S45.7,53,31.6,53z M31.6,3.3 C18.4,3.3,7.5,14.1,7.5,27.4c0,13.3,10.8,24.1,24.1,24.1C44.9,51.5,55.7,40.7,55.7,27.4C55.7,14.1,44.9,3.3,31.6,3.3z M24.9,21.3 c0-2.2,1.6-3.1,3.5-2l10.5,6.1c1.899,1.1,1.899,2.9,0,4l-10.5,6.1c-1.9,1.1-3.5,0.2-3.5-2V21.3z",stopIcon:"path://M30.9,53.2C16.8,53.2,5.3,41.7,5.3,27.6S16.8,2,30.9,2C45,2,56.4,13.5,56.4,27.6S45,53.2,30.9,53.2z M30.9,3.5C17.6,3.5,6.8,14.4,6.8,27.6c0,13.3,10.8,24.1,24.101,24.1C44.2,51.7,55,40.9,55,27.6C54.9,14.4,44.1,3.5,30.9,3.5z M36.9,35.8c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H36c0.5,0,0.9,0.4,0.9,1V35.8z M27.8,35.8 c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H27c0.5,0,0.9,0.4,0.9,1L27.8,35.8L27.8,35.8z",nextIcon:"M2,18.5A1.52,1.52,0,0,1,.92,18a1.49,1.49,0,0,1,0-2.12L7.81,9.36,1,3.11A1.5,1.5,0,1,1,3,.89l8,7.34a1.48,1.48,0,0,1,.49,1.09,1.51,1.51,0,0,1-.46,1.1L3,18.08A1.5,1.5,0,0,1,2,18.5Z",prevIcon:"M10,.5A1.52,1.52,0,0,1,11.08,1a1.49,1.49,0,0,1,0,2.12L4.19,9.64,11,15.89a1.5,1.5,0,1,1-2,2.22L1,10.77A1.48,1.48,0,0,1,.5,9.68,1.51,1.51,0,0,1,1,8.58L9,.92A1.5,1.5,0,0,1,10,.5Z",prevBtnSize:18,nextBtnSize:18,color:"#A4B1D7",borderColor:"#A4B1D7",borderWidth:1},emphasis:{label:{show:!0,color:"#6f778d"},itemStyle:{color:"#316BF3"},controlStyle:{color:"#316BF3",borderColor:"#316BF3",borderWidth:2}},progress:{lineStyle:{color:"#316BF3"},itemStyle:{color:"#316BF3"},label:{color:"#6f778d"}},data:[]}),t}(U6);yn(DZ,zS.prototype);const G3t=DZ;var j3t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="timeline",t}($i);const X3t=j3t;var Z3t=function(r){Vt(t,r);function t(e,i,n,a){var s=r.call(this,e,i,n)||this;return s.type=a||"value",s}return t.prototype.getLabelModel=function(){return this.model.getModel("label")},t.prototype.isHorizontal=function(){return this.model.get("orient")==="horizontal"},t}($o);const q3t=Z3t;var lE=Math.PI,$6=Ir(),Y3t=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,i){this.api=i},t.prototype.render=function(e,i,n){if(this.model=e,this.api=n,this.ecModel=i,this.group.removeAll(),e.get("show",!0)){var a=this._layout(e,n),s=this._createGroup("_mainGroup"),o=this._createGroup("_labelGroup"),l=this._axis=this._createAxis(a,e);e.formatTooltip=function(u){var c=l.scale.getLabel({value:u});return Ln("nameValue",{noName:!0,value:c})},J(["AxisLine","AxisTick","Control","CurrentPointer"],function(u){this["_render"+u](a,s,l,e)},this),this._renderAxisLabel(a,o,l,e),this._position(a,e)}this._doPlayStop(),this._updateTicksStatus()},t.prototype.remove=function(){this._clearTimer(),this.group.removeAll()},t.prototype.dispose=function(){this._clearTimer()},t.prototype._layout=function(e,i){var n=e.get(["label","position"]),a=e.get("orient"),s=J3t(e,i),o;n==null||n==="auto"?o=a==="horizontal"?s.y+s.height/2<i.getHeight()/2?"-":"+":s.x+s.width/2<i.getWidth()/2?"+":"-":ve(n)?o={horizontal:{top:"-",bottom:"+"},vertical:{left:"-",right:"+"}}[a][n]:o=n;var l={horizontal:"center",vertical:o>=0||o==="+"?"left":"right"},u={horizontal:o>=0||o==="+"?"top":"bottom",vertical:"middle"},c={horizontal:0,vertical:lE/2},h=a==="vertical"?s.height:s.width,p=e.getModel("controlStyle"),v=p.get("show",!0),y=v?p.get("itemSize"):0,x=v?p.get("itemGap"):0,w=y+x,T=e.get(["label","rotate"])||0;T=T*lE/180;var E,M,L,F=p.get("position",!0),O=v&&p.get("showPlayBtn",!0),U=v&&p.get("showPrevBtn",!0),W=v&&p.get("showNextBtn",!0),H=0,j=h;F==="left"||F==="bottom"?(O&&(E=[0,0],H+=w),U&&(M=[H,0],H+=w),W&&(L=[j-y,0],j-=w)):(O&&(E=[j-y,0],j-=w),U&&(M=[0,0],H+=w),W&&(L=[j-y,0],j-=w));var Y=[H,j];return e.get("inverse")&&Y.reverse(),{viewRect:s,mainLength:h,orient:a,rotation:c[a],labelRotation:T,labelPosOpt:o,labelAlign:e.get(["label","align"])||l[a],labelBaseline:e.get(["label","verticalAlign"])||e.get(["label","baseline"])||u[a],playPosition:E,prevBtnPosition:M,nextBtnPosition:L,axisExtent:Y,controlSize:y,controlGap:x}},t.prototype._position=function(e,i){var n=this._mainGroup,a=this._labelGroup,s=e.viewRect;if(e.orient==="vertical"){var o=Es(),l=s.x,u=s.y+s.height;wl(o,o,[-l,-u]),td(o,o,-lE/2),wl(o,o,[l,u]),s=s.clone(),s.applyTransform(o)}var c=E(s),h=E(n.getBoundingRect()),p=E(a.getBoundingRect()),v=[n.x,n.y],y=[a.x,a.y];y[0]=v[0]=c[0][0];var x=e.labelPosOpt;if(x==null||ve(x)){var w=x==="+"?0:1;M(v,h,c,1,w),M(y,p,c,1,1-w)}else{var w=x>=0?0:1;M(v,h,c,1,w),y[1]=v[1]+x}n.setPosition(v),a.setPosition(y),n.rotation=a.rotation=e.rotation,T(n),T(a);function T(L){L.originX=c[0][0]-L.x,L.originY=c[1][0]-L.y}function E(L){return[[L.x,L.x+L.width],[L.y,L.y+L.height]]}function M(L,F,O,U,W){L[U]+=O[U][W]-F[U][W]}},t.prototype._createAxis=function(e,i){var n=i.getData(),a=i.get("axisType"),s=K3t(i,a);s.getTicks=function(){return n.mapArray(["value"],function(u){return{value:u}})};var o=n.getDataExtent("value");s.setExtent(o[0],o[1]),s.calcNiceTicks();var l=new q3t("value",s,e.axisExtent,a);return l.model=i,l},t.prototype._createGroup=function(e){var i=this[e]=new Ke;return this.group.add(i),i},t.prototype._renderAxisLine=function(e,i,n,a){var s=n.getExtent();if(a.get(["lineStyle","show"])){var o=new $n({shape:{x1:s[0],y1:0,x2:s[1],y2:0},style:Zt({lineCap:"round"},a.getModel("lineStyle").getLineStyle()),silent:!0,z2:1});i.add(o);var l=this._progressLine=new $n({shape:{x1:s[0],x2:this._currentPointer?this._currentPointer.x:s[0],y1:0,y2:0},style:We({lineCap:"round",lineWidth:o.style.lineWidth},a.getModel(["progress","lineStyle"]).getLineStyle()),silent:!0,z2:1});i.add(l)}},t.prototype._renderAxisTick=function(e,i,n,a){var s=this,o=a.getData(),l=n.scale.getTicks();this._tickSymbols=[],J(l,function(u){var c=n.dataToCoord(u.value),h=o.getItemModel(u.value),p=h.getModel("itemStyle"),v=h.getModel(["emphasis","itemStyle"]),y=h.getModel(["progress","itemStyle"]),x={x:c,y:0,onclick:we(s._changeTimeline,s,u.value)},w=W6(h,p,i,x);w.ensureState("emphasis").style=v.getItemStyle(),w.ensureState("progress").style=y.getItemStyle(),If(w);var T=Je(w);h.get("tooltip")?(T.dataIndex=u.value,T.dataModel=a):T.dataIndex=T.dataModel=null,s._tickSymbols.push(w)})},t.prototype._renderAxisLabel=function(e,i,n,a){var s=this,o=n.getLabelModel();if(o.get("show")){var l=a.getData(),u=n.getViewLabels();this._tickLabels=[],J(u,function(c){var h=c.tickValue,p=l.getItemModel(h),v=p.getModel("label"),y=p.getModel(["emphasis","label"]),x=p.getModel(["progress","label"]),w=n.dataToCoord(c.tickValue),T=new Nr({x:w,y:0,rotation:e.labelRotation-e.rotation,onclick:we(s._changeTimeline,s,h),silent:!1,style:hi(v,{text:c.formattedLabel,align:e.labelAlign,verticalAlign:e.labelBaseline})});T.ensureState("emphasis").style=hi(y),T.ensureState("progress").style=hi(x),i.add(T),If(T),$6(T).dataIndex=h,s._tickLabels.push(T)})}},t.prototype._renderControl=function(e,i,n,a){var s=e.controlSize,o=e.rotation,l=a.getModel("controlStyle").getItemStyle(),u=a.getModel(["emphasis","controlStyle"]).getItemStyle(),c=a.getPlayState(),h=a.get("inverse",!0);p(e.nextBtnPosition,"next",we(this._changeTimeline,this,h?"-":"+")),p(e.prevBtnPosition,"prev",we(this._changeTimeline,this,h?"+":"-")),p(e.playPosition,c?"stop":"play",we(this._handlePlayClick,this,!c),!0);function p(v,y,x,w){if(v){var T=zo(ir(a.get(["controlStyle",y+"BtnSize"]),s),s),E=[0,-T/2,T,T],M=Q3t(a,y+"Icon",E,{x:v[0],y:v[1],originX:s/2,originY:0,rotation:w?-o:0,rectHover:!0,style:l,onclick:x});M.ensureState("emphasis").style=u,i.add(M),If(M)}}},t.prototype._renderCurrentPointer=function(e,i,n,a){var s=a.getData(),o=a.getCurrentIndex(),l=s.getItemModel(o).getModel("checkpointStyle"),u=this,c={onCreate:function(h){h.draggable=!0,h.drift=we(u._handlePointerDrag,u),h.ondragend=we(u._handlePointerDragend,u),H6(h,u._progressLine,o,n,a,!0)},onUpdate:function(h){H6(h,u._progressLine,o,n,a)}};this._currentPointer=W6(l,l,this._mainGroup,{},this._currentPointer,c)},t.prototype._handlePlayClick=function(e){this._clearTimer(),this.api.dispatchAction({type:"timelinePlayChange",playState:e,from:this.uid})},t.prototype._handlePointerDrag=function(e,i,n){this._clearTimer(),this._pointerChangeTimeline([n.offsetX,n.offsetY])},t.prototype._handlePointerDragend=function(e){this._pointerChangeTimeline([e.offsetX,e.offsetY],!0)},t.prototype._pointerChangeTimeline=function(e,i){var n=this._toAxisCoord(e)[0],a=this._axis,s=ro(a.getExtent().slice());n>s[1]&&(n=s[1]),n<s[0]&&(n=s[0]),this._currentPointer.x=n,this._currentPointer.markRedraw();var o=this._progressLine;o&&(o.shape.x2=n,o.dirty());var l=this._findNearestTick(n),u=this.model;(i||l!==u.getCurrentIndex()&&u.get("realtime"))&&this._changeTimeline(l)},t.prototype._doPlayStop=function(){var e=this;this._clearTimer(),this.model.getPlayState()&&(this._timer=setTimeout(function(){var i=e.model;e._changeTimeline(i.getCurrentIndex()+(i.get("rewind",!0)?-1:1))},this.model.get("playInterval")))},t.prototype._toAxisCoord=function(e){var i=this._mainGroup.getLocalTransform();return Fo(e,i,!0)},t.prototype._findNearestTick=function(e){var i=this.model.getData(),n=1/0,a,s=this._axis;return i.each(["value"],function(o,l){var u=s.dataToCoord(o),c=Math.abs(u-e);c<n&&(n=c,a=l)}),a},t.prototype._clearTimer=function(){this._timer&&(clearTimeout(this._timer),this._timer=null)},t.prototype._changeTimeline=function(e){var i=this.model.getCurrentIndex();e==="+"?e=i+1:e==="-"&&(e=i-1),this.api.dispatchAction({type:"timelineChange",currentIndex:e,from:this.uid})},t.prototype._updateTicksStatus=function(){var e=this.model.getCurrentIndex(),i=this._tickSymbols,n=this._tickLabels;if(i)for(var a=0;a<i.length;a++)i&&i[a]&&i[a].toggleState("progress",a<e);if(n)for(var a=0;a<n.length;a++)n&&n[a]&&n[a].toggleState("progress",$6(n[a]).dataIndex<=e)},t.type="timeline.slider",t}(X3t);function K3t(r,t){if(t=t||r.get("type"),t)switch(t){case"category":return new CD({ordinalMeta:r.getCategories(),extent:[1/0,-1/0]});case"time":return new DG({locale:r.ecModel.getLocaleModel(),useUTC:r.ecModel.get("useUTC")});default:return new Gc}}function J3t(r,t){return bn(r.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()},r.get("padding"))}function Q3t(r,t,e,i){var n=i.style,a=R_(r.get(["controlStyle",t]),i||{},new hr(e[0],e[1],e[2],e[3]));return n&&a.setStyle(n),a}function W6(r,t,e,i,n,a){var s=t.get("color");if(n)n.setColor(s),e.add(n),a&&a.onUpdate(n);else{var o=r.get("symbol");n=mn(o,-1,-1,2,2,s),n.setStyle("strokeNoScale",!0),e.add(n),a&&a.onCreate(n)}var l=t.getItemStyle(["color"]);n.setStyle(l),i=cr({rectHover:!0,z2:100},i,!0);var u=$g(r.get("symbolSize"));i.scaleX=u[0]/2,i.scaleY=u[1]/2;var c=id(r.get("symbolOffset"),u);c&&(i.x=(i.x||0)+c[0],i.y=(i.y||0)+c[1]);var h=r.get("symbolRotate");return i.rotation=(h||0)*Math.PI/180||0,n.attr(i),n.updateTransform(),n}function H6(r,t,e,i,n,a){if(!r.dragging){var s=n.getModel("checkpointStyle"),o=i.dataToCoord(n.getData().get("value",e));if(a||!s.get("animation",!0))r.attr({x:o,y:0}),t&&t.attr({shape:{x2:o}});else{var l={duration:s.get("animationDuration",!0),easing:s.get("animationEasing",!0)};r.stopAnimation(null,!0),r.animateTo({x:o,y:0},l),t&&t.animateTo({shape:{x2:o}},l)}}}const tOt=Y3t;function eOt(r){r.registerAction({type:"timelineChange",event:"timelineChanged",update:"prepareAndUpdate"},function(t,e,i){var n=e.getComponent("timeline");return n&&t.currentIndex!=null&&(n.setCurrentIndex(t.currentIndex),!n.get("loop",!0)&&n.isIndexMax()&&n.getPlayState()&&(n.setPlayState(!1),i.dispatchAction({type:"timelinePlayChange",playState:!1,from:t.from}))),e.resetOption("timeline",{replaceMerge:n.get("replaceMerge",!0)}),We({currentIndex:n.option.currentIndex},t)}),r.registerAction({type:"timelinePlayChange",event:"timelinePlayChanged",update:"update"},function(t,e){var i=e.getComponent("timeline");i&&t.playState!=null&&i.setPlayState(t.playState)})}function rOt(r){var t=r&&r.timeline;Kt(t)||(t=t?[t]:[]),J(t,function(e){e&&iOt(e)})}function iOt(r){var t=r.type,e={number:"value",time:"time"};if(e[t]&&(r.axisType=e[t],delete r.type),G6(r),of(r,"controlPosition")){var i=r.controlStyle||(r.controlStyle={});of(i,"position")||(i.position=r.controlPosition),i.position==="none"&&!of(i,"show")&&(i.show=!1,delete i.position),delete r.controlPosition}J(r.data||[],function(n){je(n)&&!Kt(n)&&(!of(n,"value")&&of(n,"name")&&(n.value=n.name),G6(n))})}function G6(r){var t=r.itemStyle||(r.itemStyle={}),e=t.emphasis||(t.emphasis={}),i=r.label||r.label||{},n=i.normal||(i.normal={}),a={normal:1,emphasis:1};J(i,function(s,o){!a[o]&&!of(n,o)&&(n[o]=s)}),e.label&&!of(i,"emphasis")&&(i.emphasis=e.label,delete e.label)}function of(r,t){return r.hasOwnProperty(t)}function nOt(r){r.registerComponentModel(G3t),r.registerComponentView(tOt),r.registerSubTypeDefaulter("timeline",function(){return"slider"}),eOt(r),r.registerPreprocessor(rOt)}function PL(r,t){if(!r)return!1;for(var e=Kt(r)?r:[r],i=0;i<e.length;i++)if(e[i]&&e[i][t])return!0;return!1}function T1(r){$f(r,"label",["show"])}var A1=Ir(),LZ=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.createdBySelf=!1,e}return t.prototype.init=function(e,i,n){this.mergeDefaultAndTheme(e,n),this._mergeOption(e,n,!1,!0)},t.prototype.isAnimationEnabled=function(){if(Or.node)return!1;var e=this.__hostSeries;return this.getShallow("animation")&&e&&e.isAnimationEnabled()},t.prototype.mergeOption=function(e,i){this._mergeOption(e,i,!1,!1)},t.prototype._mergeOption=function(e,i,n,a){var s=this.mainType;n||i.eachSeries(function(o){var l=o.get(this.mainType,!0),u=A1(o)[s];if(!l||!l.data){A1(o)[s]=null;return}u?u._mergeOption(l,i,!0):(a&&T1(l),J(l.data,function(c){c instanceof Array?(T1(c[0]),T1(c[1])):T1(c)}),u=this.createMarkerModelFromSeries(l,this,i),Zt(u,{mainType:this.mainType,seriesIndex:o.seriesIndex,name:o.name,createdBySelf:!0}),u.__hostSeries=o),A1(o)[s]=u},this)},t.prototype.formatTooltip=function(e,i,n){var a=this.getData(),s=this.getRawValue(e),o=a.getName(e);return Ln("section",{header:this.name,blocks:[Ln("nameValue",{name:o,value:s,noName:!o,noValue:s==null})]})},t.prototype.getData=function(){return this._data},t.prototype.setData=function(e){this._data=e},t.prototype.getDataParams=function(e,i){var n=zS.prototype.getDataParams.call(this,e,i),a=this.__hostSeries;return a&&(n.seriesId=a.id,n.seriesName=a.name,n.seriesType=a.subType),n},t.getMarkerModelFromSeries=function(e,i){return A1(e)[i]},t.type="marker",t.dependencies=["series","grid","polar","geo"],t}(kr);yn(LZ,zS.prototype);const Zc=LZ;var aOt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.createMarkerModelFromSeries=function(e,i,n){return new t(e,i,n)},t.type="markPoint",t.defaultOption={z:5,symbol:"pin",symbolSize:50,tooltip:{trigger:"item"},label:{show:!0,position:"inside"},itemStyle:{borderWidth:2},emphasis:{label:{show:!0}}},t}(Zc);const sOt=aOt;function lP(r){return!(isNaN(parseFloat(r.x))&&isNaN(parseFloat(r.y)))}function oOt(r){return!isNaN(parseFloat(r.x))&&!isNaN(parseFloat(r.y))}function C1(r,t,e,i,n,a){var s=[],o=Hc(t,i),l=o?t.getCalculationInfo("stackResultDimension"):i,u=RL(t,l,r),c=t.indicesOfNearest(l,u)[0];s[n]=t.get(e,c),s[a]=t.get(l,c);var h=t.get(i,c),p=gl(t.get(i,c));return p=Math.min(p,20),p>=0&&(s[a]=+s[a].toFixed(p)),[s,h]}var uE={min:nr(C1,"min"),max:nr(C1,"max"),average:nr(C1,"average"),median:nr(C1,"median")};function h_(r,t){if(t){var e=r.getData(),i=r.coordinateSystem,n=i&&i.dimensions;if(!oOt(t)&&!Kt(t.coord)&&Kt(n)){var a=kZ(t,e,i,r);if(t=Ze(t),t.type&&uE[t.type]&&a.baseAxis&&a.valueAxis){var s=pr(n,a.baseAxis.dim),o=pr(n,a.valueAxis.dim),l=uE[t.type](e,a.baseDataDim,a.valueDataDim,s,o);t.coord=l[0],t.value=l[1]}else t.coord=[t.xAxis!=null?t.xAxis:t.radiusAxis,t.yAxis!=null?t.yAxis:t.angleAxis]}if(t.coord==null||!Kt(n))t.coord=[];else for(var u=t.coord,c=0;c<2;c++)uE[u[c]]&&(u[c]=RL(e,e.mapDimension(n[c]),u[c]));return t}}function kZ(r,t,e,i){var n={};return r.valueIndex!=null||r.valueDim!=null?(n.valueDataDim=r.valueIndex!=null?t.getDimension(r.valueIndex):r.valueDim,n.valueAxis=e.getAxis(lOt(i,n.valueDataDim)),n.baseAxis=e.getOtherAxis(n.valueAxis),n.baseDataDim=t.mapDimension(n.baseAxis.dim)):(n.baseAxis=i.getBaseAxis(),n.valueAxis=e.getOtherAxis(n.baseAxis),n.baseDataDim=t.mapDimension(n.baseAxis.dim),n.valueDataDim=t.mapDimension(n.valueAxis.dim)),n}function lOt(r,t){var e=r.getData().getDimensionInfo(t);return e&&e.coordDim}function f_(r,t){return r&&r.containData&&t.coord&&!lP(t)?r.containData(t.coord):!0}function uOt(r,t,e){return r&&r.containZone&&t.coord&&e.coord&&!lP(t)&&!lP(e)?r.containZone(t.coord,e.coord):!0}function OZ(r,t){return r?function(e,i,n,a){var s=a<2?e.coord&&e.coord[a]:e.value;return kc(s,t[a])}:function(e,i,n,a){return kc(e.value,t[a])}}function RL(r,t,e){if(e==="average"){var i=0,n=0;return r.each(t,function(a,s){isNaN(a)||(i+=a,n++)}),i/n}else return e==="median"?r.getMedian(t):r.getDataExtent(t)[e==="max"?1:0]}var cE=Ir(),cOt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){this.markerGroupMap=Re()},t.prototype.render=function(e,i,n){var a=this,s=this.markerGroupMap;s.each(function(o){cE(o).keep=!1}),i.eachSeries(function(o){var l=Zc.getMarkerModelFromSeries(o,a.type);l&&a.renderSeries(o,l,i,n)}),s.each(function(o){!cE(o).keep&&a.group.remove(o.group)})},t.prototype.markKeep=function(e){cE(e).keep=!0},t.prototype.toggleBlurSeries=function(e,i){var n=this;J(e,function(a){var s=Zc.getMarkerModelFromSeries(a,n.type);if(s){var o=s.getData();o.eachItemGraphicEl(function(l){l&&(i?s7(l):ZR(l))})}})},t.type="marker",t}($i);const DL=cOt;function j6(r,t,e){var i=t.coordinateSystem;r.each(function(n){var a=r.getItemModel(n),s,o=he(a.get("x"),e.getWidth()),l=he(a.get("y"),e.getHeight());if(!isNaN(o)&&!isNaN(l))s=[o,l];else if(t.getMarkerPosition)s=t.getMarkerPosition(r.getValues(r.dimensions,n));else if(i){var u=r.get(i.dimensions[0],n),c=r.get(i.dimensions[1],n);s=i.dataToPoint([u,c])}isNaN(o)||(s[0]=o),isNaN(l)||(s[1]=l),r.setItemLayout(n,s)})}var hOt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.updateTransform=function(e,i,n){i.eachSeries(function(a){var s=Zc.getMarkerModelFromSeries(a,"markPoint");s&&(j6(s.getData(),a,n),this.markerGroupMap.get(a.id).updateLayout())},this)},t.prototype.renderSeries=function(e,i,n,a){var s=e.coordinateSystem,o=e.id,l=e.getData(),u=this.markerGroupMap,c=u.get(o)||u.set(o,new F_),h=fOt(s,e,i);i.setData(h),j6(i.getData(),e,a),h.each(function(p){var v=h.getItemModel(p),y=v.getShallow("symbol"),x=v.getShallow("symbolSize"),w=v.getShallow("symbolRotate"),T=v.getShallow("symbolOffset"),E=v.getShallow("symbolKeepAspect");if(Ve(y)||Ve(x)||Ve(w)||Ve(T)){var M=i.getRawValue(p),L=i.getDataParams(p);Ve(y)&&(y=y(M,L)),Ve(x)&&(x=x(M,L)),Ve(w)&&(w=w(M,L)),Ve(T)&&(T=T(M,L))}var F=v.getModel("itemStyle").getItemStyle(),O=L_(l,"color");F.fill||(F.fill=O),h.setItemVisual(p,{symbol:y,symbolSize:x,symbolRotate:w,symbolOffset:T,symbolKeepAspect:E,style:F})}),c.updateData(h),this.group.add(c.group),h.eachItemGraphicEl(function(p){p.traverse(function(v){Je(v).dataModel=i})}),this.markKeep(c),c.group.silent=i.get("silent")||e.get("silent")},t.type="markPoint",t}(DL);function fOt(r,t,e){var i;r?i=te(r&&r.dimensions,function(o){var l=t.getData().getDimensionInfo(t.getData().mapDimension(o))||{};return Zt(Zt({},l),{name:o,ordinalMeta:null})}):i=[{name:"value",type:"float"}];var n=new Xa(i,e),a=te(e.get("data"),nr(h_,t));r&&(a=ti(a,nr(f_,r)));var s=OZ(!!r,i);return n.initData(a,null,s),n}const dOt=hOt;function pOt(r){r.registerComponentModel(sOt),r.registerComponentView(dOt),r.registerPreprocessor(function(t){PL(t.series,"markPoint")&&(t.markPoint=t.markPoint||{})})}var gOt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.createMarkerModelFromSeries=function(e,i,n){return new t(e,i,n)},t.type="markLine",t.defaultOption={z:5,symbol:["circle","arrow"],symbolSize:[8,16],symbolOffset:0,precision:2,tooltip:{trigger:"item"},label:{show:!0,position:"end",distance:5},lineStyle:{type:"dashed"},emphasis:{label:{show:!0},lineStyle:{width:3}},animationEasing:"linear"},t}(Zc);const vOt=gOt;var E1=Ir(),mOt=function(r,t,e,i){var n=r.getData(),a;if(Kt(i))a=i;else{var s=i.type;if(s==="min"||s==="max"||s==="average"||s==="median"||i.xAxis!=null||i.yAxis!=null){var o=void 0,l=void 0;if(i.yAxis!=null||i.xAxis!=null)o=t.getAxis(i.yAxis!=null?"y":"x"),l=Un(i.yAxis,i.xAxis);else{var u=kZ(i,n,t,r);o=u.valueAxis;var c=yG(n,u.valueDataDim);l=RL(n,c,s)}var h=o.dim==="x"?0:1,p=1-h,v=Ze(i),y={coord:[]};v.type=null,v.coord=[],v.coord[p]=-1/0,y.coord[p]=1/0;var x=e.get("precision");x>=0&&Fr(l)&&(l=+l.toFixed(Math.min(x,20))),v.coord[h]=y.coord[h]=l,a=[v,y,{type:s,valueIndex:i.valueIndex,value:l}]}else a=[]}var w=[h_(r,a[0]),h_(r,a[1]),Zt({},a[2])];return w[2].type=w[2].type||null,cr(w[2],w[0]),cr(w[2],w[1]),w};function Pw(r){return!isNaN(r)&&!isFinite(r)}function X6(r,t,e,i){var n=1-r,a=i.dimensions[r];return Pw(t[n])&&Pw(e[n])&&t[r]===e[r]&&i.getAxis(a).containData(t[r])}function yOt(r,t){if(r.type==="cartesian2d"){var e=t[0].coord,i=t[1].coord;if(e&&i&&(X6(1,e,i,r)||X6(0,e,i,r)))return!0}return f_(r,t[0])&&f_(r,t[1])}function hE(r,t,e,i,n){var a=i.coordinateSystem,s=r.getItemModel(t),o,l=he(s.get("x"),n.getWidth()),u=he(s.get("y"),n.getHeight());if(!isNaN(l)&&!isNaN(u))o=[l,u];else{if(i.getMarkerPosition)o=i.getMarkerPosition(r.getValues(r.dimensions,t));else{var c=a.dimensions,h=r.get(c[0],t),p=r.get(c[1],t);o=a.dataToPoint([h,p])}if(ad(a,"cartesian2d")){var v=a.getAxis("x"),y=a.getAxis("y"),c=a.dimensions;Pw(r.get(c[0],t))?o[0]=v.toGlobalCoord(v.getExtent()[e?0:1]):Pw(r.get(c[1],t))&&(o[1]=y.toGlobalCoord(y.getExtent()[e?0:1]))}isNaN(l)||(o[0]=l),isNaN(u)||(o[1]=u)}r.setItemLayout(t,o)}var _Ot=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.updateTransform=function(e,i,n){i.eachSeries(function(a){var s=Zc.getMarkerModelFromSeries(a,"markLine");if(s){var o=s.getData(),l=E1(s).from,u=E1(s).to;l.each(function(c){hE(l,c,!0,a,n),hE(u,c,!1,a,n)}),o.each(function(c){o.setItemLayout(c,[l.getItemLayout(c),u.getItemLayout(c)])}),this.markerGroupMap.get(a.id).updateLayout()}},this)},t.prototype.renderSeries=function(e,i,n,a){var s=e.coordinateSystem,o=e.id,l=e.getData(),u=this.markerGroupMap,c=u.get(o)||u.set(o,new eL);this.group.add(c.group);var h=xOt(s,e,i),p=h.from,v=h.to,y=h.line;E1(i).from=p,E1(i).to=v,i.setData(y);var x=i.get("symbol"),w=i.get("symbolSize"),T=i.get("symbolRotate"),E=i.get("symbolOffset");Kt(x)||(x=[x,x]),Kt(w)||(w=[w,w]),Kt(T)||(T=[T,T]),Kt(E)||(E=[E,E]),h.from.each(function(L){M(p,L,!0),M(v,L,!1)}),y.each(function(L){var F=y.getItemModel(L).getModel("lineStyle").getLineStyle();y.setItemLayout(L,[p.getItemLayout(L),v.getItemLayout(L)]),F.stroke==null&&(F.stroke=p.getItemVisual(L,"style").fill),y.setItemVisual(L,{fromSymbolKeepAspect:p.getItemVisual(L,"symbolKeepAspect"),fromSymbolOffset:p.getItemVisual(L,"symbolOffset"),fromSymbolRotate:p.getItemVisual(L,"symbolRotate"),fromSymbolSize:p.getItemVisual(L,"symbolSize"),fromSymbol:p.getItemVisual(L,"symbol"),toSymbolKeepAspect:v.getItemVisual(L,"symbolKeepAspect"),toSymbolOffset:v.getItemVisual(L,"symbolOffset"),toSymbolRotate:v.getItemVisual(L,"symbolRotate"),toSymbolSize:v.getItemVisual(L,"symbolSize"),toSymbol:v.getItemVisual(L,"symbol"),style:F})}),c.updateData(y),h.line.eachItemGraphicEl(function(L){Je(L).dataModel=i,L.traverse(function(F){Je(F).dataModel=i})});function M(L,F,O){var U=L.getItemModel(F);hE(L,F,O,e,a);var W=U.getModel("itemStyle").getItemStyle();W.fill==null&&(W.fill=L_(l,"color")),L.setItemVisual(F,{symbolKeepAspect:U.get("symbolKeepAspect"),symbolOffset:ir(U.get("symbolOffset",!0),E[O?0:1]),symbolRotate:ir(U.get("symbolRotate",!0),T[O?0:1]),symbolSize:ir(U.get("symbolSize"),w[O?0:1]),symbol:ir(U.get("symbol",!0),x[O?0:1]),style:W})}this.markKeep(c),c.group.silent=i.get("silent")||e.get("silent")},t.type="markLine",t}(DL);function xOt(r,t,e){var i;r?i=te(r&&r.dimensions,function(u){var c=t.getData().getDimensionInfo(t.getData().mapDimension(u))||{};return Zt(Zt({},c),{name:u,ordinalMeta:null})}):i=[{name:"value",type:"float"}];var n=new Xa(i,e),a=new Xa(i,e),s=new Xa([],e),o=te(e.get("data"),nr(mOt,t,r,e));r&&(o=ti(o,nr(yOt,r)));var l=OZ(!!r,i);return n.initData(te(o,function(u){return u[0]}),null,l),a.initData(te(o,function(u){return u[1]}),null,l),s.initData(te(o,function(u){return u[2]})),s.hasItemOption=!0,{from:n,to:a,line:s}}const bOt=_Ot;function wOt(r){r.registerComponentModel(vOt),r.registerComponentView(bOt),r.registerPreprocessor(function(t){PL(t.series,"markLine")&&(t.markLine=t.markLine||{})})}var SOt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.createMarkerModelFromSeries=function(e,i,n){return new t(e,i,n)},t.type="markArea",t.defaultOption={z:1,tooltip:{trigger:"item"},animation:!1,label:{show:!0,position:"top"},itemStyle:{borderWidth:0},emphasis:{label:{show:!0,position:"top"}}},t}(Zc);const TOt=SOt;var I1=Ir(),AOt=function(r,t,e,i){var n=i[0],a=i[1];if(!(!n||!a)){var s=h_(r,n),o=h_(r,a),l=s.coord,u=o.coord;l[0]=Un(l[0],-1/0),l[1]=Un(l[1],-1/0),u[0]=Un(u[0],1/0),u[1]=Un(u[1],1/0);var c=MR([{},s,o]);return c.coord=[s.coord,o.coord],c.x0=s.x,c.y0=s.y,c.x1=o.x,c.y1=o.y,c}};function Rw(r){return!isNaN(r)&&!isFinite(r)}function Z6(r,t,e,i){var n=1-r;return Rw(t[n])&&Rw(e[n])}function COt(r,t){var e=t.coord[0],i=t.coord[1],n={coord:e,x:t.x0,y:t.y0},a={coord:i,x:t.x1,y:t.y1};return ad(r,"cartesian2d")?e&&i&&(Z6(1,e,i)||Z6(0,e,i))?!0:uOt(r,n,a):f_(r,n)||f_(r,a)}function q6(r,t,e,i,n){var a=i.coordinateSystem,s=r.getItemModel(t),o,l=he(s.get(e[0]),n.getWidth()),u=he(s.get(e[1]),n.getHeight());if(!isNaN(l)&&!isNaN(u))o=[l,u];else{if(i.getMarkerPosition){var c=r.getValues(["x0","y0"],t),h=r.getValues(["x1","y1"],t),p=a.clampData(c),v=a.clampData(h),y=[];e[0]==="x0"?y[0]=p[0]>v[0]?h[0]:c[0]:y[0]=p[0]>v[0]?c[0]:h[0],e[1]==="y0"?y[1]=p[1]>v[1]?h[1]:c[1]:y[1]=p[1]>v[1]?c[1]:h[1],o=i.getMarkerPosition(y,e,!0)}else{var x=r.get(e[0],t),w=r.get(e[1],t),T=[x,w];a.clampData&&a.clampData(T,T),o=a.dataToPoint(T,!0)}if(ad(a,"cartesian2d")){var E=a.getAxis("x"),M=a.getAxis("y"),x=r.get(e[0],t),w=r.get(e[1],t);Rw(x)?o[0]=E.toGlobalCoord(E.getExtent()[e[0]==="x0"?0:1]):Rw(w)&&(o[1]=M.toGlobalCoord(M.getExtent()[e[1]==="y0"?0:1]))}isNaN(l)||(o[0]=l),isNaN(u)||(o[1]=u)}return o}var Y6=[["x0","y0"],["x1","y0"],["x1","y1"],["x0","y1"]],EOt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.updateTransform=function(e,i,n){i.eachSeries(function(a){var s=Zc.getMarkerModelFromSeries(a,"markArea");if(s){var o=s.getData();o.each(function(l){var u=te(Y6,function(h){return q6(o,l,h,a,n)});o.setItemLayout(l,u);var c=o.getItemGraphicEl(l);c.setShape("points",u)})}},this)},t.prototype.renderSeries=function(e,i,n,a){var s=e.coordinateSystem,o=e.id,l=e.getData(),u=this.markerGroupMap,c=u.get(o)||u.set(o,{group:new Ke});this.group.add(c.group),this.markKeep(c);var h=IOt(s,e,i);i.setData(h),h.each(function(p){var v=te(Y6,function(W){return q6(h,p,W,e,a)}),y=s.getAxis("x").scale,x=s.getAxis("y").scale,w=y.getExtent(),T=x.getExtent(),E=[y.parse(h.get("x0",p)),y.parse(h.get("x1",p))],M=[x.parse(h.get("y0",p)),x.parse(h.get("y1",p))];ro(E),ro(M);var L=!(w[0]>E[1]||w[1]<E[0]||T[0]>M[1]||T[1]<M[0]),F=!L;h.setItemLayout(p,{points:v,allClipped:F});var O=h.getItemModel(p).getModel("itemStyle").getItemStyle(),U=L_(l,"color");O.fill||(O.fill=U,ve(O.fill)&&(O.fill=jb(O.fill,.4))),O.stroke||(O.stroke=U),h.setItemVisual(p,"style",O)}),h.diff(I1(c).data).add(function(p){var v=h.getItemLayout(p);if(!v.allClipped){var y=new ds({shape:{points:v.points}});h.setItemGraphicEl(p,y),c.group.add(y)}}).update(function(p,v){var y=I1(c).data.getItemGraphicEl(v),x=h.getItemLayout(p);x.allClipped?y&&c.group.remove(y):(y?zr(y,{shape:{points:x.points}},i,p):y=new ds({shape:{points:x.points}}),h.setItemGraphicEl(p,y),c.group.add(y))}).remove(function(p){var v=I1(c).data.getItemGraphicEl(p);c.group.remove(v)}).execute(),h.eachItemGraphicEl(function(p,v){var y=h.getItemModel(v),x=h.getItemVisual(v,"style");p.useStyle(h.getItemVisual(v,"style")),ra(p,Dn(y),{labelFetcher:i,labelDataIndex:v,defaultText:h.getName(v)||"",inheritColor:ve(x.fill)?jb(x.fill,1):"#000"}),ea(p,y),Ui(p,null,null,y.get(["emphasis","disabled"])),Je(p).dataModel=i}),I1(c).data=h,c.group.silent=i.get("silent")||e.get("silent")},t.type="markArea",t}(DL);function IOt(r,t,e){var i,n,a=["x0","y0","x1","y1"];if(r){var s=te(r&&r.dimensions,function(u){var c=t.getData(),h=c.getDimensionInfo(c.mapDimension(u))||{};return Zt(Zt({},h),{name:u,ordinalMeta:null})});n=te(a,function(u,c){return{name:u,type:s[c%2].type}}),i=new Xa(n,e)}else n=[{name:"value",type:"float"}],i=new Xa(n,e);var o=te(e.get("data"),nr(AOt,t,r,e));r&&(o=ti(o,nr(COt,r)));var l=r?function(u,c,h,p){var v=u.coord[Math.floor(p/2)][p%2];return kc(v,n[p])}:function(u,c,h,p){return kc(u.value,n[p])};return i.initData(o,null,l),i.hasItemOption=!0,i}const MOt=EOt;function POt(r){r.registerComponentModel(TOt),r.registerComponentView(MOt),r.registerPreprocessor(function(t){PL(t.series,"markArea")&&(t.markArea=t.markArea||{})})}var ROt=function(r,t){if(t==="all")return{type:"all",title:r.getLocaleModel().get(["legend","selector","all"])};if(t==="inverse")return{type:"inverse",title:r.getLocaleModel().get(["legend","selector","inverse"])}},DOt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.layoutMode={type:"box",ignoreSize:!0},e}return t.prototype.init=function(e,i,n){this.mergeDefaultAndTheme(e,n),e.selected=e.selected||{},this._updateSelector(e)},t.prototype.mergeOption=function(e,i){r.prototype.mergeOption.call(this,e,i),this._updateSelector(e)},t.prototype._updateSelector=function(e){var i=e.selector,n=this.ecModel;i===!0&&(i=e.selector=["all","inverse"]),Kt(i)&&J(i,function(a,s){ve(a)&&(a={type:a}),i[s]=cr(a,ROt(n,a.type))})},t.prototype.optionUpdated=function(){this._updateData(this.ecModel);var e=this._data;if(e[0]&&this.get("selectedMode")==="single"){for(var i=!1,n=0;n<e.length;n++){var a=e[n].get("name");if(this.isSelected(a)){this.select(a),i=!0;break}}!i&&this.select(e[0].get("name"))}},t.prototype._updateData=function(e){var i=[],n=[];e.eachRawSeries(function(l){var u=l.name;n.push(u);var c;if(l.legendVisualProvider){var h=l.legendVisualProvider,p=h.getAllNames();e.isSeriesFiltered(l)||(n=n.concat(p)),p.length?i=i.concat(p):c=!0}else c=!0;c&&VR(l)&&i.push(l.name)}),this._availableNames=n;var a=this.get("data")||i,s=Re(),o=te(a,function(l){return(ve(l)||Fr(l))&&(l={name:l}),s.get(l.name)?null:(s.set(l.name,!0),new fi(l,this,this.ecModel))},this);this._data=ti(o,function(l){return!!l})},t.prototype.getData=function(){return this._data},t.prototype.select=function(e){var i=this.option.selected,n=this.get("selectedMode");if(n==="single"){var a=this._data;J(a,function(s){i[s.get("name")]=!1})}i[e]=!0},t.prototype.unSelect=function(e){this.get("selectedMode")!=="single"&&(this.option.selected[e]=!1)},t.prototype.toggleSelected=function(e){var i=this.option.selected;i.hasOwnProperty(e)||(i[e]=!0),this[i[e]?"unSelect":"select"](e)},t.prototype.allSelect=function(){var e=this._data,i=this.option.selected;J(e,function(n){i[n.get("name",!0)]=!0})},t.prototype.inverseSelect=function(){var e=this._data,i=this.option.selected;J(e,function(n){var a=n.get("name",!0);i.hasOwnProperty(a)||(i[a]=!0),i[a]=!i[a]})},t.prototype.isSelected=function(e){var i=this.option.selected;return!(i.hasOwnProperty(e)&&!i[e])&&pr(this._availableNames,e)>=0},t.prototype.getOrient=function(){return this.get("orient")==="vertical"?{index:1,name:"vertical"}:{index:0,name:"horizontal"}},t.type="legend.plain",t.dependencies=["series"],t.defaultOption={z:4,show:!0,orient:"horizontal",left:"center",top:0,align:"auto",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemGap:10,itemWidth:25,itemHeight:14,symbolRotate:"inherit",symbolKeepAspect:!0,inactiveColor:"#ccc",inactiveBorderColor:"#ccc",inactiveBorderWidth:"auto",itemStyle:{color:"inherit",opacity:"inherit",borderColor:"inherit",borderWidth:"auto",borderCap:"inherit",borderJoin:"inherit",borderDashOffset:"inherit",borderMiterLimit:"inherit"},lineStyle:{width:"auto",color:"inherit",inactiveColor:"#ccc",inactiveWidth:2,opacity:"inherit",type:"inherit",cap:"inherit",join:"inherit",dashOffset:"inherit",miterLimit:"inherit"},textStyle:{color:"#333"},selectedMode:!0,selector:!1,selectorLabel:{show:!0,borderRadius:10,padding:[3,5,3,5],fontSize:12,fontFamily:"sans-serif",color:"#666",borderWidth:1,borderColor:"#666"},emphasis:{selectorLabel:{show:!0,color:"#eee",backgroundColor:"#666"}},selectorPosition:"auto",selectorItemGap:7,selectorButtonGap:10,tooltip:{show:!1}},t}(kr);const uP=DOt;var mp=nr,cP=J,M1=Ke,LOt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.newlineDisabled=!1,e}return t.prototype.init=function(){this.group.add(this._contentGroup=new M1),this.group.add(this._selectorGroup=new M1),this._isFirstRender=!0},t.prototype.getContentGroup=function(){return this._contentGroup},t.prototype.getSelectorGroup=function(){return this._selectorGroup},t.prototype.render=function(e,i,n){var a=this._isFirstRender;if(this._isFirstRender=!1,this.resetInner(),!!e.get("show",!0)){var s=e.get("align"),o=e.get("orient");(!s||s==="auto")&&(s=e.get("left")==="right"&&o==="vertical"?"right":"left");var l=e.get("selector",!0),u=e.get("selectorPosition",!0);l&&(!u||u==="auto")&&(u=o==="horizontal"?"end":"start"),this.renderInner(s,e,i,n,l,o,u);var c=e.getBoxLayoutParams(),h={width:n.getWidth(),height:n.getHeight()},p=e.get("padding"),v=bn(c,h,p),y=this.layoutInner(e,s,v,a,l,u),x=bn(We({width:y.width,height:y.height},c),h,p);this.group.x=x.x-y.x,this.group.y=x.y-y.y,this.group.markRedraw(),this.group.add(this._backgroundEl=SZ(y,e))}},t.prototype.resetInner=function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl),this.getSelectorGroup().removeAll()},t.prototype.renderInner=function(e,i,n,a,s,o,l){var u=this.getContentGroup(),c=Re(),h=i.get("selectedMode"),p=[];n.eachRawSeries(function(v){!v.get("legendHoverLink")&&p.push(v.id)}),cP(i.getData(),function(v,y){var x=v.get("name");if(!this.newlineDisabled&&(x===""||x===`
`)){var w=new M1;w.newline=!0,u.add(w);return}var T=n.getSeriesByName(x)[0];if(!c.get(x))if(T){var E=T.getData(),M=E.getVisual("legendLineStyle")||{},L=E.getVisual("legendIcon"),F=E.getVisual("style"),O=this._createItem(T,x,y,v,i,e,M,F,L,h,a);O.on("click",mp(K6,x,null,a,p)).on("mouseover",mp(hP,T.name,null,a,p)).on("mouseout",mp(fP,T.name,null,a,p)),n.ssr&&O.eachChild(function(U){var W=Je(U);W.seriesIndex=T.seriesIndex,W.dataIndex=y,W.ssrType="legend"}),c.set(x,!0)}else n.eachRawSeries(function(U){if(!c.get(x)&&U.legendVisualProvider){var W=U.legendVisualProvider;if(!W.containName(x))return;var H=W.indexOfName(x),j=W.getItemVisual(H,"style"),Y=W.getItemVisual(H,"legendIcon"),tt=Is(j.fill);tt&&tt[3]===0&&(tt[3]=.2,j=Zt(Zt({},j),{fill:uu(tt,"rgba")}));var it=this._createItem(U,x,y,v,i,e,{},j,Y,h,a);it.on("click",mp(K6,null,x,a,p)).on("mouseover",mp(hP,null,x,a,p)).on("mouseout",mp(fP,null,x,a,p)),n.ssr&&it.eachChild(function(lt){var ht=Je(lt);ht.seriesIndex=U.seriesIndex,ht.dataIndex=y,ht.ssrType="legend"}),c.set(x,!0)}},this)},this),s&&this._createSelector(s,i,a,o,l)},t.prototype._createSelector=function(e,i,n,a,s){var o=this.getSelectorGroup();cP(e,function(u){var c=u.type,h=new Nr({style:{x:0,y:0,align:"center",verticalAlign:"middle"},onclick:function(){n.dispatchAction({type:c==="all"?"legendAllSelect":"legendInverseSelect"})}});o.add(h);var p=i.getModel("selectorLabel"),v=i.getModel(["emphasis","selectorLabel"]);ra(h,{normal:p,emphasis:v},{defaultText:u.title}),If(h)})},t.prototype._createItem=function(e,i,n,a,s,o,l,u,c,h,p){var v=e.visualDrawType,y=s.get("itemWidth"),x=s.get("itemHeight"),w=s.isSelected(i),T=a.get("symbolRotate"),E=a.get("symbolKeepAspect"),M=a.get("icon");c=M||c||"roundRect";var L=kOt(c,a,l,u,v,w,p),F=new M1,O=a.getModel("textStyle");if(Ve(e.getLegendIcon)&&(!M||M==="inherit"))F.add(e.getLegendIcon({itemWidth:y,itemHeight:x,icon:c,iconRotate:T,itemStyle:L.itemStyle,lineStyle:L.lineStyle,symbolKeepAspect:E}));else{var U=M==="inherit"&&e.getData().getVisual("symbol")?T==="inherit"?e.getData().getVisual("symbolRotate"):T:0;F.add(OOt({itemWidth:y,itemHeight:x,icon:c,iconRotate:U,itemStyle:L.itemStyle,lineStyle:L.lineStyle,symbolKeepAspect:E}))}var W=o==="left"?y+5:-5,H=o,j=s.get("formatter"),Y=i;ve(j)&&j?Y=j.replace("{name}",i??""):Ve(j)&&(Y=j(i));var tt=w?O.getTextColor():a.get("inactiveColor");F.add(new Nr({style:hi(O,{text:Y,x:W,y:x/2,fill:tt,align:H,verticalAlign:"middle"},{inheritColor:tt})}));var it=new Pr({shape:F.getBoundingRect(),style:{fill:"transparent"}}),lt=a.getModel("tooltip");return lt.get("show")&&Lg({el:it,componentModel:s,itemName:i,itemTooltipOption:lt.option}),F.add(it),F.eachChild(function(ht){ht.silent=!0}),it.silent=!h,this.getContentGroup().add(F),If(F),F.__legendDataIndex=n,F},t.prototype.layoutInner=function(e,i,n,a,s,o){var l=this.getContentGroup(),u=this.getSelectorGroup();Pf(e.get("orient"),l,e.get("itemGap"),n.width,n.height);var c=l.getBoundingRect(),h=[-c.x,-c.y];if(u.markRedraw(),l.markRedraw(),s){Pf("horizontal",u,e.get("selectorItemGap",!0));var p=u.getBoundingRect(),v=[-p.x,-p.y],y=e.get("selectorButtonGap",!0),x=e.getOrient().index,w=x===0?"width":"height",T=x===0?"height":"width",E=x===0?"y":"x";o==="end"?v[x]+=c[w]+y:h[x]+=p[w]+y,v[1-x]+=c[T]/2-p[T]/2,u.x=v[0],u.y=v[1],l.x=h[0],l.y=h[1];var M={x:0,y:0};return M[w]=c[w]+y+p[w],M[T]=Math.max(c[T],p[T]),M[E]=Math.min(0,p[E]+v[1-x]),M}else return l.x=h[0],l.y=h[1],this.group.getBoundingRect()},t.prototype.remove=function(){this.getContentGroup().removeAll(),this._isFirstRender=!0},t.type="legend.plain",t}($i);function kOt(r,t,e,i,n,a,s){function o(w,T){w.lineWidth==="auto"&&(w.lineWidth=T.lineWidth>0?2:0),cP(w,function(E,M){w[M]==="inherit"&&(w[M]=T[M])})}var l=t.getModel("itemStyle"),u=l.getItemStyle(),c=r.lastIndexOf("empty",0)===0?"fill":"stroke",h=l.getShallow("decal");u.decal=!h||h==="inherit"?i.decal:gg(h,s),u.fill==="inherit"&&(u.fill=i[n]),u.stroke==="inherit"&&(u.stroke=i[c]),u.opacity==="inherit"&&(u.opacity=(n==="fill"?i:e).opacity),o(u,i);var p=t.getModel("lineStyle"),v=p.getLineStyle();if(o(v,e),u.fill==="auto"&&(u.fill=i.fill),u.stroke==="auto"&&(u.stroke=i.fill),v.stroke==="auto"&&(v.stroke=i.fill),!a){var y=t.get("inactiveBorderWidth"),x=u[c];u.lineWidth=y==="auto"?i.lineWidth>0&&x?2:0:u.lineWidth,u.fill=t.get("inactiveColor"),u.stroke=t.get("inactiveBorderColor"),v.stroke=p.get("inactiveColor"),v.lineWidth=p.get("inactiveWidth")}return{itemStyle:u,lineStyle:v}}function OOt(r){var t=r.icon||"roundRect",e=mn(t,0,0,r.itemWidth,r.itemHeight,r.itemStyle.fill,r.symbolKeepAspect);return e.setStyle(r.itemStyle),e.rotation=(r.iconRotate||0)*Math.PI/180,e.setOrigin([r.itemWidth/2,r.itemHeight/2]),t.indexOf("empty")>-1&&(e.style.stroke=e.style.fill,e.style.fill="#fff",e.style.lineWidth=2),e}function K6(r,t,e,i){fP(r,t,e,i),e.dispatchAction({type:"legendToggleSelect",name:r??t}),hP(r,t,e,i)}function NZ(r){for(var t=r.getZr().storage.getDisplayList(),e,i=0,n=t.length;i<n&&!(e=t[i].states.emphasis);)i++;return e&&e.hoverLayer}function hP(r,t,e,i){NZ(e)||e.dispatchAction({type:"highlight",seriesName:r,name:t,excludeSeriesId:i})}function fP(r,t,e,i){NZ(e)||e.dispatchAction({type:"downplay",seriesName:r,name:t,excludeSeriesId:i})}const FZ=LOt;function NOt(r){var t=r.findComponents({mainType:"legend"});t&&t.length&&r.filterSeries(function(e){for(var i=0;i<t.length;i++)if(!t[i].isSelected(e.name))return!1;return!0})}function Im(r,t,e){var i={},n=r==="toggleSelected",a;return e.eachComponent("legend",function(s){n&&a!=null?s[a?"select":"unSelect"](t.name):r==="allSelect"||r==="inverseSelect"?s[r]():(s[r](t.name),a=s.isSelected(t.name));var o=s.getData();J(o,function(l){var u=l.get("name");if(!(u===`
`||u==="")){var c=s.isSelected(u);i.hasOwnProperty(u)?i[u]=i[u]&&c:i[u]=c}})}),r==="allSelect"||r==="inverseSelect"?{selected:i}:{name:t.name,selected:i}}function FOt(r){r.registerAction("legendToggleSelect","legendselectchanged",nr(Im,"toggleSelected")),r.registerAction("legendAllSelect","legendselectall",nr(Im,"allSelect")),r.registerAction("legendInverseSelect","legendinverseselect",nr(Im,"inverseSelect")),r.registerAction("legendSelect","legendselected",nr(Im,"select")),r.registerAction("legendUnSelect","legendunselected",nr(Im,"unSelect"))}function BZ(r){r.registerComponentModel(uP),r.registerComponentView(FZ),r.registerProcessor(r.PRIORITY.PROCESSOR.SERIES_FILTER,NOt),r.registerSubTypeDefaulter("legend",function(){return"plain"}),FOt(r)}var BOt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.setScrollDataIndex=function(e){this.option.scrollDataIndex=e},t.prototype.init=function(e,i,n){var a=Fg(e);r.prototype.init.call(this,e,i,n),J6(this,e,a)},t.prototype.mergeOption=function(e,i){r.prototype.mergeOption.call(this,e,i),J6(this,this.option,e)},t.type="legend.scroll",t.defaultOption=Jc(uP.defaultOption,{scrollDataIndex:0,pageButtonItemGap:5,pageButtonGap:null,pageButtonPosition:"end",pageFormatter:"{current}/{total}",pageIcons:{horizontal:["M0,0L12,-10L12,10z","M0,0L-12,-10L-12,10z"],vertical:["M0,0L20,0L10,-20z","M0,0L20,0L10,20z"]},pageIconColor:"#2f4554",pageIconInactiveColor:"#aaa",pageIconSize:15,pageTextStyle:{color:"#333"},animationDurationUpdate:800}),t}(uP);function J6(r,t,e){var i=r.getOrient(),n=[1,1];n[i.index]=0,Wc(t,e,{type:"box",ignoreSize:!!n})}const zOt=BOt;var Q6=Ke,fE=["width","height"],dE=["x","y"],VOt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.newlineDisabled=!0,e._currentIndex=0,e}return t.prototype.init=function(){r.prototype.init.call(this),this.group.add(this._containerGroup=new Q6),this._containerGroup.add(this.getContentGroup()),this.group.add(this._controllerGroup=new Q6)},t.prototype.resetInner=function(){r.prototype.resetInner.call(this),this._controllerGroup.removeAll(),this._containerGroup.removeClipPath(),this._containerGroup.__rectSize=null},t.prototype.renderInner=function(e,i,n,a,s,o,l){var u=this;r.prototype.renderInner.call(this,e,i,n,a,s,o,l);var c=this._controllerGroup,h=i.get("pageIconSize",!0),p=Kt(h)?h:[h,h];y("pagePrev",0);var v=i.getModel("pageTextStyle");c.add(new Nr({name:"pageText",style:{text:"xx/xx",fill:v.getTextColor(),font:v.getFont(),verticalAlign:"middle",align:"center"},silent:!0})),y("pageNext",1);function y(x,w){var T=x+"DataIndex",E=R_(i.get("pageIcons",!0)[i.getOrient().name][w],{onclick:we(u._pageGo,u,T,i,a)},{x:-p[0]/2,y:-p[1]/2,width:p[0],height:p[1]});E.name=x,c.add(E)}},t.prototype.layoutInner=function(e,i,n,a,s,o){var l=this.getSelectorGroup(),u=e.getOrient().index,c=fE[u],h=dE[u],p=fE[1-u],v=dE[1-u];s&&Pf("horizontal",l,e.get("selectorItemGap",!0));var y=e.get("selectorButtonGap",!0),x=l.getBoundingRect(),w=[-x.x,-x.y],T=Ze(n);s&&(T[c]=n[c]-x[c]-y);var E=this._layoutContentAndController(e,a,T,u,c,p,v,h);if(s){if(o==="end")w[u]+=E[c]+y;else{var M=x[c]+y;w[u]-=M,E[h]-=M}E[c]+=x[c]+y,w[1-u]+=E[v]+E[p]/2-x[p]/2,E[p]=Math.max(E[p],x[p]),E[v]=Math.min(E[v],x[v]+w[1-u]),l.x=w[0],l.y=w[1],l.markRedraw()}return E},t.prototype._layoutContentAndController=function(e,i,n,a,s,o,l,u){var c=this.getContentGroup(),h=this._containerGroup,p=this._controllerGroup;Pf(e.get("orient"),c,e.get("itemGap"),a?n.width:null,a?null:n.height),Pf("horizontal",p,e.get("pageButtonItemGap",!0));var v=c.getBoundingRect(),y=p.getBoundingRect(),x=this._showController=v[s]>n[s],w=[-v.x,-v.y];i||(w[a]=c[u]);var T=[0,0],E=[-y.x,-y.y],M=ir(e.get("pageButtonGap",!0),e.get("itemGap",!0));if(x){var L=e.get("pageButtonPosition",!0);L==="end"?E[a]+=n[s]-y[s]:T[a]+=y[s]+M}E[1-a]+=v[o]/2-y[o]/2,c.setPosition(w),h.setPosition(T),p.setPosition(E);var F={x:0,y:0};if(F[s]=x?n[s]:v[s],F[o]=Math.max(v[o],y[o]),F[l]=Math.min(0,y[l]+E[1-a]),h.__rectSize=n[s],x){var O={x:0,y:0};O[s]=Math.max(n[s]-y[s]-M,0),O[o]=F[o],h.setClipPath(new Pr({shape:O})),h.__rectSize=O[s]}else p.eachChild(function(W){W.attr({invisible:!0,silent:!0})});var U=this._getPageInfo(e);return U.pageIndex!=null&&zr(c,{x:U.contentPosition[0],y:U.contentPosition[1]},x?e:null),this._updatePageInfoView(e,U),F},t.prototype._pageGo=function(e,i,n){var a=this._getPageInfo(i)[e];a!=null&&n.dispatchAction({type:"legendScroll",scrollDataIndex:a,legendId:i.id})},t.prototype._updatePageInfoView=function(e,i){var n=this._controllerGroup;J(["pagePrev","pageNext"],function(c){var h=c+"DataIndex",p=i[h]!=null,v=n.childOfName(c);v&&(v.setStyle("fill",p?e.get("pageIconColor",!0):e.get("pageIconInactiveColor",!0)),v.cursor=p?"pointer":"default")});var a=n.childOfName("pageText"),s=e.get("pageFormatter"),o=i.pageIndex,l=o!=null?o+1:0,u=i.pageCount;a&&s&&a.setStyle("text",ve(s)?s.replace("{current}",l==null?"":l+"").replace("{total}",u==null?"":u+""):s({current:l,total:u}))},t.prototype._getPageInfo=function(e){var i=e.get("scrollDataIndex",!0),n=this.getContentGroup(),a=this._containerGroup.__rectSize,s=e.getOrient().index,o=fE[s],l=dE[s],u=this._findTargetItemIndex(i),c=n.children(),h=c[u],p=c.length,v=p?1:0,y={contentPosition:[n.x,n.y],pageCount:v,pageIndex:v-1,pagePrevDataIndex:null,pageNextDataIndex:null};if(!h)return y;var x=L(h);y.contentPosition[s]=-x.s;for(var w=u+1,T=x,E=x,M=null;w<=p;++w)M=L(c[w]),(!M&&E.e>T.s+a||M&&!F(M,T.s))&&(E.i>T.i?T=E:T=M,T&&(y.pageNextDataIndex==null&&(y.pageNextDataIndex=T.i),++y.pageCount)),E=M;for(var w=u-1,T=x,E=x,M=null;w>=-1;--w)M=L(c[w]),(!M||!F(E,M.s))&&T.i<E.i&&(E=T,y.pagePrevDataIndex==null&&(y.pagePrevDataIndex=T.i),++y.pageCount,++y.pageIndex),T=M;return y;function L(O){if(O){var U=O.getBoundingRect(),W=U[l]+O[l];return{s:W,e:W+U[o],i:O.__legendDataIndex}}}function F(O,U){return O.e>=U&&O.s<=U+a}},t.prototype._findTargetItemIndex=function(e){if(!this._showController)return 0;var i,n=this.getContentGroup(),a;return n.eachChild(function(s,o){var l=s.__legendDataIndex;a==null&&l!=null&&(a=o),l===e&&(i=o)}),i??a},t.type="legend.scroll",t}(FZ);const UOt=VOt;function $Ot(r){r.registerAction("legendScroll","legendscroll",function(t,e){var i=t.scrollDataIndex;i!=null&&e.eachComponent({mainType:"legend",subType:"scroll",query:t},function(n){n.setScrollDataIndex(i)})})}function WOt(r){gr(BZ),r.registerComponentModel(zOt),r.registerComponentView(UOt),$Ot(r)}function HOt(r){gr(BZ),gr(WOt)}var GOt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.inside",t.defaultOption=Jc(c_.defaultOption,{disabled:!1,zoomLock:!1,zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),t}(c_);const jOt=GOt;var LL=Ir();function XOt(r,t,e){LL(r).coordSysRecordMap.each(function(i){var n=i.dataZoomInfoMap.get(t.uid);n&&(n.getRange=e)})}function ZOt(r,t){for(var e=LL(r).coordSysRecordMap,i=e.keys(),n=0;n<i.length;n++){var a=i[n],s=e.get(a),o=s.dataZoomInfoMap;if(o){var l=t.uid,u=o.get(l);u&&(o.removeKey(l),o.keys().length||zZ(e,s))}}}function zZ(r,t){if(t){r.removeKey(t.model.uid);var e=t.controller;e&&e.dispose()}}function qOt(r,t){var e={model:t,containsPoint:nr(KOt,t),dispatchAction:nr(YOt,r),dataZoomInfoMap:null,controller:null},i=e.controller=new $_(r.getZr());return J(["pan","zoom","scrollMove"],function(n){i.on(n,function(a){var s=[];e.dataZoomInfoMap.each(function(o){if(a.isAvailableBehavior(o.model.option)){var l=(o.getRange||{})[n],u=l&&l(o.dzReferCoordSysInfo,e.model.mainType,e.controller,a);!o.model.get("disabled",!0)&&u&&s.push({dataZoomId:o.model.id,start:u[0],end:u[1]})}}),s.length&&e.dispatchAction(s)})}),e}function YOt(r,t){r.isDisposed()||r.dispatchAction({type:"dataZoom",animation:{easing:"cubicOut",duration:100},batch:t})}function KOt(r,t,e,i){return r.coordinateSystem.containPoint([e,i])}function JOt(r){var t,e="type_",i={type_true:2,type_move:1,type_false:0,type_undefined:-1},n=!0;return r.each(function(a){var s=a.model,o=s.get("disabled",!0)?!1:s.get("zoomLock",!0)?"move":!0;i[e+o]>i[e+t]&&(t=o),n=n&&s.get("preventDefaultMouseMove",!0)}),{controlType:t,opt:{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!0,preventDefaultMouseMove:!!n}}}function QOt(r){r.registerProcessor(r.PRIORITY.PROCESSOR.FILTER,function(t,e){var i=LL(e),n=i.coordSysRecordMap||(i.coordSysRecordMap=Re());n.each(function(a){a.dataZoomInfoMap=null}),t.eachComponent({mainType:"dataZoom",subType:"inside"},function(a){var s=xZ(a);J(s.infoList,function(o){var l=o.model.uid,u=n.get(l)||n.set(l,qOt(e,o.model)),c=u.dataZoomInfoMap||(u.dataZoomInfoMap=Re());c.set(a.uid,{dzReferCoordSysInfo:o,model:a,getRange:null})})}),n.each(function(a){var s=a.controller,o,l=a.dataZoomInfoMap;if(l){var u=l.keys()[0];u!=null&&(o=l.get(u))}if(!o){zZ(n,a);return}var c=JOt(l);s.enable(c.controlType,c.opt),s.setPointerChecker(a.containsPoint),Ug(a,"dispatchAction",o.model.get("throttle",!0),"fixRate")})})}var tNt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="dataZoom.inside",e}return t.prototype.render=function(e,i,n){if(r.prototype.render.apply(this,arguments),e.noTarget()){this._clear();return}this.range=e.getPercentRange(),XOt(n,e,{pan:we(pE.pan,this),zoom:we(pE.zoom,this),scrollMove:we(pE.scrollMove,this)})},t.prototype.dispose=function(){this._clear(),r.prototype.dispose.apply(this,arguments)},t.prototype._clear=function(){ZOt(this.api,this.dataZoomModel),this.range=null},t.type="dataZoom.inside",t}(TL),pE={zoom:function(r,t,e,i){var n=this.range,a=n.slice(),s=r.axisModels[0];if(s){var o=gE[t](null,[i.originX,i.originY],s,e,r),l=(o.signal>0?o.pixelStart+o.pixelLength-o.pixel:o.pixel-o.pixelStart)/o.pixelLength*(a[1]-a[0])+a[0],u=Math.max(1/i.scale,0);a[0]=(a[0]-l)*u+l,a[1]=(a[1]-l)*u+l;var c=this.dataZoomModel.findRepresentativeAxisProxy().getMinMaxSpan();if(od(0,a,[0,100],0,c.minSpan,c.maxSpan),this.range=a,n[0]!==a[0]||n[1]!==a[1])return a}},pan:tU(function(r,t,e,i,n,a){var s=gE[i]([a.oldX,a.oldY],[a.newX,a.newY],t,n,e);return s.signal*(r[1]-r[0])*s.pixel/s.pixelLength}),scrollMove:tU(function(r,t,e,i,n,a){var s=gE[i]([0,0],[a.scrollDelta,a.scrollDelta],t,n,e);return s.signal*(r[1]-r[0])*a.scrollDelta})};function tU(r){return function(t,e,i,n){var a=this.range,s=a.slice(),o=t.axisModels[0];if(o){var l=r(s,o,t,e,i,n);if(od(l,s,[0,100],"all"),this.range=s,a[0]!==s[0]||a[1]!==s[1])return s}}}var gE={grid:function(r,t,e,i,n){var a=e.axis,s={},o=n.model.coordinateSystem.getRect();return r=r||[0,0],a.dim==="x"?(s.pixel=t[0]-r[0],s.pixelLength=o.width,s.pixelStart=o.x,s.signal=a.inverse?1:-1):(s.pixel=t[1]-r[1],s.pixelLength=o.height,s.pixelStart=o.y,s.signal=a.inverse?-1:1),s},polar:function(r,t,e,i,n){var a=e.axis,s={},o=n.model.coordinateSystem,l=o.getRadiusAxis().getExtent(),u=o.getAngleAxis().getExtent();return r=r?o.pointToCoord(r):[0,0],t=o.pointToCoord(t),e.mainType==="radiusAxis"?(s.pixel=t[0]-r[0],s.pixelLength=l[1]-l[0],s.pixelStart=l[0],s.signal=a.inverse?1:-1):(s.pixel=t[1]-r[1],s.pixelLength=u[1]-u[0],s.pixelStart=u[0],s.signal=a.inverse?-1:1),s},singleAxis:function(r,t,e,i,n){var a=e.axis,s=n.model.coordinateSystem.getRect(),o={};return r=r||[0,0],a.orient==="horizontal"?(o.pixel=t[0]-r[0],o.pixelLength=s.width,o.pixelStart=s.x,o.signal=a.inverse?1:-1):(o.pixel=t[1]-r[1],o.pixelLength=s.height,o.pixelStart=s.y,o.signal=a.inverse?-1:1),o}};const eNt=tNt;function VZ(r){AL(r),r.registerComponentModel(jOt),r.registerComponentView(eNt),QOt(r)}var rNt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.slider",t.layoutMode="box",t.defaultOption=Jc(c_.defaultOption,{show:!0,right:"ph",top:"ph",width:"ph",height:"ph",left:null,bottom:null,borderColor:"#d2dbee",borderRadius:3,backgroundColor:"rgba(47,69,84,0)",dataBackground:{lineStyle:{color:"#d2dbee",width:.5},areaStyle:{color:"#d2dbee",opacity:.2}},selectedDataBackground:{lineStyle:{color:"#8fb0f7",width:.5},areaStyle:{color:"#8fb0f7",opacity:.2}},fillerColor:"rgba(135,175,274,0.2)",handleIcon:"path://M-9.35,34.56V42m0-40V9.5m-2,0h4a2,2,0,0,1,2,2v21a2,2,0,0,1-2,2h-4a2,2,0,0,1-2-2v-21A2,2,0,0,1-11.35,9.5Z",handleSize:"100%",handleStyle:{color:"#fff",borderColor:"#ACB8D1"},moveHandleSize:7,moveHandleIcon:"path://M-320.9-50L-320.9-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-348-41-339-50-320.9-50z M-212.3-50L-212.3-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-239.4-41-230.4-50-212.3-50z M-103.7-50L-103.7-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-130.9-41-121.8-50-103.7-50z",moveHandleStyle:{color:"#D2DBEE",opacity:.7},showDetail:!0,showDataShadow:"auto",realtime:!0,zoomLock:!1,textStyle:{color:"#6E7079"},brushSelect:!0,brushStyle:{color:"rgba(135,175,274,0.15)"},emphasis:{handleStyle:{borderColor:"#8FB0F7"},moveHandleStyle:{color:"#8FB0F7"}}}),t}(c_);const iNt=rNt;var Mm=Pr,eU=7,nNt=1,vE=30,aNt=7,Pm="horizontal",rU="vertical",sNt=5,oNt=["line","bar","candlestick","scatter"],lNt={easing:"cubicOut",duration:100,delay:0},uNt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e._displayables={},e}return t.prototype.init=function(e,i){this.api=i,this._onBrush=we(this._onBrush,this),this._onBrushEnd=we(this._onBrushEnd,this)},t.prototype.render=function(e,i,n,a){if(r.prototype.render.apply(this,arguments),Ug(this,"_dispatchZoomAction",e.get("throttle"),"fixRate"),this._orient=e.getOrient(),e.get("show")===!1){this.group.removeAll();return}if(e.noTarget()){this._clear(),this.group.removeAll();return}(!a||a.type!=="dataZoom"||a.from!==this.uid)&&this._buildView(),this._updateView()},t.prototype.dispose=function(){this._clear(),r.prototype.dispose.apply(this,arguments)},t.prototype._clear=function(){Jy(this,"_dispatchZoomAction");var e=this.api.getZr();e.off("mousemove",this._onBrush),e.off("mouseup",this._onBrushEnd)},t.prototype._buildView=function(){var e=this.group;e.removeAll(),this._brushing=!1,this._displayables.brushRect=null,this._resetLocation(),this._resetInterval();var i=this._displayables.sliderGroup=new Ke;this._renderBackground(),this._renderHandle(),this._renderDataShadow(),e.add(i),this._positionGroup()},t.prototype._resetLocation=function(){var e=this.dataZoomModel,i=this.api,n=e.get("brushSelect"),a=n?aNt:0,s=this._findCoordRect(),o={width:i.getWidth(),height:i.getHeight()},l=this._orient===Pm?{right:o.width-s.x-s.width,top:o.height-vE-eU-a,width:s.width,height:vE}:{right:eU,top:s.y,width:vE,height:s.height},u=Fg(e.option);J(["right","top","width","height"],function(h){u[h]==="ph"&&(u[h]=l[h])});var c=bn(u,o);this._location={x:c.x,y:c.y},this._size=[c.width,c.height],this._orient===rU&&this._size.reverse()},t.prototype._positionGroup=function(){var e=this.group,i=this._location,n=this._orient,a=this.dataZoomModel.getFirstTargetAxisModel(),s=a&&a.get("inverse"),o=this._displayables.sliderGroup,l=(this._dataShadowInfo||{}).otherAxisInverse;o.attr(n===Pm&&!s?{scaleY:l?1:-1,scaleX:1}:n===Pm&&s?{scaleY:l?1:-1,scaleX:-1}:n===rU&&!s?{scaleY:l?-1:1,scaleX:1,rotation:Math.PI/2}:{scaleY:l?-1:1,scaleX:-1,rotation:Math.PI/2});var u=e.getBoundingRect([o]);e.x=i.x-u.x,e.y=i.y-u.y,e.markRedraw()},t.prototype._getViewExtent=function(){return[0,this._size[0]]},t.prototype._renderBackground=function(){var e=this.dataZoomModel,i=this._size,n=this._displayables.sliderGroup,a=e.get("brushSelect");n.add(new Mm({silent:!0,shape:{x:0,y:0,width:i[0],height:i[1]},style:{fill:e.get("backgroundColor")},z2:-40}));var s=new Mm({shape:{x:0,y:0,width:i[0],height:i[1]},style:{fill:"transparent"},z2:0,onclick:we(this._onClickPanel,this)}),o=this.api.getZr();a?(s.on("mousedown",this._onBrushStart,this),s.cursor="crosshair",o.on("mousemove",this._onBrush),o.on("mouseup",this._onBrushEnd)):(o.off("mousemove",this._onBrush),o.off("mouseup",this._onBrushEnd)),n.add(s)},t.prototype._renderDataShadow=function(){var e=this._dataShadowInfo=this._prepareDataShadowInfo();if(this._displayables.dataShadowSegs=[],!e)return;var i=this._size,n=this._shadowSize||[],a=e.series,s=a.getRawData(),o=a.getShadowDim&&a.getShadowDim(),l=o&&s.getDimensionInfo(o)?a.getShadowDim():e.otherDim;if(l==null)return;var u=this._shadowPolygonPts,c=this._shadowPolylinePts;if(s!==this._shadowData||l!==this._shadowDim||i[0]!==n[0]||i[1]!==n[1]){var h=s.getDataExtent(l),p=(h[1]-h[0])*.3;h=[h[0]-p,h[1]+p];var v=[0,i[1]],y=[0,i[0]],x=[[i[0],0],[0,0]],w=[],T=y[1]/(s.count()-1),E=0,M=Math.round(s.count()/i[0]),L;s.each([l],function(H,j){if(M>0&&j%M){E+=T;return}var Y=H==null||isNaN(H)||H==="",tt=Y?0:Jr(H,h,v,!0);Y&&!L&&j?(x.push([x[x.length-1][0],0]),w.push([w[w.length-1][0],0])):!Y&&L&&(x.push([E,0]),w.push([E,0])),x.push([E,tt]),w.push([E,tt]),E+=T,L=Y}),u=this._shadowPolygonPts=x,c=this._shadowPolylinePts=w}this._shadowData=s,this._shadowDim=l,this._shadowSize=[i[0],i[1]];var F=this.dataZoomModel;function O(H){var j=F.getModel(H?"selectedDataBackground":"dataBackground"),Y=new Ke,tt=new ds({shape:{points:u},segmentIgnoreThreshold:1,style:j.getModel("areaStyle").getAreaStyle(),silent:!0,z2:-20}),it=new ps({shape:{points:c},segmentIgnoreThreshold:1,style:j.getModel("lineStyle").getLineStyle(),silent:!0,z2:-19});return Y.add(tt),Y.add(it),Y}for(var U=0;U<3;U++){var W=O(U===1);this._displayables.sliderGroup.add(W),this._displayables.dataShadowSegs.push(W)}},t.prototype._prepareDataShadowInfo=function(){var e=this.dataZoomModel,i=e.get("showDataShadow");if(i!==!1){var n,a=this.ecModel;return e.eachTargetAxis(function(s,o){var l=e.getAxisProxy(s,o).getTargetSeriesModels();J(l,function(u){if(!n&&!(i!==!0&&pr(oNt,u.get("type"))<0)){var c=a.getComponent(Ic(s),o).axis,h=cNt(s),p,v=u.coordinateSystem;h!=null&&v.getOtherAxis&&(p=v.getOtherAxis(c).inverse),h=u.getData().mapDimension(h),n={thisAxis:c,series:u,thisDim:s,otherDim:h,otherAxisInverse:p}}},this)},this),n}},t.prototype._renderHandle=function(){var e=this.group,i=this._displayables,n=i.handles=[null,null],a=i.handleLabels=[null,null],s=this._displayables.sliderGroup,o=this._size,l=this.dataZoomModel,u=this.api,c=l.get("borderRadius")||0,h=l.get("brushSelect"),p=i.filler=new Mm({silent:h,style:{fill:l.get("fillerColor")},textConfig:{position:"inside"}});s.add(p),s.add(new Mm({silent:!0,subPixelOptimize:!0,shape:{x:0,y:0,width:o[0],height:o[1],r:c},style:{stroke:l.get("dataBackgroundColor")||l.get("borderColor"),lineWidth:nNt,fill:"rgba(0,0,0,0)"}})),J([0,1],function(M){var L=l.get("handleIcon");!ow[L]&&L.indexOf("path://")<0&&L.indexOf("image://")<0&&(L="path://"+L);var F=mn(L,-1,0,2,2,null,!0);F.attr({cursor:iU(this._orient),draggable:!0,drift:we(this._onDragMove,this,M),ondragend:we(this._onDragEnd,this),onmouseover:we(this._showDataInfo,this,!0),onmouseout:we(this._showDataInfo,this,!1),z2:5});var O=F.getBoundingRect(),U=l.get("handleSize");this._handleHeight=he(U,this._size[1]),this._handleWidth=O.width/O.height*this._handleHeight,F.setStyle(l.getModel("handleStyle").getItemStyle()),F.style.strokeNoScale=!0,F.rectHover=!0,F.ensureState("emphasis").style=l.getModel(["emphasis","handleStyle"]).getItemStyle(),If(F);var W=l.get("handleColor");W!=null&&(F.style.fill=W),s.add(n[M]=F);var H=l.getModel("textStyle");e.add(a[M]=new Nr({silent:!0,invisible:!0,style:hi(H,{x:0,y:0,text:"",verticalAlign:"middle",align:"center",fill:H.getTextColor(),font:H.getFont()}),z2:10}))},this);var v=p;if(h){var y=he(l.get("moveHandleSize"),o[1]),x=i.moveHandle=new Pr({style:l.getModel("moveHandleStyle").getItemStyle(),silent:!0,shape:{r:[0,0,2,2],y:o[1]-.5,height:y}}),w=y*.8,T=i.moveHandleIcon=mn(l.get("moveHandleIcon"),-w/2,-w/2,w,w,"#fff",!0);T.silent=!0,T.y=o[1]+y/2-.5,x.ensureState("emphasis").style=l.getModel(["emphasis","moveHandleStyle"]).getItemStyle();var E=Math.min(o[1]/2,Math.max(y,10));v=i.moveZone=new Pr({invisible:!0,shape:{y:o[1]-E,height:y+E}}),v.on("mouseover",function(){u.enterEmphasis(x)}).on("mouseout",function(){u.leaveEmphasis(x)}),s.add(x),s.add(T),s.add(v)}v.attr({draggable:!0,cursor:iU(this._orient),drift:we(this._onDragMove,this,"all"),ondragstart:we(this._showDataInfo,this,!0),ondragend:we(this._onDragEnd,this),onmouseover:we(this._showDataInfo,this,!0),onmouseout:we(this._showDataInfo,this,!1)})},t.prototype._resetInterval=function(){var e=this._range=this.dataZoomModel.getPercentRange(),i=this._getViewExtent();this._handleEnds=[Jr(e[0],[0,100],i,!0),Jr(e[1],[0,100],i,!0)]},t.prototype._updateInterval=function(e,i){var n=this.dataZoomModel,a=this._handleEnds,s=this._getViewExtent(),o=n.findRepresentativeAxisProxy().getMinMaxSpan(),l=[0,100];od(i,a,s,n.get("zoomLock")?"all":e,o.minSpan!=null?Jr(o.minSpan,l,s,!0):null,o.maxSpan!=null?Jr(o.maxSpan,l,s,!0):null);var u=this._range,c=this._range=ro([Jr(a[0],s,l,!0),Jr(a[1],s,l,!0)]);return!u||u[0]!==c[0]||u[1]!==c[1]},t.prototype._updateView=function(e){var i=this._displayables,n=this._handleEnds,a=ro(n.slice()),s=this._size;J([0,1],function(v){var y=i.handles[v],x=this._handleHeight;y.attr({scaleX:x/2,scaleY:x/2,x:n[v]+(v?-1:1),y:s[1]/2-x/2})},this),i.filler.setShape({x:a[0],y:0,width:a[1]-a[0],height:s[1]});var o={x:a[0],width:a[1]-a[0]};i.moveHandle&&(i.moveHandle.setShape(o),i.moveZone.setShape(o),i.moveZone.getBoundingRect(),i.moveHandleIcon&&i.moveHandleIcon.attr("x",o.x+o.width/2));for(var l=i.dataShadowSegs,u=[0,a[0],a[1],s[0]],c=0;c<l.length;c++){var h=l[c],p=h.getClipPath();p||(p=new Pr,h.setClipPath(p)),p.setShape({x:u[c],y:0,width:u[c+1]-u[c],height:s[1]})}this._updateDataInfo(e)},t.prototype._updateDataInfo=function(e){var i=this.dataZoomModel,n=this._displayables,a=n.handleLabels,s=this._orient,o=["",""];if(i.get("showDetail")){var l=i.findRepresentativeAxisProxy();if(l){var u=l.getAxisModel().axis,c=this._range,h=e?l.calculateDataWindow({start:c[0],end:c[1]}).valueWindow:l.getDataValueWindow();o=[this._formatLabel(h[0],u),this._formatLabel(h[1],u)]}}var p=ro(this._handleEnds.slice());v.call(this,0),v.call(this,1);function v(y){var x=Mf(n.handles[y].parent,this.group),w=PS(y===0?"right":"left",x),T=this._handleWidth/2+sNt,E=Fo([p[y]+(y===0?-T:T),this._size[1]/2],x);a[y].setStyle({x:E[0],y:E[1],verticalAlign:s===Pm?"middle":w,align:s===Pm?w:"center",text:o[y]})}},t.prototype._formatLabel=function(e,i){var n=this.dataZoomModel,a=n.get("labelFormatter"),s=n.get("labelPrecision");(s==null||s==="auto")&&(s=i.getPixelPrecision());var o=e==null||isNaN(e)?"":i.type==="category"||i.type==="time"?i.scale.getLabel({value:Math.round(e)}):e.toFixed(Math.min(s,20));return Ve(a)?a(e,o):ve(a)?a.replace("{value}",o):o},t.prototype._showDataInfo=function(e){e=this._dragging||e;var i=this._displayables,n=i.handleLabels;n[0].attr("invisible",!e),n[1].attr("invisible",!e),i.moveHandle&&this.api[e?"enterEmphasis":"leaveEmphasis"](i.moveHandle,1)},t.prototype._onDragMove=function(e,i,n,a){this._dragging=!0,pu(a.event);var s=this._displayables.sliderGroup.getLocalTransform(),o=Fo([i,n],s,!0),l=this._updateInterval(e,o[0]),u=this.dataZoomModel.get("realtime");this._updateView(!u),l&&u&&this._dispatchZoomAction(!0)},t.prototype._onDragEnd=function(){this._dragging=!1,this._showDataInfo(!1);var e=this.dataZoomModel.get("realtime");!e&&this._dispatchZoomAction(!1)},t.prototype._onClickPanel=function(e){var i=this._size,n=this._displayables.sliderGroup.transformCoordToLocal(e.offsetX,e.offsetY);if(!(n[0]<0||n[0]>i[0]||n[1]<0||n[1]>i[1])){var a=this._handleEnds,s=(a[0]+a[1])/2,o=this._updateInterval("all",n[0]-s);this._updateView(),o&&this._dispatchZoomAction(!1)}},t.prototype._onBrushStart=function(e){var i=e.offsetX,n=e.offsetY;this._brushStart=new lr(i,n),this._brushing=!0,this._brushStartTime=+new Date},t.prototype._onBrushEnd=function(e){if(this._brushing){var i=this._displayables.brushRect;if(this._brushing=!1,!!i){i.attr("ignore",!0);var n=i.shape,a=+new Date;if(!(a-this._brushStartTime<200&&Math.abs(n.width)<5)){var s=this._getViewExtent(),o=[0,100];this._range=ro([Jr(n.x,s,o,!0),Jr(n.x+n.width,s,o,!0)]),this._handleEnds=[n.x,n.x+n.width],this._updateView(),this._dispatchZoomAction(!1)}}}},t.prototype._onBrush=function(e){this._brushing&&(pu(e.event),this._updateBrushRect(e.offsetX,e.offsetY))},t.prototype._updateBrushRect=function(e,i){var n=this._displayables,a=this.dataZoomModel,s=n.brushRect;s||(s=n.brushRect=new Mm({silent:!0,style:a.getModel("brushStyle").getItemStyle()}),n.sliderGroup.add(s)),s.attr("ignore",!1);var o=this._brushStart,l=this._displayables.sliderGroup,u=l.transformCoordToLocal(e,i),c=l.transformCoordToLocal(o.x,o.y),h=this._size;u[0]=Math.max(Math.min(h[0],u[0]),0),s.setShape({x:c[0],y:0,width:u[0]-c[0],height:h[1]})},t.prototype._dispatchZoomAction=function(e){var i=this._range;this.api.dispatchAction({type:"dataZoom",from:this.uid,dataZoomId:this.dataZoomModel.id,animation:e?lNt:null,start:i[0],end:i[1]})},t.prototype._findCoordRect=function(){var e,i=xZ(this.dataZoomModel).infoList;if(!e&&i.length){var n=i[0].model.coordinateSystem;e=n.getRect&&n.getRect()}if(!e){var a=this.api.getWidth(),s=this.api.getHeight();e={x:a*.2,y:s*.2,width:a*.6,height:s*.6}}return e},t.type="dataZoom.slider",t}(TL);function cNt(r){var t={x:"y",y:"x",radius:"angle",angle:"radius"};return t[r]}function iU(r){return r==="vertical"?"ns-resize":"ew-resize"}const hNt=uNt;function UZ(r){r.registerComponentModel(iNt),r.registerComponentView(hNt),AL(r)}function fNt(r){gr(VZ),gr(UZ)}var dNt={get:function(r,t,e){var i=Ze((pNt[r]||{})[t]);return e&&Kt(i)?i[i.length-1]:i}},pNt={color:{active:["#006edd","#e0ffff"],inactive:["rgba(0,0,0,0)"]},colorHue:{active:[0,360],inactive:[0,0]},colorSaturation:{active:[.3,1],inactive:[0,0]},colorLightness:{active:[.9,.5],inactive:[0,0]},colorAlpha:{active:[.3,1],inactive:[0,0]},opacity:{active:[.3,1],inactive:[0,0]},symbol:{active:["circle","roundRect","diamond"],inactive:["none"]},symbolSize:{active:[10,50],inactive:[0,0]}};const $Z=dNt;var nU=ta.mapVisual,gNt=ta.eachVisual,vNt=Kt,aU=J,mNt=ro,yNt=Jr,_Nt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.stateList=["inRange","outOfRange"],e.replacableOptionKeys=["inRange","outOfRange","target","controller","color"],e.layoutMode={type:"box",ignoreSize:!0},e.dataBound=[-1/0,1/0],e.targetVisuals={},e.controllerVisuals={},e}return t.prototype.init=function(e,i,n){this.mergeDefaultAndTheme(e,n)},t.prototype.optionUpdated=function(e,i){var n=this.option;!i&&PZ(n,e,this.replacableOptionKeys),this.textStyleModel=this.getModel("textStyle"),this.resetItemSize(),this.completeVisualOption()},t.prototype.resetVisual=function(e){var i=this.stateList;e=we(e,this),this.controllerVisuals=sP(this.option.controller,i,e),this.targetVisuals=sP(this.option.target,i,e)},t.prototype.getItemSymbol=function(){return null},t.prototype.getTargetSeriesIndices=function(){var e=this.option.seriesIndex,i=[];return e==null||e==="all"?this.ecModel.eachSeries(function(n,a){i.push(a)}):i=ri(e),i},t.prototype.eachTargetSeries=function(e,i){J(this.getTargetSeriesIndices(),function(n){var a=this.ecModel.getSeriesByIndex(n);a&&e.call(i,a)},this)},t.prototype.isTargetSeries=function(e){var i=!1;return this.eachTargetSeries(function(n){n===e&&(i=!0)}),i},t.prototype.formatValueText=function(e,i,n){var a=this.option,s=a.precision,o=this.dataBound,l=a.formatter,u;n=n||["<",">"],Kt(e)&&(e=e.slice(),u=!0);var c=i?e:u?[h(e[0]),h(e[1])]:h(e);if(ve(l))return l.replace("{value}",u?c[0]:c).replace("{value2}",u?c[1]:c);if(Ve(l))return u?l(e[0],e[1]):l(e);if(u)return e[0]===o[0]?n[0]+" "+c[1]:e[1]===o[1]?n[1]+" "+c[0]:c[0]+" - "+c[1];return c;function h(p){return p===o[0]?"min":p===o[1]?"max":(+p).toFixed(Math.min(s,20))}},t.prototype.resetExtent=function(){var e=this.option,i=mNt([e.min,e.max]);this._dataExtent=i},t.prototype.getDataDimensionIndex=function(e){var i=this.option.dimension;if(i!=null)return e.getDimensionIndex(i);for(var n=e.dimensions,a=n.length-1;a>=0;a--){var s=n[a],o=e.getDimensionInfo(s);if(!o.isCalculationCoord)return o.storeDimIndex}},t.prototype.getExtent=function(){return this._dataExtent.slice()},t.prototype.completeVisualOption=function(){var e=this.ecModel,i=this.option,n={inRange:i.inRange,outOfRange:i.outOfRange},a=i.target||(i.target={}),s=i.controller||(i.controller={});cr(a,n),cr(s,n);var o=this.isCategory();l.call(this,a),l.call(this,s),u.call(this,a,"inRange","outOfRange"),c.call(this,s);function l(h){vNt(i.color)&&!h.inRange&&(h.inRange={color:i.color.slice().reverse()}),h.inRange=h.inRange||{color:e.get("gradientColor")}}function u(h,p,v){var y=h[p],x=h[v];y&&!x&&(x=h[v]={},aU(y,function(w,T){if(ta.isValidType(T)){var E=$Z.get(T,"inactive",o);E!=null&&(x[T]=E,T==="color"&&!x.hasOwnProperty("opacity")&&!x.hasOwnProperty("colorAlpha")&&(x.opacity=[0,0]))}}))}function c(h){var p=(h.inRange||{}).symbol||(h.outOfRange||{}).symbol,v=(h.inRange||{}).symbolSize||(h.outOfRange||{}).symbolSize,y=this.get("inactiveColor"),x=this.getItemSymbol(),w=x||"roundRect";aU(this.stateList,function(T){var E=this.itemSize,M=h[T];M||(M=h[T]={color:o?y:[y]}),M.symbol==null&&(M.symbol=p&&Ze(p)||(o?w:[w])),M.symbolSize==null&&(M.symbolSize=v&&Ze(v)||(o?E[0]:[E[0],E[0]])),M.symbol=nU(M.symbol,function(O){return O==="none"?w:O});var L=M.symbolSize;if(L!=null){var F=-1/0;gNt(L,function(O){O>F&&(F=O)}),M.symbolSize=nU(L,function(O){return yNt(O,[0,F],[0,E[0]],!0)})}},this)}},t.prototype.resetItemSize=function(){this.itemSize=[parseFloat(this.get("itemWidth")),parseFloat(this.get("itemHeight"))]},t.prototype.isCategory=function(){return!!this.option.categories},t.prototype.setSelected=function(e){},t.prototype.getSelected=function(){return null},t.prototype.getValueState=function(e){return null},t.prototype.getVisualMeta=function(e){return null},t.type="visualMap",t.dependencies=["series"],t.defaultOption={show:!0,z:4,seriesIndex:"all",min:0,max:200,left:0,right:null,top:null,bottom:0,itemWidth:null,itemHeight:null,inverse:!1,orient:"vertical",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",contentColor:"#5793f3",inactiveColor:"#aaa",borderWidth:0,padding:5,textGap:10,precision:0,textStyle:{color:"#333"}},t}(kr);const Dw=_Nt;var sU=[20,140],xNt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(e,i){r.prototype.optionUpdated.apply(this,arguments),this.resetExtent(),this.resetVisual(function(n){n.mappingMethod="linear",n.dataExtent=this.getExtent()}),this._resetRange()},t.prototype.resetItemSize=function(){r.prototype.resetItemSize.apply(this,arguments);var e=this.itemSize;(e[0]==null||isNaN(e[0]))&&(e[0]=sU[0]),(e[1]==null||isNaN(e[1]))&&(e[1]=sU[1])},t.prototype._resetRange=function(){var e=this.getExtent(),i=this.option.range;!i||i.auto?(e.auto=1,this.option.range=e):Kt(i)&&(i[0]>i[1]&&i.reverse(),i[0]=Math.max(i[0],e[0]),i[1]=Math.min(i[1],e[1]))},t.prototype.completeVisualOption=function(){r.prototype.completeVisualOption.apply(this,arguments),J(this.stateList,function(e){var i=this.option.controller[e].symbolSize;i&&i[0]!==i[1]&&(i[0]=i[1]/3)},this)},t.prototype.setSelected=function(e){this.option.range=e.slice(),this._resetRange()},t.prototype.getSelected=function(){var e=this.getExtent(),i=ro((this.get("range")||[]).slice());return i[0]>e[1]&&(i[0]=e[1]),i[1]>e[1]&&(i[1]=e[1]),i[0]<e[0]&&(i[0]=e[0]),i[1]<e[0]&&(i[1]=e[0]),i},t.prototype.getValueState=function(e){var i=this.option.range,n=this.getExtent();return(i[0]<=n[0]||i[0]<=e)&&(i[1]>=n[1]||e<=i[1])?"inRange":"outOfRange"},t.prototype.findTargetDataIndices=function(e){var i=[];return this.eachTargetSeries(function(n){var a=[],s=n.getData();s.each(this.getDataDimensionIndex(s),function(o,l){e[0]<=o&&o<=e[1]&&a.push(l)},this),i.push({seriesId:n.id,dataIndex:a})},this),i},t.prototype.getVisualMeta=function(e){var i=oU(this,"outOfRange",this.getExtent()),n=oU(this,"inRange",this.option.range.slice()),a=[];function s(v,y){a.push({value:v,color:e(v,y)})}for(var o=0,l=0,u=n.length,c=i.length;l<c&&(!n.length||i[l]<=n[0]);l++)i[l]<n[o]&&s(i[l],"outOfRange");for(var h=1;o<u;o++,h=0)h&&a.length&&s(n[o],"outOfRange"),s(n[o],"inRange");for(var h=1;l<c;l++)(!n.length||n[n.length-1]<i[l])&&(h&&(a.length&&s(a[a.length-1].value,"outOfRange"),h=0),s(i[l],"outOfRange"));var p=a.length;return{stops:a,outerColors:[p?a[0].color:"transparent",p?a[p-1].color:"transparent"]}},t.type="visualMap.continuous",t.defaultOption=Jc(Dw.defaultOption,{align:"auto",calculable:!1,hoverLink:!0,realtime:!0,handleIcon:"path://M-11.39,9.77h0a3.5,3.5,0,0,1-3.5,3.5h-22a3.5,3.5,0,0,1-3.5-3.5h0a3.5,3.5,0,0,1,3.5-3.5h22A3.5,3.5,0,0,1-11.39,9.77Z",handleSize:"120%",handleStyle:{borderColor:"#fff",borderWidth:1},indicatorIcon:"circle",indicatorSize:"50%",indicatorStyle:{borderColor:"#fff",borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0,0,0,0.2)"}}),t}(Dw);function oU(r,t,e){if(e[0]===e[1])return e.slice();for(var i=200,n=(e[1]-e[0])/i,a=e[0],s=[],o=0;o<=i&&a<e[1];o++)s.push(a),a+=n;return s.push(e[1]),s}const bNt=xNt;var wNt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e.autoPositionValues={left:1,right:1,top:1,bottom:1},e}return t.prototype.init=function(e,i){this.ecModel=e,this.api=i},t.prototype.render=function(e,i,n,a){if(this.visualMapModel=e,e.get("show")===!1){this.group.removeAll();return}this.doRender(e,i,n,a)},t.prototype.renderBackground=function(e){var i=this.visualMapModel,n=Ng(i.get("padding")||0),a=e.getBoundingRect();e.add(new Pr({z2:-1,silent:!0,shape:{x:a.x-n[3],y:a.y-n[0],width:a.width+n[3]+n[1],height:a.height+n[0]+n[2]},style:{fill:i.get("backgroundColor"),stroke:i.get("borderColor"),lineWidth:i.get("borderWidth")}}))},t.prototype.getControllerVisual=function(e,i,n){n=n||{};var a=n.forceState,s=this.visualMapModel,o={};if(i==="color"){var l=s.get("contentColor");o.color=l}function u(v){return o[v]}function c(v,y){o[v]=y}var h=s.controllerVisuals[a||s.getValueState(e)],p=ta.prepareVisualTypes(h);return J(p,function(v){var y=h[v];n.convertOpacityToAlpha&&v==="opacity"&&(v="colorAlpha",y=h.__alphaForOpacity),ta.dependsOn(v,i)&&y&&y.applyVisual(e,u,c)}),o[i]},t.prototype.positionGroup=function(e){var i=this.visualMapModel,n=this.api;FS(e,i.getBoxLayoutParams(),{width:n.getWidth(),height:n.getHeight()})},t.prototype.doRender=function(e,i,n,a){},t.type="visualMap",t}($i);const WZ=wNt;var lU=[["left","right","width"],["top","bottom","height"]];function HZ(r,t,e){var i=r.option,n=i.align;if(n!=null&&n!=="auto")return n;for(var a={width:t.getWidth(),height:t.getHeight()},s=i.orient==="horizontal"?1:0,o=lU[s],l=[0,null,10],u={},c=0;c<3;c++)u[lU[1-s][c]]=l[c],u[o[c]]=c===2?e[0]:i[o[c]];var h=[["x","width",3],["y","height",0]][s],p=bn(u,a,i.padding);return o[(p.margin[h[2]]||0)+p[h[0]]+p[h[1]]*.5<a[h[1]]*.5?0:1]}function sb(r,t){return J(r||[],function(e){e.dataIndex!=null&&(e.dataIndexInside=e.dataIndex,e.dataIndex=null),e.highlightKey="visualMap"+(t?t.componentIndex:"")}),r}var ul=Jr,SNt=J,uU=Math.min,mE=Math.max,TNt=12,ANt=6,CNt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e._shapes={},e._dataInterval=[],e._handleEnds=[],e._hoverLinkDataIndices=[],e}return t.prototype.init=function(e,i){r.prototype.init.call(this,e,i),this._hoverLinkFromSeriesMouseOver=we(this._hoverLinkFromSeriesMouseOver,this),this._hideIndicator=we(this._hideIndicator,this)},t.prototype.doRender=function(e,i,n,a){(!a||a.type!=="selectDataRange"||a.from!==this.uid)&&this._buildView()},t.prototype._buildView=function(){this.group.removeAll();var e=this.visualMapModel,i=this.group;this._orient=e.get("orient"),this._useHandle=e.get("calculable"),this._resetInterval(),this._renderBar(i);var n=e.get("text");this._renderEndsText(i,n,0),this._renderEndsText(i,n,1),this._updateView(!0),this.renderBackground(i),this._updateView(),this._enableHoverLinkToSeries(),this._enableHoverLinkFromSeries(),this.positionGroup(i)},t.prototype._renderEndsText=function(e,i,n){if(i){var a=i[1-n];a=a!=null?a+"":"";var s=this.visualMapModel,o=s.get("textGap"),l=s.itemSize,u=this._shapes.mainGroup,c=this._applyTransform([l[0]/2,n===0?-o:l[1]+o],u),h=this._applyTransform(n===0?"bottom":"top",u),p=this._orient,v=this.visualMapModel.textStyleModel;this.group.add(new Nr({style:hi(v,{x:c[0],y:c[1],verticalAlign:p==="horizontal"?"middle":h,align:p==="horizontal"?h:"center",text:a})}))}},t.prototype._renderBar=function(e){var i=this.visualMapModel,n=this._shapes,a=i.itemSize,s=this._orient,o=this._useHandle,l=HZ(i,this.api,a),u=n.mainGroup=this._createBarGroup(l),c=new Ke;u.add(c),c.add(n.outOfRange=cU()),c.add(n.inRange=cU(null,o?fU(this._orient):null,we(this._dragHandle,this,"all",!1),we(this._dragHandle,this,"all",!0))),c.setClipPath(new Pr({shape:{x:0,y:0,width:a[0],height:a[1],r:3}}));var h=i.textStyleModel.getTextRect(""),p=mE(h.width,h.height);o&&(n.handleThumbs=[],n.handleLabels=[],n.handleLabelPoints=[],this._createHandle(i,u,0,a,p,s),this._createHandle(i,u,1,a,p,s)),this._createIndicator(i,u,a,p,s),e.add(u)},t.prototype._createHandle=function(e,i,n,a,s,o){var l=we(this._dragHandle,this,n,!1),u=we(this._dragHandle,this,n,!0),c=zo(e.get("handleSize"),a[0]),h=mn(e.get("handleIcon"),-c/2,-c/2,c,c,null,!0),p=fU(this._orient);h.attr({cursor:p,draggable:!0,drift:l,ondragend:u,onmousemove:function(T){pu(T.event)}}),h.x=a[0]/2,h.useStyle(e.getModel("handleStyle").getItemStyle()),h.setStyle({strokeNoScale:!0,strokeFirst:!0}),h.style.lineWidth*=2,h.ensureState("emphasis").style=e.getModel(["emphasis","handleStyle"]).getItemStyle(),gf(h,!0),i.add(h);var v=this.visualMapModel.textStyleModel,y=new Nr({cursor:p,draggable:!0,drift:l,onmousemove:function(T){pu(T.event)},ondragend:u,style:hi(v,{x:0,y:0,text:""})});y.ensureState("blur").style={opacity:.1},y.stateTransition={duration:200},this.group.add(y);var x=[c,0],w=this._shapes;w.handleThumbs[n]=h,w.handleLabelPoints[n]=x,w.handleLabels[n]=y},t.prototype._createIndicator=function(e,i,n,a,s){var o=zo(e.get("indicatorSize"),n[0]),l=mn(e.get("indicatorIcon"),-o/2,-o/2,o,o,null,!0);l.attr({cursor:"move",invisible:!0,silent:!0,x:n[0]/2});var u=e.getModel("indicatorStyle").getItemStyle();if(l instanceof ia){var c=l.style;l.useStyle(Zt({image:c.image,x:c.x,y:c.y,width:c.width,height:c.height},u))}else l.useStyle(u);i.add(l);var h=this.visualMapModel.textStyleModel,p=new Nr({silent:!0,invisible:!0,style:hi(h,{x:0,y:0,text:""})});this.group.add(p);var v=[(s==="horizontal"?a/2:ANt)+n[0]/2,0],y=this._shapes;y.indicator=l,y.indicatorLabel=p,y.indicatorLabelPoint=v,this._firstShowIndicator=!0},t.prototype._dragHandle=function(e,i,n,a){if(this._useHandle){if(this._dragging=!i,!i){var s=this._applyTransform([n,a],this._shapes.mainGroup,!0);this._updateInterval(e,s[1]),this._hideIndicator(),this._updateView()}i===!this.visualMapModel.get("realtime")&&this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()}),i?!this._hovering&&this._clearHoverLinkToSeries():hU(this.visualMapModel)&&this._doHoverLinkToSeries(this._handleEnds[e],!1)}},t.prototype._resetInterval=function(){var e=this.visualMapModel,i=this._dataInterval=e.getSelected(),n=e.getExtent(),a=[0,e.itemSize[1]];this._handleEnds=[ul(i[0],n,a,!0),ul(i[1],n,a,!0)]},t.prototype._updateInterval=function(e,i){i=i||0;var n=this.visualMapModel,a=this._handleEnds,s=[0,n.itemSize[1]];od(i,a,s,e,0);var o=n.getExtent();this._dataInterval=[ul(a[0],s,o,!0),ul(a[1],s,o,!0)]},t.prototype._updateView=function(e){var i=this.visualMapModel,n=i.getExtent(),a=this._shapes,s=[0,i.itemSize[1]],o=e?s:this._handleEnds,l=this._createBarVisual(this._dataInterval,n,o,"inRange"),u=this._createBarVisual(n,n,s,"outOfRange");a.inRange.setStyle({fill:l.barColor}).setShape("points",l.barPoints),a.outOfRange.setStyle({fill:u.barColor}).setShape("points",u.barPoints),this._updateHandle(o,l)},t.prototype._createBarVisual=function(e,i,n,a){var s={forceState:a,convertOpacityToAlpha:!0},o=this._makeColorGradient(e,s),l=[this.getControllerVisual(e[0],"symbolSize",s),this.getControllerVisual(e[1],"symbolSize",s)],u=this._createBarPoints(n,l);return{barColor:new M_(0,0,0,1,o),barPoints:u,handlesColor:[o[0].color,o[o.length-1].color]}},t.prototype._makeColorGradient=function(e,i){var n=100,a=[],s=(e[1]-e[0])/n;a.push({color:this.getControllerVisual(e[0],"color",i),offset:0});for(var o=1;o<n;o++){var l=e[0]+s*o;if(l>e[1])break;a.push({color:this.getControllerVisual(l,"color",i),offset:o/n})}return a.push({color:this.getControllerVisual(e[1],"color",i),offset:1}),a},t.prototype._createBarPoints=function(e,i){var n=this.visualMapModel.itemSize;return[[n[0]-i[0],e[0]],[n[0],e[0]],[n[0],e[1]],[n[0]-i[1],e[1]]]},t.prototype._createBarGroup=function(e){var i=this._orient,n=this.visualMapModel.get("inverse");return new Ke(i==="horizontal"&&!n?{scaleX:e==="bottom"?1:-1,rotation:Math.PI/2}:i==="horizontal"&&n?{scaleX:e==="bottom"?-1:1,rotation:-Math.PI/2}:i==="vertical"&&!n?{scaleX:e==="left"?1:-1,scaleY:-1}:{scaleX:e==="left"?1:-1})},t.prototype._updateHandle=function(e,i){if(this._useHandle){var n=this._shapes,a=this.visualMapModel,s=n.handleThumbs,o=n.handleLabels,l=a.itemSize,u=a.getExtent();SNt([0,1],function(c){var h=s[c];h.setStyle("fill",i.handlesColor[c]),h.y=e[c];var p=ul(e[c],[0,l[1]],u,!0),v=this.getControllerVisual(p,"symbolSize");h.scaleX=h.scaleY=v/l[0],h.x=l[0]-v/2;var y=Fo(n.handleLabelPoints[c],Mf(h,this.group));o[c].setStyle({x:y[0],y:y[1],text:a.formatValueText(this._dataInterval[c]),verticalAlign:"middle",align:this._orient==="vertical"?this._applyTransform("left",n.mainGroup):"center"})},this)}},t.prototype._showIndicator=function(e,i,n,a){var s=this.visualMapModel,o=s.getExtent(),l=s.itemSize,u=[0,l[1]],c=this._shapes,h=c.indicator;if(h){h.attr("invisible",!1);var p={convertOpacityToAlpha:!0},v=this.getControllerVisual(e,"color",p),y=this.getControllerVisual(e,"symbolSize"),x=ul(e,o,u,!0),w=l[0]-y/2,T={x:h.x,y:h.y};h.y=x,h.x=w;var E=Fo(c.indicatorLabelPoint,Mf(h,this.group)),M=c.indicatorLabel;M.attr("invisible",!1);var L=this._applyTransform("left",c.mainGroup),F=this._orient,O=F==="horizontal";M.setStyle({text:(n||"")+s.formatValueText(i),verticalAlign:O?L:"middle",align:O?"center":L});var U={x:w,y:x,style:{fill:v}},W={style:{x:E[0],y:E[1]}};if(s.ecModel.isAnimationEnabled()&&!this._firstShowIndicator){var H={duration:100,easing:"cubicInOut",additive:!0};h.x=T.x,h.y=T.y,h.animateTo(U,H),M.animateTo(W,H)}else h.attr(U),M.attr(W);this._firstShowIndicator=!1;var j=this._shapes.handleLabels;if(j)for(var Y=0;Y<j.length;Y++)this.api.enterBlur(j[Y])}},t.prototype._enableHoverLinkToSeries=function(){var e=this;this._shapes.mainGroup.on("mousemove",function(i){if(e._hovering=!0,!e._dragging){var n=e.visualMapModel.itemSize,a=e._applyTransform([i.offsetX,i.offsetY],e._shapes.mainGroup,!0,!0);a[1]=uU(mE(0,a[1]),n[1]),e._doHoverLinkToSeries(a[1],0<=a[0]&&a[0]<=n[0])}}).on("mouseout",function(){e._hovering=!1,!e._dragging&&e._clearHoverLinkToSeries()})},t.prototype._enableHoverLinkFromSeries=function(){var e=this.api.getZr();this.visualMapModel.option.hoverLink?(e.on("mouseover",this._hoverLinkFromSeriesMouseOver,this),e.on("mouseout",this._hideIndicator,this)):this._clearHoverLinkFromSeries()},t.prototype._doHoverLinkToSeries=function(e,i){var n=this.visualMapModel,a=n.itemSize;if(n.option.hoverLink){var s=[0,a[1]],o=n.getExtent();e=uU(mE(s[0],e),s[1]);var l=ENt(n,o,s),u=[e-l,e+l],c=ul(e,s,o,!0),h=[ul(u[0],s,o,!0),ul(u[1],s,o,!0)];u[0]<s[0]&&(h[0]=-1/0),u[1]>s[1]&&(h[1]=1/0),i&&(h[0]===-1/0?this._showIndicator(c,h[1],"< ",l):h[1]===1/0?this._showIndicator(c,h[0],"> ",l):this._showIndicator(c,c," ",l));var p=this._hoverLinkDataIndices,v=[];(i||hU(n))&&(v=this._hoverLinkDataIndices=n.findTargetDataIndices(h));var y=pyt(p,v);this._dispatchHighDown("downplay",sb(y[0],n)),this._dispatchHighDown("highlight",sb(y[1],n))}},t.prototype._hoverLinkFromSeriesMouseOver=function(e){var i;if(mf(e.target,function(l){var u=Je(l);if(u.dataIndex!=null)return i=u,!0},!0),!!i){var n=this.ecModel.getSeriesByIndex(i.seriesIndex),a=this.visualMapModel;if(a.isTargetSeries(n)){var s=n.getData(i.dataType),o=s.getStore().get(a.getDataDimensionIndex(s),i.dataIndex);isNaN(o)||this._showIndicator(o,o)}}},t.prototype._hideIndicator=function(){var e=this._shapes;e.indicator&&e.indicator.attr("invisible",!0),e.indicatorLabel&&e.indicatorLabel.attr("invisible",!0);var i=this._shapes.handleLabels;if(i)for(var n=0;n<i.length;n++)this.api.leaveBlur(i[n])},t.prototype._clearHoverLinkToSeries=function(){this._hideIndicator();var e=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",sb(e,this.visualMapModel)),e.length=0},t.prototype._clearHoverLinkFromSeries=function(){this._hideIndicator();var e=this.api.getZr();e.off("mouseover",this._hoverLinkFromSeriesMouseOver),e.off("mouseout",this._hideIndicator)},t.prototype._applyTransform=function(e,i,n,a){var s=Mf(i,a?null:this.group);return Kt(e)?Fo(e,s,n):PS(e,s,n)},t.prototype._dispatchHighDown=function(e,i){i&&i.length&&this.api.dispatchAction({type:e,batch:i})},t.prototype.dispose=function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},t.type="visualMap.continuous",t}(WZ);function cU(r,t,e,i){return new ds({shape:{points:r},draggable:!!e,cursor:t,drift:e,onmousemove:function(n){pu(n.event)},ondragend:i})}function ENt(r,t,e){var i=TNt/2,n=r.get("hoverLinkDataSize");return n&&(i=ul(n,t,e,!0)/2),i}function hU(r){var t=r.get("hoverLinkOnHandle");return!!(t??r.get("realtime"))}function fU(r){return r==="vertical"?"ns-resize":"ew-resize"}const INt=CNt;var MNt={type:"selectDataRange",event:"dataRangeSelected",update:"update"},PNt=function(r,t){t.eachComponent({mainType:"visualMap",query:r},function(e){e.setSelected(r.selected)})},RNt=[{createOnAllSeries:!0,reset:function(r,t){var e=[];return t.eachComponent("visualMap",function(i){var n=r.pipelineContext;!i.isTargetSeries(r)||n&&n.large||e.push(A3t(i.stateList,i.targetVisuals,we(i.getValueState,i),i.getDataDimensionIndex(r.getData())))}),e}},{createOnAllSeries:!0,reset:function(r,t){var e=r.getData(),i=[];t.eachComponent("visualMap",function(n){if(n.isTargetSeries(r)){var a=n.getVisualMeta(we(DNt,null,r,n))||{stops:[],outerColors:[]},s=n.getDataDimensionIndex(e);s>=0&&(a.dimension=s,i.push(a))}}),r.getData().setVisual("visualMeta",i)}}];function DNt(r,t,e,i){for(var n=t.targetVisuals[i],a=ta.prepareVisualTypes(n),s={color:L_(r.getData(),"color")},o=0,l=a.length;o<l;o++){var u=a[o],c=n[u==="opacity"?"__alphaForOpacity":u];c&&c.applyVisual(e,h,p)}return s.color;function h(v){return s[v]}function p(v,y){s[v]=y}}var dU=J;function LNt(r){var t=r&&r.visualMap;Kt(t)||(t=t?[t]:[]),dU(t,function(e){if(e){yp(e,"splitList")&&!yp(e,"pieces")&&(e.pieces=e.splitList,delete e.splitList);var i=e.pieces;i&&Kt(i)&&dU(i,function(n){je(n)&&(yp(n,"start")&&!yp(n,"min")&&(n.min=n.start),yp(n,"end")&&!yp(n,"max")&&(n.max=n.end))})}})}function yp(r,t){return r&&r.hasOwnProperty&&r.hasOwnProperty(t)}var pU=!1;function GZ(r){pU||(pU=!0,r.registerSubTypeDefaulter("visualMap",function(t){return!t.categories&&(!(t.pieces?t.pieces.length>0:t.splitNumber>0)||t.calculable)?"continuous":"piecewise"}),r.registerAction(MNt,PNt),J(RNt,function(t){r.registerVisual(r.PRIORITY.VISUAL.COMPONENT,t)}),r.registerPreprocessor(LNt))}function jZ(r){r.registerComponentModel(bNt),r.registerComponentView(INt),GZ(r)}var kNt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e._pieceList=[],e}return t.prototype.optionUpdated=function(e,i){r.prototype.optionUpdated.apply(this,arguments),this.resetExtent();var n=this._mode=this._determineMode();this._pieceList=[],ONt[this._mode].call(this,this._pieceList),this._resetSelected(e,i);var a=this.option.categories;this.resetVisual(function(s,o){n==="categories"?(s.mappingMethod="category",s.categories=Ze(a)):(s.dataExtent=this.getExtent(),s.mappingMethod="piecewise",s.pieceList=te(this._pieceList,function(l){return l=Ze(l),o!=="inRange"&&(l.visual=null),l}))})},t.prototype.completeVisualOption=function(){var e=this.option,i={},n=ta.listVisualTypes(),a=this.isCategory();J(e.pieces,function(o){J(n,function(l){o.hasOwnProperty(l)&&(i[l]=1)})}),J(i,function(o,l){var u=!1;J(this.stateList,function(c){u=u||s(e,c,l)||s(e.target,c,l)},this),!u&&J(this.stateList,function(c){(e[c]||(e[c]={}))[l]=$Z.get(l,c==="inRange"?"active":"inactive",a)})},this);function s(o,l,u){return o&&o[l]&&o[l].hasOwnProperty(u)}r.prototype.completeVisualOption.apply(this,arguments)},t.prototype._resetSelected=function(e,i){var n=this.option,a=this._pieceList,s=(i?n:e).selected||{};if(n.selected=s,J(a,function(l,u){var c=this.getSelectedMapKey(l);s.hasOwnProperty(c)||(s[c]=!0)},this),n.selectedMode==="single"){var o=!1;J(a,function(l,u){var c=this.getSelectedMapKey(l);s[c]&&(o?s[c]=!1:o=!0)},this)}},t.prototype.getItemSymbol=function(){return this.get("itemSymbol")},t.prototype.getSelectedMapKey=function(e){return this._mode==="categories"?e.value+"":e.index+""},t.prototype.getPieceList=function(){return this._pieceList},t.prototype._determineMode=function(){var e=this.option;return e.pieces&&e.pieces.length>0?"pieces":this.option.categories?"categories":"splitNumber"},t.prototype.setSelected=function(e){this.option.selected=Ze(e)},t.prototype.getValueState=function(e){var i=ta.findPieceIndex(e,this._pieceList);return i!=null&&this.option.selected[this.getSelectedMapKey(this._pieceList[i])]?"inRange":"outOfRange"},t.prototype.findTargetDataIndices=function(e){var i=[],n=this._pieceList;return this.eachTargetSeries(function(a){var s=[],o=a.getData();o.each(this.getDataDimensionIndex(o),function(l,u){var c=ta.findPieceIndex(l,n);c===e&&s.push(u)},this),i.push({seriesId:a.id,dataIndex:s})},this),i},t.prototype.getRepresentValue=function(e){var i;if(this.isCategory())i=e.value;else if(e.value!=null)i=e.value;else{var n=e.interval||[];i=n[0]===-1/0&&n[1]===1/0?0:(n[0]+n[1])/2}return i},t.prototype.getVisualMeta=function(e){if(this.isCategory())return;var i=[],n=["",""],a=this;function s(c,h){var p=a.getRepresentValue({interval:c});h||(h=a.getValueState(p));var v=e(p,h);c[0]===-1/0?n[0]=v:c[1]===1/0?n[1]=v:i.push({value:c[0],color:v},{value:c[1],color:v})}var o=this._pieceList.slice();if(!o.length)o.push({interval:[-1/0,1/0]});else{var l=o[0].interval[0];l!==-1/0&&o.unshift({interval:[-1/0,l]}),l=o[o.length-1].interval[1],l!==1/0&&o.push({interval:[l,1/0]})}var u=-1/0;return J(o,function(c){var h=c.interval;h&&(h[0]>u&&s([u,h[0]],"outOfRange"),s(h.slice()),u=h[1])},this),{stops:i,outerColors:n}},t.type="visualMap.piecewise",t.defaultOption=Jc(Dw.defaultOption,{selected:null,minOpen:!1,maxOpen:!1,align:"auto",itemWidth:20,itemHeight:14,itemSymbol:"roundRect",pieces:null,categories:null,splitNumber:5,selectedMode:"multiple",itemGap:10,hoverLink:!0}),t}(Dw),ONt={splitNumber:function(r){var t=this.option,e=Math.min(t.precision,20),i=this.getExtent(),n=t.splitNumber;n=Math.max(parseInt(n,10),1),t.splitNumber=n;for(var a=(i[1]-i[0])/n;+a.toFixed(e)!==a&&e<5;)e++;t.precision=e,a=+a.toFixed(e),t.minOpen&&r.push({interval:[-1/0,i[0]],close:[0,0]});for(var s=0,o=i[0];s<n;o+=a,s++){var l=s===n-1?i[1]:o+a;r.push({interval:[o,l],close:[1,1]})}t.maxOpen&&r.push({interval:[i[1],1/0],close:[0,0]}),oB(r),J(r,function(u,c){u.index=c,u.text=this.formatValueText(u.interval)},this)},categories:function(r){var t=this.option;J(t.categories,function(e){r.push({text:this.formatValueText(e,!0),value:e})},this),gU(t,r)},pieces:function(r){var t=this.option;J(t.pieces,function(e,i){je(e)||(e={value:e});var n={text:"",index:i};if(e.label!=null&&(n.text=e.label),e.hasOwnProperty("value")){var a=n.value=e.value;n.interval=[a,a],n.close=[1,1]}else{for(var s=n.interval=[],o=n.close=[0,0],l=[1,0,1],u=[-1/0,1/0],c=[],h=0;h<2;h++){for(var p=[["gte","gt","min"],["lte","lt","max"]][h],v=0;v<3&&s[h]==null;v++)s[h]=e[p[v]],o[h]=l[v],c[h]=v===2;s[h]==null&&(s[h]=u[h])}c[0]&&s[1]===1/0&&(o[0]=0),c[1]&&s[0]===-1/0&&(o[1]=0),s[0]===s[1]&&o[0]&&o[1]&&(n.value=s[0])}n.visual=ta.retrieveVisuals(e),r.push(n)},this),gU(t,r),oB(r),J(r,function(e){var i=e.close,n=[["<",""][i[1]],[">",""][i[0]]];e.text=e.text||this.formatValueText(e.value!=null?e.value:e.interval,!1,n)},this)}};function gU(r,t){var e=r.inverse;(r.orient==="vertical"?!e:e)&&t.reverse()}const NNt=kNt;var FNt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.doRender=function(){var e=this.group;e.removeAll();var i=this.visualMapModel,n=i.get("textGap"),a=i.textStyleModel,s=a.getFont(),o=a.getTextColor(),l=this._getItemAlign(),u=i.itemSize,c=this._getViewData(),h=c.endsText,p=Un(i.get("showLabel",!0),!h);h&&this._renderEndsText(e,h[0],u,p,l),J(c.viewPieceList,function(v){var y=v.piece,x=new Ke;x.onclick=we(this._onItemClick,this,y),this._enableHoverLink(x,v.indexInModelPieceList);var w=i.getRepresentValue(y);if(this._createItemSymbol(x,w,[0,0,u[0],u[1]]),p){var T=this.visualMapModel.getValueState(w);x.add(new Nr({style:{x:l==="right"?-n:u[0]+n,y:u[1]/2,text:y.text,verticalAlign:"middle",align:l,font:s,fill:o,opacity:T==="outOfRange"?.5:1}}))}e.add(x)},this),h&&this._renderEndsText(e,h[1],u,p,l),Pf(i.get("orient"),e,i.get("itemGap")),this.renderBackground(e),this.positionGroup(e)},t.prototype._enableHoverLink=function(e,i){var n=this;e.on("mouseover",function(){return a("highlight")}).on("mouseout",function(){return a("downplay")});var a=function(s){var o=n.visualMapModel;o.option.hoverLink&&n.api.dispatchAction({type:s,batch:sb(o.findTargetDataIndices(i),o)})}},t.prototype._getItemAlign=function(){var e=this.visualMapModel,i=e.option;if(i.orient==="vertical")return HZ(e,this.api,e.itemSize);var n=i.align;return(!n||n==="auto")&&(n="left"),n},t.prototype._renderEndsText=function(e,i,n,a,s){if(i){var o=new Ke,l=this.visualMapModel.textStyleModel;o.add(new Nr({style:hi(l,{x:a?s==="right"?n[0]:0:n[0]/2,y:n[1]/2,verticalAlign:"middle",align:a?s:"center",text:i})})),e.add(o)}},t.prototype._getViewData=function(){var e=this.visualMapModel,i=te(e.getPieceList(),function(o,l){return{piece:o,indexInModelPieceList:l}}),n=e.get("text"),a=e.get("orient"),s=e.get("inverse");return(a==="horizontal"?s:!s)?i.reverse():n&&(n=n.slice().reverse()),{viewPieceList:i,endsText:n}},t.prototype._createItemSymbol=function(e,i,n){e.add(mn(this.getControllerVisual(i,"symbol"),n[0],n[1],n[2],n[3],this.getControllerVisual(i,"color")))},t.prototype._onItemClick=function(e){var i=this.visualMapModel,n=i.option,a=n.selectedMode;if(a){var s=Ze(n.selected),o=i.getSelectedMapKey(e);a==="single"||a===!0?(s[o]=!0,J(s,function(l,u){s[u]=u===o})):s[o]=!s[o],this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:s})}},t.type="visualMap.piecewise",t}(WZ);const BNt=FNt;function XZ(r){r.registerComponentModel(NNt),r.registerComponentView(BNt),GZ(r)}function zNt(r){gr(jZ),gr(XZ)}var VNt={label:{enabled:!0},decal:{show:!1}},vU=Ir(),UNt={};function $Nt(r,t){var e=r.getModel("aria");if(!e.get("enabled"))return;var i=Ze(VNt);cr(i.label,r.getLocaleModel().get("aria"),!1),cr(e.option,i,!1),n(),a();function n(){var u=e.getModel("decal"),c=u.get("show");if(c){var h=Re();r.eachSeries(function(p){if(!p.isColorBySeries()){var v=h.get(p.type);v||(v={},h.set(p.type,v)),vU(p).scope=v}}),r.eachRawSeries(function(p){if(r.isSeriesFiltered(p))return;if(Ve(p.enableAriaDecal)){p.enableAriaDecal();return}var v=p.getData();if(p.isColorBySeries()){var E=pM(p.ecModel,p.name,UNt,r.getSeriesCount()),M=v.getVisual("decal");v.setVisual("decal",L(M,E))}else{var y=p.getRawData(),x={},w=vU(p).scope;v.each(function(F){var O=v.getRawIndex(F);x[O]=F});var T=y.count();y.each(function(F){var O=x[F],U=y.getName(F)||F+"",W=pM(p.ecModel,U,w,T),H=v.getItemVisual(O,"decal");v.setItemVisual(O,"decal",L(H,W))})}function L(F,O){var U=F?Zt(Zt({},O),F):O;return U.dirty=!0,U}})}}function a(){var u=t.getZr().dom;if(u){var c=r.getLocaleModel().get("aria"),h=e.getModel("label");if(h.option=We(h.option,c),!!h.get("enabled")){if(h.get("description")){u.setAttribute("aria-label",h.get("description"));return}var p=r.getSeriesCount(),v=h.get(["data","maxCount"])||10,y=h.get(["series","maxCount"])||10,x=Math.min(p,y),w;if(!(p<1)){var T=o();if(T){var E=h.get(["general","withTitle"]);w=s(E,{title:T})}else w=h.get(["general","withoutTitle"]);var M=[],L=p>1?h.get(["series","multiple","prefix"]):h.get(["series","single","prefix"]);w+=s(L,{seriesCount:p}),r.eachSeries(function(W,H){if(H<x){var j=void 0,Y=W.get("name"),tt=Y?"withName":"withoutName";j=p>1?h.get(["series","multiple",tt]):h.get(["series","single",tt]),j=s(j,{seriesId:W.seriesIndex,seriesName:W.get("name"),seriesType:l(W.subType)});var it=W.getData();if(it.count()>v){var lt=h.get(["data","partialData"]);j+=s(lt,{displayCnt:v})}else j+=h.get(["data","allData"]);for(var ht=h.get(["data","separator","middle"]),Tt=h.get(["data","separator","end"]),Ot=[],Rt=0;Rt<it.count();Rt++)if(Rt<v){var Ut=it.getName(Rt),Jt=it.getValues(Rt),ne=h.get(["data",Ut?"withName":"withoutName"]);Ot.push(s(ne,{name:Ut,value:Jt.join(ht)}))}j+=Ot.join(ht)+Tt,M.push(j)}});var F=h.getModel(["series","multiple","separator"]),O=F.get("middle"),U=F.get("end");w+=M.join(O)+U,u.setAttribute("aria-label",w)}}}}function s(u,c){if(!ve(u))return u;var h=u;return J(c,function(p,v){h=h.replace(new RegExp("\\{\\s*"+v+"\\s*\\}","g"),p)}),h}function o(){var u=r.get("title");return u&&u.length&&(u=u[0]),u&&u.text}function l(u){var c=r.getLocaleModel().get(["series","typeNames"]);return c[u]||c.chart}}function WNt(r){if(!(!r||!r.aria)){var t=r.aria;t.show!=null&&(t.enabled=t.show),t.label=t.label||{},J(["description","general","series","data"],function(e){t[e]!=null&&(t.label[e]=t[e])})}}function HNt(r){r.registerPreprocessor(WNt),r.registerVisual(r.PRIORITY.VISUAL.ARIA,$Nt)}var mU={value:"eq","<":"lt","<=":"lte",">":"gt",">=":"gte","=":"eq","!=":"ne","<>":"ne"},GNt=function(){function r(t){var e=this._condVal=ve(t)?new RegExp(t):Svt(t)?t:null;if(e==null){var i="";jr(i)}}return r.prototype.evaluate=function(t){var e=typeof t;return ve(e)?this._condVal.test(t):Fr(e)?this._condVal.test(t+""):!1},r}(),jNt=function(){function r(){}return r.prototype.evaluate=function(){return this.value},r}(),XNt=function(){function r(){}return r.prototype.evaluate=function(){for(var t=this.children,e=0;e<t.length;e++)if(!t[e].evaluate())return!1;return!0},r}(),ZNt=function(){function r(){}return r.prototype.evaluate=function(){for(var t=this.children,e=0;e<t.length;e++)if(t[e].evaluate())return!0;return!1},r}(),qNt=function(){function r(){}return r.prototype.evaluate=function(){return!this.child.evaluate()},r}(),YNt=function(){function r(){}return r.prototype.evaluate=function(){for(var t=!!this.valueParser,e=this.getValue,i=e(this.valueGetterParam),n=t?this.valueParser(i):null,a=0;a<this.subCondList.length;a++)if(!this.subCondList[a].evaluate(t?n:i))return!1;return!0},r}();function kL(r,t){if(r===!0||r===!1){var e=new jNt;return e.value=r,e}var i="";return ZZ(r)||jr(i),r.and?yU("and",r,t):r.or?yU("or",r,t):r.not?KNt(r,t):JNt(r,t)}function yU(r,t,e){var i=t[r],n="";Kt(i)||jr(n),i.length||jr(n);var a=r==="and"?new XNt:new ZNt;return a.children=te(i,function(s){return kL(s,e)}),a.children.length||jr(n),a}function KNt(r,t){var e=r.not,i="";ZZ(e)||jr(i);var n=new qNt;return n.child=kL(e,t),n.child||jr(i),n}function JNt(r,t){for(var e="",i=t.prepareGetValue(r),n=[],a=br(r),s=r.parser,o=s?x9(s):null,l=0;l<a.length;l++){var u=a[l];if(!(u==="parser"||t.valueGetterAttrMap.get(u))){var c=Ae(mU,u)?mU[u]:u,h=r[u],p=o?o(h):h,v=Pxt(c,p)||c==="reg"&&new GNt(p);v||jr(e),n.push(v)}}n.length||jr(e);var y=new YNt;return y.valueGetterParam=i,y.valueParser=o,y.getValue=t.getValue,y.subCondList=n,y}function ZZ(r){return je(r)&&!Sa(r)}var QNt=function(){function r(t,e){this._cond=kL(t,e)}return r.prototype.evaluate=function(){return this._cond.evaluate()},r}();function tFt(r,t){return new QNt(r,t)}var eFt={type:"echarts:filter",transform:function(r){for(var t=r.upstream,e,i=tFt(r.config,{valueGetterAttrMap:Re({dimension:!0}),prepareGetValue:function(o){var l="",u=o.dimension;Ae(o,"dimension")||jr(l);var c=t.getDimensionInfo(u);return c||jr(l),{dimIdx:c.index}},getValue:function(o){return t.retrieveValueFromItem(e,o.dimIdx)}}),n=[],a=0,s=t.count();a<s;a++)e=t.getRawDataItem(a),i.evaluate()&&n.push(e);return{data:n}}},rFt={type:"echarts:sort",transform:function(r){var t=r.upstream,e=r.config,i="",n=ri(e);n.length||jr(i);var a=[];J(n,function(c){var h=c.dimension,p=c.order,v=c.parser,y=c.incomparable;if(h==null&&jr(i),p!=="asc"&&p!=="desc"&&jr(i),y&&y!=="min"&&y!=="max"){var x="";jr(x)}if(p!=="asc"&&p!=="desc"){var w="";jr(w)}var T=t.getDimensionInfo(h);T||jr(i);var E=v?x9(v):null;v&&!E&&jr(i),a.push({dimIdx:T.index,parser:E,comparator:new w9(p,y)})});var s=t.sourceFormat;s!==Ta&&s!==lo&&jr(i);for(var o=[],l=0,u=t.count();l<u;l++)o.push(t.getRawDataItem(l));return o.sort(function(c,h){for(var p=0;p<a.length;p++){var v=a[p],y=t.retrieveValueFromItem(c,v.dimIdx),x=t.retrieveValueFromItem(h,v.dimIdx);v.parser&&(y=v.parser(y),x=v.parser(x));var w=v.comparator.evaluate(y,x);if(w!==0)return w}return 0}),{data:o}}};function iFt(r){r.registerTransform(eFt),r.registerTransform(rFt)}var nFt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="dataset",e}return t.prototype.init=function(e,i,n){r.prototype.init.call(this,e,i,n),this._sourceManager=new C9(this),_z(this)},t.prototype.mergeOption=function(e,i){r.prototype.mergeOption.call(this,e,i),_z(this)},t.prototype.optionUpdated=function(){this._sourceManager.dirty()},t.prototype.getSourceManager=function(){return this._sourceManager},t.type="dataset",t.defaultOption={seriesLayoutBy:xl},t}(kr),aFt=function(r){Vt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="dataset",e}return t.type="dataset",t}($i);function sFt(r){r.registerComponentModel(nFt),r.registerComponentView(aFt)}var sl=Al.CMD;function $p(r,t){return Math.abs(r-t)<1e-5}function dP(r){var t=r.data,e=r.len(),i=[],n,a=0,s=0,o=0,l=0;function u(it,lt){n&&n.length>2&&i.push(n),n=[it,lt]}function c(it,lt,ht,Tt){$p(it,ht)&&$p(lt,Tt)||n.push(it,lt,ht,Tt,ht,Tt)}function h(it,lt,ht,Tt,Ot,Rt){var Ut=Math.abs(lt-it),Jt=Math.tan(Ut/4)*4/3,ne=lt<it?-1:1,se=Math.cos(it),ce=Math.sin(it),ye=Math.cos(lt),Qe=Math.sin(lt),sr=se*Ot+ht,ke=ce*Rt+Tt,Ce=ye*Ot+ht,Ee=Qe*Rt+Tt,Ie=Ot*Jt*ne,Se=Rt*Jt*ne;n.push(sr-Ie*ce,ke+Se*se,Ce+Ie*Qe,Ee-Se*ye,Ce,Ee)}for(var p,v,y,x,w=0;w<e;){var T=t[w++],E=w===1;switch(E&&(a=t[w],s=t[w+1],o=a,l=s,(T===sl.L||T===sl.C||T===sl.Q)&&(n=[o,l])),T){case sl.M:a=o=t[w++],s=l=t[w++],u(o,l);break;case sl.L:p=t[w++],v=t[w++],c(a,s,p,v),a=p,s=v;break;case sl.C:n.push(t[w++],t[w++],t[w++],t[w++],a=t[w++],s=t[w++]);break;case sl.Q:p=t[w++],v=t[w++],y=t[w++],x=t[w++],n.push(a+2/3*(p-a),s+2/3*(v-s),y+2/3*(p-y),x+2/3*(v-x),y,x),a=y,s=x;break;case sl.A:var M=t[w++],L=t[w++],F=t[w++],O=t[w++],U=t[w++],W=t[w++]+U;w+=1;var H=!t[w++];p=Math.cos(U)*F+M,v=Math.sin(U)*O+L,E?(o=p,l=v,u(o,l)):c(a,s,p,v),a=Math.cos(W)*F+M,s=Math.sin(W)*O+L;for(var j=(H?-1:1)*Math.PI/2,Y=U;H?Y>W:Y<W;Y+=j){var tt=H?Math.max(Y+j,W):Math.min(Y+j,W);h(Y,tt,M,L,F,O)}break;case sl.R:o=a=t[w++],l=s=t[w++],p=o+t[w++],v=l+t[w++],u(p,l),c(p,l,p,v),c(p,v,o,v),c(o,v,o,l),c(o,l,p,l);break;case sl.Z:n&&c(a,s,o,l),a=o,s=l;break}}return n&&n.length>2&&i.push(n),i}function pP(r,t,e,i,n,a,s,o,l,u){if($p(r,e)&&$p(t,i)&&$p(n,s)&&$p(a,o)){l.push(s,o);return}var c=2/u,h=c*c,p=s-r,v=o-t,y=Math.sqrt(p*p+v*v);p/=y,v/=y;var x=e-r,w=i-t,T=n-s,E=a-o,M=x*x+w*w,L=T*T+E*E;if(M<h&&L<h){l.push(s,o);return}var F=p*x+v*w,O=-p*T-v*E,U=M-F*F,W=L-O*O;if(U<h&&F>=0&&W<h&&O>=0){l.push(s,o);return}var H=[],j=[];Uc(r,e,n,s,.5,H),Uc(t,i,a,o,.5,j),pP(H[0],j[0],H[1],j[1],H[2],j[2],H[3],j[3],l,u),pP(H[4],j[4],H[5],j[5],H[6],j[6],H[7],j[7],l,u)}function oFt(r,t){var e=dP(r),i=[];t=t||1;for(var n=0;n<e.length;n++){var a=e[n],s=[],o=a[0],l=a[1];s.push(o,l);for(var u=2;u<a.length;){var c=a[u++],h=a[u++],p=a[u++],v=a[u++],y=a[u++],x=a[u++];pP(o,l,c,h,p,v,y,x,s,t),o=y,l=x}i.push(s)}return i}function qZ(r,t,e){var i=r[t],n=r[1-t],a=Math.abs(i/n),s=Math.ceil(Math.sqrt(a*e)),o=Math.floor(e/s);o===0&&(o=1,s=e);for(var l=[],u=0;u<s;u++)l.push(o);var c=s*o,h=e-c;if(h>0)for(var u=0;u<h;u++)l[u%s]+=1;return l}function _U(r,t,e){for(var i=r.r0,n=r.r,a=r.startAngle,s=r.endAngle,o=Math.abs(s-a),l=o*n,u=n-i,c=l>Math.abs(u),h=qZ([l,u],c?0:1,t),p=(c?o:u)/h.length,v=0;v<h.length;v++)for(var y=(c?u:o)/h[v],x=0;x<h[v];x++){var w={};c?(w.startAngle=a+p*v,w.endAngle=a+p*(v+1),w.r0=i+y*x,w.r=i+y*(x+1)):(w.startAngle=a+y*x,w.endAngle=a+y*(x+1),w.r0=i+p*v,w.r=i+p*(v+1)),w.clockwise=r.clockwise,w.cx=r.cx,w.cy=r.cy,e.push(w)}}function lFt(r,t,e){for(var i=r.width,n=r.height,a=i>n,s=qZ([i,n],a?0:1,t),o=a?"width":"height",l=a?"height":"width",u=a?"x":"y",c=a?"y":"x",h=r[o]/s.length,p=0;p<s.length;p++)for(var v=r[l]/s[p],y=0;y<s[p];y++){var x={};x[u]=p*h,x[c]=y*v,x[o]=h,x[l]=v,x.x+=r.x,x.y+=r.y,e.push(x)}}function xU(r,t,e,i){return r*i-e*t}function uFt(r,t,e,i,n,a,s,o){var l=e-r,u=i-t,c=s-n,h=o-a,p=xU(c,h,l,u);if(Math.abs(p)<1e-6)return null;var v=r-n,y=t-a,x=xU(v,y,c,h)/p;return x<0||x>1?null:new lr(x*l+r,x*u+t)}function cFt(r,t,e){var i=new lr;lr.sub(i,e,t),i.normalize();var n=new lr;lr.sub(n,r,t);var a=n.dot(i);return a}function _p(r,t){var e=r[r.length-1];e&&e[0]===t[0]&&e[1]===t[1]||r.push(t)}function hFt(r,t,e){for(var i=r.length,n=[],a=0;a<i;a++){var s=r[a],o=r[(a+1)%i],l=uFt(s[0],s[1],o[0],o[1],t.x,t.y,e.x,e.y);l&&n.push({projPt:cFt(l,t,e),pt:l,idx:a})}if(n.length<2)return[{points:r},{points:r}];n.sort(function(w,T){return w.projPt-T.projPt});var u=n[0],c=n[n.length-1];if(c.idx<u.idx){var h=u;u=c,c=h}for(var p=[u.pt.x,u.pt.y],v=[c.pt.x,c.pt.y],y=[p],x=[v],a=u.idx+1;a<=c.idx;a++)_p(y,r[a].slice());_p(y,v),_p(y,p);for(var a=c.idx+1;a<=u.idx+i;a++)_p(x,r[a%i].slice());return _p(x,p),_p(x,v),[{points:y},{points:x}]}function bU(r){var t=r.points,e=[],i=[];TS(t,e,i);var n=new hr(e[0],e[1],i[0]-e[0],i[1]-e[1]),a=n.width,s=n.height,o=n.x,l=n.y,u=new lr,c=new lr;return a>s?(u.x=c.x=o+a/2,u.y=l,c.y=l+s):(u.y=c.y=l+s/2,u.x=o,c.x=o+a),hFt(t,u,c)}function Lw(r,t,e,i){if(e===1)i.push(t);else{var n=Math.floor(e/2),a=r(t);Lw(r,a[0],n,i),Lw(r,a[1],e-n,i)}return i}function fFt(r,t){for(var e=[],i=0;i<t;i++)e.push(YR(r));return e}function dFt(r,t){t.setStyle(r.style),t.z=r.z,t.z2=r.z2,t.zlevel=r.zlevel}function pFt(r){for(var t=[],e=0;e<r.length;)t.push([r[e++],r[e++]]);return t}function gFt(r,t){var e=[],i=r.shape,n;switch(r.type){case"rect":lFt(i,t,e),n=Pr;break;case"sector":_U(i,t,e),n=fs;break;case"circle":_U({r0:0,r:i.r,startAngle:0,endAngle:Math.PI*2,cx:i.cx,cy:i.cy},t,e),n=fs;break;default:var a=r.getComputedTransform(),s=a?Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1],a[2]*a[2]+a[3]*a[3])):1,o=te(oFt(r.getUpdatedPathProxy(),s),function(T){return pFt(T)}),l=o.length;if(l===0)Lw(bU,{points:o[0]},t,e);else if(l===t)for(var u=0;u<l;u++)e.push({points:o[u]});else{var c=0,h=te(o,function(T){var E=[],M=[];TS(T,E,M);var L=(M[1]-E[1])*(M[0]-E[0]);return c+=L,{poly:T,area:L}});h.sort(function(T,E){return E.area-T.area});for(var p=t,u=0;u<l;u++){var v=h[u];if(p<=0)break;var y=u===l-1?p:Math.ceil(v.area/c*t);y<0||(Lw(bU,{points:v.poly},y,e),p-=y)}}n=ds;break}if(!n)return fFt(r,t);for(var x=[],u=0;u<e.length;u++){var w=new n;w.setShape(e[u]),dFt(r,w),x.push(w)}return x}function vFt(r,t){var e=r.length,i=t.length;if(e===i)return[r,t];for(var n=[],a=[],s=e<i?r:t,o=Math.min(e,i),l=Math.abs(i-e)/6,u=(o-2)/6,c=Math.ceil(l/u)+1,h=[s[0],s[1]],p=l,v=2;v<o;){var y=s[v-2],x=s[v-1],w=s[v++],T=s[v++],E=s[v++],M=s[v++],L=s[v++],F=s[v++];if(p<=0){h.push(w,T,E,M,L,F);continue}for(var O=Math.min(p,c-1)+1,U=1;U<=O;U++){var W=U/O;Uc(y,w,E,L,W,n),Uc(x,T,M,F,W,a),y=n[3],x=a[3],h.push(n[1],a[1],n[2],a[2],y,x),w=n[5],T=a[5],E=n[6],M=a[6]}p-=O-1}return s===r?[h,t]:[r,h]}function wU(r,t){for(var e=r.length,i=r[e-2],n=r[e-1],a=[],s=0;s<t.length;)a[s++]=i,a[s++]=n;return a}function mFt(r,t){for(var e,i,n,a=[],s=[],o=0;o<Math.max(r.length,t.length);o++){var l=r[o],u=t[o],c=void 0,h=void 0;l?u?(e=vFt(l,u),c=e[0],h=e[1],i=c,n=h):(h=wU(n||l,l),c=l):(c=wU(i||u,u),h=u),a.push(c),s.push(h)}return[a,s]}function SU(r){for(var t=0,e=0,i=0,n=r.length,a=0,s=n-2;a<n;s=a,a+=2){var o=r[s],l=r[s+1],u=r[a],c=r[a+1],h=o*c-u*l;t+=h,e+=(o+u)*h,i+=(l+c)*h}return t===0?[r[0]||0,r[1]||0]:[e/t/3,i/t/3,t]}function yFt(r,t,e,i){for(var n=(r.length-2)/6,a=1/0,s=0,o=r.length,l=o-2,u=0;u<n;u++){for(var c=u*6,h=0,p=0;p<o;p+=2){var v=p===0?c:(c+p-2)%l+2,y=r[v]-e[0],x=r[v+1]-e[1],w=t[p]-i[0],T=t[p+1]-i[1],E=w-y,M=T-x;h+=E*E+M*M}h<a&&(a=h,s=u)}return s}function _Ft(r){for(var t=[],e=r.length,i=0;i<e;i+=2)t[i]=r[e-i-2],t[i+1]=r[e-i-1];return t}function xFt(r,t,e,i){for(var n=[],a,s=0;s<r.length;s++){var o=r[s],l=t[s],u=SU(o),c=SU(l);a==null&&(a=u[2]<0!=c[2]<0);var h=[],p=[],v=0,y=1/0,x=[],w=o.length;a&&(o=_Ft(o));for(var T=yFt(o,l,u,c)*6,E=w-2,M=0;M<E;M+=2){var L=(T+M)%E+2;h[M+2]=o[L]-u[0],h[M+3]=o[L+1]-u[1]}if(h[0]=o[T]-u[0],h[1]=o[T+1]-u[1],e>0)for(var F=i/e,O=-i/2;O<=i/2;O+=F){for(var U=Math.sin(O),W=Math.cos(O),H=0,M=0;M<o.length;M+=2){var j=h[M],Y=h[M+1],tt=l[M]-c[0],it=l[M+1]-c[1],lt=tt*W-it*U,ht=tt*U+it*W;x[M]=lt,x[M+1]=ht;var Tt=lt-j,Ot=ht-Y;H+=Tt*Tt+Ot*Ot}if(H<y){y=H,v=O;for(var Rt=0;Rt<x.length;Rt++)p[Rt]=x[Rt]}}else for(var Ut=0;Ut<w;Ut+=2)p[Ut]=l[Ut]-c[0],p[Ut+1]=l[Ut+1]-c[1];n.push({from:h,to:p,fromCp:u,toCp:c,rotation:-v})}return n}function kw(r){return r.__isCombineMorphing}var YZ="__mOriginal_";function Ow(r,t,e){var i=YZ+t,n=r[i]||r[t];r[i]||(r[i]=r[t]);var a=e.replace,s=e.after,o=e.before;r[t]=function(){var l=arguments,u;return o&&o.apply(this,l),a?u=a.apply(this,l):u=n.apply(this,l),s&&s.apply(this,l),u}}function yy(r,t){var e=YZ+t;r[e]&&(r[t]=r[e],r[e]=null)}function TU(r,t){for(var e=0;e<r.length;e++)for(var i=r[e],n=0;n<i.length;){var a=i[n],s=i[n+1];i[n++]=t[0]*a+t[2]*s+t[4],i[n++]=t[1]*a+t[3]*s+t[5]}}function KZ(r,t){var e=r.getUpdatedPathProxy(),i=t.getUpdatedPathProxy(),n=mFt(dP(e),dP(i)),a=n[0],s=n[1],o=r.getComputedTransform(),l=t.getComputedTransform();function u(){this.transform=null}o&&TU(a,o),l&&TU(s,l),Ow(t,"updateTransform",{replace:u}),t.transform=null;var c=xFt(a,s,10,Math.PI),h=[];Ow(t,"buildPath",{replace:function(p){for(var v=t.__morphT,y=1-v,x=[],w=0;w<c.length;w++){var T=c[w],E=T.from,M=T.to,L=T.rotation*v,F=T.fromCp,O=T.toCp,U=Math.sin(L),W=Math.cos(L);$1(x,F,O,v);for(var H=0;H<E.length;H+=2){var j=E[H],Y=E[H+1],tt=M[H],it=M[H+1],lt=j*y+tt*v,ht=Y*y+it*v;h[H]=lt*W-ht*U+x[0],h[H+1]=lt*U+ht*W+x[1]}var Tt=h[0],Ot=h[1];p.moveTo(Tt,Ot);for(var H=2;H<E.length;){var tt=h[H++],it=h[H++],Rt=h[H++],Ut=h[H++],Jt=h[H++],ne=h[H++];Tt===tt&&Ot===it&&Rt===Jt&&Ut===ne?p.lineTo(Jt,ne):p.bezierCurveTo(tt,it,Rt,Ut,Jt,ne),Tt=Jt,Ot=ne}}}})}function OL(r,t,e){if(!r||!t)return t;var i=e.done,n=e.during;KZ(r,t),t.__morphT=0;function a(){yy(t,"buildPath"),yy(t,"updateTransform"),t.__morphT=-1,t.createPathProxy(),t.dirtyShape()}return t.animateTo({__morphT:1},We({during:function(s){t.dirtyShape(),n&&n(s)},done:function(){a(),i&&i()}},e)),t}function bFt(r,t,e,i,n,a){var s=16;r=n===e?0:Math.round(32767*(r-e)/(n-e)),t=a===i?0:Math.round(32767*(t-i)/(a-i));for(var o=0,l,u=(1<<s)/2;u>0;u/=2){var c=0,h=0;(r&u)>0&&(c=1),(t&u)>0&&(h=1),o+=u*u*(3*c^h),h===0&&(c===1&&(r=u-1-r,t=u-1-t),l=r,r=t,t=l)}return o}function Nw(r){var t=1/0,e=1/0,i=-1/0,n=-1/0,a=te(r,function(o){var l=o.getBoundingRect(),u=o.getComputedTransform(),c=l.x+l.width/2+(u?u[4]:0),h=l.y+l.height/2+(u?u[5]:0);return t=Math.min(c,t),e=Math.min(h,e),i=Math.max(c,i),n=Math.max(h,n),[c,h]}),s=te(a,function(o,l){return{cp:o,z:bFt(o[0],o[1],t,e,i,n),path:r[l]}});return s.sort(function(o,l){return o.z-l.z}).map(function(o){return o.path})}function JZ(r){return gFt(r.path,r.count)}function gP(){return{fromIndividuals:[],toIndividuals:[],count:0}}function wFt(r,t,e){var i=[];function n(F){for(var O=0;O<F.length;O++){var U=F[O];kw(U)?n(U.childrenRef()):U instanceof vr&&i.push(U)}}n(r);var a=i.length;if(!a)return gP();var s=e.dividePath||JZ,o=s({path:t,count:a});if(o.length!==a)return console.error("Invalid morphing: unmatched splitted path"),gP();i=Nw(i),o=Nw(o);for(var l=e.done,u=e.during,c=e.individualDelay,h=new ru,p=0;p<a;p++){var v=i[p],y=o[p];y.parent=t,y.copyTransform(h),c||KZ(v,y)}t.__isCombineMorphing=!0,t.childrenRef=function(){return o};function x(F){for(var O=0;O<o.length;O++)o[O].addSelfToZr(F)}Ow(t,"addSelfToZr",{after:function(F){x(F)}}),Ow(t,"removeSelfFromZr",{after:function(F){for(var O=0;O<o.length;O++)o[O].removeSelfFromZr(F)}});function w(){t.__isCombineMorphing=!1,t.__morphT=-1,t.childrenRef=null,yy(t,"addSelfToZr"),yy(t,"removeSelfFromZr")}var T=o.length;if(c)for(var E=T,M=function(){E--,E===0&&(w(),l&&l())},p=0;p<T;p++){var L=c?We({delay:(e.delay||0)+c(p,T,i[p],o[p]),done:M},e):e;OL(i[p],o[p],L)}else t.__morphT=0,t.animateTo({__morphT:1},We({during:function(F){for(var O=0;O<T;O++){var U=o[O];U.__morphT=t.__morphT,U.dirtyShape()}u&&u(F)},done:function(){w();for(var F=0;F<r.length;F++)yy(r[F],"updateTransform");l&&l()}},e));return t.__zr&&x(t.__zr),{fromIndividuals:i,toIndividuals:o,count:T}}function SFt(r,t,e){var i=t.length,n=[],a=e.dividePath||JZ;function s(v){for(var y=0;y<v.length;y++){var x=v[y];kw(x)?s(x.childrenRef()):x instanceof vr&&n.push(x)}}if(kw(r)){s(r.childrenRef());var o=n.length;if(o<i)for(var l=0,u=o;u<i;u++)n.push(YR(n[l++%o]));n.length=i}else{n=a({path:r,count:i});for(var c=r.getComputedTransform(),u=0;u<n.length;u++)n[u].setLocalTransform(c);if(n.length!==i)return console.error("Invalid morphing: unmatched splitted path"),gP()}n=Nw(n),t=Nw(t);for(var h=e.individualDelay,u=0;u<i;u++){var p=h?We({delay:(e.delay||0)+h(u,i,n[u],t[u])},e):e;OL(n[u],t[u],p)}return{fromIndividuals:n,toIndividuals:t,count:t.length}}function AU(r){return Kt(r[0])}function CU(r,t){for(var e=[],i=r.length,n=0;n<i;n++)e.push({one:r[n],many:[]});for(var n=0;n<t.length;n++){var a=t[n].length,s=void 0;for(s=0;s<a;s++)e[s%i].many.push(t[n][s])}for(var o=0,n=i-1;n>=0;n--)if(!e[n].many.length){var l=e[o].many;if(l.length<=1)if(o)o=0;else return e;var a=l.length,u=Math.ceil(a/2);e[n].many=l.slice(u,a),e[o].many=l.slice(0,u),o++}return e}var TFt={clone:function(r){for(var t=[],e=1-Math.pow(1-r.path.style.opacity,1/r.count),i=0;i<r.count;i++){var n=YR(r.path);n.setStyle("opacity",e),t.push(n)}return t},split:null};function yE(r,t,e,i,n,a){if(!r.length||!t.length)return;var s=Dg("update",i,n);if(!(s&&s.duration>0))return;var o=i.getModel("universalTransition").get("delay"),l=Object.assign({setToFinal:!0},s),u,c;AU(r)&&(u=r,c=t),AU(t)&&(u=t,c=r);function h(T,E,M,L,F){var O=T.many,U=T.one;if(O.length===1&&!F){var W=E?O[0]:U,H=E?U:O[0];if(kw(W))h({many:[W],one:H},!0,M,L,!0);else{var j=o?We({delay:o(M,L)},l):l;OL(W,H,j),a(W,H,W,H,j)}}else for(var Y=We({dividePath:TFt[e],individualDelay:o&&function(Ot,Rt,Ut,Jt){return o(Ot+M,L)}},l),tt=E?wFt(O,U,Y):SFt(U,O,Y),it=tt.fromIndividuals,lt=tt.toIndividuals,ht=it.length,Tt=0;Tt<ht;Tt++){var j=o?We({delay:o(Tt,ht)},l):l;a(it[Tt],lt[Tt],E?O[Tt]:T.one,E?T.one:O[Tt],j)}}for(var p=u?u===r:r.length>t.length,v=u?CU(c,u):CU(p?t:r,[p?r:t]),y=0,x=0;x<v.length;x++)y+=v[x].many.length;for(var w=0,x=0;x<v.length;x++)h(v[x],p,w,y),w+=v[x].many.length}function ef(r){if(!r)return[];if(Kt(r)){for(var t=[],e=0;e<r.length;e++)t.push(ef(r[e]));return t}var i=[];return r.traverse(function(n){n instanceof vr&&!n.disableMorphing&&!n.invisible&&!n.ignore&&i.push(n)}),i}var QZ=1e4,AFt=0,EU=1,IU=2,CFt=Ir();function EFt(r,t){for(var e=r.dimensions,i=0;i<e.length;i++){var n=r.getDimensionInfo(e[i]);if(n&&n.otherDims[t]===0)return e[i]}}function IFt(r,t,e){var i=r.getDimensionInfo(e),n=i&&i.ordinalMeta;if(i){var a=r.get(i.name,t);return n&&n.categories[a]||a+""}}function MU(r,t,e,i){var n=i?"itemChildGroupId":"itemGroupId",a=EFt(r,n);if(a){var s=IFt(r,t,a);return s}var o=r.getRawDataItem(t),l=i?"childGroupId":"groupId";if(o&&o[l])return o[l]+"";if(!i)return e||r.getId(t)}function PU(r){var t=[];return J(r,function(e){var i=e.data,n=e.dataGroupId;if(!(i.count()>QZ))for(var a=i.getIndices(),s=0;s<a.length;s++)t.push({data:i,groupId:MU(i,s,n,!1),childGroupId:MU(i,s,n,!0),divide:e.divide,dataIndex:s})}),t}function _E(r,t,e){r.traverse(function(i){i instanceof vr&&Ei(i,{style:{opacity:0}},t,{dataIndex:e,isFrom:!0})})}function xE(r){if(r.parent){var t=r.getComputedTransform();r.setLocalTransform(t),r.parent.remove(r)}}function xp(r){r.stopAnimation(),r.isGroup&&r.traverse(function(t){t.stopAnimation()})}function MFt(r,t,e){var i=Dg("update",e,t);i&&r.traverse(function(n){if(n instanceof ao){var a=u0t(n);a&&n.animateFrom({style:a},i)}})}function PFt(r,t){var e=r.length;if(e!==t.length)return!1;for(var i=0;i<e;i++){var n=r[i],a=t[i];if(n.data.getId(n.dataIndex)!==a.data.getId(a.dataIndex))return!1}return!0}function tq(r,t,e){var i=PU(r),n=PU(t);function a(M,L,F,O,U){(F||M)&&L.animateFrom({style:F&&F!==M?Zt(Zt({},F.style),M.style):M.style},U)}var s=!1,o=AFt,l=Re(),u=Re();i.forEach(function(M){M.groupId&&l.set(M.groupId,!0),M.childGroupId&&u.set(M.childGroupId,!0)});for(var c=0;c<n.length;c++){var h=n[c].groupId;if(u.get(h)){o=EU;break}var p=n[c].childGroupId;if(p&&l.get(p)){o=IU;break}}function v(M,L){return function(F){var O=F.data,U=F.dataIndex;return L?O.getId(U):M?o===EU?F.childGroupId:F.groupId:o===IU?F.childGroupId:F.groupId}}var y=PFt(i,n),x={};if(!y)for(var c=0;c<n.length;c++){var w=n[c],T=w.data.getItemGraphicEl(w.dataIndex);T&&(x[T.id]=!0)}function E(M,L){var F=i[L],O=n[M],U=O.data.hostModel,W=F.data.getItemGraphicEl(F.dataIndex),H=O.data.getItemGraphicEl(O.dataIndex);if(W===H){H&&MFt(H,O.dataIndex,U);return}W&&x[W.id]||H&&(xp(H),W?(xp(W),xE(W),s=!0,yE(ef(W),ef(H),O.divide,U,M,a)):_E(H,U,M))}new yu(i,n,v(!0,y),v(!1,y),null,"multiple").update(E).updateManyToOne(function(M,L){var F=n[M],O=F.data,U=O.hostModel,W=O.getItemGraphicEl(F.dataIndex),H=ti(te(L,function(j){return i[j].data.getItemGraphicEl(i[j].dataIndex)}),function(j){return j&&j!==W&&!x[j.id]});W&&(xp(W),H.length?(J(H,function(j){xp(j),xE(j)}),s=!0,yE(ef(H),ef(W),F.divide,U,M,a)):_E(W,U,F.dataIndex))}).updateOneToMany(function(M,L){var F=i[L],O=F.data.getItemGraphicEl(F.dataIndex);if(!(O&&x[O.id])){var U=ti(te(M,function(H){return n[H].data.getItemGraphicEl(n[H].dataIndex)}),function(H){return H&&H!==O}),W=n[M[0]].data.hostModel;U.length&&(J(U,function(H){return xp(H)}),O?(xp(O),xE(O),s=!0,yE(ef(O),ef(U),F.divide,W,M[0],a)):J(U,function(H){return _E(H,W,M[0])}))}}).updateManyToMany(function(M,L){new yu(L,M,function(F){return i[F].data.getId(i[F].dataIndex)},function(F){return n[F].data.getId(n[F].dataIndex)}).update(function(F,O){E(M[F],L[O])}).execute()}).execute(),s&&J(t,function(M){var L=M.data,F=L.hostModel,O=F&&e.getViewOfSeriesModel(F),U=Dg("update",F,0);O&&F.isAnimationEnabled()&&U&&U.duration>0&&O.group.traverse(function(W){W instanceof vr&&!W.animators.length&&W.animateFrom({style:{opacity:0}},U)})})}function RU(r){var t=r.getModel("universalTransition").get("seriesKey");return t||r.id}function DU(r){return Kt(r)?r.sort().join(","):r}function cc(r){if(r.hostModel)return r.hostModel.getModel("universalTransition").get("divideShape")}function RFt(r,t){var e=Re(),i=Re(),n=Re();return J(r.oldSeries,function(a,s){var o=r.oldDataGroupIds[s],l=r.oldData[s],u=RU(a),c=DU(u);i.set(c,{dataGroupId:o,data:l}),Kt(u)&&J(u,function(h){n.set(h,{key:c,dataGroupId:o,data:l})})}),J(t.updatedSeries,function(a){if(a.isUniversalTransitionEnabled()&&a.isAnimationEnabled()){var s=a.get("dataGroupId"),o=a.getData(),l=RU(a),u=DU(l),c=i.get(u);if(c)e.set(u,{oldSeries:[{dataGroupId:c.dataGroupId,divide:cc(c.data),data:c.data}],newSeries:[{dataGroupId:s,divide:cc(o),data:o}]});else if(Kt(l)){var h=[];J(l,function(y){var x=i.get(y);x.data&&h.push({dataGroupId:x.dataGroupId,divide:cc(x.data),data:x.data})}),h.length&&e.set(u,{oldSeries:h,newSeries:[{dataGroupId:s,data:o,divide:cc(o)}]})}else{var p=n.get(l);if(p){var v=e.get(p.key);v||(v={oldSeries:[{dataGroupId:p.dataGroupId,data:p.data,divide:cc(p.data)}],newSeries:[]},e.set(p.key,v)),v.newSeries.push({dataGroupId:s,data:o,divide:cc(o)})}}}}),e}function LU(r,t){for(var e=0;e<r.length;e++){var i=t.seriesIndex!=null&&t.seriesIndex===r[e].seriesIndex||t.seriesId!=null&&t.seriesId===r[e].id;if(i)return e}}function DFt(r,t,e,i){var n=[],a=[];J(ri(r.from),function(s){var o=LU(t.oldSeries,s);o>=0&&n.push({dataGroupId:t.oldDataGroupIds[o],data:t.oldData[o],divide:cc(t.oldData[o]),groupIdDim:s.dimension})}),J(ri(r.to),function(s){var o=LU(e.updatedSeries,s);if(o>=0){var l=e.updatedSeries[o].getData();a.push({dataGroupId:t.oldDataGroupIds[o],data:l,divide:cc(l),groupIdDim:s.dimension})}}),n.length>0&&a.length>0&&tq(n,a,i)}function LFt(r){r.registerUpdateLifecycle("series:beforeupdate",function(t,e,i){J(ri(i.seriesTransition),function(n){J(ri(n.to),function(a){for(var s=i.updatedSeries,o=0;o<s.length;o++)(a.seriesIndex!=null&&a.seriesIndex===s[o].seriesIndex||a.seriesId!=null&&a.seriesId===s[o].id)&&(s[o][tb]=!0)})})}),r.registerUpdateLifecycle("series:transition",function(t,e,i){var n=CFt(e);if(n.oldSeries&&i.updatedSeries&&i.optionChanged){var a=i.seriesTransition;if(a)J(ri(a),function(v){DFt(v,n,i,e)});else{var s=RFt(n,i);J(s.keys(),function(v){var y=s.get(v);tq(y.oldSeries,y.newSeries,e)})}J(i.updatedSeries,function(v){v[tb]&&(v[tb]=!1)})}for(var o=t.getSeries(),l=n.oldSeries=[],u=n.oldDataGroupIds=[],c=n.oldData=[],h=0;h<o.length;h++){var p=o[h].getData();p.count()<QZ&&(l.push(o[h]),u.push(o[h].get("dataGroupId")),c.push(p))}})}gr([ZSt]);gr([USt]);gr([yTt,NTt,qTt,NAt,QAt,X2t,TCt,cEt,BEt,XEt,nIt,lMt,OMt,ZMt,pPt,bPt,zPt,qPt,lRt,vRt,MRt,pDt]);gr(FDt);gr(mLt);gr(qj);gr(kLt);gr(OX);gr(ULt);gr(YLt);gr(Kkt);gr(x3t);gr(H_);gr(V3t);gr(W3t);gr(nOt);gr(pOt);gr(wOt);gr(POt);gr(HOt);gr(fNt);gr(VZ);gr(UZ);gr(zNt);gr(jZ);gr(XZ);gr(HNt);gr(iFt);gr(sFt);gr(LFt);gr(aSt);function kFt(r,t){let e;return function(...i){clearTimeout(e),e=setTimeout(()=>r.apply(this,i),t)}}const OFt="https://gcp-us-east1.api.carto.com",NFt="eyJhbGciOiJIUzI1NiJ9.eyJhIjoiYWNfbHFlM3p3Z3UiLCJqdGkiOiJkOTU4OWMyZiJ9.78MdzU2J6y-J6Far71_Mh7IQO9eYIZD9nECUiZJAVL4",FFt="carto_dw",BFt={apiBaseUrl:OFt,accessToken:NFt,connectionName:FFt},zFt={latitude:41.8097343,longitude:-110.5556199,zoom:1,bearing:0,pitch:0},eq=new Dlt({canvas:"deck-canvas",initialViewState:zFt,controller:!0}),VFt=new iK.Map({container:"map",style:ggt.POSITRON,interactive:!1}),kU=document.querySelector("#widget1"),UFt=document.querySelector("#widget2");var $Ft=UFt,ob=bbt($Ft);ob.on("click",function(r){r.componentType==="series"&&GFt(r.dataIndex)});let eg;async function WFt(){return eg=await avt({...BFt,tableName:"carto-demo-data.demo_tables.populated_places",filters:kf})}const rq={0:"0 - 50k",5e4:"50k - 100k",1e5:"100k - 150k",15e4:"150k - 200k",2e5:"200k - 250k",25e4:"250k - 300k",3e5:"300k - 350k",35e4:"350k - 400k",4e5:"400k - 450k",45e4:"450k - 500k",5e5:"> 500k"};let vP;const HFt=kFt(r=>{const t=new Cy(r);vP=Fgt(t.getBounds()),iq()},300);eq.setProps({onViewStateChange:({viewState:r})=>{const{longitude:t,latitude:e,...i}=r;VFt.jumpTo({center:[t,e],...i}),HFt(r)}});let kf={};const Rm=document.querySelector("#osmCategorySelector");Rm==null||Rm.addEventListener("change",()=>{const r=Rm.value;r=="All"?Ngt(kf):CI(kf,{column:"sov_a3",type:Uf.IN,values:[r]}),Rm.value,eT()});const _y=document.querySelector("#clearHistogramFilter");_y==null||_y.addEventListener("click",()=>{jFt()});function GFt(r){_y.style.display="inherit";const t=Object.keys(rq).map(Number),e=t[r],i=t[r+1];$W(kf,{column:"pop_max"}),r===t.length-1?CI(kf,{column:"pop_max",type:Uf.CLOSED_OPEN,values:[[e,1/0]]}):CI(kf,{column:"pop_max",type:Uf.BETWEEN,values:[[e,i]]}),eT()}function jFt(){_y.style.display="none",$W(kf,{column:"pop_max"}),eT()}async function iq(){if(!eg)return;kU.innerHTML="Loading...",ob.showLoading();const r=await eg.widgetSource.getFormula({operation:"count",spatialFilter:vP}),t=await eg.widgetSource.getHistogram({column:"pop_max",ticks:[5e4,1e5,15e4,2e5,25e4,3e5,35e4,4e5,45e4,5e5],operation:"count",spatialFilter:vP}),e={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:40,right:30,top:10,width:"auto",height:"auto"},xAxis:{type:"category",data:Object.values(rq),axisLabel:{rotate:45,interval:0}},yAxis:{type:"value"},series:[{name:"Total cities",type:"bar",data:t,itemStyle:{color:"#3398DB"}}]};kU.innerHTML=r.value,ob.setOption(e),ob.hideLoading()}async function XFt(){if(!eg)return;const r=[new hgt({id:"places",pickable:!0,data:eg,pointRadiusMinPixels:4,getFillColor:[200,0,80]})];eq.setProps({layers:r,getTooltip:({object:t})=>t&&{html:`
          <strong>Name</strong>: ${t.properties.name}<br/>
          <strong>Population (max)</strong>: ${t.properties.pop_max}<br/>
          <strong>Latitude</strong>: ${t.geometry.coordinates[0].toFixed(6)}<br/>
          <strong>Latitude</strong>: ${t.geometry.coordinates[1].toFixed(6)}
        `}})}async function eT(){await WFt(),iq(),XFt()}eT();
