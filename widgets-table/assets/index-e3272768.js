var CP=Object.defineProperty;var RP=(t,e,i)=>e in t?CP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var H=(t,e,i)=>(RP(t,typeof e!="symbol"?e+"":e,i),i);function MP(t,e){for(var i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in t)){const l=Object.getOwnPropertyDescriptor(r,n);l&&Object.defineProperty(t,n,l.get?l:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function i(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=i(n);fetch(n.href,l)}})();var kP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wp(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var eT={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(kP,function(){var i,r,n;function l(a,g){if(!i)i=g;else if(!r)r=g;else{var y="var sharedChunk = {}; ("+i+")(sharedChunk); ("+r+")(sharedChunk);",T={};i(T),n=g(T),typeof window<"u"&&(n.workerUrl=window.URL.createObjectURL(new Blob([y],{type:"text/javascript"})))}}l(["exports"],function(a){function g(c,s,u,f){return new(u||(u=Promise))(function(_,v){function w(k){try{C(f.next(k))}catch(F){v(F)}}function E(k){try{C(f.throw(k))}catch(F){v(F)}}function C(k){var F;k.done?_(k.value):(F=k.value,F instanceof u?F:new u(function(L){L(F)})).then(w,E)}C((f=f.apply(c,s||[])).next())})}function y(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var T=S;function S(c,s){this.x=c,this.y=s}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,s){return this.clone()._rotateAround(c,s)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var s=c.x-this.x,u=c.y-this.y;return s*s+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,s){return Math.atan2(this.x*s-this.y*c,this.x*c+this.y*s)},_matMult:function(c){var s=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=s,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var s=Math.cos(c),u=Math.sin(c),f=u*this.x+s*this.y;return this.x=s*this.x-u*this.y,this.y=f,this},_rotateAround:function(c,s){var u=Math.cos(c),f=Math.sin(c),_=s.y+f*(this.x-s.x)+u*(this.y-s.y);return this.x=s.x+u*(this.x-s.x)-f*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(c){return c instanceof S?c:Array.isArray(c)?new S(c[0],c[1]):c};var P=y(T),M=B;function B(c,s,u,f){this.cx=3*c,this.bx=3*(u-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=s,this.p2x=u,this.p2y=f}B.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,s){if(s===void 0&&(s=1e-6),c<0)return 0;if(c>1)return 1;for(var u=c,f=0;f<8;f++){var _=this.sampleCurveX(u)-c;if(Math.abs(_)<s)return u;var v=this.sampleCurveDerivativeX(u);if(Math.abs(v)<1e-6)break;u-=_/v}var w=0,E=1;for(u=c,f=0;f<20&&(_=this.sampleCurveX(u),!(Math.abs(_-c)<s));f++)c>_?w=u:E=u,u=.5*(E-w)+w;return u},solve:function(c,s){return this.sampleCurveY(this.solveCurveX(c,s))}};var j=y(M);let Z,G;function fe(){return Z==null&&(Z=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Z}function re(){if(G==null&&(G=!1,fe())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let f=0;f<5*5;f++){const _=4*f;s.fillStyle=`rgb(${_},${_+1},${_+2})`,s.fillRect(f%5,Math.floor(f/5),1,1)}const u=s.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&u[f]!==f){G=!0;break}}}return G||!1}function ue(c,s,u,f){const _=new j(c,s,u,f);return function(v){return _.solve(v)}}const Me=ue(.25,.1,.25,1);function Oe(c,s,u){return Math.min(u,Math.max(s,c))}function $e(c,s,u){const f=u-s,_=((c-s)%f+f)%f+s;return _===s?u:_}function ke(c,...s){for(const u of s)for(const f in u)c[f]=u[f];return c}let je=1;function Ue(c,s,u){const f={};for(const _ in c)f[_]=s.call(u||this,c[_],_,c);return f}function ct(c,s,u){const f={};for(const _ in c)s.call(u||this,c[_],_,c)&&(f[_]=c[_]);return f}function tt(c){return Array.isArray(c)?c.map(tt):typeof c=="object"&&c?Ue(c,tt):c}const pt={};function ot(c){pt[c]||(typeof console<"u"&&console.warn(c),pt[c]=!0)}function ei(c,s,u){return(u.y-c.y)*(s.x-c.x)>(s.y-c.y)*(u.x-c.x)}function rn(c){let s=0;for(let u,f,_=0,v=c.length,w=v-1;_<v;w=_++)u=c[_],f=c[w],s+=(f.x-u.x)*(u.y+f.y);return s}function lr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let us=null;function ks(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const Co="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function eo(c,s,u,f,_){return g(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(c,{timestamp:0});try{const w=v==null?void 0:v.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const E=w.startsWith("BGR"),C=new Uint8ClampedArray(f*_*4);if(yield v.copyTo(C,function(k,F,L,U,W){const q=4*Math.max(-F,0),Q=(Math.max(0,L)-L)*U*4+q,ae=4*U,de=Math.max(0,F),ve=Math.max(0,L);return{rect:{x:de,y:ve,width:Math.min(k.width,F+U)-de,height:Math.min(k.height,L+W)-ve},layout:[{offset:Q,stride:ae}]}}(c,s,u,f,_)),E)for(let k=0;k<C.length;k+=4){const F=C[k];C[k]=C[k+2],C[k+2]=F}return C}finally{v.close()}})}let _r,oi,sr,hs;const Os={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(c){const s=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(c,s=0){return this.getImageCanvasContext(c).getImageData(-s,-s,c.width+2*s,c.height+2*s)},getImageCanvasContext(c){const s=window.document.createElement("canvas"),u=s.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return s.width=c.width,s.height=c.height,u.drawImage(c,0,0,c.width,c.height),u},resolveURL:c=>(sr||(sr=document.createElement("a")),sr.href=c,sr.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(hs==null&&(hs=matchMedia("(prefers-reduced-motion: reduce)")),hs.matches)}},Mi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class mr extends Error{constructor(s,u,f,_){super(`AJAXError: ${u} (${s}): ${f}`),this.status=s,this.statusText=u,this.url=f,this.body=_}}const Yt=lr()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,ci=c=>Mi.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))];function Xn(c,s){const u=new AbortController,f=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:Yt(),signal:u.signal});let _=!1,v=!1;return c.type==="json"&&f.headers.set("Accept","application/json"),v||fetch(f).then(w=>w.ok?(E=>{(c.type==="arrayBuffer"||c.type==="image"?E.arrayBuffer():c.type==="json"?E.json():E.text()).then(C=>{v||(_=!0,s(null,C,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(C=>{v||s(new Error(C.message))})})(w):w.blob().then(E=>s(new mr(w.status,w.statusText,c.url,E)))).catch(w=>{w.code!==20&&s(new Error(w.message))}),{cancel:()=>{v=!0,_||u.abort()}}}const Nr=function(c,s){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){if(lr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s);if(!lr())return(ci(c.url)||Xn)(c,s)}if(!(/^file:/.test(u=c.url)||/^file:/.test(Yt())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Xn(c,s);if(lr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s,void 0,!0)}var u;return function(f,_){const v=new XMLHttpRequest;v.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(v.responseType="arraybuffer");for(const w in f.headers)v.setRequestHeader(w,f.headers[w]);return f.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=f.credentials==="include",v.onerror=()=>{_(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let w=v.response;if(f.type==="json")try{w=JSON.parse(v.response)}catch(E){return _(E)}_(null,w,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else{const w=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});_(new mr(v.status,v.statusText,f.url,w))}},v.send(f.body),{cancel:()=>v.abort()}}(c,s)},Nn=function(c,s){return Nr(ke(c,{type:"arrayBuffer"}),s)};function Er(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const s=new URL(c),u=window.location;return s.protocol===u.protocol&&s.host===u.host}function Tn(c,s,u){u[c]&&u[c].indexOf(s)!==-1||(u[c]=u[c]||[],u[c].push(s))}function or(c,s,u){if(u&&u[c]){const f=u[c].indexOf(s);f!==-1&&u[c].splice(f,1)}}class yr{constructor(s,u={}){ke(this,u),this.type=s}}class Ln extends yr{constructor(s,u={}){super("error",ke({error:s},u))}}class Zn{on(s,u){return this._listeners=this._listeners||{},Tn(s,u,this._listeners),this}off(s,u){return or(s,u,this._listeners),or(s,u,this._oneTimeListeners),this}once(s,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Tn(s,u,this._oneTimeListeners),this):new Promise(f=>this.once(s,f))}fire(s,u){typeof s=="string"&&(s=new yr(s,u||{}));const f=s.type;if(this.listens(f)){s.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const E of _)E.call(this,s);const v=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const E of v)or(f,E,this._oneTimeListeners),E.call(this,s);const w=this._eventedParent;w&&(ke(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(s))}else s instanceof Ln&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,u){return this._eventedParent=s,this._eventedParentData=u,this}}var Fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ui=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Lr(c,s){const u={};for(const f in c)f!=="ref"&&(u[f]=c[f]);return ui.forEach(f=>{f in s&&(u[f]=s[f])}),u}function ti(c,s){if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let u=0;u<c.length;u++)if(!ti(c[u],s[u]))return!1;return!0}if(typeof c=="object"&&c!==null&&s!==null){if(typeof s!="object"||Object.keys(c).length!==Object.keys(s).length)return!1;for(const u in c)if(!ti(c[u],s[u]))return!1;return!0}return c===s}const jt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Sn(c,s,u){u.push({command:jt.addSource,args:[c,s[c]]})}function Fs(c,s,u){s.push({command:jt.removeSource,args:[c]}),u[c]=!0}function En(c,s,u,f){Fs(c,u,f),Sn(c,s,u)}function to(c,s,u){let f;for(f in c[u])if(Object.prototype.hasOwnProperty.call(c[u],f)&&f!=="data"&&!ti(c[u][f],s[u][f]))return!1;for(f in s[u])if(Object.prototype.hasOwnProperty.call(s[u],f)&&f!=="data"&&!ti(c[u][f],s[u][f]))return!1;return!0}function ds(c,s,u,f,_,v){let w;for(w in s=s||{},c=c||{})Object.prototype.hasOwnProperty.call(c,w)&&(ti(c[w],s[w])||u.push({command:v,args:[f,w,s[w],_]}));for(w in s)Object.prototype.hasOwnProperty.call(s,w)&&!Object.prototype.hasOwnProperty.call(c,w)&&(ti(c[w],s[w])||u.push({command:v,args:[f,w,s[w],_]}))}function Bn(c){return c.id}function An(c,s){return c[s.id]=s,c}class Ze{constructor(s,u,f,_){this.message=(s?`${s}: `:"")+f,_&&(this.identifier=_),u!=null&&u.__line__&&(this.line=u.__line__)}}function Pn(c,...s){for(const u of s)for(const f in u)c[f]=u[f];return c}class xi extends Error{constructor(s,u){super(u),this.message=u,this.key=s}}class fs{constructor(s,u=[]){this.parent=s,this.bindings={};for(const[f,_]of u)this.bindings[f]=_}concat(s){return new fs(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const zn={kind:"null"},Ke={kind:"number"},Pt={kind:"string"},At={kind:"boolean"},cr={kind:"color"},nn={kind:"object"},It={kind:"value"},sn={kind:"collator"},ne={kind:"formatted"},z={kind:"padding"},V={kind:"resolvedImage"},Y={kind:"variableAnchorOffsetCollection"};function oe(c,s){return{kind:"array",itemType:c,N:s}}function le(c){if(c.kind==="array"){const s=le(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}const be=[zn,Ke,Pt,At,cr,ne,nn,oe(It),z,V,Y];function _e(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!_e(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(const u of be)if(!_e(u,s))return null}}return`Expected ${le(c)} but found ${le(s)} instead.`}function he(c,s){return s.some(u=>u.kind===c.kind)}function ye(c,s){return s.some(u=>u==="null"?c===null:u==="array"?Array.isArray(c):u==="object"?c&&!Array.isArray(c)&&typeof c=="object":u===typeof c)}function De(c,s){return c.kind==="array"&&s.kind==="array"?c.itemType.kind===s.itemType.kind&&typeof c.N=="number":c.kind===s.kind}const Ne=.96422,ze=.82521,yt=4/29,St=6/29,lt=3*St*St,xt=St*St*St,Et=Math.PI/180,Ht=180/Math.PI;function qt(c){return(c%=360)<0&&(c+=360),c}function Rt([c,s,u,f]){let _,v;const w=ki((.2225045*(c=Mt(c))+.7168786*(s=Mt(s))+.0606169*(u=Mt(u)))/1);c===s&&s===u?_=v=w:(_=ki((.4360747*c+.3850649*s+.1430804*u)/Ne),v=ki((.0139322*c+.0971045*s+.7141733*u)/ze));const E=116*w-16;return[E<0?0:E,500*(_-w),200*(w-v),f]}function Mt(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function ki(c){return c>xt?Math.pow(c,1/3):c/lt+yt}function Kt([c,s,u,f]){let _=(c+16)/116,v=isNaN(s)?_:_+s/500,w=isNaN(u)?_:_-u/200;return _=1*Zi(_),v=Ne*Zi(v),w=ze*Zi(w),[Ti(3.1338561*v-1.6168667*_-.4906146*w),Ti(-.9787684*v+1.9161415*_+.033454*w),Ti(.0719453*v-.2289914*_+1.4052427*w),f]}function Ti(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Zi(c){return c>St?c*c*c:lt*(c-yt)}function Br(c){return parseInt(c.padEnd(2,c),16)/255}function io(c,s){return Yi(s?c/100:c,0,1)}function Yi(c,s,u){return Math.min(Math.max(s,c),u)}function on(c){return!c.some(Number.isNaN)}const Yn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Dt{constructor(s,u,f,_=1,v=!0){this.r=s,this.g=u,this.b=f,this.a=_,v||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[s,u,f,_]))}static parse(s){if(s instanceof Dt)return s;if(typeof s!="string")return;const u=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Yn[f];if(_){const[w,E,C]=_;return[w/255,E/255,C/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const w=f.length<6?1:2;let E=1;return[Br(f.slice(E,E+=w)),Br(f.slice(E,E+=w)),Br(f.slice(E,E+=w)),Br(f.slice(E,E+w)||"ff")]}if(f.startsWith("rgb")){const w=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[E,C,k,F,L,U,W,q,Q,ae,de,ve]=w,ge=[F||" ",W||" ",ae].join("");if(ge==="  "||ge==="  /"||ge===",,"||ge===",,,"){const we=[k,U,Q].join(""),Pe=we==="%%%"?100:we===""?255:0;if(Pe){const Be=[Yi(+C/Pe,0,1),Yi(+L/Pe,0,1),Yi(+q/Pe,0,1),de?io(+de,ve):1];if(on(Be))return Be}}return}}const v=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[w,E,C,k,F,L,U,W,q]=v,Q=[C||" ",F||" ",U].join("");if(Q==="  "||Q==="  /"||Q===",,"||Q===",,,"){const ae=[+E,Yi(+k,0,100),Yi(+L,0,100),W?io(+W,q):1];if(on(ae))return function([de,ve,ge,we]){function Pe(Be){const nt=(Be+de/30)%12,dt=ve*Math.min(ge,1-ge);return ge-dt*Math.max(-1,Math.min(nt-3,9-nt,1))}return de=qt(de),ve/=100,ge/=100,[Pe(0),Pe(8),Pe(4),we]}(ae)}}}(s);return u?new Dt(...u,!1):void 0}get rgb(){const{r:s,g:u,b:f,a:_}=this,v=_||1/0;return this.overwriteGetter("rgb",[s/v,u/v,f/v,_])}get hcl(){return this.overwriteGetter("hcl",function(s){const[u,f,_,v]=Rt(s),w=Math.sqrt(f*f+_*_);return[Math.round(1e4*w)?qt(Math.atan2(_,f)*Ht):NaN,w,u,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Rt(this.rgb))}overwriteGetter(s,u){return Object.defineProperty(this,s,{value:u}),u}toString(){const[s,u,f,_]=this.rgb;return`rgba(${[s,u,f].map(v=>Math.round(255*v)).join(",")},${_})`}}Dt.black=new Dt(0,0,0,1),Dt.white=new Dt(1,1,1,1),Dt.transparent=new Dt(0,0,0,0),Dt.red=new Dt(1,0,0,1);class ps{constructor(s,u,f){this.sensitivity=s?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,u){return this.collator.compare(s,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ar{constructor(s,u,f,_,v){this.text=s,this.image=u,this.scale=f,this.fontStack=_,this.textColor=v}}class di{constructor(s){this.sections=s}static fromString(s){return new di([new Ar(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof di?s:di.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class xr{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof xr)return s;if(typeof s=="number")return new xr([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const u of s)if(typeof u!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new xr(s)}}toString(){return JSON.stringify(this.values)}}const fl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ur{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof ur)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let u=0;u<s.length;u+=2){const f=s[u],_=s[u+1];if(typeof f!="string"||!fl.has(f)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new ur(s)}}toString(){return JSON.stringify(this.values)}}class ri{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new ri({name:s,available:!1}):null}}function gs(c,s,u,f){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[c,s,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[c,s,u,f]:[c,s,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Kn(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Dt||c instanceof ps||c instanceof di||c instanceof xr||c instanceof ur||c instanceof ri)return!0;if(Array.isArray(c)){for(const s of c)if(!Kn(s))return!1;return!0}if(typeof c=="object"){for(const s in c)if(!Kn(c[s]))return!1;return!0}return!1}function ai(c){if(c===null)return zn;if(typeof c=="string")return Pt;if(typeof c=="boolean")return At;if(typeof c=="number")return Ke;if(c instanceof Dt)return cr;if(c instanceof ps)return sn;if(c instanceof di)return ne;if(c instanceof xr)return z;if(c instanceof ur)return Y;if(c instanceof ri)return V;if(Array.isArray(c)){const s=c.length;let u;for(const f of c){const _=ai(f);if(u){if(u===_)continue;u=It;break}u=_}return oe(u||It,s)}return nn}function $t(c){const s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof Dt||c instanceof di||c instanceof xr||c instanceof ur||c instanceof ri?c.toString():JSON.stringify(c)}class Un{constructor(s,u){this.type=s,this.value=u}static parse(s,u){if(s.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!Kn(s[1]))return u.error("invalid value");const f=s[1];let _=ai(f);const v=u.expectedType;return _.kind!=="array"||_.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(_=v),new Un(_,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class li{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const zr={string:Pt,number:Ke,boolean:At,object:nn};class Ur{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");let f,_=1;const v=s[0];if(v==="array"){let E,C;if(s.length>2){const k=s[1];if(typeof k!="string"||!(k in zr)||k==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=zr[k],_++}else E=It;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return u.error('The length argument to "array" must be a positive integer literal',2);C=s[2],_++}f=oe(E,C)}else{if(!zr[v])throw new Error(`Types doesn't contain name = ${v}`);f=zr[v]}const w=[];for(;_<s.length;_++){const E=u.parse(s[_],_,It);if(!E)return null;w.push(E)}return new Ur(f,w)}evaluate(s){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(s);if(!_e(this.type,ai(f)))return f;if(u===this.args.length-1)throw new li(`Expected value to be of type ${le(this.type)}, but found ${le(ai(f))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Ro={"to-boolean":At,"to-color":cr,"to-number":Ke,"to-string":Pt};class In{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const f=s[0];if(!Ro[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&s.length!==2)return u.error("Expected one argument.");const _=Ro[f],v=[];for(let w=1;w<s.length;w++){const E=u.parse(s[w],w,It);if(!E)return null;v.push(E)}return new In(_,v)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let u,f;for(const _ of this.args){if(u=_.evaluate(s),f=null,u instanceof Dt)return u;if(typeof u=="string"){const v=s.parseColor(u);if(v)return v}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:gs(u[0],u[1],u[2],u[3]),!f))return new Dt(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new li(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const f of this.args){u=f.evaluate(s);const _=xr.parse(u);if(_)return _}throw new li(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const f of this.args){u=f.evaluate(s);const _=ur.parse(u);if(_)return _}throw new li(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const f of this.args){if(u=f.evaluate(s),u===null)return 0;const _=Number(u);if(!isNaN(_))return _}throw new li(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return di.fromString($t(this.args[0].evaluate(s)));case"resolvedImage":return ri.fromString($t(this.args[0].evaluate(s)));default:return $t(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const ba=["Unknown","Point","LineString","Polygon"];class wa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ba[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let u=this._parseColorCache[s];return u||(u=this._parseColorCache[s]=Dt.parse(s)),u}}class Mo{constructor(s,u,f=[],_,v=new fs,w=[]){this.registry=s,this.path=f,this.key=f.map(E=>`[${E}]`).join(""),this.scope=v,this.errors=w,this.expectedType=_,this._isConstant=u}parse(s,u,f,_,v={}){return u?this.concat(u,f,_)._parse(s,v):this._parse(s,v)}_parse(s,u){function f(_,v,w){return w==="assert"?new Ur(v,[_]):w==="coerce"?new In(v,[_]):_}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=s[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[_];if(v){let w=v.parse(s,this);if(!w)return null;if(this.expectedType){const E=this.expectedType,C=w.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||C.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(E.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(E.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(E,C))return null}else w=f(w,E,u.typeAnnotation||"coerce");else w=f(w,E,u.typeAnnotation||"coerce");else w=f(w,E,u.typeAnnotation||"coerce");else w=f(w,E,u.typeAnnotation||"assert")}if(!(w instanceof Un)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const E=new wa;try{w=new Un(w.type,w.evaluate(E))}catch(C){return this.error(C.message),null}}return w}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,u,f){const _=typeof s=="number"?this.path.concat(s):this.path,v=f?this.scope.concat(f):this.scope;return new Mo(this.registry,this._isConstant,_,u||null,v,this.errors)}error(s,...u){const f=`${this.key}${u.map(_=>`[${_}]`).join("")}`;this.errors.push(new xi(f,s))}checkSubtype(s,u){const f=_e(s,u);return f&&this.error(f),f}}class X{constructor(s,u,f){this.type=sn,this.locale=f,this.caseSensitive=s,this.diacriticSensitive=u}static parse(s,u){if(s.length!==2)return u.error("Expected one argument.");const f=s[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const _=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,At);if(!_)return null;const v=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,At);if(!v)return null;let w=null;return f.locale&&(w=u.parse(f.locale,1,Pt),!w)?null:new X(_,v,w)}evaluate(s){return new ps(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const K=8192;function pe(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function Ce(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function qe(c,s){const u=(180+c[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(u*_*K),Math.round(f*_*K)]}function ut(c,s,u){const f=c[0]-s[0],_=c[1]-s[1],v=c[0]-u[0],w=c[1]-u[1];return f*w-v*_==0&&f*v<=0&&_*w<=0}function Ot(c,s){let u=!1;for(let w=0,E=s.length;w<E;w++){const C=s[w];for(let k=0,F=C.length;k<F-1;k++){if(ut(c,C[k],C[k+1]))return!1;(_=C[k])[1]>(f=c)[1]!=(v=C[k+1])[1]>f[1]&&f[0]<(v[0]-_[0])*(f[1]-_[1])/(v[1]-_[1])+_[0]&&(u=!u)}}var f,_,v;return u}function Oi(c,s){for(let u=0;u<s.length;u++)if(Ot(c,s[u]))return!0;return!1}function Wi(c,s,u,f){const _=f[0]-u[0],v=f[1]-u[1],w=(c[0]-u[0])*v-_*(c[1]-u[1]),E=(s[0]-u[0])*v-_*(s[1]-u[1]);return w>0&&E<0||w<0&&E>0}function hr(c,s,u){for(const k of u)for(let F=0;F<k.length-1;++F)if((E=[(w=k[F+1])[0]-(v=k[F])[0],w[1]-v[1]])[0]*(C=[(_=s)[0]-(f=c)[0],_[1]-f[1]])[1]-E[1]*C[0]!=0&&Wi(f,_,v,w)&&Wi(v,w,f,_))return!0;var f,_,v,w,E,C;return!1}function an(c,s){for(let u=0;u<c.length;++u)if(!Ot(c[u],s))return!1;for(let u=0;u<c.length-1;++u)if(hr(c[u],c[u+1],s))return!1;return!0}function Yh(c,s){for(let u=0;u<s.length;u++)if(an(c,s[u]))return!0;return!1}function pl(c,s,u){const f=[];for(let _=0;_<c.length;_++){const v=[];for(let w=0;w<c[_].length;w++){const E=qe(c[_][w],u);pe(s,E),v.push(E)}f.push(v)}return f}function Kh(c,s,u){const f=[];for(let _=0;_<c.length;_++){const v=pl(c[_],s,u);f.push(v)}return f}function Gh(c,s,u,f){if(c[0]<u[0]||c[0]>u[2]){const _=.5*f;let v=c[0]-u[0]>_?-f:u[0]-c[0]>_?f:0;v===0&&(v=c[0]-u[2]>_?-f:u[2]-c[0]>_?f:0),c[0]+=v}pe(s,c)}function Vc(c,s,u,f){const _=Math.pow(2,f.z)*K,v=[f.x*K,f.y*K],w=[];for(const E of c)for(const C of E){const k=[C.x+v[0],C.y+v[1]];Gh(k,s,u,_),w.push(k)}return w}function $c(c,s,u,f){const _=Math.pow(2,f.z)*K,v=[f.x*K,f.y*K],w=[];for(const C of c){const k=[];for(const F of C){const L=[F.x+v[0],F.y+v[1]];pe(s,L),k.push(L)}w.push(k)}if(s[2]-s[0]<=_/2){(E=s)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const C of w)for(const k of C)Gh(k,s,u,_)}var E;return w}class ro{constructor(s,u){this.type=At,this.geojson=s,this.geometries=u}static parse(s,u){if(s.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(Kn(s[1])){const f=s[1];if(f.type==="FeatureCollection")for(let _=0;_<f.features.length;++_){const v=f.features[_].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new ro(f,f.features[_].geometry)}else if(f.type==="Feature"){const _=f.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ro(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new ro(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,f){const _=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=u.canonicalID();if(f.type==="Polygon"){const E=pl(f.coordinates,v,w),C=Vc(u.geometry(),_,v,w);if(!Ce(_,v))return!1;for(const k of C)if(!Ot(k,E))return!1}if(f.type==="MultiPolygon"){const E=Kh(f.coordinates,v,w),C=Vc(u.geometry(),_,v,w);if(!Ce(_,v))return!1;for(const k of C)if(!Oi(k,E))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,f){const _=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=u.canonicalID();if(f.type==="Polygon"){const E=pl(f.coordinates,v,w),C=$c(u.geometry(),_,v,w);if(!Ce(_,v))return!1;for(const k of C)if(!an(k,E))return!1}if(f.type==="MultiPolygon"){const E=Kh(f.coordinates,v,w),C=$c(u.geometry(),_,v,w);if(!Ce(_,v))return!1;for(const k of C)if(!Yh(k,E))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class gl{constructor(s,u){this.type=u.type,this.name=s,this.boundExpression=u}static parse(s,u){if(s.length!==2||typeof s[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=s[1];return u.scope.has(f)?new gl(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Cn{constructor(s,u,f,_){this.name=s,this.type=u,this._evaluate=f,this.args=_}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,u){const f=s[0],_=Cn.definitions[f];if(!_)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(_)?_[0]:_.type,w=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,E=w.filter(([k])=>!Array.isArray(k)||k.length===s.length-1);let C=null;for(const[k,F]of E){C=new Mo(u.registry,_l,u.path,null,u.scope);const L=[];let U=!1;for(let W=1;W<s.length;W++){const q=s[W],Q=Array.isArray(k)?k[W-1]:k.type,ae=C.parse(q,1+L.length,Q);if(!ae){U=!0;break}L.push(ae)}if(!U)if(Array.isArray(k)&&k.length!==L.length)C.error(`Expected ${k.length} arguments, but found ${L.length} instead.`);else{for(let W=0;W<L.length;W++){const q=Array.isArray(k)?k[W]:k.type,Q=L[W];C.concat(W+1).checkSubtype(q,Q.type)}if(C.errors.length===0)return new Cn(f,v,F,L)}}if(E.length===1)u.errors.push(...C.errors);else{const k=(E.length?E:w).map(([L])=>{return U=L,Array.isArray(U)?`(${U.map(le).join(", ")})`:`(${le(U.type)}...)`;var U}).join(" | "),F=[];for(let L=1;L<s.length;L++){const U=u.parse(s[L],1+F.length);if(!U)return null;F.push(le(U.type))}u.error(`Expected arguments of type ${k}, but found (${F.join(", ")}) instead.`)}return null}static register(s,u){Cn.definitions=u;for(const f in u)s[f]=Cn}}function _l(c){if(c instanceof gl)return _l(c.boundExpression);if(c instanceof Cn&&c.name==="error"||c instanceof X||c instanceof ro)return!1;const s=c instanceof In||c instanceof Ur;let u=!0;return c.eachChild(f=>{u=s?u&&_l(f):u&&f instanceof Un}),!!u&&ml(c)&&yl(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ml(c){if(c instanceof Cn&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof ro)return!1;let s=!0;return c.eachChild(u=>{s&&!ml(u)&&(s=!1)}),s}function Ta(c){if(c instanceof Cn&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(u=>{s&&!Ta(u)&&(s=!1)}),s}function yl(c,s){if(c instanceof Cn&&s.indexOf(c.name)>=0)return!1;let u=!0;return c.eachChild(f=>{u&&!yl(f,s)&&(u=!1)}),u}function ko(c,s){const u=c.length-1;let f,_,v=0,w=u,E=0;for(;v<=w;)if(E=Math.floor((v+w)/2),f=c[E],_=c[E+1],f<=s){if(E===u||s<_)return E;v=E+1}else{if(!(f>s))throw new li("Input is not a number.");w=E-1}return 0}class Ds{constructor(s,u,f){this.type=s,this.input=u,this.labels=[],this.outputs=[];for(const[_,v]of f)this.labels.push(_),this.outputs.push(v)}static parse(s,u){if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(s[1],1,Ke);if(!f)return null;const _=[];let v=null;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);for(let w=1;w<s.length;w+=2){const E=w===1?-1/0:s[w],C=s[w+1],k=w,F=w+1;if(typeof E!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(_.length&&_[_.length-1][0]>=E)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const L=u.parse(C,F,v);if(!L)return null;v=v||L.type,_.push([E,L])}return new Ds(v,f,_)}evaluate(s){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);const _=this.input.evaluate(s);if(_<=u[0])return f[0].evaluate(s);const v=u.length;return _>=u[v-1]?f[v-1].evaluate(s):f[ko(u,_)].evaluate(s)}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function zt(c,s,u){return c+u*(s-c)}function xl(c,s,u){return c.map((f,_)=>zt(f,s[_],u))}const ln={number:zt,color:function(c,s,u,f="rgb"){switch(f){case"rgb":{const[_,v,w,E]=xl(c.rgb,s.rgb,u);return new Dt(_,v,w,E,!1)}case"hcl":{const[_,v,w,E]=c.hcl,[C,k,F,L]=s.hcl;let U,W;if(isNaN(_)||isNaN(C))isNaN(_)?isNaN(C)?U=NaN:(U=C,w!==1&&w!==0||(W=k)):(U=_,F!==1&&F!==0||(W=v));else{let ve=C-_;C>_&&ve>180?ve-=360:C<_&&_-C>180&&(ve+=360),U=_+u*ve}const[q,Q,ae,de]=function([ve,ge,we,Pe]){return ve=isNaN(ve)?0:ve*Et,Kt([we,Math.cos(ve)*ge,Math.sin(ve)*ge,Pe])}([U,W??zt(v,k,u),zt(w,F,u),zt(E,L,u)]);return new Dt(q,Q,ae,de,!1)}case"lab":{const[_,v,w,E]=Kt(xl(c.lab,s.lab,u));return new Dt(_,v,w,E,!1)}}},array:xl,padding:function(c,s,u){return new xr(xl(c.values,s.values,u))},variableAnchorOffsetCollection:function(c,s,u){const f=c.values,_=s.values;if(f.length!==_.length)throw new li(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${s.toString()}`);const v=[];for(let w=0;w<f.length;w+=2){if(f[w]!==_[w])throw new li(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${_[w]}`);v.push(f[w]);const[E,C]=f[w+1],[k,F]=_[w+1];v.push([zt(E,k,u),zt(C,F,u)])}return new ur(v)}};class cn{constructor(s,u,f,_,v){this.type=s,this.operator=u,this.interpolation=f,this.input=_,this.labels=[],this.outputs=[];for(const[w,E]of v)this.labels.push(w),this.outputs.push(E)}static interpolationFactor(s,u,f,_){let v=0;if(s.name==="exponential")v=jc(u,s.base,f,_);else if(s.name==="linear")v=jc(u,1,f,_);else if(s.name==="cubic-bezier"){const w=s.controlPoints;v=new j(w[0],w[1],w[2],w[3]).solve(jc(u,1,f,_))}return v}static parse(s,u){let[f,_,v,...w]=s;if(!Array.isArray(_)||_.length===0)return u.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const k=_[1];if(typeof k!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:k}}else{if(_[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const k=_.slice(1);if(k.length!==4||k.some(F=>typeof F!="number"||F<0||F>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:k}}}if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(v=u.parse(v,2,Ke),!v)return null;const E=[];let C=null;f==="interpolate-hcl"||f==="interpolate-lab"?C=cr:u.expectedType&&u.expectedType.kind!=="value"&&(C=u.expectedType);for(let k=0;k<w.length;k+=2){const F=w[k],L=w[k+1],U=k+3,W=k+4;if(typeof F!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(E.length&&E[E.length-1][0]>=F)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const q=u.parse(L,W,C);if(!q)return null;C=C||q.type,E.push([F,q])}return De(C,Ke)||De(C,cr)||De(C,z)||De(C,Y)||De(C,oe(Ke))?new cn(C,f,_,v,E):u.error(`Type ${le(C)} is not interpolatable.`)}evaluate(s){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);const _=this.input.evaluate(s);if(_<=u[0])return f[0].evaluate(s);const v=u.length;if(_>=u[v-1])return f[v-1].evaluate(s);const w=ko(u,_),E=cn.interpolationFactor(this.interpolation,_,u[w],u[w+1]),C=f[w].evaluate(s),k=f[w+1].evaluate(s);switch(this.operator){case"interpolate":return ln[this.type.kind](C,k,E);case"interpolate-hcl":return ln.color(C,k,E,"hcl");case"interpolate-lab":return ln.color(C,k,E,"lab")}}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function jc(c,s,u,f){const _=f-u,v=c-u;return _===0?0:s===1?v/_:(Math.pow(s,v)-1)/(Math.pow(s,_)-1)}class vl{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expectected at least one argument.");let f=null;const _=u.expectedType;_&&_.kind!=="value"&&(f=_);const v=[];for(const E of s.slice(1)){const C=u.parse(E,1+v.length,f,void 0,{typeAnnotation:"omit"});if(!C)return null;f=f||C.type,v.push(C)}if(!f)throw new Error("No output type");const w=_&&v.some(E=>_e(_,E.type));return new vl(w?It:f,v)}evaluate(s){let u,f=null,_=0;for(const v of this.args)if(_++,f=v.evaluate(s),f&&f instanceof ri&&!f.available&&(u||(u=f.name),f=null,_===this.args.length&&(f=u)),f!==null)break;return f}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class bl{constructor(s,u){this.type=u.type,this.bindings=[].concat(s),this.result=u}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const u of this.bindings)s(u[1]);s(this.result)}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const f=[];for(let v=1;v<s.length-1;v+=2){const w=s[v];if(typeof w!="string")return u.error(`Expected string, but found ${typeof w} instead.`,v);if(/[^a-zA-Z0-9_]/.test(w))return u.error("Variable names must contain only alphanumeric characters or '_'.",v);const E=u.parse(s[v+1],v+1);if(!E)return null;f.push([w,E])}const _=u.parse(s[s.length-1],s.length-1,u.expectedType,f);return _?new bl(f,_):null}outputDefined(){return this.result.outputDefined()}}class Wc{constructor(s,u,f){this.type=s,this.index=u,this.input=f}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,Ke),_=u.parse(s[2],2,oe(u.expectedType||It));return f&&_?new Wc(_.type.itemType,f,_):null}evaluate(s){const u=this.index.evaluate(s),f=this.input.evaluate(s);if(u<0)throw new li(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new li(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new li(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class Hc{constructor(s,u){this.type=At,this.needle=s,this.haystack=u}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,It),_=u.parse(s[2],2,It);return f&&_?he(f.type,[At,Pt,Ke,zn,It])?new Hc(f,_):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${le(f.type)} instead`):null}evaluate(s){const u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!f)return!1;if(!ye(u,["boolean","string","number","null"]))throw new li(`Expected first argument to be of type boolean, string, number or null, but found ${le(ai(u))} instead.`);if(!ye(f,["string","array"]))throw new li(`Expected second argument to be of type array or string, but found ${le(ai(f))} instead.`);return f.indexOf(u)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class wl{constructor(s,u,f){this.type=Ke,this.needle=s,this.haystack=u,this.fromIndex=f}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,It),_=u.parse(s[2],2,It);if(!f||!_)return null;if(!he(f.type,[At,Pt,Ke,zn,It]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${le(f.type)} instead`);if(s.length===4){const v=u.parse(s[3],3,Ke);return v?new wl(f,_,v):null}return new wl(f,_)}evaluate(s){const u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!ye(u,["boolean","string","number","null"]))throw new li(`Expected first argument to be of type boolean, string, number or null, but found ${le(ai(u))} instead.`);if(!ye(f,["string","array"]))throw new li(`Expected second argument to be of type array or string, but found ${le(ai(f))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(s);return f.indexOf(u,_)}return f.indexOf(u)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class qc{constructor(s,u,f,_,v,w){this.inputType=s,this.type=u,this.input=f,this.cases=_,this.outputs=v,this.otherwise=w}static parse(s,u){if(s.length<5)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return u.error("Expected an even number of arguments.");let f,_;u.expectedType&&u.expectedType.kind!=="value"&&(_=u.expectedType);const v={},w=[];for(let k=2;k<s.length-1;k+=2){let F=s[k];const L=s[k+1];Array.isArray(F)||(F=[F]);const U=u.concat(k);if(F.length===0)return U.error("Expected at least one branch label.");for(const q of F){if(typeof q!="number"&&typeof q!="string")return U.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return U.error("Numeric branch labels must be integer values.");if(f){if(U.checkSubtype(f,ai(q)))return null}else f=ai(q);if(v[String(q)]!==void 0)return U.error("Branch labels must be unique.");v[String(q)]=w.length}const W=u.parse(L,k,_);if(!W)return null;_=_||W.type,w.push(W)}const E=u.parse(s[1],1,It);if(!E)return null;const C=u.parse(s[s.length-1],s.length-1,_);return C?E.type.kind!=="value"&&u.concat(1).checkSubtype(f,E.type)?null:new qc(f,_,E,v,w,C):null}evaluate(s){const u=this.input.evaluate(s);return(ai(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class Xc{constructor(s,u,f){this.type=s,this.branches=u,this.otherwise=f}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const _=[];for(let w=1;w<s.length-1;w+=2){const E=u.parse(s[w],w,At);if(!E)return null;const C=u.parse(s[w+1],w+1,f);if(!C)return null;_.push([E,C]),f=f||C.type}const v=u.parse(s[s.length-1],s.length-1,f);if(!v)return null;if(!f)throw new Error("Can't infer output type");return new Xc(f,_,v)}evaluate(s){for(const[u,f]of this.branches)if(u.evaluate(s))return f.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[u,f]of this.branches)s(u),s(f);s(this.otherwise)}outputDefined(){return this.branches.every(([s,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class Tl{constructor(s,u,f,_){this.type=s,this.input=u,this.beginIndex=f,this.endIndex=_}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,It),_=u.parse(s[2],2,Ke);if(!f||!_)return null;if(!he(f.type,[oe(It),Pt,It]))return u.error(`Expected first argument to be of type array or string, but found ${le(f.type)} instead`);if(s.length===4){const v=u.parse(s[3],3,Ke);return v?new Tl(f.type,f,_,v):null}return new Tl(f.type,f,_)}evaluate(s){const u=this.input.evaluate(s),f=this.beginIndex.evaluate(s);if(!ye(u,["string","array"]))throw new li(`Expected first argument to be of type array or string, but found ${le(ai(u))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(s);return u.slice(f,_)}return u.slice(f)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Jh(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Qh(c,s,u,f){return f.compare(s,u)===0}function Oo(c,s,u){const f=c!=="=="&&c!=="!=";return class tT{constructor(v,w,E){this.type=At,this.lhs=v,this.rhs=w,this.collator=E,this.hasUntypedArgument=v.type.kind==="value"||w.type.kind==="value"}static parse(v,w){if(v.length!==3&&v.length!==4)return w.error("Expected two or three arguments.");const E=v[0];let C=w.parse(v[1],1,It);if(!C)return null;if(!Jh(E,C.type))return w.concat(1).error(`"${E}" comparisons are not supported for type '${le(C.type)}'.`);let k=w.parse(v[2],2,It);if(!k)return null;if(!Jh(E,k.type))return w.concat(2).error(`"${E}" comparisons are not supported for type '${le(k.type)}'.`);if(C.type.kind!==k.type.kind&&C.type.kind!=="value"&&k.type.kind!=="value")return w.error(`Cannot compare types '${le(C.type)}' and '${le(k.type)}'.`);f&&(C.type.kind==="value"&&k.type.kind!=="value"?C=new Ur(k.type,[C]):C.type.kind!=="value"&&k.type.kind==="value"&&(k=new Ur(C.type,[k])));let F=null;if(v.length===4){if(C.type.kind!=="string"&&k.type.kind!=="string"&&C.type.kind!=="value"&&k.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(F=w.parse(v[3],3,sn),!F)return null}return new tT(C,k,F)}evaluate(v){const w=this.lhs.evaluate(v),E=this.rhs.evaluate(v);if(f&&this.hasUntypedArgument){const C=ai(w),k=ai(E);if(C.kind!==k.kind||C.kind!=="string"&&C.kind!=="number")throw new li(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${C.kind}, ${k.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const C=ai(w),k=ai(E);if(C.kind!=="string"||k.kind!=="string")return s(v,w,E)}return this.collator?u(v,w,E,this.collator.evaluate(v)):s(v,w,E)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const pg=Oo("==",function(c,s,u){return s===u},Qh),gg=Oo("!=",function(c,s,u){return s!==u},function(c,s,u,f){return!Qh(0,s,u,f)}),_g=Oo("<",function(c,s,u){return s<u},function(c,s,u,f){return f.compare(s,u)<0}),mg=Oo(">",function(c,s,u){return s>u},function(c,s,u,f){return f.compare(s,u)>0}),yg=Oo("<=",function(c,s,u){return s<=u},function(c,s,u,f){return f.compare(s,u)<=0}),xg=Oo(">=",function(c,s,u){return s>=u},function(c,s,u,f){return f.compare(s,u)>=0});class Zc{constructor(s,u,f,_,v){this.type=Pt,this.number=s,this.locale=u,this.currency=f,this.minFractionDigits=_,this.maxFractionDigits=v}static parse(s,u){if(s.length!==3)return u.error("Expected two arguments.");const f=u.parse(s[1],1,Ke);if(!f)return null;const _=s[2];if(typeof _!="object"||Array.isArray(_))return u.error("NumberFormat options argument must be an object.");let v=null;if(_.locale&&(v=u.parse(_.locale,1,Pt),!v))return null;let w=null;if(_.currency&&(w=u.parse(_.currency,1,Pt),!w))return null;let E=null;if(_["min-fraction-digits"]&&(E=u.parse(_["min-fraction-digits"],1,Ke),!E))return null;let C=null;return _["max-fraction-digits"]&&(C=u.parse(_["max-fraction-digits"],1,Ke),!C)?null:new Zc(f,v,w,E,C)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Sl{constructor(s){this.type=ne,this.sections=s}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const f=s[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const _=[];let v=!1;for(let w=1;w<=s.length-1;++w){const E=s[w];if(v&&typeof E=="object"&&!Array.isArray(E)){v=!1;let C=null;if(E["font-scale"]&&(C=u.parse(E["font-scale"],1,Ke),!C))return null;let k=null;if(E["text-font"]&&(k=u.parse(E["text-font"],1,oe(Pt)),!k))return null;let F=null;if(E["text-color"]&&(F=u.parse(E["text-color"],1,cr),!F))return null;const L=_[_.length-1];L.scale=C,L.font=k,L.textColor=F}else{const C=u.parse(s[w],1,It);if(!C)return null;const k=C.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,_.push({content:C,scale:null,font:null,textColor:null})}}return new Sl(_)}evaluate(s){return new di(this.sections.map(u=>{const f=u.content.evaluate(s);return ai(f)===V?new Ar("",f,null,null,null):new Ar($t(f),null,u.scale?u.scale.evaluate(s):null,u.font?u.font.evaluate(s).join(","):null,u.textColor?u.textColor.evaluate(s):null)}))}eachChild(s){for(const u of this.sections)s(u.content),u.scale&&s(u.scale),u.font&&s(u.font),u.textColor&&s(u.textColor)}outputDefined(){return!1}}class Yc{constructor(s){this.type=V,this.input=s}static parse(s,u){if(s.length!==2)return u.error("Expected two arguments.");const f=u.parse(s[1],1,Pt);return f?new Yc(f):u.error("No image name provided.")}evaluate(s){const u=this.input.evaluate(s),f=ri.fromString(u);return f&&s.availableImages&&(f.available=s.availableImages.indexOf(u)>-1),f}eachChild(s){s(this.input)}outputDefined(){return!1}}class Kc{constructor(s){this.type=Ke,this.input=s}static parse(s,u){if(s.length!==2)return u.error(`Expected 1 argument, but found ${s.length-1} instead.`);const f=u.parse(s[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${le(f.type)} instead.`):new Kc(f):null}evaluate(s){const u=this.input.evaluate(s);if(typeof u=="string"||Array.isArray(u))return u.length;throw new li(`Expected value to be of type string or array, but found ${le(ai(u))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const Fo={"==":pg,"!=":gg,">":mg,"<":_g,">=":xg,"<=":yg,array:Ur,at:Wc,boolean:Ur,case:Xc,coalesce:vl,collator:X,format:Sl,image:Yc,in:Hc,"index-of":wl,interpolate:cn,"interpolate-hcl":cn,"interpolate-lab":cn,length:Kc,let:bl,literal:Un,match:qc,number:Ur,"number-format":Zc,object:Ur,slice:Tl,step:Ds,string:Ur,"to-boolean":In,"to-color":In,"to-number":In,"to-string":In,var:gl,within:ro};function ed(c,[s,u,f,_]){s=s.evaluate(c),u=u.evaluate(c),f=f.evaluate(c);const v=_?_.evaluate(c):1,w=gs(s,u,f,v);if(w)throw new li(w);return new Dt(s/255,u/255,f/255,v,!1)}function td(c,s){return c in s}function Gc(c,s){const u=s[c];return u===void 0?null:u}function no(c){return{type:c}}function id(c){return{result:"success",value:c}}function Ns(c){return{result:"error",value:c}}function Do(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function rd(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Jc(c){return!!c.expression&&c.expression.interpolated}function Xt(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Si(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function vg(c){return c}function Ut(c,s){const u=s.type==="color",f=c.stops&&typeof c.stops[0][0]=="object",_=f||!(f||c.property!==void 0),v=c.type||(Jc(s)?"exponential":"interval");if(u||s.type==="padding"){const F=u?Dt.parse:xr.parse;(c=Pn({},c)).stops&&(c.stops=c.stops.map(L=>[L[0],F(L[1])])),c.default=F(c.default?c.default:s.default)}if(c.colorSpace&&(w=c.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var w;let E,C,k;if(v==="exponential")E=Sa;else if(v==="interval")E=vi;else if(v==="categorical"){E=Ei,C=Object.create(null);for(const F of c.stops)C[F[0]]=F[1];k=typeof c.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);E=nd}if(f){const F={},L=[];for(let q=0;q<c.stops.length;q++){const Q=c.stops[q],ae=Q[0].zoom;F[ae]===void 0&&(F[ae]={zoom:ae,type:c.type,property:c.property,default:c.default,stops:[]},L.push(ae)),F[ae].stops.push([Q[0].value,Q[1]])}const U=[];for(const q of L)U.push([F[q].zoom,Ut(F[q],s)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:cn.interpolationFactor.bind(void 0,W),zoomStops:U.map(q=>q[0]),evaluate:({zoom:q},Q)=>Sa({stops:U,base:c.base},s,q).evaluate(q,Q)}}if(_){const F=v==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:cn.interpolationFactor.bind(void 0,F),zoomStops:c.stops.map(L=>L[0]),evaluate:({zoom:L})=>E(c,s,L,C,k)}}return{kind:"source",evaluate(F,L){const U=L&&L.properties?L.properties[c.property]:void 0;return U===void 0?so(c.default,s.default):E(c,s,U,C,k)}}}function so(c,s,u){return c!==void 0?c:s!==void 0?s:u!==void 0?u:void 0}function Ei(c,s,u,f,_){return so(typeof u===_?f[u]:void 0,c.default,s.default)}function vi(c,s,u){if(Xt(u)!=="number")return so(c.default,s.default);const f=c.stops.length;if(f===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[f-1][0])return c.stops[f-1][1];const _=ko(c.stops.map(v=>v[0]),u);return c.stops[_][1]}function Sa(c,s,u){const f=c.base!==void 0?c.base:1;if(Xt(u)!=="number")return so(c.default,s.default);const _=c.stops.length;if(_===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[_-1][0])return c.stops[_-1][1];const v=ko(c.stops.map(F=>F[0]),u),w=function(F,L,U,W){const q=W-U,Q=F-U;return q===0?0:L===1?Q/q:(Math.pow(L,Q)-1)/(Math.pow(L,q)-1)}(u,f,c.stops[v][0],c.stops[v+1][0]),E=c.stops[v][1],C=c.stops[v+1][1],k=ln[s.type]||vg;return typeof E.evaluate=="function"?{evaluate(...F){const L=E.evaluate.apply(void 0,F),U=C.evaluate.apply(void 0,F);if(L!==void 0&&U!==void 0)return k(L,U,w,c.colorSpace)}}:k(E,C,w,c.colorSpace)}function nd(c,s,u){switch(s.type){case"color":u=Dt.parse(u);break;case"formatted":u=di.fromString(u.toString());break;case"resolvedImage":u=ri.fromString(u.toString());break;case"padding":u=xr.parse(u);break;default:Xt(u)===s.type||s.type==="enum"&&s.values[u]||(u=void 0)}return so(u,c.default,s.default)}Cn.register(Fo,{error:[{kind:"error"},[Pt],(c,[s])=>{throw new li(s.evaluate(c))}],typeof:[Pt,[It],(c,[s])=>le(ai(s.evaluate(c)))],"to-rgba":[oe(Ke,4),[cr],(c,[s])=>{const[u,f,_,v]=s.evaluate(c).rgb;return[255*u,255*f,255*_,v]}],rgb:[cr,[Ke,Ke,Ke],ed],rgba:[cr,[Ke,Ke,Ke,Ke],ed],has:{type:At,overloads:[[[Pt],(c,[s])=>td(s.evaluate(c),c.properties())],[[Pt,nn],(c,[s,u])=>td(s.evaluate(c),u.evaluate(c))]]},get:{type:It,overloads:[[[Pt],(c,[s])=>Gc(s.evaluate(c),c.properties())],[[Pt,nn],(c,[s,u])=>Gc(s.evaluate(c),u.evaluate(c))]]},"feature-state":[It,[Pt],(c,[s])=>Gc(s.evaluate(c),c.featureState||{})],properties:[nn,[],c=>c.properties()],"geometry-type":[Pt,[],c=>c.geometryType()],id:[It,[],c=>c.id()],zoom:[Ke,[],c=>c.globals.zoom],"heatmap-density":[Ke,[],c=>c.globals.heatmapDensity||0],"line-progress":[Ke,[],c=>c.globals.lineProgress||0],accumulated:[It,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Ke,no(Ke),(c,s)=>{let u=0;for(const f of s)u+=f.evaluate(c);return u}],"*":[Ke,no(Ke),(c,s)=>{let u=1;for(const f of s)u*=f.evaluate(c);return u}],"-":{type:Ke,overloads:[[[Ke,Ke],(c,[s,u])=>s.evaluate(c)-u.evaluate(c)],[[Ke],(c,[s])=>-s.evaluate(c)]]},"/":[Ke,[Ke,Ke],(c,[s,u])=>s.evaluate(c)/u.evaluate(c)],"%":[Ke,[Ke,Ke],(c,[s,u])=>s.evaluate(c)%u.evaluate(c)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(c,[s,u])=>Math.pow(s.evaluate(c),u.evaluate(c))],sqrt:[Ke,[Ke],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[Ke,[Ke],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[Ke,[Ke],(c,[s])=>Math.log(s.evaluate(c))],log2:[Ke,[Ke],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[Ke,[Ke],(c,[s])=>Math.sin(s.evaluate(c))],cos:[Ke,[Ke],(c,[s])=>Math.cos(s.evaluate(c))],tan:[Ke,[Ke],(c,[s])=>Math.tan(s.evaluate(c))],asin:[Ke,[Ke],(c,[s])=>Math.asin(s.evaluate(c))],acos:[Ke,[Ke],(c,[s])=>Math.acos(s.evaluate(c))],atan:[Ke,[Ke],(c,[s])=>Math.atan(s.evaluate(c))],min:[Ke,no(Ke),(c,s)=>Math.min(...s.map(u=>u.evaluate(c)))],max:[Ke,no(Ke),(c,s)=>Math.max(...s.map(u=>u.evaluate(c)))],abs:[Ke,[Ke],(c,[s])=>Math.abs(s.evaluate(c))],round:[Ke,[Ke],(c,[s])=>{const u=s.evaluate(c);return u<0?-Math.round(-u):Math.round(u)}],floor:[Ke,[Ke],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[Ke,[Ke],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[At,[Pt,It],(c,[s,u])=>c.properties()[s.value]===u.value],"filter-id-==":[At,[It],(c,[s])=>c.id()===s.value],"filter-type-==":[At,[Pt],(c,[s])=>c.geometryType()===s.value],"filter-<":[At,[Pt,It],(c,[s,u])=>{const f=c.properties()[s.value],_=u.value;return typeof f==typeof _&&f<_}],"filter-id-<":[At,[It],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u<f}],"filter->":[At,[Pt,It],(c,[s,u])=>{const f=c.properties()[s.value],_=u.value;return typeof f==typeof _&&f>_}],"filter-id->":[At,[It],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u>f}],"filter-<=":[At,[Pt,It],(c,[s,u])=>{const f=c.properties()[s.value],_=u.value;return typeof f==typeof _&&f<=_}],"filter-id-<=":[At,[It],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u<=f}],"filter->=":[At,[Pt,It],(c,[s,u])=>{const f=c.properties()[s.value],_=u.value;return typeof f==typeof _&&f>=_}],"filter-id->=":[At,[It],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u>=f}],"filter-has":[At,[It],(c,[s])=>s.value in c.properties()],"filter-has-id":[At,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[At,[oe(Pt)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[At,[oe(It)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[At,[Pt,oe(It)],(c,[s,u])=>u.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[At,[Pt,oe(It)],(c,[s,u])=>function(f,_,v,w){for(;v<=w;){const E=v+w>>1;if(_[E]===f)return!0;_[E]>f?w=E-1:v=E+1}return!1}(c.properties()[s.value],u.value,0,u.value.length-1)],all:{type:At,overloads:[[[At,At],(c,[s,u])=>s.evaluate(c)&&u.evaluate(c)],[no(At),(c,s)=>{for(const u of s)if(!u.evaluate(c))return!1;return!0}]]},any:{type:At,overloads:[[[At,At],(c,[s,u])=>s.evaluate(c)||u.evaluate(c)],[no(At),(c,s)=>{for(const u of s)if(u.evaluate(c))return!0;return!1}]]},"!":[At,[At],(c,[s])=>!s.evaluate(c)],"is-supported-script":[At,[Pt],(c,[s])=>{const u=c.globals&&c.globals.isSupportedScript;return!u||u(s.evaluate(c))}],upcase:[Pt,[Pt],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[Pt,[Pt],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[Pt,no(It),(c,s)=>s.map(u=>$t(u.evaluate(c))).join("")],"resolved-locale":[Pt,[sn],(c,[s])=>s.evaluate(c).resolvedLocale()]});class Qc{constructor(s,u){var f;this.expression=s,this._warningHistory={},this._evaluator=new wa,this._defaultValue=u?(f=u).type==="color"&&Si(f.default)?new Dt(0,0,0,0):f.type==="color"?Dt.parse(f.default)||null:f.type==="padding"?xr.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?ur.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(s,u,f,_,v,w){return this._evaluator.globals=s,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=_,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(s,u,f,_,v,w){this._evaluator.globals=s,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=_,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new li(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function El(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Fo}function Al(c,s){const u=new Mo(Fo,_l,[],s?function(_){const v={color:cr,string:Pt,number:Ke,enum:Pt,boolean:At,formatted:ne,padding:z,resolvedImage:V,variableAnchorOffsetCollection:Y};return _.type==="array"?oe(v[_.value]||It,_.length):v[_.type]}(s):void 0),f=u.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?id(new Qc(f,s)):Ns(u.errors)}class eu{constructor(s,u){this.kind=s,this._styleExpression=u,this.isStateDependent=s!=="constant"&&!Ta(u.expression)}evaluateWithoutErrorHandling(s,u,f,_,v,w){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,_,v,w)}evaluate(s,u,f,_,v,w){return this._styleExpression.evaluate(s,u,f,_,v,w)}}class Pl{constructor(s,u,f,_){this.kind=s,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=s!=="camera"&&!Ta(u.expression),this.interpolationType=_}evaluateWithoutErrorHandling(s,u,f,_,v,w){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,_,v,w)}evaluate(s,u,f,_,v,w){return this._styleExpression.evaluate(s,u,f,_,v,w)}interpolationFactor(s,u,f){return this.interpolationType?cn.interpolationFactor(this.interpolationType,s,u,f):0}}function tu(c,s){const u=Al(c,s);if(u.result==="error")return u;const f=u.value.expression,_=ml(f);if(!_&&!Do(s))return Ns([new xi("","data expressions not supported")]);const v=yl(f,["zoom"]);if(!v&&!rd(s))return Ns([new xi("","zoom expressions not supported")]);const w=Aa(f);return w||v?w instanceof xi?Ns([w]):w instanceof cn&&!Jc(s)?Ns([new xi("",'"interpolate" expressions cannot be used with this property')]):id(w?new Pl(_?"camera":"composite",u.value,w.labels,w instanceof cn?w.interpolation:void 0):new eu(_?"constant":"source",u.value)):Ns([new xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ea{constructor(s,u){this._parameters=s,this._specification=u,Pn(this,Ut(this._parameters,this._specification))}static deserialize(s){return new Ea(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Aa(c){let s=null;if(c instanceof bl)s=Aa(c.result);else if(c instanceof vl){for(const u of c.args)if(s=Aa(u),s)break}else(c instanceof Ds||c instanceof cn)&&c.input instanceof Cn&&c.input.name==="zoom"&&(s=c);return s instanceof xi||c.eachChild(u=>{const f=Aa(u);f instanceof xi?s=f:!s&&f?s=new xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&f&&s!==f&&(s=new xi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function Pa(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!Pa(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const bg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function iu(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Pa(c)||(c=Il(c));const s=Al(c,bg);if(s.result==="error")throw new Error(s.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,_)=>s.value.evaluate(u,f,{},_),needGeometry:sd(c)}}function wg(c,s){return c<s?-1:c>s?1:0}function sd(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let s=1;s<c.length;s++)if(sd(c[s]))return!0;return!1}function Il(c){if(!c)return!0;const s=c[0];return c.length<=1?s!=="any":s==="=="?ru(c[1],c[2],"=="):s==="!="?Ia(ru(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?ru(c[1],c[2],s):s==="any"?(u=c.slice(1),["any"].concat(u.map(Il))):s==="all"?["all"].concat(c.slice(1).map(Il)):s==="none"?["all"].concat(c.slice(1).map(Il).map(Ia)):s==="in"?od(c[1],c.slice(2)):s==="!in"?Ia(od(c[1],c.slice(2))):s==="has"?ad(c[1]):s==="!has"?Ia(ad(c[1])):s!=="within"||c;var u}function ru(c,s,u){switch(c){case"$type":return[`filter-type-${u}`,s];case"$id":return[`filter-id-${u}`,s];default:return[`filter-${u}`,c,s]}}function od(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(u=>typeof u!=typeof s[0])?["filter-in-large",c,["literal",s.sort(wg)]]:["filter-in-small",c,["literal",s]]}}function ad(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Ia(c){return["!",c]}function Cl(c){const s=typeof c;if(s==="number"||s==="boolean"||s==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let _="[";for(const v of c)_+=`${Cl(v)},`;return`${_}]`}const u=Object.keys(c).sort();let f="{";for(let _=0;_<u.length;_++)f+=`${JSON.stringify(u[_])}:${Cl(c[u[_]])},`;return`${f}}`}function Rl(c){let s="";for(const u of ui)s+=`/${Cl(c[u])}`;return s}function ld(c){const s=c.value;return s?[new Ze(c.key,s,"constants have been deprecated as of v8")]:[]}function Ii(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function oo(c){if(Array.isArray(c))return c.map(oo);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const u in c)s[u]=oo(c[u]);return s}return Ii(c)}function Vr(c){const s=c.key,u=c.value,f=c.valueSpec||{},_=c.objectElementValidators||{},v=c.style,w=c.styleSpec,E=c.validateSpec;let C=[];const k=Xt(u);if(k!=="object")return[new Ze(s,u,`object expected, ${k} found`)];for(const F in u){const L=F.split(".")[0],U=f[L]||f["*"];let W;if(_[L])W=_[L];else if(f[L])W=E;else if(_["*"])W=_["*"];else{if(!f["*"]){C.push(new Ze(s,u[F],`unknown property "${F}"`));continue}W=E}C=C.concat(W({key:(s&&`${s}.`)+F,value:u[F],valueSpec:U,style:v,styleSpec:w,object:u,objectKey:F,validateSpec:E},u))}for(const F in f)_[F]||f[F].required&&f[F].default===void 0&&u[F]===void 0&&C.push(new Ze(s,u,`missing required property "${F}"`));return C}function No(c){const s=c.value,u=c.valueSpec,f=c.style,_=c.styleSpec,v=c.key,w=c.arrayElementValidator||c.validateSpec;if(Xt(s)!=="array")return[new Ze(v,s,`array expected, ${Xt(s)} found`)];if(u.length&&s.length!==u.length)return[new Ze(v,s,`array length ${u.length} expected, length ${s.length} found`)];if(u["min-length"]&&s.length<u["min-length"])return[new Ze(v,s,`array length at least ${u["min-length"]} expected, length ${s.length} found`)];let E={type:u.value,values:u.values};_.$version<7&&(E.function=u.function),Xt(u.value)==="object"&&(E=u.value);let C=[];for(let k=0;k<s.length;k++)C=C.concat(w({array:s,arrayIndex:k,value:s[k],valueSpec:E,validateSpec:c.validateSpec,style:f,styleSpec:_,key:`${v}[${k}]`}));return C}function Ca(c){const s=c.key,u=c.value,f=c.valueSpec;let _=Xt(u);return _==="number"&&u!=u&&(_="NaN"),_!=="number"?[new Ze(s,u,`number expected, ${_} found`)]:"minimum"in f&&u<f.minimum?[new Ze(s,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new Ze(s,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function Ml(c){const s=c.valueSpec,u=Ii(c.value.type);let f,_,v,w={};const E=u!=="categorical"&&c.value.property===void 0,C=!E,k=Xt(c.value.stops)==="array"&&Xt(c.value.stops[0])==="array"&&Xt(c.value.stops[0][0])==="object",F=Vr({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(W){if(u==="identity")return[new Ze(W.key,W.value,'identity function may not have a "stops" property')];let q=[];const Q=W.value;return q=q.concat(No({key:W.key,value:Q,valueSpec:W.valueSpec,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:L})),Xt(Q)==="array"&&Q.length===0&&q.push(new Ze(W.key,Q,"array must have at least one stop")),q},default:function(W){return W.validateSpec({key:W.key,value:W.value,valueSpec:s,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec})}}});return u==="identity"&&E&&F.push(new Ze(c.key,c.value,'missing required property "property"')),u==="identity"||c.value.stops||F.push(new Ze(c.key,c.value,'missing required property "stops"')),u==="exponential"&&c.valueSpec.expression&&!Jc(c.valueSpec)&&F.push(new Ze(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(C&&!Do(c.valueSpec)?F.push(new Ze(c.key,c.value,"property functions not supported")):E&&!rd(c.valueSpec)&&F.push(new Ze(c.key,c.value,"zoom functions not supported"))),u!=="categorical"&&!k||c.value.property!==void 0||F.push(new Ze(c.key,c.value,'"property" property is required')),F;function L(W){let q=[];const Q=W.value,ae=W.key;if(Xt(Q)!=="array")return[new Ze(ae,Q,`array expected, ${Xt(Q)} found`)];if(Q.length!==2)return[new Ze(ae,Q,`array length 2 expected, length ${Q.length} found`)];if(k){if(Xt(Q[0])!=="object")return[new Ze(ae,Q,`object expected, ${Xt(Q[0])} found`)];if(Q[0].zoom===void 0)return[new Ze(ae,Q,"object stop key must have zoom")];if(Q[0].value===void 0)return[new Ze(ae,Q,"object stop key must have value")];if(v&&v>Ii(Q[0].zoom))return[new Ze(ae,Q[0].zoom,"stop zoom values must appear in ascending order")];Ii(Q[0].zoom)!==v&&(v=Ii(Q[0].zoom),_=void 0,w={}),q=q.concat(Vr({key:`${ae}[0]`,value:Q[0],valueSpec:{zoom:{}},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Ca,value:U}}))}else q=q.concat(U({key:`${ae}[0]`,value:Q[0],valueSpec:{},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec},Q));return El(oo(Q[1]))?q.concat([new Ze(`${ae}[1]`,Q[1],"expressions are not allowed in function stops.")]):q.concat(W.validateSpec({key:`${ae}[1]`,value:Q[1],valueSpec:s,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec}))}function U(W,q){const Q=Xt(W.value),ae=Ii(W.value),de=W.value!==null?W.value:q;if(f){if(Q!==f)return[new Ze(W.key,de,`${Q} stop domain type must match previous stop domain type ${f}`)]}else f=Q;if(Q!=="number"&&Q!=="string"&&Q!=="boolean")return[new Ze(W.key,de,"stop domain value must be a number, string, or boolean")];if(Q!=="number"&&u!=="categorical"){let ve=`number expected, ${Q} found`;return Do(s)&&u===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ze(W.key,de,ve)]}return u!=="categorical"||Q!=="number"||isFinite(ae)&&Math.floor(ae)===ae?u!=="categorical"&&Q==="number"&&_!==void 0&&ae<_?[new Ze(W.key,de,"stop domain values must appear in ascending order")]:(_=ae,u==="categorical"&&ae in w?[new Ze(W.key,de,"stop domain values must be unique")]:(w[ae]=!0,[])):[new Ze(W.key,de,`integer expected, found ${ae}`)]}}function ao(c){const s=(c.expressionContext==="property"?tu:Al)(oo(c.value),c.valueSpec);if(s.result==="error")return s.value.map(f=>new Ze(`${c.key}${f.key}`,c.value,f.message));const u=s.value.expression||s.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!u.outputDefined())return[new Ze(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Ta(u))return[new Ze(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Ta(u))return[new Ze(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!yl(u,["zoom","feature-state"]))return[new Ze(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!ml(u))return[new Ze(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ra(c){const s=c.key,u=c.value,f=c.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(Ii(u))===-1&&_.push(new Ze(s,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(Ii(u))===-1&&_.push(new Ze(s,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),_}function Lo(c){return Pa(oo(c.value))?ao(Pn({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):cd(c)}function cd(c){const s=c.value,u=c.key;if(Xt(s)!=="array")return[new Ze(u,s,`array expected, ${Xt(s)} found`)];const f=c.styleSpec;let _,v=[];if(s.length<1)return[new Ze(u,s,"filter array must have at least 1 element")];switch(v=v.concat(Ra({key:`${u}[0]`,value:s[0],valueSpec:f.filter_operator,style:c.style,styleSpec:c.styleSpec})),Ii(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&Ii(s[1])==="$type"&&v.push(new Ze(u,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&v.push(new Ze(u,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(_=Xt(s[1]),_!=="string"&&v.push(new Ze(`${u}[1]`,s[1],`string expected, ${_} found`)));for(let w=2;w<s.length;w++)_=Xt(s[w]),Ii(s[1])==="$type"?v=v.concat(Ra({key:`${u}[${w}]`,value:s[w],valueSpec:f.geometry_type,style:c.style,styleSpec:c.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&v.push(new Ze(`${u}[${w}]`,s[w],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let w=1;w<s.length;w++)v=v.concat(cd({key:`${u}[${w}]`,value:s[w],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":_=Xt(s[1]),s.length!==2?v.push(new Ze(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):_!=="string"&&v.push(new Ze(`${u}[1]`,s[1],`string expected, ${_} found`));break;case"within":_=Xt(s[1]),s.length!==2?v.push(new Ze(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):_!=="object"&&v.push(new Ze(`${u}[1]`,s[1],`object expected, ${_} found`))}return v}function ud(c,s){const u=c.key,f=c.validateSpec,_=c.style,v=c.styleSpec,w=c.value,E=c.objectKey,C=v[`${s}_${c.layerType}`];if(!C)return[];const k=E.match(/^(.*)-transition$/);if(s==="paint"&&k&&C[k[1]]&&C[k[1]].transition)return f({key:u,value:w,valueSpec:v.transition,style:_,styleSpec:v});const F=c.valueSpec||C[E];if(!F)return[new Ze(u,w,`unknown property "${E}"`)];let L;if(Xt(w)==="string"&&Do(F)&&!F.tokens&&(L=/^{([^}]+)}$/.exec(w)))return[new Ze(u,w,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const U=[];return c.layerType==="symbol"&&(E==="text-field"&&_&&!_.glyphs&&U.push(new Ze(u,w,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&Si(oo(w))&&Ii(w.type)==="identity"&&U.push(new Ze(u,w,'"text-font" does not support identity functions'))),U.concat(f({key:c.key,value:w,valueSpec:F,style:_,styleSpec:v,expressionContext:"property",propertyType:s,propertyKey:E}))}function hd(c){return ud(c,"paint")}function dd(c){return ud(c,"layout")}function fd(c){let s=[];const u=c.value,f=c.key,_=c.style,v=c.styleSpec;u.type||u.ref||s.push(new Ze(f,u,'either "type" or "ref" is required'));let w=Ii(u.type);const E=Ii(u.ref);if(u.id){const C=Ii(u.id);for(let k=0;k<c.arrayIndex;k++){const F=_.layers[k];Ii(F.id)===C&&s.push(new Ze(f,u.id,`duplicate layer id "${u.id}", previously used at line ${F.id.__line__}`))}}if("ref"in u){let C;["type","source","source-layer","filter","layout"].forEach(k=>{k in u&&s.push(new Ze(f,u[k],`"${k}" is prohibited for ref layers`))}),_.layers.forEach(k=>{Ii(k.id)===E&&(C=k)}),C?C.ref?s.push(new Ze(f,u.ref,"ref cannot reference another ref layer")):w=Ii(C.type):s.push(new Ze(f,u.ref,`ref layer "${E}" not found`))}else if(w!=="background")if(u.source){const C=_.sources&&_.sources[u.source],k=C&&Ii(C.type);C?k==="vector"&&w==="raster"?s.push(new Ze(f,u.source,`layer "${u.id}" requires a raster source`)):k!=="raster-dem"&&w==="hillshade"?s.push(new Ze(f,u.source,`layer "${u.id}" requires a raster-dem source`)):k==="raster"&&w!=="raster"?s.push(new Ze(f,u.source,`layer "${u.id}" requires a vector source`)):k!=="vector"||u["source-layer"]?k==="raster-dem"&&w!=="hillshade"?s.push(new Ze(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!u.paint||!u.paint["line-gradient"]||k==="geojson"&&C.lineMetrics||s.push(new Ze(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new Ze(f,u,`layer "${u.id}" must specify a "source-layer"`)):s.push(new Ze(f,u.source,`source "${u.source}" not found`))}else s.push(new Ze(f,u,'missing required property "source"'));return s=s.concat(Vr({key:f,value:u,valueSpec:v.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${f}.type`,value:u.type,valueSpec:v.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:u,objectKey:"type"}),filter:Lo,layout:C=>Vr({layer:u,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":k=>dd(Pn({layerType:w},k))}}),paint:C=>Vr({layer:u,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":k=>hd(Pn({layerType:w},k))}})}})),s}function Gn(c){const s=c.value,u=c.key,f=Xt(s);return f!=="string"?[new Ze(u,s,`string expected, ${f} found`)]:[]}const Ma={promoteId:function({key:c,value:s}){if(Xt(s)==="string")return Gn({key:c,value:s});{const u=[];for(const f in s)u.push(...Gn({key:`${c}.${f}`,value:s[f]}));return u}}};function un(c){const s=c.value,u=c.key,f=c.styleSpec,_=c.style,v=c.validateSpec;if(!s.type)return[new Ze(u,s,'"type" is required')];const w=Ii(s.type);let E;switch(w){case"vector":case"raster":return E=Vr({key:u,value:s,valueSpec:f[`source_${w.replace("-","_")}`],style:c.style,styleSpec:f,objectElementValidators:Ma,validateSpec:v}),E;case"raster-dem":return E=function(C){var k;const F=(k=C.sourceName)!==null&&k!==void 0?k:"",L=C.value,U=C.styleSpec,W=U.source_raster_dem,q=C.style;let Q=[];const ae=Xt(L);if(L===void 0)return Q;if(ae!=="object")return Q.push(new Ze("source_raster_dem",L,`object expected, ${ae} found`)),Q;const de=Ii(L.encoding)==="custom",ve=["redFactor","greenFactor","blueFactor","baseShift"],ge=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const we in L)!de&&ve.includes(we)?Q.push(new Ze(we,L[we],`In "${F}": "${we}" is only valid when "encoding" is set to "custom". ${ge} encoding found`)):W[we]?Q=Q.concat(C.validateSpec({key:we,value:L[we],valueSpec:W[we],validateSpec:C.validateSpec,style:q,styleSpec:U})):Q.push(new Ze(we,L[we],`unknown property "${we}"`));return Q}({sourceName:u,value:s,style:c.style,styleSpec:f,validateSpec:v}),E;case"geojson":if(E=Vr({key:u,value:s,valueSpec:f.source_geojson,style:_,styleSpec:f,validateSpec:v,objectElementValidators:Ma}),s.cluster)for(const C in s.clusterProperties){const[k,F]=s.clusterProperties[C],L=typeof k=="string"?[k,["accumulated"],["get",C]]:k;E.push(...ao({key:`${u}.${C}.map`,value:F,validateSpec:v,expressionContext:"cluster-map"})),E.push(...ao({key:`${u}.${C}.reduce`,value:L,validateSpec:v,expressionContext:"cluster-reduce"}))}return E;case"video":return Vr({key:u,value:s,valueSpec:f.source_video,style:_,validateSpec:v,styleSpec:f});case"image":return Vr({key:u,value:s,valueSpec:f.source_image,style:_,validateSpec:v,styleSpec:f});case"canvas":return[new Ze(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ra({key:`${u}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:v,styleSpec:f})}}function ka(c){const s=c.value,u=c.styleSpec,f=u.light,_=c.style;let v=[];const w=Xt(s);if(s===void 0)return v;if(w!=="object")return v=v.concat([new Ze("light",s,`object expected, ${w} found`)]),v;for(const E in s){const C=E.match(/^(.*)-transition$/);v=v.concat(C&&f[C[1]]&&f[C[1]].transition?c.validateSpec({key:E,value:s[E],valueSpec:u.transition,validateSpec:c.validateSpec,style:_,styleSpec:u}):f[E]?c.validateSpec({key:E,value:s[E],valueSpec:f[E],validateSpec:c.validateSpec,style:_,styleSpec:u}):[new Ze(E,s[E],`unknown property "${E}"`)])}return v}function pd(c){const s=c.value,u=c.styleSpec,f=u.terrain,_=c.style;let v=[];const w=Xt(s);if(s===void 0)return v;if(w!=="object")return v=v.concat([new Ze("terrain",s,`object expected, ${w} found`)]),v;for(const E in s)v=v.concat(f[E]?c.validateSpec({key:E,value:s[E],valueSpec:f[E],validateSpec:c.validateSpec,style:_,styleSpec:u}):[new Ze(E,s[E],`unknown property "${E}"`)]);return v}function gd(c){let s=[];const u=c.value,f=c.key;if(Array.isArray(u)){const _=[],v=[];for(const w in u)u[w].id&&_.includes(u[w].id)&&s.push(new Ze(f,u,`all the sprites' ids must be unique, but ${u[w].id} is duplicated`)),_.push(u[w].id),u[w].url&&v.includes(u[w].url)&&s.push(new Ze(f,u,`all the sprites' URLs must be unique, but ${u[w].url} is duplicated`)),v.push(u[w].url),s=s.concat(Vr({key:`${f}[${w}]`,value:u[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return s}return Gn({key:f,value:u})}const _d={"*":()=>[],array:No,boolean:function(c){const s=c.value,u=c.key,f=Xt(s);return f!=="boolean"?[new Ze(u,s,`boolean expected, ${f} found`)]:[]},number:Ca,color:function(c){const s=c.key,u=c.value,f=Xt(u);return f!=="string"?[new Ze(s,u,`color expected, ${f} found`)]:Dt.parse(String(u))?[]:[new Ze(s,u,`color expected, "${u}" found`)]},constants:ld,enum:Ra,filter:Lo,function:Ml,layer:fd,object:Vr,source:un,light:ka,terrain:pd,string:Gn,formatted:function(c){return Gn(c).length===0?[]:ao(c)},resolvedImage:function(c){return Gn(c).length===0?[]:ao(c)},padding:function(c){const s=c.key,u=c.value;if(Xt(u)==="array"){if(u.length<1||u.length>4)return[new Ze(s,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let _=[];for(let v=0;v<u.length;v++)_=_.concat(c.validateSpec({key:`${s}[${v}]`,value:u[v],validateSpec:c.validateSpec,valueSpec:f}));return _}return Ca({key:s,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const s=c.key,u=c.value,f=Xt(u),_=c.styleSpec;if(f!=="array"||u.length<1||u.length%2!=0)return[new Ze(s,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let w=0;w<u.length;w+=2)v=v.concat(Ra({key:`${s}[${w}]`,value:u[w],valueSpec:_.layout_symbol["text-anchor"]})),v=v.concat(No({key:`${s}[${w+1}]`,value:u[w+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:_}));return v},sprite:gd};function _s(c){const s=c.value,u=c.valueSpec,f=c.styleSpec;return c.validateSpec=_s,u.expression&&Si(Ii(s))?Ml(c):u.expression&&El(oo(s))?ao(c):u.type&&_d[u.type]?_d[u.type](c):Vr(Pn({},c,{valueSpec:u.type?f[u.type]:u}))}function md(c){const s=c.value,u=c.key,f=Gn(c);return f.length||(s.indexOf("{fontstack}")===-1&&f.push(new Ze(u,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&f.push(new Ze(u,s,'"glyphs" url must include a "{range}" token'))),f}function Rn(c,s=Fe){let u=[];return u=u.concat(_s({key:"",value:c,valueSpec:s.$root,styleSpec:s,style:c,validateSpec:_s,objectElementValidators:{glyphs:md,"*":()=>[]}})),c.constants&&(u=u.concat(ld({key:"constants",value:c.constants,style:c,styleSpec:s,validateSpec:_s}))),kl(u)}function ms(c){return function(s){return c({...s,validateSpec:_s})}}function kl(c){return[].concat(c).sort((s,u)=>s.line-u.line)}function ys(c){return function(...s){return kl(c.apply(this,s))}}Rn.source=ys(ms(un)),Rn.sprite=ys(ms(gd)),Rn.glyphs=ys(ms(md)),Rn.light=ys(ms(ka)),Rn.terrain=ys(ms(pd)),Rn.layer=ys(ms(fd)),Rn.filter=ys(ms(Lo)),Rn.paintProperty=ys(ms(hd)),Rn.layoutProperty=ys(ms(dd));const xs=Rn,Tg=xs.light,nu=xs.paintProperty,yd=xs.layoutProperty;function Ol(c,s){let u=!1;if(s&&s.length)for(const f of s)c.fire(new Ln(new Error(f.message))),u=!0;return u}class Bo{constructor(s,u,f){const _=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const w=new Int32Array(this.arrayBuffer);s=w[0],this.d=(u=w[1])+2*(f=w[2]);for(let C=0;C<this.d*this.d;C++){const k=w[3+C],F=w[3+C+1];_.push(k===F?null:w.subarray(k,F))}const E=w[3+_.length+1];this.keys=w.subarray(w[3+_.length],E),this.bboxes=w.subarray(E),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let w=0;w<this.d*this.d;w++)_.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=f,this.scale=u/s,this.uid=0;const v=f/u*s;this.min=-v,this.max=s+v}insert(s,u,f,_,v){this._forEachCell(u,f,_,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,u,f,_,v,w){this.cells[v].push(w)}query(s,u,f,_,v){const w=this.min,E=this.max;if(s<=w&&u<=w&&E<=f&&E<=_&&!v)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(s,u,f,_,this._queryCell,C,{},v),C}}_queryCell(s,u,f,_,v,w,E,C){const k=this.cells[v];if(k!==null){const F=this.keys,L=this.bboxes;for(let U=0;U<k.length;U++){const W=k[U];if(E[W]===void 0){const q=4*W;(C?C(L[q+0],L[q+1],L[q+2],L[q+3]):s<=L[q+2]&&u<=L[q+3]&&f>=L[q+0]&&_>=L[q+1])?(E[W]=!0,w.push(F[W])):E[W]=!1}}}}_forEachCell(s,u,f,_,v,w,E,C){const k=this._convertToCellCoord(s),F=this._convertToCellCoord(u),L=this._convertToCellCoord(f),U=this._convertToCellCoord(_);for(let W=k;W<=L;W++)for(let q=F;q<=U;q++){const Q=this.d*q+W;if((!C||C(this._convertFromCellCoord(W),this._convertFromCellCoord(q),this._convertFromCellCoord(W+1),this._convertFromCellCoord(q+1)))&&v.call(this,s,u,f,_,Q,w,E,C))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,u=3+this.cells.length+1+1;let f=0;for(let w=0;w<this.cells.length;w++)f+=this.cells[w].length;const _=new Int32Array(u+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let v=u;for(let w=0;w<s.length;w++){const E=s[w];_[3+w]=v,_.set(E,v),v+=E.length}return _[3+s.length]=v,_.set(this.keys,v),v+=this.keys.length,_[3+s.length+1]=v,_.set(this.bboxes,v),v+=this.bboxes.length,_.buffer}static serialize(s,u){const f=s.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(s){return new Bo(s.buffer)}}const vs={};function st(c,s,u={}){if(vs[c])throw new Error(`${c} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:c,writeable:!1}),vs[c]={klass:s,omit:u.omit||[],shallow:u.shallow||[]}}st("Object",Object),st("TransferableGridIndex",Bo),st("Color",Dt),st("Error",Error),st("AJAXError",mr),st("ResolvedImage",ri),st("StylePropertyFunction",Ea),st("StyleExpression",Qc,{omit:["_evaluator"]}),st("ZoomDependentExpression",Pl),st("ZoomConstantExpression",eu),st("CompoundExpression",Cn,{omit:["_evaluate"]});for(const c in Fo)Fo[c]._classRegistryKey||st(`Expression_${c}`,Fo[c]);function Fl(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Ls(c,s){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob)return c;if(Fl(c)||ks(c))return s&&s.push(c),c;if(ArrayBuffer.isView(c)){const u=c;return s&&s.push(u.buffer),u}if(c instanceof ImageData)return s&&s.push(c.data.buffer),c;if(Array.isArray(c)){const u=[];for(const f of c)u.push(Ls(f,s));return u}if(typeof c=="object"){const u=c.constructor,f=u._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");if(!vs[f])throw new Error(`${f} is not registered.`);const _=u.serialize?u.serialize(c,s):{};if(u.serialize){if(s&&_===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in c){if(!c.hasOwnProperty(v)||vs[f].omit.indexOf(v)>=0)continue;const w=c[v];_[v]=vs[f].shallow.indexOf(v)>=0?w:Ls(w,s)}c instanceof Error&&(_.message=c.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(_.$name=f),_}throw new Error("can't serialize object of type "+typeof c)}function zo(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||Fl(c)||ks(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(zo);if(typeof c=="object"){const s=c.$name||"Object";if(!vs[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:u}=vs[s];if(!u)throw new Error(`can't deserialize unregistered class ${s}`);if(u.deserialize)return u.deserialize(c);const f=Object.create(u.prototype);for(const _ of Object.keys(c)){if(_==="$name")continue;const v=c[_];f[_]=vs[s].shallow.indexOf(_)>=0?v:zo(v)}return f}throw new Error("can't deserialize object of type "+typeof c)}class xd{constructor(){this.first=!0}update(s,u){const f=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=f,!0))}}const rt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function su(c){for(const s of c)if(au(s.charCodeAt(0)))return!0;return!1}function ou(c){for(const s of c)if(!Sg(s.charCodeAt(0)))return!1;return!0}function Sg(c){return!(rt.Arabic(c)||rt["Arabic Supplement"](c)||rt["Arabic Extended-A"](c)||rt["Arabic Presentation Forms-A"](c)||rt["Arabic Presentation Forms-B"](c))}function au(c){return!(c!==746&&c!==747&&(c<4352||!(rt["Bopomofo Extended"](c)||rt.Bopomofo(c)||rt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||rt["CJK Compatibility Ideographs"](c)||rt["CJK Compatibility"](c)||rt["CJK Radicals Supplement"](c)||rt["CJK Strokes"](c)||!(!rt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||rt["CJK Unified Ideographs Extension A"](c)||rt["CJK Unified Ideographs"](c)||rt["Enclosed CJK Letters and Months"](c)||rt["Hangul Compatibility Jamo"](c)||rt["Hangul Jamo Extended-A"](c)||rt["Hangul Jamo Extended-B"](c)||rt["Hangul Jamo"](c)||rt["Hangul Syllables"](c)||rt.Hiragana(c)||rt["Ideographic Description Characters"](c)||rt.Kanbun(c)||rt["Kangxi Radicals"](c)||rt["Katakana Phonetic Extensions"](c)||rt.Katakana(c)&&c!==12540||!(!rt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!rt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||rt["Unified Canadian Aboriginal Syllabics"](c)||rt["Unified Canadian Aboriginal Syllabics Extended"](c)||rt["Vertical Forms"](c)||rt["Yijing Hexagram Symbols"](c)||rt["Yi Syllables"](c)||rt["Yi Radicals"](c))))}function vd(c){return!(au(c)||function(s){return!!(rt["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||rt["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||rt["Letterlike Symbols"](s)||rt["Number Forms"](s)||rt["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||rt["Control Pictures"](s)&&s!==9251||rt["Optical Character Recognition"](s)||rt["Enclosed Alphanumerics"](s)||rt["Geometric Shapes"](s)||rt["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||rt["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||rt["CJK Symbols and Punctuation"](s)||rt.Katakana(s)||rt["Private Use Area"](s)||rt["CJK Compatibility Forms"](s)||rt["Small Form Variants"](s)||rt["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(c))}function bd(c){return c>=1424&&c<=2303||rt["Arabic Presentation Forms-A"](c)||rt["Arabic Presentation Forms-B"](c)}function wd(c,s){return!(!s&&bd(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||rt.Khmer(c))}function Eg(c){for(const s of c)if(bd(s.charCodeAt(0)))return!0;return!1}const lu="deferred",cu="loading",uu="loaded";let hu=null,$r="unavailable",Bs=null;const Oa=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&($r="error"),hu&&hu(c)};function du(){Fa.fire(new yr("pluginStateChange",{pluginStatus:$r,pluginURL:Bs}))}const Fa=new Zn,fu=function(){return $r},Td=function(){if($r!==lu||!Bs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$r=cu,du(),Bs&&Nn({url:Bs},c=>{c?Oa(c):($r=uu,du())})},hn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$r===uu||hn.applyArabicShaping!=null,isLoading:()=>$r===cu,setState(c){if(!lr())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");$r=c.pluginStatus,Bs=c.pluginURL},isParsed(){if(!lr())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return hn.applyArabicShaping!=null&&hn.processBidirectionalText!=null&&hn.processStyledBidirectionalText!=null},getPluginURL(){if(!lr())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Bs}};class fi{constructor(s,u){this.zoom=s,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new xd,this.transition={})}isSupportedScript(s){return function(u,f){for(const _ of u)if(!wd(_.charCodeAt(0),f))return!1;return!0}(s,hn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,u=s-Math.floor(s),f=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class Dl{constructor(s,u){this.property=s,this.value=u,this.expression=function(f,_){if(Si(f))return new Ea(f,_);if(El(f)){const v=tu(f,_);if(v.result==="error")throw new Error(v.value.map(w=>`${w.key}: ${w.message}`).join(", "));return v.value}{let v=f;return _.type==="color"&&typeof f=="string"?v=Dt.parse(f):_.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(v=ur.parse(f)):v=xr.parse(f),{kind:"constant",evaluate:()=>v}}}(u===void 0?s.specification.default:u,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,u,f){return this.property.possiblyEvaluate(this,s,u,f)}}class pu{constructor(s){this.property=s,this.value=new Dl(s,void 0)}transitioned(s,u){return new Ed(this.property,this.value,u,ke({},s.transition,this.transition),s.now)}untransitioned(){return new Ed(this.property,this.value,null,{},0)}}class Sd{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return tt(this._values[s].value.value)}setValue(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new pu(this._values[s].property)),this._values[s].value=new Dl(this._values[s].property,u===null?void 0:tt(u))}getTransition(s){return tt(this._values[s].transition)}setTransition(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new pu(this._values[s].property)),this._values[s].transition=tt(u)||void 0}serialize(){const s={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(s[u]=f);const _=this.getTransition(u);_!==void 0&&(s[`${u}-transition`]=_)}return s}transitioned(s,u){const f=new Ad(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].transitioned(s,u._values[_]);return f}untransitioned(){const s=new Ad(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].untransitioned();return s}}class Ed{constructor(s,u,f,_,v){this.property=s,this.value=u,this.begin=v+_.delay||0,this.end=this.begin+_.duration||0,s.specification.transition&&(_.delay||_.duration)&&(this.prior=f)}possiblyEvaluate(s,u,f){const _=s.now||0,v=this.value.possiblyEvaluate(s,u,f),w=this.prior;if(w){if(_>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(_<this.begin)return w.possiblyEvaluate(s,u,f);{const E=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(s,u,f),v,function(C){if(C<=0)return 0;if(C>=1)return 1;const k=C*C,F=k*C;return 4*(C<.5?F:3*(C-k)+F-.75)}(E))}}return v}}class Ad{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,u,f){const _=new Nl(this._properties);for(const v of Object.keys(this._values))_._values[v]=this._values[v].possiblyEvaluate(s,u,f);return _}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Ag{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return tt(this._values[s].value)}setValue(s,u){this._values[s]=new Dl(this._values[s].property,u===null?void 0:tt(u))}serialize(){const s={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(s[u]=f)}return s}possiblyEvaluate(s,u,f){const _=new Nl(this._properties);for(const v of Object.keys(this._values))_._values[v]=this._values[v].possiblyEvaluate(s,u,f);return _}}class Pr{constructor(s,u,f){this.property=s,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,u,f,_){return this.property.evaluate(this.value,this.parameters,s,u,f,_)}}class Nl{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class _t{constructor(s){this.specification=s}possiblyEvaluate(s,u){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(u)}interpolate(s,u,f){const _=ln[this.specification.type];return _?_(s,u,f):s}}class wt{constructor(s,u){this.specification=s,this.overrides=u}possiblyEvaluate(s,u,f,_){return new Pr(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(u,null,{},f,_)}:s.expression,u)}interpolate(s,u,f){if(s.value.kind!=="constant"||u.value.kind!=="constant")return s;if(s.value.value===void 0||u.value.value===void 0)return new Pr(this,{kind:"constant",value:void 0},s.parameters);const _=ln[this.specification.type];if(_){const v=_(s.value.value,u.value.value,f);return new Pr(this,{kind:"constant",value:v},s.parameters)}return s}evaluate(s,u,f,_,v,w){return s.kind==="constant"?s.value:s.evaluate(u,f,_,v,w)}}class Da extends wt{possiblyEvaluate(s,u,f,_){if(s.value===void 0)return new Pr(this,{kind:"constant",value:void 0},u);if(s.expression.kind==="constant"){const v=s.expression.evaluate(u,null,{},f,_),w=s.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,E=this._calculate(w,w,w,u);return new Pr(this,{kind:"constant",value:E},u)}if(s.expression.kind==="camera"){const v=this._calculate(s.expression.evaluate({zoom:u.zoom-1}),s.expression.evaluate({zoom:u.zoom}),s.expression.evaluate({zoom:u.zoom+1}),u);return new Pr(this,{kind:"constant",value:v},u)}return new Pr(this,s.expression,u)}evaluate(s,u,f,_,v,w){if(s.kind==="source"){const E=s.evaluate(u,f,_,v,w);return this._calculate(E,E,E,u)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(u.zoom)-1},f,_),s.evaluate({zoom:Math.floor(u.zoom)},f,_),s.evaluate({zoom:Math.floor(u.zoom)+1},f,_),u):s.value}_calculate(s,u,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:f,to:u}}interpolate(s){return s}}class gu{constructor(s){this.specification=s}possiblyEvaluate(s,u,f,_){if(s.value!==void 0){if(s.expression.kind==="constant"){const v=s.expression.evaluate(u,null,{},f,_);return this._calculate(v,v,v,u)}return this._calculate(s.expression.evaluate(new fi(Math.floor(u.zoom-1),u)),s.expression.evaluate(new fi(Math.floor(u.zoom),u)),s.expression.evaluate(new fi(Math.floor(u.zoom+1),u)),u)}}_calculate(s,u,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:f,to:u}}interpolate(s){return s}}class _u{constructor(s){this.specification=s}possiblyEvaluate(s,u,f,_){return!!s.expression.evaluate(u,null,{},f,_)}interpolate(){return!1}}class zi{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in s){const f=s[u];f.specification.overridable&&this.overridableProperties.push(u);const _=this.defaultPropertyValues[u]=new Dl(f,void 0),v=this.defaultTransitionablePropertyValues[u]=new pu(f);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=_.possiblyEvaluate({})}}}st("DataDrivenProperty",wt),st("DataConstantProperty",_t),st("CrossFadedDataDrivenProperty",Da),st("CrossFadedProperty",gu),st("ColorRampProperty",_u);const mu="-transition";class Mn extends Zn{constructor(s,u){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),u.layout&&(this._unevaluatedLayout=new Ag(u.layout)),u.paint)){this._transitionablePaint=new Sd(u.paint);for(const f in s.paint)this.setPaintProperty(f,s.paint[f],{validate:!1});for(const f in s.layout)this.setLayoutProperty(f,s.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Nl(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,u,f={}){u!=null&&this._validate(yd,`layers.${this.id}.layout.${s}`,s,u,f)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,u):this.visibility=u)}getPaintProperty(s){return s.endsWith(mu)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,u,f={}){if(u!=null&&this._validate(nu,`layers.${this.id}.paint.${s}`,s,u,f))return!1;if(s.endsWith(mu))return this._transitionablePaint.setTransition(s.slice(0,-11),u||void 0),!1;{const _=this._transitionablePaint._values[s],v=_.property.specification["property-type"]==="cross-faded-data-driven",w=_.value.isDataDriven(),E=_.value;this._transitionablePaint.setValue(s,u),this._handleSpecialPaintPropertyUpdate(s);const C=this._transitionablePaint._values[s].value;return C.isDataDriven()||w||v||this._handleOverridablePaintPropertyUpdate(s,E,C)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,u,f){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,u){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,u)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),ct(s,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(s,u,f,_,v={}){return(!v||v.validate!==!1)&&Ol(this,s.call(xs,{key:u,layerType:this.type,objectKey:f,value:_,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const u=this.paint.get(s);if(u instanceof Pr&&Do(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const Pd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class lo{constructor(s,u){this._structArray=s,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ci{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,u){return s._trim(),u&&(s.isTransferred=!0,u.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const u=Object.create(this.prototype);return u.arrayBuffer=s.arrayBuffer,u.length=s.length,u.capacity=s.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ai(c,s=1){let u=0,f=0;return{members:c.map(_=>{const v=Pd[_.type].BYTES_PER_ELEMENT,w=u=Uo(u,Math.max(s,v)),E=_.components||1;return f=Math.max(f,v),u+=v*E,{name:_.name,type:_.type,components:E,offset:w}}),size:Uo(u,Math.max(f,s)),alignment:s}}function Uo(c,s){return Math.ceil(c/s)*s}class Na extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const _=2*s;return this.int16[_+0]=u,this.int16[_+1]=f,s}}Na.prototype.bytesPerElement=4,st("StructArrayLayout2i4",Na);class La extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,f)}emplace(s,u,f,_){const v=3*s;return this.int16[v+0]=u,this.int16[v+1]=f,this.int16[v+2]=_,s}}La.prototype.bytesPerElement=6,st("StructArrayLayout3i6",La);class co extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,s,u,f,_)}emplace(s,u,f,_,v){const w=4*s;return this.int16[w+0]=u,this.int16[w+1]=f,this.int16[w+2]=_,this.int16[w+3]=v,s}}co.prototype.bytesPerElement=8,st("StructArrayLayout4i8",co);class yu extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,_,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,s,u,f,_,v,w)}emplace(s,u,f,_,v,w,E){const C=6*s;return this.int16[C+0]=u,this.int16[C+1]=f,this.int16[C+2]=_,this.int16[C+3]=v,this.int16[C+4]=w,this.int16[C+5]=E,s}}yu.prototype.bytesPerElement=12,st("StructArrayLayout2i4i12",yu);class xu extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,_,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,s,u,f,_,v,w)}emplace(s,u,f,_,v,w,E){const C=4*s,k=8*s;return this.int16[C+0]=u,this.int16[C+1]=f,this.uint8[k+4]=_,this.uint8[k+5]=v,this.uint8[k+6]=w,this.uint8[k+7]=E,s}}xu.prototype.bytesPerElement=8,st("StructArrayLayout2i4ub8",xu);class Vo extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const _=2*s;return this.float32[_+0]=u,this.float32[_+1]=f,s}}Vo.prototype.bytesPerElement=8,st("StructArrayLayout2f8",Vo);class vu extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,_,v,w,E,C,k,F){const L=this.length;return this.resize(L+1),this.emplace(L,s,u,f,_,v,w,E,C,k,F)}emplace(s,u,f,_,v,w,E,C,k,F,L){const U=10*s;return this.uint16[U+0]=u,this.uint16[U+1]=f,this.uint16[U+2]=_,this.uint16[U+3]=v,this.uint16[U+4]=w,this.uint16[U+5]=E,this.uint16[U+6]=C,this.uint16[U+7]=k,this.uint16[U+8]=F,this.uint16[U+9]=L,s}}vu.prototype.bytesPerElement=20,st("StructArrayLayout10ui20",vu);class bu extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,_,v,w,E,C,k,F,L,U){const W=this.length;return this.resize(W+1),this.emplace(W,s,u,f,_,v,w,E,C,k,F,L,U)}emplace(s,u,f,_,v,w,E,C,k,F,L,U,W){const q=12*s;return this.int16[q+0]=u,this.int16[q+1]=f,this.int16[q+2]=_,this.int16[q+3]=v,this.uint16[q+4]=w,this.uint16[q+5]=E,this.uint16[q+6]=C,this.uint16[q+7]=k,this.int16[q+8]=F,this.int16[q+9]=L,this.int16[q+10]=U,this.int16[q+11]=W,s}}bu.prototype.bytesPerElement=24,st("StructArrayLayout4i4ui4i24",bu);class Zt extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,f)}emplace(s,u,f,_){const v=3*s;return this.float32[v+0]=u,this.float32[v+1]=f,this.float32[v+2]=_,s}}Zt.prototype.bytesPerElement=12,st("StructArrayLayout3f12",Zt);class x extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint32[1*s+0]=u,s}}x.prototype.bytesPerElement=4,st("StructArrayLayout1ul4",x);class o extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,_,v,w,E,C,k){const F=this.length;return this.resize(F+1),this.emplace(F,s,u,f,_,v,w,E,C,k)}emplace(s,u,f,_,v,w,E,C,k,F){const L=10*s,U=5*s;return this.int16[L+0]=u,this.int16[L+1]=f,this.int16[L+2]=_,this.int16[L+3]=v,this.int16[L+4]=w,this.int16[L+5]=E,this.uint32[U+3]=C,this.uint16[L+8]=k,this.uint16[L+9]=F,s}}o.prototype.bytesPerElement=20,st("StructArrayLayout6i1ul2ui20",o);class d extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,_,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,s,u,f,_,v,w)}emplace(s,u,f,_,v,w,E){const C=6*s;return this.int16[C+0]=u,this.int16[C+1]=f,this.int16[C+2]=_,this.int16[C+3]=v,this.int16[C+4]=w,this.int16[C+5]=E,s}}d.prototype.bytesPerElement=12,st("StructArrayLayout2i2i2i12",d);class p extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,s,u,f,_,v)}emplace(s,u,f,_,v,w){const E=4*s,C=8*s;return this.float32[E+0]=u,this.float32[E+1]=f,this.float32[E+2]=_,this.int16[C+6]=v,this.int16[C+7]=w,s}}p.prototype.bytesPerElement=16,st("StructArrayLayout2f1f2i16",p);class m extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,s,u,f,_)}emplace(s,u,f,_,v){const w=12*s,E=3*s;return this.uint8[w+0]=u,this.uint8[w+1]=f,this.float32[E+1]=_,this.float32[E+2]=v,s}}m.prototype.bytesPerElement=12,st("StructArrayLayout2ub2f12",m);class b extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,f)}emplace(s,u,f,_){const v=3*s;return this.uint16[v+0]=u,this.uint16[v+1]=f,this.uint16[v+2]=_,s}}b.prototype.bytesPerElement=6,st("StructArrayLayout3ui6",b);class A extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,_,v,w,E,C,k,F,L,U,W,q,Q,ae,de){const ve=this.length;return this.resize(ve+1),this.emplace(ve,s,u,f,_,v,w,E,C,k,F,L,U,W,q,Q,ae,de)}emplace(s,u,f,_,v,w,E,C,k,F,L,U,W,q,Q,ae,de,ve){const ge=24*s,we=12*s,Pe=48*s;return this.int16[ge+0]=u,this.int16[ge+1]=f,this.uint16[ge+2]=_,this.uint16[ge+3]=v,this.uint32[we+2]=w,this.uint32[we+3]=E,this.uint32[we+4]=C,this.uint16[ge+10]=k,this.uint16[ge+11]=F,this.uint16[ge+12]=L,this.float32[we+7]=U,this.float32[we+8]=W,this.uint8[Pe+36]=q,this.uint8[Pe+37]=Q,this.uint8[Pe+38]=ae,this.uint32[we+10]=de,this.int16[ge+22]=ve,s}}A.prototype.bytesPerElement=48,st("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",A);class I extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,_,v,w,E,C,k,F,L,U,W,q,Q,ae,de,ve,ge,we,Pe,Be,nt,dt,it,et,Ye,at){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,s,u,f,_,v,w,E,C,k,F,L,U,W,q,Q,ae,de,ve,ge,we,Pe,Be,nt,dt,it,et,Ye,at)}emplace(s,u,f,_,v,w,E,C,k,F,L,U,W,q,Q,ae,de,ve,ge,we,Pe,Be,nt,dt,it,et,Ye,at,Ge){const He=32*s,bt=16*s;return this.int16[He+0]=u,this.int16[He+1]=f,this.int16[He+2]=_,this.int16[He+3]=v,this.int16[He+4]=w,this.int16[He+5]=E,this.int16[He+6]=C,this.int16[He+7]=k,this.uint16[He+8]=F,this.uint16[He+9]=L,this.uint16[He+10]=U,this.uint16[He+11]=W,this.uint16[He+12]=q,this.uint16[He+13]=Q,this.uint16[He+14]=ae,this.uint16[He+15]=de,this.uint16[He+16]=ve,this.uint16[He+17]=ge,this.uint16[He+18]=we,this.uint16[He+19]=Pe,this.uint16[He+20]=Be,this.uint16[He+21]=nt,this.uint16[He+22]=dt,this.uint32[bt+12]=it,this.float32[bt+13]=et,this.float32[bt+14]=Ye,this.uint16[He+30]=at,this.uint16[He+31]=Ge,s}}I.prototype.bytesPerElement=64,st("StructArrayLayout8i15ui1ul2f2ui64",I);class R extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.float32[1*s+0]=u,s}}R.prototype.bytesPerElement=4,st("StructArrayLayout1f4",R);class O extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,f)}emplace(s,u,f,_){const v=3*s;return this.uint16[6*s+0]=u,this.float32[v+1]=f,this.float32[v+2]=_,s}}O.prototype.bytesPerElement=12,st("StructArrayLayout1ui2f12",O);class D extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,f)}emplace(s,u,f,_){const v=4*s;return this.uint32[2*s+0]=u,this.uint16[v+2]=f,this.uint16[v+3]=_,s}}D.prototype.bytesPerElement=8,st("StructArrayLayout1ul2ui8",D);class N extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const _=2*s;return this.uint16[_+0]=u,this.uint16[_+1]=f,s}}N.prototype.bytesPerElement=4,st("StructArrayLayout2ui4",N);class $ extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint16[1*s+0]=u,s}}$.prototype.bytesPerElement=2,st("StructArrayLayout1ui2",$);class te extends Ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,s,u,f,_)}emplace(s,u,f,_,v){const w=4*s;return this.float32[w+0]=u,this.float32[w+1]=f,this.float32[w+2]=_,this.float32[w+3]=v,s}}te.prototype.bytesPerElement=16,st("StructArrayLayout4f16",te);class ee extends lo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new P(this.anchorPointX,this.anchorPointY)}}ee.prototype.size=20;class se extends o{get(s){return new ee(this,s)}}st("CollisionBoxArray",se);class J extends lo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}J.prototype.size=48;class me extends A{get(s){return new J(this,s)}}st("PlacedSymbolArray",me);class Ee extends lo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ee.prototype.size=64;class ce extends I{get(s){return new Ee(this,s)}}st("SymbolInstanceArray",ce);class xe extends R{getoffsetX(s){return this.float32[1*s+0]}}st("GlyphOffsetArray",xe);class Ie extends La{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}st("SymbolLineVertexArray",Ie);class Re extends lo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Re.prototype.size=12;class Le extends O{get(s){return new Re(this,s)}}st("TextAnchorOffsetArray",Le);class We extends lo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}We.prototype.size=8;class Ve extends D{get(s){return new We(this,s)}}st("FeatureIndexArray",Ve);class Xe extends Na{}class ht extends Na{}class Nt extends Na{}class Qe extends yu{}class Tt extends xu{}class ft extends Vo{}class ii extends vu{}class Ft extends bu{}class Ct extends Zt{}class Lt extends x{}class Fi extends d{}class hi extends m{}class dr extends b{}class Ki extends N{}const Ui=Ai([{name:"a_pos",components:2,type:"Int16"}],4),{members:dn}=Ui;class pi{constructor(s=[]){this.segments=s}prepareSegment(s,u,f,_){let v=this.segments[this.segments.length-1];return s>pi.MAX_VERTEX_ARRAY_LENGTH&&ot(`Max vertices per segment is ${pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!v||v.vertexLength+s>pi.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==_)&&(v={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},_!==void 0&&(v.sortKey=_),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const s of this.segments)for(const u in s.vaos)s.vaos[u].destroy()}static simpleSegment(s,u,f,_){return new pi([{vertexOffset:s,primitiveOffset:u,vertexLength:f,primitiveLength:_,vaos:{},sortKey:0}])}}function Jn(c,s){return 256*(c=Oe(Math.floor(c),0,255))+Oe(Math.floor(s),0,255)}pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st("SegmentVector",pi);const Qn=Ai([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var zs={exports:{}},uo={exports:{}};uo.exports=function(c,s){var u,f,_,v,w,E,C,k;for(f=c.length-(u=3&c.length),_=s,w=3432918353,E=461845907,k=0;k<f;)C=255&c.charCodeAt(k)|(255&c.charCodeAt(++k))<<8|(255&c.charCodeAt(++k))<<16|(255&c.charCodeAt(++k))<<24,++k,_=27492+(65535&(v=5*(65535&(_=(_^=C=(65535&(C=(C=(65535&C)*w+(((C>>>16)*w&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(C=0,u){case 3:C^=(255&c.charCodeAt(k+2))<<16;case 2:C^=(255&c.charCodeAt(k+1))<<8;case 1:_^=C=(65535&(C=(C=(65535&(C^=255&c.charCodeAt(k)))*w+(((C>>>16)*w&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295}return _^=c.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var $o=uo.exports,vr={exports:{}};vr.exports=function(c,s){for(var u,f=c.length,_=s^f,v=0;f>=4;)u=1540483477*(65535&(u=255&c.charCodeAt(v)|(255&c.charCodeAt(++v))<<8|(255&c.charCodeAt(++v))<<16|(255&c.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:_^=(255&c.charCodeAt(v+2))<<16;case 2:_^=(255&c.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&c.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var fr=$o,Ir=vr.exports;zs.exports=fr,zs.exports.murmur3=fr,zs.exports.murmur2=Ir;var ho=y(zs.exports);class Di{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,u,f,_){this.ids.push(Gi(s)),this.positions.push(u,f,_)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Gi(s);let f=0,_=this.ids.length-1;for(;f<_;){const w=f+_>>1;this.ids[w]>=u?_=w:f=w+1}const v=[];for(;this.ids[f]===u;)v.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return v}static serialize(s,u){const f=new Float64Array(s.ids),_=new Uint32Array(s.positions);return jr(f,_,0,f.length-1),u&&u.push(f.buffer,_.buffer),{ids:f,positions:_}}static deserialize(s){const u=new Di;return u.ids=s.ids,u.positions=s.positions,u.indexed=!0,u}}function Gi(c){const s=+c;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:ho(String(c))}function jr(c,s,u,f){for(;u<f;){const _=c[u+f>>1];let v=u-1,w=f+1;for(;;){do v++;while(c[v]<_);do w--;while(c[w]>_);if(v>=w)break;Ni(c,v,w),Ni(s,3*v,3*w),Ni(s,3*v+1,3*w+1),Ni(s,3*v+2,3*w+2)}w-u<f-w?(jr(c,s,u,w),u=w+1):(jr(c,s,w+1,f),f=w)}}function Ni(c,s,u){const f=c[s];c[s]=c[u],c[u]=f}st("FeaturePositionMap",Di);class fo{constructor(s,u){this.gl=s.gl,this.location=u}}class Ll extends fo{constructor(s,u){super(s,u),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Id extends fo{constructor(s,u){super(s,u),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class Cd extends fo{constructor(s,u){super(s,u),this.current=Dt.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const Pg=new Float32Array(16);function wu(c){return[Jn(255*c.r,255*c.g),Jn(255*c.b,255*c.a)]}class es{constructor(s,u,f){this.value=s,this.uniformNames=u.map(_=>`u_${_}`),this.type=f}setUniform(s,u,f){s.set(f.constantOr(this.value))}getBinding(s,u,f){return this.type==="color"?new Cd(s,u):new Ll(s,u)}}class po{constructor(s,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=s.tlbr}setUniform(s,u,f,_){const v=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&s.set(v)}getBinding(s,u,f){return f.substr(0,9)==="u_pattern"?new Id(s,u):new Ll(s,u)}}class ts{constructor(s,u,f,_){this.expression=s,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(v=>({name:`a_${v}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(s,u,f,_,v){const w=this.paintVertexArray.length,E=this.expression.evaluate(new fi(0),u,{},_,[],v);this.paintVertexArray.resize(s),this._setPaintValue(w,s,E)}updatePaintArray(s,u,f,_){const v=this.expression.evaluate({zoom:0},f,_);this._setPaintValue(s,u,v)}_setPaintValue(s,u,f){if(this.type==="color"){const _=wu(f);for(let v=s;v<u;v++)this.paintVertexArray.emplace(v,_[0],_[1])}else{for(let _=s;_<u;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class kn{constructor(s,u,f,_,v,w){this.expression=s,this.uniformNames=u.map(E=>`u_${E}_t`),this.type=f,this.useIntegerZoom=_,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=u.map(E=>({name:`a_${E}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(s,u,f,_,v){const w=this.expression.evaluate(new fi(this.zoom),u,{},_,[],v),E=this.expression.evaluate(new fi(this.zoom+1),u,{},_,[],v),C=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(C,s,w,E)}updatePaintArray(s,u,f,_){const v=this.expression.evaluate({zoom:this.zoom},f,_),w=this.expression.evaluate({zoom:this.zoom+1},f,_);this._setPaintValue(s,u,v,w)}_setPaintValue(s,u,f,_){if(this.type==="color"){const v=wu(f),w=wu(_);for(let E=s;E<u;E++)this.paintVertexArray.emplace(E,v[0],v[1],w[0],w[1])}else{for(let v=s;v<u;v++)this.paintVertexArray.emplace(v,f,_);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(_))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,_=Oe(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);s.set(_)}getBinding(s,u,f){return new Ll(s,u)}}class is{constructor(s,u,f,_,v,w){this.expression=s,this.type=u,this.useIntegerZoom=f,this.zoom=_,this.layerId=w,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(s,u,f){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(_,s,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(s,u,f,_,v){this._setPaintValues(s,u,f.patterns&&f.patterns[this.layerId],v)}_setPaintValues(s,u,f,_){if(!_||!f)return;const{min:v,mid:w,max:E}=f,C=_[v],k=_[w],F=_[E];if(C&&k&&F)for(let L=s;L<u;L++)this.zoomInPaintVertexArray.emplace(L,k.tl[0],k.tl[1],k.br[0],k.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],k.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,k.tl[0],k.tl[1],k.br[0],k.br[1],F.tl[0],F.tl[1],F.br[0],F.br[1],k.pixelRatio,F.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,Qn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,Qn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Tu{constructor(s,u,f){this.binders={},this._buffers=[];const _=[];for(const v in s.paint._values){if(!f(v))continue;const w=s.paint.get(v);if(!(w instanceof Pr&&Do(w.property.specification)))continue;const E=DA(v,s.type),C=w.value,k=w.property.specification.type,F=w.property.useIntegerZoom,L=w.property.specification["property-type"],U=L==="cross-faded"||L==="cross-faded-data-driven";if(C.kind==="constant")this.binders[v]=U?new po(C.value,E):new es(C.value,E,k),_.push(`/u_${v}`);else if(C.kind==="source"||U){const W=F0(v,k,"source");this.binders[v]=U?new is(C,k,F,u,W,s.id):new ts(C,E,k,W),_.push(`/a_${v}`)}else{const W=F0(v,k,"composite");this.binders[v]=new kn(C,E,k,F,u,W),_.push(`/z_${v}`)}}this.cacheKey=_.sort().join("")}getMaxValue(s){const u=this.binders[s];return u instanceof ts||u instanceof kn?u.maxValue:0}populatePaintArrays(s,u,f,_,v){for(const w in this.binders){const E=this.binders[w];(E instanceof ts||E instanceof kn||E instanceof is)&&E.populatePaintArray(s,u,f,_,v)}}setConstantPatternPositions(s,u){for(const f in this.binders){const _=this.binders[f];_ instanceof po&&_.setConstantPatternPositions(s,u)}}updatePaintArrays(s,u,f,_,v){let w=!1;for(const E in s){const C=u.getPositions(E);for(const k of C){const F=f.feature(k.index);for(const L in this.binders){const U=this.binders[L];if((U instanceof ts||U instanceof kn||U instanceof is)&&U.expression.isStateDependent===!0){const W=_.paint.get(L);U.expression=W.value,U.updatePaintArray(k.start,k.end,F,s[E],v),w=!0}}}}return w}defines(){const s=[];for(const u in this.binders){const f=this.binders[u];(f instanceof es||f instanceof po)&&s.push(...f.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return s}getBinderAttributes(){const s=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof ts||f instanceof kn)for(let _=0;_<f.paintVertexAttributes.length;_++)s.push(f.paintVertexAttributes[_].name);else if(f instanceof is)for(let _=0;_<Qn.members.length;_++)s.push(Qn.members[_].name)}return s}getBinderUniforms(){const s=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof es||f instanceof po||f instanceof kn)for(const _ of f.uniformNames)s.push(_)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,u){const f=[];for(const _ in this.binders){const v=this.binders[_];if(v instanceof es||v instanceof po||v instanceof kn){for(const w of v.uniformNames)if(u[w]){const E=v.getBinding(s,u[w],w);f.push({name:w,property:_,binding:E})}}}return f}setUniforms(s,u,f,_){for(const{name:v,property:w,binding:E}of u)this.binders[w].setUniform(E,_,f.get(w),v)}updatePaintBuffers(s){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(s&&f instanceof is){const _=s.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(f instanceof ts||f instanceof kn)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(s){for(const u in this.binders){const f=this.binders[u];(f instanceof ts||f instanceof kn||f instanceof is)&&f.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const u=this.binders[s];(u instanceof ts||u instanceof kn||u instanceof is)&&u.destroy()}}}class bs{constructor(s,u,f=()=>!0){this.programConfigurations={};for(const _ of s)this.programConfigurations[_.id]=new Tu(_,u,f);this.needsUpload=!1,this._featureMap=new Di,this._bufferOffset=0}populatePaintArrays(s,u,f,_,v,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(s,u,_,v,w);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,u,f,_){for(const v of f)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(s,this._featureMap,u,v,_)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function DA(c,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}function F0(c,s,u){const f={color:{source:Vo,composite:te},number:{source:R,composite:Vo}},_=function(v){return{"line-pattern":{source:ii,composite:ii},"fill-pattern":{source:ii,composite:ii},"fill-extrusion-pattern":{source:ii,composite:ii}}[v]}(c);return _&&_[u]||f[s][u]}st("ConstantBinder",es),st("CrossFadedConstantBinder",po),st("SourceExpressionBinder",ts),st("CrossFadedCompositeBinder",is),st("CompositeExpressionBinder",kn),st("ProgramConfiguration",Tu,{omit:["_buffers"]}),st("ProgramConfigurationSet",bs);const Hi=8192,Ig=Math.pow(2,14)-1,D0=-Ig-1;function Ba(c){const s=Hi/c.extent,u=c.loadGeometry();for(let f=0;f<u.length;f++){const _=u[f];for(let v=0;v<_.length;v++){const w=_[v],E=Math.round(w.x*s),C=Math.round(w.y*s);w.x=Oe(E,D0,Ig),w.y=Oe(C,D0,Ig),(E<w.x||E>w.x+1||C<w.y||C>w.y+1)&&ot("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function za(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?Ba(c):[]}}function Rd(c,s,u,f,_){c.emplaceBack(2*s+(f+1)/2,2*u+(_+1)/2)}class Cg{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ht,this.indexArray=new dr,this.segments=new pi,this.programConfigurations=new bs(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){const _=this.layers[0],v=[];let w=null,E=!1;_.type==="circle"&&(w=_.layout.get("circle-sort-key"),E=!w.isConstant());for(const{feature:C,id:k,index:F,sourceLayerIndex:L}of s){const U=this.layers[0]._featureFilter.needGeometry,W=za(C,U);if(!this.layers[0]._featureFilter.filter(new fi(this.zoom),W,f))continue;const q=E?w.evaluate(W,{},f):void 0,Q={id:k,properties:C.properties,type:C.type,sourceLayerIndex:L,index:F,geometry:U?W.geometry:Ba(C),patterns:{},sortKey:q};v.push(Q)}E&&v.sort((C,k)=>C.sortKey-k.sortKey);for(const C of v){const{geometry:k,index:F,sourceLayerIndex:L}=C,U=s[F].feature;this.addFeature(C,k,F,f),u.featureIndex.insert(U,k,F,L,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,dn),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,u,f,_){for(const v of u)for(const w of v){const E=w.x,C=w.y;if(E<0||E>=Hi||C<0||C>=Hi)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),F=k.vertexLength;Rd(this.layoutVertexArray,E,C,-1,-1),Rd(this.layoutVertexArray,E,C,1,-1),Rd(this.layoutVertexArray,E,C,1,1),Rd(this.layoutVertexArray,E,C,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+3,F+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{},_)}}function N0(c,s){for(let u=0;u<c.length;u++)if(Bl(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(Bl(c,s[u]))return!0;return!!Rg(c,s)}function NA(c,s,u){return!!Bl(c,s)||!!Mg(s,c,u)}function L0(c,s){if(c.length===1)return z0(s,c[0]);for(let u=0;u<s.length;u++){const f=s[u];for(let _=0;_<f.length;_++)if(Bl(c,f[_]))return!0}for(let u=0;u<c.length;u++)if(z0(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(Rg(c,s[u]))return!0;return!1}function LA(c,s,u){if(c.length>1){if(Rg(c,s))return!0;for(let f=0;f<s.length;f++)if(Mg(s[f],c,u))return!0}for(let f=0;f<c.length;f++)if(Mg(c[f],s,u))return!0;return!1}function Rg(c,s){if(c.length===0||s.length===0)return!1;for(let u=0;u<c.length-1;u++){const f=c[u],_=c[u+1];for(let v=0;v<s.length-1;v++)if(BA(f,_,s[v],s[v+1]))return!0}return!1}function BA(c,s,u,f){return ei(c,u,f)!==ei(s,u,f)&&ei(c,s,u)!==ei(c,s,f)}function Mg(c,s,u){const f=u*u;if(s.length===1)return c.distSqr(s[0])<f;for(let _=1;_<s.length;_++)if(B0(c,s[_-1],s[_])<f)return!0;return!1}function B0(c,s,u){const f=s.distSqr(u);if(f===0)return c.distSqr(s);const _=((c.x-s.x)*(u.x-s.x)+(c.y-s.y)*(u.y-s.y))/f;return c.distSqr(_<0?s:_>1?u:u.sub(s)._mult(_)._add(s))}function z0(c,s){let u,f,_,v=!1;for(let w=0;w<c.length;w++){u=c[w];for(let E=0,C=u.length-1;E<u.length;C=E++)f=u[E],_=u[C],f.y>s.y!=_.y>s.y&&s.x<(_.x-f.x)*(s.y-f.y)/(_.y-f.y)+f.x&&(v=!v)}return v}function Bl(c,s){let u=!1;for(let f=0,_=c.length-1;f<c.length;_=f++){const v=c[f],w=c[_];v.y>s.y!=w.y>s.y&&s.x<(w.x-v.x)*(s.y-v.y)/(w.y-v.y)+v.x&&(u=!u)}return u}function zA(c,s,u){const f=u[0],_=u[2];if(c.x<f.x&&s.x<f.x||c.x>_.x&&s.x>_.x||c.y<f.y&&s.y<f.y||c.y>_.y&&s.y>_.y)return!1;const v=ei(c,s,u[0]);return v!==ei(c,s,u[1])||v!==ei(c,s,u[2])||v!==ei(c,s,u[3])}function Su(c,s,u){const f=s.paint.get(c).value;return f.kind==="constant"?f.value:u.programConfigurations.get(s.id).getMaxValue(c)}function Md(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function kd(c,s,u,f,_){if(!s[0]&&!s[1])return c;const v=P.convert(s)._mult(_);u==="viewport"&&v._rotate(-f);const w=[];for(let E=0;E<c.length;E++)w.push(c[E].sub(v));return w}let U0,V0;st("CircleBucket",Cg,{omit:["layers"]});var UA={get paint(){return V0=V0||new zi({"circle-radius":new wt(Fe.paint_circle["circle-radius"]),"circle-color":new wt(Fe.paint_circle["circle-color"]),"circle-blur":new wt(Fe.paint_circle["circle-blur"]),"circle-opacity":new wt(Fe.paint_circle["circle-opacity"]),"circle-translate":new _t(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new _t(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _t(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _t(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wt(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wt(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wt(Fe.paint_circle["circle-stroke-opacity"])})},get layout(){return U0=U0||new zi({"circle-sort-key":new wt(Fe.layout_circle["circle-sort-key"])})}},Wr=1e-6,zl=typeof Float32Array<"u"?Float32Array:Array;function kg(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function $0(c,s,u){var f=s[0],_=s[1],v=s[2],w=s[3],E=s[4],C=s[5],k=s[6],F=s[7],L=s[8],U=s[9],W=s[10],q=s[11],Q=s[12],ae=s[13],de=s[14],ve=s[15],ge=u[0],we=u[1],Pe=u[2],Be=u[3];return c[0]=ge*f+we*E+Pe*L+Be*Q,c[1]=ge*_+we*C+Pe*U+Be*ae,c[2]=ge*v+we*k+Pe*W+Be*de,c[3]=ge*w+we*F+Pe*q+Be*ve,c[4]=(ge=u[4])*f+(we=u[5])*E+(Pe=u[6])*L+(Be=u[7])*Q,c[5]=ge*_+we*C+Pe*U+Be*ae,c[6]=ge*v+we*k+Pe*W+Be*de,c[7]=ge*w+we*F+Pe*q+Be*ve,c[8]=(ge=u[8])*f+(we=u[9])*E+(Pe=u[10])*L+(Be=u[11])*Q,c[9]=ge*_+we*C+Pe*U+Be*ae,c[10]=ge*v+we*k+Pe*W+Be*de,c[11]=ge*w+we*F+Pe*q+Be*ve,c[12]=(ge=u[12])*f+(we=u[13])*E+(Pe=u[14])*L+(Be=u[15])*Q,c[13]=ge*_+we*C+Pe*U+Be*ae,c[14]=ge*v+we*k+Pe*W+Be*de,c[15]=ge*w+we*F+Pe*q+Be*ve,c}Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)});var Eu,VA=$0;function Od(c,s,u){var f=s[0],_=s[1],v=s[2],w=s[3];return c[0]=u[0]*f+u[4]*_+u[8]*v+u[12]*w,c[1]=u[1]*f+u[5]*_+u[9]*v+u[13]*w,c[2]=u[2]*f+u[6]*_+u[10]*v+u[14]*w,c[3]=u[3]*f+u[7]*_+u[11]*v+u[15]*w,c}Eu=new zl(4),zl!=Float32Array&&(Eu[0]=0,Eu[1]=0,Eu[2]=0,Eu[3]=0);class $A extends Mn{constructor(s){super(s,UA)}createBucket(s){return new Cg(s)}queryRadius(s){const u=s;return Su("circle-radius",this,u)+Su("circle-stroke-width",this,u)+Md(this.paint.get("circle-translate"))}queryIntersectsFeature(s,u,f,_,v,w,E,C){const k=kd(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,E),F=this.paint.get("circle-radius").evaluate(u,f)+this.paint.get("circle-stroke-width").evaluate(u,f),L=this.paint.get("circle-pitch-alignment")==="map",U=L?k:function(q,Q){return q.map(ae=>j0(ae,Q))}(k,C),W=L?F*E:F;for(const q of _)for(const Q of q){const ae=L?Q:j0(Q,C);let de=W;const ve=Od([],[Q.x,Q.y,0,1],C);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?de*=ve[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(de*=w.cameraToCenterDistance/ve[3]),NA(U,ae,de))return!0}return!1}}function j0(c,s){const u=Od([],[c.x,c.y,0,1],s);return new P(u[0]/u[3],u[1]/u[3])}class W0 extends Cg{}let H0;st("HeatmapBucket",W0,{omit:["layers"]});var jA={get paint(){return H0=H0||new zi({"heatmap-radius":new wt(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wt(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _t(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _u(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _t(Fe.paint_heatmap["heatmap-opacity"])})}};function Og(c,{width:s,height:u},f,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==s*u*f)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${s*u*f}`)}else _=new Uint8Array(s*u*f);return c.width=s,c.height=u,c.data=_,c}function q0(c,{width:s,height:u},f){if(s===c.width&&u===c.height)return;const _=Og({},{width:s,height:u},f);Fg(c,_,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,s),height:Math.min(c.height,u)},f),c.width=s,c.height=u,c.data=_.data}function Fg(c,s,u,f,_,v){if(_.width===0||_.height===0)return s;if(_.width>c.width||_.height>c.height||u.x>c.width-_.width||u.y>c.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||f.x>s.width-_.width||f.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const w=c.data,E=s.data;if(w===E)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<_.height;C++){const k=((u.y+C)*c.width+u.x)*v,F=((f.y+C)*s.width+f.x)*v;for(let L=0;L<_.width*v;L++)E[F+L]=w[k+L]}return s}class Au{constructor(s,u){Og(this,s,1,u)}resize(s){q0(this,s,1)}clone(){return new Au({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,f,_,v){Fg(s,u,f,_,v,1)}}class Vn{constructor(s,u){Og(this,s,4,u)}resize(s){q0(this,s,4)}replace(s,u){u?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new Vn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,f,_,v){Fg(s,u,f,_,v,4)}}function X0(c){const s={},u=c.resolution||256,f=c.clips?c.clips.length:1,_=c.image||new Vn({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const v=(w,E,C)=>{s[c.evaluationKey]=C;const k=c.expression.evaluate(s);_.data[w+E+0]=Math.floor(255*k.r/k.a),_.data[w+E+1]=Math.floor(255*k.g/k.a),_.data[w+E+2]=Math.floor(255*k.b/k.a),_.data[w+E+3]=Math.floor(255*k.a)};if(c.clips)for(let w=0,E=0;w<f;++w,E+=4*u)for(let C=0,k=0;C<u;C++,k+=4){const F=C/(u-1),{start:L,end:U}=c.clips[w];v(E,k,L*(1-F)+U*F)}else for(let w=0,E=0;w<u;w++,E+=4)v(0,E,w/(u-1));return _}st("AlphaImage",Au),st("RGBAImage",Vn);class WA extends Mn{createBucket(s){return new W0(s)}constructor(s){super(s,jA),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=X0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Z0;var HA={get paint(){return Z0=Z0||new zi({"hillshade-illumination-direction":new _t(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _t(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _t(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _t(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _t(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _t(Fe.paint_hillshade["hillshade-accent-color"])})}};class qA extends Mn{constructor(s){super(s,HA)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const XA=Ai([{name:"a_pos",components:2,type:"Int16"}],4),{members:ZA}=XA;var Dg={exports:{}};function Fd(c,s,u){u=u||2;var f,_,v,w,E,C,k,F=s&&s.length,L=F?s[0]*u:c.length,U=Y0(c,0,L,u,!0),W=[];if(!U||U.next===U.prev)return W;if(F&&(U=function(Q,ae,de,ve){var ge,we,Pe,Be=[];for(ge=0,we=ae.length;ge<we;ge++)(Pe=Y0(Q,ae[ge]*ve,ge<we-1?ae[ge+1]*ve:Q.length,ve,!1))===Pe.next&&(Pe.steiner=!0),Be.push(i2(Pe));for(Be.sort(QA),ge=0;ge<Be.length;ge++)de=e2(Be[ge],de);return de}(c,s,U,u)),c.length>80*u){f=v=c[0],_=w=c[1];for(var q=u;q<L;q+=u)(E=c[q])<f&&(f=E),(C=c[q+1])<_&&(_=C),E>v&&(v=E),C>w&&(w=C);k=(k=Math.max(v-f,w-_))!==0?32767/k:0}return Pu(U,W,u,f,_,k,0),W}function Y0(c,s,u,f,_){var v,w;if(_===Bg(c,s,u,f)>0)for(v=s;v<u;v+=f)w=J0(v,c[v],c[v+1],w);else for(v=u-f;v>=s;v-=f)w=J0(v,c[v],c[v+1],w);return w&&Dd(w,w.next)&&(Cu(w),w=w.next),w}function Ua(c,s){if(!c)return c;s||(s=c);var u,f=c;do if(u=!1,f.steiner||!Dd(f,f.next)&&Vi(f.prev,f,f.next)!==0)f=f.next;else{if(Cu(f),(f=s=f.prev)===f.next)break;u=!0}while(u||f!==s);return s}function Pu(c,s,u,f,_,v,w){if(c){!w&&v&&function(F,L,U,W){var q=F;do q.z===0&&(q.z=Ng(q.x,q.y,L,U,W)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==F);q.prevZ.nextZ=null,q.prevZ=null,function(Q){var ae,de,ve,ge,we,Pe,Be,nt,dt=1;do{for(de=Q,Q=null,we=null,Pe=0;de;){for(Pe++,ve=de,Be=0,ae=0;ae<dt&&(Be++,ve=ve.nextZ);ae++);for(nt=dt;Be>0||nt>0&&ve;)Be!==0&&(nt===0||!ve||de.z<=ve.z)?(ge=de,de=de.nextZ,Be--):(ge=ve,ve=ve.nextZ,nt--),we?we.nextZ=ge:Q=ge,ge.prevZ=we,we=ge;de=ve}we.nextZ=null,dt*=2}while(Pe>1)}(q)}(c,f,_,v);for(var E,C,k=c;c.prev!==c.next;)if(E=c.prev,C=c.next,v?KA(c,f,_,v):YA(c))s.push(E.i/u|0),s.push(c.i/u|0),s.push(C.i/u|0),Cu(c),c=C.next,k=C.next;else if((c=C)===k){w?w===1?Pu(c=GA(Ua(c),s,u),s,u,f,_,v,2):w===2&&JA(c,s,u,f,_,v):Pu(Ua(c),s,u,f,_,v,1);break}}}function YA(c){var s=c.prev,u=c,f=c.next;if(Vi(s,u,f)>=0)return!1;for(var _=s.x,v=u.x,w=f.x,E=s.y,C=u.y,k=f.y,F=_<v?_<w?_:w:v<w?v:w,L=E<C?E<k?E:k:C<k?C:k,U=_>v?_>w?_:w:v>w?v:w,W=E>C?E>k?E:k:C>k?C:k,q=f.next;q!==s;){if(q.x>=F&&q.x<=U&&q.y>=L&&q.y<=W&&Ul(_,E,v,C,w,k,q.x,q.y)&&Vi(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function KA(c,s,u,f){var _=c.prev,v=c,w=c.next;if(Vi(_,v,w)>=0)return!1;for(var E=_.x,C=v.x,k=w.x,F=_.y,L=v.y,U=w.y,W=E<C?E<k?E:k:C<k?C:k,q=F<L?F<U?F:U:L<U?L:U,Q=E>C?E>k?E:k:C>k?C:k,ae=F>L?F>U?F:U:L>U?L:U,de=Ng(W,q,s,u,f),ve=Ng(Q,ae,s,u,f),ge=c.prevZ,we=c.nextZ;ge&&ge.z>=de&&we&&we.z<=ve;){if(ge.x>=W&&ge.x<=Q&&ge.y>=q&&ge.y<=ae&&ge!==_&&ge!==w&&Ul(E,F,C,L,k,U,ge.x,ge.y)&&Vi(ge.prev,ge,ge.next)>=0||(ge=ge.prevZ,we.x>=W&&we.x<=Q&&we.y>=q&&we.y<=ae&&we!==_&&we!==w&&Ul(E,F,C,L,k,U,we.x,we.y)&&Vi(we.prev,we,we.next)>=0))return!1;we=we.nextZ}for(;ge&&ge.z>=de;){if(ge.x>=W&&ge.x<=Q&&ge.y>=q&&ge.y<=ae&&ge!==_&&ge!==w&&Ul(E,F,C,L,k,U,ge.x,ge.y)&&Vi(ge.prev,ge,ge.next)>=0)return!1;ge=ge.prevZ}for(;we&&we.z<=ve;){if(we.x>=W&&we.x<=Q&&we.y>=q&&we.y<=ae&&we!==_&&we!==w&&Ul(E,F,C,L,k,U,we.x,we.y)&&Vi(we.prev,we,we.next)>=0)return!1;we=we.nextZ}return!0}function GA(c,s,u){var f=c;do{var _=f.prev,v=f.next.next;!Dd(_,v)&&K0(_,f,f.next,v)&&Iu(_,v)&&Iu(v,_)&&(s.push(_.i/u|0),s.push(f.i/u|0),s.push(v.i/u|0),Cu(f),Cu(f.next),f=c=v),f=f.next}while(f!==c);return Ua(f)}function JA(c,s,u,f,_,v){var w=c;do{for(var E=w.next.next;E!==w.prev;){if(w.i!==E.i&&r2(w,E)){var C=G0(w,E);return w=Ua(w,w.next),C=Ua(C,C.next),Pu(w,s,u,f,_,v,0),void Pu(C,s,u,f,_,v,0)}E=E.next}w=w.next}while(w!==c)}function QA(c,s){return c.x-s.x}function e2(c,s){var u=function(_,v){var w,E=v,C=_.x,k=_.y,F=-1/0;do{if(k<=E.y&&k>=E.next.y&&E.next.y!==E.y){var L=E.x+(k-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(L<=C&&L>F&&(F=L,w=E.x<E.next.x?E:E.next,L===C))return w}E=E.next}while(E!==v);if(!w)return null;var U,W=w,q=w.x,Q=w.y,ae=1/0;E=w;do C>=E.x&&E.x>=q&&C!==E.x&&Ul(k<Q?C:F,k,q,Q,k<Q?F:C,k,E.x,E.y)&&(U=Math.abs(k-E.y)/(C-E.x),Iu(E,_)&&(U<ae||U===ae&&(E.x>w.x||E.x===w.x&&t2(w,E)))&&(w=E,ae=U)),E=E.next;while(E!==W);return w}(c,s);if(!u)return s;var f=G0(u,c);return Ua(f,f.next),Ua(u,u.next)}function t2(c,s){return Vi(c.prev,c,s.prev)<0&&Vi(s.next,c,c.next)<0}function Ng(c,s,u,f,_){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-u)*_|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-f)*_|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function i2(c){var s=c,u=c;do(s.x<u.x||s.x===u.x&&s.y<u.y)&&(u=s),s=s.next;while(s!==c);return u}function Ul(c,s,u,f,_,v,w,E){return(_-w)*(s-E)>=(c-w)*(v-E)&&(c-w)*(f-E)>=(u-w)*(s-E)&&(u-w)*(v-E)>=(_-w)*(f-E)}function r2(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(u,f){var _=u;do{if(_.i!==u.i&&_.next.i!==u.i&&_.i!==f.i&&_.next.i!==f.i&&K0(_,_.next,u,f))return!0;_=_.next}while(_!==u);return!1}(c,s)&&(Iu(c,s)&&Iu(s,c)&&function(u,f){var _=u,v=!1,w=(u.x+f.x)/2,E=(u.y+f.y)/2;do _.y>E!=_.next.y>E&&_.next.y!==_.y&&w<(_.next.x-_.x)*(E-_.y)/(_.next.y-_.y)+_.x&&(v=!v),_=_.next;while(_!==u);return v}(c,s)&&(Vi(c.prev,c,s.prev)||Vi(c,s.prev,s))||Dd(c,s)&&Vi(c.prev,c,c.next)>0&&Vi(s.prev,s,s.next)>0)}function Vi(c,s,u){return(s.y-c.y)*(u.x-s.x)-(s.x-c.x)*(u.y-s.y)}function Dd(c,s){return c.x===s.x&&c.y===s.y}function K0(c,s,u,f){var _=Ld(Vi(c,s,u)),v=Ld(Vi(c,s,f)),w=Ld(Vi(u,f,c)),E=Ld(Vi(u,f,s));return _!==v&&w!==E||!(_!==0||!Nd(c,u,s))||!(v!==0||!Nd(c,f,s))||!(w!==0||!Nd(u,c,f))||!(E!==0||!Nd(u,s,f))}function Nd(c,s,u){return s.x<=Math.max(c.x,u.x)&&s.x>=Math.min(c.x,u.x)&&s.y<=Math.max(c.y,u.y)&&s.y>=Math.min(c.y,u.y)}function Ld(c){return c>0?1:c<0?-1:0}function Iu(c,s){return Vi(c.prev,c,c.next)<0?Vi(c,s,c.next)>=0&&Vi(c,c.prev,s)>=0:Vi(c,s,c.prev)<0||Vi(c,c.next,s)<0}function G0(c,s){var u=new Lg(c.i,c.x,c.y),f=new Lg(s.i,s.x,s.y),_=c.next,v=s.prev;return c.next=s,s.prev=c,u.next=_,_.prev=u,f.next=u,u.prev=f,v.next=f,f.prev=v,f}function J0(c,s,u,f){var _=new Lg(c,s,u);return f?(_.next=f.next,_.prev=f,f.next.prev=_,f.next=_):(_.prev=_,_.next=_),_}function Cu(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Lg(c,s,u){this.i=c,this.x=s,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bg(c,s,u,f){for(var _=0,v=s,w=u-f;v<u;v+=f)_+=(c[w]-c[v])*(c[v+1]+c[w+1]),w=v;return _}Dg.exports=Fd,Dg.exports.default=Fd,Fd.deviation=function(c,s,u,f){var _=s&&s.length,v=Math.abs(Bg(c,0,_?s[0]*u:c.length,u));if(_)for(var w=0,E=s.length;w<E;w++)v-=Math.abs(Bg(c,s[w]*u,w<E-1?s[w+1]*u:c.length,u));var C=0;for(w=0;w<f.length;w+=3){var k=f[w]*u,F=f[w+1]*u,L=f[w+2]*u;C+=Math.abs((c[k]-c[L])*(c[F+1]-c[k+1])-(c[k]-c[F])*(c[L+1]-c[k+1]))}return v===0&&C===0?0:Math.abs((C-v)/v)},Fd.flatten=function(c){for(var s=c[0][0].length,u={vertices:[],holes:[],dimensions:s},f=0,_=0;_<c.length;_++){for(var v=0;v<c[_].length;v++)for(var w=0;w<s;w++)u.vertices.push(c[_][v][w]);_>0&&u.holes.push(f+=c[_-1].length)}return u};var Q0=y(Dg.exports);function n2(c,s,u,f,_){ex(c,s,u||0,f||c.length-1,_||s2)}function ex(c,s,u,f,_){for(;f>u;){if(f-u>600){var v=f-u+1,w=s-u+1,E=Math.log(v),C=.5*Math.exp(2*E/3),k=.5*Math.sqrt(E*C*(v-C)/v)*(w-v/2<0?-1:1);ex(c,s,Math.max(u,Math.floor(s-w*C/v+k)),Math.min(f,Math.floor(s+(v-w)*C/v+k)),_)}var F=c[s],L=u,U=f;for(Ru(c,u,s),_(c[f],F)>0&&Ru(c,u,f);L<U;){for(Ru(c,L,U),L++,U--;_(c[L],F)<0;)L++;for(;_(c[U],F)>0;)U--}_(c[u],F)===0?Ru(c,u,U):Ru(c,++U,f),U<=s&&(u=U+1),s<=U&&(f=U-1)}}function Ru(c,s,u){var f=c[s];c[s]=c[u],c[u]=f}function s2(c,s){return c<s?-1:c>s?1:0}function zg(c,s){const u=c.length;if(u<=1)return[c];const f=[];let _,v;for(let w=0;w<u;w++){const E=rn(c[w]);E!==0&&(c[w].area=Math.abs(E),v===void 0&&(v=E<0),v===E<0?(_&&f.push(_),_=[c[w]]):_.push(c[w]))}if(_&&f.push(_),s>1)for(let w=0;w<f.length;w++)f[w].length<=s||(n2(f[w],s,1,f[w].length-1,o2),f[w]=f[w].slice(0,s));return f}function o2(c,s){return s.area-c.area}function Ug(c,s,u){const f=u.patternDependencies;let _=!1;for(const v of s){const w=v.paint.get(`${c}-pattern`);w.isConstant()||(_=!0);const E=w.constantOr(null);E&&(_=!0,f[E.to]=!0,f[E.from]=!0)}return _}function Vg(c,s,u,f,_){const v=_.patternDependencies;for(const w of s){const E=w.paint.get(`${c}-pattern`).value;if(E.kind!=="constant"){let C=E.evaluate({zoom:f-1},u,{},_.availableImages),k=E.evaluate({zoom:f},u,{},_.availableImages),F=E.evaluate({zoom:f+1},u,{},_.availableImages);C=C&&C.name?C.name:C,k=k&&k.name?k.name:k,F=F&&F.name?F.name:F,v[C]=!0,v[k]=!0,v[F]=!0,u.patterns[w.id]={min:C,mid:k,max:F}}}return u}class $g{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Nt,this.indexArray=new dr,this.indexArray2=new Ki,this.programConfigurations=new bs(s.layers,s.zoom),this.segments=new pi,this.segments2=new pi,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.hasPattern=Ug("fill",this.layers,u);const _=this.layers[0].layout.get("fill-sort-key"),v=!_.isConstant(),w=[];for(const{feature:E,id:C,index:k,sourceLayerIndex:F}of s){const L=this.layers[0]._featureFilter.needGeometry,U=za(E,L);if(!this.layers[0]._featureFilter.filter(new fi(this.zoom),U,f))continue;const W=v?_.evaluate(U,{},f,u.availableImages):void 0,q={id:C,properties:E.properties,type:E.type,sourceLayerIndex:F,index:k,geometry:L?U.geometry:Ba(E),patterns:{},sortKey:W};w.push(q)}v&&w.sort((E,C)=>E.sortKey-C.sortKey);for(const E of w){const{geometry:C,index:k,sourceLayerIndex:F}=E;if(this.hasPattern){const L=Vg("fill",this.layers,E,this.zoom,u);this.patternFeatures.push(L)}else this.addFeature(E,C,k,f,{});u.featureIndex.insert(s[k].feature,C,k,F,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}addFeatures(s,u,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ZA),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,u,f,_,v){for(const w of zg(u,500)){let E=0;for(const W of w)E+=W.length;const C=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),k=C.vertexLength,F=[],L=[];for(const W of w){if(W.length===0)continue;W!==w[0]&&L.push(F.length/2);const q=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),Q=q.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(Q+W.length-1,Q),F.push(W[0].x),F.push(W[0].y);for(let ae=1;ae<W.length;ae++)this.layoutVertexArray.emplaceBack(W[ae].x,W[ae].y),this.indexArray2.emplaceBack(Q+ae-1,Q+ae),F.push(W[ae].x),F.push(W[ae].y);q.vertexLength+=W.length,q.primitiveLength+=W.length}const U=Q0(F,L);for(let W=0;W<U.length;W+=3)this.indexArray.emplaceBack(k+U[W],k+U[W+1],k+U[W+2]);C.vertexLength+=E,C.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,v,_)}}let tx,ix;st("FillBucket",$g,{omit:["layers","patternFeatures"]});var a2={get paint(){return ix=ix||new zi({"fill-antialias":new _t(Fe.paint_fill["fill-antialias"]),"fill-opacity":new wt(Fe.paint_fill["fill-opacity"]),"fill-color":new wt(Fe.paint_fill["fill-color"]),"fill-outline-color":new wt(Fe.paint_fill["fill-outline-color"]),"fill-translate":new _t(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new _t(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Da(Fe.paint_fill["fill-pattern"])})},get layout(){return tx=tx||new zi({"fill-sort-key":new wt(Fe.layout_fill["fill-sort-key"])})}};class l2 extends Mn{constructor(s){super(s,a2)}recalculate(s,u){super.recalculate(s,u);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new $g(s)}queryRadius(){return Md(this.paint.get("fill-translate"))}queryIntersectsFeature(s,u,f,_,v,w,E){return L0(kd(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,E),_)}isTileClipped(){return!0}}const c2=Ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),u2=Ai([{name:"a_centroid",components:2,type:"Int16"}],4),{members:h2}=c2;var jo={},d2=T,rx=Vl;function Vl(c,s,u,f,_){this.properties={},this.extent=u,this.type=0,this._pbf=c,this._geometry=-1,this._keys=f,this._values=_,c.readFields(f2,this,s)}function f2(c,s,u){c==1?s.id=u.readVarint():c==2?function(f,_){for(var v=f.readVarint()+f.pos;f.pos<v;){var w=_._keys[f.readVarint()],E=_._values[f.readVarint()];_.properties[w]=E}}(u,s):c==3?s.type=u.readVarint():c==4&&(s._geometry=u.pos)}function p2(c){for(var s,u,f=0,_=0,v=c.length,w=v-1;_<v;w=_++)f+=((u=c[w]).x-(s=c[_]).x)*(s.y+u.y);return f}Vl.types=["Unknown","Point","LineString","Polygon"],Vl.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var s,u=c.readVarint()+c.pos,f=1,_=0,v=0,w=0,E=[];c.pos<u;){if(_<=0){var C=c.readVarint();f=7&C,_=C>>3}if(_--,f===1||f===2)v+=c.readSVarint(),w+=c.readSVarint(),f===1&&(s&&E.push(s),s=[]),s.push(new d2(v,w));else{if(f!==7)throw new Error("unknown command "+f);s&&s.push(s[0].clone())}}return s&&E.push(s),E},Vl.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var s=c.readVarint()+c.pos,u=1,f=0,_=0,v=0,w=1/0,E=-1/0,C=1/0,k=-1/0;c.pos<s;){if(f<=0){var F=c.readVarint();u=7&F,f=F>>3}if(f--,u===1||u===2)(_+=c.readSVarint())<w&&(w=_),_>E&&(E=_),(v+=c.readSVarint())<C&&(C=v),v>k&&(k=v);else if(u!==7)throw new Error("unknown command "+u)}return[w,C,E,k]},Vl.prototype.toGeoJSON=function(c,s,u){var f,_,v=this.extent*Math.pow(2,u),w=this.extent*c,E=this.extent*s,C=this.loadGeometry(),k=Vl.types[this.type];function F(W){for(var q=0;q<W.length;q++){var Q=W[q];W[q]=[360*(Q.x+w)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+E)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(f=0;f<C.length;f++)L[f]=C[f][0];F(C=L);break;case 2:for(f=0;f<C.length;f++)F(C[f]);break;case 3:for(C=function(W){var q=W.length;if(q<=1)return[W];for(var Q,ae,de=[],ve=0;ve<q;ve++){var ge=p2(W[ve]);ge!==0&&(ae===void 0&&(ae=ge<0),ae===ge<0?(Q&&de.push(Q),Q=[W[ve]]):Q.push(W[ve]))}return Q&&de.push(Q),de}(C),f=0;f<C.length;f++)for(_=0;_<C[f].length;_++)F(C[f][_])}C.length===1?C=C[0]:k="Multi"+k;var U={type:"Feature",geometry:{type:k,coordinates:C},properties:this.properties};return"id"in this&&(U.id=this.id),U};var g2=rx,nx=sx;function sx(c,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(_2,this,s),this.length=this._features.length}function _2(c,s,u){c===15?s.version=u.readVarint():c===1?s.name=u.readString():c===5?s.extent=u.readVarint():c===2?s._features.push(u.pos):c===3?s._keys.push(u.readString()):c===4&&s._values.push(function(f){for(var _=null,v=f.readVarint()+f.pos;f.pos<v;){var w=f.readVarint()>>3;_=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return _}(u))}sx.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var s=this._pbf.readVarint()+this._pbf.pos;return new g2(this._pbf,s,this.extent,this._keys,this._values)};var m2=nx;function y2(c,s,u){if(c===3){var f=new m2(u,u.readVarint()+u.pos);f.length&&(s[f.name]=f)}}jo.VectorTile=function(c,s){this.layers=c.readFields(y2,{},s)},jo.VectorTileFeature=rx,jo.VectorTileLayer=nx;const x2=jo.VectorTileFeature.types,jg=Math.pow(2,13);function Mu(c,s,u,f,_,v,w,E){c.emplaceBack(s,u,2*Math.floor(f*jg)+w,_*jg*2,v*jg*2,Math.round(E))}class Wg{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new Qe,this.centroidVertexArray=new Xe,this.indexArray=new dr,this.programConfigurations=new bs(s.layers,s.zoom),this.segments=new pi,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.features=[],this.hasPattern=Ug("fill-extrusion",this.layers,u);for(const{feature:_,id:v,index:w,sourceLayerIndex:E}of s){const C=this.layers[0]._featureFilter.needGeometry,k=za(_,C);if(!this.layers[0]._featureFilter.filter(new fi(this.zoom),k,f))continue;const F={id:v,sourceLayerIndex:E,index:w,geometry:C?k.geometry:Ba(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(Vg("fill-extrusion",this.layers,F,this.zoom,u)):this.addFeature(F,F.geometry,w,f,{}),u.featureIndex.insert(_,F.geometry,w,E,this.index,!0)}}addFeatures(s,u,f){for(const _ of this.features){const{geometry:v}=_;this.addFeature(_,v,_.index,u,f)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,h2),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,u2.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,u,f,_,v){const w={x:0,y:0,vertexCount:0};for(const E of zg(u,500)){let C=0;for(const q of E)C+=q.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const q of E){if(q.length===0||b2(q))continue;let Q=0;for(let ae=0;ae<q.length;ae++){const de=q[ae];if(ae>=1){const ve=q[ae-1];if(!v2(de,ve)){k.vertexLength+4>pi.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ge=de.sub(ve)._perp()._unit(),we=ve.dist(de);Q+we>32768&&(Q=0),Mu(this.layoutVertexArray,de.x,de.y,ge.x,ge.y,0,0,Q),Mu(this.layoutVertexArray,de.x,de.y,ge.x,ge.y,0,1,Q),w.x+=2*de.x,w.y+=2*de.y,w.vertexCount+=2,Q+=we,Mu(this.layoutVertexArray,ve.x,ve.y,ge.x,ge.y,0,0,Q),Mu(this.layoutVertexArray,ve.x,ve.y,ge.x,ge.y,0,1,Q),w.x+=2*ve.x,w.y+=2*ve.y,w.vertexCount+=2;const Pe=k.vertexLength;this.indexArray.emplaceBack(Pe,Pe+2,Pe+1),this.indexArray.emplaceBack(Pe+1,Pe+2,Pe+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+C>pi.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),x2[s.type]!=="Polygon")continue;const F=[],L=[],U=k.vertexLength;for(const q of E)if(q.length!==0){q!==E[0]&&L.push(F.length/2);for(let Q=0;Q<q.length;Q++){const ae=q[Q];Mu(this.layoutVertexArray,ae.x,ae.y,0,0,1,1,0),w.x+=ae.x,w.y+=ae.y,w.vertexCount+=1,F.push(ae.x),F.push(ae.y)}}const W=Q0(F,L);for(let q=0;q<W.length;q+=3)this.indexArray.emplaceBack(U+W[q],U+W[q+2],U+W[q+1]);k.primitiveLength+=W.length/3,k.vertexLength+=C}for(let E=0;E<w.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,v,_)}}function v2(c,s){return c.x===s.x&&(c.x<0||c.x>Hi)||c.y===s.y&&(c.y<0||c.y>Hi)}function b2(c){return c.every(s=>s.x<0)||c.every(s=>s.x>Hi)||c.every(s=>s.y<0)||c.every(s=>s.y>Hi)}let ox;st("FillExtrusionBucket",Wg,{omit:["layers","features"]});var w2={get paint(){return ox=ox||new zi({"fill-extrusion-opacity":new _t(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wt(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _t(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _t(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Da(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wt(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wt(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _t(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class T2 extends Mn{constructor(s){super(s,w2)}createBucket(s){return new Wg(s)}queryRadius(){return Md(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,u,f,_,v,w,E,C){const k=kd(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,E),F=this.paint.get("fill-extrusion-height").evaluate(u,f),L=this.paint.get("fill-extrusion-base").evaluate(u,f),U=function(q,Q,ae,de){const ve=[];for(const ge of q){const we=[ge.x,ge.y,0,1];Od(we,we,Q),ve.push(new P(we[0]/we[3],we[1]/we[3]))}return ve}(k,C),W=function(q,Q,ae,de){const ve=[],ge=[],we=de[8]*Q,Pe=de[9]*Q,Be=de[10]*Q,nt=de[11]*Q,dt=de[8]*ae,it=de[9]*ae,et=de[10]*ae,Ye=de[11]*ae;for(const at of q){const Ge=[],He=[];for(const bt of at){const gt=bt.x,kt=bt.y,gi=de[0]*gt+de[4]*kt+de[12],bi=de[1]*gt+de[5]*kt+de[13],Qi=de[2]*gt+de[6]*kt+de[14],On=de[3]*gt+de[7]*kt+de[15],Hr=Qi+Be,qi=On+nt,pr=gi+dt,wr=bi+it,qr=Qi+et,Xr=On+Ye,er=new P((gi+we)/qi,(bi+Pe)/qi);er.z=Hr/qi,Ge.push(er);const tr=new P(pr/Xr,wr/Xr);tr.z=qr/Xr,He.push(tr)}ve.push(Ge),ge.push(He)}return[ve,ge]}(_,L,F,C);return function(q,Q,ae){let de=1/0;L0(ae,Q)&&(de=ax(ae,Q[0]));for(let ve=0;ve<Q.length;ve++){const ge=Q[ve],we=q[ve];for(let Pe=0;Pe<ge.length-1;Pe++){const Be=ge[Pe],nt=[Be,ge[Pe+1],we[Pe+1],we[Pe],Be];N0(ae,nt)&&(de=Math.min(de,ax(ae,nt)))}}return de!==1/0&&de}(W[0],W[1],U)}}function ku(c,s){return c.x*s.x+c.y*s.y}function ax(c,s){if(c.length===1){let u=0;const f=s[u++];let _;for(;!_||f.equals(_);)if(_=s[u++],!_)return 1/0;for(;u<s.length;u++){const v=s[u],w=c[0],E=_.sub(f),C=v.sub(f),k=w.sub(f),F=ku(E,E),L=ku(E,C),U=ku(C,C),W=ku(k,E),q=ku(k,C),Q=F*U-L*L,ae=(U*W-L*q)/Q,de=(F*q-L*W)/Q,ve=f.z*(1-ae-de)+_.z*ae+v.z*de;if(isFinite(ve))return ve}return 1/0}{let u=1/0;for(const f of s)u=Math.min(u,f.z);return u}}const S2=Ai([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:E2}=S2,A2=Ai([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:P2}=A2,I2=jo.VectorTileFeature.types,C2=Math.cos(Math.PI/180*37.5),lx=Math.pow(2,14)/.5;class Hg{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Tt,this.layoutVertexArray2=new ft,this.indexArray=new dr,this.programConfigurations=new bs(s.layers,s.zoom),this.segments=new pi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.hasPattern=Ug("line",this.layers,u);const _=this.layers[0].layout.get("line-sort-key"),v=!_.isConstant(),w=[];for(const{feature:E,id:C,index:k,sourceLayerIndex:F}of s){const L=this.layers[0]._featureFilter.needGeometry,U=za(E,L);if(!this.layers[0]._featureFilter.filter(new fi(this.zoom),U,f))continue;const W=v?_.evaluate(U,{},f):void 0,q={id:C,properties:E.properties,type:E.type,sourceLayerIndex:F,index:k,geometry:L?U.geometry:Ba(E),patterns:{},sortKey:W};w.push(q)}v&&w.sort((E,C)=>E.sortKey-C.sortKey);for(const E of w){const{geometry:C,index:k,sourceLayerIndex:F}=E;if(this.hasPattern){const L=Vg("line",this.layers,E,this.zoom,u);this.patternFeatures.push(L)}else this.addFeature(E,C,k,f,{});u.featureIndex.insert(s[k].feature,C,k,F,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}addFeatures(s,u,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,P2)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,E2),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,u,f,_,v){const w=this.layers[0].layout,E=w.get("line-join").evaluate(s,{}),C=w.get("line-cap"),k=w.get("line-miter-limit"),F=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const L of u)this.addLine(L,s,E,C,k,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,v,_)}addLine(s,u,f,_,v,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<s.length-1;de++)this.totalDistance+=s[de].dist(s[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=I2[u.type]==="Polygon";let C=s.length;for(;C>=2&&s[C-1].equals(s[C-2]);)C--;let k=0;for(;k<C-1&&s[k].equals(s[k+1]);)k++;if(C<(E?3:2))return;f==="bevel"&&(v=1.05);const F=this.overscaling<=16?15*Hi/(512*this.overscaling):0,L=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let U,W,q,Q,ae;this.e1=this.e2=-1,E&&(U=s[C-2],ae=s[k].sub(U)._unit()._perp());for(let de=k;de<C;de++){if(q=de===C-1?E?s[k+1]:void 0:s[de+1],q&&s[de].equals(q))continue;ae&&(Q=ae),U&&(W=U),U=s[de],ae=q?q.sub(U)._unit()._perp():Q,Q=Q||ae;let ve=Q.add(ae);ve.x===0&&ve.y===0||ve._unit();const ge=Q.x*ae.x+Q.y*ae.y,we=ve.x*ae.x+ve.y*ae.y,Pe=we!==0?1/we:1/0,Be=2*Math.sqrt(2-2*we),nt=we<C2&&W&&q,dt=Q.x*ae.y-Q.y*ae.x>0;if(nt&&de>k){const Ye=U.dist(W);if(Ye>2*F){const at=U.sub(U.sub(W)._mult(F/Ye)._round());this.updateDistance(W,at),this.addCurrentVertex(at,Q,0,0,L),W=at}}const it=W&&q;let et=it?f:E?"butt":_;if(it&&et==="round"&&(Pe<w?et="miter":Pe<=2&&(et="fakeround")),et==="miter"&&Pe>v&&(et="bevel"),et==="bevel"&&(Pe>2&&(et="flipbevel"),Pe<v&&(et="miter")),W&&this.updateDistance(W,U),et==="miter")ve._mult(Pe),this.addCurrentVertex(U,ve,0,0,L);else if(et==="flipbevel"){if(Pe>100)ve=ae.mult(-1);else{const Ye=Pe*Q.add(ae).mag()/Q.sub(ae).mag();ve._perp()._mult(Ye*(dt?-1:1))}this.addCurrentVertex(U,ve,0,0,L),this.addCurrentVertex(U,ve.mult(-1),0,0,L)}else if(et==="bevel"||et==="fakeround"){const Ye=-Math.sqrt(Pe*Pe-1),at=dt?Ye:0,Ge=dt?0:Ye;if(W&&this.addCurrentVertex(U,Q,at,Ge,L),et==="fakeround"){const He=Math.round(180*Be/Math.PI/20);for(let bt=1;bt<He;bt++){let gt=bt/He;if(gt!==.5){const gi=gt-.5;gt+=gt*gi*(gt-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*gi*gi+(.848013+ge*(.215638*ge-1.06021)))}const kt=ae.sub(Q)._mult(gt)._add(Q)._unit()._mult(dt?-1:1);this.addHalfVertex(U,kt.x,kt.y,!1,dt,0,L)}}q&&this.addCurrentVertex(U,ae,-at,-Ge,L)}else if(et==="butt")this.addCurrentVertex(U,ve,0,0,L);else if(et==="square"){const Ye=W?1:-1;this.addCurrentVertex(U,ve,Ye,Ye,L)}else et==="round"&&(W&&(this.addCurrentVertex(U,Q,0,0,L),this.addCurrentVertex(U,Q,1,1,L,!0)),q&&(this.addCurrentVertex(U,ae,-1,-1,L,!0),this.addCurrentVertex(U,ae,0,0,L)));if(nt&&de<C-1){const Ye=U.dist(q);if(Ye>2*F){const at=U.add(q.sub(U)._mult(F/Ye)._round());this.updateDistance(U,at),this.addCurrentVertex(at,ae,0,0,L),U=at}}}}addCurrentVertex(s,u,f,_,v,w=!1){const E=u.y*_-u.x,C=-u.y-u.x*_;this.addHalfVertex(s,u.x+u.y*f,u.y-u.x*f,w,!1,f,v),this.addHalfVertex(s,E,C,w,!0,-_,v),this.distance>lx/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,u,f,_,v,w))}addHalfVertex({x:s,y:u},f,_,v,w,E,C){const k=.5*(this.lineClips?this.scaledDistance*(lx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(v?1:0),(u<<1)+(w?1:0),Math.round(63*f)+128,Math.round(63*_)+128,1+(E===0?0:E<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const F=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),C.primitiveLength++),w?this.e2=F:this.e1=F}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,u){this.distance+=s.dist(u),this.updateScaledDistance()}}let cx,ux;st("LineBucket",Hg,{omit:["layers","patternFeatures"]});var hx={get paint(){return ux=ux||new zi({"line-opacity":new wt(Fe.paint_line["line-opacity"]),"line-color":new wt(Fe.paint_line["line-color"]),"line-translate":new _t(Fe.paint_line["line-translate"]),"line-translate-anchor":new _t(Fe.paint_line["line-translate-anchor"]),"line-width":new wt(Fe.paint_line["line-width"]),"line-gap-width":new wt(Fe.paint_line["line-gap-width"]),"line-offset":new wt(Fe.paint_line["line-offset"]),"line-blur":new wt(Fe.paint_line["line-blur"]),"line-dasharray":new gu(Fe.paint_line["line-dasharray"]),"line-pattern":new Da(Fe.paint_line["line-pattern"]),"line-gradient":new _u(Fe.paint_line["line-gradient"])})},get layout(){return cx=cx||new zi({"line-cap":new _t(Fe.layout_line["line-cap"]),"line-join":new wt(Fe.layout_line["line-join"]),"line-miter-limit":new _t(Fe.layout_line["line-miter-limit"]),"line-round-limit":new _t(Fe.layout_line["line-round-limit"]),"line-sort-key":new wt(Fe.layout_line["line-sort-key"])})}};class R2 extends wt{possiblyEvaluate(s,u){return u=new fi(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(s,u)}evaluate(s,u,f,_){return u=ke({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(s,u,f,_)}}let Bd;class M2 extends Mn{constructor(s){super(s,hx),this.gradientVersion=0,Bd||(Bd=new R2(hx.paint.properties["line-width"].specification),Bd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof Ds,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,u){super.recalculate(s,u),this.paint._values["line-floorwidth"]=Bd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Hg(s)}queryRadius(s){const u=s,f=dx(Su("line-width",this,u),Su("line-gap-width",this,u)),_=Su("line-offset",this,u);return f/2+Math.abs(_)+Md(this.paint.get("line-translate"))}queryIntersectsFeature(s,u,f,_,v,w,E){const C=kd(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,E),k=E/2*dx(this.paint.get("line-width").evaluate(u,f),this.paint.get("line-gap-width").evaluate(u,f)),F=this.paint.get("line-offset").evaluate(u,f);return F&&(_=function(L,U){const W=[];for(let q=0;q<L.length;q++){const Q=L[q],ae=[];for(let de=0;de<Q.length;de++){const ve=Q[de-1],ge=Q[de],we=Q[de+1],Pe=de===0?new P(0,0):ge.sub(ve)._unit()._perp(),Be=de===Q.length-1?new P(0,0):we.sub(ge)._unit()._perp(),nt=Pe._add(Be)._unit(),dt=nt.x*Be.x+nt.y*Be.y;dt!==0&&nt._mult(1/dt),ae.push(nt._mult(U)._add(ge))}W.push(ae)}return W}(_,F*E)),function(L,U,W){for(let q=0;q<U.length;q++){const Q=U[q];if(L.length>=3){for(let ae=0;ae<Q.length;ae++)if(Bl(L,Q[ae]))return!0}if(LA(L,Q,W))return!0}return!1}(C,_,k)}isTileClipped(){return!0}}function dx(c,s){return s>0?s+2*c:c}const k2=Ai([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),O2=Ai([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ai([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const F2=Ai([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ai([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const fx=Ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),D2=Ai([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function N2(c,s,u){return c.sections.forEach(f=>{f.text=function(_,v,w){const E=v.layout.get("text-transform").evaluate(w,{});return E==="uppercase"?_=_.toLocaleUpperCase():E==="lowercase"&&(_=_.toLocaleLowerCase()),hn.applyArabicShaping&&(_=hn.applyArabicShaping(_)),_}(f.text,s,u)}),c}Ai([{name:"triangle",components:3,type:"Uint16"}]),Ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ai([{type:"Float32",name:"offsetX"}]),Ai([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ai([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ou={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Ji=24,px=ni,gx=function(c,s,u,f,_){var v,w,E=8*_-f-1,C=(1<<E)-1,k=C>>1,F=-7,L=u?_-1:0,U=u?-1:1,W=c[s+L];for(L+=U,v=W&(1<<-F)-1,W>>=-F,F+=E;F>0;v=256*v+c[s+L],L+=U,F-=8);for(w=v&(1<<-F)-1,v>>=-F,F+=f;F>0;w=256*w+c[s+L],L+=U,F-=8);if(v===0)v=1-k;else{if(v===C)return w?NaN:1/0*(W?-1:1);w+=Math.pow(2,f),v-=k}return(W?-1:1)*w*Math.pow(2,v-f)},_x=function(c,s,u,f,_,v){var w,E,C,k=8*v-_-1,F=(1<<k)-1,L=F>>1,U=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=f?0:v-1,q=f?1:-1,Q=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(E=isNaN(s)?1:0,w=F):(w=Math.floor(Math.log(s)/Math.LN2),s*(C=Math.pow(2,-w))<1&&(w--,C*=2),(s+=w+L>=1?U/C:U*Math.pow(2,1-L))*C>=2&&(w++,C/=2),w+L>=F?(E=0,w=F):w+L>=1?(E=(s*C-1)*Math.pow(2,_),w+=L):(E=s*Math.pow(2,L-1)*Math.pow(2,_),w=0));_>=8;c[u+W]=255&E,W+=q,E/=256,_-=8);for(w=w<<_|E,k+=_;k>0;c[u+W]=255&w,W+=q,w/=256,k-=8);c[u+W-q]|=128*Q};function ni(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}ni.Varint=0,ni.Fixed64=1,ni.Bytes=2,ni.Fixed32=5;var qg=4294967296,mx=1/qg,yx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function go(c){return c.type===ni.Bytes?c.readVarint()+c.pos:c.pos+1}function $l(c,s,u){return u?4294967296*s+(c>>>0):4294967296*(s>>>0)+(c>>>0)}function xx(c,s,u){var f=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));u.realloc(f);for(var _=u.pos-1;_>=c;_--)u.buf[_+f]=u.buf[_]}function L2(c,s){for(var u=0;u<c.length;u++)s.writeVarint(c[u])}function B2(c,s){for(var u=0;u<c.length;u++)s.writeSVarint(c[u])}function z2(c,s){for(var u=0;u<c.length;u++)s.writeFloat(c[u])}function U2(c,s){for(var u=0;u<c.length;u++)s.writeDouble(c[u])}function V2(c,s){for(var u=0;u<c.length;u++)s.writeBoolean(c[u])}function $2(c,s){for(var u=0;u<c.length;u++)s.writeFixed32(c[u])}function j2(c,s){for(var u=0;u<c.length;u++)s.writeSFixed32(c[u])}function W2(c,s){for(var u=0;u<c.length;u++)s.writeFixed64(c[u])}function H2(c,s){for(var u=0;u<c.length;u++)s.writeSFixed64(c[u])}function zd(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+16777216*c[s+3]}function jl(c,s,u){c[u]=s,c[u+1]=s>>>8,c[u+2]=s>>>16,c[u+3]=s>>>24}function vx(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+(c[s+3]<<24)}ni.prototype={destroy:function(){this.buf=null},readFields:function(c,s,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),_=f>>3,v=this.pos;this.type=7&f,c(_,s,this),this.pos===v&&this.skip(f)}return s},readMessage:function(c,s){return this.readFields(c,s,this.readVarint()+this.pos)},readFixed32:function(){var c=zd(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=vx(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=zd(this.buf,this.pos)+zd(this.buf,this.pos+4)*qg;return this.pos+=8,c},readSFixed64:function(){var c=zd(this.buf,this.pos)+vx(this.buf,this.pos+4)*qg;return this.pos+=8,c},readFloat:function(){var c=gx(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=gx(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var s,u,f=this.buf;return s=127&(u=f[this.pos++]),u<128?s:(s|=(127&(u=f[this.pos++]))<<7,u<128?s:(s|=(127&(u=f[this.pos++]))<<14,u<128?s:(s|=(127&(u=f[this.pos++]))<<21,u<128?s:function(_,v,w){var E,C,k=w.buf;if(E=(112&(C=k[w.pos++]))>>4,C<128||(E|=(127&(C=k[w.pos++]))<<3,C<128)||(E|=(127&(C=k[w.pos++]))<<10,C<128)||(E|=(127&(C=k[w.pos++]))<<17,C<128)||(E|=(127&(C=k[w.pos++]))<<24,C<128)||(E|=(1&(C=k[w.pos++]))<<31,C<128))return $l(_,E,v);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(u=f[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,s=this.pos;return this.pos=c,c-s>=12&&yx?function(u,f,_){return yx.decode(u.subarray(f,_))}(this.buf,s,c):function(u,f,_){for(var v="",w=f;w<_;){var E,C,k,F=u[w],L=null,U=F>239?4:F>223?3:F>191?2:1;if(w+U>_)break;U===1?F<128&&(L=F):U===2?(192&(E=u[w+1]))==128&&(L=(31&F)<<6|63&E)<=127&&(L=null):U===3?(C=u[w+2],(192&(E=u[w+1]))==128&&(192&C)==128&&((L=(15&F)<<12|(63&E)<<6|63&C)<=2047||L>=55296&&L<=57343)&&(L=null)):U===4&&(C=u[w+2],k=u[w+3],(192&(E=u[w+1]))==128&&(192&C)==128&&(192&k)==128&&((L=(15&F)<<18|(63&E)<<12|(63&C)<<6|63&k)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,U=1):L>65535&&(L-=65536,v+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),v+=String.fromCharCode(L),w+=U}return v}(this.buf,s,c)},readBytes:function(){var c=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,c);return this.pos=c,s},readPackedVarint:function(c,s){if(this.type!==ni.Bytes)return c.push(this.readVarint(s));var u=go(this);for(c=c||[];this.pos<u;)c.push(this.readVarint(s));return c},readPackedSVarint:function(c){if(this.type!==ni.Bytes)return c.push(this.readSVarint());var s=go(this);for(c=c||[];this.pos<s;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==ni.Bytes)return c.push(this.readBoolean());var s=go(this);for(c=c||[];this.pos<s;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==ni.Bytes)return c.push(this.readFloat());var s=go(this);for(c=c||[];this.pos<s;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==ni.Bytes)return c.push(this.readDouble());var s=go(this);for(c=c||[];this.pos<s;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==ni.Bytes)return c.push(this.readFixed32());var s=go(this);for(c=c||[];this.pos<s;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==ni.Bytes)return c.push(this.readSFixed32());var s=go(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==ni.Bytes)return c.push(this.readFixed64());var s=go(this);for(c=c||[];this.pos<s;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==ni.Bytes)return c.push(this.readSFixed64());var s=go(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed64());return c},skip:function(c){var s=7&c;if(s===ni.Varint)for(;this.buf[this.pos++]>127;);else if(s===ni.Bytes)this.pos=this.readVarint()+this.pos;else if(s===ni.Fixed32)this.pos+=4;else{if(s!==ni.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(c,s){this.writeVarint(c<<3|s)},realloc:function(c){for(var s=this.length||16;s<this.pos+c;)s*=2;if(s!==this.length){var u=new Uint8Array(s);u.set(this.buf),this.buf=u,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),jl(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),jl(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),jl(this.buf,-1&c,this.pos),jl(this.buf,Math.floor(c*mx),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),jl(this.buf,-1&c,this.pos),jl(this.buf,Math.floor(c*mx),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(s,u){var f,_;if(s>=0?(f=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(f=~(-s%4294967296))?f=f+1|0:(f=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(v,w,E){E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,E.buf[E.pos]=127&(v>>>=7)}(f,0,u),function(v,w){var E=(7&v)<<4;w.buf[w.pos++]|=E|((v>>>=3)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v)))))}(_,u)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var s=this.pos;this.pos=function(f,_,v){for(var w,E,C=0;C<_.length;C++){if((w=_.charCodeAt(C))>55295&&w<57344){if(!E){w>56319||C+1===_.length?(f[v++]=239,f[v++]=191,f[v++]=189):E=w;continue}if(w<56320){f[v++]=239,f[v++]=191,f[v++]=189,E=w;continue}w=E-55296<<10|w-56320|65536,E=null}else E&&(f[v++]=239,f[v++]=191,f[v++]=189,E=null);w<128?f[v++]=w:(w<2048?f[v++]=w>>6|192:(w<65536?f[v++]=w>>12|224:(f[v++]=w>>18|240,f[v++]=w>>12&63|128),f[v++]=w>>6&63|128),f[v++]=63&w|128)}return v}(this.buf,c,this.pos);var u=this.pos-s;u>=128&&xx(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u},writeFloat:function(c){this.realloc(4),_x(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),_x(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var s=c.length;this.writeVarint(s),this.realloc(s);for(var u=0;u<s;u++)this.buf[this.pos++]=c[u]},writeRawMessage:function(c,s){this.pos++;var u=this.pos;c(s,this);var f=this.pos-u;f>=128&&xx(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(c,s,u){this.writeTag(c,ni.Bytes),this.writeRawMessage(s,u)},writePackedVarint:function(c,s){s.length&&this.writeMessage(c,L2,s)},writePackedSVarint:function(c,s){s.length&&this.writeMessage(c,B2,s)},writePackedBoolean:function(c,s){s.length&&this.writeMessage(c,V2,s)},writePackedFloat:function(c,s){s.length&&this.writeMessage(c,z2,s)},writePackedDouble:function(c,s){s.length&&this.writeMessage(c,U2,s)},writePackedFixed32:function(c,s){s.length&&this.writeMessage(c,$2,s)},writePackedSFixed32:function(c,s){s.length&&this.writeMessage(c,j2,s)},writePackedFixed64:function(c,s){s.length&&this.writeMessage(c,W2,s)},writePackedSFixed64:function(c,s){s.length&&this.writeMessage(c,H2,s)},writeBytesField:function(c,s){this.writeTag(c,ni.Bytes),this.writeBytes(s)},writeFixed32Field:function(c,s){this.writeTag(c,ni.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(c,s){this.writeTag(c,ni.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(c,s){this.writeTag(c,ni.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(c,s){this.writeTag(c,ni.Fixed64),this.writeSFixed64(s)},writeVarintField:function(c,s){this.writeTag(c,ni.Varint),this.writeVarint(s)},writeSVarintField:function(c,s){this.writeTag(c,ni.Varint),this.writeSVarint(s)},writeStringField:function(c,s){this.writeTag(c,ni.Bytes),this.writeString(s)},writeFloatField:function(c,s){this.writeTag(c,ni.Fixed32),this.writeFloat(s)},writeDoubleField:function(c,s){this.writeTag(c,ni.Fixed64),this.writeDouble(s)},writeBooleanField:function(c,s){this.writeVarintField(c,!!s)}};var Xg=y(px);const Zg=3;function q2(c,s,u){c===1&&u.readMessage(X2,s)}function X2(c,s,u){if(c===3){const{id:f,bitmap:_,width:v,height:w,left:E,top:C,advance:k}=u.readMessage(Z2,{});s.push({id:f,bitmap:new Au({width:v+2*Zg,height:w+2*Zg},_),metrics:{width:v,height:w,left:E,top:C,advance:k}})}}function Z2(c,s,u){c===1?s.id=u.readVarint():c===2?s.bitmap=u.readBytes():c===3?s.width=u.readVarint():c===4?s.height=u.readVarint():c===5?s.left=u.readSVarint():c===6?s.top=u.readSVarint():c===7&&(s.advance=u.readVarint())}const bx=Zg;function wx(c){let s=0,u=0;for(const w of c)s+=w.w*w.h,u=Math.max(u,w.w);c.sort((w,E)=>E.h-w.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),u),h:1/0}];let _=0,v=0;for(const w of c)for(let E=f.length-1;E>=0;E--){const C=f[E];if(!(w.w>C.w||w.h>C.h)){if(w.x=C.x,w.y=C.y,v=Math.max(v,w.y+w.h),_=Math.max(_,w.x+w.w),w.w===C.w&&w.h===C.h){const k=f.pop();E<f.length&&(f[E]=k)}else w.h===C.h?(C.x+=w.w,C.w-=w.w):w.w===C.w?(C.y+=w.h,C.h-=w.h):(f.push({x:C.x+w.w,y:C.y,w:C.w-w.w,h:w.h}),C.y+=w.h,C.h-=w.h);break}}return{w:_,h:v,fill:s/(_*v)||0}}const fn=1;class Yg{constructor(s,{pixelRatio:u,version:f,stretchX:_,stretchY:v,content:w}){this.paddedRect=s,this.pixelRatio=u,this.stretchX=_,this.stretchY=v,this.content=w,this.version=f}get tl(){return[this.paddedRect.x+fn,this.paddedRect.y+fn]}get br(){return[this.paddedRect.x+this.paddedRect.w-fn,this.paddedRect.y+this.paddedRect.h-fn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*fn)/this.pixelRatio,(this.paddedRect.h-2*fn)/this.pixelRatio]}}class Tx{constructor(s,u){const f={},_={};this.haveRenderCallbacks=[];const v=[];this.addImages(s,f,v),this.addImages(u,_,v);const{w,h:E}=wx(v),C=new Vn({width:w||1,height:E||1});for(const k in s){const F=s[k],L=f[k].paddedRect;Vn.copy(F.data,C,{x:0,y:0},{x:L.x+fn,y:L.y+fn},F.data)}for(const k in u){const F=u[k],L=_[k].paddedRect,U=L.x+fn,W=L.y+fn,q=F.data.width,Q=F.data.height;Vn.copy(F.data,C,{x:0,y:0},{x:U,y:W},F.data),Vn.copy(F.data,C,{x:0,y:Q-1},{x:U,y:W-1},{width:q,height:1}),Vn.copy(F.data,C,{x:0,y:0},{x:U,y:W+Q},{width:q,height:1}),Vn.copy(F.data,C,{x:q-1,y:0},{x:U-1,y:W},{width:1,height:Q}),Vn.copy(F.data,C,{x:0,y:0},{x:U+q,y:W},{width:1,height:Q})}this.image=C,this.iconPositions=f,this.patternPositions=_}addImages(s,u,f){for(const _ in s){const v=s[_],w={x:0,y:0,w:v.data.width+2*fn,h:v.data.height+2*fn};f.push(w),u[_]=new Yg(w,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(s,u){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in s.updatedImages)this.patchUpdatedImage(this.iconPositions[f],s.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],s.getImage(f),u)}patchUpdatedImage(s,u,f){if(!s||!u||s.version===u.version)return;s.version=u.version;const[_,v]=s.tl;f.update(u.data,void 0,{x:_,y:v})}}var Wo;st("ImagePosition",Yg),st("ImageAtlas",Tx),a.ai=void 0,(Wo=a.ai||(a.ai={}))[Wo.none=0]="none",Wo[Wo.horizontal=1]="horizontal",Wo[Wo.vertical=2]="vertical",Wo[Wo.horizontalOnly=3]="horizontalOnly";const Fu=-17;class Du{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,u){const f=new Du;return f.scale=s||1,f.fontStack=u,f}static forImage(s){const u=new Du;return u.imageName=s,u}}class Wl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,u){const f=new Wl;for(let _=0;_<s.sections.length;_++){const v=s.sections[_];v.image?f.addImageSection(v):f.addTextSection(v,u)}return f}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let u="";for(let f=0;f<s.length;f++){const _=s.charCodeAt(f+1)||null,v=s.charCodeAt(f-1)||null;u+=_&&vd(_)&&!Ou[s[f+1]]||v&&vd(v)&&!Ou[s[f-1]]||!Ou[s[f]]?s[f]:Ou[s[f]]}return u}(this.text)}trim(){let s=0;for(let f=0;f<this.text.length&&Vd[this.text.charCodeAt(f)];f++)s++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=s&&Vd[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(s,u),this.sectionIndex=this.sectionIndex.slice(s,u)}substring(s,u){const f=new Wl;return f.text=this.text.substring(s,u),f.sectionIndex=this.sectionIndex.slice(s,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,u)=>Math.max(s,this.sections[u].scale),0)}addTextSection(s,u){this.text+=s.text,this.sections.push(Du.forText(s.scale,s.fontStack||u));const f=this.sections.length-1;for(let _=0;_<s.text.length;++_)this.sectionIndex.push(f)}addImageSection(s){const u=s.image?s.image.name:"";if(u.length===0)return void ot("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Du.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ot("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ud(c,s,u,f,_,v,w,E,C,k,F,L,U,W,q,Q){const ae=Wl.fromFeature(c,_);let de;L===a.ai.vertical&&ae.verticalizePunctuation();const{processBidirectionalText:ve,processStyledBidirectionalText:ge}=hn;if(ve&&ae.sections.length===1){de=[];const Be=ve(ae.toString(),Kg(ae,k,v,s,f,W,q));for(const nt of Be){const dt=new Wl;dt.text=nt,dt.sections=ae.sections;for(let it=0;it<nt.length;it++)dt.sectionIndex.push(0);de.push(dt)}}else if(ge){de=[];const Be=ge(ae.text,ae.sectionIndex,Kg(ae,k,v,s,f,W,q));for(const nt of Be){const dt=new Wl;dt.text=nt[0],dt.sectionIndex=nt[1],dt.sections=ae.sections,de.push(dt)}}else de=function(Be,nt){const dt=[],it=Be.text;let et=0;for(const Ye of nt)dt.push(Be.substring(et,Ye)),et=Ye;return et<it.length&&dt.push(Be.substring(et,it.length)),dt}(ae,Kg(ae,k,v,s,f,W,q));const we=[],Pe={positionedLines:we,text:ae.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(Be,nt,dt,it,et,Ye,at,Ge,He,bt,gt,kt){let gi=0,bi=Fu,Qi=0,On=0;const Hr=Ge==="right"?1:Ge==="left"?0:.5;let qi=0;for(const er of et){er.trim();const tr=er.getMaxScale(),Cr=(tr-1)*Ji,Zr={positionedGlyphs:[],lineOffset:0};Be.positionedLines[qi]=Zr;const Rr=Zr.positionedGlyphs;let pn=0;if(!er.length()){bi+=Ye,++qi;continue}for(let ir=0;ir<er.length();ir++){const Bt=er.getSection(ir),Mr=er.getSectionIndex(ir),Tr=er.getCharCode(ir);let rr=0,rs=null,ws=null,Ts=null,_o=Ji;const ns=!(He===a.ai.horizontal||!gt&&!au(Tr)||gt&&(Vd[Tr]||(pr=Tr,rt.Arabic(pr)||rt["Arabic Supplement"](pr)||rt["Arabic Extended-A"](pr)||rt["Arabic Presentation Forms-A"](pr)||rt["Arabic Presentation Forms-B"](pr))));if(Bt.imageName){const jn=it[Bt.imageName];if(!jn)continue;Ts=Bt.imageName,Be.iconsInText=Be.iconsInText||!0,ws=jn.paddedRect;const _n=jn.displaySize;Bt.scale=Bt.scale*Ji/kt,rs={width:_n[0],height:_n[1],left:fn,top:-bx,advance:ns?_n[1]:_n[0]},rr=Cr+(Ji-_n[1]*Bt.scale),_o=rs.advance;const mo=ns?_n[0]*Bt.scale-Ji*tr:_n[1]*Bt.scale-Ji*tr;mo>0&&mo>pn&&(pn=mo)}else{const jn=dt[Bt.fontStack],_n=jn&&jn[Tr];if(_n&&_n.rect)ws=_n.rect,rs=_n.metrics;else{const mo=nt[Bt.fontStack],Uu=mo&&mo[Tr];if(!Uu)continue;rs=Uu.metrics}rr=(tr-Bt.scale)*Ji}ns?(Be.verticalizable=!0,Rr.push({glyph:Tr,imageName:Ts,x:gi,y:bi+rr,vertical:ns,scale:Bt.scale,fontStack:Bt.fontStack,sectionIndex:Mr,metrics:rs,rect:ws}),gi+=_o*Bt.scale+bt):(Rr.push({glyph:Tr,imageName:Ts,x:gi,y:bi+rr,vertical:ns,scale:Bt.scale,fontStack:Bt.fontStack,sectionIndex:Mr,metrics:rs,rect:ws}),gi+=rs.advance*Bt.scale+bt)}Rr.length!==0&&(Qi=Math.max(gi-bt,Qi),G2(Rr,0,Rr.length-1,Hr,pn)),gi=0;const gn=Ye*tr+pn;Zr.lineOffset=Math.max(pn,Cr),bi+=gn,On=Math.max(gn,On),++qi}var pr;const wr=bi-Fu,{horizontalAlign:qr,verticalAlign:Xr}=Gg(at);(function(er,tr,Cr,Zr,Rr,pn,gn,ir,Bt){const Mr=(tr-Cr)*Rr;let Tr=0;Tr=pn!==gn?-ir*Zr-Fu:(-Zr*Bt+.5)*gn;for(const rr of er)for(const rs of rr.positionedGlyphs)rs.x+=Mr,rs.y+=Tr})(Be.positionedLines,Hr,qr,Xr,Qi,On,Ye,wr,et.length),Be.top+=-Xr*wr,Be.bottom=Be.top+wr,Be.left+=-qr*Qi,Be.right=Be.left+Qi}(Pe,s,u,f,de,w,E,C,L,k,U,Q),!function(Be){for(const nt of Be)if(nt.positionedGlyphs.length!==0)return!1;return!0}(we)&&Pe}const Vd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Y2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sx(c,s,u,f,_,v){if(s.imageName){const w=f[s.imageName];return w?w.displaySize[0]*s.scale*Ji/v+_:0}{const w=u[s.fontStack],E=w&&w[c];return E?E.metrics.advance*s.scale+_:0}}function Ex(c,s,u,f){const _=Math.pow(c-s,2);return f?c<s?_/2:2*_:_+Math.abs(u)*u}function K2(c,s,u){let f=0;return c===10&&(f-=1e4),u&&(f+=150),c!==40&&c!==65288||(f+=50),s!==41&&s!==65289||(f+=50),f}function Ax(c,s,u,f,_,v){let w=null,E=Ex(s,u,_,v);for(const C of f){const k=Ex(s-C.x,u,_,v)+C.badness;k<=E&&(w=C,E=k)}return{index:c,x:s,priorBreak:w,badness:E}}function Px(c){return c?Px(c.priorBreak).concat(c.index):[]}function Kg(c,s,u,f,_,v,w){if(v!=="point")return[];if(!c)return[];const E=[],C=function(U,W,q,Q,ae,de){let ve=0;for(let ge=0;ge<U.length();ge++){const we=U.getSection(ge);ve+=Sx(U.getCharCode(ge),we,Q,ae,W,de)}return ve/Math.max(1,Math.ceil(ve/q))}(c,s,u,f,_,w),k=c.text.indexOf("​")>=0;let F=0;for(let U=0;U<c.length();U++){const W=c.getSection(U),q=c.getCharCode(U);if(Vd[q]||(F+=Sx(q,W,f,_,s,w)),U<c.length()-1){const Q=!((L=q)<11904||!(rt["Bopomofo Extended"](L)||rt.Bopomofo(L)||rt["CJK Compatibility Forms"](L)||rt["CJK Compatibility Ideographs"](L)||rt["CJK Compatibility"](L)||rt["CJK Radicals Supplement"](L)||rt["CJK Strokes"](L)||rt["CJK Symbols and Punctuation"](L)||rt["CJK Unified Ideographs Extension A"](L)||rt["CJK Unified Ideographs"](L)||rt["Enclosed CJK Letters and Months"](L)||rt["Halfwidth and Fullwidth Forms"](L)||rt.Hiragana(L)||rt["Ideographic Description Characters"](L)||rt["Kangxi Radicals"](L)||rt["Katakana Phonetic Extensions"](L)||rt.Katakana(L)||rt["Vertical Forms"](L)||rt["Yi Radicals"](L)||rt["Yi Syllables"](L)));(Y2[q]||Q||W.imageName)&&E.push(Ax(U+1,F,C,E,K2(q,c.getCharCode(U+1),Q&&k),!1))}}var L;return Px(Ax(c.length(),F,C,E,0,!0))}function Gg(c){let s=.5,u=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:s,verticalAlign:u}}function G2(c,s,u,f,_){if(!f&&!_)return;const v=c[u],w=(c[u].x+v.metrics.advance*v.scale)*f;for(let E=s;E<=u;E++)c[E].x-=w,c[E].y+=_}function J2(c,s,u){const{horizontalAlign:f,verticalAlign:_}=Gg(u),v=s[0]-c.displaySize[0]*f,w=s[1]-c.displaySize[1]*_;return{image:c,top:w,bottom:w+c.displaySize[1],left:v,right:v+c.displaySize[0]}}function Ix(c,s,u,f,_,v){const w=c.image;let E;if(w.content){const ae=w.content,de=w.pixelRatio||1;E=[ae[0]/de,ae[1]/de,w.displaySize[0]-ae[2]/de,w.displaySize[1]-ae[3]/de]}const C=s.left*v,k=s.right*v;let F,L,U,W;u==="width"||u==="both"?(W=_[0]+C-f[3],L=_[0]+k+f[1]):(W=_[0]+(C+k-w.displaySize[0])/2,L=W+w.displaySize[0]);const q=s.top*v,Q=s.bottom*v;return u==="height"||u==="both"?(F=_[1]+q-f[0],U=_[1]+Q+f[2]):(F=_[1]+(q+Q-w.displaySize[1])/2,U=F+w.displaySize[1]),{image:w,top:F,right:L,bottom:U,left:W,collisionPadding:E}}const Nu=255,Us=128,Ho=Nu*Us;function Cx(c,s){const{expression:u}=s;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new fi(c+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:_}=u;let v=0;for(;v<f.length&&f[v]<=c;)v++;v=Math.max(0,v-1);let w=v;for(;w<f.length&&f[w]<c+1;)w++;w=Math.min(f.length-1,w);const E=f[v],C=f[w];return u.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:C,interpolationType:_}:{kind:"camera",minZoom:E,maxZoom:C,minSize:u.evaluate(new fi(E)),maxSize:u.evaluate(new fi(C)),interpolationType:_}}}function Jg(c,s,u){let f="never";const _=c.get(s);return _?f=_:c.get(u)&&(f="always"),f}const Q2=jo.VectorTileFeature.types,eP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $d(c,s,u,f,_,v,w,E,C,k,F,L,U){const W=E?Math.min(Ho,Math.round(E[0])):0,q=E?Math.min(Ho,Math.round(E[1])):0;c.emplaceBack(s,u,Math.round(32*f),Math.round(32*_),v,w,(W<<1)+(C?1:0),q,16*k,16*F,256*L,256*U)}function Qg(c,s,u){c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u)}function tP(c){for(const s of c.sections)if(Eg(s.text))return!0;return!1}class e_{constructor(s){this.layoutVertexArray=new Ft,this.indexArray=new dr,this.programConfigurations=s,this.segments=new pi,this.dynamicLayoutVertexArray=new Ct,this.opacityVertexArray=new Lt,this.hasVisibleVertices=!1,this.placedSymbolArray=new me}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,u,f,_){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,k2.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,O2.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,eP,!0),this.opacityVertexBuffer.itemSize=1),(f||_)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st("SymbolBuffers",e_);class t_{constructor(s,u,f){this.layoutVertexArray=new s,this.layoutAttributes=u,this.indexArray=new f,this.segments=new pi,this.collisionVertexArray=new hi}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,F2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}st("CollisionBuffers",t_);class Hl{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(w=>w.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=kg([]),this.placementViewportMatrix=kg([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cx(this.zoom,u["text-size"]),this.iconSizeData=Cx(this.zoom,u["icon-size"]);const f=this.layers[0].layout,_=f.get("symbol-sort-key"),v=f.get("symbol-z-order");this.canOverlap=Jg(f,"text-overlap","text-allow-overlap")!=="never"||Jg(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(w=>a.ai[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=s.sourceID}createArrays(){this.text=new e_(new bs(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new e_(new bs(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new xe,this.lineVertexArray=new Ie,this.symbolInstances=new ce,this.textAnchorOffsets=new Le}calculateGlyphDependencies(s,u,f,_,v){for(let w=0;w<s.length;w++)if(u[s.charCodeAt(w)]=!0,(f||_)&&v){const E=Ou[s.charAt(w)];E&&(u[E.charCodeAt(0)]=!0)}}populate(s,u,f){const _=this.layers[0],v=_.layout,w=v.get("text-font"),E=v.get("text-field"),C=v.get("icon-image"),k=(E.value.kind!=="constant"||E.value.value instanceof di&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),F=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,L=v.get("symbol-sort-key");if(this.features=[],!k&&!F)return;const U=u.iconDependencies,W=u.glyphDependencies,q=u.availableImages,Q=new fi(this.zoom);for(const{feature:ae,id:de,index:ve,sourceLayerIndex:ge}of s){const we=_._featureFilter.needGeometry,Pe=za(ae,we);if(!_._featureFilter.filter(Q,Pe,f))continue;let Be,nt;if(we||(Pe.geometry=Ba(ae)),k){const it=_.getValueAndResolveTokens("text-field",Pe,f,q),et=di.factory(it);tP(et)&&(this.hasRTLText=!0),(!this.hasRTLText||fu()==="unavailable"||this.hasRTLText&&hn.isParsed())&&(Be=N2(et,_,Pe))}if(F){const it=_.getValueAndResolveTokens("icon-image",Pe,f,q);nt=it instanceof ri?it:ri.fromString(it)}if(!Be&&!nt)continue;const dt=this.sortFeaturesByKey?L.evaluate(Pe,{},f):void 0;if(this.features.push({id:de,text:Be,icon:nt,index:ve,sourceLayerIndex:ge,geometry:Pe.geometry,properties:ae.properties,type:Q2[ae.type],sortKey:dt}),nt&&(U[nt.name]=!0),Be){const it=w.evaluate(Pe,{},f).join(","),et=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ai.vertical)>=0;for(const Ye of Be.sections)if(Ye.image)U[Ye.image.name]=!0;else{const at=su(Be.toString()),Ge=Ye.fontStack||it,He=W[Ge]=W[Ge]||{};this.calculateGlyphDependencies(Ye.text,He,et,this.allowVerticalPlacement,at)}}}v.get("symbol-placement")==="line"&&(this.features=function(ae){const de={},ve={},ge=[];let we=0;function Pe(it){ge.push(ae[it]),we++}function Be(it,et,Ye){const at=ve[it];return delete ve[it],ve[et]=at,ge[at].geometry[0].pop(),ge[at].geometry[0]=ge[at].geometry[0].concat(Ye[0]),at}function nt(it,et,Ye){const at=de[et];return delete de[et],de[it]=at,ge[at].geometry[0].shift(),ge[at].geometry[0]=Ye[0].concat(ge[at].geometry[0]),at}function dt(it,et,Ye){const at=Ye?et[0][et[0].length-1]:et[0][0];return`${it}:${at.x}:${at.y}`}for(let it=0;it<ae.length;it++){const et=ae[it],Ye=et.geometry,at=et.text?et.text.toString():null;if(!at){Pe(it);continue}const Ge=dt(at,Ye),He=dt(at,Ye,!0);if(Ge in ve&&He in de&&ve[Ge]!==de[He]){const bt=nt(Ge,He,Ye),gt=Be(Ge,He,ge[bt].geometry);delete de[Ge],delete ve[He],ve[dt(at,ge[gt].geometry,!0)]=gt,ge[bt].geometry=null}else Ge in ve?Be(Ge,He,Ye):He in de?nt(Ge,He,Ye):(Pe(it),de[Ge]=we-1,ve[He]=we-1)}return ge.filter(it=>it.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,de)=>ae.sortKey-de.sortKey)}update(s,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(s,u,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,u){const f=this.lineVertexArray.length;if(s.segment!==void 0){let _=s.dist(u[s.segment+1]),v=s.dist(u[s.segment]);const w={};for(let E=s.segment+1;E<u.length;E++)w[E]={x:u[E].x,y:u[E].y,tileUnitDistanceFromAnchor:_},E<u.length-1&&(_+=u[E+1].dist(u[E]));for(let E=s.segment||0;E>=0;E--)w[E]={x:u[E].x,y:u[E].y,tileUnitDistanceFromAnchor:v},E>0&&(v+=u[E-1].dist(u[E]));for(let E=0;E<u.length;E++){const C=w[E];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(s,u,f,_,v,w,E,C,k,F,L,U){const W=s.indexArray,q=s.layoutVertexArray,Q=s.segments.prepareSegment(4*u.length,q,W,this.canOverlap?w.sortKey:void 0),ae=this.glyphOffsetArray.length,de=Q.vertexLength,ve=this.allowVerticalPlacement&&E===a.ai.vertical?Math.PI/2:0,ge=w.text&&w.text.sections;for(let we=0;we<u.length;we++){const{tl:Pe,tr:Be,bl:nt,br:dt,tex:it,pixelOffsetTL:et,pixelOffsetBR:Ye,minFontScaleX:at,minFontScaleY:Ge,glyphOffset:He,isSDF:bt,sectionIndex:gt}=u[we],kt=Q.vertexLength,gi=He[1];$d(q,C.x,C.y,Pe.x,gi+Pe.y,it.x,it.y,f,bt,et.x,et.y,at,Ge),$d(q,C.x,C.y,Be.x,gi+Be.y,it.x+it.w,it.y,f,bt,Ye.x,et.y,at,Ge),$d(q,C.x,C.y,nt.x,gi+nt.y,it.x,it.y+it.h,f,bt,et.x,Ye.y,at,Ge),$d(q,C.x,C.y,dt.x,gi+dt.y,it.x+it.w,it.y+it.h,f,bt,Ye.x,Ye.y,at,Ge),Qg(s.dynamicLayoutVertexArray,C,ve),W.emplaceBack(kt,kt+1,kt+2),W.emplaceBack(kt+1,kt+2,kt+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(He[0]),we!==u.length-1&&gt===u[we+1].sectionIndex||s.programConfigurations.populatePaintArrays(q.length,w,w.index,{},U,ge&&ge[gt])}s.placedSymbolArray.emplaceBack(C.x,C.y,ae,this.glyphOffsetArray.length-ae,de,k,F,C.segment,f?f[0]:0,f?f[1]:0,_[0],_[1],E,0,!1,0,L)}_addCollisionDebugVertex(s,u,f,_,v,w){return u.emplaceBack(0,0),s.emplaceBack(f.x,f.y,_,v,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(s,u,f,_,v,w,E){const C=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),k=C.vertexLength,F=v.layoutVertexArray,L=v.collisionVertexArray,U=E.anchorX,W=E.anchorY;this._addCollisionDebugVertex(F,L,w,U,W,new P(s,u)),this._addCollisionDebugVertex(F,L,w,U,W,new P(f,u)),this._addCollisionDebugVertex(F,L,w,U,W,new P(f,_)),this._addCollisionDebugVertex(F,L,w,U,W,new P(s,_)),C.vertexLength+=4;const q=v.indexArray;q.emplaceBack(k,k+1),q.emplaceBack(k+1,k+2),q.emplaceBack(k+2,k+3),q.emplaceBack(k+3,k),C.primitiveLength+=4}addDebugCollisionBoxes(s,u,f,_){for(let v=s;v<u;v++){const w=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,_?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new t_(Fi,fx.members,Ki),this.iconCollisionBox=new t_(Fi,fx.members,Ki);for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(s,u,f,_,v,w,E,C,k){const F={};for(let L=u;L<f;L++){const U=s.get(L);F.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},F.textFeatureIndex=U.featureIndex;break}for(let L=_;L<v;L++){const U=s.get(L);F.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},F.verticalTextFeatureIndex=U.featureIndex;break}for(let L=w;L<E;L++){const U=s.get(L);F.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},F.iconFeatureIndex=U.featureIndex;break}for(let L=C;L<k;L++){const U=s.get(L);F.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},F.verticalIconFeatureIndex=U.featureIndex;break}return F}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,u){const f=s.placedSymbolArray.get(u),_=f.vertexStartIndex+4*f.numGlyphs;for(let v=f.vertexStartIndex;v<_;v+=4)s.indexArray.emplaceBack(v,v+1,v+2),s.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(s),f=Math.cos(s),_=[],v=[],w=[];for(let E=0;E<this.symbolInstances.length;++E){w.push(E);const C=this.symbolInstances.get(E);_.push(0|Math.round(u*C.anchorX+f*C.anchorY)),v.push(C.featureIndex)}return w.sort((E,C)=>_[E]-_[C]||v[C]-v[E]),w}addToSortKeyRanges(s,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((_,v,w)=>{_>=0&&w.indexOf(_)===v&&this.addIndicesForPlacedSymbol(this.text,_)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Rx,Mx;st("SymbolBucket",Hl,{omit:["layers","collisionBoxArray","features","compareText"]}),Hl.MAX_GLYPHS=65535,Hl.addDynamicAttributes=Qg;var i_={get paint(){return Mx=Mx||new zi({"icon-opacity":new wt(Fe.paint_symbol["icon-opacity"]),"icon-color":new wt(Fe.paint_symbol["icon-color"]),"icon-halo-color":new wt(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new wt(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wt(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new _t(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new _t(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new wt(Fe.paint_symbol["text-opacity"]),"text-color":new wt(Fe.paint_symbol["text-color"],{runtimeType:cr,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new wt(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new wt(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new wt(Fe.paint_symbol["text-halo-blur"]),"text-translate":new _t(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new _t(Fe.paint_symbol["text-translate-anchor"])})},get layout(){return Rx=Rx||new zi({"symbol-placement":new _t(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new _t(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _t(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wt(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _t(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _t(Fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new _t(Fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new _t(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new _t(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _t(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new wt(Fe.layout_symbol["icon-size"]),"icon-text-fit":new _t(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _t(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new wt(Fe.layout_symbol["icon-image"]),"icon-rotate":new wt(Fe.layout_symbol["icon-rotate"]),"icon-padding":new wt(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new _t(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new wt(Fe.layout_symbol["icon-offset"]),"icon-anchor":new wt(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _t(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _t(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _t(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new wt(Fe.layout_symbol["text-field"]),"text-font":new wt(Fe.layout_symbol["text-font"]),"text-size":new wt(Fe.layout_symbol["text-size"]),"text-max-width":new wt(Fe.layout_symbol["text-max-width"]),"text-line-height":new _t(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new wt(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new wt(Fe.layout_symbol["text-justify"]),"text-radial-offset":new wt(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _t(Fe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new wt(Fe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new wt(Fe.layout_symbol["text-anchor"]),"text-max-angle":new _t(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new _t(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new wt(Fe.layout_symbol["text-rotate"]),"text-padding":new _t(Fe.layout_symbol["text-padding"]),"text-keep-upright":new _t(Fe.layout_symbol["text-keep-upright"]),"text-transform":new wt(Fe.layout_symbol["text-transform"]),"text-offset":new wt(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new _t(Fe.layout_symbol["text-allow-overlap"]),"text-overlap":new _t(Fe.layout_symbol["text-overlap"]),"text-ignore-placement":new _t(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new _t(Fe.layout_symbol["text-optional"])})}};class kx{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:zn,this.defaultValue=s}evaluate(s){if(s.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(s.formattedSection))return u.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st("FormatSectionOverride",kx,{omit:["defaultValue"]});class jd extends Mn{constructor(s){super(s,i_)}recalculate(s,u){if(super.recalculate(s,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const _=[];for(const v of f)_.indexOf(v)<0&&_.push(v);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,u,f,_){const v=this.layout.get(s).evaluate(u,{},f,_),w=this._unevaluatedLayout._values[s];return w.isDataDriven()||El(w.value)||!v?v:function(E,C){return C.replace(/{([^{}]+)}/g,(k,F)=>E&&F in E?String(E[F]):"")}(u.properties,v)}createBucket(s){return new Hl(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of i_.paint.overridableProperties){if(!jd.hasPaintOverride(this.layout,s))continue;const u=this.paint.get(s),f=new kx(u),_=new Qc(f,u.property.specification);let v=null;v=u.value.kind==="constant"||u.value.kind==="source"?new eu("source",_):new Pl("composite",_,u.value.zoomStops),this.paint._values[s]=new Pr(u.property,v,u.parameters)}}_handleOverridablePaintPropertyUpdate(s,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&jd.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,u){const f=s.get("text-field"),_=i_.paint.properties[u];let v=!1;const w=E=>{for(const C of E)if(_.overrides&&_.overrides.hasOverride(C))return void(v=!0)};if(f.value.kind==="constant"&&f.value.value instanceof di)w(f.value.value.sections);else if(f.value.kind==="source"){const E=k=>{v||(k instanceof Un&&ai(k.value)===ne?w(k.value.sections):k instanceof Sl?w(k.sections):k.eachChild(E))},C=f.value;C._styleExpression&&E(C._styleExpression.expression)}return v}}let Ox;var iP={get paint(){return Ox=Ox||new zi({"background-color":new _t(Fe.paint_background["background-color"]),"background-pattern":new gu(Fe.paint_background["background-pattern"]),"background-opacity":new _t(Fe.paint_background["background-opacity"])})}};class rP extends Mn{constructor(s){super(s,iP)}}let Fx;var nP={get paint(){return Fx=Fx||new zi({"raster-opacity":new _t(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new _t(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _t(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _t(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new _t(Fe.paint_raster["raster-saturation"]),"raster-contrast":new _t(Fe.paint_raster["raster-contrast"]),"raster-resampling":new _t(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new _t(Fe.paint_raster["raster-fade-duration"])})}};class sP extends Mn{constructor(s){super(s,nP)}}class oP extends Mn{constructor(s){super(s,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class aP{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const r_=63710088e-1;class qo{constructor(s,u){if(isNaN(s)||isNaN(u))throw new Error(`Invalid LngLat object: (${s}, ${u})`);if(this.lng=+s,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qo($e(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const u=Math.PI/180,f=this.lat*u,_=s.lat*u,v=Math.sin(f)*Math.sin(_)+Math.cos(f)*Math.cos(_)*Math.cos((s.lng-this.lng)*u);return r_*Math.acos(Math.min(v,1))}static convert(s){if(s instanceof qo)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new qo(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new qo(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Dx=2*Math.PI*r_;function Nx(c){return Dx*Math.cos(c*Math.PI/180)}function Lx(c){return(180+c)/360}function Bx(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function zx(c,s){return c/Nx(s)}function Ux(c){return 360*c-180}function n_(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class Wd{constructor(s,u,f=0){this.x=+s,this.y=+u,this.z=+f}static fromLngLat(s,u=0){const f=qo.convert(s);return new Wd(Lx(f.lng),Bx(f.lat),zx(u,f.lat))}toLngLat(){return new qo(Ux(this.x),n_(this.y))}toAltitude(){return this.z*Nx(n_(this.y))}meterInMercatorCoordinateUnits(){return 1/Dx*(s=n_(this.y),1/Math.cos(s*Math.PI/180));var s}}function Vx(c,s,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[c*f-2*Math.PI*6378137/2,s*f-2*Math.PI*6378137/2]}class s_{constructor(s,u,f){if(s<0||s>25||f<0||f>=Math.pow(2,s)||u<0||u>=Math.pow(2,s))throw new Error(`x=${u}, y=${f}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=u,this.y=f,this.key=Lu(0,s,s,u,f)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,u,f){const _=(w=this.y,E=this.z,C=Vx(256*(v=this.x),256*(w=Math.pow(2,E)-w-1),E),k=Vx(256*(v+1),256*(w+1),E),C[0]+","+C[1]+","+k[0]+","+k[1]);var v,w,E,C,k;const F=function(L,U,W){let q,Q="";for(let ae=L;ae>0;ae--)q=1<<ae-1,Q+=(U&q?1:0)+(W&q?2:0);return Q}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,F).replace(/{bbox-epsg-3857}/g,_)}isChildOf(s){const u=this.z-s.z;return u>0&&s.x===this.x>>u&&s.y===this.y>>u}getTilePoint(s){const u=Math.pow(2,this.z);return new P((s.x*u-this.x)*Hi,(s.y*u-this.y)*Hi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class $x{constructor(s,u){this.wrap=s,this.canonical=u,this.key=Lu(s,u.z,u.z,u.x,u.y)}}class $n{constructor(s,u,f,_,v){if(s<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${f}`);this.overscaledZ=s,this.wrap=u,this.canonical=new s_(f,+_,+v),this.key=Lu(u,s,f,_,v)}clone(){return new $n(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-s;return s>this.canonical.z?new $n(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $n(s,this.wrap,s,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(s,u){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-s;return s>this.canonical.z?Lu(this.wrap*+u,s,this.canonical.z,this.canonical.x,this.canonical.y):Lu(this.wrap*+u,s,s,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const u=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>u&&s.canonical.y===this.canonical.y>>u}children(s){if(this.overscaledZ>=s)return[new $n(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,_=2*this.canonical.y;return[new $n(u,this.wrap,u,f,_),new $n(u,this.wrap,u,f+1,_),new $n(u,this.wrap,u,f,_+1),new $n(u,this.wrap,u,f+1,_+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new $n(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new $n(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new $x(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new Wd(s.x-this.wrap,s.y))}}function Lu(c,s,u,f,_){(c*=2)<0&&(c=-1*c-1);const v=1<<u;return(v*v*c+v*_+f).toString(36)+u.toString(36)+s.toString(36)}st("CanonicalTileID",s_),st("OverscaledTileID",$n,{omit:["posMatrix"]});class jx{constructor(s,u,f,_=1,v=1,w=1,E=0){if(this.uid=s,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void ot(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const C=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=v,this.blueFactor=w,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<C;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(C,k)]=this.data[this._idx(C-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,C)]=this.data[this._idx(k,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<C;k++)for(let F=0;F<C;F++){const L=this.get(k,F);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(s,u){const f=new Uint8Array(this.data.buffer),_=4*this._idx(s,u);return this.unpack(f[_],f[_+1],f[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,u){if(s<-1||s>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(s+1)}unpack(s,u,f){return s*this.redFactor+u*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new Vn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,u,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let _=u*this.dim,v=u*this.dim+this.dim,w=f*this.dim,E=f*this.dim+this.dim;switch(u){case-1:_=v-1;break;case 1:v=_+1}switch(f){case-1:w=E-1;break;case 1:E=w+1}const C=-u*this.dim,k=-f*this.dim;for(let F=w;F<E;F++)for(let L=_;L<v;L++)this.data[this._idx(L,F)]=s.data[this._idx(L+C,F+k)]}}st("DEMData",jx);class Wx{constructor(s){this._stringToNumber={},this._numberToString=[];for(let u=0;u<s.length;u++){const f=s[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class Hx{constructor(s,u,f,_,v){this.type="Feature",this._vectorTileFeature=s,s._z=u,s._x=f,s._y=_,this.properties=s.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(s[u]=this[u]);return s}}class qx{constructor(s,u){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Bo(Hi,16,0),this.grid3D=new Bo(Hi,16,0),this.featureIndexArray=new Ve,this.promoteId=u}insert(s,u,f,_,v,w){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,_,v);const C=w?this.grid3D:this.grid;for(let k=0;k<u.length;k++){const F=u[k],L=[1/0,1/0,-1/0,-1/0];for(let U=0;U<F.length;U++){const W=F[U];L[0]=Math.min(L[0],W.x),L[1]=Math.min(L[1],W.y),L[2]=Math.max(L[2],W.x),L[3]=Math.max(L[3],W.y)}L[0]<Hi&&L[1]<Hi&&L[2]>=0&&L[3]>=0&&C.insert(E,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new jo.VectorTile(new Xg(this.rawTileData)).layers,this.sourceLayerCoder=new Wx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,u,f,_){this.loadVTLayers();const v=s.params||{},w=Hi/s.tileSize/s.scale,E=iu(v.filter),C=s.queryGeometry,k=s.queryPadding*w,F=Zx(C),L=this.grid.query(F.minX-k,F.minY-k,F.maxX+k,F.maxY+k),U=Zx(s.cameraQueryGeometry),W=this.grid3D.query(U.minX-k,U.minY-k,U.maxX+k,U.maxY+k,(ae,de,ve,ge)=>function(we,Pe,Be,nt,dt){for(const et of we)if(Pe<=et.x&&Be<=et.y&&nt>=et.x&&dt>=et.y)return!0;const it=[new P(Pe,Be),new P(Pe,dt),new P(nt,dt),new P(nt,Be)];if(we.length>2){for(const et of it)if(Bl(we,et))return!0}for(let et=0;et<we.length-1;et++)if(zA(we[et],we[et+1],it))return!0;return!1}(s.cameraQueryGeometry,ae-k,de-k,ve+k,ge+k));for(const ae of W)L.push(ae);L.sort(lP);const q={};let Q;for(let ae=0;ae<L.length;ae++){const de=L[ae];if(de===Q)continue;Q=de;const ve=this.featureIndexArray.get(de);let ge=null;this.loadMatchingFeature(q,ve.bucketIndex,ve.sourceLayerIndex,ve.featureIndex,E,v.layers,v.availableImages,u,f,_,(we,Pe,Be)=>(ge||(ge=Ba(we)),Pe.queryIntersectsFeature(C,we,Be,ge,this.z,s.transform,w,s.pixelPosMatrix)))}return q}loadMatchingFeature(s,u,f,_,v,w,E,C,k,F,L){const U=this.bucketLayerIDs[u];if(w&&!function(ae,de){for(let ve=0;ve<ae.length;ve++)if(de.indexOf(ae[ve])>=0)return!0;return!1}(w,U))return;const W=this.sourceLayerCoder.decode(f),q=this.vtLayers[W].feature(_);if(v.needGeometry){const ae=za(q,!0);if(!v.filter(new fi(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!v.filter(new fi(this.tileID.overscaledZ),q))return;const Q=this.getId(q,W);for(let ae=0;ae<U.length;ae++){const de=U[ae];if(w&&w.indexOf(de)<0)continue;const ve=C[de];if(!ve)continue;let ge={};Q&&F&&(ge=F.getState(ve.sourceLayer||"_geojsonTileLayer",Q));const we=ke({},k[de]);we.paint=Xx(we.paint,ve.paint,q,ge,E),we.layout=Xx(we.layout,ve.layout,q,ge,E);const Pe=!L||L(q,ve,ge);if(!Pe)continue;const Be=new Hx(q,this.z,this.x,this.y,Q);Be.layer=we;let nt=s[de];nt===void 0&&(nt=s[de]=[]),nt.push({featureIndex:_,feature:Be,intersectionZ:Pe})}}lookupSymbolFeatures(s,u,f,_,v,w,E,C){const k={};this.loadVTLayers();const F=iu(v);for(const L of s)this.loadMatchingFeature(k,f,_,L,F,w,E,C,u);return k}hasLayer(s){for(const u of this.bucketLayerIDs)for(const f of u)if(s===f)return!0;return!1}getId(s,u){let f=s.id;return this.promoteId&&(f=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof f=="boolean"&&(f=Number(f))),f}}function Xx(c,s,u,f,_){return Ue(c,(v,w)=>{const E=s instanceof Nl?s.get(w):null;return E&&E.evaluate?E.evaluate(u,f,_):E})}function Zx(c){let s=1/0,u=1/0,f=-1/0,_=-1/0;for(const v of c)s=Math.min(s,v.x),u=Math.min(u,v.y),f=Math.max(f,v.x),_=Math.max(_,v.y);return{minX:s,minY:u,maxX:f,maxY:_}}function lP(c,s){return s-c}function Yx(c,s,u,f,_){const v=[];for(let w=0;w<c.length;w++){const E=c[w];let C;for(let k=0;k<E.length-1;k++){let F=E[k],L=E[k+1];F.x<s&&L.x<s||(F.x<s?F=new P(s,F.y+(s-F.x)/(L.x-F.x)*(L.y-F.y))._round():L.x<s&&(L=new P(s,F.y+(s-F.x)/(L.x-F.x)*(L.y-F.y))._round()),F.y<u&&L.y<u||(F.y<u?F=new P(F.x+(u-F.y)/(L.y-F.y)*(L.x-F.x),u)._round():L.y<u&&(L=new P(F.x+(u-F.y)/(L.y-F.y)*(L.x-F.x),u)._round()),F.x>=f&&L.x>=f||(F.x>=f?F=new P(f,F.y+(f-F.x)/(L.x-F.x)*(L.y-F.y))._round():L.x>=f&&(L=new P(f,F.y+(f-F.x)/(L.x-F.x)*(L.y-F.y))._round()),F.y>=_&&L.y>=_||(F.y>=_?F=new P(F.x+(_-F.y)/(L.y-F.y)*(L.x-F.x),_)._round():L.y>=_&&(L=new P(F.x+(_-F.y)/(L.y-F.y)*(L.x-F.x),_)._round()),C&&F.equals(C[C.length-1])||(C=[F],v.push(C)),C.push(L)))))}}return v}st("FeatureIndex",qx,{omit:["rawTileData","sourceLayerCoder"]});class Xo extends P{constructor(s,u,f,_){super(s,u),this.angle=f,_!==void 0&&(this.segment=_)}clone(){return new Xo(this.x,this.y,this.angle,this.segment)}}function Kx(c,s,u,f,_){if(s.segment===void 0||u===0)return!0;let v=s,w=s.segment+1,E=0;for(;E>-u/2;){if(w--,w<0)return!1;E-=c[w].dist(v),v=c[w]}E+=c[w].dist(c[w+1]),w++;const C=[];let k=0;for(;E<u/2;){const F=c[w],L=c[w+1];if(!L)return!1;let U=c[w-1].angleTo(F)-F.angleTo(L);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:E,angleDelta:U}),k+=U;E-C[0].distance>f;)k-=C.shift().angleDelta;if(k>_)return!1;w++,E+=F.dist(L)}return!0}function Gx(c){let s=0;for(let u=0;u<c.length-1;u++)s+=c[u].dist(c[u+1]);return s}function Jx(c,s,u){return c?.6*s*u:0}function Qx(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function cP(c,s,u,f,_,v){const w=Jx(u,_,v),E=Qx(u,f)*v;let C=0;const k=Gx(c)/2;for(let F=0;F<c.length-1;F++){const L=c[F],U=c[F+1],W=L.dist(U);if(C+W>k){const q=(k-C)/W,Q=ln.number(L.x,U.x,q),ae=ln.number(L.y,U.y,q),de=new Xo(Q,ae,U.angleTo(L),F);return de._round(),!w||Kx(c,de,E,w,s)?de:void 0}C+=W}}function uP(c,s,u,f,_,v,w,E,C){const k=Jx(f,v,w),F=Qx(f,_),L=F*w,U=c[0].x===0||c[0].x===C||c[0].y===0||c[0].y===C;return s-L<s/4&&(s=L+s/4),ev(c,U?s/2*E%s:(F/2+2*v)*w*E%s,s,k,u,L,U,!1,C)}function ev(c,s,u,f,_,v,w,E,C){const k=v/2,F=Gx(c);let L=0,U=s-u,W=[];for(let q=0;q<c.length-1;q++){const Q=c[q],ae=c[q+1],de=Q.dist(ae),ve=ae.angleTo(Q);for(;U+u<L+de;){U+=u;const ge=(U-L)/de,we=ln.number(Q.x,ae.x,ge),Pe=ln.number(Q.y,ae.y,ge);if(we>=0&&we<C&&Pe>=0&&Pe<C&&U-k>=0&&U+k<=F){const Be=new Xo(we,Pe,ve,q);Be._round(),f&&!Kx(c,Be,v,f,_)||W.push(Be)}}L+=de}return E||W.length||w||(W=ev(c,L/2,u,f,_,v,w,!0,C)),W}st("Anchor",Xo);const ql=fn;function tv(c,s,u,f){const _=[],v=c.image,w=v.pixelRatio,E=v.paddedRect.w-2*ql,C=v.paddedRect.h-2*ql,k=c.right-c.left,F=c.bottom-c.top,L=v.stretchX||[[0,E]],U=v.stretchY||[[0,C]],W=(Ye,at)=>Ye+at[1]-at[0],q=L.reduce(W,0),Q=U.reduce(W,0),ae=E-q,de=C-Q;let ve=0,ge=q,we=0,Pe=Q,Be=0,nt=ae,dt=0,it=de;if(v.content&&f){const Ye=v.content;ve=Hd(L,0,Ye[0]),we=Hd(U,0,Ye[1]),ge=Hd(L,Ye[0],Ye[2]),Pe=Hd(U,Ye[1],Ye[3]),Be=Ye[0]-ve,dt=Ye[1]-we,nt=Ye[2]-Ye[0]-ge,it=Ye[3]-Ye[1]-Pe}const et=(Ye,at,Ge,He)=>{const bt=qd(Ye.stretch-ve,ge,k,c.left),gt=Xd(Ye.fixed-Be,nt,Ye.stretch,q),kt=qd(at.stretch-we,Pe,F,c.top),gi=Xd(at.fixed-dt,it,at.stretch,Q),bi=qd(Ge.stretch-ve,ge,k,c.left),Qi=Xd(Ge.fixed-Be,nt,Ge.stretch,q),On=qd(He.stretch-we,Pe,F,c.top),Hr=Xd(He.fixed-dt,it,He.stretch,Q),qi=new P(bt,kt),pr=new P(bi,kt),wr=new P(bi,On),qr=new P(bt,On),Xr=new P(gt/w,gi/w),er=new P(Qi/w,Hr/w),tr=s*Math.PI/180;if(tr){const Rr=Math.sin(tr),pn=Math.cos(tr),gn=[pn,-Rr,Rr,pn];qi._matMult(gn),pr._matMult(gn),qr._matMult(gn),wr._matMult(gn)}const Cr=Ye.stretch+Ye.fixed,Zr=at.stretch+at.fixed;return{tl:qi,tr:pr,bl:qr,br:wr,tex:{x:v.paddedRect.x+ql+Cr,y:v.paddedRect.y+ql+Zr,w:Ge.stretch+Ge.fixed-Cr,h:He.stretch+He.fixed-Zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xr,pixelOffsetBR:er,minFontScaleX:nt/w/k,minFontScaleY:it/w/F,isSDF:u}};if(f&&(v.stretchX||v.stretchY)){const Ye=iv(L,ae,q),at=iv(U,de,Q);for(let Ge=0;Ge<Ye.length-1;Ge++){const He=Ye[Ge],bt=Ye[Ge+1];for(let gt=0;gt<at.length-1;gt++)_.push(et(He,at[gt],bt,at[gt+1]))}}else _.push(et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:C+1}));return _}function Hd(c,s,u){let f=0;for(const _ of c)f+=Math.max(s,Math.min(u,_[1]))-Math.max(s,Math.min(u,_[0]));return f}function iv(c,s,u){const f=[{fixed:-ql,stretch:0}];for(const[_,v]of c){const w=f[f.length-1];f.push({fixed:_-w.stretch,stretch:w.stretch}),f.push({fixed:_-w.stretch,stretch:w.stretch+(v-_)})}return f.push({fixed:s+ql,stretch:u}),f}function qd(c,s,u,f){return c/s*u+f}function Xd(c,s,u,f){return c-s*u/f}class Zd{constructor(s,u,f,_,v,w,E,C,k,F){if(this.boxStartIndex=s.length,k){let L=w.top,U=w.bottom;const W=w.collisionPadding;W&&(L-=W[1],U+=W[3]);let q=U-L;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{let L=w.top*E-C[0],U=w.bottom*E+C[2],W=w.left*E-C[3],q=w.right*E+C[1];const Q=w.collisionPadding;if(Q&&(W-=Q[0]*E,L-=Q[1]*E,q+=Q[2]*E,U+=Q[3]*E),F){const ae=new P(W,L),de=new P(q,L),ve=new P(W,U),ge=new P(q,U),we=F*Math.PI/180;ae._rotate(we),de._rotate(we),ve._rotate(we),ge._rotate(we),W=Math.min(ae.x,de.x,ve.x,ge.x),q=Math.max(ae.x,de.x,ve.x,ge.x),L=Math.min(ae.y,de.y,ve.y,ge.y),U=Math.max(ae.y,de.y,ve.y,ge.y)}s.emplaceBack(u.x,u.y,W,L,q,U,f,_,v)}this.boxEndIndex=s.length}}class hP{constructor(s=[],u=dP){if(this.data=s,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:u,compare:f}=this,_=u[s];for(;s>0;){const v=s-1>>1,w=u[v];if(f(_,w)>=0)break;u[s]=w,s=v}u[s]=_}_down(s){const{data:u,compare:f}=this,_=this.length>>1,v=u[s];for(;s<_;){let w=1+(s<<1),E=u[w];const C=w+1;if(C<this.length&&f(u[C],E)<0&&(w=C,E=u[C]),f(E,v)>=0)break;u[s]=E,s=w}u[s]=v}}function dP(c,s){return c<s?-1:c>s?1:0}function fP(c,s=1,u=!1){let f=1/0,_=1/0,v=-1/0,w=-1/0;const E=c[0];for(let W=0;W<E.length;W++){const q=E[W];(!W||q.x<f)&&(f=q.x),(!W||q.y<_)&&(_=q.y),(!W||q.x>v)&&(v=q.x),(!W||q.y>w)&&(w=q.y)}const C=Math.min(v-f,w-_);let k=C/2;const F=new hP([],pP);if(C===0)return new P(f,_);for(let W=f;W<v;W+=C)for(let q=_;q<w;q+=C)F.push(new Xl(W+k,q+k,k,c));let L=function(W){let q=0,Q=0,ae=0;const de=W[0];for(let ve=0,ge=de.length,we=ge-1;ve<ge;we=ve++){const Pe=de[ve],Be=de[we],nt=Pe.x*Be.y-Be.x*Pe.y;Q+=(Pe.x+Be.x)*nt,ae+=(Pe.y+Be.y)*nt,q+=3*nt}return new Xl(Q/q,ae/q,0,W)}(c),U=F.length;for(;F.length;){const W=F.pop();(W.d>L.d||!L.d)&&(L=W,u&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,U)),W.max-L.d<=s||(k=W.h/2,F.push(new Xl(W.p.x-k,W.p.y-k,k,c)),F.push(new Xl(W.p.x+k,W.p.y-k,k,c)),F.push(new Xl(W.p.x-k,W.p.y+k,k,c)),F.push(new Xl(W.p.x+k,W.p.y+k,k,c)),U+=4)}return u&&(console.log(`num probes: ${U}`),console.log(`best distance: ${L.d}`)),L.p}function pP(c,s){return s.max-c.max}function Xl(c,s,u,f){this.p=new P(c,s),this.h=u,this.d=function(_,v){let w=!1,E=1/0;for(let C=0;C<v.length;C++){const k=v[C];for(let F=0,L=k.length,U=L-1;F<L;U=F++){const W=k[F],q=k[U];W.y>_.y!=q.y>_.y&&_.x<(q.x-W.x)*(_.y-W.y)/(q.y-W.y)+W.x&&(w=!w),E=Math.min(E,B0(_,W,q))}}return(w?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var br;a.aq=void 0,(br=a.aq||(a.aq={}))[br.center=1]="center",br[br.left=2]="left",br[br.right=3]="right",br[br.top=4]="top",br[br.bottom=5]="bottom",br[br["top-left"]=6]="top-left",br[br["top-right"]=7]="top-right",br[br["bottom-left"]=8]="bottom-left",br[br["bottom-right"]=9]="bottom-right";const Zo=7,o_=Number.POSITIVE_INFINITY;function rv(c,s){return s[1]!==o_?function(u,f,_){let v=0,w=0;switch(f=Math.abs(f),_=Math.abs(_),u){case"top-right":case"top-left":case"top":w=_-Zo;break;case"bottom-right":case"bottom-left":case"bottom":w=-_+Zo}switch(u){case"top-right":case"bottom-right":case"right":v=-f;break;case"top-left":case"bottom-left":case"left":v=f}return[v,w]}(c,s[0],s[1]):function(u,f){let _=0,v=0;f<0&&(f=0);const w=f/Math.SQRT2;switch(u){case"top-right":case"top-left":v=w-Zo;break;case"bottom-right":case"bottom-left":v=-w+Zo;break;case"bottom":v=-f+Zo;break;case"top":v=f-Zo}switch(u){case"top-right":case"bottom-right":_=-w;break;case"top-left":case"bottom-left":_=w;break;case"left":_=f;break;case"right":_=-f}return[_,v]}(c,s[0])}function nv(c,s,u){var f;const _=c.layout,v=(f=_.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(s,{},u);if(v){const E=v.values,C=[];for(let k=0;k<E.length;k+=2){const F=C[k]=E[k],L=E[k+1].map(U=>U*Ji);F.startsWith("top")?L[1]-=Zo:F.startsWith("bottom")&&(L[1]+=Zo),C[k+1]=L}return new ur(C)}const w=_.get("text-variable-anchor");if(w){let E;E=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(s,{},u)*Ji,o_]:_.get("text-offset").evaluate(s,{},u).map(k=>k*Ji);const C=[];for(const k of w)C.push(k,rv(k,E));return new ur(C)}return null}function a_(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gP(c,s,u,f,_,v,w,E,C,k,F){let L=v.textMaxSize.evaluate(s,{});L===void 0&&(L=w);const U=c.layers[0].layout,W=U.get("icon-offset").evaluate(s,{},F),q=ov(u.horizontal),Q=w/24,ae=c.tilePixelRatio*Q,de=c.tilePixelRatio*L/24,ve=c.tilePixelRatio*E,ge=c.tilePixelRatio*U.get("symbol-spacing"),we=U.get("text-padding")*c.tilePixelRatio,Pe=function(He,bt,gt,kt=1){const gi=He.get("icon-padding").evaluate(bt,{},gt),bi=gi&&gi.values;return[bi[0]*kt,bi[1]*kt,bi[2]*kt,bi[3]*kt]}(U,s,F,c.tilePixelRatio),Be=U.get("text-max-angle")/180*Math.PI,nt=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",dt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",it=U.get("symbol-placement"),et=ge/2,Ye=U.get("icon-text-fit");let at;f&&Ye!=="none"&&(c.allowVerticalPlacement&&u.vertical&&(at=Ix(f,u.vertical,Ye,U.get("icon-text-fit-padding"),W,Q)),q&&(f=Ix(f,q,Ye,U.get("icon-text-fit-padding"),W,Q)));const Ge=(He,bt)=>{bt.x<0||bt.x>=Hi||bt.y<0||bt.y>=Hi||function(gt,kt,gi,bi,Qi,On,Hr,qi,pr,wr,qr,Xr,er,tr,Cr,Zr,Rr,pn,gn,ir,Bt,Mr,Tr,rr,rs){const ws=gt.addToLineVertexArray(kt,gi);let Ts,_o,ns,jn,_n=0,mo=0,Uu=0,uv=0,g_=-1,__=-1;const yo={};let hv=ho("");if(gt.allowVerticalPlacement&&bi.vertical){const kr=qi.layout.get("text-rotate").evaluate(Bt,{},rr)+90;ns=new Zd(pr,kt,wr,qr,Xr,bi.vertical,er,tr,Cr,kr),Hr&&(jn=new Zd(pr,kt,wr,qr,Xr,Hr,Rr,pn,Cr,kr))}if(Qi){const kr=qi.layout.get("icon-rotate").evaluate(Bt,{}),Wn=qi.layout.get("icon-text-fit")!=="none",Va=tv(Qi,kr,Tr,Wn),Es=Hr?tv(Hr,kr,Tr,Wn):void 0;_o=new Zd(pr,kt,wr,qr,Xr,Qi,Rr,pn,!1,kr),_n=4*Va.length;const $a=gt.iconSizeData;let Vs=null;$a.kind==="source"?(Vs=[Us*qi.layout.get("icon-size").evaluate(Bt,{})],Vs[0]>Ho&&ot(`${gt.layerIds[0]}: Value for "icon-size" is >= ${Nu}. Reduce your "icon-size".`)):$a.kind==="composite"&&(Vs=[Us*Mr.compositeIconSizes[0].evaluate(Bt,{},rr),Us*Mr.compositeIconSizes[1].evaluate(Bt,{},rr)],(Vs[0]>Ho||Vs[1]>Ho)&&ot(`${gt.layerIds[0]}: Value for "icon-size" is >= ${Nu}. Reduce your "icon-size".`)),gt.addSymbols(gt.icon,Va,Vs,ir,gn,Bt,a.ai.none,kt,ws.lineStartIndex,ws.lineLength,-1,rr),g_=gt.icon.placedSymbolArray.length-1,Es&&(mo=4*Es.length,gt.addSymbols(gt.icon,Es,Vs,ir,gn,Bt,a.ai.vertical,kt,ws.lineStartIndex,ws.lineLength,-1,rr),__=gt.icon.placedSymbolArray.length-1)}const dv=Object.keys(bi.horizontal);for(const kr of dv){const Wn=bi.horizontal[kr];if(!Ts){hv=ho(Wn.text);const Es=qi.layout.get("text-rotate").evaluate(Bt,{},rr);Ts=new Zd(pr,kt,wr,qr,Xr,Wn,er,tr,Cr,Es)}const Va=Wn.positionedLines.length===1;if(Uu+=sv(gt,kt,Wn,On,qi,Cr,Bt,Zr,ws,bi.vertical?a.ai.horizontal:a.ai.horizontalOnly,Va?dv:[kr],yo,g_,Mr,rr),Va)break}bi.vertical&&(uv+=sv(gt,kt,bi.vertical,On,qi,Cr,Bt,Zr,ws,a.ai.vertical,["vertical"],yo,__,Mr,rr));const yP=Ts?Ts.boxStartIndex:gt.collisionBoxArray.length,xP=Ts?Ts.boxEndIndex:gt.collisionBoxArray.length,vP=ns?ns.boxStartIndex:gt.collisionBoxArray.length,bP=ns?ns.boxEndIndex:gt.collisionBoxArray.length,wP=_o?_o.boxStartIndex:gt.collisionBoxArray.length,TP=_o?_o.boxEndIndex:gt.collisionBoxArray.length,SP=jn?jn.boxStartIndex:gt.collisionBoxArray.length,EP=jn?jn.boxEndIndex:gt.collisionBoxArray.length;let Ss=-1;const Kd=(kr,Wn)=>kr&&kr.circleDiameter?Math.max(kr.circleDiameter,Wn):Wn;Ss=Kd(Ts,Ss),Ss=Kd(ns,Ss),Ss=Kd(_o,Ss),Ss=Kd(jn,Ss);const fv=Ss>-1?1:0;fv&&(Ss*=rs/Ji),gt.glyphOffsetArray.length>=Hl.MAX_GLYPHS&&ot("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Bt.sortKey!==void 0&&gt.addToSortKeyRanges(gt.symbolInstances.length,Bt.sortKey);const AP=nv(qi,Bt,rr),[PP,IP]=function(kr,Wn){const Va=kr.length,Es=Wn==null?void 0:Wn.values;if((Es==null?void 0:Es.length)>0)for(let $a=0;$a<Es.length;$a+=2){const Vs=Es[$a+1];kr.emplaceBack(a.aq[Es[$a]],Vs[0],Vs[1])}return[Va,kr.length]}(gt.textAnchorOffsets,AP);gt.symbolInstances.emplaceBack(kt.x,kt.y,yo.right>=0?yo.right:-1,yo.center>=0?yo.center:-1,yo.left>=0?yo.left:-1,yo.vertical||-1,g_,__,hv,yP,xP,vP,bP,wP,TP,SP,EP,wr,Uu,uv,_n,mo,fv,0,er,Ss,PP,IP)}(c,bt,He,u,f,_,at,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,ae,[we,we,we,we],nt,C,ve,Pe,dt,W,s,v,k,F,w)};if(it==="line")for(const He of Yx(s.geometry,0,0,Hi,Hi)){const bt=uP(He,ge,Be,u.vertical||q,f,24,de,c.overscaling,Hi);for(const gt of bt)q&&_P(c,q.text,et,gt)||Ge(He,gt)}else if(it==="line-center"){for(const He of s.geometry)if(He.length>1){const bt=cP(He,Be,u.vertical||q,f,24,de);bt&&Ge(He,bt)}}else if(s.type==="Polygon")for(const He of zg(s.geometry,0)){const bt=fP(He,16);Ge(He[0],new Xo(bt.x,bt.y,0))}else if(s.type==="LineString")for(const He of s.geometry)Ge(He,new Xo(He[0].x,He[0].y,0));else if(s.type==="Point")for(const He of s.geometry)for(const bt of He)Ge([bt],new Xo(bt.x,bt.y,0))}function sv(c,s,u,f,_,v,w,E,C,k,F,L,U,W,q){const Q=function(ve,ge,we,Pe,Be,nt,dt,it){const et=Pe.layout.get("text-rotate").evaluate(nt,{})*Math.PI/180,Ye=[];for(const at of ge.positionedLines)for(const Ge of at.positionedGlyphs){if(!Ge.rect)continue;const He=Ge.rect||{};let bt=bx+1,gt=!0,kt=1,gi=0;const bi=(Be||it)&&Ge.vertical,Qi=Ge.metrics.advance*Ge.scale/2;if(it&&ge.verticalizable&&(gi=at.lineOffset/2-(Ge.imageName?-(Ji-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*Ji)),Ge.imageName){const ir=dt[Ge.imageName];gt=ir.sdf,kt=ir.pixelRatio,bt=fn/kt}const On=Be?[Ge.x+Qi,Ge.y]:[0,0];let Hr=Be?[0,0]:[Ge.x+Qi+we[0],Ge.y+we[1]-gi],qi=[0,0];bi&&(qi=Hr,Hr=[0,0]);const pr=Ge.metrics.isDoubleResolution?2:1,wr=(Ge.metrics.left-bt)*Ge.scale-Qi+Hr[0],qr=(-Ge.metrics.top-bt)*Ge.scale+Hr[1],Xr=wr+He.w/pr*Ge.scale/kt,er=qr+He.h/pr*Ge.scale/kt,tr=new P(wr,qr),Cr=new P(Xr,qr),Zr=new P(wr,er),Rr=new P(Xr,er);if(bi){const ir=new P(-Qi,Qi-Fu),Bt=-Math.PI/2,Mr=Ji/2-Qi,Tr=new P(5-Fu-Mr,-(Ge.imageName?Mr:0)),rr=new P(...qi);tr._rotateAround(Bt,ir)._add(Tr)._add(rr),Cr._rotateAround(Bt,ir)._add(Tr)._add(rr),Zr._rotateAround(Bt,ir)._add(Tr)._add(rr),Rr._rotateAround(Bt,ir)._add(Tr)._add(rr)}if(et){const ir=Math.sin(et),Bt=Math.cos(et),Mr=[Bt,-ir,ir,Bt];tr._matMult(Mr),Cr._matMult(Mr),Zr._matMult(Mr),Rr._matMult(Mr)}const pn=new P(0,0),gn=new P(0,0);Ye.push({tl:tr,tr:Cr,bl:Zr,br:Rr,tex:He,writingMode:ge.writingMode,glyphOffset:On,sectionIndex:Ge.sectionIndex,isSDF:gt,pixelOffsetTL:pn,pixelOffsetBR:gn,minFontScaleX:0,minFontScaleY:0})}return Ye}(0,u,E,_,v,w,f,c.allowVerticalPlacement),ae=c.textSizeData;let de=null;ae.kind==="source"?(de=[Us*_.layout.get("text-size").evaluate(w,{})],de[0]>Ho&&ot(`${c.layerIds[0]}: Value for "text-size" is >= ${Nu}. Reduce your "text-size".`)):ae.kind==="composite"&&(de=[Us*W.compositeTextSizes[0].evaluate(w,{},q),Us*W.compositeTextSizes[1].evaluate(w,{},q)],(de[0]>Ho||de[1]>Ho)&&ot(`${c.layerIds[0]}: Value for "text-size" is >= ${Nu}. Reduce your "text-size".`)),c.addSymbols(c.text,Q,de,E,v,w,k,s,C.lineStartIndex,C.lineLength,U,q);for(const ve of F)L[ve]=c.text.placedSymbolArray.length-1;return 4*Q.length}function ov(c){for(const s in c)return c[s];return null}function _P(c,s,u,f){const _=c.compareText;if(s in _){const v=_[s];for(let w=v.length-1;w>=0;w--)if(f.dist(v[w])<u)return!0}else _[s]=[];return _[s].push(f),!1}const av=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class l_{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,f]=new Uint8Array(s,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=f>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const v=av[15&f];if(!v)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(s,2,1),[E]=new Uint32Array(s,4,1);return new l_(E,w,v,s)}constructor(s,u=64,f=Float64Array,_){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=f,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const v=av.indexOf(this.ArrayType),w=2*s*this.ArrayType.BYTES_PER_ELEMENT,E=s*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-E%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${f}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+E+C,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+w+E+C),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+E+C,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=s)}add(s,u){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=s,this.coords[this._pos++]=u,f}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return c_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,u,f,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:w,nodeSize:E}=this,C=[0,v.length-1,0],k=[];for(;C.length;){const F=C.pop()||0,L=C.pop()||0,U=C.pop()||0;if(L-U<=E){for(let ae=U;ae<=L;ae++){const de=w[2*ae],ve=w[2*ae+1];de>=s&&de<=f&&ve>=u&&ve<=_&&k.push(v[ae])}continue}const W=U+L>>1,q=w[2*W],Q=w[2*W+1];q>=s&&q<=f&&Q>=u&&Q<=_&&k.push(v[W]),(F===0?s<=q:u<=Q)&&(C.push(U),C.push(W-1),C.push(1-F)),(F===0?f>=q:_>=Q)&&(C.push(W+1),C.push(L),C.push(1-F))}return k}within(s,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:w}=this,E=[0,_.length-1,0],C=[],k=f*f;for(;E.length;){const F=E.pop()||0,L=E.pop()||0,U=E.pop()||0;if(L-U<=w){for(let ae=U;ae<=L;ae++)cv(v[2*ae],v[2*ae+1],s,u)<=k&&C.push(_[ae]);continue}const W=U+L>>1,q=v[2*W],Q=v[2*W+1];cv(q,Q,s,u)<=k&&C.push(_[W]),(F===0?s-f<=q:u-f<=Q)&&(E.push(U),E.push(W-1),E.push(1-F)),(F===0?s+f>=q:u+f>=Q)&&(E.push(W+1),E.push(L),E.push(1-F))}return C}}function c_(c,s,u,f,_,v){if(_-f<=u)return;const w=f+_>>1;lv(c,s,w,f,_,v),c_(c,s,u,f,w-1,1-v),c_(c,s,u,w+1,_,1-v)}function lv(c,s,u,f,_,v){for(;_>f;){if(_-f>600){const k=_-f+1,F=u-f+1,L=Math.log(k),U=.5*Math.exp(2*L/3),W=.5*Math.sqrt(L*U*(k-U)/k)*(F-k/2<0?-1:1);lv(c,s,u,Math.max(f,Math.floor(u-F*U/k+W)),Math.min(_,Math.floor(u+(k-F)*U/k+W)),v)}const w=s[2*u+v];let E=f,C=_;for(Bu(c,s,f,u),s[2*_+v]>w&&Bu(c,s,f,_);E<C;){for(Bu(c,s,E,C),E++,C--;s[2*E+v]<w;)E++;for(;s[2*C+v]>w;)C--}s[2*f+v]===w?Bu(c,s,f,C):(C++,Bu(c,s,C,_)),C<=u&&(f=C+1),u<=C&&(_=C-1)}}function Bu(c,s,u,f){u_(c,u,f),u_(s,2*u,2*f),u_(s,2*u+1,2*f+1)}function u_(c,s,u){const f=c[s];c[s]=c[u],c[u]=f}function cv(c,s,u,f){const _=c-u,v=s-f;return _*_+v*v}var h_;a.bh=void 0,(h_=a.bh||(a.bh={})).create="create",h_.load="load",h_.fullLoad="fullLoad";let Yd=null,zu=[];const d_=1e3/60,f_="loadTime",p_="fullLoadTime",mP={mark(c){performance.mark(c)},frame(c){const s=c;Yd!=null&&zu.push(s-Yd),Yd=s},clearMetrics(){Yd=null,zu=[],performance.clearMeasures(f_),performance.clearMeasures(p_);for(const c in a.bh)performance.clearMarks(a.bh[c])},getPerformanceMetrics(){performance.measure(f_,a.bh.create,a.bh.load),performance.measure(p_,a.bh.create,a.bh.fullLoad);const c=performance.getEntriesByName(f_)[0].duration,s=performance.getEntriesByName(p_)[0].duration,u=zu.length,f=1/(zu.reduce((v,w)=>v+w,0)/u/1e3),_=zu.filter(v=>v>d_).reduce((v,w)=>v+(w-d_)/d_,0);return{loadTime:c,fullLoadTime:s,fps:f,percentDroppedFrames:_/(u+_)*100,totalFrames:u}}};a.$=function(c,s,u){var f,_,v,w,E,C,k,F,L,U,W,q,Q=u[0],ae=u[1],de=u[2];return s===c?(c[12]=s[0]*Q+s[4]*ae+s[8]*de+s[12],c[13]=s[1]*Q+s[5]*ae+s[9]*de+s[13],c[14]=s[2]*Q+s[6]*ae+s[10]*de+s[14],c[15]=s[3]*Q+s[7]*ae+s[11]*de+s[15]):(_=s[1],v=s[2],w=s[3],E=s[4],C=s[5],k=s[6],F=s[7],L=s[8],U=s[9],W=s[10],q=s[11],c[0]=f=s[0],c[1]=_,c[2]=v,c[3]=w,c[4]=E,c[5]=C,c[6]=k,c[7]=F,c[8]=L,c[9]=U,c[10]=W,c[11]=q,c[12]=f*Q+E*ae+L*de+s[12],c[13]=_*Q+C*ae+U*de+s[13],c[14]=v*Q+k*ae+W*de+s[14],c[15]=w*Q+F*ae+q*de+s[15]),c},a.A=zl,a.B=ln,a.C=class{constructor(c,s,u){this.receive=f=>{const _=f.data,v=_.id;if(v&&(!_.targetMapId||this.mapId===_.targetMapId))if(_.type==="<cancel>"){delete this.tasks[v];const w=this.cancelCallbacks[v];delete this.cancelCallbacks[v],w&&w()}else lr()||_.mustQueue?(this.tasks[v]=_,this.taskQueue.push(v),this.invoker.trigger()):this.processTask(v,_)},this.process=()=>{if(!this.taskQueue.length)return;const f=this.taskQueue.shift(),_=this.tasks[f];delete this.tasks[f],this.taskQueue.length&&this.invoker.trigger(),_&&this.processTask(f,_)},this.target=c,this.parent=s,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new aP(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=lr()?c:window}send(c,s,u,f,_=!1){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[v]=u);const w=[],E={id:v,type:c,hasCallback:!!u,targetMapId:f,mustQueue:_,sourceMapId:this.mapId,data:Ls(s,w)};return this.target.postMessage(E,{transfer:w}),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}processTask(c,s){if(s.type==="<response>"){const u=this.callbacks[c];delete this.callbacks[c],u&&(s.error?u(zo(s.error)):u(null,zo(s.data)))}else{let u=!1;const f=[],_=s.hasCallback?(E,C)=>{u=!0,delete this.cancelCallbacks[c];const k={id:c,type:"<response>",sourceMapId:this.mapId,error:E?Ls(E):null,data:Ls(C,f)};this.target.postMessage(k,{transfer:f})}:E=>{u=!0};let v=null;const w=zo(s.data);if(this.parent[s.type])v=this.parent[s.type](s.sourceMapId,w,_);else if("getWorkerSource"in this.parent){const E=s.type.split(".");v=this.parent.getWorkerSource(s.sourceMapId,E[0],w.source)[E[1]](w,_)}else _(new Error(`Could not find function ${s.type}`));!u&&v&&v.cancel&&(this.cancelCallbacks[c]=v.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.D=_t,a.E=Zn,a.F=function(c,s){const u={};for(let f=0;f<s.length;f++){const _=s[f];_ in c&&(u[_]=c[_])}return u},a.G=Lx,a.H=Bx,a.I=Yg,a.J=fe,a.K=re,a.L=qo,a.M=eo,a.N=Hi,a.O=$n,a.P=P,a.Q=Ai,a.R=Vn,a.S=pi,a.T=Sd,a.U=Wd,a.V=class extends co{},a.W=s_,a.X=function(c,s){const u=window.document.createElement("video");u.muted=!0,u.onloadstart=function(){s(null,u)};for(let f=0;f<c.length;f++){const _=window.document.createElement("source");Er(c[f])||(u.crossOrigin="Anonymous"),_.src=c[f],u.appendChild(_)}return{cancel:()=>{}}},a.Y=Ze,a.Z=function(){var c=new zl(16);return zl!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},a._=g,a.a=ks,a.a$=class extends ${},a.a0=function(c,s,u){var f=u[0],_=u[1],v=u[2];return c[0]=s[0]*f,c[1]=s[1]*f,c[2]=s[2]*f,c[3]=s[3]*f,c[4]=s[4]*_,c[5]=s[5]*_,c[6]=s[6]*_,c[7]=s[7]*_,c[8]=s[8]*v,c[9]=s[9]*v,c[10]=s[10]*v,c[11]=s[11]*v,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},a.a1=$0,a.a2=function(){return je++},a.a3=se,a.a4=Hl,a.a5=function(){hn.isLoading()||hn.isLoaded()||fu()!=="deferred"||Td()},a.a6=iu,a.a7=za,a.a8=fi,a.a9=Hx,a.aA=Oa,a.aB=function(c){c=c.slice();const s=Object.create(null);for(let u=0;u<c.length;u++)s[c[u].id]=c[u];for(let u=0;u<c.length;u++)"ref"in c[u]&&(c[u]=Lr(c[u],s[c[u].ref]));return c},a.aC=function(c){if(c.type==="custom")return new oP(c);switch(c.type){case"background":return new rP(c);case"circle":return new $A(c);case"fill":return new l2(c);case"fill-extrusion":return new T2(c);case"heatmap":return new WA(c);case"hillshade":return new qA(c);case"line":return new M2(c);case"raster":return new sP(c);case"symbol":return new jd(c)}},a.aD=tt,a.aE=function(c,s){if(!c)return[{command:jt.setStyle,args:[s]}];let u=[];try{if(!ti(c.version,s.version))return[{command:jt.setStyle,args:[s]}];ti(c.center,s.center)||u.push({command:jt.setCenter,args:[s.center]}),ti(c.zoom,s.zoom)||u.push({command:jt.setZoom,args:[s.zoom]}),ti(c.bearing,s.bearing)||u.push({command:jt.setBearing,args:[s.bearing]}),ti(c.pitch,s.pitch)||u.push({command:jt.setPitch,args:[s.pitch]}),ti(c.sprite,s.sprite)||u.push({command:jt.setSprite,args:[s.sprite]}),ti(c.glyphs,s.glyphs)||u.push({command:jt.setGlyphs,args:[s.glyphs]}),ti(c.transition,s.transition)||u.push({command:jt.setTransition,args:[s.transition]}),ti(c.light,s.light)||u.push({command:jt.setLight,args:[s.light]});const f={},_=[];(function(w,E,C,k){let F;for(F in E=E||{},w=w||{})Object.prototype.hasOwnProperty.call(w,F)&&(Object.prototype.hasOwnProperty.call(E,F)||Fs(F,C,k));for(F in E)Object.prototype.hasOwnProperty.call(E,F)&&(Object.prototype.hasOwnProperty.call(w,F)?ti(w[F],E[F])||(w[F].type==="geojson"&&E[F].type==="geojson"&&to(w,E,F)?C.push({command:jt.setGeoJSONSourceData,args:[F,E[F].data]}):En(F,E,C,k)):Sn(F,E,C))})(c.sources,s.sources,_,f);const v=[];c.layers&&c.layers.forEach(w=>{f[w.source]?u.push({command:jt.removeLayer,args:[w.id]}):v.push(w)}),u=u.concat(_),function(w,E,C){E=E||[];const k=(w=w||[]).map(Bn),F=E.map(Bn),L=w.reduce(An,{}),U=E.reduce(An,{}),W=k.slice(),q=Object.create(null);let Q,ae,de,ve,ge,we,Pe;for(Q=0,ae=0;Q<k.length;Q++)de=k[Q],Object.prototype.hasOwnProperty.call(U,de)?ae++:(C.push({command:jt.removeLayer,args:[de]}),W.splice(W.indexOf(de,ae),1));for(Q=0,ae=0;Q<F.length;Q++)de=F[F.length-1-Q],W[W.length-1-Q]!==de&&(Object.prototype.hasOwnProperty.call(L,de)?(C.push({command:jt.removeLayer,args:[de]}),W.splice(W.lastIndexOf(de,W.length-ae),1)):ae++,we=W[W.length-Q],C.push({command:jt.addLayer,args:[U[de],we]}),W.splice(W.length-Q,0,de),q[de]=!0);for(Q=0;Q<F.length;Q++)if(de=F[Q],ve=L[de],ge=U[de],!q[de]&&!ti(ve,ge))if(ti(ve.source,ge.source)&&ti(ve["source-layer"],ge["source-layer"])&&ti(ve.type,ge.type)){for(Pe in ds(ve.layout,ge.layout,C,de,null,jt.setLayoutProperty),ds(ve.paint,ge.paint,C,de,null,jt.setPaintProperty),ti(ve.filter,ge.filter)||C.push({command:jt.setFilter,args:[de,ge.filter]}),ti(ve.minzoom,ge.minzoom)&&ti(ve.maxzoom,ge.maxzoom)||C.push({command:jt.setLayerZoomRange,args:[de,ge.minzoom,ge.maxzoom]}),ve)Object.prototype.hasOwnProperty.call(ve,Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?ds(ve[Pe],ge[Pe],C,de,Pe.slice(6),jt.setPaintProperty):ti(ve[Pe],ge[Pe])||C.push({command:jt.setLayerProperty,args:[de,Pe,ge[Pe]]}));for(Pe in ge)Object.prototype.hasOwnProperty.call(ge,Pe)&&!Object.prototype.hasOwnProperty.call(ve,Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?ds(ve[Pe],ge[Pe],C,de,Pe.slice(6),jt.setPaintProperty):ti(ve[Pe],ge[Pe])||C.push({command:jt.setLayerProperty,args:[de,Pe,ge[Pe]]}))}else C.push({command:jt.removeLayer,args:[de]}),we=W[W.lastIndexOf(de)+1],C.push({command:jt.addLayer,args:[ge,we]})}(v,s.layers,u)}catch(f){console.warn("Unable to compute style diff:",f),u=[{command:jt.setStyle,args:[s]}]}return u},a.aF=function(c){const s=[],u=c.id;return u===void 0&&s.push({message:`layers.${u}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${u}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),s},a.aG=function c(s,u){if(Array.isArray(s)){if(!Array.isArray(u)||s.length!==u.length)return!1;for(let f=0;f<s.length;f++)if(!c(s[f],u[f]))return!1;return!0}if(typeof s=="object"&&s!==null&&u!==null){if(typeof u!="object"||Object.keys(s).length!==Object.keys(u).length)return!1;for(const f in s)if(!c(s[f],u[f]))return!1;return!0}return s===u},a.aH=Ue,a.aI=ct,a.aJ=Fa,a.aK=function(c){return c({pluginStatus:$r,pluginURL:Bs}),Fa.on("pluginStateChange",c),c},a.aL=class extends fo{constructor(c,s){super(c,s),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},a.aM=Ll,a.aN=class extends fo{constructor(c,s){super(c,s),this.current=Pg}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let s=1;s<16;s++)if(c[s]!==this.current[s]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},a.aO=Id,a.aP=class extends fo{constructor(c,s){super(c,s),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},a.aQ=class extends fo{constructor(c,s){super(c,s),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},a.aR=Cd,a.aS=function(c,s,u,f,_,v,w){var E=1/(s-u),C=1/(f-_),k=1/(v-w);return c[0]=-2*E,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*C,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*k,c[11]=0,c[12]=(s+u)*E,c[13]=(_+f)*C,c[14]=(w+v)*k,c[15]=1,c},a.aT=Dt,a.aU=VA,a.aV=class extends p{},a.aW=D2,a.aX=class extends b{},a.aY=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},a.aZ=X0,a.a_=Xe,a.aa=function(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,_,v)=>{const w=_||v;return s[f]=!w||w.toLowerCase(),""}),s["max-age"]){const u=parseInt(s["max-age"],10);isNaN(u)?delete s["max-age"]:s["max-age"]=u}return s},a.ab=function(c,s){const u=[];for(const f in c)f in s||u.push(f);return u},a.ac=function(c){if(us==null){const s=c.navigator?c.navigator.userAgent:null;us=!!c.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return us},a.ad=Oe,a.ae=function(c,s,u){var f=Math.sin(u),_=Math.cos(u),v=s[0],w=s[1],E=s[2],C=s[3],k=s[4],F=s[5],L=s[6],U=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=v*_+k*f,c[1]=w*_+F*f,c[2]=E*_+L*f,c[3]=C*_+U*f,c[4]=k*_-v*f,c[5]=F*_-w*f,c[6]=L*_-E*f,c[7]=U*_-C*f,c},a.af=function(c){var s=new zl(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},a.ag=Od,a.ah=function(c,s){let u=0,f=0;if(c.kind==="constant")f=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:_,minZoom:v,maxZoom:w}=c,E=_?Oe(cn.interpolationFactor(_,s,v,w),0,1):0;c.kind==="camera"?f=ln.number(c.minSize,c.maxSize,E):u=E}return{uSizeT:u,uSize:f}},a.aj=function(c,{uSize:s,uSizeT:u},{lowerSize:f,upperSize:_}){return c.kind==="source"?f/Us:c.kind==="composite"?ln.number(f/Us,_/Us,u):s},a.ak=Qg,a.al=function(c,s,u,f){const _=s.y-c.y,v=s.x-c.x,w=f.y-u.y,E=f.x-u.x,C=w*v-E*_;if(C===0)return null;const k=(E*(c.y-u.y)-w*(c.x-u.x))/C;return new P(c.x+k*v,c.y+k*_)},a.am=Yx,a.an=N0,a.ao=kg,a.ap=Ji,a.ar=Jg,a.as=function(c,s){var u=s[0],f=s[1],_=s[2],v=s[3],w=s[4],E=s[5],C=s[6],k=s[7],F=s[8],L=s[9],U=s[10],W=s[11],q=s[12],Q=s[13],ae=s[14],de=s[15],ve=u*E-f*w,ge=u*C-_*w,we=u*k-v*w,Pe=f*C-_*E,Be=f*k-v*E,nt=_*k-v*C,dt=F*Q-L*q,it=F*ae-U*q,et=F*de-W*q,Ye=L*ae-U*Q,at=L*de-W*Q,Ge=U*de-W*ae,He=ve*Ge-ge*at+we*Ye+Pe*et-Be*it+nt*dt;return He?(c[0]=(E*Ge-C*at+k*Ye)*(He=1/He),c[1]=(_*at-f*Ge-v*Ye)*He,c[2]=(Q*nt-ae*Be+de*Pe)*He,c[3]=(U*Be-L*nt-W*Pe)*He,c[4]=(C*et-w*Ge-k*it)*He,c[5]=(u*Ge-_*et+v*it)*He,c[6]=(ae*we-q*nt-de*ge)*He,c[7]=(F*nt-U*we+W*ge)*He,c[8]=(w*at-E*et+k*dt)*He,c[9]=(f*et-u*at-v*dt)*He,c[10]=(q*Be-Q*we+de*ve)*He,c[11]=(L*we-F*Be-W*ve)*He,c[12]=(E*it-w*Ye-C*dt)*He,c[13]=(u*Ye-f*it+_*dt)*He,c[14]=(Q*ge-q*Pe-ae*ve)*He,c[15]=(F*Pe-L*ge+U*ve)*He,c):null},a.at=a_,a.au=Gg,a.av=l_,a.aw=function(){const c={},s=Fe.$version;for(const u in Fe.$root){const f=Fe.$root[u];if(f.required){let _=null;_=u==="version"?s:f.type==="array"?[]:{},_!=null&&(c[u]=_)}}return c},a.ax=jt,a.ay=xd,a.az=Yt,a.b=function(c,s){const u=new Blob([new Uint8Array(c)],{type:"image/png"});createImageBitmap(u).then(f=>{s(null,f)}).catch(f=>{s(new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},a.b0=dr,a.b1=function(c,s){var u=c[0],f=c[1],_=c[2],v=c[3],w=c[4],E=c[5],C=c[6],k=c[7],F=c[8],L=c[9],U=c[10],W=c[11],q=c[12],Q=c[13],ae=c[14],de=c[15],ve=s[0],ge=s[1],we=s[2],Pe=s[3],Be=s[4],nt=s[5],dt=s[6],it=s[7],et=s[8],Ye=s[9],at=s[10],Ge=s[11],He=s[12],bt=s[13],gt=s[14],kt=s[15];return Math.abs(u-ve)<=Wr*Math.max(1,Math.abs(u),Math.abs(ve))&&Math.abs(f-ge)<=Wr*Math.max(1,Math.abs(f),Math.abs(ge))&&Math.abs(_-we)<=Wr*Math.max(1,Math.abs(_),Math.abs(we))&&Math.abs(v-Pe)<=Wr*Math.max(1,Math.abs(v),Math.abs(Pe))&&Math.abs(w-Be)<=Wr*Math.max(1,Math.abs(w),Math.abs(Be))&&Math.abs(E-nt)<=Wr*Math.max(1,Math.abs(E),Math.abs(nt))&&Math.abs(C-dt)<=Wr*Math.max(1,Math.abs(C),Math.abs(dt))&&Math.abs(k-it)<=Wr*Math.max(1,Math.abs(k),Math.abs(it))&&Math.abs(F-et)<=Wr*Math.max(1,Math.abs(F),Math.abs(et))&&Math.abs(L-Ye)<=Wr*Math.max(1,Math.abs(L),Math.abs(Ye))&&Math.abs(U-at)<=Wr*Math.max(1,Math.abs(U),Math.abs(at))&&Math.abs(W-Ge)<=Wr*Math.max(1,Math.abs(W),Math.abs(Ge))&&Math.abs(q-He)<=Wr*Math.max(1,Math.abs(q),Math.abs(He))&&Math.abs(Q-bt)<=Wr*Math.max(1,Math.abs(Q),Math.abs(bt))&&Math.abs(ae-gt)<=Wr*Math.max(1,Math.abs(ae),Math.abs(gt))&&Math.abs(de-kt)<=Wr*Math.max(1,Math.abs(de),Math.abs(kt))},a.b2=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},a.b3=function(c,s,u){return c[0]=s[0]*u[0],c[1]=s[1]*u[1],c[2]=s[2]*u[2],c[3]=s[3]*u[3],c},a.b4=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]*s[3]},a.b5=$e,a.b6=$x,a.b7=zx,a.b8=function(c,s,u,f,_){var v,w=1/Math.tan(s/2);return c[0]=w/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=w,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,_!=null&&_!==1/0?(c[10]=(_+f)*(v=1/(f-_)),c[14]=2*_*f*v):(c[10]=-1,c[14]=-2*f),c},a.b9=function(c,s,u){var f=Math.sin(u),_=Math.cos(u),v=s[4],w=s[5],E=s[6],C=s[7],k=s[8],F=s[9],L=s[10],U=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=v*_+k*f,c[5]=w*_+F*f,c[6]=E*_+L*f,c[7]=C*_+U*f,c[8]=k*_-v*f,c[9]=F*_-w*f,c[10]=L*_-E*f,c[11]=U*_-C*f,c},a.bA=T,a.bB=px,a.bC=Al,a.bD=hn,a.ba=ue,a.bb=Me,a.bc=function(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},a.bd=class extends La{},a.be=r_,a.bf=Ux,a.bg=mP,a.bi=mr,a.bj=function(c,s,u=!1){if($r===lu||$r===cu||$r===uu)throw new Error("setRTLTextPlugin cannot be called multiple times.");Bs=Os.resolveURL(c),$r=lu,hu=s,du(),u||Td()},a.bk=fu,a.bl=function(c,s){const u={};for(let _=0;_<c.length;_++){const v=s&&s[c[_].id]||Rl(c[_]);s&&(s[c[_].id]=v);let w=u[v];w||(w=u[v]=[]),w.push(c[_])}const f=[];for(const _ in u)f.push(u[_]);return f},a.bm=st,a.bn=Wx,a.bo=qx,a.bp=Tx,a.bq=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=Hi/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const s=c.bucket.layers[0],u=s.layout,f=s._unevaluatedLayout._values,_={layoutIconSize:f["icon-size"].possiblyEvaluate(new fi(c.bucket.zoom+1),c.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new fi(c.bucket.zoom+1),c.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new fi(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:F}=c.bucket.textSizeData;_.compositeTextSizes=[f["text-size"].possiblyEvaluate(new fi(k),c.canonical),f["text-size"].possiblyEvaluate(new fi(F),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:F}=c.bucket.iconSizeData;_.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new fi(k),c.canonical),f["icon-size"].possiblyEvaluate(new fi(F),c.canonical)]}const v=u.get("text-line-height")*Ji,w=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",E=u.get("text-keep-upright"),C=u.get("text-size");for(const k of c.bucket.features){const F=u.get("text-font").evaluate(k,{},c.canonical).join(","),L=C.evaluate(k,{},c.canonical),U=_.layoutTextSize.evaluate(k,{},c.canonical),W=_.layoutIconSize.evaluate(k,{},c.canonical),q={horizontal:{},vertical:void 0},Q=k.text;let ae,de=[0,0];if(Q){const we=Q.toString(),Pe=u.get("text-letter-spacing").evaluate(k,{},c.canonical)*Ji,Be=ou(we)?Pe:0,nt=u.get("text-anchor").evaluate(k,{},c.canonical),dt=nv(s,k,c.canonical);if(!dt){const Ge=u.get("text-radial-offset").evaluate(k,{},c.canonical);de=Ge?rv(nt,[Ge*Ji,o_]):u.get("text-offset").evaluate(k,{},c.canonical).map(He=>He*Ji)}let it=w?"center":u.get("text-justify").evaluate(k,{},c.canonical);const et=u.get("symbol-placement"),Ye=et==="point"?u.get("text-max-width").evaluate(k,{},c.canonical)*Ji:0,at=()=>{c.bucket.allowVerticalPlacement&&su(we)&&(q.vertical=Ud(Q,c.glyphMap,c.glyphPositions,c.imagePositions,F,Ye,v,nt,"left",Be,de,a.ai.vertical,!0,et,U,L))};if(!w&&dt){const Ge=new Set;if(it==="auto")for(let bt=0;bt<dt.values.length;bt+=2)Ge.add(a_(dt.values[bt]));else Ge.add(it);let He=!1;for(const bt of Ge)if(!q.horizontal[bt])if(He)q.horizontal[bt]=q.horizontal[0];else{const gt=Ud(Q,c.glyphMap,c.glyphPositions,c.imagePositions,F,Ye,v,"center",bt,Be,de,a.ai.horizontal,!1,et,U,L);gt&&(q.horizontal[bt]=gt,He=gt.positionedLines.length===1)}at()}else{it==="auto"&&(it=a_(nt));const Ge=Ud(Q,c.glyphMap,c.glyphPositions,c.imagePositions,F,Ye,v,nt,it,Be,de,a.ai.horizontal,!1,et,U,L);Ge&&(q.horizontal[it]=Ge),at(),su(we)&&w&&E&&(q.vertical=Ud(Q,c.glyphMap,c.glyphPositions,c.imagePositions,F,Ye,v,nt,it,Be,de,a.ai.vertical,!1,et,U,L))}}let ve=!1;if(k.icon&&k.icon.name){const we=c.imageMap[k.icon.name];we&&(ae=J2(c.imagePositions[k.icon.name],u.get("icon-offset").evaluate(k,{},c.canonical),u.get("icon-anchor").evaluate(k,{},c.canonical)),ve=!!we.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=ve:c.bucket.sdfIcons!==ve&&ot("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(we.pixelRatio!==c.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const ge=ov(q.horizontal)||q.vertical;c.bucket.iconsInText=!!ge&&ge.iconsInText,(ge||ae)&&gP(c.bucket,k,q,ae,c.imageMap,_,U,W,de,ve,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},a.br=Hg,a.bs=$g,a.bt=Wg,a.bu=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},a.bv=Xg,a.bw=jo,a.bx=function(c,s,u,f,_){return g(this,void 0,void 0,function*(){if(re())try{return yield eo(c,s,u,f,_)}catch{}return function(v,w,E,C,k){const F=v.width,L=v.height;_r&&oi||(_r=new OffscreenCanvas(F,L),oi=_r.getContext("2d",{willReadFrequently:!0})),_r.width=F,_r.height=L,oi.drawImage(v,0,0,F,L);const U=oi.getImageData(w,E,C,k);return oi.clearRect(0,0,F,L),U.data}(c,s,u,f,_)})},a.by=jx,a.bz=y,a.c=Mi,a.d=function(c,s){const u=new Image;u.onload=()=>{s(null,u),URL.revokeObjectURL(u.src),u.onload=null,window.requestAnimationFrame(()=>{u.src=Co})},u.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(c)],{type:"image/png"});u.src=c.byteLength?URL.createObjectURL(f):Co},a.e=ke,a.f=function(c,s){return Nr(ke(c,{type:"json"}),s)},a.g=ci,a.h=Os,a.i=lr,a.j=Ln,a.k=yr,a.l=Nn,a.m=Nr,a.n=function(c){return new Xg(c).readFields(q2,[])},a.o=function(c,s,u){if(!c.length)return u(null,[]);let f=c.length;const _=new Array(c.length);let v=null;c.forEach((w,E)=>{s(w,(C,k)=>{C&&(v=C),_[E]=k,--f==0&&u(v,_)})})},a.p=wx,a.q=Au,a.r=zi,a.s=Er,a.t=Tg,a.u=rt,a.v=Fe,a.w=ot,a.x=Ol,a.y=xs,a.z=function([c,s,u]){return s+=90,s*=Math.PI/180,u*=Math.PI/180,{x:c*Math.cos(s)*Math.sin(u),y:c*Math.sin(s)*Math.sin(u),z:c*Math.cos(u)}}}),l(["./shared"],function(a){class g{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,V){for(const oe of z){this._layerConfigs[oe.id]=oe;const le=this._layers[oe.id]=a.aC(oe);le._featureFilter=a.a6(le.filter),this.keyCache[oe.id]&&delete this.keyCache[oe.id]}for(const oe of V)delete this.keyCache[oe],delete this._layerConfigs[oe],delete this._layers[oe];this.familiesBySource={};const Y=a.bl(Object.values(this._layerConfigs),this.keyCache);for(const oe of Y){const le=oe.map(Ne=>this._layers[Ne.id]),be=le[0];if(be.visibility==="none")continue;const _e=be.source||"";let he=this.familiesBySource[_e];he||(he=this.familiesBySource[_e]={});const ye=be.sourceLayer||"_geojsonTileLayer";let De=he[ye];De||(De=he[ye]=[]),De.push(le)}}}class y{constructor(z){const V={},Y=[];for(const _e in z){const he=z[_e],ye=V[_e]={};for(const De in he){const Ne=he[+De];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const ze={x:0,y:0,w:Ne.bitmap.width+2,h:Ne.bitmap.height+2};Y.push(ze),ye[De]={rect:ze,metrics:Ne.metrics}}}const{w:oe,h:le}=a.p(Y),be=new a.q({width:oe||1,height:le||1});for(const _e in z){const he=z[_e];for(const ye in he){const De=he[+ye];if(!De||De.bitmap.width===0||De.bitmap.height===0)continue;const Ne=V[_e][ye].rect;a.q.copy(De.bitmap,be,{x:0,y:0},{x:Ne.x+1,y:Ne.y+1},De.bitmap)}}this.image=be,this.positions=V}}a.bm("GlyphAtlas",y);class T{constructor(z){this.tileID=new a.O(z.tileID.overscaledZ,z.tileID.wrap,z.tileID.canonical.z,z.tileID.canonical.x,z.tileID.canonical.y),this.uid=z.uid,this.zoom=z.zoom,this.pixelRatio=z.pixelRatio,this.tileSize=z.tileSize,this.source=z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=z.showCollisionBoxes,this.collectResourceTiming=!!z.collectResourceTiming,this.returnDependencies=!!z.returnDependencies,this.promoteId=z.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(z,V,Y,oe,le){this.status="parsing",this.data=z,this.collisionBoxArray=new a.a3;const be=new a.bn(Object.keys(z.layers).sort()),_e=new a.bo(this.tileID,this.promoteId);_e.bucketLayerIDs=[];const he={},ye={featureIndex:_e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y},De=V.familiesBySource[this.source];for(const Rt in De){const Mt=z.layers[Rt];if(!Mt)continue;Mt.version===1&&a.w(`Vector tile source "${this.source}" layer "${Rt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ki=be.encode(Rt),Kt=[];for(let Ti=0;Ti<Mt.length;Ti++){const Zi=Mt.feature(Ti),Br=_e.getId(Zi,Rt);Kt.push({feature:Zi,id:Br,index:Ti,sourceLayerIndex:ki})}for(const Ti of De[Rt]){const Zi=Ti[0];Zi.source!==this.source&&a.w(`layer.source = ${Zi.source} does not equal this.source = ${this.source}`),Zi.minzoom&&this.zoom<Math.floor(Zi.minzoom)||Zi.maxzoom&&this.zoom>=Zi.maxzoom||Zi.visibility!=="none"&&(S(Ti,this.zoom,Y),(he[Zi.id]=Zi.createBucket({index:_e.bucketLayerIDs.length,layers:Ti,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ki,sourceID:this.source})).populate(Kt,ye,this.tileID.canonical),_e.bucketLayerIDs.push(Ti.map(Br=>Br.id)))}}let Ne,ze,yt,St;const lt=a.aH(ye.glyphDependencies,Rt=>Object.keys(Rt).map(Number));this.inFlightDependencies.forEach(Rt=>Rt==null?void 0:Rt.cancel()),this.inFlightDependencies=[];const xt=++this.dependencySentinel;Object.keys(lt).length?this.inFlightDependencies.push(oe.send("getGlyphs",{uid:this.uid,stacks:lt,source:this.source,tileID:this.tileID,type:"glyphs"},(Rt,Mt)=>{xt===this.dependencySentinel&&(Ne||(Ne=Rt,ze=Mt,qt.call(this)))})):ze={};const Et=Object.keys(ye.iconDependencies);Et.length?this.inFlightDependencies.push(oe.send("getImages",{icons:Et,source:this.source,tileID:this.tileID,type:"icons"},(Rt,Mt)=>{xt===this.dependencySentinel&&(Ne||(Ne=Rt,yt=Mt,qt.call(this)))})):yt={};const Ht=Object.keys(ye.patternDependencies);function qt(){if(Ne)return le(Ne);if(ze&&yt&&St){const Rt=new y(ze),Mt=new a.bp(yt,St);for(const ki in he){const Kt=he[ki];Kt instanceof a.a4?(S(Kt.layers,this.zoom,Y),a.bq({bucket:Kt,glyphMap:ze,glyphPositions:Rt.positions,imageMap:yt,imagePositions:Mt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Kt.hasPattern&&(Kt instanceof a.br||Kt instanceof a.bs||Kt instanceof a.bt)&&(S(Kt.layers,this.zoom,Y),Kt.addFeatures(ye,this.tileID.canonical,Mt.patternPositions))}this.status="done",le(null,{buckets:Object.values(he).filter(ki=>!ki.isEmpty()),featureIndex:_e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Rt.image,imageAtlas:Mt,glyphMap:this.returnDependencies?ze:null,iconMap:this.returnDependencies?yt:null,glyphPositions:this.returnDependencies?Rt.positions:null})}}Ht.length?this.inFlightDependencies.push(oe.send("getImages",{icons:Ht,source:this.source,tileID:this.tileID,type:"patterns"},(Rt,Mt)=>{xt===this.dependencySentinel&&(Ne||(Ne=Rt,St=Mt,qt.call(this)))})):St={},qt.call(this)}}function S(ne,z,V){const Y=new a.a8(z);for(const oe of ne)oe.recalculate(Y,V)}function P(ne,z){const V=a.l(ne.request,(Y,oe,le,be)=>{if(Y)z(Y);else if(oe)try{const _e=new a.bw.VectorTile(new a.bv(oe));z(null,{vectorTile:_e,rawData:oe,cacheControl:le,expires:be})}catch(_e){const he=new Uint8Array(oe);let ye=`Unable to parse the tile at ${ne.request.url}, `;ye+=he[0]===31&&he[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${_e.messge}`,z(new Error(ye))}});return()=>{V.cancel(),z()}}class M{constructor(z,V,Y,oe){this.actor=z,this.layerIndex=V,this.availableImages=Y,this.loadVectorData=oe||P,this.fetching={},this.loading={},this.loaded={}}loadTile(z,V){const Y=z.uid;this.loading||(this.loading={});const oe=!!(z&&z.request&&z.request.collectResourceTiming)&&new a.bu(z.request),le=this.loading[Y]=new T(z);le.abort=this.loadVectorData(z,(be,_e)=>{if(delete this.loading[Y],be||!_e)return le.status="done",this.loaded[Y]=le,V(be);const he=_e.rawData,ye={};_e.expires&&(ye.expires=_e.expires),_e.cacheControl&&(ye.cacheControl=_e.cacheControl);const De={};if(oe){const Ne=oe.finish();Ne&&(De.resourceTiming=JSON.parse(JSON.stringify(Ne)))}le.vectorTile=_e.vectorTile,le.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ne,ze)=>{if(delete this.fetching[Y],Ne||!ze)return V(Ne);V(null,a.e({rawTileData:he.slice(0)},ze,ye,De))}),this.loaded=this.loaded||{},this.loaded[Y]=le,this.fetching[Y]={rawTileData:he,cacheControl:ye,resourceTiming:De}})}reloadTile(z,V){const Y=this.loaded,oe=z.uid;if(Y&&Y[oe]){const le=Y[oe];le.showCollisionBoxes=z.showCollisionBoxes,le.status==="parsing"?le.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor,(be,_e)=>{if(be||!_e)return V(be,_e);let he;if(this.fetching[oe]){const{rawTileData:ye,cacheControl:De,resourceTiming:Ne}=this.fetching[oe];delete this.fetching[oe],he=a.e({rawTileData:ye.slice(0)},_e,De,Ne)}else he=_e;V(null,he)}):le.status==="done"&&(le.vectorTile?le.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor,V):V())}}abortTile(z,V){const Y=this.loading,oe=z.uid;Y&&Y[oe]&&Y[oe].abort&&(Y[oe].abort(),delete Y[oe]),V()}removeTile(z,V){const Y=this.loaded,oe=z.uid;Y&&Y[oe]&&delete Y[oe],V()}}class B{constructor(){this.loaded={}}loadTile(z,V){return a._(this,void 0,void 0,function*(){const{uid:Y,encoding:oe,rawImageData:le,redFactor:be,greenFactor:_e,blueFactor:he,baseShift:ye}=z,De=le.width+2,Ne=le.height+2,ze=a.a(le)?new a.R({width:De,height:Ne},yield a.bx(le,-1,-1,De,Ne)):le,yt=new a.by(Y,ze,oe,be,_e,he,ye);this.loaded=this.loaded||{},this.loaded[Y]=yt,V(null,yt)})}removeTile(z){const V=this.loaded,Y=z.uid;V&&V[Y]&&delete V[Y]}}function j(ne,z){if(ne.length!==0){Z(ne[0],z);for(var V=1;V<ne.length;V++)Z(ne[V],!z)}}function Z(ne,z){for(var V=0,Y=0,oe=0,le=ne.length,be=le-1;oe<le;be=oe++){var _e=(ne[oe][0]-ne[be][0])*(ne[be][1]+ne[oe][1]),he=V+_e;Y+=Math.abs(V)>=Math.abs(_e)?V-he+_e:_e-he+V,V=he}V+Y>=0!=!!z&&ne.reverse()}var G=a.bz(function ne(z,V){var Y,oe=z&&z.type;if(oe==="FeatureCollection")for(Y=0;Y<z.features.length;Y++)ne(z.features[Y],V);else if(oe==="GeometryCollection")for(Y=0;Y<z.geometries.length;Y++)ne(z.geometries[Y],V);else if(oe==="Feature")ne(z.geometry,V);else if(oe==="Polygon")j(z.coordinates,V);else if(oe==="MultiPolygon")for(Y=0;Y<z.coordinates.length;Y++)j(z.coordinates[Y],V);return z});const fe=a.bw.VectorTileFeature.prototype.toGeoJSON;var re={exports:{}},ue=a.bA,Me=a.bw.VectorTileFeature,Oe=$e;function $e(ne,z){this.options=z||{},this.features=ne,this.length=ne.length}function ke(ne,z){this.id=typeof ne.id=="number"?ne.id:void 0,this.type=ne.type,this.rawGeometry=ne.type===1?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=z||4096}$e.prototype.feature=function(ne){return new ke(this.features[ne],this.options.extent)},ke.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var z=0;z<ne.length;z++){for(var V=ne[z],Y=[],oe=0;oe<V.length;oe++)Y.push(new ue(V[oe][0],V[oe][1]));this.geometry.push(Y)}return this.geometry},ke.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,z=1/0,V=-1/0,Y=1/0,oe=-1/0,le=0;le<ne.length;le++)for(var be=ne[le],_e=0;_e<be.length;_e++){var he=be[_e];z=Math.min(z,he.x),V=Math.max(V,he.x),Y=Math.min(Y,he.y),oe=Math.max(oe,he.y)}return[z,Y,V,oe]},ke.prototype.toGeoJSON=Me.prototype.toGeoJSON;var je=a.bB,Ue=Oe;function ct(ne){var z=new je;return function(V,Y){for(var oe in V.layers)Y.writeMessage(3,tt,V.layers[oe])}(ne,z),z.finish()}function tt(ne,z){var V;z.writeVarintField(15,ne.version||1),z.writeStringField(1,ne.name||""),z.writeVarintField(5,ne.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<ne.length;V++)Y.feature=ne.feature(V),z.writeMessage(2,pt,Y);var oe=Y.keys;for(V=0;V<oe.length;V++)z.writeStringField(3,oe[V]);var le=Y.values;for(V=0;V<le.length;V++)z.writeMessage(4,us,le[V])}function pt(ne,z){var V=ne.feature;V.id!==void 0&&z.writeVarintField(1,V.id),z.writeMessage(2,ot,ne),z.writeVarintField(3,V.type),z.writeMessage(4,lr,V)}function ot(ne,z){var V=ne.feature,Y=ne.keys,oe=ne.values,le=ne.keycache,be=ne.valuecache;for(var _e in V.properties){var he=V.properties[_e],ye=le[_e];if(he!==null){ye===void 0&&(Y.push(_e),le[_e]=ye=Y.length-1),z.writeVarint(ye);var De=typeof he;De!=="string"&&De!=="boolean"&&De!=="number"&&(he=JSON.stringify(he));var Ne=De+":"+he,ze=be[Ne];ze===void 0&&(oe.push(he),be[Ne]=ze=oe.length-1),z.writeVarint(ze)}}}function ei(ne,z){return(z<<3)+(7&ne)}function rn(ne){return ne<<1^ne>>31}function lr(ne,z){for(var V=ne.loadGeometry(),Y=ne.type,oe=0,le=0,be=V.length,_e=0;_e<be;_e++){var he=V[_e],ye=1;Y===1&&(ye=he.length),z.writeVarint(ei(1,ye));for(var De=Y===3?he.length-1:he.length,Ne=0;Ne<De;Ne++){Ne===1&&Y!==1&&z.writeVarint(ei(2,De-1));var ze=he[Ne].x-oe,yt=he[Ne].y-le;z.writeVarint(rn(ze)),z.writeVarint(rn(yt)),oe+=ze,le+=yt}Y===3&&z.writeVarint(ei(7,1))}}function us(ne,z){var V=typeof ne;V==="string"?z.writeStringField(1,ne):V==="boolean"?z.writeBooleanField(7,ne):V==="number"&&(ne%1!=0?z.writeDoubleField(3,ne):ne<0?z.writeSVarintField(6,ne):z.writeVarintField(5,ne))}re.exports=ct,re.exports.fromVectorTileJs=ct,re.exports.fromGeojsonVt=function(ne,z){z=z||{};var V={};for(var Y in ne)V[Y]=new Ue(ne[Y].features,z),V[Y].name=Y,V[Y].version=z.version,V[Y].extent=z.extent;return ct({layers:V})},re.exports.GeoJSONWrapper=Ue;var ks=a.bz(re.exports);const Co={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},eo=Math.fround||(_r=new Float32Array(1),ne=>(_r[0]=+ne,_r[0]));var _r;const oi=3,sr=5,hs=6;class Os{constructor(z){this.options=Object.assign(Object.create(Co),z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(z){const{log:V,minZoom:Y,maxZoom:oe}=this.options;V&&console.time("total time");const le=`prepare ${z.length} points`;V&&console.time(le),this.points=z;const be=[];for(let he=0;he<z.length;he++){const ye=z[he];if(!ye.geometry)continue;const[De,Ne]=ye.geometry.coordinates,ze=eo(Yt(De)),yt=eo(ci(Ne));be.push(ze,yt,1/0,he,-1,1),this.options.reduce&&be.push(0)}let _e=this.trees[oe+1]=this._createTree(be);V&&console.timeEnd(le);for(let he=oe;he>=Y;he--){const ye=+Date.now();_e=this.trees[he]=this._createTree(this._cluster(_e,he)),V&&console.log("z%d: %d clusters in %dms",he,_e.numItems,+Date.now()-ye)}return V&&console.timeEnd("total time"),this}getClusters(z,V){let Y=((z[0]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,z[1]));let le=z[2]===180?180:((z[2]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)Y=-180,le=180;else if(Y>le){const Ne=this.getClusters([Y,oe,180,be],V),ze=this.getClusters([-180,oe,le,be],V);return Ne.concat(ze)}const _e=this.trees[this._limitZoom(V)],he=_e.range(Yt(Y),ci(be),Yt(le),ci(oe)),ye=_e.data,De=[];for(const Ne of he){const ze=this.stride*Ne;De.push(ye[ze+sr]>1?Mi(ye,ze,this.clusterProps):this.points[ye[ze+oi]])}return De}getChildren(z){const V=this._getOriginId(z),Y=this._getOriginZoom(z),oe="No cluster with the specified id.",le=this.trees[Y];if(!le)throw new Error(oe);const be=le.data;if(V*this.stride>=be.length)throw new Error(oe);const _e=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),he=le.within(be[V*this.stride],be[V*this.stride+1],_e),ye=[];for(const De of he){const Ne=De*this.stride;be[Ne+4]===z&&ye.push(be[Ne+sr]>1?Mi(be,Ne,this.clusterProps):this.points[be[Ne+oi]])}if(ye.length===0)throw new Error(oe);return ye}getLeaves(z,V,Y){const oe=[];return this._appendLeaves(oe,z,V=V||10,Y=Y||0,0),oe}getTile(z,V,Y){const oe=this.trees[this._limitZoom(z)],le=Math.pow(2,z),{extent:be,radius:_e}=this.options,he=_e/be,ye=(Y-he)/le,De=(Y+1+he)/le,Ne={features:[]};return this._addTileFeatures(oe.range((V-he)/le,ye,(V+1+he)/le,De),oe.data,V,Y,le,Ne),V===0&&this._addTileFeatures(oe.range(1-he/le,ye,1,De),oe.data,le,Y,le,Ne),V===le-1&&this._addTileFeatures(oe.range(0,ye,he/le,De),oe.data,-1,Y,le,Ne),Ne.features.length?Ne:null}getClusterExpansionZoom(z){let V=this._getOriginZoom(z)-1;for(;V<=this.options.maxZoom;){const Y=this.getChildren(z);if(V++,Y.length!==1)break;z=Y[0].properties.cluster_id}return V}_appendLeaves(z,V,Y,oe,le){const be=this.getChildren(V);for(const _e of be){const he=_e.properties;if(he&&he.cluster?le+he.point_count<=oe?le+=he.point_count:le=this._appendLeaves(z,he.cluster_id,Y,oe,le):le<oe?le++:z.push(_e),z.length===Y)break}return le}_createTree(z){const V=new a.av(z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Y=0;Y<z.length;Y+=this.stride)V.add(z[Y],z[Y+1]);return V.finish(),V.data=z,V}_addTileFeatures(z,V,Y,oe,le,be){for(const _e of z){const he=_e*this.stride,ye=V[he+sr]>1;let De,Ne,ze;if(ye)De=mr(V,he,this.clusterProps),Ne=V[he],ze=V[he+1];else{const lt=this.points[V[he+oi]];De=lt.properties;const[xt,Et]=lt.geometry.coordinates;Ne=Yt(xt),ze=ci(Et)}const yt={type:1,geometry:[[Math.round(this.options.extent*(Ne*le-Y)),Math.round(this.options.extent*(ze*le-oe))]],tags:De};let St;St=ye||this.options.generateId?V[he+oi]:this.points[V[he+oi]].id,St!==void 0&&(yt.id=St),be.features.push(yt)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,V){const{radius:Y,extent:oe,reduce:le,minPoints:be}=this.options,_e=Y/(oe*Math.pow(2,V)),he=z.data,ye=[],De=this.stride;for(let Ne=0;Ne<he.length;Ne+=De){if(he[Ne+2]<=V)continue;he[Ne+2]=V;const ze=he[Ne],yt=he[Ne+1],St=z.within(he[Ne],he[Ne+1],_e),lt=he[Ne+sr];let xt=lt;for(const Et of St){const Ht=Et*De;he[Ht+2]>V&&(xt+=he[Ht+sr])}if(xt>lt&&xt>=be){let Et,Ht=ze*lt,qt=yt*lt,Rt=-1;const Mt=((Ne/De|0)<<5)+(V+1)+this.points.length;for(const ki of St){const Kt=ki*De;if(he[Kt+2]<=V)continue;he[Kt+2]=V;const Ti=he[Kt+sr];Ht+=he[Kt]*Ti,qt+=he[Kt+1]*Ti,he[Kt+4]=Mt,le&&(Et||(Et=this._map(he,Ne,!0),Rt=this.clusterProps.length,this.clusterProps.push(Et)),le(Et,this._map(he,Kt)))}he[Ne+4]=Mt,ye.push(Ht/xt,qt/xt,1/0,Mt,-1,xt),le&&ye.push(Rt)}else{for(let Et=0;Et<De;Et++)ye.push(he[Ne+Et]);if(xt>1)for(const Et of St){const Ht=Et*De;if(!(he[Ht+2]<=V)){he[Ht+2]=V;for(let qt=0;qt<De;qt++)ye.push(he[Ht+qt])}}}}return ye}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,V,Y){if(z[V+sr]>1){const be=this.clusterProps[z[V+hs]];return Y?Object.assign({},be):be}const oe=this.points[z[V+oi]].properties,le=this.options.map(oe);return Y&&le===oe?Object.assign({},le):le}}function Mi(ne,z,V){return{type:"Feature",id:ne[z+oi],properties:mr(ne,z,V),geometry:{type:"Point",coordinates:[(Y=ne[z],360*(Y-.5)),Xn(ne[z+1])]}};var Y}function mr(ne,z,V){const Y=ne[z+sr],oe=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y,le=ne[z+hs],be=le===-1?{}:Object.assign({},V[le]);return Object.assign(be,{cluster:!0,cluster_id:ne[z+oi],point_count:Y,point_count_abbreviated:oe})}function Yt(ne){return ne/360+.5}function ci(ne){const z=Math.sin(ne*Math.PI/180),V=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return V<0?0:V>1?1:V}function Xn(ne){const z=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function Nr(ne,z,V,Y){for(var oe,le=Y,be=V-z>>1,_e=V-z,he=ne[z],ye=ne[z+1],De=ne[V],Ne=ne[V+1],ze=z+3;ze<V;ze+=3){var yt=Nn(ne[ze],ne[ze+1],he,ye,De,Ne);if(yt>le)oe=ze,le=yt;else if(yt===le){var St=Math.abs(ze-be);St<_e&&(oe=ze,_e=St)}}le>Y&&(oe-z>3&&Nr(ne,z,oe,Y),ne[oe+2]=le,V-oe>3&&Nr(ne,oe,V,Y))}function Nn(ne,z,V,Y,oe,le){var be=oe-V,_e=le-Y;if(be!==0||_e!==0){var he=((ne-V)*be+(z-Y)*_e)/(be*be+_e*_e);he>1?(V=oe,Y=le):he>0&&(V+=be*he,Y+=_e*he)}return(be=ne-V)*be+(_e=z-Y)*_e}function Er(ne,z,V,Y){var oe={id:ne===void 0?null:ne,type:z,geometry:V,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var be=le.geometry,_e=le.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")Tn(le,be);else if(_e==="Polygon"||_e==="MultiLineString")for(var he=0;he<be.length;he++)Tn(le,be[he]);else if(_e==="MultiPolygon")for(he=0;he<be.length;he++)for(var ye=0;ye<be[he].length;ye++)Tn(le,be[he][ye])}(oe),oe}function Tn(ne,z){for(var V=0;V<z.length;V+=3)ne.minX=Math.min(ne.minX,z[V]),ne.minY=Math.min(ne.minY,z[V+1]),ne.maxX=Math.max(ne.maxX,z[V]),ne.maxY=Math.max(ne.maxY,z[V+1])}function or(ne,z,V,Y){if(z.geometry){var oe=z.geometry.coordinates,le=z.geometry.type,be=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),_e=[],he=z.id;if(V.promoteId?he=z.properties[V.promoteId]:V.generateId&&(he=Y||0),le==="Point")yr(oe,_e);else if(le==="MultiPoint")for(var ye=0;ye<oe.length;ye++)yr(oe[ye],_e);else if(le==="LineString")Ln(oe,_e,be,!1);else if(le==="MultiLineString"){if(V.lineMetrics){for(ye=0;ye<oe.length;ye++)Ln(oe[ye],_e=[],be,!1),ne.push(Er(he,"LineString",_e,z.properties));return}Zn(oe,_e,be,!1)}else if(le==="Polygon")Zn(oe,_e,be,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(ye=0;ye<z.geometry.geometries.length;ye++)or(ne,{id:he,geometry:z.geometry.geometries[ye],properties:z.properties},V,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ye=0;ye<oe.length;ye++){var De=[];Zn(oe[ye],De,be,!0),_e.push(De)}}ne.push(Er(he,le,_e,z.properties))}}function yr(ne,z){z.push(Fe(ne[0])),z.push(ui(ne[1])),z.push(0)}function Ln(ne,z,V,Y){for(var oe,le,be=0,_e=0;_e<ne.length;_e++){var he=Fe(ne[_e][0]),ye=ui(ne[_e][1]);z.push(he),z.push(ye),z.push(0),_e>0&&(be+=Y?(oe*ye-he*le)/2:Math.sqrt(Math.pow(he-oe,2)+Math.pow(ye-le,2))),oe=he,le=ye}var De=z.length-3;z[2]=1,Nr(z,0,De,V),z[De+2]=1,z.size=Math.abs(be),z.start=0,z.end=z.size}function Zn(ne,z,V,Y){for(var oe=0;oe<ne.length;oe++){var le=[];Ln(ne[oe],le,V,Y),z.push(le)}}function Fe(ne){return ne/360+.5}function ui(ne){var z=Math.sin(ne*Math.PI/180),V=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return V<0?0:V>1?1:V}function Lr(ne,z,V,Y,oe,le,be,_e){if(Y/=z,le>=(V/=z)&&be<Y)return ne;if(be<V||le>=Y)return null;for(var he=[],ye=0;ye<ne.length;ye++){var De=ne[ye],Ne=De.geometry,ze=De.type,yt=oe===0?De.minX:De.minY,St=oe===0?De.maxX:De.maxY;if(yt>=V&&St<Y)he.push(De);else if(!(St<V||yt>=Y)){var lt=[];if(ze==="Point"||ze==="MultiPoint")ti(Ne,lt,V,Y,oe);else if(ze==="LineString")jt(Ne,lt,V,Y,oe,!1,_e.lineMetrics);else if(ze==="MultiLineString")Fs(Ne,lt,V,Y,oe,!1);else if(ze==="Polygon")Fs(Ne,lt,V,Y,oe,!0);else if(ze==="MultiPolygon")for(var xt=0;xt<Ne.length;xt++){var Et=[];Fs(Ne[xt],Et,V,Y,oe,!0),Et.length&&lt.push(Et)}if(lt.length){if(_e.lineMetrics&&ze==="LineString"){for(xt=0;xt<lt.length;xt++)he.push(Er(De.id,ze,lt[xt],De.tags));continue}ze!=="LineString"&&ze!=="MultiLineString"||(lt.length===1?(ze="LineString",lt=lt[0]):ze="MultiLineString"),ze!=="Point"&&ze!=="MultiPoint"||(ze=lt.length===3?"Point":"MultiPoint"),he.push(Er(De.id,ze,lt,De.tags))}}}return he.length?he:null}function ti(ne,z,V,Y,oe){for(var le=0;le<ne.length;le+=3){var be=ne[le+oe];be>=V&&be<=Y&&(z.push(ne[le]),z.push(ne[le+1]),z.push(ne[le+2]))}}function jt(ne,z,V,Y,oe,le,be){for(var _e,he,ye=Sn(ne),De=oe===0?to:ds,Ne=ne.start,ze=0;ze<ne.length-3;ze+=3){var yt=ne[ze],St=ne[ze+1],lt=ne[ze+2],xt=ne[ze+3],Et=ne[ze+4],Ht=oe===0?yt:St,qt=oe===0?xt:Et,Rt=!1;be&&(_e=Math.sqrt(Math.pow(yt-xt,2)+Math.pow(St-Et,2))),Ht<V?qt>V&&(he=De(ye,yt,St,xt,Et,V),be&&(ye.start=Ne+_e*he)):Ht>Y?qt<Y&&(he=De(ye,yt,St,xt,Et,Y),be&&(ye.start=Ne+_e*he)):En(ye,yt,St,lt),qt<V&&Ht>=V&&(he=De(ye,yt,St,xt,Et,V),Rt=!0),qt>Y&&Ht<=Y&&(he=De(ye,yt,St,xt,Et,Y),Rt=!0),!le&&Rt&&(be&&(ye.end=Ne+_e*he),z.push(ye),ye=Sn(ne)),be&&(Ne+=_e)}var Mt=ne.length-3;yt=ne[Mt],St=ne[Mt+1],lt=ne[Mt+2],(Ht=oe===0?yt:St)>=V&&Ht<=Y&&En(ye,yt,St,lt),Mt=ye.length-3,le&&Mt>=3&&(ye[Mt]!==ye[0]||ye[Mt+1]!==ye[1])&&En(ye,ye[0],ye[1],ye[2]),ye.length&&z.push(ye)}function Sn(ne){var z=[];return z.size=ne.size,z.start=ne.start,z.end=ne.end,z}function Fs(ne,z,V,Y,oe,le){for(var be=0;be<ne.length;be++)jt(ne[be],z,V,Y,oe,le,!1)}function En(ne,z,V,Y){ne.push(z),ne.push(V),ne.push(Y)}function to(ne,z,V,Y,oe,le){var be=(le-z)/(Y-z);return ne.push(le),ne.push(V+(oe-V)*be),ne.push(1),be}function ds(ne,z,V,Y,oe,le){var be=(le-V)/(oe-V);return ne.push(z+(Y-z)*be),ne.push(le),ne.push(1),be}function Bn(ne,z){for(var V=[],Y=0;Y<ne.length;Y++){var oe,le=ne[Y],be=le.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")oe=An(le.geometry,z);else if(be==="MultiLineString"||be==="Polygon"){oe=[];for(var _e=0;_e<le.geometry.length;_e++)oe.push(An(le.geometry[_e],z))}else if(be==="MultiPolygon")for(oe=[],_e=0;_e<le.geometry.length;_e++){for(var he=[],ye=0;ye<le.geometry[_e].length;ye++)he.push(An(le.geometry[_e][ye],z));oe.push(he)}V.push(Er(le.id,be,oe,le.tags))}return V}function An(ne,z){var V=[];V.size=ne.size,ne.start!==void 0&&(V.start=ne.start,V.end=ne.end);for(var Y=0;Y<ne.length;Y+=3)V.push(ne[Y]+z,ne[Y+1],ne[Y+2]);return V}function Ze(ne,z){if(ne.transformed)return ne;var V,Y,oe,le=1<<ne.z,be=ne.x,_e=ne.y;for(V=0;V<ne.features.length;V++){var he=ne.features[V],ye=he.geometry,De=he.type;if(he.geometry=[],De===1)for(Y=0;Y<ye.length;Y+=2)he.geometry.push(Pn(ye[Y],ye[Y+1],z,le,be,_e));else for(Y=0;Y<ye.length;Y++){var Ne=[];for(oe=0;oe<ye[Y].length;oe+=2)Ne.push(Pn(ye[Y][oe],ye[Y][oe+1],z,le,be,_e));he.geometry.push(Ne)}}return ne.transformed=!0,ne}function Pn(ne,z,V,Y,oe,le){return[Math.round(V*(ne*Y-oe)),Math.round(V*(z*Y-le))]}function xi(ne,z,V,Y,oe){for(var le=z===oe.maxZoom?0:oe.tolerance/((1<<z)*oe.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:Y,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_e=0;_e<ne.length;_e++){be.numFeatures++,fs(be,ne[_e],le,oe);var he=ne[_e].minX,ye=ne[_e].minY,De=ne[_e].maxX,Ne=ne[_e].maxY;he<be.minX&&(be.minX=he),ye<be.minY&&(be.minY=ye),De>be.maxX&&(be.maxX=De),Ne>be.maxY&&(be.maxY=Ne)}return be}function fs(ne,z,V,Y){var oe=z.geometry,le=z.type,be=[];if(le==="Point"||le==="MultiPoint")for(var _e=0;_e<oe.length;_e+=3)be.push(oe[_e]),be.push(oe[_e+1]),ne.numPoints++,ne.numSimplified++;else if(le==="LineString")zn(be,oe,ne,V,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(_e=0;_e<oe.length;_e++)zn(be,oe[_e],ne,V,le==="Polygon",_e===0);else if(le==="MultiPolygon")for(var he=0;he<oe.length;he++){var ye=oe[he];for(_e=0;_e<ye.length;_e++)zn(be,ye[_e],ne,V,!0,_e===0)}if(be.length){var De=z.tags||null;if(le==="LineString"&&Y.lineMetrics){for(var Ne in De={},z.tags)De[Ne]=z.tags[Ne];De.mapbox_clip_start=oe.start/oe.size,De.mapbox_clip_end=oe.end/oe.size}var ze={geometry:be,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:De};z.id!==null&&(ze.id=z.id),ne.features.push(ze)}}function zn(ne,z,V,Y,oe,le){var be=Y*Y;if(Y>0&&z.size<(oe?be:Y))V.numPoints+=z.length/3;else{for(var _e=[],he=0;he<z.length;he+=3)(Y===0||z[he+2]>be)&&(V.numSimplified++,_e.push(z[he]),_e.push(z[he+1])),V.numPoints++;oe&&function(ye,De){for(var Ne=0,ze=0,yt=ye.length,St=yt-2;ze<yt;St=ze,ze+=2)Ne+=(ye[ze]-ye[St])*(ye[ze+1]+ye[St+1]);if(Ne>0===De)for(ze=0,yt=ye.length;ze<yt/2;ze+=2){var lt=ye[ze],xt=ye[ze+1];ye[ze]=ye[yt-2-ze],ye[ze+1]=ye[yt-1-ze],ye[yt-2-ze]=lt,ye[yt-1-ze]=xt}}(_e,le),ne.push(_e)}}function Ke(ne,z){var V=(z=this.options=function(oe,le){for(var be in le)oe[be]=le[be];return oe}(Object.create(this.options),z)).debug;if(V&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(oe,le){var be=[];if(oe.type==="FeatureCollection")for(var _e=0;_e<oe.features.length;_e++)or(be,oe.features[_e],le,_e);else or(be,oe.type==="Feature"?oe:{geometry:oe},le);return be}(ne,z);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(oe,le){var be=le.buffer/le.extent,_e=oe,he=Lr(oe,1,-1-be,be,0,-1,2,le),ye=Lr(oe,1,1-be,2+be,0,-1,2,le);return(he||ye)&&(_e=Lr(oe,1,-be,1+be,0,-1,2,le)||[],he&&(_e=Bn(he,1).concat(_e)),ye&&(_e=_e.concat(Bn(ye,-1)))),_e}(Y,z),Y.length&&this.splitTile(Y,0,0,0),V&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Pt(ne,z,V){return 32*((1<<ne)*V+z)+ne}function At(ne,z){return z?ne.properties[z]:ne.id}function cr(ne,z){if(ne==null)return!0;if(ne.type==="Feature")return At(ne,z)!=null;if(ne.type==="FeatureCollection"){const V=new Set;for(const Y of ne.features){const oe=At(Y,z);if(oe==null||V.has(oe))return!1;V.add(oe)}return!0}return!1}function nn(ne,z){const V=new Map;if(ne!=null)if(ne.type==="Feature")V.set(At(ne,z),ne);else for(const Y of ne.features)V.set(At(Y,z),Y);return V}Ke.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ke.prototype.splitTile=function(ne,z,V,Y,oe,le,be){for(var _e=[ne,z,V,Y],he=this.options,ye=he.debug;_e.length;){Y=_e.pop(),V=_e.pop(),z=_e.pop(),ne=_e.pop();var De=1<<z,Ne=Pt(z,V,Y),ze=this.tiles[Ne];if(!ze&&(ye>1&&console.time("creation"),ze=this.tiles[Ne]=xi(ne,z,V,Y,he),this.tileCoords.push({z,x:V,y:Y}),ye)){ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,V,Y,ze.numFeatures,ze.numPoints,ze.numSimplified),console.timeEnd("creation"));var yt="z"+z;this.stats[yt]=(this.stats[yt]||0)+1,this.total++}if(ze.source=ne,oe){if(z===he.maxZoom||z===oe)continue;var St=1<<oe-z;if(V!==Math.floor(le/St)||Y!==Math.floor(be/St))continue}else if(z===he.indexMaxZoom||ze.numPoints<=he.indexMaxPoints)continue;if(ze.source=null,ne.length!==0){ye>1&&console.time("clipping");var lt,xt,Et,Ht,qt,Rt,Mt=.5*he.buffer/he.extent,ki=.5-Mt,Kt=.5+Mt,Ti=1+Mt;lt=xt=Et=Ht=null,qt=Lr(ne,De,V-Mt,V+Kt,0,ze.minX,ze.maxX,he),Rt=Lr(ne,De,V+ki,V+Ti,0,ze.minX,ze.maxX,he),ne=null,qt&&(lt=Lr(qt,De,Y-Mt,Y+Kt,1,ze.minY,ze.maxY,he),xt=Lr(qt,De,Y+ki,Y+Ti,1,ze.minY,ze.maxY,he),qt=null),Rt&&(Et=Lr(Rt,De,Y-Mt,Y+Kt,1,ze.minY,ze.maxY,he),Ht=Lr(Rt,De,Y+ki,Y+Ti,1,ze.minY,ze.maxY,he),Rt=null),ye>1&&console.timeEnd("clipping"),_e.push(lt||[],z+1,2*V,2*Y),_e.push(xt||[],z+1,2*V,2*Y+1),_e.push(Et||[],z+1,2*V+1,2*Y),_e.push(Ht||[],z+1,2*V+1,2*Y+1)}}},Ke.prototype.getTile=function(ne,z,V){var Y=this.options,oe=Y.extent,le=Y.debug;if(ne<0||ne>24)return null;var be=1<<ne,_e=Pt(ne,z=(z%be+be)%be,V);if(this.tiles[_e])return Ze(this.tiles[_e],oe);le>1&&console.log("drilling down to z%d-%d-%d",ne,z,V);for(var he,ye=ne,De=z,Ne=V;!he&&ye>0;)ye--,De=Math.floor(De/2),Ne=Math.floor(Ne/2),he=this.tiles[Pt(ye,De,Ne)];return he&&he.source?(le>1&&console.log("found parent tile z%d-%d-%d",ye,De,Ne),le>1&&console.time("drilling down"),this.splitTile(he.source,ye,De,Ne,ne,z,V),le>1&&console.timeEnd("drilling down"),this.tiles[_e]?Ze(this.tiles[_e],oe):null):null};class It extends M{constructor(z,V,Y,oe){super(z,V,Y),this._dataUpdateable=new Map,this.loadGeoJSON=(le,be)=>{const{promoteId:_e}=le;if(le.request)return a.f(le.request,(he,ye,De,Ne)=>{this._dataUpdateable=cr(ye,_e)?nn(ye,_e):void 0,be(he,ye,De,Ne)});if(typeof le.data=="string")try{const he=JSON.parse(le.data);this._dataUpdateable=cr(he,_e)?nn(he,_e):void 0,be(null,he)}catch{be(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`))}else le.dataDiff?this._dataUpdateable?(function(he,ye,De){var Ne,ze,yt,St;if(ye.removeAll&&he.clear(),ye.remove)for(const lt of ye.remove)he.delete(lt);if(ye.add)for(const lt of ye.add){const xt=At(lt,De);xt!=null&&he.set(xt,lt)}if(ye.update)for(const lt of ye.update){let xt=he.get(lt.id);if(xt==null)continue;const Et=!lt.removeAllProperties&&(((Ne=lt.removeProperties)===null||Ne===void 0?void 0:Ne.length)>0||((ze=lt.addOrUpdateProperties)===null||ze===void 0?void 0:ze.length)>0);if((lt.newGeometry||lt.removeAllProperties||Et)&&(xt=Object.assign({},xt),he.set(lt.id,xt),Et&&(xt.properties=Object.assign({},xt.properties))),lt.newGeometry&&(xt.geometry=lt.newGeometry),lt.removeAllProperties)xt.properties={};else if(((yt=lt.removeProperties)===null||yt===void 0?void 0:yt.length)>0)for(const Ht of lt.removeProperties)Object.prototype.hasOwnProperty.call(xt.properties,Ht)&&delete xt.properties[Ht];if(((St=lt.addOrUpdateProperties)===null||St===void 0?void 0:St.length)>0)for(const{key:Ht,value:qt}of lt.addOrUpdateProperties)xt.properties[Ht]=qt}}(this._dataUpdateable,le.dataDiff,_e),be(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):be(new Error(`Cannot update existing geojson data in ${le.source}`)):be(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,oe&&(this.loadGeoJSON=oe)}loadGeoJSONTile(z,V){const Y=z.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const oe=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!oe)return V(null,null);const le=new class{constructor(_e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.N,this.length=_e.length,this._features=_e}feature(_e){return new class{constructor(he){this._feature=he,this.extent=a.N,this.type=he.type,this.properties=he.tags,"id"in he&&!isNaN(he.id)&&(this.id=parseInt(he.id,10))}loadGeometry(){if(this._feature.type===1){const he=[];for(const ye of this._feature.geometry)he.push([new a.P(ye[0],ye[1])]);return he}{const he=[];for(const ye of this._feature.geometry){const De=[];for(const Ne of ye)De.push(new a.P(Ne[0],Ne[1]));he.push(De)}return he}}toGeoJSON(he,ye,De){return fe.call(this,he,ye,De)}}(this._features[_e])}}(oe.features);let be=ks(le);be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),V(null,{vectorTile:le,rawData:be.buffer})}loadData(z,V){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const oe=!!(z&&z.request&&z.request.collectResourceTiming)&&new a.bu(z.request);this._pendingCallback=V,this._pendingRequest=this.loadGeoJSON(z,(le,be)=>{if(delete this._pendingCallback,delete this._pendingRequest,le||!be)return V(le);if(typeof be!="object")return V(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{G(be,!0);try{if(z.filter){const he=a.bC(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(he.result==="error")throw new Error(he.value.map(De=>`${De.key}: ${De.message}`).join(", "));be={type:"FeatureCollection",features:be.features.filter(De=>he.value.evaluate({zoom:0},De))}}this._geoJSONIndex=z.cluster?new Os(function({superclusterOptions:he,clusterProperties:ye}){if(!ye||!he)return he;const De={},Ne={},ze={accumulated:null,zoom:0},yt={properties:null},St=Object.keys(ye);for(const lt of St){const[xt,Et]=ye[lt],Ht=a.bC(Et),qt=a.bC(typeof xt=="string"?[xt,["accumulated"],["get",lt]]:xt);De[lt]=Ht.value,Ne[lt]=qt.value}return he.map=lt=>{yt.properties=lt;const xt={};for(const Et of St)xt[Et]=De[Et].evaluate(ze,yt);return xt},he.reduce=(lt,xt)=>{yt.properties=xt;for(const Et of St)ze.accumulated=lt[Et],lt[Et]=Ne[Et].evaluate(ze,yt)},he}(z)).load(be.features):function(he,ye){return new Ke(he,ye)}(be,z.geojsonVtOptions)}catch(he){return V(he)}this.loaded={};const _e={};if(oe){const he=oe.finish();he&&(_e.resourceTiming={},_e.resourceTiming[z.source]=JSON.parse(JSON.stringify(he)))}V(null,_e)}})}reloadTile(z,V){const Y=this.loaded;return Y&&Y[z.uid]?super.reloadTile(z,V):this.loadTile(z,V)}removeSource(z,V){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),V()}getClusterExpansionZoom(z,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(Y){V(Y)}}getClusterChildren(z,V){try{V(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(Y){V(Y)}}getClusterLeaves(z,V){try{V(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(Y){V(Y)}}}class sn{constructor(z){this.self=z,this.actor=new a.C(z,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:M,geojson:It},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,Y)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=Y},this.self.registerRTLTextPlugin=V=>{if(a.bD.isParsed())throw new Error("RTL text plugin already registered.");a.bD.applyArabicShaping=V.applyArabicShaping,a.bD.processBidirectionalText=V.processBidirectionalText,a.bD.processStyledBidirectionalText=V.processStyledBidirectionalText}}setReferrer(z,V){this.referrer=V}setImages(z,V,Y){this.availableImages[z]=V;for(const oe in this.workerSources[z]){const le=this.workerSources[z][oe];for(const be in le)le[be].availableImages=V}Y()}setLayers(z,V,Y){this.getLayerIndex(z).replace(V),Y()}updateLayers(z,V,Y){this.getLayerIndex(z).update(V.layers,V.removedIds),Y()}loadTile(z,V,Y){this.getWorkerSource(z,V.type,V.source).loadTile(V,Y)}loadDEMTile(z,V,Y){this.getDEMWorkerSource(z,V.source).loadTile(V,Y)}reloadTile(z,V,Y){this.getWorkerSource(z,V.type,V.source).reloadTile(V,Y)}abortTile(z,V,Y){this.getWorkerSource(z,V.type,V.source).abortTile(V,Y)}removeTile(z,V,Y){this.getWorkerSource(z,V.type,V.source).removeTile(V,Y)}removeDEMTile(z,V){this.getDEMWorkerSource(z,V.source).removeTile(V)}removeSource(z,V,Y){if(!this.workerSources[z]||!this.workerSources[z][V.type]||!this.workerSources[z][V.type][V.source])return;const oe=this.workerSources[z][V.type][V.source];delete this.workerSources[z][V.type][V.source],oe.removeSource!==void 0?oe.removeSource(V,Y):Y()}loadWorkerSource(z,V,Y){try{this.self.importScripts(V.url),Y()}catch(oe){Y(oe.toString())}}syncRTLPluginState(z,V,Y){try{a.bD.setState(V);const oe=a.bD.getPluginURL();if(a.bD.isLoaded()&&!a.bD.isParsed()&&oe!=null){this.self.importScripts(oe);const le=a.bD.isParsed();Y(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${oe}`),le)}}catch(oe){Y(oe.toString())}}getAvailableImages(z){let V=this.availableImages[z];return V||(V=[]),V}getLayerIndex(z){let V=this.layerIndexes[z];return V||(V=this.layerIndexes[z]=new g),V}getWorkerSource(z,V,Y){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][V]||(this.workerSources[z][V]={}),this.workerSources[z][V][Y]||(this.workerSources[z][V][Y]=new this.workerSourceTypes[V]({send:(oe,le,be)=>{this.actor.send(oe,le,be,z)}},this.getLayerIndex(z),this.getAvailableImages(z))),this.workerSources[z][V][Y]}getDEMWorkerSource(z,V){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][V]||(this.demWorkerSources[z][V]=new B),this.demWorkerSources[z][V]}}return a.i()&&(self.worker=new sn(self)),sn}),l(["./shared"],function(a){var g="3.6.2";class y{static testProp(o){if(!y.docStyle)return o[0];for(let d=0;d<o.length;d++)if(o[d]in y.docStyle)return o[d];return o[0]}static create(o,d,p){const m=window.document.createElement(o);return d!==void 0&&(m.className=d),p&&p.appendChild(m),m}static createNS(o,d){return window.document.createElementNS(o,d)}static disableDrag(){y.docStyle&&y.selectProp&&(y.userSelect=y.docStyle[y.selectProp],y.docStyle[y.selectProp]="none")}static enableDrag(){y.docStyle&&y.selectProp&&(y.docStyle[y.selectProp]=y.userSelect)}static setTransform(o,d){o.style[y.transformProp]=d}static addEventListener(o,d,p,m={}){o.addEventListener(d,p,"passive"in m?m:m.capture)}static removeEventListener(o,d,p,m={}){o.removeEventListener(d,p,"passive"in m?m:m.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",y.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",y.suppressClickInternal,!0)},0)}static mousePos(o,d){const p=o.getBoundingClientRect();return new a.P(d.clientX-p.left-o.clientLeft,d.clientY-p.top-o.clientTop)}static touchPos(o,d){const p=o.getBoundingClientRect(),m=[];for(let b=0;b<d.length;b++)m.push(new a.P(d[b].clientX-p.left-o.clientLeft,d[b].clientY-p.top-o.clientTop));return m}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,y.selectProp=y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),y.transformProp=y.testProp(["transform","WebkitTransform"]);const T={supported:!1,testSupport:function(x){!M&&P&&(B?j(x):S=x)}};let S,P,M=!1,B=!1;function j(x){const o=x.createTexture();x.bindTexture(x.TEXTURE_2D,o);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,P),x.isContextLost())return;T.supported=!0}catch{}x.deleteTexture(o),M=!0}var Z,G;typeof document<"u"&&(P=document.createElement("img"),P.onload=function(){S&&j(S),S=null,B=!0},P.onerror=function(){M=!0,S=null},P.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(x){let o,d,p,m;x.resetRequestQueue=()=>{o=[],d=0,p=0,m={}},x.addThrottleControl=O=>{const D=p++;return m[D]=O,D},x.removeThrottleControl=O=>{delete m[O],I()},x.getImage=(O,D,N=!0)=>{T.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*");const $={requestParameters:O,supportImageRefresh:N,callback:D,cancelled:!1,completed:!1,cancel:()=>{$.completed||$.cancelled||($.cancelled=!0,$.innerRequest&&($.innerRequest.cancel(),d--),I())}};return o.push($),I(),$};const b=O=>{const{requestParameters:D,supportImageRefresh:N,callback:$}=O;return a.e(D,{type:"image"}),(N!==!1||a.i()||a.g(D.url)||D.headers&&!Object.keys(D.headers).reduce((te,ee)=>te&&ee==="accept",!0)?a.m:R)(D,(te,ee,se,J)=>{A(O,$,te,ee,se,J)})},A=(O,D,N,$,te,ee)=>{N?D(N):$ instanceof HTMLImageElement||a.a($)?D(null,$):$&&((se,J)=>{typeof createImageBitmap=="function"?a.b(se,J):a.d(se,J)})($,(se,J)=>{se!=null?D(se):J!=null&&D(null,J,{cacheControl:te,expires:ee})}),O.cancelled||(O.completed=!0,d--,I())},I=()=>{const O=(()=>{const D=Object.keys(m);let N=!1;if(D.length>0){for(const $ of D)if(N=m[$](),N)break}return N})()?a.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=d;D<O&&o.length>0;D++){const N=o.shift();if(N.cancelled){D--;continue}const $=b(N);d++,N.innerRequest=$}},R=(O,D)=>{const N=new Image,$=O.url;let te=!1;const ee=O.credentials;return ee&&ee==="include"?N.crossOrigin="use-credentials":(ee&&ee==="same-origin"||!a.s($))&&(N.crossOrigin="anonymous"),N.fetchPriority="high",N.onload=()=>{D(null,N),N.onerror=N.onload=null},N.onerror=()=>{te||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),N.onerror=N.onload=null},N.src=$,{cancel:()=>{te=!0,N.src=""}}}}(Z||(Z={})),Z.resetRequestQueue(),function(x){x.Glyphs="Glyphs",x.Image="Image",x.Source="Source",x.SpriteImage="SpriteImage",x.SpriteJSON="SpriteJSON",x.Style="Style",x.Tile="Tile",x.Unknown="Unknown"}(G||(G={}));class fe{constructor(o){this._transformRequestFn=o}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}normalizeSpriteURL(o,d,p){const m=function(b){const A=b.match(re);if(!A)throw new Error(`Unable to parse URL "${b}"`);return{protocol:A[1],authority:A[2],path:A[3]||"/",params:A[4]?A[4].split("&"):[]}}(o);return m.path+=`${d}${p}`,function(b){const A=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${A}`}(m)}setTransformRequest(o){this._transformRequestFn=o}}const re=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ue(x){var o=new a.A(3);return o[0]=x[0],o[1]=x[1],o[2]=x[2],o}var Me,Oe=function(x,o,d){return x[0]=o[0]-d[0],x[1]=o[1]-d[1],x[2]=o[2]-d[2],x};Me=new a.A(3),a.A!=Float32Array&&(Me[0]=0,Me[1]=0,Me[2]=0);var $e=function(x){var o=x[0],d=x[1];return o*o+d*d};function ke(x){const o=[];if(typeof x=="string")o.push({id:"default",url:x});else if(x&&x.length>0){const d=[];for(const{id:p,url:m}of x){const b=`${p}${m}`;d.indexOf(b)===-1&&(d.push(b),o.push({id:p,url:m}))}}return o}function je(x,o,d,p,m){if(p)return void x(p);if(m!==Object.values(o).length||m!==Object.values(d).length)return;const b={};for(const A in o){b[A]={};const I=a.h.getImageCanvasContext(d[A]),R=o[A];for(const O in R){const{width:D,height:N,x:$,y:te,sdf:ee,pixelRatio:se,stretchX:J,stretchY:me,content:Ee}=R[O];b[A][O]={data:null,pixelRatio:se,sdf:ee,stretchX:J,stretchY:me,content:Ee,spriteData:{width:D,height:N,x:$,y:te,context:I}}}}x(null,b)}(function(){var x=new a.A(2);a.A!=Float32Array&&(x[0]=0,x[1]=0)})();class Ue{constructor(o,d,p,m){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(d,m)}update(o,d,p){const{width:m,height:b}=o,A=!(this.size&&this.size[0]===m&&this.size[1]===b||p),{context:I}=this,{gl:R}=I;if(this.useMipmap=!!(d&&d.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!d||d.premultiply!==!1)),A)this.size=[m,b],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.a(o)?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,o):R.texImage2D(R.TEXTURE_2D,0,this.format,m,b,0,this.format,R.UNSIGNED_BYTE,o.data);else{const{x:O,y:D}=p||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.a(o)?R.texSubImage2D(R.TEXTURE_2D,0,O,D,R.RGBA,R.UNSIGNED_BYTE,o):R.texSubImage2D(R.TEXTURE_2D,0,O,D,m,b,R.RGBA,R.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D)}bind(o,d,p){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),o!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,o),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||o),this.filter=o),d!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,d),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function ct(x){const{userImage:o}=x;return!!(o&&o.render&&o.render())&&(x.data.replace(new Uint8Array(o.data.buffer)),!0)}class tt extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:d,callback:p}of this.requestors)this._notify(d,p);this.requestors=[]}}getImage(o){const d=this.images[o];if(d&&!d.data&&d.spriteData){const p=d.spriteData;d.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),d.spriteData=null}return d}addImage(o,d){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,d)&&(this.images[o]=d)}_validate(o,d){let p=!0;const m=d.data||d.spriteData;return this._validateStretch(d.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(d.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(d.content,d)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,d){if(!o)return!0;let p=0;for(const m of o){if(m[0]<p||m[1]<m[0]||d<m[1])return!1;p=m[1]}return!0}_validateContent(o,d){if(!o)return!0;if(o.length!==4)return!1;const p=d.spriteData,m=p&&p.width||d.data.width,b=p&&p.height||d.data.height;return!(o[0]<0||m<o[0]||o[1]<0||b<o[1]||o[2]<0||m<o[2]||o[3]<0||b<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,d,p=!0){const m=this.getImage(o);if(p&&(m.data.width!==d.data.width||m.data.height!==d.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=m.version+1,this.images[o]=d,this.updatedImages[o]=!0}removeImage(o){const d=this.images[o];delete this.images[o],delete this.patterns[o],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,d){let p=!0;if(!this.isLoaded())for(const m of o)this.images[m]||(p=!1);this.isLoaded()||p?this._notify(o,d):this.requestors.push({ids:o,callback:d})}_notify(o,d){const p={};for(const m of o){let b=this.getImage(m);b||(this.fire(new a.k("styleimagemissing",{id:m})),b=this.getImage(m)),b?p[m]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:a.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,p)}getPixelSize(){const{width:o,height:d}=this.atlasImage;return{width:o,height:d}}getPattern(o){const d=this.patterns[o],p=this.getImage(o);if(!p)return null;if(d&&d.position.version===p.version)return d.position;if(d)d.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new a.I(m,p);this.patterns[o]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const d=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ue(o,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:d,h:p}=a.p(o),m=this.atlasImage;m.resize({width:d||1,height:p||1});for(const b in this.patterns){const{bin:A}=this.patterns[b],I=A.x+1,R=A.y+1,O=this.getImage(b).data,D=O.width,N=O.height;a.R.copy(O,m,{x:0,y:0},{x:I,y:R},{width:D,height:N}),a.R.copy(O,m,{x:0,y:N-1},{x:I,y:R-1},{width:D,height:1}),a.R.copy(O,m,{x:0,y:0},{x:I,y:R+N},{width:D,height:1}),a.R.copy(O,m,{x:D-1,y:0},{x:I-1,y:R},{width:1,height:N}),a.R.copy(O,m,{x:0,y:0},{x:I+D,y:R},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const d of o){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const p=this.getImage(d);p||a.w(`Image with ID: "${d}" was not found`),ct(p)&&this.updateImage(d,p)}}}const pt=1e20;function ot(x,o,d,p,m,b,A,I,R){for(let O=o;O<o+p;O++)ei(x,d*b+O,b,m,A,I,R);for(let O=d;O<d+m;O++)ei(x,O*b+o,1,p,A,I,R)}function ei(x,o,d,p,m,b,A){b[0]=0,A[0]=-pt,A[1]=pt,m[0]=x[o];for(let I=1,R=0,O=0;I<p;I++){m[I]=x[o+I*d];const D=I*I;do{const N=b[R];O=(m[I]-m[N]+D-N*N)/(I-N)/2}while(O<=A[R]&&--R>-1);R++,b[R]=I,A[R]=O,A[R+1]=pt}for(let I=0,R=0;I<p;I++){for(;A[R+1]<I;)R++;const O=b[R],D=I-O;x[o+I*d]=m[O]+D*D}}class rn{constructor(o,d){this.requestManager=o,this.localIdeographFontFamily=d,this.entries={}}setURL(o){this.url=o}getGlyphs(o,d){const p=[];for(const m in o)for(const b of o[m])p.push({stack:m,id:b});a.o(p,({stack:m,id:b},A)=>{let I=this.entries[m];I||(I=this.entries[m]={glyphs:{},requests:{},ranges:{}});let R=I.glyphs[b];if(R!==void 0)return void A(null,{stack:m,id:b,glyph:R});if(R=this._tinySDF(I,m,b),R)return I.glyphs[b]=R,void A(null,{stack:m,id:b,glyph:R});const O=Math.floor(b/256);if(256*O>65535)return void A(new Error("glyphs > 65535 not supported"));if(I.ranges[O])return void A(null,{stack:m,id:b,glyph:R});if(!this.url)return void A(new Error("glyphsUrl is not set"));let D=I.requests[O];D||(D=I.requests[O]=[],rn.loadGlyphRange(m,O,this.url,this.requestManager,(N,$)=>{if($){for(const te in $)this._doesCharSupportLocalGlyph(+te)||(I.glyphs[+te]=$[+te]);I.ranges[O]=!0}for(const te of D)te(N,$);delete I.requests[O]})),D.push((N,$)=>{N?A(N):$&&A(null,{stack:m,id:b,glyph:$[b]||null})})},(m,b)=>{if(m)d(m);else if(b){const A={};for(const{stack:I,id:R,glyph:O}of b)(A[I]||(A[I]={}))[R]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics};d(null,A)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](o)||a.u["Hangul Syllables"](o)||a.u.Hiragana(o)||a.u.Katakana(o))}_tinySDF(o,d,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let b=o.tinySDF;if(!b){let I="400";/bold/i.test(d)?I="900":/medium/i.test(d)?I="500":/light/i.test(d)&&(I="200"),b=o.tinySDF=new rn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:I})}const A=b.draw(String.fromCharCode(p));return{id:p,bitmap:new a.q({width:A.width||60,height:A.height||60},A.data),metrics:{width:A.glyphWidth/2||24,height:A.glyphHeight/2||24,left:A.glyphLeft/2+.5||0,top:A.glyphTop/2-27.5||-8,advance:A.glyphAdvance/2||24,isDoubleResolution:!0}}}}rn.loadGlyphRange=function(x,o,d,p,m){const b=256*o,A=b+255,I=p.transformRequest(d.replace("{fontstack}",x).replace("{range}",`${b}-${A}`),G.Glyphs);a.l(I,(R,O)=>{if(R)m(R);else if(O){const D={};for(const N of a.n(O))D[N.id]=N;m(null,D)}})},rn.TinySDF=class{constructor({fontSize:x=24,buffer:o=3,radius:d=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:A="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=d;const I=this.size=x+4*o,R=this._createCanvas(I),O=this.ctx=R.getContext("2d",{willReadFrequently:!0});O.font=`${A} ${b} ${x}px ${m}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(x){const o=document.createElement("canvas");return o.width=o.height=x,o}draw(x){const{width:o,actualBoundingBoxAscent:d,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(x),A=Math.ceil(d),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),R=Math.min(this.size-this.buffer,A+Math.ceil(p)),O=I+2*this.buffer,D=R+2*this.buffer,N=Math.max(O*D,0),$=new Uint8ClampedArray(N),te={data:$,width:O,height:D,glyphWidth:I,glyphHeight:R,glyphTop:A,glyphLeft:0,glyphAdvance:o};if(I===0||R===0)return te;const{ctx:ee,buffer:se,gridInner:J,gridOuter:me}=this;ee.clearRect(se,se,I,R),ee.fillText(x,se,se+A);const Ee=ee.getImageData(se,se,I,R);me.fill(pt,0,N),J.fill(0,0,N);for(let ce=0;ce<R;ce++)for(let xe=0;xe<I;xe++){const Ie=Ee.data[4*(ce*I+xe)+3]/255;if(Ie===0)continue;const Re=(ce+se)*O+xe+se;if(Ie===1)me[Re]=0,J[Re]=pt;else{const Le=.5-Ie;me[Re]=Le>0?Le*Le:0,J[Re]=Le<0?Le*Le:0}}ot(me,0,0,O,D,O,this.f,this.v,this.z),ot(J,se,se,I,R,O,this.f,this.v,this.z);for(let ce=0;ce<N;ce++){const xe=Math.sqrt(me[ce])-Math.sqrt(J[ce]);$[ce]=Math.round(255-255*(xe/this.radius+this.cutoff))}return te}};class lr{constructor(){this.specification=a.v.light.position}possiblyEvaluate(o,d){return a.z(o.expression.evaluate(d))}interpolate(o,d,p){return{x:a.B.number(o.x,d.x,p),y:a.B.number(o.y,d.y,p),z:a.B.number(o.z,d.z,p)}}}let us;class ks extends a.E{constructor(o){super(),us=us||new a.r({anchor:new a.D(a.v.light.anchor),position:new lr,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(us),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d={}){if(!this._validate(a.t,o,d))for(const p in o){const m=o[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,p){return(!p||p.validate!==!1)&&a.x(this,o.call(a.y,a.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}}class Co{constructor(o,d){this.width=o,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,d){const p=o.join(",")+String(d);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,d)),this.dashEntry[p]}getDashRanges(o,d,p){const m=[];let b=o.length%2==1?-o[o.length-1]*p:0,A=o[0]*p,I=!0;m.push({left:b,right:A,isDash:I,zeroLength:o[0]===0});let R=o[0];for(let O=1;O<o.length;O++){I=!I;const D=o[O];b=R*p,R+=D,A=R*p,m.push({left:b,right:A,isDash:I,zeroLength:D===0})}return m}addRoundDash(o,d,p){const m=d/2;for(let b=-p;b<=p;b++){const A=this.width*(this.nextRow+p+b);let I=0,R=o[I];for(let O=0;O<this.width;O++){O/R.right>1&&(R=o[++I]);const D=Math.abs(O-R.left),N=Math.abs(O-R.right),$=Math.min(D,N);let te;const ee=b/p*(m+1);if(R.isDash){const se=m-Math.abs(ee);te=Math.sqrt($*$+se*se)}else te=m-Math.sqrt($*$+ee*ee);this.data[A+O]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(o){for(let I=o.length-1;I>=0;--I){const R=o[I],O=o[I+1];R.zeroLength?o.splice(I,1):O&&O.isDash===R.isDash&&(O.left=R.left,o.splice(I,1))}const d=o[0],p=o[o.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const m=this.width*this.nextRow;let b=0,A=o[b];for(let I=0;I<this.width;I++){I/A.right>1&&(A=o[++b]);const R=Math.abs(I-A.left),O=Math.abs(I-A.right),D=Math.min(R,O);this.data[m+I]=Math.max(0,Math.min(255,(A.isDash?D:-D)+128))}}addDash(o,d){const p=d?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let b=0;for(let I=0;I<o.length;I++)b+=o[I];if(b!==0){const I=this.width/b,R=this.getDashRanges(o,this.width,I);d?this.addRoundDash(R,I,p):this.addRegularDash(R)}const A={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=m,this.dirty=!0,A}bind(o){const d=o.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}class eo{constructor(o,d,p){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=p;const m=this.workerPool.acquire(p);for(let b=0;b<m.length;b++){const A=new a.C(m[b],d,p);A.name=`Worker ${b}`,this.actors.push(A)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,d,p){a.o(this.actors,(m,b)=>{m.send(o,d,b)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}}function _r(x,o,d){const p=function(m,b){if(m)return d(m);if(b){const A=a.F(a.e(b,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(A.vectorLayers=b.vector_layers,A.vectorLayerIds=A.vectorLayers.map(I=>I.id)),d(null,A)}};return x.url?a.f(o.transformRequest(x.url,G.Source),p):a.h.frame(()=>p(null,x))}class oi{constructor(o,d){o&&(d?this.setSouthWest(o).setNorthEast(d):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof a.L?new a.L(o.lng,o.lat):a.L.convert(o),this}setSouthWest(o){return this._sw=o instanceof a.L?new a.L(o.lng,o.lat):a.L.convert(o),this}extend(o){const d=this._sw,p=this._ne;let m,b;if(o instanceof a.L)m=o,b=o;else{if(!(o instanceof oi))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(oi.convert(o)):this.extend(a.L.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(a.L.convert(o)):this;if(m=o._sw,b=o._ne,!m||!b)return this}return d||p?(d.lng=Math.min(m.lng,d.lng),d.lat=Math.min(m.lat,d.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new a.L(m.lng,m.lat),this._ne=new a.L(b.lng,b.lat)),this}getCenter(){return new a.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.L(this.getWest(),this.getNorth())}getSouthEast(){return new a.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:d,lat:p}=a.L.convert(o);let m=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(o){return o instanceof oi?o:o&&new oi(o)}static fromLngLat(o,d=0){const p=360*d/40075017,m=p/Math.cos(Math.PI/180*o.lat);return new oi(new a.L(o.lng-m,o.lat-p),new a.L(o.lng+m,o.lat+p))}}class sr{constructor(o,d,p){this.bounds=oi.convert(this.validateBounds(o)),this.minzoom=d||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const d=Math.pow(2,o.z),p=Math.floor(a.G(this.bounds.getWest())*d),m=Math.floor(a.H(this.bounds.getNorth())*d),b=Math.ceil(a.G(this.bounds.getEast())*d),A=Math.ceil(a.H(this.bounds.getSouth())*d);return o.x>=p&&o.x<b&&o.y>=m&&o.y<A}}class hs extends a.E{constructor(o,d,p,m){if(super(),this.load=()=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=_r(this._options,this.map._requestManager,(b,A)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),b?this.fire(new a.j(b)):A&&(a.e(this,A),A.bounds&&(this.tileBounds=new sr(A.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>a.e({},this._options),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.F(d,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(p,G.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function b(A,I){return delete o.request,o.aborted?d(null):A&&A.status!==404?d(A):(I&&I.resourceTiming&&(o.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&o.setExpiryData(I),o.loadVectorData(I,this.map.painter),d(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}m.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=d:o.request=o.actor.send("reloadTile",m,b.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",m,b.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Os extends a.E{constructor(o,d,p,m){super(),this.id=o,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},d),a.e(this,a.F(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=_r(this._options,this.map._requestManager,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new a.j(o)):d&&(a.e(this,d),d.bounds&&(this.tileBounds=new sr(d.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}serialize(){return a.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=Z.getImage(this.map._requestManager.transformRequest(p,G.Tile),(m,b,A)=>{if(delete o.request,o.aborted)o.state="unloaded",d(null);else if(m)o.state="errored",d(m);else if(b){this.map._refreshExpiredTiles&&A&&o.setExpiryData(A);const I=this.map.painter.context,R=I.gl;o.texture=this.map.painter.getTileTexture(b.width),o.texture?o.texture.update(b,{useMipmap:!0}):(o.texture=new Ue(I,b,R.RGBA,{useMipmap:!0}),o.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),I.extTextureFilterAnisotropic&&R.texParameterf(R.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax)),o.state="loaded",d(null)}},this.map._refreshExpiredTiles)}abortTile(o,d){o.request&&(o.request.cancel(),delete o.request),d()}unloadTile(o,d){o.texture&&this.map.painter.saveTileTexture(o.texture),d()}hasTransition(){return!1}}class Mi extends Os{constructor(o,d,p,m){super(o,d,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(p,G.Tile);function b(A,I){A&&(o.state="errored",d(A)),I&&(o.dem=I,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded",d(null))}o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.request=Z.getImage(m,(A,I,R)=>a._(this,void 0,void 0,function*(){if(delete o.request,o.aborted)o.state="unloaded",d(null);else if(A)o.state="errored",d(A);else if(I){this.map._refreshExpiredTiles&&o.setExpiryData(R);const O=a.a(I)&&a.J()?I:yield function(N){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.K()){const $=N.width+2,te=N.height+2;try{return new a.R({width:$,height:te},yield a.M(N,-1,-1,$,te))}catch{}}return a.h.getImageData(N,1)})}(I),D={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:O,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",D,b))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(o){const d=o.canonical,p=Math.pow(2,d.z),m=(d.x-1+p)%p,b=d.x===0?o.wrap-1:o.wrap,A=(d.x+1+p)%p,I=d.x+1===p?o.wrap+1:o.wrap,R={};return R[new a.O(o.overscaledZ,b,d.z,m,d.y).key]={backfilled:!1},R[new a.O(o.overscaledZ,I,d.z,A,d.y).key]={backfilled:!1},d.y>0&&(R[new a.O(o.overscaledZ,b,d.z,m,d.y-1).key]={backfilled:!1},R[new a.O(o.overscaledZ,o.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},R[new a.O(o.overscaledZ,I,d.z,A,d.y-1).key]={backfilled:!1}),d.y+1<p&&(R[new a.O(o.overscaledZ,b,d.z,m,d.y+1).key]={backfilled:!1},R[new a.O(o.overscaledZ,o.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},R[new a.O(o.overscaledZ,I,d.z,A,d.y+1).key]={backfilled:!1}),R}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class mr extends a.E{constructor(o,d,p,m){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>a.e({},this._options,{type:this.type,data:this._data}),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=d.data,this._options=a.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const b=a.N/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*b,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*b,extent:a.N,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:a.N,radius:(d.clusterRadius||50)*b,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},d),this}getClusterChildren(o,d){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},d),this}getClusterLeaves(o,d,p,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:d,offset:p},m),this}_updateWorkerData(o){const d=a.e({},this.workerOptions);o?d.dataDiff=o:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(a.h.resolveURL(this._data),G.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,d,(p,m)=>{if(this._pendingLoads--,this._removed||m&&m.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let b=null;if(m&&m.resourceTiming&&m.resourceTiming[this.id]&&(b=m.resourceTiming[this.id].slice(0)),p)return void this.fire(new a.j(p));const A={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&a.e(A,{resourceTiming:b}),this.fire(new a.k("data",Object.assign(Object.assign({},A),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},A),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(o,d){const p=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const m={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(p,m,(b,A)=>(delete o.request,o.unloadVectorData(),o.aborted?d(null):b?d(b):(o.loadVectorData(A,this.map.painter,p==="reloadTile"),d(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Yt=a.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ci extends a.E{constructor(o,d,p,m){super(),this.load=(b,A)=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Z.getImage(this.map._requestManager.transformRequest(this.url,G.Image),(I,R)=>{this._request=null,this._loaded=!0,I?this.fire(new a.j(I)):R&&(this.image=R,b&&(this.coordinates=b),A&&A(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const b=this.map.painter.context,A=b.gl;this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,Yt.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ue(b,this.image,A.RGBA),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE));let I=!1;for(const R in this.tiles){const O=this.tiles[R];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,I=!0)}I&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=o,this.dispatcher=p,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=d}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(o){this.coordinates=o;const d=o.map(a.U.fromLngLat);this.tileID=function(m){let b=1/0,A=1/0,I=-1/0,R=-1/0;for(const $ of m)b=Math.min(b,$.x),A=Math.min(A,$.y),I=Math.max(I,$.x),R=Math.max(R,$.y);const O=Math.max(I-b,R-A),D=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),N=Math.pow(2,D);return new a.W(D,Math.floor((b+I)/2*N),Math.floor((A+R)/2*N))}(d),this.minzoom=this.maxzoom=this.tileID.z;const p=d.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.V,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.N,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.N),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.N,a.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(o,d){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},d(null)):(o.state="errored",d(null))}hasTransition(){return!1}}class Xn extends ci{constructor(o,d,p,m){super(o,d,p,m),this.load=()=>{this._loaded=!1;const b=this.options;this.urls=[];for(const A of b.urls)this.urls.push(this.map._requestManager.transformRequest(A,G.Source).url);a.X(this.urls,(A,I)=>{this._loaded=!0,A?this.fire(new a.j(A)):I&&(this.video=I,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const b=this.map.painter.context,A=b.gl;this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,Yt.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.texSubImage2D(A.TEXTURE_2D,0,0,0,A.RGBA,A.UNSIGNED_BYTE,this.video)):(this.texture=new Ue(b,this.video,A.RGBA),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE));let I=!1;for(const R in this.tiles){const O=this.tiles[R];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,I=!0)}I&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=d}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const d=this.video.seekable;o<d.start(0)||o>d.end(0)?this.fire(new a.j(new a.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Nr extends ci{constructor(o,d,p,m){super(o,d,p,m),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let b=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,b=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,b=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const A=this.map.painter.context,I=A.gl;this.boundsBuffer||(this.boundsBuffer=A.createVertexBuffer(this._boundsArray,Yt.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?(b||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ue(A,this.canvas,I.RGBA,{premultiply:!0});let R=!1;for(const O in this.tiles){const D=this.tiles[O];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture,R=!0)}R&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(A=>typeof A!="number"))||this.fire(new a.j(new a.Y(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.Y(`sources.${o}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new a.j(new a.Y(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.Y(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.Y(`sources.${o}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Nn={},Er=x=>{switch(x){case"geojson":return mr;case"image":return ci;case"raster":return Os;case"raster-dem":return Mi;case"vector":return hs;case"video":return Xn;case"canvas":return Nr}return Nn[x]};function Tn(x,o){const d=a.Z();return a.$(d,d,[1,1,0]),a.a0(d,d,[.5*x.width,.5*x.height,1]),a.a1(d,d,x.calculatePosMatrix(o.toUnwrapped()))}function or(x,o,d,p,m,b){const A=function(N,$,te){if(N)for(const ee of N){const se=$[ee];if(se&&se.source===te&&se.type==="fill-extrusion")return!0}else for(const ee in $){const se=$[ee];if(se.source===te&&se.type==="fill-extrusion")return!0}return!1}(m&&m.layers,o,x.id),I=b.maxPitchScaleFactor(),R=x.tilesIn(p,I,A);R.sort(yr);const O=[];for(const N of R)O.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(o,d,x._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,m,b,I,Tn(x.transform,N.tileID))});const D=function(N){const $={},te={};for(const ee of N){const se=ee.queryResults,J=ee.wrappedTileID,me=te[J]=te[J]||{};for(const Ee in se){const ce=se[Ee],xe=me[Ee]=me[Ee]||{},Ie=$[Ee]=$[Ee]||[];for(const Re of ce)xe[Re.featureIndex]||(xe[Re.featureIndex]=!0,Ie.push(Re))}}return $}(O);for(const N in D)D[N].forEach($=>{const te=$.feature,ee=x.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=ee});return D}function yr(x,o){const d=x.tileID,p=o.tileID;return d.overscaledZ-p.overscaledZ||d.canonical.y-p.canonical.y||d.wrap-p.wrap||d.canonical.x-p.canonical.x}class Ln{constructor(o,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=a.a2(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const d=o+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,d,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(m,b){const A={};if(!b)return A;for(const I of m){const R=I.layerIds.map(O=>b.getLayer(O)).filter(Boolean);if(R.length!==0){I.layers=R,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(O=>R.filter(D=>D.id===O)[0]));for(const O of R)A[O.id]=I}}return A}(o.buckets,d.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a4){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a4&&b.hasRTLText){this.hasRTLText=!0,a.a5();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(m).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new a.a3}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(o)}const d=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ue(o,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ue(o,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,d,p,m,b,A,I,R,O,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:A,tileSize:this.tileSize,pixelPosMatrix:D,transform:R,params:I,queryPadding:this.queryPadding*O},o,d,p):{}}querySourceFeatures(o,d){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),b=d&&d.sourceLayer?d.sourceLayer:"",A=m._geojsonTileLayer||m[b];if(!A)return;const I=a.a6(d&&d.filter),{z:R,x:O,y:D}=this.tileID.canonical,N={z:R,x:O,y:D};for(let $=0;$<A.length;$++){const te=A.feature($);if(I.needGeometry){const J=a.a7(te,!0);if(!I.filter(new a.a8(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!I.filter(new a.a8(this.tileID.overscaledZ),te))continue;const ee=p.getId(te,b),se=new a.a9(te,R,O,D,ee);se.tile=N,o.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const p=a.aa(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(d)if(this.expirationTime<d)m=!0;else{const b=this.expirationTime-d;b?this.expirationTime=p+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!d.style.hasLayer(m))continue;const b=this.buckets[m],A=b.layers[0].sourceLayer||"_geojsonTileLayer",I=p[A],R=o[A];if(!I||!R||Object.keys(R).length===0)continue;b.update(R,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const O=d&&d.style&&d.style.getLayer(m);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=a.h.now()+o}setDependencies(o,d){const p={};for(const m of d)p[m]=!0;this.dependencies[o]=p}hasDependency(o,d){for(const p of o){const m=this.dependencies[p];if(m){for(const b of d)if(m[b])return!0}}return!1}}class Zn{constructor(o,d){this.max=o,this.onRemove=d,this.reset()}reset(){for(const o in this.data)for(const d of this.data[o])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(o,d,p){const m=o.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:d,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(o,b)},p)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const d=this.data[o].shift();return d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),d.value}getByKey(o){const d=this.data[o];return d?d[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,d){if(!this.has(o))return this;const p=o.wrapped().key,m=d===void 0?0:this.data[p].indexOf(d),b=this.data[p][m];return this.data[p].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(o){const d=[];for(const p in this.data)for(const m of this.data[p])o(m.value)||d.push(m);for(const p of d)this.remove(p.value.tileID,p)}}class Fe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,d,p){const m=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},a.e(this.stateChanges[o][m],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const b in this.state[o])b!==m&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][m]===null){this.deletedStates[o][m]={};for(const b in this.state[o][m])p[b]||(this.deletedStates[o][m][b]=null)}else for(const b in p)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][b]===null&&delete this.deletedStates[o][m][b]}removeFeatureState(o,d,p){if(this.deletedStates[o]===null)return;const m=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&d!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][p]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(p in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][p]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}getState(o,d){const p=String(d),m=a.e({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const b=this.deletedStates[o][d];if(b===null)return{};for(const A in b)delete m[A]}return m}initializeTileState(o,d){o.setFeatureState(this.state,d)}coalesceChanges(o,d){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const A in this.stateChanges[m])this.state[m][A]||(this.state[m][A]={}),a.e(this.state[m][A],this.stateChanges[m][A]),b[A]=this.state[m][A];p[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const A in this.state[m])b[A]={},this.state[m][A]={};else for(const A in this.deletedStates[m]){if(this.deletedStates[m][A]===null)this.state[m][A]={};else for(const I of Object.keys(this.deletedStates[m][A]))delete this.state[m][A][I];b[A]=this.state[m][A]}p[m]=p[m]||{},a.e(p[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in o)o[m].setFeatureState(p,d)}}class ui extends a.E{constructor(o,d,p){super(),this.id=o,this.dispatcher=p,this.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,A,I)=>{const R=new(Er(b.type))(m,b,A,I);if(R.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${R.id}`);return R})(o,d,p,this),this._tiles={},this._cache=new Zn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Fe,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const d=this._tiles[o];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,d){return this._source.loadTile(o,d)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new a.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const p=this._tiles[d];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Lr).map(o=>o.key)}getRenderableIds(o){const d=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&d.push(this._tiles[p]);return o?d.sort((p,m)=>{const b=p.tileID,A=m.tileID,I=new a.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),R=new a.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-A.overscaledZ||R.y-I.y||R.x-I.x}).map(p=>p.tileID.key):d.map(p=>p.tileID).sort(Lr).map(p=>p.key)}hasRenderableParent(o){const d=this.findLoadedParent(o,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(o,d){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(d||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,d){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=d),this._loadTile(p,this._tileLoaded.bind(this,p,o,d)))}_tileLoaded(o,d,p,m){if(m)return o.state="errored",void(m.status!==404?this._source.fire(new a.j(m,{tile:o})):this.update(this.transform,this.terrain));o.timeAdded=a.h.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const d=this.getRenderableIds();for(let m=0;m<d.length;m++){const b=d[m];if(o.neighboringTiles&&o.neighboringTiles[b]){const A=this.getTileByID(b);p(o,A),p(A,o)}}function p(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let A=b.tileID.canonical.x-m.tileID.canonical.x;const I=b.tileID.canonical.y-m.tileID.canonical.y,R=Math.pow(2,m.tileID.canonical.z),O=b.tileID.key;A===0&&I===0||Math.abs(I)>1||(Math.abs(A)>1&&(Math.abs(A+R)===1?A+=R:Math.abs(A-R)===1&&(A-=R)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,A,I),m.neighboringTiles&&m.neighboringTiles[O]&&(m.neighboringTiles[O].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,d,p,m){for(const b in this._tiles){let A=this._tiles[b];if(m[b]||!A.hasData()||A.tileID.overscaledZ<=d||A.tileID.overscaledZ>p)continue;let I=A.tileID;for(;A&&A.tileID.overscaledZ>d+1;){const O=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[O.key],A&&A.hasData()&&(I=O)}let R=I;for(;R.overscaledZ>d;)if(R=R.scaledTo(R.overscaledZ-1),o[R.key]){m[I.key]=I;break}}}findLoadedParent(o,d){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=d?p:null}for(let p=o.overscaledZ-1;p>=d;p--){const m=o.scaledTo(p),b=this._getLoadedTile(m);if(b)return b}}_getLoadedTile(o){const d=this._tiles[o.key];return d&&d.hasData()?d:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const d=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,m=Math.floor(d*p*(this._maxTileCacheZoomLevels===null?a.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,d){const p={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+d),p[b.tileID.key]=b}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(o,d){if(this.transform=o,this.terrain=d,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new a.O(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(p=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(p=p.filter(D=>this._source.hasTile(D)))):p=[];const m=o.coveringZoomLevel(this._source),b=Math.max(m-ui.maxOverzooming,this._source.minzoom),A=Math.max(m+ui.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const N of p)if(N.canonical.z>this._source.minzoom){const $=N.scaledTo(N.canonical.z-1);D[$.key]=$;const te=N.scaledTo(Math.max(this._source.minzoom,Math.min(N.canonical.z,5)));D[te.key]=te}p=p.concat(Object.values(D))}const I=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,I&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const R=this._updateRetainedTiles(p,m);if(ti(this._source.type)){const D={},N={},$=Object.keys(R),te=a.h.now();for(const ee of $){const se=R[ee],J=this._tiles[ee];if(!J||J.fadeEndTime!==0&&J.fadeEndTime<=te)continue;const me=this.findLoadedParent(se,b);me&&(this._addTile(me.tileID),D[me.tileID.key]=me.tileID),N[ee]=se}this._retainLoadedChildren(N,m,A,R);for(const ee in D)R[ee]||(this._coveredTiles[ee]=!0,R[ee]=D[ee]);if(d){const ee={},se={};for(const J of p)this._tiles[J.key].hasData()?ee[J.key]=J:se[J.key]=J;for(const J in se){const me=se[J].children(this._source.maxzoom);this._tiles[me[0].key]&&this._tiles[me[1].key]&&this._tiles[me[2].key]&&this._tiles[me[3].key]&&(ee[me[0].key]=R[me[0].key]=me[0],ee[me[1].key]=R[me[1].key]=me[1],ee[me[2].key]=R[me[2].key]=me[2],ee[me[3].key]=R[me[3].key]=me[3],delete se[J])}for(const J in se){const me=this.findLoadedParent(se[J],this._source.minzoom);if(me){ee[me.tileID.key]=R[me.tileID.key]=me.tileID;for(const Ee in ee)ee[Ee].isChildOf(me.tileID)&&delete ee[Ee]}}for(const J in this._tiles)ee[J]||(this._coveredTiles[J]=!0)}}for(const D in R)this._tiles[D].clearFadeHold();const O=a.ab(this._tiles,R);for(const D of O){const N=this._tiles[D];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,d){const p={},m={},b=Math.max(d-ui.maxOverzooming,this._source.minzoom),A=Math.max(d+ui.maxUnderzooming,this._source.minzoom),I={};for(const R of o){const O=this._addTile(R);p[R.key]=R,O.hasData()||d<this._source.maxzoom&&(I[R.key]=R)}this._retainLoadedChildren(I,d,A,p);for(const R of o){let O=this._tiles[R.key];if(O.hasData())continue;if(d+1>this._source.maxzoom){const N=R.children(this._source.maxzoom)[0],$=this.getTile(N);if($&&$.hasData()){p[N.key]=N;continue}}else{const N=R.children(this._source.maxzoom);if(p[N[0].key]&&p[N[1].key]&&p[N[2].key]&&p[N[3].key])continue}let D=O.wasRequested();for(let N=R.overscaledZ-1;N>=b;--N){const $=R.scaledTo(N);if(m[$.key])break;if(m[$.key]=!0,O=this.getTile($),!O&&D&&(O=this._addTile($)),O){const te=O.hasData();if((D||te)&&(p[$.key]=$),D=O.wasRequested(),te)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const d=[];let p,m=this._tiles[o].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}d.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;m=b}for(const b of d)this._loadedParentTiles[b]=p}}_addTile(o){let d=this._tiles[o.key];if(d)return d;d=this._cache.getAndRemove(o),d&&(this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,d)));const p=d;return d||(d=new Ln(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,o.key,d.state))),d.uses++,this._tiles[o.key]=d,p||this._source.fire(new a.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=d.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const d=this._tiles[o];d&&(d.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,d,p){const m=[],b=this.transform;if(!b)return m;const A=p?b.getCameraQueryGeometry(o):o,I=o.map(ee=>b.pointCoordinate(ee,this.terrain)),R=A.map(ee=>b.pointCoordinate(ee,this.terrain)),O=this.getIds();let D=1/0,N=1/0,$=-1/0,te=-1/0;for(const ee of R)D=Math.min(D,ee.x),N=Math.min(N,ee.y),$=Math.max($,ee.x),te=Math.max(te,ee.y);for(let ee=0;ee<O.length;ee++){const se=this._tiles[O[ee]];if(se.holdingForFade())continue;const J=se.tileID,me=Math.pow(2,b.zoom-se.tileID.overscaledZ),Ee=d*se.queryPadding*a.N/se.tileSize/me,ce=[J.getTilePoint(new a.U(D,N)),J.getTilePoint(new a.U($,te))];if(ce[0].x-Ee<a.N&&ce[0].y-Ee<a.N&&ce[1].x+Ee>=0&&ce[1].y+Ee>=0){const xe=I.map(Re=>J.getTilePoint(Re)),Ie=R.map(Re=>J.getTilePoint(Re));m.push({tile:se,tileID:J,queryGeometry:xe,cameraQueryGeometry:Ie,scale:me})}}return m}getVisibleCoordinates(o){const d=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);for(const p of d)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(ti(this._source.type)){const o=a.h.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=o)return!0}return!1}setFeatureState(o,d,p){this._state.updateState(o=o||"_geojsonTileLayer",d,p)}removeFeatureState(o,d,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",d,p)}getFeatureState(o,d){return this._state.getState(o=o||"_geojsonTileLayer",d)}setDependencies(o,d,p){const m=this._tiles[o];m&&m.setDependencies(d,p)}reloadTilesForDependencies(o,d){for(const p in this._tiles)this._tiles[p].hasDependency(o,d)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,d))}}function Lr(x,o){const d=Math.abs(2*x.wrap)-+(x.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return x.overscaledZ-o.overscaledZ||p-d||o.canonical.y-x.canonical.y||o.canonical.x-x.canonical.x}function ti(x){return x==="raster"||x==="image"||x==="video"}ui.maxOverzooming=10,ui.maxUnderzooming=3;const jt="mapboxgl_preloaded_worker_pool";class Sn{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Sn.workerCount;)this.workers.push(new Worker(a.c.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jt]}numActive(){return Object.keys(this.active).length}}const Fs=Math.floor(a.h.hardwareConcurrency/2);let En;function to(){return En||(En=new Sn),En}Sn.workerCount=a.ac(globalThis)?Math.max(Math.min(Fs,3),1):1;class ds{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=a.ad(o,0,1);let d=1,p=this._distances[d];const m=o*this.paddedLength+this.padding;for(;p<m&&d<this._distances.length;)p=this._distances[++d];const b=d-1,A=this._distances[b],I=p-A,R=I>0?(m-A)/I:0;return this.points[b].mult(1-R).add(this.points[d].mult(R))}}function Bn(x,o){let d=!0;return x==="always"||x!=="never"&&o!=="never"||(d=!1),d}class An{constructor(o,d,p){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(d/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,p,m,b){this._forEachCell(d,p,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(o,d,p,m){this._forEachCell(d-m,p-m,d+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(p),this.circles.push(m)}_insertBoxCell(o,d,p,m,b,A){this.boxCells[b].push(A)}_insertCircleCell(o,d,p,m,b,A){this.circleCells[b].push(A)}_query(o,d,p,m,b,A,I){if(p<0||o>this.width||m<0||d>this.height)return[];const R=[];if(o<=0&&d<=0&&this.width<=p&&this.height<=m){if(b)return[{key:null,x1:o,y1:d,x2:p,y2:m}];for(let O=0;O<this.boxKeys.length;O++)R.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const D=this.circles[3*O],N=this.circles[3*O+1],$=this.circles[3*O+2];R.push({key:this.circleKeys[O],x1:D-$,y1:N-$,x2:D+$,y2:N+$})}}else this._forEachCell(o,d,p,m,this._queryCell,R,{hitTest:b,overlapMode:A,seenUids:{box:{},circle:{}}},I);return R}query(o,d,p,m){return this._query(o,d,p,m,!1,null)}hitTest(o,d,p,m,b,A){return this._query(o,d,p,m,!0,b,A).length>0}hitTestCircle(o,d,p,m,b){const A=o-p,I=o+p,R=d-p,O=d+p;if(I<0||A>this.width||O<0||R>this.height)return!1;const D=[];return this._forEachCell(A,R,I,O,this._queryCellCircle,D,{hitTest:!0,overlapMode:m,circle:{x:o,y:d,radius:p},seenUids:{box:{},circle:{}}},b),D.length>0}_queryCell(o,d,p,m,b,A,I,R){const{seenUids:O,hitTest:D,overlapMode:N}=I,$=this.boxCells[b];if($!==null){const ee=this.bboxes;for(const se of $)if(!O.box[se]){O.box[se]=!0;const J=4*se,me=this.boxKeys[se];if(o<=ee[J+2]&&d<=ee[J+3]&&p>=ee[J+0]&&m>=ee[J+1]&&(!R||R(me))&&(!D||!Bn(N,me.overlapMode))&&(A.push({key:me,x1:ee[J],y1:ee[J+1],x2:ee[J+2],y2:ee[J+3]}),D))return!0}}const te=this.circleCells[b];if(te!==null){const ee=this.circles;for(const se of te)if(!O.circle[se]){O.circle[se]=!0;const J=3*se,me=this.circleKeys[se];if(this._circleAndRectCollide(ee[J],ee[J+1],ee[J+2],o,d,p,m)&&(!R||R(me))&&(!D||!Bn(N,me.overlapMode))){const Ee=ee[J],ce=ee[J+1],xe=ee[J+2];if(A.push({key:me,x1:Ee-xe,y1:ce-xe,x2:Ee+xe,y2:ce+xe}),D)return!0}}}return!1}_queryCellCircle(o,d,p,m,b,A,I,R){const{circle:O,seenUids:D,overlapMode:N}=I,$=this.boxCells[b];if($!==null){const ee=this.bboxes;for(const se of $)if(!D.box[se]){D.box[se]=!0;const J=4*se,me=this.boxKeys[se];if(this._circleAndRectCollide(O.x,O.y,O.radius,ee[J+0],ee[J+1],ee[J+2],ee[J+3])&&(!R||R(me))&&!Bn(N,me.overlapMode))return A.push(!0),!0}}const te=this.circleCells[b];if(te!==null){const ee=this.circles;for(const se of te)if(!D.circle[se]){D.circle[se]=!0;const J=3*se,me=this.circleKeys[se];if(this._circlesCollide(ee[J],ee[J+1],ee[J+2],O.x,O.y,O.radius)&&(!R||R(me))&&!Bn(N,me.overlapMode))return A.push(!0),!0}}}_forEachCell(o,d,p,m,b,A,I,R){const O=this._convertToXCellCoord(o),D=this._convertToYCellCoord(d),N=this._convertToXCellCoord(p),$=this._convertToYCellCoord(m);for(let te=O;te<=N;te++)for(let ee=D;ee<=$;ee++)if(b.call(this,o,d,p,m,this.xCellCount*ee+te,A,I,R))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,p,m,b,A){const I=m-o,R=b-d,O=p+A;return O*O>I*I+R*R}_circleAndRectCollide(o,d,p,m,b,A,I){const R=(A-m)/2,O=Math.abs(o-(m+R));if(O>R+p)return!1;const D=(I-b)/2,N=Math.abs(d-(b+D));if(N>D+p)return!1;if(O<=R||N<=D)return!0;const $=O-R,te=N-D;return $*$+te*te<=p*p}}function Ze(x,o,d,p,m){const b=a.Z();return o?(a.a0(b,b,[1/m,1/m,1]),d||a.ae(b,b,p.angle)):a.a1(b,p.labelPlaneMatrix,x),b}function Pn(x,o,d,p,m){if(o){const b=a.af(x);return a.a0(b,b,[m,m,1]),d||a.ae(b,b,-p.angle),b}return p.glCoordMatrix}function xi(x,o,d){let p;d?(p=[x.x,x.y,d(x.x,x.y),1],a.ag(p,p,o)):(p=[x.x,x.y,0,1],oe(p,p,o));const m=p[3];return{point:new a.P(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function fs(x,o){return .5+x/o*.5}function zn(x,o){const d=x[0]/x[3],p=x[1]/x[3];return d>=-o[0]&&d<=o[0]&&p>=-o[1]&&p<=o[1]}function Ke(x,o,d,p,m,b,A,I,R,O){const D=p?x.textSizeData:x.iconSizeData,N=a.ah(D,d.transform.zoom),$=[256/d.width*2+1,256/d.height*2+1],te=p?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;te.clear();const ee=x.lineVertexArray,se=p?x.text.placedSymbolArray:x.icon.placedSymbolArray,J=d.transform.width/d.transform.height;let me=!1;for(let Ee=0;Ee<se.length;Ee++){const ce=se.get(Ee);if(ce.hidden||ce.writingMode===a.ai.vertical&&!me){Y(ce.numGlyphs,te);continue}let xe;if(me=!1,O?(xe=[ce.anchorX,ce.anchorY,O(ce.anchorX,ce.anchorY),1],a.ag(xe,xe,o)):(xe=[ce.anchorX,ce.anchorY,0,1],oe(xe,xe,o)),!zn(xe,$)){Y(ce.numGlyphs,te);continue}const Ie=fs(d.transform.cameraToCenterDistance,xe[3]),Re=a.aj(D,N,ce),Le=A?Re/Ie:Re*Ie,We=new a.P(ce.anchorX,ce.anchorY),Ve=xi(We,m,O).point,Xe={projections:{},offsets:{}},ht=cr(ce,Le,!1,I,o,m,b,x.glyphOffsetArray,ee,te,Ve,We,Xe,J,R,O);me=ht.useVertical,(ht.notEnoughRoom||me||ht.needsFlipping&&cr(ce,Le,!0,I,o,m,b,x.glyphOffsetArray,ee,te,Ve,We,Xe,J,R,O).notEnoughRoom)&&Y(ce.numGlyphs,te)}p?x.text.dynamicLayoutVertexBuffer.updateData(te):x.icon.dynamicLayoutVertexBuffer.updateData(te)}function Pt(x,o,d,p,m,b,A,I,R,O,D,N,$){const te=I.glyphStartIndex+I.numGlyphs,ee=I.lineStartIndex,se=I.lineStartIndex+I.lineLength,J=o.getoffsetX(I.glyphStartIndex),me=o.getoffsetX(te-1),Ee=z(x*J,d,p,m,b,A,I.segment,ee,se,R,O,D,N,$);if(!Ee)return null;const ce=z(x*me,d,p,m,b,A,I.segment,ee,se,R,O,D,N,$);return ce?{first:Ee,last:ce}:null}function At(x,o,d,p){return x===a.ai.horizontal&&Math.abs(d.y-o.y)>Math.abs(d.x-o.x)*p?{useVertical:!0}:(x===a.ai.vertical?o.y<d.y:o.x>d.x)?{needsFlipping:!0}:null}function cr(x,o,d,p,m,b,A,I,R,O,D,N,$,te,ee,se){const J=o/24,me=x.lineOffsetX*J,Ee=x.lineOffsetY*J;let ce;if(x.numGlyphs>1){const xe=x.glyphStartIndex+x.numGlyphs,Ie=x.lineStartIndex,Re=x.lineStartIndex+x.lineLength,Le=Pt(J,I,me,Ee,d,D,N,x,R,b,$,ee,se);if(!Le)return{notEnoughRoom:!0};const We=xi(Le.first.point,A,se).point,Ve=xi(Le.last.point,A,se).point;if(p&&!d){const Xe=At(x.writingMode,We,Ve,te);if(Xe)return Xe}ce=[Le.first];for(let Xe=x.glyphStartIndex+1;Xe<xe-1;Xe++)ce.push(z(J*I.getoffsetX(Xe),me,Ee,d,D,N,x.segment,Ie,Re,R,b,$,ee,se));ce.push(Le.last)}else{if(p&&!d){const Ie=xi(N,m,se).point,Re=x.lineStartIndex+x.segment+1,Le=new a.P(R.getx(Re),R.gety(Re)),We=xi(Le,m,se),Ve=We.signedDistanceFromCamera>0?We.point:nn(N,Le,Ie,1,m,se),Xe=At(x.writingMode,Ie,Ve,te);if(Xe)return Xe}const xe=z(J*I.getoffsetX(x.glyphStartIndex),me,Ee,d,D,N,x.segment,x.lineStartIndex,x.lineStartIndex+x.lineLength,R,b,$,ee,se);if(!xe)return{notEnoughRoom:!0};ce=[xe]}for(const xe of ce)a.ak(O,xe.point,xe.angle);return{}}function nn(x,o,d,p,m,b){const A=xi(x.add(x.sub(o)._unit()),m,b).point,I=d.sub(A);return d.add(I._mult(p/I.mag()))}function It(x,o){const{projectionCache:d,lineVertexArray:p,labelPlaneMatrix:m,tileAnchorPoint:b,distanceFromAnchor:A,getElevation:I,previousVertex:R,direction:O,absOffsetX:D}=o;if(d.projections[x])return d.projections[x];const N=new a.P(p.getx(x),p.gety(x)),$=xi(N,m,I);if($.signedDistanceFromCamera>0)return d.projections[x]=$.point,$.point;const te=x-O;return nn(A===0?b:new a.P(p.getx(te),p.gety(te)),N,R,D-A+1,m,I)}function sn(x,o,d){return x._unit()._perp()._mult(o*d)}function ne(x,o,d,p,m,b,A,I){const{projectionCache:R,direction:O}=I;if(R.offsets[x])return R.offsets[x];const D=d.add(o);if(x+O<p||x+O>=m)return R.offsets[x]=D,D;const N=It(x+O,I),$=sn(N.sub(d),A,O),te=d.add($),ee=N.add($);return R.offsets[x]=a.al(b,D,te,ee)||D,R.offsets[x]}function z(x,o,d,p,m,b,A,I,R,O,D,N,$,te){const ee=p?x-o:x+o;let se=ee>0?1:-1,J=0;p&&(se*=-1,J=Math.PI),se<0&&(J+=Math.PI);let me,Ee,ce=se>0?I+A:I+A+1,xe=m,Ie=m,Re=0,Le=0;const We=Math.abs(ee),Ve=[];let Xe;for(;Re+Le<=We;){if(ce+=se,ce<I||ce>=R)return null;Re+=Le,Ie=xe,Ee=me;const Qe={projectionCache:N,lineVertexArray:O,labelPlaneMatrix:D,tileAnchorPoint:b,distanceFromAnchor:Re,getElevation:te,previousVertex:Ie,direction:se,absOffsetX:We};if(xe=It(ce,Qe),d===0)Ve.push(Ie),Xe=xe.sub(Ie);else{let Tt;const ft=xe.sub(Ie);Tt=ft.mag()===0?sn(It(ce+se,Qe).sub(xe),d,se):sn(ft,d,se),Ee||(Ee=Ie.add(Tt)),me=ne(ce,Tt,xe,I,R,Ee,d,Qe),Ve.push(Ee),Xe=me.sub(Ee)}Le=Xe.mag()}const ht=Xe._mult((We-Re)/Le)._add(Ee||Ie),Nt=J+Math.atan2(xe.y-Ie.y,xe.x-Ie.x);return Ve.push(ht),{point:ht,angle:$?Nt:0,path:Ve}}const V=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Y(x,o){for(let d=0;d<x;d++){const p=o.length;o.resize(p+4),o.float32.set(V,3*p)}}function oe(x,o,d){const p=o[0],m=o[1];return x[0]=d[0]*p+d[4]*m+d[12],x[1]=d[1]*p+d[5]*m+d[13],x[3]=d[3]*p+d[7]*m+d[15],x}const le=100;class be{constructor(o,d=new An(o.width+200,o.height+200,25),p=new An(o.width+200,o.height+200,25)){this.transform=o,this.grid=d,this.ignoredGrid=p,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+le,this.screenBottomBoundary=o.height+le,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,d,p,m,b,A){const I=this.projectAndGetPerspectiveRatio(m,o.anchorPointX,o.anchorPointY,A),R=p*I.perspectiveRatio,O=o.x1*R+I.point.x,D=o.y1*R+I.point.y,N=o.x2*R+I.point.x,$=o.y2*R+I.point.y;return!this.isInsideGrid(O,D,N,$)||d!=="always"&&this.grid.hitTest(O,D,N,$,d,b)||I.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[O,D,N,$],offscreen:this.isOffscreen(O,D,N,$)}}placeCollisionCircles(o,d,p,m,b,A,I,R,O,D,N,$,te,ee){const se=[],J=new a.P(d.anchorX,d.anchorY),me=xi(J,A,ee),Ee=fs(this.transform.cameraToCenterDistance,me.signedDistanceFromCamera),ce=(D?b/Ee:b*Ee)/a.ap,xe=xi(J,I,ee).point,Ie=Pt(ce,m,d.lineOffsetX*ce,d.lineOffsetY*ce,!1,xe,J,d,p,I,{projections:{},offsets:{}},!1,ee);let Re=!1,Le=!1,We=!0;if(Ie){const Ve=.5*$*Ee+te,Xe=new a.P(-100,-100),ht=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Nt=new ds,Qe=Ie.first,Tt=Ie.last;let ft=[];for(let Ct=Qe.path.length-1;Ct>=1;Ct--)ft.push(Qe.path[Ct]);for(let Ct=1;Ct<Tt.path.length;Ct++)ft.push(Tt.path[Ct]);const ii=2.5*Ve;if(R){const Ct=ft.map(Lt=>xi(Lt,R,ee));ft=Ct.some(Lt=>Lt.signedDistanceFromCamera<=0)?[]:Ct.map(Lt=>Lt.point)}let Ft=[];if(ft.length>0){const Ct=ft[0].clone(),Lt=ft[0].clone();for(let Fi=1;Fi<ft.length;Fi++)Ct.x=Math.min(Ct.x,ft[Fi].x),Ct.y=Math.min(Ct.y,ft[Fi].y),Lt.x=Math.max(Lt.x,ft[Fi].x),Lt.y=Math.max(Lt.y,ft[Fi].y);Ft=Ct.x>=Xe.x&&Lt.x<=ht.x&&Ct.y>=Xe.y&&Lt.y<=ht.y?[ft]:Lt.x<Xe.x||Ct.x>ht.x||Lt.y<Xe.y||Ct.y>ht.y?[]:a.am([ft],Xe.x,Xe.y,ht.x,ht.y)}for(const Ct of Ft){Nt.reset(Ct,.25*Ve);let Lt=0;Lt=Nt.length<=.5*Ve?1:Math.ceil(Nt.paddedLength/ii)+1;for(let Fi=0;Fi<Lt;Fi++){const hi=Fi/Math.max(Lt-1,1),dr=Nt.lerp(hi),Ki=dr.x+le,Ui=dr.y+le;se.push(Ki,Ui,Ve,0);const dn=Ki-Ve,pi=Ui-Ve,Jn=Ki+Ve,Qn=Ui+Ve;if(We=We&&this.isOffscreen(dn,pi,Jn,Qn),Le=Le||this.isInsideGrid(dn,pi,Jn,Qn),o!=="always"&&this.grid.hitTestCircle(Ki,Ui,Ve,o,N)&&(Re=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Re}}}}return{circles:!O&&Re||!Le||Ee<this.perspectiveRatioCutoff?[]:se,offscreen:We,collisionDetected:Re}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let p=1/0,m=1/0,b=-1/0,A=-1/0;for(const D of o){const N=new a.P(D.x+le,D.y+le);p=Math.min(p,N.x),m=Math.min(m,N.y),b=Math.max(b,N.x),A=Math.max(A,N.y),d.push(N)}const I=this.grid.query(p,m,b,A).concat(this.ignoredGrid.query(p,m,b,A)),R={},O={};for(const D of I){const N=D.key;if(R[N.bucketInstanceId]===void 0&&(R[N.bucketInstanceId]={}),R[N.bucketInstanceId][N.featureIndex])continue;const $=[new a.P(D.x1,D.y1),new a.P(D.x2,D.y1),new a.P(D.x2,D.y2),new a.P(D.x1,D.y2)];a.an(d,$)&&(R[N.bucketInstanceId][N.featureIndex]=!0,O[N.bucketInstanceId]===void 0&&(O[N.bucketInstanceId]=[]),O[N.bucketInstanceId].push(N.featureIndex))}return O}insertCollisionBox(o,d,p,m,b,A){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:A,overlapMode:d},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,p,m,b,A){const I=p?this.ignoredGrid:this.grid,R={bucketInstanceId:m,featureIndex:b,collisionGroupID:A,overlapMode:d};for(let O=0;O<o.length;O+=4)I.insertCircle(R,o[O],o[O+1],o[O+2])}projectAndGetPerspectiveRatio(o,d,p,m){let b;return m?(b=[d,p,m(d,p),1],a.ag(b,b,o)):(b=[d,p,0,1],oe(b,b,o)),{point:new a.P((b[0]/b[3]+1)/2*this.transform.width+le,(-b[1]/b[3]+1)/2*this.transform.height+le),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(o,d,p,m){return p<le||o>=this.screenRightBoundary||m<le||d>this.screenBottomBoundary}isInsideGrid(o,d,p,m){return p>=0&&o<this.gridRightBoundary&&m>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=a.ao([]);return a.$(o,o,[-100,-100,0]),o}}function _e(x,o,d){return o*(a.N/(x.tileSize*Math.pow(2,d-x.tileID.overscaledZ)))}class he{constructor(o,d,p,m){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class ye{constructor(o,d,p,m,b){this.text=new he(o?o.text:null,d,p,b),this.icon=new he(o?o.icon:null,d,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class De{constructor(o,d,p){this.text=o,this.icon=d,this.skipFade=p}}class Ne{constructor(){this.invProjMatrix=a.Z(),this.viewportMatrix=a.Z(),this.circles=[]}}class ze{constructor(o,d,p,m,b){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=b}}class yt{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:p=>p.collisionGroupID===d}}return this.collisionGroups[o]}}function St(x,o,d,p,m){const{horizontalAlign:b,verticalAlign:A}=a.au(x);return new a.P(-(b-.5)*o+p[0]*m,-(A-.5)*d+p[1]*m)}function lt(x,o,d,p,m,b){const{x1:A,x2:I,y1:R,y2:O,anchorPointX:D,anchorPointY:N}=x,$=new a.P(o,d);return p&&$._rotate(m?b:-b),{x1:A+$.x,y1:R+$.y,x2:I+$.x,y2:O+$.y,anchorPointX:D,anchorPointY:N}}class xt{constructor(o,d,p,m,b){this.transform=o.clone(),this.terrain=d,this.collisionIndex=new be(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new yt(m),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,d,p,m){const b=p.getBucket(d),A=p.latestFeatureIndex;if(!b||!A||d.id!==b.layerIds[0])return;const I=p.collisionBoxArray,R=b.layers[0].layout,O=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),D=p.tileSize/a.N,N=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),$=R.get("text-pitch-alignment")==="map",te=R.get("text-rotation-alignment")==="map",ee=_e(p,1,this.transform.zoom),se=Ze(N,$,te,this.transform,ee);let J=null;if($){const Ee=Pn(N,$,te,this.transform,ee);J=a.a1([],this.transform.labelPlaneMatrix,Ee)}this.retainedQueryData[b.bucketInstanceId]=new ze(b.bucketInstanceId,A,b.sourceLayerIndex,b.index,p.tileID);const me={bucket:b,layout:R,posMatrix:N,textLabelPlaneMatrix:se,labelToScreenMatrix:J,scale:O,textPixelRatio:D,holdingForFade:p.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:a.ah(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const Ee of b.sortKeyRanges){const{sortKey:ce,symbolInstanceStart:xe,symbolInstanceEnd:Ie}=Ee;o.push({sortKey:ce,symbolInstanceStart:xe,symbolInstanceEnd:Ie,parameters:me})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:me})}attemptAnchorPlacement(o,d,p,m,b,A,I,R,O,D,N,$,te,ee,se,J){const me=a.aq[o.textAnchor],Ee=[o.textOffset0,o.textOffset1],ce=St(me,p,m,Ee,b),xe=this.collisionIndex.placeCollisionBox(lt(d,ce.x,ce.y,A,I,this.transform.angle),N,R,O,D.predicate,J);if((!se||this.collisionIndex.placeCollisionBox(lt(se,ce.x,ce.y,A,I,this.transform.angle),N,R,O,D.predicate,J).box.length!==0)&&xe.box.length>0){let Ie;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Ie=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:Ee,width:p,height:m,anchor:me,textBoxScale:b,prevAnchor:Ie},this.markUsedJustification(te,me,$,ee),te.allowVerticalPlacement&&(this.markUsedOrientation(te,ee,$),this.placedOrientations[$.crossTileID]=ee),{shift:ce,placedGlyphBoxes:xe}}}placeLayerBucketPart(o,d,p){const{bucket:m,layout:b,posMatrix:A,textLabelPlaneMatrix:I,labelToScreenMatrix:R,textPixelRatio:O,holdingForFade:D,collisionBoxArray:N,partiallyEvaluatedTextSize:$,collisionGroup:te}=o.parameters,ee=b.get("text-optional"),se=b.get("icon-optional"),J=a.ar(b,"text-overlap","text-allow-overlap"),me=J==="always",Ee=a.ar(b,"icon-overlap","icon-allow-overlap"),ce=Ee==="always",xe=b.get("text-rotation-alignment")==="map",Ie=b.get("text-pitch-alignment")==="map",Re=b.get("icon-text-fit")!=="none",Le=b.get("symbol-z-order")==="viewport-y",We=me&&(ce||!m.hasIconData()||se),Ve=ce&&(me||!m.hasTextData()||ee);!m.collisionArrays&&N&&m.deserializeCollisionBoxes(N);const Xe=this.retainedQueryData[m.bucketInstanceId].tileID,ht=this.terrain?(Qe,Tt)=>this.terrain.getElevation(Xe,Qe,Tt):null,Nt=(Qe,Tt)=>{var ft,ii;if(d[Qe.crossTileID])return;if(D)return void(this.placements[Qe.crossTileID]=new De(!1,!1,!1));let Ft=!1,Ct=!1,Lt=!0,Fi=null,hi={box:null,offscreen:null},dr={box:null,offscreen:null},Ki=null,Ui=null,dn=null,pi=0,Jn=0,Qn=0;Tt.textFeatureIndex?pi=Tt.textFeatureIndex:Qe.useRuntimeCollisionCircles&&(pi=Qe.featureIndex),Tt.verticalTextFeatureIndex&&(Jn=Tt.verticalTextFeatureIndex);const zs=Tt.textBox;if(zs){const vr=Di=>{let Gi=a.ai.horizontal;if(m.allowVerticalPlacement&&!Di&&this.prevPlacement){const jr=this.prevPlacement.placedOrientations[Qe.crossTileID];jr&&(this.placedOrientations[Qe.crossTileID]=jr,Gi=jr,this.markUsedOrientation(m,Gi,Qe))}return Gi},fr=(Di,Gi)=>{if(m.allowVerticalPlacement&&Qe.numVerticalGlyphVertices>0&&Tt.verticalTextBox){for(const jr of m.writingModes)if(jr===a.ai.vertical?(hi=Gi(),dr=hi):hi=Di(),hi&&hi.box&&hi.box.length)break}else hi=Di()},Ir=Qe.textAnchorOffsetStartIndex,ho=Qe.textAnchorOffsetEndIndex;if(ho===Ir){const Di=(Gi,jr)=>{const Ni=this.collisionIndex.placeCollisionBox(Gi,J,O,A,te.predicate,ht);return Ni&&Ni.box&&Ni.box.length&&(this.markUsedOrientation(m,jr,Qe),this.placedOrientations[Qe.crossTileID]=jr),Ni};fr(()=>Di(zs,a.ai.horizontal),()=>{const Gi=Tt.verticalTextBox;return m.allowVerticalPlacement&&Qe.numVerticalGlyphVertices>0&&Gi?Di(Gi,a.ai.vertical):{box:null,offscreen:null}}),vr(hi&&hi.box&&hi.box.length)}else{let Di=a.aq[(ii=(ft=this.prevPlacement)===null||ft===void 0?void 0:ft.variableOffsets[Qe.crossTileID])===null||ii===void 0?void 0:ii.anchor];const Gi=(Ni,fo,Ll)=>{const Id=Ni.x2-Ni.x1,Cd=Ni.y2-Ni.y1,Pg=Qe.textBoxScale,wu=Re&&Ee==="never"?fo:null;let es={box:[],offscreen:!1},po=J==="never"?1:2,ts="never";Di&&po++;for(let kn=0;kn<po;kn++){for(let is=Ir;is<ho;is++){const Tu=m.textAnchorOffsets.get(is);if(Di&&Tu.textAnchor!==Di)continue;const bs=this.attemptAnchorPlacement(Tu,Ni,Id,Cd,Pg,xe,Ie,O,A,te,ts,Qe,m,Ll,wu,ht);if(bs&&(es=bs.placedGlyphBoxes,es&&es.box&&es.box.length))return Ft=!0,Fi=bs.shift,es}Di?Di=null:ts=J}return es};fr(()=>Gi(zs,Tt.iconBox,a.ai.horizontal),()=>{const Ni=Tt.verticalTextBox;return m.allowVerticalPlacement&&!(hi&&hi.box&&hi.box.length)&&Qe.numVerticalGlyphVertices>0&&Ni?Gi(Ni,Tt.verticalIconBox,a.ai.vertical):{box:null,offscreen:null}}),hi&&(Ft=hi.box,Lt=hi.offscreen);const jr=vr(hi&&hi.box);if(!Ft&&this.prevPlacement){const Ni=this.prevPlacement.variableOffsets[Qe.crossTileID];Ni&&(this.variableOffsets[Qe.crossTileID]=Ni,this.markUsedJustification(m,Ni.anchor,Qe,jr))}}}if(Ki=hi,Ft=Ki&&Ki.box&&Ki.box.length>0,Lt=Ki&&Ki.offscreen,Qe.useRuntimeCollisionCircles){const vr=m.text.placedSymbolArray.get(Qe.centerJustifiedTextSymbolIndex),fr=a.aj(m.textSizeData,$,vr),Ir=b.get("text-padding");Ui=this.collisionIndex.placeCollisionCircles(J,vr,m.lineVertexArray,m.glyphOffsetArray,fr,A,I,R,p,Ie,te.predicate,Qe.collisionCircleDiameter,Ir,ht),Ui.circles.length&&Ui.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),Ft=me||Ui.circles.length>0&&!Ui.collisionDetected,Lt=Lt&&Ui.offscreen}if(Tt.iconFeatureIndex&&(Qn=Tt.iconFeatureIndex),Tt.iconBox){const vr=fr=>{const Ir=Re&&Fi?lt(fr,Fi.x,Fi.y,xe,Ie,this.transform.angle):fr;return this.collisionIndex.placeCollisionBox(Ir,Ee,O,A,te.predicate,ht)};dr&&dr.box&&dr.box.length&&Tt.verticalIconBox?(dn=vr(Tt.verticalIconBox),Ct=dn.box.length>0):(dn=vr(Tt.iconBox),Ct=dn.box.length>0),Lt=Lt&&dn.offscreen}const uo=ee||Qe.numHorizontalGlyphVertices===0&&Qe.numVerticalGlyphVertices===0,$o=se||Qe.numIconVertices===0;if(uo||$o?$o?uo||(Ct=Ct&&Ft):Ft=Ct&&Ft:Ct=Ft=Ct&&Ft,Ft&&Ki&&Ki.box&&this.collisionIndex.insertCollisionBox(Ki.box,J,b.get("text-ignore-placement"),m.bucketInstanceId,dr&&dr.box&&Jn?Jn:pi,te.ID),Ct&&dn&&this.collisionIndex.insertCollisionBox(dn.box,Ee,b.get("icon-ignore-placement"),m.bucketInstanceId,Qn,te.ID),Ui&&(Ft&&this.collisionIndex.insertCollisionCircles(Ui.circles,J,b.get("text-ignore-placement"),m.bucketInstanceId,pi,te.ID),p)){const vr=m.bucketInstanceId;let fr=this.collisionCircleArrays[vr];fr===void 0&&(fr=this.collisionCircleArrays[vr]=new Ne);for(let Ir=0;Ir<Ui.circles.length;Ir+=4)fr.circles.push(Ui.circles[Ir+0]),fr.circles.push(Ui.circles[Ir+1]),fr.circles.push(Ui.circles[Ir+2]),fr.circles.push(Ui.collisionDetected?1:0)}if(Qe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Qe.crossTileID]=new De(Ft||We,Ct||Ve,Lt||m.justReloaded),d[Qe.crossTileID]=!0};if(Le){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Qe=m.getSortedSymbolIndexes(this.transform.angle);for(let Tt=Qe.length-1;Tt>=0;--Tt){const ft=Qe[Tt];Nt(m.symbolInstances.get(ft),m.collisionArrays[ft])}}else for(let Qe=o.symbolInstanceStart;Qe<o.symbolInstanceEnd;Qe++)Nt(m.symbolInstances.get(Qe),m.collisionArrays[Qe]);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const Qe=this.collisionCircleArrays[m.bucketInstanceId];a.as(Qe.invProjMatrix,A),Qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(o,d,p,m){let b;b=m===a.ai.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.at(d)];const A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const I of A)I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=b>=0&&I!==b?0:p.crossTileID)}markUsedOrientation(o,d,p){const m=d===a.ai.horizontal||d===a.ai.horizontalOnly?d:0,b=d===a.ai.vertical?d:0,A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const I of A)o.text.placedSymbolArray.get(I).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let p=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const m=d?d.symbolFadeChange(o):1,b=d?d.opacities:{},A=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(const R in this.placements){const O=this.placements[R],D=b[R];D?(this.opacities[R]=new ye(D,m,O.text,O.icon),p=p||O.text!==D.text.placed||O.icon!==D.icon.placed):(this.opacities[R]=new ye(null,m,O.text,O.icon,O.skipFade),p=p||O.text||O.icon)}for(const R in b){const O=b[R];if(!this.opacities[R]){const D=new ye(O,m,!1,!1);D.isHidden()||(this.opacities[R]=D,p=p||O.text.placed||O.icon.placed)}}for(const R in A)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=A[R]);for(const R in I)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=I[R]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d){const p={};for(const m of d){const b=m.getBucket(o);b&&m.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,p,m.collisionBoxArray)}}updateBucketOpacities(o,d,p){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const m=o.layers[0],b=m.layout,A=new ye(null,0,!1,!1,!0),I=b.get("text-allow-overlap"),R=b.get("icon-allow-overlap"),O=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=b.get("text-rotation-alignment")==="map",N=b.get("text-pitch-alignment")==="map",$=b.get("icon-text-fit")!=="none",te=new ye(null,0,I&&(R||!o.hasIconData()||b.get("icon-optional")),R&&(I||!o.hasTextData()||b.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const ee=(se,J,me)=>{for(let Ee=0;Ee<J/4;Ee++)se.opacityVertexArray.emplaceBack(me);se.hasVisibleVertices=se.hasVisibleVertices||me!==Br};for(let se=0;se<o.symbolInstances.length;se++){const J=o.symbolInstances.get(se),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:Ee,crossTileID:ce}=J;let xe=this.opacities[ce];d[ce]?xe=A:xe||(xe=te,this.opacities[ce]=xe),d[ce]=!0;const Ie=J.numIconVertices>0,Re=this.placedOrientations[J.crossTileID],Le=Re===a.ai.vertical,We=Re===a.ai.horizontal||Re===a.ai.horizontalOnly;if(me>0||Ee>0){const Ve=Zi(xe.text);ee(o.text,me,Le?Br:Ve),ee(o.text,Ee,We?Br:Ve);const Xe=xe.text.isHidden();[J.rightJustifiedTextSymbolIndex,J.centerJustifiedTextSymbolIndex,J.leftJustifiedTextSymbolIndex].forEach(Qe=>{Qe>=0&&(o.text.placedSymbolArray.get(Qe).hidden=Xe||Le?1:0)}),J.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(J.verticalPlacedTextSymbolIndex).hidden=Xe||We?1:0);const ht=this.variableOffsets[J.crossTileID];ht&&this.markUsedJustification(o,ht.anchor,J,Re);const Nt=this.placedOrientations[J.crossTileID];Nt&&(this.markUsedJustification(o,"left",J,Nt),this.markUsedOrientation(o,Nt,J))}if(Ie){const Ve=Zi(xe.icon),Xe=!($&&J.verticalPlacedIconSymbolIndex&&Le);J.placedIconSymbolIndex>=0&&(ee(o.icon,J.numIconVertices,Xe?Ve:Br),o.icon.placedSymbolArray.get(J.placedIconSymbolIndex).hidden=xe.icon.isHidden()),J.verticalPlacedIconSymbolIndex>=0&&(ee(o.icon,J.numVerticalIconVertices,Xe?Br:Ve),o.icon.placedSymbolArray.get(J.verticalPlacedIconSymbolIndex).hidden=xe.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ve=o.collisionArrays[se];if(Ve){let Xe=new a.P(0,0);if(Ve.textBox||Ve.verticalTextBox){let Nt=!0;if(O){const Qe=this.variableOffsets[ce];Qe?(Xe=St(Qe.anchor,Qe.width,Qe.height,Qe.textOffset,Qe.textBoxScale),D&&Xe._rotate(N?this.transform.angle:-this.transform.angle)):Nt=!1}Ve.textBox&&Et(o.textCollisionBox.collisionVertexArray,xe.text.placed,!Nt||Le,Xe.x,Xe.y),Ve.verticalTextBox&&Et(o.textCollisionBox.collisionVertexArray,xe.text.placed,!Nt||We,Xe.x,Xe.y)}const ht=!!(!We&&Ve.verticalIconBox);Ve.iconBox&&Et(o.iconCollisionBox.collisionVertexArray,xe.icon.placed,ht,$?Xe.x:0,$?Xe.y:0),Ve.verticalIconBox&&Et(o.iconCollisionBox.collisionVertexArray,xe.icon.placed,!ht,$?Xe.x:0,$?Xe.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=se.invProjMatrix,o.placementViewportMatrix=se.viewportMatrix,o.collisionCircleArray=se.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const p=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function Et(x,o,d,p,m){x.emplaceBack(o?1:0,d?1:0,p||0,m||0),x.emplaceBack(o?1:0,d?1:0,p||0,m||0),x.emplaceBack(o?1:0,d?1:0,p||0,m||0),x.emplaceBack(o?1:0,d?1:0,p||0,m||0)}const Ht=Math.pow(2,25),qt=Math.pow(2,24),Rt=Math.pow(2,17),Mt=Math.pow(2,16),ki=Math.pow(2,9),Kt=Math.pow(2,8),Ti=Math.pow(2,1);function Zi(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const o=x.placed?1:0,d=Math.floor(127*x.opacity);return d*Ht+o*qt+d*Rt+o*Mt+d*ki+o*Kt+d*Ti+o}const Br=0;class io{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,d,p,m,b){const A=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(A,m,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((I,R)=>I.sortKey-R.sortKey));this._currentPartIndex<A.length;)if(d.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class Yi{constructor(o,d,p,m,b,A,I,R){this.placement=new xt(o,d,A,I,R),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(o,d,p){const m=a.h.now(),b=()=>!this._forceFullPlacement&&a.h.now()-m>2;for(;this._currentPlacementIndex>=0;){const A=d[o[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=I)&&(!A.maxzoom||A.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new io(A)),this._inProgressLayer.continuePlacement(p[A.source],this.placement,this._showCollisionBoxes,A,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const on=512/a.N/2;class Yn{constructor(o,d,p){this.tileID=o,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let b=0;b<d.length;b++){const A=d.get(b),I=A.key,R=m.get(I);R?R.push(A):m.set(I,[A])}for(const[b,A]of m){const I={positions:A.map(R=>({x:Math.floor(R.anchorX*on),y:Math.floor(R.anchorY*on)})),crossTileIDs:A.map(R=>R.crossTileID)};if(I.positions.length>128){const R=new a.av(I.positions.length,16,Uint16Array);for(const{x:O,y:D}of I.positions)R.add(O,D);R.finish(),delete I.positions,I.index=R}this._symbolsByKey[b]=I}}getScaledCoordinates(o,d){const{x:p,y:m,z:b}=this.tileID.canonical,{x:A,y:I,z:R}=d.canonical,O=on/Math.pow(2,R-b),D=(I*a.N+o.anchorY)*O,N=m*a.N*on;return{x:Math.floor((A*a.N+o.anchorX)*O-p*a.N*on),y:Math.floor(D-N)}}findMatches(o,d,p){const m=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let b=0;b<o.length;b++){const A=o.get(b);if(A.crossTileID)continue;const I=this._symbolsByKey[A.key];if(!I)continue;const R=this.getScaledCoordinates(A,d);if(I.index){const O=I.index.range(R.x-m,R.y-m,R.x+m,R.y+m).sort();for(const D of O){const N=I.crossTileIDs[D];if(!p[N]){p[N]=!0,A.crossTileID=N;break}}}else if(I.positions)for(let O=0;O<I.positions.length;O++){const D=I.positions[O],N=I.crossTileIDs[O];if(Math.abs(D.x-R.x)<=m&&Math.abs(D.y-R.y)<=m&&!p[N]){p[N]=!0,A.crossTileID=N;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Dt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ps{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const p in this.indexes){const m=this.indexes[p],b={};for(const A in m){const I=m[A];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),b[I.tileID.key]=I}this.indexes[p]=b}this.lng=o}addBucket(o,d,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<d.symbolInstances.length;b++)d.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const m=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const A=this.indexes[b];if(Number(b)>o.overscaledZ)for(const I in A){const R=A[I];R.tileID.isChildOf(o)&&R.findMatches(d.symbolInstances,o,m)}else{const I=A[o.scaledTo(Number(b)).key];I&&I.findMatches(d.symbolInstances,o,m)}}for(let b=0;b<d.symbolInstances.length;b++){const A=d.symbolInstances.get(b);A.crossTileID||(A.crossTileID=p.generate(),m[A.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Yn(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const p of d.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[o][m]}removeStaleBuckets(o){let d=!1;for(const p in this.indexes){const m=this.indexes[p];for(const b in m)o[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[b]),delete m[b],d=!0)}return d}}class Ar{constructor(){this.layerIndexes={},this.crossTileIDs=new Dt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,p){let m=this.layerIndexes[o.id];m===void 0&&(m=this.layerIndexes[o.id]=new ps);let b=!1;const A={};m.handleWrapJump(p);for(const I of d){const R=I.getBucket(o);R&&o.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(I.tileID,R,this.crossTileIDs)&&(b=!0),A[R.bucketInstanceId]=!0)}return m.removeStaleBuckets(A)&&(b=!0),b}pruneUnusedLayers(o){const d={};o.forEach(p=>{d[p]=!0});for(const p in this.layerIndexes)d[p]||delete this.layerIndexes[p]}}const di=(x,o)=>a.x(x,o&&o.filter(d=>d.identifier!=="source.canvas")),xr=a.F(a.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),fl=a.F(a.ax,["setCenter","setZoom","setBearing","setPitch"]),ur=a.aw();class ri extends a.E{constructor(o,d={}){super(),this.map=o,this.dispatcher=new eo(to(),this,o._getMapId()),this.imageManager=new tt,this.imageManager.setEventedParent(this),this.glyphManager=new rn(o._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Co(256,512),this.crossTileSymbolIndex=new Ar,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.az());const p=this;this._rtlTextPluginCallback=ri.registerForPluginStateChange(m=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(b,A)=>{if(a.aA(b),A&&A.every(I=>I))for(const I in p.sourceCaches){const R=p.sourceCaches[I].getSource().type;R!=="vector"&&R!=="geojson"||p.sourceCaches[I].reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const b=this.sourceCaches[m.sourceId];if(!b)return;const A=b.getSource();if(A&&A.vectorLayerIds)for(const I in this._layers){const R=this._layers[I];R.source===A.id&&this._validateLayer(R)}})}loadURL(o,d={},p){this.fire(new a.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const m=this.map._requestManager.transformRequest(o,G.Style);this._request=a.f(m,(b,A)=>{this._request=null,b?this.fire(new a.j(b)):A&&this._load(A,d,p)})}loadJSON(o,d={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._request=a.h.frame(()=>{this._request=null,d.validate=d.validate!==!1,this._load(o,d,p)})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(ur,{validate:!1})}_load(o,d,p){var m;const b=d.transformStyle?d.transformStyle(p,o):o;if(!d.validate||!di(this,a.y(b))){this._loaded=!0,this.stylesheet=b;for(const A in b.sources)this.addSource(A,b.sources[A],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new ks(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const o=a.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",o),this._order=o.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of o){const p=a.aC(d);p.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=p}}_loadSprite(o,d=!1,p=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(m,b,A,I){const R=ke(m),O=R.length,D=A>1?"@2x":"",N={},$={},te={};for(const{id:ee,url:se}of R){const J=b.transformRequest(b.normalizeSpriteURL(se,D,".json"),G.SpriteJSON),me=`${ee}_${J.url}`;N[me]=a.f(J,(xe,Ie)=>{delete N[me],$[ee]=Ie,je(I,$,te,xe,O)});const Ee=b.transformRequest(b.normalizeSpriteURL(se,D,".png"),G.SpriteImage),ce=`${ee}_${Ee.url}`;N[ce]=Z.getImage(Ee,(xe,Ie)=>{delete N[ce],te[ee]=Ie,je(I,$,te,xe,O)})}return{cancel(){for(const ee of Object.values(N))ee.cancel()}}}(o,this.map._requestManager,this.map.getPixelRatio(),(m,b)=>{if(this._spriteRequest=null,m)this.fire(new a.j(m));else if(b)for(const A in b){this._spritesImagesIds[A]=[];const I=this._spritesImagesIds[A]?this._spritesImagesIds[A].filter(R=>!(R in b)):[];for(const R of I)this.imageManager.removeImage(R),this._changedImages[R]=!0;for(const R in b[A]){const O=A==="default"?R:`${A}:${R}`;this._spritesImagesIds[A].push(O),O in this.imageManager.images?this.imageManager.updateImage(O,b[A][R],!1):this.imageManager.addImage(O,b[A][R]),d&&(this._changedImages[O]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(o){const d=this.sourceCaches[o.source];if(!d)return;const p=o.sourceLayer;if(!p)return;const m=d.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o){const d=this._serializedAllLayers();if(!o||o.length===0)return Object.values(d);const p=[];for(const m of o)d[m]&&p.push(d[m]);return p}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const d=Object.keys(this._layers);for(const p of d){const m=this._layers[p];m.type!=="custom"&&(o[p]=m.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const d=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const A in this._updatedSources){const I=this._updatedSources[A];if(I==="reload")this._reloadSource(A);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(A)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];p[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in p){const b=this.sourceCaches[m];p[m]!==b.used&&b.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(o),this.z=o.zoom,d&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(o),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,d={}){this._checkLoaded();const p=this.serialize();if(o=d.transformStyle?d.transformStyle(p,o):o,di(this,a.y(o)))return!1;(o=a.aD(o)).layers=a.aB(o.layers);const m=a.aE(p,o).filter(A=>!(A.command in fl));if(m.length===0)return!1;const b=m.filter(A=>!(A.command in xr));if(b.length>0)throw new Error(`Unimplemented: ${b.map(A=>A.command).join(", ")}.`);for(const A of m)A.command!=="setTransition"&&this[A.command].apply(this,A.args);return this.stylesheet=o,this._serializedLayers=null,!0}addImage(o,d){if(this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,d),this._afterImageUpdated(o)}updateImage(o,d){this.imageManager.updateImage(o,d)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,d,p={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(a.y.source,`sources.${o}`,d,null,p))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const m=this.sourceCaches[o]=new ui(o,d,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:o})),m.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new a.j(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const d=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],d.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,d){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(d),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,d,p={}){this._checkLoaded();const m=o.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let b;if(o.type==="custom"){if(di(this,a.aF(o)))return;b=a.aC(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(m,o.source),o=a.aD(o),o=a.e(o,{source:m})),this._validate(a.y.layer,`layers.${m}`,o,{arrayIndex:-1},p))return;b=a.aC(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const A=d?this._order.indexOf(d):this._order.length;if(d&&A===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${d}".`)));else{if(this._order.splice(A,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const I=this._removedLayers[m];delete this._removedLayers[m],I.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(o,d){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new a.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===d)return;const p=this._order.indexOf(o);this._order.splice(p,1);const m=d?this._order.indexOf(d):this._order.length;d&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${o}" before non-existing layer "${d}".`))):(this._order.splice(m,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const d=this._layers[o];if(!d)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${o}".`)));d.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=d,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],d.onRemove&&d.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,d,p){this._checkLoaded();const m=this.getLayer(o);m?m.minzoom===d&&m.maxzoom===p||(d!=null&&(m.minzoom=d),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,d,p={}){this._checkLoaded();const m=this.getLayer(o);if(m){if(!a.aG(m.filter,d))return d==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.y.filter,`layers.${m.id}.filter`,d,null,p)||(m.filter=a.aD(d),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return a.aD(this.getLayer(o).filter)}setLayoutProperty(o,d,p,m={}){this._checkLoaded();const b=this.getLayer(o);b?a.aG(b.getLayoutProperty(d),p)||(b.setLayoutProperty(d,p,m),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,d){const p=this.getLayer(o);if(p)return p.getLayoutProperty(d);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,d,p,m={}){this._checkLoaded();const b=this.getLayer(o);b?a.aG(b.getPaintProperty(d),p)||(b.setPaintProperty(d,p,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,d){return this.getLayer(o).getPaintProperty(d)}setFeatureState(o,d){this._checkLoaded();const p=o.source,m=o.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const A=b.getSource().type;A==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):A!=="vector"||m?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,o.id,d)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,d){this._checkLoaded();const p=o.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const b=m.getSource().type,A=b==="vector"?o.sourceLayer:void 0;b!=="vector"||A?d&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(A,o.id,d):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const d=o.source,p=o.sourceLayer,m=this.sourceCaches[d];if(m!==void 0)return m.getSource().type!=="vector"||p?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,o.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=a.aH(this.sourceCaches,b=>b.serialize()),d=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aI({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:o,layers:d,terrain:p},b=>b!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const d=A=>this._layers[A].type==="fill-extrusion",p={},m=[];for(let A=this._order.length-1;A>=0;A--){const I=this._order[A];if(d(I)){p[I]=A;for(const R of o){const O=R[I];if(O)for(const D of O)m.push(D)}}}m.sort((A,I)=>I.intersectionZ-A.intersectionZ);const b=[];for(let A=this._order.length-1;A>=0;A--){const I=this._order[A];if(d(I))for(let R=m.length-1;R>=0;R--){const O=m[R].feature;if(p[O.layer.id]<A)break;b.push(O),m.pop()}else for(const R of o){const O=R[I];if(O)for(const D of O)b.push(D.feature)}}return b}queryRenderedFeatures(o,d,p){d&&d.filter&&this._validate(a.y.filter,"queryRenderedFeatures.filter",d.filter,null,d);const m={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const I of d.layers){const R=this._layers[I];if(!R)return this.fire(new a.j(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];m[R.source]=!0}}const b=[];d.availableImages=this._availableImages;const A=this._serializedAllLayers();for(const I in this.sourceCaches)d.layers&&!m[I]||b.push(or(this.sourceCaches[I],this._layers,A,o,d,p));return this.placement&&b.push(function(I,R,O,D,N,$,te){const ee={},se=$.queryRenderedSymbols(D),J=[];for(const me of Object.keys(se).map(Number))J.push(te[me]);J.sort(yr);for(const me of J){const Ee=me.featureIndex.lookupSymbolFeatures(se[me.bucketInstanceId],R,me.bucketIndex,me.sourceLayerIndex,N.filter,N.layers,N.availableImages,I);for(const ce in Ee){const xe=ee[ce]=ee[ce]||[],Ie=Ee[ce];Ie.sort((Re,Le)=>{const We=me.featureSortOrder;if(We){const Ve=We.indexOf(Re.featureIndex);return We.indexOf(Le.featureIndex)-Ve}return Le.featureIndex-Re.featureIndex});for(const Re of Ie)xe.push(Re)}}for(const me in ee)ee[me].forEach(Ee=>{const ce=Ee.feature,xe=O[I[me].source].getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=xe});return ee}(this._layers,A,this.sourceCaches,o,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,d){d&&d.filter&&this._validate(a.y.filter,"querySourceFeatures.filter",d.filter,null,d);const p=this.sourceCaches[o];return p?function(m,b){const A=m.getRenderableIds().map(O=>m.getTileByID(O)),I=[],R={};for(let O=0;O<A.length;O++){const D=A[O],N=D.tileID.canonical.key;R[N]||(R[N]=!0,D.querySourceFeatures(I,b))}return I}(p,d):[]}addSourceType(o,d,p){return Er(o)?p(new Error(`A source type called "${o}" already exists.`)):(((m,b)=>{Nn[m]=b})(o,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:d.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(o,d={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const A in o)if(!a.aG(o[A],p[A])){m=!0;break}if(!m)return;const b={now:a.h.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,d),this.light.updateTransitions(b)}_validate(o,d,p,m,b={}){return(!b||b.validate!==!1)&&di(this,o.call(a.y,a.e({key:d,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(o=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const p=this.sourceCaches[d];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const d in this.sourceCaches)this.sourceCaches[d].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,d,p,m,b=!1){let A=!1,I=!1;const R={};for(const O of this._order){const D=this._layers[O];if(D.type!=="symbol")continue;if(!R[D.source]){const $=this.sourceCaches[D.source];R[D.source]=$.getRenderableIds(!0).map(te=>$.getTileByID(te)).sort((te,ee)=>ee.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ee.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(D,R[D.source],o.center.lng);A=A||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.h.now(),o.zoom))&&(this.pauseablePlacement=new Yi(o,this.map.terrain,this._order,b,d,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.h.now()),I=!0),A&&this.pauseablePlacement.placement.setStale()),I||A)for(const O of this._order){const D=this._layers[O];D.type==="symbol"&&this.placement.updateLayerOpacities(D,R[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.h.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,d,p){this.imageManager.getImages(d.icons,p),this._updateTilesForChangedImages();const m=this.sourceCaches[d.source];m&&m.setDependencies(d.tileID.key,d.type,d.icons)}getGlyphs(o,d,p){this.glyphManager.getGlyphs(d.stacks,p);const m=this.sourceCaches[d.source];m&&m.setDependencies(d.tileID.key,d.type,[""])}getResource(o,d,p){return a.m(d,p)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,d={}){this._checkLoaded(),o&&this._validate(a.y.glyphs,"glyphs",o,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,d,p={},m){this._checkLoaded();const b=[{id:o,url:d}],A=[...ke(this.stylesheet.sprite),...b];this._validate(a.y.sprite,"sprite",A,null,p)||(this.stylesheet.sprite=A,this._loadSprite(b,!0,m))}removeSprite(o){this._checkLoaded();const d=ke(this.stylesheet.sprite);if(d.find(p=>p.id===o)){if(this._spritesImagesIds[o])for(const p of this._spritesImagesIds[o])this.imageManager.removeImage(p),this._changedImages[p]=!0;d.splice(d.findIndex(p=>p.id===o),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return ke(this.stylesheet.sprite)}setSprite(o,d={},p){this._checkLoaded(),o&&this._validate(a.y.sprite,"sprite",o,null,d)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,p):(this._unloadSprite(),p&&p(null)))}}ri.registerForPluginStateChange=a.aK;var gs=a.Q([{name:"a_pos",type:"Int16",components:2}]),Kn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ai={prelude:$t(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:$t(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:$t(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:$t(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:$t("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$t(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:$t(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:$t("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:$t("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:$t("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:$t(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:$t(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:$t(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:$t(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:$t(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$t(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:$t(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:$t(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:$t(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:$t(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:$t(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:$t(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:$t(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:$t("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Kn),terrainDepth:$t("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Kn),terrainCoords:$t("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Kn)};function $t(x,o){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute ([\w]+) ([\w]+)/g),m=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=b?b.concat(m):m,I={};return{fragmentSource:x=x.replace(d,(R,O,D,N,$)=>(I[$]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${D} ${N} ${$};
#else
uniform ${D} ${N} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${D} ${N} ${$} = u_${$};
#endif
`)),vertexSource:o=o.replace(d,(R,O,D,N,$)=>{const te=N==="float"?"vec2":"vec4",ee=$.match(/color/)?"color":te;return I[$]?O==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${D} ${te} a_${$};
varying ${D} ${N} ${$};
#else
uniform ${D} ${N} u_${$};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${D} ${N} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${ee}(a_${$}, u_${$}_t);
#else
    ${D} ${N} ${$} = u_${$};
#endif
`:O==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${D} ${te} a_${$};
#else
uniform ${D} ${N} u_${$};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${D} ${N} ${$} = a_${$};
#else
    ${D} ${N} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${D} ${N} ${$} = unpack_mix_${ee}(a_${$}, u_${$}_t);
#else
    ${D} ${N} ${$} = u_${$};
#endif
`}),staticAttributes:p,staticUniforms:A}}class Un{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,d,p,m,b,A,I,R,O){this.context=o;let D=this.boundPaintVertexBuffers.length!==m.length;for(let N=0;!D&&N<m.length;N++)this.boundPaintVertexBuffers[N]!==m[N]&&(D=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==p||D||this.boundIndexBuffer!==b||this.boundVertexOffset!==A||this.boundDynamicVertexBuffer!==I||this.boundDynamicVertexBuffer2!==R||this.boundDynamicVertexBuffer3!==O?this.freshBind(d,p,m,b,A,I,R,O):(o.bindVertexArray.set(this.vao),I&&I.bind(),b&&b.dynamicDraw&&b.bind(),R&&R.bind(),O&&O.bind())}freshBind(o,d,p,m,b,A,I,R){const O=o.numAttributes,D=this.context,N=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=R,d.enableAttributes(N,o);for(const $ of p)$.enableAttributes(N,o);A&&A.enableAttributes(N,o),I&&I.enableAttributes(N,o),R&&R.enableAttributes(N,o),d.bind(),d.setVertexAttribPointers(N,o,b);for(const $ of p)$.bind(),$.setVertexAttribPointers(N,o,b);A&&(A.bind(),A.setVertexAttribPointers(N,o,b)),m&&m.bind(),I&&(I.bind(),I.setVertexAttribPointers(N,o,b)),R&&(R.bind(),R.setVertexAttribPointers(N,o,b)),D.currentNumAttributes=O}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function li(x){const o=[];for(let d=0;d<x.length;d++){if(x[d]===null)continue;const p=x[d].split(" ");o.push(p.pop())}return o}class zr{constructor(o,d,p,m,b,A){const I=o.gl;this.program=I.createProgram();const R=li(d.staticAttributes),O=p?p.getBinderAttributes():[],D=R.concat(O),N=ai.prelude.staticUniforms?li(ai.prelude.staticUniforms):[],$=d.staticUniforms?li(d.staticUniforms):[],te=p?p.getBinderUniforms():[],ee=N.concat($).concat(te),se=[];for(const Re of ee)se.indexOf(Re)<0&&se.push(Re);const J=p?p.defines():[];b&&J.push("#define OVERDRAW_INSPECTOR;"),A&&J.push("#define TERRAIN3D;");const me=J.concat(ai.prelude.fragmentSource,d.fragmentSource).join(`
`),Ee=J.concat(ai.prelude.vertexSource,d.vertexSource).join(`
`),ce=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(ce,me),I.compileShader(ce),!I.getShaderParameter(ce,I.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${I.getShaderInfoLog(ce)}`);I.attachShader(this.program,ce);const xe=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(xe,Ee),I.compileShader(xe),!I.getShaderParameter(xe,I.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${I.getShaderInfoLog(xe)}`);I.attachShader(this.program,xe),this.attributes={};const Ie={};this.numAttributes=D.length;for(let Re=0;Re<this.numAttributes;Re++)D[Re]&&(I.bindAttribLocation(this.program,Re,D[Re]),this.attributes[D[Re]]=Re);if(I.linkProgram(this.program),!I.getProgramParameter(this.program,I.LINK_STATUS))throw new Error(`Program failed to link: ${I.getProgramInfoLog(this.program)}`);I.deleteShader(xe),I.deleteShader(ce);for(let Re=0;Re<se.length;Re++){const Le=se[Re];if(Le&&!Ie[Le]){const We=I.getUniformLocation(this.program,Le);We&&(Ie[Le]=We)}}this.fixedUniforms=m(o,Ie),this.terrainUniforms=((Re,Le)=>({u_depth:new a.aL(Re,Le.u_depth),u_terrain:new a.aL(Re,Le.u_terrain),u_terrain_dim:new a.aM(Re,Le.u_terrain_dim),u_terrain_matrix:new a.aN(Re,Le.u_terrain_matrix),u_terrain_unpack:new a.aO(Re,Le.u_terrain_unpack),u_terrain_exaggeration:new a.aM(Re,Le.u_terrain_exaggeration)}))(o,Ie),this.binderUniforms=p?p.getUniforms(o,Ie):[]}draw(o,d,p,m,b,A,I,R,O,D,N,$,te,ee,se,J,me,Ee){const ce=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(m),o.setColorMode(b),o.setCullFace(A),R){o.activeTexture.set(ce.TEXTURE2),ce.bindTexture(ce.TEXTURE_2D,R.depthTexture),o.activeTexture.set(ce.TEXTURE3),ce.bindTexture(ce.TEXTURE_2D,R.texture);for(const Ie in this.terrainUniforms)this.terrainUniforms[Ie].set(R[Ie])}for(const Ie in this.fixedUniforms)this.fixedUniforms[Ie].set(I[Ie]);se&&se.setUniforms(o,this.binderUniforms,te,{zoom:ee});let xe=0;switch(d){case ce.LINES:xe=2;break;case ce.TRIANGLES:xe=3;break;case ce.LINE_STRIP:xe=1}for(const Ie of $.get()){const Re=Ie.vaos||(Ie.vaos={});(Re[O]||(Re[O]=new Un)).bind(o,this,D,se?se.getPaintVertexBuffers():[],N,Ie.vertexOffset,J,me,Ee),ce.drawElements(d,Ie.primitiveLength*xe,ce.UNSIGNED_SHORT,Ie.primitiveOffset*xe*2)}}}function Ur(x,o,d){const p=1/_e(d,1,o.transform.tileZoom),m=Math.pow(2,d.tileID.overscaledZ),b=d.tileSize*Math.pow(2,o.transform.tileZoom)/m,A=b*(d.tileID.canonical.x+d.tileID.wrap*m),I=b*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[p,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[A>>16,I>>16],u_pixel_coord_lower:[65535&A,65535&I]}}const Ro=(x,o,d,p)=>{const m=o.style.light,b=m.properties.get("position"),A=[b.x,b.y,b.z],I=function(){var O=new a.A(9);return a.A!=Float32Array&&(O[1]=0,O[2]=0,O[3]=0,O[5]=0,O[6]=0,O[7]=0),O[0]=1,O[4]=1,O[8]=1,O}();m.properties.get("anchor")==="viewport"&&function(O,D){var N=Math.sin(D),$=Math.cos(D);O[0]=$,O[1]=N,O[2]=0,O[3]=-N,O[4]=$,O[5]=0,O[6]=0,O[7]=0,O[8]=1}(I,-o.transform.angle),function(O,D,N){var $=D[0],te=D[1],ee=D[2];O[0]=$*N[0]+te*N[3]+ee*N[6],O[1]=$*N[1]+te*N[4]+ee*N[7],O[2]=$*N[2]+te*N[5]+ee*N[8]}(A,A,I);const R=m.properties.get("color");return{u_matrix:x,u_lightpos:A,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+d,u_opacity:p}},In=(x,o,d,p,m,b,A)=>a.e(Ro(x,o,d,p),Ur(b,o,A),{u_height_factor:-Math.pow(2,m.overscaledZ)/A.tileSize/8}),ba=x=>({u_matrix:x}),wa=(x,o,d,p)=>a.e(ba(x),Ur(d,o,p)),Mo=(x,o)=>({u_matrix:x,u_world:o}),X=(x,o,d,p,m)=>a.e(wa(x,o,d,p),{u_world:m}),K=(x,o,d,p)=>{const m=x.transform;let b,A;if(p.paint.get("circle-pitch-alignment")==="map"){const I=_e(d,1,m.zoom);b=!0,A=[I,I]}else b=!1,A=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:x.translatePosMatrix(o.posMatrix,d,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:A}},pe=(x,o,d)=>{const p=_e(d,1,o.zoom),m=Math.pow(2,o.zoom-d.tileID.overscaledZ),b=d.tileID.overscaleFactor();return{u_matrix:x,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[o.pixelsToGLUnits[0]/(p*m),o.pixelsToGLUnits[1]/(p*m)],u_overscale_factor:b}},Ce=(x,o,d=1)=>({u_matrix:x,u_color:o,u_overlay:0,u_overlay_scale:d}),qe=x=>({u_matrix:x}),ut=(x,o,d,p)=>({u_matrix:x,u_extrude_scale:_e(o,1,d),u_intensity:p});function Ot(x,o){const d=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new a.U(0,p/d).toLngLat().lat,new a.U(0,(p+1)/d).toLngLat().lat]}const Oi=(x,o,d,p)=>{const m=x.transform;return{u_matrix:pl(x,o,d,p),u_ratio:1/_e(o,1,m.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Wi=(x,o,d,p,m)=>a.e(Oi(x,o,d,m),{u_image:0,u_image_height:p}),hr=(x,o,d,p,m)=>{const b=x.transform,A=Yh(o,b);return{u_matrix:pl(x,o,d,m),u_texsize:o.imageAtlasTexture.size,u_ratio:1/_e(o,1,b.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[A,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},an=(x,o,d,p,m,b)=>{const A=x.lineAtlas,I=Yh(o,x.transform),R=d.layout.get("line-cap")==="round",O=A.getDash(p.from,R),D=A.getDash(p.to,R),N=O.width*m.fromScale,$=D.width*m.toScale;return a.e(Oi(x,o,d,b),{u_patternscale_a:[I/N,-O.height/2],u_patternscale_b:[I/$,-D.height/2],u_sdfgamma:A.width/(256*Math.min(N,$)*x.pixelRatio)/2,u_image:0,u_tex_y_a:O.y,u_tex_y_b:D.y,u_mix:m.t})};function Yh(x,o){return 1/_e(x,1,o.tileZoom)}function pl(x,o,d,p){return x.translatePosMatrix(p?p.posMatrix:o.tileID.posMatrix,o,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Kh=(x,o,d,p,m)=>{return{u_matrix:x,u_tl_parent:o,u_scale_parent:d,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(A=m.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Gh(m.paint.get("raster-hue-rotate"))};var b,A};function Gh(x){x*=Math.PI/180;const o=Math.sin(x),d=Math.cos(x);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const Vc=(x,o,d,p,m,b,A,I,R,O)=>{const D=m.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:D.cameraToCenterDistance,u_pitch:D.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:D.width/D.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:A,u_coord_matrix:I,u_is_text:+R,u_pitch_with_map:+p,u_texsize:O,u_texture:0}},$c=(x,o,d,p,m,b,A,I,R,O,D)=>{const N=m.transform;return a.e(Vc(x,o,d,p,m,b,A,I,R,O),{u_gamma_scale:p?Math.cos(N._pitch)*N.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+D})},ro=(x,o,d,p,m,b,A,I,R,O)=>a.e($c(x,o,d,p,m,b,A,I,!0,R,!0),{u_texsize_icon:O,u_texture_icon:1}),gl=(x,o,d)=>({u_matrix:x,u_opacity:o,u_color:d}),Cn=(x,o,d,p,m,b)=>a.e(function(A,I,R,O){const D=R.imageManager.getPattern(A.from.toString()),N=R.imageManager.getPattern(A.to.toString()),{width:$,height:te}=R.imageManager.getPixelSize(),ee=Math.pow(2,O.tileID.overscaledZ),se=O.tileSize*Math.pow(2,R.transform.tileZoom)/ee,J=se*(O.tileID.canonical.x+O.tileID.wrap*ee),me=se*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[$,te],u_mix:I.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/_e(O,1,R.transform.tileZoom),u_pixel_coord_upper:[J>>16,me>>16],u_pixel_coord_lower:[65535&J,65535&me]}}(p,b,d,m),{u_matrix:x,u_opacity:o}),_l={fillExtrusion:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_lightpos:new a.aP(x,o.u_lightpos),u_lightintensity:new a.aM(x,o.u_lightintensity),u_lightcolor:new a.aP(x,o.u_lightcolor),u_vertical_gradient:new a.aM(x,o.u_vertical_gradient),u_opacity:new a.aM(x,o.u_opacity)}),fillExtrusionPattern:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_lightpos:new a.aP(x,o.u_lightpos),u_lightintensity:new a.aM(x,o.u_lightintensity),u_lightcolor:new a.aP(x,o.u_lightcolor),u_vertical_gradient:new a.aM(x,o.u_vertical_gradient),u_height_factor:new a.aM(x,o.u_height_factor),u_image:new a.aL(x,o.u_image),u_texsize:new a.aQ(x,o.u_texsize),u_pixel_coord_upper:new a.aQ(x,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(x,o.u_pixel_coord_lower),u_scale:new a.aP(x,o.u_scale),u_fade:new a.aM(x,o.u_fade),u_opacity:new a.aM(x,o.u_opacity)}),fill:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix)}),fillPattern:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_image:new a.aL(x,o.u_image),u_texsize:new a.aQ(x,o.u_texsize),u_pixel_coord_upper:new a.aQ(x,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(x,o.u_pixel_coord_lower),u_scale:new a.aP(x,o.u_scale),u_fade:new a.aM(x,o.u_fade)}),fillOutline:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_world:new a.aQ(x,o.u_world)}),fillOutlinePattern:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_world:new a.aQ(x,o.u_world),u_image:new a.aL(x,o.u_image),u_texsize:new a.aQ(x,o.u_texsize),u_pixel_coord_upper:new a.aQ(x,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(x,o.u_pixel_coord_lower),u_scale:new a.aP(x,o.u_scale),u_fade:new a.aM(x,o.u_fade)}),circle:(x,o)=>({u_camera_to_center_distance:new a.aM(x,o.u_camera_to_center_distance),u_scale_with_map:new a.aL(x,o.u_scale_with_map),u_pitch_with_map:new a.aL(x,o.u_pitch_with_map),u_extrude_scale:new a.aQ(x,o.u_extrude_scale),u_device_pixel_ratio:new a.aM(x,o.u_device_pixel_ratio),u_matrix:new a.aN(x,o.u_matrix)}),collisionBox:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_camera_to_center_distance:new a.aM(x,o.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aM(x,o.u_pixels_to_tile_units),u_extrude_scale:new a.aQ(x,o.u_extrude_scale),u_overscale_factor:new a.aM(x,o.u_overscale_factor)}),collisionCircle:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_inv_matrix:new a.aN(x,o.u_inv_matrix),u_camera_to_center_distance:new a.aM(x,o.u_camera_to_center_distance),u_viewport_size:new a.aQ(x,o.u_viewport_size)}),debug:(x,o)=>({u_color:new a.aR(x,o.u_color),u_matrix:new a.aN(x,o.u_matrix),u_overlay:new a.aL(x,o.u_overlay),u_overlay_scale:new a.aM(x,o.u_overlay_scale)}),clippingMask:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix)}),heatmap:(x,o)=>({u_extrude_scale:new a.aM(x,o.u_extrude_scale),u_intensity:new a.aM(x,o.u_intensity),u_matrix:new a.aN(x,o.u_matrix)}),heatmapTexture:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_world:new a.aQ(x,o.u_world),u_image:new a.aL(x,o.u_image),u_color_ramp:new a.aL(x,o.u_color_ramp),u_opacity:new a.aM(x,o.u_opacity)}),hillshade:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_image:new a.aL(x,o.u_image),u_latrange:new a.aQ(x,o.u_latrange),u_light:new a.aQ(x,o.u_light),u_shadow:new a.aR(x,o.u_shadow),u_highlight:new a.aR(x,o.u_highlight),u_accent:new a.aR(x,o.u_accent)}),hillshadePrepare:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_image:new a.aL(x,o.u_image),u_dimension:new a.aQ(x,o.u_dimension),u_zoom:new a.aM(x,o.u_zoom),u_unpack:new a.aO(x,o.u_unpack)}),line:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_ratio:new a.aM(x,o.u_ratio),u_device_pixel_ratio:new a.aM(x,o.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(x,o.u_units_to_pixels)}),lineGradient:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_ratio:new a.aM(x,o.u_ratio),u_device_pixel_ratio:new a.aM(x,o.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(x,o.u_units_to_pixels),u_image:new a.aL(x,o.u_image),u_image_height:new a.aM(x,o.u_image_height)}),linePattern:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_texsize:new a.aQ(x,o.u_texsize),u_ratio:new a.aM(x,o.u_ratio),u_device_pixel_ratio:new a.aM(x,o.u_device_pixel_ratio),u_image:new a.aL(x,o.u_image),u_units_to_pixels:new a.aQ(x,o.u_units_to_pixels),u_scale:new a.aP(x,o.u_scale),u_fade:new a.aM(x,o.u_fade)}),lineSDF:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_ratio:new a.aM(x,o.u_ratio),u_device_pixel_ratio:new a.aM(x,o.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(x,o.u_units_to_pixels),u_patternscale_a:new a.aQ(x,o.u_patternscale_a),u_patternscale_b:new a.aQ(x,o.u_patternscale_b),u_sdfgamma:new a.aM(x,o.u_sdfgamma),u_image:new a.aL(x,o.u_image),u_tex_y_a:new a.aM(x,o.u_tex_y_a),u_tex_y_b:new a.aM(x,o.u_tex_y_b),u_mix:new a.aM(x,o.u_mix)}),raster:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_tl_parent:new a.aQ(x,o.u_tl_parent),u_scale_parent:new a.aM(x,o.u_scale_parent),u_buffer_scale:new a.aM(x,o.u_buffer_scale),u_fade_t:new a.aM(x,o.u_fade_t),u_opacity:new a.aM(x,o.u_opacity),u_image0:new a.aL(x,o.u_image0),u_image1:new a.aL(x,o.u_image1),u_brightness_low:new a.aM(x,o.u_brightness_low),u_brightness_high:new a.aM(x,o.u_brightness_high),u_saturation_factor:new a.aM(x,o.u_saturation_factor),u_contrast_factor:new a.aM(x,o.u_contrast_factor),u_spin_weights:new a.aP(x,o.u_spin_weights)}),symbolIcon:(x,o)=>({u_is_size_zoom_constant:new a.aL(x,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(x,o.u_is_size_feature_constant),u_size_t:new a.aM(x,o.u_size_t),u_size:new a.aM(x,o.u_size),u_camera_to_center_distance:new a.aM(x,o.u_camera_to_center_distance),u_pitch:new a.aM(x,o.u_pitch),u_rotate_symbol:new a.aL(x,o.u_rotate_symbol),u_aspect_ratio:new a.aM(x,o.u_aspect_ratio),u_fade_change:new a.aM(x,o.u_fade_change),u_matrix:new a.aN(x,o.u_matrix),u_label_plane_matrix:new a.aN(x,o.u_label_plane_matrix),u_coord_matrix:new a.aN(x,o.u_coord_matrix),u_is_text:new a.aL(x,o.u_is_text),u_pitch_with_map:new a.aL(x,o.u_pitch_with_map),u_texsize:new a.aQ(x,o.u_texsize),u_texture:new a.aL(x,o.u_texture)}),symbolSDF:(x,o)=>({u_is_size_zoom_constant:new a.aL(x,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(x,o.u_is_size_feature_constant),u_size_t:new a.aM(x,o.u_size_t),u_size:new a.aM(x,o.u_size),u_camera_to_center_distance:new a.aM(x,o.u_camera_to_center_distance),u_pitch:new a.aM(x,o.u_pitch),u_rotate_symbol:new a.aL(x,o.u_rotate_symbol),u_aspect_ratio:new a.aM(x,o.u_aspect_ratio),u_fade_change:new a.aM(x,o.u_fade_change),u_matrix:new a.aN(x,o.u_matrix),u_label_plane_matrix:new a.aN(x,o.u_label_plane_matrix),u_coord_matrix:new a.aN(x,o.u_coord_matrix),u_is_text:new a.aL(x,o.u_is_text),u_pitch_with_map:new a.aL(x,o.u_pitch_with_map),u_texsize:new a.aQ(x,o.u_texsize),u_texture:new a.aL(x,o.u_texture),u_gamma_scale:new a.aM(x,o.u_gamma_scale),u_device_pixel_ratio:new a.aM(x,o.u_device_pixel_ratio),u_is_halo:new a.aL(x,o.u_is_halo)}),symbolTextAndIcon:(x,o)=>({u_is_size_zoom_constant:new a.aL(x,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(x,o.u_is_size_feature_constant),u_size_t:new a.aM(x,o.u_size_t),u_size:new a.aM(x,o.u_size),u_camera_to_center_distance:new a.aM(x,o.u_camera_to_center_distance),u_pitch:new a.aM(x,o.u_pitch),u_rotate_symbol:new a.aL(x,o.u_rotate_symbol),u_aspect_ratio:new a.aM(x,o.u_aspect_ratio),u_fade_change:new a.aM(x,o.u_fade_change),u_matrix:new a.aN(x,o.u_matrix),u_label_plane_matrix:new a.aN(x,o.u_label_plane_matrix),u_coord_matrix:new a.aN(x,o.u_coord_matrix),u_is_text:new a.aL(x,o.u_is_text),u_pitch_with_map:new a.aL(x,o.u_pitch_with_map),u_texsize:new a.aQ(x,o.u_texsize),u_texsize_icon:new a.aQ(x,o.u_texsize_icon),u_texture:new a.aL(x,o.u_texture),u_texture_icon:new a.aL(x,o.u_texture_icon),u_gamma_scale:new a.aM(x,o.u_gamma_scale),u_device_pixel_ratio:new a.aM(x,o.u_device_pixel_ratio),u_is_halo:new a.aL(x,o.u_is_halo)}),background:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_opacity:new a.aM(x,o.u_opacity),u_color:new a.aR(x,o.u_color)}),backgroundPattern:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_opacity:new a.aM(x,o.u_opacity),u_image:new a.aL(x,o.u_image),u_pattern_tl_a:new a.aQ(x,o.u_pattern_tl_a),u_pattern_br_a:new a.aQ(x,o.u_pattern_br_a),u_pattern_tl_b:new a.aQ(x,o.u_pattern_tl_b),u_pattern_br_b:new a.aQ(x,o.u_pattern_br_b),u_texsize:new a.aQ(x,o.u_texsize),u_mix:new a.aM(x,o.u_mix),u_pattern_size_a:new a.aQ(x,o.u_pattern_size_a),u_pattern_size_b:new a.aQ(x,o.u_pattern_size_b),u_scale_a:new a.aM(x,o.u_scale_a),u_scale_b:new a.aM(x,o.u_scale_b),u_pixel_coord_upper:new a.aQ(x,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(x,o.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aM(x,o.u_tile_units_to_pixels)}),terrain:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_texture:new a.aL(x,o.u_texture),u_ele_delta:new a.aM(x,o.u_ele_delta)}),terrainDepth:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_ele_delta:new a.aM(x,o.u_ele_delta)}),terrainCoords:(x,o)=>({u_matrix:new a.aN(x,o.u_matrix),u_texture:new a.aL(x,o.u_texture),u_terrain_coords_id:new a.aM(x,o.u_terrain_coords_id),u_ele_delta:new a.aM(x,o.u_ele_delta)})};class ml{constructor(o,d,p){this.context=o;const m=o.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ta={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yl{constructor(o,d,p,m){this.length=d.length,this.attributes=p,this.itemSize=d.bytesPerElement,this.dynamicDraw=m,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let p=0;p<this.attributes.length;p++){const m=d.attributes[this.attributes[p].name];m!==void 0&&o.enableVertexAttribArray(m)}}setVertexAttribPointers(o,d,p){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],A=d.attributes[b.name];A!==void 0&&o.vertexAttribPointer(A,b.components,o[Ta[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ko=new WeakMap;function Ds(x){var o;if(ko.has(x))return ko.get(x);{const d=(o=x.getParameter(x.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return ko.set(x,d),d}}class zt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xl extends zt{getDefault(){return a.aT.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ln extends zt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class cn extends zt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class jc extends zt{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class vl extends zt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class bl extends zt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Wc extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Hc extends zt{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class wl extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class qc extends zt{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Xc extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class Tl extends zt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Jh extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class Qh extends zt{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Oo extends zt{getDefault(){return a.aT.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class pg extends zt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class gg extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class _g extends zt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class mg extends zt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class yg extends zt{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class xg extends zt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Zc extends zt{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Sl extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Yc extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Kc extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Fo extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ed extends zt{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class td extends zt{getDefault(){return null}set(o){var d;if(o===this.current&&!this.dirty)return;const p=this.gl;Ds(p)?p.bindVertexArray(o):(d=p.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Gc extends zt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class no extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class id extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Ns extends zt{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class Do extends Ns{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class rd extends Ns{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Jc extends Ns{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Xt{constructor(o,d,p,m,b){this.context=o,this.width=d,this.height=p;const A=o.gl,I=this.framebuffer=A.createFramebuffer();if(this.colorAttachment=new Do(o,I),m)this.depthAttachment=b?new Jc(o,I):new rd(o,I);else if(b)throw new Error("Stencil cannot be setted without depth");if(A.checkFramebufferStatus(A.FRAMEBUFFER)!==A.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,d=this.colorAttachment.get();if(d&&o.deleteTexture(d),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class Si{constructor(o,d,p){this.blendFunction=o,this.blendColor=d,this.mask=p}}Si.Replace=[1,0],Si.disabled=new Si(Si.Replace,a.aT.transparent,[!1,!1,!1,!1]),Si.unblended=new Si(Si.Replace,a.aT.transparent,[!0,!0,!0,!0]),Si.alphaBlended=new Si([1,771],a.aT.transparent,[!0,!0,!0,!0]);class vg{constructor(o){var d,p;if(this.gl=o,this.clearColor=new xl(this),this.clearDepth=new ln(this),this.clearStencil=new cn(this),this.colorMask=new jc(this),this.depthMask=new vl(this),this.stencilMask=new bl(this),this.stencilFunc=new Wc(this),this.stencilOp=new Hc(this),this.stencilTest=new wl(this),this.depthRange=new qc(this),this.depthTest=new Xc(this),this.depthFunc=new Tl(this),this.blend=new Jh(this),this.blendFunc=new Qh(this),this.blendColor=new Oo(this),this.blendEquation=new pg(this),this.cullFace=new gg(this),this.cullFaceSide=new _g(this),this.frontFace=new mg(this),this.program=new yg(this),this.activeTexture=new xg(this),this.viewport=new Zc(this),this.bindFramebuffer=new Sl(this),this.bindRenderbuffer=new Yc(this),this.bindTexture=new Kc(this),this.bindVertexBuffer=new Fo(this),this.bindElementBuffer=new ed(this),this.bindVertexArray=new td(this),this.pixelStoreUnpack=new Gc(this),this.pixelStoreUnpackPremultiplyAlpha=new no(this),this.pixelStoreUnpackFlipY=new id(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),Ds(o)){this.HALF_FLOAT=o.HALF_FLOAT;const m=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=o.RGBA16F)!==null&&d!==void 0?d:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=o.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const m=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d){return new ml(this,o,d)}createVertexBuffer(o,d,p){return new yl(this,o,d,p)}createRenderbuffer(o,d,p){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,o,d,p),this.bindRenderbuffer.set(null),b}createFramebuffer(o,d,p,m){return new Xt(this,o,d,p,m)}clear({color:o,depth:d,stencil:p}){const m=this.gl;let b=0;o&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),p!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(b)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){a.aG(o.blendFunction,Si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return Ds(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var d;return Ds(this.gl)?this.gl.deleteVertexArray(o):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class Ut{constructor(o,d,p){this.func=o,this.mask=d,this.range=p}}Ut.ReadOnly=!1,Ut.ReadWrite=!0,Ut.disabled=new Ut(519,Ut.ReadOnly,[0,1]);const so=7680;class Ei{constructor(o,d,p,m,b,A){this.test=o,this.ref=d,this.mask=p,this.fail=m,this.depthFail=b,this.pass=A}}Ei.disabled=new Ei({func:519,mask:0},0,0,so,so,so);class vi{constructor(o,d,p){this.enable=o,this.mode=d,this.frontFace=p}}let Sa;function nd(x,o,d,p,m,b,A){const I=x.context,R=I.gl,O=x.useProgram("collisionBox"),D=[];let N=0,$=0;for(let ce=0;ce<p.length;ce++){const xe=p[ce],Ie=o.getTile(xe),Re=Ie.getBucket(d);if(!Re)continue;let Le=xe.posMatrix;m[0]===0&&m[1]===0||(Le=x.translatePosMatrix(xe.posMatrix,Ie,m,b));const We=A?Re.textCollisionBox:Re.iconCollisionBox,Ve=Re.collisionCircleArray;if(Ve.length>0){const Xe=a.Z(),ht=Le;a.aU(Xe,Re.placementInvProjMatrix,x.transform.glCoordMatrix),a.aU(Xe,Xe,Re.placementViewportMatrix),D.push({circleArray:Ve,circleOffset:$,transform:ht,invTransform:Xe,coord:xe}),N+=Ve.length/4,$=N}We&&O.draw(I,R.LINES,Ut.disabled,Ei.disabled,x.colorModeForRenderPass(),vi.disabled,pe(Le,x.transform,Ie),x.style.map.terrain&&x.style.map.terrain.getTerrainData(xe),d.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,x.transform.zoom,null,null,We.collisionVertexBuffer)}if(!A||!D.length)return;const te=x.useProgram("collisionCircle"),ee=new a.aV;ee.resize(4*N),ee._trim();let se=0;for(const ce of D)for(let xe=0;xe<ce.circleArray.length/4;xe++){const Ie=4*xe,Re=ce.circleArray[Ie+0],Le=ce.circleArray[Ie+1],We=ce.circleArray[Ie+2],Ve=ce.circleArray[Ie+3];ee.emplace(se++,Re,Le,We,Ve,0),ee.emplace(se++,Re,Le,We,Ve,1),ee.emplace(se++,Re,Le,We,Ve,2),ee.emplace(se++,Re,Le,We,Ve,3)}(!Sa||Sa.length<2*N)&&(Sa=function(ce){const xe=2*ce,Ie=new a.aX;Ie.resize(xe),Ie._trim();for(let Re=0;Re<xe;Re++){const Le=6*Re;Ie.uint16[Le+0]=4*Re+0,Ie.uint16[Le+1]=4*Re+1,Ie.uint16[Le+2]=4*Re+2,Ie.uint16[Le+3]=4*Re+2,Ie.uint16[Le+4]=4*Re+3,Ie.uint16[Le+5]=4*Re+0}return Ie}(N));const J=I.createIndexBuffer(Sa,!0),me=I.createVertexBuffer(ee,a.aW.members,!0);for(const ce of D){const xe={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(Ee=x.transform).cameraToCenterDistance,u_viewport_size:[Ee.width,Ee.height]};te.draw(I,R.TRIANGLES,Ut.disabled,Ei.disabled,x.colorModeForRenderPass(),vi.disabled,xe,x.style.map.terrain&&x.style.map.terrain.getTerrainData(ce.coord),d.id,me,J,a.S.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,x.transform.zoom,null,null,null)}var Ee;me.destroy(),J.destroy()}vi.disabled=new vi(!1,1029,2305),vi.backCCW=new vi(!0,1029,2305);const Qc=a.ao(new Float32Array(16));function El(x,o,d,p,m,b){const{horizontalAlign:A,verticalAlign:I}=a.au(x);return new a.P((-(A-.5)*o/m+p[0])*b,(-(I-.5)*d/m+p[1])*b)}function Al(x,o,d,p,m,b,A,I,R,O,D){const N=x.text.placedSymbolArray,$=x.text.dynamicLayoutVertexArray,te=x.icon.dynamicLayoutVertexArray,ee={};$.clear();for(let se=0;se<N.length;se++){const J=N.get(se),me=J.hidden||!J.crossTileID||x.allowVerticalPlacement&&!J.placedOrientation?null:p[J.crossTileID];if(me){const Ee=new a.P(J.anchorX,J.anchorY),ce=xi(Ee,d?A:b,D),xe=fs(m.cameraToCenterDistance,ce.signedDistanceFromCamera);let Ie=a.aj(x.textSizeData,R,J)*xe/a.ap;d&&(Ie*=x.tilePixelRatio/I);const{width:Re,height:Le,anchor:We,textOffset:Ve,textBoxScale:Xe}=me,ht=El(We,Re,Le,Ve,Xe,Ie),Nt=d?xi(Ee.add(ht),b,D).point:ce.point.add(o?ht.rotate(-m.angle):ht),Qe=x.allowVerticalPlacement&&J.placedOrientation===a.ai.vertical?Math.PI/2:0;for(let Tt=0;Tt<J.numGlyphs;Tt++)a.ak($,Nt,Qe);O&&J.associatedIconIndex>=0&&(ee[J.associatedIconIndex]={shiftedAnchor:Nt,angle:Qe})}else Y(J.numGlyphs,$)}if(O){te.clear();const se=x.icon.placedSymbolArray;for(let J=0;J<se.length;J++){const me=se.get(J);if(me.hidden)Y(me.numGlyphs,te);else{const Ee=ee[J];if(Ee)for(let ce=0;ce<me.numGlyphs;ce++)a.ak(te,Ee.shiftedAnchor,Ee.angle);else Y(me.numGlyphs,te)}}x.icon.dynamicLayoutVertexBuffer.updateData(te)}x.text.dynamicLayoutVertexBuffer.updateData($)}function eu(x,o,d){return d.iconsInText&&o?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function Pl(x,o,d,p,m,b,A,I,R,O,D,N){const $=x.context,te=$.gl,ee=x.transform,se=I==="map",J=R==="map",me=I!=="viewport"&&d.layout.get("symbol-placement")!=="point",Ee=se&&!J&&!me,ce=!d.layout.get("symbol-sort-key").isConstant();let xe=!1;const Ie=x.depthModeForSublayer(0,Ut.ReadOnly),Re=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Le=[];for(const We of p){const Ve=o.getTile(We),Xe=Ve.getBucket(d);if(!Xe)continue;const ht=m?Xe.text:Xe.icon;if(!ht||!ht.segments.get().length||!ht.hasVisibleVertices)continue;const Nt=ht.programConfigurations.get(d.id),Qe=m||Xe.sdfIcons,Tt=m?Xe.textSizeData:Xe.iconSizeData,ft=J||ee.pitch!==0,ii=x.useProgram(eu(Qe,m,Xe),Nt),Ft=a.ah(Tt,ee.zoom),Ct=x.style.map.terrain&&x.style.map.terrain.getTerrainData(We);let Lt,Fi,hi,dr,Ki=[0,0],Ui=null;if(m)Fi=Ve.glyphAtlasTexture,hi=te.LINEAR,Lt=Ve.glyphAtlasTexture.size,Xe.iconsInText&&(Ki=Ve.imageAtlasTexture.size,Ui=Ve.imageAtlasTexture,dr=ft||x.options.rotating||x.options.zooming||Tt.kind==="composite"||Tt.kind==="camera"?te.LINEAR:te.NEAREST);else{const Di=d.layout.get("icon-size").constantOr(0)!==1||Xe.iconsNeedLinear;Fi=Ve.imageAtlasTexture,hi=Qe||x.options.rotating||x.options.zooming||Di||ft?te.LINEAR:te.NEAREST,Lt=Ve.imageAtlasTexture.size}const dn=_e(Ve,1,x.transform.zoom),pi=Ze(We.posMatrix,J,se,x.transform,dn),Jn=Pn(We.posMatrix,J,se,x.transform,dn),Qn=Re&&Xe.hasTextData(),zs=d.layout.get("icon-text-fit")!=="none"&&Qn&&Xe.hasIconData();if(me){const Di=x.style.map.terrain?(jr,Ni)=>x.style.map.terrain.getElevation(We,jr,Ni):null,Gi=d.layout.get("text-rotation-alignment")==="map";Ke(Xe,We.posMatrix,x,m,pi,Jn,J,O,Gi,Di)}const uo=x.translatePosMatrix(We.posMatrix,Ve,b,A),$o=me||m&&Re||zs?Qc:pi,vr=x.translatePosMatrix(Jn,Ve,b,A,!0),fr=Qe&&d.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ir;Ir=Qe?Xe.iconsInText?ro(Tt.kind,Ft,Ee,J,x,uo,$o,vr,Lt,Ki):$c(Tt.kind,Ft,Ee,J,x,uo,$o,vr,m,Lt,!0):Vc(Tt.kind,Ft,Ee,J,x,uo,$o,vr,m,Lt);const ho={program:ii,buffers:ht,uniformValues:Ir,atlasTexture:Fi,atlasTextureIcon:Ui,atlasInterpolation:hi,atlasInterpolationIcon:dr,isSDF:Qe,hasHalo:fr};if(ce&&Xe.canOverlap){xe=!0;const Di=ht.segments.get();for(const Gi of Di)Le.push({segments:new a.S([Gi]),sortKey:Gi.sortKey,state:ho,terrainData:Ct})}else Le.push({segments:ht.segments,sortKey:0,state:ho,terrainData:Ct})}xe&&Le.sort((We,Ve)=>We.sortKey-Ve.sortKey);for(const We of Le){const Ve=We.state;if($.activeTexture.set(te.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,te.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&($.activeTexture.set(te.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),Ve.isSDF){const Xe=Ve.uniformValues;Ve.hasHalo&&(Xe.u_is_halo=1,tu(Ve.buffers,We.segments,d,x,Ve.program,Ie,D,N,Xe,We.terrainData)),Xe.u_is_halo=0}tu(Ve.buffers,We.segments,d,x,Ve.program,Ie,D,N,Ve.uniformValues,We.terrainData)}}function tu(x,o,d,p,m,b,A,I,R,O){const D=p.context;m.draw(D,D.gl.TRIANGLES,b,A,I,vi.disabled,R,O,d.id,x.layoutVertexBuffer,x.indexBuffer,o,d.paint,p.transform.zoom,x.programConfigurations.get(d.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function Ea(x,o,d,p,m){if(!d||!p||!p.imageAtlas)return;const b=p.imageAtlas.patternPositions;let A=b[d.to.toString()],I=b[d.from.toString()];if(!A&&I&&(A=I),!I&&A&&(I=A),!A||!I){const R=m.getPaintProperty(o);A=b[R],I=b[R]}A&&I&&x.setConstantPatternPositions(A,I)}function Aa(x,o,d,p,m,b,A){const I=x.context.gl,R="fill-pattern",O=d.paint.get(R),D=O&&O.constantOr(1),N=d.getCrossfadeParameters();let $,te,ee,se,J;A?(te=D&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=I.LINES):(te=D?"fillPattern":"fill",$=I.TRIANGLES);const me=O.constantOr(null);for(const Ee of p){const ce=o.getTile(Ee);if(D&&!ce.patternsLoaded())continue;const xe=ce.getBucket(d);if(!xe)continue;const Ie=xe.programConfigurations.get(d.id),Re=x.useProgram(te,Ie),Le=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ee);D&&(x.context.activeTexture.set(I.TEXTURE0),ce.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Ie.updatePaintBuffers(N)),Ea(Ie,R,me,ce,d);const We=Le?Ee:null,Ve=x.translatePosMatrix(We?We.posMatrix:Ee.posMatrix,ce,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(A){se=xe.indexBuffer2,J=xe.segments2;const Xe=[I.drawingBufferWidth,I.drawingBufferHeight];ee=te==="fillOutlinePattern"&&D?X(Ve,x,N,ce,Xe):Mo(Ve,Xe)}else se=xe.indexBuffer,J=xe.segments,ee=D?wa(Ve,x,N,ce):ba(Ve);Re.draw(x.context,$,m,x.stencilModeForClipping(Ee),b,vi.disabled,ee,Le,d.id,xe.layoutVertexBuffer,se,J,d.paint,x.transform.zoom,Ie)}}function Pa(x,o,d,p,m,b,A){const I=x.context,R=I.gl,O="fill-extrusion-pattern",D=d.paint.get(O),N=D.constantOr(1),$=d.getCrossfadeParameters(),te=d.paint.get("fill-extrusion-opacity"),ee=D.constantOr(null);for(const se of p){const J=o.getTile(se),me=J.getBucket(d);if(!me)continue;const Ee=x.style.map.terrain&&x.style.map.terrain.getTerrainData(se),ce=me.programConfigurations.get(d.id),xe=x.useProgram(N?"fillExtrusionPattern":"fillExtrusion",ce);N&&(x.context.activeTexture.set(R.TEXTURE0),J.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ce.updatePaintBuffers($)),Ea(ce,O,ee,J,d);const Ie=x.translatePosMatrix(se.posMatrix,J,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Re=d.paint.get("fill-extrusion-vertical-gradient"),Le=N?In(Ie,x,Re,te,se,$,J):Ro(Ie,x,Re,te);xe.draw(I,I.gl.TRIANGLES,m,b,A,vi.backCCW,Le,Ee,d.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,d.paint,x.transform.zoom,ce,x.style.map.terrain&&me.centroidVertexBuffer)}}function bg(x,o,d,p,m,b,A){const I=x.context,R=I.gl,O=d.fbo;if(!O)return;const D=x.useProgram("hillshade"),N=x.style.map.terrain&&x.style.map.terrain.getTerrainData(o);I.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,O.colorAttachment.get()),D.draw(I,R.TRIANGLES,m,b,A,vi.disabled,(($,te,ee,se)=>{const J=ee.paint.get("hillshade-shadow-color"),me=ee.paint.get("hillshade-highlight-color"),Ee=ee.paint.get("hillshade-accent-color");let ce=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);ee.paint.get("hillshade-illumination-anchor")==="viewport"&&(ce-=$.transform.angle);const xe=!$.options.moving;return{u_matrix:se?se.posMatrix:$.transform.calculatePosMatrix(te.tileID.toUnwrapped(),xe),u_image:0,u_latrange:Ot(0,te.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),ce],u_shadow:J,u_highlight:me,u_accent:Ee}})(x,d,p,N?o:null),N,p.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}function iu(x,o,d,p,m,b){const A=x.context,I=A.gl,R=o.dem;if(R&&R.data){const O=R.dim,D=R.stride,N=R.getPixels();if(A.activeTexture.set(I.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||x.getTileTexture(D),o.demTexture){const te=o.demTexture;te.update(N,{premultiply:!1}),te.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else o.demTexture=new Ue(A,N,I.RGBA,{premultiply:!1}),o.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);A.activeTexture.set(I.TEXTURE0);let $=o.fbo;if(!$){const te=new Ue(A,{width:O,height:O,data:null},I.RGBA);te.bind(I.LINEAR,I.CLAMP_TO_EDGE),$=o.fbo=A.createFramebuffer(O,O,!0,!1),$.colorAttachment.set(te.texture)}A.bindFramebuffer.set($.framebuffer),A.viewport.set([0,0,O,O]),x.useProgram("hillshadePrepare").draw(A,I.TRIANGLES,p,m,b,vi.disabled,((te,ee)=>{const se=ee.stride,J=a.Z();return a.aS(J,0,a.N,-a.N,0,0,1),a.$(J,J,[0,-a.N,0]),{u_matrix:J,u_image:1,u_dimension:[se,se],u_zoom:te.overscaledZ,u_unpack:ee.getUnpackVector()}})(o.tileID,R),null,d.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function wg(x,o,d,p,m,b){const A=p.paint.get("raster-fade-duration");if(!b&&A>0){const I=a.h.now(),R=(I-x.timeAdded)/A,O=o?(I-o.timeAdded)/A:-1,D=d.getSource(),N=m.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),$=!o||Math.abs(o.tileID.overscaledZ-N)>Math.abs(x.tileID.overscaledZ-N),te=$&&x.refreshedUponExpiration?1:a.ad($?R:1-O,0,1);return x.refreshedUponExpiration&&R>=1&&(x.refreshedUponExpiration=!1),o?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}const sd=new a.aT(1,0,0,1),Il=new a.aT(0,1,0,1),ru=new a.aT(0,0,1,1),od=new a.aT(1,0,1,1),ad=new a.aT(0,1,1,1);function Ia(x,o,d,p){Rl(x,0,o+d/2,x.transform.width,d,p)}function Cl(x,o,d,p){Rl(x,o-d/2,0,d,x.transform.height,p)}function Rl(x,o,d,p,m,b){const A=x.context,I=A.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*x.pixelRatio,d*x.pixelRatio,p*x.pixelRatio,m*x.pixelRatio),A.clear({color:b}),I.disable(I.SCISSOR_TEST)}function ld(x,o,d){const p=x.context,m=p.gl,b=d.posMatrix,A=x.useProgram("debug"),I=Ut.disabled,R=Ei.disabled,O=x.colorModeForRenderPass(),D="$debug",N=x.style.map.terrain&&x.style.map.terrain.getTerrainData(d);p.activeTexture.set(m.TEXTURE0);const $=o.getTileByID(d.key).latestRawTileData,te=Math.floor(($&&$.byteLength||0)/1024),ee=o.getTile(d).tileSize,se=512/Math.min(ee,512)*(d.overscaledZ/x.transform.zoom)*.5;let J=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(J+=` => ${d.overscaledZ}`),function(me,Ee){me.initDebugOverlayCanvas();const ce=me.debugOverlayCanvas,xe=me.context.gl,Ie=me.debugOverlayCanvas.getContext("2d");Ie.clearRect(0,0,ce.width,ce.height),Ie.shadowColor="white",Ie.shadowBlur=2,Ie.lineWidth=1.5,Ie.strokeStyle="white",Ie.textBaseline="top",Ie.font="bold 36px Open Sans, sans-serif",Ie.fillText(Ee,5,5),Ie.strokeText(Ee,5,5),me.debugOverlayTexture.update(ce),me.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(x,`${J} ${te}kB`),A.draw(p,m.TRIANGLES,I,R,Si.alphaBlended,vi.disabled,Ce(b,a.aT.transparent,se),null,D,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),A.draw(p,m.LINE_STRIP,I,R,O,vi.disabled,Ce(b,a.aT.red),N,D,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function Ii(x,o,d){const p=x.context,m=p.gl,b=x.colorModeForRenderPass(),A=new Ut(m.LEQUAL,Ut.ReadWrite,x.depthRangeFor3D),I=x.useProgram("terrain"),R=o.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,x.width,x.height]);for(const O of d){const D=x.renderToTexture.getTexture(O),N=o.getTerrainData(O.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,D.texture);const $={u_matrix:x.transform.calculatePosMatrix(O.tileID.toUnwrapped()),u_texture:0,u_ele_delta:o.getMeshFrameDelta(x.transform.zoom)};I.draw(p,m.TRIANGLES,A,Ei.disabled,b,vi.backCCW,$,N,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}}class oo{constructor(o,d){this.context=new vg(o),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.Z(),renderTime:0},this.setup(),this.numSublayers=ui.maxUnderzooming+ui.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ar}resize(o,d,p){if(this.width=Math.floor(o*p),this.height=Math.floor(d*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const o=this.context,d=new a.a_;d.emplaceBack(0,0),d.emplaceBack(a.N,0),d.emplaceBack(0,a.N),d.emplaceBack(a.N,a.N),this.tileExtentBuffer=o.createVertexBuffer(d,gs.members),this.tileExtentSegments=a.S.simpleSegment(0,0,4,2);const p=new a.a_;p.emplaceBack(0,0),p.emplaceBack(a.N,0),p.emplaceBack(0,a.N),p.emplaceBack(a.N,a.N),this.debugBuffer=o.createVertexBuffer(p,gs.members),this.debugSegments=a.S.simpleSegment(0,0,4,5);const m=new a.V;m.emplaceBack(0,0,0,0),m.emplaceBack(a.N,0,a.N,0),m.emplaceBack(0,a.N,0,a.N),m.emplaceBack(a.N,a.N,a.N,a.N),this.rasterBoundsBuffer=o.createVertexBuffer(m,Yt.members),this.rasterBoundsSegments=a.S.simpleSegment(0,0,4,2);const b=new a.a_;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,gs.members),this.viewportSegments=a.S.simpleSegment(0,0,4,2);const A=new a.a$;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(A);const I=new a.b0;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(I);const R=this.context.gl;this.stencilClearMode=new Ei({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)}clearStencil(){const o=this.context,d=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.Z();a.aS(p,0,this.width,this.height,0,0,1),a.a0(p,p,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,d.TRIANGLES,Ut.disabled,this.stencilClearMode,Si.disabled,vi.disabled,qe(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,d){if(this.currentStencilSource===o.source||!o.isTileClipped()||!d||!d.length)return;this.currentStencilSource=o.source;const p=this.context,m=p.gl;this.nextStencilID+d.length>256&&this.clearStencil(),p.setColorMode(Si.disabled),p.setDepthMode(Ut.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of d){const I=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A);b.draw(p,m.TRIANGLES,Ut.disabled,new Ei({func:m.ALWAYS,mask:0},I,255,m.KEEP,m.KEEP,m.REPLACE),Si.disabled,vi.disabled,qe(A.posMatrix),R,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new Ei({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){const d=this.context.gl;return new Ei({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,p=o.sort((A,I)=>I.overscaledZ-A.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const A={};for(let I=0;I<b;I++)A[I+m]=new Ei({func:d.GEQUAL,mask:255},I+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=b,[A,p]}return[{[m]:Ei.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Si([o.CONSTANT_COLOR,o.ONE],new a.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Si.unblended:Si.alphaBlended}depthModeForSublayer(o,d,p){if(!this.opaquePassEnabledForLayer())return Ut.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Ut(p||this.context.gl.LEQUAL,d,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,d){this.style=o,this.options=d,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(a.h.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,b={},A={},I={};for(const R in m){const O=m[R];O.used&&O.prepare(this.context),b[R]=O.getVisibleCoordinates(),A[R]=b[R].slice().reverse(),I[R]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<p.length;R++)if(this.style._layers[p[R]].is3D()){this.opaquePassCutoff=R;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const R=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||R.length)&&(a.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(O,D){const N=O.context,$=N.gl,te=Si.unblended,ee=new Ut($.LEQUAL,Ut.ReadWrite,[0,1]),se=D.getTerrainMesh(),J=D.sourceCache.getRenderableTiles(),me=O.useProgram("terrainDepth");N.bindFramebuffer.set(D.getFramebuffer("depth").framebuffer),N.viewport.set([0,0,O.width/devicePixelRatio,O.height/devicePixelRatio]),N.clear({color:a.aT.transparent,depth:1});for(const Ee of J){const ce=D.getTerrainData(Ee.tileID),xe={u_matrix:O.transform.calculatePosMatrix(Ee.tileID.toUnwrapped()),u_ele_delta:D.getMeshFrameDelta(O.transform.zoom)};me.draw(N,$.TRIANGLES,ee,Ei.disabled,te,vi.backCCW,xe,ce,"terrain",se.vertexBuffer,se.indexBuffer,se.segments)}N.bindFramebuffer.set(null),N.viewport.set([0,0,O.width,O.height])}(this,this.style.map.terrain),function(O,D){const N=O.context,$=N.gl,te=Si.unblended,ee=new Ut($.LEQUAL,Ut.ReadWrite,[0,1]),se=D.getTerrainMesh(),J=D.getCoordsTexture(),me=D.sourceCache.getRenderableTiles(),Ee=O.useProgram("terrainCoords");N.bindFramebuffer.set(D.getFramebuffer("coords").framebuffer),N.viewport.set([0,0,O.width/devicePixelRatio,O.height/devicePixelRatio]),N.clear({color:a.aT.transparent,depth:1}),D.coordsIndex=[];for(const ce of me){const xe=D.getTerrainData(ce.tileID);N.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,J.texture);const Ie={u_matrix:O.transform.calculatePosMatrix(ce.tileID.toUnwrapped()),u_terrain_coords_id:(255-D.coordsIndex.length)/255,u_texture:0,u_ele_delta:D.getMeshFrameDelta(O.transform.zoom)};Ee.draw(N,$.TRIANGLES,ee,Ei.disabled,te,vi.backCCW,Ie,xe,"terrain",se.vertexBuffer,se.indexBuffer,se.segments),D.coordsIndex.push(ce.tileID.key)}N.bindFramebuffer.set(null),N.viewport.set([0,0,O.width,O.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const R of p){const O=this.style._layers[R];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const D=A[O.source];(O.type==="custom"||D.length)&&this.renderLayer(this,m[O.source],O,D)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?a.aT.black:a.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[p[this.currentLayer]],O=m[R.source],D=b[R.source];this._renderTileClippingMasks(R,D),this.renderLayer(this,O,R,D)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const R=this.style._layers[p[this.currentLayer]],O=m[R.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(R))continue;const D=(R.type==="symbol"?I:A)[R.source];this._renderTileClippingMasks(R,b[R.source]),this.renderLayer(this,O,R,D)}if(this.options.showTileBoundaries){const R=function(O,D){let N=null;const $=Object.values(O._layers).flatMap(J=>J.source&&!J.isHidden(D)?[O.sourceCaches[J.source]]:[]),te=$.filter(J=>J.getSource().type==="vector"),ee=$.filter(J=>J.getSource().type!=="vector"),se=J=>{(!N||N.getSource().maxzoom<J.getSource().maxzoom)&&(N=J)};return te.forEach(J=>se(J)),N||ee.forEach(J=>se(J)),N}(this.style,this.transform.zoom);R&&function(O,D,N){for(let $=0;$<N.length;$++)ld(O,D,N[$])}(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const O=R.transform.padding;Ia(R,R.transform.height-(O.top||0),3,sd),Ia(R,O.bottom||0,3,Il),Cl(R,O.left||0,3,ru),Cl(R,R.transform.width-(O.right||0),3,od);const D=R.transform.centerPoint;(function(N,$,te,ee){Rl(N,$-1,te-10,2,20,ee),Rl(N,$-10,te-1,20,2,ee)})(R,D.x,R.transform.height-D.y,ad)}(this),this.context.setDefault()}renderLayer(o,d,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(b,A,I,R,O){if(b.renderPass!=="translucent")return;const D=Ei.disabled,N=b.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function($,te,ee,se,J,me,Ee){const ce=te.transform,xe=J==="map",Ie=me==="map";for(const Re of $){const Le=se.getTile(Re),We=Le.getBucket(ee);if(!We||!We.text||!We.text.segments.get().length)continue;const Ve=a.ah(We.textSizeData,ce.zoom),Xe=_e(Le,1,te.transform.zoom),ht=Ze(Re.posMatrix,Ie,xe,te.transform,Xe),Nt=ee.layout.get("icon-text-fit")!=="none"&&We.hasIconData();if(Ve){const Qe=Math.pow(2,ce.zoom-Le.tileID.overscaledZ);Al(We,xe,Ie,Ee,ce,ht,Re.posMatrix,Qe,Ve,Nt,te.style.map.terrain?(Tt,ft)=>te.style.map.terrain.getElevation(Re,Tt,ft):null)}}}(R,b,I,A,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),O),I.paint.get("icon-opacity").constantOr(1)!==0&&Pl(b,A,I,R,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),D,N),I.paint.get("text-opacity").constantOr(1)!==0&&Pl(b,A,I,R,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),D,N),A.map.showCollisionBoxes&&(nd(b,A,I,R,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),!0),nd(b,A,I,R,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),!1))})(o,d,p,m,this.style.placement.variableOffsets);break;case"circle":(function(b,A,I,R){if(b.renderPass!=="translucent")return;const O=I.paint.get("circle-opacity"),D=I.paint.get("circle-stroke-width"),N=I.paint.get("circle-stroke-opacity"),$=!I.layout.get("circle-sort-key").isConstant();if(O.constantOr(1)===0&&(D.constantOr(1)===0||N.constantOr(1)===0))return;const te=b.context,ee=te.gl,se=b.depthModeForSublayer(0,Ut.ReadOnly),J=Ei.disabled,me=b.colorModeForRenderPass(),Ee=[];for(let ce=0;ce<R.length;ce++){const xe=R[ce],Ie=A.getTile(xe),Re=Ie.getBucket(I);if(!Re)continue;const Le=Re.programConfigurations.get(I.id),We=b.useProgram("circle",Le),Ve=Re.layoutVertexBuffer,Xe=Re.indexBuffer,ht=b.style.map.terrain&&b.style.map.terrain.getTerrainData(xe),Nt={programConfiguration:Le,program:We,layoutVertexBuffer:Ve,indexBuffer:Xe,uniformValues:K(b,xe,Ie,I),terrainData:ht};if($){const Qe=Re.segments.get();for(const Tt of Qe)Ee.push({segments:new a.S([Tt]),sortKey:Tt.sortKey,state:Nt})}else Ee.push({segments:Re.segments,sortKey:0,state:Nt})}$&&Ee.sort((ce,xe)=>ce.sortKey-xe.sortKey);for(const ce of Ee){const{programConfiguration:xe,program:Ie,layoutVertexBuffer:Re,indexBuffer:Le,uniformValues:We,terrainData:Ve}=ce.state;Ie.draw(te,ee.TRIANGLES,se,J,me,vi.disabled,We,Ve,I.id,Re,Le,ce.segments,I.paint,b.transform.zoom,xe)}})(o,d,p,m);break;case"heatmap":(function(b,A,I,R){if(I.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const O=b.context,D=O.gl,N=Ei.disabled,$=new Si([D.ONE,D.ONE],a.aT.transparent,[!0,!0,!0,!0]);(function(te,ee,se){const J=te.gl;te.activeTexture.set(J.TEXTURE1),te.viewport.set([0,0,ee.width/4,ee.height/4]);let me=se.heatmapFbo;if(me)J.bindTexture(J.TEXTURE_2D,me.colorAttachment.get()),te.bindFramebuffer.set(me.framebuffer);else{const Ee=J.createTexture();J.bindTexture(J.TEXTURE_2D,Ee),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),me=se.heatmapFbo=te.createFramebuffer(ee.width/4,ee.height/4,!1,!1),function(ce,xe,Ie,Re){var Le,We;const Ve=ce.gl,Xe=(Le=ce.HALF_FLOAT)!==null&&Le!==void 0?Le:Ve.UNSIGNED_BYTE,ht=(We=ce.RGBA16F)!==null&&We!==void 0?We:Ve.RGBA;Ve.texImage2D(Ve.TEXTURE_2D,0,ht,xe.width/4,xe.height/4,0,Ve.RGBA,Xe,null),Re.colorAttachment.set(Ie)}(te,ee,Ee,me)}})(O,b,I),O.clear({color:a.aT.transparent});for(let te=0;te<R.length;te++){const ee=R[te];if(A.hasRenderableParent(ee))continue;const se=A.getTile(ee),J=se.getBucket(I);if(!J)continue;const me=J.programConfigurations.get(I.id),Ee=b.useProgram("heatmap",me),{zoom:ce}=b.transform;Ee.draw(O,D.TRIANGLES,Ut.disabled,N,$,vi.disabled,ut(ee.posMatrix,se,ce,I.paint.get("heatmap-intensity")),null,I.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,I.paint,b.transform.zoom,me)}O.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(O,D){const N=O.context,$=N.gl,te=D.heatmapFbo;if(!te)return;N.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,te.colorAttachment.get()),N.activeTexture.set($.TEXTURE1);let ee=D.colorRampTexture;ee||(ee=D.colorRampTexture=new Ue(N,D.colorRamp,$.RGBA)),ee.bind($.LINEAR,$.CLAMP_TO_EDGE),O.useProgram("heatmapTexture").draw(N,$.TRIANGLES,Ut.disabled,Ei.disabled,O.colorModeForRenderPass(),vi.disabled,((se,J,me,Ee)=>{const ce=a.Z();a.aS(ce,0,se.width,se.height,0,0,1);const xe=se.context.gl;return{u_matrix:ce,u_world:[xe.drawingBufferWidth,xe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:J.paint.get("heatmap-opacity")}})(O,D),null,D.id,O.viewportBuffer,O.quadTriangleIndexBuffer,O.viewportSegments,D.paint,O.transform.zoom)}(b,I))})(o,d,p,m);break;case"line":(function(b,A,I,R){if(b.renderPass!=="translucent")return;const O=I.paint.get("line-opacity"),D=I.paint.get("line-width");if(O.constantOr(1)===0||D.constantOr(1)===0)return;const N=b.depthModeForSublayer(0,Ut.ReadOnly),$=b.colorModeForRenderPass(),te=I.paint.get("line-dasharray"),ee=I.paint.get("line-pattern"),se=ee.constantOr(1),J=I.paint.get("line-gradient"),me=I.getCrossfadeParameters(),Ee=se?"linePattern":te?"lineSDF":J?"lineGradient":"line",ce=b.context,xe=ce.gl;let Ie=!0;for(const Re of R){const Le=A.getTile(Re);if(se&&!Le.patternsLoaded())continue;const We=Le.getBucket(I);if(!We)continue;const Ve=We.programConfigurations.get(I.id),Xe=b.context.program.get(),ht=b.useProgram(Ee,Ve),Nt=Ie||ht.program!==Xe,Qe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Re),Tt=ee.constantOr(null);if(Tt&&Le.imageAtlas){const Ft=Le.imageAtlas,Ct=Ft.patternPositions[Tt.to.toString()],Lt=Ft.patternPositions[Tt.from.toString()];Ct&&Lt&&Ve.setConstantPatternPositions(Ct,Lt)}const ft=Qe?Re:null,ii=se?hr(b,Le,I,me,ft):te?an(b,Le,I,te,me,ft):J?Wi(b,Le,I,We.lineClipsArray.length,ft):Oi(b,Le,I,ft);if(se)ce.activeTexture.set(xe.TEXTURE0),Le.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Ve.updatePaintBuffers(me);else if(te&&(Nt||b.lineAtlas.dirty))ce.activeTexture.set(xe.TEXTURE0),b.lineAtlas.bind(ce);else if(J){const Ft=We.gradients[I.id];let Ct=Ft.texture;if(I.gradientVersion!==Ft.version){let Lt=256;if(I.stepInterpolant){const Fi=A.getSource().maxzoom,hi=Re.canonical.z===Fi?Math.ceil(1<<b.transform.maxZoom-Re.canonical.z):1;Lt=a.ad(a.aY(We.maxLineLength/a.N*1024*hi),256,ce.maxTextureSize)}Ft.gradient=a.aZ({expression:I.gradientExpression(),evaluationKey:"lineProgress",resolution:Lt,image:Ft.gradient||void 0,clips:We.lineClipsArray}),Ft.texture?Ft.texture.update(Ft.gradient):Ft.texture=new Ue(ce,Ft.gradient,xe.RGBA),Ft.version=I.gradientVersion,Ct=Ft.texture}ce.activeTexture.set(xe.TEXTURE0),Ct.bind(I.stepInterpolant?xe.NEAREST:xe.LINEAR,xe.CLAMP_TO_EDGE)}ht.draw(ce,xe.TRIANGLES,N,b.stencilModeForClipping(Re),$,vi.disabled,ii,Qe,I.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,I.paint,b.transform.zoom,Ve,We.layoutVertexBuffer2),Ie=!1}})(o,d,p,m);break;case"fill":(function(b,A,I,R){const O=I.paint.get("fill-color"),D=I.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const N=b.colorModeForRenderPass(),$=I.paint.get("fill-pattern"),te=b.opaquePassEnabledForLayer()&&!$.constantOr(1)&&O.constantOr(a.aT.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===te){const ee=b.depthModeForSublayer(1,b.renderPass==="opaque"?Ut.ReadWrite:Ut.ReadOnly);Aa(b,A,I,R,ee,N,!1)}if(b.renderPass==="translucent"&&I.paint.get("fill-antialias")){const ee=b.depthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,Ut.ReadOnly);Aa(b,A,I,R,ee,N,!0)}})(o,d,p,m);break;case"fill-extrusion":(function(b,A,I,R){const O=I.paint.get("fill-extrusion-opacity");if(O!==0&&b.renderPass==="translucent"){const D=new Ut(b.context.gl.LEQUAL,Ut.ReadWrite,b.depthRangeFor3D);if(O!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))Pa(b,A,I,R,D,Ei.disabled,Si.disabled),Pa(b,A,I,R,D,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const N=b.colorModeForRenderPass();Pa(b,A,I,R,D,Ei.disabled,N)}}})(o,d,p,m);break;case"hillshade":(function(b,A,I,R){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const O=b.context,D=b.depthModeForSublayer(0,Ut.ReadOnly),N=b.colorModeForRenderPass(),[$,te]=b.renderPass==="translucent"?b.stencilConfigForOverlap(R):[{},R];for(const ee of te){const se=A.getTile(ee);se.needsHillshadePrepare!==void 0&&se.needsHillshadePrepare&&b.renderPass==="offscreen"?iu(b,se,I,D,Ei.disabled,N):b.renderPass==="translucent"&&bg(b,ee,se,I,D,$[ee.overscaledZ],N)}O.viewport.set([0,0,b.width,b.height])})(o,d,p,m);break;case"raster":(function(b,A,I,R){if(b.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!R.length)return;const O=b.context,D=O.gl,N=A.getSource(),$=b.useProgram("raster"),te=b.colorModeForRenderPass(),[ee,se]=N instanceof ci?[{},R]:b.stencilConfigForOverlap(R),J=se[se.length-1].overscaledZ,me=!b.options.moving;for(const Ee of se){const ce=b.depthModeForSublayer(Ee.overscaledZ-J,I.paint.get("raster-opacity")===1?Ut.ReadWrite:Ut.ReadOnly,D.LESS),xe=A.getTile(Ee);xe.registerFadeDuration(I.paint.get("raster-fade-duration"));const Ie=A.findLoadedParent(Ee,0),Re=wg(xe,Ie,A,I,b.transform,b.style.map.terrain);let Le,We;const Ve=I.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;O.activeTexture.set(D.TEXTURE0),xe.texture.bind(Ve,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),O.activeTexture.set(D.TEXTURE1),Ie?(Ie.texture.bind(Ve,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),Le=Math.pow(2,Ie.tileID.overscaledZ-xe.tileID.overscaledZ),We=[xe.tileID.canonical.x*Le%1,xe.tileID.canonical.y*Le%1]):xe.texture.bind(Ve,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const Xe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ee),ht=Xe?Ee:null,Nt=ht?ht.posMatrix:b.transform.calculatePosMatrix(Ee.toUnwrapped(),me),Qe=Kh(Nt,We||[0,0],Le||1,Re,I);N instanceof ci?$.draw(O,D.TRIANGLES,ce,Ei.disabled,te,vi.disabled,Qe,Xe,I.id,N.boundsBuffer,b.quadTriangleIndexBuffer,N.boundsSegments):$.draw(O,D.TRIANGLES,ce,ee[Ee.overscaledZ],te,vi.disabled,Qe,Xe,I.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(o,d,p,m);break;case"background":(function(b,A,I,R){const O=I.paint.get("background-color"),D=I.paint.get("background-opacity");if(D===0)return;const N=b.context,$=N.gl,te=b.transform,ee=te.tileSize,se=I.paint.get("background-pattern");if(b.isPatternMissing(se))return;const J=!se&&O.a===1&&D===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==J)return;const me=Ei.disabled,Ee=b.depthModeForSublayer(0,J==="opaque"?Ut.ReadWrite:Ut.ReadOnly),ce=b.colorModeForRenderPass(),xe=b.useProgram(se?"backgroundPattern":"background"),Ie=R||te.coveringTiles({tileSize:ee,terrain:b.style.map.terrain});se&&(N.activeTexture.set($.TEXTURE0),b.imageManager.bind(b.context));const Re=I.getCrossfadeParameters();for(const Le of Ie){const We=R?Le.posMatrix:b.transform.calculatePosMatrix(Le.toUnwrapped()),Ve=se?Cn(We,D,b,se,{tileID:Le,tileSize:ee},Re):gl(We,D,O),Xe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Le);xe.draw(N,$.TRIANGLES,Ee,me,ce,vi.disabled,Ve,Xe,I.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(o,0,p,m);break;case"custom":(function(b,A,I){const R=b.context,O=I.implementation;if(b.renderPass==="offscreen"){const D=O.prerender;D&&(b.setCustomLayerDefaults(),R.setColorMode(b.colorModeForRenderPass()),D.call(O,R.gl,b.transform.customLayerMatrix()),R.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),R.setColorMode(b.colorModeForRenderPass()),R.setStencilMode(Ei.disabled);const D=O.renderingMode==="3d"?new Ut(b.context.gl.LEQUAL,Ut.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Ut.ReadOnly);R.setDepthMode(D),O.render(R.gl,b.transform.customLayerMatrix()),R.setDirty(),b.setBaseState(),R.bindFramebuffer.set(null)}})(o,0,p)}}translatePosMatrix(o,d,p,m,b){if(!p[0]&&!p[1])return o;const A=b?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(A){const O=Math.sin(A),D=Math.cos(A);p=[p[0]*D-p[1]*O,p[0]*O+p[1]*D]}const I=[b?p[0]:_e(d,p[0],this.transform.zoom),b?p[1]:_e(d,p[1],this.transform.zoom),0],R=new Float32Array(16);return a.$(R,o,I),R}saveTileTexture(o){const d=this._tileTextures[o.size[0]];d?d.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const d=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!d||!p}useProgram(o,d){this.cache=this.cache||{};const p=o+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new zr(this.context,ai[o],d,_l[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ue(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:d}=this.context.gl;return this.width!==o||this.height!==d}}class Vr{constructor(o,d){this.points=o,this.planes=d}static fromInvProjectionMatrix(o,d,p){const m=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const R=1/(I=a.ag([],I,o))[3]/d*m;return a.b3(I,I,[R,R,1/I[3],R])}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const R=function($,te){var ee=te[0],se=te[1],J=te[2],me=ee*ee+se*se+J*J;return me>0&&(me=1/Math.sqrt(me)),$[0]=te[0]*me,$[1]=te[1]*me,$[2]=te[2]*me,$}([],function($,te,ee){var se=te[0],J=te[1],me=te[2],Ee=ee[0],ce=ee[1],xe=ee[2];return $[0]=J*xe-me*ce,$[1]=me*Ee-se*xe,$[2]=se*ce-J*Ee,$}([],Oe([],b[I[0]],b[I[1]]),Oe([],b[I[2]],b[I[1]]))),O=-((D=R)[0]*(N=b[I[1]])[0]+D[1]*N[1]+D[2]*N[2]);var D,N;return R.concat(O)});return new Vr(b,A)}}class No{constructor(o,d){this.min=o,this.max=d,this.center=function(p,m,b){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,b){return p[0]=m[0]+b[0],p[1]=m[1]+b[1],p[2]=m[2]+b[2],p}([],this.min,this.max))}quadrant(o){const d=[o%2==0,o<2],p=ue(this.min),m=ue(this.max);for(let b=0;b<d.length;b++)p[b]=d[b]?this.min[b]:this.center[b],m[b]=d[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new No(p,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<o.planes.length;m++){const b=o.planes[m];let A=0;for(let I=0;I<d.length;I++)a.b4(b,d[I])>=0&&A++;if(A===0)return 0;A!==d.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let I=0;I<o.points.length;I++){const R=o.points[I][m]-this.min[m];b=Math.min(b,R),A=Math.max(A,R)}if(A<0||b>this.max[m]-this.min[m])return 0}return 1}}class Ca{constructor(o=0,d=0,p=0,m=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=p,this.right=m}interpolate(o,d,p){return d.top!=null&&o.top!=null&&(this.top=a.B.number(o.top,d.top,p)),d.bottom!=null&&o.bottom!=null&&(this.bottom=a.B.number(o.bottom,d.bottom,p)),d.left!=null&&o.left!=null&&(this.left=a.B.number(o.left,d.left,p)),d.right!=null&&o.right!=null&&(this.right=a.B.number(o.right,d.right,p)),this}getCenter(o,d){const p=a.ad((this.left+o-this.right)/2,0,o),m=a.ad((this.top+d-this.bottom)/2,0,d);return new a.P(p,m)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Ml{constructor(o,d,p,m,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||!!b,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ca,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const o=new Ml(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this._minEleveationForCurrentTile=o._minEleveationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const d=-a.b5(o,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,b){var A=m[0],I=m[1],R=m[2],O=m[3],D=Math.sin(b),N=Math.cos(b);p[0]=A*N+R*D,p[1]=I*N+O*D,p[2]=A*-D+R*N,p[3]=I*-D+O*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=a.ad(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,p){this._unmodified=!1,this._edgeInsets.interpolate(o,d,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new a.b6(0,o)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),b=this.pointCoordinate(new a.P(this.width,this.height)),A=this.pointCoordinate(new a.P(0,this.height)),I=Math.floor(Math.min(p.x,m.x,b.x,A.x)),R=Math.floor(Math.max(p.x,m.x,b.x,A.x)),O=1;for(let D=I-O;D<=R+O;D++)D!==0&&d.push(new a.b6(D,o))}return d}coveringTiles(o){var d,p;let m=this.coveringZoomLevel(o);const b=m;if(o.minzoom!==void 0&&m<o.minzoom)return[];o.maxzoom!==void 0&&m>o.maxzoom&&(m=o.maxzoom);const A=this.pointCoordinate(this.getCameraPoint()),I=a.U.fromLngLat(this.center),R=Math.pow(2,m),O=[R*A.x,R*A.y,0],D=[R*I.x,R*I.y,0],N=Vr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let $=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&($=m);const te=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,ee=ce=>({aabb:new No([ce*R,0,0],[(ce+1)*R,R,0]),zoom:0,x:0,y:0,wrap:ce,fullyVisible:!1}),se=[],J=[],me=m,Ee=o.reparseOverscaled?b:m;if(this._renderWorldCopies)for(let ce=1;ce<=3;ce++)se.push(ee(-ce)),se.push(ee(ce));for(se.push(ee(0));se.length>0;){const ce=se.pop(),xe=ce.x,Ie=ce.y;let Re=ce.fullyVisible;if(!Re){const ht=ce.aabb.intersects(N);if(ht===0)continue;Re=ht===2}const Le=o.terrain?O:D,We=ce.aabb.distanceX(Le),Ve=ce.aabb.distanceY(Le),Xe=Math.max(Math.abs(We),Math.abs(Ve));if(ce.zoom===me||Xe>te+(1<<me-ce.zoom)-2&&ce.zoom>=$){const ht=me-ce.zoom,Nt=O[0]-.5-(xe<<ht),Qe=O[1]-.5-(Ie<<ht);J.push({tileID:new a.O(ce.zoom===me?Ee:ce.zoom,ce.wrap,ce.zoom,xe,Ie),distanceSq:$e([D[0]-.5-xe,D[1]-.5-Ie]),tileDistanceToCamera:Math.sqrt(Nt*Nt+Qe*Qe)})}else for(let ht=0;ht<4;ht++){const Nt=(xe<<1)+ht%2,Qe=(Ie<<1)+(ht>>1),Tt=ce.zoom+1;let ft=ce.aabb.quadrant(ht);if(o.terrain){const ii=new a.O(Tt,ce.wrap,Tt,Nt,Qe),Ft=o.terrain.getMinMaxElevation(ii),Ct=(d=Ft.minElevation)!==null&&d!==void 0?d:this.elevation,Lt=(p=Ft.maxElevation)!==null&&p!==void 0?p:this.elevation;ft=new No([ft.min[0],ft.min[1],Ct],[ft.max[0],ft.max[1],Lt])}se.push({aabb:ft,zoom:Tt,x:Nt,y:Qe,wrap:ce.wrap,fullyVisible:Re})}}return J.sort((ce,xe)=>ce.distanceSq-xe.distanceSq).map(ce=>ce.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const d=a.ad(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.P(a.G(o.lng)*this.worldSize,a.H(d)*this.worldSize)}unproject(o){return new a.U(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const d=this.pointLocation(this.centerPoint,o),p=o.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-p))return;const m=this.getCameraPosition(),b=a.U.fromLngLat(m.lngLat,m.altitude),A=a.U.fromLngLat(d,p),I=b.x-A.x,R=b.y-A.y,O=b.z-A.z,D=Math.sqrt(I*I+R*R+O*O),N=this.scaleZoom(this.cameraToCenterDistance/D/this.tileSize);this._elevation=p,this._center=d,this.zoom=N}setLocationAtPoint(o,d){const p=this.pointCoordinate(d),m=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(o),A=new a.U(b.x-(p.x-m.x),b.y-(p.y-m.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,d){return d?this.coordinatePoint(this.locationCoordinate(o),d.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,d){return this.coordinateLocation(this.pointCoordinate(o,d))}locationCoordinate(o){return a.U.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,d){if(d){const $=d.pointCoordinate(o);if($!=null)return $}const p=[o.x,o.y,0,1],m=[o.x,o.y,1,1];a.ag(p,p,this.pixelMatrixInverse),a.ag(m,m,this.pixelMatrixInverse);const b=p[3],A=m[3],I=p[1]/b,R=m[1]/A,O=p[2]/b,D=m[2]/A,N=O===D?0:(0-O)/(D-O);return new a.U(a.B.number(p[0]/b,m[0]/A,N)/this.worldSize,a.B.number(I,R,N)/this.worldSize)}coordinatePoint(o,d=0,p=this.pixelMatrix){const m=[o.x*this.worldSize,o.y*this.worldSize,d,1];return a.ag(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new oi().extend(this.pointLocation(new a.P(0,o))).extend(this.pointLocation(new a.P(this.width,o))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new oi([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,d=!1){const p=o.key,m=d?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const b=o.canonical,A=this.worldSize/this.zoomScale(b.z),I=b.x+Math.pow(2,b.z)*o.wrap,R=a.ao(new Float64Array(16));return a.$(R,R,[I*A,b.y*A,0]),a.a0(R,R,[A/a.N,A/a.N,1]),a.a1(R,d?this.alignedProjMatrix:this.projMatrix,R),m[p]=new Float32Array(R),m[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,d,p,m,b=-90,A=90,I=-180,R=180;const O=this.size,D=this._unmodified;if(this.latRange){const te=this.latRange;b=a.H(te[1])*this.worldSize,A=a.H(te[0])*this.worldSize,o=A-b<O.y?O.y/(A-b):0}if(this.lngRange){const te=this.lngRange;I=a.b5(a.G(te[0])*this.worldSize,0,this.worldSize),R=a.b5(a.G(te[1])*this.worldSize,0,this.worldSize),R<I&&(R+=this.worldSize),d=R-I<O.x?O.x/(R-I):0}const N=this.point,$=Math.max(d||0,o||0);if($)return this.center=this.unproject(new a.P(d?(R+I)/2:N.x,o?(A+b)/2:N.y)),this.zoom+=this.scaleZoom($),this._unmodified=D,void(this._constraining=!1);if(this.latRange){const te=N.y,ee=O.y/2;te-ee<b&&(m=b+ee),te+ee>A&&(m=A-ee)}if(this.lngRange){const te=(I+R)/2,ee=a.b5(N.x,te-this.worldSize/2,te+this.worldSize/2),se=O.x/2;ee-se<I&&(p=I+se),ee+se>R&&(p=R-se)}p===void 0&&m===void 0||(this.center=this.unproject(new a.P(p!==void 0?p:N.x,m!==void 0?m:N.y)).wrap()),this._unmodified=D,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,d=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b7(1,this.center.lat)*this.worldSize;let m=a.ao(new Float64Array(16));a.a0(m,m,[this.width/2,-this.height/2,1]),a.$(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.ao(new Float64Array(16)),a.a0(m,m,[1,-1,1]),a.$(m,m,[-1,-1,0]),a.a0(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),A=Math.min(this.elevation,this._minEleveationForCurrentTile),I=b-A*this._pixelPerMeter/Math.cos(this._pitch),R=A<0?I:b,O=Math.PI/2+this._pitch,D=this._fov*(.5+o.y/this.height),N=Math.sin(D)*R/Math.sin(a.ad(Math.PI-O-D,.01,Math.PI-.01)),$=this.getHorizon(),te=2*Math.atan($/this.cameraToCenterDistance)*(.5+o.y/(2*$)),ee=Math.sin(te)*R/Math.sin(a.ad(Math.PI-O-te,.01,Math.PI-.01)),se=Math.min(N,ee),J=1.01*(Math.cos(Math.PI/2-this._pitch)*se+R),me=this.height/50;m=new Float64Array(16),a.b8(m,this._fov,this.width/this.height,me,J),m[8]=2*-o.x/this.width,m[9]=2*o.y/this.height,a.a0(m,m,[1,-1,1]),a.$(m,m,[0,0,-this.cameraToCenterDistance]),a.b9(m,m,this._pitch),a.ae(m,m,this.angle),a.$(m,m,[-d,-p,0]),this.mercatorMatrix=a.a0([],m,[this.worldSize,this.worldSize,this.worldSize]),a.a0(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.a1(new Float64Array(16),this.labelPlaneMatrix,m),a.$(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=a.as([],m),this.pixelMatrix3D=a.a1(new Float64Array(16),this.labelPlaneMatrix,m);const Ee=this.width%2/2,ce=this.height%2/2,xe=Math.cos(this.angle),Ie=Math.sin(this.angle),Re=d-Math.round(d)+xe*Ee+Ie*ce,Le=p-Math.round(p)+xe*ce+Ie*Ee,We=new Float64Array(m);if(a.$(We,We,[Re>.5?Re-1:Re,Le>.5?Le-1:Le,0]),this.alignedProjMatrix=We,m=a.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new a.P(0,0)),d=[o.x*this.worldSize,o.y*this.worldSize,0,1];return a.ag(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,o))}getCameraQueryGeometry(o){const d=this.getCameraPoint();if(o.length===1)return[o[0],d];{let p=d.x,m=d.y,b=d.x,A=d.y;for(const I of o)p=Math.min(p,I.x),m=Math.min(m,I.y),b=Math.max(b,I.x),A=Math.max(A,I.y);return[new a.P(p,m),new a.P(b,m),new a.P(b,A),new a.P(p,A),new a.P(p,m)]}}}function ao(x,o){let d,p=!1,m=null,b=null;const A=()=>{m=null,p&&(x.apply(b,d),m=setTimeout(A,o),p=!1)};return(...I)=>(p=!0,b=this,d=I,m||A(),m)}class Ra{constructor(o){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let p;return d.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:p,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=ao(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const d=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),A=Math.round(d.lng*b)/b,I=Math.round(d.lat*b)/b,R=this._map.getBearing(),O=this._map.getPitch();let D="";if(D+=o?`/${A}/${I}/${p}`:`${p}/${I}/${A}`,(R||O)&&(D+="/"+Math.round(10*R)/10),O&&(D+=`/${Math.round(O)}`),this._hashName){const N=this._hashName;let $=!1;const te=window.location.hash.slice(1).split("&").map(ee=>{const se=ee.split("=")[0];return se===N?($=!0,`${se}=${D}`):ee}).filter(ee=>ee);return $||te.push(`${N}=${D}`),`#${te.join("&")}`}return`#${D}`}}const Lo={linearity:.3,easing:a.ba(0,0,.3,1)},cd=a.e({deceleration:2500,maxSpeed:1400},Lo),ud=a.e({deceleration:20,maxSpeed:1400},Lo),hd=a.e({deceleration:1e3,maxSpeed:360},Lo),dd=a.e({deceleration:1e3,maxSpeed:90},Lo);class fd{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.h.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=a.h.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)d.zoom+=b.zoomDelta||0,d.bearing+=b.bearingDelta||0,d.pitch+=b.pitchDelta||0,b.panDelta&&d.pan._add(b.panDelta),b.around&&(d.around=b.around),b.pinchAround&&(d.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(d.pan.mag()){const b=Ma(d.pan.mag(),p,a.e({},cd,o||{}));m.offset=d.pan.mult(b.amount/d.pan.mag()),m.center=this._map.transform.center,Gn(m,b)}if(d.zoom){const b=Ma(d.zoom,p,ud);m.zoom=this._map.transform.zoom+b.amount,Gn(m,b)}if(d.bearing){const b=Ma(d.bearing,p,hd);m.bearing=this._map.transform.bearing+a.ad(b.amount,-179,179),Gn(m,b)}if(d.pitch){const b=Ma(d.pitch,p,dd);m.pitch=this._map.transform.pitch+b.amount,Gn(m,b)}if(m.zoom||m.bearing){const b=d.pinchAround===void 0?d.around:d.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function Gn(x,o){(!x.duration||x.duration<o.duration)&&(x.duration=o.duration,x.easing=o.easing)}function Ma(x,o,d){const{maxSpeed:p,linearity:m,deceleration:b}=d,A=a.ad(x*m/(o/1e3),-p,p),I=Math.abs(A)/(b*m);return{easing:d.easing,duration:1e3*I,amount:A*(I/2)}}class un extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,p,m={}){const b=y.mousePos(d.getCanvasContainer(),p),A=d.unproject(b);super(o,a.e({point:b,lngLat:A,originalEvent:p},m)),this._defaultPrevented=!1,this.target=d}}class ka extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,p){const m=o==="touchend"?p.changedTouches:p.touches,b=y.touchPos(d.getCanvasContainer(),m),A=b.map(R=>d.unproject(R)),I=b.reduce((R,O,D,N)=>R.add(O.div(N.length)),new a.P(0,0));super(o,{points:b,point:I,lngLats:A,lngLat:d.unproject(I),originalEvent:p}),this._defaultPrevented=!1}}class pd extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}}class gd{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new pd(o.type,this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new un(o.type,this._map,o))}mouseup(o){this._map.fire(new un(o.type,this._map,o))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new un(o.type,this._map,o))}dblclick(o){return this._firePreventable(new un(o.type,this._map,o))}mouseover(o){this._map.fire(new un(o.type,this._map,o))}mouseout(o){this._map.fire(new un(o.type,this._map,o))}touchstart(o){return this._firePreventable(new ka(o.type,this._map,o))}touchmove(o){this._map.fire(new ka(o.type,this._map,o))}touchend(o){this._map.fire(new ka(o.type,this._map,o))}touchcancel(o){this._map.fire(new ka(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _d{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new un(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new un("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new un(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _s{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(a.P.convert(o),this._map.terrain)}}class md{constructor(o,d){this._map=o,this._tr=new _s(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(y.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const p=d;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(m.x,p.x),A=Math.max(m.x,p.x),I=Math.min(m.y,p.y),R=Math.max(m.y,p.y);y.setTransform(this._box,`translate(${b}px,${I}px)`),this._box.style.width=A-b+"px",this._box.style.height=R-I+"px"}mouseupWindow(o,d){if(!this._active||o.button!==0)return;const p=this._startPos,m=d;if(this.reset(),y.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(y.remove(this._box),this._box=null),y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new a.k(o,{originalEvent:d}))}}function Rn(x,o){if(x.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${o.length}`);const d={};for(let p=0;p<x.length;p++)d[x[p].identifier]=o[p];return d}class ms{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,d,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const b=new a.P(0,0);for(const A of m)b._add(A);return b.div(m.length)}(d),this.touches=Rn(p,d)))}touchmove(o,d,p){if(this.aborted||!this.centroid)return;const m=Rn(p,d);for(const b in this.touches){const A=m[b];(!A||A.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(o,d,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class kl{constructor(o){this.singleTap=new ms(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,d,p){this.singleTap.touchstart(o,d,p)}touchmove(o,d,p){this.singleTap.touchmove(o,d,p)}touchend(o,d,p){const m=this.singleTap.touchend(o,d,p);if(m){const b=o.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(m)<30;if(b&&A||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class ys{constructor(o){this._tr=new _s(o),this._zoomIn=new kl({numTouches:1,numTaps:2}),this._zoomOut=new kl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,p){this._zoomIn.touchstart(o,d,p),this._zoomOut.touchstart(o,d,p)}touchmove(o,d,p){this._zoomIn.touchmove(o,d,p),this._zoomOut.touchmove(o,d,p)}touchend(o,d,p){const m=this._zoomIn.touchend(o,d,p),b=this._zoomOut.touchend(o,d,p),A=this._tr;return m?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:A.zoom+1,around:A.unproject(m)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:A.zoom-1,around:A.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xs{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const d=this._moveFunction(...o);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(o,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,d){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const m=d.length?d[0]:d;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&y.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Tg={0:1,2:2};class nu{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const d=y.mouseButton(o);this._eventButton=d}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(d,p){const m=Tg[p];return d.buttons===void 0||(d.buttons&m)!==m}(o,this._eventButton)}isValidEndEvent(o){return y.mouseButton(o)===this._eventButton}}class yd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const Ol=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=function(o){o.preventDefault()}},Bo=({enable:x,clickTolerance:o,bearingDegreesPerPixelMoved:d=.8})=>{const p=new nu({checkCorrectEvent:m=>y.mouseButton(m)===0&&m.ctrlKey||y.mouseButton(m)===2});return new xs({clickTolerance:o,move:(m,b)=>({bearingDelta:(b.x-m.x)*d}),moveStateManager:p,enable:x,assignEvents:Ol})},vs=({enable:x,clickTolerance:o,pitchDegreesPerPixelMoved:d=-.5})=>{const p=new nu({checkCorrectEvent:m=>y.mouseButton(m)===0&&m.ctrlKey||y.mouseButton(m)===2});return new xs({clickTolerance:o,move:(m,b)=>({pitchDelta:(b.y-m.y)*d}),moveStateManager:p,enable:x,assignEvents:Ol})};class st{constructor(o,d){this._minTouches=o.cooperativeGestures?2:1,this._clickTolerance=o.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(o,d,p){return this._calculateTransform(o,d,p)}touchmove(o,d,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(o,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,d,p)}touchend(o,d,p){this._calculateTransform(o,d,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,p){p.length>0&&(this._active=!0);const m=Rn(p,d),b=new a.P(0,0),A=new a.P(0,0);let I=0;for(const O in m){const D=m[O],N=this._touches[O];N&&(b._add(D),A._add(D.sub(N)),I++,m[O]=D)}if(this._touches=m,I<this._minTouches||!A.mag())return;const R=A.div(I);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:R}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,d,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,p){if(!this._firstTwoTouches)return;o.preventDefault();const[m,b]=this._firstTwoTouches,A=Ls(p,d,m),I=Ls(p,d,b);if(!A||!I)return;const R=this._aroundCenter?null:A.add(I).div(2);return this._move([A,I],R,o)}touchend(o,d,p){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,A=Ls(p,d,m),I=Ls(p,d,b);A&&I||(this._active&&y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ls(x,o,d){for(let p=0;p<x.length;p++)if(x[p].identifier===d)return o[p]}function zo(x,o){return Math.log(x/o)/Math.LN2}class xd extends Fl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(zo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zo(this._distance,p),pinchAround:d}}}function rt(x,o){return 180*x.angleWith(o)/Math.PI}class su extends Fl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d){const p=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:rt(this._vector,p),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,p=rt(o,this._startVector);return Math.abs(p)<d}}function ou(x){return Math.abs(x.y)>Math.abs(x.x)}class Sg extends Fl{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,d,p){super.touchstart(o,d,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,ou(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const m=o[0].sub(this._lastPoints[0]),b=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(o,d,p){if(this._valid!==void 0)return this._valid;const m=o.mag()>=2,b=d.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=o.y>0==d.y>0;return ou(o)&&ou(d)&&A}}const au={panStep:100,bearingStep:15,pitchStep:10};class vd{constructor(o){this._tr=new _s(o);const d=au;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,p=0,m=0,b=0,A=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?m=1:(o.preventDefault(),A=-1);break;case 40:o.shiftKey?m=-1:(o.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:I=>{const R=this._tr;I.easeTo({duration:300,easeId:"keyboardHandler",easing:bd,zoom:d?Math.round(R.zoom)+d*(o.shiftKey?2:1):R.zoom,bearing:R.bearing+p*this._bearingStep,pitch:R.pitch+m*this._pitchStep,offset:[-b*this._panStep,-A*this._panStep],center:R.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bd(x){return x*(2-x)}const wd=4.000244140625;class Eg{constructor(o,d){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=o,this._tr=new _s(o),this._el=o.getCanvasContainer(),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!o[this._map._metaKey])return;o.preventDefault()}let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=a.h.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,d!==0&&d%wd==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(m*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=y.mousePos(this._el,o),p=this._tr;this._around=a.L.convert(this._aroundCenter?p.center:p.unproject(d)),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>wd?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&R!==0&&(R=1/R);const O=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(O*R))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,p=this._startZoom,m=this._easing;let b,A=!1;if(this._type==="wheel"&&p&&m){const I=Math.min((a.h.now()-this._lastWheelEventTime)/200,1),R=m(I);b=a.B.number(p,d,R),I<1?this._frameId||(this._frameId=!0):A=!0}else b=d,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:b-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=a.bb;if(this._prevEase){const p=this._prevEase,m=(a.h.now()-p.start)/p.duration,b=p.easing(m+.01)-p.easing(m),A=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-A*A);d=a.ba(A,I,.25,1)}return this._prevEase={start:a.h.now(),duration:o,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class lu{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cu{constructor(o){this._tr=new _s(o),this.reset()}reset(){this._active=!1}dblclick(o,d){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uu{constructor(){this._tap=new kl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,d,p){if(!this._swipePoint)if(this._tapTime){const m=d[0],b=o.timeStamp-this._tapTime<500,A=this._tapPoint.dist(m)<30;b&&A?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(o,d,p)}touchmove(o,d,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=d[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,d,p)}touchend(o,d,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(o,d,p);m&&(this._tapTime=o.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hu{constructor(o,d,p){this._el=o,this._mousePan=d,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $r{constructor(o,d,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bs{constructor(o,d,p,m){this._el=o,this._touchZoom=d,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Oa=x=>x.zoom||x.drag||x.pitch||x.rotate;class du extends a.k{}function Fa(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta}class fu{constructor(o,d){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const A=m.type==="renderFrame"?void 0:m,I={needsRenderFrame:!1},R={},O={},D=m.touches,N=D?this._getMapTouches(D):void 0,$=N?y.touchPos(this._el,N):y.mousePos(this._el,m);for(const{handlerName:se,handler:J,allowed:me}of this._handlers){if(!J.isEnabled())continue;let Ee;this._blockedByActive(O,me,se)?J.reset():J[b||m.type]&&(Ee=J[b||m.type](m,$,N),this.mergeHandlerResult(I,R,Ee,se,A),Ee&&Ee.needsRenderFrame&&this._triggerRenderFrame()),(Ee||J.isActive())&&(O[se]=J)}const te={};for(const se in this._previousActiveHandlers)O[se]||(te[se]=A);this._previousActiveHandlers=O,(Object.keys(te).length||Fa(I))&&(this._changes.push([I,R,te]),this._triggerRenderFrame()),(Object.keys(O).length||Fa(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=I;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fd(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,A]of this._listeners)y.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[o,d,p]of this._listeners)y.removeEventListener(o,d,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const d=this._map,p=d.getCanvasContainer();this._add("mapEvent",new gd(d,o));const m=d.boxZoom=new md(d,o);this._add("boxZoom",m),o.interactive&&o.boxZoom&&m.enable();const b=new ys(d),A=new cu(d);d.doubleClickZoom=new lu(A,b),this._add("tapZoom",b),this._add("clickZoom",A),o.interactive&&o.doubleClickZoom&&d.doubleClickZoom.enable();const I=new uu;this._add("tapDragZoom",I);const R=d.touchPitch=new Sg(d);this._add("touchPitch",R),o.interactive&&o.touchPitch&&d.touchPitch.enable(o.touchPitch);const O=Bo(o),D=vs(o);d.dragRotate=new $r(o,O,D),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]),o.interactive&&o.dragRotate&&d.dragRotate.enable();const N=(({enable:me,clickTolerance:Ee})=>{const ce=new nu({checkCorrectEvent:xe=>y.mouseButton(xe)===0&&!xe.ctrlKey});return new xs({clickTolerance:Ee,move:(xe,Ie)=>({around:Ie,panDelta:Ie.sub(xe)}),activateOnStart:!0,moveStateManager:ce,enable:me,assignEvents:Ol})})(o),$=new st(o,d);d.dragPan=new hu(p,N,$),this._add("mousePan",N),this._add("touchPan",$,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&d.dragPan.enable(o.dragPan);const te=new su,ee=new xd;d.touchZoomRotate=new Bs(p,ee,te,I),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&d.touchZoomRotate.enable(o.touchZoomRotate);const se=d.scrollZoom=new Eg(d,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),o.interactive&&o.scrollZoom&&d.scrollZoom.enable(o.scrollZoom);const J=d.keyboard=new vd(d);this._add("keyboard",J),o.interactive&&o.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new _d(d))}_add(o,d,p){this._handlers.push({handlerName:o,handler:d,allowed:p}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Oa(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,d,p){for(const m in o)if(m!==p&&(!d||d.indexOf(m)<0))return!0;return!1}_getMapTouches(o){const d=[];for(const p of o)this._el.contains(p.target)&&d.push(p);return d}mergeHandlerResult(o,d,p,m,b){if(!p)return;a.e(o,p);const A={handlerName:m,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(d.zoom=A),p.panDelta!==void 0&&(d.drag=A),p.pitchDelta!==void 0&&(d.pitch=A),p.bearingDelta!==void 0&&(d.rotate=A)}_applyChanges(){const o={},d={},p={};for(const[m,b,A]of this._changes)m.panDelta&&(o.panDelta=(o.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(o.around=m.around),m.pinchAround!==void 0&&(o.pinchAround=m.pinchAround),m.noInertia&&(o.noInertia=m.noInertia),a.e(d,b),a.e(p,A);this._updateMapTransform(o,d,p),this._changes=[]}_updateMapTransform(o,d,p){const m=this._map,b=m._getTransformForUpdate(),A=m.terrain;if(!(Fa(o)||A&&this._terrainMovement))return this._fireEvents(d,p,!0);let{panDelta:I,zoomDelta:R,bearingDelta:O,pitchDelta:D,around:N,pinchAround:$}=o;$!==void 0&&(N=$),m._stop(!0),N=N||m.transform.centerPoint;const te=b.pointLocation(I?N.sub(I):N);O&&(b.bearing+=O),D&&(b.pitch+=D),R&&(b.zoom+=R),A?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(I)):b.setLocationAtPoint(te,N):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(te,N),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,b.recalculateZoom(m.terrain)})):b.setLocationAtPoint(te,N),m._applyUpdatedTransform(b),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,p,!0)}_fireEvents(o,d,p){const m=Oa(this._eventsInProgress),b=Oa(o),A={};for(const D in o){const{originalEvent:N}=o[D];this._eventsInProgress[D]||(A[`${D}start`]=N),this._eventsInProgress[D]=o[D]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const D in A)this._fireEvent(D,A[D]);b&&this._fireEvent("move",b.originalEvent);for(const D in o){const{originalEvent:N}=o[D];this._fireEvent(D,N)}const I={};let R;for(const D in this._eventsInProgress){const{handlerName:N,originalEvent:$}=this._eventsInProgress[D];this._handlersById[N].isActive()||(delete this._eventsInProgress[D],R=d[N]||$,I[`${D}end`]=R)}for(const D in I)this._fireEvent(D,I[D]);const O=Oa(this._eventsInProgress);if(p&&(m||b)&&!O){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!D||!D.essential&&a.h.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:R})),N(this._map.getBearing())&&this._map.resetNorth()):(N(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:R})),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new a.k(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new du("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Td extends a.E{constructor(o,d){super(),this._renderFrameCallback=()=>{const p=Math.min((a.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.L(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,p){return o=a.P.convert(o).mult(-1),this.panTo(this.transform.center,a.e({offset:o},d),p)}panTo(o,d,p){return this.easeTo(a.e({center:o},d),p)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,p){return this.easeTo(a.e({zoom:o},d),p)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,p){return this.easeTo(a.e({bearing:o},d),p)}resetNorth(o,d){return this.rotateTo(0,a.e({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=oi.convert(o);const p=d&&d.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,d)}_cameraForBoxAndBearing(o,d,p,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Ie=m.padding;m.padding={top:Ie,bottom:Ie,right:Ie,left:Ie}}m.padding=a.e(b,m.padding);const A=this.transform,I=A.padding,R=A.project(a.L.convert(o)),O=A.project(a.L.convert(d)),D=R.rotate(-p*Math.PI/180),N=O.rotate(-p*Math.PI/180),$=new a.P(Math.max(D.x,N.x),Math.max(D.y,N.y)),te=new a.P(Math.min(D.x,N.x),Math.min(D.y,N.y)),ee=$.sub(te),se=(A.width-(I.left+I.right+m.padding.left+m.padding.right))/ee.x,J=(A.height-(I.top+I.bottom+m.padding.top+m.padding.bottom))/ee.y;if(J<0||se<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const me=Math.min(A.scaleZoom(A.scale*Math.min(se,J)),m.maxZoom),Ee=a.P.convert(m.offset),ce=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(p*Math.PI/180),xe=Ee.add(ce).mult(A.scale/A.zoomScale(me));return{center:A.unproject(R.add(O).div(2).sub(xe)),zoom:me,bearing:p}}fitBounds(o,d,p){return this._fitInternal(this.cameraForBounds(o,d),d,p)}fitScreenCoordinates(o,d,p,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(o)),this.transform.pointLocation(a.P.convert(d)),p,m),m,b)}_fitInternal(o,d,p){return o?(delete(d=a.e(o,d)).padding,d.linear?this.easeTo(d,p):this.flyTo(d,p)):this}jumpTo(o,d){this.stop();const p=this._getTransformForUpdate();let m=!1,b=!1,A=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(m=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=a.L.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(b=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(A=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",d)).fire(new a.k("move",d)),m&&this.fire(new a.k("zoomstart",d)).fire(new a.k("zoom",d)).fire(new a.k("zoomend",d)),b&&this.fire(new a.k("rotatestart",d)).fire(new a.k("rotate",d)).fire(new a.k("rotateend",d)),A&&this.fire(new a.k("pitchstart",d)).fire(new a.k("pitch",d)).fire(new a.k("pitchend",d)),this.fire(new a.k("moveend",d))}calculateCameraOptionsFromTo(o,d,p,m=0){const b=a.U.fromLngLat(o,d),A=a.U.fromLngLat(p,m),I=A.x-b.x,R=A.y-b.y,O=A.z-b.z,D=Math.hypot(I,R,O);if(D===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(I,R),$=this.transform.scaleZoom(this.transform.cameraToCenterDistance/D/this.transform.tileSize),te=180*Math.atan2(I,-R)/Math.PI;let ee=180*Math.acos(N/D)/Math.PI;return ee=O<0?90-ee:90+ee,{center:A.toLngLat(),zoom:$,pitch:ee,bearing:te}}easeTo(o,d){this._stop(!1,o.easeId),((o=a.e({offset:[0,0],duration:500,easing:a.bb},o)).animate===!1||!o.essential&&a.h.prefersReducedMotion)&&(o.duration=0);const p=this._getTransformForUpdate(),m=this.getZoom(),b=this.getBearing(),A=this.getPitch(),I=this.getPadding(),R="zoom"in o?+o.zoom:m,O="bearing"in o?this._normalizeBearing(o.bearing,b):b,D="pitch"in o?+o.pitch:A,N="padding"in o?o.padding:p.padding,$=a.P.convert(o.offset);let te=p.centerPoint.add($);const ee=p.pointLocation(te),se=a.L.convert(o.center||ee);this._normalizeCenter(se);const J=p.project(ee),me=p.project(se).sub(J),Ee=p.zoomScale(R-m);let ce,xe;o.around&&(ce=a.L.convert(o.around),xe=p.locationPoint(ce));const Ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||R!==m,this._rotating=this._rotating||b!==O,this._pitching=this._pitching||D!==A,this._padding=!p.isPaddingEqual(N),this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,Ie),this.terrain&&this._prepareElevation(se),this._ease(Re=>{if(this._zooming&&(p.zoom=a.B.number(m,R,Re)),this._rotating&&(p.bearing=a.B.number(b,O,Re)),this._pitching&&(p.pitch=a.B.number(A,D,Re)),this._padding&&(p.interpolatePadding(I,N,Re),te=p.centerPoint.add($)),this.terrain&&!o.freezeElevation&&this._updateElevation(Re),ce)p.setLocationAtPoint(ce,xe);else{const Le=p.zoomScale(p.zoom-m),We=R>m?Math.min(2,Ee):Math.max(.5,Ee),Ve=Math.pow(We,1-Re),Xe=p.unproject(J.add(me.mult(Re*Ve)).mult(Le));p.setLocationAtPoint(p.renderWorldCopies?Xe.wrap():Xe,te)}this._applyUpdatedTransform(p),this._fireMoveEvents(d)},Re=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,Re)},o),this}_prepareEase(o,d,p={}){this._moving=!0,d||p.moving||this.fire(new a.k("movestart",o)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&d!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(p-(d-(p*o+this._elevationStart))/(1-o)),this._elevationTarget=d}this.transform.elevation=a.B.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(o){if(!this.transformCameraUpdate)return;const d=o.clone(),{center:p,zoom:m,pitch:b,bearing:A,elevation:I}=this.transformCameraUpdate(d);p&&(d.center=p),m!==void 0&&(d.zoom=m),b!==void 0&&(d.pitch=b),A!==void 0&&(d.bearing=A),I!==void 0&&(d.elevation=I),this.transform.apply(d)}_fireMoveEvents(o){this.fire(new a.k("move",o)),this._zooming&&this.fire(new a.k("zoom",o)),this._rotating&&this.fire(new a.k("rotate",o)),this._pitching&&this.fire(new a.k("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const p=this._zooming,m=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",o)),m&&this.fire(new a.k("rotateend",o)),b&&this.fire(new a.k("pitchend",o)),this.fire(new a.k("moveend",o))}flyTo(o,d){if(!o.essential&&a.h.prefersReducedMotion){const ft=a.F(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ft,d)}this.stop(),o=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.bb},o);const p=this._getTransformForUpdate(),m=this.getZoom(),b=this.getBearing(),A=this.getPitch(),I=this.getPadding(),R="zoom"in o?a.ad(+o.zoom,p.minZoom,p.maxZoom):m,O="bearing"in o?this._normalizeBearing(o.bearing,b):b,D="pitch"in o?+o.pitch:A,N="padding"in o?o.padding:p.padding,$=p.zoomScale(R-m),te=a.P.convert(o.offset);let ee=p.centerPoint.add(te);const se=p.pointLocation(ee),J=a.L.convert(o.center||se);this._normalizeCenter(J);const me=p.project(se),Ee=p.project(J).sub(me);let ce=o.curve;const xe=Math.max(p.width,p.height),Ie=xe/$,Re=Ee.mag();if("minZoom"in o){const ft=a.ad(Math.min(o.minZoom,m,R),p.minZoom,p.maxZoom),ii=xe/p.zoomScale(ft-m);ce=Math.sqrt(ii/Re*2)}const Le=ce*ce;function We(ft){const ii=(Ie*Ie-xe*xe+(ft?-1:1)*Le*Le*Re*Re)/(2*(ft?Ie:xe)*Le*Re);return Math.log(Math.sqrt(ii*ii+1)-ii)}function Ve(ft){return(Math.exp(ft)-Math.exp(-ft))/2}function Xe(ft){return(Math.exp(ft)+Math.exp(-ft))/2}const ht=We(!1);let Nt=function(ft){return Xe(ht)/Xe(ht+ce*ft)},Qe=function(ft){return xe*((Xe(ht)*(Ve(ii=ht+ce*ft)/Xe(ii))-Ve(ht))/Le)/Re;var ii},Tt=(We(!0)-ht)/ce;if(Math.abs(Re)<1e-6||!isFinite(Tt)){if(Math.abs(xe-Ie)<1e-6)return this.easeTo(o,d);const ft=Ie<xe?-1:1;Tt=Math.abs(Math.log(Ie/xe))/ce,Qe=function(){return 0},Nt=function(ii){return Math.exp(ft*ce*ii)}}return o.duration="duration"in o?+o.duration:1e3*Tt/("screenSpeed"in o?+o.screenSpeed/ce:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=b!==O,this._pitching=D!==A,this._padding=!p.isPaddingEqual(N),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(J),this._ease(ft=>{const ii=ft*Tt,Ft=1/Nt(ii);p.zoom=ft===1?R:m+p.scaleZoom(Ft),this._rotating&&(p.bearing=a.B.number(b,O,ft)),this._pitching&&(p.pitch=a.B.number(A,D,ft)),this._padding&&(p.interpolatePadding(I,N,ft),ee=p.centerPoint.add(te)),this.terrain&&!o.freezeElevation&&this._updateElevation(ft);const Ct=ft===1?J:p.unproject(me.add(Ee.mult(Qe(ii))).mult(Ft));p.setLocationAtPoint(p.renderWorldCopies?Ct.wrap():Ct,ee),this._applyUpdatedTransform(p),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,d)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,d,p){p.animate===!1||p.duration===0?(o(1),d()):(this._easeStart=a.h.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,d){o=a.b5(o,-180,180);const p=Math.abs(o-d);return Math.abs(o-360-d)<p&&(o-=360),Math.abs(o+360-d)<p&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const p=o.lng-d.center.lng;o.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(a.L.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}class hn{constructor(o={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,d){const p=this._map._getUIString(`AttributionControl.${d}`);o.title=p,o.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const d=this._map.style.sourceCaches;for(const m in d){const b=d[m];if(b.used||b.usedForTerrain){const A=b.getSource();A.attribution&&o.indexOf(A.attribution)<0&&o.push(A.attribution)}}o=o.filter(m=>String(m).trim()),o.sort((m,b)=>m.length-b.length),o=o.filter((m,b)=>{for(let A=b+1;A<o.length;A++)if(o[A].indexOf(m)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class fi{constructor(o={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const p=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=y.create("div","maplibregl-ctrl");const d=y.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Dl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,p=d?this._queue.concat(d):this._queue;for(const m of p)if(m.id===o)return void(m.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const p of d)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const pu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Sd=a.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Ed extends a.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,d){this.sourceCache.update(o,d),this._renderableTilesKeys=[];const p={};for(const m of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aS(m.posMatrix,0,a.N,0,a.N,0,1),this._tiles[m.key]=new Ln(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(o){for(const d in this._tiles){const p=this._tiles[d];(!o||p.tileID.equals(o)||p.tileID.isChildOf(o)||o.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const d={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(o.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16),a.aS(b.posMatrix,0,a.N,0,a.N,0,1),d[p]=b}else if(m.canonical.isChildOf(o.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16);const A=m.canonical.z-o.canonical.z,I=m.canonical.x-(m.canonical.x>>A<<A),R=m.canonical.y-(m.canonical.y>>A<<A),O=a.N>>A;a.aS(b.posMatrix,0,O,0,O,0,1),a.$(b.posMatrix,b.posMatrix,[-I*O,-R*O,0]),d[p]=b}else if(o.canonical.isChildOf(m.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16);const A=o.canonical.z-m.canonical.z,I=o.canonical.x-(o.canonical.x>>A<<A),R=o.canonical.y-(o.canonical.y>>A<<A),O=a.N>>A;a.aS(b.posMatrix,0,a.N,0,a.N,0,1),a.$(b.posMatrix,b.posMatrix,[I*O,R*O,0]),a.a0(b.posMatrix,b.posMatrix,[1/2**A,1/2**A,0]),d[p]=b}}return d}getSourceTile(o,d){const p=this.sourceCache._source;let m=o.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!b||!b.dem)&&d)for(;m>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(o.scaledTo(m--).key);return b}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=o)}}class Ad{constructor(o,d,p){this.painter=o,this.sourceCache=new Ed(d),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,d,p,m=a.N){var b;if(!(d>=0&&d<m&&p>=0&&p<m))return 0;const A=this.getTerrainData(o),I=(b=A.tile)===null||b===void 0?void 0:b.dem;if(!I)return 0;const R=function(ee,se,J){var me=se[0],Ee=se[1];return ee[0]=J[0]*me+J[4]*Ee+J[12],ee[1]=J[1]*me+J[5]*Ee+J[13],ee}([],[d/m*a.N,p/m*a.N],A.u_terrain_matrix),O=[R[0]*I.dim,R[1]*I.dim],D=Math.floor(O[0]),N=Math.floor(O[1]),$=O[0]-D,te=O[1]-N;return I.get(D,N)*(1-$)*(1-te)+I.get(D+1,N)*$*(1-te)+I.get(D,N+1)*(1-$)*te+I.get(D+1,N+1)*$*te}getElevationForLngLatZoom(o,d){const{tileID:p,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(o,d);return this.getElevation(p,m%a.N,b%a.N,a.N)}getElevation(o,d,p,m=a.N){return this.getDEMElevation(o,d,p,m)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const m=this.painter.context,b=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ue(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ue(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ao([])}const d=this.sourceCache.getSourceTile(o,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const m=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new Ue(m,d.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),d.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const p=d&&d+d.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=o.canonical.z-d.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=m?b=o.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const A=o.canonical.x-(o.canonical.x>>b<<b),I=o.canonical.y-(o.canonical.y>>b<<b),R=a.bc(new Float64Array(16),[1/(a.N<<b),1/(a.N<<b),0]);a.$(R,R,[A*a.N,I*a.N,0]),this._demMatrixCache[o.key]={matrix:R,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(o){const d=this.painter,p=d.width/devicePixelRatio,m=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ue(d.context,{width:p,height:m,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ue(d.context,{width:p,height:m,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,A=0;b<this._coordsTextureSize;b++)for(let I=0;I<this._coordsTextureSize;I++,A+=4)d[A+0]=255&I,d[A+1]=255&b,d[A+2]=I>>8<<4|b>>8,d[A+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),m=new Ue(o,p,o.gl.RGBA,{premultiply:!1});return m.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(o){const d=new Uint8Array(4),p=this.painter.context,m=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,d),p.bindFramebuffer.set(null);const b=d[0]+(d[2]>>4<<8),A=d[1]+((15&d[2])<<8),I=this.coordsIndex[255-d[3]],R=I&&this.sourceCache.getTileByID(I);if(!R)return null;const O=this._coordsTextureSize,D=(1<<R.tileID.canonical.z)*O;return new a.U(this._allowMercatorOverflow(o,(R.tileID.canonical.x*O+b)/D),(R.tileID.canonical.y*O+A)/D,this.getElevation(R.tileID,b,A,O))}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,d=new a.bd,p=new a.b0,m=this.meshSize,b=a.N/m,A=m*m;for(let N=0;N<=m;N++)for(let $=0;$<=m;$++)d.emplaceBack($*b,N*b,0);for(let N=0;N<A;N+=m+1)for(let $=0;$<m;$++)p.emplaceBack($+N,m+$+N+1,m+$+N+2),p.emplaceBack($+N,m+$+N+2,$+N+1);const I=d.length,R=I+2*(m+1);for(const N of[0,1])for(let $=0;$<=m;$++)for(const te of[0,1])d.emplaceBack($*b,N*a.N,te);for(let N=0;N<2*m;N+=2)p.emplaceBack(R+N,R+N+1,R+N+3),p.emplaceBack(R+N,R+N+3,R+N+2),p.emplaceBack(I+N,I+N+3,I+N+1),p.emplaceBack(I+N,I+N+2,I+N+3);const O=d.length,D=O+2*(m+1);for(const N of[0,1])for(let $=0;$<=m;$++)for(const te of[0,1])d.emplaceBack(N*a.N,$*b,te);for(let N=0;N<2*m;N+=2)p.emplaceBack(O+N,O+N+1,O+N+3),p.emplaceBack(O+N,O+N+3,O+N+2),p.emplaceBack(D+N,D+N+3,D+N+1),p.emplaceBack(D+N,D+N+2,D+N+3);return this._mesh={indexBuffer:o.createIndexBuffer(p),vertexBuffer:o.createVertexBuffer(d,Sd.members),segments:a.S.simpleSegment(0,0,d.length,p.length)},this._mesh}getMeshFrameDelta(o){return 2*Math.PI*a.be/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,d){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(o,d);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(o){const d=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return d&&d.dem&&(p.minElevation=d.dem.min*this.exaggeration,p.maxElevation=d.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(o,d){const p=a.U.fromLngLat(o.wrap()),m=(1<<d)*a.N,b=p.x*m,A=p.y*m,I=Math.floor(b/a.N),R=Math.floor(A/a.N);return{tileID:new a.O(d,0,d,I,R),mercatorX:b,mercatorY:A}}_allowMercatorOverflow(o,d){const p=o.x<this.painter.width/2;let m=a.bf(d);const b=this.painter.transform.center.lng;return p&&Math.sign(m)>0&&Math.sign(b)<0||!p&&Math.sign(m)<0&&Math.sign(b)>0?(m=360*Math.sign(b)+m,a.G(m)):d}}class Ag{constructor(o,d,p){this._context=o,this._size=d,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new Ue(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(p.texture),{id:o,fbo:d,texture:p,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>o.id!==d),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const Pr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Nl{constructor(o,d){this.painter=o,this.terrain=d,this.pool=new Ag(o.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(p=>!o._layers[p].isHidden(d)),this._coordsDescendingInv={};for(const p in o.sourceCaches){this._coordsDescendingInv[p]={};const m=o.sourceCaches[p].getVisibleCoordinates();for(const b of m){const A=this.terrain.sourceCache.getTerrainCoords(b);for(const I in A)this._coordsDescendingInv[p][I]||(this._coordsDescendingInv[p][I]=[]),this._coordsDescendingInv[p][I].push(A[I])}}this._coordsDescendingInvStr={};for(const p of o._order){const m=o._layers[p],b=m.source;if(Pr[m.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const A in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][A]=this._coordsDescendingInv[b][A].map(I=>I.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[m][p.tileID.key];b&&b!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const d=o.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(Pr[d]&&(this._prevType&&Pr[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(o.id),!m))return!0;if(Pr[this._prevType]||Pr[d]&&m){this._prevType=d;const b=this._stacks.length-1,A=this._stacks[b]||[];for(const I of this._renderableTiles){if(this.pool.isFull()&&(Ii(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(I),I.rtt[b]){const O=this.pool.getObjectForId(I.rtt[b].id);if(O.stamp===I.rtt[b].stamp){this.pool.useObject(O);continue}}const R=this.pool.getOrCreateFreeObject();this.pool.useObject(R),this.pool.stampObject(R),I.rtt[b]={id:R.id,stamp:R.stamp},p.context.bindFramebuffer.set(R.fbo.framebuffer),p.context.clear({color:a.aT.transparent,stencil:0}),p.currentStencilSource=void 0;for(let O=0;O<A.length;O++){const D=p.style._layers[A[O]],N=D.source?this._coordsDescendingInv[D.source][I.tileID.key]:[I.tileID];p.context.viewport.set([0,0,R.fbo.width,R.fbo.height]),p._renderTileClippingMasks(D,N),p.renderLayer(p,p.style.sourceCaches[D.source],D,N),D.source&&(I.rttCoords[D.source]=this._coordsDescendingInvStr[D.source][I.tileID.key])}}return Ii(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Pr[d]}return!1}}const _t=g,wt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Da=x=>{x.touchstart=x.dragStart,x.touchmoveWindow=x.dragMove,x.touchend=x.dragEnd},gu={showCompass:!0,showZoom:!0,visualizePitch:!1};class _u{constructor(o,d,p=!1){this.mousedown=A=>{this.startMouse(a.e({},A,{ctrlKey:!0,preventDefault:()=>A.preventDefault()}),y.mousePos(this.element,A)),y.addEventListener(window,"mousemove",this.mousemove),y.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=A=>{this.moveMouse(A,y.mousePos(this.element,A))},this.mouseup=A=>{this.mouseRotate.dragEnd(A),this.mousePitch&&this.mousePitch.dragEnd(A),this.offTemp()},this.touchstart=A=>{A.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=y.touchPos(this.element,A.targetTouches)[0],this.startTouch(A,this._startPos),y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.addEventListener(window,"touchend",this.touchend))},this.touchmove=A=>{A.targetTouches.length!==1?this.reset():(this._lastPos=y.touchPos(this.element,A.targetTouches)[0],this.moveTouch(A,this._lastPos))},this.touchend=A=>{A.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=o.dragRotate._mouseRotate.getClickTolerance(),b=o.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=Bo({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:A,clickTolerance:I,bearingDegreesPerPixelMoved:R=.8})=>{const O=new yd;return new xs({clickTolerance:I,move:(D,N)=>({bearingDelta:(N.x-D.x)*R}),moveStateManager:O,enable:A,assignEvents:Da})})({clickTolerance:m,enable:!0}),this.map=o,p&&(this.mousePitch=vs({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:A,clickTolerance:I,pitchDegreesPerPixelMoved:R=-.5})=>{const O=new yd;return new xs({clickTolerance:I,move:(D,N)=>({pitchDelta:(N.y-D.y)*R}),moveStateManager:O,enable:A,assignEvents:Da})})({clickTolerance:b,enable:!0})),y.addEventListener(d,"mousedown",this.mousedown),y.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),y.addEventListener(d,"touchcancel",this.reset)}startMouse(o,d){this.mouseRotate.dragStart(o,d),this.mousePitch&&this.mousePitch.dragStart(o,d),y.disableDrag()}startTouch(o,d){this.touchRotate.dragStart(o,d),this.touchPitch&&this.touchPitch.dragStart(o,d),y.disableDrag()}moveMouse(o,d){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(o,d)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(o,d)||{};b&&p.setPitch(p.getPitch()+b)}}moveTouch(o,d){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(o,d)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(o,d)||{};b&&p.setPitch(p.getPitch()+b)}}off(){const o=this.element;y.removeEventListener(o,"mousedown",this.mousedown),y.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.removeEventListener(window,"touchend",this.touchend),y.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){y.enableDrag(),y.removeEventListener(window,"mousemove",this.mousemove),y.removeEventListener(window,"mouseup",this.mouseup),y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.removeEventListener(window,"touchend",this.touchend)}}let zi;function mu(x,o,d){if(x=new a.L(x.lng,x.lat),o){const p=new a.L(x.lng-360,x.lat),m=new a.L(x.lng+360,x.lat),b=d.locationPoint(x).distSqr(o);d.locationPoint(p).distSqr(o)<b?x=p:d.locationPoint(m).distSqr(o)<b&&(x=m)}for(;Math.abs(x.lng-d.center.lng)>180;){const p=d.locationPoint(x);if(p.x>=0&&p.y>=0&&p.x<=d.width&&p.y<=d.height)break;x.lng>d.center.lng?x.lng-=360:x.lng+=360}return x}const Mn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Pd(x,o,d){const p=x.classList;for(const m in Mn)p.remove(`maplibregl-${d}-anchor-${m}`);p.add(`maplibregl-${d}-anchor-${o}`)}class lo extends a.E{constructor(o){if(super(),this._onKeyPress=d=>{const p=d.code,m=d.charCode||d.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=d=>{const p=d.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!p)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=mu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),y.setTransform(this._element,`${Mn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${m}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const A=this._map.unproject(this._pos),I=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=A.distanceTo(this._lngLat)>20*I?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=d=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=a.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=y.create("div"),this._element.setAttribute("aria-label","Map marker");const d=y.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${p}px`),d.setAttributeNS(null,"width",`${m}px`),d.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const b=y.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const A=y.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const I=y.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const R=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const me of R){const Ee=y.createNS("http://www.w3.org/2000/svg","ellipse");Ee.setAttributeNS(null,"opacity","0.04"),Ee.setAttributeNS(null,"cx","10.5"),Ee.setAttributeNS(null,"cy","5.80029008"),Ee.setAttributeNS(null,"rx",me.rx),Ee.setAttributeNS(null,"ry",me.ry),I.appendChild(Ee)}const O=y.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill",this._color);const D=y.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),O.appendChild(D);const N=y.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const $=y.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild($);const te=y.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const ee=y.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=y.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const J=y.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#FFFFFF"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962"),ee.appendChild(se),ee.appendChild(J),A.appendChild(I),A.appendChild(O),A.appendChild(N),A.appendChild(te),A.appendChild(ee),d.appendChild(A),d.setAttributeNS(null,"height",p*this._scale+"px"),d.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(d),this._offset=a.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),Pd(this._element,this._anchor,"marker"),o&&o.className)for(const d of o.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=a.L.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const m=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(o){return this._offset=a.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Ci={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ai=0,Uo=!1;const Na={maxWidth:100,unit:"metric"};function La(x,o,d){const p=d&&d.maxWidth||100,m=x._container.clientHeight/2,b=x.unproject([0,m]),A=x.unproject([p,m]),I=b.distanceTo(A);if(d&&d.unit==="imperial"){const R=3.2808*I;R>5280?co(o,p,R/5280,x._getUIString("ScaleControl.Miles")):co(o,p,R,x._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?co(o,p,I/1852,x._getUIString("ScaleControl.NauticalMiles")):I>=1e3?co(o,p,I/1e3,x._getUIString("ScaleControl.Kilometers")):co(o,p,I,x._getUIString("ScaleControl.Meters"))}function co(x,o,d,p){const m=function(b){const A=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/A;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(R){const O=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*O)/O}(I),A*I}(d);x.style.width=o*(m/d)+"px",x.innerHTML=`${m}&nbsp;${p}`}const yu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},xu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Vo(x){if(x){if(typeof x=="number"){const o=Math.round(Math.abs(x)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,x),"top-left":new a.P(o,o),"top-right":new a.P(-o,o),bottom:new a.P(0,-x),"bottom-left":new a.P(o,-o),"bottom-right":new a.P(-o,-o),left:new a.P(x,0),right:new a.P(-x,0)}}if(x instanceof a.P||Array.isArray(x)){const o=a.P.convert(x);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:a.P.convert(x.center||[0,0]),top:a.P.convert(x.top||[0,0]),"top-left":a.P.convert(x["top-left"]||[0,0]),"top-right":a.P.convert(x["top-right"]||[0,0]),bottom:a.P.convert(x.bottom||[0,0]),"bottom-left":a.P.convert(x["bottom-left"]||[0,0]),"bottom-right":a.P.convert(x["bottom-right"]||[0,0]),left:a.P.convert(x.left||[0,0]),right:a.P.convert(x.right||[0,0])}}return Vo(new a.P(0,0))}const vu={extend:(x,...o)=>a.e(x,...o),run(x){x()},logToElement(x,o=!1,d="log"){const p=window.document.getElementById(d);p&&(o&&(p.innerHTML=""),p.innerHTML+=`<br>${x}`)}},bu=g;class Zt{static get version(){return bu}static get workerCount(){return Sn.workerCount}static set workerCount(o){Sn.workerCount=o}static get maxParallelImageRequests(){return a.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(o){a.c.MAX_PARALLEL_IMAGE_REQUESTS=o}static get workerUrl(){return a.c.WORKER_URL}static set workerUrl(o){a.c.WORKER_URL=o}static addProtocol(o,d){a.c.REGISTERED_PROTOCOLS[o]=d}static removeProtocol(o){delete a.c.REGISTERED_PROTOCOLS[o]}}return Zt.Map=class extends Td{constructor(x){if(a.bg.mark(a.bh.create),(x=a.e({},wt,x)).minZoom!=null&&x.maxZoom!=null&&x.minZoom>x.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(x.minPitch!=null&&x.maxPitch!=null&&x.minPitch>x.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(x.minPitch!=null&&x.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(x.maxPitch!=null&&x.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ml(x.minZoom,x.maxZoom,x.minPitch,x.maxPitch,x.renderWorldCopies),{bearingSnap:x.bearingSnap}),this._cooperativeGesturesOnWheel=o=>{this._onCooperativeGesture(o,o[this._metaKey],1)},this._contextLost=o=>{o.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=x.interactive,this._cooperativeGestures=x.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=x.maxTileCacheSize,this._maxTileCacheZoomLevels=x.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=x.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=x.preserveDrawingBuffer,this._antialias=x.antialias,this._trackResize=x.trackResize,this._bearingSnap=x.bearingSnap,this._refreshExpiredTiles=x.refreshExpiredTiles,this._fadeDuration=x.fadeDuration,this._crossSourceCollisions=x.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=x.collectResourceTiming,this._renderTaskQueue=new Dl,this._controls=[],this._mapId=a.a2(),this._locale=a.e({},pu,x.locale),this._clickTolerance=x.clickTolerance,this._overridePixelRatio=x.pixelRatio,this._maxCanvasSize=x.maxCanvasSize,this.transformCameraUpdate=x.transformCameraUpdate,this._imageQueueHandle=Z.addThrottleControl(()=>this.isMoving()),this._requestManager=new fe(x.transformRequest),typeof x.container=="string"){if(this._container=document.getElementById(x.container),!this._container)throw new Error(`Container '${x.container}' not found.`)}else{if(!(x.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=x.container}if(x.maxBounds&&this.setMaxBounds(x.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const d=ao(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{o?d(p):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new fu(this,x),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=x.hash&&new Ra(typeof x.hash=="string"&&x.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch}),x.bounds&&(this.resize(),this.fitBounds(x.bounds,a.e({},x.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=x.localIdeographFontFamily,this._validateStyle=x.validateStyle,x.style&&this.setStyle(x.style,{localIdeographFontFamily:x.localIdeographFontFamily}),x.attributionControl&&this.addControl(new hn({customAttribution:x.customAttribution})),x.maplibreLogo&&this.addControl(new fi,x.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new a.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new a.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new a.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(x,o){if(o===void 0&&(o=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=x.onAdd(this);this._controls.push(x);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(d,p.firstChild):p.appendChild(d),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(x);return o>-1&&this._controls.splice(o,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}calculateCameraOptionsFromTo(x,o,d,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(x,o,d,p)}resize(x){var o;const d=this._containerDimensions(),p=d[0],m=d[1],b=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,b),this.painter.resize(p,m,b),this.painter.overLimit()){const I=this.painter.context.gl;this._maxCanvasSize=[I.drawingBufferWidth,I.drawingBufferHeight];const R=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,R),this.painter.resize(p,m,R)}this.transform.resize(p,m),(o=this._requestedCameraState)===null||o===void 0||o.resize(p,m);const A=!this._moving;return A&&(this.stop(),this.fire(new a.k("movestart",x)).fire(new a.k("move",x))),this.fire(new a.k("resize",x)),A&&this.fire(new a.k("moveend",x)),this}_getClampedPixelRatio(x,o){const{0:d,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),b=x*m,A=o*m;return Math.min(b>d?d/b:1,A>p?p/A:1)*m}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(oi.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.minZoom=x,this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.maxZoom=x,this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.minPitch=x,this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(x>=this.transform.minPitch)return this.transform.maxPitch=x,this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.renderWorldCopies=x,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(x){return this._cooperativeGestures=x,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(x){return this.transform.locationPoint(a.L.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.pointLocation(a.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,o,d){if(x==="mouseenter"||x==="mouseover"){let p=!1;return{layer:o,listener:d,delegates:{mousemove:b=>{const A=this.getLayer(o)?this.queryRenderedFeatures(b.point,{layers:[o]}):[];A.length?p||(p=!0,d.call(this,new un(x,this,b.originalEvent,{features:A}))):p=!1},mouseout:()=>{p=!1}}}}if(x==="mouseleave"||x==="mouseout"){let p=!1;return{layer:o,listener:d,delegates:{mousemove:A=>{(this.getLayer(o)?this.queryRenderedFeatures(A.point,{layers:[o]}):[]).length?p=!0:p&&(p=!1,d.call(this,new un(x,this,A.originalEvent)))},mouseout:A=>{p&&(p=!1,d.call(this,new un(x,this,A.originalEvent)))}}}}{const p=m=>{const b=this.getLayer(o)?this.queryRenderedFeatures(m.point,{layers:[o]}):[];b.length&&(m.features=b,d.call(this,m),delete m.features)};return{layer:o,listener:d,delegates:{[x]:p}}}}on(x,o,d){if(d===void 0)return super.on(x,o);const p=this._createDelegatedListener(x,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(x,o,d){if(d===void 0)return super.once(x,o);const p=this._createDelegatedListener(x,o,d);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(x,o,d){return d===void 0?super.off(x,o):(this._delegatedListeners&&this._delegatedListeners[x]&&(p=>{const m=this._delegatedListeners[x];for(let b=0;b<m.length;b++){const A=m[b];if(A.layer===o&&A.listener===d){for(const I in A.delegates)this.off(I,A.delegates[I]);return m.splice(b,1),this}}})(),this)}queryRenderedFeatures(x,o){if(!this.style)return[];let d;const p=x instanceof a.P||Array.isArray(x),m=p?x:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(p?{}:x)||{},m instanceof a.P||typeof m[0]=="number")d=[a.P.convert(m)];else{const b=a.P.convert(m[0]),A=a.P.convert(m[1]);d=[b,new a.P(A.x,b.y),A,new a.P(b.x,A.y),b]}return this.style.queryRenderedFeatures(d,o,this.transform)}querySourceFeatures(x,o){return this.style.querySourceFeatures(x,o)}setStyle(x,o){return(o=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(x,o))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const o=this._locale[x];if(o==null)throw new Error(`Missing UI string '${x}'`);return o}_updateStyle(x,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(x,o));const d=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new ri(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,o,d):this.style.loadJSON(x,o,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ri(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,o){if(typeof x=="string"){const d=this._requestManager.transformRequest(x,G.Style);a.f(d,(p,m)=>{p?this.fire(new a.j(p)):m&&this._updateDiff(m,o)})}else typeof x=="object"&&this._updateDiff(x,o)}_updateDiff(x,o){try{this.style.setState(x,o)&&this._update(!0)}catch(d){a.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(x,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(x,o){return this._lazyInitEmptyStyle(),this.style.addSource(x,o),this._update(!0)}isSourceLoaded(x){const o=this.style&&this.style.sourceCaches[x];if(o!==void 0)return o.loaded();this.fire(new a.j(new Error(`There is no source with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const o=this.style.sourceCaches[x.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);for(const d in this.style._layers){const p=this.style._layers[d];p.type==="hillshade"&&p.source===x.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ad(this.painter,o,x),this.painter.renderToTexture=new Nl(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==x.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:x})),this}getTerrain(){var x,o;return(o=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const x=this.style&&this.style.sourceCaches;for(const o in x){const d=x[o]._tiles;for(const p in d){const m=d[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(x,o,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(x,o,d)}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}addImage(x,o,d={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:b,stretchY:A,content:I}=d;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||a.a(o))){if(o.width===void 0||o.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:O,data:D}=o,N=o;return this.style.addImage(x,{data:new a.R({width:R,height:O},new Uint8Array(D)),pixelRatio:p,stretchX:b,stretchY:A,content:I,sdf:m,version:0,userImage:N}),N.onAdd&&N.onAdd(this,x),this}}{const{width:R,height:O,data:D}=a.h.getImageData(o);this.style.addImage(x,{data:new a.R({width:R,height:O},D),pixelRatio:p,stretchX:b,stretchY:A,content:I,sdf:m,version:0})}}updateImage(x,o){const d=this.style.getImage(x);if(!d)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||a.a(o)?a.h.getImageData(o):o,{width:m,height:b,data:A}=p;if(m===void 0||b===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==d.data.width||b!==d.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(o instanceof HTMLImageElement||a.a(o));return d.data.replace(A,I),this.style.updateImage(x,d),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x,o){Z.getImage(this._requestManager.transformRequest(x,G.Image),o)}listImages(){return this.style.listImages()}addLayer(x,o){return this._lazyInitEmptyStyle(),this.style.addLayer(x,o),this._update(!0)}moveLayer(x,o){return this.style.moveLayer(x,o),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,o,d){return this.style.setLayerZoomRange(x,o,d),this._update(!0)}setFilter(x,o,d={}){return this.style.setFilter(x,o,d),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,o,d,p={}){return this.style.setPaintProperty(x,o,d,p),this._update(!0)}getPaintProperty(x,o){return this.style.getPaintProperty(x,o)}setLayoutProperty(x,o,d,p={}){return this.style.setLayoutProperty(x,o,d,p),this._update(!0)}getLayoutProperty(x,o){return this.style.getLayoutProperty(x,o)}setGlyphs(x,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,o,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(x,o,d,p=>{p||this._update(!0)}),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(x,o,d=>{d||this._update(!0)}),this}setLight(x,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(x,o){return this.style.setFeatureState(x,o),this._update()}removeFeatureState(x,o){return this.style.removeFeatureState(x,o),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,o=0;return this._container&&(x=this._container.clientWidth||400,o=this._container.clientHeight||300),[x,o]}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const o=this._canvasContainer=y.create("div","maplibregl-canvas-container",x);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=y.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),p=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],p);const m=this._controlContainer=y.create("div","maplibregl-control-container",x),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(A=>{b[A]=y.create("div",`maplibregl-ctrl-${A} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=y.create("div","maplibregl-cooperative-gesture-screen",this._container);let x=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(x=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${x}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){y.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(x,o,d){this._canvas.width=Math.floor(d*x),this._canvas.height=Math.floor(d*o),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const x={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{o={requestedAttributes:x},p&&(o.statusMessage=p.statusMessage,o.type=p.type)},{once:!0});const d=this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x);if(!d){const p="Failed to initialize WebGL";throw o?(o.message=p,new Error(JSON.stringify(o))):new Error(p)}this.painter=new oo(d,this.transform),T.testSupport(d)}_onCooperativeGesture(x,o,d){return!o&&d<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,b=a.h.now();this.style.zoomHistory.update(m,b);const A=new a.a8(m,{now:b,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),I=A.crossFadingFactor();I===1&&I===this._crossFadingFactor||(d=!0,this._crossFadingFactor=I),this.style.update(A)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bg.mark(a.bh.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bg.mark(a.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Z.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),y.remove(this._canvasContainer),y.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),a.bg.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.h.frame(x=>{a.bg.frame(x),this._frame=null,this._render(x)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return _t}getCameraTargetElevation(){return this.transform.elevation}},Zt.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const o=this._map.getZoom(),d=o===this._map.getMaxZoom(),p=o===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,d)=>{const p=this._map._getUIString(`NavigationControl.${d}`);o.title=p,o.setAttribute("aria-label",p)},this.options=a.e({},gu,x),this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _u(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,o){const d=y.create("button",x,this._container);return d.type="button",d.addEventListener("click",o),d}},Zt.GeolocateControl=class extends a.E{constructor(x){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const d=new a.L(o.coords.longitude,o.coords.latitude),p=o.coords.accuracy,m=this._map.getBearing(),b=a.e({bearing:m},this.options.fitBoundsOptions),A=oi.fromLngLat(d,p);this._map.fitBounds(A,b,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const d=new a.L(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&Uo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=o=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=y.create("button","maplibregl-ctrl-geolocate",this._container),y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",o===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new lo({element:this._dotElement}),this._circleElement=y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new lo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},Ci,x)}onAdd(x){return this._map=x,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(o,d=!1){zi===void 0||d?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(p=>{zi=p.state!=="denied",o(zi)}).catch(()=>{zi=!!window.navigator.geolocation,o(zi)}):(zi=!!window.navigator.geolocation,o(zi)):o(zi)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ai=0,Uo=!1}_isOutOfMapMaxBounds(x){const o=this._map.getMaxBounds(),d=x.coords;return o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const x=this._map.getBounds(),o=x.getSouthEast(),d=x.getNorthEast(),p=o.distanceTo(d),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ai--,Uo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ai++,Ai>1?(x={maximumAge:6e5,timeout:0},Uo=!0):(x=this.options.positionOptions,Uo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Zt.AttributionControl=hn,Zt.LogoControl=fi,Zt.ScaleControl=class{constructor(x){this._onMove=()=>{La(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,La(this._map,this._container,this.options)},this.options=a.e({},Na,x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Zt.FullscreenControl=class extends a.E{constructor(x={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);y.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Zt.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=x}onAdd(x){return this._map=x,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=y.create("button","maplibregl-ctrl-terrain",this._container),y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Zt.Popup=class extends a.E{constructor(x){super(),this.remove=()=>(this._content&&y.remove(this._content),this._container&&(y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.k("close")),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const A of this.options.className.split(" "))this._container.classList.add(A);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=mu(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!o)return;const d=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);let p=this.options.anchor;const m=Vo(this.options.offset);if(!p){const A=this._container.offsetWidth,I=this._container.offsetHeight;let R;R=d.y+m.bottom.y<I?["top"]:d.y>this._map.transform.height-I?["bottom"]:[],d.x<A/2?R.push("left"):d.x>this._map.transform.width-A/2&&R.push("right"),p=R.length===0?"bottom":R.join("-")}const b=d.add(m[p]).round();y.setTransform(this._container,`${Mn[p]} translate(${b.x}px,${b.y}px)`),Pd(this._container,p,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(yu),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=a.L.convert(x),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const o=document.createDocumentFragment(),d=document.createElement("body");let p;for(d.innerHTML=x;p=d.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){this._container&&this._container.classList.add(x)}removeClassName(x){this._container&&this._container.classList.remove(x)}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}_createCloseButton(){this.options.closeButton&&(this._closeButton=y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(xu);x&&x.focus()}},Zt.Marker=lo,Zt.Style=ri,Zt.LngLat=a.L,Zt.LngLatBounds=oi,Zt.Point=a.P,Zt.MercatorCoordinate=a.U,Zt.Evented=a.E,Zt.AJAXError=a.bi,Zt.config=a.c,Zt.CanvasSource=Nr,Zt.GeoJSONSource=mr,Zt.ImageSource=ci,Zt.RasterDEMTileSource=Mi,Zt.RasterTileSource=Os,Zt.VectorTileSource=hs,Zt.VideoSource=Xn,Zt.setRTLTextPlugin=a.bj,Zt.getRTLTextPluginStatus=a.bk,Zt.prewarm=function(){to().acquire(jt)},Zt.clearPrewarmedResources=function(){const x=En;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(jt),En=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},vu.extend(Zt,{isSafari:a.ac,getPerformanceMetrics:a.bg.getPerformanceMetrics}),Zt});var h=n;return h})})(eT);var OP=eT.exports;const FP=Wp(OP);function Xf(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const wy=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),pv=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);pv&&parseFloat(pv[1]);const Gd=globalThis,Zl=globalThis.process||{},DP=globalThis.navigator||{};function iT(t){var r,n;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((n=process.versions)!=null&&n.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,i=t||e;return!!(i&&i.indexOf("Electron")>=0)}function va(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||iT()}function NP(t){return!t&&!va()?"Node":iT(t)?"Electron":(t||DP.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const rT="4.0.7";function LP(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class BP{constructor(e,i,r="sessionStorage"){this.storage=LP(r),this.id=e,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function zP(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function UP(t,e=8){const i=Math.max(e-t.length,0);return`${" ".repeat(i)}${t}`}var Zf;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Zf||(Zf={}));const VP=10;function gv(t){return typeof t!="string"?t:(t=t.toUpperCase(),Zf[t]||Zf.WHITE)}function $P(t,e,i){return!va&&typeof t=="string"&&(e&&(t=`\x1B[${gv(e)}m${t}\x1B[39m`),i&&(t=`\x1B[${gv(i)+VP}m${t}\x1B[49m`)),t}function jP(t,e=["constructor"]){const i=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(i),n=t;for(const l of r){const h=n[l];typeof h=="function"&&(e.find(a=>l===a)||(n[l]=h.bind(t)))}}function Ty(t,e){if(!t)throw new Error(e||"Assertion failed")}function Yl(){var e,i,r;let t;if(va()&&Gd.performance)t=(i=(e=Gd==null?void 0:Gd.performance)==null?void 0:e.now)==null?void 0:i.call(e);else if("hrtime"in Zl){const n=(r=Zl==null?void 0:Zl.hrtime)==null?void 0:r.call(Zl);t=n[0]*1e3+n[1]/1e6}else t=Date.now();return t}const Kl={debug:va()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},WP={enabled:!0,level:0};function Gl(){}const _v={},mv={once:!0};class Dh{constructor({id:e}={id:""}){this.VERSION=rT,this._startTs=Yl(),this._deltaTs=Yl(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new BP(`__probe-${this.id}__`,WP),this.timeStamp(`${this.id} started`),jP(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Yl()-this._startTs).toPrecision(10))}getDelta(){return Number((Yl()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.setConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){if(!e)throw new Error(i||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Kl.warn,arguments,mv)}error(e){return this._getLogFunction(0,e,Kl.error,arguments)}deprecated(e,i){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(e,i){return this.error(`\`${e}\` has been removed. Use \`${i}\` instead`)}probe(e,i){return this._getLogFunction(e,i,Kl.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,Kl.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){return this._getLogFunction(e,i,Kl.debug||Kl.info,arguments,mv)}table(e,i,r){return i?this._getLogFunction(e,i,console.table||Gl,r&&[r],{tag:qP(i)}):Gl}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||Gl)}group(e,i,r={collapsed:!1}){const n=yv({logLevel:e,message:i,opts:r}),{collapsed:l}=r;return n.method=(l?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,i,r={}){return this.group(e,i,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Gl)}withGroup(e,i,r){this.group(e,i)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=nT(e)}_getLogFunction(e,i,r,n,l){if(this._shouldLog(e)){l=yv({logLevel:e,message:i,args:n,opts:l}),r=r||l.method,Ty(r),l.total=this.getTotal(),l.delta=this.getDelta(),this._deltaTs=Yl();const h=l.tag||l.message;if(l.once&&h)if(!_v[h])_v[h]=Yl();else return Gl;return i=HP(this.id,l.message,l),r.bind(console,i,...l.args)}return Gl}}Dh.VERSION=rT;function nT(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Ty(Number.isFinite(e)&&e>=0),e}function yv(t){const{logLevel:e,message:i}=t;t.logLevel=nT(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&r.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const n=typeof t.message;return Ty(n==="string"||n==="object"),Object.assign(t,{args:r},t.opts)}function HP(t,e,i){if(typeof e=="string"){const r=i.time?UP(zP(i.total)):"";e=i.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=$P(e,i.color,i.background)}return e}function qP(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}const m_="4.3.1",XP=m_[0]>="0"&&m_[0]<="9"?`v${m_}`:"";function ZP(){const t=new Dh({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=XP,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const sT=ZP();function YP(t,e){return oT(t||{},e)}function oT(t,e,i=0){if(i>3)return e;const r={...t};for(const[n,l]of Object.entries(e))l&&typeof l=="object"&&!Array.isArray(l)?r[n]=oT(r[n]||{},e[n],i+1):r[n]=e[n];return r}const KP="latest";function GP(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const JP=GP();function _a(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Qa=typeof process!="object"||String(process)!=="[object process]"||process.browser,QP=typeof window<"u"&&typeof window.orientation<"u",xv=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);xv&&parseFloat(xv[1]);class eI{constructor(e,i){H(this,"name");H(this,"workerThread");H(this,"isRunning",!0);H(this,"result");H(this,"_resolve",()=>{});H(this,"_reject",()=>{});this.name=e,this.workerThread=i,this.result=new Promise((r,n)=>{this._resolve=r,this._reject=n})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){_a(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){_a(this.isRunning),this.isRunning=!1,this._reject(e)}}class y_{terminate(){}}const x_=new Map;function tI(t){_a(t.source&&!t.url||!t.source&&t.url);let e=x_.get(t.source||t.url);return e||(t.url&&(e=iI(t.url),x_.set(t.url,e)),t.source&&(e=aT(t.source),x_.set(t.source,e))),_a(e),e}function iI(t){if(!t.startsWith("http"))return t;const e=rI(t);return aT(e)}function aT(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function rI(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function lT(t,e=!0,i){const r=i||new Set;if(t){if(vv(t))r.add(t);else if(vv(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const n in t)lT(t[n],e,r)}}return i===void 0?Array.from(r):[]}function vv(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const v_=()=>{};class pm{constructor(e){H(this,"name");H(this,"source");H(this,"url");H(this,"terminated",!1);H(this,"worker");H(this,"onMessage");H(this,"onError");H(this,"_loadableURL","");const{name:i,source:r,url:n}=e;_a(r||n),this.name=i,this.source=r,this.url=n,this.onMessage=v_,this.onError=l=>console.log(l),this.worker=Qa?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Qa||typeof y_<"u"&&!Qa}destroy(){this.onMessage=v_,this.onError=v_,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,i){i=i||lT(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,e.message&&(i+=`${e.message} in `),e.lineno&&(i+=`:${e.lineno}:${e.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=tI({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new y_(r,{eval:!1})}else if(this.source)e=new y_(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class nI{constructor(e){H(this,"name","unnamed");H(this,"source");H(this,"url");H(this,"maxConcurrency",1);H(this,"maxMobileConcurrency",1);H(this,"onDebug",()=>{});H(this,"reuseWorkers",!0);H(this,"props",{});H(this,"jobQueue",[]);H(this,"idleQueue",[]);H(this,"count",0);H(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return pm.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,i=(n,l,h)=>n.done(h),r=(n,l)=>n.error(l)){const n=new Promise(l=>(this.jobQueue.push({name:e,onMessage:i,onError:r,onStart:l}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const r=new eI(i.name,e);e.onMessage=n=>i.onMessage(r,n.type,n.payload),e.onError=n=>i.onError(r,n),i.onStart(r);try{await r.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Qa||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new pm({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return QP?this.maxMobileConcurrency:this.maxConcurrency}}const sI={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},ra=class ra{constructor(e){H(this,"props");H(this,"workerPools",new Map);this.props={...sI},this.setProps(e),this.workerPools=new Map}static isSupported(){return pm.isSupported()}static getWorkerFarm(e={}){return ra._workerFarm=ra._workerFarm||new ra({}),ra._workerFarm.setProps(e),ra._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:r,url:n}=e;let l=this.workerPools.get(i);return l||(l=new nI({name:i,source:r,url:n}),l.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,l)),l}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};H(ra,"_workerFarm");let Yf=ra;function oI(t,e={}){const i=e[t.id]||{},r=Qa?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let n=i.workerUrl;if(!n&&t.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(Qa?n=`modules/${t.module}/dist/${r}`:n=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!n){let l=t.version;l==="latest"&&(l=KP);const h=l?`@${l}`:"";n=`https://unpkg.com/@loaders.gl/${t.module}${h}/dist/${r}`}return _a(n),n}function aI(t,e=JP){_a(t,"no worker provided");const i=t.version;return!(!e||!i)}function lI(t,e){return!Yf.isSupported()||!Qa&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function cI(t,e,i,r,n){const l=t.id,h=oI(t,i),g=Yf.getWorkerFarm(i).getWorkerPool({name:l,url:h});i=JSON.parse(JSON.stringify(i)),r=JSON.parse(JSON.stringify(r||{}));const y=await g.startJob("process-on-worker",uI.bind(null,n));return y.postMessage("process",{input:e,options:i,context:r}),await(await y.result).result}async function uI(t,e,i,r){switch(i){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:n,input:l,options:h}=r;try{const a=await t(l,h);e.postMessage("done",{id:n,result:a})}catch(a){const g=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:n,error:g})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function hI(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const r=new Uint8Array(t),n=new Uint8Array(e);for(let l=0;l<r.length;++l)if(r[l]!==n[l])return!1;return!0}function dI(...t){return fI(t)}function fI(t){const e=t.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),i=e.reduce((l,h)=>l+h.byteLength,0),r=new Uint8Array(i);let n=0;for(const l of e)r.set(l,n),n+=l.byteLength;return r.buffer}async function pI(t){const e=[];for await(const i of t)e.push(i);return dI(...e)}function bv(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class wv{constructor(e,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=bv(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(bv()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Nh{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,i="count"){return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const i of Object.values(this.stats))e(i)}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(i=>this._getOrCreate(i))}_getOrCreate(e){const{name:i,type:r}=e;let n=this.stats[i];return n||(e instanceof wv?n=e:n=new wv(i,r),this.stats[i]=n),n}}const gI="Queued Requests",_I="Active Requests",mI="Cancelled Requests",yI="Queued Requests Ever",xI="Active Requests Ever",vI={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class bI{constructor(e={}){H(this,"props");H(this,"stats");H(this,"activeRequestCount",0);H(this,"requestQueue",[]);H(this,"requestMap",new Map);H(this,"updateTimer",null);this.props={...vI,...e},this.stats=new Nh({id:this.props.id}),this.stats.get(gI),this.stats.get(_I),this.stats.get(mI),this.stats.get(yI),this.stats.get(xI)}scheduleRequest(e,i=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:i},n=new Promise(l=>(r.resolve=l,r));return this.requestQueue.push(r),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){const{handle:i,resolve:r}=e;let n=!1;const l=()=>{n||(n=!0,this.requestMap.delete(i),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:l}):Promise.resolve({done:l})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let i=0;i<e;++i){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let i=0;i<e.length;++i){const r=e[i];this._updateRequest(r)||(e.splice(i,1),this.requestMap.delete(r.handle),i--)}e.sort((i,r)=>i.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let wI="";const Tv={};function TI(t){for(const e in Tv)if(t.startsWith(e)){const i=Tv[e];t=t.replace(e,i)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${wI}${t}`),t}function SI(t){return t&&typeof t=="object"&&t.isBuffer}function cT(t){if(SI(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function uT(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function EI(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const AI=t=>typeof t=="boolean",rh=t=>typeof t=="function",Lh=t=>t!==null&&typeof t=="object",Sv=t=>Lh(t)&&t.constructor==={}.constructor,PI=t=>!!t&&typeof t[Symbol.iterator]=="function",II=t=>t&&typeof t[Symbol.asyncIterator]=="function",cl=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ul=t=>typeof Blob<"u"&&t instanceof Blob,CI=t=>t&&typeof t=="object"&&t.isBuffer,RI=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Lh(t)&&rh(t.tee)&&rh(t.cancel)&&rh(t.getReader),MI=t=>Lh(t)&&rh(t.read)&&rh(t.pipe)&&AI(t.readable),hT=t=>RI(t)||MI(t);class kI extends Error{constructor(i,r){super(i);H(this,"reason");H(this,"url");H(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const OI=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,FI=/^([-\w.]+\/[-\w.+]+)/;function Ev(t,e){return t.toLowerCase()===e.toLowerCase()}function DI(t){const e=FI.exec(t);return e?e[1]:t}function Av(t){const e=OI.exec(t);return e?e[1]:""}const dT=/\?.*/;function NI(t){const e=t.match(dT);return e&&e[0]}function Sy(t){return t.replace(dT,"")}function LI(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Hp(t){return cl(t)?t.url:ul(t)?t.name||"":typeof t=="string"?t:""}function Ey(t){if(cl(t)){const e=t,i=e.headers.get("content-type")||"",r=Sy(e.url);return DI(i)||Av(r)}return ul(t)?t.type||"":typeof t=="string"?Av(t):""}function BI(t){return cl(t)?t.headers["content-length"]||-1:ul(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function fT(t){if(cl(t))return t;const e={},i=BI(t);i>=0&&(e["content-length"]=String(i));const r=Hp(t),n=Ey(t);n&&(e["content-type"]=n);const l=await VI(t);l&&(e["x-first-bytes"]=l),typeof t=="string"&&(t=new TextEncoder().encode(t));const h=new Response(t,{headers:e});return Object.defineProperty(h,"url",{value:r}),h}async function zI(t){if(!t.ok)throw await UI(t)}async function UI(t){const e=LI(t.url);let i=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;i=i.length>100?`${i.slice(0,100)}...`:i;const r={reason:t.statusText,url:t.url,response:t};try{const n=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(n!=null&&n.includes("application/json"))?await t.json():await t.text()}catch{}return new kI(i,r)}async function VI(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const i=t.slice(0,5);return await new Promise(r=>{const n=new FileReader;n.onload=l=>{var h;return r((h=l==null?void 0:l.target)==null?void 0:h.result)},n.readAsDataURL(i)})}if(t instanceof ArrayBuffer){const i=t.slice(0,5);return`data:base64,${$I(i)}`}return null}function $I(t){let e="";const i=new Uint8Array(t);for(let r=0;r<i.byteLength;r++)e+=String.fromCharCode(i[r]);return btoa(e)}function jI(t){return!WI(t)&&!HI(t)}function WI(t){return t.startsWith("http:")||t.startsWith("https:")}function HI(t){return t.startsWith("data:")}async function Pv(t,e){var i,r;if(typeof t=="string"){const n=TI(t);return jI(n)&&(i=globalThis.loaders)!=null&&i.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(n,e):await fetch(n,e)}return await fT(t)}const Iv=new Dh({id:"loaders.gl"});class qI{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class XI{constructor(){H(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const pT={fetch:null,mimeType:void 0,nothrow:!1,log:new XI,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:wy,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},ZI={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function gT(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function _T(){const t=gT();return t.globalOptions=t.globalOptions||{...pT},t.globalOptions}function YI(t,e,i,r){return i=i||[],i=Array.isArray(i)?i:[i],KI(t,i),JI(e,t,r)}function KI(t,e){Cv(t,null,pT,ZI,e);for(const i of e){const r=t&&t[i.id]||{},n=i.options&&i.options[i.id]||{},l=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};Cv(r,i.id,n,l,e)}}function Cv(t,e,i,r,n){const l=e||"Top level",h=e?`${e}.`:"";for(const a in t){const g=!e&&Lh(t[a]),y=a==="baseUri"&&!e,T=a==="workerUrl"&&e;if(!(a in i)&&!y&&!T){if(a in r)Iv.warn(`${l} loader option '${h}${a}' no longer supported, use '${r[a]}'`)();else if(!g){const S=GI(a,n);Iv.warn(`${l} loader option '${h}${a}' not recognized. ${S}`)()}}}}function GI(t,e){const i=t.toLowerCase();let r="";for(const n of e)for(const l in n.options){if(t===l)return`Did you mean '${n.id}.${l}'?`;const h=l.toLowerCase();(i.startsWith(h)||h.startsWith(i))&&(r=r||`Did you mean '${n.id}.${l}'?`)}return r}function JI(t,e,i){const n={...t.options||{}};return QI(n,i),n.log===null&&(n.log=new qI),Rv(n,_T()),Rv(n,e),n}function Rv(t,e){for(const i in e)if(i in e){const r=e[i];Sv(r)&&Sv(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function QI(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Ay(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function Py(t){Xf(t,"null loader"),Xf(Ay(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const mT=()=>{const t=gT();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function yT(t){const e=mT();t=Array.isArray(t)?t:[t];for(const i of t){const r=Py(i);e.find(n=>r===n)||e.unshift(r)}}function eC(){return mT()}const tC=/\.([^.]+)$/;async function iC(t,e=[],i,r){if(!xT(t))return null;let n=Mv(t,e,{...i,nothrow:!0},r);if(n)return n;if(ul(t)&&(t=await t.slice(0,10).arrayBuffer(),n=Mv(t,e,i,r)),!n&&!(i!=null&&i.nothrow))throw new Error(vT(t));return n}function Mv(t,e=[],i,r){if(!xT(t))return null;if(e&&!Array.isArray(e))return Py(e);let n=[];e&&(n=n.concat(e)),i!=null&&i.ignoreRegisteredLoaders||n.push(...eC()),nC(n);const l=rC(t,n,i,r);if(!l&&!(i!=null&&i.nothrow))throw new Error(vT(t));return l}function rC(t,e,i,r){const n=Hp(t),l=Ey(t),h=Sy(n)||(r==null?void 0:r.url);let a=null,g="";return i!=null&&i.mimeType&&(a=b_(e,i==null?void 0:i.mimeType),g=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),a=a||sC(e,h),g=g||(a?`matched url ${h}`:""),a=a||b_(e,l),g=g||(a?`matched MIME type ${l}`:""),a=a||aC(e,t),g=g||(a?`matched initial data ${bT(t)}`:""),i!=null&&i.fallbackMimeType&&(a=a||b_(e,i==null?void 0:i.fallbackMimeType),g=g||(a?`matched fallback MIME type ${l}`:"")),g&&sT.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${g}.`),a}function xT(t){return!(t instanceof Response&&t.status===204)}function vT(t){const e=Hp(t),i=Ey(t);let r="No valid loader found (";r+=e?`${uT(e)}, `:"no url provided, ",r+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const n=t?bT(t):"";return r+=n?` first bytes: "${n}"`:"first bytes: not available",r+=")",r}function nC(t){for(const e of t)Py(e)}function sC(t,e){const i=e&&tC.exec(e),r=i&&i[1];return r?oC(t,r):null}function oC(t,e){e=e.toLowerCase();for(const i of t)for(const r of i.extensions)if(r.toLowerCase()===e)return i;return null}function b_(t,e){var i;for(const r of t)if((i=r.mimeTypes)!=null&&i.some(n=>Ev(e,n))||Ev(e,`application/x.${r.id}`))return r;return null}function aC(t,e){if(!e)return null;for(const i of t)if(typeof e=="string"){if(lC(e,i))return i}else if(ArrayBuffer.isView(e)){if(kv(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&kv(e,0,i))return i;return null}function lC(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function kv(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(n=>cC(t,e,i,n))}function cC(t,e,i,r){if(r instanceof ArrayBuffer)return hI(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const n=gm(t,e,r.length);return r===n;default:return!1}}function bT(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?gm(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?gm(t,0,e):""}function gm(t,e,i){if(t.byteLength<e+i)return"";const r=new DataView(t);let n="";for(let l=0;l<i;l++)n+=String.fromCharCode(r.getUint8(e+l));return n}const uC=256*1024;function*hC(t,e){const i=(e==null?void 0:e.chunkSize)||uC;let r=0;const n=new TextEncoder;for(;r<t.length;){const l=Math.min(t.length-r,i),h=t.slice(r,r+l);r+=l,yield n.encode(h)}}const dC=256*1024;function*fC(t,e={}){const{chunkSize:i=dC}=e;let r=0;for(;r<t.byteLength;){const n=Math.min(t.byteLength-r,i),l=new ArrayBuffer(n),h=new Uint8Array(t,r,n);new Uint8Array(l).set(h),r+=n,yield l}}const pC=1024*1024;async function*gC(t,e){const i=(e==null?void 0:e.chunkSize)||pC;let r=0;for(;r<t.size;){const n=r+i,l=await t.slice(r,n).arrayBuffer();r=n,yield l}}function Ov(t,e){return wy?_C(t,e):mC(t)}async function*_C(t,e){const i=t.getReader();let r;try{for(;;){const n=r||i.read();e!=null&&e._streamReadAhead&&(r=i.read());const{done:l,value:h}=await n;if(l)return;yield cT(h)}}catch{i.releaseLock()}}async function*mC(t,e){for await(const i of t)yield cT(i)}function yC(t,e){if(typeof t=="string")return hC(t,e);if(t instanceof ArrayBuffer)return fC(t,e);if(ul(t))return gC(t,e);if(hT(t))return Ov(t,e);if(cl(t))return Ov(t.body,e);throw new Error("makeIterator")}const wT="Cannot convert supplied data type";function xC(t,e,i){if(e.text&&typeof t=="string")return t;if(CI(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const n=t.byteLength||t.length;return(t.byteOffset!==0||n!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+n)),r}throw new Error(wT)}async function vC(t,e,i){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return xC(t,e);if(ul(t)&&(t=await fT(t)),cl(t)){const n=t;return await zI(n),e.binary?await n.arrayBuffer():await n.text()}if(hT(t)&&(t=yC(t,i)),PI(t)||II(t))return pI(t);throw new Error(wT)}function TT(t,e){const i=_T(),r=t||i;return typeof r.fetch=="function"?r.fetch:Lh(r.fetch)?n=>Pv(n,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Pv}function bC(t,e,i){if(i)return i;const r={fetch:TT(e,t),...t};if(r.url){const n=Sy(r.url);r.baseUrl=n,r.queryString=NI(r.url),r.filename=uT(n),r.baseUrl=EI(n)}return Array.isArray(r.loaders)||(r.loaders=null),r}function wC(t,e){if(t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...r]:r}return i&&i.length?i:void 0}async function Kf(t,e,i,r){e&&!Array.isArray(e)&&!Ay(e)&&(r=void 0,i=e,e=void 0),t=await t,i=i||{};const n=Hp(t),h=wC(e,r),a=await iC(t,h,i);return a?(i=YI(i,a,h,n),r=bC({url:n,_parse:Kf,loaders:h},i,r||null),await TC(a,t,i,r)):null}async function TC(t,e,i,r){if(aI(t),i=YP(t.options,i),cl(e)){const l=e,{ok:h,redirected:a,status:g,statusText:y,type:T,url:S}=l,P=Object.fromEntries(l.headers.entries());r.response={headers:P,ok:h,redirected:a,status:g,statusText:y,type:T,url:S}}e=await vC(e,t,i);const n=t;if(n.parseTextSync&&typeof e=="string")return n.parseTextSync(e,i,r);if(lI(t,i))return await cI(t,e,i,r,Kf);if(n.parseText&&typeof e=="string")return await n.parseText(e,i,r);if(n.parse)return await n.parse(e,i,r);throw _a(!n.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function Gf(t,e,i,r){let n,l;!Array.isArray(e)&&!Ay(e)?(n=[],l=e):(n=e,l=i);const h=TT(l);let a=t;return typeof t=="string"&&(a=await h(t)),ul(t)&&(a=await h(t)),Array.isArray(n)?await Kf(a,n,l):await Kf(a,n,l)}const SC="4.3.1";var Qw;const EC=(Qw=globalThis.loaders)==null?void 0:Qw.parseImageNode,_m=typeof Image<"u",mm=typeof ImageBitmap<"u",AC=!!EC,ym=wy?!0:AC;function PC(t){switch(t){case"auto":return mm||_m||ym;case"imagebitmap":return mm;case"image":return _m;case"data":return ym;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function IC(){if(mm)return"imagebitmap";if(_m)return"image";if(ym)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function CC(t){const e=MC(t);if(!e)throw new Error("Not an image");return e}function RC(t){switch(CC(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function MC(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const kC=/^data:image\/svg\+xml/,OC=/\.svg((\?|#).*)?$/;function Iy(t){return t&&(kC.test(t)||OC.test(t))}function FC(t,e){if(Iy(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(l){throw new Error(l.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return ST(t,e)}function ST(t,e){if(Iy(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function ET(t,e,i){const r=FC(t,i),n=self.URL||self.webkitURL,l=typeof r!="string"&&n.createObjectURL(r);try{return await DC(l||r,e)}finally{l&&n.revokeObjectURL(l)}}async function DC(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((r,n)=>{try{i.onload=()=>r(i),i.onerror=l=>{const h=l instanceof Error?l.message:"error";n(new Error(h))}}catch(l){n(l)}})}const NC={};let Fv=!0;async function LC(t,e,i){let r;Iy(i)?r=await ET(t,e,i):r=ST(t,i);const n=e&&e.imagebitmap;return await BC(r,n)}async function BC(t,e=null){if((zC(e)||!Fv)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),Fv=!1}return await createImageBitmap(t)}function zC(t){for(const e in t||NC)return!1;return!0}function UC(t){return!WC(t,"ftyp",4)||!(t[8]&96)?null:VC(t)}function VC(t){switch($C(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function $C(t,e,i){return String.fromCharCode(...t.slice(e,i))}function jC(t){return[...t].map(e=>e.charCodeAt(0))}function WC(t,e,i=0){const r=jC(e);for(let n=0;n<r.length;++n)if(r[n]!==t[n+i])return!1;return!0}const Zs=!1,nh=!0;function AT(t){const e=Bh(t);return qC(e)||YC(e)||XC(e)||ZC(e)||HC(e)}function HC(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),i=UC(e);return i?{mimeType:i.mimeType,width:0,height:0}:null}function qC(t){const e=Bh(t);return e.byteLength>=24&&e.getUint32(0,Zs)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Zs),height:e.getUint32(20,Zs)}:null}function XC(t){const e=Bh(t);return e.byteLength>=10&&e.getUint32(0,Zs)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,nh),height:e.getUint16(8,nh)}:null}function ZC(t){const e=Bh(t);return e.byteLength>=14&&e.getUint16(0,Zs)===16973&&e.getUint32(2,nh)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,nh),height:e.getUint32(22,nh)}:null}function YC(t){const e=Bh(t);if(!(e.byteLength>=3&&e.getUint16(0,Zs)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:n}=KC();let l=2;for(;l+9<e.byteLength;){const h=e.getUint16(l,Zs);if(n.has(h))return{mimeType:"image/jpeg",height:e.getUint16(l+5,Zs),width:e.getUint16(l+7,Zs)};if(!r.has(h))return null;l+=2,l+=e.getUint16(l,Zs)}return null}function KC(){const t=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)t.add(i);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Bh(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function GC(t,e){var n;const{mimeType:i}=AT(t)||{},r=(n=globalThis.loaders)==null?void 0:n.parseImageNode;return Xf(r),await r(t,i)}async function JC(t,e,i){e=e||{};const n=(e.image||{}).type||"auto",{url:l}=i||{},h=QC(n);let a;switch(h){case"imagebitmap":a=await LC(t,e,l);break;case"image":a=await ET(t,e,l);break;case"data":a=await GC(t);break;default:Xf(!1)}return n==="data"&&(a=RC(a)),a}function QC(t){switch(t){case"auto":case"data":return IC();default:return PC(t),t}}const eR=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],tR=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],iR={image:{type:"auto",decode:!0}},rR={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:SC,mimeTypes:tR,extensions:eR,parse:JC,tests:[t=>!!AT(new DataView(t))],options:iR},nR=new Dh({id:"deck"}),Wt=nR;let xm={};function sR(t){xm=t}function Gr(t,e,i,r){Wt.level>0&&xm[t]&&xm[t].call(null,e,i,r)}function oR(t){const e=t[0],i=t[t.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const aR={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:oR,parseTextSync:JSON.parse};function lR(){const t="9.0.36",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Wt.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Wt,_registerLoggers:sR},yT([aR,[rR,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const PT=lR();function Ka(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const w_={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function cR(t){const e={};for(const[i,r]of Object.entries(t))e[i]=hR(r);return e}function uR(t,e,i){const r={};for(const[n,l]of Object.entries(e))t&&n in t&&!l.private?(l.validate&&Ka(l.validate(t[n],l),`${i}: invalid ${n}`),r[n]=t[n]):r[n]=l.value;return r}function hR(t){let e=Dv(t);if(e!=="object")return{value:t,...w_[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...w_[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Dv(t.value),{...t,...w_[e],type:e}):{type:"object",value:null};throw new Error("props")}function Dv(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const dR=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,fR=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,pR={vertex:dR,fragment:fR},Nv=/void\s+main\s*\([^)]*\)\s*\{\n?/,Lv=/}\n?[^{}]*$/,T_=[],kf="__LUMA_INJECT_DECLARATIONS__";function gR(t){const e={vertex:{},fragment:{}};for(const i in t){let r=t[i];const n=_R(i);typeof r=="string"&&(r={order:0,injection:r}),e[n][i]=r}return e}function _R(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Jf(t,e,i,r=!1){const n=e==="vertex";for(const l in i){const h=i[l];h.sort((g,y)=>g.order-y.order),T_.length=h.length;for(let g=0,y=h.length;g<y;++g)T_[g]=h[g].injection;const a=`${T_.join(`
`)}
`;switch(l){case"vs:#decl":n&&(t=t.replace(kf,a));break;case"vs:#main-start":n&&(t=t.replace(Nv,g=>g+a));break;case"vs:#main-end":n&&(t=t.replace(Lv,g=>a+g));break;case"fs:#decl":n||(t=t.replace(kf,a));break;case"fs:#main-start":n||(t=t.replace(Nv,g=>g+a));break;case"fs:#main-end":n||(t=t.replace(Lv,g=>a+g));break;default:t=t.replace(l,g=>g+a)}}return t=t.replace(kf,""),r&&(t=t.replace(/\}\s*$/,l=>l+pR[e])),t}let mR=1;class Ga{constructor(e){H(this,"name");H(this,"vs");H(this,"fs");H(this,"getModuleUniforms");H(this,"dependencies");H(this,"deprecations");H(this,"defines");H(this,"injections");H(this,"uniforms",{});H(this,"uniformTypes",{});const{name:i,vs:r,fs:n,dependencies:l=[],uniformTypes:h={},uniformPropTypes:a={},getUniforms:g,deprecations:y=[],defines:T={},inject:S={}}=e;Ka(typeof i=="string"),this.name=i,this.vs=r,this.fs=n,this.getModuleUniforms=g,this.dependencies=Ga.instantiateModules(l),this.deprecations=this._parseDeprecationDefinitions(y),this.defines=T,this.injections=gR(S),this.uniformTypes=h,a&&(this.uniforms=cR(a))}static instantiateModules(e){return e.map(i=>{if(i instanceof Ga)return i;Ka(typeof i!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(i)}' and use it directly.`),i.name||(console.warn("shader module has no name"),i.name=`shader-module-${mR++}`);const r=new Ga(i);return r.dependencies=Ga.instantiateModules(i.dependencies||[]),r})}getModuleSource(e){let i;switch(e){case"vertex":i=this.vs||"";break;case"fragment":i=this.fs||"";break;default:Ka(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${i}

`}getUniforms(e,i){return this.getModuleUniforms?this.getModuleUniforms(e,i):uR(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,i){this.deprecations.forEach(r=>{var n;(n=r.regex)!=null&&n.test(e)&&(r.deprecated?i.deprecated(r.old,r.new)():i.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(i=>{switch(i.type){case"function":i.regex=new RegExp(`\\b${i.old}\\(`);break;default:i.regex=new RegExp(`${i.type} ${i.old};`)}}),e}_defaultGetUniforms(e={}){const i={},r=this.uniforms;for(const n in r){const l=r[n];n in e&&!l.private?(l.validate&&Ka(l.validate(e[n],l),`${this.name}: invalid ${n}`),i[n]=e[n]):i[n]=l.value}return i}}function Bv(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=zv(t.platformInfo,t.vs);let i;return t.fs&&(i=zv(t.platformInfo,t.fs)),{...t,vs:e,fs:i}}function zv(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function qp(t){const e=Ga.instantiateModules(t);return yR(e)}function yR(t){const e={},i={};return IT({modules:t,level:0,moduleMap:e,moduleDepth:i}),Object.keys(i).sort((r,n)=>i[n]-i[r]).map(r=>e[r])}function IT(t){const{modules:e,level:i,moduleMap:r,moduleDepth:n}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const l of e)r[l.name]=l,(n[l.name]===void 0||n[l.name]<i)&&(n[l.name]=i);for(const l of e)l.dependencies&&IT({modules:l.dependencies,level:i+1,moduleMap:r,moduleDepth:n})}function xR(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function vR(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=Uv(t,bR),t;case"fragment":return t=Uv(t,wR),t;default:throw new Error(e)}}const CT=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],bR=[...CT,[vm("attribute"),"in $1"],[vm("varying"),"out $1"]],wR=[...CT,[vm("varying"),"in $1"]];function Uv(t,e){for(const[i,r]of e)t=t.replace(i,r);return t}function vm(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function RT(t,e){let i="";for(const r in t){const n=t[r];if(i+=`void ${n.signature} {
`,n.header&&(i+=`  ${n.header}`),e[r]){const l=e[r];l.sort((h,a)=>h.order-a.order);for(const h of l)i+=`  ${h.injection}
`}n.footer&&(i+=`  ${n.footer}`),i+=`}
`}return i}function MT(t){const e={vertex:{},fragment:{}};for(const i of t){let r,n;typeof i!="string"?(r=i,n=r.hook):(r={},n=i),n=n.trim();const[l,h]=n.split(":"),a=n.replace(/\(.+/,""),g=Object.assign(r,{signature:h});switch(l){case"vs":e.vertex[a]=g;break;case"fs":e.fragment[a]=g;break;default:throw new Error(l)}}return e}function TR(t,e){return{name:SR(t,e),language:"glsl",version:ER(t)}}function SR(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function ER(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const r=parseInt(i[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const kT=`

${kf}
`,AR=`precision highp float;
`;function PR(t){const e=qp(t.modules||[]);return{source:bm(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:Cy(e)}}function IR(t){const e=qp(t.modules||[]);return{vs:bm(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:bm(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:Cy(e)}}function CR(t){const{vs:e,fs:i}=t,r=qp(t.modules||[]);return{vs:Vv(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:Vv(t.platformInfo,{...t,source:i,stage:"fragment",modules:r}),getUniforms:Cy(r)}}function bm(t,e){const{source:i,stage:r,modules:n,hookFunctions:l=[],inject:h={},log:a}=e;Ka(typeof i=="string","shader source must be a string");const g=i;let y="";const T=MT(l),S={},P={},M={};for(const j in h){const Z=typeof h[j]=="string"?{injection:h[j],order:0}:h[j],G=/^(v|f)s:(#)?([\w-]+)$/.exec(j);if(G){const fe=G[2],re=G[3];fe?re==="decl"?P[j]=[Z]:M[j]=[Z]:S[j]=[Z]}else M[j]=[Z]}const B=t.type!=="webgpu"?n:[];for(const j of B){a&&j.checkDeprecations(g,a);const Z=j.getModuleSource(r,"wgsl");y+=Z;const G=j.injections[r];for(const fe in G){const re=/^(v|f)s:#([\w-]+)$/.exec(fe);if(re){const Me=re[2]==="decl"?P:M;Me[fe]=Me[fe]||[],Me[fe].push(G[fe])}else S[fe]=S[fe]||[],S[fe].push(G[fe])}}return y+=kT,y=Jf(y,r,P),y+=RT(T[r],S),y+=g,y=Jf(y,r,M),y}function Vv(t,e){const{id:i,source:r,stage:n,language:l="glsl",modules:h,defines:a={},hookFunctions:g=[],inject:y={},prologue:T=!0,log:S}=e;Ka(typeof r=="string","shader source must be a string");const P=l==="glsl"?TR(r).version:-1,M=t.shaderLanguageVersion,B=P===100?"#version 100":"#version 300 es",Z=r.split(`
`).slice(1).join(`
`),G={};h.forEach($e=>{Object.assign(G,$e.getDefines())}),Object.assign(G,a);let fe="";switch(l){case"wgsl":break;case"glsl":fe=T?`${B}

// ----- PROLOGUE -------------------------
${RR({id:i,source:r,stage:n})}
${`#define SHADER_TYPE_${n.toUpperCase()}`}
${xR(t)}
${n==="fragment"?AR:""}

// ----- APPLICATION DEFINES -------------------------

${MR(G)}

`:`${B}
`;break}const re=MT(g),ue={},Me={},Oe={};for(const $e in y){const ke=typeof y[$e]=="string"?{injection:y[$e],order:0}:y[$e],je=/^(v|f)s:(#)?([\w-]+)$/.exec($e);if(je){const Ue=je[2],ct=je[3];Ue?ct==="decl"?Me[$e]=[ke]:Oe[$e]=[ke]:ue[$e]=[ke]}else Oe[$e]=[ke]}for(const $e of h){S&&$e.checkDeprecations(Z,S);const ke=$e.getModuleSource(n);fe+=ke;const je=$e.injections[n];for(const Ue in je){const ct=/^(v|f)s:#([\w-]+)$/.exec(Ue);if(ct){const pt=ct[2]==="decl"?Me:Oe;pt[Ue]=pt[Ue]||[],pt[Ue].push(je[Ue])}else ue[Ue]=ue[Ue]||[],ue[Ue].push(je[Ue])}}return fe+="// ----- MAIN SHADER SOURCE -------------------------",fe+=kT,fe=Jf(fe,n,Me),fe+=RT(re[n],ue),fe+=Z,fe=Jf(fe,n,Oe),l==="glsl"&&P!==M&&(fe=vR(fe,n)),fe.trim()}function Cy(t){return function(i){const r={};for(const n of t){const l=n.getUniforms(i,r);Object.assign(r,l)}return r}}function RR(t){const{id:e,source:i,stage:r}=t;return e&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function MR(t={}){let e="";for(const i in t){const r=t[i];(r||Number.isFinite(r))&&(e+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e}const Za=class Za{constructor(){H(this,"_hookFunctions",[]);H(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Za.defaultShaderAssembler=Za.defaultShaderAssembler||new Za,Za.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(i=>i.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==i)}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const i=this._getModuleList(e.modules),r=this._hookFunctions,n=Bv(e);return{...PR({platformInfo:e.platformInfo,...n,modules:i,hookFunctions:r}),modules:i}}assembleShaderPair(e){const i=Bv(e),r=this._getModuleList(e.modules),n=this._hookFunctions,{platformInfo:l}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?IR({platformInfo:l,...i,modules:r,hookFunctions:n}):CR({platformInfo:l,...i,modules:r,hookFunctions:n}),modules:r}}_getModuleList(e=[]){const i=new Array(this._defaultModules.length+e.length),r={};let n=0;for(let l=0,h=this._defaultModules.length;l<h;++l){const a=this._defaultModules[l],g=a.name;i[n++]=a,r[g]=!0}for(let l=0,h=e.length;l<h;++l){const a=e[l],g=a.name;r[g]||(i[n++]=a,r[g]=!0)}return i.length=n,Ga.instantiateModules(i)}};H(Za,"defaultShaderAssembler");let Qf=Za;const kR=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,OR=`#version 300 es
${kR}`;function FR(t){const{input:e,inputChannels:i,output:r}=t||{};if(!e)return OR;if(!i)throw new Error("inputChannels");const n=DR(i),l=NR(e,i);return`#version 300 es
in ${n} ${e};
out vec4 ${r};
void main() {
  ${r} = ${l};
}`}function DR(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function NR(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const Je=new Dh({id:"luma.gl"});class LR{constructor(){H(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Nh({id:e})),this.stats.get(e)}}const Ry=new LR;function BR(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(va()&&Je.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:Je,stats:Ry}),t}const zR=BR();function UR(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function gh(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:UR(t)}const S_={};function hl(t="id"){S_[t]=S_[t]||1;const e=S_[t]++;return`${t}-${e}`}function ep(t){let e=!0;for(const i in t){e=!1;break}return e}var fm;let yi=(fm=class{constructor(e,i,r){H(this,"id");H(this,"props");H(this,"userData",{});H(this,"_device");H(this,"destroyed",!1);H(this,"allocatedBytes",0);H(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=VR(i,r);const n=this.props.id!=="undefined"?this.props.id:hl(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get(`${i}s Active`).decrementCount()}trackAllocatedMemory(e,i=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${i} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").subtractCount(this.allocatedBytes),i.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${i}s Created`).incrementCount(),e.get(`${i}s Active`).incrementCount()}},H(fm,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),fm);function VR(t,e){const i={...e};for(const r in t)t[r]!==void 0&&(i[r]=t[r]);return i}const Or=class Or extends yi{constructor(i,r){const n={...r};(r.usage||0)&Or.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array&&(n.indexType="uint16"));super(i,n,Or.defaultProps);H(this,"usage");H(this,"indexType");H(this,"updateTimestamp");H(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=n.indexType,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(i,r){throw new Error("not implemented")}_setDebugData(i,r,n){const l=ArrayBuffer.isView(i)?i.buffer:i,h=Math.min(i?i.byteLength:n,Or.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(h):r===0&&n===i.byteLength?this.debugData=l.slice(0,h):this.debugData=l.slice(r,r+h)}};H(Or,"defaultProps",{...yi.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),H(Or,"MAP_READ",1),H(Or,"MAP_WRITE",2),H(Or,"COPY_SRC",4),H(Or,"COPY_DST",8),H(Or,"INDEX",16),H(Or,"VERTEX",32),H(Or,"UNIFORM",64),H(Or,"STORAGE",128),H(Or,"INDIRECT",256),H(Or,"QUERY_RESOLVE",512),H(Or,"DEBUG_DATA_MAX_LENGTH",32);let Li=Or;function OT(t){const e=$v[t],i=$R(e),r=t.includes("norm"),n=!r&&!t.startsWith("float"),l=t.startsWith("s");return{dataType:$v[t],byteLength:i,integer:n,signed:l,normalized:r}}function $R(t){return jR[t]}const $v={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},jR={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},WR=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],HR=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function qR(t){return WR.some(e=>t.startsWith(e))}function FT(t){const e=HR.exec(t);if(e){const[,i,r,n,l,h]=e;if(i){const a=`${n}${r}`,g=OT(a);return{format:i,components:i.length,srgb:l==="-srgb",unsized:h==="-unsized",webgl:h==="-webgl",...g}}}return ZR(t)}const XR={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function ZR(t){var i;const e=XR[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((i=e.format)==null?void 0:i.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class YR{}class KR{constructor(e=[],i){H(this,"features");H(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const fh=class fh{constructor(e){H(this,"id");H(this,"props");H(this,"userData",{});H(this,"statsManager",Ry);H(this,"_lumaData",{});H(this,"timestamp",0);this.props={...fh.defaultProps,...e},this.id=this.props.id||hl(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return qR(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,i){throw new Error("not implemented")}readPixelsToBufferWebGL(e,i){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,i){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const i={...e};return(e.usage||0)&Li.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?i.indexType="uint32":e.data instanceof Uint16Array?i.indexType="uint16":Je.warn("indices buffer content must be of integer type")()),i}};H(fh,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Je.get("debug"),spector:!!(Je.get("spector")||Je.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>Je.error(e.message)}),H(fh,"VERSION",zR);let Ac=fh;function Pi(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const Vu=new Map,xc=class xc{static registerDevices(e){for(const i of e)Pi(i.type&&i.isSupported&&i.create),Vu.set(i.type,i)}static getAvailableDevices(){return Array.from(Vu).map(e=>e.type)}static getSupportedDevices(){return Array.from(Vu).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Ac.defaultProps,e)}static async attachDevice(e){const i=jv(e.devices)||Vu;if(e.handle instanceof WebGL2RenderingContext){const r=i.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=i.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var l,h;e={...xc.defaultProps,...e},e.gl&&(e.type="webgl");const i=jv(e.devices)||Vu;let r,n;switch(e.type){case"webgpu":if(r=i.get("webgpu"),r)return await r.create(e);break;case"webgl":if(n=i.get("webgl"),n)return await n.create(e);break;case"unknown":const a=i.get("unknown");if(a)return await a.create(e);break;case"best-available":if(r=i.get("webgpu"),(l=r==null?void 0:r.isSupported)!=null&&l.call(r))return await r.create(e);if(n=i.get("webgl"),(h=n==null?void 0:n.isSupported)!=null&&h.call(n))return await n.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const i=HTMLCanvasElement.prototype;if(!e&&i.originalGetContext){i.getContext=i.originalGetContext,i.originalGetContext=void 0;return}i.originalGetContext=i.getContext,i.getContext=function(r,n){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",n):this.originalGetContext(r,n)}}};H(xc,"defaultProps",{...Ac.defaultProps,type:"best-available",devices:void 0}),H(xc,"stats",Ry),H(xc,"log",Je);let vc=xc;function jv(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const i of t)e.set(i.type,i);return e}const GR=va()&&typeof document<"u",Xp=()=>GR&&document.readyState==="complete",JR={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class My{constructor(e){H(this,"id");H(this,"props");H(this,"canvas");H(this,"htmlCanvas");H(this,"offscreenCanvas");H(this,"type");H(this,"width",1);H(this,"height",1);H(this,"resizeObserver");H(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...JR,...e},e=this.props,!va()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=tM(e.canvas):this.canvas=e.canvas;else{const i=iM(e),r=eM((e==null?void 0:e.container)||null);r.insertBefore(i,r.firstChild),this.canvas=i,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const r of i)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return Xp()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*e,i.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,i]=this.getPixelSize();return e/i}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:i}=this._canvasSizeInfo;return i?e/i:1}catch{return 1}}cssToDevicePixels(e,i=!0){const r=this.cssToDeviceRatio(),[n,l]=this.getDrawingBufferSize();return rM(e,r,n,l,i)}setDevicePixelRatio(e,i={}){if(!this.htmlCanvas)return;let r="width"in i?i.width:this.htmlCanvas.clientWidth,n="height"in i?i.height:this.htmlCanvas.clientHeight;(!r||!n)&&(Je.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,n=this.htmlCanvas.height||1);const l=this._canvasSizeInfo;if(l.clientWidth!==r||l.clientHeight!==n||l.devicePixelRatio!==e){let h=e;const a=Math.floor(r*h),g=Math.floor(n*h);this.htmlCanvas.width=a,this.htmlCanvas.height=g;const[y,T]=this.getDrawingBufferSize();(y!==a||T!==g)&&(h=Math.min(y/r,T/n),this.htmlCanvas.width=Math.floor(r*h),this.htmlCanvas.height=Math.floor(n*h),Je.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=n,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}H(My,"pageLoaded",QR());function QR(){return Xp()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function eM(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!Xp())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function tM(t){const e=document.getElementById(t);if(!e&&!Xp())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function iM(t){const{width:e,height:i}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=i||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(i)?`${i}px`:"100%",r}function rM(t,e,i,r,n){const l=t,h=Wv(l[0],e,i);let a=Hv(l[1],e,r,n),g=Wv(l[0]+1,e,i);const y=g===i-1?g:g-1;g=Hv(l[1]+1,e,r,n);let T;return n?(g=g===0?g:g+1,T=a,a=g):T=g===r-1?g:g-1,{x:h,y:a,width:Math.max(y-h+1,1),height:Math.max(T-a+1,1)}}function Wv(t,e,i){return Math.min(Math.round(t*e),i-1)}function Hv(t,e,i,r){return r?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const bo=class bo extends yi{constructor(i,r,n=bo.defaultProps){super(i,r,n);H(this,"dimension");H(this,"format");H(this,"width");H(this,"height");H(this,"depth");H(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};H(bo,"defaultProps",{...yi.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),H(bo,"COPY_SRC",1),H(bo,"COPY_DST",2),H(bo,"TEXTURE_BINDING",4),H(bo,"STORAGE_BINDING",8),H(bo,"RENDER_ATTACHMENT",16);let as=bo;const Cp=class Cp extends yi{get[Symbol.toStringTag](){return"TextureView"}constructor(e,i){super(e,i,Cp.defaultProps)}};H(Cp,"defaultProps",{...yi.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let tp=Cp;function nM(t,e,i){let r="";const n=e.split(/\r?\n/),l=t.slice().sort((h,a)=>h.lineNum-a.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let h=0;for(let a=1;a<=n.length;a++)for(r+=DT(n[a-1],a,i);l.length>h&&l[h].lineNum===a;){const g=l[h++];r+=qv(g,n,g.lineNum,{...i,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=qv(a,n,a.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return r}}function qv(t,e,i,r){if(r!=null&&r.inlineSource){const n=sM(e,i),l=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${n}${l}${t.type.toUpperCase()}: ${t.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function sM(t,e,i){let r="";for(let n=e-2;n<=e;n++){const l=t[n-1];l!==void 0&&(r+=DT(l,e,i))}return r}function DT(t,e,i){const r=i!=null&&i.html?aM(t):t;return`${oM(String(e),4)}: ${r}${i!=null&&i.html?"<br/>":`
`}`}function oM(t,e){let i="";for(let r=t.length;r<e;++r)i+=" ";return i+t}function aM(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function NT(t,e){return{name:lM(t,e),language:"glsl",version:cM(t)}}function lM(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function cM(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const r=parseInt(i[1],10);Number.isFinite(r)&&(e=r)}return e}const Rp=class Rp extends yi{constructor(i,r){super(i,{id:uM(r),...r},Rp.defaultProps);H(this,"stage");H(this,"source");H(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(i=this.props.debug){switch(i){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(i){var y;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=NT(this.source).name,n=`${this.stage} ${r}`;let l=nM(i,this.source,{showSourceCode:"all",html:!0});const h=this.getTranslatedSource();h&&(l+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${h}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${l}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const g=document.getElementsByClassName("luma-compiler-log-error");(y=g[0])!=null&&y.scrollIntoView&&g[0].scrollIntoView(),a.onclick=()=>{const T=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(T)}}};H(Rp,"defaultProps",{...yi.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let ip=Rp;function uM(t){return NT(t.source).name||t.id||hl(`unnamed ${t.stage}-shader`)}const Mp=class Mp extends yi{get[Symbol.toStringTag](){return"Sampler"}constructor(e,i){super(e,i,Mp.defaultProps)}};H(Mp,"defaultProps",{...yi.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let rp=Mp;const kp=class kp extends yi{constructor(i,r={}){super(i,r,kp.defaultProps);H(this,"width");H(this,"height");H(this,"colorAttachments",[]);H(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(i){let r=!i;if(i){const[n,l]=Array.isArray(i)?i:[i.width,i.height];r=r||l!==this.height||n!==this.width,this.width=n,this.height=l}r&&(Je.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const n=this.createColorTexture(r);return this.attachResource(n),n.view}return r instanceof as?r.view:r});const i=this.props.depthStencilAttachment;if(i)if(typeof i=="string"){const r=this.createDepthStencilTexture(i);this.attachResource(r),this.depthStencilAttachment=r.view}else i instanceof as?this.depthStencilAttachment=i.view:this.depthStencilAttachment=i}createColorTexture(i){return this.device.createTexture({id:"color-attachment",usage:as.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}createDepthStencilTexture(i){return this.device.createTexture({id:"depth-stencil-attachment",usage:as.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}resizeAttachments(i,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const l=this.device._createTexture({...this.colorAttachments[n].props,width:i,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=l.view,this.attachResource(l.view)}if(this.depthStencilAttachment){const n=this.device._createTexture({...this.depthStencilAttachment.props,width:i,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}}};H(kp,"defaultProps",{...yi.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let np=kp;const Op=class Op extends yi{constructor(i,r){super(i,r,Op.defaultProps);H(this,"shaderLayout");H(this,"bufferLayout");H(this,"linkStatus","pending");H(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(i){throw new Error("Use uniform blocks")}};H(Op,"defaultProps",{...yi.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Pc=Op;const Fp=class Fp extends yi{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,i){super(e,i,Fp.defaultProps)}};H(Fp,"defaultProps",{...yi.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let wm=Fp;const Dp=class Dp extends yi{constructor(i,r){super(i,r,Dp.defaultProps);H(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};H(Dp,"defaultProps",{...yi.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let sp=Dp;const Np=class Np extends yi{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,i){super(e,i,Np.defaultProps)}};H(Np,"defaultProps",{...yi.defaultProps,measureExecutionTime:void 0});let Tm=Np;const Lp=class Lp extends yi{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,i){super(e,i,Lp.defaultProps)}};H(Lp,"defaultProps",{...yi.defaultProps});let Sm=Lp;function hM(t){const[e,i]=fM[t],r=e==="i32"||e==="u32",n=e!=="u32",l=pM[e]*i,h=dM(e,i);return{dataType:e,components:i,defaultVertexFormat:h,byteLength:l,integer:r,signed:n}}function dM(t,e){let i;switch(t){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?i:`${i}x${e}`}const fM={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},pM={f32:4,f16:2,i32:4,u32:4};function LT(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[i,r]=t.split("x"),n=i,l=r?parseInt(r):1,h=OT(n),a={type:n,components:l,byteLength:h.byteLength*l,integer:h.integer,signed:h.signed,normalized:h.normalized};return e&&(a.webglOnly=!0),a}function BT(t,e){const i={};for(const r of t.attributes)i[r.name]=_M(t,e,r.name);return i}function gM(t,e,i=16){const r=BT(t,e),n=new Array(i).fill(null);for(const l of Object.values(r))n[l.location]=l;return n}function _M(t,e,i){const r=mM(t,i),n=yM(e,i);if(!r)return null;const l=hM(r.type),h=(n==null?void 0:n.vertexFormat)||l.defaultVertexFormat,a=LT(h);return{attributeName:(n==null?void 0:n.attributeName)||r.name,bufferName:(n==null?void 0:n.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:l.dataType,shaderComponents:l.components,vertexFormat:h,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:l.integer,stepMode:(n==null?void 0:n.stepMode)||r.stepMode,byteOffset:(n==null?void 0:n.byteOffset)||0,byteStride:(n==null?void 0:n.byteStride)||0}}function mM(t,e){const i=t.attributes.find(r=>r.name===e);return i||Je.warn(`shader layout attribute "${e}" not present in shader`),i||null}function yM(t,e){xM(t);let i=vM(t,e);return i||(i=bM(t,e),i)?i:(Je.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function xM(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Je.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function vM(t,e){for(const i of t)if(i.format&&i.name===e)return{attributeName:i.name,bufferName:e,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function bM(t,e){var i;for(const r of t){let n=r.byteStride;if(typeof r.byteStride!="number")for(const h of r.attributes||[]){const a=LT(h.format);n+=a.byteLength}const l=(i=r.attributes)==null?void 0:i.find(h=>h.attribute===e);if(l)return{attributeName:l.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:l.format,byteOffset:l.byteOffset,byteStride:n}}return null}function wM(t,e){const i={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const n=i.attributes.find(l=>l.name===r.name);n?(n.type=r.type||n.type,n.stepMode=r.stepMode||n.stepMode):Je.warn(`shader layout attribute ${r.name} not present in shader`)}return i}const Bp=class Bp extends yi{constructor(i,r){super(i,r,Bp.defaultProps);H(this,"maxVertexAttributes");H(this,"attributeInfos");H(this,"indexBuffer",null);H(this,"attributes");this.maxVertexAttributes=i.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=gM(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(i,r){throw new Error("constant attributes not supported")}};H(Bp,"defaultProps",{...yi.defaultProps,renderPipeline:null});let Em=Bp;const zp=class zp extends yi{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,i){super(e,i,zp.defaultProps)}};H(zp,"defaultProps",{...yi.defaultProps,layout:void 0,buffers:{}});let Am=zp;const Up=class Up extends yi{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,i){super(e,i,Up.defaultProps)}};H(Up,"defaultProps",{...yi.defaultProps,type:void 0,count:void 0});let Pm=Up;const TM={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function SM(t){const e=TM[t];return Pi(t),e}function EM(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Jd;function zT(t){return(!Jd||Jd.byteLength<t)&&(Jd=new ArrayBuffer(t)),Jd}function AM(t,e){const i=zT(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}function PM(t){const{target:e,source:i,start:r=0,count:n=1}=t,l=i.length,h=n*l;let a=0;for(let g=r;a<l;a++)e[g++]=i[a];for(;a<h;)a<h-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+h-a),a=h);return t.target}const Xv=1024;class IM{constructor(e){H(this,"layout",{});H(this,"byteLength");let i=0;for(const[n,l]of Object.entries(e)){const h=SM(l),{type:a,components:g}=h;i=EM(i,g);const y=i;i+=g,this.layout[n]={type:a,size:g,offset:y}}i+=(4-i%4)%4;const r=i*4;this.byteLength=Math.max(r,Xv)}getData(e){const i=Math.max(this.byteLength,Xv),r=zT(i),n={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[l,h]of Object.entries(e)){const a=this.layout[l];if(!a){Je.warn(`Supplied uniform value ${l} not present in uniform block layout`)();continue}const{type:g,size:y,offset:T}=a,S=n[g];if(y===1){if(typeof h!="number"&&typeof h!="boolean"){Je.warn(`Supplied value for single component uniform ${l} is not a number: ${h}`)();continue}S[T]=Number(h)}else{const P=gh(h);if(!P){Je.warn(`Supplied value for multi component / array uniform ${l} is not a numeric array: ${h}`)();continue}S.set(P,T)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function CM(t,e,i=16){if(t!==e)return!1;const r=gh(t);if(!r)return!1;const n=gh(e);if(n&&r.length===n.length){for(let l=0;l<r.length;++l)if(n[l]!==r[l])return!1}return!0}function RM(t){const e=gh(t);return e?e.slice():t}class MM{constructor(e){H(this,"name");H(this,"uniforms",{});H(this,"modifiedUniforms",{});H(this,"modified",!0);H(this,"bindingLayout",{});H(this,"needsRedraw","initialized");var i;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(i=e==null?void 0:e.shaderLayout.bindings)==null?void 0:i.find(l=>l.type==="uniform"&&l.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const n=r;for(const l of n.uniforms||[])this.bindingLayout[l.name]=l}}setUniforms(e){for(const[i,r]of Object.entries(e))this._setUniform(i,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,i){CM(this.uniforms[e],i)||(this.uniforms[e]=RM(i),this.modifiedUniforms[e]=!0,this.modified=!0)}}class kM{constructor(e){H(this,"uniformBlocks",new Map);H(this,"uniformBufferLayouts",new Map);H(this,"uniformBuffers",new Map);for(const[i,r]of Object.entries(e)){const n=i,l=new IM(r.uniformTypes||{});this.uniformBufferLayouts.set(n,l);const h=new MM({name:i});h.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(n,h)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[i,r]of Object.entries(e))this.uniformBlocks.get(i).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const i=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(i)}createUniformBuffer(e,i,r){r&&this.setUniforms(r);const n=this.getUniformBufferByteLength(i),l=e.createBuffer({usage:Li.UNIFORM|Li.COPY_DST,byteLength:n}),h=this.getUniformBufferData(i);return l.write(h),l}getManagedUniformBuffer(e,i){if(!this.uniformBuffers.get(i)){const r=this.getUniformBufferByteLength(i),n=e.createBuffer({usage:Li.UNIFORM|Li.COPY_DST,byteLength:r});this.uniformBuffers.set(i,n)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let e=!1;for(const i of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(i);e||(e=r)}return e&&Je.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const i=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let n=!1;if(r&&i.needsRedraw){n||(n=i.needsRedraw);const l=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(l);const a=this.uniformBlocks.get(e).getAllUniforms();Je.log(4,`Writing to uniform buffer ${String(e)}`,l,a)()}return n}}function UT(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function VT(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function OM(t,e,i){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let n=UT(t);if(n==="uint8"&&i&&r===1)return"unorm8-webgl";if(n==="uint8"&&i&&r===3)return"unorm8x3-webgl";if(n==="uint8"||n==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return i&&(n=n.replace("int","norm")),`${n}x${r}`}if(n==="uint16"||n==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return i&&(n=n.replace("int","norm")),`${n}x${r}`}return r===1?n:`${n}x${r}`}function FM(t){return gh(t)!==null||typeof t=="number"||typeof t=="boolean"}function ky(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const r=t[i];FM(r)?e.uniforms[i]=r:e.bindings[i]=r}),e}function DM(t,e,i){const{removedProps:r={},deprecatedProps:n={},replacedProps:l={}}=i;for(const a in r)if(a in e){const y=r[a]?`${t}.${r[a]}`:"N/A";Je.removed(`${t}.${a}`,y)()}for(const a in n)if(a in e){const g=n[a];Je.deprecated(`${t}.${a}`,`${t}.${g}`)()}let h=null;for(const[a,g]of Object.entries(l))a in e&&(Je.deprecated(`${t}.${a}`,`${t}.${g}`)(),h=h||Object.assign({},e),h[g]=e[a],delete h[a]);return h||e}let NM="";async function LM(t,e){return await new Promise((i,r)=>{try{const n=new Image;n.onload=()=>i(n),n.onerror=()=>r(new Error(`Could not load image ${t}.`)),n.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",n.src=t.startsWith("http")?t:NM+t}catch(n){r(n)}})}async function $T(t,e){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),e&&(r.id=e),new Promise((n,l)=>{r.onload=n,r.onerror=h=>l(new Error(`Unable to load script '${t}': ${h}`)),i.appendChild(r)})}function Im(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Im(t[r],e[r],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const l of r)if(!e.hasOwnProperty(l)||!Im(t[l],e[l],i-1))return!1;return!0}return!1}function BM(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function zM(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class UM{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}let Io=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,i){if(e){i(op.instance);for(const r of e)r instanceof Array?this.searchBlock(r,i):r.search(i);i(ap.instance)}}};class op extends Io{}op.instance=new op;class ap extends Io{}ap.instance=new ap;class Bi extends Io{constructor(){super()}}let Cm=class extends Bi{constructor(e,i,r,n,l,h){super(),this.calls=new Set,this.name=e,this.args=i,this.returnType=r,this.body=n,this.startLine=l,this.endLine=h}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}};class VM extends Bi{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class $M extends Bi{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class jM extends Bi{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class WM extends Bi{constructor(e,i,r,n){super(),this.init=e,this.condition=i,this.increment=r,this.body=n}get astNodeType(){return"for"}search(e){var i,r,n;(i=this.init)===null||i===void 0||i.search(e),(r=this.condition)===null||r===void 0||r.search(e),(n=this.increment)===null||n===void 0||n.search(e),this.searchBlock(this.body,e)}}class Xa extends Bi{constructor(e,i,r,n,l){super(),this.name=e,this.type=i,this.storage=r,this.access=n,this.value=l}get astNodeType(){return"var"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class jT extends Bi{constructor(e,i,r){super(),this.name=e,this.type=i,this.value=r}get astNodeType(){return"override"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class Rm extends Bi{constructor(e,i,r,n,l){super(),this.name=e,this.type=i,this.storage=r,this.access=n,this.value=l}get astNodeType(){return"let"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class Zv extends Bi{constructor(e,i,r,n,l){super(),this.name=e,this.type=i,this.storage=r,this.access=n,this.value=l}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}var Ic;(function(t){t.increment="++",t.decrement="--"})(Ic||(Ic={}));(function(t){function e(i){const r=i;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e})(Ic||(Ic={}));class HM extends Bi{constructor(e,i){super(),this.operator=e,this.variable=i}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var _h;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(_h||(_h={}));(function(t){function e(i){const r=i;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e})(_h||(_h={}));class qM extends Bi{constructor(e,i,r){super(),this.operator=e,this.variable=i,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class WT extends Bi{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"call"}search(e){for(const i of this.args)i.search(e);e(this)}}class XM extends Bi{constructor(e,i){super(),this.body=e,this.continuing=i}get astNodeType(){return"loop"}}class ZM extends Bi{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"body"}}class YM extends Bi{constructor(e,i,r,n){super(),this.condition=e,this.body=i,this.elseif=r,this.else=n}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class KM extends Bi{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class GM extends Bi{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class JM extends Bi{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class QM extends Bi{constructor(e,i){super(),this.severity=e,this.rule=i}get astNodeType(){return"diagnostic"}}class HT extends Bi{constructor(e,i){super(),this.name=e,this.type=i}get astNodeType(){return"alias"}}class e3 extends Bi{constructor(){super()}get astNodeType(){return"discard"}}class t3 extends Bi{constructor(){super()}get astNodeType(){return"break"}}class i3 extends Bi{constructor(){super()}get astNodeType(){return"continue"}}class dl extends Bi{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class qa extends dl{constructor(e,i,r,n){super(e),this.members=i,this.startLine=r,this.endLine=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let i=0;i<this.members.length;i++)if(this.members[i].name==e)return i;return-1}}class qT extends dl{constructor(e,i,r){super(e),this.format=i,this.access=r}get astNodeType(){return"template"}}class r3 extends dl{constructor(e,i,r,n){super(e),this.storage=i,this.type=r,this.access=n}get astNodeType(){return"pointer"}}class XT extends dl{constructor(e,i,r,n){super(e),this.attributes=i,this.format=r,this.count=n}get astNodeType(){return"array"}get isArray(){return!0}}class Ju extends dl{constructor(e,i,r){super(e),this.format=i,this.access=r}get astNodeType(){return"sampler"}}class Js extends Io{constructor(){super()}}class n3 extends Js{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class oc extends Js{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const i of this.args)i.search(e)}evaluate(e){return this.args[0].evaluate(e)}}class ZT extends Js{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const i of this.args)i.search(e);e(this)}}class Mm extends Js{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const i=e.constants.get(this.name);if(!i)throw new Error("Cannot evaluate node");return i.evaluate(e)}}class Yv extends Js{constructor(e,i){super(),this.name=e,this.initializer=i}get astNodeType(){return"constExpr"}evaluate(e){var i,r;if(this.initializer instanceof oc){const n=(i=this.postfix)===null||i===void 0?void 0:i.evaluateString(e),l=(r=this.initializer.type)===null||r===void 0?void 0:r.name,h=e.structs.get(l),a=h==null?void 0:h.getMemberIndex(n);return a!==void 0&&a!=-1?this.initializer.args[a].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class Kv extends Js{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class s3 extends Js{constructor(e,i){super(),this.type=e,this.value=i}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Gv extends Js{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class o3 extends Js{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class YT extends Js{constructor(){super()}}class a3 extends YT{constructor(e,i){super(),this.operator=e,this.right=i}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class $s extends YT{constructor(e,i,r){super(),this.operator=e,this.left=i,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class KT extends Io{constructor(){super()}}class l3 extends KT{constructor(e,i){super(),this.selector=e,this.body=i}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class c3 extends KT{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class u3 extends Io{constructor(e,i,r){super(),this.name=e,this.type=i,this.attributes=r}get astNodeType(){return"argument"}}class h3 extends Io{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class d3 extends Io{constructor(e,i,r){super(),this.name=e,this.type=i,this.attributes=r}get astNodeType(){return"member"}}let f3=class extends Io{constructor(e,i){super(),this.name=e,this.value=i}get astNodeType(){return"attribute"}};var Ae,Te;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Te||(Te={}));class Se{constructor(e,i,r){this.name=e,this.type=i,this.rule=r}toString(){return this.name}}class ie{}Ae=ie;ie.none=new Se("",Te.reserved,"");ie.eof=new Se("EOF",Te.token,"");ie.reserved={asm:new Se("asm",Te.reserved,"asm"),bf16:new Se("bf16",Te.reserved,"bf16"),do:new Se("do",Te.reserved,"do"),enum:new Se("enum",Te.reserved,"enum"),f16:new Se("f16",Te.reserved,"f16"),f64:new Se("f64",Te.reserved,"f64"),handle:new Se("handle",Te.reserved,"handle"),i8:new Se("i8",Te.reserved,"i8"),i16:new Se("i16",Te.reserved,"i16"),i64:new Se("i64",Te.reserved,"i64"),mat:new Se("mat",Te.reserved,"mat"),premerge:new Se("premerge",Te.reserved,"premerge"),regardless:new Se("regardless",Te.reserved,"regardless"),typedef:new Se("typedef",Te.reserved,"typedef"),u8:new Se("u8",Te.reserved,"u8"),u16:new Se("u16",Te.reserved,"u16"),u64:new Se("u64",Te.reserved,"u64"),unless:new Se("unless",Te.reserved,"unless"),using:new Se("using",Te.reserved,"using"),vec:new Se("vec",Te.reserved,"vec"),void:new Se("void",Te.reserved,"void")};ie.keywords={array:new Se("array",Te.keyword,"array"),atomic:new Se("atomic",Te.keyword,"atomic"),bool:new Se("bool",Te.keyword,"bool"),f32:new Se("f32",Te.keyword,"f32"),i32:new Se("i32",Te.keyword,"i32"),mat2x2:new Se("mat2x2",Te.keyword,"mat2x2"),mat2x3:new Se("mat2x3",Te.keyword,"mat2x3"),mat2x4:new Se("mat2x4",Te.keyword,"mat2x4"),mat3x2:new Se("mat3x2",Te.keyword,"mat3x2"),mat3x3:new Se("mat3x3",Te.keyword,"mat3x3"),mat3x4:new Se("mat3x4",Te.keyword,"mat3x4"),mat4x2:new Se("mat4x2",Te.keyword,"mat4x2"),mat4x3:new Se("mat4x3",Te.keyword,"mat4x3"),mat4x4:new Se("mat4x4",Te.keyword,"mat4x4"),ptr:new Se("ptr",Te.keyword,"ptr"),sampler:new Se("sampler",Te.keyword,"sampler"),sampler_comparison:new Se("sampler_comparison",Te.keyword,"sampler_comparison"),struct:new Se("struct",Te.keyword,"struct"),texture_1d:new Se("texture_1d",Te.keyword,"texture_1d"),texture_2d:new Se("texture_2d",Te.keyword,"texture_2d"),texture_2d_array:new Se("texture_2d_array",Te.keyword,"texture_2d_array"),texture_3d:new Se("texture_3d",Te.keyword,"texture_3d"),texture_cube:new Se("texture_cube",Te.keyword,"texture_cube"),texture_cube_array:new Se("texture_cube_array",Te.keyword,"texture_cube_array"),texture_multisampled_2d:new Se("texture_multisampled_2d",Te.keyword,"texture_multisampled_2d"),texture_storage_1d:new Se("texture_storage_1d",Te.keyword,"texture_storage_1d"),texture_storage_2d:new Se("texture_storage_2d",Te.keyword,"texture_storage_2d"),texture_storage_2d_array:new Se("texture_storage_2d_array",Te.keyword,"texture_storage_2d_array"),texture_storage_3d:new Se("texture_storage_3d",Te.keyword,"texture_storage_3d"),texture_depth_2d:new Se("texture_depth_2d",Te.keyword,"texture_depth_2d"),texture_depth_2d_array:new Se("texture_depth_2d_array",Te.keyword,"texture_depth_2d_array"),texture_depth_cube:new Se("texture_depth_cube",Te.keyword,"texture_depth_cube"),texture_depth_cube_array:new Se("texture_depth_cube_array",Te.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Se("texture_depth_multisampled_2d",Te.keyword,"texture_depth_multisampled_2d"),texture_external:new Se("texture_external",Te.keyword,"texture_external"),u32:new Se("u32",Te.keyword,"u32"),vec2:new Se("vec2",Te.keyword,"vec2"),vec3:new Se("vec3",Te.keyword,"vec3"),vec4:new Se("vec4",Te.keyword,"vec4"),bitcast:new Se("bitcast",Te.keyword,"bitcast"),block:new Se("block",Te.keyword,"block"),break:new Se("break",Te.keyword,"break"),case:new Se("case",Te.keyword,"case"),continue:new Se("continue",Te.keyword,"continue"),continuing:new Se("continuing",Te.keyword,"continuing"),default:new Se("default",Te.keyword,"default"),diagnostic:new Se("diagnostic",Te.keyword,"diagnostic"),discard:new Se("discard",Te.keyword,"discard"),else:new Se("else",Te.keyword,"else"),enable:new Se("enable",Te.keyword,"enable"),fallthrough:new Se("fallthrough",Te.keyword,"fallthrough"),false:new Se("false",Te.keyword,"false"),fn:new Se("fn",Te.keyword,"fn"),for:new Se("for",Te.keyword,"for"),function:new Se("function",Te.keyword,"function"),if:new Se("if",Te.keyword,"if"),let:new Se("let",Te.keyword,"let"),const:new Se("const",Te.keyword,"const"),loop:new Se("loop",Te.keyword,"loop"),while:new Se("while",Te.keyword,"while"),private:new Se("private",Te.keyword,"private"),read:new Se("read",Te.keyword,"read"),read_write:new Se("read_write",Te.keyword,"read_write"),return:new Se("return",Te.keyword,"return"),requires:new Se("requires",Te.keyword,"requires"),storage:new Se("storage",Te.keyword,"storage"),switch:new Se("switch",Te.keyword,"switch"),true:new Se("true",Te.keyword,"true"),alias:new Se("alias",Te.keyword,"alias"),type:new Se("type",Te.keyword,"type"),uniform:new Se("uniform",Te.keyword,"uniform"),var:new Se("var",Te.keyword,"var"),override:new Se("override",Te.keyword,"override"),workgroup:new Se("workgroup",Te.keyword,"workgroup"),write:new Se("write",Te.keyword,"write"),r8unorm:new Se("r8unorm",Te.keyword,"r8unorm"),r8snorm:new Se("r8snorm",Te.keyword,"r8snorm"),r8uint:new Se("r8uint",Te.keyword,"r8uint"),r8sint:new Se("r8sint",Te.keyword,"r8sint"),r16uint:new Se("r16uint",Te.keyword,"r16uint"),r16sint:new Se("r16sint",Te.keyword,"r16sint"),r16float:new Se("r16float",Te.keyword,"r16float"),rg8unorm:new Se("rg8unorm",Te.keyword,"rg8unorm"),rg8snorm:new Se("rg8snorm",Te.keyword,"rg8snorm"),rg8uint:new Se("rg8uint",Te.keyword,"rg8uint"),rg8sint:new Se("rg8sint",Te.keyword,"rg8sint"),r32uint:new Se("r32uint",Te.keyword,"r32uint"),r32sint:new Se("r32sint",Te.keyword,"r32sint"),r32float:new Se("r32float",Te.keyword,"r32float"),rg16uint:new Se("rg16uint",Te.keyword,"rg16uint"),rg16sint:new Se("rg16sint",Te.keyword,"rg16sint"),rg16float:new Se("rg16float",Te.keyword,"rg16float"),rgba8unorm:new Se("rgba8unorm",Te.keyword,"rgba8unorm"),rgba8unorm_srgb:new Se("rgba8unorm_srgb",Te.keyword,"rgba8unorm_srgb"),rgba8snorm:new Se("rgba8snorm",Te.keyword,"rgba8snorm"),rgba8uint:new Se("rgba8uint",Te.keyword,"rgba8uint"),rgba8sint:new Se("rgba8sint",Te.keyword,"rgba8sint"),bgra8unorm:new Se("bgra8unorm",Te.keyword,"bgra8unorm"),bgra8unorm_srgb:new Se("bgra8unorm_srgb",Te.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Se("rgb10a2unorm",Te.keyword,"rgb10a2unorm"),rg11b10float:new Se("rg11b10float",Te.keyword,"rg11b10float"),rg32uint:new Se("rg32uint",Te.keyword,"rg32uint"),rg32sint:new Se("rg32sint",Te.keyword,"rg32sint"),rg32float:new Se("rg32float",Te.keyword,"rg32float"),rgba16uint:new Se("rgba16uint",Te.keyword,"rgba16uint"),rgba16sint:new Se("rgba16sint",Te.keyword,"rgba16sint"),rgba16float:new Se("rgba16float",Te.keyword,"rgba16float"),rgba32uint:new Se("rgba32uint",Te.keyword,"rgba32uint"),rgba32sint:new Se("rgba32sint",Te.keyword,"rgba32sint"),rgba32float:new Se("rgba32float",Te.keyword,"rgba32float"),static_assert:new Se("static_assert",Te.keyword,"static_assert")};ie.tokens={decimal_float_literal:new Se("decimal_float_literal",Te.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Se("hex_float_literal",Te.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Se("int_literal",Te.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Se("uint_literal",Te.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Se("ident",Te.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Se("and",Te.token,"&"),and_and:new Se("and_and",Te.token,"&&"),arrow:new Se("arrow ",Te.token,"->"),attr:new Se("attr",Te.token,"@"),forward_slash:new Se("forward_slash",Te.token,"/"),bang:new Se("bang",Te.token,"!"),bracket_left:new Se("bracket_left",Te.token,"["),bracket_right:new Se("bracket_right",Te.token,"]"),brace_left:new Se("brace_left",Te.token,"{"),brace_right:new Se("brace_right",Te.token,"}"),colon:new Se("colon",Te.token,":"),comma:new Se("comma",Te.token,","),equal:new Se("equal",Te.token,"="),equal_equal:new Se("equal_equal",Te.token,"=="),not_equal:new Se("not_equal",Te.token,"!="),greater_than:new Se("greater_than",Te.token,">"),greater_than_equal:new Se("greater_than_equal",Te.token,">="),shift_right:new Se("shift_right",Te.token,">>"),less_than:new Se("less_than",Te.token,"<"),less_than_equal:new Se("less_than_equal",Te.token,"<="),shift_left:new Se("shift_left",Te.token,"<<"),modulo:new Se("modulo",Te.token,"%"),minus:new Se("minus",Te.token,"-"),minus_minus:new Se("minus_minus",Te.token,"--"),period:new Se("period",Te.token,"."),plus:new Se("plus",Te.token,"+"),plus_plus:new Se("plus_plus",Te.token,"++"),or:new Se("or",Te.token,"|"),or_or:new Se("or_or",Te.token,"||"),paren_left:new Se("paren_left",Te.token,"("),paren_right:new Se("paren_right",Te.token,")"),semicolon:new Se("semicolon",Te.token,";"),star:new Se("star",Te.token,"*"),tilde:new Se("tilde",Te.token,"~"),underscore:new Se("underscore",Te.token,"_"),xor:new Se("xor",Te.token,"^"),plus_equal:new Se("plus_equal",Te.token,"+="),minus_equal:new Se("minus_equal",Te.token,"-="),times_equal:new Se("times_equal",Te.token,"*="),division_equal:new Se("division_equal",Te.token,"/="),modulo_equal:new Se("modulo_equal",Te.token,"%="),and_equal:new Se("and_equal",Te.token,"&="),or_equal:new Se("or_equal",Te.token,"|="),xor_equal:new Se("xor_equal",Te.token,"^="),shift_right_equal:new Se("shift_right_equal",Te.token,">>="),shift_left_equal:new Se("shift_left_equal",Te.token,"<<=")};ie.simpleTokens={"@":Ae.tokens.attr,"{":Ae.tokens.brace_left,"}":Ae.tokens.brace_right,":":Ae.tokens.colon,",":Ae.tokens.comma,"(":Ae.tokens.paren_left,")":Ae.tokens.paren_right,";":Ae.tokens.semicolon};ie.literalTokens={"&":Ae.tokens.and,"&&":Ae.tokens.and_and,"->":Ae.tokens.arrow,"/":Ae.tokens.forward_slash,"!":Ae.tokens.bang,"[":Ae.tokens.bracket_left,"]":Ae.tokens.bracket_right,"=":Ae.tokens.equal,"==":Ae.tokens.equal_equal,"!=":Ae.tokens.not_equal,">":Ae.tokens.greater_than,">=":Ae.tokens.greater_than_equal,">>":Ae.tokens.shift_right,"<":Ae.tokens.less_than,"<=":Ae.tokens.less_than_equal,"<<":Ae.tokens.shift_left,"%":Ae.tokens.modulo,"-":Ae.tokens.minus,"--":Ae.tokens.minus_minus,".":Ae.tokens.period,"+":Ae.tokens.plus,"++":Ae.tokens.plus_plus,"|":Ae.tokens.or,"||":Ae.tokens.or_or,"*":Ae.tokens.star,"~":Ae.tokens.tilde,_:Ae.tokens.underscore,"^":Ae.tokens.xor,"+=":Ae.tokens.plus_equal,"-=":Ae.tokens.minus_equal,"*=":Ae.tokens.times_equal,"/=":Ae.tokens.division_equal,"%=":Ae.tokens.modulo_equal,"&=":Ae.tokens.and_equal,"|=":Ae.tokens.or_equal,"^=":Ae.tokens.xor_equal,">>=":Ae.tokens.shift_right_equal,"<<=":Ae.tokens.shift_left_equal};ie.regexTokens={decimal_float_literal:Ae.tokens.decimal_float_literal,hex_float_literal:Ae.tokens.hex_float_literal,int_literal:Ae.tokens.int_literal,uint_literal:Ae.tokens.uint_literal,ident:Ae.tokens.ident};ie.storage_class=[Ae.keywords.function,Ae.keywords.private,Ae.keywords.workgroup,Ae.keywords.uniform,Ae.keywords.storage];ie.access_mode=[Ae.keywords.read,Ae.keywords.write,Ae.keywords.read_write];ie.sampler_type=[Ae.keywords.sampler,Ae.keywords.sampler_comparison];ie.sampled_texture_type=[Ae.keywords.texture_1d,Ae.keywords.texture_2d,Ae.keywords.texture_2d_array,Ae.keywords.texture_3d,Ae.keywords.texture_cube,Ae.keywords.texture_cube_array];ie.multisampled_texture_type=[Ae.keywords.texture_multisampled_2d];ie.storage_texture_type=[Ae.keywords.texture_storage_1d,Ae.keywords.texture_storage_2d,Ae.keywords.texture_storage_2d_array,Ae.keywords.texture_storage_3d];ie.depth_texture_type=[Ae.keywords.texture_depth_2d,Ae.keywords.texture_depth_2d_array,Ae.keywords.texture_depth_cube,Ae.keywords.texture_depth_cube_array,Ae.keywords.texture_depth_multisampled_2d];ie.texture_external_type=[Ae.keywords.texture_external];ie.any_texture_type=[...Ae.sampled_texture_type,...Ae.multisampled_texture_type,...Ae.storage_texture_type,...Ae.depth_texture_type,...Ae.texture_external_type];ie.texel_format=[Ae.keywords.r8unorm,Ae.keywords.r8snorm,Ae.keywords.r8uint,Ae.keywords.r8sint,Ae.keywords.r16uint,Ae.keywords.r16sint,Ae.keywords.r16float,Ae.keywords.rg8unorm,Ae.keywords.rg8snorm,Ae.keywords.rg8uint,Ae.keywords.rg8sint,Ae.keywords.r32uint,Ae.keywords.r32sint,Ae.keywords.r32float,Ae.keywords.rg16uint,Ae.keywords.rg16sint,Ae.keywords.rg16float,Ae.keywords.rgba8unorm,Ae.keywords.rgba8unorm_srgb,Ae.keywords.rgba8snorm,Ae.keywords.rgba8uint,Ae.keywords.rgba8sint,Ae.keywords.bgra8unorm,Ae.keywords.bgra8unorm_srgb,Ae.keywords.rgb10a2unorm,Ae.keywords.rg11b10float,Ae.keywords.rg32uint,Ae.keywords.rg32sint,Ae.keywords.rg32float,Ae.keywords.rgba16uint,Ae.keywords.rgba16sint,Ae.keywords.rgba16float,Ae.keywords.rgba32uint,Ae.keywords.rgba32sint,Ae.keywords.rgba32float];ie.const_literal=[Ae.tokens.int_literal,Ae.tokens.uint_literal,Ae.tokens.decimal_float_literal,Ae.tokens.hex_float_literal,Ae.keywords.true,Ae.keywords.false];ie.literal_or_ident=[Ae.tokens.ident,Ae.tokens.int_literal,Ae.tokens.uint_literal,Ae.tokens.decimal_float_literal,Ae.tokens.hex_float_literal];ie.element_count_expression=[Ae.tokens.int_literal,Ae.tokens.uint_literal,Ae.tokens.ident];ie.template_types=[Ae.keywords.vec2,Ae.keywords.vec3,Ae.keywords.vec4,Ae.keywords.mat2x2,Ae.keywords.mat2x3,Ae.keywords.mat2x4,Ae.keywords.mat3x2,Ae.keywords.mat3x3,Ae.keywords.mat3x4,Ae.keywords.mat4x2,Ae.keywords.mat4x3,Ae.keywords.mat4x4,Ae.keywords.atomic,Ae.keywords.bitcast,...Ae.any_texture_type];ie.attribute_name=[Ae.tokens.ident,Ae.keywords.block,Ae.keywords.diagnostic];ie.assignment_operators=[Ae.tokens.equal,Ae.tokens.plus_equal,Ae.tokens.minus_equal,Ae.tokens.times_equal,Ae.tokens.division_equal,Ae.tokens.modulo_equal,Ae.tokens.and_equal,Ae.tokens.or_equal,Ae.tokens.xor_equal,Ae.tokens.shift_right_equal,Ae.tokens.shift_left_equal];ie.increment_operators=[Ae.tokens.plus_plus,Ae.tokens.minus_minus];class Jv{constructor(e,i,r){this.type=e,this.lexeme=i,this.line=r}toString(){return this.lexeme}isTemplateType(){return ie.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ie.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class p3{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Jv(ie.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let h=1;for(;h>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),h--,h==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),h++)}return!0}}const i=ie.simpleTokens[e];if(i)return this._addToken(i),!0;let r=ie.none;const n=this._isAlpha(e),l=e==="_";if(this._isAlphaNumeric(e)){let h=this._peekAhead();for(;this._isAlphaNumeric(h);)e+=this._advance(),h=this._peekAhead()}if(n){const h=ie.keywords[e];if(h)return this._addToken(h),!0}if(n||l)return this._addToken(ie.tokens.ident),!0;for(;;){let h=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(ie.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(ie.tokens.minus_minus),!0;const g=this._tokens.length-1;if((ie.literal_or_ident.indexOf(this._tokens[g].type)!=-1||this._tokens[g].type==ie.tokens.paren_right)&&a!=">")return this._addToken(h),!0}if(e==">"&&(a==">"||a=="=")){let g=!1,y=this._tokens.length-1;for(let T=0;T<5&&y>=0&&ie.assignment_operators.indexOf(this._tokens[y].type)===-1;++T,--y)if(this._tokens[y].type===ie.tokens.less_than){y>0&&this._tokens[y-1].isArrayOrTemplateType()&&(g=!0);break}if(g)return this._addToken(h),!0}if(h===ie.none){let g=e,y=0;const T=2;for(let S=0;S<T;++S)if(g+=this._peekAhead(S),h=this._findType(g),h!==ie.none){y=S;break}if(h===ie.none)return r===ie.none?!1:(this._current--,this._addToken(r),!0);e=g,this._current+=y+1}if(r=h,this._isAtEnd())break;e+=this._advance()}return r===ie.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in ie.regexTokens){const n=ie.regexTokens[r];if(this._match(e,n.rule))return n}const i=ie.literalTokens[e];return i||ie.none}_match(e,i){const r=i.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let i=this._source[this._current];return e=e||0,e++,this._current+=e,i}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const i=this._source.substring(this._start,this._current);this._tokens.push(new Jv(e,i,this._line))}}class g3{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new UM,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const i=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;i.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const n=r.arrayType,l=r.countNode;if(l instanceof Mm){const a=l.name,g=this._context.constants.get(a);if(g)try{const y=g.evaluate(this._context);n.count=y}catch{}}}this._deferArrayCountEval.length=0}return i}_initialize(e){if(e)if(typeof e=="string"){const i=new p3(e);this._tokens=i.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,i){return{token:e,message:i,toString:function(){return`${i}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ie.eof}_match(e){if(e instanceof Se)return this._check(e)?(this._advance(),!0):!1;for(let i=0,r=e.length;i<r;++i){const n=e[i];if(this._check(n))return this._advance(),!0}return!1}_consume(e,i){if(this._check(e))return this._advance();throw this._error(this._peek(),i)}_check(e){if(this._isAtEnd())return!1;const i=this._peek();if(e instanceof Array){const r=i.type;return e.indexOf(r)!=-1}return i.type==e}_advance(){var e,i;return this._currentLine=(i=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&i!==void 0?i:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ie.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ie.keywords.alias)){const i=this._type_alias();return this._consume(ie.tokens.semicolon,"Expected ';'"),i}if(this._match(ie.keywords.diagnostic)){const i=this._diagnostic();return this._consume(ie.tokens.semicolon,"Expected ';'"),i}if(this._match(ie.keywords.requires)){const i=this._requires_directive();return this._consume(ie.tokens.semicolon,"Expected ';'"),i}if(this._match(ie.keywords.enable)){const i=this._enable_directive();return this._consume(ie.tokens.semicolon,"Expected ';'"),i}const e=this._attribute();if(this._check(ie.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),i}if(this._check(ie.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),i}if(this._check(ie.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),i}if(this._check(ie.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),i}if(this._check(ie.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=e),i}if(this._check(ie.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=e),i}return null}_function_decl(){if(!this._match(ie.keywords.fn))return null;const e=this._currentLine,i=this._consume(ie.tokens.ident,"Expected function name.").toString();this._consume(ie.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(ie.tokens.paren_right))do{if(this._check(ie.tokens.paren_right))break;const a=this._attribute(),g=this._consume(ie.tokens.ident,"Expected argument name.").toString();this._consume(ie.tokens.colon,"Expected ':' for argument type.");const y=this._attribute(),T=this._type_decl();T!=null&&(T.attributes=y,r.push(new u3(g,T,a)))}while(this._match(ie.tokens.comma));this._consume(ie.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(ie.tokens.arrow)){const a=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=a)}const l=this._compound_statement(),h=this._currentLine;return new Cm(i,r,n,l,e,h)}_compound_statement(){const e=[];for(this._consume(ie.tokens.brace_left,"Expected '{' for block.");!this._check(ie.tokens.brace_right);){const i=this._statement();i!==null&&e.push(i)}return this._consume(ie.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ie.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ie.tokens.attr)&&this._attribute(),this._check(ie.keywords.if))return this._if_statement();if(this._check(ie.keywords.switch))return this._switch_statement();if(this._check(ie.keywords.loop))return this._loop_statement();if(this._check(ie.keywords.for))return this._for_statement();if(this._check(ie.keywords.while))return this._while_statement();if(this._check(ie.keywords.continuing))return this._continuing_statement();if(this._check(ie.keywords.static_assert))return this._static_assert_statement();if(this._check(ie.tokens.brace_left))return this._compound_statement();let e=null;return this._check(ie.keywords.return)?e=this._return_statement():this._check([ie.keywords.var,ie.keywords.let,ie.keywords.const])?e=this._variable_statement():this._match(ie.keywords.discard)?e=new e3:this._match(ie.keywords.break)?e=new t3:this._match(ie.keywords.continue)?e=new i3:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(ie.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ie.keywords.static_assert))return null;const e=this._optional_paren_expression();return new VM(e)}_while_statement(){if(!this._match(ie.keywords.while))return null;const e=this._optional_paren_expression();this._check(ie.tokens.attr)&&this._attribute();const i=this._compound_statement();return new $M(e,i)}_continuing_statement(){if(!this._match(ie.keywords.continuing))return null;const e=this._compound_statement();return new jM(e)}_for_statement(){if(!this._match(ie.keywords.for))return null;this._consume(ie.tokens.paren_left,"Expected '('.");const e=this._check(ie.tokens.semicolon)?null:this._for_init();this._consume(ie.tokens.semicolon,"Expected ';'.");const i=this._check(ie.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(ie.tokens.semicolon,"Expected ';'.");const r=this._check(ie.tokens.paren_right)?null:this._for_increment();this._consume(ie.tokens.paren_right,"Expected ')'."),this._check(ie.tokens.attr)&&this._attribute();const n=this._compound_statement();return new WM(e,i,r,n)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ie.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(ie.tokens.equal)&&(i=this._short_circuit_or_expression()),new Xa(e.name,e.type,e.storage,e.access,i)}if(this._match(ie.keywords.let)){const e=this._consume(ie.tokens.ident,"Expected name for let.").toString();let i=null;if(this._match(ie.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}this._consume(ie.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new Rm(e,i,null,null,r)}if(this._match(ie.keywords.const)){const e=this._consume(ie.tokens.ident,"Expected name for const.").toString();let i=null;if(this._match(ie.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}this._consume(ie.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new Zv(e,i,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(ie.increment_operators))return this._current=e,null;const r=this._consume(ie.increment_operators,"Expected increment operator");return new HM(r.type===ie.tokens.plus_plus?Ic.increment:Ic.decrement,i)}_assignment_statement(){let e=null;if(this._check(ie.tokens.brace_right))return null;let i=this._match(ie.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const r=this._consume(ie.assignment_operators,"Expected assignment operator."),n=this._short_circuit_or_expression();return new qM(_h.parse(r.lexeme),e,n)}_func_call_statement(){if(!this._check(ie.tokens.ident))return null;const e=this._current,i=this._consume(ie.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new WT(i.lexeme,r)}_loop_statement(){if(!this._match(ie.keywords.loop))return null;this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Expected '{' for loop.");const e=[];let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let n of i)e.push(n);else e.push(i);i=this._statement()}let r=null;return this._match(ie.keywords.continuing)&&(r=this._compound_statement()),this._consume(ie.tokens.brace_right,"Expected '}' for loop."),new XM(e,r)}_switch_statement(){if(!this._match(ie.keywords.switch))return null;const e=this._optional_paren_expression();this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Expected '{' for switch.");const i=this._switch_body();if(i==null||i.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ie.tokens.brace_right,"Expected '}' for switch."),new ZM(e,i)}_switch_body(){const e=[];if(this._match(ie.keywords.case)){const i=this._case_selectors();this._match(ie.tokens.colon),this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(ie.tokens.brace_right,"Exected '}' for switch case."),e.push(new l3(i,r))}if(this._match(ie.keywords.default)){this._match(ie.tokens.colon),this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(ie.tokens.brace_right,"Exected '}' for switch default."),e.push(new c3(i))}if(this._check([ie.keywords.default,ie.keywords.case])){const i=this._switch_body();e.push(i[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(ie.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(ie.keywords.fallthrough))return this._consume(ie.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const i=this._case_body();return i.length==0?e:[...e,i[0]]}_if_statement(){if(!this._match(ie.keywords.if))return null;const e=this._optional_paren_expression();this._check(ie.tokens.attr)&&this._attribute();const i=this._compound_statement();let r=[];this._match_elseif()&&(this._check(ie.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let n=null;return this._match(ie.keywords.else)&&(this._check(ie.tokens.attr)&&this._attribute(),n=this._compound_statement()),new YM(e,i,r,n)}_match_elseif(){return this._tokens[this._current].type===ie.keywords.else&&this._tokens[this._current+1].type===ie.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const i=this._optional_paren_expression(),r=this._compound_statement();return e.push(new h3(i,r)),this._match_elseif()&&(this._check(ie.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ie.keywords.return))return null;const e=this._short_circuit_or_expression();return new KM(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ie.tokens.or_or);)e=new $s(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ie.tokens.and_and);)e=new $s(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ie.tokens.or);)e=new $s(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ie.tokens.xor);)e=new $s(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(ie.tokens.and);)e=new $s(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([ie.tokens.equal_equal,ie.tokens.not_equal])?new $s(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ie.tokens.less_than,ie.tokens.greater_than,ie.tokens.less_than_equal,ie.tokens.greater_than_equal]);)e=new $s(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ie.tokens.shift_left,ie.tokens.shift_right]);)e=new $s(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ie.tokens.plus,ie.tokens.minus]);)e=new $s(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ie.tokens.star,ie.tokens.forward_slash,ie.tokens.modulo]);)e=new $s(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([ie.tokens.minus,ie.tokens.bang,ie.tokens.tilde,ie.tokens.star,ie.tokens.and])?new a3(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),i=this._postfix_expression();return i&&(e.postfix=i),e}_postfix_expression(){if(this._match(ie.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ie.tokens.bracket_right,"Expected ']'.");const i=new o3(e),r=this._postfix_expression();return r&&(i.postfix=r),i}if(this._match(ie.tokens.period)){const e=this._consume(ie.tokens.ident,"Expected member name."),i=this._postfix_expression(),r=new n3(e.lexeme);return i&&(r.postfix=i),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(ie.tokens.ident)){const r=this._previous().toString();if(this._check(ie.tokens.paren_left)){const n=this._argument_expression_list(),l=this._getStruct(r);return l!=null?new oc(l,n):new ZT(r,n)}if(this._context.constants.has(r)){const n=this._context.constants.get(r);return new Yv(r,n.value)}return new Mm(r)}if(this._match(ie.const_literal))return new Kv(parseFloat(this._previous().toString()));if(this._check(ie.tokens.paren_left))return this._paren_expression();if(this._match(ie.keywords.bitcast)){this._consume(ie.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(ie.tokens.greater_than,"Expected '>'.");const n=this._paren_expression();return new s3(r,n)}const e=this._type_decl(),i=this._argument_expression_list();return new oc(e,i)}_argument_expression_list(){if(!this._match(ie.tokens.paren_left))return null;const e=[];do{if(this._check(ie.tokens.paren_right))break;const i=this._short_circuit_or_expression();e.push(i)}while(this._match(ie.tokens.comma));return this._consume(ie.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ie.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ie.tokens.paren_right),new Gv([e])}_paren_expression(){this._consume(ie.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ie.tokens.paren_right,"Expected ')'."),new Gv([e])}_struct_decl(){if(!this._match(ie.keywords.struct))return null;const e=this._currentLine,i=this._consume(ie.tokens.ident,"Expected name for struct.").toString();this._consume(ie.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(ie.tokens.brace_right);){const h=this._attribute(),a=this._consume(ie.tokens.ident,"Expected variable name.").toString();this._consume(ie.tokens.colon,"Expected ':' for struct member type.");const g=this._attribute(),y=this._type_decl();y!=null&&(y.attributes=g),this._check(ie.tokens.brace_right)?this._match(ie.tokens.comma):this._consume(ie.tokens.comma,"Expected ',' for struct member."),r.push(new d3(a,y,h))}this._consume(ie.tokens.brace_right,"Expected '}' after struct body.");const n=this._currentLine,l=new qa(i,r,e,n);return this._context.structs.set(i,l),l}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(ie.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ie.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(ie.keywords.const))return null;const e=this._consume(ie.tokens.ident,"Expected variable name");let i=null;if(this._match(ie.tokens.colon)){const l=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=l)}let r=null;if(this._match(ie.tokens.equal)){const l=this._short_circuit_or_expression();if(l instanceof oc)r=l;else if(l instanceof Yv&&l.initializer instanceof oc)r=l.initializer;else try{const h=l.evaluate(this._context);r=new Kv(h)}catch{r=l}}const n=new Zv(e.toString(),i,"","",r);return this._context.constants.set(n.name,n),n}_global_let_decl(){if(!this._match(ie.keywords.let))return null;const e=this._consume(ie.tokens.ident,"Expected variable name");let i=null;if(this._match(ie.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}let r=null;return this._match(ie.tokens.equal)&&(r=this._const_expression()),new Rm(e.toString(),i,"","",r)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ie.keywords.var))return null;let e="",i="";this._match(ie.tokens.less_than)&&(e=this._consume(ie.storage_class,"Expected storage_class.").toString(),this._match(ie.tokens.comma)&&(i=this._consume(ie.access_mode,"Expected access_mode.").toString()),this._consume(ie.tokens.greater_than,"Expected '>'."));const r=this._consume(ie.tokens.ident,"Expected variable name");let n=null;if(this._match(ie.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}return new Xa(r.toString(),n,e,i,null)}_override_decl(){if(!this._match(ie.keywords.override))return null;const e=this._consume(ie.tokens.ident,"Expected variable name");let i=null;if(this._match(ie.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}return new jT(e.toString(),i,null)}_diagnostic(){this._consume(ie.tokens.paren_left,"Expected '('");const e=this._consume(ie.tokens.ident,"Expected severity control name.");this._consume(ie.tokens.comma,"Expected ','");const i=this._consume(ie.tokens.ident,"Expected diagnostic rule name.");return this._consume(ie.tokens.paren_right,"Expected ')'"),new QM(e.toString(),i.toString())}_enable_directive(){const e=this._consume(ie.tokens.ident,"identity expected.");return new GM(e.toString())}_requires_directive(){const e=[this._consume(ie.tokens.ident,"identity expected.").toString()];for(;this._match(ie.tokens.comma);){const i=this._consume(ie.tokens.ident,"identity expected.");e.push(i.toString())}return new JM(e)}_type_alias(){const e=this._consume(ie.tokens.ident,"identity expected.");this._consume(ie.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const r=new HT(e.toString(),i);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([ie.tokens.ident,...ie.texel_format,ie.keywords.bool,ie.keywords.f32,ie.keywords.i32,ie.keywords.u32])){const r=this._advance(),n=r.toString();return this._context.structs.has(n)?this._context.structs.get(n):this._context.aliases.has(n)?this._context.aliases.get(n).type:new dl(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(ie.template_types)){let r=this._advance().toString(),n=null,l=null;return this._match(ie.tokens.less_than)&&(n=this._type_decl(),l=null,this._match(ie.tokens.comma)&&(l=this._consume(ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(ie.tokens.greater_than,"Expected '>' for type.")),new qT(r,n,l)}if(this._match(ie.keywords.ptr)){let r=this._previous().toString();this._consume(ie.tokens.less_than,"Expected '<' for pointer.");const n=this._consume(ie.storage_class,"Expected storage_class for pointer");this._consume(ie.tokens.comma,"Expected ',' for pointer.");const l=this._type_decl();let h=null;return this._match(ie.tokens.comma)&&(h=this._consume(ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(ie.tokens.greater_than,"Expected '>' for pointer."),new r3(r,n.toString(),l,h)}const i=this._attribute();if(this._match(ie.keywords.array)){let r=null,n=-1;const l=this._previous();let h=null;if(this._match(ie.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let g="";if(this._match(ie.tokens.comma)){h=this._shift_expression();try{g=h.evaluate(this._context).toString(),h=null}catch{g="1"}}this._consume(ie.tokens.greater_than,"Expected '>' for array."),n=g?parseInt(g):0}const a=new XT(l.toString(),i,r,n);return h&&this._deferArrayCountEval.push({arrayType:a,countNode:h}),a}return null}_texture_sampler_types(){if(this._match(ie.sampler_type))return new Ju(this._previous().toString(),null,null);if(this._match(ie.depth_texture_type))return new Ju(this._previous().toString(),null,null);if(this._match(ie.sampled_texture_type)||this._match(ie.multisampled_texture_type)){const e=this._previous();this._consume(ie.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(ie.tokens.greater_than,"Expected '>' for sampler type."),new Ju(e.toString(),i,null)}if(this._match(ie.storage_texture_type)){const e=this._previous();this._consume(ie.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(ie.texel_format,"Invalid texel format.").toString();this._consume(ie.tokens.comma,"Expected ',' after texel format.");const r=this._consume(ie.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ie.tokens.greater_than,"Expected '>' for sampler type."),new Ju(e.toString(),i,r)}return null}_attribute(){let e=[];for(;this._match(ie.tokens.attr);){const i=this._consume(ie.attribute_name,"Expected attribute name"),r=new f3(i.toString(),null);if(this._match(ie.tokens.paren_left)){if(r.value=this._consume(ie.literal_or_ident,"Expected attribute value").toString(),this._check(ie.tokens.comma)){this._advance();do{const n=this._consume(ie.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(n)}while(this._match(ie.tokens.comma))}this._consume(ie.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class bc{constructor(e,i){this.name=e,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Qv{constructor(e,i,r){this.name=e,this.type=i,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Qd extends bc{constructor(e,i){super(e,i),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class E_ extends bc{constructor(e,i){super(e,i),this.count=0,this.stride=0}get isArray(){return!0}}class eb extends bc{constructor(e,i,r,n){super(e,r),this.format=i,this.access=n}get isTemplate(){return!0}}var ta;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(ta||(ta={}));class ef{constructor(e,i,r,n,l,h,a){this.name=e,this.type=i,this.group=r,this.binding=n,this.attributes=l,this.resourceType=h,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class _3{constructor(e,i){this.name=e,this.type=i}}class tf{constructor(e,i){this.align=e,this.size=i}}class m3{constructor(e,i,r,n){this.name=e,this.type=i,this.locationType=r,this.location=n,this.interpolation=null}}class tb{constructor(e,i,r,n){this.name=e,this.type=i,this.locationType=r,this.location=n}}class y3{constructor(e,i,r,n){this.name=e,this.type=i,this.attributes=r,this.id=n}}class x3{constructor(e,i){this.name=e,this.type=i}}class v3{constructor(e,i=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=i}}class b3{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class w3{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class wo{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new b3,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new g3().parse(e);for(const n of r)n instanceof Cm&&this._functions.set(n.name,new w3(n));for(const n of r)if(n instanceof qa){const l=this._getTypeInfo(n,null);l instanceof Qd&&this.structs.push(l)}for(const n of r){if(n instanceof HT){this.aliases.push(this._getAliasInfo(n));continue}if(n instanceof jT){const l=n,h=this._getAttributeNum(l.attributes,"id",0),a=l.type!=null?this._getTypeInfo(l.type,l.attributes):null;this.overrides.push(new y3(l.name,a,l.attributes,h));continue}if(this._isUniformVar(n)){const l=n,h=this._getAttributeNum(l.attributes,"group",0),a=this._getAttributeNum(l.attributes,"binding",0),g=this._getTypeInfo(l.type,l.attributes),y=new ef(l.name,g,h,a,l.attributes,ta.Uniform,l.access);this.uniforms.push(y);continue}if(this._isStorageVar(n)){const l=n,h=this._getAttributeNum(l.attributes,"group",0),a=this._getAttributeNum(l.attributes,"binding",0),g=this._getTypeInfo(l.type,l.attributes),y=this._isStorageTexture(g),T=new ef(l.name,g,h,a,l.attributes,y?ta.StorageTexture:ta.Storage,l.access);this.storage.push(T);continue}if(this._isTextureVar(n)){const l=n,h=this._getAttributeNum(l.attributes,"group",0),a=this._getAttributeNum(l.attributes,"binding",0),g=this._getTypeInfo(l.type,l.attributes),y=this._isStorageTexture(g),T=new ef(l.name,g,h,a,l.attributes,y?ta.StorageTexture:ta.Texture,l.access);y?this.storage.push(T):this.textures.push(T);continue}if(this._isSamplerVar(n)){const l=n,h=this._getAttributeNum(l.attributes,"group",0),a=this._getAttributeNum(l.attributes,"binding",0),g=this._getTypeInfo(l.type,l.attributes),y=new ef(l.name,g,h,a,l.attributes,ta.Sampler,l.access);this.samplers.push(y);continue}if(n instanceof Cm){const l=this._getAttribute(n,"vertex"),h=this._getAttribute(n,"fragment"),a=this._getAttribute(n,"compute"),g=l||h||a,y=new v3(n.name,g==null?void 0:g.name);y.startLine=n.startLine,y.endLine=n.endLine,this.functions.push(y),this._functions.get(n.name).info=y,g?(this._functions.get(n.name).inUse=!0,y.inUse=!0,y.resources=this._findResources(n,!!g),y.inputs=this._getInputs(n.args),y.outputs=this._getOutputs(n.returnType),this.entry[g.name].push(y)):(y.arguments=n.args.map(T=>new x3(T.name,this._getTypeInfo(T.type,T.attributes))),y.returnType=n.returnType?this._getTypeInfo(n.returnType,n.attributes):null);continue}}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(l=>{var h;if(l.astNodeType==="varExpr"){const a=l;for(const g of this.overrides)a.name==g.name&&((h=n.info)===null||h===void 0||h.overrides.push(g))}});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const i of e.members)this._markStructsInUse(i.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const i=this._getAlias(e.name);i&&this._markStructsInUse(i)}}_addCalls(e,i){var r;for(const n of e.calls){const l=(r=this._functions.get(n.name))===null||r===void 0?void 0:r.info;l&&i.add(l)}}findResource(e,i){for(const r of this.uniforms)if(r.group==e&&r.binding==i)return r;for(const r of this.storage)if(r.group==e&&r.binding==i)return r;for(const r of this.textures)if(r.group==e&&r.binding==i)return r;for(const r of this.samplers)if(r.group==e&&r.binding==i)return r;return null}_findResource(e){for(const i of this.uniforms)if(i.name==e)return i;for(const i of this.storage)if(i.name==e)return i;for(const i of this.textures)if(i.name==e)return i;for(const i of this.samplers)if(i.name==e)return i;return null}_markStructsFromAST(e){const i=this._getTypeInfo(e,null);this._markStructsInUse(i)}_findResources(e,i){const r=[],n=this,l=[];return e.search(h=>{if(h instanceof op)l.push({});else if(h instanceof ap)l.pop();else if(h instanceof Xa){const a=h;i&&a.type!==null&&this._markStructsFromAST(a.type),l.length>0&&(l[l.length-1][a.name]=a)}else if(h instanceof oc){const a=h;i&&a.type!==null&&this._markStructsFromAST(a.type)}else if(h instanceof Rm){const a=h;i&&a.type!==null&&this._markStructsFromAST(a.type),l.length>0&&(l[l.length-1][a.name]=a)}else if(h instanceof Mm){const a=h;if(l.length>0&&l[l.length-1][a.name])return;const g=n._findResource(a.name);g&&r.push(g)}else if(h instanceof ZT){const a=h,g=n._functions.get(a.name);g&&(i&&(g.inUse=!0),e.calls.add(g.node),g.resources===null&&(g.resources=n._findResources(g.node,i)),r.push(...g.resources))}else if(h instanceof WT){const a=h,g=n._functions.get(a.name);g&&(i&&(g.inUse=!0),e.calls.add(g.node),g.resources===null&&(g.resources=n._findResources(g.node,i)),r.push(...g.resources))}}),[...new Map(r.map(h=>[h.name,h])).values()]}getBindGroups(){const e=[];function i(r,n){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),n>=e[r].length&&(e[r].length=n+1)}for(const r of this.uniforms){i(r.group,r.binding);const n=e[r.group];n[r.binding]=r}for(const r of this.storage){i(r.group,r.binding);const n=e[r.group];n[r.binding]=r}for(const r of this.textures){i(r.group,r.binding);const n=e[r.group];n[r.binding]=r}for(const r of this.samplers){i(r.group,r.binding);const n=e[r.group];n[r.binding]=r}return e}_getOutputs(e,i=void 0){if(i===void 0&&(i=[]),e instanceof qa)this._getStructOutputs(e,i);else{const r=this._getOutputInfo(e);r!==null&&i.push(r)}return i}_getStructOutputs(e,i){for(const r of e.members)if(r.type instanceof qa)this._getStructOutputs(r.type,i);else{const n=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(n!==null){const l=this._getTypeInfo(r.type,r.type.attributes),h=this._parseInt(n.value),a=new tb(r.name,l,n.name,h);i.push(a)}}}_getOutputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const r=this._getTypeInfo(e,e.attributes),n=this._parseInt(i.value);return new tb("",r,i.name,n)}return null}_getInputs(e,i=void 0){i===void 0&&(i=[]);for(const r of e)if(r.type instanceof qa)this._getStructInputs(r.type,i);else{const n=this._getInputInfo(r);n!==null&&i.push(n)}return i}_getStructInputs(e,i){for(const r of e.members)if(r.type instanceof qa)this._getStructInputs(r.type,i);else{const n=this._getInputInfo(r);n!==null&&i.push(n)}}_getInputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const r=this._getAttribute(e,"interpolation"),n=this._getTypeInfo(e.type,e.attributes),l=this._parseInt(i.value),h=new m3(e.name,n,i.name,l);return r!==null&&(h.interpolation=this._parseString(r.value)),h}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const i=parseInt(e);return isNaN(i)?e:i}_getAlias(e){for(const i of this.aliases)if(i.name==e)return i.type;return null}_getAliasInfo(e){return new _3(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,i){if(this._types.has(e))return this._types.get(e);if(e instanceof XT){const n=e,l=n.format?this._getTypeInfo(n.format,n.attributes):null,h=new E_(n.name,i);return h.format=l,h.count=n.count,this._types.set(e,h),this._updateTypeInfo(h),h}if(e instanceof qa){const n=e,l=new Qd(n.name,i);l.startLine=n.startLine,l.endLine=n.endLine;for(const h of n.members){const a=this._getTypeInfo(h.type,h.attributes);l.members.push(new Qv(h.name,a,h.attributes))}return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof Ju){const n=e,l=n.format instanceof dl,h=n.format?l?this._getTypeInfo(n.format,null):new bc(n.format,null):null,a=new eb(n.name,h,i,n.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof qT){const n=e,l=n.format?this._getTypeInfo(n.format,null):null,h=new eb(n.name,l,i,n.access);return this._types.set(e,h),this._updateTypeInfo(h),h}const r=new bc(e.name,i);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var i,r;const n=this._getTypeSize(e);if(e.size=(i=n==null?void 0:n.size)!==null&&i!==void 0?i:0,e instanceof E_&&e.format){const l=this._getTypeSize(e.format);e.stride=(r=l==null?void 0:l.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof Qd&&this._updateStructInfo(e)}_updateStructInfo(e){var i;let r=0,n=0,l=0,h=0;for(let a=0,g=e.members.length;a<g;++a){const y=e.members[a],T=this._getTypeSize(y);if(!T)continue;(i=this._getAlias(y.type.name))!==null&&i!==void 0||y.type;const S=T.align,P=T.size;r=this._roundUp(S,r+n),n=P,l=r,h=Math.max(h,S),y.offset=r,y.size=P,this._updateTypeInfo(y.type)}e.size=this._roundUp(h,l+n),e.align=h}_getTypeSize(e){var i,r;if(e==null)return null;const n=this._getAttributeNum(e.attributes,"size",0),l=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Qv&&(e=e.type),e instanceof bc){const h=this._getAlias(e.name);h!==null&&(e=h)}{const h=wo._typeInfo[e.name];if(h!==void 0){const a=((i=e.format)===null||i===void 0?void 0:i.name)==="f16"?2:1;return new tf(Math.max(l,h.align/a),Math.max(n,h.size/a))}}{const h=wo._typeInfo[e.name.substring(0,e.name.length-1)];if(h){const a=e.name[e.name.length-1]==="h"?2:1;return new tf(Math.max(l,h.align/a),Math.max(n,h.size/a))}}if(e instanceof E_){let h=e,a=8,g=8;const y=this._getTypeSize(h.format);y!==null&&(g=y.size,a=y.align);const T=h.count,S=this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,g));return g=T*S,n&&(g=n),new tf(Math.max(l,a),Math.max(n,g))}if(e instanceof Qd){let h=0,a=0,g=0,y=0,T=0;for(const S of e.members){const P=this._getTypeSize(S.type);P!==null&&(h=Math.max(P.align,h),g=this._roundUp(P.align,g+y),y=P.size,T=g)}return a=this._roundUp(h,T+y),new tf(Math.max(l,h),Math.max(n,a))}return null}_isUniformVar(e){return e instanceof Xa&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Xa&&e.storage=="storage"}_isTextureVar(e){return e instanceof Xa&&e.type!==null&&wo._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Xa&&e.type!==null&&wo._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,i){const r=e;if(!r||!r.attributes)return null;const n=r.attributes;for(let l of n)if(l.name==i)return l;return null}_getAttributeNum(e,i,r){if(e===null)return r;for(let n of e)if(n.name==i){let l=n!==null&&n.value!==null?n.value:r;return l instanceof Array&&(l=l[0]),typeof l=="number"?l:typeof l=="string"?parseInt(l):r}return r}_roundUp(e,i){return Math.ceil(i/e)*e}}wo._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};wo._textureTypes=ie.any_texture_type.map(t=>t.name);wo._samplerTypes=ie.sampler_type.map(t=>t.name);function T3(t){var l;const e={attributes:[],bindings:[]};let i;try{i=S3(t)}catch(h){return Je.error(h.message)(),e}for(const h of i.uniforms){const a=[];for(const g of((l=h.type)==null?void 0:l.members)||[])a.push({name:g.name,type:ib(g.type)});e.bindings.push({type:"uniform",name:h.name,location:h.binding,group:h.group,members:a})}const r=i.entry.vertex[0],n=(r==null?void 0:r.inputs.length)||0;for(let h=0;h<n;h++){const a=r.inputs[h];if(a.locationType==="location"){const g=ib(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:g})}}return e}function ib(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function S3(t){try{return new wo(t)}catch(e){if(e instanceof Error)throw e;let i="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(i+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(i+=e.token.line||""),new Error(i,{cause:e})}}const E3=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,A3={name:"fp32",vs:E3},P3=[0,1,1,1],I3=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,C3=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,rb={name:"picking",vs:I3,fs:C3,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:P3},getUniforms:R3};function R3(t={},e){const i={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,n=>n/255);Number.isFinite(r[3])||(r[3]=1),i.highlightColor=r}return t.isActive!==void 0&&(i.isActive=!!t.isActive,i.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(i.useFloatColors=!!t.useFloatColors),i}function GT(t,e=[],i=0){const r=Math.fround(t),n=t-r;return e[i]=r,e[i+1]=n,e}function M3(t){return t-Math.fround(t)}function k3(t){const e=new Float32Array(32);for(let i=0;i<4;++i)for(let r=0;r<4;++r){const n=i*4+r;GT(t[r*4+i],e,n*2)}return e}const O3=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,F3={ONE:1};function D3(){return F3}const N3={name:"fp64-arithmetic",vs:O3,getUniforms:D3,fp64ify:GT,fp64LowPart:M3,fp64ifyMatrix4:k3},L3={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...L3}};const bn=globalThis.mathgl.config;function B3(t,{precision:e=bn.precision}={}){return t=z3(t),`${parseFloat(t.toPrecision(e))}`}function il(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function sa(t,e,i){return V3(t,r=>Math.max(e,Math.min(i,r)))}function Cc(t,e,i){return il(t)?t.map((r,n)=>Cc(r,e[n],i)):i*e+(1-i)*t}function So(t,e,i){const r=bn.EPSILON;i&&(bn.EPSILON=i);try{if(t===e)return!0;if(il(t)&&il(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!So(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=bn.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{bn.EPSILON=r}}function z3(t){return Math.round(t/bn.EPSILON)*bn.EPSILON}function U3(t){return t.clone?t.clone():new Array(t.length)}function V3(t,e,i){if(il(t)){const r=t;i=i||U3(r);for(let n=0;n<i.length&&n<r.length;++n){const l=typeof t=="number"?t:t[n];i[n]=e(l,n,i)}return i}return e(t)}class Oy extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+i];return this.check()}toArray(e=[],i=0){for(let r=0;r<this.ELEMENTS;++r)e[i+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:il(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(bn)}formatString(e){let i="";for(let r=0;r<this.ELEMENTS;++r)i+=(r>0?", ":"")+B3(this[r],e);return`${e.printTypes?this.constructor.name:""}[${i}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!So(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,r){if(r===void 0)return this.lerp(this,e,i);for(let n=0;n<this.ELEMENTS;++n){const l=e[n],h=typeof i=="number"?i:i[n];this[n]=l+r*(h-l)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),i[r]);return this.check()}add(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=i[r];return this.check()}subtract(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=i[r];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(bn.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),i);return this.check()}get elements(){return this}}function $3(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function wi(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function sh(t,e,i=""){if(bn.debug&&!$3(t,e))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return t}function mh(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class JT extends Oy{get x(){return this[0]}set x(e){this[0]=wi(e)}get y(){return this[1]}set y(e){this[1]=wi(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let r=0;r<this.ELEMENTS;++r){const n=this[r]-e[r];i+=n*n}return wi(i)}dot(e){let i=0;for(let r=0;r<this.ELEMENTS;++r)i+=this[r]*e[r];return wi(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=i[r];return this.check()}divide(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=i[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return mh(e>=0&&e<this.ELEMENTS,"index is out of range"),wi(this[e])}setComponent(e,i){return mh(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}const oh=1e-6;let Ms=typeof Float32Array<"u"?Float32Array:Array;function j3(){const t=new Ms(2);return Ms!=Float32Array&&(t[0]=0,t[1]=0),t}function nb(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function W3(t,e){return t[0]=-e[0],t[1]=-e[1],t}function QT(t,e,i,r){const n=e[0],l=e[1];return t[0]=n+r*(i[0]-n),t[1]=l+r*(i[1]-l),t}function H3(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t}function q3(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}(function(){const t=j3();return function(e,i,r,n,l,h){let a,g;for(i||(i=2),r||(r=0),n?g=Math.min(n*i+r,e.length):g=e.length,a=r;a<g;a+=i)t[0]=e[a],t[1]=e[a+1],l(t,t,h),e[a]=t[0],e[a+1]=t[1];return e}})();function X3(t,e,i){const r=e[0],n=e[1],l=i[3]*r+i[7]*n||1;return t[0]=(i[0]*r+i[4]*n)/l,t[1]=(i[1]*r+i[5]*n)/l,t}function eS(t,e,i){const r=e[0],n=e[1],l=e[2],h=i[3]*r+i[7]*n+i[11]*l||1;return t[0]=(i[0]*r+i[4]*n+i[8]*l)/h,t[1]=(i[1]*r+i[5]*n+i[9]*l)/h,t[2]=(i[2]*r+i[6]*n+i[10]*l)/h,t}function Z3(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t[2]=e[2],t}function Y3(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t[2]=e[2],t[3]=e[3],t}function tS(t,e,i){const r=e[0],n=e[1],l=e[2];return t[0]=i[0]*r+i[3]*n+i[6]*l,t[1]=i[1]*r+i[4]*n+i[7]*l,t[2]=i[2]*r+i[5]*n+i[8]*l,t[3]=e[3],t}function iS(){const t=new Ms(3);return Ms!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function K3(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function sb(t,e,i){const r=new Ms(3);return r[0]=t,r[1]=e,r[2]=i,r}function G3(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function J3(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Q3(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function ek(t,e){const i=e[0],r=e[1],n=e[2];let l=i*i+r*r+n*n;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t}function rS(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Of(t,e,i){const r=e[0],n=e[1],l=e[2],h=i[0],a=i[1],g=i[2];return t[0]=n*g-l*a,t[1]=l*h-r*g,t[2]=r*a-n*h,t}function tk(t,e,i,r){const n=e[0],l=e[1],h=e[2];return t[0]=n+r*(i[0]-n),t[1]=l+r*(i[1]-l),t[2]=h+r*(i[2]-h),t}function Fy(t,e,i){const r=e[0],n=e[1],l=e[2];let h=i[3]*r+i[7]*n+i[11]*l+i[15];return h=h||1,t[0]=(i[0]*r+i[4]*n+i[8]*l+i[12])/h,t[1]=(i[1]*r+i[5]*n+i[9]*l+i[13])/h,t[2]=(i[2]*r+i[6]*n+i[10]*l+i[14])/h,t}function nS(t,e,i){const r=e[0],n=e[1],l=e[2];return t[0]=r*i[0]+n*i[3]+l*i[6],t[1]=r*i[1]+n*i[4]+l*i[7],t[2]=r*i[2]+n*i[5]+l*i[8],t}function sS(t,e,i){const r=i[0],n=i[1],l=i[2],h=i[3],a=e[0],g=e[1],y=e[2];let T=n*y-l*g,S=l*a-r*y,P=r*g-n*a,M=n*P-l*S,B=l*T-r*P,j=r*S-n*T;const Z=h*2;return T*=Z,S*=Z,P*=Z,M*=2,B*=2,j*=2,t[0]=a+T+M,t[1]=g+S+B,t[2]=y+P+j,t}function ik(t,e,i,r){const n=[],l=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],l[0]=n[0],l[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),l[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t}function rk(t,e,i,r){const n=[],l=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],l[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),l[1]=n[1],l[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t}function nk(t,e,i,r){const n=[],l=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],l[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),l[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),l[2]=n[2],t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t}function sk(t,e){const i=t[0],r=t[1],n=t[2],l=e[0],h=e[1],a=e[2],g=Math.sqrt((i*i+r*r+n*n)*(l*l+h*h+a*a)),y=g&&rS(t,e)/g;return Math.acos(Math.min(Math.max(y,-1),1))}const oS=G3,aS=K3,A_=J3;(function(){const t=iS();return function(e,i,r,n,l,h){let a,g;for(i||(i=3),r||(r=0),n?g=Math.min(n*i+r,e.length):g=e.length,a=r;a<g;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],l(t,t,h),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const P_=[0,0,0];let rf;class mt extends JT{static get ZERO(){return rf||(rf=new mt(0,0,0),Object.freeze(rf)),rf}constructor(e=0,i=0,r=0){super(-0,-0,-0),arguments.length===1&&il(e)?this.copy(e):(bn.debug&&(wi(e),wi(i),wi(r)),this[0]=e,this[1]=i,this[2]=r)}set(e,i,r){return this[0]=e,this[1]=i,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return bn.debug&&(wi(e.x),wi(e.y),wi(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=wi(e)}angle(e){return sk(this,e)}cross(e){return Of(this,this,e),this.check()}rotateX({radians:e,origin:i=P_}){return ik(this,this,i,e),this.check()}rotateY({radians:e,origin:i=P_}){return rk(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=P_}){return nk(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Fy(this,this,e),this.check()}transformAsVector(e){return eS(this,this,e),this.check()}transformByMatrix3(e){return nS(this,this,e),this.check()}transformByMatrix2(e){return Z3(this,this,e),this.check()}transformByQuaternion(e){return sS(this,this,e),this.check()}}let nf;class Dy extends JT{static get ZERO(){return nf||(nf=new Dy(0,0,0,0),Object.freeze(nf)),nf}constructor(e=0,i=0,r=0,n=0){super(-0,-0,-0,-0),il(e)&&arguments.length===1?this.copy(e):(bn.debug&&(wi(e),wi(i),wi(r),wi(n)),this[0]=e,this[1]=i,this[2]=r,this[3]=n)}set(e,i,r,n){return this[0]=e,this[1]=i,this[2]=r,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return bn.debug&&(wi(e.x),wi(e.y),wi(e.z),wi(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=wi(e)}get w(){return this[3]}set w(e){this[3]=wi(e)}transform(e){return Fy(this,this,e),this.check()}transformByMatrix3(e){return tS(this,this,e),this.check()}transformByMatrix2(e){return Y3(this,this,e),this.check()}transformByQuaternion(e){return sS(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class lS extends Oy{toString(){let e="[";if(bn.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+i]}`}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=` ${this[i]}`}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,r){return this[i*this.RANK+e]=wi(r),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let n=0;n<this.RANK;++n)i[n]=this[r+n];return i}setColumn(e,i){const r=e*this.RANK;for(let n=0;n<this.RANK;++n)this[r+n]=i[n];return this}}function ok(){const t=new Ms(9);return Ms!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ak(t,e){if(t===e){const i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function lk(t,e){const i=e[0],r=e[1],n=e[2],l=e[3],h=e[4],a=e[5],g=e[6],y=e[7],T=e[8],S=T*h-a*y,P=-T*l+a*g,M=y*l-h*g;let B=i*S+r*P+n*M;return B?(B=1/B,t[0]=S*B,t[1]=(-T*r+n*y)*B,t[2]=(a*r-n*h)*B,t[3]=P*B,t[4]=(T*i-n*g)*B,t[5]=(-a*i+n*l)*B,t[6]=M*B,t[7]=(-y*i+r*g)*B,t[8]=(h*i-r*l)*B,t):null}function ck(t){const e=t[0],i=t[1],r=t[2],n=t[3],l=t[4],h=t[5],a=t[6],g=t[7],y=t[8];return e*(y*l-h*g)+i*(-y*n+h*a)+r*(g*n-l*a)}function ob(t,e,i){const r=e[0],n=e[1],l=e[2],h=e[3],a=e[4],g=e[5],y=e[6],T=e[7],S=e[8],P=i[0],M=i[1],B=i[2],j=i[3],Z=i[4],G=i[5],fe=i[6],re=i[7],ue=i[8];return t[0]=P*r+M*h+B*y,t[1]=P*n+M*a+B*T,t[2]=P*l+M*g+B*S,t[3]=j*r+Z*h+G*y,t[4]=j*n+Z*a+G*T,t[5]=j*l+Z*g+G*S,t[6]=fe*r+re*h+ue*y,t[7]=fe*n+re*a+ue*T,t[8]=fe*l+re*g+ue*S,t}function uk(t,e,i){const r=e[0],n=e[1],l=e[2],h=e[3],a=e[4],g=e[5],y=e[6],T=e[7],S=e[8],P=i[0],M=i[1];return t[0]=r,t[1]=n,t[2]=l,t[3]=h,t[4]=a,t[5]=g,t[6]=P*r+M*h+y,t[7]=P*n+M*a+T,t[8]=P*l+M*g+S,t}function hk(t,e,i){const r=e[0],n=e[1],l=e[2],h=e[3],a=e[4],g=e[5],y=e[6],T=e[7],S=e[8],P=Math.sin(i),M=Math.cos(i);return t[0]=M*r+P*h,t[1]=M*n+P*a,t[2]=M*l+P*g,t[3]=M*h-P*r,t[4]=M*a-P*n,t[5]=M*g-P*l,t[6]=y,t[7]=T,t[8]=S,t}function ab(t,e,i){const r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function dk(t,e){const i=e[0],r=e[1],n=e[2],l=e[3],h=i+i,a=r+r,g=n+n,y=i*h,T=r*h,S=r*a,P=n*h,M=n*a,B=n*g,j=l*h,Z=l*a,G=l*g;return t[0]=1-S-B,t[3]=T-G,t[6]=P+Z,t[1]=T+G,t[4]=1-y-B,t[7]=M-j,t[2]=P-Z,t[5]=M+j,t[8]=1-y-S,t}var km;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(km||(km={}));const fk=Object.freeze([1,0,0,0,1,0,0,0,1]);class Dr extends lS{static get IDENTITY(){return gk()}static get ZERO(){return pk()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return km}constructor(e,...i){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):i.length>0?this.copy([e,...i]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(fk)}fromObject(e){return this.check()}fromQuaternion(e){return dk(this,e),this.check()}set(e,i,r,n,l,h,a,g,y){return this[0]=e,this[1]=i,this[2]=r,this[3]=n,this[4]=l,this[5]=h,this[6]=a,this[7]=g,this[8]=y,this.check()}setRowMajor(e,i,r,n,l,h,a,g,y){return this[0]=e,this[1]=n,this[2]=a,this[3]=i,this[4]=l,this[5]=g,this[6]=r,this[7]=h,this[8]=y,this.check()}determinant(){return ck(this)}transpose(){return ak(this,this),this.check()}invert(){return lk(this,this),this.check()}multiplyLeft(e){return ob(this,e,this),this.check()}multiplyRight(e){return ob(this,this,e),this.check()}rotate(e){return hk(this,this,e),this.check()}scale(e){return Array.isArray(e)?ab(this,this,e):ab(this,this,[e,e]),this.check()}translate(e){return uk(this,this,e),this.check()}transform(e,i){let r;switch(e.length){case 2:r=H3(i||[-0,-0],e,this);break;case 3:r=nS(i||[-0,-0,-0],e,this);break;case 4:r=tS(i||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return sh(r,e.length),r}transformVector(e,i){return this.transform(e,i)}transformVector2(e,i){return this.transform(e,i)}transformVector3(e,i){return this.transform(e,i)}}let sf,of=null;function pk(){return sf||(sf=new Dr([0,0,0,0,0,0,0,0,0]),Object.freeze(sf)),sf}function gk(){return of||(of=new Dr,Object.freeze(of)),of}function _k(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mk(t,e){if(t===e){const i=e[1],r=e[2],n=e[3],l=e[6],h=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=l,t[11]=e[14],t[12]=n,t[13]=h,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Om(t,e){const i=e[0],r=e[1],n=e[2],l=e[3],h=e[4],a=e[5],g=e[6],y=e[7],T=e[8],S=e[9],P=e[10],M=e[11],B=e[12],j=e[13],Z=e[14],G=e[15],fe=i*a-r*h,re=i*g-n*h,ue=i*y-l*h,Me=r*g-n*a,Oe=r*y-l*a,$e=n*y-l*g,ke=T*j-S*B,je=T*Z-P*B,Ue=T*G-M*B,ct=S*Z-P*j,tt=S*G-M*j,pt=P*G-M*Z;let ot=fe*pt-re*tt+ue*ct+Me*Ue-Oe*je+$e*ke;return ot?(ot=1/ot,t[0]=(a*pt-g*tt+y*ct)*ot,t[1]=(n*tt-r*pt-l*ct)*ot,t[2]=(j*$e-Z*Oe+G*Me)*ot,t[3]=(P*Oe-S*$e-M*Me)*ot,t[4]=(g*Ue-h*pt-y*je)*ot,t[5]=(i*pt-n*Ue+l*je)*ot,t[6]=(Z*ue-B*$e-G*re)*ot,t[7]=(T*$e-P*ue+M*re)*ot,t[8]=(h*tt-a*Ue+y*ke)*ot,t[9]=(r*Ue-i*tt-l*ke)*ot,t[10]=(B*Oe-j*ue+G*fe)*ot,t[11]=(S*ue-T*Oe-M*fe)*ot,t[12]=(a*je-h*ct-g*ke)*ot,t[13]=(i*ct-r*je+n*ke)*ot,t[14]=(j*re-B*Me-Z*fe)*ot,t[15]=(T*Me-S*re+P*fe)*ot,t):null}function yk(t){const e=t[0],i=t[1],r=t[2],n=t[3],l=t[4],h=t[5],a=t[6],g=t[7],y=t[8],T=t[9],S=t[10],P=t[11],M=t[12],B=t[13],j=t[14],Z=t[15],G=e*h-i*l,fe=e*a-r*l,re=i*a-r*h,ue=y*B-T*M,Me=y*j-S*M,Oe=T*j-S*B,$e=e*Oe-i*Me+r*ue,ke=l*Oe-h*Me+a*ue,je=y*re-T*fe+S*G,Ue=M*re-B*fe+j*G;return g*$e-n*ke+Z*je-P*Ue}function el(t,e,i){const r=e[0],n=e[1],l=e[2],h=e[3],a=e[4],g=e[5],y=e[6],T=e[7],S=e[8],P=e[9],M=e[10],B=e[11],j=e[12],Z=e[13],G=e[14],fe=e[15];let re=i[0],ue=i[1],Me=i[2],Oe=i[3];return t[0]=re*r+ue*a+Me*S+Oe*j,t[1]=re*n+ue*g+Me*P+Oe*Z,t[2]=re*l+ue*y+Me*M+Oe*G,t[3]=re*h+ue*T+Me*B+Oe*fe,re=i[4],ue=i[5],Me=i[6],Oe=i[7],t[4]=re*r+ue*a+Me*S+Oe*j,t[5]=re*n+ue*g+Me*P+Oe*Z,t[6]=re*l+ue*y+Me*M+Oe*G,t[7]=re*h+ue*T+Me*B+Oe*fe,re=i[8],ue=i[9],Me=i[10],Oe=i[11],t[8]=re*r+ue*a+Me*S+Oe*j,t[9]=re*n+ue*g+Me*P+Oe*Z,t[10]=re*l+ue*y+Me*M+Oe*G,t[11]=re*h+ue*T+Me*B+Oe*fe,re=i[12],ue=i[13],Me=i[14],Oe=i[15],t[12]=re*r+ue*a+Me*S+Oe*j,t[13]=re*n+ue*g+Me*P+Oe*Z,t[14]=re*l+ue*y+Me*M+Oe*G,t[15]=re*h+ue*T+Me*B+Oe*fe,t}function lp(t,e,i){const r=i[0],n=i[1],l=i[2];let h,a,g,y,T,S,P,M,B,j,Z,G;return e===t?(t[12]=e[0]*r+e[4]*n+e[8]*l+e[12],t[13]=e[1]*r+e[5]*n+e[9]*l+e[13],t[14]=e[2]*r+e[6]*n+e[10]*l+e[14],t[15]=e[3]*r+e[7]*n+e[11]*l+e[15]):(h=e[0],a=e[1],g=e[2],y=e[3],T=e[4],S=e[5],P=e[6],M=e[7],B=e[8],j=e[9],Z=e[10],G=e[11],t[0]=h,t[1]=a,t[2]=g,t[3]=y,t[4]=T,t[5]=S,t[6]=P,t[7]=M,t[8]=B,t[9]=j,t[10]=Z,t[11]=G,t[12]=h*r+T*n+B*l+e[12],t[13]=a*r+S*n+j*l+e[13],t[14]=g*r+P*n+Z*l+e[14],t[15]=y*r+M*n+G*l+e[15]),t}function Ny(t,e,i){const r=i[0],n=i[1],l=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function xk(t,e,i,r){let n=r[0],l=r[1],h=r[2],a=Math.sqrt(n*n+l*l+h*h),g,y,T,S,P,M,B,j,Z,G,fe,re,ue,Me,Oe,$e,ke,je,Ue,ct,tt,pt,ot,ei;return a<oh?null:(a=1/a,n*=a,l*=a,h*=a,y=Math.sin(i),g=Math.cos(i),T=1-g,S=e[0],P=e[1],M=e[2],B=e[3],j=e[4],Z=e[5],G=e[6],fe=e[7],re=e[8],ue=e[9],Me=e[10],Oe=e[11],$e=n*n*T+g,ke=l*n*T+h*y,je=h*n*T-l*y,Ue=n*l*T-h*y,ct=l*l*T+g,tt=h*l*T+n*y,pt=n*h*T+l*y,ot=l*h*T-n*y,ei=h*h*T+g,t[0]=S*$e+j*ke+re*je,t[1]=P*$e+Z*ke+ue*je,t[2]=M*$e+G*ke+Me*je,t[3]=B*$e+fe*ke+Oe*je,t[4]=S*Ue+j*ct+re*tt,t[5]=P*Ue+Z*ct+ue*tt,t[6]=M*Ue+G*ct+Me*tt,t[7]=B*Ue+fe*ct+Oe*tt,t[8]=S*pt+j*ot+re*ei,t[9]=P*pt+Z*ot+ue*ei,t[10]=M*pt+G*ot+Me*ei,t[11]=B*pt+fe*ot+Oe*ei,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function cS(t,e,i){const r=Math.sin(i),n=Math.cos(i),l=e[4],h=e[5],a=e[6],g=e[7],y=e[8],T=e[9],S=e[10],P=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*n+y*r,t[5]=h*n+T*r,t[6]=a*n+S*r,t[7]=g*n+P*r,t[8]=y*n-l*r,t[9]=T*n-h*r,t[10]=S*n-a*r,t[11]=P*n-g*r,t}function vk(t,e,i){const r=Math.sin(i),n=Math.cos(i),l=e[0],h=e[1],a=e[2],g=e[3],y=e[8],T=e[9],S=e[10],P=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*n-y*r,t[1]=h*n-T*r,t[2]=a*n-S*r,t[3]=g*n-P*r,t[8]=l*r+y*n,t[9]=h*r+T*n,t[10]=a*r+S*n,t[11]=g*r+P*n,t}function uS(t,e,i){const r=Math.sin(i),n=Math.cos(i),l=e[0],h=e[1],a=e[2],g=e[3],y=e[4],T=e[5],S=e[6],P=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*n+y*r,t[1]=h*n+T*r,t[2]=a*n+S*r,t[3]=g*n+P*r,t[4]=y*n-l*r,t[5]=T*n-h*r,t[6]=S*n-a*r,t[7]=P*n-g*r,t}function bk(t,e){const i=e[0],r=e[1],n=e[2],l=e[4],h=e[5],a=e[6],g=e[8],y=e[9],T=e[10];return t[0]=Math.sqrt(i*i+r*r+n*n),t[1]=Math.sqrt(l*l+h*h+a*a),t[2]=Math.sqrt(g*g+y*y+T*T),t}function wk(t,e){const i=e[0],r=e[1],n=e[2],l=e[3],h=i+i,a=r+r,g=n+n,y=i*h,T=r*h,S=r*a,P=n*h,M=n*a,B=n*g,j=l*h,Z=l*a,G=l*g;return t[0]=1-S-B,t[1]=T+G,t[2]=P-Z,t[3]=0,t[4]=T-G,t[5]=1-y-B,t[6]=M+j,t[7]=0,t[8]=P+Z,t[9]=M-j,t[10]=1-y-S,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Tk(t,e,i,r,n,l,h){const a=1/(i-e),g=1/(n-r),y=1/(l-h);return t[0]=l*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l*2*g,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(n+r)*g,t[10]=(h+l)*y,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*l*2*y,t[15]=0,t}function Sk(t,e,i,r,n){const l=1/Math.tan(e/2);if(t[0]=l/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){const h=1/(r-n);t[10]=(n+r)*h,t[14]=2*n*r*h}else t[10]=-1,t[14]=-2*r;return t}const Ek=Sk;function Ak(t,e,i,r,n,l,h){const a=1/(e-i),g=1/(r-n),y=1/(l-h);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*y,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*g,t[14]=(h+l)*y,t[15]=1,t}const Pk=Ak;function Ik(t,e,i,r){let n,l,h,a,g,y,T,S,P,M;const B=e[0],j=e[1],Z=e[2],G=r[0],fe=r[1],re=r[2],ue=i[0],Me=i[1],Oe=i[2];return Math.abs(B-ue)<oh&&Math.abs(j-Me)<oh&&Math.abs(Z-Oe)<oh?_k(t):(S=B-ue,P=j-Me,M=Z-Oe,n=1/Math.sqrt(S*S+P*P+M*M),S*=n,P*=n,M*=n,l=fe*M-re*P,h=re*S-G*M,a=G*P-fe*S,n=Math.sqrt(l*l+h*h+a*a),n?(n=1/n,l*=n,h*=n,a*=n):(l=0,h=0,a=0),g=P*a-M*h,y=M*l-S*a,T=S*h-P*l,n=Math.sqrt(g*g+y*y+T*T),n?(n=1/n,g*=n,y*=n,T*=n):(g=0,y=0,T=0),t[0]=l,t[1]=g,t[2]=S,t[3]=0,t[4]=h,t[5]=y,t[6]=P,t[7]=0,t[8]=a,t[9]=T,t[10]=M,t[11]=0,t[12]=-(l*B+h*j+a*Z),t[13]=-(g*B+y*j+T*Z),t[14]=-(S*B+P*j+M*Z),t[15]=1,t)}function Ck(){const t=new Ms(4);return Ms!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Rk(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function Ly(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Mk(t){const e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)}function kk(t){const e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}function Ok(t,e){const i=e[0],r=e[1],n=e[2],l=e[3];let h=i*i+r*r+n*n+l*l;return h>0&&(h=1/Math.sqrt(h)),t[0]=i*h,t[1]=r*h,t[2]=n*h,t[3]=l*h,t}function Fk(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Dk(t,e,i,r){const n=e[0],l=e[1],h=e[2],a=e[3];return t[0]=n+r*(i[0]-n),t[1]=l+r*(i[1]-l),t[2]=h+r*(i[2]-h),t[3]=a+r*(i[3]-a),t}function Dc(t,e,i){const r=e[0],n=e[1],l=e[2],h=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*l+i[12]*h,t[1]=i[1]*r+i[5]*n+i[9]*l+i[13]*h,t[2]=i[2]*r+i[6]*n+i[10]*l+i[14]*h,t[3]=i[3]*r+i[7]*n+i[11]*l+i[15]*h,t}function Nk(t,e,i){const r=e[0],n=e[1],l=e[2],h=i[0],a=i[1],g=i[2],y=i[3],T=y*r+a*l-g*n,S=y*n+g*r-h*l,P=y*l+h*n-a*r,M=-h*r-a*n-g*l;return t[0]=T*y+M*-h+S*-g-P*-a,t[1]=S*y+M*-a+P*-h-T*-g,t[2]=P*y+M*-g+T*-a-S*-h,t[3]=e[3],t}(function(){const t=Ck();return function(e,i,r,n,l,h){let a,g;for(i||(i=4),r||(r=0),n?g=Math.min(n*i+r,e.length):g=e.length,a=r;a<g;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],l(t,t,h),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Fm;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Fm||(Fm={}));const Lk=45*Math.PI/180,Bk=1,I_=.1,C_=500,zk=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Qr extends lS{static get IDENTITY(){return Vk()}static get ZERO(){return Uk()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Fm}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,r,n,l,h,a,g,y,T,S,P,M,B,j,Z){return this[0]=e,this[1]=i,this[2]=r,this[3]=n,this[4]=l,this[5]=h,this[6]=a,this[7]=g,this[8]=y,this[9]=T,this[10]=S,this[11]=P,this[12]=M,this[13]=B,this[14]=j,this[15]=Z,this.check()}setRowMajor(e,i,r,n,l,h,a,g,y,T,S,P,M,B,j,Z){return this[0]=e,this[1]=l,this[2]=y,this[3]=M,this[4]=i,this[5]=h,this[6]=T,this[7]=B,this[8]=r,this[9]=a,this[10]=S,this[11]=j,this[12]=n,this[13]=g,this[14]=P,this[15]=Z,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(zk)}fromObject(e){return this.check()}fromQuaternion(e){return wk(this,e),this.check()}frustum(e){const{left:i,right:r,bottom:n,top:l,near:h=I_,far:a=C_}=e;return a===1/0?$k(this,i,r,n,l,h):Tk(this,i,r,n,l,h,a),this.check()}lookAt(e){const{eye:i,center:r=[0,0,0],up:n=[0,1,0]}=e;return Ik(this,i,r,n),this.check()}ortho(e){const{left:i,right:r,bottom:n,top:l,near:h=I_,far:a=C_}=e;return Pk(this,i,r,n,l,h,a),this.check()}orthographic(e){const{fovy:i=Lk,aspect:r=Bk,focalDistance:n=1,near:l=I_,far:h=C_}=e;lb(i);const a=i/2,g=n*Math.tan(a),y=g*r;return this.ortho({left:-y,right:y,bottom:-g,top:g,near:l,far:h})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:r=1,near:n=.1,far:l=500}=e;return lb(i),Ek(this,i,r,n,l),this.check()}determinant(){return yk(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),n=1/r[0],l=1/r[1],h=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*l,e[2]=this[2]*h,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*l,e[6]=this[6]*h,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*l,e[10]=this[10]*h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),n=1/r[0],l=1/r[1],h=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*l,e[2]=this[2]*h,e[3]=this[4]*n,e[4]=this[5]*l,e[5]=this[6]*h,e[6]=this[8]*n,e[7]=this[9]*l,e[8]=this[10]*h,e}transpose(){return mk(this,this),this.check()}invert(){return Om(this,this),this.check()}multiplyLeft(e){return el(this,e,this),this.check()}multiplyRight(e){return el(this,this,e),this.check()}rotateX(e){return cS(this,this,e),this.check()}rotateY(e){return vk(this,this,e),this.check()}rotateZ(e){return uS(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return xk(this,this,e,i),this.check()}scale(e){return Ny(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return lp(this,this,e),this.check()}transform(e,i){return e.length===4?(i=Dc(i||[-0,-0,-0,-0],e,this),sh(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:r}=e;let n;switch(r){case 2:n=q3(i||[-0,-0],e,this);break;case 3:n=Fy(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return sh(n,e.length),n}transformAsVector(e,i){let r;switch(e.length){case 2:r=X3(i||[-0,-0],e,this);break;case 3:r=eS(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return sh(r,e.length),r}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,r){return this.identity().translate([e,i,r])}}let af,lf;function Uk(){return af||(af=new Qr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(af)),af}function Vk(){return lf||(lf=new Qr,Object.freeze(lf)),lf}function lb(t){if(t>Math.PI*2)throw Error("expected radians")}function $k(t,e,i,r,n,l){const h=2*l/(i-e),a=2*l/(n-r),g=(i+e)/(i-e),y=(n+r)/(n-r),T=-1,S=-1,P=-2*l;return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=g,t[9]=y,t[10]=T,t[11]=S,t[12]=0,t[13]=0,t[14]=P,t[15]=0,t}function cb(){const t=new Ms(4);return Ms!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function jk(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function hS(t,e,i){i=i*.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function ub(t,e,i){const r=e[0],n=e[1],l=e[2],h=e[3],a=i[0],g=i[1],y=i[2],T=i[3];return t[0]=r*T+h*a+n*y-l*g,t[1]=n*T+h*g+l*a-r*y,t[2]=l*T+h*y+r*g-n*a,t[3]=h*T-r*a-n*g-l*y,t}function Wk(t,e,i){i*=.5;const r=e[0],n=e[1],l=e[2],h=e[3],a=Math.sin(i),g=Math.cos(i);return t[0]=r*g+h*a,t[1]=n*g+l*a,t[2]=l*g-n*a,t[3]=h*g-r*a,t}function Hk(t,e,i){i*=.5;const r=e[0],n=e[1],l=e[2],h=e[3],a=Math.sin(i),g=Math.cos(i);return t[0]=r*g-l*a,t[1]=n*g+h*a,t[2]=l*g+r*a,t[3]=h*g-n*a,t}function qk(t,e,i){i*=.5;const r=e[0],n=e[1],l=e[2],h=e[3],a=Math.sin(i),g=Math.cos(i);return t[0]=r*g+n*a,t[1]=n*g-r*a,t[2]=l*g+h*a,t[3]=h*g-l*a,t}function Xk(t,e){const i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t}function Ff(t,e,i,r){const n=e[0],l=e[1],h=e[2],a=e[3];let g=i[0],y=i[1],T=i[2],S=i[3],P,M,B,j,Z;return P=n*g+l*y+h*T+a*S,P<0&&(P=-P,g=-g,y=-y,T=-T,S=-S),1-P>oh?(M=Math.acos(P),Z=Math.sin(M),B=Math.sin((1-r)*M)/Z,j=Math.sin(r*M)/Z):(B=1-r,j=r),t[0]=B*n+j*g,t[1]=B*l+j*y,t[2]=B*h+j*T,t[3]=B*a+j*S,t}function Zk(t,e){const i=e[0],r=e[1],n=e[2],l=e[3],h=i*i+r*r+n*n+l*l,a=h?1/h:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-n*a,t[3]=l*a,t}function Yk(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function dS(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);const l=(n+1)%3,h=(n+2)%3;r=Math.sqrt(e[n*3+n]-e[l*3+l]-e[h*3+h]+1),t[n]=.5*r,r=.5/r,t[3]=(e[l*3+h]-e[h*3+l])*r,t[l]=(e[l*3+n]+e[n*3+l])*r,t[h]=(e[h*3+n]+e[n*3+h])*r}return t}const Kk=Rk,Gk=Ly,Jk=Fk,Qk=Dk,eO=Mk,tO=kk,fS=Ok,iO=function(){const t=iS(),e=sb(1,0,0),i=sb(0,1,0);return function(r,n,l){const h=rS(n,l);return h<-.999999?(Of(t,e,n),aS(t)<1e-6&&Of(t,i,n),ek(t,t),hS(r,t,Math.PI),r):h>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Of(t,n,l),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+h,fS(r,r))}}();(function(){const t=cb(),e=cb();return function(i,r,n,l,h,a){return Ff(t,r,h,a),Ff(e,n,l,a),Ff(i,t,e,2*a*(1-a)),i}})();(function(){const t=ok();return function(e,i,r,n){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],fS(e,dS(e,t))}})();const rO=[0,0,0,1];class hb extends Oy{constructor(e=0,i=0,r=0,n=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,i,r,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,i,r,n){return this[0]=e,this[1]=i,this[2]=r,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return dS(this,e),this.check()}fromAxisRotation(e,i){return hS(this,e,i),this.check()}identity(){return jk(this),this.check()}setAxisAngle(e,i){return this.fromAxisRotation(e,i)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=wi(e)}get y(){return this[1]}set y(e){this[1]=wi(e)}get z(){return this[2]}set z(e){this[2]=wi(e)}get w(){return this[3]}set w(e){this[3]=wi(e)}len(){return eO(this)}lengthSquared(){return tO(this)}dot(e){return Jk(this,e)}rotationTo(e,i){return iO(this,e,i),this.check()}add(e){return Kk(this,this,e),this.check()}calculateW(){return Xk(this,this),this.check()}conjugate(){return Yk(this,this),this.check()}invert(){return Zk(this,this),this.check()}lerp(e,i,r){return r===void 0?this.lerp(this,e,i):(Qk(this,e,i,r),this.check())}multiplyRight(e){return ub(this,this,e),this.check()}multiplyLeft(e){return ub(this,e,this),this.check()}normalize(){const e=this.len(),i=e>0?1/e:0;return this[0]=this[0]*i,this[1]=this[1]*i,this[2]=this[2]*i,this[3]=this[3]*i,e===0&&(this[3]=1),this.check()}rotateX(e){return Wk(this,this,e),this.check()}rotateY(e){return Hk(this,this,e),this.check()}rotateZ(e){return qk(this,this,e),this.check()}scale(e){return Gk(this,this,e),this.check()}slerp(e,i,r){let n,l,h;switch(arguments.length){case 1:({start:n=rO,target:l,ratio:h}=e);break;case 2:n=this,l=e,h=i;break;default:n=e,l=i,h=r}return Ff(this,n,l,h),this.check()}transformVector4(e,i=new Dy){return Nk(i,e,this),sh(i,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,i){return this.setAxisAngle(e,i)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const nO=1e-15,sO=1e-20,db=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,oO={lightSources:{}};function R_(t={}){const{color:e=[0,0,0],intensity:i=1}=t;return e.map(r=>r*i/255)}function aO({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const r={};return t?r["lighting_uAmbientLight.color"]=R_(t):r["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((n,l)=>{r[`lighting_uPointLight[${l}].color`]=R_(n),r[`lighting_uPointLight[${l}].position`]=n.position,r[`lighting_uPointLight[${l}].attenuation`]=n.attenuation||[1,0,0]}),r.lighting_uPointLightCount=e.length,i.forEach((n,l)=>{r[`lighting_uDirectionalLight[${l}].color`]=R_(n),r[`lighting_uDirectionalLight[${l}].direction`]=n.direction}),r.lighting_uDirectionalLightCount=i.length,r}function pS(t=oO){var e,i;if("lightSources"in t){const{ambientLight:r,pointLights:n,directionalLights:l}=t.lightSources||{};return r||n&&n.length>0||l&&l.length>0?Object.assign({},aO({ambientLight:r,pointLights:n,directionalLights:l}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const r={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":r.ambientLight=n;break;case"directional":(e=r.directionalLights)==null||e.push(n);break;case"point":(i=r.pointLights)==null||i.push(n);break}return pS({lightSources:r})}return{}}const lO={name:"lights",vs:db,fs:db,getUniforms:pS,defines:{MAX_LIGHTS:3}},cO=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,uO={};function hO(t){const{ambient:e=.35,diffuse:i=.6,shininess:r=32,specularColor:n=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:r,lighting_uSpecularColor:n.map(l=>l/255)}}function dO(t=uO){if(!("material"in t))return{};const{material:e}=t;return e?hO(e):{lighting_uEnabled:!1}}const fO={name:"gouraud-lighting",dependencies:[lO],vs:cO,defines:{LIGHTING_VERTEX:1},getUniforms:dO},gS="#define SMOOTH_EDGE_RADIUS 0.5",pO=`
${gS}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,gO=`
${gS}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,_O={name:"geometry",vs:pO,fs:gO},Qt={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Qt,"IDENTITY",{get:()=>(Wt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const As={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},rl={common:0,meters:1,pixels:2},Dm={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},mO=Object.keys(Qt).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Qt[t]};`).join(""),yO=Object.keys(As).map(t=>`const int PROJECTION_MODE_${t} = ${As[t]};`).join(""),xO=Object.keys(rl).map(t=>`const int UNIT_${t.toUpperCase()} = ${rl[t]};`).join(""),vO=`${mO}
${yO}
${xO}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function bO(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}return!1}function zh(t){let e={},i;return r=>{for(const n in r)if(!bO(r[n],e[n])){i=t(r),e=r;break}return i}}const fb=[0,0,0,0],wO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],_S=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],TO=[0,0,0],mS=[0,0,0],SO=zh(PO);function yS(t,e,i=mS){i.length<3&&(i=[i[0],i[1],0]);let r=i,n,l=!0;switch(e===Qt.LNGLAT_OFFSETS||e===Qt.METER_OFFSETS?n=i:n=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case As.WEB_MERCATOR:(e===Qt.LNGLAT||e===Qt.CARTESIAN)&&(n=[0,0,0],l=!1);break;case As.WEB_MERCATOR_AUTO_OFFSET:e===Qt.LNGLAT?r=n:e===Qt.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],n=t.unprojectPosition(r),r[0]-=i[0],r[1]-=i[1],r[2]-=i[2]);break;case As.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case As.GLOBE:l=!1,n=null;break;default:l=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:r,offsetMode:l}}function EO(t,e,i){const{viewMatrixUncentered:r,projectionMatrix:n}=t;let{viewMatrix:l,viewProjectionMatrix:h}=t,a=fb,g=fb,y=t.cameraPosition;const{geospatialOrigin:T,shaderCoordinateOrigin:S,offsetMode:P}=yS(t,e,i);return P&&(g=t.projectPosition(T||S),y=[y[0]-g[0],y[1]-g[1],y[2]-g[2]],g[3]=1,a=Dc([],g,h),l=r||l,h=el([],n,l),h=el([],h,wO)),{viewMatrix:l,viewProjectionMatrix:h,projectionCenter:a,originCommon:g,cameraPosCommon:y,shaderCoordinateOrigin:S,geospatialOrigin:T}}function AO({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:r=Qt.DEFAULT,coordinateOrigin:n=mS,autoWrapLongitude:l=!1}){r===Qt.DEFAULT&&(r=t.isGeospatial?Qt.LNGLAT:Qt.CARTESIAN);const h=SO({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:n});return h.project_uWrapLongitude=l,h.project_uModelMatrix=i||_S,h}function PO({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r}){const{projectionCenter:n,viewProjectionMatrix:l,originCommon:h,cameraPosCommon:a,shaderCoordinateOrigin:g,geospatialOrigin:y}=EO(t,i,r),T=t.getDistanceScales(),S=[t.width*e,t.height*e],P=Dc([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,M={project_uCoordinateSystem:i,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:g,project_uCommonOrigin:h.slice(0,3),project_uCenter:n,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:S,project_uDevicePixelRatio:e,project_uFocalDistance:P,project_uCommonUnitsPerMeter:T.unitsPerMeter,project_uCommonUnitsPerWorldUnit:T.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:TO,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:l,project_uModelMatrix:_S,project_uCameraPosition:a};if(y){const B=t.getDistanceScales(y);switch(i){case Qt.METER_OFFSETS:M.project_uCommonUnitsPerWorldUnit=B.unitsPerMeter,M.project_uCommonUnitsPerWorldUnit2=B.unitsPerMeter2;break;case Qt.LNGLAT:case Qt.LNGLAT_OFFSETS:t._pseudoMeters||(M.project_uCommonUnitsPerMeter=B.unitsPerMeter),M.project_uCommonUnitsPerWorldUnit=B.unitsPerDegree,M.project_uCommonUnitsPerWorldUnit2=B.unitsPerDegree2;break;case Qt.CARTESIAN:M.project_uCommonUnitsPerWorldUnit=[1,1,B.unitsPerMeter[2]],M.project_uCommonUnitsPerWorldUnit2=[0,0,B.unitsPerMeter2[2]];break}}return M}const IO={};function CO(t=IO){return"viewport"in t?AO(t):{}}const By={name:"project",dependencies:[A3,_O],vs:vO,getUniforms:CO},RO=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Uh={name:"project32",dependencies:[By],vs:RO};function MO(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wc(t,e){const i=Dc([],e,t);return Ly(i,i,1/i[3]),i}function pb(t,e){const i=t%e;return i<0?e+i:i}function Nm(t,e,i){return t<e?e:t>i?i:t}function kO(t){return Math.log(t)*Math.LOG2E}const zy=Math.log2||kO;function Ao(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ps=Math.PI,xS=Ps/4,ls=Ps/180,Lm=180/Ps,Rc=512,cp=4003e4,cf=85.051129,OO=1.5;function FO(t){return zy(t)}function Mc(t){const[e,i]=t;Ao(Number.isFinite(e)),Ao(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const r=e*ls,n=i*ls,l=Rc*(r+Ps)/(2*Ps),h=Rc*(Ps+Math.log(Math.tan(xS+n*.5)))/(2*Ps);return[l,h]}function kc(t){const[e,i]=t,r=e/Rc*(2*Ps)-Ps,n=2*(Math.atan(Math.exp(i/Rc*(2*Ps)-Ps))-xS);return[r*Lm,n*Lm]}function DO(t){const{latitude:e}=t;Ao(Number.isFinite(e));const i=Math.cos(e*ls);return FO(cp*i)-9}function M_(t){const e=Math.cos(t*ls);return Rc/cp/e}function Bm(t){const{latitude:e,longitude:i,highPrecision:r=!1}=t;Ao(Number.isFinite(e)&&Number.isFinite(i));const n=Rc,l=Math.cos(e*ls),h=n/360,a=h/l,g=n/cp/l,y={unitsPerMeter:[g,g,g],metersPerUnit:[1/g,1/g,1/g],unitsPerDegree:[h,a,g],degreesPerUnit:[1/h,1/a,1/g]};if(r){const T=ls*Math.tan(e*ls)/l,S=h*T/2,P=n/cp*T,M=P/a*g;y.unitsPerDegree2=[0,S,P],y.unitsPerMeter2=[M,0,M]}return y}function vS(t,e){const[i,r,n]=t,[l,h,a]=e,{unitsPerMeter:g,unitsPerMeter2:y}=Bm({longitude:i,latitude:r,highPrecision:!0}),T=Mc(t);T[0]+=l*(g[0]+y[0]*h),T[1]+=h*(g[1]+y[1]*h);const S=kc(T),P=(n||0)+(a||0);return Number.isFinite(n)||Number.isFinite(a)?[S[0],S[1],P]:S}function NO(t){const{height:e,pitch:i,bearing:r,altitude:n,scale:l,center:h}=t,a=MO();lp(a,a,[0,0,-n]),cS(a,a,-i*ls),uS(a,a,r*ls);const g=l/e;return Ny(a,a,[g,g,g]),h&&lp(a,a,Q3([],h)),a}function LO(t){const{width:e,height:i,altitude:r,pitch:n=0,offset:l,center:h,scale:a,nearZMultiplier:g=1,farZMultiplier:y=1}=t;let{fovy:T=up(OO)}=t;r!==void 0&&(T=up(r));const S=T*ls,P=n*ls,M=bS(T);let B=M;h&&(B+=h[2]*a/Math.cos(P)/i);const j=S*(.5+(l?l[1]:0)/i),Z=Math.sin(j)*B/Math.sin(Nm(Math.PI/2-P-j,.01,Math.PI-.01)),G=Math.sin(P)*Z+B,fe=B*10,re=Math.min(G*y,fe);return{fov:S,aspect:e/i,focalDistance:M,near:g,far:re}}function up(t){return 2*Math.atan(.5/t)*Lm}function bS(t){return .5/Math.tan(.5*t*ls)}function wS(t,e){const[i,r,n=0]=t;return Ao(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(n)),wc(e,[i,r,n,1])}function Uy(t,e,i=0){const[r,n,l]=t;if(Ao(Number.isFinite(r)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(l))return wc(e,[r,n,l,1]);const h=wc(e,[r,n,0,1]),a=wc(e,[r,n,1,1]),g=h[2],y=a[2],T=g===y?0:((i||0)-g)/(y-g);return QT([],h,a,T)}function BO(t){const{width:e,height:i,bounds:r,minExtent:n=0,maxZoom:l=24,offset:h=[0,0]}=t,[[a,g],[y,T]]=r,S=zO(t.padding),P=Mc([a,Nm(T,-cf,cf)]),M=Mc([y,Nm(g,-cf,cf)]),B=[Math.max(Math.abs(M[0]-P[0]),n),Math.max(Math.abs(M[1]-P[1]),n)],j=[e-S.left-S.right-Math.abs(h[0])*2,i-S.top-S.bottom-Math.abs(h[1])*2];Ao(j[0]>0&&j[1]>0);const Z=j[0]/B[0],G=j[1]/B[1],fe=(S.right-S.left)/2/Z,re=(S.top-S.bottom)/2/G,ue=[(M[0]+P[0])/2+fe,(M[1]+P[1])/2+re],Me=kc(ue),Oe=Math.min(l,zy(Math.abs(Math.min(Z,G))));return Ao(Number.isFinite(Oe)),{longitude:Me[0],latitude:Me[1],zoom:Oe}}function zO(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Ao(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const gb=Math.PI/180;function UO(t,e=0){const{width:i,height:r,unproject:n}=t,l={targetZ:e},h=n([0,r],l),a=n([i,r],l);let g,y;const T=t.fovy?.5*t.fovy*gb:Math.atan(.5/t.altitude),S=(90-t.pitch)*gb;return T>S-.01?(g=_b(t,0,e),y=_b(t,i,e)):(g=n([0,0],l),y=n([i,0],l)),[h,a,y,g]}function _b(t,e,i){const{pixelUnprojectionMatrix:r}=t,n=wc(r,[e,0,1,1]),l=wc(r,[e,t.height,1,1]),a=(i*t.distanceScales.unitsPerMeter[2]-n[2])/(l[2]-n[2]),g=QT([],n,l,a),y=kc(g);return y.push(i),y}const mb=512;function VO(t){const{width:e,height:i,pitch:r=0}=t;let{longitude:n,latitude:l,zoom:h,bearing:a=0}=t;(n<-180||n>180)&&(n=pb(n+180,360)-180),(a<-180||a>180)&&(a=pb(a+180,360)-180);const g=zy(i/mb);if(h<=g)h=g,l=0;else{const y=i/2/Math.pow(2,h),T=kc([0,y])[1];if(l<T)l=T;else{const S=kc([0,mb-y])[1];l>S&&(l=S)}}return{width:e,height:i,longitude:n,latitude:l,zoom:h,pitch:r,bearing:a}}const $O=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,jO=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,WO=zh(YO),HO=zh(KO),qO=[0,0,0,1],XO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function ZO(t,e){const[i,r,n]=t,l=Uy([i,r,n],e);return Number.isFinite(n)?l:[l[0],l[1],0]}function YO({viewport:t,center:e}){return new Qr(t.viewProjectionMatrix).invert().transform(e)}function KO({viewport:t,shadowMatrices:e}){const i=[],r=t.pixelUnprojectionMatrix,n=t.isGeospatial?void 0:1,l=[[0,0,n],[t.width,0,n],[0,t.height,n],[t.width,t.height,n],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(h=>ZO(h,r));for(const h of e){const a=h.clone().translate(new mt(t.center).negate()),g=l.map(T=>a.transform(T)),y=new Qr().ortho({left:Math.min(...g.map(T=>T[0])),right:Math.max(...g.map(T=>T[0])),bottom:Math.min(...g.map(T=>T[1])),top:Math.max(...g.map(T=>T[1])),near:Math.min(...g.map(T=>-T[2])),far:Math.max(...g.map(T=>-T[2]))});i.push(y.multiplyRight(h))}return i}function GO(t,e){const{shadowEnabled:i=!0}=t;if(!i||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||qO,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},n=WO({viewport:t.viewport,center:e.project_uCenter}),l=[],h=HO({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const g=h[a],y=g.clone().translate(new mt(t.viewport.center).negate());e.project_uCoordinateSystem===Qt.LNGLAT&&e.project_uProjectionMode===As.WEB_MERCATOR?(h[a]=y,l[a]=n):(h[a]=g.clone().multiplyRight(XO),l[a]=y.transform(n))}for(let a=0;a<h.length;a++)r[`shadow_uViewProjectionMatrices[${a}]`]=h[a],r[`shadow_uProjectCenters[${a}]`]=l[a];for(let a=0;a<2;a++)r[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return r}const yb={name:"shadow",dependencies:[By],vs:$O,fs:jO,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?GO(t,e):{}},Vh={...rb,defaultUniforms:{...rb.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},JO=[By],QO=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function eF(){const t=Qf.getDefaultShaderAssembler();for(const e of JO)t.addDefaultModule(e);for(const e of QO)t.addShaderHook(e);return t}const tF=[255,255,255],iF=1;let rF=0;class nF{constructor(e={}){this.type="ambient";const{color:i=tF}=e,{intensity:r=iF}=e;this.id=e.id||`ambient-${rF++}`,this.color=i,this.intensity=r}}const sF=[255,255,255],oF=1,aF=[0,0,-1];let lF=0;class xb{constructor(e={}){this.type="directional";const{color:i=sF}=e,{intensity:r=oF}=e,{direction:n=aF}=e,{_shadow:l=!1}=e;this.id=e.id||`directional-${lF++}`,this.color=i,this.intensity=r,this.type="directional",this.direction=new mt(n).normalize().toArray(),this.shadow=l}getProjectedLight(e){return this}}class cF{constructor(e,i={id:"pass"}){const{id:r}=i;this.id=r,this.device=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Vy extends cF{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[i,r]=this.device.canvasContext.getDrawingBufferSize(),n=e.clearCanvas??!0,l=e.clearColor??(n?[0,0,0,0]:!1),h=n?1:!1,a=n?0:!1,g=e.colorMask??15,y={viewport:[0,0,i,r]};e.colorMask&&(y.colorMask=g),e.scissorRect&&(y.scissorRect=e.scissorRect);const T=this.device.beginRenderPass({framebuffer:e.target,parameters:y,clearColor:l,clearDepth:h,clearStencil:a});try{return this._drawLayers(T,e)}finally{T.end()}}_drawLayers(e,i){const{target:r,moduleParameters:n,viewports:l,views:h,onViewportActive:a,clearStack:g=!0}=i;i.pass=i.pass||"unknown",g&&(this._lastRenderIndex=-1);const y=[];for(const T of l){const S=h&&h[T.id];a==null||a(T);const P=this._getDrawLayerParams(T,i),M=T.subViewports||[T];for(const B of M){const j=this._drawLayersInViewport(e,{target:r,moduleParameters:n,viewport:B,view:S,pass:i.pass,layers:i.layers},P);y.push(j)}}return y}_getDrawLayerParams(e,{layers:i,pass:r,isPicking:n=!1,layerFilter:l,cullRect:h,effects:a,moduleParameters:g},y=!1){var B;const T=[],S=TS(this._lastRenderIndex+1),P={layer:i[0],viewport:e,isPicking:n,renderPass:r,cullRect:h},M={};for(let j=0;j<i.length;j++){const Z=i[j],G=this._shouldDrawLayer(Z,P,l,M),fe={shouldDrawLayer:G};G&&!y&&(fe.layerRenderIndex=S(Z,G),fe.moduleParameters=this._getModuleParameters(Z,a,r,g),fe.layerParameters={...(B=Z.context.deck)==null?void 0:B.props.parameters,...this.getLayerParameters(Z,j,e)}),T[j]=fe}return T}_drawLayersInViewport(e,{layers:i,moduleParameters:r,pass:n,target:l,viewport:h,view:a},g){const y=uF(this.device,{moduleParameters:r,target:l,viewport:h});if(a&&a.props.clear){const S=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:y},()=>this.device.clearWebGL(S))}const T={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:y});for(let S=0;S<i.length;S++){const P=i[S],{shouldDrawLayer:M,layerRenderIndex:B,moduleParameters:j,layerParameters:Z}=g[S];if(M&&P.props.pickable&&T.pickableCount++,P.isComposite)T.compositeCount++;else if(M){T.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,B),j.viewport=h,P.context.renderPass=e;try{P._drawLayer({renderPass:e,moduleParameters:j,uniforms:{layerIndex:B},parameters:Z})}catch(G){P.raiseError(G,`drawing ${P} to ${n}`)}}}return T}shouldDrawLayer(e){return!0}getModuleParameters(e,i){return null}getLayerParameters(e,i,r){return e.props.parameters}_shouldDrawLayer(e,i,r,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let h=e.parent;for(;h;){if(!h.props.visible||!h.filterSubLayer(i))return!1;i.layer=h,h=h.parent}if(r){const a=i.layer.id;if(a in n||(n[a]=r(i)),!n[a])return!1}return e.activateViewport(i.viewport),!0}_getModuleParameters(e,i,r,n){var a,g;const l=this.device.canvasContext.cssToDeviceRatio(),h=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:l});if(i)for(const y of i)Object.assign(h,(g=y.getModuleParameters)==null?void 0:g.call(y,e));return Object.assign(h,this.getModuleParameters(e,i),n)}}function TS(t=0,e={}){const i={},r=(n,l)=>{const h=n.props._offset,a=n.id,g=n.parent&&n.parent.id;let y;if(g&&!(g in e)&&r(n.parent,!1),g in i){const T=i[g]=i[g]||TS(e[g],e);y=T(n,l),i[a]=T}else Number.isFinite(h)?(y=h+(e[g]||0),i[a]=null):y=t;return l&&y>=t&&(t=y+1),e[a]=y,y};return r}function uF(t,{moduleParameters:e,target:i,viewport:r}){const n=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,l]=t.canvasContext.getDrawingBufferSize(),h=i?i.height:l,a=r;return[a.x*n,h-(a.y+a.height)*n,a.width*n,a.height*n]}class hF extends Vy{constructor(e,i){super(e,i),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const i=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),n=e.viewports[0],l=n.width*r,h=n.height*r,a=[1,1,1,1];(l!==i.width||h!==i.height)&&i.resize({width:l,height:h}),super.render({...e,clearColor:a,target:i,pass:"shadow"})}getLayerParameters(e,i,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const dF={color:[255,255,255],intensity:1},vb=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],fF=[0,0,0,200/255];class SS{constructor(e={}){this.id="lighting-effect",this.shadowColor=fF,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:i,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),r._addDefaultShaderModule(yb),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const i in e){const r=e[i];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:i,viewports:r,onViewportActive:n,views:l}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let h=0;h<this.shadowPasses.length;h++)this.shadowPasses[h].render({layers:e,layerFilter:i,viewports:r,onViewportActive:n,views:l,moduleParameters:{shadowLightId:h,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const i=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return i.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},i}cleanup(e){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(yb))}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const r=new Qr().lookAt({eye:new mt(i.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const r=new hF(e);this.shadowPasses[i]=r,this.shadowMaps[i]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:r}=this;!e&&i.length===0&&r.length===0&&(this.ambientLight=new nF(dF),this.directionalLights.push(new xb(vb[0]),new xb(vb[1])))}}class pF{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:r=1,type:n,padding:l=0,copy:h=!1,initialize:a=!1,maxCount:g}){const y=n||e&&e.constructor||Float32Array,T=i*r+l;if(ArrayBuffer.isView(e)){if(T<=e.length)return e;if(T*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new y(e.buffer,0,T)}let S=1/0;g&&(S=g*r+l);const P=this._allocate(y,T,a,S);return e&&h?P.set(e):a||P.fill(0,0,4),this._release(e),P}release(e){this._release(e)}_allocate(e,i,r,n){let l=Math.max(Math.ceil(i*this.opts.overAlloc),1);l>n&&(l=n);const h=this._pool,a=e.BYTES_PER_ELEMENT*l,g=h.findIndex(y=>y.byteLength>=a);if(g>=0){const y=new e(h.splice(g,1)[0],0,l);return r&&y.fill(0),y}return new e(l)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:r}=e,{byteLength:n}=r,l=i.findIndex(h=>h.byteLength>=n);l<0?i.push(r):(l>0||i.length<this.opts.poolSize)&&i.splice(l,0,r),i.length>this.opts.poolSize&&i.shift()}}const Oc=new pF;function Qu(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function gF(t){return[t[12],t[13],t[14]]}function _F(t){return{left:Jl(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Jl(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Jl(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Jl(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Jl(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Jl(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const bb=new mt;function Jl(t,e,i,r){bb.set(t,e,i);const n=bb.len();return{distance:r/n,normal:new mt(-t/n,-e/n,-i/n)}}function mF(t){return t-Math.fround(t)}let $u;function k_(t,e){const{size:i=1,startIndex:r=0}=e,n=e.endIndex!==void 0?e.endIndex:t.length,l=(n-r)/i;$u=Oc.allocate($u,l,{type:Float32Array,size:i*2});let h=r,a=0;for(;h<n;){for(let g=0;g<i;g++){const y=t[h++];$u[a+g]=y,$u[a+g+i]=mF(y)}a+=i*2}return $u.subarray(0,l*i*2)}function yF(t){let e=null,i=!1;for(const r of t)r&&(e?(i||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],i=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const xF=Math.PI/180,vF=Qu(),wb=[0,0,0],bF={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function wF({width:t,height:e,orthographic:i,fovyRadians:r,focalDistance:n,padding:l,near:h,far:a}){const g=t/e,y=i?new Qr().orthographic({fovy:r,aspect:g,focalDistance:n,near:h,far:a}):new Qr().perspective({fovy:r,aspect:g,near:h,far:a});if(l){const{left:T=0,right:S=0,top:P=0,bottom:M=0}=l,B=sa((T+t-S)/2,0,t)-t/2,j=sa((P+e-M)/2,0,e)-e/2;y[8]-=B*2/t,y[9]+=j*2/e}return y}class Zp{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||bF,this.focalDistance=e.focalDistance||1,this.position=e.position||wb,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?As.WEB_MERCATOR:As.WEB_MERCATOR_AUTO_OFFSET:As.IDENTITY}equals(e){return e instanceof Zp?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&So(e.projectionMatrix,this.projectionMatrix)&&So(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const r=this.projectPosition(e),n=wS(r,this.pixelProjectionMatrix),[l,h]=n,a=i?h:this.height-h;return e.length===2?[l,a]:[l,a,n[2]]}unproject(e,{topLeft:i=!0,targetZ:r}={}){const[n,l,h]=e,a=i?l:this.height-l,g=r&&r*this.distanceScales.unitsPerMeter[2],y=Uy([n,a,h],this.pixelUnprojectionMatrix,g),[T,S,P]=this.unprojectPosition(y);return Number.isFinite(h)?[T,S,P]:Number.isFinite(r)?[T,S,r]:[T,S]}projectPosition(e){const[i,r]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,r,n]}unprojectPosition(e){const[i,r]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,r,n]}projectFlat(e){if(this.isGeospatial){const i=Mc(e);return i[1]=sa(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?kc(e):e}getBounds(e={}){const i={targetZ:e.z||0},r=this.unproject([0,0],i),n=this.unproject([this.width,0],i),l=this.unproject([0,this.height],i),h=this.unproject([this.width,this.height],i);return[Math.min(r[0],n[0],l[0],h[0]),Math.min(r[1],n[1],l[1],h[1]),Math.max(r[0],n[0],l[0],h[0]),Math.max(r[1],n[1],l[1],h[1])]}getDistanceScales(e){return e?Bm({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:r=1,height:n=1}){return e<this.x+this.width&&this.x<e+r&&i<this.y+this.height&&this.y<i+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,_F(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=DO({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Bm({latitude:r,longitude:i}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:l,modelMatrix:h}=e;let a=wb;if(l&&(a=h?new Qr(h).transformAsVector(l,[]):l),this.isGeospatial){const g=this.projectPosition([i,r,0]);this.center=new mt(a).scale(this.distanceScales.unitsPerMeter).add(g)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:i=vF,projectionMatrix:r=null,orthographic:n=!1,fovyRadians:l,fovy:h=75,near:a=.1,far:g=1e3,padding:y=null,focalDistance:T=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new Qr().multiplyRight(i).translate(new mt(this.center).negate()),this.projectionMatrix=r||wF({width:this.width,height:this.height,orthographic:n,fovyRadians:l||h*xF,focalDistance:T,padding:y,near:a,far:g});const S=Qu();el(S,S,this.projectionMatrix),el(S,S,this.viewMatrix),this.viewProjectionMatrix=S,this.viewMatrixInverse=Om([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=gF(this.viewMatrixInverse);const P=Qu(),M=Qu();Ny(P,P,[this.width/2,-this.height/2,1]),lp(P,P,[1,-1,0]),el(M,P,this.viewProjectionMatrix),this.pixelProjectionMatrix=M,this.pixelUnprojectionMatrix=Om(Qu(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Wt.warn("Pixel project matrix not invertible")()}}Zp.displayName="Viewport";const $y=Zp;class yh extends $y{constructor(e={}){const{latitude:i=0,longitude:r=0,zoom:n=0,pitch:l=0,bearing:h=0,nearZMultiplier:a=.1,farZMultiplier:g=1.01,nearZ:y,farZ:T,orthographic:S=!1,projectionMatrix:P,repeat:M=!1,worldOffset:B=0,position:j,padding:Z,legacyMeterSizes:G=!1}=e;let{width:fe,height:re,altitude:ue=1.5}=e;const Me=Math.pow(2,n);fe=fe||1,re=re||1;let Oe,$e=null;if(P)ue=P[5]/2,Oe=up(ue);else{e.fovy?(Oe=e.fovy,ue=bS(Oe)):Oe=up(ue);let je;if(Z){const{top:Ue=0,bottom:ct=0}=Z;je=[0,sa((Ue+re-ct)/2,0,re)-re/2]}$e=LO({width:fe,height:re,scale:Me,center:j&&[0,0,j[2]*M_(i)],offset:je,pitch:l,fovy:Oe,nearZMultiplier:a,farZMultiplier:g}),Number.isFinite(y)&&($e.near=y),Number.isFinite(T)&&($e.far=T)}let ke=NO({height:re,pitch:l,bearing:h,scale:Me,altitude:ue});B&&(ke=new Qr().translate([512*B,0,0]).multiplyLeft(ke)),super({...e,width:fe,height:re,viewMatrix:ke,longitude:r,latitude:i,zoom:n,...$e,fovy:Oe,focalDistance:ue}),this.latitude=i,this.longitude=r,this.zoom=n,this.pitch=l,this.bearing=h,this.altitude=ue,this.fovy=Oe,this.orthographic=S,this._subViewports=M?[]:null,this._pseudoMeters=G,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let n=i;n<=r;n++){const l=n?new yh({...this,worldOffset:n}):this;this._subViewports.push(l)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,r]=this.projectFlat(e),n=(e[2]||0)*M_(e[1]);return[i,r,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,r]=this.unprojectFlat(e),n=(e[2]||0)/M_(r);return[i,r,n]}addMetersToLngLat(e,i){return vS(e,i)}panByPosition(e,i){const r=Uy(i,this.pixelUnprojectionMatrix),n=this.projectFlat(e),l=nb([],n,W3([],r)),h=nb([],this.center,l),[a,g]=this.unprojectFlat(h);return{longitude:a,latitude:g}}getBounds(e={}){const i=UO(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:r,height:n}=this,{longitude:l,latitude:h,zoom:a}=BO({width:r,height:n,bounds:e,...i});return new yh({width:r,height:n,longitude:l,latitude:h,zoom:a})}}yh.displayName="WebMercatorViewport";const xh=yh,Tb=[0,0,0];function O_(t,e,i=!1){const r=e.projectPosition(t);if(i&&e instanceof xh){const[n,l,h=0]=t,a=e.getDistanceScales([n,l]);r[2]=h*a.unitsPerMeter[2]}return r}function TF(t){const{viewport:e,modelMatrix:i,coordinateOrigin:r}=t;let{coordinateSystem:n,fromCoordinateSystem:l,fromCoordinateOrigin:h}=t;return n===Qt.DEFAULT&&(n=e.isGeospatial?Qt.LNGLAT:Qt.CARTESIAN),l===void 0&&(l=n),h===void 0&&(h=r),{viewport:e,coordinateSystem:n,coordinateOrigin:r,modelMatrix:i,fromCoordinateSystem:l,fromCoordinateOrigin:h}}function ES(t,{viewport:e,modelMatrix:i,coordinateSystem:r,coordinateOrigin:n,offsetMode:l}){let[h,a,g=0]=t;switch(i&&([h,a,g]=Dc([],[h,a,g,1],i)),r){case Qt.LNGLAT:return O_([h,a,g],e,l);case Qt.LNGLAT_OFFSETS:return O_([h+n[0],a+n[1],g+(n[2]||0)],e,l);case Qt.METER_OFFSETS:return O_(vS(n,[h,a,g]),e,l);case Qt.CARTESIAN:default:return e.isGeospatial?[h+n[0],a+n[1],g+n[2]]:e.projectPosition([h,a,g])}}function SF(t,e){const{viewport:i,coordinateSystem:r,coordinateOrigin:n,modelMatrix:l,fromCoordinateSystem:h,fromCoordinateOrigin:a}=TF(e),{autoOffset:g=!0}=e,{geospatialOrigin:y=Tb,shaderCoordinateOrigin:T=Tb,offsetMode:S=!1}=g?yS(i,r,n):{},P=ES(t,{viewport:i,modelMatrix:l,coordinateSystem:h,coordinateOrigin:a,offsetMode:S});if(S){const M=i.projectPosition(y||T);oS(P,P,M)}return P}let EF=1,AF=1;class AS{constructor(){H(this,"time",0);H(this,"channels",new Map);H(this,"animations",new Map);H(this,"playing",!1);H(this,"lastEngineTime",-1)}addChannel(e){const{delay:i=0,duration:r=Number.POSITIVE_INFINITY,rate:n=1,repeat:l=1}=e,h=EF++,a={time:0,delay:i,duration:r,rate:n,repeat:l};return this._setChannelTime(a,this.time),this.channels.set(h,a),h}removeChannel(e){this.channels.delete(e);for(const[i,r]of this.animations)r.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const n of i)this._setChannelTime(n,this.time);const r=this.animations.values();for(const n of r){const{animation:l,channel:h}=n;l.setTime(this.getTime(h))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const r=AF++;return this.animations.set(r,{animation:e,channel:i}),e.setTime(this.getTime(i)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const r=i-e.delay,n=e.duration*e.repeat;r>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let PF=0;const IF={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:vc.stats.get(`animation-loop-${PF++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class CF{constructor(e){H(this,"device",null);H(this,"canvas",null);H(this,"props");H(this,"animationProps",null);H(this,"timeline",null);H(this,"stats");H(this,"cpuTime");H(this,"gpuTime");H(this,"frameRate");H(this,"display");H(this,"needsRedraw","initialized");H(this,"_initialized",!1);H(this,"_running",!1);H(this,"_animationFrameId",null);H(this,"_nextFramePromise",null);H(this,"_resolveNextFrame",null);H(this,"_cpuStartTime",0);if(this.props={...IF,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=e.stats||new Nh({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const i=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=BM(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(zM(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,i;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(i=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:i.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:i,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(i);const r=this.props.onAddHTML(i);r&&(i.innerHTML=r)}}_getSizeAndAspect(){var l,h,a,g;if(!this.device)return{width:1,height:1,aspect:1};const[e,i]=((h=(l=this.device)==null?void 0:l.canvasContext)==null?void 0:h.getPixelSize())||[1,1];let r=1;const n=(g=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:g.canvas;return n&&n.clientHeight?r=n.clientWidth/n.clientHeight:e>0&&i>0&&(r=e/i),{width:e,height:i,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,i;this.props.autoResizeDrawingBuffer&&((i=(e=this.device)==null?void 0:e.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class Sb{constructor(e){H(this,"id");H(this,"userData",{});H(this,"topology");H(this,"bufferLayout",[]);H(this,"vertexCount");H(this,"indices");H(this,"attributes");this.id=e.id||hl("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&Pi(this.indices.usage===Li.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const i of Object.values(this.attributes))i.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function RF(t,e){if(e instanceof Sb)return e;const i=MF(t,e),{attributes:r,bufferLayout:n}=kF(t,e);return new Sb({topology:e.topology||"triangle-list",bufferLayout:n,vertexCount:e.vertexCount,indices:i,attributes:r})}function MF(t,e){if(!e.indices)return;const i=e.indices.value;return t.createBuffer({usage:Li.INDEX,data:i})}function kF(t,e){const i=[],r={};for(const[l,h]of Object.entries(e.attributes)){let a=l;switch(l){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}r[a]=t.createBuffer({data:h.value,id:`${l}-buffer`});const{value:g,size:y,normalized:T}=h;i.push({name:a,format:OM(g,y,T)})}const n=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:i,vertexCount:n}}class OF{constructor(e){H(this,"modules");H(this,"moduleUniforms");H(this,"moduleBindings");H(this,"moduleUniformsChanged");const i=qp(Object.values(e).filter(r=>r.dependencies));for(const r of i)e[r.name]=r;Je.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,n]of Object.entries(e)){const l=r;this.moduleUniforms[l]=n.defaultUniforms||{},this.moduleBindings[l]={}}}destroy(){}setProps(e){var i;for(const r of Object.keys(e)){const n=r,l=e[n],h=this.modules[n];if(!h){Je.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[n],g=this.moduleBindings[n],y=((i=h.getUniforms)==null?void 0:i.call(h,l,a))||l,{uniforms:T,bindings:S}=ky(y);this.moduleUniforms[n]={...a,...T},this.moduleBindings[n]={...g,...S}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const i of Object.values(this.moduleBindings))Object.assign(e,i);return e}getDebugTable(){var i;const e={};for(const[r,n]of Object.entries(this.moduleUniforms))for(const[l,h]of Object.entries(n))e[`${r}.${l}`]={type:(i=this.modules[r].uniformTypes)==null?void 0:i[l],value:String(h)};return e}}const Vp=class Vp{constructor(e){H(this,"device");H(this,"_hashCounter",0);H(this,"_hashes",{});H(this,"_renderPipelineCache",{});H(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Vp(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const i={...Pc.defaultProps,...e},r=this._hashRenderPipeline(i);if(!this._renderPipelineCache[r]){const n=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});n.hash=r,this._renderPipelineCache[r]={pipeline:n,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const i={...sp.defaultProps,...e},r=this._hashComputePipeline(i);if(!this._computePipelineCache[r]){const n=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});n.hash=r,this._computePipelineCache[r]={pipeline:n,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const i=e.hash,r=e instanceof sp?this._computePipelineCache:this._renderPipelineCache;r[i].useCount--,r[i].useCount===0&&(r[i].pipeline.destroy(),delete r[i])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const i=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,n="-",l=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${r}V${n}BL${l}`;default:const h=this._getHash(JSON.stringify(e.parameters));return`${i}/${r}V${n}T${e.topology}P${h}BL${l}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};H(Vp,"defaultProps",{...Pc.defaultProps});let zm=Vp;const $p=class $p{constructor(e){H(this,"device");H(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var i;return(i=e._lumaData).defaultShaderFactory||(i.defaultShaderFactory=new $p(e)),e._lumaData.defaultShaderFactory}createShader(e){const i=this._hashShader(e);let r=this._cache[i];if(!r){const n=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[i]=r={shader:n,useCount:0}}return r.useCount++,r.shader}release(e){const i=this._hashShader(e),r=this._cache[i];r&&(r.useCount--,r.useCount===0&&(delete this._cache[i],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};H($p,"defaultProps",{...ip.defaultProps});let Um=$p;function FF(t,e){var n;const i={},r="Values";if(t.attributes.length===0&&!((n=t.varyings)!=null&&n.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const l of t.attributes)if(l){const h=`${l.location} ${l.name}: ${l.type}`;i[`in ${h}`]={[r]:l.stepMode||"vertex"}}for(const l of t.varyings||[]){const h=`${l.location} ${l.name}`;i[`out ${h}`]={[r]:JSON.stringify(l.accessor)}}return i}let Sr=null,F_=null;function DF(t,{id:e,minimap:i,opaque:r,top:n="0",left:l="0",rgbaScale:h=1}){Sr||(Sr=document.createElement("canvas"),Sr.id=e,Sr.title=e,Sr.style.zIndex="100",Sr.style.position="absolute",Sr.style.top=n,Sr.style.left=l,Sr.style.border="blue 1px solid",Sr.style.transform="scaleY(-1)",document.body.appendChild(Sr),F_=Sr.getContext("2d")),(Sr.width!==t.width||Sr.height!==t.height)&&(Sr.width=t.width/2,Sr.height=t.height/2,Sr.style.width="400px",Sr.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),g=F_.createImageData(t.width,t.height),y=0;for(let T=0;T<a.length;T+=4)g.data[y+T+0]=a[T+0]*h,g.data[y+T+1]=a[T+1]*h,g.data[y+T+2]=a[T+2]*h,g.data[y+T+3]=r?255:a[T+3]*h;F_.putImageData(g,0,0)}const Ql=2,NF=1e4,jp=class jp{constructor(e,i){H(this,"device");H(this,"id");H(this,"source");H(this,"vs");H(this,"fs");H(this,"pipelineFactory");H(this,"shaderFactory");H(this,"userData",{});H(this,"parameters");H(this,"topology");H(this,"bufferLayout");H(this,"isInstanced");H(this,"instanceCount",0);H(this,"vertexCount");H(this,"indexBuffer",null);H(this,"bufferAttributes",{});H(this,"constantAttributes",{});H(this,"bindings",{});H(this,"uniforms",{});H(this,"vertexArray");H(this,"transformFeedback",null);H(this,"pipeline");H(this,"shaderInputs");H(this,"_uniformStore");H(this,"_attributeInfos",{});H(this,"_gpuGeometry",null);H(this,"_getModuleUniforms");H(this,"props");H(this,"_pipelineNeedsUpdate","newly created");H(this,"_needsRedraw","initializing");H(this,"_destroyed",!1);H(this,"_lastDrawTimestamp",-1);H(this,"_lastLogTime",0);H(this,"_logOpen",!1);H(this,"_drawCount",0);var a,g,y,T;this.props={...jp.defaultProps,...i},i=this.props,this.id=i.id||hl("model"),this.device=e,Object.assign(this.userData,i.userData);const r=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(S=>[S.name,S]))||[]);this.setShaderInputs(i.shaderInputs||new OF(r));const n=LF(e),l=(((g=this.props.modules)==null?void 0:g.length)>0?this.props.modules:(y=this.shaderInputs)==null?void 0:y.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(T=this.props).shaderLayout||(T.shaderLayout=T3(this.props.source));const{source:S,getUniforms:P}=this.props.shaderAssembler.assembleShader({platformInfo:n,...this.props,modules:l});this.source=S,this._getModuleUniforms=P}else{const{vs:S,fs:P,getUniforms:M}=this.props.shaderAssembler.assembleShaderPair({platformInfo:n,...this.props,modules:l});this.vs=S,this.fs=P,this._getModuleUniforms=M}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||zm.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||Um.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniforms(i.uniforms),i.moduleSettings&&this.updateModuleSettings(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let i;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),ep(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,n=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:n,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const i=e&&RF(this.device,e);i&&(this.setTopology(i.topology||"triangle-list"),this.bufferLayout=Eb(i.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(i)),this._gpuGeometry=i}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?Eb(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Im(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new kM(this.shaderInputs.modules);for(const i of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,i){e.indices&&Je.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,n]of Object.entries(e)){const l=this.bufferLayout.find(g=>Ab(g).includes(r));if(!l){Je.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const h=Ab(l);let a=!1;for(const g of h){const y=this._attributeInfos[g];y&&(this.vertexArray.setBuffer(y.location,n),a=!0)}!a&&!((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)&&Je.warn(`Model(${this.id}): Ignoring buffer "${n.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,i){for(const[r,n]of Object.entries(e)){const l=this._attributeInfos[r];l?this.vertexArray.setConstantWebGL(l.location,n):((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)||Je.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){ep(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:i,uniforms:r}=ky(this._getModuleUniforms(e));Object.assign(this.bindings,i),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const i of Object.values(this.bindings))i instanceof tp?e=Math.max(e,i.texture.updateTimestamp):i instanceof Li||i instanceof as?e=Math.max(e,i.updateTimestamp):i instanceof rp||(e=Math.max(e,i.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const i={...e.attributes};for(const[r]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(n=>n.name===r)&&r!=="positions"&&delete i[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,i=null;this.pipeline&&(Je.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let n=null;this.source?n=r:this.fs&&(n=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:n}),this._attributeInfos=BT(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),i&&this.shaderFactory.release(i)}return this.pipeline}_logDrawCallStart(){const e=Je.level>3?0:NF;Je.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Je.group(Ql,`>>> DRAWING MODEL ${this.id}`,{collapsed:Je.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=FF(this.pipeline.shaderLayout,this.id);Je.table(Ql,e)();const i=this.shaderInputs.getDebugTable();for(const[n,l]of Object.entries(this.uniforms))i[n]={value:l};Je.table(Ql,i)();const r=this._getAttributeDebugTable();Je.table(Ql,this._attributeInfos)(),Je.table(Ql,r)(),Je.groupEnd(Ql)(),this._logOpen=!1}}_logFramebuffer(e){const i=Je.get("framebuffer");if(this._drawCount++,!i||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&DF(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[i,r]of Object.entries(this._attributeInfos))e[r.location]={name:i,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,r=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);e.indices={name:"indices",type:i.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,i){const r=VT(i);return(e instanceof Li?new r(e.debugData):e).toString()}};H(jp,"defaultProps",{...Pc.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Qf.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Rs=jp;function Eb(t,e){const i=[...t];for(const r of e){const n=i.findIndex(l=>l.name===r.name);n<0?i.push(r):i[n]=r}return i}function LF(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function Ab(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(i=>i.attribute):[t.name]}class vh{constructor(e,i=Rs.defaultProps){H(this,"device");H(this,"model");H(this,"transformFeedback");Pi(vh.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Rs(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||FR(),topology:i.topology||"point-list",...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var i;return((i=e==null?void 0:e.info)==null?void 0:i.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const i=this.device.beginRenderPass(e);this.model.draw(i),i.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const i=this.getBuffer(e);if(i instanceof Li)return i.readAsync();const{buffer:r,byteOffset:n=0,byteLength:l=r.byteLength}=i;return r.readAsync(n,l)}}class Fc{constructor(e){H(this,"id");H(this,"topology");H(this,"vertexCount");H(this,"indices");H(this,"attributes");H(this,"userData",{});const{attributes:i={},indices:r=null,vertexCount:n=null}=e;this.id=e.id||hl("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[l,h]of Object.entries(i)){const a=ArrayBuffer.isView(h)?{value:h}:h;Pi(ArrayBuffer.isView(a.value),`${this._print(l)}: must be typed array or object with value as typed array`),(l==="POSITION"||l==="positions")&&!a.size&&(a.size=3),l==="indices"?(Pi(!this.indices),this.indices=a):this.attributes[l]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=n||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,i){return this}_calculateVertexCount(e,i){if(i)return i.value.length;let r=1/0;for(const n of Object.values(e)){const{value:l,size:h,constant:a}=n;!a&&l&&h>=1&&(r=Math.min(r,l.length/h))}return Pi(Number.isFinite(r)),r}}const BF={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class PS extends Vy{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:r,viewports:n,onViewportActive:l,pickingFBO:h,deviceRect:{x:a,y:g,width:y,height:T},cullRect:S,effects:P,pass:M="picking",pickZ:B,moduleParameters:j}){this.pickZ=B;const Z=this._resetColorEncoder(B),G=[a,g,y,T],fe=super.render({target:h,layers:e,layerFilter:i,views:r,viewports:n,onViewportActive:l,cullRect:S,effects:P==null?void 0:P.filter(ue=>ue.useInPicking),pass:M,isPicking:!0,moduleParameters:j,clearColor:[0,0,0,0],colorMask:15,scissorRect:G});return this._colorEncoderState=null,{decodePickingColor:Z&&UF.bind(null,Z),stats:fe}}shouldDrawLayer(e){const{pickable:i,operation:r}=e.props;return i&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,i,r){const n={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:l,operation:h}=e.props;return!this._colorEncoderState||h.includes("terrain")?n.blend=!1:l&&h.includes("draw")&&(Object.assign(n,BF),n.blend=!0,n.blendColor=zF(this._colorEncoderState,e,r)),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function zF(t,e,i){const{byLayer:r,byAlpha:n}=t;let l,h=r.get(e);return h?(h.viewports.push(i),l=h.a):(l=r.size+1,l<=255?(h={a:l,layer:e,viewports:[i]},r.set(e,h),n[l]=h):(Wt.warn("Too many pickable layers, only picking the first 255")(),l=0)),[0,0,0,l/255]}function UF(t,e){const i=t.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const sc={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},hp=Symbol.for("component"),fa=Symbol.for("propTypes"),D_=Symbol.for("deprecatedProps"),Tc=Symbol.for("asyncPropDefaults"),nl=Symbol.for("asyncPropOriginal"),oa=Symbol.for("asyncPropResolved");function Yp(t,e=()=>!0){return Array.isArray(t)?IS(t,e,[]):e(t)?[t]:[]}function IS(t,e,i){let r=-1;for(;++r<t.length;){const n=t[r];Array.isArray(n)?IS(n,e,i):e(n)&&i.push(n)}return i}function VF({target:t,source:e,start:i=0,count:r=1}){const n=e.length,l=r*n;let h=0;for(let a=i;h<n;h++)t[a++]=e[h];for(;h<l;)h<l-h?(t.copyWithin(i+h,i,i+h),h*=2):(t.copyWithin(i+h,i,i+l-h),h=l);return t}class $F{constructor(e,i,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const r=++this._loadCount;let n=e;typeof e=="string"&&(n=Gf(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(l=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=l)}).catch(l=>{this._loadCount===r&&(this.isLoaded=!0,this._error=l||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const l of this._subscribers)l.onChange(this.getData())}}class jF{constructor(e){var i;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(i=e.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:r=!1,persistent:n=!0}){let l=this._resources[e];l?l.setData(i,r):(l=new $F(e,i,this._context),this._resources[e]=l),l.persistent=n}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const r in i){const n=i[r],l=this._resources[n.resourceId];l&&l.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:r,requestId:n="default"}){const{_resources:l,protocol:h}=this;e.startsWith(h)&&(e=e.replace(h,""),l[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=l[e];if(this._track(r,n,a,i),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,r,n){const l=this._consumers,h=l[e]=l[e]||{};let a=h[i];const g=a&&a.resourceId&&this._resources[a.resourceId];g&&(g.unsubscribe(a),this.prune()),r&&(a?(a.onChange=n,a.resourceId=r.id):a={onChange:n,resourceId:r.id},h[i]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const WF="layerManager.setLayers",HF="layerManager.activateViewport";class qF{constructor(e,i){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Gr(HF,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:n,viewport:l,timeline:h}=i||{};this.layers=[],this.resourceManager=new jF({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:eF(),defaultShaderModules:[],renderPass:void 0,stats:n||new Nh({id:"deck.gl"}),viewport:l||new $y({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:h||new AS,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const n=r.getNeedsRedraw(e);i=i||n}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(r=>i.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){Gr(WF,this,i,e),this._lastRenderedLayers=e;const r=Yp(e,Boolean);for(const n of r)n.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:i}=this.context;i.find(r=>r.name===e.name)||(i.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:i}=this.context,r=i.findIndex(n=>n.name===e.name);r>=0&&(i.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,i,r){r.raiseError(i,`${e} of ${r}`)}_updateLayers(e,i){const r={};for(const h of e)r[h.id]?Wt.warn(`Multiple old layers with same id ${h.id}`)():r[h.id]=h;if(this._defaultShaderModulesChanged){for(const h of e)h.setNeedsUpdate(),h.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const n=[];this._updateSublayersRecursively(i,r,n),this._finalizeOldLayers(r);let l=!1;for(const h of n)if(h.hasUniformTransition()){l=`Uniform transition in ${h}`;break}this._needsUpdate=l,this.layers=n}_updateSublayersRecursively(e,i,r){for(const n of e){n.context=this.context;const l=i[n.id];l===null&&Wt.warn(`Multiple new layers with same id ${n.id}`)(),i[n.id]=null;let h=null;try{this._debug&&l!==n&&n.validateProps(),l?(this._transferLayerState(l,n),this._updateLayer(n)):this._initializeLayer(n),r.push(n),h=n.isComposite?n.getSubLayers():null}catch(a){this._handleError("matching",a,n)}h&&this._updateSublayersRecursively(h,i,r)}}_finalizeOldLayers(e){for(const i in e){const r=e[i];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=sc.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=sc.MATCHED,i!==e&&(e.lifecycle=sc.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=sc.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=sc.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function qn(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!qn(t[r],e[r],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const l of r)if(!e.hasOwnProperty(l)||!qn(t[l],e[l],i-1))return!1;return!0}return!1}class XF{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,r=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,i){const r=this.getViewports(),n={x:e[0],y:e[1]};for(let l=r.length-1;l>=0;--l){const h=r[l];if(h.containsPixel(n)){const a=e.slice();return a[0]-=h.x,a[1]-=h.y,h.unproject(a,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Yp(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!qn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Wt.warn("missing `viewState` or `initialViewState`")()}_createController(e,i){const r=i.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:l=>{var h;return(h=this.getView(e.id))==null?void 0:h.makeViewport({viewState:l,width:this.width,height:this.height})}})}_updateController(e,i,r,n){const l=e.controller;if(l&&r){const h={...i,...l,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!n||n.constructor!==l.type)&&(n=this._createController(e,h)),n&&n.setProps(h),n}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let n=e.length;n--;){const l=e[n],h=this.getViewState(l),a=l.makeViewport({viewState:h,width:this.width,height:this.height});let g=i[l.id];const y=!!l.controller;y&&!g&&(r=!0),(r||!y)&&g&&(g.finalize(),g=null),this.controllers[l.id]=this._updateController(l,h,a,g),a&&this._viewports.unshift(a)}for(const n in i){const l=i[n];l&&!this.controllers[n]&&l.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((r,n)=>!e[n].equals(i[n]))}}const ZF=/([0-9]+\.?[0-9]*)(%|px)/;function Yo(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=ZF.exec(t);if(e&&e.length>=3){const i=e[2]==="%",r=parseFloat(e[1]);return{position:i?r/100:r,relative:i}}default:throw new Error(`Could not parse position string ${t}`)}}function Ko(t,e){return t.relative?Math.round(t.position*e):t.position}class YF{constructor(e){const{id:i,x:r=0,y:n=0,width:l="100%",height:h="100%",padding:a=null}=e;this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Yo(r),this._y=Yo(n),this._width=Yo(l),this._height=Yo(h),this._padding=a&&{left:Yo(a.left||0),right:Yo(a.right||0),top:Yo(a.top||0),bottom:Yo(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&qn(this.props,e.props,2)}makeViewport({width:e,height:i,viewState:r}){r=this.filterViewState(r);const n=this.getDimensions({width:e,height:i});return!n.height||!n.width?null:new this.ViewportType({...r,...this.props,...n})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const r in this.props.viewState)r!=="id"&&(i[r]=this.props.viewState[r]);return i}return e}getDimensions({width:e,height:i}){const r={x:Ko(this._x,e),y:Ko(this._y,i),width:Ko(this._width,e),height:Ko(this._height,i)};return this._padding&&(r.padding={left:Ko(this._padding.left,e),top:Ko(this._padding.top,i),right:Ko(this._padding.right,e),bottom:Ko(this._padding.bottom,i)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Kp{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var i,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(i=this.settings).onStart)==null||r.call(i,this)}end(){var e,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(e=this.settings).onEnd)==null||i.call(e,this))}cancel(){var e,i;this._inProgress&&((i=(e=this.settings).onInterrupt)==null||i.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:n}=this;this._handle=r.addChannel({delay:r.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(e=this.settings).onUpdate)==null||i.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Pb=()=>{},Vm={BREAK:1,SNAP_TO_END:2,IGNORE:3},KF=t=>t,GF=Vm.BREAK;class JF{constructor(e){this._onTransitionUpdate=i=>{const{time:r,settings:{interpolator:n,startProps:l,endProps:h,duration:a,easing:g}}=i,y=g(r/a),T=n.interpolateProps(l,h,y);this.propsInTransition=this.getControllerState({...this.props,...T}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Kp(e.timeline),this.onViewStateChange=e.onViewStateChange||Pb,this.onStateChange=e.onStateChange||Pb}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let n=r;if(this.transition.inProgress){const{interruption:l,endProps:h}=this.transition.settings;n={...r,...l===Vm.SNAP_TO_END?h:this.propsInTransition||r}}this._triggerTransition(n,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:r}=e;return(i>0||i==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===Vm.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const r=this.getControllerState(e),n=this.getControllerState(i).shortestPathFrom(r),l=i.transitionInterpolator,h=l.getDuration?l.getDuration(e,i):i.transitionDuration;if(h===0)return;const a=l.initializeProps(e,n);this.propsInTransition={};const g={duration:h,easing:i.transitionEasing||KF,interpolator:l,interruption:i.transitionInterruption||GF,startProps:a.start,endProps:a.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(g),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(i)}}}function Fr(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class QF{constructor(e){const{compare:i,extract:r,required:n}=e;this._propsToCompare=i,this._propsToExtract=r||i,this._requiredProps=n}arePropsEqual(e,i){for(const r of this._propsToCompare)if(!(r in e)||!(r in i)||!So(e[r],i[r]))return!1;return!0}initializeProps(e,i){const r={},n={};for(const l of this._propsToExtract)(l in e||l in i)&&(r[l]=e[l],n[l]=i[l]);return this._checkRequiredProps(r),this._checkRequiredProps(n),{start:r,end:n}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(i=>{const r=e[i];Fr(Number.isFinite(r)||Array.isArray(r),`${i} is required for transition`)})}}const eD=["longitude","latitude","zoom","bearing","pitch"],tD=["longitude","latitude","zoom"];class CS extends QF{constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:eD,required:tD},super(r.transitionProps),this.opts=r}initializeProps(e,i){const r=super.initializeProps(e,i),{makeViewport:n,around:l}=this.opts;if(n&&l){const h=n(e),a=n(i),g=h.unproject(l);r.start.around=l,Object.assign(r.end,{around:a.project(g),aroundPosition:g,width:i.width,height:i.height})}return r}interpolateProps(e,i,r){const n={};for(const l of this._propsToExtract)n[l]=Cc(e[l]||0,i[l]||0,r);if(i.aroundPosition&&this.opts.makeViewport){const l=this.opts.makeViewport({...i,...n});Object.assign(n,l.panByPosition(i.aroundPosition,Cc(e.around,i.around,r)))}return n}}const Go={transitionDuration:0},iD=300,uf=t=>1-(1-t)*(1-t),ec={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ja={};class rD{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new JF({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const i in this._events)this._events[i]&&((e=this.eventManager)==null||e.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return i?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:r}=this.props,{offsetCenter:n}=e;return[n.x-i,n.y-r]}isPointInBounds(e,i){const{width:r,height:n}=this.props;if(i&&i.handled)return!1;const l=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=n;return l&&i&&i.stopPropagation(),l}isFunctionKeyPressed(e){const{srcEvent:i}=e;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?iD:0;const{scrollZoom:r=!0,dragPan:n=!0,dragRotate:l=!0,doubleClickZoom:h=!0,touchZoom:a=!0,touchRotate:g=!1,keyboard:y=!0}=e,T=!!this.onViewStateChange;this.toggleEvents(ec.WHEEL,T&&r),this.toggleEvents(ec.PAN,T),this.toggleEvents(ec.PINCH,T&&(a||g)),this.toggleEvents(ec.TRIPLE_PAN,T&&g),this.toggleEvents(ec.DOUBLE_TAP,T&&h),this.toggleEvents(ec.KEYBOARD,T&&y),this.scrollZoom=r,this.dragPan=n,this.dragRotate=l,this.doubleClickZoom=h,this.touchZoom=a,this.touchRotate=g,this.keyboard=y}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(r=>{this._events[r]!==i&&(this._events[r]=i,i?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,i=null,r={}){const n={...e.getViewportProps(),...i},l=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),l){const h=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:h,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const n=this.controllerState[r?"panStart":"rotateStart"]({pos:i});return this._panMove=r,this.updateViewport(n,Go,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),r=this.controllerState.pan({pos:i});return this.updateViewport(r,Go,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const r=this.getCenter(e),n=[r[0]+e.velocityX*i/2,r[1]+e.velocityY*i/2],l=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:uf},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),r=this.controllerState.rotate({pos:i});return this.updateViewport(r,Go,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const r=this.getCenter(e),n=[r[0]+e.velocityX*i/2,r[1]+e.velocityY*i/2],l=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:uf},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:l}=e;let h=2/(1+Math.exp(-Math.abs(l*r)));l<0&&h!==0&&(h=1/h);const a=this.controllerState.zoom({pos:i,scale:h});return this.updateViewport(a,{...this._getTransitionProps({around:i}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.controllerState.rotateStart({pos:i});return this.updateViewport(r,Go,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const r=this.controllerState.rotate({pos:i});return this.updateViewport(r,Go,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const r=this.getCenter(e),n=[r[0],r[1]+=e.velocityY*i/2],l=this.controllerState.rotate({pos:n});this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:uf},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return ja._startPinchRotation=e.rotation,ja._lastPinchEvent=e,this.updateViewport(r,Go,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:r}=e,n=this.getCenter(e);i=i.zoom({pos:n,scale:r})}if(this.touchRotate){const{rotation:r}=e;i=i.rotate({deltaAngleX:ja._startPinchRotation-r})}return this.updateViewport(i,Go,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ja._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:r}=ja;if(this.touchZoom&&i&&r&&e.scale!==r.scale){const n=this.getCenter(e);let l=this.controllerState.rotateEnd();const h=Math.log2(e.scale),a=(h-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),g=Math.pow(2,h+a*i/2);l=l.zoom({pos:n,scale:g}).zoomEnd(),this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:i,transitionEasing:uf},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ja._startPinchRotation=null,ja._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:i,scale:r?.5:2});return this.updateViewport(n,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:n,rotateSpeedX:l,rotateSpeedY:h}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let g;const y={};switch(e.srcEvent.code){case"Minus":g=i?a.zoomOut(r).zoomOut(r):a.zoomOut(r),y.isZooming=!0;break;case"Equal":g=i?a.zoomIn(r).zoomIn(r):a.zoomIn(r),y.isZooming=!0;break;case"ArrowLeft":i?(g=a.rotateLeft(l),y.isRotating=!0):(g=a.moveLeft(n),y.isPanning=!0);break;case"ArrowRight":i?(g=a.rotateRight(l),y.isRotating=!0):(g=a.moveRight(n),y.isPanning=!0);break;case"ArrowUp":i?(g=a.rotateUp(h),y.isRotating=!0):(g=a.moveUp(n),y.isPanning=!0);break;case"ArrowDown":i?(g=a.rotateDown(h),y.isRotating=!0):(g=a.moveDown(n),y.isPanning=!0);break;default:return!1}return this.updateViewport(g,this._getTransitionProps(),y),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?Go:e?{...i,transitionInterpolator:new CS({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class nD{constructor(e,i){this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Ib=5,sD=1.2;class oD extends nD{constructor(e){const{width:i,height:r,latitude:n,longitude:l,zoom:h,bearing:a=0,pitch:g=0,altitude:y=1.5,position:T=[0,0,0],maxZoom:S=20,minZoom:P=0,maxPitch:M=60,minPitch:B=0,startPanLngLat:j,startZoomLngLat:Z,startRotatePos:G,startBearing:fe,startPitch:re,startZoom:ue,normalize:Me=!0}=e;Fr(Number.isFinite(l)),Fr(Number.isFinite(n)),Fr(Number.isFinite(h)),super({width:i,height:r,latitude:n,longitude:l,zoom:h,bearing:a,pitch:g,altitude:y,maxZoom:S,minZoom:P,maxPitch:M,minPitch:B,normalize:Me,position:T},{startPanLngLat:j,startZoomLngLat:Z,startRotatePos:G,startBearing:fe,startPitch:re,startZoom:ue}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const r=this.getState().startPanLngLat||this._unproject(i);if(!r)return this;const l=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(l)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:r=0}){const{startRotatePos:n,startBearing:l,startPitch:h}=this.getState();if(!n||l===void 0||h===void 0)return this;let a;return e?a=this._getNewRotation(e,n,h,l):a={bearing:l+i,pitch:h+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:r}){let{startZoom:n,startZoomLngLat:l}=this.getState();if(l||(n=this.getViewportProps().zoom,l=this._unproject(i)||this._unproject(e)),!l)return this;const{maxZoom:h,minZoom:a}=this.getViewportProps();let g=n+Math.log2(r);g=sa(g,a,h);const y=this.makeViewport({...this.getViewportProps(),zoom:g});return this._getUpdatedState({zoom:g,...y.panByPosition(l,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),r={...this.getViewportProps()},{bearing:n,longitude:l}=r;return Math.abs(n-i.bearing)>180&&(r.bearing=n<0?n+360:n-360),Math.abs(l-i.longitude)>180&&(r.longitude=l<0?l+360:l-360),r}applyConstraints(e){const{maxZoom:i,minZoom:r,zoom:n}=e;e.zoom=sa(n,r,i);const{maxPitch:l,minPitch:h,pitch:a}=e;e.pitch=sa(a,h,l);const{normalize:g=!0}=e;return g&&Object.assign(e,VO(e)),e}_zoomFromCenter(e){const{width:i,height:r}=this.getViewportProps();return this.zoom({pos:[i/2,r/2],scale:e})}_panFromCenter(e){const{width:i,height:r}=this.getViewportProps();return this.pan({startPos:[i/2,r/2],pos:[i/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,r,n){const l=e[0]-i[0],h=e[1]-i[1],a=e[1],g=i[1],{width:y,height:T}=this.getViewportProps(),S=l/y;let P=0;h>0?Math.abs(T-g)>Ib&&(P=h/(g-T)*sD):h<0&&g>Ib&&(P=1-a/g),P=sa(P,-1,1);const{minPitch:M,maxPitch:B}=this.getViewportProps(),j=n+180*S;let Z=r;return P>0?Z=r+P*(B-r):P<0&&(Z=r-P*(M-r)),{pitch:Z,bearing:j}}}class aD extends rD{constructor(){super(...arguments),this.ControllerState=oD,this.transition={transitionDuration:300,transitionInterpolator:new CS({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class RS extends YF{constructor(e={}){super(e)}get ViewportType(){return xh}get ControllerType(){return aD}}RS.displayName="MapView";const lD=RS,cD=new SS;function uD(t,e){const i=t.order??1/0,r=e.order??1/0;return i-r}class hD{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const i=this._defaultEffects;if(!i.find(r=>r.id===e.id)){const r=i.findIndex(n=>uD(n,e)>0);r<0?i.push(e):i.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(qn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(e){const i={};for(const n of this.effects)i[n.id]=n;const r=[];for(const n of e){const l=i[n.id];let h=n;l&&l!==n?l.setProps?(l.setProps(n.props),h=l):l.cleanup(this._context):l||n.setup(this._context),r.push(h),delete i[n.id]}for(const n in i)i[n].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(n=>n instanceof SS)||this._resolvedEffects.push(cD),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class dD extends Vy{shouldDrawLayer(e){const{operation:i}=e.props;return i.includes("draw")||i.includes("terrain")}}const fD="deckRenderer.renderLayers";class pD{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new dD(e),this.pickLayersPass=new PS(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const n=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const l=i.render({...r,target:n});r.effects&&this._postRender(r.effects,r),this.renderCount++,Gr(fD,this,l,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const r of e)i.preRenderStats[r.id]=r.preRender(i),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,i=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[n]}))});for(const r of e)r.resize(i)}_postRender(e,i){const{renderBuffers:r}=this,n={...i,inputBuffer:r[0],swapBuffer:r[1]};for(const l of e)if(l.postRender){n.target=l.id===this.lastPostProcessEffect?i.target:void 0;const h=l.postRender(n);n.inputBuffer=h,n.swapBuffer=h===r[0]?r[1]:r[0]}}}const gD={pickedColor:null,pickedObjectIndex:-1};function _D({pickedColors:t,decodePickingColor:e,deviceX:i,deviceY:r,deviceRadius:n,deviceRect:l}){const{x:h,y:a,width:g,height:y}=l;let T=n*n,S=-1,P=0;for(let M=0;M<y;M++){const B=M+a-r,j=B*B;if(j>T)P+=4*g;else for(let Z=0;Z<g;Z++){if(t[P+3]-1>=0){const fe=Z+h-i,re=fe*fe+j;re<=T&&(T=re,S=P)}P+=4}}if(S>=0){const M=t.slice(S,S+4),B=e(M);if(B){const j=Math.floor(S/4/g),Z=S/4-j*g;return{...B,pickedColor:M,pickedX:h+Z,pickedY:a+j}}Wt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return gD}function mD({pickedColors:t,decodePickingColor:e}){const i=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const l=t.slice(r,r+4),h=l.join(",");if(!i.has(h)){const a=e(l);a?i.set(h,{...a,color:l}):Wt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function MS({pickInfo:t,viewports:e,pixelRatio:i,x:r,y:n,z:l}){let h=e[0];e.length>1&&(h=xD((t==null?void 0:t.pickedViewports)||e,{x:r,y:n}));let a;if(h){const g=[r-h.x,n-h.y];l!==void 0&&(g[2]=l),a=h.unproject(g)}return{color:null,layer:null,viewport:h,index:-1,picked:!1,x:r,y:n,pixel:[r,n],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function yD(t){const{pickInfo:e,lastPickedInfo:i,mode:r,layers:n}=t,{pickedColor:l,pickedLayer:h,pickedObjectIndex:a}=e,g=h?[h]:[];if(r==="hover"){const S=i.index,P=i.layerId,M=h?h.props.id:null;if(M!==P||a!==S){if(M!==P){const B=n.find(j=>j.props.id===P);B&&g.unshift(B)}i.layerId=M,i.index=a,i.info=null}}const y=MS(t),T=new Map;return T.set(null,y),g.forEach(S=>{let P={...y};S===h&&(P.color=l,P.index=a,P.picked=!0),P=kS({layer:S,info:P,mode:r});const M=P.layer;S===h&&r==="hover"&&(i.info=P),T.set(M.id,P),r==="hover"&&M.updateAutoHighlight(P)}),T}function kS({layer:t,info:e,mode:i}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:r}),t=t.parent}return e}function xD(t,e){for(let i=t.length-1;i>=0;i--){const r=t[i];if(r.containsPixel(e))return r}return t[0]}class vD{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new PS(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:r,viewports:n},l=this.lastPickedInfo.info){const h=l&&l.layer&&l.layer.id,a=l&&l.viewport&&l.viewport.id,g=h?r.find(P=>P.id===h):null,y=a&&n.find(P=>P.id===a)||n[0],T=y&&y.unproject([e-y.x,i-y.y]);return{...l,...{x:e,y:i,viewport:y,coordinate:T,layer:g}}}_resizeBuffer(){var i,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const n=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=n}const{canvas:e}=this.device.getCanvasContext();(i=this.pickingFBO)==null||i.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:r,x:n,y:l,radius:h=0,depth:a=1,mode:g="query",unproject3D:y,onViewportActive:T,effects:S}){const P=this.device.canvasContext.cssToDeviceRatio(),M=this._getPickable(e);if(!M||r.length===0)return{result:[],emptyInfo:MS({viewports:r,x:n,y:l,pixelRatio:P})};this._resizeBuffer();const B=this.device.canvasContext.cssToDevicePixels([n,l],!0),j=[B.x+Math.floor(B.width/2),B.y+Math.floor(B.height/2)],Z=Math.round(h*P),{width:G,height:fe}=this.pickingFBO,re=this._getPickingRect({deviceX:j[0],deviceY:j[1],deviceRadius:Z,deviceWidth:G,deviceHeight:fe}),ue={x:n-h,y:l-h,width:h*2+1,height:h*2+1};let Me;const Oe=[],$e=new Set;for(let ke=0;ke<a;ke++){let je;if(re){const ct=this._drawAndSample({layers:M,views:i,viewports:r,onViewportActive:T,deviceRect:re,cullRect:ue,effects:S,pass:`picking:${g}`});je=_D({...ct,deviceX:j[0],deviceY:j[1],deviceRadius:Z,deviceRect:re})}else je={pickedColor:null,pickedObjectIndex:-1};let Ue;if(je.pickedLayer&&y&&this.depthFBO){const{pickedColors:ct}=this._drawAndSample({layers:[je.pickedLayer],views:i,viewports:r,onViewportActive:T,deviceRect:{x:je.pickedX,y:je.pickedY,width:1,height:1},cullRect:ue,effects:S,pass:`picking:${g}:z`},!0);ct[3]&&(Ue=ct[0])}je.pickedLayer&&ke+1<a&&($e.add(je.pickedLayer),je.pickedLayer.disablePickingIndex(je.pickedObjectIndex)),Me=yD({pickInfo:je,lastPickedInfo:this.lastPickedInfo,mode:g,layers:M,viewports:r,x:n,y:l,z:Ue,pixelRatio:P});for(const ct of Me.values())ct.layer&&Oe.push(ct);if(!je.pickedColor)break}for(const ke of $e)ke.restorePickingColors();return{result:Oe,emptyInfo:Me.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:r,x:n,y:l,width:h=1,height:a=1,mode:g="query",maxObjects:y=null,onViewportActive:T,effects:S}){const P=this._getPickable(e);if(!P||r.length===0)return[];this._resizeBuffer();const M=this.device.canvasContext.cssToDeviceRatio(),B=this.device.canvasContext.cssToDevicePixels([n,l],!0),j=B.x,Z=B.y+B.height,G=this.device.canvasContext.cssToDevicePixels([n+h,l+a],!0),fe=G.x+G.width,re=G.y,ue={x:j,y:re,width:fe-j,height:Z-re},Me=this._drawAndSample({layers:P,views:i,viewports:r,onViewportActive:T,deviceRect:ue,cullRect:{x:n,y:l,width:h,height:a},effects:S,pass:`picking:${g}`}),Oe=mD(Me),$e=new Map,ke=[],je=Number.isFinite(y);for(let Ue=0;Ue<Oe.length&&!(je&&ke.length>=y);Ue++){const ct=Oe[Ue];let tt={color:ct.pickedColor,layer:null,index:ct.pickedObjectIndex,picked:!0,x:n,y:l,pixelRatio:M};tt=kS({layer:ct.pickedLayer,info:tt,mode:g});const pt=tt.layer.id;$e.has(pt)||$e.set(pt,new Set);const ot=$e.get(pt),ei=tt.object??tt.index;ot.has(ei)||(ot.add(ei),ke.push(tt))}return ke}_drawAndSample({layers:e,views:i,viewports:r,onViewportActive:n,deviceRect:l,cullRect:h,effects:a,pass:g},y=!1){const T=y?this.depthFBO:this.pickingFBO,S={layers:e,layerFilter:this.layerFilter,views:i,viewports:r,onViewportActive:n,pickingFBO:T,deviceRect:l,cullRect:h,effects:a,pass:g,pickZ:y,preRenderStats:{}};for(const fe of a)fe.useInPicking&&(S.preRenderStats[fe.id]=fe.preRender(S));const{decodePickingColor:P}=this.pickLayersPass.render(S),{x:M,y:B,width:j,height:Z}=l,G=new(y?Float32Array:Uint8Array)(j*Z*4);return this.device.readPixelsToArrayWebGL(T,{sourceX:M,sourceY:B,sourceWidth:j,sourceHeight:Z,target:G}),{pickedColors:G,decodePickingColor:P}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:r,deviceWidth:n,deviceHeight:l}){const h=Math.max(0,e-r),a=Math.max(0,i-r),g=Math.min(n,e+r+1)-h,y=Math.min(l,i+r+1)-a;return g<=0||y<=0?null:{x:h,y:a,width:g,height:y}}}const bD={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},wD="top-left",Cb="__root";class TD{constructor({deck:e,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!qn(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(i=>i.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const i={};for(const r of this.resolvedWidgets)i[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)i[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const n=i[r.id];n?n.viewId!==r.viewId||n.placement!==r.placement?(this._remove(n),this._add(r)):r!==n&&(n.setProps(r.props),r=n):this._add(r),i[r.id]=null,this.resolvedWidgets.push(r)}for(const r in i){const n=i[r];n&&this._remove(n)}this.widgets=e}_add(e){const{viewId:i=null,placement:r=wD}=e,n=e.onAdd({deck:this.deck,viewId:i});n&&this._getContainer(i,r).append(n),e._element=n}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,i){var h;const r=e||Cb;let n=this.containers[r];n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",(h=this.parentElement)==null||h.append(n),this.containers[r]=n);let l=n.querySelector(`.${i}`);return l||(l=document.createElement("div"),l.className=i,l.style.position="absolute",l.style.zIndex="2",Object.assign(l.style,bD[i]),n.append(l)),l}_updateContainers(){const e=this.deck.width,i=this.deck.height;for(const r in this.containers){const n=this.lastViewports[r]||null,l=r===Cb||n,h=this.containers[r];l?(h.style.display="block",h.style.left=`${n?n.x:0}px`,h.style.top=`${n?n.y:0}px`,h.style.width=`${n?n.width:e}px`,h.style.height=`${n?n.height:i}px`):h.style.display="none"}}onRedraw({viewports:e,layers:i}){var l,h;const r=e.reduce((a,g)=>(a[g.id]=g,a),{}),{lastViewports:n}=this;for(const a of this.getWidgets()){const{viewId:g}=a;if(g){const y=r[g];y&&(a.onViewportChange&&!y.equals(n[g])&&a.onViewportChange(y),(l=a.onRedraw)==null||l.call(a,{viewports:[y],layers:i}))}else{if(a.onViewportChange)for(const y of e)y.equals(n[y.id])||a.onViewportChange(y);(h=a.onRedraw)==null||h.call(a,{viewports:e,layers:i})}}this.lastViewports=r,this._updateContainers()}onHover(e,i){var r,n;for(const l of this.getWidgets()){const{viewId:h}=l;(!h||h===((r=e.viewport)==null?void 0:r.id))&&((n=l.onHover)==null||n.call(l,e,i))}}onEvent(e,i){var n,l;const r=Dm[i.type];if(r)for(const h of this.getWidgets()){const{viewId:a}=h;(!a||a===((n=e.viewport)==null?void 0:n.id))&&((l=h[r.handler])==null||l.call(h,e,i))}}}const SD={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class ED{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,SD),this.deck=e,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var i;this.isVisible&&e.id===((i=this.lastViewport)==null?void 0:i.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:i}=this,r=i&&i.props.getTooltip;if(!r)return;const n=r(e);this.lastViewport=e.viewport,this.setTooltip(n,e.x,e.y)}setTooltip(e,i,r){const n=this.element;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform=`translate(${i}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}}var ac;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(ac||(ac={}));const jy={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ar=(t,e,i)=>e?t.enable(i):t.disable(i),Rb=(t,e,i)=>t.hint(i,e),Hn=(t,e,i)=>t.pixelStorei(i,e),Mb=(t,e,i)=>{const r=i===36006?36009:36008;return t.bindFramebuffer(r,e)},ju=(t,e,i)=>{const n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];t.bindBuffer(n,e)};function N_(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const AD={3042:ar,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:ar,2885:(t,e)=>t.cullFace(e),2929:ar,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:ar,35723:Rb,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var i;return(i=t.bindTransformFeedback)==null?void 0:i.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:Mb,36010:Mb,34964:ju,36662:ju,36663:ju,35053:ju,35055:ju,2886:(t,e)=>t.frontFace(e),33170:Rb,2849:(t,e)=>t.lineWidth(e),32823:ar,32824:"polygonOffset",10752:"polygonOffset",35977:ar,32926:ar,32928:ar,32938:"sampleCoverage",32939:"sampleCoverage",3089:ar,3088:(t,e)=>t.scissor(...e),2960:ar,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:ar,10754:ar,12288:ar,12289:ar,12290:ar,12291:ar,12292:ar,12293:ar,12294:ar,12295:ar,3333:Hn,3317:Hn,37440:Hn,37441:Hn,37443:Hn,3330:Hn,3332:Hn,3331:Hn,3314:Hn,32878:Hn,3316:Hn,3315:Hn,32877:Hn,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const i=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...i)},blendFunc:(t,e)=>{const i=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...i)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=N_(e)?e:[e,e];const[i,r]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=N_(e)&&e.length===3?[...e,...e]:e;const[i,r,n,l,h,a]=e;t.stencilFuncSeparate(1028,i,r,n),t.stencilFuncSeparate(1029,l,h,a)},stencilOp:(t,e)=>{e=N_(e)&&e.length===3?[...e,...e]:e;const[i,r,n,l,h,a]=e;t.stencilOpSeparate(1028,i,r,n),t.stencilOpSeparate(1029,l,h,a)},viewport:(t,e)=>t.viewport(...e)};function Xi(t,e,i){return e[t]!==void 0?e[t]:i[t]}const PD={blendEquation:(t,e,i)=>t.blendEquationSeparate(Xi(32777,e,i),Xi(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate(Xi(32969,e,i),Xi(32968,e,i),Xi(32971,e,i),Xi(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset(Xi(32824,e,i),Xi(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage(Xi(32938,e,i),Xi(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,Xi(2962,e,i),Xi(2967,e,i),Xi(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,Xi(34816,e,i),Xi(36003,e,i),Xi(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,Xi(2964,e,i),Xi(2965,e,i),Xi(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,Xi(34817,e,i),Xi(34818,e,i),Xi(34819,e,i))},kb={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,i)=>t({36007:i}),bindTransformFeedback:(t,e,i)=>t({36389:i}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({36006:i,36010:i});case 36009:return t({36006:i});case 36008:return t({36010:i});default:return null}},bindBuffer:(t,e,i)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:i}):{valueChanged:!0}},blendColor:(t,e,i,r,n)=>t({32773:new Float32Array([e,i,r,n])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,i)=>t({32777:e,34877:i}),blendFunc:(t,e,i)=>t({32969:e,32968:i,32971:e,32970:i}),blendFuncSeparate:(t,e,i,r,n)=>t({32969:e,32968:i,32971:r,32970:n}),clearColor:(t,e,i,r,n)=>t({3106:new Float32Array([e,i,r,n])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,i,r,n)=>t({3107:[e,i,r,n]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,i)=>t({2928:new Float32Array([e,i])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,i)=>t({32824:e,10752:i}),sampleCoverage:(t,e,i)=>t({32938:e,32939:i}),scissor:(t,e,i,r,n)=>t({3088:new Int32Array([e,i,r,n])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,i)=>t({[e===1028?2968:36005]:i}),stencilFunc:(t,e,i,r)=>t({2962:e,2967:i,2963:r,34816:e,36003:i,36004:r}),stencilFuncSeparate:(t,e,i,r,n)=>t({[e===1028?2962:34816]:i,[e===1028?2967:36003]:r,[e===1028?2963:36004]:n}),stencilOp:(t,e,i,r)=>t({2964:e,2965:i,2966:r,34817:e,34818:i,34819:r}),stencilOpSeparate:(t,e,i,r,n)=>t({[e===1028?2964:34817]:i,[e===1028?2965:34818]:r,[e===1028?2966:34819]:n}),viewport:(t,e,i,r,n)=>t({2978:[e,i,r,n]})},js=(t,e)=>t.isEnabled(e),Ob={3042:js,2884:js,2929:js,3024:js,32823:js,32926:js,32928:js,3089:js,2960:js,35977:js},ID=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Nc(t,e){if(RD(e))return;const i={};for(const n in e){const l=Number(n),h=AD[n];h&&(typeof h=="string"?i[h]=!0:h(t,e[n],l))}const r=t.state&&t.state.cache;if(r)for(const n in i){const l=PD[n];l(t,e,r)}}function OS(t,e=jy){if(typeof e=="number"){const n=e,l=Ob[n];return l?l(t,n):t.getParameter(n)}const i=Array.isArray(e)?e:Object.keys(e),r={};for(const n of i){const l=Ob[n];r[n]=l?l(t,Number(n)):t.getParameter(Number(n))}return r}function CD(t){Nc(t,jy)}function RD(t){for(const e in t)return!1;return!0}function MD(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&r&&t.length===e.length){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}class kD{constructor(e,{copyState:i=!1,log:r=()=>{}}={}){H(this,"gl");H(this,"program",null);H(this,"stateStack",[]);H(this,"enable",!0);H(this,"cache");H(this,"log");this.gl=e,this.cache=i?OS(e):Object.assign({},jy),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){Pi(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Nc(this.gl,e),this.stateStack.pop()}_updateCache(e){let i=!1,r;const n=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const l in e){Pi(l!==void 0);const h=e[l],a=this.cache[l];MD(h,a)||(i=!0,r=a,n&&!(l in n)&&(n[l]=a),this.cache[l]=h)}return{valueChanged:i,oldValue:r}}}function sl(t){return t.state}function FS(t,e){const{enable:i=!0,copyState:r}=e;if(Pi(r!==void 0),!t.state){t.state=new kD(t,{copyState:r}),FD(t);for(const l in kb){const h=kb[l];OD(t,l,h)}Fb(t,"getParameter"),Fb(t,"isEnabled")}const n=sl(t);return n.enable=i,t}function Gp(t){let e=sl(t);e||(FS(t,{copyState:!1}),e=sl(t)),e.push()}function bh(t){const e=sl(t);Pi(e),e.pop()}function Fb(t,e){const i=t[e].bind(t);t[e]=function(n){if(n===void 0||ID.has(n))return i(n);const l=sl(t);return n in l.cache||(l.cache[n]=i(n)),l.enable?l.cache[n]:i(n)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function OD(t,e,i){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...l){const h=sl(t),{valueChanged:a,oldValue:g}=i(h._updateCache,...l);return a&&r(...l),g},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function FD(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const n=sl(t);n.program!==r&&(e(r),n.program=r)}}const DD={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function ND(t,e){e={...DD,...e};let i=null;const r=l=>i=l.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);let n=null;if(n||(n=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",r,!1),!n)throw new Error(`Failed to create WebGL context: ${i||"Unknown error"}`);if(e.onContextLost){const{onContextLost:l}=e;t.addEventListener("webglcontextlost",h=>l(h),!1)}if(e.onContextRestored){const{onContextRestored:l}=e;t.addEventListener("webglcontextrestored",h=>l(h),!1)}return n}function ma(t,e,i){return i[e]===void 0&&(i[e]=t.getExtension(e)||null),i[e]}function LD(t,e){const i=t.getParameter(7936),r=t.getParameter(7937);ma(t,"WEBGL_debug_renderer_info",e);const n=e.WEBGL_debug_renderer_info,l=t.getParameter(n?n.UNMASKED_VENDOR_WEBGL:7936),h=t.getParameter(n?n.UNMASKED_RENDERER_WEBGL:7937),a=l||i,g=h||r,y=t.getParameter(7938),T=DS(a,g),S=BD(a,g),P=zD(a,g);return{type:"webgl",gpu:T,gpuType:P,gpuBackend:S,vendor:a,renderer:g,version:y,shadingLanguage:"glsl",shadingLanguageVersion:300}}function DS(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function BD(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function zD(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(DS(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function NS(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Yr="texture-compression-bc",_i="texture-compression-astc",Ws="texture-compression-etc2",UD="texture-compression-etc1-webgl",hf="texture-compression-pvrtc-webgl",L_="texture-compression-atc-webgl",Wu="float32-renderable-webgl",B_="float16-renderable-webgl",VD="rgb9e5ufloat_renderable-webgl",z_="snorm8-renderable-webgl",Hu="norm16-renderable-webgl",U_="snorm16-renderable-webgl",df="float32-filterable",Db="float16-filterable-webgl",eh="WEBGL_compressed_texture_s3tc",th="WEBGL_compressed_texture_s3tc_srgb",lc="EXT_texture_compression_rgtc",cc="EXT_texture_compression_bptc",$D="WEBGL_compressed_texture_etc",jD="WEBGL_compressed_texture_astc",WD="WEBGL_compressed_texture_etc1",HD="WEBGL_compressed_texture_pvrtc",qD="WEBGL_compressed_texture_atc",Nb="EXT_texture_norm16",Lb="EXT_render_snorm",XD="EXT_color_buffer_float",Wy={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Lb],"norm16-renderable-webgl":[Nb],"snorm16-renderable-webgl":[Nb,Lb],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[eh,th,lc,cc],"texture-compression-bc5-webgl":[lc],"texture-compression-bc7-webgl":[cc],"texture-compression-etc2":[$D],"texture-compression-astc":[jD],"texture-compression-etc1-webgl":[WD],"texture-compression-pvrtc-webgl":[HD],"texture-compression-atc-webgl":[qD]};function ZD(t){return t in Wy}function YD(t,e,i){return(Wy[e]||[]).every(n=>ma(t,n,i))}const Jp={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:z_},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:z_},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:B_,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Hu,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:U_},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:z_},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:B_,filter:Db,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Hu},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:U_},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Wu,filter:df},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:VD},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Wu,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Hu},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Hu},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Wu,filter:df,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:B_,filter:Db},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Hu,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:U_},"rgb32float-webgl":{gl:34837,render:Wu,filter:df,gl2ext:XD,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Wu,filter:df,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:eh,f:Yr},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:th,f:Yr},"bc1-rgba-unorm":{gl:33777,x:eh,f:Yr},"bc1-rgba-unorm-srgb":{gl:35916,x:th,f:Yr},"bc2-rgba-unorm":{gl:33778,x:eh,f:Yr},"bc2-rgba-unorm-srgb":{gl:35918,x:th,f:Yr},"bc3-rgba-unorm":{gl:33779,x:eh,f:Yr},"bc3-rgba-unorm-srgb":{gl:35919,x:th,f:Yr},"bc4-r-unorm":{gl:36283,x:lc,f:Yr},"bc4-r-snorm":{gl:36284,x:lc,f:Yr},"bc5-rg-unorm":{gl:36285,x:lc,f:Yr},"bc5-rg-snorm":{gl:36286,x:lc,f:Yr},"bc6h-rgb-ufloat":{gl:36495,x:cc,f:Yr},"bc6h-rgb-float":{gl:36494,x:cc,f:Yr},"bc7-rgba-unorm":{gl:36492,x:cc,f:Yr},"bc7-rgba-unorm-srgb":{gl:36493,x:cc,f:Yr},"etc2-rgb8unorm":{gl:37492,f:Ws},"etc2-rgb8unorm-srgb":{gl:37494,f:Ws},"etc2-rgb8a1unorm":{gl:37496,f:Ws},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Ws},"etc2-rgba8unorm":{gl:37493,f:Ws},"etc2-rgba8unorm-srgb":{gl:37495,f:Ws},"eac-r11unorm":{gl:37488,f:Ws},"eac-r11snorm":{gl:37489,f:Ws},"eac-rg11unorm":{gl:37490,f:Ws},"eac-rg11snorm":{gl:37491,f:Ws},"astc-4x4-unorm":{gl:37808,f:_i},"astc-4x4-unorm-srgb":{gl:37840,f:_i},"astc-5x4-unorm":{gl:37809,f:_i},"astc-5x4-unorm-srgb":{gl:37841,f:_i},"astc-5x5-unorm":{gl:37810,f:_i},"astc-5x5-unorm-srgb":{gl:37842,f:_i},"astc-6x5-unorm":{gl:37811,f:_i},"astc-6x5-unorm-srgb":{gl:37843,f:_i},"astc-6x6-unorm":{gl:37812,f:_i},"astc-6x6-unorm-srgb":{gl:37844,f:_i},"astc-8x5-unorm":{gl:37813,f:_i},"astc-8x5-unorm-srgb":{gl:37845,f:_i},"astc-8x6-unorm":{gl:37814,f:_i},"astc-8x6-unorm-srgb":{gl:37846,f:_i},"astc-8x8-unorm":{gl:37815,f:_i},"astc-8x8-unorm-srgb":{gl:37847,f:_i},"astc-10x5-unorm":{gl:37819,f:_i},"astc-10x5-unorm-srgb":{gl:37851,f:_i},"astc-10x6-unorm":{gl:37817,f:_i},"astc-10x6-unorm-srgb":{gl:37849,f:_i},"astc-10x8-unorm":{gl:37818,f:_i},"astc-10x8-unorm-srgb":{gl:37850,f:_i},"astc-10x10-unorm":{gl:37819,f:_i},"astc-10x10-unorm-srgb":{gl:37851,f:_i},"astc-12x10-unorm":{gl:37820,f:_i},"astc-12x10-unorm-srgb":{gl:37852,f:_i},"astc-12x12-unorm":{gl:37821,f:_i},"astc-12x12-unorm-srgb":{gl:37853,f:_i},"pvrtc-rgb4unorm-webgl":{gl:35840,f:hf},"pvrtc-rgba4unorm-webgl":{gl:35842,f:hf},"pvrtc-rbg2unorm-webgl":{gl:35841,f:hf},"pvrtc-rgba2unorm-webgl":{gl:35843,f:hf},"etc1-rbg-unorm-webgl":{gl:36196,f:UD},"atc-rgb-unorm-webgl":{gl:35986,f:L_},"atc-rgba-unorm-webgl":{gl:35986,f:L_},"atc-rgbai-unorm-webgl":{gl:34798,f:L_}},KD={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},GD={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Hy(t,e,i){const r=Jp[e];if(!r||r.gl===void 0)return!1;const n=r.x||r.gl2ext;return n?!!ma(t,n,i):!0}function LS(t){const e=Jp[t],i=e==null?void 0:e.gl;if(i===void 0)throw new Error(`Unsupported texture format ${t}`);return i}function JD(t,e,i){if(!Hy(t,e,i)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(FT(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!ma(t,"OES_texture_float_linear, extensions",i):e.endsWith("16float")?!!ma(t,"OES_texture_half_float_linear, extensions",i):!0}function QD(t,e,i){return!(!Hy(t,e,i)||typeof e=="number")}function dp(t){var n;const e=Jp[t],i=LS(t),r=FT(t);return{format:i,dataFormat:(e==null?void 0:e.dataFormat)||tN(r.format,r.integer,r.normalized,i),type:r.dataType?NS(r.dataType):((n=e==null?void 0:e.types)==null?void 0:n[0])||5121,compressed:r.compressed}}function eN(t){const e=Jp[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function Bb(t){const e=dp(t),i=KD[e.dataFormat]||4,r=GD[e.type]||1;return i*r}function tN(t,e,i,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!i?36244:6403;case"rg":return e&&!i?33320:33319;case"rgb":return e&&!i?36248:6407;case"rgba":return e&&!i?36249:6408;default:return 6408}}const zb={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class iN extends KR{constructor(i,r,n){super([],n);H(this,"gl");H(this,"extensions");H(this,"testedFeatures",new Set);this.gl=i,this.extensions=r,ma(i,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const i=this.getFeatures();for(const r of i)this.has(r)&&(yield r);return[]}has(i){return this.disabledFeatures[i]?!1:(this.testedFeatures.has(i)||(this.testedFeatures.add(i),ZD(i)&&YD(this.gl,i,this.extensions)&&this.features.add(i),this.getWebGLFeature(i)&&this.features.add(i)),this.features.has(i))}initializeFeatures(){const i=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of i)this.has(r)}getFeatures(){return[...Object.keys(zb),...Object.keys(Wy)]}getWebGLFeature(i){const r=zb[i];return typeof r=="string"?!!ma(this.gl,r,this.extensions):!!r}}class rN extends YR{constructor(i){super();H(this,"gl");H(this,"limits",{});this.gl=i}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(i){return this.limits[i]===void 0&&(this.limits[i]=this.gl.getParameter(i)),this.limits[i]}}function aa(t,e,i){if(nN(e))return i(t);const{nocatch:r=!0}=e;Gp(t),Nc(t,e);let n;if(r)n=i(t),bh(t);else try{n=i(t)}finally{bh(t)}return n}function nN(t){for(const e in t)return!1;return!0}function sN(t,e,i,r){if(ep(e))return r(t);const n=t;Gp(n.gl);try{return oN(t,e),Nc(n.gl,i),r(t)}finally{bh(n.gl)}}function oN(t,e){const i=t,{gl:r}=i;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(tl("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const l=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,h=tl("provokingVertex",e.provokingVertex,{first:36429,last:36430});l==null||l.provokingVertexWEBGL(h)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const l=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,h=tl("polygonMode",e.polygonMode,{fill:6914,line:6913});l==null||l.polygonModeWEBGL(1028,h),l==null||l.polygonModeWEBGL(1029,h)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(lN("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc($m("depthCompare",e.depthCompare))),e.stencilWriteMask){const n=e.stencilWriteMask;r.stencilMaskSeparate(1028,n),r.stencilMaskSeparate(1029,n)}if(e.stencilReadMask&&Je.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const n=e.stencilReadMask||4294967295,l=$m("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,l,0,n),r.stencilFuncSeparate(1029,l,0,n)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const n=V_("stencilPassOperation",e.stencilPassOperation),l=V_("stencilFailOperation",e.stencilFailOperation),h=V_("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,l,h,n),r.stencilOpSeparate(1029,l,h,n)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const n=Ub("blendColorOperation",e.blendColorOperation||"add"),l=Ub("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(n,l);const h=ff("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=ff("blendColorDstFactor",e.blendColorDstFactor||"zero"),g=ff("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),y=ff("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(h,a,g,y)}}function $m(t,e){return tl(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function V_(t,e){return tl(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Ub(t,e){return tl(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function ff(t,e){return tl(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function aN(t,e){return`Illegal parameter ${e} for ${t}`}function tl(t,e,i){if(!(e in i))throw new Error(aN(t,e));return i[e]}function lN(t,e){return e}function BS(t){const e={};return t.addressModeU&&(e[10242]=$_(t.addressModeU)),t.addressModeV&&(e[10243]=$_(t.addressModeV)),t.addressModeW&&(e[32882]=$_(t.addressModeW)),t.magFilter&&(e[10240]=zS(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=cN(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=$m("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function $_(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function zS(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function cN(t,e){if(!e)return zS(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class pa extends Li{constructor(i,r={}){super(i,r);H(this,"device");H(this,"gl");H(this,"handle");H(this,"glTarget");H(this,"glUsage");H(this,"glIndexType",5123);H(this,"byteLength");H(this,"bytesUsed");this.device=i,this.gl=this.device.gl;const n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),i.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=uN(this.props.usage),this.glUsage=hN(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(i,r=0,n=i.byteLength+r){const l=this.glTarget;this.gl.bindBuffer(l,this.handle),this.gl.bufferData(l,n,this.glUsage),this.gl.bufferSubData(l,r,i),this.gl.bindBuffer(l,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(i,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(i){Pi(i>=0);let r=i;i===0&&(r=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(null,0,i),this.trackAllocatedMemory(i),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(i,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,i),this.gl.bindBuffer(36663,null),this._setDebugData(i,r,i.byteLength)}async readAsync(i=0,r){return this.readSyncWebGL(i,r)}readSyncWebGL(i=0,r){r=r??this.byteLength-i;const n=new Uint8Array(r),l=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,n,l,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,i,r),n}}function uN(t){return t&Li.INDEX?34963:t&Li.VERTEX?34962:t&Li.UNIFORM?35345:34962}function hN(t){return t&Li.INDEX||t&Li.VERTEX?35044:t&Li.UNIFORM?35048:35044}class jm extends rp{constructor(i,r){super(i,r);H(this,"device");H(this,"handle");H(this,"parameters");this.device=i,this.parameters=BS(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(i){for(const[r,n]of Object.entries(i)){const l=Number(r);switch(l){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,l,n);break;default:this.device.gl.samplerParameteri(this.handle,l,n);break}}}}class uc extends tp{constructor(i,r){super(i,{...as.defaultProps,...r});H(this,"device");H(this,"gl");H(this,"handle");H(this,"texture");this.device=i,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const dN={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},ph=class ph extends as{constructor(i,r){var n;super(i,{...dN,format:"rgba8unorm",...r});H(this,"MAX_ATTRIBUTES");H(this,"device");H(this,"gl");H(this,"handle");H(this,"sampler");H(this,"view");H(this,"glFormat");H(this,"type");H(this,"dataFormat");H(this,"mipmaps");H(this,"target");H(this,"textureUnit");H(this,"loaded",!1);H(this,"_video");this.device=i,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=fN(this.props),this.loaded=!1,typeof((n=this.props)==null?void 0:n.data)=="string"&&Object.assign(this.props,{data:LM(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(i){return new uc(this.device,{...i,texture:this})}initialize(i={}){if(this.props.dimension==="cube")return this.initializeCube(i);let r=i.data;if(r instanceof Promise)return r.then(G=>this.initialize(Object.assign({},i,{pixels:G,data:G}))),this;const n=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(n&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(i)),this;const{parameters:l={}}=i,{pixels:h=null,pixelStore:a={},textureUnit:g=void 0,mipmaps:y=!0}=i;r||(r=h);let{width:T,height:S,dataFormat:P,type:M,compressed:B=!1}=i;const{depth:j=0}=i,Z=LS(i.format);return{width:T,height:S,compressed:B,dataFormat:P,type:M}=this._deduceParameters({format:i.format,type:M,dataFormat:P,compressed:B,data:r,width:T,height:S}),this.width=T,this.height=S,this.glFormat=Z,this.type=M,this.dataFormat=P,this.textureUnit=g,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=y,this.setImageData({data:r,width:T,height:S,depth:j,format:i.format,type:M,dataFormat:P,parameters:a,compressed:B}),this.setSampler(i.sampler),this._setSamplerParameters(l),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),y&&this.device.isTextureFormatFilterable(i.format)&&this.generateMipmap(),n&&(this._video={video:r,parameters:l,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(i){const{mipmaps:r=!0,parameters:n={}}=i;return this.setCubeMapImageData(i).then(()=>{this.loaded=!0,r&&this.generateMipmap(i),this.setSampler(i.sampler),this._setSamplerParameters(n)}),this}setSampler(i={}){let r;i instanceof jm?(this.sampler=i,r=i.props):(this.sampler=new jm(this.device,i),r=i);const n=BS(r);return this._setSamplerParameters(n),this}resize(i){const{height:r,width:n,mipmaps:l=!1}=i;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:l}):this}update(){if(this._video){const{video:i,parameters:r,lastTime:n}=this._video;if(n===i.currentTime||i.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:i,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=i.currentTime}}generateMipmap(i={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),aa(this.gl,i,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(i){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(i);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:n=null,level:l=0,glFormat:h=this.glFormat,offset:a=0,parameters:g={}}=i;let{data:y=null,type:T=this.type,width:S=this.width,height:P=this.height,dataFormat:M=this.dataFormat,compressed:B=!1}=i;y||(y=n),{type:T,dataFormat:M,compressed:B,width:S,height:P}=this._deduceParameters({format:this.props.format,type:T,dataFormat:M,compressed:B,data:y,width:S,height:P});const{gl:j}=this;j.bindTexture(this.target,this.handle);let Z=null;if({data:y,dataType:Z}=this._getDataType({data:y,compressed:B}),aa(this.gl,g,()=>{switch(Z){case"null":j.texImage2D(r,l,h,S,P,0,M,T,y);break;case"typed-array":j.texImage2D(r,l,h,S,P,0,M,T,y,a);break;case"buffer":this.device.gl.bindBuffer(35052,y.handle||y),this.device.gl.texImage2D(r,l,h,S,P,0,M,T,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":j.texImage2D(r,l,h,S,P,0,M,T,y);break;case"compressed":for(const[G,fe]of y.entries())j.compressedTexImage2D(r,G,fe.format,fe.width,fe.height,0,fe.data);break;default:Pi(!1,"Unknown image data type")}}),y&&y.byteLength)this.trackAllocatedMemory(y.byteLength,"Texture");else{const G=Bb(this.props.format);this.trackAllocatedMemory(this.width*this.height*G,"Texture")}return this.loaded=!0,this}setSubImageData({target:i=this.target,pixels:r=null,data:n=null,x:l=0,y:h=0,width:a=this.width,height:g=this.height,level:y=0,glFormat:T=this.glFormat,type:S=this.type,dataFormat:P=this.dataFormat,compressed:M=!1,offset:B=0,parameters:j={}}){if({type:S,dataFormat:P,compressed:M,width:a,height:g}=this._deduceParameters({format:this.props.format,type:S,dataFormat:P,compressed:M,data:n,width:a,height:g}),Pi(this.depth===1,"texSubImage not supported for 3D textures"),n||(n=r),n&&n.data){const Z=n;n=Z.data,a=Z.shape[0],g=Z.shape[1]}n instanceof pa&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),aa(this.gl,j,()=>{M?this.gl.compressedTexSubImage2D(i,y,l,h,a,g,T,n):n===null?this.gl.texSubImage2D(i,y,l,h,a,g,P,S,null):ArrayBuffer.isView(n)?this.gl.texSubImage2D(i,y,l,h,a,g,P,S,n,B):typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,n),this.device.gl.texSubImage2D(i,y,l,h,a,g,P,S,B),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(i,y,l,h,a,g,P,S,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(i={}){return Je.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(i=this.textureUnit){const{gl:r}=this;return i!==void 0&&(this.textureUnit=i,r.activeTexture(33984+i)),r.bindTexture(this.target,this.handle),i}unbind(i=this.textureUnit){const{gl:r}=this;return i!==void 0&&(this.textureUnit=i,r.activeTexture(33984+i)),r.bindTexture(this.target,null),i}_getDataType({data:i,compressed:r=!1}){return r?{data:i,dataType:"compressed"}:i===null?{data:i,dataType:"null"}:ArrayBuffer.isView(i)?{data:i,dataType:"typed-array"}:i instanceof pa?{data:i.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?{data:i,dataType:"buffer"}:{data:i,dataType:"browser-object"}}_deduceParameters(i){const{format:r,data:n}=i;let{width:l,height:h,dataFormat:a,type:g,compressed:y}=i;const T=dp(r);return a=a||T.dataFormat,g=g||T.type,y=y||T.compressed,{width:l,height:h}=this._deduceImageSize(n,l,h),{dataFormat:a,type:g,compressed:y,width:l,height:h,format:r,data:n}}_deduceImageSize(i,r,n){let l;return typeof ImageData<"u"&&i instanceof ImageData?l={width:i.width,height:i.height}:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement?l={width:i.naturalWidth,height:i.naturalHeight}:typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement?l={width:i.width,height:i.height}:typeof ImageBitmap<"u"&&i instanceof ImageBitmap?l={width:i.width,height:i.height}:typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement?l={width:i.videoWidth,height:i.videoHeight}:i?l={width:r,height:n}:l={width:r>=0?r:1,height:n>=0?n:1},Pi(l,"Could not deduced texture size"),Pi(r===void 0||l.width===r,"Deduced texture width does not match supplied width"),Pi(n===void 0||l.height===n,"Deduced texture height does not match supplied height"),l}async setCubeMapImageData(i){const{gl:r}=this,{width:n,height:l,pixels:h,data:a,format:g=6408,type:y=5121}=i,T=h||a,S=await Promise.all(ph.FACES.map(P=>{const M=T[P];return Promise.all(Array.isArray(M)?M:[M])}));this.bind(),ph.FACES.forEach((P,M)=>{S[M].length>1&&this.props.mipmaps!==!1&&Je.warn(`${this.id} has mipmap and multiple LODs.`)(),S[M].forEach((B,j)=>{n&&l?r.texImage2D(P,j,g,n,l,0,g,y,B):r.texImage2D(P,j,g,g,y,B)})}),this.unbind()}setImageDataForFace(i){const{face:r,width:n,height:l,pixels:h,data:a,format:g=6408,type:y=5121}=i,{gl:T}=this,S=h||a;return this.bind(),S instanceof Promise?S.then(P=>this.setImageDataForFace(Object.assign({},i,{face:r,data:P,pixels:P}))):this.width||this.height?T.texImage2D(r,0,g,n,l,0,g,y,S):T.texImage2D(r,0,g,g,y,S),this}setImageData3D(i){const{level:r=0,dataFormat:n,format:l,type:h,width:a,height:g,depth:y=1,offset:T=0,data:S,parameters:P={}}=i;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const M=dp(l);if(aa(this.gl,P,()=>{ArrayBuffer.isView(S)&&this.gl.texImage3D(this.target,r,M.format,a,g,y,0,M.dataFormat,M.type,S),S instanceof pa&&(this.gl.bindBuffer(35052,S.handle),this.gl.texImage3D(this.target,r,n,a,g,y,0,l,h,T))}),S&&S.byteLength)this.trackAllocatedMemory(S.byteLength,"Texture");else{const B=Bb(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*B,"Texture")}return this.loaded=!0,this}_setSamplerParameters(i){if(!ep(i)){pN(i),this.gl.bindTexture(this.target,this.handle);for(const[r,n]of Object.entries(i)){const l=Number(r),h=n;switch(l){case 33082:case 33083:this.gl.texParameterf(this.target,l,h);break;default:this.gl.texParameteri(this.target,l,h);break}}this.gl.bindTexture(this.target,null)}}};H(ph,"FACES",[34069,34070,34071,34072,34073,34074]);let Ys=ph;function fN(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function pN(t){Je.log(1,"texture sampler parameters",t)()}class ah extends np{constructor(i,r){super(i,r);H(this,"device");H(this,"gl");H(this,"handle");const n=r.handle===null;if(this.device=i,this.gl=i.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),!n){i.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const l=this.gl.bindFramebuffer(36160,this.handle);for(let h=0;h<this.colorAttachments.length;++h){const a=this.colorAttachments[h],g=36064+h;a&&this._attachOne(g,a)}if(this.depthStencilAttachment&&this._attachOne(eN(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const h=this.gl.checkFramebufferStatus(36160);if(h!==36053)throw new Error(`Framebuffer ${_N(h)}`)}this.gl.bindFramebuffer(36160,l)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(i){return new Ys(this.device,{id:`${this.id}-depth-stencil`,format:i,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(i,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;i===void 0&&(i=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const n of this.colorAttachments)n.texture.resize({width:i,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:i,height:r}),this}_attachOne(i,r){if(Array.isArray(r)){const[n,l=0,h=0]=r;return this._attachTexture(i,n,l,h),n}if(r instanceof Ys)return this._attachTexture(i,r,0,0),r;if(r instanceof uc){const n=r;return this._attachTexture(i,n.texture,n.props.baseMipLevel,n.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(i,r,n,l){const{gl:h}=this.device;switch(h.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:h.framebufferTextureLayer(36160,i,r.target,l,n);break;case 34067:const a=gN(n);h.framebufferTexture2D(36160,i,a,r.handle,l);break;case 3553:h.framebufferTexture2D(36160,i,3553,r.handle,l);break;default:Pi(!1,"Illegal texture type")}h.bindTexture(r.target,null)}}function gN(t){return t<34069?t+34069:t}function _N(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class mN extends My{constructor(i,r){super(r);H(this,"device");H(this,"presentationSize");H(this,"_framebuffer",null);this.device=i,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new ah(this.device,{handle:null}),this._framebuffer}update(){const i=this.getPixelSize();(i[0]!==this.presentationSize[0]||i[1]!==this.presentationSize[1])&&(this.presentationSize=i,this.resize())}resize(i){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(i==null?void 0:i.useDevicePixels);this.setDevicePixelRatio(r,i);return}}commit(){}}const yN={spector:Je.get("spector")||Je.get("spectorjs")},xN="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",vN=1;let mi=null,Vb=!1;async function bN(t){if(!globalThis.SPECTOR)try{await $T(xN)}catch(e){Je.warn(String(e))}}function wN(t){if(t={...yN,...t},!(t!=null&&t.spector)||(!mi&&globalThis.SPECTOR&&(Je.probe(vN,"SPECTOR found and initialized")(),mi=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=mi)),!mi))return null;if(Vb||(Vb=!0,mi.spyCanvases(),mi==null||mi.onCaptureStarted.add(e=>Je.info("Spector capture started:",e)()),mi==null||mi.onCapture.add(e=>{Je.info("Spector capture complete:",e)(),mi==null||mi.getResultUI(),mi==null||mi.resultView.display(),mi==null||mi.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return mi;mi==null||mi.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Je.info("Spector capture stopped after 2 seconds")(),mi==null||mi.stopCapture()})}return mi}const TN="https://unpkg.com/webgl-debug@2.0.1/index.js";function US(t){return t.luma=t.luma||{},t.luma}async function SN(){va()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await $T(TN))}function EN(t,e={}){return t?e.debug?PN(t,e):AN(t):null}function AN(t){const e=US(t);return e.realContext?e.realContext:t}function PN(t,e){if(!globalThis.WebGLDebugUtils)return Je.warn("webgl-debug not loaded")(),t;const i=US(t);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...ac,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,IN.bind(null,e),CN.bind(null,e));for(const h in ac)!(h in r)&&typeof ac[h]=="number"&&(r[h]=ac[h]);class n{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(n,r);const l=Object.create(n);return i.realContext=t,i.debugContext=l,l.debug=!0,l}function j_(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${t}(${i})`}function IN(t,e,i,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const n=globalThis.WebGLDebugUtils.glEnumToString(e),l=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,r),h=`${n} in gl.${i}(${l})`;Je.error(h)();debugger;if(t.throwOnError)throw new Error(h)}function CN(t,e,i){let r="";if(Je.level>=1&&(r=j_(e,i),Je.log(1,r)()),t.break&&t.break.length>0&&(r=r||j_(e,i),t.break.every(l=>r.indexOf(l)!==-1)))debugger;for(const n of i)if(n===void 0){if(r=r||j_(e,i),t.throwOnError)throw new Error(`Undefined argument: ${r}`);Je.error(`Undefined argument: ${r}`)();debugger}}function RN(t){const e=t.split(/\r?\n/),i=[];for(const r of e){if(r.length<=1)continue;const n=r.split(":");if(n.length===2){const[S,P]=n;i.push({message:P.trim(),type:$b(S),lineNum:0,linePos:0});continue}const[l,h,a,...g]=n;let y=parseInt(a,10);isNaN(y)&&(y=0);let T=parseInt(h,10);isNaN(T)&&(T=0),i.push({message:g.join(":").trim(),type:$b(l),lineNum:y,linePos:T})}return i}function $b(t){const e=["warning","error","info"],i=t.toLowerCase();return e.includes(i)?i:"info"}class MN extends ip{constructor(i,r){super(i,r);H(this,"device");H(this,"handle");switch(this.device=i,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const i=this.device.gl.getShaderInfoLog(this.handle);return RN(i)}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return r==null?void 0:r.getTranslatedShaderSource(this.handle)}async _compile(i){i=(l=>l.startsWith("#version ")?l:`#version 100
${l}`)(i);const{gl:n}=this.device;if(n.shaderSource(this.handle,i),n.compileShader(this.handle),Je.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Je.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Je.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const i=async l=>await new Promise(h=>setTimeout(h,l));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await i(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const kN=256,ON=1024,FN=16384,W_=6144,DN=[1,2,4,8];class NN extends wm{constructor(i,r){super(i,r);H(this,"device");H(this,"glParameters");this.device=i,Gp(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){bh(this.device.gl)}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}setParameters(i={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,i.viewport&&(i.viewport.length>=6?(r.viewport=i.viewport.slice(0,4),r.depthRange=[i.viewport[4],i.viewport[5]]):r.viewport=i.viewport),i.scissorRect&&(r.scissorTest=!0,r.scissor=i.scissorRect),i.blendConstant&&(r.blendColor=i.blendConstant),i.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),i[2967]=i.stencilReference),i.colorMask&&(r.colorMask=DN.map(n=>!!(n&i.colorMask))),this.glParameters=r,Nc(this.device.gl,r)}beginOcclusionQuery(i){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const i=this.props.occlusionQuerySet;i==null||i.endOcclusionQuery()}clear(){const i={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=FN,i.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=kN,i.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=ON,i.clearStencil=this.props.clearStencil),r!==0&&aa(this.device.gl,i,()=>{this.device.gl.clear(r)})}clearColorBuffer(i=0,r=[0,0,0,0]){aa(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(W_,i,r);break;case Uint32Array:this.device.gl.clearBufferuiv(W_,i,r);break;case Float32Array:default:this.device.gl.clearBufferfv(W_,i,r);break}})}}const LN="Failed to deduce GL constant from typed array";function BN(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(LN)}}function Wm(t,e){const{clamped:i=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const zN={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},UN={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class lh{constructor(...e){H(this,"offset");H(this,"stride");H(this,"type");H(this,"size");H(this,"divisor");H(this,"normalized");H(this,"integer");H(this,"buffer");H(this,"index");e.forEach(i=>this._assign(i)),Object.freeze(this)}static getBytesPerElement(e){return Wm(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Pi(e.size),Wm(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new lh(zN,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return lh.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return lh.getBytesPerVertex(this)}_assign(e={}){return e=DM("Accessor",e,UN),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function VN(t){return $N.includes(t)}const $N=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],VS={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function $S(t){const e=VS[t];if(!e)throw new Error("uniform");const[i,r,,n]=e;return{format:n,components:r,glType:i}}function jN(t){const e=VS[t];if(!e)throw new Error("attribute");const[,i,,r,n]=e;return{attributeType:r,vertexFormat:n,components:i}}function WN(t,e){const i={attributes:[],bindings:[]};i.attributes=HN(t,e);const r=ZN(t,e);for(const a of r){const g=a.uniforms.map(y=>({name:y.name,format:y.format,byteOffset:y.byteOffset,byteStride:y.byteStride,arrayLength:y.arrayLength}));i.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:g})}const n=XN(t,e);let l=0;for(const a of n)if(VN(a.type)){const{viewDimension:g,sampleType:y}=KN(a.type);i.bindings.push({type:"texture",name:a.name,location:l,viewDimension:g,sampleType:y}),a.textureUnit=l,l+=1}n.length&&(i.uniforms=n);const h=qN(t,e);return h!=null&&h.length&&(i.varyings=h),i}function HN(t,e){const i=[],r=t.getProgramParameter(e,35721);for(let n=0;n<r;n++){const l=t.getActiveAttrib(e,n);if(!l)throw new Error("activeInfo");const{name:h,type:a}=l,g=t.getAttribLocation(e,h);if(g>=0){const{attributeType:y}=jN(a),T=/instance/i.test(h)?"instance":"vertex";i.push({name:h,location:g,stepMode:T,type:y})}}return i.sort((n,l)=>n.location-l.location),i}function qN(t,e){const i=[],r=t.getProgramParameter(e,35971);for(let n=0;n<r;n++){const l=t.getTransformFeedbackVarying(e,n);if(!l)throw new Error("activeInfo");const{name:h,type:a,size:g}=l,{glType:y,components:T}=$S(a),S=new lh({type:y,size:g*T}),P={location:n,name:h,accessor:S};i.push(P)}return i.sort((n,l)=>n.location-l.location),i}function XN(t,e){const i=[],r=t.getProgramParameter(e,35718);for(let n=0;n<r;n++){const l=t.getActiveUniform(e,n);if(!l)throw new Error("activeInfo");const{name:h,size:a,type:g}=l,{name:y,isArray:T}=GN(h);let S=t.getUniformLocation(e,y);const P={location:S,name:y,size:a,type:g,isArray:T};if(i.push(P),P.size>1)for(let M=0;M<P.size;M++){const B=`${y}[${M}]`;S=t.getUniformLocation(e,B);const j={...P,name:B,location:S};i.push(j)}}return i}function ZN(t,e){const i=(l,h)=>t.getActiveUniformBlockParameter(e,l,h),r=[],n=t.getProgramParameter(e,35382);for(let l=0;l<n;l++){const h={name:t.getActiveUniformBlockName(e,l)||"",location:i(l,35391),byteLength:i(l,35392),vertex:i(l,35396),fragment:i(l,35398),uniformCount:i(l,35394),uniforms:[]},a=i(l,35395)||[],g=t.getActiveUniforms(e,a,35383),y=t.getActiveUniforms(e,a,35384),T=t.getActiveUniforms(e,a,35387),S=t.getActiveUniforms(e,a,35388);for(let P=0;P<h.uniformCount;++P){const M=t.getActiveUniform(e,a[P]);if(!M)throw new Error("activeInfo");h.uniforms.push({name:M.name,format:$S(g[P]).format,type:g[P],arrayLength:y[P],byteOffset:T[P],byteStride:S[P]})}r.push(h)}return r.sort((l,h)=>l.location-h.location),r}const YN={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function KN(t){const e=YN[t];if(!e)throw new Error("sampler");const[i,r]=e;return{viewDimension:i,sampleType:r}}function GN(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const i=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!i||i.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:i[1],length:i[2]?1:0,isArray:!!i[2]}}function JN(t,e,i,r){const n=t;let l=r;l===!0&&(l=1),l===!1&&(l=0);const h=typeof l=="number"?[l]:l;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,h);case 35664:return t.uniform2fv(e,h);case 35665:return t.uniform3fv(e,h);case 35666:return t.uniform4fv(e,h);case 5124:return t.uniform1iv(e,h);case 35667:return t.uniform2iv(e,h);case 35668:return t.uniform3iv(e,h);case 35669:return t.uniform4iv(e,h);case 35670:return t.uniform1iv(e,h);case 35671:return t.uniform2iv(e,h);case 35672:return t.uniform3iv(e,h);case 35673:return t.uniform4iv(e,h);case 5125:return n.uniform1uiv(e,h,1);case 36294:return n.uniform2uiv(e,h,2);case 36295:return n.uniform3uiv(e,h,3);case 36296:return n.uniform4uiv(e,h,4);case 35674:return t.uniformMatrix2fv(e,!1,h);case 35675:return t.uniformMatrix3fv(e,!1,h);case 35676:return t.uniformMatrix4fv(e,!1,h);case 35685:return n.uniformMatrix2x3fv(e,!1,h);case 35686:return n.uniformMatrix2x4fv(e,!1,h);case 35687:return n.uniformMatrix3x2fv(e,!1,h);case 35688:return n.uniformMatrix3x4fv(e,!1,h);case 35689:return n.uniformMatrix4x2fv(e,!1,h);case 35690:return n.uniformMatrix4x3fv(e,!1,h)}throw new Error("Illegal uniform")}function QN(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function eL(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const jb=4;class tL extends Pc{constructor(i,r){super(i,r);H(this,"device");H(this,"handle");H(this,"vs");H(this,"fs");H(this,"introspectedLayout");H(this,"uniforms",{});H(this,"bindings",{});H(this,"varyings",null);H(this,"_uniformCount",0);H(this,"_uniformSetters",{});this.device=i,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:n,bufferMode:l=35981}=r;switch(n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,l)),this._linkShaders(),Je.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=WN(this.device.gl,this.handle),Je.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=wM(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Je.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(i,r){for(const[n,l]of Object.entries(i)){const h=this.shaderLayout.bindings.find(a=>a.name===n)||this.shaderLayout.bindings.find(a=>a.name===`${n}Uniforms`);if(!h){const a=this.shaderLayout.bindings.map(g=>`"${g.name}"`).join(", ");r!=null&&r.disableWarnings||Je.warn(`Unknown binding "${n}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(l||Je.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),h.type){case"uniform":if(!(l instanceof pa)&&!(l.buffer instanceof pa))throw new Error("buffer value");break;case"texture":if(!(l instanceof uc||l instanceof Ys||l instanceof ah))throw new Error("texture value");break;case"sampler":Je.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(h.type)}this.bindings[n]=l}}draw(i){var Z;const{renderPass:r,parameters:n=this.props.parameters,topology:l=this.props.topology,vertexArray:h,vertexCount:a,instanceCount:g,isInstanced:y=!1,firstVertex:T=0,transformFeedback:S}=i,P=QN(l),M=!!h.indexBuffer,B=(Z=h.indexBuffer)==null?void 0:Z.glIndexType;if(this.linkStatus!=="success")return Je.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return Je.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return Je.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),h.bindBeforeRender(r),S&&S.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const j=r;return sN(this.device,n,j.glParameters,()=>{M&&y?this.device.gl.drawElementsInstanced(P,a||0,B,T,g||0):M?this.device.gl.drawElements(P,a||0,B,T):y?this.device.gl.drawArraysInstanced(P,T,a||0,g||0):this.device.gl.drawArrays(P,T,a||0),S&&S.end()}),h.unbindAfterRender(r),!0}setUniformsWebGL(i){const{bindings:r}=ky(i);Object.keys(r).forEach(n=>{Je.warn(`Unsupported value "${JSON.stringify(r[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,i)}async _linkShaders(){const{gl:i}=this.device;if(i.attachShader(this.handle,this.vs.handle),i.attachShader(this.handle,this.fs.handle),Je.time(jb,`linkProgram for ${this.id}`)(),i.linkProgram(this.handle),Je.timeEnd(jb,`linkProgram for ${this.id}`)(),Je.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}Je.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Je.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(i){var r;switch(i){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${i}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:i}=this.device;return i.getProgramParameter(this.handle,35714)?(i.validateProgram(this.handle),i.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const i=async l=>await new Promise(h=>setTimeout(h,l));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await i(10)}}_areTexturesRenderable(){let i=!0;for(const[,r]of Object.entries(this.bindings))r instanceof Ys&&(r.update(),i=i&&r.loaded);return i}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:i}=this.device;i.useProgram(this.handle);let r=0,n=0;for(const l of this.shaderLayout.bindings){const h=this.bindings[l.name]||this.bindings[l.name.replace(/Uniforms$/,"")];if(!h)throw new Error(`No value for binding ${l.name} in ${this.id}`);switch(l.type){case"uniform":const{name:a}=l,g=i.getUniformBlockIndex(this.handle,a);if(g===4294967295)throw new Error(`Invalid uniform block name ${a}`);i.uniformBlockBinding(this.handle,n,g),h instanceof pa?i.bindBufferBase(35345,n,h.handle):i.bindBufferRange(35345,n,h.buffer.handle,h.offset||0,h.size||h.buffer.byteLength-h.offset),n+=1;break;case"texture":if(!(h instanceof uc||h instanceof Ys||h instanceof ah))throw new Error("texture");let y;if(h instanceof uc)y=h.texture;else if(h instanceof Ys)y=h;else if(h instanceof ah&&h.colorAttachments[0]instanceof uc)Je.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),y=h.colorAttachments[0].texture;else throw new Error("No texture");i.activeTexture(33984+r),i.bindTexture(y.target,y.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${l.type}' not supported in WebGL`)}}}_applyUniforms(){for(const i of this.shaderLayout.uniforms||[]){const{name:r,location:n,type:l,textureUnit:h}=i,a=this.uniforms[r]??h;a!==void 0&&JN(this.device.gl,n,l,a)}}}class iL extends Sm{constructor(i){super(i,{});H(this,"device");H(this,"commands",[]);this.device=i}submitCommands(i=this.commands){for(const r of i)switch(r.name){case"copy-buffer-to-buffer":rL(this.device,r.options);break;case"copy-buffer-to-texture":nL(this.device,r.options);break;case"copy-texture-to-buffer":sL(this.device,r.options);break;case"copy-texture-to-texture":oL(this.device,r.options);break}}}function rL(t,e){const i=e.source,r=e.destination;t.gl.bindBuffer(36662,i.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function nL(t,e){throw new Error("Not implemented")}function sL(t,e){const{source:i,mipLevel:r=0,aspect:n="all",width:l=e.source.width,height:h=e.source.height,depthOrArrayLayers:a=0,origin:g=[0,0],destination:y,byteOffset:T=0,bytesPerRow:S,rowsPerImage:P}=e;if(n!=="all")throw new Error("not supported");if(r!==0||a!==0||S||P)throw new Error("not implemented");const{framebuffer:M,destroyFramebuffer:B}=jS(i);let j;try{const Z=y,G=l||M.width,fe=h||M.height,re=dp(M.texture.props.format),ue=re.dataFormat,Me=re.type;t.gl.bindBuffer(35051,Z.handle),j=t.gl.bindFramebuffer(36160,M.handle),t.gl.readPixels(g[0],g[1],G,fe,ue,Me,T)}finally{t.gl.bindBuffer(35051,null),j!==void 0&&t.gl.bindFramebuffer(36160,j),B&&M.destroy()}}function oL(t,e){const{source:i,destinationMipLevel:r=0,origin:n=[0,0],destinationOrigin:l=[0,0],destination:h}=e;let{width:a=e.destination.width,height:g=e.destination.height}=e;const{framebuffer:y,destroyFramebuffer:T}=jS(i),[S,P]=n,[M,B,j]=l,Z=t.gl.bindFramebuffer(36160,y.handle);let G=null,fe;if(h instanceof Ys)G=h,a=Number.isFinite(a)?a:G.width,g=Number.isFinite(g)?g:G.height,G.bind(0),fe=G.target;else throw new Error("invalid destination");switch(fe){case 3553:case 34067:t.gl.copyTexSubImage2D(fe,r,M,B,S,P,a,g);break;case 35866:case 32879:t.gl.copyTexSubImage3D(fe,r,M,B,j,S,P,a,g);break}G&&G.unbind(),t.gl.bindFramebuffer(36160,Z),T&&y.destroy()}function jS(t){if(t instanceof as){const{width:e,height:i,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:i,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class aL extends Tm{constructor(i,r){super(i,r);H(this,"device");H(this,"commandBuffer");this.device=i,this.commandBuffer=new iL(i)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(i){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:i})}copyBufferToTexture(i){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:i})}copyTextureToBuffer(i){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:i})}copyTextureToTexture(i){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:i})}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}resolveQuerySet(i,r,n){}}class qy extends Em{constructor(i,r){super(i,r);H(this,"device");H(this,"handle");H(this,"buffer",null);H(this,"bufferValue",null);this.device=i,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(i){return NP()==="Chrome"}destroy(){var i;super.destroy(),this.buffer&&((i=this.buffer)==null||i.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(i){const r=i;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(i,r){const n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:l,type:h,stride:a,offset:g,normalized:y,integer:T,divisor:S}=this._getAccessor(i);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),T?this.device.gl.vertexAttribIPointer(i,l,h,a,g):this.device.gl.vertexAttribPointer(i,l,h,y,a,g),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(i),this.device.gl.vertexAttribDivisor(i,S||0),this.attributes[i]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(i,r){this._enable(i,!1),this.attributes[i]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let i=0;i<this.maxVertexAttributes;++i){const r=this.attributes[i];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(i,r)}}_getAccessor(i){const r=this.attributeInfos[i];if(!r)throw new Error(`Unknown attribute location ${i}`);const n=NS(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(i,r=!0){const l=qy.isConstantAttributeZeroSupported(this.device)||i!==0;(r||l)&&(i=Number(i),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(i):this.device.gl.disableVertexAttribArray(i),this.device.gl.bindVertexArray(null))}getConstantBuffer(i,r){const n=lL(r),l=n.byteLength*i,h=n.length*i;if(this.buffer&&l!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${l} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:l}),a=a||!cL(n,this.bufferValue),a){const g=AM(r.constructor,h);PM({target:g,source:n,start:0,count:h}),this.buffer.write(g),this.bufferValue=r}return this.buffer}}function lL(t){return Array.isArray(t)?new Float32Array(t):t}function cL(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}class uL extends Am{constructor(i,r){super(i,r);H(this,"device");H(this,"gl");H(this,"handle");H(this,"layout");H(this,"buffers",{});H(this,"unusedBuffers",{});H(this,"bindOnUse",!0);H(this,"_bound",!1);this.device=i,this.gl=i.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(i="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(eL(i))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(i){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in i)this.setBuffer(r,i[r])})}setBuffer(i,r){const n=this._getVaryingIndex(i),{buffer:l,byteLength:h,byteOffset:a}=this._getBufferRange(r);if(n<0){this.unusedBuffers[i]=l,Je.warn(`${this.id} unusedBuffers varying buffer ${i}`)();return}this.buffers[n]={buffer:l,byteLength:h,byteOffset:a},this.bindOnUse||this._bindBuffer(n,l,a,h)}getBuffer(i){if(Wb(i))return this.buffers[i]||null;const r=this._getVaryingIndex(i);return r>=0?this.buffers[r]:null}bind(i=this.handle){if(typeof i!="function")return this.gl.bindTransformFeedback(36386,i),this;let r;return this._bound?r=i():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=i(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(i){if(i instanceof pa)return{buffer:i,byteOffset:0,byteLength:i.byteLength};const{buffer:r,byteOffset:n=0,byteLength:l=i.buffer.byteLength}=i;return{buffer:r,byteOffset:n,byteLength:l}}_getVaryingIndex(i){if(Wb(i))return Number(i);for(const r of this.layout.varyings)if(i===r.name)return r.location;return-1}_bindBuffers(){for(const i in this.buffers){const{buffer:r,byteLength:n,byteOffset:l}=this._getBufferRange(this.buffers[i]);this._bindBuffer(Number(i),r,l,n)}}_unbindBuffers(){for(const i in this.buffers)this.gl.bindBufferBase(35982,Number(i),null)}_bindBuffer(i,r,n=0,l){const h=r&&r.handle;!h||l===void 0?this.gl.bindBufferBase(35982,i,h):this.gl.bindBufferRange(35982,i,h,n,l)}}function Wb(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class hL extends Pm{constructor(i,r){super(i,r);H(this,"device");H(this,"handle");H(this,"target",null);H(this,"_queryPending",!1);H(this,"_pollingPromise",null);if(this.device=i,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(i){return this._begin(i!=null&&i.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(i){this._queryPending||(this.target=i,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const i=this.device.gl.getQueryParameter(this.handle,34919);return i&&(this._queryPending=!1),i}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(i=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,l)=>{const h=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>i?(l("Timed out"),this._pollingPromise=null):requestAnimationFrame(h)};requestAnimationFrame(h)}),this._pollingPromise}}function WS(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Pi(!1),0}}function dL(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Pi(!1),0}}function fL(t,e){var Z,G;const{sourceX:i=0,sourceY:r=0,sourceFormat:n=6408,sourceAttachment:l=36064}=e||{};let{target:h=null,sourceWidth:a,sourceHeight:g,sourceType:y}=e||{};const{framebuffer:T,deleteFramebuffer:S}=HS(t);Pi(T);const{gl:P,handle:M}=T;a=a||T.width,g=g||T.height;const B=l-36064;y=y||((G=(Z=T.colorAttachments[B])==null?void 0:Z.texture)==null?void 0:G.type)||5121,h=_L(h,y,n,a,g),y=y||BN(h);const j=P.bindFramebuffer(36160,M);return P.readPixels(i,r,a,g,n,y,h),P.bindFramebuffer(36160,j||null),S&&T.destroy(),h}function pL(t,e){const{target:i,sourceX:r=0,sourceY:n=0,sourceFormat:l=6408,targetByteOffset:h=0}=e||{};let{sourceWidth:a,sourceHeight:g,sourceType:y}=e||{};const{framebuffer:T,deleteFramebuffer:S}=HS(t);Pi(T),a=a||T.width,g=g||T.height;const P=T;y=y||5121;let M=i;if(!M){const j=WS(l),Z=dL(y),G=h+a*g*j*Z;M=P.device.createBuffer({byteLength:G})}const B=t.device.createCommandEncoder();return B.copyTextureToBuffer({source:t,width:a,height:g,origin:[r,n],destination:M,byteOffset:h}),B.destroy(),S&&T.destroy(),M}function HS(t){return t instanceof np?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:gL(t),deleteFramebuffer:!0}}function gL(t,e){const{device:i,width:r,height:n,id:l}=t;return i.createFramebuffer({...e,id:`framebuffer-for-${l}`,width:r,height:n,colorAttachments:[t]})}function _L(t,e,i,r,n){if(t)return t;e=e||5121;const l=Wm(e,{clamped:!1}),h=WS(i);return new l(r*n*h)}const mL=256,yL=1024,xL=16384,vL="clear: bad arguments";function bL(t,e){const{framebuffer:i=null,color:r=null,depth:n=null,stencil:l=null}=e||{},h={};i&&(h.framebuffer=i);let a=0;r&&(a|=xL,r!==!0&&(h.clearColor=r)),n&&(a|=mL,n!==!0&&(h.clearDepth=n)),l&&(a|=yL,n!==!0&&(h.clearStencil=n)),Pi(a!==0,vL);const g=t.gl;aa(g,h,()=>{g.clear(a)})}const qu=1,Ya=class Ya extends Ac{constructor(i){var g,y;super({...i,id:i.id||hl("webgl-device")});H(this,"type","webgl");H(this,"handle");H(this,"features");H(this,"limits");H(this,"info");H(this,"canvasContext");H(this,"lost");H(this,"_resolveContextLost");H(this,"renderPass",null);H(this,"gl");H(this,"debug",!1);H(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});H(this,"_extensions",{});H(this,"_polyfilled",!1);H(this,"spectorJS");H(this,"_constants");const r=(g=i.gl)==null?void 0:g.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const n=((y=i.gl)==null?void 0:y.canvas)||i.canvas;this.canvasContext=new mN(this,{...i,canvas:n}),this.lost=new Promise(T=>{this._resolveContextLost=T});let l=i.gl||null;if(l||(l=ND(this.canvasContext.canvas,{...i,onContextLost:T=>{var S;return(S=this._resolveContextLost)==null?void 0:S.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!l)throw new Error("WebGL context creation failed");this.handle=l,this.gl=l,this.gl.device=this,this.gl._version=2,i.spector&&(this.spectorJS=wN({...this.props,canvas:this.handle.canvas})),this.info=LD(this.gl,this._extensions),this.limits=new rN(this.gl),this.features=new iN(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:h=!0,copyState:a=!1}=i;FS(this.gl,{enable:h,copyState:a,log:(...T)=>Je.log(1,...T)()}),i.debug&&(this.gl=EN(this.gl,{...i,throwOnError:!0}),this.debug=!0,Je.level=Math.max(Je.level,1),Je.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(i){if(i instanceof Ya)return i;if((i==null?void 0:i.device)instanceof Ac)return i.device;if(!wL(i))throw new Error("Invalid WebGL2RenderingContext");return new Ya({gl:i})}static async create(i={}){var a;Je.groupCollapsed(qu,"WebGLDevice created")();const r=[];i.debug&&r.push(SN()),i.spector&&r.push(bN()),typeof i.canvas=="string"&&r.push(My.pageLoaded);const n=await Promise.allSettled(r);for(const g of n)g.status==="rejected"&&Je.error(`Failed to initialize debug libraries ${g.reason}`)();if(Je.probe(qu+1,"DOM is loaded")(),(a=i.gl)!=null&&a.device)return Je.warn("reattaching existing device")(),Ya.attach(i.gl);const l=new Ya(i),h=`Created ${l.type}${l.debug?" debug":""} context: ${l.info.vendor}, ${l.info.renderer} for canvas: ${l.canvasContext.id}`;return Je.probe(qu,h)(),Je.table(qu,l.info)(),Je.groupEnd(qu)(),l}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(i){return Hy(this.gl,i,this._extensions)}isTextureFormatFilterable(i){return JD(this.gl,i,this._extensions)}isTextureFormatRenderable(i){return QD(this.gl,i,this._extensions)}createCanvasContext(i){throw new Error("WebGL only supports a single canvas")}createBuffer(i){const r=this._getBufferProps(i);return new pa(this,r)}_createTexture(i){return new Ys(this,i)}createExternalTexture(i){throw new Error("createExternalTexture() not implemented")}createSampler(i){return new jm(this,i)}createShader(i){return new MN(this,i)}createFramebuffer(i){return new ah(this,i)}createVertexArray(i){return new qy(this,i)}createTransformFeedback(i){return new uL(this,i)}createQuerySet(i){return new hL(this,i)}createRenderPipeline(i){return new tL(this,i)}beginRenderPass(i){return new NN(this,i)}createComputePipeline(i){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(i){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(i){return new aL(this,i)}submit(){var i;(i=this.renderPass)==null||i.end(),this.renderPass=null}readPixelsToArrayWebGL(i,r){return fL(i,r)}readPixelsToBufferWebGL(i,r){return pL(i,r)}setParametersWebGL(i){Nc(this.gl,i)}getParametersWebGL(i){return OS(this.gl,i)}withParametersWebGL(i,r){return aa(this.gl,i,r)}clearWebGL(i){bL(this,i)}resetWebGL(){Je.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),CD(this.gl)}loseDevice(){var l;let i=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(i=!0,n.loseContext()),(l=this._resolveContextLost)==null||l.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){Gp(this.gl)}popState(){bh(this.gl)}setSpectorMetadata(i,r){i.__SPECTOR_Metadata=r}getGLKey(i,r){r=r||this.gl2||this.gl;const n=Number(i);for(const l in r)if(r[l]===n)return`GL.${l}`;return String(i)}setConstantAttributeWebGL(i,r){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const l=this._constants[i];switch(l&&AL(l,r)&&Je.info(1,`setConstantAttributeWebGL(${i}) could have been skipped, value unchanged`)(),this._constants[i]=r,r.constructor){case Float32Array:TL(this,i,r);break;case Int32Array:SL(this,i,r);break;case Uint32Array:EL(this,i,r);break;default:Pi(!1)}}getExtension(i){return ma(this.gl,i,this._extensions),this._extensions}};H(Ya,"type","webgl");let ch=Ya;function wL(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function TL(t,e,i){switch(i.length){case 1:t.gl.vertexAttrib1fv(e,i);break;case 2:t.gl.vertexAttrib2fv(e,i);break;case 3:t.gl.vertexAttrib3fv(e,i);break;case 4:t.gl.vertexAttrib4fv(e,i);break;default:Pi(!1)}}function SL(t,e,i){t.gl.vertexAttribI4iv(e,i)}function EL(t,e,i){t.gl.vertexAttribI4uiv(e,i)}function AL(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}var qS={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,i,r,n){var l=["","webkit","Moz","MS","ms","o"],h=i.createElement("div"),a="function",g=Math.round,y=Math.abs,T=Date.now;function S(X,K,pe){return setTimeout(re(X,pe),K)}function P(X,K,pe){return Array.isArray(X)?(M(X,pe[K],pe),!0):!1}function M(X,K,pe){var Ce;if(X)if(X.forEach)X.forEach(K,pe);else if(X.length!==n)for(Ce=0;Ce<X.length;)K.call(pe,X[Ce],Ce,X),Ce++;else for(Ce in X)X.hasOwnProperty(Ce)&&K.call(pe,X[Ce],Ce,X)}function B(X,K,pe){var Ce="DEPRECATED METHOD: "+K+`
`+pe+` AT 
`;return function(){var qe=new Error("get-stack-trace"),ut=qe&&qe.stack?qe.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ot=e.console&&(e.console.warn||e.console.log);return Ot&&Ot.call(e.console,Ce,ut),X.apply(this,arguments)}}var j;typeof Object.assign!="function"?j=function(K){if(K===n||K===null)throw new TypeError("Cannot convert undefined or null to object");for(var pe=Object(K),Ce=1;Ce<arguments.length;Ce++){var qe=arguments[Ce];if(qe!==n&&qe!==null)for(var ut in qe)qe.hasOwnProperty(ut)&&(pe[ut]=qe[ut])}return pe}:j=Object.assign;var Z=B(function(K,pe,Ce){for(var qe=Object.keys(pe),ut=0;ut<qe.length;)(!Ce||Ce&&K[qe[ut]]===n)&&(K[qe[ut]]=pe[qe[ut]]),ut++;return K},"extend","Use `assign`."),G=B(function(K,pe){return Z(K,pe,!0)},"merge","Use `assign`.");function fe(X,K,pe){var Ce=K.prototype,qe;qe=X.prototype=Object.create(Ce),qe.constructor=X,qe._super=Ce,pe&&j(qe,pe)}function re(X,K){return function(){return X.apply(K,arguments)}}function ue(X,K){return typeof X==a?X.apply(K&&K[0]||n,K):X}function Me(X,K){return X===n?K:X}function Oe(X,K,pe){M(Ue(K),function(Ce){X.addEventListener(Ce,pe,!1)})}function $e(X,K,pe){M(Ue(K),function(Ce){X.removeEventListener(Ce,pe,!1)})}function ke(X,K){for(;X;){if(X==K)return!0;X=X.parentNode}return!1}function je(X,K){return X.indexOf(K)>-1}function Ue(X){return X.trim().split(/\s+/g)}function ct(X,K,pe){if(X.indexOf&&!pe)return X.indexOf(K);for(var Ce=0;Ce<X.length;){if(pe&&X[Ce][pe]==K||!pe&&X[Ce]===K)return Ce;Ce++}return-1}function tt(X){return Array.prototype.slice.call(X,0)}function pt(X,K,pe){for(var Ce=[],qe=[],ut=0;ut<X.length;){var Ot=K?X[ut][K]:X[ut];ct(qe,Ot)<0&&Ce.push(X[ut]),qe[ut]=Ot,ut++}return pe&&(K?Ce=Ce.sort(function(Wi,hr){return Wi[K]>hr[K]}):Ce=Ce.sort()),Ce}function ot(X,K){for(var pe,Ce,qe=K[0].toUpperCase()+K.slice(1),ut=0;ut<l.length;){if(pe=l[ut],Ce=pe?pe+qe:K,Ce in X)return Ce;ut++}return n}var ei=1;function rn(){return ei++}function lr(X){var K=X.ownerDocument||X;return K.defaultView||K.parentWindow||e}var us=/mobile|tablet|ip(ad|hone|od)|android/i,ks="ontouchstart"in e,Co=ot(e,"PointerEvent")!==n,eo=ks&&us.test(navigator.userAgent),_r="touch",oi="pen",sr="mouse",hs="kinect",Os=25,Mi=1,mr=2,Yt=4,ci=8,Xn=1,Nr=2,Nn=4,Er=8,Tn=16,or=Nr|Nn,yr=Er|Tn,Ln=or|yr,Zn=["x","y"],Fe=["clientX","clientY"];function ui(X,K){var pe=this;this.manager=X,this.callback=K,this.element=X.element,this.target=X.options.inputTarget,this.domHandler=function(Ce){ue(X.options.enable,[X])&&pe.handler(Ce)},this.init()}ui.prototype={handler:function(){},init:function(){this.evEl&&Oe(this.element,this.evEl,this.domHandler),this.evTarget&&Oe(this.target,this.evTarget,this.domHandler),this.evWin&&Oe(lr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(lr(this.element),this.evWin,this.domHandler)}};function Lr(X){var K,pe=X.options.inputClass;return pe?K=pe:Co?K=sn:eo?K=_e:ks?K=Ne:K=Pt,new K(X,ti)}function ti(X,K,pe){var Ce=pe.pointers.length,qe=pe.changedPointers.length,ut=K&Mi&&Ce-qe===0,Ot=K&(Yt|ci)&&Ce-qe===0;pe.isFirst=!!ut,pe.isFinal=!!Ot,ut&&(X.session={}),pe.eventType=K,jt(X,pe),X.emit("hammer.input",pe),X.recognize(pe),X.session.prevInput=pe}function jt(X,K){var pe=X.session,Ce=K.pointers,qe=Ce.length;pe.firstInput||(pe.firstInput=En(K)),qe>1&&!pe.firstMultiple?pe.firstMultiple=En(K):qe===1&&(pe.firstMultiple=!1);var ut=pe.firstInput,Ot=pe.firstMultiple,Oi=Ot?Ot.center:ut.center,Wi=K.center=to(Ce);K.timeStamp=T(),K.deltaTime=K.timeStamp-ut.timeStamp,K.angle=Ze(Oi,Wi),K.distance=An(Oi,Wi),Sn(pe,K),K.offsetDirection=Bn(K.deltaX,K.deltaY);var hr=ds(K.deltaTime,K.deltaX,K.deltaY);K.overallVelocityX=hr.x,K.overallVelocityY=hr.y,K.overallVelocity=y(hr.x)>y(hr.y)?hr.x:hr.y,K.scale=Ot?xi(Ot.pointers,Ce):1,K.rotation=Ot?Pn(Ot.pointers,Ce):0,K.maxPointers=pe.prevInput?K.pointers.length>pe.prevInput.maxPointers?K.pointers.length:pe.prevInput.maxPointers:K.pointers.length,Fs(pe,K);var an=X.element;ke(K.srcEvent.target,an)&&(an=K.srcEvent.target),K.target=an}function Sn(X,K){var pe=K.center,Ce=X.offsetDelta||{},qe=X.prevDelta||{},ut=X.prevInput||{};(K.eventType===Mi||ut.eventType===Yt)&&(qe=X.prevDelta={x:ut.deltaX||0,y:ut.deltaY||0},Ce=X.offsetDelta={x:pe.x,y:pe.y}),K.deltaX=qe.x+(pe.x-Ce.x),K.deltaY=qe.y+(pe.y-Ce.y)}function Fs(X,K){var pe=X.lastInterval||K,Ce=K.timeStamp-pe.timeStamp,qe,ut,Ot,Oi;if(K.eventType!=ci&&(Ce>Os||pe.velocity===n)){var Wi=K.deltaX-pe.deltaX,hr=K.deltaY-pe.deltaY,an=ds(Ce,Wi,hr);ut=an.x,Ot=an.y,qe=y(an.x)>y(an.y)?an.x:an.y,Oi=Bn(Wi,hr),X.lastInterval=K}else qe=pe.velocity,ut=pe.velocityX,Ot=pe.velocityY,Oi=pe.direction;K.velocity=qe,K.velocityX=ut,K.velocityY=Ot,K.direction=Oi}function En(X){for(var K=[],pe=0;pe<X.pointers.length;)K[pe]={clientX:g(X.pointers[pe].clientX),clientY:g(X.pointers[pe].clientY)},pe++;return{timeStamp:T(),pointers:K,center:to(K),deltaX:X.deltaX,deltaY:X.deltaY}}function to(X){var K=X.length;if(K===1)return{x:g(X[0].clientX),y:g(X[0].clientY)};for(var pe=0,Ce=0,qe=0;qe<K;)pe+=X[qe].clientX,Ce+=X[qe].clientY,qe++;return{x:g(pe/K),y:g(Ce/K)}}function ds(X,K,pe){return{x:K/X||0,y:pe/X||0}}function Bn(X,K){return X===K?Xn:y(X)>=y(K)?X<0?Nr:Nn:K<0?Er:Tn}function An(X,K,pe){pe||(pe=Zn);var Ce=K[pe[0]]-X[pe[0]],qe=K[pe[1]]-X[pe[1]];return Math.sqrt(Ce*Ce+qe*qe)}function Ze(X,K,pe){pe||(pe=Zn);var Ce=K[pe[0]]-X[pe[0]],qe=K[pe[1]]-X[pe[1]];return Math.atan2(qe,Ce)*180/Math.PI}function Pn(X,K){return Ze(K[1],K[0],Fe)+Ze(X[1],X[0],Fe)}function xi(X,K){return An(K[0],K[1],Fe)/An(X[0],X[1],Fe)}var fs={mousedown:Mi,mousemove:mr,mouseup:Yt},zn="mousedown",Ke="mousemove mouseup";function Pt(){this.evEl=zn,this.evWin=Ke,this.pressed=!1,ui.apply(this,arguments)}fe(Pt,ui,{handler:function(K){var pe=fs[K.type];pe&Mi&&K.button===0&&(this.pressed=!0),pe&mr&&K.which!==1&&(pe=Yt),this.pressed&&(pe&Yt&&(this.pressed=!1),this.callback(this.manager,pe,{pointers:[K],changedPointers:[K],pointerType:sr,srcEvent:K}))}});var At={pointerdown:Mi,pointermove:mr,pointerup:Yt,pointercancel:ci,pointerout:ci},cr={2:_r,3:oi,4:sr,5:hs},nn="pointerdown",It="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(nn="MSPointerDown",It="MSPointerMove MSPointerUp MSPointerCancel");function sn(){this.evEl=nn,this.evWin=It,ui.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}fe(sn,ui,{handler:function(K){var pe=this.store,Ce=!1,qe=K.type.toLowerCase().replace("ms",""),ut=At[qe],Ot=cr[K.pointerType]||K.pointerType,Oi=Ot==_r,Wi=ct(pe,K.pointerId,"pointerId");ut&Mi&&(K.button===0||Oi)?Wi<0&&(pe.push(K),Wi=pe.length-1):ut&(Yt|ci)&&(Ce=!0),!(Wi<0)&&(pe[Wi]=K,this.callback(this.manager,ut,{pointers:pe,changedPointers:[K],pointerType:Ot,srcEvent:K}),Ce&&pe.splice(Wi,1))}});var ne={touchstart:Mi,touchmove:mr,touchend:Yt,touchcancel:ci},z="touchstart",V="touchstart touchmove touchend touchcancel";function Y(){this.evTarget=z,this.evWin=V,this.started=!1,ui.apply(this,arguments)}fe(Y,ui,{handler:function(K){var pe=ne[K.type];if(pe===Mi&&(this.started=!0),!!this.started){var Ce=oe.call(this,K,pe);pe&(Yt|ci)&&Ce[0].length-Ce[1].length===0&&(this.started=!1),this.callback(this.manager,pe,{pointers:Ce[0],changedPointers:Ce[1],pointerType:_r,srcEvent:K})}}});function oe(X,K){var pe=tt(X.touches),Ce=tt(X.changedTouches);return K&(Yt|ci)&&(pe=pt(pe.concat(Ce),"identifier",!0)),[pe,Ce]}var le={touchstart:Mi,touchmove:mr,touchend:Yt,touchcancel:ci},be="touchstart touchmove touchend touchcancel";function _e(){this.evTarget=be,this.targetIds={},ui.apply(this,arguments)}fe(_e,ui,{handler:function(K){var pe=le[K.type],Ce=he.call(this,K,pe);Ce&&this.callback(this.manager,pe,{pointers:Ce[0],changedPointers:Ce[1],pointerType:_r,srcEvent:K})}});function he(X,K){var pe=tt(X.touches),Ce=this.targetIds;if(K&(Mi|mr)&&pe.length===1)return Ce[pe[0].identifier]=!0,[pe,pe];var qe,ut,Ot=tt(X.changedTouches),Oi=[],Wi=this.target;if(ut=pe.filter(function(hr){return ke(hr.target,Wi)}),K===Mi)for(qe=0;qe<ut.length;)Ce[ut[qe].identifier]=!0,qe++;for(qe=0;qe<Ot.length;)Ce[Ot[qe].identifier]&&Oi.push(Ot[qe]),K&(Yt|ci)&&delete Ce[Ot[qe].identifier],qe++;if(Oi.length)return[pt(ut.concat(Oi),"identifier",!0),Oi]}var ye=2500,De=25;function Ne(){ui.apply(this,arguments);var X=re(this.handler,this);this.touch=new _e(this.manager,X),this.mouse=new Pt(this.manager,X),this.primaryTouch=null,this.lastTouches=[]}fe(Ne,ui,{handler:function(K,pe,Ce){var qe=Ce.pointerType==_r,ut=Ce.pointerType==sr;if(!(ut&&Ce.sourceCapabilities&&Ce.sourceCapabilities.firesTouchEvents)){if(qe)ze.call(this,pe,Ce);else if(ut&&St.call(this,Ce))return;this.callback(K,pe,Ce)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ze(X,K){X&Mi?(this.primaryTouch=K.changedPointers[0].identifier,yt.call(this,K)):X&(Yt|ci)&&yt.call(this,K)}function yt(X){var K=X.changedPointers[0];if(K.identifier===this.primaryTouch){var pe={x:K.clientX,y:K.clientY};this.lastTouches.push(pe);var Ce=this.lastTouches,qe=function(){var ut=Ce.indexOf(pe);ut>-1&&Ce.splice(ut,1)};setTimeout(qe,ye)}}function St(X){for(var K=X.srcEvent.clientX,pe=X.srcEvent.clientY,Ce=0;Ce<this.lastTouches.length;Ce++){var qe=this.lastTouches[Ce],ut=Math.abs(K-qe.x),Ot=Math.abs(pe-qe.y);if(ut<=De&&Ot<=De)return!0}return!1}var lt=ot(h.style,"touchAction"),xt=lt!==n,Et="compute",Ht="auto",qt="manipulation",Rt="none",Mt="pan-x",ki="pan-y",Kt=Br();function Ti(X,K){this.manager=X,this.set(K)}Ti.prototype={set:function(X){X==Et&&(X=this.compute()),xt&&this.manager.element.style&&Kt[X]&&(this.manager.element.style[lt]=X),this.actions=X.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var X=[];return M(this.manager.recognizers,function(K){ue(K.options.enable,[K])&&(X=X.concat(K.getTouchAction()))}),Zi(X.join(" "))},preventDefaults:function(X){var K=X.srcEvent,pe=X.offsetDirection;if(this.manager.session.prevented){K.preventDefault();return}var Ce=this.actions,qe=je(Ce,Rt)&&!Kt[Rt],ut=je(Ce,ki)&&!Kt[ki],Ot=je(Ce,Mt)&&!Kt[Mt];if(qe){var Oi=X.pointers.length===1,Wi=X.distance<2,hr=X.deltaTime<250;if(Oi&&Wi&&hr)return}if(!(Ot&&ut)&&(qe||ut&&pe&or||Ot&&pe&yr))return this.preventSrc(K)},preventSrc:function(X){this.manager.session.prevented=!0,X.preventDefault()}};function Zi(X){if(je(X,Rt))return Rt;var K=je(X,Mt),pe=je(X,ki);return K&&pe?Rt:K||pe?K?Mt:ki:je(X,qt)?qt:Ht}function Br(){if(!xt)return!1;var X={},K=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(pe){X[pe]=K?e.CSS.supports("touch-action",pe):!0}),X}var io=1,Yi=2,on=4,Yn=8,Dt=Yn,ps=16,Ar=32;function di(X){this.options=j({},this.defaults,X||{}),this.id=rn(),this.manager=null,this.options.enable=Me(this.options.enable,!0),this.state=io,this.simultaneous={},this.requireFail=[]}di.prototype={defaults:{},set:function(X){return j(this.options,X),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(X){if(P(X,"recognizeWith",this))return this;var K=this.simultaneous;return X=ur(X,this),K[X.id]||(K[X.id]=X,X.recognizeWith(this)),this},dropRecognizeWith:function(X){return P(X,"dropRecognizeWith",this)?this:(X=ur(X,this),delete this.simultaneous[X.id],this)},requireFailure:function(X){if(P(X,"requireFailure",this))return this;var K=this.requireFail;return X=ur(X,this),ct(K,X)===-1&&(K.push(X),X.requireFailure(this)),this},dropRequireFailure:function(X){if(P(X,"dropRequireFailure",this))return this;X=ur(X,this);var K=ct(this.requireFail,X);return K>-1&&this.requireFail.splice(K,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(X){return!!this.simultaneous[X.id]},emit:function(X){var K=this,pe=this.state;function Ce(qe){K.manager.emit(qe,X)}pe<Yn&&Ce(K.options.event+xr(pe)),Ce(K.options.event),X.additionalEvent&&Ce(X.additionalEvent),pe>=Yn&&Ce(K.options.event+xr(pe))},tryEmit:function(X){if(this.canEmit())return this.emit(X);this.state=Ar},canEmit:function(){for(var X=0;X<this.requireFail.length;){if(!(this.requireFail[X].state&(Ar|io)))return!1;X++}return!0},recognize:function(X){var K=j({},X);if(!ue(this.options.enable,[this,K])){this.reset(),this.state=Ar;return}this.state&(Dt|ps|Ar)&&(this.state=io),this.state=this.process(K),this.state&(Yi|on|Yn|ps)&&this.tryEmit(K)},process:function(X){},getTouchAction:function(){},reset:function(){}};function xr(X){return X&ps?"cancel":X&Yn?"end":X&on?"move":X&Yi?"start":""}function fl(X){return X==Tn?"down":X==Er?"up":X==Nr?"left":X==Nn?"right":""}function ur(X,K){var pe=K.manager;return pe?pe.get(X):X}function ri(){di.apply(this,arguments)}fe(ri,di,{defaults:{pointers:1},attrTest:function(X){var K=this.options.pointers;return K===0||X.pointers.length===K},process:function(X){var K=this.state,pe=X.eventType,Ce=K&(Yi|on),qe=this.attrTest(X);return Ce&&(pe&ci||!qe)?K|ps:Ce||qe?pe&Yt?K|Yn:K&Yi?K|on:Yi:Ar}});function gs(){ri.apply(this,arguments),this.pX=null,this.pY=null}fe(gs,ri,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ln},getTouchAction:function(){var X=this.options.direction,K=[];return X&or&&K.push(ki),X&yr&&K.push(Mt),K},directionTest:function(X){var K=this.options,pe=!0,Ce=X.distance,qe=X.direction,ut=X.deltaX,Ot=X.deltaY;return qe&K.direction||(K.direction&or?(qe=ut===0?Xn:ut<0?Nr:Nn,pe=ut!=this.pX,Ce=Math.abs(X.deltaX)):(qe=Ot===0?Xn:Ot<0?Er:Tn,pe=Ot!=this.pY,Ce=Math.abs(X.deltaY))),X.direction=qe,pe&&Ce>K.threshold&&qe&K.direction},attrTest:function(X){return ri.prototype.attrTest.call(this,X)&&(this.state&Yi||!(this.state&Yi)&&this.directionTest(X))},emit:function(X){this.pX=X.deltaX,this.pY=X.deltaY;var K=fl(X.direction);K&&(X.additionalEvent=this.options.event+K),this._super.emit.call(this,X)}});function Kn(){ri.apply(this,arguments)}fe(Kn,ri,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Rt]},attrTest:function(X){return this._super.attrTest.call(this,X)&&(Math.abs(X.scale-1)>this.options.threshold||this.state&Yi)},emit:function(X){if(X.scale!==1){var K=X.scale<1?"in":"out";X.additionalEvent=this.options.event+K}this._super.emit.call(this,X)}});function ai(){di.apply(this,arguments),this._timer=null,this._input=null}fe(ai,di,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ht]},process:function(X){var K=this.options,pe=X.pointers.length===K.pointers,Ce=X.distance<K.threshold,qe=X.deltaTime>K.time;if(this._input=X,!Ce||!pe||X.eventType&(Yt|ci)&&!qe)this.reset();else if(X.eventType&Mi)this.reset(),this._timer=S(function(){this.state=Dt,this.tryEmit()},K.time,this);else if(X.eventType&Yt)return Dt;return Ar},reset:function(){clearTimeout(this._timer)},emit:function(X){this.state===Dt&&(X&&X.eventType&Yt?this.manager.emit(this.options.event+"up",X):(this._input.timeStamp=T(),this.manager.emit(this.options.event,this._input)))}});function $t(){ri.apply(this,arguments)}fe($t,ri,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Rt]},attrTest:function(X){return this._super.attrTest.call(this,X)&&(Math.abs(X.rotation)>this.options.threshold||this.state&Yi)}});function Un(){ri.apply(this,arguments)}fe(Un,ri,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:or|yr,pointers:1},getTouchAction:function(){return gs.prototype.getTouchAction.call(this)},attrTest:function(X){var K=this.options.direction,pe;return K&(or|yr)?pe=X.overallVelocity:K&or?pe=X.overallVelocityX:K&yr&&(pe=X.overallVelocityY),this._super.attrTest.call(this,X)&&K&X.offsetDirection&&X.distance>this.options.threshold&&X.maxPointers==this.options.pointers&&y(pe)>this.options.velocity&&X.eventType&Yt},emit:function(X){var K=fl(X.offsetDirection);K&&this.manager.emit(this.options.event+K,X),this.manager.emit(this.options.event,X)}});function li(){di.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}fe(li,di,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[qt]},process:function(X){var K=this.options,pe=X.pointers.length===K.pointers,Ce=X.distance<K.threshold,qe=X.deltaTime<K.time;if(this.reset(),X.eventType&Mi&&this.count===0)return this.failTimeout();if(Ce&&qe&&pe){if(X.eventType!=Yt)return this.failTimeout();var ut=this.pTime?X.timeStamp-this.pTime<K.interval:!0,Ot=!this.pCenter||An(this.pCenter,X.center)<K.posThreshold;this.pTime=X.timeStamp,this.pCenter=X.center,!Ot||!ut?this.count=1:this.count+=1,this._input=X;var Oi=this.count%K.taps;if(Oi===0)return this.hasRequireFailures()?(this._timer=S(function(){this.state=Dt,this.tryEmit()},K.interval,this),Yi):Dt}return Ar},failTimeout:function(){return this._timer=S(function(){this.state=Ar},this.options.interval,this),Ar},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Dt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function zr(X,K){return K=K||{},K.recognizers=Me(K.recognizers,zr.defaults.preset),new In(X,K)}zr.VERSION="2.0.7",zr.defaults={domEvents:!1,touchAction:Et,enable:!0,inputTarget:null,inputClass:null,preset:[[$t,{enable:!1}],[Kn,{enable:!1},["rotate"]],[Un,{direction:or}],[gs,{direction:or},["swipe"]],[li],[li,{event:"doubletap",taps:2},["tap"]],[ai]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ur=1,Ro=2;function In(X,K){this.options=j({},zr.defaults,K||{}),this.options.inputTarget=this.options.inputTarget||X,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=X,this.input=Lr(this),this.touchAction=new Ti(this,this.options.touchAction),ba(this,!0),M(this.options.recognizers,function(pe){var Ce=this.add(new pe[0](pe[1]));pe[2]&&Ce.recognizeWith(pe[2]),pe[3]&&Ce.requireFailure(pe[3])},this)}In.prototype={set:function(X){return j(this.options,X),X.touchAction&&this.touchAction.update(),X.inputTarget&&(this.input.destroy(),this.input.target=X.inputTarget,this.input.init()),this},stop:function(X){this.session.stopped=X?Ro:Ur},recognize:function(X){var K=this.session;if(!K.stopped){this.touchAction.preventDefaults(X);var pe,Ce=this.recognizers,qe=K.curRecognizer;(!qe||qe&&qe.state&Dt)&&(qe=K.curRecognizer=null);for(var ut=0;ut<Ce.length;)pe=Ce[ut],K.stopped!==Ro&&(!qe||pe==qe||pe.canRecognizeWith(qe))?pe.recognize(X):pe.reset(),!qe&&pe.state&(Yi|on|Yn)&&(qe=K.curRecognizer=pe),ut++}},get:function(X){if(X instanceof di)return X;for(var K=this.recognizers,pe=0;pe<K.length;pe++)if(K[pe].options.event==X)return K[pe];return null},add:function(X){if(P(X,"add",this))return this;var K=this.get(X.options.event);return K&&this.remove(K),this.recognizers.push(X),X.manager=this,this.touchAction.update(),X},remove:function(X){if(P(X,"remove",this))return this;if(X=this.get(X),X){var K=this.recognizers,pe=ct(K,X);pe!==-1&&(K.splice(pe,1),this.touchAction.update())}return this},on:function(X,K){if(X!==n&&K!==n){var pe=this.handlers;return M(Ue(X),function(Ce){pe[Ce]=pe[Ce]||[],pe[Ce].push(K)}),this}},off:function(X,K){if(X!==n){var pe=this.handlers;return M(Ue(X),function(Ce){K?pe[Ce]&&pe[Ce].splice(ct(pe[Ce],K),1):delete pe[Ce]}),this}},emit:function(X,K){this.options.domEvents&&wa(X,K);var pe=this.handlers[X]&&this.handlers[X].slice();if(!(!pe||!pe.length)){K.type=X,K.preventDefault=function(){K.srcEvent.preventDefault()};for(var Ce=0;Ce<pe.length;)pe[Ce](K),Ce++}},destroy:function(){this.element&&ba(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ba(X,K){var pe=X.element;if(pe.style){var Ce;M(X.options.cssProps,function(qe,ut){Ce=ot(pe.style,ut),K?(X.oldCssProps[Ce]=pe.style[Ce],pe.style[Ce]=qe):pe.style[Ce]=X.oldCssProps[Ce]||""}),K||(X.oldCssProps={})}}function wa(X,K){var pe=i.createEvent("Event");pe.initEvent(X,!0,!0),pe.gesture=K,K.target.dispatchEvent(pe)}j(zr,{INPUT_START:Mi,INPUT_MOVE:mr,INPUT_END:Yt,INPUT_CANCEL:ci,STATE_POSSIBLE:io,STATE_BEGAN:Yi,STATE_CHANGED:on,STATE_ENDED:Yn,STATE_RECOGNIZED:Dt,STATE_CANCELLED:ps,STATE_FAILED:Ar,DIRECTION_NONE:Xn,DIRECTION_LEFT:Nr,DIRECTION_RIGHT:Nn,DIRECTION_UP:Er,DIRECTION_DOWN:Tn,DIRECTION_HORIZONTAL:or,DIRECTION_VERTICAL:yr,DIRECTION_ALL:Ln,Manager:In,Input:ui,TouchAction:Ti,TouchInput:_e,MouseInput:Pt,PointerEventInput:sn,TouchMouseInput:Ne,SingleTouchInput:Y,Recognizer:di,AttrRecognizer:ri,Tap:li,Pan:gs,Swipe:Un,Pinch:Kn,Rotate:$t,Press:ai,on:Oe,off:$e,each:M,merge:G,extend:Z,assign:j,inherit:fe,bindFn:re,prefixed:ot});var Mo=typeof e<"u"?e:typeof self<"u"?self:{};Mo.Hammer=zr,typeof n=="function"&&n.amd?n(function(){return zr}):t.exports?t.exports=zr:e[r]=zr})(window,document,"Hammer")})(qS);var $h=qS.exports;const PL=Wp($h),Hs=MP({__proto__:null,default:PL},[$h]),XS=1,ZS=2,Hm=4,IL={mousedown:XS,mousemove:ZS,mouseup:Hm};function CL(t,e){for(let i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}function RL(t){const e=t.prototype.handler;t.prototype.handler=function(r){const n=this.store;r.button>0&&r.type==="pointerdown"&&(CL(n,l=>l.pointerId===r.pointerId)||n.push(r)),e.call(this,r)}}function ML(t){t.prototype.handler=function(i){let r=IL[i.type];r&XS&&i.button>=0&&(this.pressed=!0),r&ZS&&i.buttons===0&&(r=Hm),this.pressed&&(r&Hm&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[i],changedPointers:[i],pointerType:"mouse",srcEvent:i}))}}RL($h.PointerEventInput);ML($h.MouseInput);const kL=$h.Manager;class Qp{constructor(e,i,r){this.element=e,this.callback=i,this.options={enable:!0,...r}}}const OL=Hs?[[Hs.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Hs.Rotate,{enable:!1}],[Hs.Pinch,{enable:!1}],[Hs.Swipe,{enable:!1}],[Hs.Pan,{threshold:0,enable:!1}],[Hs.Press,{enable:!1}],[Hs.Tap,{event:"doubletap",taps:2,enable:!1}],[Hs.Tap,{event:"anytap",enable:!1}],[Hs.Tap,{enable:!1}]]:null,Hb={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},FL={doubletap:["tap"]},DL={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Xy={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},NL={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},qb={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},LL=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",hc=typeof window<"u"?window:global;let qm=!1;try{const t={get passive(){return qm=!0,!0}};hc.addEventListener("test",null,t),hc.removeEventListener("test",null)}catch{qm=!1}const BL=LL.indexOf("firefox")!==-1,{WHEEL_EVENTS:zL}=Xy,Xb="wheel",Zb=4.000244140625,UL=40,VL=.25;class $L extends Qp{constructor(e,i,r){super(e,i,r),this.handleEvent=n=>{if(!this.options.enable)return;let l=n.deltaY;hc.WheelEvent&&(BL&&n.deltaMode===hc.WheelEvent.DOM_DELTA_PIXEL&&(l/=hc.devicePixelRatio),n.deltaMode===hc.WheelEvent.DOM_DELTA_LINE&&(l*=UL)),l!==0&&l%Zb===0&&(l=Math.floor(l/Zb)),n.shiftKey&&l&&(l=l*VL),this.callback({type:Xb,center:{x:n.clientX,y:n.clientY},delta:-l,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(zL),this.events.forEach(n=>e.addEventListener(n,this.handleEvent,qm?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===Xb&&(this.options.enable=i)}}const{MOUSE_EVENTS:jL}=Xy,Yb="pointermove",Kb="pointerover",Gb="pointerout",Jb="pointerenter",Qb="pointerleave";class WL extends Qp{constructor(e,i,r){super(e,i,r),this.handleEvent=l=>{this.handleOverEvent(l),this.handleOutEvent(l),this.handleEnterEvent(l),this.handleLeaveEvent(l),this.handleMoveEvent(l)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(jL),this.events.forEach(l=>e.addEventListener(l,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===Yb&&(this.enableMoveEvent=i),e===Kb&&(this.enableOverEvent=i),e===Gb&&(this.enableOutEvent=i),e===Jb&&(this.enableEnterEvent=i),e===Qb&&(this.enableLeaveEvent=i)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Kb,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(Gb,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(Jb,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Qb,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(Yb,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:HL}=Xy,e1="keydown",t1="keyup";class qL extends Qp{constructor(e,i,r){super(e,i,r),this.handleEvent=n=>{const l=n.target||n.srcElement;l.tagName==="INPUT"&&l.type==="text"||l.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:e1,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:t1,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(HL),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===e1&&(this.enableDownEvent=i),e===t1&&(this.enableUpEvent=i)}}const i1="contextmenu";class XL extends Qp{constructor(e,i,r){super(e,i,r),this.handleEvent=n=>{this.options.enable&&this.callback({type:i1,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e===i1&&(this.options.enable=i)}}const r1=1,Xm=2,n1=4,ZL={pointerdown:r1,pointermove:Xm,pointerup:n1,mousedown:r1,mousemove:Xm,mouseup:n1},YL=0,KL=1,GL=2,JL=1,QL=2,eB=4;function tB(t){const e=ZL[t.srcEvent.type];if(!e)return null;const{buttons:i,button:r}=t.srcEvent;let n=!1,l=!1,h=!1;return e===Xm?(n=!!(i&JL),l=!!(i&eB),h=!!(i&QL)):(n=r===YL,l=r===KL,h=r===GL),{leftButton:n,middleButton:l,rightButton:h}}function iB(t,e){const i=t.center;if(!i)return null;const r=e.getBoundingClientRect(),n=r.width/e.offsetWidth||1,l=r.height/e.offsetHeight||1,h={x:(i.x-r.left-e.clientLeft)/n,y:(i.y-r.top-e.clientTop)/l};return{center:i,offsetCenter:h}}const H_={srcElement:"root",priority:0};class rB{constructor(e){this.handleEvent=i=>{if(this.isEmpty())return;const r=this._normalizeEvent(i);let n=i.srcEvent.target;for(;n&&n!==r.rootElement;){if(this._emit(r,n),r.handled)return;n=n.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,r,n=!1,l=!1){const{handlers:h,handlersByElement:a}=this;let g=H_;typeof r=="string"||r&&r.addEventListener?g={...H_,srcElement:r}:r&&(g={...H_,...r});let y=a.get(g.srcElement);y||(y=[],a.set(g.srcElement,y));const T={type:e,handler:i,srcElement:g.srcElement,priority:g.priority};n&&(T.once=!0),l&&(T.passive=!0),h.push(T),this._active=this._active||!T.passive;let S=y.length-1;for(;S>=0&&!(y[S].priority>=T.priority);)S--;y.splice(S+1,0,T)}remove(e,i){const{handlers:r,handlersByElement:n}=this;for(let l=r.length-1;l>=0;l--){const h=r[l];if(h.type===e&&h.handler===i){r.splice(l,1);const a=n.get(h.srcElement);a.splice(a.indexOf(h),1),a.length===0&&n.delete(h.srcElement)}}this._active=r.some(l=>!l.passive)}_emit(e,i){const r=this.handlersByElement.get(i);if(r){let n=!1;const l=()=>{e.handled=!0},h=()=>{e.handled=!0,n=!0},a=[];for(let g=0;g<r.length;g++){const{type:y,handler:T,once:S}=r[g];if(T({...e,type:y,stopPropagation:l,stopImmediatePropagation:h}),S&&a.push(r[g]),n)break}for(let g=0;g<a.length;g++){const{type:y,handler:T}=a[g];this.remove(y,T)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...tB(e),...iB(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const nB={events:null,recognizers:null,recognizerOptions:{},Manager:kL,touchAction:"none",tabIndex:0};class sB{constructor(e=null,i){this._onBasicInput=n=>{const{srcEvent:l}=n,h=DL[l.type];h&&this.manager.emit(h,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...nB,...i},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:i}=this,r=i.Manager;this.manager=new r(e,{touchAction:i.touchAction,recognizers:i.recognizers||OL}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(Hb).forEach(n=>{const l=this.manager.get(n);l&&Hb[n].forEach(h=>{l.recognizeWith(h)})});for(const n in i.recognizerOptions){const l=this.manager.get(n);if(l){const h=i.recognizerOptions[n];delete h.enable,l.set(h)}}this.wheelInput=new $L(e,this._onOtherEvent,{enable:!1}),this.moveInput=new WL(e,this._onOtherEvent,{enable:!1}),this.keyInput=new qL(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new XL(e,this._onOtherEvent,{enable:!1});for(const[n,l]of this.events)l.isEmpty()||(this._toggleRecognizer(l.recognizerName,!0),this.manager.on(n,l.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,i,r){this._addEventHandler(e,i,r,!1)}once(e,i,r){this._addEventHandler(e,i,r,!0)}watch(e,i,r){this._addEventHandler(e,i,r,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){const{manager:r}=this;if(!r)return;const n=r.get(e);if(n&&n.options.enable!==i){n.set({enable:i});const l=FL[e];l&&!this.options.recognizers&&l.forEach(h=>{const a=r.get(h);i?(a.requireFailure(e),n.dropRequireFailure(h)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,i),this.moveInput.enableEventType(e,i),this.keyInput.enableEventType(e,i),this.contextmenuInput.enableEventType(e,i)}_addEventHandler(e,i,r,n,l){if(typeof e!="string"){r=i;for(const T in e)this._addEventHandler(T,e[T],r,n,l);return}const{manager:h,events:a}=this,g=qb[e]||e;let y=a.get(g);y||(y=new rB(this),a.set(g,y),y.recognizerName=NL[g]||g,h&&h.on(g,y.handleEvent)),y.add(e,i,r,n,l),y.isEmpty()||this._toggleRecognizer(y.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const h in e)this._removeEventHandler(h,e[h]);return}const{events:r}=this,n=qb[e]||e,l=r.get(n);if(l&&(l.remove(e,i),l.isEmpty())){const{recognizerName:h}=l;let a=!1;for(const g of r.values())if(g.recognizerName===h&&!g.isEmpty()){a=!0;break}a||this._toggleRecognizer(h,!1)}}}function Jo(){}const oB=({isDragging:t})=>t?"grabbing":"grab",YS={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Jo,onWebGLInitialized:Jo,onResize:Jo,onViewStateChange:Jo,onInteractionStateChange:Jo,onBeforeRender:Jo,onAfterRender:Jo,onLoad:Jo,onError:t=>Wt.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:oB,getTooltip:null,debug:!1,drawPickingColors:!1};class Zy{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Nh({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:n}=this;if(r.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(r.leftButton||r.rightButton)return;{const l=r.offsetCenter;if(!l)return;n.x=l.x,n.y=l.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=r},this._onEvent=r=>{const n=Dm[r.type],l=r.offsetCenter;if(!n||!l||!this.layerManager)return;const h=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:l.x,y:l.y,layers:h,viewports:this.getViewports(l)},this._lastPointerDownInfo),{layer:g}=a,y=g&&(g[n.handler]||g.props[n.handler]),T=this.props[n.handler];let S=!1;y&&(S=y.call(g,a,r)),S||(T==null||T(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{const n=r.offsetCenter,l=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=l.result[0]||l.emptyInfo},this.props={...YS,...e},e=this.props,e.viewState&&e.initialViewState&&Wt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&Wt.error("WebGL1 context not supported.")(),this.device=ch.attach(e.gl));let i=this.device;i||(vc.registerDevices([ch]),i=vc.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(i,e),this.setProps(e),e._typedArrayManagerProps&&Oc.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,r,n,l,h,a,g,y,T;(e=this.animationLoop)==null||e.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(n=this.viewManager)==null||n.finalize(),this.viewManager=null,(l=this.effectManager)==null||l.finalize(),this.effectManager=null,(h=this.deckRenderer)==null||h.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(g=this.eventManager)==null||g.destroy(),this.eventManager=null,(y=this.widgetManager)==null||y.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((T=this.canvas.parentElement)==null||T.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Wt.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Wt.removed("onLayerClick","onClick")(),e.initialViewState&&!qn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),l=this.effectManager.needsRedraw(e),h=this.deckRenderer.needsRedraw(e);return i=i||r||n||l||h,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return Fr(this.viewManager),this.viewManager.views}getViewports(e){return Fr(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(e)}_pick(e,i,r){Fr(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(i).timeStart();const l=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return n.get(i).timeEnd(),l}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),Fr(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){var n;if(!this.canvas)return;const{width:i,height:r}=e;if(i||i===0){const l=Number.isFinite(i)?`${i}px`:i;this.canvas.style.width=l}if(r||r===0){const l=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((n=e.style)==null?void 0:n.position)||"absolute",this.canvas.style.height=l}}_updateCanvasSize(){var n,l;const{canvas:e}=this;if(!e)return;const i=e.clientWidth??e.width,r=e.clientHeight??e.height;(i!==this.width||r!==this.height)&&(this.width=i,this.height=r,(n=this.viewManager)==null||n.setProps({width:i,height:r}),(l=this.layerManager)==null||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:r}))}_createAnimationLoop(e,i){const{gl:r,onError:n,useDevicePixels:l}=i;return new CF({device:e,useDevicePixels:l,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:h=>this._setDevice(h.device),onRender:this._onRenderFrame.bind(this),onError:n})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,i=Array.isArray(e)?e:e?[e]:[new lD({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var i,r,n;const{_pickRequest:e}=this;if(e.event){const{result:l,emptyInfo:h}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=l.length>0;let a=h,g=!1;for(const y of l)a=y,g=((i=y.layer)==null?void 0:i.onHover(y,e.event))||g;g||((n=(r=this.props).onHover)==null||n.call(r,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var n,l;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(n=this.device.canvasContext)==null?void 0:n.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof ch&&this.props.onWebGLInitialized(this.device.gl);const i=new AS;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new sB(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const h in Dm)this.eventManager.on(h,this._onEvent);this.viewManager=new XF({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new qF(this.device,{deck:this,stats:this.stats,viewport:r,timeline:i}),this.effectManager=new hD({deck:this,device:this.device}),this.deckRenderer=new pD(this.device),this.deckPicker=new vD(this.device),this.widgetManager=new TD({deck:this,parentElement:(l=this.canvas)==null?void 0:l.parentElement}),this.widgetManager.addDefault(new ED),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){var h;const{device:r,gl:n}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:n});const l={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(h=this.deckRenderer)==null||h.renderLayers(l),l.pass==="screen"&&this.widgetManager.onRedraw({viewports:l.viewports,layers:l.layers}),this.props.onAfterRender({device:r,gl:n})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Wt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const r=vc.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}Zy.defaultProps=YS;Zy.VERSION=PT;const aB=Zy;function lB(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return VT(t)}}const cB=UT;function pf(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Ja(t){return t.stride||t.size*t.bytesPerElement}function uB(t,e){return t.type===e.type&&t.size===e.size&&Ja(t)===Ja(e)&&(t.offset||0)===(e.offset||0)}function Zm(t,e){e.offset&&Wt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=Ja(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,n=e.elementOffset||0,l=r*i+n*t.bytesPerElement+(t.offset||0);return{...e,offset:l,stride:i}}function hB(t,e){const i=Zm(t,e);return{high:i,low:{...i,offset:i.offset+t.size*4}}}class dB{constructor(e,i,r){this._buffer=null,this.device=e,this.id=i.id||"",this.size=i.size||1;const n=i.logicalType||i.type,l=n==="float64";let{defaultValue:h}=i;h=Number.isFinite(h)?[h]:h||new Array(this.size).fill(0);let a;l?a="float32":!n&&i.isIndexed?a="uint32":a=n||"float32";let g=lB(n||a);this.doublePrecision=l,l&&i.fp64===!1&&(g=Float32Array),this.value=null,this.settings={...i,defaultType:g,defaultValue:h,logicalType:n,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:g.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ja(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Oc.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,i=null){const r={};if(this.state.constant){const n=this.value;if(i){const l=Zm(this.getAccessor(),i),h=l.offset/n.BYTES_PER_ELEMENT,a=l.size||this.size;r[e]=n.subarray(h,h+a)}else r[e]=n}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,i=null){const r=this.getAccessor(),n=[],l={name:this.id,byteStride:Ja(r),attributes:n};if(this.doublePrecision){const h=hB(r,i||{});n.push(pf(e,{...r,...h.high}),pf(`${e}64Low`,{...r,...h.low}))}else if(i){const h=Zm(r,i);n.push(pf(e,{...r,...h}))}else n.push(pf(e,r));return l}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const i=Array.from(this.value);e=[i,i]}else{const{value:i,numInstances:r,size:n}=this,l=r*n;if(i&&l&&i.length>=l){const h=new Array(n).fill(1/0),a=new Array(n).fill(-1/0);for(let g=0;g<l;)for(let y=0;y<n;y++){const T=i[g++];T<h[y]&&(h[y]=T),T>a[y]&&(a[y]=T)}e=[h,a]}}return this.state.bounds=e,e}setData(e){const{state:i}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Li?r={buffer:e}:r=e;const n={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)n.type="float32";else{const h=cB(r.value);n.type=n.normalized?h.replace("int","norm"):h}n.bytesPerElement=r.value.BYTES_PER_ELEMENT,n.stride=Ja(n)}if(i.bounds=null,r.constant){let l=r.value;if(l=this._normalizeValue(l,[],0),this.settings.normalized&&(l=this.normalizeConstant(l)),!(!i.constant||!this._areValuesEqual(l,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(l)?l:new Float32Array(l)}else if(r.buffer){const l=r.buffer;i.externalBuffer=l,i.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let l=r.value;i.externalBuffer=null,i.constant=!1,this.value=l;let{buffer:h}=this;const a=Ja(n),g=(n.vertexOffset||0)*a;if(this.doublePrecision&&l instanceof Float64Array&&(l=k_(l,n)),this.settings.isIndexed){const T=this.settings.defaultType;l.constructor!==T&&(l=new T(l))}const y=l.byteLength+g+a*2;(!h||h.byteLength<y)&&(h=this._createBuffer(y)),h.write(l,g)}return this.setAccessor(n),!0}updateSubBuffer(e={}){this.state.bounds=null;const i=this.value,{startOffset:r=0,endOffset:n}=e;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?k_(i,{size:this.size,startIndex:r,endIndex:n}):i.subarray(r,n),r*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,i=!1){const{state:r}=this,n=r.allocatedValue,l=Oc.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=l;const{byteOffset:h}=this;let{buffer:a}=this;return(!a||a.byteLength<l.byteLength+h)&&(a=this._createBuffer(l.byteLength+h),i&&n&&a.write(n instanceof Float64Array?k_(n,this):n,h)),r.allocatedValue=l,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:i}=e;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=i.BYTES_PER_ELEMENT<4),n)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Wt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(e).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(i=>i/255);case"unorm16":return new Float32Array(e).map(i=>i/65535);default:return e}}_normalizeValue(e,i,r){const{defaultValue:n,size:l}=this.settings;if(Number.isFinite(e))return i[r]=e,i;if(!e){let h=l;for(;--h>=0;)i[r+h]=n[h];return i}switch(l){case 4:i[r+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:i[r+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:i[r+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:i[r+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let h=l;for(;--h>=0;)i[r+h]=Number.isFinite(e[h])?e[h]:n[h]}return i}_areValuesEqual(e,i){if(!e||!i)return!1;const{size:r}=this;for(let n=0;n<r;n++)if(e[n]!==i[n])return!1;return!0}_createBuffer(e){var n;this._buffer&&this._buffer.destroy();const{isIndexed:i,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(n=this._buffer)==null?void 0:n.props,id:this.id,usage:i?Li.INDEX:Li.VERTEX,indexType:i?r:void 0,byteLength:e}),this._buffer}}const s1=[],o1=[];function eg(t,e=0,i=1/0){let r=s1;const n={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(o1.length=t.length,r=o1):r=s1,(e>0||Number.isFinite(i))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,i),n.index=e-1),{iterable:r,objectInfo:n}}function KS(t){return t&&t[Symbol.asyncIterator]}function GS(t,e){const{size:i,stride:r,offset:n,startIndices:l,nested:h}=e,a=t.BYTES_PER_ELEMENT,g=r?r/a:i,y=n?n/a:0,T=Math.floor((t.length-y)/g);return(S,{index:P,target:M})=>{if(!l){const G=P*g+y;for(let fe=0;fe<i;fe++)M[fe]=t[G+fe];return M}const B=l[P],j=l[P+1]||T;let Z;if(h){Z=new Array(j-B);for(let G=B;G<j;G++){const fe=G*g+y;M=new Array(i);for(let re=0;re<i;re++)M[re]=t[fe+re];Z[G-B]=M}}else if(g===i)Z=t.subarray(B*i+y,j*i+y);else{Z=new t.constructor((j-B)*i);let G=0;for(let fe=B;fe<j;fe++){const re=fe*g+y;for(let ue=0;ue<i;ue++)Z[G++]=t[re+ue]}}return Z}}const fB=[],Df=[[0,1/0]];function pB(t,e){if(t===Df||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const i=[],r=t.length;let n=0;for(let l=0;l<r;l++){const h=t[l];h[1]<e[0]?(i.push(h),n=l+1):h[0]>e[1]?i.push(h):e=[Math.min(h[0],e[0]),Math.max(h[1],e[1])]}return i.splice(n,0,e),i}const gB={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function JS(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const i=t.type||"interpolation";return{...gB[i],...e,...t,type:i}}class QS extends dB{constructor(e,i){super(e,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Df}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!e,i}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var i;(i=this.state).layoutChanged||(i.layoutChanged=!uB(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:i}=this.settings,r=this.settings.transition,n=Array.isArray(i)?e[i.find(l=>e[l])]:e[i];return JS(n,r)}setNeedsUpdate(e=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),i){const{startRow:r=0,endRow:n=1/0}=i;this.state.updateRanges=pB(this.state.updateRanges,[r,n])}else this.state.updateRanges=Df}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=fB}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:i,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,i.updateRanges!==Df),!0):!1}updateBuffer({numInstances:e,data:i,props:r,context:n}){if(!this.needsUpdate())return!1;const{state:{updateRanges:l},settings:{update:h,noAlloc:a}}=this;let g=!0;if(h){for(const[y,T]of l)h.call(n,this,{data:i,startRow:y,endRow:T,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[y,T]of l){const S=Number.isFinite(y)?this.getVertexOffset(y):0,P=Number.isFinite(T)?this.getVertexOffset(T):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:S,endOffset:P})}this._checkAttributeArray()}else g=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),g}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:i}=this;return e?(this.clearNeedsUpdate(),i.lastExternalBuffer===e||(i.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(e,i=null){const{state:r,settings:n}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),n.transform||i!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const h=e;Fr(ArrayBuffer.isView(h.value),`invalid ${n.accessor}`);const a=!!h.size&&h.size!==this.size;return r.binaryAccessor=GS(h.value,{size:h.size||this.size,stride:h.stride,offset:h.offset,startIndices:i,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:i}=this;return(i?e<i.length?i[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,i=super.getValue();if(!e)return i;for(const r in e)Object.assign(i,super.getValue(r,e[r]));return i}getBufferLayout(e){this.state.layoutChanged=!1;const i=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:n}=this.settings;if(n==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=n??"vertex",!i)return r;for(const l in i){const h=super._getBufferLayout(l,i[l]);r.attributes.push(...h.attributes)}return r}_autoUpdater(e,{data:i,startRow:r,endRow:n,props:l,numInstances:h}){if(e.constant)return;const{settings:a,state:g,value:y,size:T,startIndices:S}=e,{accessor:P,transform:M}=a,B=g.binaryAccessor||(typeof P=="function"?P:l[P]);Fr(typeof B=="function",`accessor "${P}" is not a function`);let j=e.getVertexOffset(r);const{iterable:Z,objectInfo:G}=eg(i,r,n);for(const fe of Z){G.index++;let re=B(fe,G);if(M&&(re=M.call(this,re)),S){const ue=(G.index<S.length-1?S[G.index+1]:h)-S[G.index];if(re&&Array.isArray(re[0])){let Me=j;for(const Oe of re)e._normalizeValue(Oe,y,Me),Me+=T}else re&&re.length>T?y.set(re,j):(e._normalizeValue(re,G.target,0),VF({target:y,source:G.target,start:j,count:ue}));j+=ue*T}else e._normalizeValue(re,y,j),j+=T}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,i=Math.min(4,this.size);if(e&&e.length>=i){let r=!0;switch(i){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function q_(t){const{source:e,target:i,start:r=0,size:n,getData:l}=t,h=t.end||i.length,a=e.length,g=h-r;if(a>g){i.set(e.subarray(0,g),r);return}if(i.set(e,r),!l)return;let y=a;for(;y<g;){const T=l(y,e);for(let S=0;S<n;S++)i[r+y]=T[S]||0,y++}}function _B({source:t,target:e,size:i,getData:r,sourceStartIndices:n,targetStartIndices:l}){if(!n||!l)return q_({source:t,target:e,size:i,getData:r}),e;let h=0,a=0;const g=r&&((T,S)=>r(T+a,S)),y=Math.min(n.length,l.length);for(let T=1;T<y;T++){const S=n[T]*i,P=l[T]*i;q_({source:t.subarray(h,S),target:e,start:a,end:P,size:i,getData:g}),h=S,a=P}return a<e.length&&q_({source:[],target:e,start:a,size:i,getData:g}),e}function mB(t){const{device:e,settings:i,value:r}=t,n=new QS(e,i);return n.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),n}function eE(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function tE(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function iE(t){t.push(t.shift())}function yB(t,e){const{doublePrecision:i,settings:r,value:n,size:l}=t,h=i&&n instanceof Float64Array?2:1;let a=0;const{shaderAttributes:g}=t.settings;if(g)for(const y of Object.values(g))a=Math.max(a,y.vertexOffset??0);return(r.noAlloc?n.length:(e+a)*l)*h}function rE({device:t,source:e,target:i}){return(!i||i.byteLength<e.byteLength)&&(i==null||i.destroy(),i=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),i}function nE({device:t,buffer:e,attribute:i,fromLength:r,toLength:n,fromStartIndices:l,getData:h=a=>a}){const a=i.doublePrecision&&i.value instanceof Float64Array?2:1,g=i.size*a,y=i.byteOffset,T=i.settings.bytesPerElement<4?y/i.settings.bytesPerElement*4:y,S=i.startIndices,P=l&&S,M=i.isConstant;if(!P&&e&&r>=n)return e;const B=i.value instanceof Float64Array?Float32Array:i.value.constructor,j=M?i.value:new B(i.getBuffer().readSyncWebGL(y,n*B.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!M){const re=h;h=(ue,Me)=>i.normalizeConstant(re(ue,Me))}const Z=M?(re,ue)=>h(j,ue):(re,ue)=>h(j.subarray(re+y,re+y+g),ue),G=e?new Float32Array(e.readSyncWebGL(T,r*4).buffer):new Float32Array(0),fe=new Float32Array(n);return _B({source:G,target:fe,sourceStartIndices:l,targetStartIndices:S,size:g,getData:Z}),(!e||e.byteLength<fe.byteLength+T)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:fe.byteLength+T,usage:35050})),e.write(fe,T),e}class sE{constructor({device:e,attribute:i,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Kp(r),this.attribute=i,this.attributeInTransition=mB(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(e,i,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=yB(this.attribute,i),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class xB extends sE{constructor({device:e,attribute:i,timeline:r}){super({device:e,attribute:i,timeline:r}),this.type="interpolation",this.transform=wB(e,i)}start(e,i){const r=this.currentLength,n=this.currentStartIndices;if(super.start(e,i,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:l,attribute:h}=this;iE(l),l[0]=nE({device:this.device,buffer:l[0],attribute:h,fromLength:r,toLength:this.currentLength,fromStartIndices:n,getData:e.enter}),l[1]=rE({device:this.device,source:l[0],target:l[1]}),this.setBuffer(l[1]);const{transform:a}=this,g=a.model;let y=Math.floor(this.currentLength/h.size);oE(h)&&(y/=2),g.setVertexCount(y),h.isConstant?(g.setAttributes({aFrom:l[0]}),g.setConstantAttributes({aTo:h.value})):g.setAttributes({aFrom:l[0],aTo:h.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:l[1]})}onUpdate(){const{duration:e,easing:i}=this.settings,{time:r}=this.transition;let n=r/e;i&&(n=i(n));const{model:l}=this.transform;l.setUniforms({time:n}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const vB=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,bB=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function oE(t){return t.doublePrecision&&t.value instanceof Float64Array}function wB(t,e){const i=e.size,r=eE(i),n=tE(i),l=e.getBufferLayout();return oE(e)?new vh(t,{vs:bB,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*i}]}],modules:[N3],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new vh(t,{vs:vB,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:l.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class TB extends sE{constructor({device:e,attribute:i,timeline:r}){super({device:e,attribute:i,timeline:r}),this.type="spring",this.texture=PB(e),this.framebuffer=IB(e,this.texture),this.transform=AB(e,i)}start(e,i){const r=this.currentLength,n=this.currentStartIndices;super.start(e,i);const{buffers:l,attribute:h}=this;for(let g=0;g<2;g++)l[g]=nE({device:this.device,buffer:l[g],attribute:h,fromLength:r,toLength:this.currentLength,fromStartIndices:n,getData:e.enter});l[2]=rE({device:this.device,source:l[0],target:l[2]}),this.setBuffer(l[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/h.size)),h.isConstant?a.setConstantAttributes({aTo:h.value}):a.setAttributes({aTo:h.getBuffer()})}onUpdate(){const{buffers:e,transform:i,framebuffer:r,transition:n}=this,l=this.settings;i.model.setAttributes({aPrev:e[0],aCur:e[1]}),i.transformFeedback.setBuffers({vNext:e[2]}),i.model.setUniforms({stiffness:l.stiffness,damping:l.damping}),i.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),iE(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||n.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const SB=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,EB=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function AB(t,e){const i=eE(e.size),r=tE(e.size);return new vh(t,{vs:SB,fs:EB,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function PB(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function IB(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const CB={interpolation:xB,spring:TB};class RB{constructor(e,{id:i,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:i,numInstances:r}){this.numInstances=r||1;for(const n in e){const l=e[n],h=l.getTransitionSetting(i);h&&this._updateAttribute(n,l,h)}for(const n in this.transitions){const l=e[n];(!l||!l.getTransitionSetting(i))&&this._removeTransition(n)}}hasAttribute(e){const i=this.transitions[e];return i&&i.inProgress}getAttributes(){const e={};for(const i in this.transitions){const r=this.transitions[i];r.inProgress&&(e[i]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,i,r){const n=this.transitions[e];let l=!n||n.type!==r.type;if(l){n&&this._removeTransition(e);const h=CB[r.type];h?this.transitions[e]=new h({attribute:i,timeline:this.timeline,device:this.device}):(Wt.error(`unsupported transition type '${r.type}'`)(),l=!1)}(l||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const a1="attributeManager.invalidate",MB="attributeManager.updateStart",kB="attributeManager.updateEnd",OB="attribute.updateStart",FB="attribute.allocate",DB="attribute.updateEnd";class NB{constructor(e,{id:i="attribute-manager",stats:r,timeline:n}={}){this.mergeBoundsMemoized=zh(yF),this.id=i,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new RB(e,{id:`${i}-transitions`,timeline:n}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const i of e)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(e,i){const r=this._invalidateTrigger(e,i);Gr(a1,this,e,r)}invalidateAll(e){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,e);Gr(a1,this,"all")}update({data:e,numInstances:i,startIndices:r=null,transitions:n,props:l={},buffers:h={},context:a={}}){let g=!1;Gr(MB,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const y in this.attributes){const T=this.attributes[y],S=T.settings.accessor;T.startIndices=r,T.numInstances=i,l[y]&&Wt.removed(`props.${y}`,`data.attributes.${y}`)(),T.setExternalBuffer(h[y])||T.setBinaryValue(typeof S=="string"?h[S]:void 0,e.startIndices)||typeof S=="string"&&!h[S]&&T.setConstantValue(l[S])||T.needsUpdate()&&(g=!0,this._updateAttribute({attribute:T,numInstances:i,data:e,props:l,context:a})),this.needsRedraw=this.needsRedraw||T.needsRedraw()}g&&Gr(kB,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:n})}updateTransition(){const{attributeTransitionManager:e}=this,i=e.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const i=e.map(r=>{var n;return(n=this.attributes[r])==null?void 0:n.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:r}=this,n={...r.getAttributes()};for(const l in i){const h=i[l];h.needsRedraw(e)&&!r.hasAttribute(l)&&(n[l]=h)}return n}getBufferLayouts(e){return Object.values(this.getAttributes()).map(i=>i.getBufferLayout(e))}_add(e,i){for(const r in e){const n=e[r],l={...n,id:r,size:n.isIndexed&&1||n.size||1,...i};this.attributes[r]=new QS(this.device,l)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(i)});this.updateTriggers=e}_invalidateTrigger(e,i){const{attributes:r,updateTriggers:n}=this,l=n[e];return l&&l.forEach(h=>{const a=r[h];a&&a.setNeedsUpdate(a.id,i)}),l}_updateAttribute(e){const{attribute:i,numInstances:r}=e;if(Gr(OB,i),i.constant){i.setConstantValue(i.value);return}i.allocate(r)&&Gr(FB,i,r),i.updateBuffer(e)&&(this.needsRedraw=!0,Gr(DB,i,r))}}class LB extends Kp{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:i,toValue:r,duration:n,easing:l}}=this,h=l(e/n);this._value=Cc(i,r,h)}}const l1=1e-5;function c1(t,e,i,r,n){const l=e-t,a=(i-e)*n,g=-l*r;return a+g+l+e}function BB(t,e,i,r,n){if(Array.isArray(i)){const l=[];for(let h=0;h<i.length;h++)l[h]=c1(t[h],e[h],i[h],r,n);return l}return c1(t,e,i,r,n)}function u1(t,e){if(Array.isArray(t)){let i=0;for(let r=0;r<t.length;r++){const n=t[r]-e[r];i+=n*n}return Math.sqrt(i)}return Math.abs(t-e)}class zB extends Kp{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:i,damping:r,stiffness:n}=this.settings,{_prevValue:l=e,_currValue:h=e}=this;let a=BB(l,h,i,r,n);const g=u1(a,i),y=u1(a,h);g<l1&&y<l1&&(a=i,this.end()),this._prevValue=h,this._currValue=a}}const UB={interpolation:LB,spring:zB};class VB{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,i,r,n){const{transitions:l}=this;if(l.has(e)){const g=l.get(e),{value:y=g.settings.fromValue}=g;i=y,this.remove(e)}if(n=JS(n),!n)return;const h=UB[n.type];if(!h){Wt.error(`unsupported transition type '${n.type}'`)();return}const a=new h(this.timeline);a.start({...n,fromValue:i,toValue:r}),l.set(e,a)}remove(e){const{transitions:i}=this;i.has(e)&&(i.get(e).cancel(),i.delete(e))}update(){const e={};for(const[i,r]of this.transitions)r.update(),e[i]=r.value,r.inProgress||this.remove(i);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function $B(t){const e=t[fa];for(const i in e){const r=e[i],{validate:n}=r;if(n&&!n(t[i],r))throw new Error(`Invalid prop ${i}: ${t[i]}`)}}function jB(t,e){const i=aE({newProps:t,oldProps:e,propTypes:t[fa],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=HB(t,e);let n=!1;return r||(n=qB(t,e)),{dataChanged:r,propsChanged:i,updateTriggersChanged:n,extensionsChanged:XB(t,e),transitionsChanged:WB(t,e)}}function WB(t,e){if(!t.transitions)return!1;const i={},r=t[fa];let n=!1;for(const l in t.transitions){const h=r[l],a=h&&h.type;(a==="number"||a==="color"||a==="array")&&Ym(t[l],e[l],h)&&(i[l]=!0,n=!0)}return n?i:!1}function aE({newProps:t,oldProps:e,ignoreProps:i={},propTypes:r={},triggerName:n="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${n} changed shallowly`;if(typeof e!="object"||e===null)return`${n} changed shallowly`;for(const l of Object.keys(t))if(!(l in i)){if(!(l in e))return`${n}.${l} added`;const h=Ym(t[l],e[l],r[l]);if(h)return`${n}.${l} ${h}`}for(const l of Object.keys(e))if(!(l in i)){if(!(l in t))return`${n}.${l} dropped`;if(!Object.hasOwnProperty.call(t,l)){const h=Ym(t[l],e[l],r[l]);if(h)return`${n}.${l} ${h}`}}return!1}function Ym(t,e,i){let r=i&&i.equal;return r&&!r(t,e,i)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function HB(t,e){if(e===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:r,_dataDiff:n}=t;return r?r(t.data,e.data)||(i="Data comparator detected a change"):t.data!==e.data&&(i="A new data container was supplied"),i&&n&&(i=n(t.data,e.data)||i),i}function qB(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&h1(t,e,"all"))return{all:!0};const i={};let r=!1;for(const n in t.updateTriggers)n!=="all"&&h1(t,e,n)&&(i[n]=!0,r=!0);return r?i:!1}function XB(t,e){if(e===null)return!0;const i=e.extensions,{extensions:r}=t;if(r===i)return!1;if(!i||!r||r.length!==i.length)return!0;for(let n=0;n<r.length;n++)if(!r[n].equals(i[n]))return!0;return!1}function h1(t,e,i){let r=t.updateTriggers[i];r=r??{};let n=e.updateTriggers[i];return n=n??{},aE({oldProps:n,newProps:r,triggerName:i})}const ZB="count(): argument not an object",YB="count(): argument not a container";function KB(t){if(!JB(t))throw new Error(ZB);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(GB(t))return Object.keys(t).length;throw new Error(YB)}function GB(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function JB(t){return t!==null&&typeof t=="object"}function d1(t,e){if(!e)return t;const i={...t,...e};if("defines"in e&&(i.defines={...t.defines,...e.defines}),"modules"in e&&(i.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=i.modules.findIndex(n=>n.name==="project32");r>=0&&i.modules.splice(r,1)}if("inject"in e)if(!t.inject)i.inject=e.inject;else{const r={...t.inject};for(const n in e.inject)r[n]=(r[n]||"")+e.inject[n];i.inject=r}return i}const QB={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Km={};function ez(t,e,i,r){if(i instanceof as)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let n=null;i.compressed&&(n={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const l=e.createTexture({...i,sampler:{...QB,...n,...r}});return Km[l.id]=t,l}function tz(t,e){!e||!(e instanceof as)||Km[e.id]===t&&(e.delete(),delete Km[e.id])}const iz={boolean:{validate(t,e){return!0},equal(t,e,i){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Gm(t)&&(t.length===3||t.length===4)},equal(t,e,i){return qn(t,e,1)}},accessor:{validate(t,e){const i=fp(t);return i==="function"||i===fp(e.value)},equal(t,e,i){return typeof e=="function"?!0:qn(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Gm(t)},equal(t,e,i){const{compare:r}=i,n=Number.isInteger(r)?r:r?1:0;return r?qn(t,e,n):t===e}},object:{equal(t,e,i){if(i.ignore)return!0;const{compare:r}=i,n=Number.isInteger(r)?r:r?1:0;return r?qn(t,e,n):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,i){return!i.compare&&i.ignore!==!1||t===e}},data:{transform:(t,e,i)=>{if(!t)return t;const{dataTransform:r}=i.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,i)=>{const r=i.context;return!r||!r.device?null:ez(i.id,r.device,t,{...e.parameters,...i.props.textureParameters})},release:(t,e,i)=>{tz(i.id,t)}}};function rz(t){const e={},i={},r={};for(const[n,l]of Object.entries(t)){const h=l==null?void 0:l.deprecatedFor;if(h)r[n]=Array.isArray(h)?h:[h];else{const a=nz(n,l);e[n]=a,i[n]=a.value}}return{propTypes:e,defaultProps:i,deprecatedProps:r}}function nz(t,e){switch(fp(e)){case"object":return Xu(t,e);case"array":return Xu(t,{type:"array",value:e,compare:!1});case"boolean":return Xu(t,{type:"boolean",value:e});case"number":return Xu(t,{type:"number",value:e});case"function":return Xu(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Xu(t,e){return"type"in e?{name:t,...iz[e.type],...e}:"value"in e?{name:t,type:fp(e.value),...e}:{name:t,type:"object",value:e}}function Gm(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function fp(t){return Gm(t)?"array":t===null?"null":typeof t}function sz(t,e){let i;for(let l=e.length-1;l>=0;l--){const h=e[l];"extensions"in h&&(i=h.extensions)}const r=Jm(t.constructor,i),n=Object.create(r);n[hp]=t,n[nl]={},n[oa]={};for(let l=0;l<e.length;++l){const h=e[l];for(const a in h)n[a]=h[a]}return Object.freeze(n),n}const oz="_mergedDefaultProps";function Jm(t,e){if(!(t instanceof cE.constructor))return{};let i=oz;if(e)for(const n of e){const l=n.constructor;l&&(i+=`:${l.extensionName||l.name}`)}const r=lE(t,i);return r||(t[i]=az(t,e||[]))}function az(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),n=Jm(r),l=lE(t,"defaultProps")||{},h=rz(l),a=Object.assign(Object.create(null),n,h.defaultProps),g=Object.assign(Object.create(null),n==null?void 0:n[fa],h.propTypes),y=Object.assign(Object.create(null),n==null?void 0:n[D_],h.deprecatedProps);for(const T of e){const S=Jm(T.constructor);S&&(Object.assign(a,S),Object.assign(g,S[fa]),Object.assign(y,S[D_]))}return lz(a,t),uz(a,g),cz(a,y),a[fa]=g,a[D_]=y,e.length===0&&!Yy(t,"_propTypes")&&(t._propTypes=g),a}function lz(t,e){const i=dz(e);Object.defineProperties(t,{id:{writable:!0,value:i}})}function cz(t,e){for(const i in e)Object.defineProperty(t,i,{enumerable:!1,set(r){const n=`${this.id}: ${i}`;for(const l of e[i])Yy(this,l)||(this[l]=r);Wt.deprecated(n,e[i].join("/"))()}})}function uz(t,e){const i={},r={};for(const n in e){const l=e[n],{name:h,value:a}=l;l.async&&(i[h]=a,r[h]=hz(h))}t[Tc]=i,t[nl]={},Object.defineProperties(t,r)}function hz(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||KS(e)?this[nl][t]=e:this[oa][t]=e},get(){if(this[oa]){if(t in this[oa])return this[oa][t]||this[Tc][t];if(t in this[nl]){const e=this[hp]&&this[hp].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Tc][t]}}return this[Tc][t]}}}function Yy(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function lE(t,e){return Yy(t,e)&&t[e]}function dz(t){const e=t.componentName;return e||Wt.warn(`${t.name}.componentName not specified`)(),e||t.name}let fz=0;class Ky{constructor(...e){this.props=sz(this,e),this.id=this.props.id,this.count=fz++}clone(e){const{props:i}=this,r={};for(const n in i[Tc])n in i[oa]?r[n]=i[oa][n]:n in i[nl]&&(r[n]=i[nl][n]);return new this.constructor({...i,...r,...e})}}Ky.componentName="Component";Ky.defaultProps={};const cE=Ky,pz=Object.freeze({});class gz{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const i=this.asyncProps[e];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||pz}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const i=this.asyncProps[e];return i&&i.resolvedValue}isAsyncPropLoading(e){if(e){const i=this.asyncProps[e];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(e,i){this._watchPromise(e,Promise.resolve(i))}setAsyncProps(e){this.component=e[hp]||this.component;const i=e[oa]||{},r=e[nl]||e,n=e[Tc]||{};for(const l in i){const h=i[l];this._createAsyncPropData(l,n[l]),this._updateAsyncProp(l,h),i[l]=this.getAsyncProp(l)}for(const l in r){const h=r[l];this._createAsyncPropData(l,n[l]),this._updateAsyncProp(l,h)}}_fetch(e,i){return null}_onResolve(e,i){}_onError(e,i){}_updateAsyncProp(e,i){if(this._didAsyncInputValueChange(e,i)){if(typeof i=="string"&&(i=this._fetch(e,i)),i instanceof Promise){this._watchPromise(e,i);return}if(KS(i)){this._resolveAsyncIterable(e,i);return}this._setPropValue(e,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,i){const r=this.asyncProps[e];return i===r.resolvedValue||i===r.lastValue?!1:(r.lastValue=i,!0)}_setPropValue(e,i){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(i=this._postProcessValue(r,i),r.resolvedValue=i,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,i,r){const n=this.asyncProps[e];n&&r>=n.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=i,n.resolvedLoadCount=r,this.onAsyncPropUpdated(e,i))}_watchPromise(e,i){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const n=r.pendingLoadCount;i.then(l=>{this.component&&(l=this._postProcessValue(r,l),this._setAsyncPropValue(e,l,n),this._onResolve(e,l))}).catch(l=>{this._onError(e,l)})}}async _resolveAsyncIterable(e,i){if(e!=="data"){this._setPropValue(e,i);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const n=r.pendingLoadCount;let l=[],h=0;for await(const a of i){if(!this.component)return;const{dataTransform:g}=this.component.props;g?l=g(a,l):l=l.concat(a),Object.defineProperty(l,"__diff",{enumerable:!1,value:[{startRow:h,endRow:l.length}]}),h=l.length,this._setAsyncPropValue(e,l,n)}this._onResolve(e,l)}_postProcessValue(e,i){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(i,r,this.component):i}_createAsyncPropData(e,i){if(!this.asyncProps[e]){const n=this.component&&this.component.props[fa];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class _z extends gz{constructor({attributeManager:e,layer:i}){super(i),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,i){const r=this.layer,n=r==null?void 0:r.props.fetch;return n?n(i,{propName:e,layer:r}):super._fetch(e,i)}_onResolve(e,i){const r=this.layer;if(r){const n=r.props.onDataLoad;e==="data"&&n&&n(i,{propName:e,layer:r})}}_onError(e,i){const r=this.layer;r&&r.raiseError(i,`loading ${e} of ${this.layer}`)}}const mz="layer.changeFlag",yz="layer.initialize",xz="layer.update",vz="layer.finalize",bz="layer.matched",f1=2**24-1,wz=Object.freeze([]),Tz=zh(({oldViewport:t,viewport:e})=>t.equals(e));let qs=new Uint8ClampedArray(0);const Sz={data:{type:"data",value:wz,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:i,loaders:r,loadOptions:n,signal:l})=>{const{resourceManager:h}=i.context;n=n||i.getLoadOptions(),r=r||i.props.loaders,l&&(n={...n,fetch:{...n==null?void 0:n.fetch,signal:l}});let a=h.contains(t);return!a&&!n&&(h.add({resourceId:t,data:Gf(t,r),persistent:!1}),a=!0),a?h.subscribe({resourceId:t,onChange:g=>{var y;return(y=i.internalState)==null?void 0:y.reloadAsyncProp(e,g)},consumerId:i.id,requestId:e}):Gf(t,r,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Qt.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Gy extends cE{constructor(){super(...arguments),this.internalState=null,this.lifecycle=sc.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Fr(this.internalState);const i=this.internalState.viewport||this.context.viewport,r=ES(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,l,h]=wS(r,i.pixelProjectionMatrix);return e.length===2?[n,l]:[n,l,h]}unproject(e){return Fr(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,i){Fr(this.internalState);const r=this.internalState.viewport||this.context.viewport;return SF(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const i of this.getModels())i.updateModuleSettings(e)}setShaderModuleProps(...e){for(const i of this.getModels())i.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Qt.DEFAULT||e===Qt.LNGLAT||e===Qt.CARTESIAN}onHover(e,i){return this.props.onHover&&this.props.onHover(e,i)||!1}onClick(e,i){return this.props.onClick&&this.props.onClick(e,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,i=[]){return i[0]=e+1&255,i[1]=e+1>>8&255,i[2]=e+1>>8>>8&255,i}decodePickingColor(e){Fr(e instanceof Uint8Array);const[i,r,n]=e;return i+r*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:KB(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=d1(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)e=d1(e,i.getShaders.call(this,i));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const i=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&i)if(Array.isArray(r))for(const n of r)i.invalidateAll(n);else i.invalidateAll();if(i){const{props:n}=e,l=this.internalState.hasPickingBuffer,h=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(l!==h){this.internalState.hasPickingBuffer=h;const{pickingColors:a,instancePickingColors:g}=i.attributes,y=a||g;y&&(h&&y.constant&&(y.constant=!1,i.invalidate(y.id)),!y.value&&!h&&(y.constant=!0,y.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const i of this.getModels())i.draw(e)}getPickingInfo({info:e,mode:i,sourceLayer:r}){const{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}raiseError(e,i){var r,n,l,h;i&&(e=new Error(`${i}: ${e.message}`,{cause:e})),(n=(r=this.props).onError)!=null&&n.call(r,e)||(h=(l=this.context)==null?void 0:l.onError)==null||h.call(l,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=e,(!i||!Tz({oldViewport:i,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const i=this.getAttributeManager();i&&(e==="all"?i.invalidateAll():i.invalidate(e))}updateAttributes(e){let i=!1;for(const r in e)e[r].layoutChanged()&&(i=!0);for(const r of this.getModels())this._setModelAttributes(r,e,i)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const i=this.props,r=this.getNumInstances(),n=this.getStartIndices();e.update({data:i.data,numInstances:r,startIndices:n,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const l=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(l)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const i=e.update(),r=Object.create(this.props);for(const n in i)Object.defineProperty(r,n,{value:i[n]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:i}){if(e.constant)return;const r=Math.floor(qs.length/4);if(this.internalState.usesPickingColorCache=!0,r<i){i>f1&&Wt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),qs=Oc.allocate(qs,i,{size:4,copy:!0,maxCount:Math.max(i,f1)});const n=Math.floor(qs.length/4),l=[];for(let h=r;h<n;h++)this.encodePickingColor(h,l),qs[h*4+0]=l[0],qs[h*4+1]=l[1],qs[h*4+2]=l[2]}e.value=qs.subarray(0,i*4)}_setModelAttributes(e,i,r=!1){var a;if(!Object.keys(i).length)return;if(r){const g=this.getAttributeManager();e.setBufferLayout(g.getBufferLayouts(e)),i=g.getAttributes()}const n=((a=e.userData)==null?void 0:a.excludeAttributes)||{},l={},h={};for(const g in i){if(n[g])continue;const y=i[g].getValue();for(const T in y){const S=y[T];S instanceof Li?i[g].settings.isIndexed?e.setIndexBuffer(S):l[T]=S:S&&(h[T]=S)}}e.setAttributes(l),e.setConstantAttributes(h)}disablePickingIndex(e){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,l=r||n,h=l&&i.attributes&&i.attributes[l.id];if(h&&h.value){const a=h.value,g=this.encodePickingColor(e);for(let y=0;y<i.length;y++){const T=l.getVertexOffset(y);a[T]===g[0]&&a[T+1]===g[1]&&a[T+2]===g[2]&&this._disablePickingIndex(y)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,n=i||r;if(!n)return;const l=n.getVertexOffset(e),h=n.getVertexOffset(e+1);n.buffer.write(new Uint8Array(h-l),l)}restorePickingColors(){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,r=e||i;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==qs.buffer&&(r.value=qs.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Fr(!this.internalState),Fr(Number.isFinite(this.props.coordinateSystem)),Gr(yz,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new _z({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Wt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new VB(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Gr(bz,this,this===e);const{state:i,internalState:r}=e;this!==e&&(this.internalState=r,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Gr(xz,this,e),!e)return;const i=this.props,r=this.context,n=this.internalState,l=r.viewport,h=this._updateUniformTransition();n.propsInTransition=h,r.viewport=n.viewport||l,this.props=h;try{const a=this._getUpdateParams(),g=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const T of this.props.extensions)T.updateState.call(this,a,T);const y=this.getModels()[0]!==g[0];this._postUpdate(a,y)}finally{r.viewport=l,this.props=i,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){Gr(vz,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:i=null,uniforms:r={},parameters:n={}}){this._updateAttributeTransition();const l=this.props,h=this.context;this.props=this.internalState.propsInTransition||l;const a=this.props.opacity;r.opacity=Math.pow(a,1/2.2);try{if(i){const{isActive:T,isAttribute:S}=i.picking;this.setModuleParameters(i),this.setShaderModuleProps({picking:{isActive:T,isAttribute:S}})}const{getPolygonOffset:g}=this.props,y=g&&g(r)||[0,0];h.device.setParametersWebGL({polygonOffset:y});for(const T of this.getModels())T.setParameters(n);h.device.withParametersWebGL(n,()=>{const T={renderPass:e,moduleParameters:i,uniforms:r,parameters:n,context:h};for(const S of this.props.extensions)S.draw.call(this,T,S);this.draw(T)})}finally{this.props=l}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const n in e)if(e[n]){let l=!1;switch(n){case"dataChanged":const h=e[n],a=i[n];h&&Array.isArray(a)&&(i.dataChanged=Array.isArray(h)?a.concat(h):h,l=!0);default:i[n]||(i[n]=e[n],l=!0)}l&&Gr(mz,this,n,e)}const r=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=r,i.somethingChanged=r||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,i){var n;const r=jB(e,i);if(r.updateTriggersChanged)for(const l in r.updateTriggersChanged)r.updateTriggersChanged[l]&&this.invalidateAttribute(l);if(r.transitionsChanged)for(const l in r.transitionsChanged)this.internalState.uniformTransitions.add(l,i[l],e[l],(n=e.transitions)==null?void 0:n[l]);return this.setChangeFlags(r)}validateProps(){$B(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const i={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(i.highlightColor=r(e)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new NB(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,i){const{props:r,oldProps:n}=e;this.setNeedsRedraw(),this._updateAttributes();const l=this.state.model;l!=null&&l.isInstanced&&l.setInstanceCount(this.getNumInstances());const{autoHighlight:h,highlightedObjectIndex:a,highlightColor:g}=r;if(i||n.autoHighlight!==h||n.highlightedObjectIndex!==a||n.highlightColor!==g){const y={};Array.isArray(g)&&(y.highlightColor=g),(i||n.autoHighlight!==h||a!==n.highlightedObjectIndex)&&(y.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:y})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),n=r?r.getNeedsRedraw(e):!1;if(i=i||n,i)for(const l of this.props.extensions)l.onNeedsRedraw.call(this,l);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Gy.defaultProps=Sz;Gy.layerName="Layer";const Lc=Gy,Ez="compositeLayer.renderLayers";class uE extends Lc{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:i}=e;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(e.object=i.__source.object,e.index=i.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,i){return i&&i.length}getSubLayerClass(e,i){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||i}getSubLayerRow(e,i,r){return e.__source={parent:this,object:i,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const i={index:-1,data:this.props.data,target:[]};return(r,n)=>r&&r.__source?(i.index=r.__source.index,e(r.__source.object,i)):e(r,n)}return e}getSubLayerProps(e={}){var $e;const{opacity:i,pickable:r,visible:n,parameters:l,getPolygonOffset:h,highlightedObjectIndex:a,autoHighlight:g,highlightColor:y,coordinateSystem:T,coordinateOrigin:S,wrapLongitude:P,positionFormat:M,modelMatrix:B,extensions:j,fetch:Z,operation:G,_subLayerProps:fe}=this.props,re={id:"",updateTriggers:{},opacity:i,pickable:r,visible:n,parameters:l,getPolygonOffset:h,highlightedObjectIndex:a,autoHighlight:g,highlightColor:y,coordinateSystem:T,coordinateOrigin:S,wrapLongitude:P,positionFormat:M,modelMatrix:B,extensions:j,fetch:Z,operation:G},ue=fe&&e.id&&fe[e.id],Me=ue&&ue.updateTriggers,Oe=e.id||"sublayer";if(ue){const ke=this.props[fa],je=e.type?e.type._propTypes:{};for(const Ue in ue){const ct=je[Ue]||ke[Ue];ct&&ct.type==="accessor"&&(ue[Ue]=this.getSubLayerAccessor(ue[Ue]))}}Object.assign(re,e,ue),re.id=`${this.props.id}-${Oe}`,re.updateTriggers={all:($e=this.props.updateTriggers)==null?void 0:$e.all,...e.updateTriggers,...Me};for(const ke of j){const je=ke.getSubLayerProps.call(this,ke);je&&Object.assign(re,je,{updateTriggers:Object.assign(re.updateTriggers,je.updateTriggers)})}return re}_updateAutoHighlight(e){for(const i of this.getSubLayers())i.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,i){let r=this.internalState.subLayers;const n=!r||this.needsUpdate();if(n){const l=this.renderLayers();r=Yp(l,Boolean),this.internalState.subLayers=r}Gr(Ez,this,n,r);for(const l of r)l.parent=this}}uE.layerName="CompositeLayer";const Jy=uE,gf=Math.PI/180,p1=180/Math.PI,Nf=6370972,dc=256;function Az(){const t=dc/Nf,e=Math.PI/180*dc;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class Pz extends $y{constructor(e={}){const{latitude:i=0,longitude:r=0,zoom:n=0,nearZMultiplier:l=.1,farZMultiplier:h=2,resolution:a=10}=e;let{height:g,altitude:y=1.5}=e;g=g||1,y=Math.max(.75,y);const T=new Qr().lookAt({eye:[0,-y,0],up:[0,0,1]}),S=Math.pow(2,n);T.rotateX(i*gf),T.rotateZ(-r*gf),T.scale(S/g);const P=Math.atan(.5/y),M=dc*2*S/g;super({...e,height:g,viewMatrix:T,longitude:r,latitude:i,zoom:n,distanceScales:Az(),fovyRadians:P*2,focalDistance:y,near:l,far:Math.min(2,1/M+1)*y*h}),this.latitude=i,this.longitude=r,this.resolution=a}get projectionMode(){return As.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const i={targetZ:e.z||0},r=this.unproject([0,this.height/2],i),n=this.unproject([this.width/2,0],i),l=this.unproject([this.width,this.height/2],i),h=this.unproject([this.width/2,this.height],i);return l[0]<this.longitude&&(l[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],l[0],n[0],h[0]),Math.min(r[1],l[1],n[1],h[1]),Math.max(r[0],l[0],n[0],h[0]),Math.max(r[1],l[1],n[1],h[1])]}unproject(e,{topLeft:i=!0,targetZ:r}={}){const[n,l,h]=e,a=i?l:this.height-l,{pixelUnprojectionMatrix:g}=this;let y;if(Number.isFinite(h))y=X_(g,[n,a,h,1]);else{const M=X_(g,[n,a,-1,1]),B=X_(g,[n,a,1,1]),j=((r||0)/Nf+1)*dc,Z=A_(oS([],M,B)),G=A_(M),fe=A_(B),ue=4*((4*G*fe-(Z-G-fe)**2)/16)/Z,Me=Math.sqrt(G-ue),Oe=Math.sqrt(Math.max(0,j*j-ue)),$e=(Me-Oe)/Math.sqrt(Z);y=tk([],M,B,$e)}const[T,S,P]=this.unprojectPosition(y);return Number.isFinite(h)?[T,S,P]:Number.isFinite(r)?[T,S,r]:[T,S]}projectPosition(e){const[i,r,n=0]=e,l=i*gf,h=r*gf,a=Math.cos(h),g=(n/Nf+1)*dc;return[Math.sin(l)*a*g,-Math.cos(l)*a*g,Math.sin(h)*g]}unprojectPosition(e){const[i,r,n]=e,l=aS(e),h=Math.asin(n/l),g=Math.atan2(i,-r)*p1,y=h*p1,T=(l/dc-1)*Nf;return[g,y,T]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,i){const r=this.unproject(i);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}function X_(t,e){const i=Dc([],e,t);return Ly(i,i,1/i[3]),i}class Qy{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&qn(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:i}=e.constructor,r={updateTriggers:{}};for(const n in i)if(n in this.props){const l=i[n],h=this.props[n];r[n]=h,l&&l.type==="accessor"&&(r.updateTriggers[n]=this.props.updateTriggers[n],typeof h=="function"&&(r[n]=this.getSubLayerAccessor(h)))}return r}initializeState(e,i){}updateState(e,i){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,i){}finalizeState(e,i){}}Qy.defaultProps={};Qy.extensionName="LayerExtension";const Iz=Qy;class hE{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:i={}}=e;this.typedArrayManager=Oc,this.attributes={},this._attributeDefs=i,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:i,buffers:r={},getGeometry:n,geometryBuffer:l,positionFormat:h,dataChanged:a,normalize:g=!0}=this.opts;if(this.data=i,this.getGeometry=n,this.positionSize=l&&l.size||(h==="XY"?2:3),this.buffers=r,this.normalize=g,l&&(Fr(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(l),g||(r.vertexPositions=l)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(const y of a)this._rebuildGeometry(y);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:i}){this._rebuildGeometry({startRow:e,endRow:i})}getGeometryFromBuffer(e){const i=e.value||e;return ArrayBuffer.isView(i)?GS(i,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,i){const{attributes:r,buffers:n,_attributeDefs:l,typedArrayManager:h}=this;for(const a in l)if(a in n)h.release(r[a]),r[a]=null;else{const g=l[a];g.copy=i,r[a]=h.allocate(r[a],e,g)}}_forEachGeometry(e,i,r){const{data:n,getGeometry:l}=this,{iterable:h,objectInfo:a}=eg(n,i,r);for(const g of h){a.index++;const y=l?l(g,a):null;e(y,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:i,vertexStarts:r,instanceCount:n}=this;const{data:l,geometryBuffer:h}=this,{startRow:a=0,endRow:g=1/0}=e||{},y={};if(e||(i=[0],r=[0]),this.normalize||!h)this._forEachGeometry((S,P)=>{const M=S&&this.normalizeGeometry(S);y[P]=M,r[P+1]=r[P]+(M?this.getGeometrySize(M):0)},a,g),n=r[r.length-1];else if(r=l.startIndices,n=r[l.length]||0,ArrayBuffer.isView(h))n=n||h.length/this.positionSize;else if(h instanceof Li){const S=this.positionSize*4;n=n||h.byteLength/S}else if(h.buffer){const S=h.stride||this.positionSize*4;n=n||h.buffer.byteLength/S}else if(h.value){const S=h.value,P=h.stride/S.BYTES_PER_ELEMENT||this.positionSize;n=n||S.length/P}this._allocate(n,!!e),this.indexStarts=i,this.vertexStarts=r,this.instanceCount=n;const T={};this._forEachGeometry((S,P)=>{const M=y[P]||S;T.vertexStart=r[P],T.indexStart=i[P];const B=P<r.length-1?r[P+1]:n;T.geometrySize=B-r[P],T.geometryIndex=P,this.updateGeometryAttributes(M,T)},a,g),this.vertexCount=i[i.length-1]}}function la(t,e,i={}){const r={type:"Feature"};return(i.id===0||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=e||{},r.geometry=t,r}function jh(t,e,i={}){for(const n of t){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<n[n.length-1].length;l++)if(n[n.length-1][l]!==n[0][l])throw new Error("First and last Position are not equivalent.")}return la({type:"Polygon",coordinates:t},e,i)}function Cz(t,e,i={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return la({type:"LineString",coordinates:t},e,i)}function g1(t,e={}){const i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=t,i}function Rz(t,e,i={}){return la({type:"MultiLineString",coordinates:t},e,i)}function tg(t,e,i={}){return la({type:"MultiPolygon",coordinates:t},e,i)}function Mz(t){return t.type==="Feature"?t.geometry:t}function pp(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}function kz(t,e,i){var r=t.length,n=fc(t[0],e),l=[],h,a,g;let y,T;for(i||(i=[]),h=1;h<r;h++){for(y=t[h-1],T=t[h],a=g=fc(T,e);;)if(n|a){if(n&a)break;n?(y=Qm(y,T,n,e),n=fc(y,e)):(T=Qm(y,T,a,e),a=fc(T,e))}else{l.push(y),a!==g?(l.push(T),h<r-1&&(i.push(l),l=[])):h===r-1&&l.push(T);break}n=g}return l.length&&i.push(l),i}function Oz(t,e){var i,r,n,l,h,a,g;for(r=1;r<=8;r*=2){for(i=[],n=t[t.length-1],l=!(fc(n,e)&r),h=0;h<t.length;h++)a=t[h],g=!(fc(a,e)&r),g!==l&&i.push(Qm(n,a,r,e)),g&&i.push(a),n=a,l=g;if(t=i,!t.length)break}return i}function Qm(t,e,i,r){return i&8?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:i&4?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:i&2?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:i&1?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null}function fc(t,e){var i=0;return t[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}function Fz(t,e){const i=Mz(t),r=i.type,n=t.type==="Feature"?t.properties:{};let l=i.coordinates;switch(r){case"LineString":case"MultiLineString":{const h=[];return r==="LineString"&&(l=[l]),l.forEach(a=>{kz(a,e,h)}),h.length===1?Cz(h[0],n):Rz(h,n)}case"Polygon":return jh(_1(l,e),n);case"MultiPolygon":return tg(l.map(h=>_1(h,e)),n);default:throw new Error("geometry "+r+" not supported")}}function _1(t,e){const i=[];for(const r of t){const n=Oz(r,e);n.length>0&&((n[0][0]!==n[n.length-1][0]||n[0][1]!==n[n.length-1][1])&&n.push(n[0]),n.length>=4&&i.push(n))}return i}var Z_=Fz;function Dz(t,e={}){const i=Number(t[0]),r=Number(t[1]),n=Number(t[2]),l=Number(t[3]);if(t.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const h=[i,r];return jh([[h,[n,r],[n,l],[i,l],h]],e.properties,{bbox:t,id:e.id})}var Nz=Dz;/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Lz(t,e){var i={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,n,l,h;return h={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function a(y){return function(T){return g([y,T])}}function g(y){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(l=y[0]&2?n.return:y[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,y[1])).done)return l;switch(n=0,l&&(y=[y[0]&2,l.value]),y[0]){case 0:case 1:l=y;break;case 4:return i.label++,{value:y[1],done:!1};case 5:i.label++,n=y[1],y=[0];continue;case 7:y=i.ops.pop(),i.trys.pop();continue;default:if(l=i.trys,!(l=l.length>0&&l[l.length-1])&&(y[0]===6||y[0]===2)){i=0;continue}if(y[0]===3&&(!l||y[1]>l[0]&&y[1]<l[3])){i.label=y[1];break}if(y[0]===6&&i.label<l[1]){i.label=l[1],l=y;break}if(l&&i.label<l[2]){i.label=l[2],i.ops.push(y);break}l[2]&&i.ops.pop(),i.trys.pop();continue}y=e.call(t,i)}catch(T){y=[6,T],n=0}finally{r=l=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}var ya=function(){function t(e,i){this.next=null,this.key=e,this.data=i,this.left=null,this.right=null}return t}();function Bz(t,e){return t>e?1:t<e?-1:0}function na(t,e,i){for(var r=new ya(null,null),n=r,l=r;;){var h=i(t,e.key);if(h<0){if(e.left===null)break;if(i(t,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}l.left=e,l=e,e=e.left}else if(h>0){if(e.right===null)break;if(i(t,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}n.right=e,n=e,e=e.right}else break}return n.right=e.left,l.left=e.right,e.left=r.right,e.right=r.left,e}function Y_(t,e,i,r){var n=new ya(t,e);if(i===null)return n.left=n.right=null,n;i=na(t,i,r);var l=r(t,i.key);return l<0?(n.left=i.left,n.right=i,i.left=null):l>=0&&(n.right=i.right,n.left=i,i.right=null),n}function m1(t,e,i){var r=null,n=null;if(e){e=na(t,e,i);var l=i(e.key,t);l===0?(r=e.left,n=e.right):l<0?(n=e.right,e.right=null,r=e):(r=e.left,e.left=null,n=e)}return{left:r,right:n}}function zz(t,e,i){return e===null?t:(t===null||(e=na(t.key,e,i),e.left=t),e)}function ey(t,e,i,r,n){if(t){r(""+e+(i?"└── ":"├── ")+n(t)+`
`);var l=e+(i?"    ":"│   ");t.left&&ey(t.left,l,!1,r,n),t.right&&ey(t.right,l,!0,r,n)}}var e0=function(){function t(e){e===void 0&&(e=Bz),this._root=null,this._size=0,this._comparator=e}return t.prototype.insert=function(e,i){return this._size++,this._root=Y_(e,i,this._root,this._comparator)},t.prototype.add=function(e,i){var r=new ya(e,i);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var n=this._comparator,l=na(e,this._root,n),h=n(e,l.key);return h===0?this._root=l:(h<0?(r.left=l.left,r.right=l,l.left=null):h>0&&(r.right=l.right,r.left=l,l.right=null),this._size++,this._root=r),this._root},t.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},t.prototype._remove=function(e,i,r){var n;if(i===null)return null;i=na(e,i,r);var l=r(e,i.key);return l===0?(i.left===null?n=i.right:(n=na(e,i.left,r),n.right=i.right),this._size--,n):i},t.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=na(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},t.prototype.findStatic=function(e){for(var i=this._root,r=this._comparator;i;){var n=r(e,i.key);if(n===0)return i;n<0?i=i.left:i=i.right}return null},t.prototype.find=function(e){return this._root&&(this._root=na(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},t.prototype.contains=function(e){for(var i=this._root,r=this._comparator;i;){var n=r(e,i.key);if(n===0)return!0;n<0?i=i.left:i=i.right}return!1},t.prototype.forEach=function(e,i){for(var r=this._root,n=[],l=!1;!l;)r!==null?(n.push(r),r=r.left):n.length!==0?(r=n.pop(),e.call(i,r),r=r.right):l=!0;return this},t.prototype.range=function(e,i,r,n){for(var l=[],h=this._comparator,a=this._root,g;l.length!==0||a;)if(a)l.push(a),a=a.left;else{if(a=l.pop(),g=h(a.key,i),g>0)break;if(h(a.key,e)>=0&&r.call(n,a))return this;a=a.right}return this},t.prototype.keys=function(){var e=[];return this.forEach(function(i){var r=i.key;return e.push(r)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(i){var r=i.data;return e.push(r)}),e},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},t.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},t.prototype.at=function(e){for(var i=this._root,r=!1,n=0,l=[];!r;)if(i)l.push(i),i=i.left;else if(l.length>0){if(i=l.pop(),n===e)return i;n++,i=i.right}else r=!0;return null},t.prototype.next=function(e){var i=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var n=this._comparator;i;){var l=n(e.key,i.key);if(l===0)break;l<0?(r=i,i=i.left):i=i.right}return r},t.prototype.prev=function(e){var i=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var n=this._comparator;i;){var l=n(e.key,i.key);if(l===0)break;l<0?i=i.left:(r=i,i=i.right)}return r},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return Vz(this._root)},t.prototype.load=function(e,i,r){i===void 0&&(i=[]),r===void 0&&(r=!1);var n=e.length,l=this._comparator;if(r&&ry(e,i,0,n-1,l),this._root===null)this._root=ty(e,i,0,n),this._size=n;else{var h=$z(this.toList(),Uz(e,i),l);n=this._size+n,this._root=iy({head:h},0,n)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var i=[];return ey(this._root,"",!0,function(r){return i.push(r)},e),i.join("")},t.prototype.update=function(e,i,r){var n=this._comparator,l=m1(e,this._root,n),h=l.left,a=l.right;n(e,i)<0?a=Y_(i,r,a,n):h=Y_(i,r,h,n),this._root=zz(h,a,n)},t.prototype.split=function(e){return m1(e,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var e,i,r;return Lz(this,function(n){switch(n.label){case 0:e=this._root,i=[],r=!1,n.label=1;case 1:return r?[3,6]:e===null?[3,2]:(i.push(e),e=e.left,[3,5]);case 2:return i.length===0?[3,4]:(e=i.pop(),[4,e]);case 3:return n.sent(),e=e.right,[3,5];case 4:r=!0,n.label=5;case 5:return[3,1];case 6:return[2]}})},t}();function ty(t,e,i,r){var n=r-i;if(n>0){var l=i+Math.floor(n/2),h=t[l],a=e[l],g=new ya(h,a);return g.left=ty(t,e,i,l),g.right=ty(t,e,l+1,r),g}return null}function Uz(t,e){for(var i=new ya(null,null),r=i,n=0;n<t.length;n++)r=r.next=new ya(t[n],e[n]);return r.next=null,i.next}function Vz(t){for(var e=t,i=[],r=!1,n=new ya(null,null),l=n;!r;)e?(i.push(e),e=e.left):i.length>0?(e=l=l.next=i.pop(),e=e.right):r=!0;return l.next=null,n.next}function iy(t,e,i){var r=i-e;if(r>0){var n=e+Math.floor(r/2),l=iy(t,e,n),h=t.head;return h.left=l,t.head=t.head.next,h.right=iy(t,n+1,i),h}return null}function $z(t,e,i){for(var r=new ya(null,null),n=r,l=t,h=e;l!==null&&h!==null;)i(l.key,h.key)<0?(n.next=l,l=l.next):(n.next=h,h=h.next),n=n.next;return l!==null?n.next=l:h!==null&&(n.next=h),r.next}function ry(t,e,i,r,n){if(!(i>=r)){for(var l=t[i+r>>1],h=i-1,a=r+1;;){do h++;while(n(t[h],l)<0);do a--;while(n(t[a],l)>0);if(h>=a)break;var g=t[h];t[h]=t[a],t[a]=g,g=e[h],e[h]=e[a],e[a]=g}ry(t,e,i,a,n),ry(t,e,a+1,r,n)}}const Eo=11102230246251565e-32,Kr=134217729,jz=(3+8*Eo)*Eo;function K_(t,e,i,r,n){let l,h,a,g,y=e[0],T=r[0],S=0,P=0;T>y==T>-y?(l=y,y=e[++S]):(l=T,T=r[++P]);let M=0;if(S<t&&P<i)for(T>y==T>-y?(h=y+l,a=l-(h-y),y=e[++S]):(h=T+l,a=l-(h-T),T=r[++P]),l=h,a!==0&&(n[M++]=a);S<t&&P<i;)T>y==T>-y?(h=l+y,g=h-l,a=l-(h-g)+(y-g),y=e[++S]):(h=l+T,g=h-l,a=l-(h-g)+(T-g),T=r[++P]),l=h,a!==0&&(n[M++]=a);for(;S<t;)h=l+y,g=h-l,a=l-(h-g)+(y-g),y=e[++S],l=h,a!==0&&(n[M++]=a);for(;P<i;)h=l+T,g=h-l,a=l-(h-g)+(T-g),T=r[++P],l=h,a!==0&&(n[M++]=a);return(l!==0||M===0)&&(n[M++]=l),M}function Wz(t,e){let i=e[0];for(let r=1;r<t;r++)i+=e[r];return i}function Wh(t){return new Float64Array(t)}const Hz=(3+16*Eo)*Eo,qz=(2+12*Eo)*Eo,Xz=(9+64*Eo)*Eo*Eo,tc=Wh(4),y1=Wh(8),x1=Wh(12),v1=Wh(16),mn=Wh(4);function Zz(t,e,i,r,n,l,h){let a,g,y,T,S,P,M,B,j,Z,G,fe,re,ue,Me,Oe,$e,ke;const je=t-n,Ue=i-n,ct=e-l,tt=r-l;ue=je*tt,P=Kr*je,M=P-(P-je),B=je-M,P=Kr*tt,j=P-(P-tt),Z=tt-j,Me=B*Z-(ue-M*j-B*j-M*Z),Oe=ct*Ue,P=Kr*ct,M=P-(P-ct),B=ct-M,P=Kr*Ue,j=P-(P-Ue),Z=Ue-j,$e=B*Z-(Oe-M*j-B*j-M*Z),G=Me-$e,S=Me-G,tc[0]=Me-(G+S)+(S-$e),fe=ue+G,S=fe-ue,re=ue-(fe-S)+(G-S),G=re-Oe,S=re-G,tc[1]=re-(G+S)+(S-Oe),ke=fe+G,S=ke-fe,tc[2]=fe-(ke-S)+(G-S),tc[3]=ke;let pt=Wz(4,tc),ot=qz*h;if(pt>=ot||-pt>=ot||(S=t-je,a=t-(je+S)+(S-n),S=i-Ue,y=i-(Ue+S)+(S-n),S=e-ct,g=e-(ct+S)+(S-l),S=r-tt,T=r-(tt+S)+(S-l),a===0&&g===0&&y===0&&T===0)||(ot=Xz*h+jz*Math.abs(pt),pt+=je*T+tt*a-(ct*y+Ue*g),pt>=ot||-pt>=ot))return pt;ue=a*tt,P=Kr*a,M=P-(P-a),B=a-M,P=Kr*tt,j=P-(P-tt),Z=tt-j,Me=B*Z-(ue-M*j-B*j-M*Z),Oe=g*Ue,P=Kr*g,M=P-(P-g),B=g-M,P=Kr*Ue,j=P-(P-Ue),Z=Ue-j,$e=B*Z-(Oe-M*j-B*j-M*Z),G=Me-$e,S=Me-G,mn[0]=Me-(G+S)+(S-$e),fe=ue+G,S=fe-ue,re=ue-(fe-S)+(G-S),G=re-Oe,S=re-G,mn[1]=re-(G+S)+(S-Oe),ke=fe+G,S=ke-fe,mn[2]=fe-(ke-S)+(G-S),mn[3]=ke;const ei=K_(4,tc,4,mn,y1);ue=je*T,P=Kr*je,M=P-(P-je),B=je-M,P=Kr*T,j=P-(P-T),Z=T-j,Me=B*Z-(ue-M*j-B*j-M*Z),Oe=ct*y,P=Kr*ct,M=P-(P-ct),B=ct-M,P=Kr*y,j=P-(P-y),Z=y-j,$e=B*Z-(Oe-M*j-B*j-M*Z),G=Me-$e,S=Me-G,mn[0]=Me-(G+S)+(S-$e),fe=ue+G,S=fe-ue,re=ue-(fe-S)+(G-S),G=re-Oe,S=re-G,mn[1]=re-(G+S)+(S-Oe),ke=fe+G,S=ke-fe,mn[2]=fe-(ke-S)+(G-S),mn[3]=ke;const rn=K_(ei,y1,4,mn,x1);ue=a*T,P=Kr*a,M=P-(P-a),B=a-M,P=Kr*T,j=P-(P-T),Z=T-j,Me=B*Z-(ue-M*j-B*j-M*Z),Oe=g*y,P=Kr*g,M=P-(P-g),B=g-M,P=Kr*y,j=P-(P-y),Z=y-j,$e=B*Z-(Oe-M*j-B*j-M*Z),G=Me-$e,S=Me-G,mn[0]=Me-(G+S)+(S-$e),fe=ue+G,S=fe-ue,re=ue-(fe-S)+(G-S),G=re-Oe,S=re-G,mn[1]=re-(G+S)+(S-Oe),ke=fe+G,S=ke-fe,mn[2]=fe-(ke-S)+(G-S),mn[3]=ke;const lr=K_(rn,x1,4,mn,v1);return v1[lr-1]}function Yz(t,e,i,r,n,l){const h=(e-l)*(i-n),a=(t-n)*(r-l),g=h-a,y=Math.abs(h+a);return Math.abs(g)>=Hz*y?g:-Zz(t,e,i,r,n,l,y)}const Zu=(t,e)=>t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y,ny=(t,e)=>{if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;const i=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x,n=t.ll.y<e.ll.y?e.ll.y:t.ll.y,l=t.ur.y<e.ur.y?t.ur.y:e.ur.y;return{ll:{x:i,y:n},ur:{x:r,y:l}}};let ca=Number.EPSILON;ca===void 0&&(ca=Math.pow(2,-52));const Kz=ca*ca,b1=(t,e)=>{if(-ca<t&&t<ca&&-ca<e&&e<ca)return 0;const i=t-e;return i*i<Kz*t*e?0:t<e?-1:1};class Gz{constructor(){this.reset()}reset(){this.xRounder=new w1,this.yRounder=new w1}round(e,i){return{x:this.xRounder.round(e),y:this.yRounder.round(i)}}}class w1{constructor(){this.tree=new e0,this.round(0)}round(e){const i=this.tree.add(e),r=this.tree.prev(i);if(r!==null&&b1(i.key,r.key)===0)return this.tree.remove(e),r.key;const n=this.tree.next(i);return n!==null&&b1(i.key,n.key)===0?(this.tree.remove(e),n.key):e}}const wh=new Gz,Lf=(t,e)=>t.x*e.y-t.y*e.x,dE=(t,e)=>t.x*e.x+t.y*e.y,T1=(t,e,i)=>{const r=Yz(t.x,t.y,e.x,e.y,i.x,i.y);return r>0?-1:r<0?1:0},gp=t=>Math.sqrt(dE(t,t)),Jz=(t,e,i)=>{const r={x:e.x-t.x,y:e.y-t.y},n={x:i.x-t.x,y:i.y-t.y};return Lf(n,r)/gp(n)/gp(r)},Qz=(t,e,i)=>{const r={x:e.x-t.x,y:e.y-t.y},n={x:i.x-t.x,y:i.y-t.y};return dE(n,r)/gp(n)/gp(r)},S1=(t,e,i)=>e.y===0?null:{x:t.x+e.x/e.y*(i-t.y),y:i},E1=(t,e,i)=>e.x===0?null:{x:i,y:t.y+e.y/e.x*(i-t.x)},e4=(t,e,i,r)=>{if(e.x===0)return E1(i,r,t.x);if(r.x===0)return E1(t,e,i.x);if(e.y===0)return S1(i,r,t.y);if(r.y===0)return S1(t,e,i.y);const n=Lf(e,r);if(n==0)return null;const l={x:i.x-t.x,y:i.y-t.y},h=Lf(l,e)/n,a=Lf(l,r)/n,g=t.x+a*e.x,y=i.x+h*r.x,T=t.y+a*e.y,S=i.y+h*r.y,P=(g+y)/2,M=(T+S)/2;return{x:P,y:M}};class ss{static compare(e,i){const r=ss.comparePoints(e.point,i.point);return r!==0?r:(e.point!==i.point&&e.link(i),e.isLeft!==i.isLeft?e.isLeft?1:-1:ga.compare(e.segment,i.segment))}static comparePoints(e,i){return e.x<i.x?-1:e.x>i.x?1:e.y<i.y?-1:e.y>i.y?1:0}constructor(e,i){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=i}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const i=e.point.events;for(let r=0,n=i.length;r<n;r++){const l=i[r];this.point.events.push(l),l.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let i=0;i<e;i++){const r=this.point.events[i];if(r.segment.consumedBy===void 0)for(let n=i+1;n<e;n++){const l=this.point.events[n];l.consumedBy===void 0&&r.otherSE.point.events===l.otherSE.point.events&&r.segment.consume(l.segment)}}}getAvailableLinkedEvents(){const e=[];for(let i=0,r=this.point.events.length;i<r;i++){const n=this.point.events[i];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&e.push(n)}return e}getLeftmostComparator(e){const i=new Map,r=n=>{const l=n.otherSE;i.set(n,{sine:Jz(this.point,e.point,l.point),cosine:Qz(this.point,e.point,l.point)})};return(n,l)=>{i.has(n)||r(n),i.has(l)||r(l);const{sine:h,cosine:a}=i.get(n),{sine:g,cosine:y}=i.get(l);return h>=0&&g>=0?a<y?1:a>y?-1:0:h<0&&g<0?a<y?-1:a>y?1:0:g<h?-1:g>h?1:0}}}let t4=0;class ga{static compare(e,i){const r=e.leftSE.point.x,n=i.leftSE.point.x,l=e.rightSE.point.x,h=i.rightSE.point.x;if(h<r)return 1;if(l<n)return-1;const a=e.leftSE.point.y,g=i.leftSE.point.y,y=e.rightSE.point.y,T=i.rightSE.point.y;if(r<n){if(g<a&&g<y)return 1;if(g>a&&g>y)return-1;const S=e.comparePoint(i.leftSE.point);if(S<0)return 1;if(S>0)return-1;const P=i.comparePoint(e.rightSE.point);return P!==0?P:-1}if(r>n){if(a<g&&a<T)return-1;if(a>g&&a>T)return 1;const S=i.comparePoint(e.leftSE.point);if(S!==0)return S;const P=e.comparePoint(i.rightSE.point);return P<0?1:P>0?-1:1}if(a<g)return-1;if(a>g)return 1;if(l<h){const S=i.comparePoint(e.rightSE.point);if(S!==0)return S}if(l>h){const S=e.comparePoint(i.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(l!==h){const S=y-a,P=l-r,M=T-g,B=h-n;if(S>P&&M<B)return 1;if(S<P&&M>B)return-1}return l>h?1:l<h||y<T?-1:y>T?1:e.id<i.id?-1:e.id>i.id?1:0}constructor(e,i,r,n){this.id=++t4,this.leftSE=e,e.segment=this,e.otherSE=i,this.rightSE=i,i.segment=this,i.otherSE=e,this.rings=r,this.windings=n}static fromRing(e,i,r){let n,l,h;const a=ss.comparePoints(e,i);if(a<0)n=e,l=i,h=1;else if(a>0)n=i,l=e,h=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const g=new ss(n,!0),y=new ss(l,!1);return new ga(g,y,[r],[h])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,i=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<i?e:i},ur:{x:this.rightSE.point.x,y:e>i?e:i}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const i=this.leftSE.point,r=this.rightSE.point,n=this.vector();if(i.x===r.x)return e.x===i.x?0:e.x<i.x?1:-1;const l=(e.y-i.y)/n.y,h=i.x+l*n.x;if(e.x===h)return 0;const a=(e.x-i.x)/n.x,g=i.y+a*n.y;return e.y===g?0:e.y<g?-1:1}getIntersection(e){const i=this.bbox(),r=e.bbox(),n=ny(i,r);if(n===null)return null;const l=this.leftSE.point,h=this.rightSE.point,a=e.leftSE.point,g=e.rightSE.point,y=Zu(i,a)&&this.comparePoint(a)===0,T=Zu(r,l)&&e.comparePoint(l)===0,S=Zu(i,g)&&this.comparePoint(g)===0,P=Zu(r,h)&&e.comparePoint(h)===0;if(T&&y)return P&&!S?h:!P&&S?g:null;if(T)return S&&l.x===g.x&&l.y===g.y?null:l;if(y)return P&&h.x===a.x&&h.y===a.y?null:a;if(P&&S)return null;if(P)return h;if(S)return g;const M=e4(l,this.vector(),a,e.vector());return M===null||!Zu(n,M)?null:wh.round(M.x,M.y)}split(e){const i=[],r=e.events!==void 0,n=new ss(e,!0),l=new ss(e,!1),h=this.rightSE;this.replaceRightSE(l),i.push(l),i.push(n);const a=new ga(n,h,this.rings.slice(),this.windings.slice());return ss.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),ss.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(n.checkForConsuming(),l.checkForConsuming()),i}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let i=0,r=this.windings.length;i<r;i++)this.windings[i]*=-1}consume(e){let i=this,r=e;for(;i.consumedBy;)i=i.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const n=ga.compare(i,r);if(n!==0){if(n>0){const l=i;i=r,r=l}if(i.prev===r){const l=i;i=r,r=l}for(let l=0,h=r.rings.length;l<h;l++){const a=r.rings[l],g=r.windings[l],y=i.rings.indexOf(a);y===-1?(i.rings.push(a),i.windings.push(g)):i.windings[y]+=g}r.rings=null,r.windings=null,r.consumedBy=i,r.leftSE.consumedBy=i.leftSE,r.rightSE.consumedBy=i.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const i=this._afterState.rings,r=this._afterState.windings,n=this._afterState.multiPolys;for(let a=0,g=this.rings.length;a<g;a++){const y=this.rings[a],T=this.windings[a],S=i.indexOf(y);S===-1?(i.push(y),r.push(T)):r[S]+=T}const l=[],h=[];for(let a=0,g=i.length;a<g;a++){if(r[a]===0)continue;const y=i[a],T=y.poly;if(h.indexOf(T)===-1)if(y.isExterior)l.push(T);else{h.indexOf(T)===-1&&h.push(T);const S=l.indexOf(y.poly);S!==-1&&l.splice(S,1)}}for(let a=0,g=l.length;a<g;a++){const y=l[a].multiPoly;n.indexOf(y)===-1&&n.push(y)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,i=this.afterState().multiPolys;switch(Is.type){case"union":{const r=e.length===0,n=i.length===0;this._isInResult=r!==n;break}case"intersection":{let r,n;e.length<i.length?(r=e.length,n=i.length):(r=i.length,n=e.length),this._isInResult=n===Is.numMultiPolys&&r<n;break}case"xor":{const r=Math.abs(e.length-i.length);this._isInResult=r%2===1;break}case"difference":{const r=n=>n.length===1&&n[0].isSubject;this._isInResult=r(e)!==r(i);break}default:throw new Error(`Unrecognized operation type found ${Is.type}`)}return this._isInResult}}class A1{constructor(e,i,r){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const n=wh.round(e[0][0],e[0][1]);this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};let l=n;for(let h=1,a=e.length;h<a;h++){if(typeof e[h][0]!="number"||typeof e[h][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let g=wh.round(e[h][0],e[h][1]);g.x===l.x&&g.y===l.y||(this.segments.push(ga.fromRing(l,g,this)),g.x<this.bbox.ll.x&&(this.bbox.ll.x=g.x),g.y<this.bbox.ll.y&&(this.bbox.ll.y=g.y),g.x>this.bbox.ur.x&&(this.bbox.ur.x=g.x),g.y>this.bbox.ur.y&&(this.bbox.ur.y=g.y),l=g)}(n.x!==l.x||n.y!==l.y)&&this.segments.push(ga.fromRing(l,n,this))}getSweepEvents(){const e=[];for(let i=0,r=this.segments.length;i<r;i++){const n=this.segments[i];e.push(n.leftSE),e.push(n.rightSE)}return e}}class i4{constructor(e,i){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new A1(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,n=e.length;r<n;r++){const l=new A1(e[r],this,!1);l.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=l.bbox.ll.x),l.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=l.bbox.ll.y),l.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=l.bbox.ur.x),l.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=l.bbox.ur.y),this.interiorRings.push(l)}this.multiPoly=i}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let i=0,r=this.interiorRings.length;i<r;i++){const n=this.interiorRings[i].getSweepEvents();for(let l=0,h=n.length;l<h;l++)e.push(n[l])}return e}}class P1{constructor(e,i){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let r=0,n=e.length;r<n;r++){const l=new i4(e[r],this);l.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=l.bbox.ll.x),l.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=l.bbox.ll.y),l.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=l.bbox.ur.x),l.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=l.bbox.ur.y),this.polys.push(l)}this.isSubject=i}getSweepEvents(){const e=[];for(let i=0,r=this.polys.length;i<r;i++){const n=this.polys[i].getSweepEvents();for(let l=0,h=n.length;l<h;l++)e.push(n[l])}return e}}class _p{static factory(e){const i=[];for(let r=0,n=e.length;r<n;r++){const l=e[r];if(!l.isInResult()||l.ringOut)continue;let h=null,a=l.leftSE,g=l.rightSE;const y=[a],T=a.point,S=[];for(;h=a,a=g,y.push(a),a.point!==T;)for(;;){const P=a.getAvailableLinkedEvents();if(P.length===0){const j=y[0].point,Z=y[y.length-1].point;throw new Error(`Unable to complete output ring starting at [${j.x}, ${j.y}]. Last matching segment found ends at [${Z.x}, ${Z.y}].`)}if(P.length===1){g=P[0].otherSE;break}let M=null;for(let j=0,Z=S.length;j<Z;j++)if(S[j].point===a.point){M=j;break}if(M!==null){const j=S.splice(M)[0],Z=y.splice(j.index);Z.unshift(Z[0].otherSE),i.push(new _p(Z.reverse()));continue}S.push({index:y.length,point:a.point});const B=a.getLeftmostComparator(h);g=P.sort(B)[0].otherSE;break}i.push(new _p(y))}return i}constructor(e){this.events=e;for(let i=0,r=e.length;i<r;i++)e[i].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const i=[e];for(let y=1,T=this.events.length-1;y<T;y++){const S=this.events[y].point,P=this.events[y+1].point;T1(S,e,P)!==0&&(i.push(S),e=S)}if(i.length===1)return null;const r=i[0],n=i[1];T1(r,e,n)===0&&i.shift(),i.push(i[0]);const l=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:i.length-1,a=this.isExteriorRing()?i.length:-1,g=[];for(let y=h;y!=a;y+=l)g.push([i[y].x,i[y].y]);return g}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let n=1,l=this.events.length;n<l;n++){const h=this.events[n];ss.compare(e,h)>0&&(e=h)}let i=e.segment.prevInResult(),r=i?i.prevInResult():null;for(;;){if(!i)return null;if(!r)return i.ringOut;if(r.ringOut!==i.ringOut)return r.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=r.prevInResult(),r=i?i.prevInResult():null}}}class I1{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let i=0,r=this.interiorRings.length;i<r;i++){const n=this.interiorRings[i].getGeom();n!==null&&e.push(n)}return e}}class r4{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let i=0,r=this.polys.length;i<r;i++){const n=this.polys[i].getGeom();n!==null&&e.push(n)}return e}_composePolys(e){const i=[];for(let r=0,n=e.length;r<n;r++){const l=e[r];if(!l.poly)if(l.isExteriorRing())i.push(new I1(l));else{const h=l.enclosingRing();h.poly||i.push(new I1(h)),h.poly.addInterior(l)}}return i}}class n4{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ga.compare;this.queue=e,this.tree=new e0(i),this.segments=[]}process(e){const i=e.segment,r=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(i),r;const n=e.isLeft?this.tree.add(i):this.tree.find(i);if(!n)throw new Error(`Unable to find segment #${i.id} [${i.leftSE.point.x}, ${i.leftSE.point.y}] -> [${i.rightSE.point.x}, ${i.rightSE.point.y}] in SweepLine tree.`);let l=n,h=n,a,g;for(;a===void 0;)l=this.tree.prev(l),l===null?a=null:l.key.consumedBy===void 0&&(a=l.key);for(;g===void 0;)h=this.tree.next(h),h===null?g=null:h.key.consumedBy===void 0&&(g=h.key);if(e.isLeft){let y=null;if(a){const S=a.getIntersection(i);if(S!==null&&(i.isAnEndpoint(S)||(y=S),!a.isAnEndpoint(S))){const P=this._splitSafely(a,S);for(let M=0,B=P.length;M<B;M++)r.push(P[M])}}let T=null;if(g){const S=g.getIntersection(i);if(S!==null&&(i.isAnEndpoint(S)||(T=S),!g.isAnEndpoint(S))){const P=this._splitSafely(g,S);for(let M=0,B=P.length;M<B;M++)r.push(P[M])}}if(y!==null||T!==null){let S=null;y===null?S=T:T===null?S=y:S=ss.comparePoints(y,T)<=0?y:T,this.queue.remove(i.rightSE),r.push(i.rightSE);const P=i.split(S);for(let M=0,B=P.length;M<B;M++)r.push(P[M])}r.length>0?(this.tree.remove(i),r.push(e)):(this.segments.push(i),i.prev=a)}else{if(a&&g){const y=a.getIntersection(g);if(y!==null){if(!a.isAnEndpoint(y)){const T=this._splitSafely(a,y);for(let S=0,P=T.length;S<P;S++)r.push(T[S])}if(!g.isAnEndpoint(y)){const T=this._splitSafely(g,y);for(let S=0,P=T.length;S<P;S++)r.push(T[S])}}}this.tree.remove(i)}return r}_splitSafely(e,i){this.tree.remove(e);const r=e.rightSE;this.queue.remove(r);const n=e.split(i);return n.push(r),e.consumedBy===void 0&&this.tree.add(e),n}}const C1=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,s4=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class o4{run(e,i,r){Is.type=e,wh.reset();const n=[new P1(i,!0)];for(let S=0,P=r.length;S<P;S++)n.push(new P1(r[S],!1));if(Is.numMultiPolys=n.length,Is.type==="difference"){const S=n[0];let P=1;for(;P<n.length;)ny(n[P].bbox,S.bbox)!==null?P++:n.splice(P,1)}if(Is.type==="intersection")for(let S=0,P=n.length;S<P;S++){const M=n[S];for(let B=S+1,j=n.length;B<j;B++)if(ny(M.bbox,n[B].bbox)===null)return[]}const l=new e0(ss.compare);for(let S=0,P=n.length;S<P;S++){const M=n[S].getSweepEvents();for(let B=0,j=M.length;B<j;B++)if(l.insert(M[B]),l.size>C1)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const h=new n4(l);let a=l.size,g=l.pop();for(;g;){const S=g.key;if(l.size===a){const M=S.segment;throw new Error(`Unable to pop() ${S.isLeft?"left":"right"} SweepEvent [${S.point.x}, ${S.point.y}] from segment #${M.id} [${M.leftSE.point.x}, ${M.leftSE.point.y}] -> [${M.rightSE.point.x}, ${M.rightSE.point.y}] from queue.`)}if(l.size>C1)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(h.segments.length>s4)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const P=h.process(S);for(let M=0,B=P.length;M<B;M++){const j=P[M];j.consumedBy===void 0&&l.insert(j)}a=l.size,g=l.pop()}wh.reset();const y=_p.factory(h.segments);return new r4(y).getGeom()}}const Is=new o4,a4=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return Is.run("union",t,i)},l4=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return Is.run("intersection",t,i)},c4=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return Is.run("xor",t,i)},u4=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return Is.run("difference",t,i)};var h4={union:a4,intersection:l4,xor:c4,difference:u4};function d4(t,e){var i,r,n,l,h,a,g,y,T,S,P=0,M=t.type==="FeatureCollection",B=t.type==="Feature",j=M?t.features.length:1;for(i=0;i<j;i++){for(a=M?t.features[i].geometry:B?t.geometry:t,y=M?t.features[i].properties:B?t.properties:{},T=M?t.features[i].bbox:B?t.bbox:void 0,S=M?t.features[i].id:B?t.id:void 0,g=a?a.type==="GeometryCollection":!1,h=g?a.geometries.length:1,n=0;n<h;n++){if(l=g?a.geometries[n]:a,l===null){if(e(null,P,y,T,S)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(l,P,y,T,S)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<l.geometries.length;r++)if(e(l.geometries[r],P,y,T,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}P++}}function f4(t,e={}){const i=[];if(d4(t,n=>{i.push(n.coordinates)}),i.length<2)throw new Error("Must have at least 2 geometries");const r=h4.union(i[0],...i.slice(1));return r.length===0?null:r.length===1?jh(r[0],e.properties):tg(r,e.properties)}var R1=f4;const p4=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,g4=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,_4=1024,m4=4,M1=()=>{},k1={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},y4={x:0,y:0,width:0,height:0};function x4(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function v4(t,e,i,r){const n=Math.min(i/e.width,r/e.height),l=Math.floor(e.width*n),h=Math.floor(e.height*n);return n===1?{data:e,width:l,height:h}:(t.canvas.height=h,t.canvas.width=l,t.clearRect(0,0,l,h),t.drawImage(e,0,0,e.width,e.height,0,0,l,h),{data:t.canvas,width:l,height:h})}function Th(t){return t&&(t.id||t.url)}function b4(t,e,i,r){const{width:n,height:l,device:h}=t,a=h.createTexture({format:"rgba8unorm",width:e,height:i,sampler:r}),g=h.createCommandEncoder();return g.copyTextureToTexture({source:t,destination:a,width:n,height:l}),g.finish(),t.destroy(),a}function O1(t,e,i){for(let r=0;r<e.length;r++){const{icon:n,xOffset:l}=e[r],h=Th(n);t[h]={...n,x:l,y:i}}}function w4({icons:t,buffer:e,mapping:i={},xOffset:r=0,yOffset:n=0,rowHeight:l=0,canvasWidth:h}){let a=[];for(let g=0;g<t.length;g++){const y=t[g],T=Th(y);if(!i[T]){const{height:S,width:P}=y;r+P+e>h&&(O1(i,a,n),r=0,n=l+n+e,l=0,a=[]),a.push({icon:y,xOffset:r}),r=r+P+e,l=Math.max(l,S)}}return a.length>0&&O1(i,a,n),{mapping:i,rowHeight:l,xOffset:r,yOffset:n,canvasWidth:h,canvasHeight:x4(l+n+e)}}function T4(t,e,i){if(!t||!e)return null;i=i||{};const r={},{iterable:n,objectInfo:l}=eg(t);for(const h of n){l.index++;const a=e(h,l),g=Th(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[g]&&(!i[g]||a.url!==i[g].url)&&(r[g]={...a,source:h,sourceIndex:l.index})}return r}class S4{constructor(e,{onUpdate:i=M1,onError:r=M1}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=m4,this._canvasWidth=_4,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=i,this.onError=r}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const i=this._autoPacking?Th(e):e;return this._mapping[i]||y4}setProps({loadOptions:e,autoPacking:i,iconAtlas:r,iconMapping:n,textureParameters:l}){var h;e&&(this._loadOptions=e),i!==void 0&&(this._autoPacking=i),n&&(this._mapping=n),r&&((h=this._texture)==null||h.delete(),this._texture=null,this._externalTexture=r),l&&(this._textureParameters=l)}get isLoaded(){return this._pendingCount===0}packIcons(e,i){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(T4(e,i,this._mapping)||{});if(r.length>0){const{mapping:n,xOffset:l,yOffset:h,rowHeight:a,canvasHeight:g}=w4({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=n,this._xOffset=l,this._yOffset=h,this._canvasHeight=g,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||k1})),this._texture.height!==this._canvasHeight&&(this._texture=b4(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||k1)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const i=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,Gf(r.url,this._loadOptions).then(n=>{const l=Th(r),h=this._mapping[l],{x:a,y:g,width:y,height:T}=h,{data:S,width:P,height:M}=v4(i,n,y,T);this._texture.setSubImageData({data:S,x:a+(y-P)/2,y:g+(T-M)/2,width:P,height:M}),h.width=P,h.height=M,this._texture.generateMipmap(),this.onUpdate()}).catch(n=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:n})}).finally(()=>{this._pendingCount--})}}const fE=[0,0,0,255],E4={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:fE},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class t0 extends Lc{getShaders(){return super.getShaders({vs:p4,fs:g4,modules:[Uh,Vh]})}initializeState(){this.state={iconManager:new S4(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:fE},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var M;super.updateState(e);const{props:i,oldProps:r,changeFlags:n}=e,l=this.getAttributeManager(),{iconAtlas:h,iconMapping:a,data:g,getIcon:y,textureParameters:T}=i,{iconManager:S}=this.state;if(typeof h=="string")return;const P=h||this.internalState.isAsyncPropLoading("iconAtlas");S.setProps({loadOptions:i.loadOptions,autoPacking:!P,iconAtlas:h,iconMapping:P?a:null,textureParameters:T}),P?r.iconMapping!==i.iconMapping&&l.invalidate("getIcon"):(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&S.packIcons(g,y),n.extensionsChanged&&((M=this.state.model)==null||M.destroy(),this.state.model=this._getModel(),l.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:i,sizeMinPixels:r,sizeMaxPixels:n,sizeUnits:l,billboard:h,alphaCutoff:a}=this.props,{iconManager:g}=this.state,y=g.getTexture();if(y){const T=this.state.model;T.setBindings({iconsTexture:y}),T.setUniforms(e),T.setUniforms({iconsTextureDim:[y.width,y.height],sizeUnits:rl[l],sizeScale:i,sizeMinPixels:r,sizeMaxPixels:n,billboard:h,alphaCutoff:a}),T.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Rs(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Fc({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var r;const i=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;i?i(e):Wt.error(e.error.message)()}getInstanceOffset(e){const{width:i,height:r,anchorX:n=i/2,anchorY:l=r/2}=this.state.iconManager.getIconMapping(e);return[i/2-n,r/2-l]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:i,y:r,width:n,height:l}=this.state.iconManager.getIconMapping(e);return[i,r,n,l]}}t0.defaultProps=E4;t0.layerName="IconLayer";const pE=t0,A4=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,P4=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,F1=[0,0,0,255],I4={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:F1},getLineColor:{type:"accessor",value:F1},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class i0 extends Lc{getShaders(){return super.getShaders({vs:A4,fs:P4,modules:[Uh,Vh]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e),e.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:i,radiusScale:r,radiusMinPixels:n,radiusMaxPixels:l,stroked:h,filled:a,billboard:g,antialiasing:y,lineWidthUnits:T,lineWidthScale:S,lineWidthMinPixels:P,lineWidthMaxPixels:M}=this.props,B=this.state.model;B.setUniforms(e),B.setUniforms({stroked:h?1:0,filled:a,billboard:g,antialiasing:y,radiusUnits:rl[i],radiusScale:r,radiusMinPixels:n,radiusMaxPixels:l,lineWidthUnits:rl[T],lineWidthScale:S,lineWidthMinPixels:P,lineWidthMaxPixels:M}),B.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Rs(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Fc({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}i0.defaultProps=I4;i0.layerName="ScatterplotLayer";const C4=i0,gE={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function _E(t,e,i={}){return R4(t,i)!==e?(M4(t,i),!0):!1}function R4(t,e={}){return Math.sign(yp(t,e))}const mp={x:0,y:1,z:2};function yp(t,e={}){const{start:i=0,end:r=t.length,plane:n="xy"}=e,l=e.size||2;let h=0;const a=mp[n[0]],g=mp[n[1]];for(let y=i,T=r-l;y<r;y+=l)h+=(t[y+a]-t[T+a])*(t[y+g]+t[T+g]),T=y;return h/2}function M4(t,e){const{start:i=0,end:r=t.length,size:n=2}=e,l=(r-i)/n,h=Math.floor(l/2);for(let a=0;a<h;++a){const g=i+a*n,y=i+(l-1-a)*n;for(let T=0;T<n;++T){const S=t[g+T];t[g+T]=t[y+T],t[y+T]=S}}}function k4(t,e,i=2,r,n="xy"){const l=e&&e.length,h=l?e[0]*i:t.length;let a=mE(t,0,h,i,!0,r&&r[0],n);const g=[];if(!a||a.next===a.prev)return g;let y,T,S,P,M,B,j;if(l&&(a=L4(t,e,a,i,r,n)),t.length>80*i){P=T=t[0],M=S=t[1];for(let Z=i;Z<h;Z+=i)B=t[Z],j=t[Z+1],B<P&&(P=B),j<M&&(M=j),B>T&&(T=B),j>S&&(S=j);y=Math.max(T-P,S-M),y=y!==0?32767/y:0}return Sh(a,g,i,P,M,y,0),g}function mE(t,e,i,r,n,l,h){let a,g;l===void 0&&(l=yp(t,{start:e,end:i,size:r,plane:h}));let y=mp[h[0]],T=mp[h[1]];if(n===l<0)for(a=e;a<i;a+=r)g=D1(a,t[a+y],t[a+T],g);else for(a=i-r;a>=e;a-=r)g=D1(a,t[a+y],t[a+T],g);return g&&ig(g,g.next)&&(Ah(g),g=g.next),g}function ol(t,e){if(!t)return t;e||(e=t);let i=t,r;do if(r=!1,!i.steiner&&(ig(i,i.next)||$i(i.prev,i,i.next)===0)){if(Ah(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function Sh(t,e,i,r,n,l,h){if(!t)return;!h&&l&&$4(t,r,n,l);let a=t,g,y;for(;t.prev!==t.next;){if(g=t.prev,y=t.next,l?F4(t,r,n,l):O4(t)){e.push(g.i/i|0),e.push(t.i/i|0),e.push(y.i/i|0),Ah(t),t=y.next,a=y.next;continue}if(t=y,t===a){h?h===1?(t=D4(ol(t),e,i),Sh(t,e,i,r,n,l,2)):h===2&&N4(t,e,i,r,n,l):Sh(ol(t),e,i,r,n,l,1);break}}}function O4(t){const e=t.prev,i=t,r=t.next;if($i(e,i,r)>=0)return!1;const n=e.x,l=i.x,h=r.x,a=e.y,g=i.y,y=r.y,T=n<l?n<h?n:h:l<h?l:h,S=a<g?a<y?a:y:g<y?g:y,P=n>l?n>h?n:h:l>h?l:h,M=a>g?a>y?a:y:g>y?g:y;let B=r.next;for(;B!==e;){if(B.x>=T&&B.x<=P&&B.y>=S&&B.y<=M&&pc(n,a,l,g,h,y,B.x,B.y)&&$i(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function F4(t,e,i,r){const n=t.prev,l=t,h=t.next;if($i(n,l,h)>=0)return!1;const a=n.x,g=l.x,y=h.x,T=n.y,S=l.y,P=h.y,M=a<g?a<y?a:y:g<y?g:y,B=T<S?T<P?T:P:S<P?S:P,j=a>g?a>y?a:y:g>y?g:y,Z=T>S?T>P?T:P:S>P?S:P,G=sy(M,B,e,i,r),fe=sy(j,Z,e,i,r);let re=t.prevZ,ue=t.nextZ;for(;re&&re.z>=G&&ue&&ue.z<=fe;){if(re.x>=M&&re.x<=j&&re.y>=B&&re.y<=Z&&re!==n&&re!==h&&pc(a,T,g,S,y,P,re.x,re.y)&&$i(re.prev,re,re.next)>=0||(re=re.prevZ,ue.x>=M&&ue.x<=j&&ue.y>=B&&ue.y<=Z&&ue!==n&&ue!==h&&pc(a,T,g,S,y,P,ue.x,ue.y)&&$i(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;re&&re.z>=G;){if(re.x>=M&&re.x<=j&&re.y>=B&&re.y<=Z&&re!==n&&re!==h&&pc(a,T,g,S,y,P,re.x,re.y)&&$i(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;ue&&ue.z<=fe;){if(ue.x>=M&&ue.x<=j&&ue.y>=B&&ue.y<=Z&&ue!==n&&ue!==h&&pc(a,T,g,S,y,P,ue.x,ue.y)&&$i(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function D4(t,e,i){let r=t;do{const n=r.prev,l=r.next.next;!ig(n,l)&&yE(n,r,r.next,l)&&Eh(n,l)&&Eh(l,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(l.i/i|0),Ah(r),Ah(r.next),r=t=l),r=r.next}while(r!==t);return ol(r)}function N4(t,e,i,r,n,l){let h=t;do{let a=h.next.next;for(;a!==h.prev;){if(h.i!==a.i&&H4(h,a)){let g=xE(h,a);h=ol(h,h.next),g=ol(g,g.next),Sh(h,e,i,r,n,l,0),Sh(g,e,i,r,n,l,0);return}a=a.next}h=h.next}while(h!==t)}function L4(t,e,i,r,n,l){const h=[];let a,g,y,T,S;for(a=0,g=e.length;a<g;a++)y=e[a]*r,T=a<g-1?e[a+1]*r:t.length,S=mE(t,y,T,r,!1,n&&n[a+1],l),S===S.next&&(S.steiner=!0),h.push(W4(S));for(h.sort(B4),a=0;a<h.length;a++)i=z4(h[a],i);return i}function B4(t,e){return t.x-e.x}function z4(t,e){const i=U4(t,e);if(!i)return e;const r=xE(i,t);return ol(r,r.next),ol(i,i.next)}function U4(t,e){let i=e;const r=t.x,n=t.y;let l=-1/0,h;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const P=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(P<=r&&P>l&&(l=P,h=i.x<i.next.x?i:i.next,P===r))return h}i=i.next}while(i!==e);if(!h)return null;const a=h,g=h.x,y=h.y;let T=1/0,S;i=h;do r>=i.x&&i.x>=g&&r!==i.x&&pc(n<y?r:l,n,g,y,n<y?l:r,n,i.x,i.y)&&(S=Math.abs(n-i.y)/(r-i.x),Eh(i,t)&&(S<T||S===T&&(i.x>h.x||i.x===h.x&&V4(h,i)))&&(h=i,T=S)),i=i.next;while(i!==a);return h}function V4(t,e){return $i(t.prev,t,e.prev)<0&&$i(e.next,t,t.next)<0}function $4(t,e,i,r){let n=t;do n.z===0&&(n.z=sy(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,j4(n)}function j4(t){let e,i,r=1,n,l,h,a,g,y;do{for(l=t,t=null,y=null,n=0;l;){for(n++,a=l,h=0,i=0;i<r&&(h++,a=a.nextZ,!!a);i++);for(g=r;h>0||g>0&&a;)h!==0&&(g===0||!a||l.z<=a.z)?(e=l,l=l.nextZ,h--):(e=a,a=a.nextZ,g--),y?y.nextZ=e:t=e,e.prevZ=y,y=e;l=a}y.nextZ=null,r*=2}while(n>1);return t}function sy(t,e,i,r,n){return t=(t-i)*n|0,e=(e-r)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function W4(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function pc(t,e,i,r,n,l,h,a){return(n-h)*(e-a)>=(t-h)*(l-a)&&(t-h)*(r-a)>=(i-h)*(e-a)&&(i-h)*(l-a)>=(n-h)*(r-a)}function H4(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!q4(t,e)&&(Eh(t,e)&&Eh(e,t)&&X4(t,e)&&($i(t.prev,t,e.prev)||$i(t,e.prev,e))||ig(t,e)&&$i(t.prev,t,t.next)>0&&$i(e.prev,e,e.next)>0)}function $i(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ig(t,e){return t.x===e.x&&t.y===e.y}function yE(t,e,i,r){const n=mf($i(t,e,i)),l=mf($i(t,e,r)),h=mf($i(i,r,t)),a=mf($i(i,r,e));return!!(n!==l&&h!==a||n===0&&_f(t,i,e)||l===0&&_f(t,r,e)||h===0&&_f(i,t,r)||a===0&&_f(i,e,r))}function _f(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function mf(t){return t>0?1:t<0?-1:0}function q4(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&yE(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function Eh(t,e){return $i(t.prev,t,t.next)<0?$i(t,e,t.next)>=0&&$i(t,t.prev,e)>=0:$i(t,e,t.prev)<0||$i(t,t.next,e)<0}function X4(t,e){let i=t,r=!1;const n=(t.x+e.x)/2,l=(t.y+e.y)/2;do i.y>l!=i.next.y>l&&i.next.y!==i.y&&n<(i.next.x-i.x)*(l-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function xE(t,e){const i=new oy(t.i,t.x,t.y),r=new oy(e.i,e.x,e.y),n=t.next,l=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,l.next=r,r.prev=l,r}function D1(t,e,i,r){const n=new oy(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Ah(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}class oy{constructor(e,i,r){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=e,this.x=i,this.y=r}}function Cs(t,e){const i=e.length,r=t.length;if(r>0){let n=!0;for(let l=0;l<i;l++)if(t[r-i+l]!==e[l]){n=!1;break}if(n)return!1}for(let n=0;n<i;n++)t[r+n]=e[n];return!0}function ay(t,e){const i=e.length;for(let r=0;r<i;r++)t[r]=e[r]}function Ph(t,e,i,r,n=[]){const l=r+e*i;for(let h=0;h<i;h++)n[h]=t[l+h];return n}function ly(t,e,i,r,n=[]){let l,h;if(i&8)l=(r[3]-t[1])/(e[1]-t[1]),h=3;else if(i&4)l=(r[1]-t[1])/(e[1]-t[1]),h=1;else if(i&2)l=(r[2]-t[0])/(e[0]-t[0]),h=2;else if(i&1)l=(r[0]-t[0])/(e[0]-t[0]),h=0;else return null;for(let a=0;a<t.length;a++)n[a]=(h&1)===a?r[h]:l*(e[a]-t[a])+t[a];return n}function Bf(t,e){let i=0;return t[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}function vE(t,e){const{size:i=2,broken:r=!1,gridResolution:n=10,gridOffset:l=[0,0],startIndex:h=0,endIndex:a=t.length}=e||{},g=(a-h)/i;let y=[];const T=[y],S=Ph(t,0,i,h);let P,M;const B=wE(S,n,l,[]),j=[];Cs(y,S);for(let Z=1;Z<g;Z++){for(P=Ph(t,Z,i,h,P),M=Bf(P,B);M;){ly(S,P,M,B,j);const G=Bf(j,B);G&&(ly(S,j,G,B,j),M=G),Cs(y,j),ay(S,j),Y4(B,n,M),r&&y.length>i&&(y=[],T.push(y),Cs(y,S)),M=Bf(P,B)}Cs(y,P),ay(S,P)}return r?T:T[0]}const N1=0,Z4=1;function bE(t,e=null,i){if(!t.length)return[];const{size:r=2,gridResolution:n=10,gridOffset:l=[0,0],edgeTypes:h=!1}=i||{},a=[],g=[{pos:t,types:h?new Array(t.length/r).fill(Z4):null,holes:e||[]}],y=[[],[]];let T=[];for(;g.length;){const{pos:S,types:P,holes:M}=g.shift();K4(S,r,M[0]||S.length,y),T=wE(y[0],n,l,T);const B=Bf(y[1],T);if(B){let j=L1(S,P,r,0,M[0]||S.length,T,B);const Z={pos:j[0].pos,types:j[0].types,holes:[]},G={pos:j[1].pos,types:j[1].types,holes:[]};g.push(Z,G);for(let fe=0;fe<M.length;fe++)j=L1(S,P,r,M[fe],M[fe+1]||S.length,T,B),j[0]&&(Z.holes.push(Z.pos.length),Z.pos=yf(Z.pos,j[0].pos),h&&(Z.types=yf(Z.types,j[0].types))),j[1]&&(G.holes.push(G.pos.length),G.pos=yf(G.pos,j[1].pos),h&&(G.types=yf(G.types,j[1].types)))}else{const j={positions:S};h&&(j.edgeTypes=P),M.length&&(j.holeIndices=M),a.push(j)}}return a}function L1(t,e,i,r,n,l,h){const a=(n-r)/i,g=[],y=[],T=[],S=[],P=[];let M,B,j;const Z=Ph(t,a-1,i,r);let G=Math.sign(h&8?Z[1]-l[3]:Z[0]-l[2]),fe=e&&e[a-1],re=0,ue=0;for(let Me=0;Me<a;Me++)M=Ph(t,Me,i,r,M),B=Math.sign(h&8?M[1]-l[3]:M[0]-l[2]),j=e&&e[r/i+Me],B&&G&&G!==B&&(ly(Z,M,h,l,P),Cs(g,P)&&T.push(fe),Cs(y,P)&&S.push(fe)),B<=0?(Cs(g,M)&&T.push(j),re-=B):T.length&&(T[T.length-1]=N1),B>=0?(Cs(y,M)&&S.push(j),ue+=B):S.length&&(S[S.length-1]=N1),ay(Z,M),G=B,fe=j;return[re?{pos:g,types:e&&T}:null,ue?{pos:y,types:e&&S}:null]}function wE(t,e,i,r){const n=Math.floor((t[0]-i[0])/e)*e+i[0],l=Math.floor((t[1]-i[1])/e)*e+i[1];return r[0]=n,r[1]=l,r[2]=n+e,r[3]=l+e,r}function Y4(t,e,i){i&8?(t[1]+=e,t[3]+=e):i&4?(t[1]-=e,t[3]-=e):i&2?(t[0]+=e,t[2]+=e):i&1&&(t[0]-=e,t[2]-=e)}function K4(t,e,i,r){let n=1/0,l=-1/0,h=1/0,a=-1/0;for(let g=0;g<i;g+=e){const y=t[g],T=t[g+1];n=y<n?y:n,l=y>l?y:l,h=T<h?T:h,a=T>a?T:a}return r[0][0]=n,r[0][1]=h,r[1][0]=l,r[1][1]=a,r}function yf(t,e){for(let i=0;i<e.length;i++)t.push(e[i]);return t}const G4=85.051129;function J4(t,e){const{size:i=2,startIndex:r=0,endIndex:n=t.length,normalize:l=!0}=e||{},h=t.slice(r,n);TE(h,i,0,n-r);const a=vE(h,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(l)for(const g of a)SE(g,i);return a}function Q4(t,e=null,i){const{size:r=2,normalize:n=!0,edgeTypes:l=!1}=i||{};e=e||[];const h=[],a=[];let g=0,y=0;for(let S=0;S<=e.length;S++){const P=e[S]||t.length,M=y,B=e6(t,r,g,P);for(let j=B;j<P;j++)h[y++]=t[j];for(let j=g;j<B;j++)h[y++]=t[j];TE(h,r,M,y),t6(h,r,M,y,i==null?void 0:i.maxLatitude),g=P,a[S]=y}a.pop();const T=bE(h,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:l});if(n)for(const S of T)SE(S.positions,r);return T}function e6(t,e,i,r){let n=-1,l=-1;for(let h=i+1;h<r;h+=e){const a=Math.abs(t[h]);a>n&&(n=a,l=h-1)}return l}function t6(t,e,i,r,n=G4){const l=t[i],h=t[r-e];if(Math.abs(l-h)>180){const a=Ph(t,0,e,i);a[0]+=Math.round((h-l)/360)*360,Cs(t,a),a[1]=Math.sign(a[1])*n,Cs(t,a),a[0]=l,Cs(t,a)}}function TE(t,e,i,r){let n=t[0],l;for(let h=i;h<r;h+=e){l=t[h];const a=l-n;(a>180||a<-180)&&(l-=Math.round(a/360)*360),t[h]=n=l}}function SE(t,e){let i;const r=t.length/e;for(let l=0;l<r&&(i=t[l*e],(i+180)%360===0);l++);const n=-Math.round(i/360)*360;if(n!==0)for(let l=0;l<r;l++)t[l*e]+=n}function i6(t,e,i,r){let n;if(Array.isArray(t[0])){const l=t.length*e;n=new Array(l);for(let h=0;h<t.length;h++)for(let a=0;a<e;a++)n[h*e+a]=t[h][a]||0}else n=t;return i?vE(n,{size:e,gridResolution:i}):r?J4(n,{size:e}):n}const r6=1,n6=2,G_=4;class s6 extends hE{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?i6(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(B1(e)){let r=0;for(const n of e)r+=this.getGeometrySize(n);return r}const i=this.getPathLength(e);return i<2?0:this.isClosed(e)?i<3?0:i+2:i}updateGeometryAttributes(e,i){if(i.geometrySize!==0)if(e&&B1(e))for(const r of e){const n=this.getGeometrySize(r);i.geometrySize=n,this.updateGeometryAttributes(r,i),i.vertexStart+=n}else this._updateSegmentTypes(e,i),this._updatePositions(e,i)}_updateSegmentTypes(e,i){const r=this.attributes.segmentTypes,n=e?this.isClosed(e):!1,{vertexStart:l,geometrySize:h}=i;r.fill(0,l,l+h),n?(r[l]=G_,r[l+h-2]=G_):(r[l]+=r6,r[l+h-2]+=n6),r[l+h-1]=G_}_updatePositions(e,i){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:n,geometrySize:l}=i,h=new Array(3);for(let a=n,g=0;g<l;a++,g++)this.getPointOnPath(e,g,h),r[a*3]=h[0],r[a*3+1]=h[1],r[a*3+2]=h[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,i,r=[]){const{positionSize:n}=this;i*n>=e.length&&(i+=1-e.length/n);const l=i*n;return r[0]=e[l],r[1]=e[l+1],r[2]=n===3&&e[l+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:i}=this,r=e.length-i;return e[0]===e[r]&&e[1]===e[r+1]&&(i===2||e[2]===e[r+2])}}function B1(t){return Array.isArray(t[0])}const o6=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,a6=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,EE=[0,0,0,255],l6={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:EE},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},J_={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class r0 extends Lc{getShaders(){return super.getShaders({vs:o6,fs:a6,modules:[Uh,Vh]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:J_,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:J_,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:J_,defaultValue:EE},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:n,target:l})=>this.encodePickingColor(r&&r.__source?r.__source.index:n,l)}}),this.setState({pathTesselator:new s6({fp64:this.use64bitPositions()})})}updateState(e){var h;super.updateState(e);const{props:i,changeFlags:r}=e,n=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,g=i.data.attributes||{};a.updateGeometry({data:i.data,geometryBuffer:g.getPath,buffers:g,normalize:!i._pathType,loop:i._pathType==="loop",getGeometry:i.getPath,positionFormat:i.positionFormat,wrapLongitude:i.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||n.invalidateAll()}r.extensionsChanged&&((h=this.state.model)==null||h.destroy(),this.state.model=this._getModel(),n.invalidateAll())}getPickingInfo(e){const i=super.getPickingInfo(e),{index:r}=i,n=this.props.data;return n[0]&&n[0].__source&&(i.object=n.find(l=>l.__source.index===r)),i}disablePickingIndex(e){const i=this.props.data;if(i[0]&&i[0].__source)for(let r=0;r<i.length;r++)i[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:i,capRounded:r,billboard:n,miterLimit:l,widthUnits:h,widthScale:a,widthMinPixels:g,widthMaxPixels:y}=this.props,T=this.state.model;T.setUniforms(e),T.setUniforms({jointType:Number(i),capType:Number(r),billboard:n,widthUnits:rl[h],widthScale:a,miterLimit:l,widthMinPixels:g,widthMaxPixels:y}),T.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Rs(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Fc({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("positions")}calculateSegmentTypes(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("segmentTypes")}}r0.defaultProps=l6;r0.layerName="PathLayer";const c6=r0;var n0={exports:{}};n0.exports=rg;n0.exports.default=rg;function rg(t,e,i){i=i||2;var r=e&&e.length,n=r?e[0]*i:t.length,l=AE(t,0,n,i,!0),h=[];if(!l||l.next===l.prev)return h;var a,g,y,T,S,P,M;if(r&&(l=p6(t,e,l,i)),t.length>80*i){a=y=t[0],g=T=t[1];for(var B=i;B<n;B+=i)S=t[B],P=t[B+1],S<a&&(a=S),P<g&&(g=P),S>y&&(y=S),P>T&&(T=P);M=Math.max(y-a,T-g),M=M!==0?32767/M:0}return Ih(l,h,i,a,g,M,0),h}function AE(t,e,i,r,n){var l,h;if(n===hy(t,e,i,r)>0)for(l=e;l<i;l+=r)h=z1(l,t[l],t[l+1],h);else for(l=i-r;l>=e;l-=r)h=z1(l,t[l],t[l+1],h);return h&&ng(h,h.next)&&(Rh(h),h=h.next),h}function al(t,e){if(!t)return t;e||(e=t);var i=t,r;do if(r=!1,!i.steiner&&(ng(i,i.next)||ji(i.prev,i,i.next)===0)){if(Rh(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function Ih(t,e,i,r,n,l,h){if(t){!h&&l&&x6(t,r,n,l);for(var a=t,g,y;t.prev!==t.next;){if(g=t.prev,y=t.next,l?h6(t,r,n,l):u6(t)){e.push(g.i/i|0),e.push(t.i/i|0),e.push(y.i/i|0),Rh(t),t=y.next,a=y.next;continue}if(t=y,t===a){h?h===1?(t=d6(al(t),e,i),Ih(t,e,i,r,n,l,2)):h===2&&f6(t,e,i,r,n,l):Ih(al(t),e,i,r,n,l,1);break}}}}function u6(t){var e=t.prev,i=t,r=t.next;if(ji(e,i,r)>=0)return!1;for(var n=e.x,l=i.x,h=r.x,a=e.y,g=i.y,y=r.y,T=n<l?n<h?n:h:l<h?l:h,S=a<g?a<y?a:y:g<y?g:y,P=n>l?n>h?n:h:l>h?l:h,M=a>g?a>y?a:y:g>y?g:y,B=r.next;B!==e;){if(B.x>=T&&B.x<=P&&B.y>=S&&B.y<=M&&gc(n,a,l,g,h,y,B.x,B.y)&&ji(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function h6(t,e,i,r){var n=t.prev,l=t,h=t.next;if(ji(n,l,h)>=0)return!1;for(var a=n.x,g=l.x,y=h.x,T=n.y,S=l.y,P=h.y,M=a<g?a<y?a:y:g<y?g:y,B=T<S?T<P?T:P:S<P?S:P,j=a>g?a>y?a:y:g>y?g:y,Z=T>S?T>P?T:P:S>P?S:P,G=cy(M,B,e,i,r),fe=cy(j,Z,e,i,r),re=t.prevZ,ue=t.nextZ;re&&re.z>=G&&ue&&ue.z<=fe;){if(re.x>=M&&re.x<=j&&re.y>=B&&re.y<=Z&&re!==n&&re!==h&&gc(a,T,g,S,y,P,re.x,re.y)&&ji(re.prev,re,re.next)>=0||(re=re.prevZ,ue.x>=M&&ue.x<=j&&ue.y>=B&&ue.y<=Z&&ue!==n&&ue!==h&&gc(a,T,g,S,y,P,ue.x,ue.y)&&ji(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;re&&re.z>=G;){if(re.x>=M&&re.x<=j&&re.y>=B&&re.y<=Z&&re!==n&&re!==h&&gc(a,T,g,S,y,P,re.x,re.y)&&ji(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;ue&&ue.z<=fe;){if(ue.x>=M&&ue.x<=j&&ue.y>=B&&ue.y<=Z&&ue!==n&&ue!==h&&gc(a,T,g,S,y,P,ue.x,ue.y)&&ji(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function d6(t,e,i){var r=t;do{var n=r.prev,l=r.next.next;!ng(n,l)&&PE(n,r,r.next,l)&&Ch(n,l)&&Ch(l,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(l.i/i|0),Rh(r),Rh(r.next),r=t=l),r=r.next}while(r!==t);return al(r)}function f6(t,e,i,r,n,l){var h=t;do{for(var a=h.next.next;a!==h.prev;){if(h.i!==a.i&&w6(h,a)){var g=IE(h,a);h=al(h,h.next),g=al(g,g.next),Ih(h,e,i,r,n,l,0),Ih(g,e,i,r,n,l,0);return}a=a.next}h=h.next}while(h!==t)}function p6(t,e,i,r){var n=[],l,h,a,g,y;for(l=0,h=e.length;l<h;l++)a=e[l]*r,g=l<h-1?e[l+1]*r:t.length,y=AE(t,a,g,r,!1),y===y.next&&(y.steiner=!0),n.push(b6(y));for(n.sort(g6),l=0;l<n.length;l++)i=_6(n[l],i);return i}function g6(t,e){return t.x-e.x}function _6(t,e){var i=m6(t,e);if(!i)return e;var r=IE(i,t);return al(r,r.next),al(i,i.next)}function m6(t,e){var i=e,r=t.x,n=t.y,l=-1/0,h;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var a=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>l&&(l=a,h=i.x<i.next.x?i:i.next,a===r))return h}i=i.next}while(i!==e);if(!h)return null;var g=h,y=h.x,T=h.y,S=1/0,P;i=h;do r>=i.x&&i.x>=y&&r!==i.x&&gc(n<T?r:l,n,y,T,n<T?l:r,n,i.x,i.y)&&(P=Math.abs(n-i.y)/(r-i.x),Ch(i,t)&&(P<S||P===S&&(i.x>h.x||i.x===h.x&&y6(h,i)))&&(h=i,S=P)),i=i.next;while(i!==g);return h}function y6(t,e){return ji(t.prev,t,e.prev)<0&&ji(e.next,t,t.next)<0}function x6(t,e,i,r){var n=t;do n.z===0&&(n.z=cy(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,v6(n)}function v6(t){var e,i,r,n,l,h,a,g,y=1;do{for(i=t,t=null,l=null,h=0;i;){for(h++,r=i,a=0,e=0;e<y&&(a++,r=r.nextZ,!!r);e++);for(g=y;a>0||g>0&&r;)a!==0&&(g===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,g--),l?l.nextZ=n:t=n,n.prevZ=l,l=n;i=r}l.nextZ=null,y*=2}while(h>1);return t}function cy(t,e,i,r,n){return t=(t-i)*n|0,e=(e-r)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function b6(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function gc(t,e,i,r,n,l,h,a){return(n-h)*(e-a)>=(t-h)*(l-a)&&(t-h)*(r-a)>=(i-h)*(e-a)&&(i-h)*(l-a)>=(n-h)*(r-a)}function w6(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!T6(t,e)&&(Ch(t,e)&&Ch(e,t)&&S6(t,e)&&(ji(t.prev,t,e.prev)||ji(t,e.prev,e))||ng(t,e)&&ji(t.prev,t,t.next)>0&&ji(e.prev,e,e.next)>0)}function ji(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ng(t,e){return t.x===e.x&&t.y===e.y}function PE(t,e,i,r){var n=vf(ji(t,e,i)),l=vf(ji(t,e,r)),h=vf(ji(i,r,t)),a=vf(ji(i,r,e));return!!(n!==l&&h!==a||n===0&&xf(t,i,e)||l===0&&xf(t,r,e)||h===0&&xf(i,t,r)||a===0&&xf(i,e,r))}function xf(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function vf(t){return t>0?1:t<0?-1:0}function T6(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&PE(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function Ch(t,e){return ji(t.prev,t,t.next)<0?ji(t,e,t.next)>=0&&ji(t,t.prev,e)>=0:ji(t,e,t.prev)<0||ji(t,t.next,e)<0}function S6(t,e){var i=t,r=!1,n=(t.x+e.x)/2,l=(t.y+e.y)/2;do i.y>l!=i.next.y>l&&i.next.y!==i.y&&n<(i.next.x-i.x)*(l-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function IE(t,e){var i=new uy(t.i,t.x,t.y),r=new uy(e.i,e.x,e.y),n=t.next,l=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,l.next=r,r.prev=l,r}function z1(t,e,i,r){var n=new uy(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Rh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function uy(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}rg.deviation=function(t,e,i,r){var n=e&&e.length,l=n?e[0]*i:t.length,h=Math.abs(hy(t,0,l,i));if(n)for(var a=0,g=e.length;a<g;a++){var y=e[a]*i,T=a<g-1?e[a+1]*i:t.length;h-=Math.abs(hy(t,y,T,i))}var S=0;for(a=0;a<r.length;a+=3){var P=r[a]*i,M=r[a+1]*i,B=r[a+2]*i;S+=Math.abs((t[P]-t[B])*(t[M+1]-t[P+1])-(t[P]-t[M])*(t[B+1]-t[P+1]))}return h===0&&S===0?0:Math.abs((S-h)/h)};function hy(t,e,i,r){for(var n=0,l=e,h=i-r;l<i;l+=r)n+=(t[h]-t[l])*(t[l+1]+t[h+1]),h=l;return n}rg.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var l=0;l<t[n].length;l++)for(var h=0;h<e;h++)i.vertices.push(t[n][l][h]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i};var E6=n0.exports;const CE=Wp(E6),bf=gE.CLOCKWISE,U1=gE.COUNTER_CLOCKWISE,ua={isClosed:!0};function A6(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function ih(t){return"positions"in t?t.positions:t}function zf(t){return"holeIndices"in t?t.holeIndices:null}function P6(t){return Array.isArray(t[0])}function I6(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function C6(t){const e=t[0],i=t[t.length-1];return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]}function R6(t,e,i,r){for(let n=0;n<e;n++)if(t[i+n]!==t[r-e+n])return!1;return!0}function V1(t,e,i,r,n){let l=e;const h=i.length;for(let a=0;a<h;a++)for(let g=0;g<r;g++)t[l++]=i[a][g]||0;if(!C6(i))for(let a=0;a<r;a++)t[l++]=i[0][a]||0;return ua.start=e,ua.end=l,ua.size=r,_E(t,n,ua),l}function $1(t,e,i,r,n=0,l,h){l=l||i.length;const a=l-n;if(a<=0)return e;let g=e;for(let y=0;y<a;y++)t[g++]=i[n+y];if(!R6(i,r,n,l))for(let y=0;y<r;y++)t[g++]=i[n+y];return ua.start=e,ua.end=g,ua.size=r,_E(t,h,ua),g}function M6(t,e){A6(t);const i=[],r=[];if("positions"in t){const{positions:n,holeIndices:l}=t;if(l){let h=0;for(let a=0;a<=l.length;a++)h=$1(i,h,n,e,l[a-1],l[a],a===0?bf:U1),r.push(h);return r.pop(),{positions:i,holeIndices:r}}t=n}if(!P6(t))return $1(i,0,t,e,0,i.length,bf),i;if(!I6(t)){let n=0;for(const[l,h]of t.entries())n=V1(i,n,h,e,l===0?bf:U1),r.push(n);return r.pop(),{positions:i,holeIndices:r}}return V1(i,0,t,e,bf),i}function Q_(t,e,i){const r=t.length/3;let n=0;for(let l=0;l<r;l++){const h=(l+1)%r;n+=t[l*3+e]*t[h*3+i],n-=t[h*3+e]*t[l*3+i]}return Math.abs(n/2)}function j1(t,e,i,r){const n=t.length/3;for(let l=0;l<n;l++){const h=l*3,a=t[h+0],g=t[h+1],y=t[h+2];t[h+e]=a,t[h+i]=g,t[h+r]=y}}function k6(t,e,i,r){let n=zf(t);n&&(n=n.map(a=>a/e));let l=ih(t);const h=r&&e===3;if(i){const a=l.length;l=l.slice();const g=[];for(let y=0;y<a;y+=e){g[0]=l[y],g[1]=l[y+1],h&&(g[2]=l[y+2]);const T=i(g);l[y]=T[0],l[y+1]=T[1],h&&(l[y+2]=T[2])}}if(h){const a=Q_(l,0,1),g=Q_(l,0,2),y=Q_(l,1,2);if(!a&&!g&&!y)return[];a>g&&a>y||(g>y?(i||(l=l.slice()),j1(l,0,2,1)):(i||(l=l.slice()),j1(l,2,0,1)))}return CE(l,n,e)}class O6 extends hE{constructor(e){const{fp64:i,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:i}=this;return e==="indices"?i.indices&&i.indices.subarray(0,this.vertexCount):i[e]}updateGeometry(e){super.updateGeometry(e);const i=this.buffers.indices;if(i)this.vertexCount=(i.value||i).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const i=M6(e,this.positionSize);return this.opts.resolution?bE(ih(i),zf(i),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?Q4(ih(i),zf(i),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):i}return e}getGeometrySize(e){if(W1(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}return ih(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,i){if(e&&W1(e))for(const r of e){const n=this.getGeometrySize(r);i.geometrySize=n,this.updateGeometryAttributes(r,i),i.vertexStart+=n,i.indexStart=this.indexStarts[i.geometryIndex+1]}else{const r=e;this._updateIndices(r,i),this._updatePositions(r,i),this._updateVertexValid(r,i)}}_updateIndices(e,{geometryIndex:i,vertexStart:r,indexStart:n}){const{attributes:l,indexStarts:h,typedArrayManager:a}=this;let g=l.indices;if(!g||!e)return;let y=n;const T=k6(e,this.positionSize,this.opts.preproject,this.opts.full3d);g=a.allocate(g,n+T.length,{copy:!0});for(let S=0;S<T.length;S++)g[y++]=T[S]+r;h[i+1]=n+T.length,l.indices=g}_updatePositions(e,{vertexStart:i,geometrySize:r}){const{attributes:{positions:n},positionSize:l}=this;if(!n||!e)return;const h=ih(e);for(let a=i,g=0;g<r;a++,g++){const y=h[g*l],T=h[g*l+1],S=l>2?h[g*l+2]:0;n[a*3]=y,n[a*3+1]=T,n[a*3+2]=S}}_updateVertexValid(e,{vertexStart:i,geometrySize:r}){const{positionSize:n}=this,l=this.attributes.vertexValid,h=e&&zf(e);if(e&&e.edgeTypes?l.set(e.edgeTypes,i):l.fill(1,i,i+r),h)for(let a=0;a<h.length;a++)l[i+h[a]/n-1]=0;l[i+r-1]=0}}function W1(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const RE=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,F6=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${RE}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,D6=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${RE}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,N6=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,xp=[0,0,0,255],L6={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:xp},getLineColor:{type:"accessor",value:xp},material:!0},wf={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class s0 extends Lc{getShaders(e){return super.getShaders({vs:e==="top"?F6:D6,fs:N6,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Uh,fO,Vh]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&i===Qt.DEFAULT&&(i=Qt.LNGLAT);let n;i===Qt.LNGLAT&&(r?n=e.projectPosition.bind(e):n=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new O6({preproject:n,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const l=this.getAttributeManager(),h=!0;l.remove(["instancePickingColors"]),l.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:h},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:wf,accessor:"getPolygon",update:this.calculatePositions,noAlloc:h,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:h},elevations:{size:1,stepMode:"dynamic",transition:wf,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:wf,accessor:"getFillColor",defaultValue:xp},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:wf,accessor:"getLineColor",defaultValue:xp},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:g,target:y})=>this.encodePickingColor(a&&a.__source?a.__source.index:g,y)}})}getPickingInfo(e){const i=super.getPickingInfo(e),{index:r}=i,n=this.props.data;return n[0]&&n[0].__source&&(i.object=n.find(l=>l.__source.index===r)),i}disablePickingIndex(e){const i=this.props.data;if(i[0]&&i[0].__source)for(let r=0;r<i.length;r++)i[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:i,filled:r,wireframe:n,elevationScale:l}=this.props,{topModel:h,sideModel:a,wireframeModel:g,polygonTesselator:y}=this.state,T={...e,extruded:!!i,elevationScale:l};g&&n&&(g.setInstanceCount(y.instanceCount-1),g.setUniforms(T),g.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(y.instanceCount-1),a.setUniforms(T),a.draw(this.context.renderPass)),h&&r&&(h.setVertexCount(y.vertexCount),h.setUniforms(T),h.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:i,oldProps:r,changeFlags:n}=e,l=this.getAttributeManager();(n.extensionsChanged||i.filled!==r.filled||i.extruded!==r.extruded)&&((a=this.state.models)==null||a.forEach(g=>g.destroy()),this.setState(this._getModels()),l.invalidateAll())}updateGeometry({props:e,oldProps:i,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:l}=this.state,h=e.data.attributes||{};l.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:h.getPolygon,buffers:h,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:i,extruded:r}=this.props;let n,l,h;if(i){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;const g=this.getAttributeManager().getBufferLayouts({isInstanced:!1});n=new Rs(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:g,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});l=new Rs(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,uniforms:{isWireframe:!1},geometry:new Fc({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),h=new Rs(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,uniforms:{isWireframe:!0},geometry:new Fc({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[l,h,n].filter(Boolean),topModel:n,sideModel:l,wireframeModel:h}}calculateIndices(e){const{polygonTesselator:i}=this.state;e.startIndices=i.indexStarts,e.value=i.get("indices")}calculatePositions(e){const{polygonTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}s0.defaultProps=L6;s0.layerName="SolidPolygonLayer";const B6=s0;function z6({data:t,getIndex:e,dataRange:i,replace:r}){const{startRow:n=0,endRow:l=1/0}=i,h=t.length;let a=h,g=h;for(let P=0;P<h;P++){const M=e(t[P]);if(a>P&&M>=n&&(a=P),M>=l){g=P;break}}let y=a;const S=g-a!==r.length?t.slice(g):void 0;for(let P=0;P<r.length;P++)t[y++]=r[P];if(S){for(let P=0;P<S.length;P++)t[y++]=S[P];t.length=y}return{startRow:a,endRow:a+r.length}}function U6(t,e){if(!t)return null;const i="startIndices"in t?t.startIndices[e]:e,r=t.featureIds.value[i];return i!==-1?V6(t,r,i):null}function V6(t,e,i){const r={properties:{...t.properties[e]}};for(const n in t.numericProps)r.properties[n]=t.numericProps[n].value[i];return r}function $6(t,e){const i={points:null,lines:null,polygons:null};for(const r in i){const n=t[r].globalFeatureIds.value;i[r]=new Uint8ClampedArray(n.length*4);const l=[];for(let h=0;h<n.length;h++)e(n[h],l),i[r][h*4+0]=l[0],i[r][h*4+1]=l[1],i[r][h*4+2]=l[2],i[r][h*4+3]=255}return i}const j6=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,em=192/256,H1=[],W6={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class o0 extends pE{getShaders(){return{...super.getShaders(),fs:j6}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(i,{index:r,target:n})=>this.encodePickingColor(r,n)}})}updateState(e){super.updateState(e);const{props:i,oldProps:r}=e;let{outlineColor:n}=i;n!==r.outlineColor&&(n=n.map(l=>l/255),n[3]=Number.isFinite(n[3])?n[3]:1,this.setState({outlineColor:n})),!i.sdf&&i.outlineWidth&&Wt.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:i,smoothing:r,outlineWidth:n}=this.props,{outlineColor:l}=this.state,h=n?Math.max(r,em*(1-n)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:em,outlineBuffer:h,gamma:r,sdf:!!i,outlineColor:l},super.draw(e),i&&n){const{iconManager:a}=this.state,g=a.getTexture(),y=this.state.model;g&&(y.setUniforms({outlineBuffer:em}),y.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(i=>super.getInstanceOffset(i)):H1}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(i=>super.getInstanceIconFrame(i)):H1}}o0.defaultProps=W6;o0.layerName="MultiIconLayer";const H6=o0,uh=1e20;class q6{constructor({fontSize:e=24,buffer:i=3,radius:r=8,cutoff:n=.25,fontFamily:l="sans-serif",fontWeight:h="normal",fontStyle:a="normal"}={}){this.buffer=i,this.cutoff=n,this.radius=r;const g=this.size=e+i*4,y=this._createCanvas(g),T=this.ctx=y.getContext("2d",{willReadFrequently:!0});T.font=`${a} ${h} ${e}px ${l}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(e){const i=document.createElement("canvas");return i.width=i.height=e,i}draw(e){const{width:i,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:l,actualBoundingBoxRight:h}=this.ctx.measureText(e),a=Math.ceil(r),g=0,y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-l))),T=Math.min(this.size-this.buffer,a+Math.ceil(n)),S=y+2*this.buffer,P=T+2*this.buffer,M=Math.max(S*P,0),B=new Uint8ClampedArray(M),j={data:B,width:S,height:P,glyphWidth:y,glyphHeight:T,glyphTop:a,glyphLeft:g,glyphAdvance:i};if(y===0||T===0)return j;const{ctx:Z,buffer:G,gridInner:fe,gridOuter:re}=this;Z.clearRect(G,G,y,T),Z.fillText(e,G,G+a);const ue=Z.getImageData(G,G,y,T);re.fill(uh,0,M),fe.fill(0,0,M);for(let Me=0;Me<T;Me++)for(let Oe=0;Oe<y;Oe++){const $e=ue.data[4*(Me*y+Oe)+3]/255;if($e===0)continue;const ke=(Me+G)*S+Oe+G;if($e===1)re[ke]=0,fe[ke]=uh;else{const je=.5-$e;re[ke]=je>0?je*je:0,fe[ke]=je<0?je*je:0}}q1(re,0,0,S,P,S,this.f,this.v,this.z),q1(fe,G,G,y,T,S,this.f,this.v,this.z);for(let Me=0;Me<M;Me++){const Oe=Math.sqrt(re[Me])-Math.sqrt(fe[Me]);B[Me]=Math.round(255-255*(Oe/this.radius+this.cutoff))}return j}}function q1(t,e,i,r,n,l,h,a,g){for(let y=e;y<e+r;y++)X1(t,i*l+y,l,n,h,a,g);for(let y=i;y<i+n;y++)X1(t,y*l+e,1,r,h,a,g)}function X1(t,e,i,r,n,l,h){l[0]=0,h[0]=-uh,h[1]=uh,n[0]=t[e];for(let a=1,g=0,y=0;a<r;a++){n[a]=t[e+a*i];const T=a*a;do{const S=l[g];y=(n[a]-n[S]+T-S*S)/(a-S)/2}while(y<=h[g]&&--g>-1);g++,l[g]=a,h[g]=y,h[g+1]=uh}for(let a=0,g=0;a<r;a++){for(;h[g+1]<a;)g++;const y=l[g],T=a-y;t[e+a*i]=n[y]+T*T}}const X6=32,Z6=[];function Y6(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function K6({characterSet:t,getFontWidth:e,fontHeight:i,buffer:r,maxCanvasWidth:n,mapping:l={},xOffset:h=0,yOffset:a=0}){let g=0,y=h;const T=i+r*2;for(const S of t)if(!l[S]){const P=e(S);y+P+r*2>n&&(y=0,g++),l[S]={x:y+r,y:a+g*T+r,width:P,height:T,layoutWidth:P,layoutHeight:i},y+=P+r*2}return{mapping:l,xOffset:y,yOffset:a+g*T,canvasHeight:Y6(a+(g+1)*T)}}function ME(t,e,i,r){var l;let n=0;for(let h=e;h<i;h++){const a=t[h];n+=((l=r[a])==null?void 0:l.layoutWidth)||0}return n}function kE(t,e,i,r,n,l){let h=e,a=0;for(let g=e;g<i;g++){const y=ME(t,g,g+1,n);a+y>r&&(h<g&&l.push(g),h=g,a=0),a+=y}return a}function G6(t,e,i,r,n,l){let h=e,a=e,g=e,y=0;for(let T=e;T<i;T++)if((t[T]===" "||t[T+1]===" "||T+1===i)&&(g=T+1),g>a){let S=ME(t,a,g,n);y+S>r&&(h<a&&(l.push(a),h=a,y=0),S>r&&(S=kE(t,a,g,r,n,l),h=l[l.length-1])),a=g,y+=S}return y}function J6(t,e,i,r,n=0,l){l===void 0&&(l=t.length);const h=[];return e==="break-all"?kE(t,n,l,i,r,h):G6(t,n,l,i,r,h),h}function Q6(t,e,i,r,n,l){let h=0,a=0;for(let g=e;g<i;g++){const y=t[g],T=r[y];T?(a||(a=T.layoutHeight),n[g]=h+T.layoutWidth/2,h+=T.layoutWidth):(Wt.warn(`Missing character: ${y} (${y.codePointAt(0)})`)(),n[g]=h,h+=X6)}l[0]=h,l[1]=a}function eU(t,e,i,r,n){var Z;const l=Array.from(t),h=l.length,a=new Array(h),g=new Array(h),y=new Array(h),T=(i==="break-word"||i==="break-all")&&isFinite(r)&&r>0,S=[0,0],P=[0,0];let M=0,B=0,j=0;for(let G=0;G<=h;G++){const fe=l[G];if((fe===`
`||G===h)&&(j=G),j>B){const re=T?J6(l,i,r,n,B,j):Z6;for(let ue=0;ue<=re.length;ue++){const Me=ue===0?B:re[ue-1],Oe=ue<re.length?re[ue]:j;Q6(l,Me,Oe,n,a,P);for(let $e=Me;$e<Oe;$e++){const ke=l[$e],je=((Z=n[ke])==null?void 0:Z.layoutOffsetY)||0;g[$e]=M+P[1]/2+je,y[$e]=P[0]}M=M+P[1]*e,S[0]=Math.max(S[0],P[0])}B=j}fe===`
`&&(a[B]=0,g[B]=0,y[B]=0,B++)}return S[1]=M,{x:a,y:g,rowWidth:y,size:S}}function tU({value:t,length:e,stride:i,offset:r,startIndices:n,characterSet:l}){const h=t.BYTES_PER_ELEMENT,a=i?i/h:1,g=r?r/h:0,y=n[e]||Math.ceil((t.length-g)/a),T=l&&new Set,S=new Array(e);let P=t;if(a>1||g>0){const M=t.constructor;P=new M(y);for(let B=0;B<y;B++)P[B]=t[B*a+g]}for(let M=0;M<e;M++){const B=n[M],j=n[M+1]||y,Z=P.subarray(B,j);S[M]=String.fromCodePoint.apply(null,Z),T&&Z.forEach(T.add,T)}if(T)for(const M of T)l.add(String.fromCodePoint(M));return{texts:S,characterCount:y}}class OE{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const i=this._cache[e];return i&&(this._deleteOrder(e),this._appendOrder(e)),i}set(e,i){this._cache[e]?(this.delete(e),this._cache[e]=i,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=i,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const i=this._order.indexOf(e);i>=0&&this._order.splice(i,1)}_appendOrder(e){this._order.push(e)}}function iU(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Sc={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:iU(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Z1=1024,Y1=.9,K1=1.2,FE=3;let vp=new OE(FE);function rU(t,e){let i;typeof e=="string"?i=new Set(Array.from(e)):i=new Set(e);const r=vp.get(t);if(!r)return i;for(const n in r.mapping)i.has(n)&&i.delete(n);return i}function nU(t,e){for(let i=0;i<t.length;i++)e.data[4*i+3]=t[i]}function G1(t,e,i,r){t.font=`${r} ${i}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function sU(t){Wt.assert(Number.isFinite(t)&&t>=FE,"Invalid cache limit"),vp=new OE(t)}class oU{constructor(){this.props={...Sc}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:i}=this.props;return(e*K1+i*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const i=rU(this._key,this.props.characterSet),r=vp.get(this._key);if(r&&i.size===0){this._atlas!==r&&(this._atlas=r);return}const n=this._generateFontAtlas(i,r);this._atlas=n,vp.set(this._key,n)}_generateFontAtlas(e,i){const{fontFamily:r,fontWeight:n,fontSize:l,buffer:h,sdf:a,radius:g,cutoff:y}=this.props;let T=i&&i.data;T||(T=document.createElement("canvas"),T.width=Z1);const S=T.getContext("2d",{willReadFrequently:!0});G1(S,r,l,n);const{mapping:P,canvasHeight:M,xOffset:B,yOffset:j}=K6({getFontWidth:Z=>S.measureText(Z).width,fontHeight:l*K1,buffer:h,characterSet:e,maxCanvasWidth:Z1,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(T.height!==M){const Z=S.getImageData(0,0,T.width,T.height);T.height=M,S.putImageData(Z,0,0)}if(G1(S,r,l,n),a){const Z=new q6({fontSize:l,buffer:h,radius:g,cutoff:y,fontFamily:r,fontWeight:`${n}`});for(const G of e){const{data:fe,width:re,height:ue,glyphTop:Me}=Z.draw(G);P[G].width=re,P[G].layoutOffsetY=l*Y1-Me;const Oe=S.createImageData(re,ue);nU(fe,Oe),S.putImageData(Oe,P[G].x,P[G].y)}}else for(const Z of e)S.fillText(Z,P[Z].x,P[Z].y+h+l*Y1);return{xOffset:B,yOffset:j,mapping:P,data:T,width:T.width,height:T.height}}_getKey(){const{fontFamily:e,fontWeight:i,fontSize:r,buffer:n,sdf:l,radius:h,cutoff:a}=this.props;return l?`${e} ${i} ${r} ${n} ${h} ${a}`:`${e} ${i} ${r} ${n}`}}const aU=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,lU=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,cU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class a0 extends Lc{getShaders(){return super.getShaders({vs:aU,fs:lU,modules:[Uh,Vh]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e);const{changeFlags:i}=e;i.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:i,sizeScale:r,sizeUnits:n,sizeMinPixels:l,sizeMaxPixels:h,getLineWidth:a}=this.props;let{padding:g}=this.props;g.length<4&&(g=[g[0],g[1],g[0],g[1]]);const y=this.state.model;y.setUniforms(e),y.setUniforms({billboard:i,stroked:!!a,padding:g,sizeUnits:rl[n],sizeScale:r,sizeMinPixels:l,sizeMaxPixels:h}),y.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new Rs(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Fc({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}a0.defaultProps=cU;a0.layerName="TextBackgroundLayer";const uU=a0,J1={start:1,middle:0,end:-1},Q1={top:1,center:0,bottom:-1},tm=[0,0,0,255],hU=1,dU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:tm},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Sc.characterSet},fontFamily:Sc.fontFamily,fontWeight:Sc.fontWeight,lineHeight:hU,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:tm},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:tm},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class l0 extends Jy{constructor(){super(...arguments),this.getBoundingRect=(e,i)=>{let{size:[r,n]}=this.transformParagraph(e,i);const{fontSize:l}=this.state.fontAtlasManager.props;r/=l,n/=l;const{getTextAnchor:h,getAlignmentBaseline:a}=this.props,g=J1[typeof h=="function"?h(e,i):h],y=Q1[typeof a=="function"?a(e,i):a];return[(g-1)*r/2,(y-1)*n/2,r,n]},this.getIconOffsets=(e,i)=>{const{getTextAnchor:r,getAlignmentBaseline:n}=this.props,{x:l,y:h,rowWidth:a,size:[g,y]}=this.transformParagraph(e,i),T=J1[typeof r=="function"?r(e,i):r],S=Q1[typeof n=="function"?n(e,i):n],P=l.length,M=new Array(P*2);let B=0;for(let j=0;j<P;j++){const Z=(1-T)*(g-a[j])/2;M[B++]=(T-1)*g/2+Z+l[j],M[B++]=(S-1)*y/2+h[j]}return M}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new oU},this.props.maxWidth>0&&Wt.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:i,oldProps:r,changeFlags:n}=e;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||i.lineHeight!==r.lineHeight||i.wordBreak!==r.wordBreak||i.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:i,fontWeight:r}=this.props,{fontAtlasManager:n,characterSet:l}=this.state,h={...e,characterSet:l,fontFamily:i,fontWeight:r};if(!n.mapping)return n.setProps(h),!0;for(const a in h)if(h[a]!==n.props[a])return n.setProps(h),!0;return!1}_updateText(){var g;const{data:e,characterSet:i}=this.props,r=(g=e.attributes)==null?void 0:g.getText;let{getText:n}=this.props,l=e.startIndices,h;const a=i==="auto"&&new Set;if(r&&l){const{texts:y,characterCount:T}=tU({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:l,characterSet:a});h=T,n=(S,{index:P})=>y[P]}else{const{iterable:y,objectInfo:T}=eg(e);l=[0],h=0;for(const S of y){T.index++;const P=Array.from(n(S,T)||"");a&&P.forEach(a.add,a),h+=P.length,l.push(h)}}this.setState({getText:n,startIndices:l,numInstances:h,characterSet:a||i})}transformParagraph(e,i){const{fontAtlasManager:r}=this.state,n=r.mapping,l=this.state.getText,{wordBreak:h,lineHeight:a,maxWidth:g}=this.props,y=l(e,i)||"";return eU(y,a,h,g*r.props.fontSize,n)}renderLayers(){const{startIndices:e,numInstances:i,getText:r,fontAtlasManager:{scale:n,atlas:l,mapping:h},styleVersion:a}=this.state,{data:g,_dataDiff:y,getPosition:T,getColor:S,getSize:P,getAngle:M,getPixelOffset:B,getBackgroundColor:j,getBorderColor:Z,getBorderWidth:G,backgroundPadding:fe,background:re,billboard:ue,fontSettings:Me,outlineWidth:Oe,outlineColor:$e,sizeScale:ke,sizeUnits:je,sizeMinPixels:Ue,sizeMaxPixels:ct,transitions:tt,updateTriggers:pt}=this.props,ot=this.getSubLayerClass("characters",H6),ei=this.getSubLayerClass("background",uU);return[re&&new ei({getFillColor:j,getLineColor:Z,getLineWidth:G,padding:fe,getPosition:T,getSize:P,getAngle:M,getPixelOffset:B,billboard:ue,sizeScale:ke,sizeUnits:je,sizeMinPixels:Ue,sizeMaxPixels:ct,transitions:tt&&{getPosition:tt.getPosition,getAngle:tt.getAngle,getSize:tt.getSize,getFillColor:tt.getBackgroundColor,getLineColor:tt.getBorderColor,getLineWidth:tt.getBorderWidth,getPixelOffset:tt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:pt.getPosition,getAngle:pt.getAngle,getSize:pt.getSize,getFillColor:pt.getBackgroundColor,getLineColor:pt.getBorderColor,getLineWidth:pt.getBorderWidth,getPixelOffset:pt.getPixelOffset,getBoundingRect:{getText:pt.getText,getTextAnchor:pt.getTextAnchor,getAlignmentBaseline:pt.getAlignmentBaseline,styleVersion:a}}}),{data:g.attributes&&g.attributes.background?{length:g.length,attributes:g.attributes.background}:g,_dataDiff:y,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new ot({sdf:Me.sdf,smoothing:Number.isFinite(Me.smoothing)?Me.smoothing:Sc.smoothing,outlineWidth:Oe/(Me.radius||Sc.radius),outlineColor:$e,iconAtlas:l,iconMapping:h,getPosition:T,getColor:S,getSize:P,getAngle:M,getPixelOffset:B,billboard:ue,sizeScale:ke*n,sizeUnits:je,sizeMinPixels:Ue*n,sizeMaxPixels:ct*n,transitions:tt&&{getPosition:tt.getPosition,getAngle:tt.getAngle,getColor:tt.getColor,getSize:tt.getSize,getPixelOffset:tt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:pt.getText,getPosition:pt.getPosition,getAngle:pt.getAngle,getColor:pt.getColor,getSize:pt.getSize,getPixelOffset:pt.getPixelOffset,getIconOffsets:{getTextAnchor:pt.getTextAnchor,getAlignmentBaseline:pt.getAlignmentBaseline,styleVersion:a}}}),{data:g,_dataDiff:y,startIndices:e,numInstances:i,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){sU(e)}}l0.defaultProps=dU;l0.layerName="TextLayer";const fU=l0,Uf={circle:{type:C4,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:pE,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:fU,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Vf={type:c6,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},dy={type:B6,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Yu({type:t,props:e}){const i={};for(const r in e)i[r]=t.defaultProps[e[r]];return i}function im(t,e){const{transitions:i,updateTriggers:r}=t.props,n={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(const l in e){const h=e[l];let a=t.props[l];l.startsWith("get")&&(a=t.getSubLayerAccessor(a),n.updateTriggers[h]=r[l],i&&(n.transitions[h]=i[l])),n[h]=a}return n}function pU(t){if(Array.isArray(t))return t;switch(Wt.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Wt.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function ew(t,e,i={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:l=t.length}=i;for(let h=n;h<l;h++){const a=t[h],{geometry:g}=a;if(g)if(g.type==="GeometryCollection"){Wt.assert(Array.isArray(g.geometries),"GeoJSON does not have geometries array");const{geometries:y}=g;for(let T=0;T<y.length;T++){const S=y[T];tw(S,r,e,a,h)}}else tw(g,r,e,a,h)}return r}function tw(t,e,i,r,n){const{type:l,coordinates:h}=t,{pointFeatures:a,lineFeatures:g,polygonFeatures:y,polygonOutlineFeatures:T}=e;if(!_U(l,h)){Wt.warn(`${l} coordinates are malformed`)();return}switch(l){case"Point":a.push(i({geometry:t},r,n));break;case"MultiPoint":h.forEach(S=>{a.push(i({geometry:{type:"Point",coordinates:S}},r,n))});break;case"LineString":g.push(i({geometry:t},r,n));break;case"MultiLineString":h.forEach(S=>{g.push(i({geometry:{type:"LineString",coordinates:S}},r,n))});break;case"Polygon":y.push(i({geometry:t},r,n)),h.forEach(S=>{T.push(i({geometry:{type:"LineString",coordinates:S}},r,n))});break;case"MultiPolygon":h.forEach(S=>{y.push(i({geometry:{type:"Polygon",coordinates:S}},r,n)),S.forEach(P=>{T.push(i({geometry:{type:"LineString",coordinates:P}},r,n))})});break}}const gU={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function _U(t,e){let i=gU[t];for(Wt.assert(i,`Unknown GeoJSON type ${t}`);e&&--i>0;)e=e[0];return e&&Number.isFinite(e[0])}function DE(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Tf(t){return t.geometry.coordinates}function mU(t,e){const i=DE(),{pointFeatures:r,lineFeatures:n,polygonFeatures:l,polygonOutlineFeatures:h}=t;return i.points.data=r,i.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),i.points.getPosition=Tf,i.lines.data=n,i.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),i.lines.getPath=Tf,i.polygons.data=l,i.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),i.polygons.getPolygon=Tf,i.polygonsOutline.data=h,i.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),i.polygonsOutline.getPath=Tf,i}function yU(t,e){const i=DE(),{points:r,lines:n,polygons:l}=t,h=$6(t,e);return i.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:4,value:h.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:4,value:h.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},i.lines._pathType="open",i.polygons.data={length:l.polygonIndices.value.length-1,startIndices:l.polygonIndices.value,attributes:{...l.attributes,getPolygon:l.positions,pickingColors:{size:4,value:h.polygons}},properties:l.properties,numericProps:l.numericProps,featureIds:l.featureIds},i.polygons._normalize=!1,l.triangles&&(i.polygons.data.attributes.indices=l.triangles.value),i.polygonsOutline.data={length:l.primitivePolygonIndices.value.length-1,startIndices:l.primitivePolygonIndices.value,attributes:{...l.attributes,getPath:l.positions,instancePickingColors:{size:4,value:h.polygons}},properties:l.properties,numericProps:l.numericProps,featureIds:l.featureIds},i.polygonsOutline._pathType="open",i}const xU=["points","linestrings","polygons"],vU={...Yu(Uf.circle),...Yu(Uf.icon),...Yu(Uf.text),...Yu(Vf),...Yu(dy),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class c0 extends Jy{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:i}){if(!i.dataChanged)return;const{data:r}=this.props,n=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:n}),n?this._updateStateBinary({props:e,changeFlags:i}):this._updateStateJSON({props:e,changeFlags:i})}_updateStateBinary({props:e,changeFlags:i}){const r=yU(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:i}){const r=pU(e.data),n=this.getSubLayerRow.bind(this);let l={};const h={};if(Array.isArray(i.dataChanged)){const g=this.state.features;for(const y in g)l[y]=g[y].slice(),h[y]=[];for(const y of i.dataChanged){const T=ew(r,n,y);for(const S in g)h[S].push(z6({data:l[S],getIndex:P=>P.__source.index,dataRange:y,replace:T[S]}))}}else l=ew(r,n);const a=mU(l,h);this.setState({features:l,featuresDiff:h,layerProps:a})}getPickingInfo(e){const i=super.getPickingInfo(e),{index:r,sourceLayer:n}=i;return i.featureType=xU.find(l=>n.id.startsWith(`${this.id}-${l}-`)),r>=0&&n.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(i.index=this.props.data.points.globalFeatureIds.value[r]),i}_updateAutoHighlight(e){const i=`${this.id}-points-`,r=e.featureType==="points";for(const n of this.getSubLayers())n.id.startsWith(i)===r&&n.updateAutoHighlight(e)}_renderPolygonLayer(){var h;const{extruded:e,wireframe:i}=this.props,{layerProps:r}=this.state,n="polygons-fill",l=this.shouldRenderSubLayer(n,(h=r.polygons)==null?void 0:h.data)&&this.getSubLayerClass(n,dy.type);if(l){const a=im(this,dy.props),g=e&&i;return g||delete a.getLineColor,a.updateTriggers.lineColors=g,new l(a,this.getSubLayerProps({id:n,updateTriggers:a.updateTriggers}),r.polygons)}return null}_renderLineLayers(){var g,y;const{extruded:e,stroked:i}=this.props,{layerProps:r}=this.state,n="polygons-stroke",l="linestrings",h=!e&&i&&this.shouldRenderSubLayer(n,(g=r.polygonsOutline)==null?void 0:g.data)&&this.getSubLayerClass(n,Vf.type),a=this.shouldRenderSubLayer(l,(y=r.lines)==null?void 0:y.data)&&this.getSubLayerClass(l,Vf.type);if(h||a){const T=im(this,Vf.props);return[h&&new h(T,this.getSubLayerProps({id:n,updateTriggers:T.updateTriggers}),r.polygonsOutline),a&&new a(T,this.getSubLayerProps({id:l,updateTriggers:T.updateTriggers}),r.lines)]}return null}_renderPointLayers(){var a;const{pointType:e}=this.props,{layerProps:i,binary:r}=this.state;let{highlightedObjectIndex:n}=this.props;!r&&Number.isFinite(n)&&(n=i.points.data.findIndex(g=>g.__source.index===n));const l=new Set(e.split("+")),h=[];for(const g of l){const y=`points-${g}`,T=Uf[g],S=T&&this.shouldRenderSubLayer(y,(a=i.points)==null?void 0:a.data)&&this.getSubLayerClass(y,T.type);if(S){const P=im(this,T.props);let M=i.points;if(g==="text"&&r){const{instancePickingColors:B,...j}=M.data.attributes;M={...M,data:{...M.data,attributes:j}}}h.push(new S(P,this.getSubLayerProps({id:y,updateTriggers:P.updateTriggers,highlightedObjectIndex:n}),M))}}return h}renderLayers(){const{extruded:e}=this.props,i=this._renderPolygonLayer(),r=this._renderLineLayers(),n=this._renderPointLayers();return[!e&&i,r,n,e&&i]}getSubLayerAccessor(e){const{binary:i}=this.state;return!i||typeof e!="function"?super.getSubLayerAccessor(e):(r,n)=>{const{data:l,index:h}=n,a=U6(l,h);return e(a,n)}}}c0.layerName="GeoJsonLayer";c0.defaultProps=vU;const sg=c0;class bU{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:i,onLoad:r,onError:n}){const{index:l,id:h,bbox:a,userData:g,zoom:y}=this,T=this._loaderId;this._abortController=new AbortController;const{signal:S}=this._abortController,P=await i.scheduleRequest(this,j=>j.isSelected?1:-1);if(!P){this._isCancelled=!0;return}if(this._isCancelled){P.done();return}let M=null,B;try{M=await e({index:l,id:h,bbox:a,userData:g,zoom:y,signal:S})}catch(j){B=j||!0}finally{P.done()}if(T===this._loaderId){if(this._loader=void 0,this.content=M,this._isCancelled&&!M){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,B?n(B,this):r(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const Jr={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},iw=new mt,wU=new mt;class u0{constructor(e=[0,0,0],i=[0,0,0],r){r=r||iw.copy(e).add(i).scale(.5),this.center=new mt(r),this.halfDiagonal=new mt(i).subtract(this.center),this.minimum=new mt(e),this.maximum=new mt(i)}clone(){return new u0(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:i}=this,r=wU.from(e.normal),n=i.x*Math.abs(r.x)+i.y*Math.abs(r.y)+i.z*Math.abs(r.z),l=this.center.dot(r)+e.distance;return l-n>0?Jr.INSIDE:l+n<0?Jr.OUTSIDE:Jr.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const i=iw.from(e).subtract(this.center),{halfDiagonal:r}=this;let n=0,l;return l=Math.abs(i.x)-r.x,l>0&&(n+=l*l),l=Math.abs(i.y)-r.y,l>0&&(n+=l*l),l=Math.abs(i.z)-r.z,l>0&&(n+=l*l),n}}const Ku=new mt,rw=new mt;class h0{constructor(e=[0,0,0],i=0){this.radius=-0,this.center=new mt,this.fromCenterRadius(e,i)}fromCenterRadius(e,i){return this.center.from(e),this.radius=i,this}fromCornerPoints(e,i){return i=Ku.from(i),this.center=new mt().from(e).add(i).scale(.5),this.radius=this.center.distance(i),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new h0(this.center,this.radius)}union(e){const i=this.center,r=this.radius,n=e.center,l=e.radius,h=Ku.copy(n).subtract(i),a=h.magnitude();if(r>=a+l)return this.clone();if(l>=a+r)return e.clone();const g=(r+a+l)*.5;return rw.copy(h).scale((-r+g)/a).add(i),this.center.copy(rw),this.radius=g,this}expand(e){const r=Ku.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const i=bk(Ku,e);return this.radius=Math.max(i[0],Math.max(i[1],i[2]))*this.radius,this}distanceSquaredTo(e){const i=this.distanceTo(e);return i*i}distanceTo(e){const r=Ku.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const i=this.center,r=this.radius,l=e.normal.dot(i)+e.distance;return l<-r?Jr.OUTSIDE:l<r?Jr.INTERSECTING:Jr.INSIDE}}const TU=new mt,SU=new mt,Sf=new mt,Ef=new mt,Af=new mt,EU=new mt,AU=new mt,xo={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class d0{constructor(e=[0,0,0],i=[0,0,0,0,0,0,0,0,0]){this.center=new mt().from(e),this.halfAxes=new Dr(i)}get halfSize(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new mt(e).len(),new mt(i).len(),new mt(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),n=new mt(e).normalize(),l=new mt(i).normalize(),h=new mt(r).normalize();return new hb().fromMatrix3(new Dr([...n,...l,...h]))}fromCenterHalfSizeQuaternion(e,i,r){const n=new hb(r),l=new Dr().fromQuaternion(n);return l[0]=l[0]*i[0],l[1]=l[1]*i[0],l[2]=l[2]*i[0],l[3]=l[3]*i[1],l[4]=l[4]*i[1],l[5]=l[5]*i[1],l[6]=l[6]*i[2],l[7]=l[7]*i[2],l[8]=l[8]*i[2],this.center=new mt().from(e),this.halfAxes=l,this}clone(){return new d0(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new h0){const i=this.halfAxes,r=i.getColumn(0,Sf),n=i.getColumn(1,Ef),l=i.getColumn(2,Af),h=TU.copy(r).add(n).add(l);return e.center.copy(this.center),e.radius=h.magnitude(),e}intersectPlane(e){const i=this.center,r=e.normal,n=this.halfAxes,l=r.x,h=r.y,a=r.z,g=Math.abs(l*n[xo.COLUMN0ROW0]+h*n[xo.COLUMN0ROW1]+a*n[xo.COLUMN0ROW2])+Math.abs(l*n[xo.COLUMN1ROW0]+h*n[xo.COLUMN1ROW1]+a*n[xo.COLUMN1ROW2])+Math.abs(l*n[xo.COLUMN2ROW0]+h*n[xo.COLUMN2ROW1]+a*n[xo.COLUMN2ROW2]),y=r.dot(i)+e.distance;return y<=-g?Jr.OUTSIDE:y>=g?Jr.INSIDE:Jr.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const i=SU.from(e).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,Sf),l=r.getColumn(1,Ef),h=r.getColumn(2,Af),a=n.magnitude(),g=l.magnitude(),y=h.magnitude();n.normalize(),l.normalize(),h.normalize();let T=0,S;return S=Math.abs(i.dot(n))-a,S>0&&(T+=S*S),S=Math.abs(i.dot(l))-g,S>0&&(T+=S*S),S=Math.abs(i.dot(h))-y,S>0&&(T+=S*S),T}computePlaneDistances(e,i,r=[-0,-0]){let n=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const h=this.center,a=this.halfAxes,g=a.getColumn(0,Sf),y=a.getColumn(1,Ef),T=a.getColumn(2,Af),S=EU.copy(g).add(y).add(T).add(h),P=AU.copy(S).subtract(e);let M=i.dot(P);return n=Math.min(M,n),l=Math.max(M,l),S.copy(h).add(g).add(y).subtract(T),P.copy(S).subtract(e),M=i.dot(P),n=Math.min(M,n),l=Math.max(M,l),S.copy(h).add(g).subtract(y).add(T),P.copy(S).subtract(e),M=i.dot(P),n=Math.min(M,n),l=Math.max(M,l),S.copy(h).add(g).subtract(y).subtract(T),P.copy(S).subtract(e),M=i.dot(P),n=Math.min(M,n),l=Math.max(M,l),h.copy(S).subtract(g).add(y).add(T),P.copy(S).subtract(e),M=i.dot(P),n=Math.min(M,n),l=Math.max(M,l),h.copy(S).subtract(g).add(y).subtract(T),P.copy(S).subtract(e),M=i.dot(P),n=Math.min(M,n),l=Math.max(M,l),h.copy(S).subtract(g).subtract(y).add(T),P.copy(S).subtract(e),M=i.dot(P),n=Math.min(M,n),l=Math.max(M,l),h.copy(S).subtract(g).subtract(y).subtract(T),P.copy(S).subtract(e),M=i.dot(P),n=Math.min(M,n),l=Math.max(M,l),r[0]=n,r[1]=l,r}transform(e){this.center.transformAsPoint(e);const i=this.halfAxes.getColumn(0,Sf);i.transformAsPoint(e);const r=this.halfAxes.getColumn(1,Ef);r.transformAsPoint(e);const n=this.halfAxes.getColumn(2,Af);return n.transformAsPoint(e),this.halfAxes=new Dr([...i,...r,...n]),this}getTransform(){throw new Error("not implemented")}}const nw=new mt,sw=new mt;class Mh{constructor(e=[0,0,1],i=0){this.normal=new mt,this.distance=-0,this.fromNormalDistance(e,i)}fromNormalDistance(e,i){return mh(Number.isFinite(i)),this.normal.from(e).normalize(),this.distance=i,this}fromPointNormal(e,i){e=nw.from(e),this.normal.from(i).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,i,r,n){return this.normal.set(e,i,r),mh(So(this.normal.len(),1)),this.distance=n,this}clone(){return new Mh(this.normal,this.distance)}equals(e){return So(this.distance,e.distance)&&So(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const i=sw.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,i)}projectPointOntoPlane(e,i=[0,0,0]){const r=nw.from(e),n=this.getPointDistance(r),l=sw.copy(this.normal).scale(n);return r.subtract(l).to(i)}}const ow=[new mt([1,0,0]),new mt([0,1,0]),new mt([0,0,1])],aw=new mt,PU=new mt;class To{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*ow.length;const i=e.center,r=e.radius;let n=0;for(const l of ow){let h=this.planes[n],a=this.planes[n+1];h||(h=this.planes[n]=new Mh),a||(a=this.planes[n+1]=new Mh);const g=aw.copy(l).scale(-r).add(i);h.fromPointNormal(g,l);const y=aw.copy(l).scale(r).add(i),T=PU.copy(l).negate();a.fromPointNormal(y,T),n+=2}return this}computeVisibility(e){let i=Jr.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case Jr.OUTSIDE:return Jr.OUTSIDE;case Jr.INTERSECTING:i=Jr.INTERSECTING;break}return i}computeVisibilityWithPlaneMask(e,i){if(mh(Number.isFinite(i),"parentPlaneMask is required."),i===To.MASK_OUTSIDE||i===To.MASK_INSIDE)return i;let r=To.MASK_INSIDE;const n=this.planes;for(let l=0;l<this.planes.length;++l){const h=l<31?1<<l:0;if(l<31&&!(i&h))continue;const a=n[l],g=e.intersectPlane(a);if(g===Jr.OUTSIDE)return To.MASK_OUTSIDE;g===Jr.INTERSECTING&&(r|=h)}return r}}To.MASK_OUTSIDE=4294967295;To.MASK_INSIDE=0;To.MASK_INDETERMINATE=2147483647;new mt;new mt;new mt;new mt;new mt;new mt;new mt;new mt;new mt;new mt;new mt;new mt;new mt;new mt;new mt;new mt;new mt;const Xs=new Dr,IU=new Dr,CU=new Dr,Pf=new Dr,lw=new Dr;function RU(t,e={}){const i=sO,r=10;let n=0,l=0;const h=IU,a=CU;h.identity(),a.copy(t);const g=i*MU(a);for(;l<r&&kU(a)>g;)OU(a,Pf),lw.copy(Pf).transpose(),a.multiplyRight(Pf),a.multiplyLeft(lw),h.multiplyRight(Pf),++n>2&&(++l,n=0);return e.unitary=h.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function MU(t){let e=0;for(let i=0;i<9;++i){const r=t[i];e+=r*r}return Math.sqrt(e)}const fy=[1,0,0],py=[2,2,1];function kU(t){let e=0;for(let i=0;i<3;++i){const r=t[Xs.getElementIndex(py[i],fy[i])];e+=2*r*r}return Math.sqrt(e)}function OU(t,e){const i=nO;let r=0,n=1;for(let y=0;y<3;++y){const T=Math.abs(t[Xs.getElementIndex(py[y],fy[y])]);T>r&&(n=y,r=T)}const l=fy[n],h=py[n];let a=1,g=0;if(Math.abs(t[Xs.getElementIndex(h,l)])>i){const y=t[Xs.getElementIndex(h,h)],T=t[Xs.getElementIndex(l,l)],S=t[Xs.getElementIndex(h,l)],P=(y-T)/2/S;let M;P<0?M=-1/(-P+Math.sqrt(1+P*P)):M=1/(P+Math.sqrt(1+P*P)),a=1/Math.sqrt(1+M*M),g=M*a}return Dr.IDENTITY.to(e),e[Xs.getElementIndex(l,l)]=e[Xs.getElementIndex(h,h)]=a,e[Xs.getElementIndex(h,l)]=g,e[Xs.getElementIndex(l,h)]=-g,e}const Qo=new mt,FU=new mt,DU=new mt,NU=new mt,LU=new mt,BU=new Dr,zU={diagonal:new Dr,unitary:new Dr};function UU(t,e=new d0){if(!t||t.length===0)return e.halfAxes=new Dr([0,0,0,0,0,0,0,0,0]),e.center=new mt,e;const i=t.length,r=new mt(0,0,0);for(const je of t)r.add(je);const n=1/i;r.multiplyByScalar(n);let l=0,h=0,a=0,g=0,y=0,T=0;for(const je of t){const Ue=Qo.copy(je).subtract(r);l+=Ue.x*Ue.x,h+=Ue.x*Ue.y,a+=Ue.x*Ue.z,g+=Ue.y*Ue.y,y+=Ue.y*Ue.z,T+=Ue.z*Ue.z}l*=n,h*=n,a*=n,g*=n,y*=n,T*=n;const S=BU;S[0]=l,S[1]=h,S[2]=a,S[3]=h,S[4]=g,S[5]=y,S[6]=a,S[7]=y,S[8]=T;const{unitary:P}=RU(S,zU),M=e.halfAxes.copy(P);let B=M.getColumn(0,DU),j=M.getColumn(1,NU),Z=M.getColumn(2,LU),G=-Number.MAX_VALUE,fe=-Number.MAX_VALUE,re=-Number.MAX_VALUE,ue=Number.MAX_VALUE,Me=Number.MAX_VALUE,Oe=Number.MAX_VALUE;for(const je of t)Qo.copy(je),G=Math.max(Qo.dot(B),G),fe=Math.max(Qo.dot(j),fe),re=Math.max(Qo.dot(Z),re),ue=Math.min(Qo.dot(B),ue),Me=Math.min(Qo.dot(j),Me),Oe=Math.min(Qo.dot(Z),Oe);B=B.multiplyByScalar(.5*(ue+G)),j=j.multiplyByScalar(.5*(Me+fe)),Z=Z.multiplyByScalar(.5*(Oe+re)),e.center.copy(B).add(j).add(Z);const $e=FU.set(G-ue,fe-Me,re-Oe).multiplyByScalar(.5),ke=new Dr([$e[0],0,0,0,$e[1],0,0,0,$e[2]]);return e.halfAxes.multiplyRight(ke),e}const _c=512,cw=3,NE=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],LE=NE.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),VU=LE.concat([[.25,.5],[.75,.5]]);class mc{constructor(e,i,r){this.x=e,this.y=i,this.z=r}get children(){if(!this._children){const e=this.x*2,i=this.y*2,r=this.z+1;this._children=[new mc(e,i,r),new mc(e,i+1,r),new mc(e+1,i,r),new mc(e+1,i+1,r)]}return this._children}update(e){const{viewport:i,cullingVolume:r,elevationBounds:n,minZ:l,maxZ:h,bounds:a,offset:g,project:y}=e,T=this.getBoundingVolume(n,g,y);if(a&&!this.insideBounds(a)||r.computeVisibility(T)<0)return!1;if(!this.childVisible){let{z:P}=this;if(P<h&&P>=l){const M=T.distanceTo(i.cameraPosition)*i.scale/i.height;P+=Math.floor(Math.log2(M))}if(P>=h)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const P of this.children)P.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const i of this._children)i.getSelected(e);return e}insideBounds([e,i,r,n]){const l=Math.pow(2,this.z),h=_c/l;return this.x*h<r&&this.y*h<n&&(this.x+1)*h>e&&(this.y+1)*h>i}getBoundingVolume(e,i,r){if(r){const g=this.z<1?VU:this.z<2?LE:NE,y=[];for(const T of g){const S=_y(this.x+T[0],this.y+T[1],this.z);S[2]=e[0],y.push(r(S)),e[0]!==e[1]&&(S[2]=e[1],y.push(r(S)))}return UU(y)}const n=Math.pow(2,this.z),l=_c/n,h=this.x*l+i*_c,a=_c-(this.y+1)*l;return new u0([h,a,e[0]],[h+l,a+l,e[1]])}}function $U(t,e,i,r){const n=t instanceof Pz&&t.resolution?t.projectPosition:null,l=Object.values(t.getFrustumPlanes()).map(({normal:M,distance:B})=>new Mh(M.clone().negate(),B)),h=new To(l),a=t.distanceScales.unitsPerMeter[2],g=i&&i[0]*a||0,y=i&&i[1]*a||0,T=t instanceof xh&&t.pitch<=60?e:0;if(r){const[M,B,j,Z]=r,G=Mc([M,Z]),fe=Mc([j,B]);r=[G[0],_c-G[1],fe[0],_c-fe[1]]}const S=new mc(0,0,0),P={viewport:t,project:n,cullingVolume:h,elevationBounds:[g,y],minZ:T,maxZ:e,bounds:r,offset:0};if(S.update(P),t instanceof xh&&t.subViewports&&t.subViewports.length>1){for(P.offset=-1;S.update(P)&&!(--P.offset<-cw););for(P.offset=1;S.update(P)&&!(++P.offset>cw););}return S.getSelected()}const Po=512,jU=[-1/0,-1/0,1/0,1/0],BE={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(i=>typeof i=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const i=t.length;if(i!==e.length)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}};function zE(t,e){const i=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...i.map(n=>n[0])),Math.min(...i.map(n=>n[1])),Math.max(...i.map(n=>n[0])),Math.max(...i.map(n=>n[1]))]}function WU(t){return Math.abs(t.split("").reduce((e,i)=>(e<<5)-e+i.charCodeAt(0)|0,0))}function bp(t,e){if(!t||!t.length)return null;const{index:i,id:r}=e;if(Array.isArray(t)){const l=WU(r)%t.length;t=t[l]}let n=t;for(const l of Object.keys(i)){const h=new RegExp(`{${l}}`,"g");n=n.replace(h,String(i[l]))}return Number.isInteger(i.y)&&Number.isInteger(i.z)&&(n=n.replace(/\{-y\}/g,String(Math.pow(2,i.z)-i.y-1))),n}function HU(t,e,i){let r;if(e&&e.length===2){const[n,l]=e,h=t.getBounds({z:n}),a=t.getBounds({z:l});r=[Math.min(h[0],a[0]),Math.min(h[1],a[1]),Math.max(h[2],a[2]),Math.max(h[3],a[3])]}else r=t.getBounds();return t.isGeospatial?[Math.max(r[0],i[0]),Math.max(r[1],i[1]),Math.min(r[2],i[2]),Math.min(r[3],i[3])]:[Math.max(Math.min(r[0],i[2]),i[0]),Math.max(Math.min(r[1],i[3]),i[1]),Math.min(Math.max(r[2],i[0]),i[2]),Math.min(Math.max(r[3],i[1]),i[3])]}function qU({viewport:t,z:e,cullRect:i}){return(t.subViewports||[t]).map(n=>gy(n,e||0,i))}function gy(t,e,i){if(!Array.isArray(e)){const l=i.x-t.x,h=i.y-t.y,{width:a,height:g}=i,y={targetZ:e},T=t.unproject([l,h],y),S=t.unproject([l+a,h],y),P=t.unproject([l,h+g],y),M=t.unproject([l+a,h+g],y);return[Math.min(T[0],S[0],P[0],M[0]),Math.min(T[1],S[1],P[1],M[1]),Math.max(T[0],S[0],P[0],M[0]),Math.max(T[1],S[1],P[1],M[1])]}const r=gy(t,e[0],i),n=gy(t,e[1],i);return[Math.min(r[0],n[0]),Math.min(r[1],n[1]),Math.max(r[2],n[2]),Math.max(r[3],n[3])]}function XU(t,e,i){return i?zE(t,i).map(n=>n*e/Po):t.map(r=>r*e/Po)}function f0(t,e){return Math.pow(2,t)*Po/e}function _y(t,e,i){const r=f0(i,Po),n=t/r*360-180,l=Math.PI-2*Math.PI*e/r,h=180/Math.PI*Math.atan(.5*(Math.exp(l)-Math.exp(-l)));return[n,h]}function uw(t,e,i,r){const n=f0(i,r);return[t/n*Po,e/n*Po]}function ZU(t,e,i,r,n=Po){if(t.isGeospatial){const[y,T]=_y(e,i,r),[S,P]=_y(e+1,i+1,r);return{west:y,north:T,east:S,south:P}}const[l,h]=uw(e,i,r,n),[a,g]=uw(e+1,i+1,r,n);return{left:l,top:h,right:a,bottom:g}}function YU(t,e,i,r,n){const l=HU(t,null,r),h=f0(e,i),[a,g,y,T]=XU(l,h,n),S=[];for(let P=Math.floor(a);P<y;P++)for(let M=Math.floor(g);M<T;M++)S.push({x:P,y:M,z:e});return S}function KU({viewport:t,maxZoom:e,minZoom:i,zRange:r,extent:n,tileSize:l=Po,modelMatrix:h,modelMatrixInverse:a,zoomOffset:g=0}){let y=t.isGeospatial?Math.round(t.zoom+Math.log2(Po/l))+g:Math.ceil(t.zoom)+g;if(typeof i=="number"&&Number.isFinite(i)&&y<i){if(!n)return[];y=i}typeof e=="number"&&Number.isFinite(e)&&y>e&&(y=e);let T=n;return h&&a&&n&&!t.isGeospatial&&(T=zE(n,h)),t.isGeospatial?$U(t,y,r,n):YU(t,y,l,T||jU,a)}function GU(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function JU(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function QU(t){let e={},i;return r=>{for(const n in r)if(!e5(r[n],e[n])){i=t(r),e=r;break}return i}}function e5(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}return!1}const hw=1,og=2,t5="never",i5="no-overlap",p0="best-available",r5=5,n5={[p0]:a5,[i5]:l5,[t5]:()=>{}},s5={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class o5{constructor(e){this._getCullBounds=QU(qU),this.opts={...s5,...e},this.setOptions(this.opts),this.onTileLoad=i=>{var r,n;(n=(r=this.opts).onTileLoad)==null||n.call(r,i),this.opts.maxCacheByteSize!=null&&(this._cacheByteSize+=i.byteLength,this._resizeCache())},this._requestScheduler=new bI({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Qr,this._modelMatrixInverse=new Qr}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const i=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(i)?this._cache.delete(e):i.setNeedsReload()}}update(e,{zRange:i,modelMatrix:r}={zRange:null,modelMatrix:null}){const n=r?new Qr(r):new Qr,l=!n.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!So(this._zRange,i)||l){l&&(this._modelMatrixInverse=n.clone().invert(),this._modelMatrix=n),this._viewport=e,this._zRange=i;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:i,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(g=>this._getTile(g,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const h=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),h&&this._frameNumber++,this._frameNumber}isTileVisible(e,i){if(!e.isVisible)return!1;if(i&&this._viewport){const r=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:i}),{bbox:n}=e;for(const[l,h,a,g]of r){let y;if("west"in n)y=n.west<a&&n.east>l&&n.south<g&&n.north>h;else{const T=Math.min(n.top,n.bottom),S=Math.max(n.top,n.bottom);y=n.left<a&&n.right>l&&T<g&&S>h}if(y)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:i,minZoom:r,zRange:n,modelMatrix:l,modelMatrixInverse:h}){const{tileSize:a,extent:g,zoomOffset:y}=this.opts;return KU({viewport:e,maxZoom:i,minZoom:r,zRange:n,tileSize:a,extent:g,modelMatrix:l,modelMatrixInverse:h,zoomOffset:y})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:i}=this.opts;return{bbox:ZU(this._viewport,e.x,e.y,e.z,i)}}getParentIndex(e){const i=Math.floor(e.x/2),r=Math.floor(e.y/2),n=e.z-1;return{x:i,y:r,z:n}}updateTileStates(){const e=this.opts.refinementStrategy||p0,i=new Array(this._cache.size);let r=0;for(const n of this._cache.values())i[r++]=n.isVisible,n.isSelected=!1,n.isVisible=!1;for(const n of this._selectedTiles)n.isSelected=!0,n.isVisible=!0;(typeof e=="function"?e:n5[e])(Array.from(this._cache.values())),r=0;for(const n of this._cache.values())if(i[r++]!==n.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,i=[];let r=0;for(const n of this._cache.values())n.isLoading&&(r++,!n.isSelected&&!n.isVisible&&i.push(n));for(;e>0&&r>e&&i.length>0;)i.shift().abort(),r--}_rebuildTree(){const{_cache:e}=this;for(const i of e.values())i.parent=null,i.children&&(i.children.length=0);for(const i of e.values()){const r=this._getNearestAncestor(i);i.parent=r,r!=null&&r.children&&r.children.push(i)}}_resizeCache(){var h,a;const{_cache:e,opts:i}=this,r=i.maxCacheSize??(i.maxCacheByteSize!=null?1/0:r5*this.selectedTiles.length),n=i.maxCacheByteSize??1/0;if(e.size>r||this._cacheByteSize>n){for(const[g,y]of e)if(!y.isVisible&&!y.isSelected&&(this._cacheByteSize-=i.maxCacheByteSize!=null?y.byteLength:0,e.delete(g),(a=(h=this.opts).onTileUnload)==null||a.call(h,y)),e.size<=r&&this._cacheByteSize<=n)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((g,y)=>g.zoom-y.zoom),this._dirty=!1)}_getTile(e,i){const r=this.getTileId(e);let n=this._cache.get(r),l=!1;return!n&&i?(n=new bU(e),Object.assign(n,this.getTileMetadata(n.index)),Object.assign(n,{id:r,zoom:this.getTileZoom(n.index)}),l=!0,this._cache.set(r,n),this._dirty=!0):n&&n.needsReload&&(l=!0),n&&l&&n.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),n}_getNearestAncestor(e){const{_minZoom:i=0}=this;let r=e.index;for(;this.getTileZoom(r)>i;){r=this.getParentIndex(r);const n=this._getTile(r);if(n)return n}return null}}function a5(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!UE(e)&&g0(e);for(const e of t)e.isVisible=!!(e.state&og)}function l5(t){for(const i of t)i.state=0;for(const i of t)i.isSelected&&UE(i);const e=Array.from(t).sort((i,r)=>i.zoom-r.zoom);for(const i of e)if(i.isVisible=!!(i.state&og),i.children&&(i.isVisible||i.state&hw))for(const r of i.children)r.state=hw;else i.isSelected&&g0(i)}function UE(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=og,!0;e=e.parent}return!1}function g0(t){for(const e of t.children)e.isLoaded||e.content?e.state|=og:g0(e)}const c5={TilesetClass:o5,data:{type:"data",value:[]},dataComparator:BE.equal,renderSubLayers:{type:"function",value:t=>new sg(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:p0,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class _0 extends Jy{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,i;(i=(e=this.state)==null?void 0:e.tileset)==null||i.finalize()}get isLoaded(){var e,i,r;return!!((r=(i=(e=this.state)==null?void 0:e.tileset)==null?void 0:i.selectedTiles)!=null&&r.every(n=>n.isLoaded&&n.layers&&n.layers.every(l=>l.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:i}=this.state;const r=e.propsOrDataChanged||e.updateTriggersChanged,n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);i?r&&(i.setOptions(this._getTilesetOptions()),n?i.reloadAll():i.tiles.forEach(l=>{l.layers=null})):(i=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:i})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:i,maxCacheByteSize:r,refinementStrategy:n,extent:l,maxZoom:h,minZoom:a,maxRequests:g,debounceTime:y,zoomOffset:T}=this.props;return{maxCacheSize:i,maxCacheByteSize:r,maxZoom:h,minZoom:a,tileSize:e,refinementStrategy:n,extent:l,maxRequests:g,debounceTime:y,zoomOffset:T,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:i,modelMatrix:r}=this.props,n=e.update(this.context.viewport,{zRange:i,modelMatrix:r}),{isLoaded:l}=e,h=this.state.isLoaded!==l,a=this.state.frameNumber!==n;l&&(h||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:n}),this.state.isLoaded=l}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:i}=this.props;i&&i(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,i){this.props.onTileError(e),i.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:i,getTileData:r,fetch:n}=this.props,{signal:l}=e;return e.url=typeof i=="string"||Array.isArray(i)?bp(i,e):null,r?r(e):n&&e.url?n(e.url,{propName:"data",layer:this,signal:l}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const i=e.sourceLayer,r=i.props.tile,n=e.info;return n.picked&&(n.tile=r),n.sourceTile=r,n.sourceTileSubLayer=i,n}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const i=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)i&&e.layers[0]&&Object.keys(i).some(r=>e.layers[0].props[r]!==i[r])&&(e.layers=e.layers.map(r=>r.clone(i)));else{const r=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=Yp(r,Boolean).map(n=>n.clone({tile:e,...i}))}return e.layers})}filterSubLayer({layer:e,cullRect:i}){const{tile:r}=e.props;return this.state.tileset.isTileVisible(r,i)}}_0.defaultProps=c5;_0.layerName="TileLayer";const u5=_0,h5={clipBounds:[0,0,1,1],clipByInstance:void 0},VE=`
uniform vec4 clip_bounds;
bool clip_isInBounds(vec2 position) {
return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,d5={name:"clip-vs",vs:VE},f5={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
if (clip_isVisible < 0.5) discard;
`},p5={name:"clip-fs",fs:VE},g5={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
if (!clip_isInBounds(clip_commonPosition)) discard;
`};class m0 extends Iz{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[d5],inject:f5}:{modules:[p5],inject:g5}}draw({uniforms:e}){const{clipBounds:i}=this.props;if(this.state.clipByInstance)e.clip_bounds=i;else{const r=this.projectPosition([i[0],i[1],0]),n=this.projectPosition([i[2],i[3],0]);e.clip_bounds=[Math.min(r[0],n[0]),Math.min(r[1],n[1]),Math.max(r[0],n[0]),Math.max(r[1],n[1])]}}}m0.defaultProps=h5;m0.extensionName="ClipExtension";const $E=m0;function _5(t,e,i){const r=m5(t),n=Object.keys(r).filter(l=>r[l]!==Array);return y5(t,{propArrayTypes:r,...e},{numericPropKeys:i&&i.numericPropKeys||n,PositionDataType:i?i.PositionDataType:Float32Array,triangulate:i?i.triangulate:!0})}function m5(t){const e={};for(const i of t)if(i.properties)for(const r in i.properties){const n=i.properties[r];e[r]=S5(n,e[r])}return e}function y5(t,e,i){const{pointPositionsCount:r,pointFeaturesCount:n,linePositionsCount:l,linePathsCount:h,lineFeaturesCount:a,polygonPositionsCount:g,polygonObjectsCount:y,polygonRingsCount:T,polygonFeaturesCount:S,propArrayTypes:P,coordLength:M}=e,{numericPropKeys:B=[],PositionDataType:j=Float32Array,triangulate:Z=!0}=i,G=t[0]&&"id"in t[0],fe=t.length>65535?Uint32Array:Uint16Array,re={type:"Point",positions:new j(r*M),globalFeatureIds:new fe(r),featureIds:n>65535?new Uint32Array(r):new Uint16Array(r),numericProps:{},properties:[],fields:[]},ue={type:"LineString",pathIndices:l>65535?new Uint32Array(h+1):new Uint16Array(h+1),positions:new j(l*M),globalFeatureIds:new fe(l),featureIds:a>65535?new Uint32Array(l):new Uint16Array(l),numericProps:{},properties:[],fields:[]},Me={type:"Polygon",polygonIndices:g>65535?new Uint32Array(y+1):new Uint16Array(y+1),primitivePolygonIndices:g>65535?new Uint32Array(T+1):new Uint16Array(T+1),positions:new j(g*M),globalFeatureIds:new fe(g),featureIds:S>65535?new Uint32Array(g):new Uint16Array(g),numericProps:{},properties:[],fields:[]};Z&&(Me.triangles=[]);for(const $e of[re,ue,Me])for(const ke of B){const je=P[ke];$e.numericProps[ke]=new je($e.positions.length/M)}ue.pathIndices[h]=l,Me.polygonIndices[y]=g,Me.primitivePolygonIndices[T]=g;const Oe={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const $e of t){const ke=$e.geometry,je=$e.properties||{};switch(ke.type){case"Point":x5(ke,re,Oe,M,je),re.properties.push(nm(je,B)),G&&re.fields.push({id:$e.id}),Oe.pointFeature++;break;case"LineString":v5(ke,ue,Oe,M,je),ue.properties.push(nm(je,B)),G&&ue.fields.push({id:$e.id}),Oe.lineFeature++;break;case"Polygon":b5(ke,Me,Oe,M,je),Me.properties.push(nm(je,B)),G&&Me.fields.push({id:$e.id}),Oe.polygonFeature++;break;default:throw new Error("Invalid geometry type")}Oe.feature++}return T5(re,ue,Me,M)}function x5(t,e,i,r,n){e.positions.set(t.data,i.pointPosition*r);const l=t.data.length/r;y0(e,n,i.pointPosition,l),e.globalFeatureIds.fill(i.feature,i.pointPosition,i.pointPosition+l),e.featureIds.fill(i.pointFeature,i.pointPosition,i.pointPosition+l),i.pointPosition+=l}function v5(t,e,i,r,n){e.positions.set(t.data,i.linePosition*r);const l=t.data.length/r;y0(e,n,i.linePosition,l),e.globalFeatureIds.fill(i.feature,i.linePosition,i.linePosition+l),e.featureIds.fill(i.lineFeature,i.linePosition,i.linePosition+l);for(let h=0,a=t.indices.length;h<a;++h){const g=t.indices[h],y=h===a-1?t.data.length:t.indices[h+1];e.pathIndices[i.linePath++]=i.linePosition,i.linePosition+=(y-g)/r}}function b5(t,e,i,r,n){e.positions.set(t.data,i.polygonPosition*r);const l=t.data.length/r;y0(e,n,i.polygonPosition,l),e.globalFeatureIds.fill(i.feature,i.polygonPosition,i.polygonPosition+l),e.featureIds.fill(i.polygonFeature,i.polygonPosition,i.polygonPosition+l);for(let h=0,a=t.indices.length;h<a;++h){const g=i.polygonPosition;e.polygonIndices[i.polygonObject++]=g;const y=t.areas[h],T=t.indices[h],S=t.indices[h+1];for(let M=0,B=T.length;M<B;++M){const j=T[M],Z=M===B-1?S===void 0?t.data.length:S[0]:T[M+1];e.primitivePolygonIndices[i.polygonRing++]=i.polygonPosition,i.polygonPosition+=(Z-j)/r}const P=i.polygonPosition;w5(e,y,T,{startPosition:g,endPosition:P,coordLength:r})}}function w5(t,e,i,{startPosition:r,endPosition:n,coordLength:l}){if(!t.triangles)return;const h=r*l,a=n*l,g=t.positions.subarray(h,a),y=i[0],T=i.slice(1).map(P=>(P-y)/l),S=k4(g,T,l,e);for(let P=0,M=S.length;P<M;++P)t.triangles.push(r+S[P])}function rm(t,e){const i={};for(const r in t)i[r]={value:t[r],size:e};return i}function T5(t,e,i,r){const n={shape:"binary-feature-collection",points:{...t,positions:{value:t.positions,size:r},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:rm(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:r},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:rm(e.numericProps,1)},polygons:{...i,positions:{value:i.positions,size:r},polygonIndices:{value:i.polygonIndices,size:1},primitivePolygonIndices:{value:i.primitivePolygonIndices,size:1},globalFeatureIds:{value:i.globalFeatureIds,size:1},featureIds:{value:i.featureIds,size:1},numericProps:rm(i.numericProps,1)}};return n.polygons&&i.triangles&&(n.polygons.triangles={value:new Uint32Array(i.triangles),size:1}),n}function y0(t,e,i,r){for(const n in t.numericProps)if(n in e){const l=e[n];t.numericProps[n].fill(l,i,i+r)}}function nm(t,e){const i={};for(const r in t)e.includes(r)||(i[r]=t[r]);return i}function S5(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}function dw(t,e){const i=e==null?void 0:e.globalFeatureId;return i!==void 0?E5(t,i):A5(t,e==null?void 0:e.type)}function E5(t,e){const i=jE(t);for(const r of i){let n=0,l=r.featureIds.value[0];for(let h=0;h<r.featureIds.value.length;h++){const a=r.featureIds.value[h];if(a!==l){if(e===r.globalFeatureIds.value[n])return wp(r,n,h);n=h,l=a}}if(e===r.globalFeatureIds.value[n])return wp(r,n,r.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function A5(t,e){const i=jE(t);return I5(i)}function P5(t,e,i){switch(t.type){case"Point":return k5(t,e,i);case"LineString":return M5(t,e,i);case"Polygon":return WE(t,e,i);default:const r=t;throw new Error(`Unsupported geometry type: ${r==null?void 0:r.type}`)}}function jE(t,e){const i=[];return t.points&&(t.points.type="Point",i.push(t.points)),t.lines&&(t.lines.type="LineString",i.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",i.push(t.polygons)),i}function I5(t){const e=[];for(const i of t){if(i.featureIds.value.length===0)continue;let r=0,n=i.featureIds.value[0];for(let l=0;l<i.featureIds.value.length;l++){const h=i.featureIds.value[l];h!==n&&(e.push(wp(i,r,l)),r=l,n=h)}e.push(wp(i,r,i.featureIds.value.length))}return e}function wp(t,e,i){const r=P5(t,e,i),n=R5(t,e),l=C5(t,e);return{type:"Feature",geometry:r,properties:n,...l}}function C5(t,e=0,i){return t.fields&&t.fields[t.featureIds.value[e]]}function R5(t,e=0,i){const r=Object.assign({},t.properties[t.featureIds.value[e]]);for(const n in t.numericProps)r[n]=t.numericProps[n].value[e];return r}function WE(t,e=-1/0,i=1/0){const{positions:r}=t,n=t.polygonIndices.value.filter(g=>g>=e&&g<=i),l=t.primitivePolygonIndices.value.filter(g=>g>=e&&g<=i);if(!(n.length>2)){const g=[];for(let y=0;y<l.length-1;y++){const T=l[y],S=l[y+1],P=Tp(r,T,S);g.push(P)}return{type:"Polygon",coordinates:g}}const a=[];for(let g=0;g<n.length-1;g++){const y=n[g],T=n[g+1],S=WE(t,y,T).coordinates;a.push(S)}return{type:"MultiPolygon",coordinates:a}}function M5(t,e=-1/0,i=1/0){const{positions:r}=t,n=t.pathIndices.value.filter(a=>a>=e&&a<=i);if(!(n.length>2))return{type:"LineString",coordinates:Tp(r,n[0],n[1])};const h=[];for(let a=0;a<n.length-1;a++){const g=Tp(r,n[a],n[a+1]);h.push(g)}return{type:"MultiLineString",coordinates:h}}function k5(t,e,i){const{positions:r}=t,n=Tp(r,e,i);return n.length>1?{type:"MultiPoint",coordinates:n}:{type:"Point",coordinates:n[0]}}function Tp(t,e,i){e=e||0,i=i||t.value.length/t.size;const r=[];for(let n=e;n<i;n++){const l=Array();for(let h=n*t.size;h<(n+1)*t.size;h++)l.push(Number(t.value[h]));r.push(l)}return r}var x0={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */x0.read=function(t,e,i,r,n){var l,h,a=n*8-r-1,g=(1<<a)-1,y=g>>1,T=-7,S=i?n-1:0,P=i?-1:1,M=t[e+S];for(S+=P,l=M&(1<<-T)-1,M>>=-T,T+=a;T>0;l=l*256+t[e+S],S+=P,T-=8);for(h=l&(1<<-T)-1,l>>=-T,T+=r;T>0;h=h*256+t[e+S],S+=P,T-=8);if(l===0)l=1-y;else{if(l===g)return h?NaN:(M?-1:1)*(1/0);h=h+Math.pow(2,r),l=l-y}return(M?-1:1)*h*Math.pow(2,l-r)};x0.write=function(t,e,i,r,n,l){var h,a,g,y=l*8-n-1,T=(1<<y)-1,S=T>>1,P=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=r?0:l-1,B=r?1:-1,j=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,h=T):(h=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-h))<1&&(h--,g*=2),h+S>=1?e+=P/g:e+=P*Math.pow(2,1-S),e*g>=2&&(h++,g/=2),h+S>=T?(a=0,h=T):h+S>=1?(a=(e*g-1)*Math.pow(2,n),h=h+S):(a=e*Math.pow(2,S-1)*Math.pow(2,n),h=0));n>=8;t[i+M]=a&255,M+=B,a/=256,n-=8);for(h=h<<n|a,y+=n;y>0;t[i+M]=h&255,M+=B,h/=256,y-=8);t[i+M-B]|=j*128};var O5=si,If=x0;function si(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}si.Varint=0;si.Fixed64=1;si.Bytes=2;si.Fixed32=5;var my=65536*65536,fw=1/my,F5=12,HE=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");si.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,l=this.pos;this.type=r&7,t(n,e,this),this.pos===l&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Cf(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=gw(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Cf(this.buf,this.pos)+Cf(this.buf,this.pos+4)*my;return this.pos+=8,t},readSFixed64:function(){var t=Cf(this.buf,this.pos)+gw(this.buf,this.pos+4)*my;return this.pos+=8,t},readFloat:function(){var t=If.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=If.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,i,r;return r=e[this.pos++],i=r&127,r<128||(r=e[this.pos++],i|=(r&127)<<7,r<128)||(r=e[this.pos++],i|=(r&127)<<14,r<128)||(r=e[this.pos++],i|=(r&127)<<21,r<128)?i:(r=e[this.pos],i|=(r&15)<<28,D5(i,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=F5&&HE?Y5(this.buf,e,t):Z5(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==si.Bytes)return t.push(this.readVarint(e));var i=vo(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==si.Bytes)return t.push(this.readSVarint());var e=vo(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==si.Bytes)return t.push(this.readBoolean());var e=vo(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==si.Bytes)return t.push(this.readFloat());var e=vo(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==si.Bytes)return t.push(this.readDouble());var e=vo(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==si.Bytes)return t.push(this.readFixed32());var e=vo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==si.Bytes)return t.push(this.readSFixed32());var e=vo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==si.Bytes)return t.push(this.readFixed64());var e=vo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==si.Bytes)return t.push(this.readSFixed64());var e=vo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===si.Varint)for(;this.buf[this.pos++]>127;);else if(e===si.Bytes)this.pos=this.readVarint()+this.pos;else if(e===si.Fixed32)this.pos+=4;else if(e===si.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),rc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),rc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),rc(this.buf,t&-1,this.pos),rc(this.buf,Math.floor(t*fw),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),rc(this.buf,t&-1,this.pos),rc(this.buf,Math.floor(t*fw),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){N5(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=K5(this.buf,t,this.pos);var i=this.pos-e;i>=128&&pw(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),If.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),If.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&pw(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,si.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,z5,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,U5,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,j5,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,V5,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,$5,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,W5,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,H5,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,q5,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,X5,e)},writeBytesField:function(t,e){this.writeTag(t,si.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,si.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,si.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,si.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,si.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,si.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,si.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,si.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,si.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,si.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function D5(t,e,i){var r=i.buf,n,l;if(l=r[i.pos++],n=(l&112)>>4,l<128||(l=r[i.pos++],n|=(l&127)<<3,l<128)||(l=r[i.pos++],n|=(l&127)<<10,l<128)||(l=r[i.pos++],n|=(l&127)<<17,l<128)||(l=r[i.pos++],n|=(l&127)<<24,l<128)||(l=r[i.pos++],n|=(l&1)<<31,l<128))return ic(t,n,e);throw new Error("Expected varint not more than 10 bytes")}function vo(t){return t.type===si.Bytes?t.readVarint()+t.pos:t.pos+1}function ic(t,e,i){return i?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function N5(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),L5(i,r,e),B5(r,e)}function L5(t,e,i){i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos]=t&127}function B5(t,e){var i=(t&7)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function pw(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function z5(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function U5(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function V5(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function $5(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function j5(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function W5(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function H5(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function q5(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function X5(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Cf(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function rc(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function gw(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Z5(t,e,i){for(var r="",n=e;n<i;){var l=t[n],h=null,a=l>239?4:l>223?3:l>191?2:1;if(n+a>i)break;var g,y,T;a===1?l<128&&(h=l):a===2?(g=t[n+1],(g&192)===128&&(h=(l&31)<<6|g&63,h<=127&&(h=null))):a===3?(g=t[n+1],y=t[n+2],(g&192)===128&&(y&192)===128&&(h=(l&15)<<12|(g&63)<<6|y&63,(h<=2047||h>=55296&&h<=57343)&&(h=null))):a===4&&(g=t[n+1],y=t[n+2],T=t[n+3],(g&192)===128&&(y&192)===128&&(T&192)===128&&(h=(l&15)<<18|(g&63)<<12|(y&63)<<6|T&63,(h<=65535||h>=1114112)&&(h=null))),h===null?(h=65533,a=1):h>65535&&(h-=65536,r+=String.fromCharCode(h>>>10&1023|55296),h=56320|h&1023),r+=String.fromCharCode(h),n+=a}return r}function Y5(t,e,i){return HE.decode(t.subarray(e,i))}function K5(t,e,i){for(var r=0,n,l;r<e.length;r++){if(n=e.charCodeAt(r),n>55295&&n<57344)if(l)if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,l=n;continue}else n=l-55296<<10|n-56320|65536,l=null;else{n>56319||r+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):l=n;continue}else l&&(t[i++]=239,t[i++]=191,t[i++]=189,l=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=n&63|128)}return i}const v0=Wp(O5);function G5(t){let e=0;for(let i=0,r=t.length-1,n,l;i<t.length;r=i++)n=t[i],l=t[r],e+=(l[0]-n[0])*(n[1]+l[1]);return e}function qE(t,e){if(Array.isArray(t[0])){for(const r of t)qE(r,e);return}const i=t;i[0]/=e,i[1]/=e}function J5(t,e){for(let i=0;i<t.length;++i)t[i]/=e}function XE(t,e,i){if(typeof t[0][0]!="number"){for(const h of t)XE(h,e,i);return}const r=i*Math.pow(2,e.z),n=i*e.x,l=i*e.y;for(let h=0;h<t.length;h++){const a=t[h];a[0]=(a[0]+n)*360/r-180;const g=180-(a[1]+l)*360/r;a[1]=360/Math.PI*Math.atan(Math.exp(g*Math.PI/180))-90}}function Q5(t,e,i){const{x:r,y:n,z:l}=e,h=i*Math.pow(2,l),a=i*r,g=i*n;for(let y=0,T=t.length;y<T;y+=2){t[y]=(t[y]+a)*360/h-180;const S=180-(t[y+1]+g)*360/h;t[y+1]=360/Math.PI*Math.atan(Math.exp(S*Math.PI/180))-90}}function eV(t){const e=t.length;if(e<=1)return[t];const i=[];let r,n;for(let l=0;l<e;l++){const h=G5(t[l]);h!==0&&(n===void 0&&(n=h<0),n===h<0?(r&&i.push(r),r=[t[l]]):r&&r.push(t[l]))}return r&&i.push(r),i}function tV(t){const e=t.indices.length,i="Polygon";if(e<=1)return{type:i,data:t.data,areas:[[yp(t.data)]],indices:[t.indices]};const r=[],n=[];let l=[],h=[],a,g=0;for(let y,T=0,S;T<e;T++){S=t.indices[T]-g,y=t.indices[T+1]-g||t.data.length;const P=t.data.slice(S,y),M=yp(P);if(M===0){const B=t.data.slice(0,S),j=t.data.slice(y);t.data=B.concat(j),g+=y-S;continue}a===void 0&&(a=M<0),a===M<0?(h.length&&(r.push(l),n.push(h)),h=[S],l=[M]):(l.push(M),h.push(S))}return l&&r.push(l),h.length&&n.push(h),{type:i,areas:r,indices:n,data:t.data}}class Sp{constructor(e,i,r,n,l,h){H(this,"properties");H(this,"extent");H(this,"type");H(this,"id");H(this,"_pbf");H(this,"_geometry");H(this,"_keys");H(this,"_values");H(this,"_geometryInfo");this.properties={},this.extent=r,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=n,this._values=l,this._geometryInfo=h,e.readFields(iV,this,i)}toGeoJSONFeature(e,i){const r=this.loadGeometry();switch(e){case"wgs84":return _w(this,r,n=>XE(n,i,this.extent));default:return _w(this,r,qE)}}toBinaryFeature(e,i){const r=this.loadFlatGeometry();switch(e){case"wgs84":return this._toBinaryCoordinates(r,n=>Q5(n,i,this.extent));default:return this._toBinaryCoordinates(r,J5)}}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let r=1,n=0,l=0,h=0,a=1/0,g=-1/0,y=1/0,T=-1/0;for(;e.pos<i;){if(n<=0){const S=e.readVarint();r=S&7,n=S>>3}if(n--,r===1||r===2)l+=e.readSVarint(),h+=e.readSVarint(),l<a&&(a=l),l>g&&(g=l),h<y&&(y=h),h>T&&(T=h);else if(r!==7)throw new Error(`unknown command ${r}`)}return[a,y,g,T]}_toBinaryCoordinates(e,i){let r;i(e.data,this.extent);const n=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=e.indices.length,r={type:"Point",...e};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=e.indices.length,this._geometryInfo.linePositionsCount+=e.data.length/n,r={type:"LineString",...e};break;case 3:r=tV(e),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=r.indices.length;for(const h of r.indices)this._geometryInfo.polygonRingsCount+=h.length;this._geometryInfo.polygonPositionsCount+=r.data.length/n;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}const l={type:"Feature",geometry:r,properties:this.properties};return this.id!==null&&(l.id=this.id),l}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let r=1,n=0,l=0,h=0;const a=[];let g;for(;e.pos<i;){if(n<=0){const y=e.readVarint();r=y&7,n=y>>3}switch(n--,r){case 1:case 2:l+=e.readSVarint(),h+=e.readSVarint(),r===1&&(g&&a.push(g),g=[]),g&&g.push([l,h]);break;case 7:g&&g.push(g[0].slice());break;default:throw new Error(`unknown command ${r}`)}}return g&&a.push(g),a}loadFlatGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let r=1,n,l=0,h=0,a=0,g=0;const y=[],T=[];for(;e.pos<i;)if(l<=0&&(n=e.readVarint(),r=n&7,l=n>>3),l--,r===1||r===2)h+=e.readSVarint(),a+=e.readSVarint(),r===1&&y.push(g),T.push(h,a),g+=2;else if(r===7){if(g>0){const S=y[y.length-1];T.push(T[S],T[S+1]),g+=2}}else throw new Error(`unknown command ${r}`);return{data:T,indices:y}}}H(Sp,"types",["Unknown","Point","LineString","Polygon"]);function _w(t,e,i){let r=Sp.types[t.type],n,l,h;switch(t.type){case 1:const g=[];for(n=0;n<e.length;n++)g[n]=e[n][0];h=g,i(h,t.extent);break;case 2:for(h=e,n=0;n<h.length;n++)i(h[n],t.extent);break;case 3:for(h=eV(e),n=0;n<h.length;n++)for(l=0;l<h[n].length;l++)i(h[n][l],t.extent);break;default:throw new Error("illegal vector tile type")}h.length===1?h=h[0]:r=`Multi${r}`;const a={type:"Feature",geometry:{type:r,coordinates:h},properties:t.properties};return t.id!==null&&(a.properties||(a.properties={}),a.properties.id=t.id),a}function iV(t,e,i){e&&i&&(t===1?e.id=i.readVarint():t===2?rV(i,e):t===3?e.type=i.readVarint():t===4&&(e._geometry=i.pos))}function rV(t,e){const i=t.readVarint()+t.pos;for(;t.pos<i;){const r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}let nV=class{constructor(e,i){H(this,"version");H(this,"name");H(this,"extent");H(this,"length");H(this,"_pbf");H(this,"_keys");H(this,"_values");H(this,"_features");this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(sV,this,i),this.length=this._features.length}getGeoJSONFeature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Sp(this._pbf,i,this.extent,this._keys,this._values)}getBinaryFeature(e,i){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new Sp(this._pbf,r,this.extent,this._keys,this._values,i)}};function sV(t,e,i){e&&i&&(t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(oV(i)))}function oV(t){let e=null;const i=t.readVarint()+t.pos;for(;t.pos<i;){const r=t.readVarint()>>3;e=r===1?t.readString():r===2?t.readFloat():r===3?t.readDouble():r===4?t.readVarint64():r===5?t.readVarint():r===6?t.readSVarint():r===7?t.readBoolean():null}return e}class ZE{constructor(e,i){H(this,"layers");this.layers=e.readFields(aV,{},i)}}function aV(t,e,i){if(t===3&&i){const r=new nV(i,i.readVarint()+i.pos);r.length&&e&&(e[r.name]=r)}}function mw(t,e){var n,l;const i=cV(e),r=((n=e==null?void 0:e.gis)==null?void 0:n.format)||((l=e==null?void 0:e.mvt)==null?void 0:l.shape)||(e==null?void 0:e.shape);switch(r){case"columnar-table":return{shape:"columnar-table",data:sm(t,i)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:yw(t,i)};case"geojson":return yw(t,i);case"binary-geometry":return sm(t,i);case"binary":return sm(t,i);default:throw new Error(r||"undefined shape")}}function sm(t,e){const[i,r]=lV(t,e),n=_5(i,r);return n.byteLength=t.byteLength,n}function lV(t,e){const i=[],r={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[i,r];const n=new ZE(new v0(t));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(n.layers)).forEach(h=>{const a=n.layers[h];if(a)for(let g=0;g<a.length;g++){const y=a.getBinaryFeature(g,r),T=hV(y,e,h);i.push(T)}}),[i,r]}function yw(t,e){if(t.byteLength<=0)return[];const i=[],r=new ZE(new v0(t));return(Array.isArray(e.layers)?e.layers:Object.keys(r.layers)).forEach(l=>{const h=r.layers[l];if(h)for(let a=0;a<h.length;a++){const g=h.getGeoJSONFeature(a),y=uV(g,e,l);i.push(y)}}),i}function cV(t){var e;if(!(t!=null&&t.mvt))throw new Error("mvt options required");if(((e=t.mvt)==null?void 0:e.coordinates)==="wgs84"&&!t.mvt.tileIndex)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.gis&&sT.warn('MVTLoader: "options.gis" is deprecated, use "options.mvt.shape" instead')(),t.mvt}function uV(t,e,i){const r=t.toGeoJSONFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&(r.properties||(r.properties={}),r.properties[e.layerProperty]=i),r}function hV(t,e,i){const r=t.toBinaryFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&r.properties&&(r.properties[e.layerProperty]=i),r}const dV="4.3.1",YE={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:dV,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...YE});const fV={Point:KE,MultiPoint:pV,LineString:GE,MultiLineString:gV,Polygon:JE,MultiPolygon:_V};function KE([t,e],[i,r],n){const l=Cc(i[0],r[0],t),h=Cc(i[1],r[1],e);return n.unprojectFlat([l,h])}function b0(t,e,i){return t.map(r=>KE(r,e,i))}function pV(t,e,i){return b0(t,e,i)}function GE(t,e,i){return b0(t,e,i)}function gV(t,e,i){return t.map(r=>GE(r,e,i))}function JE(t,e,i){return t.map(r=>b0(r,e,i))}function _V(t,e,i){return t.map(r=>JE(r,e,i))}function mV(t,e,i){const r=i.projectFlat([e.west,e.north]),n=i.projectFlat([e.east,e.south]),l=[r,n];return{...t,coordinates:fV[t.type](t.coordinates,l,i)}}const yV=["points","lines","polygons"];function xV(t,e,i,r){for(const n of yV){const l=t[n]&&vV(t[n],e,i,r);if(l>=0)return l}return-1}function vV(t,e,i,r){const n=t.featureIds.value;if(!n.length)return-1;let l=0,h=n[n.length-1]+1;if(r){const g=bV(t,r);if(g)l=g[0],h=g[1]+1;else return-1}let a=-1;if(e in t.numericProps){const g=t.numericProps[e].value.findIndex((y,T)=>y===i&&n[T]>=l&&n[T]<h);return g>=0?t.globalFeatureIds.value[g]:-1}else e?a=xw(t.properties,g=>g[e]===i,l,h):t.fields&&(a=xw(t.fields,g=>g.id===i,l,h));return a>=0?wV(t,a):-1}function bV(t,e){if(!t.__layers){const i={},{properties:r}=t;for(let n=0;n<r.length;n++){const{layerName:l}=r[n];l&&(i[l]?i[l][1]=n:i[l]=[n,n])}t.__layers=i}return t.__layers[e]}function wV(t,e){if(!t.__ids){const i=[],r=t.featureIds.value,n=t.globalFeatureIds.value;for(let l=0;l<r.length;l++)i[r[l]]=n[l];t.__ids=i}return t.__ids[e]}function xw(t,e,i,r){for(let n=i;n<r;n++)if(e(t[n],n))return n;return-1}const om=512,TV={...sg.defaultProps,data:BE,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[YE],binary:!0};class w0 extends u5{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var e;return!!((e=this.state)!=null&&e.data&&super.isLoaded)}updateState({props:e,oldProps:i,context:r,changeFlags:n}){var h;n.dataChanged&&this._updateTileData(),(h=this.state)!=null&&h.data&&(super.updateState({props:e,oldProps:i,context:r,changeFlags:n}),this._setWGS84PropertyForTiles());const{highlightColor:l}=e;l!==i.highlightColor&&Array.isArray(l)&&this.setState({highlightColor:l})}async _updateTileData(){let e=this.props.data,i=null;if(typeof e=="string"&&!GU(e)){const{onDataLoad:r,fetch:n}=this.props;this.setState({data:null,tileJSON:null});try{i=await n(e,{propName:"data",layer:this,loaders:[]})}catch(l){this.raiseError(l,"loading TileJSON"),e=null}r&&r(i,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(i=e);i&&(e=i.tiles),this.setState({data:e,tileJSON:i})}_getTilesetOptions(){const e=super._getTilesetOptions(),i=this.state.tileJSON,{minZoom:r,maxZoom:n}=this.props;return i&&(Number.isFinite(i.minzoom)&&i.minzoom>r&&(e.minZoom=i.minzoom),Number.isFinite(i.maxzoom)&&(!Number.isFinite(n)||i.maxzoom<n)&&(e.maxZoom=i.maxzoom)),e}renderLayers(){var e;return(e=this.state)!=null&&e.data?super.renderLayers():null}getTileData(e){const{data:i,binary:r}=this.state,{index:n,signal:l}=e,h=bp(i,e);if(!h)return Promise.reject("Invalid URL");let a=this.getLoadOptions();const{fetch:g}=this.props;return a={...a,mimeType:"application/x-protobuf",mvt:{...a==null?void 0:a.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:n},gis:r?{format:"binary"}:{}},g(h,{propName:"data",layer:this,loadOptions:a,signal:l})}renderSubLayers(e){const{x:i,y:r,z:n}=e.tile.index,l=Math.pow(2,n),h=om/l,a=-h,g=om*i/l,y=om*(1-r/l),T=new Qr().scale([h,a,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=T,e.coordinateOrigin=[g,y,0],e.coordinateSystem=Qt.CARTESIAN,e.extensions=[...e.extensions||[],new $E]);const S=super.renderSubLayers(e);return this.state.binary&&!(S instanceof sg)&&Wt.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),S}_updateAutoHighlight(e){const{uniqueIdProperty:i}=this.props,{hoveredFeatureId:r,hoveredFeatureLayerName:n}=this.state,l=e.object;let h=null,a=null;l&&(h=am(l,i),a=vw(l));let{highlightColor:g}=this.props;typeof g=="function"&&(g=g(e)),(r!==h||n!==a)&&this.setState({highlightColor:g,hoveredFeatureId:h,hoveredFeatureLayerName:a})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){const i=super.getPickingInfo(e);if(this.state.binary&&i.index!==-1){const{data:r}=e.sourceLayer.props;i.object=dw(r,{globalFeatureId:i.index})}return i.object&&!this._isWGS84()&&(i.object=ww(i.object,i.tile.bbox,this.context.viewport)),i}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:i,hoveredFeatureLayerName:r,binary:n}=this.state,{uniqueIdProperty:l,highlightedFeatureId:h}=this.props,a=e.content,g=bw(h);if(!(bw(i)||g))return-1;const T=g?h:i;return Array.isArray(a)?a.findIndex(S=>{const P=am(S,l)===T,M=g||vw(S)===r;return P&&M}):a&&n?xV(a,l,T,g?"":r):-1}_pickObjects(e){const{deck:i,viewport:r}=this.context,n=r.width,l=r.height,h=r.x,a=r.y,g=[this.id];return i.pickObjects({x:h,y:a,width:n,height:l,layerIds:g,maxObjects:e})}getRenderedFeatures(e=null){const i=this._pickObjects(e),r=new Set,n=[];for(const l of i){const h=am(l.object,this.props.uniqueIdProperty);h===void 0?n.push(l.object):r.has(h)||(r.add(h),n.push(l.object))}return n}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(r=>{r.hasOwnProperty(e)||Object.defineProperty(r,e,{get:()=>{if(!r.content)return null;if(this.state.binary&&Array.isArray(r.content)&&!r.content.length)return[];const{bbox:n}=r;if(r._contentWGS84===void 0&&JU(n)){const l=this.state.binary?dw(r.content):r.content;r._contentWGS84=l.map(h=>ww(h,n,this.context.viewport))}return r._contentWGS84}})})}}w0.layerName="MVTLayer";w0.defaultProps=TV;const QE=w0;function am(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function vw(t){var e;return((e=t.properties)==null?void 0:e.layerName)||null}function bw(t){return t!=null&&t!==""}function ww(t,e,i){const r={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(r.geometry,"coordinates",{get:()=>mV(t.geometry,e,i).coordinates}),r}const SV=512,EV=.5;function eA(t,e,i){const r=e.type===2?e.readVarint()+e.pos:e.pos+1;return i.value=new t(e.buf.buffer.slice(e.pos,r)),e.pos=r,i.value}class T0{static read(e,i){return e.readFields(T0._readField,{key:"",value:null},i)}static _readField(e,i,r){e===1?i.key=r.readString():e===2&&(i.value=r.readString())}}class Bc{static read(e,i){return e.readFields(Bc._readField,{},i)}static _readField(e,i,r){if(e===1){const{key:n,value:l}=T0.read(r,r.readVarint()+r.pos);i[n]=l}}}class Hh{static read(e,i){const{value:r,size:n}=e.readFields(Hh._readField,{value:[],size:0},i);return{value:r,size:n}}static _readField(e,i,r){e===1?eA(Float64Array,r,i):e===2&&(i.size=r.readVarint(!0))}}class os{static read(e,i){const{value:r,size:n}=e.readFields(os._readField,{value:[],size:0},i);return{value:new Uint32Array(r),size:n}}static _readField(e,i,r){e===1?r.readPackedVarint(i.value):e===2&&(i.size=r.readVarint(!0))}}class qh{static read(e,i){return e.readFields(qh._readField,{id:0},i)}static _readField(e,i,r){e===1&&(i.id=r.readVarint())}}class S0{static read(e,i){return e.readFields(S0._readField,{value:[]},i)}static _readField(e,i,r){e===1&&eA(Float64Array,r,i)}}class zc{static read(e,i){return e.readFields(zc._readField,{key:"",value:null},i)}static _readField(e,i,r){e===1?i.key=r.readString():e===2&&(i.value=S0.read(r,r.readVarint()+r.pos))}}class E0{static read(e,i){return e.readFields(E0._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},i)}static _readField(e,i,r){if(e===1)i.positions=Hh.read(r,r.readVarint()+r.pos);else if(e===2)i.globalFeatureIds=os.read(r,r.readVarint()+r.pos);else if(e===3)i.featureIds=os.read(r,r.readVarint()+r.pos);else if(e===4)i.properties.push(Bc.read(r,r.readVarint()+r.pos));else if(e===5){const n=zc.read(r,r.readVarint()+r.pos);i.numericProps[n.key]=n.value}else e===6&&i.fields.push(qh.read(r,r.readVarint()+r.pos))}}class A0{static read(e,i){return e.readFields(A0._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},i)}static _readField(e,i,r){if(e===1)i.positions=Hh.read(r,r.readVarint()+r.pos);else if(e===2)i.pathIndices=os.read(r,r.readVarint()+r.pos);else if(e===3)i.globalFeatureIds=os.read(r,r.readVarint()+r.pos);else if(e===4)i.featureIds=os.read(r,r.readVarint()+r.pos);else if(e===5)i.properties.push(Bc.read(r,r.readVarint()+r.pos));else if(e===6){const n=zc.read(r,r.readVarint()+r.pos);i.numericProps[n.key]=n.value}else e===7&&i.fields.push(qh.read(r,r.readVarint()+r.pos))}}class P0{static read(e,i){return e.readFields(P0._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},i)}static _readField(e,i,r){if(e===1)i.positions=Hh.read(r,r.readVarint()+r.pos);else if(e===2)i.polygonIndices=os.read(r,r.readVarint()+r.pos);else if(e===3)i.globalFeatureIds=os.read(r,r.readVarint()+r.pos);else if(e===4)i.featureIds=os.read(r,r.readVarint()+r.pos);else if(e===5)i.primitivePolygonIndices=os.read(r,r.readVarint()+r.pos);else if(e===6)i.triangles=os.read(r,r.readVarint()+r.pos);else if(e===7)i.properties.push(Bc.read(r,r.readVarint()+r.pos));else if(e===8){const n=zc.read(r,r.readVarint()+r.pos);i.numericProps[n.key]=n.value}else e===9&&i.fields.push(qh.read(r,r.readVarint()+r.pos))}}let AV=class tA{static read(e,i){return e.readFields(tA._readField,{points:null,lines:null,polygons:null},i)}static _readField(e,i,r){e===1?i.points=E0.read(r,r.readVarint()+r.pos):e===2?i.lines=A0.read(r,r.readVarint()+r.pos):e===3&&(i.polygons=P0.read(r,r.readVarint()+r.pos))}};function iA(t,e){const i=new v0(t);return e.read(i)}function PV(t,e){return`https://unpkg.com/@deck.gl/carto@${e}/dist/${t}-worker.js`}const IV=t=>t!==null&&typeof t=="object",CV=t=>IV(t)&&t.constructor==={}.constructor;function RV(t,e){var i,r,n;(r=(i=t==null?void 0:t.fetch)==null?void 0:i.headers)!=null&&r.Authorization||(t.fetch={...t.fetch,headers:{...(n=t.fetch)==null?void 0:n.headers,Authorization:`Bearer ${e}`}})}function MV(t,e){const i={};for(const{geoid:r,...n}of e.properties)r in i?Wt.warn("Duplicate geoid key in boundary mapping, using first occurance")():i[r]=n;for(const r of["points","lines","polygons"]){const n=t[r];if(n.positions.value.length===0)continue;n.properties=n.properties.map(({geoid:y})=>i[y]);const{positions:l,globalFeatureIds:h}=n;let a=null;r==="lines"&&(a=n.pathIndices.value),r==="polygons"&&(a=n.polygonIndices.value);const g=l.value.length/l.size;for(const y in e.numericProps){const T=e.numericProps[y].value,S=T.constructor,P=new S(g);if(n.numericProps[y]={value:P,size:1},a)for(let M=0;M<a.length-1;M++){const B=a[M],j=a[M+1],Z=h.value[B];P.fill(T[Z],B,j)}else for(let M=0;M<g;M++){const B=h.value[M];P[M]=T[B]}}}return t}const Tw={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="object"&&Array.isArray(t.tiles)&&t.tiles.every(i=>typeof i=="string"),equal:(t,e)=>qn(t,e,2),async:!0};class I0{static read(e,i){return e.readFields(I0._readField,{properties:[],numericProps:{}},i)}static _readField(e,i,r){if(e===1)i.properties.push(Bc.read(r,r.readVarint()+r.pos));else if(e===2){const n=zc.read(r,r.readVarint()+r.pos);i.numericProps[n.key]=n.value}}}const kV={name:"CARTO Properties Tile",version:"1",id:"cartoPropertiesTile",module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-properties-tile"],category:"geometry",worker:!1,parse:async(t,e)=>Sw(t),parseSync:Sw,options:{}};function Sw(t,e){return t?iA(t,I0):null}const OV=kV,rA="9.0.36",nA="cartoVectorTile",FV={cartoVectorTile:{workerUrl:PV(nA,rA)}},DV={name:"CARTO Vector Tile",version:rA,id:nA,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(t,e)=>Ew(t),parseSync:Ew,worker:!0,options:FV};function NV(t,e,{startPosition:i,endPosition:r,indices:n}){const l=t.positions.size,h=i*l,a=r*l,g=t.positions.value.subarray(h,a),y=n.slice(1).map(S=>S-i),T=CE(g,y,l);for(let S=0,P=T.length;S<P;++S)e.push(i+T[S])}function LV(t){const{polygonIndices:e,primitivePolygonIndices:i}=t,r=[];let n=0;for(let l=0;l<e.value.length-1;l++){const h=e.value[l],a=e.value[l+1],g=i.value.indexOf(a),y=i.value.subarray(n,g);n=g,NV(t,r,{startPosition:h,endPosition:a,indices:y})}t.triangles={value:new Uint32Array(r),size:1}}function Ew(t,e){if(!t)return null;const i=iA(t,AV);return i.polygons&&!i.polygons.triangles&&LV(i.polygons),i}const BV=DV;yT([OV,BV]);const zV={...QE.defaultProps,data:Tw,dataComparator:Tw.equal,tileSize:SV};class C0 extends QE{constructor(...e){super(...e)}initializeState(){super.initializeState(),this.setState({binary:!0})}updateState(e){const{props:i}=e;if(i.data){super.updateState(e);const n=new URL(i.data.tiles[0]).searchParams.get("formatTiles")==="mvt";this.setState({mvt:n})}}getLoadOptions(){const e=super.getLoadOptions()||{},i=this.props.data;return RV(e,i.accessToken),e.gis={format:"binary"},e}async getTileData(e){const i=this.props.data,{tiles:r,properties_tiles:n}=i,l=bp(r,e);if(!l)return Promise.reject("Invalid URL");const h=this.getLoadOptions(),{fetch:a}=this.props,{signal:g}=e,y=a(l,{propName:"data",layer:this,loadOptions:h,signal:g});if(!n)return await y;const T=bp(n,e);if(!T)return Promise.reject("Invalid properties URL");const S=a(T,{propName:"data",layer:this,loadOptions:h,signal:g}),[P,M]=await Promise.all([y,S]);return P?M?MV(P,M):P:null}renderSubLayers(e){if(e.data===null)return null;if(this.state.mvt)return super.renderSubLayers(e);const i=e.tile.bbox,{west:r,south:n,east:l,north:h}=i,a=[new $E,...e.extensions||[]],g={clipBounds:[r,n,l,h]},y=P=>{var M,B,j;return{[P]:{...g,...(M=e==null?void 0:e._subLayerProps)==null?void 0:M[P],extensions:[...a,...((j=(B=e==null?void 0:e._subLayerProps)==null?void 0:B[P])==null?void 0:j.extensions)||[]]}}},T={...e,autoHighlight:!1,_subLayerProps:{...e._subLayerProps,...y("polygons-fill"),...y("polygons-stroke"),...y("linestrings")}};return new sg(T)}_isWGS84(){return this.state.mvt?super._isWGS84():!0}}C0.layerName="VectorTileLayer";C0.defaultProps=zV;const UV=C0;class VV extends Error{constructor(e,i,r,n){let l="Failed to connect";r&&(l="Server returned: ",r.status===400?l+="Bad request":r.status===401||r.status===403?l+="Unauthorized access":r.status===404?l+="Not found":l+="Error",l+=` (${r.status}):`),l+=` ${e.message||e}`;let h=`${i.requestType} API request failed`;h+=`
${l}`;for(const a of Object.keys(i))a!=="requestType"&&(h+=`
${$V(a)}: ${i[a]}`);h+=`
`,super(h),this.name="CartoAPIError",this.response=r,this.responseJson=n,this.error=e,this.errorContext=i}}function $V(t){return t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}const jV="https://basemaps.cartocdn.com/gl/{basemap}-gl-style/style.json";function nc(t){return jV.replace("{basemap}",t)}const WV={VOYAGER:nc("voyager"),POSITRON:nc("positron"),DARK_MATTER:nc("dark-matter"),VOYAGER_NOLABELS:nc("voyager-nolabels"),POSITRON_NOLABELS:nc("positron-nolabels"),DARK_MATTER_NOLABELS:nc("dark-matter-nolabels")},HV="https://gcp-us-east1.api.carto.com",qV="deck-gl-carto",XV="3.4",sA=7e3;function ZV(...t){return t.map(e=>e.endsWith("/")?e.slice(0,-1):e).join("/")}function YV(t,e,i,...r){return ZV(t,e,i,...r)}function KV({apiBaseUrl:t,connectionName:e,endpoint:i}){return YV(t,"v3","maps",e,i)}const GV={v:XV,deckglVersion:PT},JV={Accept:"application/json","Content-Type":"application/json"},Rf=new Map;async function lm({baseUrl:t,parameters:e={},headers:i={},errorContext:r,maxLengthURL:n=sA}){e={...GV,...e},t=t8(t,Object.keys(e));const l=QV(t,e,i);if(Rf.has(l))return Rf.get(l);const h=e8(t,e),a={...JV,...i},g=h.length>n?fetch(t,{method:"POST",body:JSON.stringify(e),headers:a}):fetch(h,{headers:a});let y,T;const S=g.then(P=>(y=P,y.json())).then(P=>{if(T=P,!y||!y.ok)throw new Error(P.error);return P}).catch(P=>{throw Rf.delete(l),new VV(P,r,y,T)});return Rf.set(l,S),S}function QV(t,e,i){const r=Object.entries(e).sort(([l],[h])=>l>h?1:-1),n=Object.entries(i).sort(([l],[h])=>l>h?1:-1);return JSON.stringify({baseUrl:t,parameters:r,headers:n})}function e8(t,e){const i=new URL(t);for(const[r,n]of Object.entries(e))CV(n)||Array.isArray(n)?i.searchParams.set(r,JSON.stringify(n)):i.searchParams.set(r,n.toString());return i.toString()}function t8(t,e){const i=new URL(t);for(const r of e)i.searchParams.has(r)&&i.searchParams.delete(r);return i.toString()}const i8={apiBaseUrl:HV,clientId:qV,format:"tilejson",headers:{},maxLengthURL:sA};async function r8(t,e,i){const{accessToken:r,connectionName:n,cache:l,...h}=e,a={...i8,accessToken:r,connectionName:n,endpoint:t};for(const G in h)h[G]&&(a[G]=h[G]);const g=KV(a),{clientId:y,maxLengthURL:T,format:S}=a,P={Authorization:`Bearer ${e.accessToken}`,...e.headers},M={client:y,...i},B={requestType:"Map instantiation",connection:e.connectionName,type:t,source:JSON.stringify(M,void 0,2)},Z=(await lm({baseUrl:g,parameters:M,headers:P,errorContext:B,maxLengthURL:T}))[S].url[0];if(l&&(l.value=parseInt(new URL(Z).searchParams.get("cache")||"",10)),B.requestType="Map data",S==="tilejson"){const G=await lm({baseUrl:Z,headers:P,errorContext:B,maxLengthURL:T});return r&&(G.accessToken=r),G}return await lm({baseUrl:Z,headers:P,errorContext:B,maxLengthURL:T})}const n8=async function(t){const{columns:e,filters:i,spatialDataColumn:r="geom",tableName:n,tileResolution:l=EV}=t,h={name:n,spatialDataColumn:r,spatialDataType:"geo",tileResolution:l.toString()};return e&&(h.columns=e.join(",")),i&&(h.filters=i),r8("table",t,h)};let s8="carto-api-client";function o8(){return s8}var yy;(function(t){t.IN="in",t.BETWEEN="between",t.CLOSED_OPEN="closed_open",t.TIME="time",t.STRING_SEARCH="stringSearch"})(yy||(yy={}));const a8=new Set(Object.values(yy)),l8=t=>a8.has(t);function c8(t,e){if(!e)return{};const i={};for(const r in e)for(const n in e[r]){if(!l8(n))continue;const l=e[r][n],h=!t||!(l!=null&&l.owner)||(l==null?void 0:l.owner)!==t;l&&h&&(i[r]||(i[r]={}),i[r][n]=l)}return i}function ia(t){return Array.isArray(t)?t.map(e=>ia(e)):typeof t!="object"?t:Object.entries(t).reduce((e,[i,r])=>(e[i.toLowerCase()]=typeof r=="object"&&r?ia(r):r,e),{})}function ea(t,e){if(!t)throw new Error(e)}class ha extends Error{constructor(e){super(`${ha.NAME}: ${e}`),this.name=ha.NAME}static is(e){var i;return e instanceof ha||((i=e.message)==null?void 0:i.includes(ha.NAME))}}ha.NAME="InvalidColumnError";function u8(t){if(!d8(t))return h8(Nz(t).geometry)}function h8(t){return t&&f8(t)||void 0}function d8(t){const[e,i,r,n]=t;return r-e>179.5*2&&n-i>85.05*2}function f8(t){const e=[-180,-90,180,90],i=Gu(Z_(t,e).geometry),r=Aw(t,360),n=Aw(t,-360);let l=i;if(l&&r){const h=Gu(Z_(r,e).geometry);if(h){const a=g1([la(l),la(h)]),g=R1(a);l=g?Gu(g.geometry):l}}if(l&&n){const h=Gu(Z_(n,e).geometry);if(h){const a=g1([la(l),la(h)]),g=R1(a);l=g?Gu(g.geometry):l}}return l}function oA(t){const e=t.filter(i=>i.length>0);return e.length>0?e:null}function p8(t){const e=t.map(oA).filter(i=>i);return e.length>0?e:null}function Gu(t){if(!t)return null;if(m8(t)){const e=oA(t.coordinates);return e?jh(e).geometry:null}if(y8(t)){const e=p8(t.coordinates);return e?tg(e).geometry:null}return null}function g8(t,e){return t.map(i=>[i[0]+e,i[1]])}function aA(t,e){return t.map(i=>g8(i,e))}function _8(t,e){return t.map(i=>aA(i,e))}function Aw(t,e){if(t&&pp(t)==="Polygon"){const i=aA(t.coordinates,e);return jh(i).geometry}else if(t&&pp(t)==="MultiPolygon"){const i=_8(t.coordinates,e);return tg(i).geometry}else return null}function m8(t){return pp(t)==="Polygon"}function y8(t){return pp(t)==="MultiPolygon"}function xn(){return xn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)({}).hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},xn.apply(null,arguments)}function Wa(t,e){if(t==null)return{};var i={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.includes(r))continue;i[r]=t[r]}return i}const x8="https://gcp-us-east1.api.carto.com",lA="geom";var Ep;(function(t){t.TABLE="table",t.QUERY="query",t.TILESET="tileset"})(Ep||(Ep={}));var Ap;(function(t){t.V1="v1",t.V2="v2",t.V3="v3"})(Ap||(Ap={}));function v8({response:t,data:e}){var i,r;if(e.error==="Column not found")throw new ha(`${e.error} ${e.column_name}`);if((i=e.error)!=null&&i.includes("Missing columns"))throw new ha(e.error);switch(t.status){case 401:throw new Error("Unauthorized access. Invalid credentials");case 403:throw new Error("Forbidden access to the requested data");default:const n=e&&e.error&&typeof e.error=="string"?e.error:JSON.stringify((e==null?void 0:e.hint)||((r=e.error)==null?void 0:r[0]));throw new Error(n)}}async function b8({url:t,accessToken:e,opts:i}){let r,n;const l=(i==null?void 0:i.method)==="POST";try{var h;r=await fetch(t.toString(),xn({headers:xn({Authorization:`Bearer ${e}`},l&&{"Content-Type":"application/json"})},l&&{method:i==null?void 0:i.method,body:i==null?void 0:i.body},{signal:i==null||(h=i.abortController)==null?void 0:h.signal},i==null?void 0:i.otherOptions)),n=await r.json()}catch(a){throw a.name==="AbortError"?a:new Error(`Failed request: ${a}`)}return r.ok||v8({response:r,data:n}),n}const Pw=["category","histogram","formula","timeseries","range","scatterplot","table"],{V3:w8}=Ap,T8=2048;function Ha(t){ea(t.source,"executeModel: missing source"),ea(t.model,"executeModel: missing model"),ea(t.params,"executeModel: missing params"),ea(Pw.includes(t.model),`executeModel: model provided isn't valid. Available models: ${Pw.join(", ")}`);const{model:e,source:i,params:r,opts:n}=t,{type:l,apiVersion:h,apiBaseUrl:a,accessToken:g,connectionName:y,clientId:T}=i;ea(a,"executeModel: missing apiBaseUrl"),ea(g,"executeModel: missing accessToken"),ea(h===w8,"executeModel: SQL Model API requires CARTO 3+"),ea(l!==Ep.TILESET,"executeModel: Tilesets not supported");let S=`${a}/v3/sql/${y}/model/${e}`;const{filters:P,filtersLogicalOperator:M="and",data:B}=i,j=i.queryParameters?JSON.stringify(i.queryParameters):"",Z={type:l,client:T,source:B,params:JSON.stringify(r),queryParameters:j,filters:JSON.stringify(P),filtersLogicalOperator:M},G=i.spatialFilter?{[i.geoColumn?i.geoColumn:lA]:i.spatialFilter}:void 0;G&&(Z.spatialFilters=JSON.stringify(G));const fe=S+"?"+new URLSearchParams(Z).toString(),re=fe.length<=T8;return re?S=fe:(Z.params=r,Z.filters=P,Z.queryParameters=i.queryParameters,G&&(Z.spatialFilters=G)),b8({url:S,accessToken:i.accessToken,opts:xn({},n,{method:re?"GET":"POST"},!re&&{body:JSON.stringify(Z)})})}const S8=["filterOwner","spatialFilter","abortController"],E8=["filterOwner","spatialFilter","abortController","operationExp"],A8=["filterOwner","spatialFilter","abortController"],P8=["filterOwner","spatialFilter","abortController"],I8=["filterOwner","spatialFilter","abortController"],C8=["filterOwner","spatialFilter","abortController"],R8=["filterOwner","abortController","spatialFilter"];class ag{constructor(e){this.props=void 0,this.props=xn({},ag.defaultProps,e)}_getModelSource(e){const i=this.props;return{apiVersion:i.apiVersion,apiBaseUrl:i.apiBaseUrl,clientId:i.clientId,accessToken:i.accessToken,connectionName:i.connectionName,filters:c8(e,i.filters),filtersLogicalOperator:i.filtersLogicalOperator,geoColumn:i.geoColumn}}async getCategories(e){const{filterOwner:i,spatialFilter:r,abortController:n}=e,l=Wa(e,S8),{column:h,operation:a,operationColumn:g}=l;return Ha({model:"category",source:xn({},this.getModelSource(i),{spatialFilter:r}),params:{column:h,operation:a,operationColumn:g||h},opts:{abortController:n}}).then(y=>ia(y.rows))}async getFormula(e){const{filterOwner:i,spatialFilter:r,abortController:n,operationExp:l}=e,h=Wa(e,E8),{column:a,operation:g}=h;return Ha({model:"formula",source:xn({},this.getModelSource(i),{spatialFilter:r}),params:{column:a??"*",operation:g,operationExp:l},opts:{abortController:n}}).then(y=>ia(y.rows[0]))}async getHistogram(e){const{filterOwner:i,spatialFilter:r,abortController:n}=e,l=Wa(e,A8),{column:h,operation:a,ticks:g}=l,y=await Ha({model:"histogram",source:xn({},this.getModelSource(i),{spatialFilter:r}),params:{column:h,operation:a,ticks:g},opts:{abortController:n}}).then(T=>ia(T.rows));if(y.length){const T=Array(g.length+1).fill(0);return y.forEach(({tick:S,value:P})=>T[S]=P),T}return[]}async getRange(e){const{filterOwner:i,spatialFilter:r,abortController:n}=e,l=Wa(e,P8),{column:h}=l;return Ha({model:"range",source:xn({},this.getModelSource(i),{spatialFilter:r}),params:{column:h},opts:{abortController:n}}).then(a=>ia(a.rows[0]))}async getScatter(e){const{filterOwner:i,spatialFilter:r,abortController:n}=e,l=Wa(e,I8),{xAxisColumn:h,xAxisJoinOperation:a,yAxisColumn:g,yAxisJoinOperation:y}=l,T=500;return Ha({model:"scatterplot",source:xn({},this.getModelSource(i),{spatialFilter:r}),params:{xAxisColumn:h,xAxisJoinOperation:a,yAxisColumn:g,yAxisJoinOperation:y,limit:T},opts:{abortController:n}}).then(S=>ia(S.rows)).then(S=>S.map(({x:P,y:M})=>[P,M]))}async getTable(e){const{filterOwner:i,spatialFilter:r,abortController:n}=e,l=Wa(e,C8),{columns:h,sortBy:a,sortDirection:g,offset:y=0,limit:T=10}=l;return Ha({model:"table",source:xn({},this.getModelSource(i),{spatialFilter:r}),params:{column:h,sortBy:a,sortDirection:g,limit:T,offset:y},opts:{abortController:n}}).then(S=>{var P,M,B,j;return{rows:(P=S.rows)!=null?P:S.ROWS,totalCount:(M=(B=S.metadata)==null?void 0:B.total)!=null?M:(j=S.METADATA)==null?void 0:j.TOTAL}})}async getTimeSeries(e){const{filterOwner:i,abortController:r,spatialFilter:n}=e,l=Wa(e,R8),{column:h,operationColumn:a,joinOperation:g,operation:y,stepSize:T,stepMultiplier:S,splitByCategory:P,splitByCategoryLimit:M,splitByCategoryValues:B}=l;return Ha({model:"timeseries",source:xn({},this.getModelSource(i),{spatialFilter:n}),params:{column:h,stepSize:T,stepMultiplier:S,operationColumn:a||h,joinOperation:g,operation:y,splitByCategory:P,splitByCategoryLimit:M,splitByCategoryValues:B},opts:{abortController:r}}).then(j=>{var Z;return{rows:ia(j.rows),categories:(Z=j.metadata)==null?void 0:Z.categories}})}}ag.defaultProps={apiVersion:Ap.V3,apiBaseUrl:x8,clientId:o8(),filters:{},filtersLogicalOperator:"and",geoColumn:lA};class M8 extends ag{getModelSource(e){return xn({},super._getModelSource(e),{type:Ep.TABLE,data:this.props.tableName})}}async function k8(t){O8(t);const e=await n8(t);return xn({},e,{widgetSource:new M8(t)})}function O8(t){typeof deck<"u"&&deck&&deck.VERSION&&(t.clientId||(t.clientId="deck-gl-carto"))}function F8(t,e){let i;return function(...r){clearTimeout(i),i=setTimeout(()=>t.apply(this,r),e)}}function Iw(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,typeof(n=function(l,h){if(typeof l!="object"||l===null)return l;var a=l[Symbol.toPrimitive];if(a!==void 0){var g=a.call(l,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r.key))=="symbol"?n:String(n),r)}var n}function tn(t,e,i){return e&&Iw(t.prototype,e),i&&Iw(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function Jt(){return Jt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},Jt.apply(this,arguments)}function gr(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,xy(t,e)}function xy(t,e){return xy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},xy(t,e)}function Cw(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Rw(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function yn(t,e){var i=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i)return(i=i.call(t)).next.bind(i);if(Array.isArray(t)||(i=function(n,l){if(n){if(typeof n=="string")return Rw(n,l);var h=Object.prototype.toString.call(n).slice(8,-1);return h==="Object"&&n.constructor&&(h=n.constructor.name),h==="Map"||h==="Set"?Array.from(n):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?Rw(n,l):void 0}}(t))||e&&t&&typeof t.length=="number"){i&&(t=i);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Fn;(function(t){t[t.Init=0]="Init",t[t.Loading=1]="Loading",t[t.Loaded=2]="Loaded",t[t.Rendered=3]="Rendered",t[t.Error=4]="Error"})(Fn||(Fn={}));var lg,Vt,cA,uA,hh,Mw,hA,Pp={},dA=[],D8=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function da(t,e){for(var i in e)t[i]=e[i];return t}function fA(t){var e=t.parentNode;e&&e.removeChild(t)}function vt(t,e,i){var r,n,l,h={};for(l in e)l=="key"?r=e[l]:l=="ref"?n=e[l]:h[l]=e[l];if(arguments.length>2&&(h.children=arguments.length>3?lg.call(arguments,2):i),typeof t=="function"&&t.defaultProps!=null)for(l in t.defaultProps)h[l]===void 0&&(h[l]=t.defaultProps[l]);return $f(t,h,r,n,null)}function $f(t,e,i,r,n){var l={type:t,props:e,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:n??++cA};return n==null&&Vt.vnode!=null&&Vt.vnode(l),l}function Ks(t){return t.children}function jf(t,e){this.props=t,this.context=e}function kh(t,e){if(e==null)return t.__?kh(t.__,t.__.__k.indexOf(t)+1):null;for(var i;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null)return i.__e;return typeof t.type=="function"?kh(t):null}function pA(t){var e,i;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null){t.__e=t.__c.base=i.__e;break}return pA(t)}}function vy(t){(!t.__d&&(t.__d=!0)&&hh.push(t)&&!Ip.__r++||Mw!==Vt.debounceRendering)&&((Mw=Vt.debounceRendering)||setTimeout)(Ip)}function Ip(){for(var t;Ip.__r=hh.length;)t=hh.sort(function(e,i){return e.__v.__b-i.__v.__b}),hh=[],t.some(function(e){var i,r,n,l,h,a;e.__d&&(h=(l=(i=e).__v).__e,(a=i.__P)&&(r=[],(n=da({},l)).__v=l.__v+1,R0(a,l,n,i.__n,a.ownerSVGElement!==void 0,l.__h!=null?[h]:null,r,h??kh(l),l.__h),yA(r,l),l.__e!=h&&pA(l)))})}function gA(t,e,i,r,n,l,h,a,g,y){var T,S,P,M,B,j,Z,G=r&&r.__k||dA,fe=G.length;for(i.__k=[],T=0;T<e.length;T++)if((M=i.__k[T]=(M=e[T])==null||typeof M=="boolean"?null:typeof M=="string"||typeof M=="number"||typeof M=="bigint"?$f(null,M,null,null,M):Array.isArray(M)?$f(Ks,{children:M},null,null,null):M.__b>0?$f(M.type,M.props,M.key,M.ref?M.ref:null,M.__v):M)!=null){if(M.__=i,M.__b=i.__b+1,(P=G[T])===null||P&&M.key==P.key&&M.type===P.type)G[T]=void 0;else for(S=0;S<fe;S++){if((P=G[S])&&M.key==P.key&&M.type===P.type){G[S]=void 0;break}P=null}R0(t,M,P=P||Pp,n,l,h,a,g,y),B=M.__e,(S=M.ref)&&P.ref!=S&&(Z||(Z=[]),P.ref&&Z.push(P.ref,null,M),Z.push(S,M.__c||B,M)),B!=null?(j==null&&(j=B),typeof M.type=="function"&&M.__k===P.__k?M.__d=g=_A(M,g,t):g=mA(t,M,P,G,B,g),typeof i.type=="function"&&(i.__d=g)):g&&P.__e==g&&g.parentNode!=t&&(g=kh(P))}for(i.__e=j,T=fe;T--;)G[T]!=null&&vA(G[T],G[T]);if(Z)for(T=0;T<Z.length;T++)xA(Z[T],Z[++T],Z[++T])}function _A(t,e,i){for(var r,n=t.__k,l=0;n&&l<n.length;l++)(r=n[l])&&(r.__=t,e=typeof r.type=="function"?_A(r,e,i):mA(i,r,r,n,r.__e,e));return e}function mA(t,e,i,r,n,l){var h,a,g;if(e.__d!==void 0)h=e.__d,e.__d=void 0;else if(i==null||n!=l||n.parentNode==null)e:if(l==null||l.parentNode!==t)t.appendChild(n),h=null;else{for(a=l,g=0;(a=a.nextSibling)&&g<r.length;g+=1)if(a==n)break e;t.insertBefore(n,l),h=l}return h!==void 0?h:n.nextSibling}function kw(t,e,i){e[0]==="-"?t.setProperty(e,i):t[e]=i==null?"":typeof i!="number"||D8.test(e)?i:i+"px"}function Mf(t,e,i,r,n){var l;e:if(e==="style")if(typeof i=="string")t.style.cssText=i;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)i&&e in i||kw(t.style,e,"");if(i)for(e in i)r&&i[e]===r[e]||kw(t.style,e,i[e])}else if(e[0]==="o"&&e[1]==="n")l=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+l]=i,i?r||t.addEventListener(e,l?Fw:Ow,l):t.removeEventListener(e,l?Fw:Ow,l);else if(e!=="dangerouslySetInnerHTML"){if(n)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=i??"";break e}catch{}typeof i=="function"||(i==null||i===!1&&e.indexOf("-")==-1?t.removeAttribute(e):t.setAttribute(e,i))}}function Ow(t){this.l[t.type+!1](Vt.event?Vt.event(t):t)}function Fw(t){this.l[t.type+!0](Vt.event?Vt.event(t):t)}function R0(t,e,i,r,n,l,h,a,g){var y,T,S,P,M,B,j,Z,G,fe,re,ue,Me,Oe,$e,ke=e.type;if(e.constructor!==void 0)return null;i.__h!=null&&(g=i.__h,a=e.__e=i.__e,e.__h=null,l=[a]),(y=Vt.__b)&&y(e);try{e:if(typeof ke=="function"){if(Z=e.props,G=(y=ke.contextType)&&r[y.__c],fe=y?G?G.props.value:y.__:r,i.__c?j=(T=e.__c=i.__c).__=T.__E:("prototype"in ke&&ke.prototype.render?e.__c=T=new ke(Z,fe):(e.__c=T=new jf(Z,fe),T.constructor=ke,T.render=L8),G&&G.sub(T),T.props=Z,T.state||(T.state={}),T.context=fe,T.__n=r,S=T.__d=!0,T.__h=[],T._sb=[]),T.__s==null&&(T.__s=T.state),ke.getDerivedStateFromProps!=null&&(T.__s==T.state&&(T.__s=da({},T.__s)),da(T.__s,ke.getDerivedStateFromProps(Z,T.__s))),P=T.props,M=T.state,S)ke.getDerivedStateFromProps==null&&T.componentWillMount!=null&&T.componentWillMount(),T.componentDidMount!=null&&T.__h.push(T.componentDidMount);else{if(ke.getDerivedStateFromProps==null&&Z!==P&&T.componentWillReceiveProps!=null&&T.componentWillReceiveProps(Z,fe),!T.__e&&T.shouldComponentUpdate!=null&&T.shouldComponentUpdate(Z,T.__s,fe)===!1||e.__v===i.__v){for(T.props=Z,T.state=T.__s,e.__v!==i.__v&&(T.__d=!1),T.__v=e,e.__e=i.__e,e.__k=i.__k,e.__k.forEach(function(je){je&&(je.__=e)}),re=0;re<T._sb.length;re++)T.__h.push(T._sb[re]);T._sb=[],T.__h.length&&h.push(T);break e}T.componentWillUpdate!=null&&T.componentWillUpdate(Z,T.__s,fe),T.componentDidUpdate!=null&&T.__h.push(function(){T.componentDidUpdate(P,M,B)})}if(T.context=fe,T.props=Z,T.__v=e,T.__P=t,ue=Vt.__r,Me=0,"prototype"in ke&&ke.prototype.render){for(T.state=T.__s,T.__d=!1,ue&&ue(e),y=T.render(T.props,T.state,T.context),Oe=0;Oe<T._sb.length;Oe++)T.__h.push(T._sb[Oe]);T._sb=[]}else do T.__d=!1,ue&&ue(e),y=T.render(T.props,T.state,T.context),T.state=T.__s;while(T.__d&&++Me<25);T.state=T.__s,T.getChildContext!=null&&(r=da(da({},r),T.getChildContext())),S||T.getSnapshotBeforeUpdate==null||(B=T.getSnapshotBeforeUpdate(P,M)),$e=y!=null&&y.type===Ks&&y.key==null?y.props.children:y,gA(t,Array.isArray($e)?$e:[$e],e,i,r,n,l,h,a,g),T.base=e.__e,e.__h=null,T.__h.length&&h.push(T),j&&(T.__E=T.__=null),T.__e=!1}else l==null&&e.__v===i.__v?(e.__k=i.__k,e.__e=i.__e):e.__e=N8(i.__e,e,i,r,n,l,h,g);(y=Vt.diffed)&&y(e)}catch(je){e.__v=null,(g||l!=null)&&(e.__e=a,e.__h=!!g,l[l.indexOf(a)]=null),Vt.__e(je,e,i)}}function yA(t,e){Vt.__c&&Vt.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(r){r.call(i)})}catch(r){Vt.__e(r,i.__v)}})}function N8(t,e,i,r,n,l,h,a){var g,y,T,S=i.props,P=e.props,M=e.type,B=0;if(M==="svg"&&(n=!0),l!=null){for(;B<l.length;B++)if((g=l[B])&&"setAttribute"in g==!!M&&(M?g.localName===M:g.nodeType===3)){t=g,l[B]=null;break}}if(t==null){if(M===null)return document.createTextNode(P);t=n?document.createElementNS("http://www.w3.org/2000/svg",M):document.createElement(M,P.is&&P),l=null,a=!1}if(M===null)S===P||a&&t.data===P||(t.data=P);else{if(l=l&&lg.call(t.childNodes),y=(S=i.props||Pp).dangerouslySetInnerHTML,T=P.dangerouslySetInnerHTML,!a){if(l!=null)for(S={},B=0;B<t.attributes.length;B++)S[t.attributes[B].name]=t.attributes[B].value;(T||y)&&(T&&(y&&T.__html==y.__html||T.__html===t.innerHTML)||(t.innerHTML=T&&T.__html||""))}if(function(j,Z,G,fe,re){var ue;for(ue in G)ue==="children"||ue==="key"||ue in Z||Mf(j,ue,null,G[ue],fe);for(ue in Z)re&&typeof Z[ue]!="function"||ue==="children"||ue==="key"||ue==="value"||ue==="checked"||G[ue]===Z[ue]||Mf(j,ue,Z[ue],G[ue],fe)}(t,P,S,n,a),T)e.__k=[];else if(B=e.props.children,gA(t,Array.isArray(B)?B:[B],e,i,r,n&&M!=="foreignObject",l,h,l?l[0]:i.__k&&kh(i,0),a),l!=null)for(B=l.length;B--;)l[B]!=null&&fA(l[B]);a||("value"in P&&(B=P.value)!==void 0&&(B!==t.value||M==="progress"&&!B||M==="option"&&B!==S.value)&&Mf(t,"value",B,S.value,!1),"checked"in P&&(B=P.checked)!==void 0&&B!==t.checked&&Mf(t,"checked",B,S.checked,!1))}return t}function xA(t,e,i){try{typeof t=="function"?t(e):t.current=e}catch(r){Vt.__e(r,i)}}function vA(t,e,i){var r,n;if(Vt.unmount&&Vt.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||xA(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(l){Vt.__e(l,e)}r.base=r.__P=null,t.__c=void 0}if(r=t.__k)for(n=0;n<r.length;n++)r[n]&&vA(r[n],e,i||typeof t.type!="function");i||t.__e==null||fA(t.__e),t.__=t.__e=t.__d=void 0}function L8(t,e,i){return this.constructor(t,i)}function dh(t,e,i){var r,n,l;Vt.__&&Vt.__(t,e),n=(r=typeof i=="function")?null:i&&i.__k||e.__k,l=[],R0(e,t=(!r&&i||e).__k=vt(Ks,null,[t]),n||Pp,Pp,e.ownerSVGElement!==void 0,!r&&i?[i]:n?null:e.firstChild?lg.call(e.childNodes):null,l,!r&&i?i:n?n.__e:e.firstChild,r),yA(l,t)}function bA(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return(t=="x"?e:3&e|8).toString(16)})}lg=dA.slice,Vt={__e:function(t,e,i,r){for(var n,l,h;e=e.__;)if((n=e.__c)&&!n.__)try{if((l=n.constructor)&&l.getDerivedStateFromError!=null&&(n.setState(l.getDerivedStateFromError(t)),h=n.__d),n.componentDidCatch!=null&&(n.componentDidCatch(t,r||{}),h=n.__d),h)return n.__E=n}catch(a){t=a}throw t}},cA=0,uA=function(t){return t!=null&&t.constructor===void 0},jf.prototype.setState=function(t,e){var i;i=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=da({},this.state),typeof t=="function"&&(t=t(da({},i),this.props)),t&&da(i,t),t!=null&&this.__v&&(e&&this._sb.push(e),vy(this))},jf.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),vy(this))},jf.prototype.render=Ks,hh=[],Ip.__r=0,hA=0;var cg=function(){function t(e){this._id=void 0,this._id=e||bA()}return tn(t,[{key:"id",get:function(){return this._id}}]),t}();function B8(t){return vt(t.parentElement||"span",{dangerouslySetInnerHTML:{__html:t.content}})}function wA(t,e){return vt(B8,{content:t,parentElement:e})}var en,M0=function(t){function e(r){var n;return(n=t.call(this)||this).data=void 0,n.update(r),n}gr(e,t);var i=e.prototype;return i.cast=function(r){return r instanceof HTMLElement?wA(r.outerHTML):r},i.update=function(r){return this.data=this.cast(r),this},e}(cg),cm=function(t){function e(r){var n;return(n=t.call(this)||this)._cells=void 0,n.cells=r||[],n}gr(e,t);var i=e.prototype;return i.cell=function(r){return this._cells[r]},i.toArray=function(){return this.cells.map(function(r){return r.data})},e.fromCells=function(r){return new e(r.map(function(n){return new M0(n.data)}))},tn(e,[{key:"cells",get:function(){return this._cells},set:function(r){this._cells=r}},{key:"length",get:function(){return this.cells.length}}]),e}(cg),ug=function(t){function e(i){var r;return(r=t.call(this)||this)._rows=void 0,r._length=void 0,r.rows=i instanceof Array?i:i instanceof cm?[i]:[],r}return gr(e,t),e.prototype.toArray=function(){return this.rows.map(function(i){return i.toArray()})},e.fromRows=function(i){return new e(i.map(function(r){return cm.fromCells(r.cells)}))},e.fromArray=function(i){return new e((i=function(r){return!r[0]||r[0]instanceof Array?r:[r]}(i)).map(function(r){return new cm(r.map(function(n){return new M0(n)}))}))},tn(e,[{key:"rows",get:function(){return this._rows},set:function(i){this._rows=i}},{key:"length",get:function(){return this._length||this.rows.length},set:function(i){this._length=i}}]),e}(cg),k0=function(){function t(){this.callbacks=void 0}var e=t.prototype;return e.init=function(i){this.callbacks||(this.callbacks={}),i&&!this.callbacks[i]&&(this.callbacks[i]=[])},e.listeners=function(){return this.callbacks},e.on=function(i,r){return this.init(i),this.callbacks[i].push(r),this},e.off=function(i,r){var n=i;return this.init(),this.callbacks[n]&&this.callbacks[n].length!==0?(this.callbacks[n]=this.callbacks[n].filter(function(l){return l!=r}),this):this},e.emit=function(i){var r=arguments,n=i;return this.init(n),this.callbacks[n].length>0&&(this.callbacks[n].forEach(function(l){return l.apply(void 0,[].slice.call(r,1))}),!0)},t}();function Wf(t,e){if(typeof t!=typeof e)return!1;if(t===null&&e===null)return!0;if(typeof t!="object")return t===e;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!Wf(t[i],e[i]))return!1;return!0}if(t.hasOwnProperty("constructor")&&e.hasOwnProperty("constructor")&&t.hasOwnProperty("props")&&e.hasOwnProperty("props")&&t.hasOwnProperty("key")&&e.hasOwnProperty("key")&&t.hasOwnProperty("ref")&&e.hasOwnProperty("ref")&&t.hasOwnProperty("type")&&e.hasOwnProperty("type"))return Wf(t.props,e.props);var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(var l=0,h=r;l<h.length;l++){var a=h[l];if(!e.hasOwnProperty(a)||!Wf(t[a],e[a]))return!1}return!0}(function(t){t[t.Initiator=0]="Initiator",t[t.ServerFilter=1]="ServerFilter",t[t.ServerSort=2]="ServerSort",t[t.ServerLimit=3]="ServerLimit",t[t.Extractor=4]="Extractor",t[t.Transformer=5]="Transformer",t[t.Filter=6]="Filter",t[t.Sort=7]="Sort",t[t.Limit=8]="Limit"})(en||(en={}));var Qs=function(t){function e(r){var n;return(n=t.call(this)||this).id=void 0,n._props=void 0,n._props={},n.id=bA(),r&&n.setProps(r),n}gr(e,t);var i=e.prototype;return i.process=function(){var r=[].slice.call(arguments);this.validateProps instanceof Function&&this.validateProps.apply(this,r),this.emit.apply(this,["beforeProcess"].concat(r));var n=this._process.apply(this,r);return this.emit.apply(this,["afterProcess"].concat(r)),n},i.setProps=function(r){var n=Jt({},this._props,r);return Wf(n,this._props)||(this._props=n,this.emit("propsUpdated",this)),this},tn(e,[{key:"props",get:function(){return this._props}}]),e}(k0),z8=function(t){function e(){return t.apply(this,arguments)||this}return gr(e,t),e.prototype._process=function(i){return this.props.keyword?(r=String(this.props.keyword).trim(),n=this.props.columns,l=this.props.ignoreHiddenColumns,h=i,a=this.props.selector,r=r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),new ug(h.rows.filter(function(g,y){return g.cells.some(function(T,S){if(!T||l&&n&&n[S]&&typeof n[S]=="object"&&n[S].hidden)return!1;var P="";if(typeof a=="function")P=a(T.data,y,S);else if(typeof T.data=="object"){var M=T.data;M&&M.props&&M.props.content&&(P=M.props.content)}else P=String(T.data);return new RegExp(r,"gi").test(P)})}))):i;var r,n,l,h,a},tn(e,[{key:"type",get:function(){return en.Filter}}]),e}(Qs);function Gt(){var t="gridjs";return""+t+[].slice.call(arguments).reduce(function(e,i){return e+"-"+i},"")}function Ri(){return[].slice.call(arguments).map(function(t){return t?t.toString():""}).filter(function(t){return t}).reduce(function(t,e){return(t||"")+" "+e},"").trim()}var Xh,nr,um,Dw,Nw=function(t){function e(){return t.apply(this,arguments)||this}return gr(e,t),e.prototype._process=function(i){if(!this.props.keyword)return i;var r={};return this.props.url&&(r.url=this.props.url(i.url,this.props.keyword)),this.props.body&&(r.body=this.props.body(i.body,this.props.keyword)),Jt({},i,r)},tn(e,[{key:"type",get:function(){return en.ServerFilter}}]),e}(Qs),Oh=0,TA=[],Hf=[],Lw=Vt.__b,Bw=Vt.__r,zw=Vt.diffed,Uw=Vt.__c,Vw=Vt.unmount;function hg(t,e){Vt.__h&&Vt.__h(nr,t,Oh||e),Oh=0;var i=nr.__H||(nr.__H={__:[],__h:[]});return t>=i.__.length&&i.__.push({__V:Hf}),i.__[t]}function xa(t){return Oh=1,function(e,i,r){var n=hg(Xh++,2);if(n.t=e,!n.__c&&(n.__=[jw(void 0,i),function(h){var a=n.__N?n.__N[0]:n.__[0],g=n.t(a,h);a!==g&&(n.__N=[g,n.__[1]],n.__c.setState({}))}],n.__c=nr,!nr.u)){nr.u=!0;var l=nr.shouldComponentUpdate;nr.shouldComponentUpdate=function(h,a,g){if(!n.__c.__H)return!0;var y=n.__c.__H.__.filter(function(S){return S.__c});if(y.every(function(S){return!S.__N}))return!l||l.call(this,h,a,g);var T=!1;return y.forEach(function(S){if(S.__N){var P=S.__[0];S.__=S.__N,S.__N=void 0,P!==S.__[0]&&(T=!0)}}),!(!T&&n.__c.props===h)&&(!l||l.call(this,h,a,g))}}return n.__N||n.__}(jw,t)}function Dn(t,e){var i=hg(Xh++,3);!Vt.__s&&EA(i.__H,e)&&(i.__=t,i.i=e,nr.__H.__h.push(i))}function Zh(t){return Oh=5,SA(function(){return{current:t}},[])}function SA(t,e){var i=hg(Xh++,7);return EA(i.__H,e)?(i.__V=t(),i.i=e,i.__h=t,i.__V):i.__}function U8(){for(var t;t=TA.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(qf),t.__H.__h.forEach(by),t.__H.__h=[]}catch(e){t.__H.__h=[],Vt.__e(e,t.__v)}}Vt.__b=function(t){nr=null,Lw&&Lw(t)},Vt.__r=function(t){Bw&&Bw(t),Xh=0;var e=(nr=t.__c).__H;e&&(um===nr?(e.__h=[],nr.__h=[],e.__.forEach(function(i){i.__N&&(i.__=i.__N),i.__V=Hf,i.__N=i.i=void 0})):(e.__h.forEach(qf),e.__h.forEach(by),e.__h=[])),um=nr},Vt.diffed=function(t){zw&&zw(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(TA.push(e)!==1&&Dw===Vt.requestAnimationFrame||((Dw=Vt.requestAnimationFrame)||V8)(U8)),e.__H.__.forEach(function(i){i.i&&(i.__H=i.i),i.__V!==Hf&&(i.__=i.__V),i.i=void 0,i.__V=Hf})),um=nr=null},Vt.__c=function(t,e){e.some(function(i){try{i.__h.forEach(qf),i.__h=i.__h.filter(function(r){return!r.__||by(r)})}catch(r){e.some(function(n){n.__h&&(n.__h=[])}),e=[],Vt.__e(r,i.__v)}}),Uw&&Uw(t,e)},Vt.unmount=function(t){Vw&&Vw(t);var e,i=t.__c;i&&i.__H&&(i.__H.__.forEach(function(r){try{qf(r)}catch(n){e=n}}),i.__H=void 0,e&&Vt.__e(e,i.__v))};var $w=typeof requestAnimationFrame=="function";function V8(t){var e,i=function(){clearTimeout(r),$w&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(i,100);$w&&(e=requestAnimationFrame(i))}function qf(t){var e=nr,i=t.__c;typeof i=="function"&&(t.__c=void 0,i()),nr=e}function by(t){var e=nr;t.__c=t.__(),nr=e}function EA(t,e){return!t||t.length!==e.length||e.some(function(i,r){return i!==t[r]})}function jw(t,e){return typeof e=="function"?e(t):e}function wn(){return function(t){var e=nr.context[t.__c],i=hg(Xh++,9);return i.c=t,e?(i.__==null&&(i.__=!0,e.sub(nr)),e.props.value):t.__}(IA)}var $8={search:{placeholder:"Type a keyword..."},sort:{sortAsc:"Sort column ascending",sortDesc:"Sort column descending"},pagination:{previous:"Previous",next:"Next",navigate:function(t,e){return"Page "+t+" of "+e},page:function(t){return"Page "+t},showing:"Showing",of:"of",to:"to",results:"results"},loading:"Loading...",noRecordsFound:"No matching records found",error:"An error happened while fetching the data"},j8=function(){function t(i){this._language=void 0,this._defaultLanguage=void 0,this._language=i,this._defaultLanguage=$8}var e=t.prototype;return e.getString=function(i,r){if(!r||!i)return null;var n=i.split("."),l=n[0];if(r[l]){var h=r[l];return typeof h=="string"?function(){return h}:typeof h=="function"?h:this.getString(n.slice(1).join("."),h)}return null},e.translate=function(i){var r,n=this.getString(i,this._language);return(r=n||this.getString(i,this._defaultLanguage))?r.apply(void 0,[].slice.call(arguments,1)):i},t}();function dg(){var t=wn();return function(e){var i;return(i=t.translator).translate.apply(i,[e].concat([].slice.call(arguments,1)))}}var Ww=function(t){return function(e){return Jt({},e,{search:{keyword:t}})}};function Uc(){return wn().store}function Gs(t){var e=Uc(),i=xa(t(e.getState())),r=i[0],n=i[1];return Dn(function(){return e.subscribe(function(){var l=t(e.getState());r!==l&&n(l)})},[]),r}function W8(){var t,e=xa(void 0),i=e[0],r=e[1],n=wn(),l=n.search,h=dg(),a=Uc().dispatch,g=Gs(function(M){return M.search});Dn(function(){i&&i.setProps({keyword:g==null?void 0:g.keyword})},[g,i]),Dn(function(){r(l.server?new Nw({keyword:l.keyword,url:l.server.url,body:l.server.body}):new z8({keyword:l.keyword,columns:n.header&&n.header.columns,ignoreHiddenColumns:l.ignoreHiddenColumns||l.ignoreHiddenColumns===void 0,selector:l.selector})),l.keyword&&a(Ww(l.keyword))},[l]),Dn(function(){if(i)return n.pipeline.register(i),function(){return n.pipeline.unregister(i)}},[n,i]);var y,T,S,P=function(M,B){return Oh=8,SA(function(){return M},B)}((y=function(M){M.target instanceof HTMLInputElement&&a(Ww(M.target.value))},T=i instanceof Nw?l.debounceTimeout||250:0,function(){var M=arguments;return new Promise(function(B){S&&clearTimeout(S),S=setTimeout(function(){return B(y.apply(void 0,[].slice.call(M)))},T)})}),[l,i]);return vt("div",{className:Gt(Ri("search",(t=n.className)==null?void 0:t.search))},vt("input",{type:"search",placeholder:h("search.placeholder"),"aria-label":h("search.placeholder"),onInput:P,className:Ri(Gt("input"),Gt("search","input")),defaultValue:(g==null?void 0:g.keyword)||""}))}var Hw=function(t){function e(){return t.apply(this,arguments)||this}gr(e,t);var i=e.prototype;return i.validateProps=function(){if(isNaN(Number(this.props.limit))||isNaN(Number(this.props.page)))throw Error("Invalid parameters passed")},i._process=function(r){var n=this.props.page;return new ug(r.rows.slice(n*this.props.limit,(n+1)*this.props.limit))},tn(e,[{key:"type",get:function(){return en.Limit}}]),e}(Qs),qw=function(t){function e(){return t.apply(this,arguments)||this}return gr(e,t),e.prototype._process=function(i){var r={};return this.props.url&&(r.url=this.props.url(i.url,this.props.page,this.props.limit)),this.props.body&&(r.body=this.props.body(i.body,this.props.page,this.props.limit)),Jt({},i,r)},tn(e,[{key:"type",get:function(){return en.ServerLimit}}]),e}(Qs);function H8(){var t=wn(),e=t.pagination,i=e.server,r=e.summary,n=r===void 0||r,l=e.nextButton,h=l===void 0||l,a=e.prevButton,g=a===void 0||a,y=e.buttonsCount,T=y===void 0?3:y,S=e.limit,P=S===void 0?10:S,M=e.page,B=M===void 0?0:M,j=e.resetPageOnUpdate,Z=j===void 0||j,G=Zh(null),fe=xa(B),re=fe[0],ue=fe[1],Me=xa(0),Oe=Me[0],$e=Me[1],ke=dg();Dn(function(){return i?(G.current=new qw({limit:P,page:re,url:i.url,body:i.body}),t.pipeline.register(G.current)):(G.current=new Hw({limit:P,page:re}),t.pipeline.register(G.current)),G.current instanceof qw?t.pipeline.on("afterProcess",function(tt){return $e(tt.length)}):G.current instanceof Hw&&G.current.on("beforeProcess",function(tt){return $e(tt.length)}),t.pipeline.on("updated",je),t.pipeline.on("error",function(){$e(0),ue(0)}),function(){t.pipeline.unregister(G.current),t.pipeline.off("updated",je)}},[]);var je=function(tt){Z&&tt!==G.current&&(ue(0),G.current.props.page!==0&&G.current.setProps({page:0}))},Ue=function(){return Math.ceil(Oe/P)},ct=function(tt){if(tt>=Ue()||tt<0||tt===re)return null;ue(tt),G.current.setProps({page:tt})};return vt("div",{className:Ri(Gt("pagination"),t.className.pagination)},vt(Ks,null,n&&Oe>0&&vt("div",{role:"status","aria-live":"polite",className:Ri(Gt("summary"),t.className.paginationSummary),title:ke("pagination.navigate",re+1,Ue())},ke("pagination.showing")," ",vt("b",null,ke(""+(re*P+1)))," ",ke("pagination.to")," ",vt("b",null,ke(""+Math.min((re+1)*P,Oe)))," ",ke("pagination.of")," ",vt("b",null,ke(""+Oe))," ",ke("pagination.results"))),vt("div",{className:Gt("pages")},g&&vt("button",{tabIndex:0,role:"button",disabled:re===0,onClick:function(){return ct(re-1)},title:ke("pagination.previous"),"aria-label":ke("pagination.previous"),className:Ri(t.className.paginationButton,t.className.paginationButtonPrev)},ke("pagination.previous")),function(){if(T<=0)return null;var tt=Math.min(Ue(),T),pt=Math.min(re,Math.floor(tt/2));return re+Math.floor(tt/2)>=Ue()&&(pt=tt-(Ue()-re)),vt(Ks,null,Ue()>tt&&re-pt>0&&vt(Ks,null,vt("button",{tabIndex:0,role:"button",onClick:function(){return ct(0)},title:ke("pagination.firstPage"),"aria-label":ke("pagination.firstPage"),className:t.className.paginationButton},ke("1")),vt("button",{tabIndex:-1,className:Ri(Gt("spread"),t.className.paginationButton)},"...")),Array.from(Array(tt).keys()).map(function(ot){return re+(ot-pt)}).map(function(ot){return vt("button",{tabIndex:0,role:"button",onClick:function(){return ct(ot)},className:Ri(re===ot?Ri(Gt("currentPage"),t.className.paginationButtonCurrent):null,t.className.paginationButton),title:ke("pagination.page",ot+1),"aria-label":ke("pagination.page",ot+1)},ke(""+(ot+1)))}),Ue()>tt&&Ue()>re+pt+1&&vt(Ks,null,vt("button",{tabIndex:-1,className:Ri(Gt("spread"),t.className.paginationButton)},"..."),vt("button",{tabIndex:0,role:"button",onClick:function(){return ct(Ue()-1)},title:ke("pagination.page",Ue()),"aria-label":ke("pagination.page",Ue()),className:t.className.paginationButton},ke(""+Ue()))))}(),h&&vt("button",{tabIndex:0,role:"button",disabled:Ue()===re+1||Ue()===0,onClick:function(){return ct(re+1)},title:ke("pagination.next"),"aria-label":ke("pagination.next"),className:Ri(t.className.paginationButton,t.className.paginationButtonNext)},ke("pagination.next"))))}function q8(t,e){return typeof t=="string"?t.indexOf("%")>-1?e/100*parseInt(t,10):parseInt(t,10):t}function hm(t){return t?Math.floor(t)+"px":""}function X8(t){var e=t.tableRef.cloneNode(!0);return e.style.position="absolute",e.style.width="100%",e.style.zIndex="-2147483640",e.style.visibility="hidden",vt("div",{ref:function(i){i&&i.appendChild(e)}})}function Z8(t){if(!t)return"";var e=t.split(" ");return e.length===1&&/([a-z][A-Z])+/g.test(t)?t:e.map(function(i,r){return r==0?i.toLowerCase():i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()}).join("")}var ll,cs=new(function(){function t(){}var e=t.prototype;return e.format=function(i,r){return"[Grid.js] ["+r.toUpperCase()+"]: "+i},e.error=function(i,r){r===void 0&&(r=!1);var n=this.format(i,"error");if(r)throw Error(n);console.error(n)},e.warn=function(i){console.warn(this.format(i,"warn"))},e.info=function(i){console.info(this.format(i,"info"))},t}());(function(t){t[t.Header=0]="Header",t[t.Footer=1]="Footer",t[t.Cell=2]="Cell"})(ll||(ll={}));var Xw=function(){function t(){this.plugins=void 0,this.plugins=[]}var e=t.prototype;return e.get=function(i){return this.plugins.find(function(r){return r.id===i})},e.add=function(i){return i.id?this.get(i.id)?(cs.error("Duplicate plugin ID: "+i.id),this):(this.plugins.push(i),this):(cs.error("Plugin ID cannot be empty"),this)},e.remove=function(i){var r=this.get(i);return r&&this.plugins.splice(this.plugins.indexOf(r),1),this},e.list=function(i){var r;return r=i!=null||i!=null?this.plugins.filter(function(n){return n.position===i}):this.plugins,r.sort(function(n,l){return n.order&&l.order?n.order-l.order:1})},t}();function fg(t){var e=this,i=wn();if(t.pluginId){var r=i.plugin.get(t.pluginId);return r?vt(Ks,{},vt(r.component,Jt({plugin:r},t.props))):null}return t.position!==void 0?vt(Ks,{},i.plugin.list(t.position).map(function(n){return vt(n.component,Jt({plugin:n},e.props.props))})):null}var Ec=function(t){function e(){var r;return(r=t.call(this)||this)._columns=void 0,r._columns=[],r}gr(e,t);var i=e.prototype;return i.adjustWidth=function(r,n,l){var h=r.container,a=r.autoWidth;if(!h)return this;var g=h.clientWidth,y={};n.current&&a&&(dh(vt(X8,{tableRef:n.current}),l.current),y=function(M){var B=M.querySelector("table");if(!B)return{};var j=B.className,Z=B.style.cssText;B.className=j+" "+Gt("shadowTable"),B.style.tableLayout="auto",B.style.width="auto",B.style.padding="0",B.style.margin="0",B.style.border="none",B.style.outline="none";var G=Array.from(B.parentNode.querySelectorAll("thead th")).reduce(function(fe,re){var ue;return re.style.width=re.clientWidth+"px",Jt(((ue={})[re.getAttribute("data-column-id")]={minWidth:re.clientWidth},ue),fe)},{});return B.className=j,B.style.cssText=Z,B.style.tableLayout="auto",Array.from(B.parentNode.querySelectorAll("thead th")).reduce(function(fe,re){return fe[re.getAttribute("data-column-id")].width=re.clientWidth,fe},G)}(l.current));for(var T,S=yn(e.tabularFormat(this.columns).reduce(function(M,B){return M.concat(B)},[]));!(T=S()).done;){var P=T.value;P.columns&&P.columns.length>0||(!P.width&&a?P.id in y&&(P.width=hm(y[P.id].width),P.minWidth=hm(y[P.id].minWidth)):P.width=hm(q8(P.width,g)))}return n.current&&a&&dh(null,l.current),this},i.setSort=function(r,n){for(var l,h=yn(n||this.columns||[]);!(l=h()).done;){var a=l.value;a.columns&&a.columns.length>0?a.sort=void 0:a.sort===void 0&&r?a.sort={}:a.sort?typeof a.sort=="object"&&(a.sort=Jt({},a.sort)):a.sort=void 0,a.columns&&this.setSort(r,a.columns)}},i.setResizable=function(r,n){for(var l,h=yn(n||this.columns||[]);!(l=h()).done;){var a=l.value;a.resizable===void 0&&(a.resizable=r),a.columns&&this.setResizable(r,a.columns)}},i.setID=function(r){for(var n,l=yn(r||this.columns||[]);!(n=l()).done;){var h=n.value;h.id||typeof h.name!="string"||(h.id=Z8(h.name)),h.id||cs.error('Could not find a valid ID for one of the columns. Make sure a valid "id" is set for all columns.'),h.columns&&this.setID(h.columns)}},i.populatePlugins=function(r,n){for(var l,h=yn(n);!(l=h()).done;){var a=l.value;a.plugin!==void 0&&r.add(Jt({id:a.id},a.plugin,{position:ll.Cell}))}},e.fromColumns=function(r){for(var n,l=new e,h=yn(r);!(n=h()).done;){var a=n.value;if(typeof a=="string"||uA(a))l.columns.push({name:a});else if(typeof a=="object"){var g=a;g.columns&&(g.columns=e.fromColumns(g.columns).columns),typeof g.plugin=="object"&&g.data===void 0&&(g.data=null),l.columns.push(a)}}return l},e.createFromConfig=function(r){var n=new e;return r.from?n.columns=e.fromHTMLTable(r.from).columns:r.columns?n.columns=e.fromColumns(r.columns).columns:!r.data||typeof r.data[0]!="object"||r.data[0]instanceof Array||(n.columns=Object.keys(r.data[0]).map(function(l){return{name:l}})),n.columns.length?(n.setID(),n.setSort(r.sort),n.setResizable(r.resizable),n.populatePlugins(r.plugin,n.columns),n):null},e.fromHTMLTable=function(r){for(var n,l=new e,h=yn(r.querySelector("thead").querySelectorAll("th"));!(n=h()).done;){var a=n.value;l.columns.push({name:a.innerHTML,width:a.width})}return l},e.tabularFormat=function(r){var n=[],l=r||[],h=[];if(l&&l.length){n.push(l);for(var a,g=yn(l);!(a=g()).done;){var y=a.value;y.columns&&y.columns.length&&(h=h.concat(y.columns))}h.length&&(n=n.concat(this.tabularFormat(h)))}return n},e.leafColumns=function(r){var n=[],l=r||[];if(l&&l.length)for(var h,a=yn(l);!(h=a()).done;){var g=h.value;g.columns&&g.columns.length!==0||n.push(g),g.columns&&(n=n.concat(this.leafColumns(g.columns)))}return n},e.maximumDepth=function(r){return this.tabularFormat([r]).length-1},tn(e,[{key:"columns",get:function(){return this._columns},set:function(r){this._columns=r}},{key:"visibleColumns",get:function(){return this._columns.filter(function(r){return!r.hidden})}}]),e}(cg),AA=function(){},Zw=function(t){function e(r){var n;return(n=t.call(this)||this).data=void 0,n.set(r),n}gr(e,t);var i=e.prototype;return i.get=function(){try{return Promise.resolve(this.data()).then(function(r){return{data:r,total:r.length}})}catch(r){return Promise.reject(r)}},i.set=function(r){return r instanceof Array?this.data=function(){return r}:r instanceof Function&&(this.data=r),this},e}(AA),PA=function(t){function e(r){var n;return(n=t.call(this)||this).options=void 0,n.options=r,n}gr(e,t);var i=e.prototype;return i.handler=function(r){return typeof this.options.handle=="function"?this.options.handle(r):r.ok?r.json():(cs.error("Could not fetch data: "+r.status+" - "+r.statusText,!0),null)},i.get=function(r){var n=Jt({},this.options,r);return typeof n.data=="function"?n.data(n):fetch(n.url,n).then(this.handler.bind(this)).then(function(l){return{data:n.then(l),total:typeof n.total=="function"?n.total(l):void 0}})},e}(AA),Y8=function(){function t(){}return t.createFromConfig=function(e){var i=null;return e.data&&(i=new Zw(e.data)),e.from&&(i=new Zw(this.tableElementToArray(e.from)),e.from.style.display="none"),e.server&&(i=new PA(e.server)),i||cs.error("Could not determine the storage type",!0),i},t.tableElementToArray=function(e){for(var i,r,n=[],l=yn(e.querySelector("tbody").querySelectorAll("tr"));!(i=l()).done;){for(var h,a=[],g=yn(i.value.querySelectorAll("td"));!(h=g()).done;){var y=h.value;y.childNodes.length===1&&y.childNodes[0].nodeType===Node.TEXT_NODE?a.push((r=y.innerHTML,new DOMParser().parseFromString(r,"text/html").documentElement.textContent)):a.push(wA(y.innerHTML))}n.push(a)}return n},t}(),Yw=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function vn(t,e,i){if(!t.s){if(i instanceof yc){if(!i.s)return void(i.o=vn.bind(null,t,e));1&e&&(e=i.s),i=i.v}if(i&&i.then)return void i.then(vn.bind(null,t,e),vn.bind(null,t,2));t.s=e,t.v=i;var r=t.o;r&&r(t)}}var yc=function(){function t(){}return t.prototype.then=function(e,i){var r=new t,n=this.s;if(n){var l=1&n?e:i;if(l){try{vn(r,1,l(this.v))}catch(h){vn(r,2,h)}return r}return this}return this.o=function(h){try{var a=h.v;1&h.s?vn(r,1,e?e(a):a):i?vn(r,1,i(a)):vn(r,2,a)}catch(g){vn(r,2,g)}},r},t}();function Kw(t){return t instanceof yc&&1&t.s}var K8=function(t){function e(r){var n;return(n=t.call(this)||this)._steps=new Map,n.cache=new Map,n.lastProcessorIndexUpdated=-1,r&&r.forEach(function(l){return n.register(l)}),n}gr(e,t);var i=e.prototype;return i.clearCache=function(){this.cache=new Map,this.lastProcessorIndexUpdated=-1},i.register=function(r,n){if(n===void 0&&(n=null),!r)throw Error("Processor is not defined");if(r.type===null)throw Error("Processor type is not defined");if(this.findProcessorIndexByID(r.id)>-1)throw Error("Processor ID "+r.id+" is already defined");return r.on("propsUpdated",this.processorPropsUpdated.bind(this)),this.addProcessorByPriority(r,n),this.afterRegistered(r),r},i.tryRegister=function(r,n){n===void 0&&(n=null);try{return this.register(r,n)}catch{}},i.unregister=function(r){if(r&&this.findProcessorIndexByID(r.id)!==-1){var n=this._steps.get(r.type);n&&n.length&&(this._steps.set(r.type,n.filter(function(l){return l!=r})),this.emit("updated",r))}},i.addProcessorByPriority=function(r,n){var l=this._steps.get(r.type);if(!l){var h=[];this._steps.set(r.type,h),l=h}if(n===null||n<0)l.push(r);else if(l[n]){var a=l.slice(0,n-1),g=l.slice(n+1);this._steps.set(r.type,a.concat(r).concat(g))}else l[n]=r},i.getStepsByType=function(r){return this.steps.filter(function(n){return n.type===r})},i.getSortedProcessorTypes=function(){return Object.keys(en).filter(function(r){return!isNaN(Number(r))}).map(function(r){return Number(r)})},i.process=function(r){try{var n=function(T){return l.lastProcessorIndexUpdated=a.length,l.emit("afterProcess",g),g},l=this,h=l.lastProcessorIndexUpdated,a=l.steps,g=r,y=function(T,S){try{var P=function(M,B,j){if(typeof M[Yw]=="function"){var Z,G,fe,re=M[Yw]();if(function $e(ke){try{for(;!(Z=re.next()).done;)if((ke=B(Z.value))&&ke.then){if(!Kw(ke))return void ke.then($e,fe||(fe=vn.bind(null,G=new yc,2)));ke=ke.v}G?vn(G,1,ke):G=ke}catch(je){vn(G||(G=new yc),2,je)}}(),re.return){var ue=function($e){try{Z.done||re.return()}catch{}return $e};if(G&&G.then)return G.then(ue,function($e){throw ue($e)});ue()}return G}if(!("length"in M))throw new TypeError("Object is not iterable");for(var Me=[],Oe=0;Oe<M.length;Oe++)Me.push(M[Oe]);return function($e,ke,je){var Ue,ct,tt=-1;return function pt(ot){try{for(;++tt<$e.length;)if((ot=ke(tt))&&ot.then){if(!Kw(ot))return void ot.then(pt,ct||(ct=vn.bind(null,Ue=new yc,2)));ot=ot.v}Ue?vn(Ue,1,ot):Ue=ot}catch(ei){vn(Ue||(Ue=new yc),2,ei)}}(),Ue}(Me,function($e){return B(Me[$e])})}(a,function(M){var B=l.findProcessorIndexByID(M.id),j=function(){if(B>=h)return Promise.resolve(M.process(g)).then(function(Z){l.cache.set(M.id,g=Z)});g=l.cache.get(M.id)}();if(j&&j.then)return j.then(function(){})})}catch(M){return S(M)}return P&&P.then?P.then(void 0,S):P}(0,function(T){throw cs.error(T),l.emit("error",g),T});return Promise.resolve(y&&y.then?y.then(n):n())}catch(T){return Promise.reject(T)}},i.findProcessorIndexByID=function(r){return this.steps.findIndex(function(n){return n.id==r})},i.setLastProcessorIndex=function(r){var n=this.findProcessorIndexByID(r.id);this.lastProcessorIndexUpdated>n&&(this.lastProcessorIndexUpdated=n)},i.processorPropsUpdated=function(r){this.setLastProcessorIndex(r),this.emit("propsUpdated"),this.emit("updated",r)},i.afterRegistered=function(r){this.setLastProcessorIndex(r),this.emit("afterRegister"),this.emit("updated",r)},tn(e,[{key:"steps",get:function(){for(var r,n=[],l=yn(this.getSortedProcessorTypes());!(r=l()).done;){var h=this._steps.get(r.value);h&&h.length&&(n=n.concat(h))}return n.filter(function(a){return a})}}]),e}(k0),G8=function(t){function e(){return t.apply(this,arguments)||this}return gr(e,t),e.prototype._process=function(i){try{return Promise.resolve(this.props.storage.get(i))}catch(r){return Promise.reject(r)}},tn(e,[{key:"type",get:function(){return en.Extractor}}]),e}(Qs),J8=function(t){function e(){return t.apply(this,arguments)||this}return gr(e,t),e.prototype._process=function(i){var r=ug.fromArray(i.data);return r.length=i.total,r},tn(e,[{key:"type",get:function(){return en.Transformer}}]),e}(Qs),Q8=function(t){function e(){return t.apply(this,arguments)||this}return gr(e,t),e.prototype._process=function(){return Object.entries(this.props.serverStorageOptions).filter(function(i){return typeof i[1]!="function"}).reduce(function(i,r){var n;return Jt({},i,((n={})[r[0]]=r[1],n))},{})},tn(e,[{key:"type",get:function(){return en.Initiator}}]),e}(Qs),e$=function(t){function e(){return t.apply(this,arguments)||this}gr(e,t);var i=e.prototype;return i.castData=function(r){if(!r||!r.length)return[];if(!this.props.header||!this.props.header.columns)return r;var n=Ec.leafColumns(this.props.header.columns);return r[0]instanceof Array?r.map(function(l){var h=0;return n.map(function(a,g){return a.data!==void 0?(h++,typeof a.data=="function"?a.data(l):a.data):l[g-h]})}):typeof r[0]!="object"||r[0]instanceof Array?[]:r.map(function(l){return n.map(function(h,a){return h.data!==void 0?typeof h.data=="function"?h.data(l):h.data:h.id?l[h.id]:(cs.error("Could not find the correct cell for column at position "+a+`.
                          Make sure either 'id' or 'selector' is defined for all columns.`),null)})})},i._process=function(r){return{data:this.castData(r.data),total:r.total}},tn(e,[{key:"type",get:function(){return en.Transformer}}]),e}(Qs),t$=function(){function t(){}return t.createFromConfig=function(e){var i=new K8;return e.storage instanceof PA&&i.register(new Q8({serverStorageOptions:e.server})),i.register(new G8({storage:e.storage})),i.register(new e$({header:e.header})),i.register(new J8),i},t}(),i$=function(t){var e=this;this.state=void 0,this.listeners=[],this.isDispatching=!1,this.getState=function(){return e.state},this.getListeners=function(){return e.listeners},this.dispatch=function(i){if(typeof i!="function")throw new Error("Reducer is not a function");if(e.isDispatching)throw new Error("Reducers may not dispatch actions");e.isDispatching=!0;var r=e.state;try{e.state=i(e.state)}finally{e.isDispatching=!1}for(var n,l=yn(e.listeners);!(n=l()).done;)(0,n.value)(e.state,r);return e.state},this.subscribe=function(i){if(typeof i!="function")throw new Error("Listener is not a function");return e.listeners=[].concat(e.listeners,[i]),function(){return e.listeners=e.listeners.filter(function(r){return r!==i})}},this.state=t},IA=function(t,e){var i={__c:e="__cC"+hA++,__:null,Consumer:function(r,n){return r.children(n)},Provider:function(r){var n,l;return this.getChildContext||(n=[],(l={})[e]=this,this.getChildContext=function(){return l},this.shouldComponentUpdate=function(h){this.props.value!==h.value&&n.some(vy)},this.sub=function(h){n.push(h);var a=h.componentWillUnmount;h.componentWillUnmount=function(){n.splice(n.indexOf(h),1),a&&a.call(h)}}),r.children}};return i.Provider.__=i.Consumer.contextType=i}(),r$=function(){function t(){Object.assign(this,t.defaultConfig())}var e=t.prototype;return e.assign=function(i){return Object.assign(this,i)},e.update=function(i){return i?(this.assign(t.fromPartialConfig(Jt({},this,i))),this):this},t.defaultConfig=function(){return{store:new i$({status:Fn.Init,header:void 0,data:null}),plugin:new Xw,tableRef:{current:null},width:"100%",height:"auto",processingThrottleMs:100,autoWidth:!0,style:{},className:{}}},t.fromPartialConfig=function(i){var r=new t().assign(i);return typeof i.sort=="boolean"&&i.sort&&r.assign({sort:{multiColumn:!0}}),r.assign({header:Ec.createFromConfig(r)}),r.assign({storage:Y8.createFromConfig(r)}),r.assign({pipeline:t$.createFromConfig(r)}),r.assign({translator:new j8(r.language)}),r.plugin=new Xw,r.search&&r.plugin.add({id:"search",position:ll.Header,component:W8}),r.pagination&&r.plugin.add({id:"pagination",position:ll.Footer,component:H8}),r.plugins&&r.plugins.forEach(function(n){return r.plugin.add(n)}),r},t}();function CA(t){var e,i=wn();return vt("td",Jt({role:t.role,colSpan:t.colSpan,"data-column-id":t.column&&t.column.id,className:Ri(Gt("td"),t.className,i.className.td),style:Jt({},t.style,i.style.td),onClick:function(r){t.messageCell||i.eventEmitter.emit("cellClick",r,t.cell,t.column,t.row)}},(e=t.column)?typeof e.attributes=="function"?e.attributes(t.cell.data,t.row,t.column):e.attributes:{}),t.column&&typeof t.column.formatter=="function"?t.column.formatter(t.cell.data,t.row,t.column):t.column&&t.column.plugin?vt(fg,{pluginId:t.column.id,props:{column:t.column,cell:t.cell,row:t.row}}):t.cell.data)}function O0(t){var e=wn(),i=Gs(function(r){return r.header});return vt("tr",{className:Ri(Gt("tr"),e.className.tr),onClick:function(r){t.messageRow||e.eventEmitter.emit("rowClick",r,t.row)}},t.children?t.children:t.row.cells.map(function(r,n){var l=function(h){if(i){var a=Ec.leafColumns(i.columns);if(a)return a[h]}return null}(n);return l&&l.hidden?null:vt(CA,{key:r.id,cell:r,row:t.row,column:l})}))}function dm(t){return vt(O0,{messageRow:!0},vt(CA,{role:"alert",colSpan:t.colSpan,messageCell:!0,cell:new M0(t.message),className:Ri(Gt("message"),t.className?t.className:null)}))}function n$(){var t=wn(),e=Gs(function(h){return h.data}),i=Gs(function(h){return h.status}),r=Gs(function(h){return h.header}),n=dg(),l=function(){return r?r.visibleColumns.length:0};return vt("tbody",{className:Ri(Gt("tbody"),t.className.tbody)},e&&e.rows.map(function(h){return vt(O0,{key:h.id,row:h})}),i===Fn.Loading&&(!e||e.length===0)&&vt(dm,{message:n("loading"),colSpan:l(),className:Ri(Gt("loading"),t.className.loading)}),i===Fn.Rendered&&e&&e.length===0&&vt(dm,{message:n("noRecordsFound"),colSpan:l(),className:Ri(Gt("notfound"),t.className.notfound)}),i===Fn.Error&&vt(dm,{message:n("error"),colSpan:l(),className:Ri(Gt("error"),t.className.error)}))}var s$=function(t){function e(){return t.apply(this,arguments)||this}gr(e,t);var i=e.prototype;return i.validateProps=function(){for(var r,n=yn(this.props.columns);!(r=n()).done;){var l=r.value;l.direction===void 0&&(l.direction=1),l.direction!==1&&l.direction!==-1&&cs.error("Invalid sort direction "+l.direction)}},i.compare=function(r,n){return r>n?1:r<n?-1:0},i.compareWrapper=function(r,n){for(var l,h=0,a=yn(this.props.columns);!(l=a()).done;){var g=l.value;if(h!==0)break;var y=r.cells[g.index].data,T=n.cells[g.index].data;h|=typeof g.compare=="function"?g.compare(y,T)*g.direction:this.compare(y,T)*g.direction}return h},i._process=function(r){var n=[].concat(r.rows);n.sort(this.compareWrapper.bind(this));var l=new ug(n);return l.length=r.length,l},tn(e,[{key:"type",get:function(){return en.Sort}}]),e}(Qs),Gw=function(t,e,i,r){return function(n){var l,h=(l=n.sort)!=null&&l.columns?n.sort.columns.map(function(j){return Jt({},j)}):[],a=h.length,g=h.find(function(j){return j.index===t}),y=!1,T=!1,S=!1,P=!1;if(g!==void 0?i?g.direction===-1?S=!0:P=!0:a===1?P=!0:a>1&&(T=!0,y=!0):a===0?y=!0:a>0&&!i?(y=!0,T=!0):a>0&&i&&(y=!0),T&&(h=[]),y)h.push({index:t,direction:e,compare:r});else if(P){var M=h.indexOf(g);h[M].direction=e}else if(S){var B=h.indexOf(g);h.splice(B,1)}return Jt({},n,{sort:{columns:h}})}},RA=function(t,e,i){return function(r){var n=(r.sort?[].concat(r.sort.columns):[]).find(function(l){return l.index===t});return Jt({},r,n?Gw(t,n.direction===1?-1:1,e,i)(r):Gw(t,1,e,i)(r))}},o$=function(t){function e(){return t.apply(this,arguments)||this}return gr(e,t),e.prototype._process=function(i){var r={};return this.props.url&&(r.url=this.props.url(i.url,this.props.columns)),this.props.body&&(r.body=this.props.body(i.body,this.props.columns)),Jt({},i,r)},tn(e,[{key:"type",get:function(){return en.ServerSort}}]),e}(Qs);function a$(t){var e=wn(),i=Uc().dispatch,r=dg(),n=xa(0),l=n[0],h=n[1],a=e.sort,g=Gs(function(S){return S.sort}),y=typeof(a==null?void 0:a.server)=="object"?en.ServerSort:en.Sort,T=function(){var S=e.pipeline.getStepsByType(y);if(S.length)return S[0]};return Dn(function(){var S=T()||(y===en.ServerSort?new o$(Jt({columns:g?g.columns:[]},a.server)):new s$({columns:g?g.columns:[]}));return e.pipeline.tryRegister(S),function(){return e.pipeline.unregister(S)}},[e]),Dn(function(){if(g){var S,P=g.columns.find(function(M){return M.index===t.index});P?(l===0&&(P.direction=(S=t.direction)!=null?S:1),h(P.direction)):h(0)}},[g]),Dn(function(){var S=T();S&&g&&S.setProps({columns:g.columns})},[g]),vt("button",{tabIndex:-1,"aria-label":r("sort.sort"+(l===1?"Desc":"Asc")),title:r("sort.sort"+(l===1?"Desc":"Asc")),className:Ri(Gt("sort"),Gt("sort",function(S){return S===1?"asc":S===-1?"desc":"neutral"}(l)),e.className.sort),onClick:function(S){S.preventDefault(),S.stopPropagation(),i(RA(t.index,S.shiftKey===!0&&a.multiColumn,t.compare))}})}var MA=function(t,e){var i;e===void 0&&(e=100);var r=Date.now(),n=function(){r=Date.now(),t.apply(void 0,[].slice.call(arguments))};return function(){var l=[].slice.call(arguments),h=Date.now(),a=h-r;a>=e?n.apply(void 0,l):(i&&clearTimeout(i),i=setTimeout(function(){n.apply(void 0,l),i=null},e-a))}};function l$(t){var e,i=function(h){return h instanceof MouseEvent?Math.floor(h.pageX):Math.floor(h.changedTouches[0].pageX)},r=function(h){h.stopPropagation();var a=parseInt(t.thRef.current.style.width,10)-i(h);e=MA(function(g){return n(g,a)},10),document.addEventListener("mouseup",l),document.addEventListener("touchend",l),document.addEventListener("mousemove",e),document.addEventListener("touchmove",e)},n=function(h,a){h.stopPropagation();var g=t.thRef.current;a+i(h)>=parseInt(g.style.minWidth,10)&&(g.style.width=a+i(h)+"px")},l=function h(a){a.stopPropagation(),document.removeEventListener("mouseup",h),document.removeEventListener("mousemove",e),document.removeEventListener("touchmove",e),document.removeEventListener("touchend",h)};return vt("div",{className:Ri(Gt("th"),Gt("resizable")),onMouseDown:r,onTouchStart:r,onClick:function(h){return h.stopPropagation()}})}function c$(t){var e=wn(),i=Zh(null),r=xa({}),n=r[0],l=r[1],h=Uc().dispatch;Dn(function(){if(e.fixedHeader&&i.current){var T=i.current.offsetTop;typeof T=="number"&&l({top:T})}},[i]);var a,g=function(){return t.column.sort!=null},y=function(T){T.stopPropagation(),g()&&h(RA(t.index,T.shiftKey===!0&&e.sort.multiColumn,t.column.sort.compare))};return vt("th",Jt({ref:i,"data-column-id":t.column&&t.column.id,className:Ri(Gt("th"),g()?Gt("th","sort"):null,e.fixedHeader?Gt("th","fixed"):null,e.className.th),onClick:y,style:Jt({},e.style.th,{minWidth:t.column.minWidth,width:t.column.width},n,t.style),onKeyDown:function(T){g()&&T.which===13&&y(T)},rowSpan:t.rowSpan>1?t.rowSpan:void 0,colSpan:t.colSpan>1?t.colSpan:void 0},(a=t.column)?typeof a.attributes=="function"?a.attributes(null,null,t.column):a.attributes:{},g()?{tabIndex:0}:{}),vt("div",{className:Gt("th","content")},t.column.name!==void 0?t.column.name:t.column.plugin!==void 0?vt(fg,{pluginId:t.column.plugin.id,props:{column:t.column}}):null),g()&&vt(a$,Jt({index:t.index},t.column.sort)),t.column.resizable&&t.index<e.header.visibleColumns.length-1&&vt(l$,{column:t.column,thRef:i}))}function u$(){var t,e=wn(),i=Gs(function(r){return r.header});return i?vt("thead",{key:i.id,className:Ri(Gt("thead"),e.className.thead)},(t=Ec.tabularFormat(i.columns)).map(function(r,n){return function(l,h,a){var g=Ec.leafColumns(i.columns);return vt(O0,null,l.map(function(y){return y.hidden?null:function(T,S,P,M){var B=function(j,Z,G){var fe=Ec.maximumDepth(j),re=G-Z;return{rowSpan:Math.floor(re-fe-fe/re),colSpan:j.columns&&j.columns.length||1}}(T,S,M);return vt(c$,{column:T,index:P,colSpan:B.colSpan,rowSpan:B.rowSpan})}(y,h,g.indexOf(y),a)}))}(r,n,t.length)})):null}var Jw=function(t){return function(e){return Jt({},e,{header:t})}};function h$(){var t=wn(),e=Zh(null),i=Uc().dispatch;return Dn(function(){e&&i(function(r){return function(n){return Jt({},n,{tableRef:r})}}(e))},[e]),vt("table",{ref:e,role:"grid",className:Ri(Gt("table"),t.className.table),style:Jt({},t.style.table,{height:t.height})},vt(u$,null),vt(n$,null))}function d$(){var t=xa(!0),e=t[0],i=t[1],r=Zh(null),n=wn();return Dn(function(){r.current.children.length===0&&i(!1)},[r]),e?vt("div",{ref:r,className:Ri(Gt("head"),n.className.header),style:Jt({},n.style.header)},vt(fg,{position:ll.Header})):null}function f$(){var t=Zh(null),e=xa(!0),i=e[0],r=e[1],n=wn();return Dn(function(){t.current.children.length===0&&r(!1)},[t]),i?vt("div",{ref:t,className:Ri(Gt("footer"),n.className.footer),style:Jt({},n.style.footer)},vt(fg,{position:ll.Footer})):null}function p$(){var t=wn(),e=Uc().dispatch,i=Gs(function(a){return a.status}),r=Gs(function(a){return a.data}),n=Gs(function(a){return a.tableRef}),l={current:null},h=MA(function(){try{e(function(g){return Jt({},g,{status:Fn.Loading})});var a=function(g,y){try{var T=Promise.resolve(t.pipeline.process()).then(function(S){e(function(P){return function(M){return P?Jt({},M,{data:P,status:Fn.Loaded}):M}}(S)),setTimeout(function(){e(function(P){return P.status===Fn.Loaded?Jt({},P,{status:Fn.Rendered}):P})},0)})}catch(S){return y(S)}return T&&T.then?T.then(void 0,y):T}(0,function(g){cs.error(g),e(function(y){return Jt({},y,{data:null,status:Fn.Error})})});return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(g){return Promise.reject(g)}},t.processingThrottleMs);return Dn(function(){return e(Jw(t.header)),h(),t.pipeline.on("updated",h),function(){return t.pipeline.off("updated",h)}},[]),Dn(function(){t.header&&i===Fn.Loaded&&r!=null&&r.length&&e(Jw(t.header.adjustWidth(t,n,l)))},[r,t,l]),vt("div",{role:"complementary",className:Ri("gridjs",Gt("container"),i===Fn.Loading?Gt("loading"):null,t.className.container),style:Jt({},t.style.container,{width:t.width})},i===Fn.Loading&&vt("div",{className:Gt("loading-bar")}),vt(d$,null),vt("div",{className:Gt("wrapper"),style:{height:t.height}},vt(h$,null)),vt(f$,null),vt("div",{ref:l,id:"gridjs-temp",className:Gt("temp")}))}var g$=function(t){function e(r){var n;return(n=t.call(this)||this).config=void 0,n.plugin=void 0,n.config=new r$().assign({instance:Cw(n),eventEmitter:Cw(n)}).update(r),n.plugin=n.config.plugin,n}gr(e,t);var i=e.prototype;return i.updateConfig=function(r){return this.config.update(r),this},i.createElement=function(){return vt(IA.Provider,{value:this.config,children:vt(p$,{})})},i.forceRender=function(){return this.config&&this.config.container||cs.error("Container is empty. Make sure you call render() before forceRender()",!0),this.destroy(),dh(this.createElement(),this.config.container),this},i.destroy=function(){this.config.pipeline.clearCache(),dh(null,this.config.container)},i.render=function(r){return r||cs.error("Container element cannot be null",!0),r.childNodes.length>0?(cs.error("The container element "+r+" is not empty. Make sure the container is empty and call render() again"),this):(this.config.container=r,dh(this.createElement(),r),this)},e}(k0);const _$="https://gcp-us-east1.api.carto.com",m$="eyJhbGciOiJIUzI1NiJ9.eyJhIjoiYWNfbHFlM3p3Z3UiLCJqdGkiOiJkOTU4OWMyZiJ9.78MdzU2J6y-J6Far71_Mh7IQO9eYIZD9nECUiZJAVL4",y$="carto_dw",x$={apiBaseUrl:_$,accessToken:m$,connectionName:y$},v$={latitude:41.8097343,longitude:-110.5556199,zoom:3,bearing:0,pitch:0},kA=new aB({canvas:"deck-canvas",initialViewState:v$,controller:!0}),b$=new FP.Map({container:"map",style:WV.POSITRON,interactive:!1}),w$=document.querySelector("#table-widget");let T$=new g$({data:[],columns:[]}).render(w$),Fh;async function S$(){return Fh=await k8({...x$,tableName:"carto-demo-data.demo_tables.osm_pois_usa"})}let OA;const E$=F8(t=>{const e=new xh(t);OA=u8(e.getBounds()),FA()},300);kA.setProps({onViewStateChange:({viewState:t})=>{const{longitude:e,latitude:i,...r}=t;b$.jumpTo({center:[e,i],...r}),E$(t)}});async function FA(){if(!Fh)return;const t={osm_id:"OSM ID",name:"Name",group_name:"Group Name",subgroup_name:"Subgroup Name"};T$.updateConfig({server:{url:"",data:async e=>{let i="OSM_ID",r="asc",n=0;const l=new URLSearchParams(e.url);l.get("order")&&l.get("dir")&&(i=l.get("order"),r=l.get("dir")),l.get("offset")&&(n=parseInt(l.get("offset")));const h=await Fh.widgetSource.getTable({columns:Object.keys(t),spatialFilter:OA,sortBy:Object.keys(t).find(g=>t[g]===i),sortDirection:r,limit:5,offset:n});return{data:h.rows.map(g=>Object.values(g)),total:h.totalCount}}},columns:Object.values(t),style:{table:{"font-size":"11px"},td:{padding:"8px"},th:{padding:"8px"}},sort:{multiColumn:!1,server:{url:(e,i)=>{if(!i.length)return e;const r=i[0],n=r.direction===1?"asc":"desc";let l=Object.values(t)[r.index];return`${e}&order=${l}&dir=${n}`}}},pagination:{server:{url:(e,i,r)=>`${e}&offset=${i*r}`},limit:5}}).forceRender()}async function A$(){if(!Fh)return;const t=[new UV({id:"places",pickable:!0,data:Fh,opacity:1,getFillColor:[3,111,226],getLineColor:[255,255,255],getPointRadius:50,getLineWidth:10,pointRadiusMinPixels:1,lineWidthMinPixels:.3})];kA.setProps({layers:t})}async function P$(){await S$(),FA(),A$()}P$();
