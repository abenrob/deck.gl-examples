var $T=Object.defineProperty;var WT=(t,e,i)=>e in t?$T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var ie=(t,e,i)=>(WT(t,typeof e!="symbol"?e+"":e,i),i);function HT(t,e){for(var i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in t)){const u=Object.getOwnPropertyDescriptor(r,o);u&&Object.defineProperty(t,o,u.get?u:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const _ of u.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&r(_)}).observe(document,{childList:!0,subtree:!0});function i(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=i(o);fetch(o.href,u)}})();var qT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var I2={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(qT,function(){var i,r,o;function u(l,I){if(!i)i=I;else if(!r)r=I;else{var R="var sharedChunk = {}; ("+i+")(sharedChunk); ("+r+")(sharedChunk);",L={};i(L),o=I(L),typeof window<"u"&&(o.workerUrl=window.URL.createObjectURL(new Blob([R],{type:"text/javascript"})))}}u(["exports"],function(l){function I(c,s,f,m){return new(f||(f=Promise))(function(x,P){function M(N){try{O(m.next(N))}catch(j){P(j)}}function D(N){try{O(m.throw(N))}catch(j){P(j)}}function O(N){var j;N.done?x(N.value):(j=N.value,j instanceof f?j:new f(function($){$(j)})).then(M,D)}O((m=m.apply(c,s||[])).next())})}function R(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var L=z;function z(c,s){this.x=c,this.y=s}z.prototype={clone:function(){return new z(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,s){return this.clone()._rotateAround(c,s)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var s=c.x-this.x,f=c.y-this.y;return s*s+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,s){return Math.atan2(this.x*s-this.y*c,this.x*c+this.y*s)},_matMult:function(c){var s=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=s,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var s=Math.cos(c),f=Math.sin(c),m=f*this.x+s*this.y;return this.x=s*this.x-f*this.y,this.y=m,this},_rotateAround:function(c,s){var f=Math.cos(c),m=Math.sin(c),x=s.y+m*(this.x-s.x)+f*(this.y-s.y);return this.x=s.x+f*(this.x-s.x)-m*(this.y-s.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},z.convert=function(c){return c instanceof z?c:Array.isArray(c)?new z(c[0],c[1]):c};var V=R(L),q=ne;function ne(c,s,f,m){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=s,this.p2x=f,this.p2y=m}ne.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,s){if(s===void 0&&(s=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,m=0;m<8;m++){var x=this.sampleCurveX(f)-c;if(Math.abs(x)<s)return f;var P=this.sampleCurveDerivativeX(f);if(Math.abs(P)<1e-6)break;f-=x/P}var M=0,D=1;for(f=c,m=0;m<20&&(x=this.sampleCurveX(f),!(Math.abs(x-c)<s));m++)c>x?M=f:D=f,f=.5*(D-M)+M;return f},solve:function(c,s){return this.sampleCurveY(this.solveCurveX(c,s))}};var Ae=R(q);let Ee,Ce;function Le(){return Ee==null&&(Ee=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ee}function Oe(){if(Ce==null&&(Ce=!1,Le())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let m=0;m<5*5;m++){const x=4*m;s.fillStyle=`rgb(${x},${x+1},${x+2})`,s.fillRect(m%5,Math.floor(m/5),1,1)}const f=s.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&f[m]!==m){Ce=!0;break}}}return Ce||!1}function Ne(c,s,f,m){const x=new Ae(c,s,f,m);return function(P){return x.solve(P)}}const Qe=Ne(.25,.1,.25,1);function Je(c,s,f){return Math.min(f,Math.max(s,c))}function xt(c,s,f){const m=f-s,x=((c-s)%m+m)%m+s;return x===s?f:x}function wt(c,...s){for(const f of s)for(const m in f)c[m]=f[m];return c}let ct=1;function at(c,s,f){const m={};for(const x in c)m[x]=s.call(f||this,c[x],x,c);return m}function Vt(c,s,f){const m={};for(const x in c)s.call(f||this,c[x],x,c)&&(m[x]=c[x]);return m}function Ot(c){return Array.isArray(c)?c.map(Ot):typeof c=="object"&&c?at(c,Ot):c}const $t={};function qt(c){$t[c]||(typeof console<"u"&&console.warn(c),$t[c]=!0)}function gi(c,s,f){return(f.y-c.y)*(s.x-c.x)>(s.y-c.y)*(f.x-c.x)}function Nr(c){let s=0;for(let f,m,x=0,P=c.length,M=P-1;x<P;M=x++)f=c[x],m=c[M],s+=(m.x-f.x)*(f.y+m.y);return s}function hr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Ks=null;function Cn(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const qn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Pn(c,s,f,m,x){return I(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const P=new VideoFrame(c,{timestamp:0});try{const M=P==null?void 0:P.format;if(!M||!M.startsWith("BGR")&&!M.startsWith("RGB"))throw new Error(`Unrecognized format ${M}`);const D=M.startsWith("BGR"),O=new Uint8ClampedArray(m*x*4);if(yield P.copyTo(O,function(N,j,$,Z,J){const ee=4*Math.max(-j,0),ce=(Math.max(0,$)-$)*Z*4+ee,_e=4*Z,xe=Math.max(0,j),Re=Math.max(0,$);return{rect:{x:xe,y:Re,width:Math.min(N.width,j+Z)-xe,height:Math.min(N.height,$+J)-Re},layout:[{offset:ce,stride:_e}]}}(c,s,f,m,x)),D)for(let N=0;N<O.length;N+=4){const j=O[N];O[N]=O[N+2],O[N+2]=j}return O}finally{P.close()}})}let ur,Ei,_r,ln;const cn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(c){const s=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(c,s=0){return this.getImageCanvasContext(c).getImageData(-s,-s,c.width+2*s,c.height+2*s)},getImageCanvasContext(c){const s=window.document.createElement("canvas"),f=s.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return s.width=c.width,s.height=c.height,f.drawImage(c,0,0,c.width,c.height),f},resolveURL:c=>(_r||(_r=document.createElement("a")),_r.href=c,_r.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ln==null&&(ln=matchMedia("(prefers-reduced-motion: reduce)")),ln.matches)}},Qi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Dr extends Error{constructor(s,f,m,x){super(`AJAXError: ${f} (${s}): ${m}`),this.status=s,this.statusText=f,this.url=m,this.body=x}}const yi=hr()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,ki=c=>Qi.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))];function Js(c,s){const f=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:yi(),signal:f.signal});let x=!1,P=!1;return c.type==="json"&&m.headers.set("Accept","application/json"),P||fetch(m).then(M=>M.ok?(D=>{(c.type==="arrayBuffer"||c.type==="image"?D.arrayBuffer():c.type==="json"?D.json():D.text()).then(O=>{P||(x=!0,s(null,O,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(O=>{P||s(new Error(O.message))})})(M):M.blob().then(D=>s(new Dr(M.status,M.statusText,c.url,D)))).catch(M=>{M.code!==20&&s(new Error(M.message))}),{cancel:()=>{P=!0,x||f.abort()}}}const Xr=function(c,s){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){if(hr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s);if(!hr())return(ki(c.url)||Js)(c,s)}if(!(/^file:/.test(f=c.url)||/^file:/.test(yi())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Js(c,s);if(hr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s,void 0,!0)}var f;return function(m,x){const P=new XMLHttpRequest;P.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(P.responseType="arraybuffer");for(const M in m.headers)P.setRequestHeader(M,m.headers[M]);return m.type==="json"&&(P.responseType="text",P.setRequestHeader("Accept","application/json")),P.withCredentials=m.credentials==="include",P.onerror=()=>{x(new Error(P.statusText))},P.onload=()=>{if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){let M=P.response;if(m.type==="json")try{M=JSON.parse(P.response)}catch(D){return x(D)}x(null,M,P.getResponseHeader("Cache-Control"),P.getResponseHeader("Expires"))}else{const M=new Blob([P.response],{type:P.getResponseHeader("Content-Type")});x(new Dr(P.status,P.statusText,m.url,M))}},P.send(m.body),{cancel:()=>P.abort()}}(c,s)},Ls=function(c,s){return Xr(wt(c,{type:"arrayBuffer"}),s)};function zr(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const s=new URL(c),f=window.location;return s.protocol===f.protocol&&s.host===f.host}function ms(c,s,f){f[c]&&f[c].indexOf(s)!==-1||(f[c]=f[c]||[],f[c].push(s))}function mr(c,s,f){if(f&&f[c]){const m=f[c].indexOf(s);m!==-1&&f[c].splice(m,1)}}class Ki{constructor(s,f={}){wt(this,f),this.type=s}}class Ur extends Ki{constructor(s,f={}){super("error",wt({error:s},f))}}class en{on(s,f){return this._listeners=this._listeners||{},ms(s,f,this._listeners),this}off(s,f){return mr(s,f,this._listeners),mr(s,f,this._oneTimeListeners),this}once(s,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},ms(s,f,this._oneTimeListeners),this):new Promise(m=>this.once(s,m))}fire(s,f){typeof s=="string"&&(s=new Ki(s,f||{}));const m=s.type;if(this.listens(m)){s.target=this;const x=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const D of x)D.call(this,s);const P=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const D of P)mr(m,D,this._oneTimeListeners),D.call(this,s);const M=this._eventedParent;M&&(wt(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),M.fire(s))}else s instanceof Ur&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,f){return this._eventedParent=s,this._eventedParentData=f,this}}var Xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const _i=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Br(c,s){const f={};for(const m in c)m!=="ref"&&(f[m]=c[m]);return _i.forEach(m=>{m in s&&(f[m]=s[m])}),f}function vi(c,s){if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let f=0;f<c.length;f++)if(!vi(c[f],s[f]))return!1;return!0}if(typeof c=="object"&&c!==null&&s!==null){if(typeof s!="object"||Object.keys(c).length!==Object.keys(s).length)return!1;for(const f in c)if(!vi(c[f],s[f]))return!1;return!0}return c===s}const oi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Zr(c,s,f){f.push({command:oi.addSource,args:[c,s[c]]})}function In(c,s,f){s.push({command:oi.removeSource,args:[c]}),f[c]=!0}function ys(c,s,f,m){In(c,f,m),Zr(c,s,f)}function Mn(c,s,f){let m;for(m in c[f])if(Object.prototype.hasOwnProperty.call(c[f],m)&&m!=="data"&&!vi(c[f][m],s[f][m]))return!1;for(m in s[f])if(Object.prototype.hasOwnProperty.call(s[f],m)&&m!=="data"&&!vi(c[f][m],s[f][m]))return!1;return!0}function tn(c,s,f,m,x,P){let M;for(M in s=s||{},c=c||{})Object.prototype.hasOwnProperty.call(c,M)&&(vi(c[M],s[M])||f.push({command:P,args:[m,M,s[M],x]}));for(M in s)Object.prototype.hasOwnProperty.call(s,M)&&!Object.prototype.hasOwnProperty.call(c,M)&&(vi(c[M],s[M])||f.push({command:P,args:[m,M,s[M],x]}))}function Ns(c){return c.id}function bs(c,s){return c[s.id]=s,c}class st{constructor(s,f,m,x){this.message=(s?`${s}: `:"")+m,x&&(this.identifier=x),f!=null&&f.__line__&&(this.line=f.__line__)}}function vs(c,...s){for(const f of s)for(const m in f)c[m]=f[m];return c}class Ui extends Error{constructor(s,f){super(f),this.message=f,this.key=s}}class hn{constructor(s,f=[]){this.parent=s,this.bindings={};for(const[m,x]of f)this.bindings[m]=x}concat(s){return new hn(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const xs={kind:"null"},nt={kind:"number"},Yt={kind:"string"},Xt={kind:"boolean"},Ar={kind:"color"},ns={kind:"object"},Gt={kind:"value"},Ke={kind:"collator"},fe={kind:"formatted"},X={kind:"padding"},Q={kind:"resolvedImage"},ae={kind:"variableAnchorOffsetCollection"};function pe(c,s){return{kind:"array",itemType:c,N:s}}function ge(c){if(c.kind==="array"){const s=ge(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}const ke=[xs,nt,Yt,Xt,Ar,fe,ns,pe(Gt),X,Q,ae];function Pe(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Pe(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(const f of ke)if(!Pe(f,s))return null}}return`Expected ${ge(c)} but found ${ge(s)} instead.`}function ye(c,s){return s.some(f=>f.kind===c.kind)}function Me(c,s){return s.some(f=>f==="null"?c===null:f==="array"?Array.isArray(c):f==="object"?c&&!Array.isArray(c)&&typeof c=="object":f===typeof c)}function qe(c,s){return c.kind==="array"&&s.kind==="array"?c.itemType.kind===s.itemType.kind&&typeof c.N=="number":c.kind===s.kind}const ue=.96422,Se=.82521,We=4/29,et=6/29,g=3*et*et,K=et*et*et,ut=Math.PI/180,Bt=180/Math.PI;function Zt(c){return(c%=360)<0&&(c+=360),c}function ft([c,s,f,m]){let x,P;const M=Si((.2225045*(c=yt(c))+.7168786*(s=yt(s))+.0606169*(f=yt(f)))/1);c===s&&s===f?x=P=M:(x=Si((.4360747*c+.3850649*s+.1430804*f)/ue),P=Si((.0139322*c+.0971045*s+.7141733*f)/Se));const D=116*M-16;return[D<0?0:D,500*(x-M),200*(M-P),m]}function yt(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Si(c){return c>K?Math.pow(c,1/3):c/g+We}function Lt([c,s,f,m]){let x=(c+16)/116,P=isNaN(s)?x:x+s/500,M=isNaN(f)?x:x-f/200;return x=1*wi(x),P=ue*wi(P),M=Se*wi(M),[Rt(3.1338561*P-1.6168667*x-.4906146*M),Rt(-.9787684*P+1.9161415*x+.033454*M),Rt(.0719453*P-.2289914*x+1.4052427*M),m]}function Rt(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function wi(c){return c>et?c*c*c:g*(c-We)}function Tr(c){return parseInt(c.padEnd(2,c),16)/255}function Xn(c,s){return tr(s?c/100:c,0,1)}function tr(c,s,f){return Math.min(Math.max(s,c),f)}function Vi(c){return!c.some(Number.isNaN)}const Vr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Qt{constructor(s,f,m,x=1,P=!0){this.r=s,this.g=f,this.b=m,this.a=x,P||(this.r*=x,this.g*=x,this.b*=x,x||this.overwriteGetter("rgb",[s,f,m,x]))}static parse(s){if(s instanceof Qt)return s;if(typeof s!="string")return;const f=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const x=Vr[m];if(x){const[M,D,O]=x;return[M/255,D/255,O/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const M=m.length<6?1:2;let D=1;return[Tr(m.slice(D,D+=M)),Tr(m.slice(D,D+=M)),Tr(m.slice(D,D+=M)),Tr(m.slice(D,D+M)||"ff")]}if(m.startsWith("rgb")){const M=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(M){const[D,O,N,j,$,Z,J,ee,ce,_e,xe,Re]=M,Ie=[j||" ",J||" ",_e].join("");if(Ie==="  "||Ie==="  /"||Ie===",,"||Ie===",,,"){const De=[N,Z,ce].join(""),Ue=De==="%%%"?100:De===""?255:0;if(Ue){const Ze=[tr(+O/Ue,0,1),tr(+$/Ue,0,1),tr(+ee/Ue,0,1),xe?Xn(+xe,Re):1];if(Vi(Ze))return Ze}}return}}const P=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(P){const[M,D,O,N,j,$,Z,J,ee]=P,ce=[O||" ",j||" ",Z].join("");if(ce==="  "||ce==="  /"||ce===",,"||ce===",,,"){const _e=[+D,tr(+N,0,100),tr(+$,0,100),J?Xn(+J,ee):1];if(Vi(_e))return function([xe,Re,Ie,De]){function Ue(Ze){const _t=(Ze+xe/30)%12,Ct=Re*Math.min(Ie,1-Ie);return Ie-Ct*Math.max(-1,Math.min(_t-3,9-_t,1))}return xe=Zt(xe),Re/=100,Ie/=100,[Ue(0),Ue(8),Ue(4),De]}(_e)}}}(s);return f?new Qt(...f,!1):void 0}get rgb(){const{r:s,g:f,b:m,a:x}=this,P=x||1/0;return this.overwriteGetter("rgb",[s/P,f/P,m/P,x])}get hcl(){return this.overwriteGetter("hcl",function(s){const[f,m,x,P]=ft(s),M=Math.sqrt(m*m+x*x);return[Math.round(1e4*M)?Zt(Math.atan2(x,m)*Bt):NaN,M,f,P]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ft(this.rgb))}overwriteGetter(s,f){return Object.defineProperty(this,s,{value:f}),f}toString(){const[s,f,m,x]=this.rgb;return`rgba(${[s,f,m].map(P=>Math.round(255*P)).join(",")},${x})`}}Qt.black=new Qt(0,0,0,1),Qt.white=new Qt(1,1,1,1),Qt.transparent=new Qt(0,0,0,0),Qt.red=new Qt(1,0,0,1);class zs{constructor(s,f,m){this.sensitivity=s?f?"variant":"case":f?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,f){return this.collator.compare(s,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class jr{constructor(s,f,m,x,P){this.text=s,this.image=f,this.scale=m,this.fontStack=x,this.textColor=P}}class bi{constructor(s){this.sections=s}static fromString(s){return new bi([new jr(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof bi?s:bi.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class Wt{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Wt)return s;if(typeof s=="number")return new Wt([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const f of s)if(typeof f!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new Wt(s)}}toString(){return JSON.stringify(this.values)}}const le=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Pt{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Pt)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let f=0;f<s.length;f+=2){const m=s[f],x=s[f+1];if(typeof m!="string"||!le.has(m)||!Array.isArray(x)||x.length!==2||typeof x[0]!="number"||typeof x[1]!="number")return}return new Pt(s)}}toString(){return JSON.stringify(this.values)}}class Ti{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new Ti({name:s,available:!1}):null}}function un(c,s,f,m){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof f=="number"&&f>=0&&f<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[c,s,f,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[c,s,f,m]:[c,s,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function rn(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Qt||c instanceof zs||c instanceof bi||c instanceof Wt||c instanceof Pt||c instanceof Ti)return!0;if(Array.isArray(c)){for(const s of c)if(!rn(s))return!1;return!0}if(typeof c=="object"){for(const s in c)if(!rn(c[s]))return!1;return!0}return!1}function Pi(c){if(c===null)return xs;if(typeof c=="string")return Yt;if(typeof c=="boolean")return Xt;if(typeof c=="number")return nt;if(c instanceof Qt)return Ar;if(c instanceof zs)return Ke;if(c instanceof bi)return fe;if(c instanceof Wt)return X;if(c instanceof Pt)return ae;if(c instanceof Ti)return Q;if(Array.isArray(c)){const s=c.length;let f;for(const m of c){const x=Pi(m);if(f){if(f===x)continue;f=Gt;break}f=x}return pe(f||Gt,s)}return ns}function fi(c){const s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof Qt||c instanceof bi||c instanceof Wt||c instanceof Pt||c instanceof Ti?c.toString():JSON.stringify(c)}class re{constructor(s,f){this.type=s,this.value=f}static parse(s,f){if(s.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!rn(s[1]))return f.error("invalid value");const m=s[1];let x=Pi(m);const P=f.expectedType;return x.kind!=="array"||x.N!==0||!P||P.kind!=="array"||typeof P.N=="number"&&P.N!==0||(x=P),new re(x,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ii{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Yr={string:Yt,number:nt,boolean:Xt,object:ns};class Gr{constructor(s,f){this.type=s,this.args=f}static parse(s,f){if(s.length<2)return f.error("Expected at least one argument.");let m,x=1;const P=s[0];if(P==="array"){let D,O;if(s.length>2){const N=s[1];if(typeof N!="string"||!(N in Yr)||N==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);D=Yr[N],x++}else D=Gt;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return f.error('The length argument to "array" must be a positive integer literal',2);O=s[2],x++}m=pe(D,O)}else{if(!Yr[P])throw new Error(`Types doesn't contain name = ${P}`);m=Yr[P]}const M=[];for(;x<s.length;x++){const D=f.parse(s[x],x,Gt);if(!D)return null;M.push(D)}return new Gr(m,M)}evaluate(s){for(let f=0;f<this.args.length;f++){const m=this.args[f].evaluate(s);if(!Pe(this.type,Pi(m)))return m;if(f===this.args.length-1)throw new Ii(`Expected value to be of type ${ge(this.type)}, but found ${ge(Pi(m))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Ao={"to-boolean":Xt,"to-color":Ar,"to-number":nt,"to-string":Yt};class ws{constructor(s,f){this.type=s,this.args=f}static parse(s,f){if(s.length<2)return f.error("Expected at least one argument.");const m=s[0];if(!Ao[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&s.length!==2)return f.error("Expected one argument.");const x=Ao[m],P=[];for(let M=1;M<s.length;M++){const D=f.parse(s[M],M,Gt);if(!D)return null;P.push(D)}return new ws(x,P)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let f,m;for(const x of this.args){if(f=x.evaluate(s),m=null,f instanceof Qt)return f;if(typeof f=="string"){const P=s.parseColor(f);if(P)return P}else if(Array.isArray(f)&&(m=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:un(f[0],f[1],f[2],f[3]),!m))return new Qt(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new Ii(m||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const m of this.args){f=m.evaluate(s);const x=Wt.parse(f);if(x)return x}throw new Ii(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const m of this.args){f=m.evaluate(s);const x=Pt.parse(f);if(x)return x}throw new Ii(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const m of this.args){if(f=m.evaluate(s),f===null)return 0;const x=Number(f);if(!isNaN(x))return x}throw new Ii(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return bi.fromString(fi(this.args[0].evaluate(s)));case"resolvedImage":return Ti.fromString(fi(this.args[0].evaluate(s)));default:return fi(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const qo=["Unknown","Point","LineString","Polygon"];class fo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let f=this._parseColorCache[s];return f||(f=this._parseColorCache[s]=Qt.parse(s)),f}}class Zn{constructor(s,f,m=[],x,P=new hn,M=[]){this.registry=s,this.path=m,this.key=m.map(D=>`[${D}]`).join(""),this.scope=P,this.errors=M,this.expectedType=x,this._isConstant=f}parse(s,f,m,x,P={}){return f?this.concat(f,m,x)._parse(s,P):this._parse(s,P)}_parse(s,f){function m(x,P,M){return M==="assert"?new Gr(P,[x]):M==="coerce"?new ws(P,[x]):x}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const x=s[0];if(typeof x!="string")return this.error(`Expression name must be a string, but found ${typeof x} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const P=this.registry[x];if(P){let M=P.parse(s,this);if(!M)return null;if(this.expectedType){const D=this.expectedType,O=M.type;if(D.kind!=="string"&&D.kind!=="number"&&D.kind!=="boolean"&&D.kind!=="object"&&D.kind!=="array"||O.kind!=="value")if(D.kind!=="color"&&D.kind!=="formatted"&&D.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string")if(D.kind!=="padding"||O.kind!=="value"&&O.kind!=="number"&&O.kind!=="array")if(D.kind!=="variableAnchorOffsetCollection"||O.kind!=="value"&&O.kind!=="array"){if(this.checkSubtype(D,O))return null}else M=m(M,D,f.typeAnnotation||"coerce");else M=m(M,D,f.typeAnnotation||"coerce");else M=m(M,D,f.typeAnnotation||"coerce");else M=m(M,D,f.typeAnnotation||"assert")}if(!(M instanceof re)&&M.type.kind!=="resolvedImage"&&this._isConstant(M)){const D=new fo;try{M=new re(M.type,M.evaluate(D))}catch(O){return this.error(O.message),null}}return M}return this.error(`Unknown expression "${x}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,f,m){const x=typeof s=="number"?this.path.concat(s):this.path,P=m?this.scope.concat(m):this.scope;return new Zn(this.registry,this._isConstant,x,f||null,P,this.errors)}error(s,...f){const m=`${this.key}${f.map(x=>`[${x}]`).join("")}`;this.errors.push(new Ui(m,s))}checkSubtype(s,f){const m=Pe(s,f);return m&&this.error(m),m}}class te{constructor(s,f,m){this.type=Ke,this.locale=m,this.caseSensitive=s,this.diacriticSensitive=f}static parse(s,f){if(s.length!==2)return f.error("Expected one argument.");const m=s[1];if(typeof m!="object"||Array.isArray(m))return f.error("Collator options argument must be an object.");const x=f.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,Xt);if(!x)return null;const P=f.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,Xt);if(!P)return null;let M=null;return m.locale&&(M=f.parse(m.locale,1,Yt),!M)?null:new te(x,P,M)}evaluate(s){return new zs(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const oe=8192;function we(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function Ve(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function rt(c,s){const f=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,x=Math.pow(2,s.z);return[Math.round(f*x*oe),Math.round(m*x*oe)]}function Et(c,s,f){const m=c[0]-s[0],x=c[1]-s[1],P=c[0]-f[0],M=c[1]-f[1];return m*M-P*x==0&&m*P<=0&&x*M<=0}function ni(c,s){let f=!1;for(let M=0,D=s.length;M<D;M++){const O=s[M];for(let N=0,j=O.length;N<j-1;N++){if(Et(c,O[N],O[N+1]))return!1;(x=O[N])[1]>(m=c)[1]!=(P=O[N+1])[1]>m[1]&&m[0]<(P[0]-x[0])*(m[1]-x[1])/(P[1]-x[1])+x[0]&&(f=!f)}}var m,x,P;return f}function Ji(c,s){for(let f=0;f<s.length;f++)if(ni(c,s[f]))return!0;return!1}function nr(c,s,f,m){const x=m[0]-f[0],P=m[1]-f[1],M=(c[0]-f[0])*P-x*(c[1]-f[1]),D=(s[0]-f[0])*P-x*(s[1]-f[1]);return M>0&&D<0||M<0&&D>0}function Er(c,s,f){for(const N of f)for(let j=0;j<N.length-1;++j)if((D=[(M=N[j+1])[0]-(P=N[j])[0],M[1]-P[1]])[0]*(O=[(x=s)[0]-(m=c)[0],x[1]-m[1]])[1]-D[1]*O[0]!=0&&nr(m,x,P,M)&&nr(P,M,m,x))return!0;var m,x,P,M,D,O;return!1}function ui(c,s){for(let f=0;f<c.length;++f)if(!ni(c[f],s))return!1;for(let f=0;f<c.length-1;++f)if(Er(c[f],c[f+1],s))return!1;return!0}function Ia(c,s){for(let f=0;f<s.length;f++)if(ui(c,s[f]))return!0;return!1}function Xo(c,s,f){const m=[];for(let x=0;x<c.length;x++){const P=[];for(let M=0;M<c[x].length;M++){const D=rt(c[x][M],f);we(s,D),P.push(D)}m.push(P)}return m}function fc(c,s,f){const m=[];for(let x=0;x<c.length;x++){const P=Xo(c[x],s,f);m.push(P)}return m}function dc(c,s,f,m){if(c[0]<f[0]||c[0]>f[2]){const x=.5*m;let P=c[0]-f[0]>x?-m:f[0]-c[0]>x?m:0;P===0&&(P=c[0]-f[2]>x?-m:f[2]-c[0]>x?m:0),c[0]+=P}we(s,c)}function fl(c,s,f,m){const x=Math.pow(2,m.z)*oe,P=[m.x*oe,m.y*oe],M=[];for(const D of c)for(const O of D){const N=[O.x+P[0],O.y+P[1]];dc(N,s,f,x),M.push(N)}return M}function Ma(c,s,f,m){const x=Math.pow(2,m.z)*oe,P=[m.x*oe,m.y*oe],M=[];for(const O of c){const N=[];for(const j of O){const $=[j.x+P[0],j.y+P[1]];we(s,$),N.push($)}M.push(N)}if(s[2]-s[0]<=x/2){(D=s)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const O of M)for(const N of O)dc(N,s,f,x)}var D;return M}class An{constructor(s,f){this.type=Xt,this.geojson=s,this.geometries=f}static parse(s,f){if(s.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(rn(s[1])){const m=s[1];if(m.type==="FeatureCollection")for(let x=0;x<m.features.length;++x){const P=m.features[x].geometry.type;if(P==="Polygon"||P==="MultiPolygon")return new An(m,m.features[x].geometry)}else if(m.type==="Feature"){const x=m.geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new An(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new An(m,m)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(f,m){const x=[1/0,1/0,-1/0,-1/0],P=[1/0,1/0,-1/0,-1/0],M=f.canonicalID();if(m.type==="Polygon"){const D=Xo(m.coordinates,P,M),O=fl(f.geometry(),x,P,M);if(!Ve(x,P))return!1;for(const N of O)if(!ni(N,D))return!1}if(m.type==="MultiPolygon"){const D=fc(m.coordinates,P,M),O=fl(f.geometry(),x,P,M);if(!Ve(x,P))return!1;for(const N of O)if(!Ji(N,D))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(f,m){const x=[1/0,1/0,-1/0,-1/0],P=[1/0,1/0,-1/0,-1/0],M=f.canonicalID();if(m.type==="Polygon"){const D=Xo(m.coordinates,P,M),O=Ma(f.geometry(),x,P,M);if(!Ve(x,P))return!1;for(const N of O)if(!ui(N,D))return!1}if(m.type==="MultiPolygon"){const D=fc(m.coordinates,P,M),O=Ma(f.geometry(),x,P,M);if(!Ve(x,P))return!1;for(const N of O)if(!Ia(N,D))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class po{constructor(s,f){this.type=f.type,this.name=s,this.boundExpression=f}static parse(s,f){if(s.length!==2||typeof s[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const m=s[1];return f.scope.has(m)?new po(m,f.scope.get(m)):f.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Ts{constructor(s,f,m,x){this.name=s,this.type=f,this._evaluate=m,this.args=x}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,f){const m=s[0],x=Ts.definitions[m];if(!x)return f.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const P=Array.isArray(x)?x[0]:x.type,M=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,D=M.filter(([N])=>!Array.isArray(N)||N.length===s.length-1);let O=null;for(const[N,j]of D){O=new Zn(f.registry,Ra,f.path,null,f.scope);const $=[];let Z=!1;for(let J=1;J<s.length;J++){const ee=s[J],ce=Array.isArray(N)?N[J-1]:N.type,_e=O.parse(ee,1+$.length,ce);if(!_e){Z=!0;break}$.push(_e)}if(!Z)if(Array.isArray(N)&&N.length!==$.length)O.error(`Expected ${N.length} arguments, but found ${$.length} instead.`);else{for(let J=0;J<$.length;J++){const ee=Array.isArray(N)?N[J]:N.type,ce=$[J];O.concat(J+1).checkSubtype(ee,ce.type)}if(O.errors.length===0)return new Ts(m,P,j,$)}}if(D.length===1)f.errors.push(...O.errors);else{const N=(D.length?D:M).map(([$])=>{return Z=$,Array.isArray(Z)?`(${Z.map(ge).join(", ")})`:`(${ge(Z.type)}...)`;var Z}).join(" | "),j=[];for(let $=1;$<s.length;$++){const Z=f.parse(s[$],1+j.length);if(!Z)return null;j.push(ge(Z.type))}f.error(`Expected arguments of type ${N}, but found (${j.join(", ")}) instead.`)}return null}static register(s,f){Ts.definitions=f;for(const m in f)s[m]=Ts}}function Ra(c){if(c instanceof po)return Ra(c.boundExpression);if(c instanceof Ts&&c.name==="error"||c instanceof te||c instanceof An)return!1;const s=c instanceof ws||c instanceof Gr;let f=!0;return c.eachChild(m=>{f=s?f&&Ra(m):f&&m instanceof re}),!!f&&Zo(c)&&Yo(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Zo(c){if(c instanceof Ts&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof An)return!1;let s=!0;return c.eachChild(f=>{s&&!Zo(f)&&(s=!1)}),s}function go(c){if(c instanceof Ts&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(f=>{s&&!go(f)&&(s=!1)}),s}function Yo(c,s){if(c instanceof Ts&&s.indexOf(c.name)>=0)return!1;let f=!0;return c.eachChild(m=>{f&&!Yo(m,s)&&(f=!1)}),f}function _o(c,s){const f=c.length-1;let m,x,P=0,M=f,D=0;for(;P<=M;)if(D=Math.floor((P+M)/2),m=c[D],x=c[D+1],m<=s){if(D===f||s<x)return D;P=D+1}else{if(!(m>s))throw new Ii("Input is not a number.");M=D-1}return 0}class Rn{constructor(s,f,m){this.type=s,this.input=f,this.labels=[],this.outputs=[];for(const[x,P]of m)this.labels.push(x),this.outputs.push(P)}static parse(s,f){if(s.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return f.error("Expected an even number of arguments.");const m=f.parse(s[1],1,nt);if(!m)return null;const x=[];let P=null;f.expectedType&&f.expectedType.kind!=="value"&&(P=f.expectedType);for(let M=1;M<s.length;M+=2){const D=M===1?-1/0:s[M],O=s[M+1],N=M,j=M+1;if(typeof D!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(x.length&&x[x.length-1][0]>=D)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const $=f.parse(O,j,P);if(!$)return null;P=P||$.type,x.push([D,$])}return new Rn(P,m,x)}evaluate(s){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(s);const x=this.input.evaluate(s);if(x<=f[0])return m[0].evaluate(s);const P=f.length;return x>=f[P-1]?m[P-1].evaluate(s):m[_o(f,x)].evaluate(s)}eachChild(s){s(this.input);for(const f of this.outputs)s(f)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Ai(c,s,f){return c+f*(s-c)}function fr(c,s,f){return c.map((m,x)=>Ai(m,s[x],f))}const dr={number:Ai,color:function(c,s,f,m="rgb"){switch(m){case"rgb":{const[x,P,M,D]=fr(c.rgb,s.rgb,f);return new Qt(x,P,M,D,!1)}case"hcl":{const[x,P,M,D]=c.hcl,[O,N,j,$]=s.hcl;let Z,J;if(isNaN(x)||isNaN(O))isNaN(x)?isNaN(O)?Z=NaN:(Z=O,M!==1&&M!==0||(J=N)):(Z=x,j!==1&&j!==0||(J=P));else{let Re=O-x;O>x&&Re>180?Re-=360:O<x&&x-O>180&&(Re+=360),Z=x+f*Re}const[ee,ce,_e,xe]=function([Re,Ie,De,Ue]){return Re=isNaN(Re)?0:Re*ut,Lt([De,Math.cos(Re)*Ie,Math.sin(Re)*Ie,Ue])}([Z,J??Ai(P,N,f),Ai(M,j,f),Ai(D,$,f)]);return new Qt(ee,ce,_e,xe,!1)}case"lab":{const[x,P,M,D]=Lt(fr(c.lab,s.lab,f));return new Qt(x,P,M,D,!1)}}},array:fr,padding:function(c,s,f){return new Wt(fr(c.values,s.values,f))},variableAnchorOffsetCollection:function(c,s,f){const m=c.values,x=s.values;if(m.length!==x.length)throw new Ii(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${s.toString()}`);const P=[];for(let M=0;M<m.length;M+=2){if(m[M]!==x[M])throw new Ii(`Cannot interpolate values containing mismatched anchors. from[${M}]: ${m[M]}, to[${M}]: ${x[M]}`);P.push(m[M]);const[D,O]=m[M+1],[N,j]=x[M+1];P.push([Ai(D,N,f),Ai(O,j,f)])}return new Pt(P)}};class Di{constructor(s,f,m,x,P){this.type=s,this.operator=f,this.interpolation=m,this.input=x,this.labels=[],this.outputs=[];for(const[M,D]of P)this.labels.push(M),this.outputs.push(D)}static interpolationFactor(s,f,m,x){let P=0;if(s.name==="exponential")P=Go(f,s.base,m,x);else if(s.name==="linear")P=Go(f,1,m,x);else if(s.name==="cubic-bezier"){const M=s.controlPoints;P=new Ae(M[0],M[1],M[2],M[3]).solve(Go(f,1,m,x))}return P}static parse(s,f){let[m,x,P,...M]=s;if(!Array.isArray(x)||x.length===0)return f.error("Expected an interpolation type expression.",1);if(x[0]==="linear")x={name:"linear"};else if(x[0]==="exponential"){const N=x[1];if(typeof N!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);x={name:"exponential",base:N}}else{if(x[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(x[0])}`,1,0);{const N=x.slice(1);if(N.length!==4||N.some(j=>typeof j!="number"||j<0||j>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);x={name:"cubic-bezier",controlPoints:N}}}if(s.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(P=f.parse(P,2,nt),!P)return null;const D=[];let O=null;m==="interpolate-hcl"||m==="interpolate-lab"?O=Ar:f.expectedType&&f.expectedType.kind!=="value"&&(O=f.expectedType);for(let N=0;N<M.length;N+=2){const j=M[N],$=M[N+1],Z=N+3,J=N+4;if(typeof j!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(D.length&&D[D.length-1][0]>=j)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const ee=f.parse($,J,O);if(!ee)return null;O=O||ee.type,D.push([j,ee])}return qe(O,nt)||qe(O,Ar)||qe(O,X)||qe(O,ae)||qe(O,pe(nt))?new Di(O,m,x,P,D):f.error(`Type ${ge(O)} is not interpolatable.`)}evaluate(s){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(s);const x=this.input.evaluate(s);if(x<=f[0])return m[0].evaluate(s);const P=f.length;if(x>=f[P-1])return m[P-1].evaluate(s);const M=_o(f,x),D=Di.interpolationFactor(this.interpolation,x,f[M],f[M+1]),O=m[M].evaluate(s),N=m[M+1].evaluate(s);switch(this.operator){case"interpolate":return dr[this.type.kind](O,N,D);case"interpolate-hcl":return dr.color(O,N,D,"hcl");case"interpolate-lab":return dr.color(O,N,D,"lab")}}eachChild(s){s(this.input);for(const f of this.outputs)s(f)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Go(c,s,f,m){const x=m-f,P=c-f;return x===0?0:s===1?P/x:(Math.pow(s,P)-1)/(Math.pow(s,x)-1)}class Qo{constructor(s,f){this.type=s,this.args=f}static parse(s,f){if(s.length<2)return f.error("Expectected at least one argument.");let m=null;const x=f.expectedType;x&&x.kind!=="value"&&(m=x);const P=[];for(const D of s.slice(1)){const O=f.parse(D,1+P.length,m,void 0,{typeAnnotation:"omit"});if(!O)return null;m=m||O.type,P.push(O)}if(!m)throw new Error("No output type");const M=x&&P.some(D=>Pe(x,D.type));return new Qo(M?Gt:m,P)}evaluate(s){let f,m=null,x=0;for(const P of this.args)if(x++,m=P.evaluate(s),m&&m instanceof Ti&&!m.available&&(f||(f=m.name),m=null,x===this.args.length&&(m=f)),m!==null)break;return m}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class Yn{constructor(s,f){this.type=f.type,this.bindings=[].concat(s),this.result=f}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const f of this.bindings)s(f[1]);s(this.result)}static parse(s,f){if(s.length<4)return f.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const m=[];for(let P=1;P<s.length-1;P+=2){const M=s[P];if(typeof M!="string")return f.error(`Expected string, but found ${typeof M} instead.`,P);if(/[^a-zA-Z0-9_]/.test(M))return f.error("Variable names must contain only alphanumeric characters or '_'.",P);const D=f.parse(s[P+1],P+1);if(!D)return null;m.push([M,D])}const x=f.parse(s[s.length-1],s.length-1,f.expectedType,m);return x?new Yn(m,x):null}outputDefined(){return this.result.outputDefined()}}class dl{constructor(s,f,m){this.type=s,this.index=f,this.input=m}static parse(s,f){if(s.length!==3)return f.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=f.parse(s[1],1,nt),x=f.parse(s[2],2,pe(f.expectedType||Gt));return m&&x?new dl(x.type.itemType,m,x):null}evaluate(s){const f=this.index.evaluate(s),m=this.input.evaluate(s);if(f<0)throw new Ii(`Array index out of bounds: ${f} < 0.`);if(f>=m.length)throw new Ii(`Array index out of bounds: ${f} > ${m.length-1}.`);if(f!==Math.floor(f))throw new Ii(`Array index must be an integer, but found ${f} instead.`);return m[f]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class pl{constructor(s,f){this.type=Xt,this.needle=s,this.haystack=f}static parse(s,f){if(s.length!==3)return f.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=f.parse(s[1],1,Gt),x=f.parse(s[2],2,Gt);return m&&x?ye(m.type,[Xt,Yt,nt,xs,Gt])?new pl(m,x):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${ge(m.type)} instead`):null}evaluate(s){const f=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!m)return!1;if(!Me(f,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${ge(Pi(f))} instead.`);if(!Me(m,["string","array"]))throw new Ii(`Expected second argument to be of type array or string, but found ${ge(Pi(m))} instead.`);return m.indexOf(f)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class ka{constructor(s,f,m){this.type=nt,this.needle=s,this.haystack=f,this.fromIndex=m}static parse(s,f){if(s.length<=2||s.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=f.parse(s[1],1,Gt),x=f.parse(s[2],2,Gt);if(!m||!x)return null;if(!ye(m.type,[Xt,Yt,nt,xs,Gt]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${ge(m.type)} instead`);if(s.length===4){const P=f.parse(s[3],3,nt);return P?new ka(m,x,P):null}return new ka(m,x)}evaluate(s){const f=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!Me(f,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${ge(Pi(f))} instead.`);if(!Me(m,["string","array"]))throw new Ii(`Expected second argument to be of type array or string, but found ${ge(Pi(m))} instead.`);if(this.fromIndex){const x=this.fromIndex.evaluate(s);return m.indexOf(f,x)}return m.indexOf(f)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Da{constructor(s,f,m,x,P,M){this.inputType=s,this.type=f,this.input=m,this.cases=x,this.outputs=P,this.otherwise=M}static parse(s,f){if(s.length<5)return f.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return f.error("Expected an even number of arguments.");let m,x;f.expectedType&&f.expectedType.kind!=="value"&&(x=f.expectedType);const P={},M=[];for(let N=2;N<s.length-1;N+=2){let j=s[N];const $=s[N+1];Array.isArray(j)||(j=[j]);const Z=f.concat(N);if(j.length===0)return Z.error("Expected at least one branch label.");for(const ee of j){if(typeof ee!="number"&&typeof ee!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ee=="number"&&Math.floor(ee)!==ee)return Z.error("Numeric branch labels must be integer values.");if(m){if(Z.checkSubtype(m,Pi(ee)))return null}else m=Pi(ee);if(P[String(ee)]!==void 0)return Z.error("Branch labels must be unique.");P[String(ee)]=M.length}const J=f.parse($,N,x);if(!J)return null;x=x||J.type,M.push(J)}const D=f.parse(s[1],1,Gt);if(!D)return null;const O=f.parse(s[s.length-1],s.length-1,x);return O?D.type.kind!=="value"&&f.concat(1).checkSubtype(m,D.type)?null:new Da(m,x,D,P,M,O):null}evaluate(s){const f=this.input.evaluate(s);return(Pi(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class mo{constructor(s,f,m){this.type=s,this.branches=f,this.otherwise=m}static parse(s,f){if(s.length<4)return f.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return f.error("Expected an odd number of arguments.");let m;f.expectedType&&f.expectedType.kind!=="value"&&(m=f.expectedType);const x=[];for(let M=1;M<s.length-1;M+=2){const D=f.parse(s[M],M,Xt);if(!D)return null;const O=f.parse(s[M+1],M+1,m);if(!O)return null;x.push([D,O]),m=m||O.type}const P=f.parse(s[s.length-1],s.length-1,m);if(!P)return null;if(!m)throw new Error("Can't infer output type");return new mo(m,x,P)}evaluate(s){for(const[f,m]of this.branches)if(f.evaluate(s))return m.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[f,m]of this.branches)s(f),s(m);s(this.otherwise)}outputDefined(){return this.branches.every(([s,f])=>f.outputDefined())&&this.otherwise.outputDefined()}}class sn{constructor(s,f,m,x){this.type=s,this.input=f,this.beginIndex=m,this.endIndex=x}static parse(s,f){if(s.length<=2||s.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=f.parse(s[1],1,Gt),x=f.parse(s[2],2,nt);if(!m||!x)return null;if(!ye(m.type,[pe(Gt),Yt,Gt]))return f.error(`Expected first argument to be of type array or string, but found ${ge(m.type)} instead`);if(s.length===4){const P=f.parse(s[3],3,nt);return P?new sn(m.type,m,x,P):null}return new sn(m.type,m,x)}evaluate(s){const f=this.input.evaluate(s),m=this.beginIndex.evaluate(s);if(!Me(f,["string","array"]))throw new Ii(`Expected first argument to be of type array or string, but found ${ge(Pi(f))} instead.`);if(this.endIndex){const x=this.endIndex.evaluate(s);return f.slice(m,x)}return f.slice(m)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function gl(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function _l(c,s,f,m){return m.compare(s,f)===0}function fn(c,s,f){const m=c!=="=="&&c!=="!=";return class M2{constructor(P,M,D){this.type=Xt,this.lhs=P,this.rhs=M,this.collator=D,this.hasUntypedArgument=P.type.kind==="value"||M.type.kind==="value"}static parse(P,M){if(P.length!==3&&P.length!==4)return M.error("Expected two or three arguments.");const D=P[0];let O=M.parse(P[1],1,Gt);if(!O)return null;if(!gl(D,O.type))return M.concat(1).error(`"${D}" comparisons are not supported for type '${ge(O.type)}'.`);let N=M.parse(P[2],2,Gt);if(!N)return null;if(!gl(D,N.type))return M.concat(2).error(`"${D}" comparisons are not supported for type '${ge(N.type)}'.`);if(O.type.kind!==N.type.kind&&O.type.kind!=="value"&&N.type.kind!=="value")return M.error(`Cannot compare types '${ge(O.type)}' and '${ge(N.type)}'.`);m&&(O.type.kind==="value"&&N.type.kind!=="value"?O=new Gr(N.type,[O]):O.type.kind!=="value"&&N.type.kind==="value"&&(N=new Gr(O.type,[N])));let j=null;if(P.length===4){if(O.type.kind!=="string"&&N.type.kind!=="string"&&O.type.kind!=="value"&&N.type.kind!=="value")return M.error("Cannot use collator to compare non-string types.");if(j=M.parse(P[3],3,Ke),!j)return null}return new M2(O,N,j)}evaluate(P){const M=this.lhs.evaluate(P),D=this.rhs.evaluate(P);if(m&&this.hasUntypedArgument){const O=Pi(M),N=Pi(D);if(O.kind!==N.kind||O.kind!=="string"&&O.kind!=="number")throw new Ii(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${O.kind}, ${N.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const O=Pi(M),N=Pi(D);if(O.kind!=="string"||N.kind!=="string")return s(P,M,D)}return this.collator?f(P,M,D,this.collator.evaluate(P)):s(P,M,D)}eachChild(P){P(this.lhs),P(this.rhs),this.collator&&P(this.collator)}outputDefined(){return!0}}}const Gn=fn("==",function(c,s,f){return s===f},_l),kn=fn("!=",function(c,s,f){return s!==f},function(c,s,f,m){return!_l(0,s,f,m)}),pc=fn("<",function(c,s,f){return s<f},function(c,s,f,m){return m.compare(s,f)<0}),gc=fn(">",function(c,s,f){return s>f},function(c,s,f,m){return m.compare(s,f)>0}),ml=fn("<=",function(c,s,f){return s<=f},function(c,s,f,m){return m.compare(s,f)<=0}),Oh=fn(">=",function(c,s,f){return s>=f},function(c,s,f,m){return m.compare(s,f)>=0});class yl{constructor(s,f,m,x,P){this.type=Yt,this.number=s,this.locale=f,this.currency=m,this.minFractionDigits=x,this.maxFractionDigits=P}static parse(s,f){if(s.length!==3)return f.error("Expected two arguments.");const m=f.parse(s[1],1,nt);if(!m)return null;const x=s[2];if(typeof x!="object"||Array.isArray(x))return f.error("NumberFormat options argument must be an object.");let P=null;if(x.locale&&(P=f.parse(x.locale,1,Yt),!P))return null;let M=null;if(x.currency&&(M=f.parse(x.currency,1,Yt),!M))return null;let D=null;if(x["min-fraction-digits"]&&(D=f.parse(x["min-fraction-digits"],1,nt),!D))return null;let O=null;return x["max-fraction-digits"]&&(O=f.parse(x["max-fraction-digits"],1,nt),!O)?null:new yl(m,P,M,D,O)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Ko{constructor(s){this.type=fe,this.sections=s}static parse(s,f){if(s.length<2)return f.error("Expected at least one argument.");const m=s[1];if(!Array.isArray(m)&&typeof m=="object")return f.error("First argument must be an image or text section.");const x=[];let P=!1;for(let M=1;M<=s.length-1;++M){const D=s[M];if(P&&typeof D=="object"&&!Array.isArray(D)){P=!1;let O=null;if(D["font-scale"]&&(O=f.parse(D["font-scale"],1,nt),!O))return null;let N=null;if(D["text-font"]&&(N=f.parse(D["text-font"],1,pe(Yt)),!N))return null;let j=null;if(D["text-color"]&&(j=f.parse(D["text-color"],1,Ar),!j))return null;const $=x[x.length-1];$.scale=O,$.font=N,$.textColor=j}else{const O=f.parse(s[M],1,Gt);if(!O)return null;const N=O.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");P=!0,x.push({content:O,scale:null,font:null,textColor:null})}}return new Ko(x)}evaluate(s){return new bi(this.sections.map(f=>{const m=f.content.evaluate(s);return Pi(m)===Q?new jr("",m,null,null,null):new jr(fi(m),null,f.scale?f.scale.evaluate(s):null,f.font?f.font.evaluate(s).join(","):null,f.textColor?f.textColor.evaluate(s):null)}))}eachChild(s){for(const f of this.sections)s(f.content),f.scale&&s(f.scale),f.font&&s(f.font),f.textColor&&s(f.textColor)}outputDefined(){return!1}}class bl{constructor(s){this.type=Q,this.input=s}static parse(s,f){if(s.length!==2)return f.error("Expected two arguments.");const m=f.parse(s[1],1,Yt);return m?new bl(m):f.error("No image name provided.")}evaluate(s){const f=this.input.evaluate(s),m=Ti.fromString(f);return m&&s.availableImages&&(m.available=s.availableImages.indexOf(f)>-1),m}eachChild(s){s(this.input)}outputDefined(){return!1}}class vl{constructor(s){this.type=nt,this.input=s}static parse(s,f){if(s.length!==2)return f.error(`Expected 1 argument, but found ${s.length-1} instead.`);const m=f.parse(s[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${ge(m.type)} instead.`):new vl(m):null}evaluate(s){const f=this.input.evaluate(s);if(typeof f=="string"||Array.isArray(f))return f.length;throw new Ii(`Expected value to be of type string or array, but found ${ge(Pi(f))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const yo={"==":Gn,"!=":kn,">":gc,"<":pc,">=":Oh,"<=":ml,array:Gr,at:dl,boolean:Gr,case:mo,coalesce:Qo,collator:te,format:Ko,image:bl,in:pl,"index-of":ka,interpolate:Di,"interpolate-hcl":Di,"interpolate-lab":Di,length:vl,let:Yn,literal:re,match:Da,number:Gr,"number-format":yl,object:Gr,slice:sn,step:Rn,string:Gr,"to-boolean":ws,"to-color":ws,"to-number":ws,"to-string":ws,var:po,within:An};function _c(c,[s,f,m,x]){s=s.evaluate(c),f=f.evaluate(c),m=m.evaluate(c);const P=x?x.evaluate(c):1,M=un(s,f,m,P);if(M)throw new Ii(M);return new Qt(s/255,f/255,m/255,P,!1)}function mc(c,s){return c in s}function xl(c,s){const f=s[c];return f===void 0?null:f}function Qn(c){return{type:c}}function yc(c){return{result:"success",value:c}}function Us(c){return{result:"error",value:c}}function bo(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function bc(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function wl(c){return!!c.expression&&c.expression.interpolated}function di(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function ji(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Tl(c){return c}function li(c,s){const f=s.type==="color",m=c.stops&&typeof c.stops[0][0]=="object",x=m||!(m||c.property!==void 0),P=c.type||(wl(s)?"exponential":"interval");if(f||s.type==="padding"){const j=f?Qt.parse:Wt.parse;(c=vs({},c)).stops&&(c.stops=c.stops.map($=>[$[0],j($[1])])),c.default=j(c.default?c.default:s.default)}if(c.colorSpace&&(M=c.colorSpace)!=="rgb"&&M!=="hcl"&&M!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var M;let D,O,N;if(P==="exponential")D=vo;else if(P==="interval")D=Bi;else if(P==="categorical"){D=$i,O=Object.create(null);for(const j of c.stops)O[j[0]]=j[1];N=typeof c.stops[0][0]}else{if(P!=="identity")throw new Error(`Unknown function type "${P}"`);D=vc}if(m){const j={},$=[];for(let ee=0;ee<c.stops.length;ee++){const ce=c.stops[ee],_e=ce[0].zoom;j[_e]===void 0&&(j[_e]={zoom:_e,type:c.type,property:c.property,default:c.default,stops:[]},$.push(_e)),j[_e].stops.push([ce[0].value,ce[1]])}const Z=[];for(const ee of $)Z.push([j[ee].zoom,li(j[ee],s)]);const J={name:"linear"};return{kind:"composite",interpolationType:J,interpolationFactor:Di.interpolationFactor.bind(void 0,J),zoomStops:Z.map(ee=>ee[0]),evaluate:({zoom:ee},ce)=>vo({stops:Z,base:c.base},s,ee).evaluate(ee,ce)}}if(x){const j=P==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:Di.interpolationFactor.bind(void 0,j),zoomStops:c.stops.map($=>$[0]),evaluate:({zoom:$})=>D(c,s,$,O,N)}}return{kind:"source",evaluate(j,$){const Z=$&&$.properties?$.properties[c.property]:void 0;return Z===void 0?Es(c.default,s.default):D(c,s,Z,O,N)}}}function Es(c,s,f){return c!==void 0?c:s!==void 0?s:f!==void 0?f:void 0}function $i(c,s,f,m,x){return Es(typeof f===x?m[f]:void 0,c.default,s.default)}function Bi(c,s,f){if(di(f)!=="number")return Es(c.default,s.default);const m=c.stops.length;if(m===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[m-1][0])return c.stops[m-1][1];const x=_o(c.stops.map(P=>P[0]),f);return c.stops[x][1]}function vo(c,s,f){const m=c.base!==void 0?c.base:1;if(di(f)!=="number")return Es(c.default,s.default);const x=c.stops.length;if(x===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[x-1][0])return c.stops[x-1][1];const P=_o(c.stops.map(j=>j[0]),f),M=function(j,$,Z,J){const ee=J-Z,ce=j-Z;return ee===0?0:$===1?ce/ee:(Math.pow($,ce)-1)/(Math.pow($,ee)-1)}(f,m,c.stops[P][0],c.stops[P+1][0]),D=c.stops[P][1],O=c.stops[P+1][1],N=dr[s.type]||Tl;return typeof D.evaluate=="function"?{evaluate(...j){const $=D.evaluate.apply(void 0,j),Z=O.evaluate.apply(void 0,j);if($!==void 0&&Z!==void 0)return N($,Z,M,c.colorSpace)}}:N(D,O,M,c.colorSpace)}function vc(c,s,f){switch(s.type){case"color":f=Qt.parse(f);break;case"formatted":f=bi.fromString(f.toString());break;case"resolvedImage":f=Ti.fromString(f.toString());break;case"padding":f=Wt.parse(f);break;default:di(f)===s.type||s.type==="enum"&&s.values[f]||(f=void 0)}return Es(f,c.default,s.default)}Ts.register(yo,{error:[{kind:"error"},[Yt],(c,[s])=>{throw new Ii(s.evaluate(c))}],typeof:[Yt,[Gt],(c,[s])=>ge(Pi(s.evaluate(c)))],"to-rgba":[pe(nt,4),[Ar],(c,[s])=>{const[f,m,x,P]=s.evaluate(c).rgb;return[255*f,255*m,255*x,P]}],rgb:[Ar,[nt,nt,nt],_c],rgba:[Ar,[nt,nt,nt,nt],_c],has:{type:Xt,overloads:[[[Yt],(c,[s])=>mc(s.evaluate(c),c.properties())],[[Yt,ns],(c,[s,f])=>mc(s.evaluate(c),f.evaluate(c))]]},get:{type:Gt,overloads:[[[Yt],(c,[s])=>xl(s.evaluate(c),c.properties())],[[Yt,ns],(c,[s,f])=>xl(s.evaluate(c),f.evaluate(c))]]},"feature-state":[Gt,[Yt],(c,[s])=>xl(s.evaluate(c),c.featureState||{})],properties:[ns,[],c=>c.properties()],"geometry-type":[Yt,[],c=>c.geometryType()],id:[Gt,[],c=>c.id()],zoom:[nt,[],c=>c.globals.zoom],"heatmap-density":[nt,[],c=>c.globals.heatmapDensity||0],"line-progress":[nt,[],c=>c.globals.lineProgress||0],accumulated:[Gt,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[nt,Qn(nt),(c,s)=>{let f=0;for(const m of s)f+=m.evaluate(c);return f}],"*":[nt,Qn(nt),(c,s)=>{let f=1;for(const m of s)f*=m.evaluate(c);return f}],"-":{type:nt,overloads:[[[nt,nt],(c,[s,f])=>s.evaluate(c)-f.evaluate(c)],[[nt],(c,[s])=>-s.evaluate(c)]]},"/":[nt,[nt,nt],(c,[s,f])=>s.evaluate(c)/f.evaluate(c)],"%":[nt,[nt,nt],(c,[s,f])=>s.evaluate(c)%f.evaluate(c)],ln2:[nt,[],()=>Math.LN2],pi:[nt,[],()=>Math.PI],e:[nt,[],()=>Math.E],"^":[nt,[nt,nt],(c,[s,f])=>Math.pow(s.evaluate(c),f.evaluate(c))],sqrt:[nt,[nt],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[nt,[nt],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[nt,[nt],(c,[s])=>Math.log(s.evaluate(c))],log2:[nt,[nt],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[nt,[nt],(c,[s])=>Math.sin(s.evaluate(c))],cos:[nt,[nt],(c,[s])=>Math.cos(s.evaluate(c))],tan:[nt,[nt],(c,[s])=>Math.tan(s.evaluate(c))],asin:[nt,[nt],(c,[s])=>Math.asin(s.evaluate(c))],acos:[nt,[nt],(c,[s])=>Math.acos(s.evaluate(c))],atan:[nt,[nt],(c,[s])=>Math.atan(s.evaluate(c))],min:[nt,Qn(nt),(c,s)=>Math.min(...s.map(f=>f.evaluate(c)))],max:[nt,Qn(nt),(c,s)=>Math.max(...s.map(f=>f.evaluate(c)))],abs:[nt,[nt],(c,[s])=>Math.abs(s.evaluate(c))],round:[nt,[nt],(c,[s])=>{const f=s.evaluate(c);return f<0?-Math.round(-f):Math.round(f)}],floor:[nt,[nt],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[nt,[nt],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[Xt,[Yt,Gt],(c,[s,f])=>c.properties()[s.value]===f.value],"filter-id-==":[Xt,[Gt],(c,[s])=>c.id()===s.value],"filter-type-==":[Xt,[Yt],(c,[s])=>c.geometryType()===s.value],"filter-<":[Xt,[Yt,Gt],(c,[s,f])=>{const m=c.properties()[s.value],x=f.value;return typeof m==typeof x&&m<x}],"filter-id-<":[Xt,[Gt],(c,[s])=>{const f=c.id(),m=s.value;return typeof f==typeof m&&f<m}],"filter->":[Xt,[Yt,Gt],(c,[s,f])=>{const m=c.properties()[s.value],x=f.value;return typeof m==typeof x&&m>x}],"filter-id->":[Xt,[Gt],(c,[s])=>{const f=c.id(),m=s.value;return typeof f==typeof m&&f>m}],"filter-<=":[Xt,[Yt,Gt],(c,[s,f])=>{const m=c.properties()[s.value],x=f.value;return typeof m==typeof x&&m<=x}],"filter-id-<=":[Xt,[Gt],(c,[s])=>{const f=c.id(),m=s.value;return typeof f==typeof m&&f<=m}],"filter->=":[Xt,[Yt,Gt],(c,[s,f])=>{const m=c.properties()[s.value],x=f.value;return typeof m==typeof x&&m>=x}],"filter-id->=":[Xt,[Gt],(c,[s])=>{const f=c.id(),m=s.value;return typeof f==typeof m&&f>=m}],"filter-has":[Xt,[Gt],(c,[s])=>s.value in c.properties()],"filter-has-id":[Xt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Xt,[pe(Yt)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[Xt,[pe(Gt)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[Xt,[Yt,pe(Gt)],(c,[s,f])=>f.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[Xt,[Yt,pe(Gt)],(c,[s,f])=>function(m,x,P,M){for(;P<=M;){const D=P+M>>1;if(x[D]===m)return!0;x[D]>m?M=D-1:P=D+1}return!1}(c.properties()[s.value],f.value,0,f.value.length-1)],all:{type:Xt,overloads:[[[Xt,Xt],(c,[s,f])=>s.evaluate(c)&&f.evaluate(c)],[Qn(Xt),(c,s)=>{for(const f of s)if(!f.evaluate(c))return!1;return!0}]]},any:{type:Xt,overloads:[[[Xt,Xt],(c,[s,f])=>s.evaluate(c)||f.evaluate(c)],[Qn(Xt),(c,s)=>{for(const f of s)if(f.evaluate(c))return!0;return!1}]]},"!":[Xt,[Xt],(c,[s])=>!s.evaluate(c)],"is-supported-script":[Xt,[Yt],(c,[s])=>{const f=c.globals&&c.globals.isSupportedScript;return!f||f(s.evaluate(c))}],upcase:[Yt,[Yt],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[Yt,[Yt],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[Yt,Qn(Gt),(c,s)=>s.map(f=>fi(f.evaluate(c))).join("")],"resolved-locale":[Yt,[Ke],(c,[s])=>s.evaluate(c).resolvedLocale()]});class Ba{constructor(s,f){var m;this.expression=s,this._warningHistory={},this._evaluator=new fo,this._defaultValue=f?(m=f).type==="color"&&ji(m.default)?new Qt(0,0,0,0):m.type==="color"?Qt.parse(m.default)||null:m.type==="padding"?Wt.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?Pt.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(s,f,m,x,P,M){return this._evaluator.globals=s,this._evaluator.feature=f,this._evaluator.featureState=m,this._evaluator.canonical=x,this._evaluator.availableImages=P||null,this._evaluator.formattedSection=M,this.expression.evaluate(this._evaluator)}evaluate(s,f,m,x,P,M){this._evaluator.globals=s,this._evaluator.feature=f||null,this._evaluator.featureState=m||null,this._evaluator.canonical=x,this._evaluator.availableImages=P||null,this._evaluator.formattedSection=M||null;try{const D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Ii(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function xo(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in yo}function wo(c,s){const f=new Zn(yo,Ra,[],s?function(x){const P={color:Ar,string:Yt,number:nt,enum:Yt,boolean:Xt,formatted:fe,padding:X,resolvedImage:Q,variableAnchorOffsetCollection:ae};return x.type==="array"?pe(P[x.value]||Gt,x.length):P[x.type]}(s):void 0),m=f.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?yc(new Ba(m,s)):Us(f.errors)}class To{constructor(s,f){this.kind=s,this._styleExpression=f,this.isStateDependent=s!=="constant"&&!go(f.expression)}evaluateWithoutErrorHandling(s,f,m,x,P,M){return this._styleExpression.evaluateWithoutErrorHandling(s,f,m,x,P,M)}evaluate(s,f,m,x,P,M){return this._styleExpression.evaluate(s,f,m,x,P,M)}}class Ci{constructor(s,f,m,x){this.kind=s,this.zoomStops=m,this._styleExpression=f,this.isStateDependent=s!=="camera"&&!go(f.expression),this.interpolationType=x}evaluateWithoutErrorHandling(s,f,m,x,P,M){return this._styleExpression.evaluateWithoutErrorHandling(s,f,m,x,P,M)}evaluate(s,f,m,x,P,M){return this._styleExpression.evaluate(s,f,m,x,P,M)}interpolationFactor(s,f,m){return this.interpolationType?Di.interpolationFactor(this.interpolationType,s,f,m):0}}function El(c,s){const f=wo(c,s);if(f.result==="error")return f;const m=f.value.expression,x=Zo(m);if(!x&&!bo(s))return Us([new Ui("","data expressions not supported")]);const P=Yo(m,["zoom"]);if(!P&&!bc(s))return Us([new Ui("","zoom expressions not supported")]);const M=ea(m);return M||P?M instanceof Ui?Us([M]):M instanceof Di&&!wl(s)?Us([new Ui("",'"interpolate" expressions cannot be used with this property')]):yc(M?new Ci(x?"camera":"composite",f.value,M.labels,M instanceof Di?M.interpolation:void 0):new To(x?"constant":"source",f.value)):Us([new Ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Jo{constructor(s,f){this._parameters=s,this._specification=f,vs(this,li(this._parameters,this._specification))}static deserialize(s){return new Jo(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function ea(c){let s=null;if(c instanceof Yn)s=ea(c.result);else if(c instanceof Qo){for(const f of c.args)if(s=ea(f),s)break}else(c instanceof Rn||c instanceof Di)&&c.input instanceof Ts&&c.input.name==="zoom"&&(s=c);return s instanceof Ui||c.eachChild(f=>{const m=ea(f);m instanceof Ui?s=m:!s&&m?s=new Ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&m&&s!==m&&(s=new Ui("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function ta(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!ta(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Lh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Sl(c){if(c==null)return{filter:()=>!0,needGeometry:!1};ta(c)||(c=Eo(c));const s=wo(c,Lh);if(s.result==="error")throw new Error(s.value.map(f=>`${f.key}: ${f.message}`).join(", "));return{filter:(f,m,x)=>s.value.evaluate(f,m,{},x),needGeometry:$r(c)}}function Nh(c,s){return c<s?-1:c>s?1:0}function $r(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let s=1;s<c.length;s++)if($r(c[s]))return!0;return!1}function Eo(c){if(!c)return!0;const s=c[0];return c.length<=1?s!=="any":s==="=="?dn(c[1],c[2],"=="):s==="!="?ia(dn(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?dn(c[1],c[2],s):s==="any"?(f=c.slice(1),["any"].concat(f.map(Eo))):s==="all"?["all"].concat(c.slice(1).map(Eo)):s==="none"?["all"].concat(c.slice(1).map(Eo).map(ia)):s==="in"?xc(c[1],c.slice(2)):s==="!in"?ia(xc(c[1],c.slice(2))):s==="has"?Fa(c[1]):s==="!has"?ia(Fa(c[1])):s!=="within"||c;var f}function dn(c,s,f){switch(c){case"$type":return[`filter-type-${f}`,s];case"$id":return[`filter-id-${f}`,s];default:return[`filter-${f}`,c,s]}}function xc(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(f=>typeof f!=typeof s[0])?["filter-in-large",c,["literal",s.sort(Nh)]]:["filter-in-small",c,["literal",s]]}}function Fa(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function ia(c){return["!",c]}function Wr(c){const s=typeof c;if(s==="number"||s==="boolean"||s==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let x="[";for(const P of c)x+=`${Wr(P)},`;return`${x}]`}const f=Object.keys(c).sort();let m="{";for(let x=0;x<f.length;x++)m+=`${JSON.stringify(f[x])}:${Wr(c[f[x]])},`;return`${m}}`}function ra(c){let s="";for(const f of _i)s+=`/${Wr(c[f])}`;return s}function Oa(c){const s=c.value;return s?[new st(c.key,s,"constants have been deprecated as of v8")]:[]}function Mi(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Vs(c){if(Array.isArray(c))return c.map(Vs);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const f in c)s[f]=Vs(c[f]);return s}return Mi(c)}function yr(c){const s=c.key,f=c.value,m=c.valueSpec||{},x=c.objectElementValidators||{},P=c.style,M=c.styleSpec,D=c.validateSpec;let O=[];const N=di(f);if(N!=="object")return[new st(s,f,`object expected, ${N} found`)];for(const j in f){const $=j.split(".")[0],Z=m[$]||m["*"];let J;if(x[$])J=x[$];else if(m[$])J=D;else if(x["*"])J=x["*"];else{if(!m["*"]){O.push(new st(s,f[j],`unknown property "${j}"`));continue}J=D}O=O.concat(J({key:(s&&`${s}.`)+j,value:f[j],valueSpec:Z,style:P,styleSpec:M,object:f,objectKey:j,validateSpec:D},f))}for(const j in m)x[j]||m[j].required&&m[j].default===void 0&&f[j]===void 0&&O.push(new st(s,f,`missing required property "${j}"`));return O}function So(c){const s=c.value,f=c.valueSpec,m=c.style,x=c.styleSpec,P=c.key,M=c.arrayElementValidator||c.validateSpec;if(di(s)!=="array")return[new st(P,s,`array expected, ${di(s)} found`)];if(f.length&&s.length!==f.length)return[new st(P,s,`array length ${f.length} expected, length ${s.length} found`)];if(f["min-length"]&&s.length<f["min-length"])return[new st(P,s,`array length at least ${f["min-length"]} expected, length ${s.length} found`)];let D={type:f.value,values:f.values};x.$version<7&&(D.function=f.function),di(f.value)==="object"&&(D=f.value);let O=[];for(let N=0;N<s.length;N++)O=O.concat(M({array:s,arrayIndex:N,value:s[N],valueSpec:D,validateSpec:c.validateSpec,style:m,styleSpec:x,key:`${P}[${N}]`}));return O}function Co(c){const s=c.key,f=c.value,m=c.valueSpec;let x=di(f);return x==="number"&&f!=f&&(x="NaN"),x!=="number"?[new st(s,f,`number expected, ${x} found`)]:"minimum"in m&&f<m.minimum?[new st(s,f,`${f} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&f>m.maximum?[new st(s,f,`${f} is greater than the maximum value ${m.maximum}`)]:[]}function La(c){const s=c.valueSpec,f=Mi(c.value.type);let m,x,P,M={};const D=f!=="categorical"&&c.value.property===void 0,O=!D,N=di(c.value.stops)==="array"&&di(c.value.stops[0])==="array"&&di(c.value.stops[0][0])==="object",j=yr({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(J){if(f==="identity")return[new st(J.key,J.value,'identity function may not have a "stops" property')];let ee=[];const ce=J.value;return ee=ee.concat(So({key:J.key,value:ce,valueSpec:J.valueSpec,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:$})),di(ce)==="array"&&ce.length===0&&ee.push(new st(J.key,ce,"array must have at least one stop")),ee},default:function(J){return J.validateSpec({key:J.key,value:J.value,valueSpec:s,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec})}}});return f==="identity"&&D&&j.push(new st(c.key,c.value,'missing required property "property"')),f==="identity"||c.value.stops||j.push(new st(c.key,c.value,'missing required property "stops"')),f==="exponential"&&c.valueSpec.expression&&!wl(c.valueSpec)&&j.push(new st(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(O&&!bo(c.valueSpec)?j.push(new st(c.key,c.value,"property functions not supported")):D&&!bc(c.valueSpec)&&j.push(new st(c.key,c.value,"zoom functions not supported"))),f!=="categorical"&&!N||c.value.property!==void 0||j.push(new st(c.key,c.value,'"property" property is required')),j;function $(J){let ee=[];const ce=J.value,_e=J.key;if(di(ce)!=="array")return[new st(_e,ce,`array expected, ${di(ce)} found`)];if(ce.length!==2)return[new st(_e,ce,`array length 2 expected, length ${ce.length} found`)];if(N){if(di(ce[0])!=="object")return[new st(_e,ce,`object expected, ${di(ce[0])} found`)];if(ce[0].zoom===void 0)return[new st(_e,ce,"object stop key must have zoom")];if(ce[0].value===void 0)return[new st(_e,ce,"object stop key must have value")];if(P&&P>Mi(ce[0].zoom))return[new st(_e,ce[0].zoom,"stop zoom values must appear in ascending order")];Mi(ce[0].zoom)!==P&&(P=Mi(ce[0].zoom),x=void 0,M={}),ee=ee.concat(yr({key:`${_e}[0]`,value:ce[0],valueSpec:{zoom:{}},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:Co,value:Z}}))}else ee=ee.concat(Z({key:`${_e}[0]`,value:ce[0],valueSpec:{},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec},ce));return xo(Vs(ce[1]))?ee.concat([new st(`${_e}[1]`,ce[1],"expressions are not allowed in function stops.")]):ee.concat(J.validateSpec({key:`${_e}[1]`,value:ce[1],valueSpec:s,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec}))}function Z(J,ee){const ce=di(J.value),_e=Mi(J.value),xe=J.value!==null?J.value:ee;if(m){if(ce!==m)return[new st(J.key,xe,`${ce} stop domain type must match previous stop domain type ${m}`)]}else m=ce;if(ce!=="number"&&ce!=="string"&&ce!=="boolean")return[new st(J.key,xe,"stop domain value must be a number, string, or boolean")];if(ce!=="number"&&f!=="categorical"){let Re=`number expected, ${ce} found`;return bo(s)&&f===void 0&&(Re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new st(J.key,xe,Re)]}return f!=="categorical"||ce!=="number"||isFinite(_e)&&Math.floor(_e)===_e?f!=="categorical"&&ce==="number"&&x!==void 0&&_e<x?[new st(J.key,xe,"stop domain values must appear in ascending order")]:(x=_e,f==="categorical"&&_e in M?[new st(J.key,xe,"stop domain values must be unique")]:(M[_e]=!0,[])):[new st(J.key,xe,`integer expected, found ${_e}`)]}}function pn(c){const s=(c.expressionContext==="property"?El:wo)(Vs(c.value),c.valueSpec);if(s.result==="error")return s.value.map(m=>new st(`${c.key}${m.key}`,c.value,m.message));const f=s.value.expression||s.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!f.outputDefined())return[new st(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!go(f))return[new st(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!go(f))return[new st(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Yo(f,["zoom","feature-state"]))return[new st(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Zo(f))return[new st(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function sa(c){const s=c.key,f=c.value,m=c.valueSpec,x=[];return Array.isArray(m.values)?m.values.indexOf(Mi(f))===-1&&x.push(new st(s,f,`expected one of [${m.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(m.values).indexOf(Mi(f))===-1&&x.push(new st(s,f,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(f)} found`)),x}function Po(c){return ta(Vs(c.value))?pn(vs({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cl(c)}function Cl(c){const s=c.value,f=c.key;if(di(s)!=="array")return[new st(f,s,`array expected, ${di(s)} found`)];const m=c.styleSpec;let x,P=[];if(s.length<1)return[new st(f,s,"filter array must have at least 1 element")];switch(P=P.concat(sa({key:`${f}[0]`,value:s[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),Mi(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&Mi(s[1])==="$type"&&P.push(new st(f,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&P.push(new st(f,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(x=di(s[1]),x!=="string"&&P.push(new st(`${f}[1]`,s[1],`string expected, ${x} found`)));for(let M=2;M<s.length;M++)x=di(s[M]),Mi(s[1])==="$type"?P=P.concat(sa({key:`${f}[${M}]`,value:s[M],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&P.push(new st(`${f}[${M}]`,s[M],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let M=1;M<s.length;M++)P=P.concat(Cl({key:`${f}[${M}]`,value:s[M],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":x=di(s[1]),s.length!==2?P.push(new st(f,s,`filter array for "${s[0]}" operator must have 2 elements`)):x!=="string"&&P.push(new st(`${f}[1]`,s[1],`string expected, ${x} found`));break;case"within":x=di(s[1]),s.length!==2?P.push(new st(f,s,`filter array for "${s[0]}" operator must have 2 elements`)):x!=="object"&&P.push(new st(`${f}[1]`,s[1],`object expected, ${x} found`))}return P}function Pl(c,s){const f=c.key,m=c.validateSpec,x=c.style,P=c.styleSpec,M=c.value,D=c.objectKey,O=P[`${s}_${c.layerType}`];if(!O)return[];const N=D.match(/^(.*)-transition$/);if(s==="paint"&&N&&O[N[1]]&&O[N[1]].transition)return m({key:f,value:M,valueSpec:P.transition,style:x,styleSpec:P});const j=c.valueSpec||O[D];if(!j)return[new st(f,M,`unknown property "${D}"`)];let $;if(di(M)==="string"&&bo(j)&&!j.tokens&&($=/^{([^}]+)}$/.exec(M)))return[new st(f,M,`"${D}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify($[1])} }\`.`)];const Z=[];return c.layerType==="symbol"&&(D==="text-field"&&x&&!x.glyphs&&Z.push(new st(f,M,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&ji(Vs(M))&&Mi(M.type)==="identity"&&Z.push(new st(f,M,'"text-font" does not support identity functions'))),Z.concat(m({key:c.key,value:M,valueSpec:j,style:x,styleSpec:P,expressionContext:"property",propertyType:s,propertyKey:D}))}function Io(c){return Pl(c,"paint")}function Kn(c){return Pl(c,"layout")}function wc(c){let s=[];const f=c.value,m=c.key,x=c.style,P=c.styleSpec;f.type||f.ref||s.push(new st(m,f,'either "type" or "ref" is required'));let M=Mi(f.type);const D=Mi(f.ref);if(f.id){const O=Mi(f.id);for(let N=0;N<c.arrayIndex;N++){const j=x.layers[N];Mi(j.id)===O&&s.push(new st(m,f.id,`duplicate layer id "${f.id}", previously used at line ${j.id.__line__}`))}}if("ref"in f){let O;["type","source","source-layer","filter","layout"].forEach(N=>{N in f&&s.push(new st(m,f[N],`"${N}" is prohibited for ref layers`))}),x.layers.forEach(N=>{Mi(N.id)===D&&(O=N)}),O?O.ref?s.push(new st(m,f.ref,"ref cannot reference another ref layer")):M=Mi(O.type):s.push(new st(m,f.ref,`ref layer "${D}" not found`))}else if(M!=="background")if(f.source){const O=x.sources&&x.sources[f.source],N=O&&Mi(O.type);O?N==="vector"&&M==="raster"?s.push(new st(m,f.source,`layer "${f.id}" requires a raster source`)):N!=="raster-dem"&&M==="hillshade"?s.push(new st(m,f.source,`layer "${f.id}" requires a raster-dem source`)):N==="raster"&&M!=="raster"?s.push(new st(m,f.source,`layer "${f.id}" requires a vector source`)):N!=="vector"||f["source-layer"]?N==="raster-dem"&&M!=="hillshade"?s.push(new st(m,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!f.paint||!f.paint["line-gradient"]||N==="geojson"&&O.lineMetrics||s.push(new st(m,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new st(m,f,`layer "${f.id}" must specify a "source-layer"`)):s.push(new st(m,f.source,`source "${f.source}" not found`))}else s.push(new st(m,f,'missing required property "source"'));return s=s.concat(yr({key:m,value:f,valueSpec:P.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${m}.type`,value:f.type,valueSpec:P.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:f,objectKey:"type"}),filter:Po,layout:O=>yr({layer:f,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,validateSpec:O.validateSpec,objectElementValidators:{"*":N=>Kn(vs({layerType:M},N))}}),paint:O=>yr({layer:f,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,validateSpec:O.validateSpec,objectElementValidators:{"*":N=>Io(vs({layerType:M},N))}})}})),s}function Qr(c){const s=c.value,f=c.key,m=di(s);return m!=="string"?[new st(f,s,`string expected, ${m} found`)]:[]}const na={promoteId:function({key:c,value:s}){if(di(s)==="string")return Qr({key:c,value:s});{const f=[];for(const m in s)f.push(...Qr({key:`${c}.${m}`,value:s[m]}));return f}}};function os(c){const s=c.value,f=c.key,m=c.styleSpec,x=c.style,P=c.validateSpec;if(!s.type)return[new st(f,s,'"type" is required')];const M=Mi(s.type);let D;switch(M){case"vector":case"raster":return D=yr({key:f,value:s,valueSpec:m[`source_${M.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:na,validateSpec:P}),D;case"raster-dem":return D=function(O){var N;const j=(N=O.sourceName)!==null&&N!==void 0?N:"",$=O.value,Z=O.styleSpec,J=Z.source_raster_dem,ee=O.style;let ce=[];const _e=di($);if($===void 0)return ce;if(_e!=="object")return ce.push(new st("source_raster_dem",$,`object expected, ${_e} found`)),ce;const xe=Mi($.encoding)==="custom",Re=["redFactor","greenFactor","blueFactor","baseShift"],Ie=O.value.encoding?`"${O.value.encoding}"`:"Default";for(const De in $)!xe&&Re.includes(De)?ce.push(new st(De,$[De],`In "${j}": "${De}" is only valid when "encoding" is set to "custom". ${Ie} encoding found`)):J[De]?ce=ce.concat(O.validateSpec({key:De,value:$[De],valueSpec:J[De],validateSpec:O.validateSpec,style:ee,styleSpec:Z})):ce.push(new st(De,$[De],`unknown property "${De}"`));return ce}({sourceName:f,value:s,style:c.style,styleSpec:m,validateSpec:P}),D;case"geojson":if(D=yr({key:f,value:s,valueSpec:m.source_geojson,style:x,styleSpec:m,validateSpec:P,objectElementValidators:na}),s.cluster)for(const O in s.clusterProperties){const[N,j]=s.clusterProperties[O],$=typeof N=="string"?[N,["accumulated"],["get",O]]:N;D.push(...pn({key:`${f}.${O}.map`,value:j,validateSpec:P,expressionContext:"cluster-map"})),D.push(...pn({key:`${f}.${O}.reduce`,value:$,validateSpec:P,expressionContext:"cluster-reduce"}))}return D;case"video":return yr({key:f,value:s,valueSpec:m.source_video,style:x,validateSpec:P,styleSpec:m});case"image":return yr({key:f,value:s,valueSpec:m.source_image,style:x,validateSpec:P,styleSpec:m});case"canvas":return[new st(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return sa({key:`${f}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:x,validateSpec:P,styleSpec:m})}}function oa(c){const s=c.value,f=c.styleSpec,m=f.light,x=c.style;let P=[];const M=di(s);if(s===void 0)return P;if(M!=="object")return P=P.concat([new st("light",s,`object expected, ${M} found`)]),P;for(const D in s){const O=D.match(/^(.*)-transition$/);P=P.concat(O&&m[O[1]]&&m[O[1]].transition?c.validateSpec({key:D,value:s[D],valueSpec:f.transition,validateSpec:c.validateSpec,style:x,styleSpec:f}):m[D]?c.validateSpec({key:D,value:s[D],valueSpec:m[D],validateSpec:c.validateSpec,style:x,styleSpec:f}):[new st(D,s[D],`unknown property "${D}"`)])}return P}function Tc(c){const s=c.value,f=c.styleSpec,m=f.terrain,x=c.style;let P=[];const M=di(s);if(s===void 0)return P;if(M!=="object")return P=P.concat([new st("terrain",s,`object expected, ${M} found`)]),P;for(const D in s)P=P.concat(m[D]?c.validateSpec({key:D,value:s[D],valueSpec:m[D],validateSpec:c.validateSpec,style:x,styleSpec:f}):[new st(D,s[D],`unknown property "${D}"`)]);return P}function Ec(c){let s=[];const f=c.value,m=c.key;if(Array.isArray(f)){const x=[],P=[];for(const M in f)f[M].id&&x.includes(f[M].id)&&s.push(new st(m,f,`all the sprites' ids must be unique, but ${f[M].id} is duplicated`)),x.push(f[M].id),f[M].url&&P.includes(f[M].url)&&s.push(new st(m,f,`all the sprites' URLs must be unique, but ${f[M].url} is duplicated`)),P.push(f[M].url),s=s.concat(yr({key:`${m}[${M}]`,value:f[M],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return s}return Qr({key:m,value:f})}const Sc={"*":()=>[],array:So,boolean:function(c){const s=c.value,f=c.key,m=di(s);return m!=="boolean"?[new st(f,s,`boolean expected, ${m} found`)]:[]},number:Co,color:function(c){const s=c.key,f=c.value,m=di(f);return m!=="string"?[new st(s,f,`color expected, ${m} found`)]:Qt.parse(String(f))?[]:[new st(s,f,`color expected, "${f}" found`)]},constants:Oa,enum:sa,filter:Po,function:La,layer:wc,object:yr,source:os,light:oa,terrain:Tc,string:Qr,formatted:function(c){return Qr(c).length===0?[]:pn(c)},resolvedImage:function(c){return Qr(c).length===0?[]:pn(c)},padding:function(c){const s=c.key,f=c.value;if(di(f)==="array"){if(f.length<1||f.length>4)return[new st(s,f,`padding requires 1 to 4 values; ${f.length} values found`)];const m={type:"number"};let x=[];for(let P=0;P<f.length;P++)x=x.concat(c.validateSpec({key:`${s}[${P}]`,value:f[P],validateSpec:c.validateSpec,valueSpec:m}));return x}return Co({key:s,value:f,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const s=c.key,f=c.value,m=di(f),x=c.styleSpec;if(m!=="array"||f.length<1||f.length%2!=0)return[new st(s,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let P=[];for(let M=0;M<f.length;M+=2)P=P.concat(sa({key:`${s}[${M}]`,value:f[M],valueSpec:x.layout_symbol["text-anchor"]})),P=P.concat(So({key:`${s}[${M+1}]`,value:f[M+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:x}));return P},sprite:Ec};function gn(c){const s=c.value,f=c.valueSpec,m=c.styleSpec;return c.validateSpec=gn,f.expression&&ji(Mi(s))?La(c):f.expression&&xo(Vs(s))?pn(c):f.type&&Sc[f.type]?Sc[f.type](c):yr(vs({},c,{valueSpec:f.type?m[f.type]:f}))}function Na(c){const s=c.value,f=c.key,m=Qr(c);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new st(f,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new st(f,s,'"glyphs" url must include a "{range}" token'))),m}function as(c,s=Xe){let f=[];return f=f.concat(gn({key:"",value:c,valueSpec:s.$root,styleSpec:s,style:c,validateSpec:gn,objectElementValidators:{glyphs:Na,"*":()=>[]}})),c.constants&&(f=f.concat(Oa({key:"constants",value:c.constants,style:c,styleSpec:s,validateSpec:gn}))),za(f)}function js(c){return function(s){return c({...s,validateSpec:gn})}}function za(c){return[].concat(c).sort((s,f)=>s.line-f.line)}function _n(c){return function(...s){return za(c.apply(this,s))}}as.source=_n(js(os)),as.sprite=_n(js(Ec)),as.glyphs=_n(js(Na)),as.light=_n(js(oa)),as.terrain=_n(js(Tc)),as.layer=_n(js(wc)),as.filter=_n(js(Po)),as.paintProperty=_n(js(Io)),as.layoutProperty=_n(js(Kn));const mn=as,zh=mn.light,Il=mn.paintProperty,Cc=mn.layoutProperty;function Ua(c,s){let f=!1;if(s&&s.length)for(const m of s)c.fire(new Ur(new Error(m.message))),f=!0;return f}class Jn{constructor(s,f,m){const x=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const M=new Int32Array(this.arrayBuffer);s=M[0],this.d=(f=M[1])+2*(m=M[2]);for(let O=0;O<this.d*this.d;O++){const N=M[3+O],j=M[3+O+1];x.push(N===j?null:M.subarray(N,j))}const D=M[3+x.length+1];this.keys=M.subarray(M[3+x.length],D),this.bboxes=M.subarray(D),this.insert=this._insertReadonly}else{this.d=f+2*m;for(let M=0;M<this.d*this.d;M++)x.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=s,this.padding=m,this.scale=f/s,this.uid=0;const P=m/f*s;this.min=-P,this.max=s+P}insert(s,f,m,x,P){this._forEachCell(f,m,x,P,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(P)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,f,m,x,P,M){this.cells[P].push(M)}query(s,f,m,x,P){const M=this.min,D=this.max;if(s<=M&&f<=M&&D<=m&&D<=x&&!P)return Array.prototype.slice.call(this.keys);{const O=[];return this._forEachCell(s,f,m,x,this._queryCell,O,{},P),O}}_queryCell(s,f,m,x,P,M,D,O){const N=this.cells[P];if(N!==null){const j=this.keys,$=this.bboxes;for(let Z=0;Z<N.length;Z++){const J=N[Z];if(D[J]===void 0){const ee=4*J;(O?O($[ee+0],$[ee+1],$[ee+2],$[ee+3]):s<=$[ee+2]&&f<=$[ee+3]&&m>=$[ee+0]&&x>=$[ee+1])?(D[J]=!0,M.push(j[J])):D[J]=!1}}}}_forEachCell(s,f,m,x,P,M,D,O){const N=this._convertToCellCoord(s),j=this._convertToCellCoord(f),$=this._convertToCellCoord(m),Z=this._convertToCellCoord(x);for(let J=N;J<=$;J++)for(let ee=j;ee<=Z;ee++){const ce=this.d*ee+J;if((!O||O(this._convertFromCellCoord(J),this._convertFromCellCoord(ee),this._convertFromCellCoord(J+1),this._convertFromCellCoord(ee+1)))&&P.call(this,s,f,m,x,ce,M,D,O))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,f=3+this.cells.length+1+1;let m=0;for(let M=0;M<this.cells.length;M++)m+=this.cells[M].length;const x=new Int32Array(f+m+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;let P=f;for(let M=0;M<s.length;M++){const D=s[M];x[3+M]=P,x.set(D,P),P+=D.length}return x[3+s.length]=P,x.set(this.keys,P),P+=this.keys.length,x[3+s.length+1]=P,x.set(this.bboxes,P),P+=this.bboxes.length,x.buffer}static serialize(s,f){const m=s.toArrayBuffer();return f&&f.push(m),{buffer:m}}static deserialize(s){return new Jn(s.buffer)}}const yn={};function bt(c,s,f={}){if(yn[c])throw new Error(`${c} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:c,writeable:!1}),yn[c]={klass:s,omit:f.omit||[],shallow:f.shallow||[]}}bt("Object",Object),bt("TransferableGridIndex",Jn),bt("Color",Qt),bt("Error",Error),bt("AJAXError",Dr),bt("ResolvedImage",Ti),bt("StylePropertyFunction",Jo),bt("StyleExpression",Ba,{omit:["_evaluator"]}),bt("ZoomDependentExpression",Ci),bt("ZoomConstantExpression",To),bt("CompoundExpression",Ts,{omit:["_evaluate"]});for(const c in yo)yo[c]._classRegistryKey||bt(`Expression_${c}`,yo[c]);function Ss(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function bn(c,s){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob)return c;if(Ss(c)||Cn(c))return s&&s.push(c),c;if(ArrayBuffer.isView(c)){const f=c;return s&&s.push(f.buffer),f}if(c instanceof ImageData)return s&&s.push(c.data.buffer),c;if(Array.isArray(c)){const f=[];for(const m of c)f.push(bn(m,s));return f}if(typeof c=="object"){const f=c.constructor,m=f._classRegistryKey;if(!m)throw new Error("can't serialize object of unregistered class");if(!yn[m])throw new Error(`${m} is not registered.`);const x=f.serialize?f.serialize(c,s):{};if(f.serialize){if(s&&x===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const P in c){if(!c.hasOwnProperty(P)||yn[m].omit.indexOf(P)>=0)continue;const M=c[P];x[P]=yn[m].shallow.indexOf(P)>=0?M:bn(M,s)}c instanceof Error&&(x.message=c.message)}if(x.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(x.$name=m),x}throw new Error("can't serialize object of type "+typeof c)}function Mo(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||Ss(c)||Cn(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Mo);if(typeof c=="object"){const s=c.$name||"Object";if(!yn[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:f}=yn[s];if(!f)throw new Error(`can't deserialize unregistered class ${s}`);if(f.deserialize)return f.deserialize(c);const m=Object.create(f.prototype);for(const x of Object.keys(c)){if(x==="$name")continue;const P=c[x];m[x]=yn[s].shallow.indexOf(x)>=0?P:Mo(P)}return m}throw new Error("can't deserialize object of type "+typeof c)}class Pc{constructor(){this.first=!0}update(s,f){const m=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=f),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=m,!0))}}const dt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Ml(c){for(const s of c)if(Va(s.charCodeAt(0)))return!0;return!1}function Rl(c){for(const s of c)if(!Dn(s.charCodeAt(0)))return!1;return!0}function Dn(c){return!(dt.Arabic(c)||dt["Arabic Supplement"](c)||dt["Arabic Extended-A"](c)||dt["Arabic Presentation Forms-A"](c)||dt["Arabic Presentation Forms-B"](c))}function Va(c){return!(c!==746&&c!==747&&(c<4352||!(dt["Bopomofo Extended"](c)||dt.Bopomofo(c)||dt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||dt["CJK Compatibility Ideographs"](c)||dt["CJK Compatibility"](c)||dt["CJK Radicals Supplement"](c)||dt["CJK Strokes"](c)||!(!dt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||dt["CJK Unified Ideographs Extension A"](c)||dt["CJK Unified Ideographs"](c)||dt["Enclosed CJK Letters and Months"](c)||dt["Hangul Compatibility Jamo"](c)||dt["Hangul Jamo Extended-A"](c)||dt["Hangul Jamo Extended-B"](c)||dt["Hangul Jamo"](c)||dt["Hangul Syllables"](c)||dt.Hiragana(c)||dt["Ideographic Description Characters"](c)||dt.Kanbun(c)||dt["Kangxi Radicals"](c)||dt["Katakana Phonetic Extensions"](c)||dt.Katakana(c)&&c!==12540||!(!dt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!dt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||dt["Unified Canadian Aboriginal Syllabics"](c)||dt["Unified Canadian Aboriginal Syllabics Extended"](c)||dt["Vertical Forms"](c)||dt["Yijing Hexagram Symbols"](c)||dt["Yi Syllables"](c)||dt["Yi Radicals"](c))))}function kl(c){return!(Va(c)||function(s){return!!(dt["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||dt["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||dt["Letterlike Symbols"](s)||dt["Number Forms"](s)||dt["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||dt["Control Pictures"](s)&&s!==9251||dt["Optical Character Recognition"](s)||dt["Enclosed Alphanumerics"](s)||dt["Geometric Shapes"](s)||dt["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||dt["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||dt["CJK Symbols and Punctuation"](s)||dt.Katakana(s)||dt["Private Use Area"](s)||dt["CJK Compatibility Forms"](s)||dt["Small Form Variants"](s)||dt["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(c))}function Ic(c){return c>=1424&&c<=2303||dt["Arabic Presentation Forms-A"](c)||dt["Arabic Presentation Forms-B"](c)}function Mc(c,s){return!(!s&&Ic(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||dt.Khmer(c))}function Uh(c){for(const s of c)if(Ic(s.charCodeAt(0)))return!0;return!1}const Dl="deferred",Bl="loading",Fl="loaded";let Ol=null,Kr="unavailable",Bn=null;const aa=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(Kr="error"),Ol&&Ol(c)};function Ll(){Ro.fire(new Ki("pluginStateChange",{pluginStatus:Kr,pluginURL:Bn}))}const Ro=new en,ja=function(){return Kr},ir=function(){if(Kr!==Dl||!Bn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Kr=Bl,Ll(),Bn&&Ls({url:Bn},c=>{c?aa(c):(Kr=Fl,Ll())})},ls={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Kr===Fl||ls.applyArabicShaping!=null,isLoading:()=>Kr===Bl,setState(c){if(!hr())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Kr=c.pluginStatus,Bn=c.pluginURL},isParsed(){if(!hr())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return ls.applyArabicShaping!=null&&ls.processBidirectionalText!=null&&ls.processStyledBidirectionalText!=null},getPluginURL(){if(!hr())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Bn}};class zi{constructor(s,f){this.zoom=s,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Pc,this.transition={})}isSupportedScript(s){return function(f,m){for(const x of f)if(!Mc(x.charCodeAt(0),m))return!1;return!0}(s,ls.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,f=s-Math.floor(s),m=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*f}}}class Fn{constructor(s,f){this.property=s,this.value=f,this.expression=function(m,x){if(ji(m))return new Jo(m,x);if(xo(m)){const P=El(m,x);if(P.result==="error")throw new Error(P.value.map(M=>`${M.key}: ${M.message}`).join(", "));return P.value}{let P=m;return x.type==="color"&&typeof m=="string"?P=Qt.parse(m):x.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?x.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(P=Pt.parse(m)):P=Wt.parse(m),{kind:"constant",evaluate:()=>P}}}(f===void 0?s.specification.default:f,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,f,m){return this.property.possiblyEvaluate(this,s,f,m)}}class Jr{constructor(s){this.property=s,this.value=new Fn(s,void 0)}transitioned(s,f){return new kc(this.property,this.value,f,wt({},s.transition,this.transition),s.now)}untransitioned(){return new kc(this.property,this.value,null,{},0)}}class Rc{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return Ot(this._values[s].value.value)}setValue(s,f){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Jr(this._values[s].property)),this._values[s].value=new Fn(this._values[s].property,f===null?void 0:Ot(f))}getTransition(s){return Ot(this._values[s].transition)}setTransition(s,f){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Jr(this._values[s].property)),this._values[s].transition=Ot(f)||void 0}serialize(){const s={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(s[f]=m);const x=this.getTransition(f);x!==void 0&&(s[`${f}-transition`]=x)}return s}transitioned(s,f){const m=new Dc(this._properties);for(const x of Object.keys(this._values))m._values[x]=this._values[x].transitioned(s,f._values[x]);return m}untransitioned(){const s=new Dc(this._properties);for(const f of Object.keys(this._values))s._values[f]=this._values[f].untransitioned();return s}}class kc{constructor(s,f,m,x,P){this.property=s,this.value=f,this.begin=P+x.delay||0,this.end=this.begin+x.duration||0,s.specification.transition&&(x.delay||x.duration)&&(this.prior=m)}possiblyEvaluate(s,f,m){const x=s.now||0,P=this.value.possiblyEvaluate(s,f,m),M=this.prior;if(M){if(x>this.end)return this.prior=null,P;if(this.value.isDataDriven())return this.prior=null,P;if(x<this.begin)return M.possiblyEvaluate(s,f,m);{const D=(x-this.begin)/(this.end-this.begin);return this.property.interpolate(M.possiblyEvaluate(s,f,m),P,function(O){if(O<=0)return 0;if(O>=1)return 1;const N=O*O,j=N*O;return 4*(O<.5?j:3*(O-N)+j-.75)}(D))}}return P}}class Dc{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,f,m){const x=new la(this._properties);for(const P of Object.keys(this._values))x._values[P]=this._values[P].possiblyEvaluate(s,f,m);return x}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Bc{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return Ot(this._values[s].value)}setValue(s,f){this._values[s]=new Fn(this._values[s].property,f===null?void 0:Ot(f))}serialize(){const s={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(s[f]=m)}return s}possiblyEvaluate(s,f,m){const x=new la(this._properties);for(const P of Object.keys(this._values))x._values[P]=this._values[P].possiblyEvaluate(s,f,m);return x}}class Fr{constructor(s,f,m){this.property=s,this.value=f,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,f,m,x){return this.property.evaluate(this.value,this.parameters,s,f,m,x)}}class la{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class It{constructor(s){this.specification=s}possiblyEvaluate(s,f){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(f)}interpolate(s,f,m){const x=dr[this.specification.type];return x?x(s,f,m):s}}class Ht{constructor(s,f){this.specification=s,this.overrides=f}possiblyEvaluate(s,f,m,x){return new Fr(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(f,null,{},m,x)}:s.expression,f)}interpolate(s,f,m){if(s.value.kind!=="constant"||f.value.kind!=="constant")return s;if(s.value.value===void 0||f.value.value===void 0)return new Fr(this,{kind:"constant",value:void 0},s.parameters);const x=dr[this.specification.type];if(x){const P=x(s.value.value,f.value.value,m);return new Fr(this,{kind:"constant",value:P},s.parameters)}return s}evaluate(s,f,m,x,P,M){return s.kind==="constant"?s.value:s.evaluate(f,m,x,P,M)}}class ca extends Ht{possiblyEvaluate(s,f,m,x){if(s.value===void 0)return new Fr(this,{kind:"constant",value:void 0},f);if(s.expression.kind==="constant"){const P=s.expression.evaluate(f,null,{},m,x),M=s.property.specification.type==="resolvedImage"&&typeof P!="string"?P.name:P,D=this._calculate(M,M,M,f);return new Fr(this,{kind:"constant",value:D},f)}if(s.expression.kind==="camera"){const P=this._calculate(s.expression.evaluate({zoom:f.zoom-1}),s.expression.evaluate({zoom:f.zoom}),s.expression.evaluate({zoom:f.zoom+1}),f);return new Fr(this,{kind:"constant",value:P},f)}return new Fr(this,s.expression,f)}evaluate(s,f,m,x,P,M){if(s.kind==="source"){const D=s.evaluate(f,m,x,P,M);return this._calculate(D,D,D,f)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(f.zoom)-1},m,x),s.evaluate({zoom:Math.floor(f.zoom)},m,x),s.evaluate({zoom:Math.floor(f.zoom)+1},m,x),f):s.value}_calculate(s,f,m,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:s,to:f}:{from:m,to:f}}interpolate(s){return s}}class Nl{constructor(s){this.specification=s}possiblyEvaluate(s,f,m,x){if(s.value!==void 0){if(s.expression.kind==="constant"){const P=s.expression.evaluate(f,null,{},m,x);return this._calculate(P,P,P,f)}return this._calculate(s.expression.evaluate(new zi(Math.floor(f.zoom-1),f)),s.expression.evaluate(new zi(Math.floor(f.zoom),f)),s.expression.evaluate(new zi(Math.floor(f.zoom+1),f)),f)}}_calculate(s,f,m,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:s,to:f}:{from:m,to:f}}interpolate(s){return s}}class zl{constructor(s){this.specification=s}possiblyEvaluate(s,f,m,x){return!!s.expression.evaluate(f,null,{},m,x)}interpolate(){return!1}}class rr{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const f in s){const m=s[f];m.specification.overridable&&this.overridableProperties.push(f);const x=this.defaultPropertyValues[f]=new Fn(m,void 0),P=this.defaultTransitionablePropertyValues[f]=new Jr(m);this.defaultTransitioningPropertyValues[f]=P.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=x.possiblyEvaluate({})}}}bt("DataDrivenProperty",Ht),bt("DataConstantProperty",It),bt("CrossFadedDataDrivenProperty",ca),bt("CrossFadedProperty",Nl),bt("ColorRampProperty",zl);const nn="-transition";class sr extends en{constructor(s,f){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),f.layout&&(this._unevaluatedLayout=new Bc(f.layout)),f.paint)){this._transitionablePaint=new Rc(f.paint);for(const m in s.paint)this.setPaintProperty(m,s.paint[m],{validate:!1});for(const m in s.layout)this.setLayoutProperty(m,s.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new la(f.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,f,m={}){f!=null&&this._validate(Cc,`layers.${this.id}.layout.${s}`,s,f,m)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,f):this.visibility=f)}getPaintProperty(s){return s.endsWith(nn)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,f,m={}){if(f!=null&&this._validate(Il,`layers.${this.id}.paint.${s}`,s,f,m))return!1;if(s.endsWith(nn))return this._transitionablePaint.setTransition(s.slice(0,-11),f||void 0),!1;{const x=this._transitionablePaint._values[s],P=x.property.specification["property-type"]==="cross-faded-data-driven",M=x.value.isDataDriven(),D=x.value;this._transitionablePaint.setValue(s,f),this._handleSpecialPaintPropertyUpdate(s);const O=this._transitionablePaint._values[s].value;return O.isDataDriven()||M||P||this._handleOverridablePaintPropertyUpdate(s,D,O)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,f,m){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,f){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,f)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Vt(s,(f,m)=>!(f===void 0||m==="layout"&&!Object.keys(f).length||m==="paint"&&!Object.keys(f).length))}_validate(s,f,m,x,P={}){return(!P||P.validate!==!1)&&Ua(this,s.call(mn,{key:f,layerType:this.type,objectKey:m,value:x,styleSpec:Xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const f=this.paint.get(s);if(f instanceof Fr&&bo(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}const Kt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Or{constructor(s,f){this._structArray=s,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,f){return s._trim(),f&&(s.isTransferred=!0,f.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const f=Object.create(this.prototype);return f.arrayBuffer=s.arrayBuffer,f.length=s.length,f.capacity=s.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ci(c,s=1){let f=0,m=0;return{members:c.map(x=>{const P=Kt[x.type].BYTES_PER_ELEMENT,M=f=eo(f,Math.max(s,P)),D=x.components||1;return m=Math.max(m,P),f+=P*D,{name:x.name,type:x.type,components:D,offset:M}}),size:eo(f,Math.max(m,s)),alignment:s}}function eo(c,s){return Math.ceil(c/s)*s}class to extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,f)}emplace(s,f,m){const x=2*s;return this.int16[x+0]=f,this.int16[x+1]=m,s}}to.prototype.bytesPerElement=4,bt("StructArrayLayout2i4",to);class $s extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,f,m){const x=this.length;return this.resize(x+1),this.emplace(x,s,f,m)}emplace(s,f,m,x){const P=3*s;return this.int16[P+0]=f,this.int16[P+1]=m,this.int16[P+2]=x,s}}$s.prototype.bytesPerElement=6,bt("StructArrayLayout3i6",$s);class io extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,f,m,x){const P=this.length;return this.resize(P+1),this.emplace(P,s,f,m,x)}emplace(s,f,m,x,P){const M=4*s;return this.int16[M+0]=f,this.int16[M+1]=m,this.int16[M+2]=x,this.int16[M+3]=P,s}}io.prototype.bytesPerElement=8,bt("StructArrayLayout4i8",io);class br extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,f,m,x,P,M){const D=this.length;return this.resize(D+1),this.emplace(D,s,f,m,x,P,M)}emplace(s,f,m,x,P,M,D){const O=6*s;return this.int16[O+0]=f,this.int16[O+1]=m,this.int16[O+2]=x,this.int16[O+3]=P,this.int16[O+4]=M,this.int16[O+5]=D,s}}br.prototype.bytesPerElement=12,bt("StructArrayLayout2i4i12",br);class ko extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,f,m,x,P,M){const D=this.length;return this.resize(D+1),this.emplace(D,s,f,m,x,P,M)}emplace(s,f,m,x,P,M,D){const O=4*s,N=8*s;return this.int16[O+0]=f,this.int16[O+1]=m,this.uint8[N+4]=x,this.uint8[N+5]=P,this.uint8[N+6]=M,this.uint8[N+7]=D,s}}ko.prototype.bytesPerElement=8,bt("StructArrayLayout2i4ub8",ko);class Ws extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,f)}emplace(s,f,m){const x=2*s;return this.float32[x+0]=f,this.float32[x+1]=m,s}}Ws.prototype.bytesPerElement=8,bt("StructArrayLayout2f8",Ws);class $a extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,f,m,x,P,M,D,O,N,j){const $=this.length;return this.resize($+1),this.emplace($,s,f,m,x,P,M,D,O,N,j)}emplace(s,f,m,x,P,M,D,O,N,j,$){const Z=10*s;return this.uint16[Z+0]=f,this.uint16[Z+1]=m,this.uint16[Z+2]=x,this.uint16[Z+3]=P,this.uint16[Z+4]=M,this.uint16[Z+5]=D,this.uint16[Z+6]=O,this.uint16[Z+7]=N,this.uint16[Z+8]=j,this.uint16[Z+9]=$,s}}$a.prototype.bytesPerElement=20,bt("StructArrayLayout10ui20",$a);class it extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,f,m,x,P,M,D,O,N,j,$,Z){const J=this.length;return this.resize(J+1),this.emplace(J,s,f,m,x,P,M,D,O,N,j,$,Z)}emplace(s,f,m,x,P,M,D,O,N,j,$,Z,J){const ee=12*s;return this.int16[ee+0]=f,this.int16[ee+1]=m,this.int16[ee+2]=x,this.int16[ee+3]=P,this.uint16[ee+4]=M,this.uint16[ee+5]=D,this.uint16[ee+6]=O,this.uint16[ee+7]=N,this.int16[ee+8]=j,this.int16[ee+9]=$,this.int16[ee+10]=Z,this.int16[ee+11]=J,s}}it.prototype.bytesPerElement=24,bt("StructArrayLayout4i4ui4i24",it);class Ge extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,f,m){const x=this.length;return this.resize(x+1),this.emplace(x,s,f,m)}emplace(s,f,m,x){const P=3*s;return this.float32[P+0]=f,this.float32[P+1]=m,this.float32[P+2]=x,s}}Ge.prototype.bytesPerElement=12,bt("StructArrayLayout3f12",Ge);class E extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const f=this.length;return this.resize(f+1),this.emplace(f,s)}emplace(s,f){return this.uint32[1*s+0]=f,s}}E.prototype.bytesPerElement=4,bt("StructArrayLayout1ul4",E);class n extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,f,m,x,P,M,D,O,N){const j=this.length;return this.resize(j+1),this.emplace(j,s,f,m,x,P,M,D,O,N)}emplace(s,f,m,x,P,M,D,O,N,j){const $=10*s,Z=5*s;return this.int16[$+0]=f,this.int16[$+1]=m,this.int16[$+2]=x,this.int16[$+3]=P,this.int16[$+4]=M,this.int16[$+5]=D,this.uint32[Z+3]=O,this.uint16[$+8]=N,this.uint16[$+9]=j,s}}n.prototype.bytesPerElement=20,bt("StructArrayLayout6i1ul2ui20",n);class d extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,f,m,x,P,M){const D=this.length;return this.resize(D+1),this.emplace(D,s,f,m,x,P,M)}emplace(s,f,m,x,P,M,D){const O=6*s;return this.int16[O+0]=f,this.int16[O+1]=m,this.int16[O+2]=x,this.int16[O+3]=P,this.int16[O+4]=M,this.int16[O+5]=D,s}}d.prototype.bytesPerElement=12,bt("StructArrayLayout2i2i2i12",d);class v extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,f,m,x,P){const M=this.length;return this.resize(M+1),this.emplace(M,s,f,m,x,P)}emplace(s,f,m,x,P,M){const D=4*s,O=8*s;return this.float32[D+0]=f,this.float32[D+1]=m,this.float32[D+2]=x,this.int16[O+6]=P,this.int16[O+7]=M,s}}v.prototype.bytesPerElement=16,bt("StructArrayLayout2f1f2i16",v);class w extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,f,m,x){const P=this.length;return this.resize(P+1),this.emplace(P,s,f,m,x)}emplace(s,f,m,x,P){const M=12*s,D=3*s;return this.uint8[M+0]=f,this.uint8[M+1]=m,this.float32[D+1]=x,this.float32[D+2]=P,s}}w.prototype.bytesPerElement=12,bt("StructArrayLayout2ub2f12",w);class C extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,f,m){const x=this.length;return this.resize(x+1),this.emplace(x,s,f,m)}emplace(s,f,m,x){const P=3*s;return this.uint16[P+0]=f,this.uint16[P+1]=m,this.uint16[P+2]=x,s}}C.prototype.bytesPerElement=6,bt("StructArrayLayout3ui6",C);class B extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,f,m,x,P,M,D,O,N,j,$,Z,J,ee,ce,_e,xe){const Re=this.length;return this.resize(Re+1),this.emplace(Re,s,f,m,x,P,M,D,O,N,j,$,Z,J,ee,ce,_e,xe)}emplace(s,f,m,x,P,M,D,O,N,j,$,Z,J,ee,ce,_e,xe,Re){const Ie=24*s,De=12*s,Ue=48*s;return this.int16[Ie+0]=f,this.int16[Ie+1]=m,this.uint16[Ie+2]=x,this.uint16[Ie+3]=P,this.uint32[De+2]=M,this.uint32[De+3]=D,this.uint32[De+4]=O,this.uint16[Ie+10]=N,this.uint16[Ie+11]=j,this.uint16[Ie+12]=$,this.float32[De+7]=Z,this.float32[De+8]=J,this.uint8[Ue+36]=ee,this.uint8[Ue+37]=ce,this.uint8[Ue+38]=_e,this.uint32[De+10]=xe,this.int16[Ie+22]=Re,s}}B.prototype.bytesPerElement=48,bt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",B);class a extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,f,m,x,P,M,D,O,N,j,$,Z,J,ee,ce,_e,xe,Re,Ie,De,Ue,Ze,_t,Ct,gt,At,ot,Tt){const lt=this.length;return this.resize(lt+1),this.emplace(lt,s,f,m,x,P,M,D,O,N,j,$,Z,J,ee,ce,_e,xe,Re,Ie,De,Ue,Ze,_t,Ct,gt,At,ot,Tt)}emplace(s,f,m,x,P,M,D,O,N,j,$,Z,J,ee,ce,_e,xe,Re,Ie,De,Ue,Ze,_t,Ct,gt,At,ot,Tt,lt){const tt=32*s,jt=16*s;return this.int16[tt+0]=f,this.int16[tt+1]=m,this.int16[tt+2]=x,this.int16[tt+3]=P,this.int16[tt+4]=M,this.int16[tt+5]=D,this.int16[tt+6]=O,this.int16[tt+7]=N,this.uint16[tt+8]=j,this.uint16[tt+9]=$,this.uint16[tt+10]=Z,this.uint16[tt+11]=J,this.uint16[tt+12]=ee,this.uint16[tt+13]=ce,this.uint16[tt+14]=_e,this.uint16[tt+15]=xe,this.uint16[tt+16]=Re,this.uint16[tt+17]=Ie,this.uint16[tt+18]=De,this.uint16[tt+19]=Ue,this.uint16[tt+20]=Ze,this.uint16[tt+21]=_t,this.uint16[tt+22]=Ct,this.uint32[jt+12]=gt,this.float32[jt+13]=At,this.float32[jt+14]=ot,this.uint16[tt+30]=Tt,this.uint16[tt+31]=lt,s}}a.prototype.bytesPerElement=64,bt("StructArrayLayout8i15ui1ul2f2ui64",a);class h extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const f=this.length;return this.resize(f+1),this.emplace(f,s)}emplace(s,f){return this.float32[1*s+0]=f,s}}h.prototype.bytesPerElement=4,bt("StructArrayLayout1f4",h);class A extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,f,m){const x=this.length;return this.resize(x+1),this.emplace(x,s,f,m)}emplace(s,f,m,x){const P=3*s;return this.uint16[6*s+0]=f,this.float32[P+1]=m,this.float32[P+2]=x,s}}A.prototype.bytesPerElement=12,bt("StructArrayLayout1ui2f12",A);class p extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,f,m){const x=this.length;return this.resize(x+1),this.emplace(x,s,f,m)}emplace(s,f,m,x){const P=4*s;return this.uint32[2*s+0]=f,this.uint16[P+2]=m,this.uint16[P+3]=x,s}}p.prototype.bytesPerElement=8,bt("StructArrayLayout1ul2ui8",p);class y extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,f)}emplace(s,f,m){const x=2*s;return this.uint16[x+0]=f,this.uint16[x+1]=m,s}}y.prototype.bytesPerElement=4,bt("StructArrayLayout2ui4",y);class b extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const f=this.length;return this.resize(f+1),this.emplace(f,s)}emplace(s,f){return this.uint16[1*s+0]=f,s}}b.prototype.bytesPerElement=2,bt("StructArrayLayout1ui2",b);class T extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,f,m,x){const P=this.length;return this.resize(P+1),this.emplace(P,s,f,m,x)}emplace(s,f,m,x,P){const M=4*s;return this.float32[M+0]=f,this.float32[M+1]=m,this.float32[M+2]=x,this.float32[M+3]=P,s}}T.prototype.bytesPerElement=16,bt("StructArrayLayout4f16",T);class S extends Or{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new V(this.anchorPointX,this.anchorPointY)}}S.prototype.size=20;class k extends n{get(s){return new S(this,s)}}bt("CollisionBoxArray",k);class F extends Or{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}F.prototype.size=48;class U extends B{get(s){return new F(this,s)}}bt("PlacedSymbolArray",U);class H extends Or{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}H.prototype.size=64;class W extends a{get(s){return new H(this,s)}}bt("SymbolInstanceArray",W);class Y extends h{getoffsetX(s){return this.float32[1*s+0]}}bt("GlyphOffsetArray",Y);class G extends $s{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}bt("SymbolLineVertexArray",G);class se extends Or{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}se.prototype.size=12;class me extends A{get(s){return new se(this,s)}}bt("TextAnchorOffsetArray",me);class Te extends Or{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Te.prototype.size=8;class de extends p{get(s){return new Te(this,s)}}bt("FeatureIndexArray",de);class be extends to{}class ve extends to{}class Ye extends to{}class je extends br{}class He extends ko{}class $e extends Ws{}class zt extends $a{}class vt extends it{}class mt extends Ge{}class pt extends E{}class Mt extends d{}class St extends w{}class ti extends C{}class kt extends y{}const Jt=ci([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fi}=Jt;class Oi{constructor(s=[]){this.segments=s}prepareSegment(s,f,m,x){let P=this.segments[this.segments.length-1];return s>Oi.MAX_VERTEX_ARRAY_LENGTH&&qt(`Max vertices per segment is ${Oi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!P||P.vertexLength+s>Oi.MAX_VERTEX_ARRAY_LENGTH||P.sortKey!==x)&&(P={vertexOffset:f.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},x!==void 0&&(P.sortKey=x),this.segments.push(P)),P}get(){return this.segments}destroy(){for(const s of this.segments)for(const f in s.vaos)s.vaos[f].destroy()}static simpleSegment(s,f,m,x){return new Oi([{vertexOffset:s,primitiveOffset:f,vertexLength:m,primitiveLength:x,vaos:{},sortKey:0}])}}function On(c,s){return 256*(c=Je(Math.floor(c),0,255))+Je(Math.floor(s),0,255)}Oi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bt("SegmentVector",Oi);const Ln=ci([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Do={exports:{}},ha={exports:{}};ha.exports=function(c,s){var f,m,x,P,M,D,O,N;for(m=c.length-(f=3&c.length),x=s,M=3432918353,D=461845907,N=0;N<m;)O=255&c.charCodeAt(N)|(255&c.charCodeAt(++N))<<8|(255&c.charCodeAt(++N))<<16|(255&c.charCodeAt(++N))<<24,++N,x=27492+(65535&(P=5*(65535&(x=(x^=O=(65535&(O=(O=(65535&O)*M+(((O>>>16)*M&65535)<<16)&4294967295)<<15|O>>>17))*D+(((O>>>16)*D&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(P>>>16)&65535)<<16);switch(O=0,f){case 3:O^=(255&c.charCodeAt(N+2))<<16;case 2:O^=(255&c.charCodeAt(N+1))<<8;case 1:x^=O=(65535&(O=(O=(65535&(O^=255&c.charCodeAt(N)))*M+(((O>>>16)*M&65535)<<16)&4294967295)<<15|O>>>17))*D+(((O>>>16)*D&65535)<<16)&4294967295}return x^=c.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0};var Wa=ha.exports,es={exports:{}};es.exports=function(c,s){for(var f,m=c.length,x=s^m,P=0;m>=4;)f=1540483477*(65535&(f=255&c.charCodeAt(P)|(255&c.charCodeAt(++P))<<8|(255&c.charCodeAt(++P))<<16|(255&c.charCodeAt(++P))<<24))+((1540483477*(f>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),m-=4,++P;switch(m){case 3:x^=(255&c.charCodeAt(P+2))<<16;case 2:x^=(255&c.charCodeAt(P+1))<<8;case 1:x=1540483477*(65535&(x^=255&c.charCodeAt(P)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0};var Hr=Wa,cs=es.exports;Do.exports=Hr,Do.exports.murmur3=Hr,Do.exports.murmur2=cs;var ua=R(Do.exports);class or{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,f,m,x){this.ids.push(Sr(s)),this.positions.push(f,m,x)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const f=Sr(s);let m=0,x=this.ids.length-1;for(;m<x;){const M=m+x>>1;this.ids[M]>=f?x=M:m=M+1}const P=[];for(;this.ids[m]===f;)P.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return P}static serialize(s,f){const m=new Float64Array(s.ids),x=new Uint32Array(s.positions);return Cs(m,x,0,m.length-1),f&&f.push(m.buffer,x.buffer),{ids:m,positions:x}}static deserialize(s){const f=new or;return f.ids=s.ids,f.positions=s.positions,f.indexed=!0,f}}function Sr(c){const s=+c;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:ua(String(c))}function Cs(c,s,f,m){for(;f<m;){const x=c[f+m>>1];let P=f-1,M=m+1;for(;;){do P++;while(c[P]<x);do M--;while(c[M]>x);if(P>=M)break;ar(c,P,M),ar(s,3*P,3*M),ar(s,3*P+1,3*M+1),ar(s,3*P+2,3*M+2)}M-f<m-M?(Cs(c,s,f,M),f=M+1):(Cs(c,s,M+1,m),m=M)}}function ar(c,s,f){const m=c[s];c[s]=c[f],c[f]=m}bt("FeaturePositionMap",or);class Aa{constructor(s,f){this.gl=s.gl,this.location=f}}class Fc extends Aa{constructor(s,f){super(s,f),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class eA extends Aa{constructor(s,f){super(s,f),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class tA extends Aa{constructor(s,f){super(s,f),this.current=Qt.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const dd=new Float32Array(16);function Vh(c){return[On(255*c.r,255*c.g),On(255*c.b,255*c.a)]}class Nn{constructor(s,f,m){this.value=s,this.uniformNames=f.map(x=>`u_${x}`),this.type=m}setUniform(s,f,m){s.set(m.constantOr(this.value))}getBinding(s,f,m){return this.type==="color"?new tA(s,f):new Fc(s,f)}}class fa{constructor(s,f){this.uniformNames=f.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=s.tlbr}setUniform(s,f,m,x){const P=x==="u_pattern_to"?this.patternTo:x==="u_pattern_from"?this.patternFrom:x==="u_pixel_ratio_to"?this.pixelRatioTo:x==="u_pixel_ratio_from"?this.pixelRatioFrom:null;P&&s.set(P)}getBinding(s,f,m){return m.substr(0,9)==="u_pattern"?new eA(s,f):new Fc(s,f)}}class zn{constructor(s,f,m,x){this.expression=s,this.type=m,this.maxValue=0,this.paintVertexAttributes=f.map(P=>({name:`a_${P}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new x}populatePaintArray(s,f,m,x,P){const M=this.paintVertexArray.length,D=this.expression.evaluate(new zi(0),f,{},x,[],P);this.paintVertexArray.resize(s),this._setPaintValue(M,s,D)}updatePaintArray(s,f,m,x){const P=this.expression.evaluate({zoom:0},m,x);this._setPaintValue(s,f,P)}_setPaintValue(s,f,m){if(this.type==="color"){const x=Vh(m);for(let P=s;P<f;P++)this.paintVertexArray.emplace(P,x[0],x[1])}else{for(let x=s;x<f;x++)this.paintVertexArray.emplace(x,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class on{constructor(s,f,m,x,P,M){this.expression=s,this.uniformNames=f.map(D=>`u_${D}_t`),this.type=m,this.useIntegerZoom=x,this.zoom=P,this.maxValue=0,this.paintVertexAttributes=f.map(D=>({name:`a_${D}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new M}populatePaintArray(s,f,m,x,P){const M=this.expression.evaluate(new zi(this.zoom),f,{},x,[],P),D=this.expression.evaluate(new zi(this.zoom+1),f,{},x,[],P),O=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(O,s,M,D)}updatePaintArray(s,f,m,x){const P=this.expression.evaluate({zoom:this.zoom},m,x),M=this.expression.evaluate({zoom:this.zoom+1},m,x);this._setPaintValue(s,f,P,M)}_setPaintValue(s,f,m,x){if(this.type==="color"){const P=Vh(m),M=Vh(x);for(let D=s;D<f;D++)this.paintVertexArray.emplace(D,P[0],P[1],M[0],M[1])}else{for(let P=s;P<f;P++)this.paintVertexArray.emplace(P,m,x);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(x))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,f){const m=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,x=Je(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);s.set(x)}getBinding(s,f,m){return new Fc(s,f)}}class Un{constructor(s,f,m,x,P,M){this.expression=s,this.type=f,this.useIntegerZoom=m,this.zoom=x,this.layerId=M,this.zoomInPaintVertexArray=new P,this.zoomOutPaintVertexArray=new P}populatePaintArray(s,f,m){const x=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(x,s,f.patterns&&f.patterns[this.layerId],m)}updatePaintArray(s,f,m,x,P){this._setPaintValues(s,f,m.patterns&&m.patterns[this.layerId],P)}_setPaintValues(s,f,m,x){if(!x||!m)return;const{min:P,mid:M,max:D}=m,O=x[P],N=x[M],j=x[D];if(O&&N&&j)for(let $=s;$<f;$++)this.zoomInPaintVertexArray.emplace($,N.tl[0],N.tl[1],N.br[0],N.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],N.pixelRatio,O.pixelRatio),this.zoomOutPaintVertexArray.emplace($,N.tl[0],N.tl[1],N.br[0],N.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],N.pixelRatio,j.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,Ln.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,Ln.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class jh{constructor(s,f,m){this.binders={},this._buffers=[];const x=[];for(const P in s.paint._values){if(!m(P))continue;const M=s.paint.get(P);if(!(M instanceof Fr&&bo(M.property.specification)))continue;const D=Yx(P,s.type),O=M.value,N=M.property.specification.type,j=M.property.useIntegerZoom,$=M.property.specification["property-type"],Z=$==="cross-faded"||$==="cross-faded-data-driven";if(O.kind==="constant")this.binders[P]=Z?new fa(O.value,D):new Nn(O.value,D,N),x.push(`/u_${P}`);else if(O.kind==="source"||Z){const J=r_(P,N,"source");this.binders[P]=Z?new Un(O,N,j,f,J,s.id):new zn(O,D,N,J),x.push(`/a_${P}`)}else{const J=r_(P,N,"composite");this.binders[P]=new on(O,D,N,j,f,J),x.push(`/z_${P}`)}}this.cacheKey=x.sort().join("")}getMaxValue(s){const f=this.binders[s];return f instanceof zn||f instanceof on?f.maxValue:0}populatePaintArrays(s,f,m,x,P){for(const M in this.binders){const D=this.binders[M];(D instanceof zn||D instanceof on||D instanceof Un)&&D.populatePaintArray(s,f,m,x,P)}}setConstantPatternPositions(s,f){for(const m in this.binders){const x=this.binders[m];x instanceof fa&&x.setConstantPatternPositions(s,f)}}updatePaintArrays(s,f,m,x,P){let M=!1;for(const D in s){const O=f.getPositions(D);for(const N of O){const j=m.feature(N.index);for(const $ in this.binders){const Z=this.binders[$];if((Z instanceof zn||Z instanceof on||Z instanceof Un)&&Z.expression.isStateDependent===!0){const J=x.paint.get($);Z.expression=J.value,Z.updatePaintArray(N.start,N.end,j,s[D],P),M=!0}}}}return M}defines(){const s=[];for(const f in this.binders){const m=this.binders[f];(m instanceof Nn||m instanceof fa)&&s.push(...m.uniformNames.map(x=>`#define HAS_UNIFORM_${x}`))}return s}getBinderAttributes(){const s=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof zn||m instanceof on)for(let x=0;x<m.paintVertexAttributes.length;x++)s.push(m.paintVertexAttributes[x].name);else if(m instanceof Un)for(let x=0;x<Ln.members.length;x++)s.push(Ln.members[x].name)}return s}getBinderUniforms(){const s=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Nn||m instanceof fa||m instanceof on)for(const x of m.uniformNames)s.push(x)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,f){const m=[];for(const x in this.binders){const P=this.binders[x];if(P instanceof Nn||P instanceof fa||P instanceof on){for(const M of P.uniformNames)if(f[M]){const D=P.getBinding(s,f[M],M);m.push({name:M,property:x,binding:D})}}}return m}setUniforms(s,f,m,x){for(const{name:P,property:M,binding:D}of f)this.binders[M].setUniform(D,x,m.get(M),P)}updatePaintBuffers(s){this._buffers=[];for(const f in this.binders){const m=this.binders[f];if(s&&m instanceof Un){const x=s.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;x&&this._buffers.push(x)}else(m instanceof zn||m instanceof on)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(s){for(const f in this.binders){const m=this.binders[f];(m instanceof zn||m instanceof on||m instanceof Un)&&m.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const f=this.binders[s];(f instanceof zn||f instanceof on||f instanceof Un)&&f.destroy()}}}class ro{constructor(s,f,m=()=>!0){this.programConfigurations={};for(const x of s)this.programConfigurations[x.id]=new jh(x,f,m);this.needsUpload=!1,this._featureMap=new or,this._bufferOffset=0}populatePaintArrays(s,f,m,x,P,M){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(s,f,x,P,M);f.id!==void 0&&this._featureMap.add(f.id,m,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,f,m,x){for(const P of m)this.needsUpload=this.programConfigurations[P.id].updatePaintArrays(s,this._featureMap,f,P,x)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function Yx(c,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}function r_(c,s,f){const m={color:{source:Ws,composite:T},number:{source:h,composite:Ws}},x=function(P){return{"line-pattern":{source:zt,composite:zt},"fill-pattern":{source:zt,composite:zt},"fill-extrusion-pattern":{source:zt,composite:zt}}[P]}(c);return x&&x[f]||m[s][f]}bt("ConstantBinder",Nn),bt("CrossFadedConstantBinder",fa),bt("SourceExpressionBinder",zn),bt("CrossFadedCompositeBinder",Un),bt("CompositeExpressionBinder",on),bt("ProgramConfiguration",jh,{omit:["_buffers"]}),bt("ProgramConfigurationSet",ro);const vr=8192,pd=Math.pow(2,14)-1,s_=-pd-1;function Ul(c){const s=vr/c.extent,f=c.loadGeometry();for(let m=0;m<f.length;m++){const x=f[m];for(let P=0;P<x.length;P++){const M=x[P],D=Math.round(M.x*s),O=Math.round(M.y*s);M.x=Je(D,s_,pd),M.y=Je(O,s_,pd),(D<M.x||D>M.x+1||O<M.y||O>M.y+1)&&qt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function Vl(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?Ul(c):[]}}function iA(c,s,f,m,x){c.emplaceBack(2*s+(m+1)/2,2*f+(x+1)/2)}class gd{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(f=>f.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ve,this.indexArray=new ti,this.segments=new Oi,this.programConfigurations=new ro(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(s,f,m){const x=this.layers[0],P=[];let M=null,D=!1;x.type==="circle"&&(M=x.layout.get("circle-sort-key"),D=!M.isConstant());for(const{feature:O,id:N,index:j,sourceLayerIndex:$}of s){const Z=this.layers[0]._featureFilter.needGeometry,J=Vl(O,Z);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),J,m))continue;const ee=D?M.evaluate(J,{},m):void 0,ce={id:N,properties:O.properties,type:O.type,sourceLayerIndex:$,index:j,geometry:Z?J.geometry:Ul(O),patterns:{},sortKey:ee};P.push(ce)}D&&P.sort((O,N)=>O.sortKey-N.sortKey);for(const O of P){const{geometry:N,index:j,sourceLayerIndex:$}=O,Z=s[j].feature;this.addFeature(O,N,j,m),f.featureIndex.insert(Z,N,j,$,this.index)}}update(s,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Fi),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,f,m,x){for(const P of f)for(const M of P){const D=M.x,O=M.y;if(D<0||D>=vr||O<0||O>=vr)continue;const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),j=N.vertexLength;iA(this.layoutVertexArray,D,O,-1,-1),iA(this.layoutVertexArray,D,O,1,-1),iA(this.layoutVertexArray,D,O,1,1),iA(this.layoutVertexArray,D,O,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,{},x)}}function n_(c,s){for(let f=0;f<c.length;f++)if(Oc(s,c[f]))return!0;for(let f=0;f<s.length;f++)if(Oc(c,s[f]))return!0;return!!_d(c,s)}function Gx(c,s,f){return!!Oc(c,s)||!!md(s,c,f)}function o_(c,s){if(c.length===1)return l_(s,c[0]);for(let f=0;f<s.length;f++){const m=s[f];for(let x=0;x<m.length;x++)if(Oc(c,m[x]))return!0}for(let f=0;f<c.length;f++)if(l_(s,c[f]))return!0;for(let f=0;f<s.length;f++)if(_d(c,s[f]))return!0;return!1}function Qx(c,s,f){if(c.length>1){if(_d(c,s))return!0;for(let m=0;m<s.length;m++)if(md(s[m],c,f))return!0}for(let m=0;m<c.length;m++)if(md(c[m],s,f))return!0;return!1}function _d(c,s){if(c.length===0||s.length===0)return!1;for(let f=0;f<c.length-1;f++){const m=c[f],x=c[f+1];for(let P=0;P<s.length-1;P++)if(Kx(m,x,s[P],s[P+1]))return!0}return!1}function Kx(c,s,f,m){return gi(c,f,m)!==gi(s,f,m)&&gi(c,s,f)!==gi(c,s,m)}function md(c,s,f){const m=f*f;if(s.length===1)return c.distSqr(s[0])<m;for(let x=1;x<s.length;x++)if(a_(c,s[x-1],s[x])<m)return!0;return!1}function a_(c,s,f){const m=s.distSqr(f);if(m===0)return c.distSqr(s);const x=((c.x-s.x)*(f.x-s.x)+(c.y-s.y)*(f.y-s.y))/m;return c.distSqr(x<0?s:x>1?f:f.sub(s)._mult(x)._add(s))}function l_(c,s){let f,m,x,P=!1;for(let M=0;M<c.length;M++){f=c[M];for(let D=0,O=f.length-1;D<f.length;O=D++)m=f[D],x=f[O],m.y>s.y!=x.y>s.y&&s.x<(x.x-m.x)*(s.y-m.y)/(x.y-m.y)+m.x&&(P=!P)}return P}function Oc(c,s){let f=!1;for(let m=0,x=c.length-1;m<c.length;x=m++){const P=c[m],M=c[x];P.y>s.y!=M.y>s.y&&s.x<(M.x-P.x)*(s.y-P.y)/(M.y-P.y)+P.x&&(f=!f)}return f}function Jx(c,s,f){const m=f[0],x=f[2];if(c.x<m.x&&s.x<m.x||c.x>x.x&&s.x>x.x||c.y<m.y&&s.y<m.y||c.y>x.y&&s.y>x.y)return!1;const P=gi(c,s,f[0]);return P!==gi(c,s,f[1])||P!==gi(c,s,f[2])||P!==gi(c,s,f[3])}function $h(c,s,f){const m=s.paint.get(c).value;return m.kind==="constant"?m.value:f.programConfigurations.get(s.id).getMaxValue(c)}function rA(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function sA(c,s,f,m,x){if(!s[0]&&!s[1])return c;const P=V.convert(s)._mult(x);f==="viewport"&&P._rotate(-m);const M=[];for(let D=0;D<c.length;D++)M.push(c[D].sub(P));return M}let c_,h_;bt("CircleBucket",gd,{omit:["layers"]});var ew={get paint(){return h_=h_||new rr({"circle-radius":new Ht(Xe.paint_circle["circle-radius"]),"circle-color":new Ht(Xe.paint_circle["circle-color"]),"circle-blur":new Ht(Xe.paint_circle["circle-blur"]),"circle-opacity":new Ht(Xe.paint_circle["circle-opacity"]),"circle-translate":new It(Xe.paint_circle["circle-translate"]),"circle-translate-anchor":new It(Xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It(Xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It(Xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ht(Xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ht(Xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ht(Xe.paint_circle["circle-stroke-opacity"])})},get layout(){return c_=c_||new rr({"circle-sort-key":new Ht(Xe.layout_circle["circle-sort-key"])})}},Ps=1e-6,Lc=typeof Float32Array<"u"?Float32Array:Array;function yd(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function u_(c,s,f){var m=s[0],x=s[1],P=s[2],M=s[3],D=s[4],O=s[5],N=s[6],j=s[7],$=s[8],Z=s[9],J=s[10],ee=s[11],ce=s[12],_e=s[13],xe=s[14],Re=s[15],Ie=f[0],De=f[1],Ue=f[2],Ze=f[3];return c[0]=Ie*m+De*D+Ue*$+Ze*ce,c[1]=Ie*x+De*O+Ue*Z+Ze*_e,c[2]=Ie*P+De*N+Ue*J+Ze*xe,c[3]=Ie*M+De*j+Ue*ee+Ze*Re,c[4]=(Ie=f[4])*m+(De=f[5])*D+(Ue=f[6])*$+(Ze=f[7])*ce,c[5]=Ie*x+De*O+Ue*Z+Ze*_e,c[6]=Ie*P+De*N+Ue*J+Ze*xe,c[7]=Ie*M+De*j+Ue*ee+Ze*Re,c[8]=(Ie=f[8])*m+(De=f[9])*D+(Ue=f[10])*$+(Ze=f[11])*ce,c[9]=Ie*x+De*O+Ue*Z+Ze*_e,c[10]=Ie*P+De*N+Ue*J+Ze*xe,c[11]=Ie*M+De*j+Ue*ee+Ze*Re,c[12]=(Ie=f[12])*m+(De=f[13])*D+(Ue=f[14])*$+(Ze=f[15])*ce,c[13]=Ie*x+De*O+Ue*Z+Ze*_e,c[14]=Ie*P+De*N+Ue*J+Ze*xe,c[15]=Ie*M+De*j+Ue*ee+Ze*Re,c}Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)});var Wh,tw=u_;function nA(c,s,f){var m=s[0],x=s[1],P=s[2],M=s[3];return c[0]=f[0]*m+f[4]*x+f[8]*P+f[12]*M,c[1]=f[1]*m+f[5]*x+f[9]*P+f[13]*M,c[2]=f[2]*m+f[6]*x+f[10]*P+f[14]*M,c[3]=f[3]*m+f[7]*x+f[11]*P+f[15]*M,c}Wh=new Lc(4),Lc!=Float32Array&&(Wh[0]=0,Wh[1]=0,Wh[2]=0,Wh[3]=0);class iw extends sr{constructor(s){super(s,ew)}createBucket(s){return new gd(s)}queryRadius(s){const f=s;return $h("circle-radius",this,f)+$h("circle-stroke-width",this,f)+rA(this.paint.get("circle-translate"))}queryIntersectsFeature(s,f,m,x,P,M,D,O){const N=sA(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,D),j=this.paint.get("circle-radius").evaluate(f,m)+this.paint.get("circle-stroke-width").evaluate(f,m),$=this.paint.get("circle-pitch-alignment")==="map",Z=$?N:function(ee,ce){return ee.map(_e=>A_(_e,ce))}(N,O),J=$?j*D:j;for(const ee of x)for(const ce of ee){const _e=$?ce:A_(ce,O);let xe=J;const Re=nA([],[ce.x,ce.y,0,1],O);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xe*=Re[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xe*=M.cameraToCenterDistance/Re[3]),Gx(Z,_e,xe))return!0}return!1}}function A_(c,s){const f=nA([],[c.x,c.y,0,1],s);return new V(f[0]/f[3],f[1]/f[3])}class f_ extends gd{}let d_;bt("HeatmapBucket",f_,{omit:["layers"]});var rw={get paint(){return d_=d_||new rr({"heatmap-radius":new Ht(Xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ht(Xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It(Xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zl(Xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It(Xe.paint_heatmap["heatmap-opacity"])})}};function bd(c,{width:s,height:f},m,x){if(x){if(x instanceof Uint8ClampedArray)x=new Uint8Array(x.buffer);else if(x.length!==s*f*m)throw new RangeError(`mismatched image size. expected: ${x.length} but got: ${s*f*m}`)}else x=new Uint8Array(s*f*m);return c.width=s,c.height=f,c.data=x,c}function p_(c,{width:s,height:f},m){if(s===c.width&&f===c.height)return;const x=bd({},{width:s,height:f},m);vd(c,x,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,s),height:Math.min(c.height,f)},m),c.width=s,c.height=f,c.data=x.data}function vd(c,s,f,m,x,P){if(x.width===0||x.height===0)return s;if(x.width>c.width||x.height>c.height||f.x>c.width-x.width||f.y>c.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>s.width||x.height>s.height||m.x>s.width-x.width||m.y>s.height-x.height)throw new RangeError("out of range destination coordinates for image copy");const M=c.data,D=s.data;if(M===D)throw new Error("srcData equals dstData, so image is already copied");for(let O=0;O<x.height;O++){const N=((f.y+O)*c.width+f.x)*P,j=((m.y+O)*s.width+m.x)*P;for(let $=0;$<x.width*P;$++)D[j+$]=M[N+$]}return s}class Hh{constructor(s,f){bd(this,s,1,f)}resize(s){p_(this,s,1)}clone(){return new Hh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,f,m,x,P){vd(s,f,m,x,P,1)}}class vn{constructor(s,f){bd(this,s,4,f)}resize(s){p_(this,s,4)}replace(s,f){f?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new vn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,f,m,x,P){vd(s,f,m,x,P,4)}}function g_(c){const s={},f=c.resolution||256,m=c.clips?c.clips.length:1,x=c.image||new vn({width:f,height:m});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);const P=(M,D,O)=>{s[c.evaluationKey]=O;const N=c.expression.evaluate(s);x.data[M+D+0]=Math.floor(255*N.r/N.a),x.data[M+D+1]=Math.floor(255*N.g/N.a),x.data[M+D+2]=Math.floor(255*N.b/N.a),x.data[M+D+3]=Math.floor(255*N.a)};if(c.clips)for(let M=0,D=0;M<m;++M,D+=4*f)for(let O=0,N=0;O<f;O++,N+=4){const j=O/(f-1),{start:$,end:Z}=c.clips[M];P(D,N,$*(1-j)+Z*j)}else for(let M=0,D=0;M<f;M++,D+=4)P(0,D,M/(f-1));return x}bt("AlphaImage",Hh),bt("RGBAImage",vn);class sw extends sr{createBucket(s){return new f_(s)}constructor(s){super(s,rw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=g_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let __;var nw={get paint(){return __=__||new rr({"hillshade-illumination-direction":new It(Xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new It(Xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It(Xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It(Xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It(Xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It(Xe.paint_hillshade["hillshade-accent-color"])})}};class ow extends sr{constructor(s){super(s,nw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const aw=ci([{name:"a_pos",components:2,type:"Int16"}],4),{members:lw}=aw;var xd={exports:{}};function oA(c,s,f){f=f||2;var m,x,P,M,D,O,N,j=s&&s.length,$=j?s[0]*f:c.length,Z=m_(c,0,$,f,!0),J=[];if(!Z||Z.next===Z.prev)return J;if(j&&(Z=function(ce,_e,xe,Re){var Ie,De,Ue,Ze=[];for(Ie=0,De=_e.length;Ie<De;Ie++)(Ue=m_(ce,_e[Ie]*Re,Ie<De-1?_e[Ie+1]*Re:ce.length,Re,!1))===Ue.next&&(Ue.steiner=!0),Ze.push(gw(Ue));for(Ze.sort(fw),Ie=0;Ie<Ze.length;Ie++)xe=dw(Ze[Ie],xe);return xe}(c,s,Z,f)),c.length>80*f){m=P=c[0],x=M=c[1];for(var ee=f;ee<$;ee+=f)(D=c[ee])<m&&(m=D),(O=c[ee+1])<x&&(x=O),D>P&&(P=D),O>M&&(M=O);N=(N=Math.max(P-m,M-x))!==0?32767/N:0}return qh(Z,J,f,m,x,N,0),J}function m_(c,s,f,m,x){var P,M;if(x===Ed(c,s,f,m)>0)for(P=s;P<f;P+=m)M=v_(P,c[P],c[P+1],M);else for(P=f-m;P>=s;P-=m)M=v_(P,c[P],c[P+1],M);return M&&aA(M,M.next)&&(Zh(M),M=M.next),M}function jl(c,s){if(!c)return c;s||(s=c);var f,m=c;do if(f=!1,m.steiner||!aA(m,m.next)&&pr(m.prev,m,m.next)!==0)m=m.next;else{if(Zh(m),(m=s=m.prev)===m.next)break;f=!0}while(f||m!==s);return s}function qh(c,s,f,m,x,P,M){if(c){!M&&P&&function(j,$,Z,J){var ee=j;do ee.z===0&&(ee.z=wd(ee.x,ee.y,$,Z,J)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next;while(ee!==j);ee.prevZ.nextZ=null,ee.prevZ=null,function(ce){var _e,xe,Re,Ie,De,Ue,Ze,_t,Ct=1;do{for(xe=ce,ce=null,De=null,Ue=0;xe;){for(Ue++,Re=xe,Ze=0,_e=0;_e<Ct&&(Ze++,Re=Re.nextZ);_e++);for(_t=Ct;Ze>0||_t>0&&Re;)Ze!==0&&(_t===0||!Re||xe.z<=Re.z)?(Ie=xe,xe=xe.nextZ,Ze--):(Ie=Re,Re=Re.nextZ,_t--),De?De.nextZ=Ie:ce=Ie,Ie.prevZ=De,De=Ie;xe=Re}De.nextZ=null,Ct*=2}while(Ue>1)}(ee)}(c,m,x,P);for(var D,O,N=c;c.prev!==c.next;)if(D=c.prev,O=c.next,P?hw(c,m,x,P):cw(c))s.push(D.i/f|0),s.push(c.i/f|0),s.push(O.i/f|0),Zh(c),c=O.next,N=O.next;else if((c=O)===N){M?M===1?qh(c=uw(jl(c),s,f),s,f,m,x,P,2):M===2&&Aw(c,s,f,m,x,P):qh(jl(c),s,f,m,x,P,1);break}}}function cw(c){var s=c.prev,f=c,m=c.next;if(pr(s,f,m)>=0)return!1;for(var x=s.x,P=f.x,M=m.x,D=s.y,O=f.y,N=m.y,j=x<P?x<M?x:M:P<M?P:M,$=D<O?D<N?D:N:O<N?O:N,Z=x>P?x>M?x:M:P>M?P:M,J=D>O?D>N?D:N:O>N?O:N,ee=m.next;ee!==s;){if(ee.x>=j&&ee.x<=Z&&ee.y>=$&&ee.y<=J&&Nc(x,D,P,O,M,N,ee.x,ee.y)&&pr(ee.prev,ee,ee.next)>=0)return!1;ee=ee.next}return!0}function hw(c,s,f,m){var x=c.prev,P=c,M=c.next;if(pr(x,P,M)>=0)return!1;for(var D=x.x,O=P.x,N=M.x,j=x.y,$=P.y,Z=M.y,J=D<O?D<N?D:N:O<N?O:N,ee=j<$?j<Z?j:Z:$<Z?$:Z,ce=D>O?D>N?D:N:O>N?O:N,_e=j>$?j>Z?j:Z:$>Z?$:Z,xe=wd(J,ee,s,f,m),Re=wd(ce,_e,s,f,m),Ie=c.prevZ,De=c.nextZ;Ie&&Ie.z>=xe&&De&&De.z<=Re;){if(Ie.x>=J&&Ie.x<=ce&&Ie.y>=ee&&Ie.y<=_e&&Ie!==x&&Ie!==M&&Nc(D,j,O,$,N,Z,Ie.x,Ie.y)&&pr(Ie.prev,Ie,Ie.next)>=0||(Ie=Ie.prevZ,De.x>=J&&De.x<=ce&&De.y>=ee&&De.y<=_e&&De!==x&&De!==M&&Nc(D,j,O,$,N,Z,De.x,De.y)&&pr(De.prev,De,De.next)>=0))return!1;De=De.nextZ}for(;Ie&&Ie.z>=xe;){if(Ie.x>=J&&Ie.x<=ce&&Ie.y>=ee&&Ie.y<=_e&&Ie!==x&&Ie!==M&&Nc(D,j,O,$,N,Z,Ie.x,Ie.y)&&pr(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.prevZ}for(;De&&De.z<=Re;){if(De.x>=J&&De.x<=ce&&De.y>=ee&&De.y<=_e&&De!==x&&De!==M&&Nc(D,j,O,$,N,Z,De.x,De.y)&&pr(De.prev,De,De.next)>=0)return!1;De=De.nextZ}return!0}function uw(c,s,f){var m=c;do{var x=m.prev,P=m.next.next;!aA(x,P)&&y_(x,m,m.next,P)&&Xh(x,P)&&Xh(P,x)&&(s.push(x.i/f|0),s.push(m.i/f|0),s.push(P.i/f|0),Zh(m),Zh(m.next),m=c=P),m=m.next}while(m!==c);return jl(m)}function Aw(c,s,f,m,x,P){var M=c;do{for(var D=M.next.next;D!==M.prev;){if(M.i!==D.i&&_w(M,D)){var O=b_(M,D);return M=jl(M,M.next),O=jl(O,O.next),qh(M,s,f,m,x,P,0),void qh(O,s,f,m,x,P,0)}D=D.next}M=M.next}while(M!==c)}function fw(c,s){return c.x-s.x}function dw(c,s){var f=function(x,P){var M,D=P,O=x.x,N=x.y,j=-1/0;do{if(N<=D.y&&N>=D.next.y&&D.next.y!==D.y){var $=D.x+(N-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if($<=O&&$>j&&(j=$,M=D.x<D.next.x?D:D.next,$===O))return M}D=D.next}while(D!==P);if(!M)return null;var Z,J=M,ee=M.x,ce=M.y,_e=1/0;D=M;do O>=D.x&&D.x>=ee&&O!==D.x&&Nc(N<ce?O:j,N,ee,ce,N<ce?j:O,N,D.x,D.y)&&(Z=Math.abs(N-D.y)/(O-D.x),Xh(D,x)&&(Z<_e||Z===_e&&(D.x>M.x||D.x===M.x&&pw(M,D)))&&(M=D,_e=Z)),D=D.next;while(D!==J);return M}(c,s);if(!f)return s;var m=b_(f,c);return jl(m,m.next),jl(f,f.next)}function pw(c,s){return pr(c.prev,c,s.prev)<0&&pr(s.next,c,c.next)<0}function wd(c,s,f,m,x){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-f)*x|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-m)*x|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function gw(c){var s=c,f=c;do(s.x<f.x||s.x===f.x&&s.y<f.y)&&(f=s),s=s.next;while(s!==c);return f}function Nc(c,s,f,m,x,P,M,D){return(x-M)*(s-D)>=(c-M)*(P-D)&&(c-M)*(m-D)>=(f-M)*(s-D)&&(f-M)*(P-D)>=(x-M)*(m-D)}function _w(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(f,m){var x=f;do{if(x.i!==f.i&&x.next.i!==f.i&&x.i!==m.i&&x.next.i!==m.i&&y_(x,x.next,f,m))return!0;x=x.next}while(x!==f);return!1}(c,s)&&(Xh(c,s)&&Xh(s,c)&&function(f,m){var x=f,P=!1,M=(f.x+m.x)/2,D=(f.y+m.y)/2;do x.y>D!=x.next.y>D&&x.next.y!==x.y&&M<(x.next.x-x.x)*(D-x.y)/(x.next.y-x.y)+x.x&&(P=!P),x=x.next;while(x!==f);return P}(c,s)&&(pr(c.prev,c,s.prev)||pr(c,s.prev,s))||aA(c,s)&&pr(c.prev,c,c.next)>0&&pr(s.prev,s,s.next)>0)}function pr(c,s,f){return(s.y-c.y)*(f.x-s.x)-(s.x-c.x)*(f.y-s.y)}function aA(c,s){return c.x===s.x&&c.y===s.y}function y_(c,s,f,m){var x=cA(pr(c,s,f)),P=cA(pr(c,s,m)),M=cA(pr(f,m,c)),D=cA(pr(f,m,s));return x!==P&&M!==D||!(x!==0||!lA(c,f,s))||!(P!==0||!lA(c,m,s))||!(M!==0||!lA(f,c,m))||!(D!==0||!lA(f,s,m))}function lA(c,s,f){return s.x<=Math.max(c.x,f.x)&&s.x>=Math.min(c.x,f.x)&&s.y<=Math.max(c.y,f.y)&&s.y>=Math.min(c.y,f.y)}function cA(c){return c>0?1:c<0?-1:0}function Xh(c,s){return pr(c.prev,c,c.next)<0?pr(c,s,c.next)>=0&&pr(c,c.prev,s)>=0:pr(c,s,c.prev)<0||pr(c,c.next,s)<0}function b_(c,s){var f=new Td(c.i,c.x,c.y),m=new Td(s.i,s.x,s.y),x=c.next,P=s.prev;return c.next=s,s.prev=c,f.next=x,x.prev=f,m.next=f,f.prev=m,P.next=m,m.prev=P,m}function v_(c,s,f,m){var x=new Td(c,s,f);return m?(x.next=m.next,x.prev=m,m.next.prev=x,m.next=x):(x.prev=x,x.next=x),x}function Zh(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Td(c,s,f){this.i=c,this.x=s,this.y=f,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ed(c,s,f,m){for(var x=0,P=s,M=f-m;P<f;P+=m)x+=(c[M]-c[P])*(c[P+1]+c[M+1]),M=P;return x}xd.exports=oA,xd.exports.default=oA,oA.deviation=function(c,s,f,m){var x=s&&s.length,P=Math.abs(Ed(c,0,x?s[0]*f:c.length,f));if(x)for(var M=0,D=s.length;M<D;M++)P-=Math.abs(Ed(c,s[M]*f,M<D-1?s[M+1]*f:c.length,f));var O=0;for(M=0;M<m.length;M+=3){var N=m[M]*f,j=m[M+1]*f,$=m[M+2]*f;O+=Math.abs((c[N]-c[$])*(c[j+1]-c[N+1])-(c[N]-c[j])*(c[$+1]-c[N+1]))}return P===0&&O===0?0:Math.abs((O-P)/P)},oA.flatten=function(c){for(var s=c[0][0].length,f={vertices:[],holes:[],dimensions:s},m=0,x=0;x<c.length;x++){for(var P=0;P<c[x].length;P++)for(var M=0;M<s;M++)f.vertices.push(c[x][P][M]);x>0&&f.holes.push(m+=c[x-1].length)}return f};var x_=R(xd.exports);function mw(c,s,f,m,x){w_(c,s,f||0,m||c.length-1,x||yw)}function w_(c,s,f,m,x){for(;m>f;){if(m-f>600){var P=m-f+1,M=s-f+1,D=Math.log(P),O=.5*Math.exp(2*D/3),N=.5*Math.sqrt(D*O*(P-O)/P)*(M-P/2<0?-1:1);w_(c,s,Math.max(f,Math.floor(s-M*O/P+N)),Math.min(m,Math.floor(s+(P-M)*O/P+N)),x)}var j=c[s],$=f,Z=m;for(Yh(c,f,s),x(c[m],j)>0&&Yh(c,f,m);$<Z;){for(Yh(c,$,Z),$++,Z--;x(c[$],j)<0;)$++;for(;x(c[Z],j)>0;)Z--}x(c[f],j)===0?Yh(c,f,Z):Yh(c,++Z,m),Z<=s&&(f=Z+1),s<=Z&&(m=Z-1)}}function Yh(c,s,f){var m=c[s];c[s]=c[f],c[f]=m}function yw(c,s){return c<s?-1:c>s?1:0}function Sd(c,s){const f=c.length;if(f<=1)return[c];const m=[];let x,P;for(let M=0;M<f;M++){const D=Nr(c[M]);D!==0&&(c[M].area=Math.abs(D),P===void 0&&(P=D<0),P===D<0?(x&&m.push(x),x=[c[M]]):x.push(c[M]))}if(x&&m.push(x),s>1)for(let M=0;M<m.length;M++)m[M].length<=s||(mw(m[M],s,1,m[M].length-1,bw),m[M]=m[M].slice(0,s));return m}function bw(c,s){return s.area-c.area}function Cd(c,s,f){const m=f.patternDependencies;let x=!1;for(const P of s){const M=P.paint.get(`${c}-pattern`);M.isConstant()||(x=!0);const D=M.constantOr(null);D&&(x=!0,m[D.to]=!0,m[D.from]=!0)}return x}function Pd(c,s,f,m,x){const P=x.patternDependencies;for(const M of s){const D=M.paint.get(`${c}-pattern`).value;if(D.kind!=="constant"){let O=D.evaluate({zoom:m-1},f,{},x.availableImages),N=D.evaluate({zoom:m},f,{},x.availableImages),j=D.evaluate({zoom:m+1},f,{},x.availableImages);O=O&&O.name?O.name:O,N=N&&N.name?N.name:N,j=j&&j.name?j.name:j,P[O]=!0,P[N]=!0,P[j]=!0,f.patterns[M.id]={min:O,mid:N,max:j}}}return f}class Id{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(f=>f.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ye,this.indexArray=new ti,this.indexArray2=new kt,this.programConfigurations=new ro(s.layers,s.zoom),this.segments=new Oi,this.segments2=new Oi,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(s,f,m){this.hasPattern=Cd("fill",this.layers,f);const x=this.layers[0].layout.get("fill-sort-key"),P=!x.isConstant(),M=[];for(const{feature:D,id:O,index:N,sourceLayerIndex:j}of s){const $=this.layers[0]._featureFilter.needGeometry,Z=Vl(D,$);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),Z,m))continue;const J=P?x.evaluate(Z,{},m,f.availableImages):void 0,ee={id:O,properties:D.properties,type:D.type,sourceLayerIndex:j,index:N,geometry:$?Z.geometry:Ul(D),patterns:{},sortKey:J};M.push(ee)}P&&M.sort((D,O)=>D.sortKey-O.sortKey);for(const D of M){const{geometry:O,index:N,sourceLayerIndex:j}=D;if(this.hasPattern){const $=Pd("fill",this.layers,D,this.zoom,f);this.patternFeatures.push($)}else this.addFeature(D,O,N,m,{});f.featureIndex.insert(s[N].feature,O,N,j,this.index)}}update(s,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,f,this.stateDependentLayers,m)}addFeatures(s,f,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,lw),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,f,m,x,P){for(const M of Sd(f,500)){let D=0;for(const J of M)D+=J.length;const O=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),N=O.vertexLength,j=[],$=[];for(const J of M){if(J.length===0)continue;J!==M[0]&&$.push(j.length/2);const ee=this.segments2.prepareSegment(J.length,this.layoutVertexArray,this.indexArray2),ce=ee.vertexLength;this.layoutVertexArray.emplaceBack(J[0].x,J[0].y),this.indexArray2.emplaceBack(ce+J.length-1,ce),j.push(J[0].x),j.push(J[0].y);for(let _e=1;_e<J.length;_e++)this.layoutVertexArray.emplaceBack(J[_e].x,J[_e].y),this.indexArray2.emplaceBack(ce+_e-1,ce+_e),j.push(J[_e].x),j.push(J[_e].y);ee.vertexLength+=J.length,ee.primitiveLength+=J.length}const Z=x_(j,$);for(let J=0;J<Z.length;J+=3)this.indexArray.emplaceBack(N+Z[J],N+Z[J+1],N+Z[J+2]);O.vertexLength+=D,O.primitiveLength+=Z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,P,x)}}let T_,E_;bt("FillBucket",Id,{omit:["layers","patternFeatures"]});var vw={get paint(){return E_=E_||new rr({"fill-antialias":new It(Xe.paint_fill["fill-antialias"]),"fill-opacity":new Ht(Xe.paint_fill["fill-opacity"]),"fill-color":new Ht(Xe.paint_fill["fill-color"]),"fill-outline-color":new Ht(Xe.paint_fill["fill-outline-color"]),"fill-translate":new It(Xe.paint_fill["fill-translate"]),"fill-translate-anchor":new It(Xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ca(Xe.paint_fill["fill-pattern"])})},get layout(){return T_=T_||new rr({"fill-sort-key":new Ht(Xe.layout_fill["fill-sort-key"])})}};class xw extends sr{constructor(s){super(s,vw)}recalculate(s,f){super.recalculate(s,f);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new Id(s)}queryRadius(){return rA(this.paint.get("fill-translate"))}queryIntersectsFeature(s,f,m,x,P,M,D){return o_(sA(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,D),x)}isTileClipped(){return!0}}const ww=ci([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Tw=ci([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ew}=ww;var Ha={},Sw=L,S_=zc;function zc(c,s,f,m,x){this.properties={},this.extent=f,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=x,c.readFields(Cw,this,s)}function Cw(c,s,f){c==1?s.id=f.readVarint():c==2?function(m,x){for(var P=m.readVarint()+m.pos;m.pos<P;){var M=x._keys[m.readVarint()],D=x._values[m.readVarint()];x.properties[M]=D}}(f,s):c==3?s.type=f.readVarint():c==4&&(s._geometry=f.pos)}function Pw(c){for(var s,f,m=0,x=0,P=c.length,M=P-1;x<P;M=x++)m+=((f=c[M]).x-(s=c[x]).x)*(s.y+f.y);return m}zc.types=["Unknown","Point","LineString","Polygon"],zc.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var s,f=c.readVarint()+c.pos,m=1,x=0,P=0,M=0,D=[];c.pos<f;){if(x<=0){var O=c.readVarint();m=7&O,x=O>>3}if(x--,m===1||m===2)P+=c.readSVarint(),M+=c.readSVarint(),m===1&&(s&&D.push(s),s=[]),s.push(new Sw(P,M));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&D.push(s),D},zc.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var s=c.readVarint()+c.pos,f=1,m=0,x=0,P=0,M=1/0,D=-1/0,O=1/0,N=-1/0;c.pos<s;){if(m<=0){var j=c.readVarint();f=7&j,m=j>>3}if(m--,f===1||f===2)(x+=c.readSVarint())<M&&(M=x),x>D&&(D=x),(P+=c.readSVarint())<O&&(O=P),P>N&&(N=P);else if(f!==7)throw new Error("unknown command "+f)}return[M,O,D,N]},zc.prototype.toGeoJSON=function(c,s,f){var m,x,P=this.extent*Math.pow(2,f),M=this.extent*c,D=this.extent*s,O=this.loadGeometry(),N=zc.types[this.type];function j(J){for(var ee=0;ee<J.length;ee++){var ce=J[ee];J[ee]=[360*(ce.x+M)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(ce.y+D)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(m=0;m<O.length;m++)$[m]=O[m][0];j(O=$);break;case 2:for(m=0;m<O.length;m++)j(O[m]);break;case 3:for(O=function(J){var ee=J.length;if(ee<=1)return[J];for(var ce,_e,xe=[],Re=0;Re<ee;Re++){var Ie=Pw(J[Re]);Ie!==0&&(_e===void 0&&(_e=Ie<0),_e===Ie<0?(ce&&xe.push(ce),ce=[J[Re]]):ce.push(J[Re]))}return ce&&xe.push(ce),xe}(O),m=0;m<O.length;m++)for(x=0;x<O[m].length;x++)j(O[m][x])}O.length===1?O=O[0]:N="Multi"+N;var Z={type:"Feature",geometry:{type:N,coordinates:O},properties:this.properties};return"id"in this&&(Z.id=this.id),Z};var Iw=S_,C_=P_;function P_(c,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Mw,this,s),this.length=this._features.length}function Mw(c,s,f){c===15?s.version=f.readVarint():c===1?s.name=f.readString():c===5?s.extent=f.readVarint():c===2?s._features.push(f.pos):c===3?s._keys.push(f.readString()):c===4&&s._values.push(function(m){for(var x=null,P=m.readVarint()+m.pos;m.pos<P;){var M=m.readVarint()>>3;x=M===1?m.readString():M===2?m.readFloat():M===3?m.readDouble():M===4?m.readVarint64():M===5?m.readVarint():M===6?m.readSVarint():M===7?m.readBoolean():null}return x}(f))}P_.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var s=this._pbf.readVarint()+this._pbf.pos;return new Iw(this._pbf,s,this.extent,this._keys,this._values)};var Rw=C_;function kw(c,s,f){if(c===3){var m=new Rw(f,f.readVarint()+f.pos);m.length&&(s[m.name]=m)}}Ha.VectorTile=function(c,s){this.layers=c.readFields(kw,{},s)},Ha.VectorTileFeature=S_,Ha.VectorTileLayer=C_;const Dw=Ha.VectorTileFeature.types,Md=Math.pow(2,13);function Gh(c,s,f,m,x,P,M,D){c.emplaceBack(s,f,2*Math.floor(m*Md)+M,x*Md*2,P*Md*2,Math.round(D))}class Rd{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(f=>f.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new je,this.centroidVertexArray=new be,this.indexArray=new ti,this.programConfigurations=new ro(s.layers,s.zoom),this.segments=new Oi,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(s,f,m){this.features=[],this.hasPattern=Cd("fill-extrusion",this.layers,f);for(const{feature:x,id:P,index:M,sourceLayerIndex:D}of s){const O=this.layers[0]._featureFilter.needGeometry,N=Vl(x,O);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),N,m))continue;const j={id:P,sourceLayerIndex:D,index:M,geometry:O?N.geometry:Ul(x),properties:x.properties,type:x.type,patterns:{}};this.hasPattern?this.features.push(Pd("fill-extrusion",this.layers,j,this.zoom,f)):this.addFeature(j,j.geometry,M,m,{}),f.featureIndex.insert(x,j.geometry,M,D,this.index,!0)}}addFeatures(s,f,m){for(const x of this.features){const{geometry:P}=x;this.addFeature(x,P,x.index,f,m)}}update(s,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Ew),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,Tw.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,f,m,x,P){const M={x:0,y:0,vertexCount:0};for(const D of Sd(f,500)){let O=0;for(const ee of D)O+=ee.length;let N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ee of D){if(ee.length===0||Fw(ee))continue;let ce=0;for(let _e=0;_e<ee.length;_e++){const xe=ee[_e];if(_e>=1){const Re=ee[_e-1];if(!Bw(xe,Re)){N.vertexLength+4>Oi.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ie=xe.sub(Re)._perp()._unit(),De=Re.dist(xe);ce+De>32768&&(ce=0),Gh(this.layoutVertexArray,xe.x,xe.y,Ie.x,Ie.y,0,0,ce),Gh(this.layoutVertexArray,xe.x,xe.y,Ie.x,Ie.y,0,1,ce),M.x+=2*xe.x,M.y+=2*xe.y,M.vertexCount+=2,ce+=De,Gh(this.layoutVertexArray,Re.x,Re.y,Ie.x,Ie.y,0,0,ce),Gh(this.layoutVertexArray,Re.x,Re.y,Ie.x,Ie.y,0,1,ce),M.x+=2*Re.x,M.y+=2*Re.y,M.vertexCount+=2;const Ue=N.vertexLength;this.indexArray.emplaceBack(Ue,Ue+2,Ue+1),this.indexArray.emplaceBack(Ue+1,Ue+2,Ue+3),N.vertexLength+=4,N.primitiveLength+=2}}}}if(N.vertexLength+O>Oi.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray)),Dw[s.type]!=="Polygon")continue;const j=[],$=[],Z=N.vertexLength;for(const ee of D)if(ee.length!==0){ee!==D[0]&&$.push(j.length/2);for(let ce=0;ce<ee.length;ce++){const _e=ee[ce];Gh(this.layoutVertexArray,_e.x,_e.y,0,0,1,1,0),M.x+=_e.x,M.y+=_e.y,M.vertexCount+=1,j.push(_e.x),j.push(_e.y)}}const J=x_(j,$);for(let ee=0;ee<J.length;ee+=3)this.indexArray.emplaceBack(Z+J[ee],Z+J[ee+2],Z+J[ee+1]);N.primitiveLength+=J.length/3,N.vertexLength+=O}for(let D=0;D<M.vertexCount;D++)this.centroidVertexArray.emplaceBack(Math.floor(M.x/M.vertexCount),Math.floor(M.y/M.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,P,x)}}function Bw(c,s){return c.x===s.x&&(c.x<0||c.x>vr)||c.y===s.y&&(c.y<0||c.y>vr)}function Fw(c){return c.every(s=>s.x<0)||c.every(s=>s.x>vr)||c.every(s=>s.y<0)||c.every(s=>s.y>vr)}let I_;bt("FillExtrusionBucket",Rd,{omit:["layers","features"]});var Ow={get paint(){return I_=I_||new rr({"fill-extrusion-opacity":new It(Xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ht(Xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It(Xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It(Xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ca(Xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ht(Xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ht(Xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new It(Xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Lw extends sr{constructor(s){super(s,Ow)}createBucket(s){return new Rd(s)}queryRadius(){return rA(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,f,m,x,P,M,D,O){const N=sA(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,D),j=this.paint.get("fill-extrusion-height").evaluate(f,m),$=this.paint.get("fill-extrusion-base").evaluate(f,m),Z=function(ee,ce,_e,xe){const Re=[];for(const Ie of ee){const De=[Ie.x,Ie.y,0,1];nA(De,De,ce),Re.push(new V(De[0]/De[3],De[1]/De[3]))}return Re}(N,O),J=function(ee,ce,_e,xe){const Re=[],Ie=[],De=xe[8]*ce,Ue=xe[9]*ce,Ze=xe[10]*ce,_t=xe[11]*ce,Ct=xe[8]*_e,gt=xe[9]*_e,At=xe[10]*_e,ot=xe[11]*_e;for(const Tt of ee){const lt=[],tt=[];for(const jt of Tt){const Dt=jt.x,ai=jt.y,Wi=xe[0]*Dt+xe[4]*ai+xe[12],Zi=xe[1]*Dt+xe[5]*ai+xe[13],Pr=xe[2]*Dt+xe[6]*ai+xe[14],an=xe[3]*Dt+xe[7]*ai+xe[15],Is=Pr+Ze,xr=an+_t,qr=Wi+Ct,is=Zi+gt,Ms=Pr+At,Rs=an+ot,Ir=new V((Wi+De)/xr,(Zi+Ue)/xr);Ir.z=Is/xr,lt.push(Ir);const Mr=new V(qr/Rs,is/Rs);Mr.z=Ms/Rs,tt.push(Mr)}Re.push(lt),Ie.push(tt)}return[Re,Ie]}(x,$,j,O);return function(ee,ce,_e){let xe=1/0;o_(_e,ce)&&(xe=M_(_e,ce[0]));for(let Re=0;Re<ce.length;Re++){const Ie=ce[Re],De=ee[Re];for(let Ue=0;Ue<Ie.length-1;Ue++){const Ze=Ie[Ue],_t=[Ze,Ie[Ue+1],De[Ue+1],De[Ue],Ze];n_(_e,_t)&&(xe=Math.min(xe,M_(_e,_t)))}}return xe!==1/0&&xe}(J[0],J[1],Z)}}function Qh(c,s){return c.x*s.x+c.y*s.y}function M_(c,s){if(c.length===1){let f=0;const m=s[f++];let x;for(;!x||m.equals(x);)if(x=s[f++],!x)return 1/0;for(;f<s.length;f++){const P=s[f],M=c[0],D=x.sub(m),O=P.sub(m),N=M.sub(m),j=Qh(D,D),$=Qh(D,O),Z=Qh(O,O),J=Qh(N,D),ee=Qh(N,O),ce=j*Z-$*$,_e=(Z*J-$*ee)/ce,xe=(j*ee-$*J)/ce,Re=m.z*(1-_e-xe)+x.z*_e+P.z*xe;if(isFinite(Re))return Re}return 1/0}{let f=1/0;for(const m of s)f=Math.min(f,m.z);return f}}const Nw=ci([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:zw}=Nw,Uw=ci([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Vw}=Uw,jw=Ha.VectorTileFeature.types,$w=Math.cos(Math.PI/180*37.5),R_=Math.pow(2,14)/.5;class kd{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(f=>f.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new He,this.layoutVertexArray2=new $e,this.indexArray=new ti,this.programConfigurations=new ro(s.layers,s.zoom),this.segments=new Oi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(s,f,m){this.hasPattern=Cd("line",this.layers,f);const x=this.layers[0].layout.get("line-sort-key"),P=!x.isConstant(),M=[];for(const{feature:D,id:O,index:N,sourceLayerIndex:j}of s){const $=this.layers[0]._featureFilter.needGeometry,Z=Vl(D,$);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),Z,m))continue;const J=P?x.evaluate(Z,{},m):void 0,ee={id:O,properties:D.properties,type:D.type,sourceLayerIndex:j,index:N,geometry:$?Z.geometry:Ul(D),patterns:{},sortKey:J};M.push(ee)}P&&M.sort((D,O)=>D.sortKey-O.sortKey);for(const D of M){const{geometry:O,index:N,sourceLayerIndex:j}=D;if(this.hasPattern){const $=Pd("line",this.layers,D,this.zoom,f);this.patternFeatures.push($)}else this.addFeature(D,O,N,m,{});f.featureIndex.insert(s[N].feature,O,N,j,this.index)}}update(s,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,f,this.stateDependentLayers,m)}addFeatures(s,f,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,Vw)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,zw),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,f,m,x,P){const M=this.layers[0].layout,D=M.get("line-join").evaluate(s,{}),O=M.get("line-cap"),N=M.get("line-miter-limit"),j=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const $ of f)this.addLine($,s,D,O,N,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,P,x)}addLine(s,f,m,x,P,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<s.length-1;xe++)this.totalDistance+=s[xe].dist(s[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D=jw[f.type]==="Polygon";let O=s.length;for(;O>=2&&s[O-1].equals(s[O-2]);)O--;let N=0;for(;N<O-1&&s[N].equals(s[N+1]);)N++;if(O<(D?3:2))return;m==="bevel"&&(P=1.05);const j=this.overscaling<=16?15*vr/(512*this.overscaling):0,$=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray);let Z,J,ee,ce,_e;this.e1=this.e2=-1,D&&(Z=s[O-2],_e=s[N].sub(Z)._unit()._perp());for(let xe=N;xe<O;xe++){if(ee=xe===O-1?D?s[N+1]:void 0:s[xe+1],ee&&s[xe].equals(ee))continue;_e&&(ce=_e),Z&&(J=Z),Z=s[xe],_e=ee?ee.sub(Z)._unit()._perp():ce,ce=ce||_e;let Re=ce.add(_e);Re.x===0&&Re.y===0||Re._unit();const Ie=ce.x*_e.x+ce.y*_e.y,De=Re.x*_e.x+Re.y*_e.y,Ue=De!==0?1/De:1/0,Ze=2*Math.sqrt(2-2*De),_t=De<$w&&J&&ee,Ct=ce.x*_e.y-ce.y*_e.x>0;if(_t&&xe>N){const ot=Z.dist(J);if(ot>2*j){const Tt=Z.sub(Z.sub(J)._mult(j/ot)._round());this.updateDistance(J,Tt),this.addCurrentVertex(Tt,ce,0,0,$),J=Tt}}const gt=J&&ee;let At=gt?m:D?"butt":x;if(gt&&At==="round"&&(Ue<M?At="miter":Ue<=2&&(At="fakeround")),At==="miter"&&Ue>P&&(At="bevel"),At==="bevel"&&(Ue>2&&(At="flipbevel"),Ue<P&&(At="miter")),J&&this.updateDistance(J,Z),At==="miter")Re._mult(Ue),this.addCurrentVertex(Z,Re,0,0,$);else if(At==="flipbevel"){if(Ue>100)Re=_e.mult(-1);else{const ot=Ue*ce.add(_e).mag()/ce.sub(_e).mag();Re._perp()._mult(ot*(Ct?-1:1))}this.addCurrentVertex(Z,Re,0,0,$),this.addCurrentVertex(Z,Re.mult(-1),0,0,$)}else if(At==="bevel"||At==="fakeround"){const ot=-Math.sqrt(Ue*Ue-1),Tt=Ct?ot:0,lt=Ct?0:ot;if(J&&this.addCurrentVertex(Z,ce,Tt,lt,$),At==="fakeround"){const tt=Math.round(180*Ze/Math.PI/20);for(let jt=1;jt<tt;jt++){let Dt=jt/tt;if(Dt!==.5){const Wi=Dt-.5;Dt+=Dt*Wi*(Dt-1)*((1.0904+Ie*(Ie*(3.55645-1.43519*Ie)-3.2452))*Wi*Wi+(.848013+Ie*(.215638*Ie-1.06021)))}const ai=_e.sub(ce)._mult(Dt)._add(ce)._unit()._mult(Ct?-1:1);this.addHalfVertex(Z,ai.x,ai.y,!1,Ct,0,$)}}ee&&this.addCurrentVertex(Z,_e,-Tt,-lt,$)}else if(At==="butt")this.addCurrentVertex(Z,Re,0,0,$);else if(At==="square"){const ot=J?1:-1;this.addCurrentVertex(Z,Re,ot,ot,$)}else At==="round"&&(J&&(this.addCurrentVertex(Z,ce,0,0,$),this.addCurrentVertex(Z,ce,1,1,$,!0)),ee&&(this.addCurrentVertex(Z,_e,-1,-1,$,!0),this.addCurrentVertex(Z,_e,0,0,$)));if(_t&&xe<O-1){const ot=Z.dist(ee);if(ot>2*j){const Tt=Z.add(ee.sub(Z)._mult(j/ot)._round());this.updateDistance(Z,Tt),this.addCurrentVertex(Tt,_e,0,0,$),Z=Tt}}}}addCurrentVertex(s,f,m,x,P,M=!1){const D=f.y*x-f.x,O=-f.y-f.x*x;this.addHalfVertex(s,f.x+f.y*m,f.y-f.x*m,M,!1,m,P),this.addHalfVertex(s,D,O,M,!0,-x,P),this.distance>R_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,f,m,x,P,M))}addHalfVertex({x:s,y:f},m,x,P,M,D,O){const N=.5*(this.lineClips?this.scaledDistance*(R_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(P?1:0),(f<<1)+(M?1:0),Math.round(63*m)+128,Math.round(63*x)+128,1+(D===0?0:D<0?-1:1)|(63&N)<<2,N>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=O.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),O.primitiveLength++),M?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,f){this.distance+=s.dist(f),this.updateScaledDistance()}}let k_,D_;bt("LineBucket",kd,{omit:["layers","patternFeatures"]});var B_={get paint(){return D_=D_||new rr({"line-opacity":new Ht(Xe.paint_line["line-opacity"]),"line-color":new Ht(Xe.paint_line["line-color"]),"line-translate":new It(Xe.paint_line["line-translate"]),"line-translate-anchor":new It(Xe.paint_line["line-translate-anchor"]),"line-width":new Ht(Xe.paint_line["line-width"]),"line-gap-width":new Ht(Xe.paint_line["line-gap-width"]),"line-offset":new Ht(Xe.paint_line["line-offset"]),"line-blur":new Ht(Xe.paint_line["line-blur"]),"line-dasharray":new Nl(Xe.paint_line["line-dasharray"]),"line-pattern":new ca(Xe.paint_line["line-pattern"]),"line-gradient":new zl(Xe.paint_line["line-gradient"])})},get layout(){return k_=k_||new rr({"line-cap":new It(Xe.layout_line["line-cap"]),"line-join":new Ht(Xe.layout_line["line-join"]),"line-miter-limit":new It(Xe.layout_line["line-miter-limit"]),"line-round-limit":new It(Xe.layout_line["line-round-limit"]),"line-sort-key":new Ht(Xe.layout_line["line-sort-key"])})}};class Ww extends Ht{possiblyEvaluate(s,f){return f=new zi(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(s,f)}evaluate(s,f,m,x){return f=wt({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(s,f,m,x)}}let hA;class Hw extends sr{constructor(s){super(s,B_),this.gradientVersion=0,hA||(hA=new Ww(B_.paint.properties["line-width"].specification),hA.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const f=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(f)&&f._styleExpression.expression instanceof Rn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,f){super.recalculate(s,f),this.paint._values["line-floorwidth"]=hA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new kd(s)}queryRadius(s){const f=s,m=F_($h("line-width",this,f),$h("line-gap-width",this,f)),x=$h("line-offset",this,f);return m/2+Math.abs(x)+rA(this.paint.get("line-translate"))}queryIntersectsFeature(s,f,m,x,P,M,D){const O=sA(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,D),N=D/2*F_(this.paint.get("line-width").evaluate(f,m),this.paint.get("line-gap-width").evaluate(f,m)),j=this.paint.get("line-offset").evaluate(f,m);return j&&(x=function($,Z){const J=[];for(let ee=0;ee<$.length;ee++){const ce=$[ee],_e=[];for(let xe=0;xe<ce.length;xe++){const Re=ce[xe-1],Ie=ce[xe],De=ce[xe+1],Ue=xe===0?new V(0,0):Ie.sub(Re)._unit()._perp(),Ze=xe===ce.length-1?new V(0,0):De.sub(Ie)._unit()._perp(),_t=Ue._add(Ze)._unit(),Ct=_t.x*Ze.x+_t.y*Ze.y;Ct!==0&&_t._mult(1/Ct),_e.push(_t._mult(Z)._add(Ie))}J.push(_e)}return J}(x,j*D)),function($,Z,J){for(let ee=0;ee<Z.length;ee++){const ce=Z[ee];if($.length>=3){for(let _e=0;_e<ce.length;_e++)if(Oc($,ce[_e]))return!0}if(Qx($,ce,J))return!0}return!1}(O,x,N)}isTileClipped(){return!0}}function F_(c,s){return s>0?s+2*c:c}const qw=ci([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xw=ci([{name:"a_projected_pos",components:3,type:"Float32"}],4);ci([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Zw=ci([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ci([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const O_=ci([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Yw=ci([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Gw(c,s,f){return c.sections.forEach(m=>{m.text=function(x,P,M){const D=P.layout.get("text-transform").evaluate(M,{});return D==="uppercase"?x=x.toLocaleUpperCase():D==="lowercase"&&(x=x.toLocaleLowerCase()),ls.applyArabicShaping&&(x=ls.applyArabicShaping(x)),x}(m.text,s,f)}),c}ci([{name:"triangle",components:3,type:"Uint16"}]),ci([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ci([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ci([{type:"Float32",name:"offsetX"}]),ci([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ci([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Kh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Cr=24,L_=Li,N_=function(c,s,f,m,x){var P,M,D=8*x-m-1,O=(1<<D)-1,N=O>>1,j=-7,$=f?x-1:0,Z=f?-1:1,J=c[s+$];for($+=Z,P=J&(1<<-j)-1,J>>=-j,j+=D;j>0;P=256*P+c[s+$],$+=Z,j-=8);for(M=P&(1<<-j)-1,P>>=-j,j+=m;j>0;M=256*M+c[s+$],$+=Z,j-=8);if(P===0)P=1-N;else{if(P===O)return M?NaN:1/0*(J?-1:1);M+=Math.pow(2,m),P-=N}return(J?-1:1)*M*Math.pow(2,P-m)},z_=function(c,s,f,m,x,P){var M,D,O,N=8*P-x-1,j=(1<<N)-1,$=j>>1,Z=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=m?0:P-1,ee=m?1:-1,ce=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(D=isNaN(s)?1:0,M=j):(M=Math.floor(Math.log(s)/Math.LN2),s*(O=Math.pow(2,-M))<1&&(M--,O*=2),(s+=M+$>=1?Z/O:Z*Math.pow(2,1-$))*O>=2&&(M++,O/=2),M+$>=j?(D=0,M=j):M+$>=1?(D=(s*O-1)*Math.pow(2,x),M+=$):(D=s*Math.pow(2,$-1)*Math.pow(2,x),M=0));x>=8;c[f+J]=255&D,J+=ee,D/=256,x-=8);for(M=M<<x|D,N+=x;N>0;c[f+J]=255&M,J+=ee,M/=256,N-=8);c[f+J-ee]|=128*ce};function Li(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}Li.Varint=0,Li.Fixed64=1,Li.Bytes=2,Li.Fixed32=5;var Dd=4294967296,U_=1/Dd,V_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function da(c){return c.type===Li.Bytes?c.readVarint()+c.pos:c.pos+1}function Uc(c,s,f){return f?4294967296*s+(c>>>0):4294967296*(s>>>0)+(c>>>0)}function j_(c,s,f){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));f.realloc(m);for(var x=f.pos-1;x>=c;x--)f.buf[x+m]=f.buf[x]}function Qw(c,s){for(var f=0;f<c.length;f++)s.writeVarint(c[f])}function Kw(c,s){for(var f=0;f<c.length;f++)s.writeSVarint(c[f])}function Jw(c,s){for(var f=0;f<c.length;f++)s.writeFloat(c[f])}function eT(c,s){for(var f=0;f<c.length;f++)s.writeDouble(c[f])}function tT(c,s){for(var f=0;f<c.length;f++)s.writeBoolean(c[f])}function iT(c,s){for(var f=0;f<c.length;f++)s.writeFixed32(c[f])}function rT(c,s){for(var f=0;f<c.length;f++)s.writeSFixed32(c[f])}function sT(c,s){for(var f=0;f<c.length;f++)s.writeFixed64(c[f])}function nT(c,s){for(var f=0;f<c.length;f++)s.writeSFixed64(c[f])}function uA(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+16777216*c[s+3]}function Vc(c,s,f){c[f]=s,c[f+1]=s>>>8,c[f+2]=s>>>16,c[f+3]=s>>>24}function $_(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+(c[s+3]<<24)}Li.prototype={destroy:function(){this.buf=null},readFields:function(c,s,f){for(f=f||this.length;this.pos<f;){var m=this.readVarint(),x=m>>3,P=this.pos;this.type=7&m,c(x,s,this),this.pos===P&&this.skip(m)}return s},readMessage:function(c,s){return this.readFields(c,s,this.readVarint()+this.pos)},readFixed32:function(){var c=uA(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=$_(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=uA(this.buf,this.pos)+uA(this.buf,this.pos+4)*Dd;return this.pos+=8,c},readSFixed64:function(){var c=uA(this.buf,this.pos)+$_(this.buf,this.pos+4)*Dd;return this.pos+=8,c},readFloat:function(){var c=N_(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=N_(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var s,f,m=this.buf;return s=127&(f=m[this.pos++]),f<128?s:(s|=(127&(f=m[this.pos++]))<<7,f<128?s:(s|=(127&(f=m[this.pos++]))<<14,f<128?s:(s|=(127&(f=m[this.pos++]))<<21,f<128?s:function(x,P,M){var D,O,N=M.buf;if(D=(112&(O=N[M.pos++]))>>4,O<128||(D|=(127&(O=N[M.pos++]))<<3,O<128)||(D|=(127&(O=N[M.pos++]))<<10,O<128)||(D|=(127&(O=N[M.pos++]))<<17,O<128)||(D|=(127&(O=N[M.pos++]))<<24,O<128)||(D|=(1&(O=N[M.pos++]))<<31,O<128))return Uc(x,D,P);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(f=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,s=this.pos;return this.pos=c,c-s>=12&&V_?function(f,m,x){return V_.decode(f.subarray(m,x))}(this.buf,s,c):function(f,m,x){for(var P="",M=m;M<x;){var D,O,N,j=f[M],$=null,Z=j>239?4:j>223?3:j>191?2:1;if(M+Z>x)break;Z===1?j<128&&($=j):Z===2?(192&(D=f[M+1]))==128&&($=(31&j)<<6|63&D)<=127&&($=null):Z===3?(O=f[M+2],(192&(D=f[M+1]))==128&&(192&O)==128&&(($=(15&j)<<12|(63&D)<<6|63&O)<=2047||$>=55296&&$<=57343)&&($=null)):Z===4&&(O=f[M+2],N=f[M+3],(192&(D=f[M+1]))==128&&(192&O)==128&&(192&N)==128&&(($=(15&j)<<18|(63&D)<<12|(63&O)<<6|63&N)<=65535||$>=1114112)&&($=null)),$===null?($=65533,Z=1):$>65535&&($-=65536,P+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),P+=String.fromCharCode($),M+=Z}return P}(this.buf,s,c)},readBytes:function(){var c=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,c);return this.pos=c,s},readPackedVarint:function(c,s){if(this.type!==Li.Bytes)return c.push(this.readVarint(s));var f=da(this);for(c=c||[];this.pos<f;)c.push(this.readVarint(s));return c},readPackedSVarint:function(c){if(this.type!==Li.Bytes)return c.push(this.readSVarint());var s=da(this);for(c=c||[];this.pos<s;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==Li.Bytes)return c.push(this.readBoolean());var s=da(this);for(c=c||[];this.pos<s;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==Li.Bytes)return c.push(this.readFloat());var s=da(this);for(c=c||[];this.pos<s;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==Li.Bytes)return c.push(this.readDouble());var s=da(this);for(c=c||[];this.pos<s;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==Li.Bytes)return c.push(this.readFixed32());var s=da(this);for(c=c||[];this.pos<s;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==Li.Bytes)return c.push(this.readSFixed32());var s=da(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==Li.Bytes)return c.push(this.readFixed64());var s=da(this);for(c=c||[];this.pos<s;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==Li.Bytes)return c.push(this.readSFixed64());var s=da(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed64());return c},skip:function(c){var s=7&c;if(s===Li.Varint)for(;this.buf[this.pos++]>127;);else if(s===Li.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Li.Fixed32)this.pos+=4;else{if(s!==Li.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(c,s){this.writeVarint(c<<3|s)},realloc:function(c){for(var s=this.length||16;s<this.pos+c;)s*=2;if(s!==this.length){var f=new Uint8Array(s);f.set(this.buf),this.buf=f,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),Vc(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),Vc(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),Vc(this.buf,-1&c,this.pos),Vc(this.buf,Math.floor(c*U_),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),Vc(this.buf,-1&c,this.pos),Vc(this.buf,Math.floor(c*U_),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(s,f){var m,x;if(s>=0?(m=s%4294967296|0,x=s/4294967296|0):(x=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,x=x+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(P,M,D){D.buf[D.pos++]=127&P|128,P>>>=7,D.buf[D.pos++]=127&P|128,P>>>=7,D.buf[D.pos++]=127&P|128,P>>>=7,D.buf[D.pos++]=127&P|128,D.buf[D.pos]=127&(P>>>=7)}(m,0,f),function(P,M){var D=(7&P)<<4;M.buf[M.pos++]|=D|((P>>>=3)?128:0),P&&(M.buf[M.pos++]=127&P|((P>>>=7)?128:0),P&&(M.buf[M.pos++]=127&P|((P>>>=7)?128:0),P&&(M.buf[M.pos++]=127&P|((P>>>=7)?128:0),P&&(M.buf[M.pos++]=127&P|((P>>>=7)?128:0),P&&(M.buf[M.pos++]=127&P)))))}(x,f)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var s=this.pos;this.pos=function(m,x,P){for(var M,D,O=0;O<x.length;O++){if((M=x.charCodeAt(O))>55295&&M<57344){if(!D){M>56319||O+1===x.length?(m[P++]=239,m[P++]=191,m[P++]=189):D=M;continue}if(M<56320){m[P++]=239,m[P++]=191,m[P++]=189,D=M;continue}M=D-55296<<10|M-56320|65536,D=null}else D&&(m[P++]=239,m[P++]=191,m[P++]=189,D=null);M<128?m[P++]=M:(M<2048?m[P++]=M>>6|192:(M<65536?m[P++]=M>>12|224:(m[P++]=M>>18|240,m[P++]=M>>12&63|128),m[P++]=M>>6&63|128),m[P++]=63&M|128)}return P}(this.buf,c,this.pos);var f=this.pos-s;f>=128&&j_(s,f,this),this.pos=s-1,this.writeVarint(f),this.pos+=f},writeFloat:function(c){this.realloc(4),z_(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),z_(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var s=c.length;this.writeVarint(s),this.realloc(s);for(var f=0;f<s;f++)this.buf[this.pos++]=c[f]},writeRawMessage:function(c,s){this.pos++;var f=this.pos;c(s,this);var m=this.pos-f;m>=128&&j_(f,m,this),this.pos=f-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,s,f){this.writeTag(c,Li.Bytes),this.writeRawMessage(s,f)},writePackedVarint:function(c,s){s.length&&this.writeMessage(c,Qw,s)},writePackedSVarint:function(c,s){s.length&&this.writeMessage(c,Kw,s)},writePackedBoolean:function(c,s){s.length&&this.writeMessage(c,tT,s)},writePackedFloat:function(c,s){s.length&&this.writeMessage(c,Jw,s)},writePackedDouble:function(c,s){s.length&&this.writeMessage(c,eT,s)},writePackedFixed32:function(c,s){s.length&&this.writeMessage(c,iT,s)},writePackedSFixed32:function(c,s){s.length&&this.writeMessage(c,rT,s)},writePackedFixed64:function(c,s){s.length&&this.writeMessage(c,sT,s)},writePackedSFixed64:function(c,s){s.length&&this.writeMessage(c,nT,s)},writeBytesField:function(c,s){this.writeTag(c,Li.Bytes),this.writeBytes(s)},writeFixed32Field:function(c,s){this.writeTag(c,Li.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(c,s){this.writeTag(c,Li.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(c,s){this.writeTag(c,Li.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(c,s){this.writeTag(c,Li.Fixed64),this.writeSFixed64(s)},writeVarintField:function(c,s){this.writeTag(c,Li.Varint),this.writeVarint(s)},writeSVarintField:function(c,s){this.writeTag(c,Li.Varint),this.writeSVarint(s)},writeStringField:function(c,s){this.writeTag(c,Li.Bytes),this.writeString(s)},writeFloatField:function(c,s){this.writeTag(c,Li.Fixed32),this.writeFloat(s)},writeDoubleField:function(c,s){this.writeTag(c,Li.Fixed64),this.writeDouble(s)},writeBooleanField:function(c,s){this.writeVarintField(c,!!s)}};var Bd=R(L_);const Fd=3;function oT(c,s,f){c===1&&f.readMessage(aT,s)}function aT(c,s,f){if(c===3){const{id:m,bitmap:x,width:P,height:M,left:D,top:O,advance:N}=f.readMessage(lT,{});s.push({id:m,bitmap:new Hh({width:P+2*Fd,height:M+2*Fd},x),metrics:{width:P,height:M,left:D,top:O,advance:N}})}}function lT(c,s,f){c===1?s.id=f.readVarint():c===2?s.bitmap=f.readBytes():c===3?s.width=f.readVarint():c===4?s.height=f.readVarint():c===5?s.left=f.readSVarint():c===6?s.top=f.readSVarint():c===7&&(s.advance=f.readVarint())}const W_=Fd;function H_(c){let s=0,f=0;for(const M of c)s+=M.w*M.h,f=Math.max(f,M.w);c.sort((M,D)=>D.h-M.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),f),h:1/0}];let x=0,P=0;for(const M of c)for(let D=m.length-1;D>=0;D--){const O=m[D];if(!(M.w>O.w||M.h>O.h)){if(M.x=O.x,M.y=O.y,P=Math.max(P,M.y+M.h),x=Math.max(x,M.x+M.w),M.w===O.w&&M.h===O.h){const N=m.pop();D<m.length&&(m[D]=N)}else M.h===O.h?(O.x+=M.w,O.w-=M.w):M.w===O.w?(O.y+=M.h,O.h-=M.h):(m.push({x:O.x+M.w,y:O.y,w:O.w-M.w,h:M.h}),O.y+=M.h,O.h-=M.h);break}}return{w:x,h:P,fill:s/(x*P)||0}}const Hs=1;class Od{constructor(s,{pixelRatio:f,version:m,stretchX:x,stretchY:P,content:M}){this.paddedRect=s,this.pixelRatio=f,this.stretchX=x,this.stretchY=P,this.content=M,this.version=m}get tl(){return[this.paddedRect.x+Hs,this.paddedRect.y+Hs]}get br(){return[this.paddedRect.x+this.paddedRect.w-Hs,this.paddedRect.y+this.paddedRect.h-Hs]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Hs)/this.pixelRatio,(this.paddedRect.h-2*Hs)/this.pixelRatio]}}class q_{constructor(s,f){const m={},x={};this.haveRenderCallbacks=[];const P=[];this.addImages(s,m,P),this.addImages(f,x,P);const{w:M,h:D}=H_(P),O=new vn({width:M||1,height:D||1});for(const N in s){const j=s[N],$=m[N].paddedRect;vn.copy(j.data,O,{x:0,y:0},{x:$.x+Hs,y:$.y+Hs},j.data)}for(const N in f){const j=f[N],$=x[N].paddedRect,Z=$.x+Hs,J=$.y+Hs,ee=j.data.width,ce=j.data.height;vn.copy(j.data,O,{x:0,y:0},{x:Z,y:J},j.data),vn.copy(j.data,O,{x:0,y:ce-1},{x:Z,y:J-1},{width:ee,height:1}),vn.copy(j.data,O,{x:0,y:0},{x:Z,y:J+ce},{width:ee,height:1}),vn.copy(j.data,O,{x:ee-1,y:0},{x:Z-1,y:J},{width:1,height:ce}),vn.copy(j.data,O,{x:0,y:0},{x:Z+ee,y:J},{width:1,height:ce})}this.image=O,this.iconPositions=m,this.patternPositions=x}addImages(s,f,m){for(const x in s){const P=s[x],M={x:0,y:0,w:P.data.width+2*Hs,h:P.data.height+2*Hs};m.push(M),f[x]=new Od(M,P),P.hasRenderCallback&&this.haveRenderCallbacks.push(x)}}patchUpdatedImages(s,f){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in s.updatedImages)this.patchUpdatedImage(this.iconPositions[m],s.getImage(m),f),this.patchUpdatedImage(this.patternPositions[m],s.getImage(m),f)}patchUpdatedImage(s,f,m){if(!s||!f||s.version===f.version)return;s.version=f.version;const[x,P]=s.tl;m.update(f.data,void 0,{x,y:P})}}var qa;bt("ImagePosition",Od),bt("ImageAtlas",q_),l.ai=void 0,(qa=l.ai||(l.ai={}))[qa.none=0]="none",qa[qa.horizontal=1]="horizontal",qa[qa.vertical=2]="vertical",qa[qa.horizontalOnly=3]="horizontalOnly";const Jh=-17;class eu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,f){const m=new eu;return m.scale=s||1,m.fontStack=f,m}static forImage(s){const f=new eu;return f.imageName=s,f}}class jc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,f){const m=new jc;for(let x=0;x<s.sections.length;x++){const P=s.sections[x];P.image?m.addImageSection(P):m.addTextSection(P,f)}return m}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let f="";for(let m=0;m<s.length;m++){const x=s.charCodeAt(m+1)||null,P=s.charCodeAt(m-1)||null;f+=x&&kl(x)&&!Kh[s[m+1]]||P&&kl(P)&&!Kh[s[m-1]]||!Kh[s[m]]?s[m]:Kh[s[m]]}return f}(this.text)}trim(){let s=0;for(let m=0;m<this.text.length&&fA[this.text.charCodeAt(m)];m++)s++;let f=this.text.length;for(let m=this.text.length-1;m>=0&&m>=s&&fA[this.text.charCodeAt(m)];m--)f--;this.text=this.text.substring(s,f),this.sectionIndex=this.sectionIndex.slice(s,f)}substring(s,f){const m=new jc;return m.text=this.text.substring(s,f),m.sectionIndex=this.sectionIndex.slice(s,f),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,f)=>Math.max(s,this.sections[f].scale),0)}addTextSection(s,f){this.text+=s.text,this.sections.push(eu.forText(s.scale,s.fontStack||f));const m=this.sections.length-1;for(let x=0;x<s.text.length;++x)this.sectionIndex.push(m)}addImageSection(s){const f=s.image?s.image.name:"";if(f.length===0)return void qt("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(eu.forImage(f)),this.sectionIndex.push(this.sections.length-1)):qt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function AA(c,s,f,m,x,P,M,D,O,N,j,$,Z,J,ee,ce){const _e=jc.fromFeature(c,x);let xe;$===l.ai.vertical&&_e.verticalizePunctuation();const{processBidirectionalText:Re,processStyledBidirectionalText:Ie}=ls;if(Re&&_e.sections.length===1){xe=[];const Ze=Re(_e.toString(),Ld(_e,N,P,s,m,J,ee));for(const _t of Ze){const Ct=new jc;Ct.text=_t,Ct.sections=_e.sections;for(let gt=0;gt<_t.length;gt++)Ct.sectionIndex.push(0);xe.push(Ct)}}else if(Ie){xe=[];const Ze=Ie(_e.text,_e.sectionIndex,Ld(_e,N,P,s,m,J,ee));for(const _t of Ze){const Ct=new jc;Ct.text=_t[0],Ct.sectionIndex=_t[1],Ct.sections=_e.sections,xe.push(Ct)}}else xe=function(Ze,_t){const Ct=[],gt=Ze.text;let At=0;for(const ot of _t)Ct.push(Ze.substring(At,ot)),At=ot;return At<gt.length&&Ct.push(Ze.substring(At,gt.length)),Ct}(_e,Ld(_e,N,P,s,m,J,ee));const De=[],Ue={positionedLines:De,text:_e.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:$,iconsInText:!1,verticalizable:!1};return function(Ze,_t,Ct,gt,At,ot,Tt,lt,tt,jt,Dt,ai){let Wi=0,Zi=Jh,Pr=0,an=0;const Is=lt==="right"?1:lt==="left"?0:.5;let xr=0;for(const Ir of At){Ir.trim();const Mr=Ir.getMaxScale(),hs=(Mr-1)*Cr,ks={positionedGlyphs:[],lineOffset:0};Ze.positionedLines[xr]=ks;const us=ks.positionedGlyphs;let qs=0;if(!Ir.length()){Zi+=ot,++xr;continue}for(let Rr=0;Rr<Ir.length();Rr++){const pi=Ir.getSection(Rr),As=Ir.getSectionIndex(Rr),rs=Ir.getCharCode(Rr);let kr=0,Vn=null,so=null,no=null,pa=Cr;const jn=!(tt===l.ai.horizontal||!Dt&&!Va(rs)||Dt&&(fA[rs]||(qr=rs,dt.Arabic(qr)||dt["Arabic Supplement"](qr)||dt["Arabic Extended-A"](qr)||dt["Arabic Presentation Forms-A"](qr)||dt["Arabic Presentation Forms-B"](qr))));if(pi.imageName){const wn=gt[pi.imageName];if(!wn)continue;no=pi.imageName,Ze.iconsInText=Ze.iconsInText||!0,so=wn.paddedRect;const Zs=wn.displaySize;pi.scale=pi.scale*Cr/ai,Vn={width:Zs[0],height:Zs[1],left:Hs,top:-W_,advance:jn?Zs[1]:Zs[0]},kr=hs+(Cr-Zs[1]*pi.scale),pa=Vn.advance;const ga=jn?Zs[0]*pi.scale-Cr*Mr:Zs[1]*pi.scale-Cr*Mr;ga>0&&ga>qs&&(qs=ga)}else{const wn=Ct[pi.fontStack],Zs=wn&&wn[rs];if(Zs&&Zs.rect)so=Zs.rect,Vn=Zs.metrics;else{const ga=_t[pi.fontStack],nu=ga&&ga[rs];if(!nu)continue;Vn=nu.metrics}kr=(Mr-pi.scale)*Cr}jn?(Ze.verticalizable=!0,us.push({glyph:rs,imageName:no,x:Wi,y:Zi+kr,vertical:jn,scale:pi.scale,fontStack:pi.fontStack,sectionIndex:As,metrics:Vn,rect:so}),Wi+=pa*pi.scale+jt):(us.push({glyph:rs,imageName:no,x:Wi,y:Zi+kr,vertical:jn,scale:pi.scale,fontStack:pi.fontStack,sectionIndex:As,metrics:Vn,rect:so}),Wi+=Vn.advance*pi.scale+jt)}us.length!==0&&(Pr=Math.max(Wi-jt,Pr),uT(us,0,us.length-1,Is,qs)),Wi=0;const Xs=ot*Mr+qs;ks.lineOffset=Math.max(qs,hs),Zi+=Xs,an=Math.max(Xs,an),++xr}var qr;const is=Zi-Jh,{horizontalAlign:Ms,verticalAlign:Rs}=Nd(Tt);(function(Ir,Mr,hs,ks,us,qs,Xs,Rr,pi){const As=(Mr-hs)*us;let rs=0;rs=qs!==Xs?-Rr*ks-Jh:(-ks*pi+.5)*Xs;for(const kr of Ir)for(const Vn of kr.positionedGlyphs)Vn.x+=As,Vn.y+=rs})(Ze.positionedLines,Is,Ms,Rs,Pr,an,ot,is,At.length),Ze.top+=-Rs*is,Ze.bottom=Ze.top+is,Ze.left+=-Ms*Pr,Ze.right=Ze.left+Pr}(Ue,s,f,m,xe,M,D,O,$,N,Z,ce),!function(Ze){for(const _t of Ze)if(_t.positionedGlyphs.length!==0)return!1;return!0}(De)&&Ue}const fA={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},cT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function X_(c,s,f,m,x,P){if(s.imageName){const M=m[s.imageName];return M?M.displaySize[0]*s.scale*Cr/P+x:0}{const M=f[s.fontStack],D=M&&M[c];return D?D.metrics.advance*s.scale+x:0}}function Z_(c,s,f,m){const x=Math.pow(c-s,2);return m?c<s?x/2:2*x:x+Math.abs(f)*f}function hT(c,s,f){let m=0;return c===10&&(m-=1e4),f&&(m+=150),c!==40&&c!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function Y_(c,s,f,m,x,P){let M=null,D=Z_(s,f,x,P);for(const O of m){const N=Z_(s-O.x,f,x,P)+O.badness;N<=D&&(M=O,D=N)}return{index:c,x:s,priorBreak:M,badness:D}}function G_(c){return c?G_(c.priorBreak).concat(c.index):[]}function Ld(c,s,f,m,x,P,M){if(P!=="point")return[];if(!c)return[];const D=[],O=function(Z,J,ee,ce,_e,xe){let Re=0;for(let Ie=0;Ie<Z.length();Ie++){const De=Z.getSection(Ie);Re+=X_(Z.getCharCode(Ie),De,ce,_e,J,xe)}return Re/Math.max(1,Math.ceil(Re/ee))}(c,s,f,m,x,M),N=c.text.indexOf("")>=0;let j=0;for(let Z=0;Z<c.length();Z++){const J=c.getSection(Z),ee=c.getCharCode(Z);if(fA[ee]||(j+=X_(ee,J,m,x,s,M)),Z<c.length()-1){const ce=!(($=ee)<11904||!(dt["Bopomofo Extended"]($)||dt.Bopomofo($)||dt["CJK Compatibility Forms"]($)||dt["CJK Compatibility Ideographs"]($)||dt["CJK Compatibility"]($)||dt["CJK Radicals Supplement"]($)||dt["CJK Strokes"]($)||dt["CJK Symbols and Punctuation"]($)||dt["CJK Unified Ideographs Extension A"]($)||dt["CJK Unified Ideographs"]($)||dt["Enclosed CJK Letters and Months"]($)||dt["Halfwidth and Fullwidth Forms"]($)||dt.Hiragana($)||dt["Ideographic Description Characters"]($)||dt["Kangxi Radicals"]($)||dt["Katakana Phonetic Extensions"]($)||dt.Katakana($)||dt["Vertical Forms"]($)||dt["Yi Radicals"]($)||dt["Yi Syllables"]($)));(cT[ee]||ce||J.imageName)&&D.push(Y_(Z+1,j,O,D,hT(ee,c.getCharCode(Z+1),ce&&N),!1))}}var $;return G_(Y_(c.length(),j,O,D,0,!0))}function Nd(c){let s=.5,f=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:s,verticalAlign:f}}function uT(c,s,f,m,x){if(!m&&!x)return;const P=c[f],M=(c[f].x+P.metrics.advance*P.scale)*m;for(let D=s;D<=f;D++)c[D].x-=M,c[D].y+=x}function AT(c,s,f){const{horizontalAlign:m,verticalAlign:x}=Nd(f),P=s[0]-c.displaySize[0]*m,M=s[1]-c.displaySize[1]*x;return{image:c,top:M,bottom:M+c.displaySize[1],left:P,right:P+c.displaySize[0]}}function Q_(c,s,f,m,x,P){const M=c.image;let D;if(M.content){const _e=M.content,xe=M.pixelRatio||1;D=[_e[0]/xe,_e[1]/xe,M.displaySize[0]-_e[2]/xe,M.displaySize[1]-_e[3]/xe]}const O=s.left*P,N=s.right*P;let j,$,Z,J;f==="width"||f==="both"?(J=x[0]+O-m[3],$=x[0]+N+m[1]):(J=x[0]+(O+N-M.displaySize[0])/2,$=J+M.displaySize[0]);const ee=s.top*P,ce=s.bottom*P;return f==="height"||f==="both"?(j=x[1]+ee-m[0],Z=x[1]+ce+m[2]):(j=x[1]+(ee+ce-M.displaySize[1])/2,Z=j+M.displaySize[1]),{image:M,top:j,right:$,bottom:Z,left:J,collisionPadding:D}}const tu=255,Bo=128,Xa=tu*Bo;function K_(c,s){const{expression:f}=s;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new zi(c+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:x}=f;let P=0;for(;P<m.length&&m[P]<=c;)P++;P=Math.max(0,P-1);let M=P;for(;M<m.length&&m[M]<c+1;)M++;M=Math.min(m.length-1,M);const D=m[P],O=m[M];return f.kind==="composite"?{kind:"composite",minZoom:D,maxZoom:O,interpolationType:x}:{kind:"camera",minZoom:D,maxZoom:O,minSize:f.evaluate(new zi(D)),maxSize:f.evaluate(new zi(O)),interpolationType:x}}}function zd(c,s,f){let m="never";const x=c.get(s);return x?m=x:c.get(f)&&(m="always"),m}const fT=Ha.VectorTileFeature.types,dT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function dA(c,s,f,m,x,P,M,D,O,N,j,$,Z){const J=D?Math.min(Xa,Math.round(D[0])):0,ee=D?Math.min(Xa,Math.round(D[1])):0;c.emplaceBack(s,f,Math.round(32*m),Math.round(32*x),P,M,(J<<1)+(O?1:0),ee,16*N,16*j,256*$,256*Z)}function Ud(c,s,f){c.emplaceBack(s.x,s.y,f),c.emplaceBack(s.x,s.y,f),c.emplaceBack(s.x,s.y,f),c.emplaceBack(s.x,s.y,f)}function pT(c){for(const s of c.sections)if(Uh(s.text))return!0;return!1}class Vd{constructor(s){this.layoutVertexArray=new vt,this.indexArray=new ti,this.programConfigurations=s,this.segments=new Oi,this.dynamicLayoutVertexArray=new mt,this.opacityVertexArray=new pt,this.hasVisibleVertices=!1,this.placedSymbolArray=new U}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,f,m,x){this.isEmpty()||(m&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,qw.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,Xw.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,dT,!0),this.opacityVertexBuffer.itemSize=1),(m||x)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}bt("SymbolBuffers",Vd);class jd{constructor(s,f,m){this.layoutVertexArray=new s,this.layoutAttributes=f,this.indexArray=new m,this.segments=new Oi,this.collisionVertexArray=new St}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,Zw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}bt("CollisionBuffers",jd);class $c{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(M=>M.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=yd([]),this.placementViewportMatrix=yd([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=K_(this.zoom,f["text-size"]),this.iconSizeData=K_(this.zoom,f["icon-size"]);const m=this.layers[0].layout,x=m.get("symbol-sort-key"),P=m.get("symbol-z-order");this.canOverlap=zd(m,"text-overlap","text-allow-overlap")!=="never"||zd(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=P!=="viewport-y"&&!x.isConstant(),this.sortFeaturesByY=(P==="viewport-y"||P==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(M=>l.ai[M])),this.stateDependentLayerIds=this.layers.filter(M=>M.isStateDependent()).map(M=>M.id),this.sourceID=s.sourceID}createArrays(){this.text=new Vd(new ro(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new Vd(new ro(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new Y,this.lineVertexArray=new G,this.symbolInstances=new W,this.textAnchorOffsets=new me}calculateGlyphDependencies(s,f,m,x,P){for(let M=0;M<s.length;M++)if(f[s.charCodeAt(M)]=!0,(m||x)&&P){const D=Kh[s.charAt(M)];D&&(f[D.charCodeAt(0)]=!0)}}populate(s,f,m){const x=this.layers[0],P=x.layout,M=P.get("text-font"),D=P.get("text-field"),O=P.get("icon-image"),N=(D.value.kind!=="constant"||D.value.value instanceof bi&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(M.value.kind!=="constant"||M.value.value.length>0),j=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,$=P.get("symbol-sort-key");if(this.features=[],!N&&!j)return;const Z=f.iconDependencies,J=f.glyphDependencies,ee=f.availableImages,ce=new zi(this.zoom);for(const{feature:_e,id:xe,index:Re,sourceLayerIndex:Ie}of s){const De=x._featureFilter.needGeometry,Ue=Vl(_e,De);if(!x._featureFilter.filter(ce,Ue,m))continue;let Ze,_t;if(De||(Ue.geometry=Ul(_e)),N){const gt=x.getValueAndResolveTokens("text-field",Ue,m,ee),At=bi.factory(gt);pT(At)&&(this.hasRTLText=!0),(!this.hasRTLText||ja()==="unavailable"||this.hasRTLText&&ls.isParsed())&&(Ze=Gw(At,x,Ue))}if(j){const gt=x.getValueAndResolveTokens("icon-image",Ue,m,ee);_t=gt instanceof Ti?gt:Ti.fromString(gt)}if(!Ze&&!_t)continue;const Ct=this.sortFeaturesByKey?$.evaluate(Ue,{},m):void 0;if(this.features.push({id:xe,text:Ze,icon:_t,index:Re,sourceLayerIndex:Ie,geometry:Ue.geometry,properties:_e.properties,type:fT[_e.type],sortKey:Ct}),_t&&(Z[_t.name]=!0),Ze){const gt=M.evaluate(Ue,{},m).join(","),At=P.get("text-rotation-alignment")!=="viewport"&&P.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.ai.vertical)>=0;for(const ot of Ze.sections)if(ot.image)Z[ot.image.name]=!0;else{const Tt=Ml(Ze.toString()),lt=ot.fontStack||gt,tt=J[lt]=J[lt]||{};this.calculateGlyphDependencies(ot.text,tt,At,this.allowVerticalPlacement,Tt)}}}P.get("symbol-placement")==="line"&&(this.features=function(_e){const xe={},Re={},Ie=[];let De=0;function Ue(gt){Ie.push(_e[gt]),De++}function Ze(gt,At,ot){const Tt=Re[gt];return delete Re[gt],Re[At]=Tt,Ie[Tt].geometry[0].pop(),Ie[Tt].geometry[0]=Ie[Tt].geometry[0].concat(ot[0]),Tt}function _t(gt,At,ot){const Tt=xe[At];return delete xe[At],xe[gt]=Tt,Ie[Tt].geometry[0].shift(),Ie[Tt].geometry[0]=ot[0].concat(Ie[Tt].geometry[0]),Tt}function Ct(gt,At,ot){const Tt=ot?At[0][At[0].length-1]:At[0][0];return`${gt}:${Tt.x}:${Tt.y}`}for(let gt=0;gt<_e.length;gt++){const At=_e[gt],ot=At.geometry,Tt=At.text?At.text.toString():null;if(!Tt){Ue(gt);continue}const lt=Ct(Tt,ot),tt=Ct(Tt,ot,!0);if(lt in Re&&tt in xe&&Re[lt]!==xe[tt]){const jt=_t(lt,tt,ot),Dt=Ze(lt,tt,Ie[jt].geometry);delete xe[lt],delete Re[tt],Re[Ct(Tt,Ie[Dt].geometry,!0)]=Dt,Ie[jt].geometry=null}else lt in Re?Ze(lt,tt,ot):tt in xe?_t(lt,tt,ot):(Ue(gt),xe[lt]=De-1,Re[tt]=De-1)}return Ie.filter(gt=>gt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,xe)=>_e.sortKey-xe.sortKey)}update(s,f,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,f,this.layers,m),this.icon.programConfigurations.updatePaintArrays(s,f,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,f){const m=this.lineVertexArray.length;if(s.segment!==void 0){let x=s.dist(f[s.segment+1]),P=s.dist(f[s.segment]);const M={};for(let D=s.segment+1;D<f.length;D++)M[D]={x:f[D].x,y:f[D].y,tileUnitDistanceFromAnchor:x},D<f.length-1&&(x+=f[D+1].dist(f[D]));for(let D=s.segment||0;D>=0;D--)M[D]={x:f[D].x,y:f[D].y,tileUnitDistanceFromAnchor:P},D>0&&(P+=f[D-1].dist(f[D]));for(let D=0;D<f.length;D++){const O=M[D];this.lineVertexArray.emplaceBack(O.x,O.y,O.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(s,f,m,x,P,M,D,O,N,j,$,Z){const J=s.indexArray,ee=s.layoutVertexArray,ce=s.segments.prepareSegment(4*f.length,ee,J,this.canOverlap?M.sortKey:void 0),_e=this.glyphOffsetArray.length,xe=ce.vertexLength,Re=this.allowVerticalPlacement&&D===l.ai.vertical?Math.PI/2:0,Ie=M.text&&M.text.sections;for(let De=0;De<f.length;De++){const{tl:Ue,tr:Ze,bl:_t,br:Ct,tex:gt,pixelOffsetTL:At,pixelOffsetBR:ot,minFontScaleX:Tt,minFontScaleY:lt,glyphOffset:tt,isSDF:jt,sectionIndex:Dt}=f[De],ai=ce.vertexLength,Wi=tt[1];dA(ee,O.x,O.y,Ue.x,Wi+Ue.y,gt.x,gt.y,m,jt,At.x,At.y,Tt,lt),dA(ee,O.x,O.y,Ze.x,Wi+Ze.y,gt.x+gt.w,gt.y,m,jt,ot.x,At.y,Tt,lt),dA(ee,O.x,O.y,_t.x,Wi+_t.y,gt.x,gt.y+gt.h,m,jt,At.x,ot.y,Tt,lt),dA(ee,O.x,O.y,Ct.x,Wi+Ct.y,gt.x+gt.w,gt.y+gt.h,m,jt,ot.x,ot.y,Tt,lt),Ud(s.dynamicLayoutVertexArray,O,Re),J.emplaceBack(ai,ai+1,ai+2),J.emplaceBack(ai+1,ai+2,ai+3),ce.vertexLength+=4,ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),De!==f.length-1&&Dt===f[De+1].sectionIndex||s.programConfigurations.populatePaintArrays(ee.length,M,M.index,{},Z,Ie&&Ie[Dt])}s.placedSymbolArray.emplaceBack(O.x,O.y,_e,this.glyphOffsetArray.length-_e,xe,N,j,O.segment,m?m[0]:0,m?m[1]:0,x[0],x[1],D,0,!1,0,$)}_addCollisionDebugVertex(s,f,m,x,P,M){return f.emplaceBack(0,0),s.emplaceBack(m.x,m.y,x,P,Math.round(M.x),Math.round(M.y))}addCollisionDebugVertices(s,f,m,x,P,M,D){const O=P.segments.prepareSegment(4,P.layoutVertexArray,P.indexArray),N=O.vertexLength,j=P.layoutVertexArray,$=P.collisionVertexArray,Z=D.anchorX,J=D.anchorY;this._addCollisionDebugVertex(j,$,M,Z,J,new V(s,f)),this._addCollisionDebugVertex(j,$,M,Z,J,new V(m,f)),this._addCollisionDebugVertex(j,$,M,Z,J,new V(m,x)),this._addCollisionDebugVertex(j,$,M,Z,J,new V(s,x)),O.vertexLength+=4;const ee=P.indexArray;ee.emplaceBack(N,N+1),ee.emplaceBack(N+1,N+2),ee.emplaceBack(N+2,N+3),ee.emplaceBack(N+3,N),O.primitiveLength+=4}addDebugCollisionBoxes(s,f,m,x){for(let P=s;P<f;P++){const M=this.collisionBoxArray.get(P);this.addCollisionDebugVertices(M.x1,M.y1,M.x2,M.y2,x?this.textCollisionBox:this.iconCollisionBox,M.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jd(Mt,O_.members,kt),this.iconCollisionBox=new jd(Mt,O_.members,kt);for(let s=0;s<this.symbolInstances.length;s++){const f=this.symbolInstances.get(s);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(s,f,m,x,P,M,D,O,N){const j={};for(let $=f;$<m;$++){const Z=s.get($);j.textBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},j.textFeatureIndex=Z.featureIndex;break}for(let $=x;$<P;$++){const Z=s.get($);j.verticalTextBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},j.verticalTextFeatureIndex=Z.featureIndex;break}for(let $=M;$<D;$++){const Z=s.get($);j.iconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},j.iconFeatureIndex=Z.featureIndex;break}for(let $=O;$<N;$++){const Z=s.get($);j.verticalIconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},j.verticalIconFeatureIndex=Z.featureIndex;break}return j}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,f){const m=s.placedSymbolArray.get(f),x=m.vertexStartIndex+4*m.numGlyphs;for(let P=m.vertexStartIndex;P<x;P+=4)s.indexArray.emplaceBack(P,P+1,P+2),s.indexArray.emplaceBack(P+1,P+2,P+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(s),m=Math.cos(s),x=[],P=[],M=[];for(let D=0;D<this.symbolInstances.length;++D){M.push(D);const O=this.symbolInstances.get(D);x.push(0|Math.round(f*O.anchorX+m*O.anchorY)),P.push(O.featureIndex)}return M.sort((D,O)=>x[D]-x[O]||P[O]-P[D]),M}addToSortKeyRanges(s,f){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===f?m.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const m=this.symbolInstances.get(f);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((x,P,M)=>{x>=0&&M.indexOf(x)===P&&this.addIndicesForPlacedSymbol(this.text,x)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let J_,em;bt("SymbolBucket",$c,{omit:["layers","collisionBoxArray","features","compareText"]}),$c.MAX_GLYPHS=65535,$c.addDynamicAttributes=Ud;var $d={get paint(){return em=em||new rr({"icon-opacity":new Ht(Xe.paint_symbol["icon-opacity"]),"icon-color":new Ht(Xe.paint_symbol["icon-color"]),"icon-halo-color":new Ht(Xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ht(Xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ht(Xe.paint_symbol["icon-halo-blur"]),"icon-translate":new It(Xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new It(Xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ht(Xe.paint_symbol["text-opacity"]),"text-color":new Ht(Xe.paint_symbol["text-color"],{runtimeType:Ar,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Ht(Xe.paint_symbol["text-halo-color"]),"text-halo-width":new Ht(Xe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ht(Xe.paint_symbol["text-halo-blur"]),"text-translate":new It(Xe.paint_symbol["text-translate"]),"text-translate-anchor":new It(Xe.paint_symbol["text-translate-anchor"])})},get layout(){return J_=J_||new rr({"symbol-placement":new It(Xe.layout_symbol["symbol-placement"]),"symbol-spacing":new It(Xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It(Xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ht(Xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It(Xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new It(Xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new It(Xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new It(Xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new It(Xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It(Xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ht(Xe.layout_symbol["icon-size"]),"icon-text-fit":new It(Xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new It(Xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ht(Xe.layout_symbol["icon-image"]),"icon-rotate":new Ht(Xe.layout_symbol["icon-rotate"]),"icon-padding":new Ht(Xe.layout_symbol["icon-padding"]),"icon-keep-upright":new It(Xe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ht(Xe.layout_symbol["icon-offset"]),"icon-anchor":new Ht(Xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It(Xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It(Xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It(Xe.layout_symbol["text-rotation-alignment"]),"text-field":new Ht(Xe.layout_symbol["text-field"]),"text-font":new Ht(Xe.layout_symbol["text-font"]),"text-size":new Ht(Xe.layout_symbol["text-size"]),"text-max-width":new Ht(Xe.layout_symbol["text-max-width"]),"text-line-height":new It(Xe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ht(Xe.layout_symbol["text-letter-spacing"]),"text-justify":new Ht(Xe.layout_symbol["text-justify"]),"text-radial-offset":new Ht(Xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It(Xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ht(Xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ht(Xe.layout_symbol["text-anchor"]),"text-max-angle":new It(Xe.layout_symbol["text-max-angle"]),"text-writing-mode":new It(Xe.layout_symbol["text-writing-mode"]),"text-rotate":new Ht(Xe.layout_symbol["text-rotate"]),"text-padding":new It(Xe.layout_symbol["text-padding"]),"text-keep-upright":new It(Xe.layout_symbol["text-keep-upright"]),"text-transform":new Ht(Xe.layout_symbol["text-transform"]),"text-offset":new Ht(Xe.layout_symbol["text-offset"]),"text-allow-overlap":new It(Xe.layout_symbol["text-allow-overlap"]),"text-overlap":new It(Xe.layout_symbol["text-overlap"]),"text-ignore-placement":new It(Xe.layout_symbol["text-ignore-placement"]),"text-optional":new It(Xe.layout_symbol["text-optional"])})}};class tm{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:xs,this.defaultValue=s}evaluate(s){if(s.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(s.formattedSection))return f.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bt("FormatSectionOverride",tm,{omit:["defaultValue"]});class pA extends sr{constructor(s){super(s,$d)}recalculate(s,f){if(super.recalculate(s,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const x=[];for(const P of m)x.indexOf(P)<0&&x.push(P);this.layout._values["text-writing-mode"]=x}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,f,m,x){const P=this.layout.get(s).evaluate(f,{},m,x),M=this._unevaluatedLayout._values[s];return M.isDataDriven()||xo(M.value)||!P?P:function(D,O){return O.replace(/{([^{}]+)}/g,(N,j)=>D&&j in D?String(D[j]):"")}(f.properties,P)}createBucket(s){return new $c(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of $d.paint.overridableProperties){if(!pA.hasPaintOverride(this.layout,s))continue;const f=this.paint.get(s),m=new tm(f),x=new Ba(m,f.property.specification);let P=null;P=f.value.kind==="constant"||f.value.kind==="source"?new To("source",x):new Ci("composite",x,f.value.zoomStops),this.paint._values[s]=new Fr(f.property,P,f.parameters)}}_handleOverridablePaintPropertyUpdate(s,f,m){return!(!this.layout||f.isDataDriven()||m.isDataDriven())&&pA.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,f){const m=s.get("text-field"),x=$d.paint.properties[f];let P=!1;const M=D=>{for(const O of D)if(x.overrides&&x.overrides.hasOverride(O))return void(P=!0)};if(m.value.kind==="constant"&&m.value.value instanceof bi)M(m.value.value.sections);else if(m.value.kind==="source"){const D=N=>{P||(N instanceof re&&Pi(N.value)===fe?M(N.value.sections):N instanceof Ko?M(N.sections):N.eachChild(D))},O=m.value;O._styleExpression&&D(O._styleExpression.expression)}return P}}let im;var gT={get paint(){return im=im||new rr({"background-color":new It(Xe.paint_background["background-color"]),"background-pattern":new Nl(Xe.paint_background["background-pattern"]),"background-opacity":new It(Xe.paint_background["background-opacity"])})}};class _T extends sr{constructor(s){super(s,gT)}}let rm;var mT={get paint(){return rm=rm||new rr({"raster-opacity":new It(Xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new It(Xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It(Xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It(Xe.paint_raster["raster-brightness-max"]),"raster-saturation":new It(Xe.paint_raster["raster-saturation"]),"raster-contrast":new It(Xe.paint_raster["raster-contrast"]),"raster-resampling":new It(Xe.paint_raster["raster-resampling"]),"raster-fade-duration":new It(Xe.paint_raster["raster-fade-duration"])})}};class yT extends sr{constructor(s){super(s,mT)}}class bT extends sr{constructor(s){super(s,{}),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class vT{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Wd=63710088e-1;class Za{constructor(s,f){if(isNaN(s)||isNaN(f))throw new Error(`Invalid LngLat object: (${s}, ${f})`);if(this.lng=+s,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Za(xt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const f=Math.PI/180,m=this.lat*f,x=s.lat*f,P=Math.sin(m)*Math.sin(x)+Math.cos(m)*Math.cos(x)*Math.cos((s.lng-this.lng)*f);return Wd*Math.acos(Math.min(P,1))}static convert(s){if(s instanceof Za)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new Za(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new Za(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const sm=2*Math.PI*Wd;function nm(c){return sm*Math.cos(c*Math.PI/180)}function om(c){return(180+c)/360}function am(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function lm(c,s){return c/nm(s)}function cm(c){return 360*c-180}function Hd(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class gA{constructor(s,f,m=0){this.x=+s,this.y=+f,this.z=+m}static fromLngLat(s,f=0){const m=Za.convert(s);return new gA(om(m.lng),am(m.lat),lm(f,m.lat))}toLngLat(){return new Za(cm(this.x),Hd(this.y))}toAltitude(){return this.z*nm(Hd(this.y))}meterInMercatorCoordinateUnits(){return 1/sm*(s=Hd(this.y),1/Math.cos(s*Math.PI/180));var s}}function hm(c,s,f){var m=2*Math.PI*6378137/256/Math.pow(2,f);return[c*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}class qd{constructor(s,f,m){if(s<0||s>25||m<0||m>=Math.pow(2,s)||f<0||f>=Math.pow(2,s))throw new Error(`x=${f}, y=${m}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=f,this.y=m,this.key=iu(0,s,s,f,m)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,f,m){const x=(M=this.y,D=this.z,O=hm(256*(P=this.x),256*(M=Math.pow(2,D)-M-1),D),N=hm(256*(P+1),256*(M+1),D),O[0]+","+O[1]+","+N[0]+","+N[1]);var P,M,D,O,N;const j=function($,Z,J){let ee,ce="";for(let _e=$;_e>0;_e--)ee=1<<_e-1,ce+=(Z&ee?1:0)+(J&ee?2:0);return ce}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,x)}isChildOf(s){const f=this.z-s.z;return f>0&&s.x===this.x>>f&&s.y===this.y>>f}getTilePoint(s){const f=Math.pow(2,this.z);return new V((s.x*f-this.x)*vr,(s.y*f-this.y)*vr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class um{constructor(s,f){this.wrap=s,this.canonical=f,this.key=iu(s,f.z,f.z,f.x,f.y)}}class xn{constructor(s,f,m,x,P){if(s<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${m}`);this.overscaledZ=s,this.wrap=f,this.canonical=new qd(m,+x,+P),this.key=iu(f,s,m,x,P)}clone(){return new xn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-s;return s>this.canonical.z?new xn(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xn(s,this.wrap,s,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(s,f){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-s;return s>this.canonical.z?iu(this.wrap*+f,s,this.canonical.z,this.canonical.x,this.canonical.y):iu(this.wrap*+f,s,s,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const f=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>f&&s.canonical.y===this.canonical.y>>f}children(s){if(this.overscaledZ>=s)return[new xn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,m=2*this.canonical.x,x=2*this.canonical.y;return[new xn(f,this.wrap,f,m,x),new xn(f,this.wrap,f,m+1,x),new xn(f,this.wrap,f,m,x+1),new xn(f,this.wrap,f,m+1,x+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new xn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new xn(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new um(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new gA(s.x-this.wrap,s.y))}}function iu(c,s,f,m,x){(c*=2)<0&&(c=-1*c-1);const P=1<<f;return(P*P*c+P*x+m).toString(36)+f.toString(36)+s.toString(36)}bt("CanonicalTileID",qd),bt("OverscaledTileID",xn,{omit:["posMatrix"]});class Am{constructor(s,f,m,x=1,P=1,M=1,D=0){if(this.uid=s,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void qt(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;const O=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=x,this.greenFactor=P,this.blueFactor=M,this.baseShift=D;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let N=0;N<O;N++)this.data[this._idx(-1,N)]=this.data[this._idx(0,N)],this.data[this._idx(O,N)]=this.data[this._idx(O-1,N)],this.data[this._idx(N,-1)]=this.data[this._idx(N,0)],this.data[this._idx(N,O)]=this.data[this._idx(N,O-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(O,-1)]=this.data[this._idx(O-1,0)],this.data[this._idx(-1,O)]=this.data[this._idx(0,O-1)],this.data[this._idx(O,O)]=this.data[this._idx(O-1,O-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let N=0;N<O;N++)for(let j=0;j<O;j++){const $=this.get(N,j);$>this.max&&(this.max=$),$<this.min&&(this.min=$)}}get(s,f){const m=new Uint8Array(this.data.buffer),x=4*this._idx(s,f);return this.unpack(m[x],m[x+1],m[x+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,f){if(s<-1||s>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(s+1)}unpack(s,f,m){return s*this.redFactor+f*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new vn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,f,m){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let x=f*this.dim,P=f*this.dim+this.dim,M=m*this.dim,D=m*this.dim+this.dim;switch(f){case-1:x=P-1;break;case 1:P=x+1}switch(m){case-1:M=D-1;break;case 1:D=M+1}const O=-f*this.dim,N=-m*this.dim;for(let j=M;j<D;j++)for(let $=x;$<P;$++)this.data[this._idx($,j)]=s.data[this._idx($+O,j+N)]}}bt("DEMData",Am);class fm{constructor(s){this._stringToNumber={},this._numberToString=[];for(let f=0;f<s.length;f++){const m=s[f];this._stringToNumber[m]=f,this._numberToString[f]=m}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class dm{constructor(s,f,m,x,P){this.type="Feature",this._vectorTileFeature=s,s._z=f,s._x=m,s._y=x,this.properties=s.properties,this.id=P}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&(s[f]=this[f]);return s}}class pm{constructor(s,f){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Jn(vr,16,0),this.grid3D=new Jn(vr,16,0),this.featureIndexArray=new de,this.promoteId=f}insert(s,f,m,x,P,M){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,x,P);const O=M?this.grid3D:this.grid;for(let N=0;N<f.length;N++){const j=f[N],$=[1/0,1/0,-1/0,-1/0];for(let Z=0;Z<j.length;Z++){const J=j[Z];$[0]=Math.min($[0],J.x),$[1]=Math.min($[1],J.y),$[2]=Math.max($[2],J.x),$[3]=Math.max($[3],J.y)}$[0]<vr&&$[1]<vr&&$[2]>=0&&$[3]>=0&&O.insert(D,$[0],$[1],$[2],$[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ha.VectorTile(new Bd(this.rawTileData)).layers,this.sourceLayerCoder=new fm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,f,m,x){this.loadVTLayers();const P=s.params||{},M=vr/s.tileSize/s.scale,D=Sl(P.filter),O=s.queryGeometry,N=s.queryPadding*M,j=_m(O),$=this.grid.query(j.minX-N,j.minY-N,j.maxX+N,j.maxY+N),Z=_m(s.cameraQueryGeometry),J=this.grid3D.query(Z.minX-N,Z.minY-N,Z.maxX+N,Z.maxY+N,(_e,xe,Re,Ie)=>function(De,Ue,Ze,_t,Ct){for(const At of De)if(Ue<=At.x&&Ze<=At.y&&_t>=At.x&&Ct>=At.y)return!0;const gt=[new V(Ue,Ze),new V(Ue,Ct),new V(_t,Ct),new V(_t,Ze)];if(De.length>2){for(const At of gt)if(Oc(De,At))return!0}for(let At=0;At<De.length-1;At++)if(Jx(De[At],De[At+1],gt))return!0;return!1}(s.cameraQueryGeometry,_e-N,xe-N,Re+N,Ie+N));for(const _e of J)$.push(_e);$.sort(xT);const ee={};let ce;for(let _e=0;_e<$.length;_e++){const xe=$[_e];if(xe===ce)continue;ce=xe;const Re=this.featureIndexArray.get(xe);let Ie=null;this.loadMatchingFeature(ee,Re.bucketIndex,Re.sourceLayerIndex,Re.featureIndex,D,P.layers,P.availableImages,f,m,x,(De,Ue,Ze)=>(Ie||(Ie=Ul(De)),Ue.queryIntersectsFeature(O,De,Ze,Ie,this.z,s.transform,M,s.pixelPosMatrix)))}return ee}loadMatchingFeature(s,f,m,x,P,M,D,O,N,j,$){const Z=this.bucketLayerIDs[f];if(M&&!function(_e,xe){for(let Re=0;Re<_e.length;Re++)if(xe.indexOf(_e[Re])>=0)return!0;return!1}(M,Z))return;const J=this.sourceLayerCoder.decode(m),ee=this.vtLayers[J].feature(x);if(P.needGeometry){const _e=Vl(ee,!0);if(!P.filter(new zi(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!P.filter(new zi(this.tileID.overscaledZ),ee))return;const ce=this.getId(ee,J);for(let _e=0;_e<Z.length;_e++){const xe=Z[_e];if(M&&M.indexOf(xe)<0)continue;const Re=O[xe];if(!Re)continue;let Ie={};ce&&j&&(Ie=j.getState(Re.sourceLayer||"_geojsonTileLayer",ce));const De=wt({},N[xe]);De.paint=gm(De.paint,Re.paint,ee,Ie,D),De.layout=gm(De.layout,Re.layout,ee,Ie,D);const Ue=!$||$(ee,Re,Ie);if(!Ue)continue;const Ze=new dm(ee,this.z,this.x,this.y,ce);Ze.layer=De;let _t=s[xe];_t===void 0&&(_t=s[xe]=[]),_t.push({featureIndex:x,feature:Ze,intersectionZ:Ue})}}lookupSymbolFeatures(s,f,m,x,P,M,D,O){const N={};this.loadVTLayers();const j=Sl(P);for(const $ of s)this.loadMatchingFeature(N,m,x,$,j,M,D,O,f);return N}hasLayer(s){for(const f of this.bucketLayerIDs)for(const m of f)if(s===m)return!0;return!1}getId(s,f){let m=s.id;return this.promoteId&&(m=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof m=="boolean"&&(m=Number(m))),m}}function gm(c,s,f,m,x){return at(c,(P,M)=>{const D=s instanceof la?s.get(M):null;return D&&D.evaluate?D.evaluate(f,m,x):D})}function _m(c){let s=1/0,f=1/0,m=-1/0,x=-1/0;for(const P of c)s=Math.min(s,P.x),f=Math.min(f,P.y),m=Math.max(m,P.x),x=Math.max(x,P.y);return{minX:s,minY:f,maxX:m,maxY:x}}function xT(c,s){return s-c}function mm(c,s,f,m,x){const P=[];for(let M=0;M<c.length;M++){const D=c[M];let O;for(let N=0;N<D.length-1;N++){let j=D[N],$=D[N+1];j.x<s&&$.x<s||(j.x<s?j=new V(s,j.y+(s-j.x)/($.x-j.x)*($.y-j.y))._round():$.x<s&&($=new V(s,j.y+(s-j.x)/($.x-j.x)*($.y-j.y))._round()),j.y<f&&$.y<f||(j.y<f?j=new V(j.x+(f-j.y)/($.y-j.y)*($.x-j.x),f)._round():$.y<f&&($=new V(j.x+(f-j.y)/($.y-j.y)*($.x-j.x),f)._round()),j.x>=m&&$.x>=m||(j.x>=m?j=new V(m,j.y+(m-j.x)/($.x-j.x)*($.y-j.y))._round():$.x>=m&&($=new V(m,j.y+(m-j.x)/($.x-j.x)*($.y-j.y))._round()),j.y>=x&&$.y>=x||(j.y>=x?j=new V(j.x+(x-j.y)/($.y-j.y)*($.x-j.x),x)._round():$.y>=x&&($=new V(j.x+(x-j.y)/($.y-j.y)*($.x-j.x),x)._round()),O&&j.equals(O[O.length-1])||(O=[j],P.push(O)),O.push($)))))}}return P}bt("FeatureIndex",pm,{omit:["rawTileData","sourceLayerCoder"]});class Ya extends V{constructor(s,f,m,x){super(s,f),this.angle=m,x!==void 0&&(this.segment=x)}clone(){return new Ya(this.x,this.y,this.angle,this.segment)}}function ym(c,s,f,m,x){if(s.segment===void 0||f===0)return!0;let P=s,M=s.segment+1,D=0;for(;D>-f/2;){if(M--,M<0)return!1;D-=c[M].dist(P),P=c[M]}D+=c[M].dist(c[M+1]),M++;const O=[];let N=0;for(;D<f/2;){const j=c[M],$=c[M+1];if(!$)return!1;let Z=c[M-1].angleTo(j)-j.angleTo($);for(Z=Math.abs((Z+3*Math.PI)%(2*Math.PI)-Math.PI),O.push({distance:D,angleDelta:Z}),N+=Z;D-O[0].distance>m;)N-=O.shift().angleDelta;if(N>x)return!1;M++,D+=j.dist($)}return!0}function bm(c){let s=0;for(let f=0;f<c.length-1;f++)s+=c[f].dist(c[f+1]);return s}function vm(c,s,f){return c?.6*s*f:0}function xm(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function wT(c,s,f,m,x,P){const M=vm(f,x,P),D=xm(f,m)*P;let O=0;const N=bm(c)/2;for(let j=0;j<c.length-1;j++){const $=c[j],Z=c[j+1],J=$.dist(Z);if(O+J>N){const ee=(N-O)/J,ce=dr.number($.x,Z.x,ee),_e=dr.number($.y,Z.y,ee),xe=new Ya(ce,_e,Z.angleTo($),j);return xe._round(),!M||ym(c,xe,D,M,s)?xe:void 0}O+=J}}function TT(c,s,f,m,x,P,M,D,O){const N=vm(m,P,M),j=xm(m,x),$=j*M,Z=c[0].x===0||c[0].x===O||c[0].y===0||c[0].y===O;return s-$<s/4&&(s=$+s/4),wm(c,Z?s/2*D%s:(j/2+2*P)*M*D%s,s,N,f,$,Z,!1,O)}function wm(c,s,f,m,x,P,M,D,O){const N=P/2,j=bm(c);let $=0,Z=s-f,J=[];for(let ee=0;ee<c.length-1;ee++){const ce=c[ee],_e=c[ee+1],xe=ce.dist(_e),Re=_e.angleTo(ce);for(;Z+f<$+xe;){Z+=f;const Ie=(Z-$)/xe,De=dr.number(ce.x,_e.x,Ie),Ue=dr.number(ce.y,_e.y,Ie);if(De>=0&&De<O&&Ue>=0&&Ue<O&&Z-N>=0&&Z+N<=j){const Ze=new Ya(De,Ue,Re,ee);Ze._round(),m&&!ym(c,Ze,P,m,x)||J.push(Ze)}}$+=xe}return D||J.length||M||(J=wm(c,$/2,f,m,x,P,M,!0,O)),J}bt("Anchor",Ya);const Wc=Hs;function Tm(c,s,f,m){const x=[],P=c.image,M=P.pixelRatio,D=P.paddedRect.w-2*Wc,O=P.paddedRect.h-2*Wc,N=c.right-c.left,j=c.bottom-c.top,$=P.stretchX||[[0,D]],Z=P.stretchY||[[0,O]],J=(ot,Tt)=>ot+Tt[1]-Tt[0],ee=$.reduce(J,0),ce=Z.reduce(J,0),_e=D-ee,xe=O-ce;let Re=0,Ie=ee,De=0,Ue=ce,Ze=0,_t=_e,Ct=0,gt=xe;if(P.content&&m){const ot=P.content;Re=_A($,0,ot[0]),De=_A(Z,0,ot[1]),Ie=_A($,ot[0],ot[2]),Ue=_A(Z,ot[1],ot[3]),Ze=ot[0]-Re,Ct=ot[1]-De,_t=ot[2]-ot[0]-Ie,gt=ot[3]-ot[1]-Ue}const At=(ot,Tt,lt,tt)=>{const jt=mA(ot.stretch-Re,Ie,N,c.left),Dt=yA(ot.fixed-Ze,_t,ot.stretch,ee),ai=mA(Tt.stretch-De,Ue,j,c.top),Wi=yA(Tt.fixed-Ct,gt,Tt.stretch,ce),Zi=mA(lt.stretch-Re,Ie,N,c.left),Pr=yA(lt.fixed-Ze,_t,lt.stretch,ee),an=mA(tt.stretch-De,Ue,j,c.top),Is=yA(tt.fixed-Ct,gt,tt.stretch,ce),xr=new V(jt,ai),qr=new V(Zi,ai),is=new V(Zi,an),Ms=new V(jt,an),Rs=new V(Dt/M,Wi/M),Ir=new V(Pr/M,Is/M),Mr=s*Math.PI/180;if(Mr){const us=Math.sin(Mr),qs=Math.cos(Mr),Xs=[qs,-us,us,qs];xr._matMult(Xs),qr._matMult(Xs),Ms._matMult(Xs),is._matMult(Xs)}const hs=ot.stretch+ot.fixed,ks=Tt.stretch+Tt.fixed;return{tl:xr,tr:qr,bl:Ms,br:is,tex:{x:P.paddedRect.x+Wc+hs,y:P.paddedRect.y+Wc+ks,w:lt.stretch+lt.fixed-hs,h:tt.stretch+tt.fixed-ks},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rs,pixelOffsetBR:Ir,minFontScaleX:_t/M/N,minFontScaleY:gt/M/j,isSDF:f}};if(m&&(P.stretchX||P.stretchY)){const ot=Em($,_e,ee),Tt=Em(Z,xe,ce);for(let lt=0;lt<ot.length-1;lt++){const tt=ot[lt],jt=ot[lt+1];for(let Dt=0;Dt<Tt.length-1;Dt++)x.push(At(tt,Tt[Dt],jt,Tt[Dt+1]))}}else x.push(At({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:O+1}));return x}function _A(c,s,f){let m=0;for(const x of c)m+=Math.max(s,Math.min(f,x[1]))-Math.max(s,Math.min(f,x[0]));return m}function Em(c,s,f){const m=[{fixed:-Wc,stretch:0}];for(const[x,P]of c){const M=m[m.length-1];m.push({fixed:x-M.stretch,stretch:M.stretch}),m.push({fixed:x-M.stretch,stretch:M.stretch+(P-x)})}return m.push({fixed:s+Wc,stretch:f}),m}function mA(c,s,f,m){return c/s*f+m}function yA(c,s,f,m){return c-s*f/m}class bA{constructor(s,f,m,x,P,M,D,O,N,j){if(this.boxStartIndex=s.length,N){let $=M.top,Z=M.bottom;const J=M.collisionPadding;J&&($-=J[1],Z+=J[3]);let ee=Z-$;ee>0&&(ee=Math.max(10,ee),this.circleDiameter=ee)}else{let $=M.top*D-O[0],Z=M.bottom*D+O[2],J=M.left*D-O[3],ee=M.right*D+O[1];const ce=M.collisionPadding;if(ce&&(J-=ce[0]*D,$-=ce[1]*D,ee+=ce[2]*D,Z+=ce[3]*D),j){const _e=new V(J,$),xe=new V(ee,$),Re=new V(J,Z),Ie=new V(ee,Z),De=j*Math.PI/180;_e._rotate(De),xe._rotate(De),Re._rotate(De),Ie._rotate(De),J=Math.min(_e.x,xe.x,Re.x,Ie.x),ee=Math.max(_e.x,xe.x,Re.x,Ie.x),$=Math.min(_e.y,xe.y,Re.y,Ie.y),Z=Math.max(_e.y,xe.y,Re.y,Ie.y)}s.emplaceBack(f.x,f.y,J,$,ee,Z,m,x,P)}this.boxEndIndex=s.length}}class ET{constructor(s=[],f=ST){if(this.data=s,this.length=this.data.length,this.compare=f,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],f=this.data.pop();return this.length--,this.length>0&&(this.data[0]=f,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:f,compare:m}=this,x=f[s];for(;s>0;){const P=s-1>>1,M=f[P];if(m(x,M)>=0)break;f[s]=M,s=P}f[s]=x}_down(s){const{data:f,compare:m}=this,x=this.length>>1,P=f[s];for(;s<x;){let M=1+(s<<1),D=f[M];const O=M+1;if(O<this.length&&m(f[O],D)<0&&(M=O,D=f[O]),m(D,P)>=0)break;f[s]=D,s=M}f[s]=P}}function ST(c,s){return c<s?-1:c>s?1:0}function CT(c,s=1,f=!1){let m=1/0,x=1/0,P=-1/0,M=-1/0;const D=c[0];for(let J=0;J<D.length;J++){const ee=D[J];(!J||ee.x<m)&&(m=ee.x),(!J||ee.y<x)&&(x=ee.y),(!J||ee.x>P)&&(P=ee.x),(!J||ee.y>M)&&(M=ee.y)}const O=Math.min(P-m,M-x);let N=O/2;const j=new ET([],PT);if(O===0)return new V(m,x);for(let J=m;J<P;J+=O)for(let ee=x;ee<M;ee+=O)j.push(new Hc(J+N,ee+N,N,c));let $=function(J){let ee=0,ce=0,_e=0;const xe=J[0];for(let Re=0,Ie=xe.length,De=Ie-1;Re<Ie;De=Re++){const Ue=xe[Re],Ze=xe[De],_t=Ue.x*Ze.y-Ze.x*Ue.y;ce+=(Ue.x+Ze.x)*_t,_e+=(Ue.y+Ze.y)*_t,ee+=3*_t}return new Hc(ce/ee,_e/ee,0,J)}(c),Z=j.length;for(;j.length;){const J=j.pop();(J.d>$.d||!$.d)&&($=J,f&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,Z)),J.max-$.d<=s||(N=J.h/2,j.push(new Hc(J.p.x-N,J.p.y-N,N,c)),j.push(new Hc(J.p.x+N,J.p.y-N,N,c)),j.push(new Hc(J.p.x-N,J.p.y+N,N,c)),j.push(new Hc(J.p.x+N,J.p.y+N,N,c)),Z+=4)}return f&&(console.log(`num probes: ${Z}`),console.log(`best distance: ${$.d}`)),$.p}function PT(c,s){return s.max-c.max}function Hc(c,s,f,m){this.p=new V(c,s),this.h=f,this.d=function(x,P){let M=!1,D=1/0;for(let O=0;O<P.length;O++){const N=P[O];for(let j=0,$=N.length,Z=$-1;j<$;Z=j++){const J=N[j],ee=N[Z];J.y>x.y!=ee.y>x.y&&x.x<(ee.x-J.x)*(x.y-J.y)/(ee.y-J.y)+J.x&&(M=!M),D=Math.min(D,a_(x,J,ee))}}return(M?1:-1)*Math.sqrt(D)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var ts;l.aq=void 0,(ts=l.aq||(l.aq={}))[ts.center=1]="center",ts[ts.left=2]="left",ts[ts.right=3]="right",ts[ts.top=4]="top",ts[ts.bottom=5]="bottom",ts[ts["top-left"]=6]="top-left",ts[ts["top-right"]=7]="top-right",ts[ts["bottom-left"]=8]="bottom-left",ts[ts["bottom-right"]=9]="bottom-right";const Ga=7,Xd=Number.POSITIVE_INFINITY;function Sm(c,s){return s[1]!==Xd?function(f,m,x){let P=0,M=0;switch(m=Math.abs(m),x=Math.abs(x),f){case"top-right":case"top-left":case"top":M=x-Ga;break;case"bottom-right":case"bottom-left":case"bottom":M=-x+Ga}switch(f){case"top-right":case"bottom-right":case"right":P=-m;break;case"top-left":case"bottom-left":case"left":P=m}return[P,M]}(c,s[0],s[1]):function(f,m){let x=0,P=0;m<0&&(m=0);const M=m/Math.SQRT2;switch(f){case"top-right":case"top-left":P=M-Ga;break;case"bottom-right":case"bottom-left":P=-M+Ga;break;case"bottom":P=-m+Ga;break;case"top":P=m-Ga}switch(f){case"top-right":case"bottom-right":x=-M;break;case"top-left":case"bottom-left":x=M;break;case"left":x=m;break;case"right":x=-m}return[x,P]}(c,s[0])}function Cm(c,s,f){var m;const x=c.layout,P=(m=x.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(s,{},f);if(P){const D=P.values,O=[];for(let N=0;N<D.length;N+=2){const j=O[N]=D[N],$=D[N+1].map(Z=>Z*Cr);j.startsWith("top")?$[1]-=Ga:j.startsWith("bottom")&&($[1]+=Ga),O[N+1]=$}return new Pt(O)}const M=x.get("text-variable-anchor");if(M){let D;D=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[x.get("text-radial-offset").evaluate(s,{},f)*Cr,Xd]:x.get("text-offset").evaluate(s,{},f).map(N=>N*Cr);const O=[];for(const N of M)O.push(N,Sm(N,D));return new Pt(O)}return null}function Zd(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function IT(c,s,f,m,x,P,M,D,O,N,j){let $=P.textMaxSize.evaluate(s,{});$===void 0&&($=M);const Z=c.layers[0].layout,J=Z.get("icon-offset").evaluate(s,{},j),ee=Im(f.horizontal),ce=M/24,_e=c.tilePixelRatio*ce,xe=c.tilePixelRatio*$/24,Re=c.tilePixelRatio*D,Ie=c.tilePixelRatio*Z.get("symbol-spacing"),De=Z.get("text-padding")*c.tilePixelRatio,Ue=function(tt,jt,Dt,ai=1){const Wi=tt.get("icon-padding").evaluate(jt,{},Dt),Zi=Wi&&Wi.values;return[Zi[0]*ai,Zi[1]*ai,Zi[2]*ai,Zi[3]*ai]}(Z,s,j,c.tilePixelRatio),Ze=Z.get("text-max-angle")/180*Math.PI,_t=Z.get("text-rotation-alignment")!=="viewport"&&Z.get("symbol-placement")!=="point",Ct=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",gt=Z.get("symbol-placement"),At=Ie/2,ot=Z.get("icon-text-fit");let Tt;m&&ot!=="none"&&(c.allowVerticalPlacement&&f.vertical&&(Tt=Q_(m,f.vertical,ot,Z.get("icon-text-fit-padding"),J,ce)),ee&&(m=Q_(m,ee,ot,Z.get("icon-text-fit-padding"),J,ce)));const lt=(tt,jt)=>{jt.x<0||jt.x>=vr||jt.y<0||jt.y>=vr||function(Dt,ai,Wi,Zi,Pr,an,Is,xr,qr,is,Ms,Rs,Ir,Mr,hs,ks,us,qs,Xs,Rr,pi,As,rs,kr,Vn){const so=Dt.addToLineVertexArray(ai,Wi);let no,pa,jn,wn,Zs=0,ga=0,nu=0,Dm=0,i0=-1,r0=-1;const _a={};let Bm=ua("");if(Dt.allowVerticalPlacement&&Zi.vertical){const fs=xr.layout.get("text-rotate").evaluate(pi,{},kr)+90;jn=new bA(qr,ai,is,Ms,Rs,Zi.vertical,Ir,Mr,hs,fs),Is&&(wn=new bA(qr,ai,is,Ms,Rs,Is,us,qs,hs,fs))}if(Pr){const fs=xr.layout.get("icon-rotate").evaluate(pi,{}),Tn=xr.layout.get("icon-text-fit")!=="none",$l=Tm(Pr,fs,rs,Tn),ao=Is?Tm(Is,fs,rs,Tn):void 0;pa=new bA(qr,ai,is,Ms,Rs,Pr,us,qs,!1,fs),Zs=4*$l.length;const Wl=Dt.iconSizeData;let Fo=null;Wl.kind==="source"?(Fo=[Bo*xr.layout.get("icon-size").evaluate(pi,{})],Fo[0]>Xa&&qt(`${Dt.layerIds[0]}: Value for "icon-size" is >= ${tu}. Reduce your "icon-size".`)):Wl.kind==="composite"&&(Fo=[Bo*As.compositeIconSizes[0].evaluate(pi,{},kr),Bo*As.compositeIconSizes[1].evaluate(pi,{},kr)],(Fo[0]>Xa||Fo[1]>Xa)&&qt(`${Dt.layerIds[0]}: Value for "icon-size" is >= ${tu}. Reduce your "icon-size".`)),Dt.addSymbols(Dt.icon,$l,Fo,Rr,Xs,pi,l.ai.none,ai,so.lineStartIndex,so.lineLength,-1,kr),i0=Dt.icon.placedSymbolArray.length-1,ao&&(ga=4*ao.length,Dt.addSymbols(Dt.icon,ao,Fo,Rr,Xs,pi,l.ai.vertical,ai,so.lineStartIndex,so.lineLength,-1,kr),r0=Dt.icon.placedSymbolArray.length-1)}const Fm=Object.keys(Zi.horizontal);for(const fs of Fm){const Tn=Zi.horizontal[fs];if(!no){Bm=ua(Tn.text);const ao=xr.layout.get("text-rotate").evaluate(pi,{},kr);no=new bA(qr,ai,is,Ms,Rs,Tn,Ir,Mr,hs,ao)}const $l=Tn.positionedLines.length===1;if(nu+=Pm(Dt,ai,Tn,an,xr,hs,pi,ks,so,Zi.vertical?l.ai.horizontal:l.ai.horizontalOnly,$l?Fm:[fs],_a,i0,As,kr),$l)break}Zi.vertical&&(Dm+=Pm(Dt,ai,Zi.vertical,an,xr,hs,pi,ks,so,l.ai.vertical,["vertical"],_a,r0,As,kr));const kT=no?no.boxStartIndex:Dt.collisionBoxArray.length,DT=no?no.boxEndIndex:Dt.collisionBoxArray.length,BT=jn?jn.boxStartIndex:Dt.collisionBoxArray.length,FT=jn?jn.boxEndIndex:Dt.collisionBoxArray.length,OT=pa?pa.boxStartIndex:Dt.collisionBoxArray.length,LT=pa?pa.boxEndIndex:Dt.collisionBoxArray.length,NT=wn?wn.boxStartIndex:Dt.collisionBoxArray.length,zT=wn?wn.boxEndIndex:Dt.collisionBoxArray.length;let oo=-1;const xA=(fs,Tn)=>fs&&fs.circleDiameter?Math.max(fs.circleDiameter,Tn):Tn;oo=xA(no,oo),oo=xA(jn,oo),oo=xA(pa,oo),oo=xA(wn,oo);const Om=oo>-1?1:0;Om&&(oo*=Vn/Cr),Dt.glyphOffsetArray.length>=$c.MAX_GLYPHS&&qt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),pi.sortKey!==void 0&&Dt.addToSortKeyRanges(Dt.symbolInstances.length,pi.sortKey);const UT=Cm(xr,pi,kr),[VT,jT]=function(fs,Tn){const $l=fs.length,ao=Tn==null?void 0:Tn.values;if((ao==null?void 0:ao.length)>0)for(let Wl=0;Wl<ao.length;Wl+=2){const Fo=ao[Wl+1];fs.emplaceBack(l.aq[ao[Wl]],Fo[0],Fo[1])}return[$l,fs.length]}(Dt.textAnchorOffsets,UT);Dt.symbolInstances.emplaceBack(ai.x,ai.y,_a.right>=0?_a.right:-1,_a.center>=0?_a.center:-1,_a.left>=0?_a.left:-1,_a.vertical||-1,i0,r0,Bm,kT,DT,BT,FT,OT,LT,NT,zT,is,nu,Dm,Zs,ga,Om,0,Ir,oo,VT,jT)}(c,jt,tt,f,m,x,Tt,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,_e,[De,De,De,De],_t,O,Re,Ue,Ct,J,s,P,N,j,M)};if(gt==="line")for(const tt of mm(s.geometry,0,0,vr,vr)){const jt=TT(tt,Ie,Ze,f.vertical||ee,m,24,xe,c.overscaling,vr);for(const Dt of jt)ee&&MT(c,ee.text,At,Dt)||lt(tt,Dt)}else if(gt==="line-center"){for(const tt of s.geometry)if(tt.length>1){const jt=wT(tt,Ze,f.vertical||ee,m,24,xe);jt&&lt(tt,jt)}}else if(s.type==="Polygon")for(const tt of Sd(s.geometry,0)){const jt=CT(tt,16);lt(tt[0],new Ya(jt.x,jt.y,0))}else if(s.type==="LineString")for(const tt of s.geometry)lt(tt,new Ya(tt[0].x,tt[0].y,0));else if(s.type==="Point")for(const tt of s.geometry)for(const jt of tt)lt([jt],new Ya(jt.x,jt.y,0))}function Pm(c,s,f,m,x,P,M,D,O,N,j,$,Z,J,ee){const ce=function(Re,Ie,De,Ue,Ze,_t,Ct,gt){const At=Ue.layout.get("text-rotate").evaluate(_t,{})*Math.PI/180,ot=[];for(const Tt of Ie.positionedLines)for(const lt of Tt.positionedGlyphs){if(!lt.rect)continue;const tt=lt.rect||{};let jt=W_+1,Dt=!0,ai=1,Wi=0;const Zi=(Ze||gt)&&lt.vertical,Pr=lt.metrics.advance*lt.scale/2;if(gt&&Ie.verticalizable&&(Wi=Tt.lineOffset/2-(lt.imageName?-(Cr-lt.metrics.width*lt.scale)/2:(lt.scale-1)*Cr)),lt.imageName){const Rr=Ct[lt.imageName];Dt=Rr.sdf,ai=Rr.pixelRatio,jt=Hs/ai}const an=Ze?[lt.x+Pr,lt.y]:[0,0];let Is=Ze?[0,0]:[lt.x+Pr+De[0],lt.y+De[1]-Wi],xr=[0,0];Zi&&(xr=Is,Is=[0,0]);const qr=lt.metrics.isDoubleResolution?2:1,is=(lt.metrics.left-jt)*lt.scale-Pr+Is[0],Ms=(-lt.metrics.top-jt)*lt.scale+Is[1],Rs=is+tt.w/qr*lt.scale/ai,Ir=Ms+tt.h/qr*lt.scale/ai,Mr=new V(is,Ms),hs=new V(Rs,Ms),ks=new V(is,Ir),us=new V(Rs,Ir);if(Zi){const Rr=new V(-Pr,Pr-Jh),pi=-Math.PI/2,As=Cr/2-Pr,rs=new V(5-Jh-As,-(lt.imageName?As:0)),kr=new V(...xr);Mr._rotateAround(pi,Rr)._add(rs)._add(kr),hs._rotateAround(pi,Rr)._add(rs)._add(kr),ks._rotateAround(pi,Rr)._add(rs)._add(kr),us._rotateAround(pi,Rr)._add(rs)._add(kr)}if(At){const Rr=Math.sin(At),pi=Math.cos(At),As=[pi,-Rr,Rr,pi];Mr._matMult(As),hs._matMult(As),ks._matMult(As),us._matMult(As)}const qs=new V(0,0),Xs=new V(0,0);ot.push({tl:Mr,tr:hs,bl:ks,br:us,tex:tt,writingMode:Ie.writingMode,glyphOffset:an,sectionIndex:lt.sectionIndex,isSDF:Dt,pixelOffsetTL:qs,pixelOffsetBR:Xs,minFontScaleX:0,minFontScaleY:0})}return ot}(0,f,D,x,P,M,m,c.allowVerticalPlacement),_e=c.textSizeData;let xe=null;_e.kind==="source"?(xe=[Bo*x.layout.get("text-size").evaluate(M,{})],xe[0]>Xa&&qt(`${c.layerIds[0]}: Value for "text-size" is >= ${tu}. Reduce your "text-size".`)):_e.kind==="composite"&&(xe=[Bo*J.compositeTextSizes[0].evaluate(M,{},ee),Bo*J.compositeTextSizes[1].evaluate(M,{},ee)],(xe[0]>Xa||xe[1]>Xa)&&qt(`${c.layerIds[0]}: Value for "text-size" is >= ${tu}. Reduce your "text-size".`)),c.addSymbols(c.text,ce,xe,D,P,M,N,s,O.lineStartIndex,O.lineLength,Z,ee);for(const Re of j)$[Re]=c.text.placedSymbolArray.length-1;return 4*ce.length}function Im(c){for(const s in c)return c[s];return null}function MT(c,s,f,m){const x=c.compareText;if(s in x){const P=x[s];for(let M=P.length-1;M>=0;M--)if(m.dist(P[M])<f)return!0}else x[s]=[];return x[s].push(m),!1}const Mm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yd{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,m]=new Uint8Array(s,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const x=m>>4;if(x!==1)throw new Error(`Got v${x} data when expected v1.`);const P=Mm[15&m];if(!P)throw new Error("Unrecognized array type.");const[M]=new Uint16Array(s,2,1),[D]=new Uint32Array(s,4,1);return new Yd(D,M,P,s)}constructor(s,f=64,m=Float64Array,x){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=m,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const P=Mm.indexOf(this.ArrayType),M=2*s*this.ArrayType.BYTES_PER_ELEMENT,D=s*this.IndexArrayType.BYTES_PER_ELEMENT,O=(8-D%8)%8;if(P<0)throw new Error(`Unexpected typed array class: ${m}.`);x&&x instanceof ArrayBuffer?(this.data=x,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+D+O,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+M+D+O),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+D+O,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+P]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=s)}add(s,f){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=s,this.coords[this._pos++]=f,m}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return Gd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,f,m,x){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:P,coords:M,nodeSize:D}=this,O=[0,P.length-1,0],N=[];for(;O.length;){const j=O.pop()||0,$=O.pop()||0,Z=O.pop()||0;if($-Z<=D){for(let _e=Z;_e<=$;_e++){const xe=M[2*_e],Re=M[2*_e+1];xe>=s&&xe<=m&&Re>=f&&Re<=x&&N.push(P[_e])}continue}const J=Z+$>>1,ee=M[2*J],ce=M[2*J+1];ee>=s&&ee<=m&&ce>=f&&ce<=x&&N.push(P[J]),(j===0?s<=ee:f<=ce)&&(O.push(Z),O.push(J-1),O.push(1-j)),(j===0?m>=ee:x>=ce)&&(O.push(J+1),O.push($),O.push(1-j))}return N}within(s,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:P,nodeSize:M}=this,D=[0,x.length-1,0],O=[],N=m*m;for(;D.length;){const j=D.pop()||0,$=D.pop()||0,Z=D.pop()||0;if($-Z<=M){for(let _e=Z;_e<=$;_e++)km(P[2*_e],P[2*_e+1],s,f)<=N&&O.push(x[_e]);continue}const J=Z+$>>1,ee=P[2*J],ce=P[2*J+1];km(ee,ce,s,f)<=N&&O.push(x[J]),(j===0?s-m<=ee:f-m<=ce)&&(D.push(Z),D.push(J-1),D.push(1-j)),(j===0?s+m>=ee:f+m>=ce)&&(D.push(J+1),D.push($),D.push(1-j))}return O}}function Gd(c,s,f,m,x,P){if(x-m<=f)return;const M=m+x>>1;Rm(c,s,M,m,x,P),Gd(c,s,f,m,M-1,1-P),Gd(c,s,f,M+1,x,1-P)}function Rm(c,s,f,m,x,P){for(;x>m;){if(x-m>600){const N=x-m+1,j=f-m+1,$=Math.log(N),Z=.5*Math.exp(2*$/3),J=.5*Math.sqrt($*Z*(N-Z)/N)*(j-N/2<0?-1:1);Rm(c,s,f,Math.max(m,Math.floor(f-j*Z/N+J)),Math.min(x,Math.floor(f+(N-j)*Z/N+J)),P)}const M=s[2*f+P];let D=m,O=x;for(ru(c,s,m,f),s[2*x+P]>M&&ru(c,s,m,x);D<O;){for(ru(c,s,D,O),D++,O--;s[2*D+P]<M;)D++;for(;s[2*O+P]>M;)O--}s[2*m+P]===M?ru(c,s,m,O):(O++,ru(c,s,O,x)),O<=f&&(m=O+1),f<=O&&(x=O-1)}}function ru(c,s,f,m){Qd(c,f,m),Qd(s,2*f,2*m),Qd(s,2*f+1,2*m+1)}function Qd(c,s,f){const m=c[s];c[s]=c[f],c[f]=m}function km(c,s,f,m){const x=c-f,P=s-m;return x*x+P*P}var Kd;l.bh=void 0,(Kd=l.bh||(l.bh={})).create="create",Kd.load="load",Kd.fullLoad="fullLoad";let vA=null,su=[];const Jd=1e3/60,e0="loadTime",t0="fullLoadTime",RT={mark(c){performance.mark(c)},frame(c){const s=c;vA!=null&&su.push(s-vA),vA=s},clearMetrics(){vA=null,su=[],performance.clearMeasures(e0),performance.clearMeasures(t0);for(const c in l.bh)performance.clearMarks(l.bh[c])},getPerformanceMetrics(){performance.measure(e0,l.bh.create,l.bh.load),performance.measure(t0,l.bh.create,l.bh.fullLoad);const c=performance.getEntriesByName(e0)[0].duration,s=performance.getEntriesByName(t0)[0].duration,f=su.length,m=1/(su.reduce((P,M)=>P+M,0)/f/1e3),x=su.filter(P=>P>Jd).reduce((P,M)=>P+(M-Jd)/Jd,0);return{loadTime:c,fullLoadTime:s,fps:m,percentDroppedFrames:x/(f+x)*100,totalFrames:f}}};l.$=function(c,s,f){var m,x,P,M,D,O,N,j,$,Z,J,ee,ce=f[0],_e=f[1],xe=f[2];return s===c?(c[12]=s[0]*ce+s[4]*_e+s[8]*xe+s[12],c[13]=s[1]*ce+s[5]*_e+s[9]*xe+s[13],c[14]=s[2]*ce+s[6]*_e+s[10]*xe+s[14],c[15]=s[3]*ce+s[7]*_e+s[11]*xe+s[15]):(x=s[1],P=s[2],M=s[3],D=s[4],O=s[5],N=s[6],j=s[7],$=s[8],Z=s[9],J=s[10],ee=s[11],c[0]=m=s[0],c[1]=x,c[2]=P,c[3]=M,c[4]=D,c[5]=O,c[6]=N,c[7]=j,c[8]=$,c[9]=Z,c[10]=J,c[11]=ee,c[12]=m*ce+D*_e+$*xe+s[12],c[13]=x*ce+O*_e+Z*xe+s[13],c[14]=P*ce+N*_e+J*xe+s[14],c[15]=M*ce+j*_e+ee*xe+s[15]),c},l.A=Lc,l.B=dr,l.C=class{constructor(c,s,f){this.receive=m=>{const x=m.data,P=x.id;if(P&&(!x.targetMapId||this.mapId===x.targetMapId))if(x.type==="<cancel>"){delete this.tasks[P];const M=this.cancelCallbacks[P];delete this.cancelCallbacks[P],M&&M()}else hr()||x.mustQueue?(this.tasks[P]=x,this.taskQueue.push(P),this.invoker.trigger()):this.processTask(P,x)},this.process=()=>{if(!this.taskQueue.length)return;const m=this.taskQueue.shift(),x=this.tasks[m];delete this.tasks[m],this.taskQueue.length&&this.invoker.trigger(),x&&this.processTask(m,x)},this.target=c,this.parent=s,this.mapId=f,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new vT(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=hr()?c:window}send(c,s,f,m,x=!1){const P=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(this.callbacks[P]=f);const M=[],D={id:P,type:c,hasCallback:!!f,targetMapId:m,mustQueue:x,sourceMapId:this.mapId,data:bn(s,M)};return this.target.postMessage(D,{transfer:M}),{cancel:()=>{f&&delete this.callbacks[P],this.target.postMessage({id:P,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}processTask(c,s){if(s.type==="<response>"){const f=this.callbacks[c];delete this.callbacks[c],f&&(s.error?f(Mo(s.error)):f(null,Mo(s.data)))}else{let f=!1;const m=[],x=s.hasCallback?(D,O)=>{f=!0,delete this.cancelCallbacks[c];const N={id:c,type:"<response>",sourceMapId:this.mapId,error:D?bn(D):null,data:bn(O,m)};this.target.postMessage(N,{transfer:m})}:D=>{f=!0};let P=null;const M=Mo(s.data);if(this.parent[s.type])P=this.parent[s.type](s.sourceMapId,M,x);else if("getWorkerSource"in this.parent){const D=s.type.split(".");P=this.parent.getWorkerSource(s.sourceMapId,D[0],M.source)[D[1]](M,x)}else x(new Error(`Could not find function ${s.type}`));!f&&P&&P.cancel&&(this.cancelCallbacks[c]=P.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.D=It,l.E=en,l.F=function(c,s){const f={};for(let m=0;m<s.length;m++){const x=s[m];x in c&&(f[x]=c[x])}return f},l.G=om,l.H=am,l.I=Od,l.J=Le,l.K=Oe,l.L=Za,l.M=Pn,l.N=vr,l.O=xn,l.P=V,l.Q=ci,l.R=vn,l.S=Oi,l.T=Rc,l.U=gA,l.V=class extends io{},l.W=qd,l.X=function(c,s){const f=window.document.createElement("video");f.muted=!0,f.onloadstart=function(){s(null,f)};for(let m=0;m<c.length;m++){const x=window.document.createElement("source");zr(c[m])||(f.crossOrigin="Anonymous"),x.src=c[m],f.appendChild(x)}return{cancel:()=>{}}},l.Y=st,l.Z=function(){var c=new Lc(16);return Lc!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},l._=I,l.a=Cn,l.a$=class extends b{},l.a0=function(c,s,f){var m=f[0],x=f[1],P=f[2];return c[0]=s[0]*m,c[1]=s[1]*m,c[2]=s[2]*m,c[3]=s[3]*m,c[4]=s[4]*x,c[5]=s[5]*x,c[6]=s[6]*x,c[7]=s[7]*x,c[8]=s[8]*P,c[9]=s[9]*P,c[10]=s[10]*P,c[11]=s[11]*P,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},l.a1=u_,l.a2=function(){return ct++},l.a3=k,l.a4=$c,l.a5=function(){ls.isLoading()||ls.isLoaded()||ja()!=="deferred"||ir()},l.a6=Sl,l.a7=Vl,l.a8=zi,l.a9=dm,l.aA=aa,l.aB=function(c){c=c.slice();const s=Object.create(null);for(let f=0;f<c.length;f++)s[c[f].id]=c[f];for(let f=0;f<c.length;f++)"ref"in c[f]&&(c[f]=Br(c[f],s[c[f].ref]));return c},l.aC=function(c){if(c.type==="custom")return new bT(c);switch(c.type){case"background":return new _T(c);case"circle":return new iw(c);case"fill":return new xw(c);case"fill-extrusion":return new Lw(c);case"heatmap":return new sw(c);case"hillshade":return new ow(c);case"line":return new Hw(c);case"raster":return new yT(c);case"symbol":return new pA(c)}},l.aD=Ot,l.aE=function(c,s){if(!c)return[{command:oi.setStyle,args:[s]}];let f=[];try{if(!vi(c.version,s.version))return[{command:oi.setStyle,args:[s]}];vi(c.center,s.center)||f.push({command:oi.setCenter,args:[s.center]}),vi(c.zoom,s.zoom)||f.push({command:oi.setZoom,args:[s.zoom]}),vi(c.bearing,s.bearing)||f.push({command:oi.setBearing,args:[s.bearing]}),vi(c.pitch,s.pitch)||f.push({command:oi.setPitch,args:[s.pitch]}),vi(c.sprite,s.sprite)||f.push({command:oi.setSprite,args:[s.sprite]}),vi(c.glyphs,s.glyphs)||f.push({command:oi.setGlyphs,args:[s.glyphs]}),vi(c.transition,s.transition)||f.push({command:oi.setTransition,args:[s.transition]}),vi(c.light,s.light)||f.push({command:oi.setLight,args:[s.light]});const m={},x=[];(function(M,D,O,N){let j;for(j in D=D||{},M=M||{})Object.prototype.hasOwnProperty.call(M,j)&&(Object.prototype.hasOwnProperty.call(D,j)||In(j,O,N));for(j in D)Object.prototype.hasOwnProperty.call(D,j)&&(Object.prototype.hasOwnProperty.call(M,j)?vi(M[j],D[j])||(M[j].type==="geojson"&&D[j].type==="geojson"&&Mn(M,D,j)?O.push({command:oi.setGeoJSONSourceData,args:[j,D[j].data]}):ys(j,D,O,N)):Zr(j,D,O))})(c.sources,s.sources,x,m);const P=[];c.layers&&c.layers.forEach(M=>{m[M.source]?f.push({command:oi.removeLayer,args:[M.id]}):P.push(M)}),f=f.concat(x),function(M,D,O){D=D||[];const N=(M=M||[]).map(Ns),j=D.map(Ns),$=M.reduce(bs,{}),Z=D.reduce(bs,{}),J=N.slice(),ee=Object.create(null);let ce,_e,xe,Re,Ie,De,Ue;for(ce=0,_e=0;ce<N.length;ce++)xe=N[ce],Object.prototype.hasOwnProperty.call(Z,xe)?_e++:(O.push({command:oi.removeLayer,args:[xe]}),J.splice(J.indexOf(xe,_e),1));for(ce=0,_e=0;ce<j.length;ce++)xe=j[j.length-1-ce],J[J.length-1-ce]!==xe&&(Object.prototype.hasOwnProperty.call($,xe)?(O.push({command:oi.removeLayer,args:[xe]}),J.splice(J.lastIndexOf(xe,J.length-_e),1)):_e++,De=J[J.length-ce],O.push({command:oi.addLayer,args:[Z[xe],De]}),J.splice(J.length-ce,0,xe),ee[xe]=!0);for(ce=0;ce<j.length;ce++)if(xe=j[ce],Re=$[xe],Ie=Z[xe],!ee[xe]&&!vi(Re,Ie))if(vi(Re.source,Ie.source)&&vi(Re["source-layer"],Ie["source-layer"])&&vi(Re.type,Ie.type)){for(Ue in tn(Re.layout,Ie.layout,O,xe,null,oi.setLayoutProperty),tn(Re.paint,Ie.paint,O,xe,null,oi.setPaintProperty),vi(Re.filter,Ie.filter)||O.push({command:oi.setFilter,args:[xe,Ie.filter]}),vi(Re.minzoom,Ie.minzoom)&&vi(Re.maxzoom,Ie.maxzoom)||O.push({command:oi.setLayerZoomRange,args:[xe,Ie.minzoom,Ie.maxzoom]}),Re)Object.prototype.hasOwnProperty.call(Re,Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&(Ue.indexOf("paint.")===0?tn(Re[Ue],Ie[Ue],O,xe,Ue.slice(6),oi.setPaintProperty):vi(Re[Ue],Ie[Ue])||O.push({command:oi.setLayerProperty,args:[xe,Ue,Ie[Ue]]}));for(Ue in Ie)Object.prototype.hasOwnProperty.call(Ie,Ue)&&!Object.prototype.hasOwnProperty.call(Re,Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&(Ue.indexOf("paint.")===0?tn(Re[Ue],Ie[Ue],O,xe,Ue.slice(6),oi.setPaintProperty):vi(Re[Ue],Ie[Ue])||O.push({command:oi.setLayerProperty,args:[xe,Ue,Ie[Ue]]}))}else O.push({command:oi.removeLayer,args:[xe]}),De=J[J.lastIndexOf(xe)+1],O.push({command:oi.addLayer,args:[Ie,De]})}(P,s.layers,f)}catch(m){console.warn("Unable to compute style diff:",m),f=[{command:oi.setStyle,args:[s]}]}return f},l.aF=function(c){const s=[],f=c.id;return f===void 0&&s.push({message:`layers.${f}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${f}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),s},l.aG=function c(s,f){if(Array.isArray(s)){if(!Array.isArray(f)||s.length!==f.length)return!1;for(let m=0;m<s.length;m++)if(!c(s[m],f[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&f!==null){if(typeof f!="object"||Object.keys(s).length!==Object.keys(f).length)return!1;for(const m in s)if(!c(s[m],f[m]))return!1;return!0}return s===f},l.aH=at,l.aI=Vt,l.aJ=Ro,l.aK=function(c){return c({pluginStatus:Kr,pluginURL:Bn}),Ro.on("pluginStateChange",c),c},l.aL=class extends Aa{constructor(c,s){super(c,s),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},l.aM=Fc,l.aN=class extends Aa{constructor(c,s){super(c,s),this.current=dd}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let s=1;s<16;s++)if(c[s]!==this.current[s]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},l.aO=eA,l.aP=class extends Aa{constructor(c,s){super(c,s),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},l.aQ=class extends Aa{constructor(c,s){super(c,s),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},l.aR=tA,l.aS=function(c,s,f,m,x,P,M){var D=1/(s-f),O=1/(m-x),N=1/(P-M);return c[0]=-2*D,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*O,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*N,c[11]=0,c[12]=(s+f)*D,c[13]=(x+m)*O,c[14]=(M+P)*N,c[15]=1,c},l.aT=Qt,l.aU=tw,l.aV=class extends v{},l.aW=Yw,l.aX=class extends C{},l.aY=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},l.aZ=g_,l.a_=be,l.aa=function(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,m,x,P)=>{const M=x||P;return s[m]=!M||M.toLowerCase(),""}),s["max-age"]){const f=parseInt(s["max-age"],10);isNaN(f)?delete s["max-age"]:s["max-age"]=f}return s},l.ab=function(c,s){const f=[];for(const m in c)m in s||f.push(m);return f},l.ac=function(c){if(Ks==null){const s=c.navigator?c.navigator.userAgent:null;Ks=!!c.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ks},l.ad=Je,l.ae=function(c,s,f){var m=Math.sin(f),x=Math.cos(f),P=s[0],M=s[1],D=s[2],O=s[3],N=s[4],j=s[5],$=s[6],Z=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=P*x+N*m,c[1]=M*x+j*m,c[2]=D*x+$*m,c[3]=O*x+Z*m,c[4]=N*x-P*m,c[5]=j*x-M*m,c[6]=$*x-D*m,c[7]=Z*x-O*m,c},l.af=function(c){var s=new Lc(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},l.ag=nA,l.ah=function(c,s){let f=0,m=0;if(c.kind==="constant")m=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:x,minZoom:P,maxZoom:M}=c,D=x?Je(Di.interpolationFactor(x,s,P,M),0,1):0;c.kind==="camera"?m=dr.number(c.minSize,c.maxSize,D):f=D}return{uSizeT:f,uSize:m}},l.aj=function(c,{uSize:s,uSizeT:f},{lowerSize:m,upperSize:x}){return c.kind==="source"?m/Bo:c.kind==="composite"?dr.number(m/Bo,x/Bo,f):s},l.ak=Ud,l.al=function(c,s,f,m){const x=s.y-c.y,P=s.x-c.x,M=m.y-f.y,D=m.x-f.x,O=M*P-D*x;if(O===0)return null;const N=(D*(c.y-f.y)-M*(c.x-f.x))/O;return new V(c.x+N*P,c.y+N*x)},l.am=mm,l.an=n_,l.ao=yd,l.ap=Cr,l.ar=zd,l.as=function(c,s){var f=s[0],m=s[1],x=s[2],P=s[3],M=s[4],D=s[5],O=s[6],N=s[7],j=s[8],$=s[9],Z=s[10],J=s[11],ee=s[12],ce=s[13],_e=s[14],xe=s[15],Re=f*D-m*M,Ie=f*O-x*M,De=f*N-P*M,Ue=m*O-x*D,Ze=m*N-P*D,_t=x*N-P*O,Ct=j*ce-$*ee,gt=j*_e-Z*ee,At=j*xe-J*ee,ot=$*_e-Z*ce,Tt=$*xe-J*ce,lt=Z*xe-J*_e,tt=Re*lt-Ie*Tt+De*ot+Ue*At-Ze*gt+_t*Ct;return tt?(c[0]=(D*lt-O*Tt+N*ot)*(tt=1/tt),c[1]=(x*Tt-m*lt-P*ot)*tt,c[2]=(ce*_t-_e*Ze+xe*Ue)*tt,c[3]=(Z*Ze-$*_t-J*Ue)*tt,c[4]=(O*At-M*lt-N*gt)*tt,c[5]=(f*lt-x*At+P*gt)*tt,c[6]=(_e*De-ee*_t-xe*Ie)*tt,c[7]=(j*_t-Z*De+J*Ie)*tt,c[8]=(M*Tt-D*At+N*Ct)*tt,c[9]=(m*At-f*Tt-P*Ct)*tt,c[10]=(ee*Ze-ce*De+xe*Re)*tt,c[11]=($*De-j*Ze-J*Re)*tt,c[12]=(D*gt-M*ot-O*Ct)*tt,c[13]=(f*ot-m*gt+x*Ct)*tt,c[14]=(ce*Ie-ee*Ue-_e*Re)*tt,c[15]=(j*Ue-$*Ie+Z*Re)*tt,c):null},l.at=Zd,l.au=Nd,l.av=Yd,l.aw=function(){const c={},s=Xe.$version;for(const f in Xe.$root){const m=Xe.$root[f];if(m.required){let x=null;x=f==="version"?s:m.type==="array"?[]:{},x!=null&&(c[f]=x)}}return c},l.ax=oi,l.ay=Pc,l.az=yi,l.b=function(c,s){const f=new Blob([new Uint8Array(c)],{type:"image/png"});createImageBitmap(f).then(m=>{s(null,m)}).catch(m=>{s(new Error(`Could not load image because of ${m.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},l.b0=ti,l.b1=function(c,s){var f=c[0],m=c[1],x=c[2],P=c[3],M=c[4],D=c[5],O=c[6],N=c[7],j=c[8],$=c[9],Z=c[10],J=c[11],ee=c[12],ce=c[13],_e=c[14],xe=c[15],Re=s[0],Ie=s[1],De=s[2],Ue=s[3],Ze=s[4],_t=s[5],Ct=s[6],gt=s[7],At=s[8],ot=s[9],Tt=s[10],lt=s[11],tt=s[12],jt=s[13],Dt=s[14],ai=s[15];return Math.abs(f-Re)<=Ps*Math.max(1,Math.abs(f),Math.abs(Re))&&Math.abs(m-Ie)<=Ps*Math.max(1,Math.abs(m),Math.abs(Ie))&&Math.abs(x-De)<=Ps*Math.max(1,Math.abs(x),Math.abs(De))&&Math.abs(P-Ue)<=Ps*Math.max(1,Math.abs(P),Math.abs(Ue))&&Math.abs(M-Ze)<=Ps*Math.max(1,Math.abs(M),Math.abs(Ze))&&Math.abs(D-_t)<=Ps*Math.max(1,Math.abs(D),Math.abs(_t))&&Math.abs(O-Ct)<=Ps*Math.max(1,Math.abs(O),Math.abs(Ct))&&Math.abs(N-gt)<=Ps*Math.max(1,Math.abs(N),Math.abs(gt))&&Math.abs(j-At)<=Ps*Math.max(1,Math.abs(j),Math.abs(At))&&Math.abs($-ot)<=Ps*Math.max(1,Math.abs($),Math.abs(ot))&&Math.abs(Z-Tt)<=Ps*Math.max(1,Math.abs(Z),Math.abs(Tt))&&Math.abs(J-lt)<=Ps*Math.max(1,Math.abs(J),Math.abs(lt))&&Math.abs(ee-tt)<=Ps*Math.max(1,Math.abs(ee),Math.abs(tt))&&Math.abs(ce-jt)<=Ps*Math.max(1,Math.abs(ce),Math.abs(jt))&&Math.abs(_e-Dt)<=Ps*Math.max(1,Math.abs(_e),Math.abs(Dt))&&Math.abs(xe-ai)<=Ps*Math.max(1,Math.abs(xe),Math.abs(ai))},l.b2=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},l.b3=function(c,s,f){return c[0]=s[0]*f[0],c[1]=s[1]*f[1],c[2]=s[2]*f[2],c[3]=s[3]*f[3],c},l.b4=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]*s[3]},l.b5=xt,l.b6=um,l.b7=lm,l.b8=function(c,s,f,m,x){var P,M=1/Math.tan(s/2);return c[0]=M/f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=M,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,x!=null&&x!==1/0?(c[10]=(x+m)*(P=1/(m-x)),c[14]=2*x*m*P):(c[10]=-1,c[14]=-2*m),c},l.b9=function(c,s,f){var m=Math.sin(f),x=Math.cos(f),P=s[4],M=s[5],D=s[6],O=s[7],N=s[8],j=s[9],$=s[10],Z=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=P*x+N*m,c[5]=M*x+j*m,c[6]=D*x+$*m,c[7]=O*x+Z*m,c[8]=N*x-P*m,c[9]=j*x-M*m,c[10]=$*x-D*m,c[11]=Z*x-O*m,c},l.bA=L,l.bB=L_,l.bC=wo,l.bD=ls,l.ba=Ne,l.bb=Qe,l.bc=function(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},l.bd=class extends $s{},l.be=Wd,l.bf=cm,l.bg=RT,l.bi=Dr,l.bj=function(c,s,f=!1){if(Kr===Dl||Kr===Bl||Kr===Fl)throw new Error("setRTLTextPlugin cannot be called multiple times.");Bn=cn.resolveURL(c),Kr=Dl,Ol=s,Ll(),f||ir()},l.bk=ja,l.bl=function(c,s){const f={};for(let x=0;x<c.length;x++){const P=s&&s[c[x].id]||ra(c[x]);s&&(s[c[x].id]=P);let M=f[P];M||(M=f[P]=[]),M.push(c[x])}const m=[];for(const x in f)m.push(f[x]);return m},l.bm=bt,l.bn=fm,l.bo=pm,l.bp=q_,l.bq=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=vr/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const s=c.bucket.layers[0],f=s.layout,m=s._unevaluatedLayout._values,x={layoutIconSize:m["icon-size"].possiblyEvaluate(new zi(c.bucket.zoom+1),c.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new zi(c.bucket.zoom+1),c.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new zi(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:j}=c.bucket.textSizeData;x.compositeTextSizes=[m["text-size"].possiblyEvaluate(new zi(N),c.canonical),m["text-size"].possiblyEvaluate(new zi(j),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:j}=c.bucket.iconSizeData;x.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new zi(N),c.canonical),m["icon-size"].possiblyEvaluate(new zi(j),c.canonical)]}const P=f.get("text-line-height")*Cr,M=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",D=f.get("text-keep-upright"),O=f.get("text-size");for(const N of c.bucket.features){const j=f.get("text-font").evaluate(N,{},c.canonical).join(","),$=O.evaluate(N,{},c.canonical),Z=x.layoutTextSize.evaluate(N,{},c.canonical),J=x.layoutIconSize.evaluate(N,{},c.canonical),ee={horizontal:{},vertical:void 0},ce=N.text;let _e,xe=[0,0];if(ce){const De=ce.toString(),Ue=f.get("text-letter-spacing").evaluate(N,{},c.canonical)*Cr,Ze=Rl(De)?Ue:0,_t=f.get("text-anchor").evaluate(N,{},c.canonical),Ct=Cm(s,N,c.canonical);if(!Ct){const lt=f.get("text-radial-offset").evaluate(N,{},c.canonical);xe=lt?Sm(_t,[lt*Cr,Xd]):f.get("text-offset").evaluate(N,{},c.canonical).map(tt=>tt*Cr)}let gt=M?"center":f.get("text-justify").evaluate(N,{},c.canonical);const At=f.get("symbol-placement"),ot=At==="point"?f.get("text-max-width").evaluate(N,{},c.canonical)*Cr:0,Tt=()=>{c.bucket.allowVerticalPlacement&&Ml(De)&&(ee.vertical=AA(ce,c.glyphMap,c.glyphPositions,c.imagePositions,j,ot,P,_t,"left",Ze,xe,l.ai.vertical,!0,At,Z,$))};if(!M&&Ct){const lt=new Set;if(gt==="auto")for(let jt=0;jt<Ct.values.length;jt+=2)lt.add(Zd(Ct.values[jt]));else lt.add(gt);let tt=!1;for(const jt of lt)if(!ee.horizontal[jt])if(tt)ee.horizontal[jt]=ee.horizontal[0];else{const Dt=AA(ce,c.glyphMap,c.glyphPositions,c.imagePositions,j,ot,P,"center",jt,Ze,xe,l.ai.horizontal,!1,At,Z,$);Dt&&(ee.horizontal[jt]=Dt,tt=Dt.positionedLines.length===1)}Tt()}else{gt==="auto"&&(gt=Zd(_t));const lt=AA(ce,c.glyphMap,c.glyphPositions,c.imagePositions,j,ot,P,_t,gt,Ze,xe,l.ai.horizontal,!1,At,Z,$);lt&&(ee.horizontal[gt]=lt),Tt(),Ml(De)&&M&&D&&(ee.vertical=AA(ce,c.glyphMap,c.glyphPositions,c.imagePositions,j,ot,P,_t,gt,Ze,xe,l.ai.vertical,!1,At,Z,$))}}let Re=!1;if(N.icon&&N.icon.name){const De=c.imageMap[N.icon.name];De&&(_e=AT(c.imagePositions[N.icon.name],f.get("icon-offset").evaluate(N,{},c.canonical),f.get("icon-anchor").evaluate(N,{},c.canonical)),Re=!!De.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Re:c.bucket.sdfIcons!==Re&&qt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==c.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const Ie=Im(ee.horizontal)||ee.vertical;c.bucket.iconsInText=!!Ie&&Ie.iconsInText,(Ie||_e)&&IT(c.bucket,N,ee,_e,c.imageMap,x,Z,J,xe,Re,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},l.br=kd,l.bs=Id,l.bt=Rd,l.bu=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},l.bv=Bd,l.bw=Ha,l.bx=function(c,s,f,m,x){return I(this,void 0,void 0,function*(){if(Oe())try{return yield Pn(c,s,f,m,x)}catch{}return function(P,M,D,O,N){const j=P.width,$=P.height;ur&&Ei||(ur=new OffscreenCanvas(j,$),Ei=ur.getContext("2d",{willReadFrequently:!0})),ur.width=j,ur.height=$,Ei.drawImage(P,0,0,j,$);const Z=Ei.getImageData(M,D,O,N);return Ei.clearRect(0,0,j,$),Z.data}(c,s,f,m,x)})},l.by=Am,l.bz=R,l.c=Qi,l.d=function(c,s){const f=new Image;f.onload=()=>{s(null,f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=qn})},f.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const m=new Blob([new Uint8Array(c)],{type:"image/png"});f.src=c.byteLength?URL.createObjectURL(m):qn},l.e=wt,l.f=function(c,s){return Xr(wt(c,{type:"json"}),s)},l.g=ki,l.h=cn,l.i=hr,l.j=Ur,l.k=Ki,l.l=Ls,l.m=Xr,l.n=function(c){return new Bd(c).readFields(oT,[])},l.o=function(c,s,f){if(!c.length)return f(null,[]);let m=c.length;const x=new Array(c.length);let P=null;c.forEach((M,D)=>{s(M,(O,N)=>{O&&(P=O),x[D]=N,--m==0&&f(P,x)})})},l.p=H_,l.q=Hh,l.r=rr,l.s=zr,l.t=zh,l.u=dt,l.v=Xe,l.w=qt,l.x=Ua,l.y=mn,l.z=function([c,s,f]){return s+=90,s*=Math.PI/180,f*=Math.PI/180,{x:c*Math.cos(s)*Math.sin(f),y:c*Math.sin(s)*Math.sin(f),z:c*Math.cos(f)}}}),u(["./shared"],function(l){class I{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,Q){for(const pe of X){this._layerConfigs[pe.id]=pe;const ge=this._layers[pe.id]=l.aC(pe);ge._featureFilter=l.a6(ge.filter),this.keyCache[pe.id]&&delete this.keyCache[pe.id]}for(const pe of Q)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const ae=l.bl(Object.values(this._layerConfigs),this.keyCache);for(const pe of ae){const ge=pe.map(ue=>this._layers[ue.id]),ke=ge[0];if(ke.visibility==="none")continue;const Pe=ke.source||"";let ye=this.familiesBySource[Pe];ye||(ye=this.familiesBySource[Pe]={});const Me=ke.sourceLayer||"_geojsonTileLayer";let qe=ye[Me];qe||(qe=ye[Me]=[]),qe.push(ge)}}}class R{constructor(X){const Q={},ae=[];for(const Pe in X){const ye=X[Pe],Me=Q[Pe]={};for(const qe in ye){const ue=ye[+qe];if(!ue||ue.bitmap.width===0||ue.bitmap.height===0)continue;const Se={x:0,y:0,w:ue.bitmap.width+2,h:ue.bitmap.height+2};ae.push(Se),Me[qe]={rect:Se,metrics:ue.metrics}}}const{w:pe,h:ge}=l.p(ae),ke=new l.q({width:pe||1,height:ge||1});for(const Pe in X){const ye=X[Pe];for(const Me in ye){const qe=ye[+Me];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const ue=Q[Pe][Me].rect;l.q.copy(qe.bitmap,ke,{x:0,y:0},{x:ue.x+1,y:ue.y+1},qe.bitmap)}}this.image=ke,this.positions=Q}}l.bm("GlyphAtlas",R);class L{constructor(X){this.tileID=new l.O(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.uid=X.uid,this.zoom=X.zoom,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.returnDependencies=!!X.returnDependencies,this.promoteId=X.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(X,Q,ae,pe,ge){this.status="parsing",this.data=X,this.collisionBoxArray=new l.a3;const ke=new l.bn(Object.keys(X.layers).sort()),Pe=new l.bo(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];const ye={},Me={featureIndex:Pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ae},qe=Q.familiesBySource[this.source];for(const ft in qe){const yt=X.layers[ft];if(!yt)continue;yt.version===1&&l.w(`Vector tile source "${this.source}" layer "${ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Si=ke.encode(ft),Lt=[];for(let Rt=0;Rt<yt.length;Rt++){const wi=yt.feature(Rt),Tr=Pe.getId(wi,ft);Lt.push({feature:wi,id:Tr,index:Rt,sourceLayerIndex:Si})}for(const Rt of qe[ft]){const wi=Rt[0];wi.source!==this.source&&l.w(`layer.source = ${wi.source} does not equal this.source = ${this.source}`),wi.minzoom&&this.zoom<Math.floor(wi.minzoom)||wi.maxzoom&&this.zoom>=wi.maxzoom||wi.visibility!=="none"&&(z(Rt,this.zoom,ae),(ye[wi.id]=wi.createBucket({index:Pe.bucketLayerIDs.length,layers:Rt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Si,sourceID:this.source})).populate(Lt,Me,this.tileID.canonical),Pe.bucketLayerIDs.push(Rt.map(Tr=>Tr.id)))}}let ue,Se,We,et;const g=l.aH(Me.glyphDependencies,ft=>Object.keys(ft).map(Number));this.inFlightDependencies.forEach(ft=>ft==null?void 0:ft.cancel()),this.inFlightDependencies=[];const K=++this.dependencySentinel;Object.keys(g).length?this.inFlightDependencies.push(pe.send("getGlyphs",{uid:this.uid,stacks:g,source:this.source,tileID:this.tileID,type:"glyphs"},(ft,yt)=>{K===this.dependencySentinel&&(ue||(ue=ft,Se=yt,Zt.call(this)))})):Se={};const ut=Object.keys(Me.iconDependencies);ut.length?this.inFlightDependencies.push(pe.send("getImages",{icons:ut,source:this.source,tileID:this.tileID,type:"icons"},(ft,yt)=>{K===this.dependencySentinel&&(ue||(ue=ft,We=yt,Zt.call(this)))})):We={};const Bt=Object.keys(Me.patternDependencies);function Zt(){if(ue)return ge(ue);if(Se&&We&&et){const ft=new R(Se),yt=new l.bp(We,et);for(const Si in ye){const Lt=ye[Si];Lt instanceof l.a4?(z(Lt.layers,this.zoom,ae),l.bq({bucket:Lt,glyphMap:Se,glyphPositions:ft.positions,imageMap:We,imagePositions:yt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Lt.hasPattern&&(Lt instanceof l.br||Lt instanceof l.bs||Lt instanceof l.bt)&&(z(Lt.layers,this.zoom,ae),Lt.addFeatures(Me,this.tileID.canonical,yt.patternPositions))}this.status="done",ge(null,{buckets:Object.values(ye).filter(Si=>!Si.isEmpty()),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ft.image,imageAtlas:yt,glyphMap:this.returnDependencies?Se:null,iconMap:this.returnDependencies?We:null,glyphPositions:this.returnDependencies?ft.positions:null})}}Bt.length?this.inFlightDependencies.push(pe.send("getImages",{icons:Bt,source:this.source,tileID:this.tileID,type:"patterns"},(ft,yt)=>{K===this.dependencySentinel&&(ue||(ue=ft,et=yt,Zt.call(this)))})):et={},Zt.call(this)}}function z(fe,X,Q){const ae=new l.a8(X);for(const pe of fe)pe.recalculate(ae,Q)}function V(fe,X){const Q=l.l(fe.request,(ae,pe,ge,ke)=>{if(ae)X(ae);else if(pe)try{const Pe=new l.bw.VectorTile(new l.bv(pe));X(null,{vectorTile:Pe,rawData:pe,cacheControl:ge,expires:ke})}catch(Pe){const ye=new Uint8Array(pe);let Me=`Unable to parse the tile at ${fe.request.url}, `;Me+=ye[0]===31&&ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Pe.messge}`,X(new Error(Me))}});return()=>{Q.cancel(),X()}}class q{constructor(X,Q,ae,pe){this.actor=X,this.layerIndex=Q,this.availableImages=ae,this.loadVectorData=pe||V,this.fetching={},this.loading={},this.loaded={}}loadTile(X,Q){const ae=X.uid;this.loading||(this.loading={});const pe=!!(X&&X.request&&X.request.collectResourceTiming)&&new l.bu(X.request),ge=this.loading[ae]=new L(X);ge.abort=this.loadVectorData(X,(ke,Pe)=>{if(delete this.loading[ae],ke||!Pe)return ge.status="done",this.loaded[ae]=ge,Q(ke);const ye=Pe.rawData,Me={};Pe.expires&&(Me.expires=Pe.expires),Pe.cacheControl&&(Me.cacheControl=Pe.cacheControl);const qe={};if(pe){const ue=pe.finish();ue&&(qe.resourceTiming=JSON.parse(JSON.stringify(ue)))}ge.vectorTile=Pe.vectorTile,ge.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,(ue,Se)=>{if(delete this.fetching[ae],ue||!Se)return Q(ue);Q(null,l.e({rawTileData:ye.slice(0)},Se,Me,qe))}),this.loaded=this.loaded||{},this.loaded[ae]=ge,this.fetching[ae]={rawTileData:ye,cacheControl:Me,resourceTiming:qe}})}reloadTile(X,Q){const ae=this.loaded,pe=X.uid;if(ae&&ae[pe]){const ge=ae[pe];ge.showCollisionBoxes=X.showCollisionBoxes,ge.status==="parsing"?ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,(ke,Pe)=>{if(ke||!Pe)return Q(ke,Pe);let ye;if(this.fetching[pe]){const{rawTileData:Me,cacheControl:qe,resourceTiming:ue}=this.fetching[pe];delete this.fetching[pe],ye=l.e({rawTileData:Me.slice(0)},Pe,qe,ue)}else ye=Pe;Q(null,ye)}):ge.status==="done"&&(ge.vectorTile?ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,Q):Q())}}abortTile(X,Q){const ae=this.loading,pe=X.uid;ae&&ae[pe]&&ae[pe].abort&&(ae[pe].abort(),delete ae[pe]),Q()}removeTile(X,Q){const ae=this.loaded,pe=X.uid;ae&&ae[pe]&&delete ae[pe],Q()}}class ne{constructor(){this.loaded={}}loadTile(X,Q){return l._(this,void 0,void 0,function*(){const{uid:ae,encoding:pe,rawImageData:ge,redFactor:ke,greenFactor:Pe,blueFactor:ye,baseShift:Me}=X,qe=ge.width+2,ue=ge.height+2,Se=l.a(ge)?new l.R({width:qe,height:ue},yield l.bx(ge,-1,-1,qe,ue)):ge,We=new l.by(ae,Se,pe,ke,Pe,ye,Me);this.loaded=this.loaded||{},this.loaded[ae]=We,Q(null,We)})}removeTile(X){const Q=this.loaded,ae=X.uid;Q&&Q[ae]&&delete Q[ae]}}function Ae(fe,X){if(fe.length!==0){Ee(fe[0],X);for(var Q=1;Q<fe.length;Q++)Ee(fe[Q],!X)}}function Ee(fe,X){for(var Q=0,ae=0,pe=0,ge=fe.length,ke=ge-1;pe<ge;ke=pe++){var Pe=(fe[pe][0]-fe[ke][0])*(fe[ke][1]+fe[pe][1]),ye=Q+Pe;ae+=Math.abs(Q)>=Math.abs(Pe)?Q-ye+Pe:Pe-ye+Q,Q=ye}Q+ae>=0!=!!X&&fe.reverse()}var Ce=l.bz(function fe(X,Q){var ae,pe=X&&X.type;if(pe==="FeatureCollection")for(ae=0;ae<X.features.length;ae++)fe(X.features[ae],Q);else if(pe==="GeometryCollection")for(ae=0;ae<X.geometries.length;ae++)fe(X.geometries[ae],Q);else if(pe==="Feature")fe(X.geometry,Q);else if(pe==="Polygon")Ae(X.coordinates,Q);else if(pe==="MultiPolygon")for(ae=0;ae<X.coordinates.length;ae++)Ae(X.coordinates[ae],Q);return X});const Le=l.bw.VectorTileFeature.prototype.toGeoJSON;var Oe={exports:{}},Ne=l.bA,Qe=l.bw.VectorTileFeature,Je=xt;function xt(fe,X){this.options=X||{},this.features=fe,this.length=fe.length}function wt(fe,X){this.id=typeof fe.id=="number"?fe.id:void 0,this.type=fe.type,this.rawGeometry=fe.type===1?[fe.geometry]:fe.geometry,this.properties=fe.tags,this.extent=X||4096}xt.prototype.feature=function(fe){return new wt(this.features[fe],this.options.extent)},wt.prototype.loadGeometry=function(){var fe=this.rawGeometry;this.geometry=[];for(var X=0;X<fe.length;X++){for(var Q=fe[X],ae=[],pe=0;pe<Q.length;pe++)ae.push(new Ne(Q[pe][0],Q[pe][1]));this.geometry.push(ae)}return this.geometry},wt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var fe=this.geometry,X=1/0,Q=-1/0,ae=1/0,pe=-1/0,ge=0;ge<fe.length;ge++)for(var ke=fe[ge],Pe=0;Pe<ke.length;Pe++){var ye=ke[Pe];X=Math.min(X,ye.x),Q=Math.max(Q,ye.x),ae=Math.min(ae,ye.y),pe=Math.max(pe,ye.y)}return[X,ae,Q,pe]},wt.prototype.toGeoJSON=Qe.prototype.toGeoJSON;var ct=l.bB,at=Je;function Vt(fe){var X=new ct;return function(Q,ae){for(var pe in Q.layers)ae.writeMessage(3,Ot,Q.layers[pe])}(fe,X),X.finish()}function Ot(fe,X){var Q;X.writeVarintField(15,fe.version||1),X.writeStringField(1,fe.name||""),X.writeVarintField(5,fe.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<fe.length;Q++)ae.feature=fe.feature(Q),X.writeMessage(2,$t,ae);var pe=ae.keys;for(Q=0;Q<pe.length;Q++)X.writeStringField(3,pe[Q]);var ge=ae.values;for(Q=0;Q<ge.length;Q++)X.writeMessage(4,Ks,ge[Q])}function $t(fe,X){var Q=fe.feature;Q.id!==void 0&&X.writeVarintField(1,Q.id),X.writeMessage(2,qt,fe),X.writeVarintField(3,Q.type),X.writeMessage(4,hr,Q)}function qt(fe,X){var Q=fe.feature,ae=fe.keys,pe=fe.values,ge=fe.keycache,ke=fe.valuecache;for(var Pe in Q.properties){var ye=Q.properties[Pe],Me=ge[Pe];if(ye!==null){Me===void 0&&(ae.push(Pe),ge[Pe]=Me=ae.length-1),X.writeVarint(Me);var qe=typeof ye;qe!=="string"&&qe!=="boolean"&&qe!=="number"&&(ye=JSON.stringify(ye));var ue=qe+":"+ye,Se=ke[ue];Se===void 0&&(pe.push(ye),ke[ue]=Se=pe.length-1),X.writeVarint(Se)}}}function gi(fe,X){return(X<<3)+(7&fe)}function Nr(fe){return fe<<1^fe>>31}function hr(fe,X){for(var Q=fe.loadGeometry(),ae=fe.type,pe=0,ge=0,ke=Q.length,Pe=0;Pe<ke;Pe++){var ye=Q[Pe],Me=1;ae===1&&(Me=ye.length),X.writeVarint(gi(1,Me));for(var qe=ae===3?ye.length-1:ye.length,ue=0;ue<qe;ue++){ue===1&&ae!==1&&X.writeVarint(gi(2,qe-1));var Se=ye[ue].x-pe,We=ye[ue].y-ge;X.writeVarint(Nr(Se)),X.writeVarint(Nr(We)),pe+=Se,ge+=We}ae===3&&X.writeVarint(gi(7,1))}}function Ks(fe,X){var Q=typeof fe;Q==="string"?X.writeStringField(1,fe):Q==="boolean"?X.writeBooleanField(7,fe):Q==="number"&&(fe%1!=0?X.writeDoubleField(3,fe):fe<0?X.writeSVarintField(6,fe):X.writeVarintField(5,fe))}Oe.exports=Vt,Oe.exports.fromVectorTileJs=Vt,Oe.exports.fromGeojsonVt=function(fe,X){X=X||{};var Q={};for(var ae in fe)Q[ae]=new at(fe[ae].features,X),Q[ae].name=ae,Q[ae].version=X.version,Q[ae].extent=X.extent;return Vt({layers:Q})},Oe.exports.GeoJSONWrapper=at;var Cn=l.bz(Oe.exports);const qn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:fe=>fe},Pn=Math.fround||(ur=new Float32Array(1),fe=>(ur[0]=+fe,ur[0]));var ur;const Ei=3,_r=5,ln=6;class cn{constructor(X){this.options=Object.assign(Object.create(qn),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:Q,minZoom:ae,maxZoom:pe}=this.options;Q&&console.time("total time");const ge=`prepare ${X.length} points`;Q&&console.time(ge),this.points=X;const ke=[];for(let ye=0;ye<X.length;ye++){const Me=X[ye];if(!Me.geometry)continue;const[qe,ue]=Me.geometry.coordinates,Se=Pn(yi(qe)),We=Pn(ki(ue));ke.push(Se,We,1/0,ye,-1,1),this.options.reduce&&ke.push(0)}let Pe=this.trees[pe+1]=this._createTree(ke);Q&&console.timeEnd(ge);for(let ye=pe;ye>=ae;ye--){const Me=+Date.now();Pe=this.trees[ye]=this._createTree(this._cluster(Pe,ye)),Q&&console.log("z%d: %d clusters in %dms",ye,Pe.numItems,+Date.now()-Me)}return Q&&console.timeEnd("total time"),this}getClusters(X,Q){let ae=((X[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,X[1]));let ge=X[2]===180?180:((X[2]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)ae=-180,ge=180;else if(ae>ge){const ue=this.getClusters([ae,pe,180,ke],Q),Se=this.getClusters([-180,pe,ge,ke],Q);return ue.concat(Se)}const Pe=this.trees[this._limitZoom(Q)],ye=Pe.range(yi(ae),ki(ke),yi(ge),ki(pe)),Me=Pe.data,qe=[];for(const ue of ye){const Se=this.stride*ue;qe.push(Me[Se+_r]>1?Qi(Me,Se,this.clusterProps):this.points[Me[Se+Ei]])}return qe}getChildren(X){const Q=this._getOriginId(X),ae=this._getOriginZoom(X),pe="No cluster with the specified id.",ge=this.trees[ae];if(!ge)throw new Error(pe);const ke=ge.data;if(Q*this.stride>=ke.length)throw new Error(pe);const Pe=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),ye=ge.within(ke[Q*this.stride],ke[Q*this.stride+1],Pe),Me=[];for(const qe of ye){const ue=qe*this.stride;ke[ue+4]===X&&Me.push(ke[ue+_r]>1?Qi(ke,ue,this.clusterProps):this.points[ke[ue+Ei]])}if(Me.length===0)throw new Error(pe);return Me}getLeaves(X,Q,ae){const pe=[];return this._appendLeaves(pe,X,Q=Q||10,ae=ae||0,0),pe}getTile(X,Q,ae){const pe=this.trees[this._limitZoom(X)],ge=Math.pow(2,X),{extent:ke,radius:Pe}=this.options,ye=Pe/ke,Me=(ae-ye)/ge,qe=(ae+1+ye)/ge,ue={features:[]};return this._addTileFeatures(pe.range((Q-ye)/ge,Me,(Q+1+ye)/ge,qe),pe.data,Q,ae,ge,ue),Q===0&&this._addTileFeatures(pe.range(1-ye/ge,Me,1,qe),pe.data,ge,ae,ge,ue),Q===ge-1&&this._addTileFeatures(pe.range(0,Me,ye/ge,qe),pe.data,-1,ae,ge,ue),ue.features.length?ue:null}getClusterExpansionZoom(X){let Q=this._getOriginZoom(X)-1;for(;Q<=this.options.maxZoom;){const ae=this.getChildren(X);if(Q++,ae.length!==1)break;X=ae[0].properties.cluster_id}return Q}_appendLeaves(X,Q,ae,pe,ge){const ke=this.getChildren(Q);for(const Pe of ke){const ye=Pe.properties;if(ye&&ye.cluster?ge+ye.point_count<=pe?ge+=ye.point_count:ge=this._appendLeaves(X,ye.cluster_id,ae,pe,ge):ge<pe?ge++:X.push(Pe),X.length===ae)break}return ge}_createTree(X){const Q=new l.av(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ae=0;ae<X.length;ae+=this.stride)Q.add(X[ae],X[ae+1]);return Q.finish(),Q.data=X,Q}_addTileFeatures(X,Q,ae,pe,ge,ke){for(const Pe of X){const ye=Pe*this.stride,Me=Q[ye+_r]>1;let qe,ue,Se;if(Me)qe=Dr(Q,ye,this.clusterProps),ue=Q[ye],Se=Q[ye+1];else{const g=this.points[Q[ye+Ei]];qe=g.properties;const[K,ut]=g.geometry.coordinates;ue=yi(K),Se=ki(ut)}const We={type:1,geometry:[[Math.round(this.options.extent*(ue*ge-ae)),Math.round(this.options.extent*(Se*ge-pe))]],tags:qe};let et;et=Me||this.options.generateId?Q[ye+Ei]:this.points[Q[ye+Ei]].id,et!==void 0&&(We.id=et),ke.features.push(We)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,Q){const{radius:ae,extent:pe,reduce:ge,minPoints:ke}=this.options,Pe=ae/(pe*Math.pow(2,Q)),ye=X.data,Me=[],qe=this.stride;for(let ue=0;ue<ye.length;ue+=qe){if(ye[ue+2]<=Q)continue;ye[ue+2]=Q;const Se=ye[ue],We=ye[ue+1],et=X.within(ye[ue],ye[ue+1],Pe),g=ye[ue+_r];let K=g;for(const ut of et){const Bt=ut*qe;ye[Bt+2]>Q&&(K+=ye[Bt+_r])}if(K>g&&K>=ke){let ut,Bt=Se*g,Zt=We*g,ft=-1;const yt=((ue/qe|0)<<5)+(Q+1)+this.points.length;for(const Si of et){const Lt=Si*qe;if(ye[Lt+2]<=Q)continue;ye[Lt+2]=Q;const Rt=ye[Lt+_r];Bt+=ye[Lt]*Rt,Zt+=ye[Lt+1]*Rt,ye[Lt+4]=yt,ge&&(ut||(ut=this._map(ye,ue,!0),ft=this.clusterProps.length,this.clusterProps.push(ut)),ge(ut,this._map(ye,Lt)))}ye[ue+4]=yt,Me.push(Bt/K,Zt/K,1/0,yt,-1,K),ge&&Me.push(ft)}else{for(let ut=0;ut<qe;ut++)Me.push(ye[ue+ut]);if(K>1)for(const ut of et){const Bt=ut*qe;if(!(ye[Bt+2]<=Q)){ye[Bt+2]=Q;for(let Zt=0;Zt<qe;Zt++)Me.push(ye[Bt+Zt])}}}}return Me}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,Q,ae){if(X[Q+_r]>1){const ke=this.clusterProps[X[Q+ln]];return ae?Object.assign({},ke):ke}const pe=this.points[X[Q+Ei]].properties,ge=this.options.map(pe);return ae&&ge===pe?Object.assign({},ge):ge}}function Qi(fe,X,Q){return{type:"Feature",id:fe[X+Ei],properties:Dr(fe,X,Q),geometry:{type:"Point",coordinates:[(ae=fe[X],360*(ae-.5)),Js(fe[X+1])]}};var ae}function Dr(fe,X,Q){const ae=fe[X+_r],pe=ae>=1e4?`${Math.round(ae/1e3)}k`:ae>=1e3?Math.round(ae/100)/10+"k":ae,ge=fe[X+ln],ke=ge===-1?{}:Object.assign({},Q[ge]);return Object.assign(ke,{cluster:!0,cluster_id:fe[X+Ei],point_count:ae,point_count_abbreviated:pe})}function yi(fe){return fe/360+.5}function ki(fe){const X=Math.sin(fe*Math.PI/180),Q=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Q<0?0:Q>1?1:Q}function Js(fe){const X=(180-360*fe)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function Xr(fe,X,Q,ae){for(var pe,ge=ae,ke=Q-X>>1,Pe=Q-X,ye=fe[X],Me=fe[X+1],qe=fe[Q],ue=fe[Q+1],Se=X+3;Se<Q;Se+=3){var We=Ls(fe[Se],fe[Se+1],ye,Me,qe,ue);if(We>ge)pe=Se,ge=We;else if(We===ge){var et=Math.abs(Se-ke);et<Pe&&(pe=Se,Pe=et)}}ge>ae&&(pe-X>3&&Xr(fe,X,pe,ae),fe[pe+2]=ge,Q-pe>3&&Xr(fe,pe,Q,ae))}function Ls(fe,X,Q,ae,pe,ge){var ke=pe-Q,Pe=ge-ae;if(ke!==0||Pe!==0){var ye=((fe-Q)*ke+(X-ae)*Pe)/(ke*ke+Pe*Pe);ye>1?(Q=pe,ae=ge):ye>0&&(Q+=ke*ye,ae+=Pe*ye)}return(ke=fe-Q)*ke+(Pe=X-ae)*Pe}function zr(fe,X,Q,ae){var pe={id:fe===void 0?null:fe,type:X,geometry:Q,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var ke=ge.geometry,Pe=ge.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")ms(ge,ke);else if(Pe==="Polygon"||Pe==="MultiLineString")for(var ye=0;ye<ke.length;ye++)ms(ge,ke[ye]);else if(Pe==="MultiPolygon")for(ye=0;ye<ke.length;ye++)for(var Me=0;Me<ke[ye].length;Me++)ms(ge,ke[ye][Me])}(pe),pe}function ms(fe,X){for(var Q=0;Q<X.length;Q+=3)fe.minX=Math.min(fe.minX,X[Q]),fe.minY=Math.min(fe.minY,X[Q+1]),fe.maxX=Math.max(fe.maxX,X[Q]),fe.maxY=Math.max(fe.maxY,X[Q+1])}function mr(fe,X,Q,ae){if(X.geometry){var pe=X.geometry.coordinates,ge=X.geometry.type,ke=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),Pe=[],ye=X.id;if(Q.promoteId?ye=X.properties[Q.promoteId]:Q.generateId&&(ye=ae||0),ge==="Point")Ki(pe,Pe);else if(ge==="MultiPoint")for(var Me=0;Me<pe.length;Me++)Ki(pe[Me],Pe);else if(ge==="LineString")Ur(pe,Pe,ke,!1);else if(ge==="MultiLineString"){if(Q.lineMetrics){for(Me=0;Me<pe.length;Me++)Ur(pe[Me],Pe=[],ke,!1),fe.push(zr(ye,"LineString",Pe,X.properties));return}en(pe,Pe,ke,!1)}else if(ge==="Polygon")en(pe,Pe,ke,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(Me=0;Me<X.geometry.geometries.length;Me++)mr(fe,{id:ye,geometry:X.geometry.geometries[Me],properties:X.properties},Q,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Me=0;Me<pe.length;Me++){var qe=[];en(pe[Me],qe,ke,!0),Pe.push(qe)}}fe.push(zr(ye,ge,Pe,X.properties))}}function Ki(fe,X){X.push(Xe(fe[0])),X.push(_i(fe[1])),X.push(0)}function Ur(fe,X,Q,ae){for(var pe,ge,ke=0,Pe=0;Pe<fe.length;Pe++){var ye=Xe(fe[Pe][0]),Me=_i(fe[Pe][1]);X.push(ye),X.push(Me),X.push(0),Pe>0&&(ke+=ae?(pe*Me-ye*ge)/2:Math.sqrt(Math.pow(ye-pe,2)+Math.pow(Me-ge,2))),pe=ye,ge=Me}var qe=X.length-3;X[2]=1,Xr(X,0,qe,Q),X[qe+2]=1,X.size=Math.abs(ke),X.start=0,X.end=X.size}function en(fe,X,Q,ae){for(var pe=0;pe<fe.length;pe++){var ge=[];Ur(fe[pe],ge,Q,ae),X.push(ge)}}function Xe(fe){return fe/360+.5}function _i(fe){var X=Math.sin(fe*Math.PI/180),Q=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Q<0?0:Q>1?1:Q}function Br(fe,X,Q,ae,pe,ge,ke,Pe){if(ae/=X,ge>=(Q/=X)&&ke<ae)return fe;if(ke<Q||ge>=ae)return null;for(var ye=[],Me=0;Me<fe.length;Me++){var qe=fe[Me],ue=qe.geometry,Se=qe.type,We=pe===0?qe.minX:qe.minY,et=pe===0?qe.maxX:qe.maxY;if(We>=Q&&et<ae)ye.push(qe);else if(!(et<Q||We>=ae)){var g=[];if(Se==="Point"||Se==="MultiPoint")vi(ue,g,Q,ae,pe);else if(Se==="LineString")oi(ue,g,Q,ae,pe,!1,Pe.lineMetrics);else if(Se==="MultiLineString")In(ue,g,Q,ae,pe,!1);else if(Se==="Polygon")In(ue,g,Q,ae,pe,!0);else if(Se==="MultiPolygon")for(var K=0;K<ue.length;K++){var ut=[];In(ue[K],ut,Q,ae,pe,!0),ut.length&&g.push(ut)}if(g.length){if(Pe.lineMetrics&&Se==="LineString"){for(K=0;K<g.length;K++)ye.push(zr(qe.id,Se,g[K],qe.tags));continue}Se!=="LineString"&&Se!=="MultiLineString"||(g.length===1?(Se="LineString",g=g[0]):Se="MultiLineString"),Se!=="Point"&&Se!=="MultiPoint"||(Se=g.length===3?"Point":"MultiPoint"),ye.push(zr(qe.id,Se,g,qe.tags))}}}return ye.length?ye:null}function vi(fe,X,Q,ae,pe){for(var ge=0;ge<fe.length;ge+=3){var ke=fe[ge+pe];ke>=Q&&ke<=ae&&(X.push(fe[ge]),X.push(fe[ge+1]),X.push(fe[ge+2]))}}function oi(fe,X,Q,ae,pe,ge,ke){for(var Pe,ye,Me=Zr(fe),qe=pe===0?Mn:tn,ue=fe.start,Se=0;Se<fe.length-3;Se+=3){var We=fe[Se],et=fe[Se+1],g=fe[Se+2],K=fe[Se+3],ut=fe[Se+4],Bt=pe===0?We:et,Zt=pe===0?K:ut,ft=!1;ke&&(Pe=Math.sqrt(Math.pow(We-K,2)+Math.pow(et-ut,2))),Bt<Q?Zt>Q&&(ye=qe(Me,We,et,K,ut,Q),ke&&(Me.start=ue+Pe*ye)):Bt>ae?Zt<ae&&(ye=qe(Me,We,et,K,ut,ae),ke&&(Me.start=ue+Pe*ye)):ys(Me,We,et,g),Zt<Q&&Bt>=Q&&(ye=qe(Me,We,et,K,ut,Q),ft=!0),Zt>ae&&Bt<=ae&&(ye=qe(Me,We,et,K,ut,ae),ft=!0),!ge&&ft&&(ke&&(Me.end=ue+Pe*ye),X.push(Me),Me=Zr(fe)),ke&&(ue+=Pe)}var yt=fe.length-3;We=fe[yt],et=fe[yt+1],g=fe[yt+2],(Bt=pe===0?We:et)>=Q&&Bt<=ae&&ys(Me,We,et,g),yt=Me.length-3,ge&&yt>=3&&(Me[yt]!==Me[0]||Me[yt+1]!==Me[1])&&ys(Me,Me[0],Me[1],Me[2]),Me.length&&X.push(Me)}function Zr(fe){var X=[];return X.size=fe.size,X.start=fe.start,X.end=fe.end,X}function In(fe,X,Q,ae,pe,ge){for(var ke=0;ke<fe.length;ke++)oi(fe[ke],X,Q,ae,pe,ge,!1)}function ys(fe,X,Q,ae){fe.push(X),fe.push(Q),fe.push(ae)}function Mn(fe,X,Q,ae,pe,ge){var ke=(ge-X)/(ae-X);return fe.push(ge),fe.push(Q+(pe-Q)*ke),fe.push(1),ke}function tn(fe,X,Q,ae,pe,ge){var ke=(ge-Q)/(pe-Q);return fe.push(X+(ae-X)*ke),fe.push(ge),fe.push(1),ke}function Ns(fe,X){for(var Q=[],ae=0;ae<fe.length;ae++){var pe,ge=fe[ae],ke=ge.type;if(ke==="Point"||ke==="MultiPoint"||ke==="LineString")pe=bs(ge.geometry,X);else if(ke==="MultiLineString"||ke==="Polygon"){pe=[];for(var Pe=0;Pe<ge.geometry.length;Pe++)pe.push(bs(ge.geometry[Pe],X))}else if(ke==="MultiPolygon")for(pe=[],Pe=0;Pe<ge.geometry.length;Pe++){for(var ye=[],Me=0;Me<ge.geometry[Pe].length;Me++)ye.push(bs(ge.geometry[Pe][Me],X));pe.push(ye)}Q.push(zr(ge.id,ke,pe,ge.tags))}return Q}function bs(fe,X){var Q=[];Q.size=fe.size,fe.start!==void 0&&(Q.start=fe.start,Q.end=fe.end);for(var ae=0;ae<fe.length;ae+=3)Q.push(fe[ae]+X,fe[ae+1],fe[ae+2]);return Q}function st(fe,X){if(fe.transformed)return fe;var Q,ae,pe,ge=1<<fe.z,ke=fe.x,Pe=fe.y;for(Q=0;Q<fe.features.length;Q++){var ye=fe.features[Q],Me=ye.geometry,qe=ye.type;if(ye.geometry=[],qe===1)for(ae=0;ae<Me.length;ae+=2)ye.geometry.push(vs(Me[ae],Me[ae+1],X,ge,ke,Pe));else for(ae=0;ae<Me.length;ae++){var ue=[];for(pe=0;pe<Me[ae].length;pe+=2)ue.push(vs(Me[ae][pe],Me[ae][pe+1],X,ge,ke,Pe));ye.geometry.push(ue)}}return fe.transformed=!0,fe}function vs(fe,X,Q,ae,pe,ge){return[Math.round(Q*(fe*ae-pe)),Math.round(Q*(X*ae-ge))]}function Ui(fe,X,Q,ae,pe){for(var ge=X===pe.maxZoom?0:pe.tolerance/((1<<X)*pe.extent),ke={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Q,y:ae,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Pe=0;Pe<fe.length;Pe++){ke.numFeatures++,hn(ke,fe[Pe],ge,pe);var ye=fe[Pe].minX,Me=fe[Pe].minY,qe=fe[Pe].maxX,ue=fe[Pe].maxY;ye<ke.minX&&(ke.minX=ye),Me<ke.minY&&(ke.minY=Me),qe>ke.maxX&&(ke.maxX=qe),ue>ke.maxY&&(ke.maxY=ue)}return ke}function hn(fe,X,Q,ae){var pe=X.geometry,ge=X.type,ke=[];if(ge==="Point"||ge==="MultiPoint")for(var Pe=0;Pe<pe.length;Pe+=3)ke.push(pe[Pe]),ke.push(pe[Pe+1]),fe.numPoints++,fe.numSimplified++;else if(ge==="LineString")xs(ke,pe,fe,Q,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(Pe=0;Pe<pe.length;Pe++)xs(ke,pe[Pe],fe,Q,ge==="Polygon",Pe===0);else if(ge==="MultiPolygon")for(var ye=0;ye<pe.length;ye++){var Me=pe[ye];for(Pe=0;Pe<Me.length;Pe++)xs(ke,Me[Pe],fe,Q,!0,Pe===0)}if(ke.length){var qe=X.tags||null;if(ge==="LineString"&&ae.lineMetrics){for(var ue in qe={},X.tags)qe[ue]=X.tags[ue];qe.mapbox_clip_start=pe.start/pe.size,qe.mapbox_clip_end=pe.end/pe.size}var Se={geometry:ke,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:qe};X.id!==null&&(Se.id=X.id),fe.features.push(Se)}}function xs(fe,X,Q,ae,pe,ge){var ke=ae*ae;if(ae>0&&X.size<(pe?ke:ae))Q.numPoints+=X.length/3;else{for(var Pe=[],ye=0;ye<X.length;ye+=3)(ae===0||X[ye+2]>ke)&&(Q.numSimplified++,Pe.push(X[ye]),Pe.push(X[ye+1])),Q.numPoints++;pe&&function(Me,qe){for(var ue=0,Se=0,We=Me.length,et=We-2;Se<We;et=Se,Se+=2)ue+=(Me[Se]-Me[et])*(Me[Se+1]+Me[et+1]);if(ue>0===qe)for(Se=0,We=Me.length;Se<We/2;Se+=2){var g=Me[Se],K=Me[Se+1];Me[Se]=Me[We-2-Se],Me[Se+1]=Me[We-1-Se],Me[We-2-Se]=g,Me[We-1-Se]=K}}(Pe,ge),fe.push(Pe)}}function nt(fe,X){var Q=(X=this.options=function(pe,ge){for(var ke in ge)pe[ke]=ge[ke];return pe}(Object.create(this.options),X)).debug;if(Q&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var ae=function(pe,ge){var ke=[];if(pe.type==="FeatureCollection")for(var Pe=0;Pe<pe.features.length;Pe++)mr(ke,pe.features[Pe],ge,Pe);else mr(ke,pe.type==="Feature"?pe:{geometry:pe},ge);return ke}(fe,X);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=function(pe,ge){var ke=ge.buffer/ge.extent,Pe=pe,ye=Br(pe,1,-1-ke,ke,0,-1,2,ge),Me=Br(pe,1,1-ke,2+ke,0,-1,2,ge);return(ye||Me)&&(Pe=Br(pe,1,-ke,1+ke,0,-1,2,ge)||[],ye&&(Pe=Ns(ye,1).concat(Pe)),Me&&(Pe=Pe.concat(Ns(Me,-1)))),Pe}(ae,X),ae.length&&this.splitTile(ae,0,0,0),Q&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Yt(fe,X,Q){return 32*((1<<fe)*Q+X)+fe}function Xt(fe,X){return X?fe.properties[X]:fe.id}function Ar(fe,X){if(fe==null)return!0;if(fe.type==="Feature")return Xt(fe,X)!=null;if(fe.type==="FeatureCollection"){const Q=new Set;for(const ae of fe.features){const pe=Xt(ae,X);if(pe==null||Q.has(pe))return!1;Q.add(pe)}return!0}return!1}function ns(fe,X){const Q=new Map;if(fe!=null)if(fe.type==="Feature")Q.set(Xt(fe,X),fe);else for(const ae of fe.features)Q.set(Xt(ae,X),ae);return Q}nt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},nt.prototype.splitTile=function(fe,X,Q,ae,pe,ge,ke){for(var Pe=[fe,X,Q,ae],ye=this.options,Me=ye.debug;Pe.length;){ae=Pe.pop(),Q=Pe.pop(),X=Pe.pop(),fe=Pe.pop();var qe=1<<X,ue=Yt(X,Q,ae),Se=this.tiles[ue];if(!Se&&(Me>1&&console.time("creation"),Se=this.tiles[ue]=Ui(fe,X,Q,ae,ye),this.tileCoords.push({z:X,x:Q,y:ae}),Me)){Me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,Q,ae,Se.numFeatures,Se.numPoints,Se.numSimplified),console.timeEnd("creation"));var We="z"+X;this.stats[We]=(this.stats[We]||0)+1,this.total++}if(Se.source=fe,pe){if(X===ye.maxZoom||X===pe)continue;var et=1<<pe-X;if(Q!==Math.floor(ge/et)||ae!==Math.floor(ke/et))continue}else if(X===ye.indexMaxZoom||Se.numPoints<=ye.indexMaxPoints)continue;if(Se.source=null,fe.length!==0){Me>1&&console.time("clipping");var g,K,ut,Bt,Zt,ft,yt=.5*ye.buffer/ye.extent,Si=.5-yt,Lt=.5+yt,Rt=1+yt;g=K=ut=Bt=null,Zt=Br(fe,qe,Q-yt,Q+Lt,0,Se.minX,Se.maxX,ye),ft=Br(fe,qe,Q+Si,Q+Rt,0,Se.minX,Se.maxX,ye),fe=null,Zt&&(g=Br(Zt,qe,ae-yt,ae+Lt,1,Se.minY,Se.maxY,ye),K=Br(Zt,qe,ae+Si,ae+Rt,1,Se.minY,Se.maxY,ye),Zt=null),ft&&(ut=Br(ft,qe,ae-yt,ae+Lt,1,Se.minY,Se.maxY,ye),Bt=Br(ft,qe,ae+Si,ae+Rt,1,Se.minY,Se.maxY,ye),ft=null),Me>1&&console.timeEnd("clipping"),Pe.push(g||[],X+1,2*Q,2*ae),Pe.push(K||[],X+1,2*Q,2*ae+1),Pe.push(ut||[],X+1,2*Q+1,2*ae),Pe.push(Bt||[],X+1,2*Q+1,2*ae+1)}}},nt.prototype.getTile=function(fe,X,Q){var ae=this.options,pe=ae.extent,ge=ae.debug;if(fe<0||fe>24)return null;var ke=1<<fe,Pe=Yt(fe,X=(X%ke+ke)%ke,Q);if(this.tiles[Pe])return st(this.tiles[Pe],pe);ge>1&&console.log("drilling down to z%d-%d-%d",fe,X,Q);for(var ye,Me=fe,qe=X,ue=Q;!ye&&Me>0;)Me--,qe=Math.floor(qe/2),ue=Math.floor(ue/2),ye=this.tiles[Yt(Me,qe,ue)];return ye&&ye.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Me,qe,ue),ge>1&&console.time("drilling down"),this.splitTile(ye.source,Me,qe,ue,fe,X,Q),ge>1&&console.timeEnd("drilling down"),this.tiles[Pe]?st(this.tiles[Pe],pe):null):null};class Gt extends q{constructor(X,Q,ae,pe){super(X,Q,ae),this._dataUpdateable=new Map,this.loadGeoJSON=(ge,ke)=>{const{promoteId:Pe}=ge;if(ge.request)return l.f(ge.request,(ye,Me,qe,ue)=>{this._dataUpdateable=Ar(Me,Pe)?ns(Me,Pe):void 0,ke(ye,Me,qe,ue)});if(typeof ge.data=="string")try{const ye=JSON.parse(ge.data);this._dataUpdateable=Ar(ye,Pe)?ns(ye,Pe):void 0,ke(null,ye)}catch{ke(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`))}else ge.dataDiff?this._dataUpdateable?(function(ye,Me,qe){var ue,Se,We,et;if(Me.removeAll&&ye.clear(),Me.remove)for(const g of Me.remove)ye.delete(g);if(Me.add)for(const g of Me.add){const K=Xt(g,qe);K!=null&&ye.set(K,g)}if(Me.update)for(const g of Me.update){let K=ye.get(g.id);if(K==null)continue;const ut=!g.removeAllProperties&&(((ue=g.removeProperties)===null||ue===void 0?void 0:ue.length)>0||((Se=g.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((g.newGeometry||g.removeAllProperties||ut)&&(K=Object.assign({},K),ye.set(g.id,K),ut&&(K.properties=Object.assign({},K.properties))),g.newGeometry&&(K.geometry=g.newGeometry),g.removeAllProperties)K.properties={};else if(((We=g.removeProperties)===null||We===void 0?void 0:We.length)>0)for(const Bt of g.removeProperties)Object.prototype.hasOwnProperty.call(K.properties,Bt)&&delete K.properties[Bt];if(((et=g.addOrUpdateProperties)===null||et===void 0?void 0:et.length)>0)for(const{key:Bt,value:Zt}of g.addOrUpdateProperties)K.properties[Bt]=Zt}}(this._dataUpdateable,ge.dataDiff,Pe),ke(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ke(new Error(`Cannot update existing geojson data in ${ge.source}`)):ke(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,pe&&(this.loadGeoJSON=pe)}loadGeoJSONTile(X,Q){const ae=X.tileID.canonical;if(!this._geoJSONIndex)return Q(null,null);const pe=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!pe)return Q(null,null);const ge=new class{constructor(Pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.N,this.length=Pe.length,this._features=Pe}feature(Pe){return new class{constructor(ye){this._feature=ye,this.extent=l.N,this.type=ye.type,this.properties=ye.tags,"id"in ye&&!isNaN(ye.id)&&(this.id=parseInt(ye.id,10))}loadGeometry(){if(this._feature.type===1){const ye=[];for(const Me of this._feature.geometry)ye.push([new l.P(Me[0],Me[1])]);return ye}{const ye=[];for(const Me of this._feature.geometry){const qe=[];for(const ue of Me)qe.push(new l.P(ue[0],ue[1]));ye.push(qe)}return ye}}toGeoJSON(ye,Me,qe){return Le.call(this,ye,Me,qe)}}(this._features[Pe])}}(pe.features);let ke=Cn(ge);ke.byteOffset===0&&ke.byteLength===ke.buffer.byteLength||(ke=new Uint8Array(ke)),Q(null,{vectorTile:ge,rawData:ke.buffer})}loadData(X,Q){var ae;(ae=this._pendingRequest)===null||ae===void 0||ae.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const pe=!!(X&&X.request&&X.request.collectResourceTiming)&&new l.bu(X.request);this._pendingCallback=Q,this._pendingRequest=this.loadGeoJSON(X,(ge,ke)=>{if(delete this._pendingCallback,delete this._pendingRequest,ge||!ke)return Q(ge);if(typeof ke!="object")return Q(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{Ce(ke,!0);try{if(X.filter){const ye=l.bC(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(qe=>`${qe.key}: ${qe.message}`).join(", "));ke={type:"FeatureCollection",features:ke.features.filter(qe=>ye.value.evaluate({zoom:0},qe))}}this._geoJSONIndex=X.cluster?new cn(function({superclusterOptions:ye,clusterProperties:Me}){if(!Me||!ye)return ye;const qe={},ue={},Se={accumulated:null,zoom:0},We={properties:null},et=Object.keys(Me);for(const g of et){const[K,ut]=Me[g],Bt=l.bC(ut),Zt=l.bC(typeof K=="string"?[K,["accumulated"],["get",g]]:K);qe[g]=Bt.value,ue[g]=Zt.value}return ye.map=g=>{We.properties=g;const K={};for(const ut of et)K[ut]=qe[ut].evaluate(Se,We);return K},ye.reduce=(g,K)=>{We.properties=K;for(const ut of et)Se.accumulated=g[ut],g[ut]=ue[ut].evaluate(Se,We)},ye}(X)).load(ke.features):function(ye,Me){return new nt(ye,Me)}(ke,X.geojsonVtOptions)}catch(ye){return Q(ye)}this.loaded={};const Pe={};if(pe){const ye=pe.finish();ye&&(Pe.resourceTiming={},Pe.resourceTiming[X.source]=JSON.parse(JSON.stringify(ye)))}Q(null,Pe)}})}reloadTile(X,Q){const ae=this.loaded;return ae&&ae[X.uid]?super.reloadTile(X,Q):this.loadTile(X,Q)}removeSource(X,Q){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Q()}getClusterExpansionZoom(X,Q){try{Q(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(ae){Q(ae)}}getClusterChildren(X,Q){try{Q(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(ae){Q(ae)}}getClusterLeaves(X,Q){try{Q(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(ae){Q(ae)}}}class Ke{constructor(X){this.self=X,this.actor=new l.C(X,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:q,geojson:Gt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Q,ae)=>{if(this.workerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.workerSourceTypes[Q]=ae},this.self.registerRTLTextPlugin=Q=>{if(l.bD.isParsed())throw new Error("RTL text plugin already registered.");l.bD.applyArabicShaping=Q.applyArabicShaping,l.bD.processBidirectionalText=Q.processBidirectionalText,l.bD.processStyledBidirectionalText=Q.processStyledBidirectionalText}}setReferrer(X,Q){this.referrer=Q}setImages(X,Q,ae){this.availableImages[X]=Q;for(const pe in this.workerSources[X]){const ge=this.workerSources[X][pe];for(const ke in ge)ge[ke].availableImages=Q}ae()}setLayers(X,Q,ae){this.getLayerIndex(X).replace(Q),ae()}updateLayers(X,Q,ae){this.getLayerIndex(X).update(Q.layers,Q.removedIds),ae()}loadTile(X,Q,ae){this.getWorkerSource(X,Q.type,Q.source).loadTile(Q,ae)}loadDEMTile(X,Q,ae){this.getDEMWorkerSource(X,Q.source).loadTile(Q,ae)}reloadTile(X,Q,ae){this.getWorkerSource(X,Q.type,Q.source).reloadTile(Q,ae)}abortTile(X,Q,ae){this.getWorkerSource(X,Q.type,Q.source).abortTile(Q,ae)}removeTile(X,Q,ae){this.getWorkerSource(X,Q.type,Q.source).removeTile(Q,ae)}removeDEMTile(X,Q){this.getDEMWorkerSource(X,Q.source).removeTile(Q)}removeSource(X,Q,ae){if(!this.workerSources[X]||!this.workerSources[X][Q.type]||!this.workerSources[X][Q.type][Q.source])return;const pe=this.workerSources[X][Q.type][Q.source];delete this.workerSources[X][Q.type][Q.source],pe.removeSource!==void 0?pe.removeSource(Q,ae):ae()}loadWorkerSource(X,Q,ae){try{this.self.importScripts(Q.url),ae()}catch(pe){ae(pe.toString())}}syncRTLPluginState(X,Q,ae){try{l.bD.setState(Q);const pe=l.bD.getPluginURL();if(l.bD.isLoaded()&&!l.bD.isParsed()&&pe!=null){this.self.importScripts(pe);const ge=l.bD.isParsed();ae(ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${pe}`),ge)}}catch(pe){ae(pe.toString())}}getAvailableImages(X){let Q=this.availableImages[X];return Q||(Q=[]),Q}getLayerIndex(X){let Q=this.layerIndexes[X];return Q||(Q=this.layerIndexes[X]=new I),Q}getWorkerSource(X,Q,ae){return this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][Q]||(this.workerSources[X][Q]={}),this.workerSources[X][Q][ae]||(this.workerSources[X][Q][ae]=new this.workerSourceTypes[Q]({send:(pe,ge,ke)=>{this.actor.send(pe,ge,ke,X)}},this.getLayerIndex(X),this.getAvailableImages(X))),this.workerSources[X][Q][ae]}getDEMWorkerSource(X,Q){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][Q]||(this.demWorkerSources[X][Q]=new ne),this.demWorkerSources[X][Q]}}return l.i()&&(self.worker=new Ke(self)),Ke}),u(["./shared"],function(l){var I="3.6.2";class R{static testProp(n){if(!R.docStyle)return n[0];for(let d=0;d<n.length;d++)if(n[d]in R.docStyle)return n[d];return n[0]}static create(n,d,v){const w=window.document.createElement(n);return d!==void 0&&(w.className=d),v&&v.appendChild(w),w}static createNS(n,d){return window.document.createElementNS(n,d)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(n,d){n.style[R.transformProp]=d}static addEventListener(n,d,v,w={}){n.addEventListener(d,v,"passive"in w?w:w.capture)}static removeEventListener(n,d,v,w={}){n.removeEventListener(d,v,"passive"in w?w:w.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static mousePos(n,d){const v=n.getBoundingClientRect();return new l.P(d.clientX-v.left-n.clientLeft,d.clientY-v.top-n.clientTop)}static touchPos(n,d){const v=n.getBoundingClientRect(),w=[];for(let C=0;C<d.length;C++)w.push(new l.P(d[C].clientX-v.left-n.clientLeft,d[C].clientY-v.top-n.clientTop));return w}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);const L={supported:!1,testSupport:function(E){!q&&V&&(ne?Ae(E):z=E)}};let z,V,q=!1,ne=!1;function Ae(E){const n=E.createTexture();E.bindTexture(E.TEXTURE_2D,n);try{if(E.texImage2D(E.TEXTURE_2D,0,E.RGBA,E.RGBA,E.UNSIGNED_BYTE,V),E.isContextLost())return;L.supported=!0}catch{}E.deleteTexture(n),q=!0}var Ee,Ce;typeof document<"u"&&(V=document.createElement("img"),V.onload=function(){z&&Ae(z),z=null,ne=!0},V.onerror=function(){q=!0,z=null},V.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(E){let n,d,v,w;E.resetRequestQueue=()=>{n=[],d=0,v=0,w={}},E.addThrottleControl=A=>{const p=v++;return w[p]=A,p},E.removeThrottleControl=A=>{delete w[A],a()},E.getImage=(A,p,y=!0)=>{L.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*");const b={requestParameters:A,supportImageRefresh:y,callback:p,cancelled:!1,completed:!1,cancel:()=>{b.completed||b.cancelled||(b.cancelled=!0,b.innerRequest&&(b.innerRequest.cancel(),d--),a())}};return n.push(b),a(),b};const C=A=>{const{requestParameters:p,supportImageRefresh:y,callback:b}=A;return l.e(p,{type:"image"}),(y!==!1||l.i()||l.g(p.url)||p.headers&&!Object.keys(p.headers).reduce((T,S)=>T&&S==="accept",!0)?l.m:h)(p,(T,S,k,F)=>{B(A,b,T,S,k,F)})},B=(A,p,y,b,T,S)=>{y?p(y):b instanceof HTMLImageElement||l.a(b)?p(null,b):b&&((k,F)=>{typeof createImageBitmap=="function"?l.b(k,F):l.d(k,F)})(b,(k,F)=>{k!=null?p(k):F!=null&&p(null,F,{cacheControl:T,expires:S})}),A.cancelled||(A.completed=!0,d--,a())},a=()=>{const A=(()=>{const p=Object.keys(w);let y=!1;if(p.length>0){for(const b of p)if(y=w[b](),y)break}return y})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let p=d;p<A&&n.length>0;p++){const y=n.shift();if(y.cancelled){p--;continue}const b=C(y);d++,y.innerRequest=b}},h=(A,p)=>{const y=new Image,b=A.url;let T=!1;const S=A.credentials;return S&&S==="include"?y.crossOrigin="use-credentials":(S&&S==="same-origin"||!l.s(b))&&(y.crossOrigin="anonymous"),y.fetchPriority="high",y.onload=()=>{p(null,y),y.onerror=y.onload=null},y.onerror=()=>{T||p(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),y.onerror=y.onload=null},y.src=b,{cancel:()=>{T=!0,y.src=""}}}}(Ee||(Ee={})),Ee.resetRequestQueue(),function(E){E.Glyphs="Glyphs",E.Image="Image",E.Source="Source",E.SpriteImage="SpriteImage",E.SpriteJSON="SpriteJSON",E.Style="Style",E.Tile="Tile",E.Unknown="Unknown"}(Ce||(Ce={}));class Le{constructor(n){this._transformRequestFn=n}transformRequest(n,d){return this._transformRequestFn&&this._transformRequestFn(n,d)||{url:n}}normalizeSpriteURL(n,d,v){const w=function(C){const B=C.match(Oe);if(!B)throw new Error(`Unable to parse URL "${C}"`);return{protocol:B[1],authority:B[2],path:B[3]||"/",params:B[4]?B[4].split("&"):[]}}(n);return w.path+=`${d}${v}`,function(C){const B=C.params.length?`?${C.params.join("&")}`:"";return`${C.protocol}://${C.authority}${C.path}${B}`}(w)}setTransformRequest(n){this._transformRequestFn=n}}const Oe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ne(E){var n=new l.A(3);return n[0]=E[0],n[1]=E[1],n[2]=E[2],n}var Qe,Je=function(E,n,d){return E[0]=n[0]-d[0],E[1]=n[1]-d[1],E[2]=n[2]-d[2],E};Qe=new l.A(3),l.A!=Float32Array&&(Qe[0]=0,Qe[1]=0,Qe[2]=0);var xt=function(E){var n=E[0],d=E[1];return n*n+d*d};function wt(E){const n=[];if(typeof E=="string")n.push({id:"default",url:E});else if(E&&E.length>0){const d=[];for(const{id:v,url:w}of E){const C=`${v}${w}`;d.indexOf(C)===-1&&(d.push(C),n.push({id:v,url:w}))}}return n}function ct(E,n,d,v,w){if(v)return void E(v);if(w!==Object.values(n).length||w!==Object.values(d).length)return;const C={};for(const B in n){C[B]={};const a=l.h.getImageCanvasContext(d[B]),h=n[B];for(const A in h){const{width:p,height:y,x:b,y:T,sdf:S,pixelRatio:k,stretchX:F,stretchY:U,content:H}=h[A];C[B][A]={data:null,pixelRatio:k,sdf:S,stretchX:F,stretchY:U,content:H,spriteData:{width:p,height:y,x:b,y:T,context:a}}}}E(null,C)}(function(){var E=new l.A(2);l.A!=Float32Array&&(E[0]=0,E[1]=0)})();class at{constructor(n,d,v,w){this.context=n,this.format=v,this.texture=n.gl.createTexture(),this.update(d,w)}update(n,d,v){const{width:w,height:C}=n,B=!(this.size&&this.size[0]===w&&this.size[1]===C||v),{context:a}=this,{gl:h}=a;if(this.useMipmap=!!(d&&d.useMipmap),h.bindTexture(h.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA&&(!d||d.premultiply!==!1)),B)this.size=[w,C],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||l.a(n)?h.texImage2D(h.TEXTURE_2D,0,this.format,this.format,h.UNSIGNED_BYTE,n):h.texImage2D(h.TEXTURE_2D,0,this.format,w,C,0,this.format,h.UNSIGNED_BYTE,n.data);else{const{x:A,y:p}=v||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||l.a(n)?h.texSubImage2D(h.TEXTURE_2D,0,A,p,h.RGBA,h.UNSIGNED_BYTE,n):h.texSubImage2D(h.TEXTURE_2D,0,A,p,w,C,h.RGBA,h.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&h.generateMipmap(h.TEXTURE_2D)}bind(n,d,v){const{context:w}=this,{gl:C}=w;C.bindTexture(C.TEXTURE_2D,this.texture),v!==C.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(v=C.LINEAR),n!==this.filter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,n),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,v||n),this.filter=n),d!==this.wrap&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,d),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}function Vt(E){const{userImage:n}=E;return!!(n&&n.render&&n.render())&&(E.data.replace(new Uint8Array(n.data.buffer)),!0)}class Ot extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:d,callback:v}of this.requestors)this._notify(d,v);this.requestors=[]}}getImage(n){const d=this.images[n];if(d&&!d.data&&d.spriteData){const v=d.spriteData;d.data=new l.R({width:v.width,height:v.height},v.context.getImageData(v.x,v.y,v.width,v.height).data),d.spriteData=null}return d}addImage(n,d){if(this.images[n])throw new Error(`Image id ${n} already exist, use updateImage instead`);this._validate(n,d)&&(this.images[n]=d)}_validate(n,d){let v=!0;const w=d.data||d.spriteData;return this._validateStretch(d.stretchX,w&&w.width)||(this.fire(new l.j(new Error(`Image "${n}" has invalid "stretchX" value`))),v=!1),this._validateStretch(d.stretchY,w&&w.height)||(this.fire(new l.j(new Error(`Image "${n}" has invalid "stretchY" value`))),v=!1),this._validateContent(d.content,d)||(this.fire(new l.j(new Error(`Image "${n}" has invalid "content" value`))),v=!1),v}_validateStretch(n,d){if(!n)return!0;let v=0;for(const w of n){if(w[0]<v||w[1]<w[0]||d<w[1])return!1;v=w[1]}return!0}_validateContent(n,d){if(!n)return!0;if(n.length!==4)return!1;const v=d.spriteData,w=v&&v.width||d.data.width,C=v&&v.height||d.data.height;return!(n[0]<0||w<n[0]||n[1]<0||C<n[1]||n[2]<0||w<n[2]||n[3]<0||C<n[3]||n[2]<n[0]||n[3]<n[1])}updateImage(n,d,v=!0){const w=this.getImage(n);if(v&&(w.data.width!==d.data.width||w.data.height!==d.data.height))throw new Error(`size mismatch between old image (${w.data.width}x${w.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=w.version+1,this.images[n]=d,this.updatedImages[n]=!0}removeImage(n){const d=this.images[n];delete this.images[n],delete this.patterns[n],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,d){let v=!0;if(!this.isLoaded())for(const w of n)this.images[w]||(v=!1);this.isLoaded()||v?this._notify(n,d):this.requestors.push({ids:n,callback:d})}_notify(n,d){const v={};for(const w of n){let C=this.getImage(w);C||(this.fire(new l.k("styleimagemissing",{id:w})),C=this.getImage(w)),C?v[w]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)}:l.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,v)}getPixelSize(){const{width:n,height:d}=this.atlasImage;return{width:n,height:d}}getPattern(n){const d=this.patterns[n],v=this.getImage(n);if(!v)return null;if(d&&d.position.version===v.version)return d.position;if(d)d.position.version=v.version;else{const w={w:v.data.width+2,h:v.data.height+2,x:0,y:0},C=new l.I(w,v);this.patterns[n]={bin:w,position:C}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const d=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new at(n,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const C in this.patterns)n.push(this.patterns[C].bin);const{w:d,h:v}=l.p(n),w=this.atlasImage;w.resize({width:d||1,height:v||1});for(const C in this.patterns){const{bin:B}=this.patterns[C],a=B.x+1,h=B.y+1,A=this.getImage(C).data,p=A.width,y=A.height;l.R.copy(A,w,{x:0,y:0},{x:a,y:h},{width:p,height:y}),l.R.copy(A,w,{x:0,y:y-1},{x:a,y:h-1},{width:p,height:1}),l.R.copy(A,w,{x:0,y:0},{x:a,y:h+y},{width:p,height:1}),l.R.copy(A,w,{x:p-1,y:0},{x:a-1,y:h},{width:1,height:y}),l.R.copy(A,w,{x:0,y:0},{x:a+p,y:h},{width:1,height:y})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const d of n){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const v=this.getImage(d);v||l.w(`Image with ID: "${d}" was not found`),Vt(v)&&this.updateImage(d,v)}}}const $t=1e20;function qt(E,n,d,v,w,C,B,a,h){for(let A=n;A<n+v;A++)gi(E,d*C+A,C,w,B,a,h);for(let A=d;A<d+w;A++)gi(E,A*C+n,1,v,B,a,h)}function gi(E,n,d,v,w,C,B){C[0]=0,B[0]=-$t,B[1]=$t,w[0]=E[n];for(let a=1,h=0,A=0;a<v;a++){w[a]=E[n+a*d];const p=a*a;do{const y=C[h];A=(w[a]-w[y]+p-y*y)/(a-y)/2}while(A<=B[h]&&--h>-1);h++,C[h]=a,B[h]=A,B[h+1]=$t}for(let a=0,h=0;a<v;a++){for(;B[h+1]<a;)h++;const A=C[h],p=a-A;E[n+a*d]=w[A]+p*p}}class Nr{constructor(n,d){this.requestManager=n,this.localIdeographFontFamily=d,this.entries={}}setURL(n){this.url=n}getGlyphs(n,d){const v=[];for(const w in n)for(const C of n[w])v.push({stack:w,id:C});l.o(v,({stack:w,id:C},B)=>{let a=this.entries[w];a||(a=this.entries[w]={glyphs:{},requests:{},ranges:{}});let h=a.glyphs[C];if(h!==void 0)return void B(null,{stack:w,id:C,glyph:h});if(h=this._tinySDF(a,w,C),h)return a.glyphs[C]=h,void B(null,{stack:w,id:C,glyph:h});const A=Math.floor(C/256);if(256*A>65535)return void B(new Error("glyphs > 65535 not supported"));if(a.ranges[A])return void B(null,{stack:w,id:C,glyph:h});if(!this.url)return void B(new Error("glyphsUrl is not set"));let p=a.requests[A];p||(p=a.requests[A]=[],Nr.loadGlyphRange(w,A,this.url,this.requestManager,(y,b)=>{if(b){for(const T in b)this._doesCharSupportLocalGlyph(+T)||(a.glyphs[+T]=b[+T]);a.ranges[A]=!0}for(const T of p)T(y,b);delete a.requests[A]})),p.push((y,b)=>{y?B(y):b&&B(null,{stack:w,id:C,glyph:b[C]||null})})},(w,C)=>{if(w)d(w);else if(C){const B={};for(const{stack:a,id:h,glyph:A}of C)(B[a]||(B[a]={}))[h]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};d(null,B)}})}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](n)||l.u["Hangul Syllables"](n)||l.u.Hiragana(n)||l.u.Katakana(n))}_tinySDF(n,d,v){const w=this.localIdeographFontFamily;if(!w||!this._doesCharSupportLocalGlyph(v))return;let C=n.tinySDF;if(!C){let a="400";/bold/i.test(d)?a="900":/medium/i.test(d)?a="500":/light/i.test(d)&&(a="200"),C=n.tinySDF=new Nr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:w,fontWeight:a})}const B=C.draw(String.fromCharCode(v));return{id:v,bitmap:new l.q({width:B.width||60,height:B.height||60},B.data),metrics:{width:B.glyphWidth/2||24,height:B.glyphHeight/2||24,left:B.glyphLeft/2+.5||0,top:B.glyphTop/2-27.5||-8,advance:B.glyphAdvance/2||24,isDoubleResolution:!0}}}}Nr.loadGlyphRange=function(E,n,d,v,w){const C=256*n,B=C+255,a=v.transformRequest(d.replace("{fontstack}",E).replace("{range}",`${C}-${B}`),Ce.Glyphs);l.l(a,(h,A)=>{if(h)w(h);else if(A){const p={};for(const y of l.n(A))p[y.id]=y;w(null,p)}})},Nr.TinySDF=class{constructor({fontSize:E=24,buffer:n=3,radius:d=8,cutoff:v=.25,fontFamily:w="sans-serif",fontWeight:C="normal",fontStyle:B="normal"}={}){this.buffer=n,this.cutoff=v,this.radius=d;const a=this.size=E+4*n,h=this._createCanvas(a),A=this.ctx=h.getContext("2d",{willReadFrequently:!0});A.font=`${B} ${C} ${E}px ${w}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(E){const n=document.createElement("canvas");return n.width=n.height=E,n}draw(E){const{width:n,actualBoundingBoxAscent:d,actualBoundingBoxDescent:v,actualBoundingBoxLeft:w,actualBoundingBoxRight:C}=this.ctx.measureText(E),B=Math.ceil(d),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(C-w))),h=Math.min(this.size-this.buffer,B+Math.ceil(v)),A=a+2*this.buffer,p=h+2*this.buffer,y=Math.max(A*p,0),b=new Uint8ClampedArray(y),T={data:b,width:A,height:p,glyphWidth:a,glyphHeight:h,glyphTop:B,glyphLeft:0,glyphAdvance:n};if(a===0||h===0)return T;const{ctx:S,buffer:k,gridInner:F,gridOuter:U}=this;S.clearRect(k,k,a,h),S.fillText(E,k,k+B);const H=S.getImageData(k,k,a,h);U.fill($t,0,y),F.fill(0,0,y);for(let W=0;W<h;W++)for(let Y=0;Y<a;Y++){const G=H.data[4*(W*a+Y)+3]/255;if(G===0)continue;const se=(W+k)*A+Y+k;if(G===1)U[se]=0,F[se]=$t;else{const me=.5-G;U[se]=me>0?me*me:0,F[se]=me<0?me*me:0}}qt(U,0,0,A,p,A,this.f,this.v,this.z),qt(F,k,k,a,h,A,this.f,this.v,this.z);for(let W=0;W<y;W++){const Y=Math.sqrt(U[W])-Math.sqrt(F[W]);b[W]=Math.round(255-255*(Y/this.radius+this.cutoff))}return T}};class hr{constructor(){this.specification=l.v.light.position}possiblyEvaluate(n,d){return l.z(n.expression.evaluate(d))}interpolate(n,d,v){return{x:l.B.number(n.x,d.x,v),y:l.B.number(n.y,d.y,v),z:l.B.number(n.z,d.z,v)}}}let Ks;class Cn extends l.E{constructor(n){super(),Ks=Ks||new l.r({anchor:new l.D(l.v.light.anchor),position:new hr,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Ks),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,d={}){if(!this._validate(l.t,n,d))for(const v in n){const w=n[v];v.endsWith("-transition")?this._transitionable.setTransition(v.slice(0,-11),w):this._transitionable.setValue(v,w)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,d,v){return(!v||v.validate!==!1)&&l.x(this,n.call(l.y,l.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}}class qn{constructor(n,d){this.width=n,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,d){const v=n.join(",")+String(d);return this.dashEntry[v]||(this.dashEntry[v]=this.addDash(n,d)),this.dashEntry[v]}getDashRanges(n,d,v){const w=[];let C=n.length%2==1?-n[n.length-1]*v:0,B=n[0]*v,a=!0;w.push({left:C,right:B,isDash:a,zeroLength:n[0]===0});let h=n[0];for(let A=1;A<n.length;A++){a=!a;const p=n[A];C=h*v,h+=p,B=h*v,w.push({left:C,right:B,isDash:a,zeroLength:p===0})}return w}addRoundDash(n,d,v){const w=d/2;for(let C=-v;C<=v;C++){const B=this.width*(this.nextRow+v+C);let a=0,h=n[a];for(let A=0;A<this.width;A++){A/h.right>1&&(h=n[++a]);const p=Math.abs(A-h.left),y=Math.abs(A-h.right),b=Math.min(p,y);let T;const S=C/v*(w+1);if(h.isDash){const k=w-Math.abs(S);T=Math.sqrt(b*b+k*k)}else T=w-Math.sqrt(b*b+S*S);this.data[B+A]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(n){for(let a=n.length-1;a>=0;--a){const h=n[a],A=n[a+1];h.zeroLength?n.splice(a,1):A&&A.isDash===h.isDash&&(A.left=h.left,n.splice(a,1))}const d=n[0],v=n[n.length-1];d.isDash===v.isDash&&(d.left=v.left-this.width,v.right=d.right+this.width);const w=this.width*this.nextRow;let C=0,B=n[C];for(let a=0;a<this.width;a++){a/B.right>1&&(B=n[++C]);const h=Math.abs(a-B.left),A=Math.abs(a-B.right),p=Math.min(h,A);this.data[w+a]=Math.max(0,Math.min(255,(B.isDash?p:-p)+128))}}addDash(n,d){const v=d?7:0,w=2*v+1;if(this.nextRow+w>this.height)return l.w("LineAtlas out of space"),null;let C=0;for(let a=0;a<n.length;a++)C+=n[a];if(C!==0){const a=this.width/C,h=this.getDashRanges(n,this.width,a);d?this.addRoundDash(h,a,v):this.addRegularDash(h)}const B={y:(this.nextRow+v+.5)/this.height,height:2*v/this.height,width:C};return this.nextRow+=w,this.dirty=!0,B}bind(n){const d=n.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}class Pn{constructor(n,d,v){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=v;const w=this.workerPool.acquire(v);for(let C=0;C<w.length;C++){const B=new l.C(w[C],d,v);B.name=`Worker ${C}`,this.actors.push(B)}if(!this.actors.length)throw new Error("No actors found")}broadcast(n,d,v){l.o(this.actors,(w,C)=>{w.send(n,d,C)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(n=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],n&&this.workerPool.release(this.id)}}function ur(E,n,d){const v=function(w,C){if(w)return d(w);if(C){const B=l.F(l.e(C,E),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(B.vectorLayers=C.vector_layers,B.vectorLayerIds=B.vectorLayers.map(a=>a.id)),d(null,B)}};return E.url?l.f(n.transformRequest(E.url,Ce.Source),v):l.h.frame(()=>v(null,E))}class Ei{constructor(n,d){n&&(d?this.setSouthWest(n).setNorthEast(d):Array.isArray(n)&&(n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1])))}setNorthEast(n){return this._ne=n instanceof l.L?new l.L(n.lng,n.lat):l.L.convert(n),this}setSouthWest(n){return this._sw=n instanceof l.L?new l.L(n.lng,n.lat):l.L.convert(n),this}extend(n){const d=this._sw,v=this._ne;let w,C;if(n instanceof l.L)w=n,C=n;else{if(!(n instanceof Ei))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Ei.convert(n)):this.extend(l.L.convert(n)):n&&("lng"in n||"lon"in n)&&"lat"in n?this.extend(l.L.convert(n)):this;if(w=n._sw,C=n._ne,!w||!C)return this}return d||v?(d.lng=Math.min(w.lng,d.lng),d.lat=Math.min(w.lat,d.lat),v.lng=Math.max(C.lng,v.lng),v.lat=Math.max(C.lat,v.lat)):(this._sw=new l.L(w.lng,w.lat),this._ne=new l.L(C.lng,C.lat)),this}getCenter(){return new l.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.L(this.getWest(),this.getNorth())}getSouthEast(){return new l.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:d,lat:v}=l.L.convert(n);let w=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(w=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=v&&v<=this._ne.lat&&w}static convert(n){return n instanceof Ei?n:n&&new Ei(n)}static fromLngLat(n,d=0){const v=360*d/40075017,w=v/Math.cos(Math.PI/180*n.lat);return new Ei(new l.L(n.lng-w,n.lat-v),new l.L(n.lng+w,n.lat+v))}}class _r{constructor(n,d,v){this.bounds=Ei.convert(this.validateBounds(n)),this.minzoom=d||0,this.maxzoom=v||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const d=Math.pow(2,n.z),v=Math.floor(l.G(this.bounds.getWest())*d),w=Math.floor(l.H(this.bounds.getNorth())*d),C=Math.ceil(l.G(this.bounds.getEast())*d),B=Math.ceil(l.H(this.bounds.getSouth())*d);return n.x>=v&&n.x<C&&n.y>=w&&n.y<B}}class ln extends l.E{constructor(n,d,v,w){if(super(),this.load=()=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ur(this._options,this.map._requestManager,(C,B)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),C?this.fire(new l.j(C)):B&&(l.e(this,B),B.bounds&&(this.tileBounds=new _r(B.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>l.e({},this._options),this.id=n,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.F(d,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.cancel(),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(n,d){const v=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),w={request:this.map._requestManager.transformRequest(v,Ce.Tile),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function C(B,a){return delete n.request,n.aborted?d(null):B&&B.status!==404?d(B):(a&&a.resourceTiming&&(n.resourceTiming=a.resourceTiming),this.map._refreshExpiredTiles&&a&&n.setExpiryData(a),n.loadVectorData(a,this.map.painter),d(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired"?n.state==="loading"?n.reloadCallback=d:n.request=n.actor.send("reloadTile",w,C.bind(this)):(n.actor=this.dispatcher.getActor(),n.request=n.actor.send("loadTile",w,C.bind(this)))}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id},void 0)}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class cn extends l.E{constructor(n,d,v,w){super(),this.id=n,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},d),l.e(this,l.F(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ur(this._options,this.map._requestManager,(n,d)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new l.j(n)):d&&(l.e(this,d),d.bounds&&(this.tileBounds=new _r(d.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.cancel(),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}serialize(){return l.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,d){const v=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.request=Ee.getImage(this.map._requestManager.transformRequest(v,Ce.Tile),(w,C,B)=>{if(delete n.request,n.aborted)n.state="unloaded",d(null);else if(w)n.state="errored",d(w);else if(C){this.map._refreshExpiredTiles&&B&&n.setExpiryData(B);const a=this.map.painter.context,h=a.gl;n.texture=this.map.painter.getTileTexture(C.width),n.texture?n.texture.update(C,{useMipmap:!0}):(n.texture=new at(a,C,h.RGBA,{useMipmap:!0}),n.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),n.state="loaded",d(null)}},this.map._refreshExpiredTiles)}abortTile(n,d){n.request&&(n.request.cancel(),delete n.request),d()}unloadTile(n,d){n.texture&&this.map.painter.saveTileTexture(n.texture),d()}hasTransition(){return!1}}class Qi extends cn{constructor(n,d,v,w){super(n,d,v,w),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(n,d){const v=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),w=this.map._requestManager.transformRequest(v,Ce.Tile);function C(B,a){B&&(n.state="errored",d(B)),a&&(n.dem=a,n.needsHillshadePrepare=!0,n.needsTerrainPrepare=!0,n.state="loaded",d(null))}n.neighboringTiles=this._getNeighboringTiles(n.tileID),n.request=Ee.getImage(w,(B,a,h)=>l._(this,void 0,void 0,function*(){if(delete n.request,n.aborted)n.state="unloaded",d(null);else if(B)n.state="errored",d(B);else if(a){this.map._refreshExpiredTiles&&n.setExpiryData(h);const A=l.a(a)&&l.J()?a:yield function(y){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.K()){const b=y.width+2,T=y.height+2;try{return new l.R({width:b,height:T},yield l.M(y,-1,-1,b,T))}catch{}}return l.h.getImageData(y,1)})}(a),p={uid:n.uid,coord:n.tileID,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};n.actor&&n.state!=="expired"||(n.actor=this.dispatcher.getActor(),n.actor.send("loadDEMTile",p,C))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(n){const d=n.canonical,v=Math.pow(2,d.z),w=(d.x-1+v)%v,C=d.x===0?n.wrap-1:n.wrap,B=(d.x+1+v)%v,a=d.x+1===v?n.wrap+1:n.wrap,h={};return h[new l.O(n.overscaledZ,C,d.z,w,d.y).key]={backfilled:!1},h[new l.O(n.overscaledZ,a,d.z,B,d.y).key]={backfilled:!1},d.y>0&&(h[new l.O(n.overscaledZ,C,d.z,w,d.y-1).key]={backfilled:!1},h[new l.O(n.overscaledZ,n.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},h[new l.O(n.overscaledZ,a,d.z,B,d.y-1).key]={backfilled:!1}),d.y+1<v&&(h[new l.O(n.overscaledZ,C,d.z,w,d.y+1).key]={backfilled:!1},h[new l.O(n.overscaledZ,n.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},h[new l.O(n.overscaledZ,a,d.z,B,d.y+1).key]={backfilled:!1}),h}unloadTile(n){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&n.actor.send("removeDEMTile",{uid:n.uid,source:this.id})}}class Dr extends l.E{constructor(n,d,v,w){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>l.e({},this._options,{type:this.type,data:this._data}),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=v.getActor(),this.setEventedParent(w),this._data=d.data,this._options=l.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const C=l.N/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*C,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*C,extent:l.N,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.N,radius:(d.clusterRadius||50)*C,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._updateWorkerData(),this}updateData(n){return this._updateWorkerData(n),this}setClusterOptions(n){return this.workerOptions.cluster=n.cluster,n&&(n.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=n.clusterRadius),n.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=n.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(n,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:n,source:this.id},d),this}getClusterChildren(n,d){return this.actor.send("geojson.getClusterChildren",{clusterId:n,source:this.id},d),this}getClusterLeaves(n,d,v,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:n,limit:d,offset:v},w),this}_updateWorkerData(n){const d=l.e({},this.workerOptions);n?d.dataDiff=n:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(l.h.resolveURL(this._data),Ce.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,d,(v,w)=>{if(this._pendingLoads--,this._removed||w&&w.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let C=null;if(w&&w.resourceTiming&&w.resourceTiming[this.id]&&(C=w.resourceTiming[this.id].slice(0)),v)return void this.fire(new l.j(v));const B={dataType:"source"};this._collectResourceTiming&&C&&C.length>0&&l.e(B,{resourceTiming:C}),this.fire(new l.k("data",Object.assign(Object.assign({},B),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},B),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(n,d){const v=n.actor?"reloadTile":"loadTile";n.actor=this.actor;const w={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};n.request=this.actor.send(v,w,(C,B)=>(delete n.request,n.unloadVectorData(),n.aborted?d(null):C?d(C):(n.loadVectorData(B,this.map.painter,v==="reloadTile"),d(null))))}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.aborted=!0}unloadTile(n){n.unloadVectorData(),this.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var yi=l.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ki extends l.E{constructor(n,d,v,w){super(),this.load=(C,B)=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Ee.getImage(this.map._requestManager.transformRequest(this.url,Ce.Image),(a,h)=>{this._request=null,this._loaded=!0,a?this.fire(new l.j(a)):h&&(this.image=h,C&&(this.coordinates=C),B&&B(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const C=this.map.painter.context,B=C.gl;this.boundsBuffer||(this.boundsBuffer=C.createVertexBuffer(this._boundsArray,yi.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new at(C,this.image,B.RGBA),this.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE));let a=!1;for(const h in this.tiles){const A=this.tiles[h];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,a=!0)}a&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=n,this.dispatcher=v,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}loaded(){return this._loaded}updateImage(n){return n.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=n.url,this.load(n.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(n){this.coordinates=n;const d=n.map(l.U.fromLngLat);this.tileID=function(w){let C=1/0,B=1/0,a=-1/0,h=-1/0;for(const b of w)C=Math.min(C,b.x),B=Math.min(B,b.y),a=Math.max(a,b.x),h=Math.max(h,b.y);const A=Math.max(a-C,h-B),p=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),y=Math.pow(2,p);return new l.W(p,Math.floor((C+a)/2*y),Math.floor((B+h)/2*y))}(d),this.minzoom=this.maxzoom=this.tileID.z;const v=d.map(w=>this.tileID.getTilePoint(w)._round());return this._boundsArray=new l.V,this._boundsArray.emplaceBack(v[0].x,v[0].y,0,0),this._boundsArray.emplaceBack(v[1].x,v[1].y,l.N,0),this._boundsArray.emplaceBack(v[3].x,v[3].y,0,l.N),this._boundsArray.emplaceBack(v[2].x,v[2].y,l.N,l.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(n,d){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},d(null)):(n.state="errored",d(null))}hasTransition(){return!1}}class Js extends ki{constructor(n,d,v,w){super(n,d,v,w),this.load=()=>{this._loaded=!1;const C=this.options;this.urls=[];for(const B of C.urls)this.urls.push(this.map._requestManager.transformRequest(B,Ce.Source).url);l.X(this.urls,(B,a)=>{this._loaded=!0,B?this.fire(new l.j(B)):a&&(this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const C=this.map.painter.context,B=C.gl;this.boundsBuffer||(this.boundsBuffer=C.createVertexBuffer(this._boundsArray,yi.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE),B.texSubImage2D(B.TEXTURE_2D,0,0,0,B.RGBA,B.UNSIGNED_BYTE,this.video)):(this.texture=new at(C,this.video,B.RGBA),this.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE));let a=!1;for(const h in this.tiles){const A=this.tiles[h];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,a=!0)}a&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=d}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const d=this.video.seekable;n<d.start(0)||n>d.end(0)?this.fire(new l.j(new l.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Xr extends ki{constructor(n,d,v,w){super(n,d,v,w),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let C=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,C=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,C=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const B=this.map.painter.context,a=B.gl;this.boundsBuffer||(this.boundsBuffer=B.createVertexBuffer(this._boundsArray,yi.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?(C||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new at(B,this.canvas,a.RGBA,{premultiply:!0});let h=!1;for(const A in this.tiles){const p=this.tiles[A];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,h=!0)}h&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(C=>!Array.isArray(C)||C.length!==2||C.some(B=>typeof B!="number"))||this.fire(new l.j(new l.Y(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.Y(`sources.${n}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.j(new l.Y(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.Y(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.Y(`sources.${n}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}const Ls={},zr=E=>{switch(E){case"geojson":return Dr;case"image":return ki;case"raster":return cn;case"raster-dem":return Qi;case"vector":return ln;case"video":return Js;case"canvas":return Xr}return Ls[E]};function ms(E,n){const d=l.Z();return l.$(d,d,[1,1,0]),l.a0(d,d,[.5*E.width,.5*E.height,1]),l.a1(d,d,E.calculatePosMatrix(n.toUnwrapped()))}function mr(E,n,d,v,w,C){const B=function(y,b,T){if(y)for(const S of y){const k=b[S];if(k&&k.source===T&&k.type==="fill-extrusion")return!0}else for(const S in b){const k=b[S];if(k.source===T&&k.type==="fill-extrusion")return!0}return!1}(w&&w.layers,n,E.id),a=C.maxPitchScaleFactor(),h=E.tilesIn(v,a,B);h.sort(Ki);const A=[];for(const y of h)A.push({wrappedTileID:y.tileID.wrapped().key,queryResults:y.tile.queryRenderedFeatures(n,d,E._state,y.queryGeometry,y.cameraQueryGeometry,y.scale,w,C,a,ms(E.transform,y.tileID))});const p=function(y){const b={},T={};for(const S of y){const k=S.queryResults,F=S.wrappedTileID,U=T[F]=T[F]||{};for(const H in k){const W=k[H],Y=U[H]=U[H]||{},G=b[H]=b[H]||[];for(const se of W)Y[se.featureIndex]||(Y[se.featureIndex]=!0,G.push(se))}}return b}(A);for(const y in p)p[y].forEach(b=>{const T=b.feature,S=E.getFeatureState(T.layer["source-layer"],T.id);T.source=T.layer.source,T.layer["source-layer"]&&(T.sourceLayer=T.layer["source-layer"]),T.state=S});return p}function Ki(E,n){const d=E.tileID,v=n.tileID;return d.overscaledZ-v.overscaledZ||d.canonical.y-v.canonical.y||d.wrap-v.wrap||d.canonical.x-v.canonical.x}class Ur{constructor(n,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=n,this.uid=l.a2(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(n){const d=n+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(n){this.demTexture&&n.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(n,d,v){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(w,C){const B={};if(!C)return B;for(const a of w){const h=a.layerIds.map(A=>C.getLayer(A)).filter(Boolean);if(h.length!==0){a.layers=h,a.stateDependentLayerIds&&(a.stateDependentLayers=a.stateDependentLayerIds.map(A=>h.filter(p=>p.id===A)[0]));for(const A of h)B[A.id]=a}}return B}(n.buckets,d.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const C=this.buckets[w];if(C instanceof l.a4){if(this.hasSymbolBuckets=!0,!v)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const C=this.buckets[w];if(C instanceof l.a4&&C.hasRTLText){this.hasRTLText=!0,l.a5();break}}this.queryPadding=0;for(const w in this.buckets){const C=this.buckets[w];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(w).queryRadius(C))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new l.a3}unloadVectorData(){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(const v in this.buckets){const w=this.buckets[v];w.uploadPending()&&w.upload(n)}const d=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new at(n,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new at(n,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,d,v,w,C,B,a,h,A,p){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:w,cameraQueryGeometry:C,scale:B,tileSize:this.tileSize,pixelPosMatrix:p,transform:h,params:a,queryPadding:this.queryPadding*A},n,d,v):{}}querySourceFeatures(n,d){const v=this.latestFeatureIndex;if(!v||!v.rawTileData)return;const w=v.loadVTLayers(),C=d&&d.sourceLayer?d.sourceLayer:"",B=w._geojsonTileLayer||w[C];if(!B)return;const a=l.a6(d&&d.filter),{z:h,x:A,y:p}=this.tileID.canonical,y={z:h,x:A,y:p};for(let b=0;b<B.length;b++){const T=B.feature(b);if(a.needGeometry){const F=l.a7(T,!0);if(!a.filter(new l.a8(this.tileID.overscaledZ),F,this.tileID.canonical))continue}else if(!a.filter(new l.a8(this.tileID.overscaledZ),T))continue;const S=v.getId(T,C),k=new l.a9(T,h,A,p,S);k.tile=y,n.push(k)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const d=this.expirationTime;if(n.cacheControl){const v=l.aa(n.cacheControl);v["max-age"]&&(this.expirationTime=Date.now()+1e3*v["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const v=Date.now();let w=!1;if(this.expirationTime>v)w=!1;else if(d)if(this.expirationTime<d)w=!0;else{const C=this.expirationTime-d;C?this.expirationTime=v+Math.max(C,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0)return;const v=this.latestFeatureIndex.loadVTLayers();for(const w in this.buckets){if(!d.style.hasLayer(w))continue;const C=this.buckets[w],B=C.layers[0].sourceLayer||"_geojsonTileLayer",a=v[B],h=n[B];if(!a||!h||Object.keys(h).length===0)continue;C.update(h,a,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=d&&d.style&&d.style.getLayer(w);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=l.h.now()+n}setDependencies(n,d){const v={};for(const w of d)v[w]=!0;this.dependencies[n]=v}hasDependency(n,d){for(const v of n){const w=this.dependencies[v];if(w){for(const C of d)if(w[C])return!0}}return!1}}class en{constructor(n,d){this.max=n,this.onRemove=d,this.reset()}reset(){for(const n in this.data)for(const d of this.data[n])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(n,d,v){const w=n.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);const C={value:d,timeout:void 0};if(v!==void 0&&(C.timeout=setTimeout(()=>{this.remove(n,C)},v)),this.data[w].push(C),this.order.push(w),this.order.length>this.max){const B=this._getAndRemoveByKey(this.order[0]);B&&this.onRemove(B)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const d=this.data[n].shift();return d.timeout&&clearTimeout(d.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),d.value}getByKey(n){const d=this.data[n];return d?d[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,d){if(!this.has(n))return this;const v=n.wrapped().key,w=d===void 0?0:this.data[v].indexOf(d),C=this.data[v][w];return this.data[v].splice(w,1),C.timeout&&clearTimeout(C.timeout),this.data[v].length===0&&delete this.data[v],this.onRemove(C.value),this.order.splice(this.order.indexOf(v),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(n){const d=[];for(const v in this.data)for(const w of this.data[v])n(w.value)||d.push(w);for(const v of d)this.remove(v.value.tileID,v)}}class Xe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,d,v){const w=String(d);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][w]=this.stateChanges[n][w]||{},l.e(this.stateChanges[n][w],v),this.deletedStates[n]===null){this.deletedStates[n]={};for(const C in this.state[n])C!==w&&(this.deletedStates[n][C]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][w]===null){this.deletedStates[n][w]={};for(const C in this.state[n][w])v[C]||(this.deletedStates[n][w][C]=null)}else for(const C in v)this.deletedStates[n]&&this.deletedStates[n][w]&&this.deletedStates[n][w][C]===null&&delete this.deletedStates[n][w][C]}removeFeatureState(n,d,v){if(this.deletedStates[n]===null)return;const w=String(d);if(this.deletedStates[n]=this.deletedStates[n]||{},v&&d!==void 0)this.deletedStates[n][w]!==null&&(this.deletedStates[n][w]=this.deletedStates[n][w]||{},this.deletedStates[n][w][v]=null);else if(d!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][w])for(v in this.deletedStates[n][w]={},this.stateChanges[n][w])this.deletedStates[n][w][v]=null;else this.deletedStates[n][w]=null;else this.deletedStates[n]=null}getState(n,d){const v=String(d),w=l.e({},(this.state[n]||{})[v],(this.stateChanges[n]||{})[v]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const C=this.deletedStates[n][d];if(C===null)return{};for(const B in C)delete w[B]}return w}initializeTileState(n,d){n.setFeatureState(this.state,d)}coalesceChanges(n,d){const v={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const C={};for(const B in this.stateChanges[w])this.state[w][B]||(this.state[w][B]={}),l.e(this.state[w][B],this.stateChanges[w][B]),C[B]=this.state[w][B];v[w]=C}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const C={};if(this.deletedStates[w]===null)for(const B in this.state[w])C[B]={},this.state[w][B]={};else for(const B in this.deletedStates[w]){if(this.deletedStates[w][B]===null)this.state[w][B]={};else for(const a of Object.keys(this.deletedStates[w][B]))delete this.state[w][B][a];C[B]=this.state[w][B]}v[w]=v[w]||{},l.e(v[w],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(v).length!==0)for(const w in n)n[w].setFeatureState(v,d)}}class _i extends l.E{constructor(n,d,v){super(),this.id=n,this.dispatcher=v,this.on("data",w=>{w.dataType==="source"&&w.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&w.dataType==="source"&&w.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((w,C,B,a)=>{const h=new(zr(C.type))(w,C,B,a);if(h.id!==w)throw new Error(`Expected Source id to be ${w} instead of ${h.id}`);return h})(n,d,v,this),this._tiles={},this._cache=new en(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Xe,this._didEmitContent=!1,this._updated=!1}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._maxTileCacheZoomLevels=n?n._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const n in this._tiles){const d=this._tiles[n];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(n,d){return this._source.loadTile(n,d)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){this._source.abortTile&&this._source.abortTile(n,()=>{}),this._source.fire(new l.k("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const v=this._tiles[d];v.upload(n),v.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Br).map(n=>n.key)}getRenderableIds(n){const d=[];for(const v in this._tiles)this._isIdRenderable(v,n)&&d.push(this._tiles[v]);return n?d.sort((v,w)=>{const C=v.tileID,B=w.tileID,a=new l.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle),h=new l.P(B.canonical.x,B.canonical.y)._rotate(this.transform.angle);return C.overscaledZ-B.overscaledZ||h.y-a.y||h.x-a.x}).map(v=>v.tileID.key):d.map(v=>v.tileID).sort(Br).map(v=>v.key)}hasRenderableParent(n){const d=this.findLoadedParent(n,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(n,d){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(d||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(n,"reloading")}}_reloadTile(n,d){const v=this._tiles[n];v&&(v.state!=="loading"&&(v.state=d),this._loadTile(v,this._tileLoaded.bind(this,v,n,d)))}_tileLoaded(n,d,v,w){if(w)return n.state="errored",void(w.status!==404?this._source.fire(new l.j(w,{tile:n})):this.update(this.transform,this.terrain));n.timeAdded=l.h.now(),v==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(d,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){const d=this.getRenderableIds();for(let w=0;w<d.length;w++){const C=d[w];if(n.neighboringTiles&&n.neighboringTiles[C]){const B=this.getTileByID(C);v(n,B),v(B,n)}}function v(w,C){w.needsHillshadePrepare=!0,w.needsTerrainPrepare=!0;let B=C.tileID.canonical.x-w.tileID.canonical.x;const a=C.tileID.canonical.y-w.tileID.canonical.y,h=Math.pow(2,w.tileID.canonical.z),A=C.tileID.key;B===0&&a===0||Math.abs(a)>1||(Math.abs(B)>1&&(Math.abs(B+h)===1?B+=h:Math.abs(B-h)===1&&(B-=h)),C.dem&&w.dem&&(w.dem.backfillBorder(C.dem,B,a),w.neighboringTiles&&w.neighboringTiles[A]&&(w.neighboringTiles[A].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,d,v,w){for(const C in this._tiles){let B=this._tiles[C];if(w[C]||!B.hasData()||B.tileID.overscaledZ<=d||B.tileID.overscaledZ>v)continue;let a=B.tileID;for(;B&&B.tileID.overscaledZ>d+1;){const A=B.tileID.scaledTo(B.tileID.overscaledZ-1);B=this._tiles[A.key],B&&B.hasData()&&(a=A)}let h=a;for(;h.overscaledZ>d;)if(h=h.scaledTo(h.overscaledZ-1),n[h.key]){w[a.key]=a;break}}}findLoadedParent(n,d){if(n.key in this._loadedParentTiles){const v=this._loadedParentTiles[n.key];return v&&v.tileID.overscaledZ>=d?v:null}for(let v=n.overscaledZ-1;v>=d;v--){const w=n.scaledTo(v),C=this._getLoadedTile(w);if(C)return C}}_getLoadedTile(n){const d=this._tiles[n.key];return d&&d.hasData()?d:this._cache.getByKey(n.wrapped().key)}updateCacheSize(n){const d=Math.ceil(n.width/this._source.tileSize)+1,v=Math.ceil(n.height/this._source.tileSize)+1,w=Math.floor(d*v*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(C)}handleWrapJump(n){const d=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,d){const v={};for(const w in this._tiles){const C=this._tiles[w];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),v[C.tileID.key]=C}this._tiles=v;for(const w in this._timers)clearTimeout(this._timers[w]),delete this._timers[w];for(const w in this._tiles)this._setTileReloadTimer(w,this._tiles[w])}}update(n,d){if(this.transform=n,this.terrain=d,!this._sourceLoaded||this._paused)return;let v;this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?v=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(p=>new l.O(p.canonical.z,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y)):(v=n.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(v=v.filter(p=>this._source.hasTile(p)))):v=[];const w=n.coveringZoomLevel(this._source),C=Math.max(w-_i.maxOverzooming,this._source.minzoom),B=Math.max(w+_i.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const p={};for(const y of v)if(y.canonical.z>this._source.minzoom){const b=y.scaledTo(y.canonical.z-1);p[b.key]=b;const T=y.scaledTo(Math.max(this._source.minzoom,Math.min(y.canonical.z,5)));p[T.key]=T}v=v.concat(Object.values(p))}const a=v.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,a&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const h=this._updateRetainedTiles(v,w);if(vi(this._source.type)){const p={},y={},b=Object.keys(h),T=l.h.now();for(const S of b){const k=h[S],F=this._tiles[S];if(!F||F.fadeEndTime!==0&&F.fadeEndTime<=T)continue;const U=this.findLoadedParent(k,C);U&&(this._addTile(U.tileID),p[U.tileID.key]=U.tileID),y[S]=k}this._retainLoadedChildren(y,w,B,h);for(const S in p)h[S]||(this._coveredTiles[S]=!0,h[S]=p[S]);if(d){const S={},k={};for(const F of v)this._tiles[F.key].hasData()?S[F.key]=F:k[F.key]=F;for(const F in k){const U=k[F].children(this._source.maxzoom);this._tiles[U[0].key]&&this._tiles[U[1].key]&&this._tiles[U[2].key]&&this._tiles[U[3].key]&&(S[U[0].key]=h[U[0].key]=U[0],S[U[1].key]=h[U[1].key]=U[1],S[U[2].key]=h[U[2].key]=U[2],S[U[3].key]=h[U[3].key]=U[3],delete k[F])}for(const F in k){const U=this.findLoadedParent(k[F],this._source.minzoom);if(U){S[U.tileID.key]=h[U.tileID.key]=U.tileID;for(const H in S)S[H].isChildOf(U.tileID)&&delete S[H]}}for(const F in this._tiles)S[F]||(this._coveredTiles[F]=!0)}}for(const p in h)this._tiles[p].clearFadeHold();const A=l.ab(this._tiles,h);for(const p of A){const y=this._tiles[p];y.hasSymbolBuckets&&!y.holdingForFade()?y.setHoldDuration(this.map._fadeDuration):y.hasSymbolBuckets&&!y.symbolFadeFinished()||this._removeTile(p)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)}_updateRetainedTiles(n,d){const v={},w={},C=Math.max(d-_i.maxOverzooming,this._source.minzoom),B=Math.max(d+_i.maxUnderzooming,this._source.minzoom),a={};for(const h of n){const A=this._addTile(h);v[h.key]=h,A.hasData()||d<this._source.maxzoom&&(a[h.key]=h)}this._retainLoadedChildren(a,d,B,v);for(const h of n){let A=this._tiles[h.key];if(A.hasData())continue;if(d+1>this._source.maxzoom){const y=h.children(this._source.maxzoom)[0],b=this.getTile(y);if(b&&b.hasData()){v[y.key]=y;continue}}else{const y=h.children(this._source.maxzoom);if(v[y[0].key]&&v[y[1].key]&&v[y[2].key]&&v[y[3].key])continue}let p=A.wasRequested();for(let y=h.overscaledZ-1;y>=C;--y){const b=h.scaledTo(y);if(w[b.key])break;if(w[b.key]=!0,A=this.getTile(b),!A&&p&&(A=this._addTile(b)),A){const T=A.hasData();if((p||T)&&(v[b.key]=b),p=A.wasRequested(),T)break}}}return v}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const d=[];let v,w=this._tiles[n].tileID;for(;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){v=this._loadedParentTiles[w.key];break}d.push(w.key);const C=w.scaledTo(w.overscaledZ-1);if(v=this._getLoadedTile(C),v)break;w=C}for(const C of d)this._loadedParentTiles[C]=v}}_addTile(n){let d=this._tiles[n.key];if(d)return d;d=this._cache.getAndRemove(n),d&&(this._setTileReloadTimer(n.key,d),d.tileID=n,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,d)));const v=d;return d||(d=new Ur(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,n.key,d.state))),d.uses++,this._tiles[n.key]=d,v||this._source.fire(new l.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(n,d){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const v=d.getExpiryTimeout();v&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},v))}_removeTile(n){const d=this._tiles[n];d&&(d.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,d,v){const w=[],C=this.transform;if(!C)return w;const B=v?C.getCameraQueryGeometry(n):n,a=n.map(S=>C.pointCoordinate(S,this.terrain)),h=B.map(S=>C.pointCoordinate(S,this.terrain)),A=this.getIds();let p=1/0,y=1/0,b=-1/0,T=-1/0;for(const S of h)p=Math.min(p,S.x),y=Math.min(y,S.y),b=Math.max(b,S.x),T=Math.max(T,S.y);for(let S=0;S<A.length;S++){const k=this._tiles[A[S]];if(k.holdingForFade())continue;const F=k.tileID,U=Math.pow(2,C.zoom-k.tileID.overscaledZ),H=d*k.queryPadding*l.N/k.tileSize/U,W=[F.getTilePoint(new l.U(p,y)),F.getTilePoint(new l.U(b,T))];if(W[0].x-H<l.N&&W[0].y-H<l.N&&W[1].x+H>=0&&W[1].y+H>=0){const Y=a.map(se=>F.getTilePoint(se)),G=h.map(se=>F.getTilePoint(se));w.push({tile:k,tileID:F,queryGeometry:Y,cameraQueryGeometry:G,scale:U})}}return w}getVisibleCoordinates(n){const d=this.getRenderableIds(n).map(v=>this._tiles[v].tileID);for(const v of d)v.posMatrix=this.transform.calculatePosMatrix(v.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(vi(this._source.type)){const n=l.h.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=n)return!0}return!1}setFeatureState(n,d,v){this._state.updateState(n=n||"_geojsonTileLayer",d,v)}removeFeatureState(n,d,v){this._state.removeFeatureState(n=n||"_geojsonTileLayer",d,v)}getFeatureState(n,d){return this._state.getState(n=n||"_geojsonTileLayer",d)}setDependencies(n,d,v){const w=this._tiles[n];w&&w.setDependencies(d,v)}reloadTilesForDependencies(n,d){for(const v in this._tiles)this._tiles[v].hasDependency(n,d)&&this._reloadTile(v,"reloading");this._cache.filter(v=>!v.hasDependency(n,d))}}function Br(E,n){const d=Math.abs(2*E.wrap)-+(E.wrap<0),v=Math.abs(2*n.wrap)-+(n.wrap<0);return E.overscaledZ-n.overscaledZ||v-d||n.canonical.y-E.canonical.y||n.canonical.x-E.canonical.x}function vi(E){return E==="raster"||E==="image"||E==="video"}_i.maxOverzooming=10,_i.maxUnderzooming=3;const oi="mapboxgl_preloaded_worker_pool";class Zr{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Zr.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[oi]}numActive(){return Object.keys(this.active).length}}const In=Math.floor(l.h.hardwareConcurrency/2);let ys;function Mn(){return ys||(ys=new Zr),ys}Zr.workerCount=l.ac(globalThis)?Math.max(Math.min(In,3),1):1;class tn{constructor(n,d){this.reset(n,d)}reset(n,d){this.points=n||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=l.ad(n,0,1);let d=1,v=this._distances[d];const w=n*this.paddedLength+this.padding;for(;v<w&&d<this._distances.length;)v=this._distances[++d];const C=d-1,B=this._distances[C],a=v-B,h=a>0?(w-B)/a:0;return this.points[C].mult(1-h).add(this.points[d].mult(h))}}function Ns(E,n){let d=!0;return E==="always"||E!=="never"&&n!=="never"||(d=!1),d}class bs{constructor(n,d,v){const w=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(n/v),this.yCellCount=Math.ceil(d/v);for(let B=0;B<this.xCellCount*this.yCellCount;B++)w.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=d,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,d,v,w,C){this._forEachCell(d,v,w,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(d),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(C)}insertCircle(n,d,v,w){this._forEachCell(d-w,v-w,d+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(d),this.circles.push(v),this.circles.push(w)}_insertBoxCell(n,d,v,w,C,B){this.boxCells[C].push(B)}_insertCircleCell(n,d,v,w,C,B){this.circleCells[C].push(B)}_query(n,d,v,w,C,B,a){if(v<0||n>this.width||w<0||d>this.height)return[];const h=[];if(n<=0&&d<=0&&this.width<=v&&this.height<=w){if(C)return[{key:null,x1:n,y1:d,x2:v,y2:w}];for(let A=0;A<this.boxKeys.length;A++)h.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const p=this.circles[3*A],y=this.circles[3*A+1],b=this.circles[3*A+2];h.push({key:this.circleKeys[A],x1:p-b,y1:y-b,x2:p+b,y2:y+b})}}else this._forEachCell(n,d,v,w,this._queryCell,h,{hitTest:C,overlapMode:B,seenUids:{box:{},circle:{}}},a);return h}query(n,d,v,w){return this._query(n,d,v,w,!1,null)}hitTest(n,d,v,w,C,B){return this._query(n,d,v,w,!0,C,B).length>0}hitTestCircle(n,d,v,w,C){const B=n-v,a=n+v,h=d-v,A=d+v;if(a<0||B>this.width||A<0||h>this.height)return!1;const p=[];return this._forEachCell(B,h,a,A,this._queryCellCircle,p,{hitTest:!0,overlapMode:w,circle:{x:n,y:d,radius:v},seenUids:{box:{},circle:{}}},C),p.length>0}_queryCell(n,d,v,w,C,B,a,h){const{seenUids:A,hitTest:p,overlapMode:y}=a,b=this.boxCells[C];if(b!==null){const S=this.bboxes;for(const k of b)if(!A.box[k]){A.box[k]=!0;const F=4*k,U=this.boxKeys[k];if(n<=S[F+2]&&d<=S[F+3]&&v>=S[F+0]&&w>=S[F+1]&&(!h||h(U))&&(!p||!Ns(y,U.overlapMode))&&(B.push({key:U,x1:S[F],y1:S[F+1],x2:S[F+2],y2:S[F+3]}),p))return!0}}const T=this.circleCells[C];if(T!==null){const S=this.circles;for(const k of T)if(!A.circle[k]){A.circle[k]=!0;const F=3*k,U=this.circleKeys[k];if(this._circleAndRectCollide(S[F],S[F+1],S[F+2],n,d,v,w)&&(!h||h(U))&&(!p||!Ns(y,U.overlapMode))){const H=S[F],W=S[F+1],Y=S[F+2];if(B.push({key:U,x1:H-Y,y1:W-Y,x2:H+Y,y2:W+Y}),p)return!0}}}return!1}_queryCellCircle(n,d,v,w,C,B,a,h){const{circle:A,seenUids:p,overlapMode:y}=a,b=this.boxCells[C];if(b!==null){const S=this.bboxes;for(const k of b)if(!p.box[k]){p.box[k]=!0;const F=4*k,U=this.boxKeys[k];if(this._circleAndRectCollide(A.x,A.y,A.radius,S[F+0],S[F+1],S[F+2],S[F+3])&&(!h||h(U))&&!Ns(y,U.overlapMode))return B.push(!0),!0}}const T=this.circleCells[C];if(T!==null){const S=this.circles;for(const k of T)if(!p.circle[k]){p.circle[k]=!0;const F=3*k,U=this.circleKeys[k];if(this._circlesCollide(S[F],S[F+1],S[F+2],A.x,A.y,A.radius)&&(!h||h(U))&&!Ns(y,U.overlapMode))return B.push(!0),!0}}}_forEachCell(n,d,v,w,C,B,a,h){const A=this._convertToXCellCoord(n),p=this._convertToYCellCoord(d),y=this._convertToXCellCoord(v),b=this._convertToYCellCoord(w);for(let T=A;T<=y;T++)for(let S=p;S<=b;S++)if(C.call(this,n,d,v,w,this.xCellCount*S+T,B,a,h))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,d,v,w,C,B){const a=w-n,h=C-d,A=v+B;return A*A>a*a+h*h}_circleAndRectCollide(n,d,v,w,C,B,a){const h=(B-w)/2,A=Math.abs(n-(w+h));if(A>h+v)return!1;const p=(a-C)/2,y=Math.abs(d-(C+p));if(y>p+v)return!1;if(A<=h||y<=p)return!0;const b=A-h,T=y-p;return b*b+T*T<=v*v}}function st(E,n,d,v,w){const C=l.Z();return n?(l.a0(C,C,[1/w,1/w,1]),d||l.ae(C,C,v.angle)):l.a1(C,v.labelPlaneMatrix,E),C}function vs(E,n,d,v,w){if(n){const C=l.af(E);return l.a0(C,C,[w,w,1]),d||l.ae(C,C,-v.angle),C}return v.glCoordMatrix}function Ui(E,n,d){let v;d?(v=[E.x,E.y,d(E.x,E.y),1],l.ag(v,v,n)):(v=[E.x,E.y,0,1],pe(v,v,n));const w=v[3];return{point:new l.P(v[0]/w,v[1]/w),signedDistanceFromCamera:w}}function hn(E,n){return .5+E/n*.5}function xs(E,n){const d=E[0]/E[3],v=E[1]/E[3];return d>=-n[0]&&d<=n[0]&&v>=-n[1]&&v<=n[1]}function nt(E,n,d,v,w,C,B,a,h,A){const p=v?E.textSizeData:E.iconSizeData,y=l.ah(p,d.transform.zoom),b=[256/d.width*2+1,256/d.height*2+1],T=v?E.text.dynamicLayoutVertexArray:E.icon.dynamicLayoutVertexArray;T.clear();const S=E.lineVertexArray,k=v?E.text.placedSymbolArray:E.icon.placedSymbolArray,F=d.transform.width/d.transform.height;let U=!1;for(let H=0;H<k.length;H++){const W=k.get(H);if(W.hidden||W.writingMode===l.ai.vertical&&!U){ae(W.numGlyphs,T);continue}let Y;if(U=!1,A?(Y=[W.anchorX,W.anchorY,A(W.anchorX,W.anchorY),1],l.ag(Y,Y,n)):(Y=[W.anchorX,W.anchorY,0,1],pe(Y,Y,n)),!xs(Y,b)){ae(W.numGlyphs,T);continue}const G=hn(d.transform.cameraToCenterDistance,Y[3]),se=l.aj(p,y,W),me=B?se/G:se*G,Te=new l.P(W.anchorX,W.anchorY),de=Ui(Te,w,A).point,be={projections:{},offsets:{}},ve=Ar(W,me,!1,a,n,w,C,E.glyphOffsetArray,S,T,de,Te,be,F,h,A);U=ve.useVertical,(ve.notEnoughRoom||U||ve.needsFlipping&&Ar(W,me,!0,a,n,w,C,E.glyphOffsetArray,S,T,de,Te,be,F,h,A).notEnoughRoom)&&ae(W.numGlyphs,T)}v?E.text.dynamicLayoutVertexBuffer.updateData(T):E.icon.dynamicLayoutVertexBuffer.updateData(T)}function Yt(E,n,d,v,w,C,B,a,h,A,p,y,b){const T=a.glyphStartIndex+a.numGlyphs,S=a.lineStartIndex,k=a.lineStartIndex+a.lineLength,F=n.getoffsetX(a.glyphStartIndex),U=n.getoffsetX(T-1),H=X(E*F,d,v,w,C,B,a.segment,S,k,h,A,p,y,b);if(!H)return null;const W=X(E*U,d,v,w,C,B,a.segment,S,k,h,A,p,y,b);return W?{first:H,last:W}:null}function Xt(E,n,d,v){return E===l.ai.horizontal&&Math.abs(d.y-n.y)>Math.abs(d.x-n.x)*v?{useVertical:!0}:(E===l.ai.vertical?n.y<d.y:n.x>d.x)?{needsFlipping:!0}:null}function Ar(E,n,d,v,w,C,B,a,h,A,p,y,b,T,S,k){const F=n/24,U=E.lineOffsetX*F,H=E.lineOffsetY*F;let W;if(E.numGlyphs>1){const Y=E.glyphStartIndex+E.numGlyphs,G=E.lineStartIndex,se=E.lineStartIndex+E.lineLength,me=Yt(F,a,U,H,d,p,y,E,h,C,b,S,k);if(!me)return{notEnoughRoom:!0};const Te=Ui(me.first.point,B,k).point,de=Ui(me.last.point,B,k).point;if(v&&!d){const be=Xt(E.writingMode,Te,de,T);if(be)return be}W=[me.first];for(let be=E.glyphStartIndex+1;be<Y-1;be++)W.push(X(F*a.getoffsetX(be),U,H,d,p,y,E.segment,G,se,h,C,b,S,k));W.push(me.last)}else{if(v&&!d){const G=Ui(y,w,k).point,se=E.lineStartIndex+E.segment+1,me=new l.P(h.getx(se),h.gety(se)),Te=Ui(me,w,k),de=Te.signedDistanceFromCamera>0?Te.point:ns(y,me,G,1,w,k),be=Xt(E.writingMode,G,de,T);if(be)return be}const Y=X(F*a.getoffsetX(E.glyphStartIndex),U,H,d,p,y,E.segment,E.lineStartIndex,E.lineStartIndex+E.lineLength,h,C,b,S,k);if(!Y)return{notEnoughRoom:!0};W=[Y]}for(const Y of W)l.ak(A,Y.point,Y.angle);return{}}function ns(E,n,d,v,w,C){const B=Ui(E.add(E.sub(n)._unit()),w,C).point,a=d.sub(B);return d.add(a._mult(v/a.mag()))}function Gt(E,n){const{projectionCache:d,lineVertexArray:v,labelPlaneMatrix:w,tileAnchorPoint:C,distanceFromAnchor:B,getElevation:a,previousVertex:h,direction:A,absOffsetX:p}=n;if(d.projections[E])return d.projections[E];const y=new l.P(v.getx(E),v.gety(E)),b=Ui(y,w,a);if(b.signedDistanceFromCamera>0)return d.projections[E]=b.point,b.point;const T=E-A;return ns(B===0?C:new l.P(v.getx(T),v.gety(T)),y,h,p-B+1,w,a)}function Ke(E,n,d){return E._unit()._perp()._mult(n*d)}function fe(E,n,d,v,w,C,B,a){const{projectionCache:h,direction:A}=a;if(h.offsets[E])return h.offsets[E];const p=d.add(n);if(E+A<v||E+A>=w)return h.offsets[E]=p,p;const y=Gt(E+A,a),b=Ke(y.sub(d),B,A),T=d.add(b),S=y.add(b);return h.offsets[E]=l.al(C,p,T,S)||p,h.offsets[E]}function X(E,n,d,v,w,C,B,a,h,A,p,y,b,T){const S=v?E-n:E+n;let k=S>0?1:-1,F=0;v&&(k*=-1,F=Math.PI),k<0&&(F+=Math.PI);let U,H,W=k>0?a+B:a+B+1,Y=w,G=w,se=0,me=0;const Te=Math.abs(S),de=[];let be;for(;se+me<=Te;){if(W+=k,W<a||W>=h)return null;se+=me,G=Y,H=U;const je={projectionCache:y,lineVertexArray:A,labelPlaneMatrix:p,tileAnchorPoint:C,distanceFromAnchor:se,getElevation:T,previousVertex:G,direction:k,absOffsetX:Te};if(Y=Gt(W,je),d===0)de.push(G),be=Y.sub(G);else{let He;const $e=Y.sub(G);He=$e.mag()===0?Ke(Gt(W+k,je).sub(Y),d,k):Ke($e,d,k),H||(H=G.add(He)),U=fe(W,He,Y,a,h,H,d,je),de.push(H),be=U.sub(H)}me=be.mag()}const ve=be._mult((Te-se)/me)._add(H||G),Ye=F+Math.atan2(Y.y-G.y,Y.x-G.x);return de.push(ve),{point:ve,angle:b?Ye:0,path:de}}const Q=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ae(E,n){for(let d=0;d<E;d++){const v=n.length;n.resize(v+4),n.float32.set(Q,3*v)}}function pe(E,n,d){const v=n[0],w=n[1];return E[0]=d[0]*v+d[4]*w+d[12],E[1]=d[1]*v+d[5]*w+d[13],E[3]=d[3]*v+d[7]*w+d[15],E}const ge=100;class ke{constructor(n,d=new bs(n.width+200,n.height+200,25),v=new bs(n.width+200,n.height+200,25)){this.transform=n,this.grid=d,this.ignoredGrid=v,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+ge,this.screenBottomBoundary=n.height+ge,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(n,d,v,w,C,B){const a=this.projectAndGetPerspectiveRatio(w,n.anchorPointX,n.anchorPointY,B),h=v*a.perspectiveRatio,A=n.x1*h+a.point.x,p=n.y1*h+a.point.y,y=n.x2*h+a.point.x,b=n.y2*h+a.point.y;return!this.isInsideGrid(A,p,y,b)||d!=="always"&&this.grid.hitTest(A,p,y,b,d,C)||a.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,p,y,b],offscreen:this.isOffscreen(A,p,y,b)}}placeCollisionCircles(n,d,v,w,C,B,a,h,A,p,y,b,T,S){const k=[],F=new l.P(d.anchorX,d.anchorY),U=Ui(F,B,S),H=hn(this.transform.cameraToCenterDistance,U.signedDistanceFromCamera),W=(p?C/H:C*H)/l.ap,Y=Ui(F,a,S).point,G=Yt(W,w,d.lineOffsetX*W,d.lineOffsetY*W,!1,Y,F,d,v,a,{projections:{},offsets:{}},!1,S);let se=!1,me=!1,Te=!0;if(G){const de=.5*b*H+T,be=new l.P(-100,-100),ve=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Ye=new tn,je=G.first,He=G.last;let $e=[];for(let mt=je.path.length-1;mt>=1;mt--)$e.push(je.path[mt]);for(let mt=1;mt<He.path.length;mt++)$e.push(He.path[mt]);const zt=2.5*de;if(h){const mt=$e.map(pt=>Ui(pt,h,S));$e=mt.some(pt=>pt.signedDistanceFromCamera<=0)?[]:mt.map(pt=>pt.point)}let vt=[];if($e.length>0){const mt=$e[0].clone(),pt=$e[0].clone();for(let Mt=1;Mt<$e.length;Mt++)mt.x=Math.min(mt.x,$e[Mt].x),mt.y=Math.min(mt.y,$e[Mt].y),pt.x=Math.max(pt.x,$e[Mt].x),pt.y=Math.max(pt.y,$e[Mt].y);vt=mt.x>=be.x&&pt.x<=ve.x&&mt.y>=be.y&&pt.y<=ve.y?[$e]:pt.x<be.x||mt.x>ve.x||pt.y<be.y||mt.y>ve.y?[]:l.am([$e],be.x,be.y,ve.x,ve.y)}for(const mt of vt){Ye.reset(mt,.25*de);let pt=0;pt=Ye.length<=.5*de?1:Math.ceil(Ye.paddedLength/zt)+1;for(let Mt=0;Mt<pt;Mt++){const St=Mt/Math.max(pt-1,1),ti=Ye.lerp(St),kt=ti.x+ge,Jt=ti.y+ge;k.push(kt,Jt,de,0);const Fi=kt-de,Oi=Jt-de,On=kt+de,Ln=Jt+de;if(Te=Te&&this.isOffscreen(Fi,Oi,On,Ln),me=me||this.isInsideGrid(Fi,Oi,On,Ln),n!=="always"&&this.grid.hitTestCircle(kt,Jt,de,n,y)&&(se=!0,!A))return{circles:[],offscreen:!1,collisionDetected:se}}}}return{circles:!A&&se||!me||H<this.perspectiveRatioCutoff?[]:k,offscreen:Te,collisionDetected:se}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let v=1/0,w=1/0,C=-1/0,B=-1/0;for(const p of n){const y=new l.P(p.x+ge,p.y+ge);v=Math.min(v,y.x),w=Math.min(w,y.y),C=Math.max(C,y.x),B=Math.max(B,y.y),d.push(y)}const a=this.grid.query(v,w,C,B).concat(this.ignoredGrid.query(v,w,C,B)),h={},A={};for(const p of a){const y=p.key;if(h[y.bucketInstanceId]===void 0&&(h[y.bucketInstanceId]={}),h[y.bucketInstanceId][y.featureIndex])continue;const b=[new l.P(p.x1,p.y1),new l.P(p.x2,p.y1),new l.P(p.x2,p.y2),new l.P(p.x1,p.y2)];l.an(d,b)&&(h[y.bucketInstanceId][y.featureIndex]=!0,A[y.bucketInstanceId]===void 0&&(A[y.bucketInstanceId]=[]),A[y.bucketInstanceId].push(y.featureIndex))}return A}insertCollisionBox(n,d,v,w,C,B){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:w,featureIndex:C,collisionGroupID:B,overlapMode:d},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,d,v,w,C,B){const a=v?this.ignoredGrid:this.grid,h={bucketInstanceId:w,featureIndex:C,collisionGroupID:B,overlapMode:d};for(let A=0;A<n.length;A+=4)a.insertCircle(h,n[A],n[A+1],n[A+2])}projectAndGetPerspectiveRatio(n,d,v,w){let C;return w?(C=[d,v,w(d,v),1],l.ag(C,C,n)):(C=[d,v,0,1],pe(C,C,n)),{point:new l.P((C[0]/C[3]+1)/2*this.transform.width+ge,(-C[1]/C[3]+1)/2*this.transform.height+ge),perspectiveRatio:.5+this.transform.cameraToCenterDistance/C[3]*.5}}isOffscreen(n,d,v,w){return v<ge||n>=this.screenRightBoundary||w<ge||d>this.screenBottomBoundary}isInsideGrid(n,d,v,w){return v>=0&&n<this.gridRightBoundary&&w>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const n=l.ao([]);return l.$(n,n,[-100,-100,0]),n}}function Pe(E,n,d){return n*(l.N/(E.tileSize*Math.pow(2,d-E.tileID.overscaledZ)))}class ye{constructor(n,d,v,w){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?d:-d))):w&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class Me{constructor(n,d,v,w,C){this.text=new ye(n?n.text:null,d,v,C),this.icon=new ye(n?n.icon:null,d,w,C)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class qe{constructor(n,d,v){this.text=n,this.icon=d,this.skipFade=v}}class ue{constructor(){this.invProjMatrix=l.Z(),this.viewportMatrix=l.Z(),this.circles=[]}}class Se{constructor(n,d,v,w,C){this.bucketInstanceId=n,this.featureIndex=d,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=C}}class We{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const d=++this.maxGroupID;this.collisionGroups[n]={ID:d,predicate:v=>v.collisionGroupID===d}}return this.collisionGroups[n]}}function et(E,n,d,v,w){const{horizontalAlign:C,verticalAlign:B}=l.au(E);return new l.P(-(C-.5)*n+v[0]*w,-(B-.5)*d+v[1]*w)}function g(E,n,d,v,w,C){const{x1:B,x2:a,y1:h,y2:A,anchorPointX:p,anchorPointY:y}=E,b=new l.P(n,d);return v&&b._rotate(w?C:-C),{x1:B+b.x,y1:h+b.y,x2:a+b.x,y2:A+b.y,anchorPointX:p,anchorPointY:y}}class K{constructor(n,d,v,w,C){this.transform=n.clone(),this.terrain=d,this.collisionIndex=new ke(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=v,this.retainedQueryData={},this.collisionGroups=new We(w),this.collisionCircleArrays={},this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,d,v,w){const C=v.getBucket(d),B=v.latestFeatureIndex;if(!C||!B||d.id!==C.layerIds[0])return;const a=v.collisionBoxArray,h=C.layers[0].layout,A=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),p=v.tileSize/l.N,y=this.transform.calculatePosMatrix(v.tileID.toUnwrapped()),b=h.get("text-pitch-alignment")==="map",T=h.get("text-rotation-alignment")==="map",S=Pe(v,1,this.transform.zoom),k=st(y,b,T,this.transform,S);let F=null;if(b){const H=vs(y,b,T,this.transform,S);F=l.a1([],this.transform.labelPlaneMatrix,H)}this.retainedQueryData[C.bucketInstanceId]=new Se(C.bucketInstanceId,B,C.sourceLayerIndex,C.index,v.tileID);const U={bucket:C,layout:h,posMatrix:y,textLabelPlaneMatrix:k,labelToScreenMatrix:F,scale:A,textPixelRatio:p,holdingForFade:v.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:l.ah(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(w)for(const H of C.sortKeyRanges){const{sortKey:W,symbolInstanceStart:Y,symbolInstanceEnd:G}=H;n.push({sortKey:W,symbolInstanceStart:Y,symbolInstanceEnd:G,parameters:U})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:U})}attemptAnchorPlacement(n,d,v,w,C,B,a,h,A,p,y,b,T,S,k,F){const U=l.aq[n.textAnchor],H=[n.textOffset0,n.textOffset1],W=et(U,v,w,H,C),Y=this.collisionIndex.placeCollisionBox(g(d,W.x,W.y,B,a,this.transform.angle),y,h,A,p.predicate,F);if((!k||this.collisionIndex.placeCollisionBox(g(k,W.x,W.y,B,a,this.transform.angle),y,h,A,p.predicate,F).box.length!==0)&&Y.box.length>0){let G;if(this.prevPlacement&&this.prevPlacement.variableOffsets[b.crossTileID]&&this.prevPlacement.placements[b.crossTileID]&&this.prevPlacement.placements[b.crossTileID].text&&(G=this.prevPlacement.variableOffsets[b.crossTileID].anchor),b.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[b.crossTileID]={textOffset:H,width:v,height:w,anchor:U,textBoxScale:C,prevAnchor:G},this.markUsedJustification(T,U,b,S),T.allowVerticalPlacement&&(this.markUsedOrientation(T,S,b),this.placedOrientations[b.crossTileID]=S),{shift:W,placedGlyphBoxes:Y}}}placeLayerBucketPart(n,d,v){const{bucket:w,layout:C,posMatrix:B,textLabelPlaneMatrix:a,labelToScreenMatrix:h,textPixelRatio:A,holdingForFade:p,collisionBoxArray:y,partiallyEvaluatedTextSize:b,collisionGroup:T}=n.parameters,S=C.get("text-optional"),k=C.get("icon-optional"),F=l.ar(C,"text-overlap","text-allow-overlap"),U=F==="always",H=l.ar(C,"icon-overlap","icon-allow-overlap"),W=H==="always",Y=C.get("text-rotation-alignment")==="map",G=C.get("text-pitch-alignment")==="map",se=C.get("icon-text-fit")!=="none",me=C.get("symbol-z-order")==="viewport-y",Te=U&&(W||!w.hasIconData()||k),de=W&&(U||!w.hasTextData()||S);!w.collisionArrays&&y&&w.deserializeCollisionBoxes(y);const be=this.retainedQueryData[w.bucketInstanceId].tileID,ve=this.terrain?(je,He)=>this.terrain.getElevation(be,je,He):null,Ye=(je,He)=>{var $e,zt;if(d[je.crossTileID])return;if(p)return void(this.placements[je.crossTileID]=new qe(!1,!1,!1));let vt=!1,mt=!1,pt=!0,Mt=null,St={box:null,offscreen:null},ti={box:null,offscreen:null},kt=null,Jt=null,Fi=null,Oi=0,On=0,Ln=0;He.textFeatureIndex?Oi=He.textFeatureIndex:je.useRuntimeCollisionCircles&&(Oi=je.featureIndex),He.verticalTextFeatureIndex&&(On=He.verticalTextFeatureIndex);const Do=He.textBox;if(Do){const es=or=>{let Sr=l.ai.horizontal;if(w.allowVerticalPlacement&&!or&&this.prevPlacement){const Cs=this.prevPlacement.placedOrientations[je.crossTileID];Cs&&(this.placedOrientations[je.crossTileID]=Cs,Sr=Cs,this.markUsedOrientation(w,Sr,je))}return Sr},Hr=(or,Sr)=>{if(w.allowVerticalPlacement&&je.numVerticalGlyphVertices>0&&He.verticalTextBox){for(const Cs of w.writingModes)if(Cs===l.ai.vertical?(St=Sr(),ti=St):St=or(),St&&St.box&&St.box.length)break}else St=or()},cs=je.textAnchorOffsetStartIndex,ua=je.textAnchorOffsetEndIndex;if(ua===cs){const or=(Sr,Cs)=>{const ar=this.collisionIndex.placeCollisionBox(Sr,F,A,B,T.predicate,ve);return ar&&ar.box&&ar.box.length&&(this.markUsedOrientation(w,Cs,je),this.placedOrientations[je.crossTileID]=Cs),ar};Hr(()=>or(Do,l.ai.horizontal),()=>{const Sr=He.verticalTextBox;return w.allowVerticalPlacement&&je.numVerticalGlyphVertices>0&&Sr?or(Sr,l.ai.vertical):{box:null,offscreen:null}}),es(St&&St.box&&St.box.length)}else{let or=l.aq[(zt=($e=this.prevPlacement)===null||$e===void 0?void 0:$e.variableOffsets[je.crossTileID])===null||zt===void 0?void 0:zt.anchor];const Sr=(ar,Aa,Fc)=>{const eA=ar.x2-ar.x1,tA=ar.y2-ar.y1,dd=je.textBoxScale,Vh=se&&H==="never"?Aa:null;let Nn={box:[],offscreen:!1},fa=F==="never"?1:2,zn="never";or&&fa++;for(let on=0;on<fa;on++){for(let Un=cs;Un<ua;Un++){const jh=w.textAnchorOffsets.get(Un);if(or&&jh.textAnchor!==or)continue;const ro=this.attemptAnchorPlacement(jh,ar,eA,tA,dd,Y,G,A,B,T,zn,je,w,Fc,Vh,ve);if(ro&&(Nn=ro.placedGlyphBoxes,Nn&&Nn.box&&Nn.box.length))return vt=!0,Mt=ro.shift,Nn}or?or=null:zn=F}return Nn};Hr(()=>Sr(Do,He.iconBox,l.ai.horizontal),()=>{const ar=He.verticalTextBox;return w.allowVerticalPlacement&&!(St&&St.box&&St.box.length)&&je.numVerticalGlyphVertices>0&&ar?Sr(ar,He.verticalIconBox,l.ai.vertical):{box:null,offscreen:null}}),St&&(vt=St.box,pt=St.offscreen);const Cs=es(St&&St.box);if(!vt&&this.prevPlacement){const ar=this.prevPlacement.variableOffsets[je.crossTileID];ar&&(this.variableOffsets[je.crossTileID]=ar,this.markUsedJustification(w,ar.anchor,je,Cs))}}}if(kt=St,vt=kt&&kt.box&&kt.box.length>0,pt=kt&&kt.offscreen,je.useRuntimeCollisionCircles){const es=w.text.placedSymbolArray.get(je.centerJustifiedTextSymbolIndex),Hr=l.aj(w.textSizeData,b,es),cs=C.get("text-padding");Jt=this.collisionIndex.placeCollisionCircles(F,es,w.lineVertexArray,w.glyphOffsetArray,Hr,B,a,h,v,G,T.predicate,je.collisionCircleDiameter,cs,ve),Jt.circles.length&&Jt.collisionDetected&&!v&&l.w("Collisions detected, but collision boxes are not shown"),vt=U||Jt.circles.length>0&&!Jt.collisionDetected,pt=pt&&Jt.offscreen}if(He.iconFeatureIndex&&(Ln=He.iconFeatureIndex),He.iconBox){const es=Hr=>{const cs=se&&Mt?g(Hr,Mt.x,Mt.y,Y,G,this.transform.angle):Hr;return this.collisionIndex.placeCollisionBox(cs,H,A,B,T.predicate,ve)};ti&&ti.box&&ti.box.length&&He.verticalIconBox?(Fi=es(He.verticalIconBox),mt=Fi.box.length>0):(Fi=es(He.iconBox),mt=Fi.box.length>0),pt=pt&&Fi.offscreen}const ha=S||je.numHorizontalGlyphVertices===0&&je.numVerticalGlyphVertices===0,Wa=k||je.numIconVertices===0;if(ha||Wa?Wa?ha||(mt=mt&&vt):vt=mt&&vt:mt=vt=mt&&vt,vt&&kt&&kt.box&&this.collisionIndex.insertCollisionBox(kt.box,F,C.get("text-ignore-placement"),w.bucketInstanceId,ti&&ti.box&&On?On:Oi,T.ID),mt&&Fi&&this.collisionIndex.insertCollisionBox(Fi.box,H,C.get("icon-ignore-placement"),w.bucketInstanceId,Ln,T.ID),Jt&&(vt&&this.collisionIndex.insertCollisionCircles(Jt.circles,F,C.get("text-ignore-placement"),w.bucketInstanceId,Oi,T.ID),v)){const es=w.bucketInstanceId;let Hr=this.collisionCircleArrays[es];Hr===void 0&&(Hr=this.collisionCircleArrays[es]=new ue);for(let cs=0;cs<Jt.circles.length;cs+=4)Hr.circles.push(Jt.circles[cs+0]),Hr.circles.push(Jt.circles[cs+1]),Hr.circles.push(Jt.circles[cs+2]),Hr.circles.push(Jt.collisionDetected?1:0)}if(je.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(w.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[je.crossTileID]=new qe(vt||Te,mt||de,pt||w.justReloaded),d[je.crossTileID]=!0};if(me){if(n.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const je=w.getSortedSymbolIndexes(this.transform.angle);for(let He=je.length-1;He>=0;--He){const $e=je[He];Ye(w.symbolInstances.get($e),w.collisionArrays[$e])}}else for(let je=n.symbolInstanceStart;je<n.symbolInstanceEnd;je++)Ye(w.symbolInstances.get(je),w.collisionArrays[je]);if(v&&w.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[w.bucketInstanceId];l.as(je.invProjMatrix,B),je.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(n,d,v,w){let C;C=w===l.ai.vertical?v.verticalPlacedTextSymbolIndex:{left:v.leftJustifiedTextSymbolIndex,center:v.centerJustifiedTextSymbolIndex,right:v.rightJustifiedTextSymbolIndex}[l.at(d)];const B=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex,v.verticalPlacedTextSymbolIndex];for(const a of B)a>=0&&(n.text.placedSymbolArray.get(a).crossTileID=C>=0&&a!==C?0:v.crossTileID)}markUsedOrientation(n,d,v){const w=d===l.ai.horizontal||d===l.ai.horizontalOnly?d:0,C=d===l.ai.vertical?d:0,B=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex];for(const a of B)n.text.placedSymbolArray.get(a).placedOrientation=w;v.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(v.verticalPlacedTextSymbolIndex).placedOrientation=C)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let v=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const w=d?d.symbolFadeChange(n):1,C=d?d.opacities:{},B=d?d.variableOffsets:{},a=d?d.placedOrientations:{};for(const h in this.placements){const A=this.placements[h],p=C[h];p?(this.opacities[h]=new Me(p,w,A.text,A.icon),v=v||A.text!==p.text.placed||A.icon!==p.icon.placed):(this.opacities[h]=new Me(null,w,A.text,A.icon,A.skipFade),v=v||A.text||A.icon)}for(const h in C){const A=C[h];if(!this.opacities[h]){const p=new Me(A,w,!1,!1);p.isHidden()||(this.opacities[h]=p,v=v||A.text.placed||A.icon.placed)}}for(const h in B)this.variableOffsets[h]||!this.opacities[h]||this.opacities[h].isHidden()||(this.variableOffsets[h]=B[h]);for(const h in a)this.placedOrientations[h]||!this.opacities[h]||this.opacities[h].isHidden()||(this.placedOrientations[h]=a[h]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");v?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:n)}updateLayerOpacities(n,d){const v={};for(const w of d){const C=w.getBucket(n);C&&w.latestFeatureIndex&&n.id===C.layerIds[0]&&this.updateBucketOpacities(C,v,w.collisionBoxArray)}}updateBucketOpacities(n,d,v){n.hasTextData()&&(n.text.opacityVertexArray.clear(),n.text.hasVisibleVertices=!1),n.hasIconData()&&(n.icon.opacityVertexArray.clear(),n.icon.hasVisibleVertices=!1),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const w=n.layers[0],C=w.layout,B=new Me(null,0,!1,!1,!0),a=C.get("text-allow-overlap"),h=C.get("icon-allow-overlap"),A=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),p=C.get("text-rotation-alignment")==="map",y=C.get("text-pitch-alignment")==="map",b=C.get("icon-text-fit")!=="none",T=new Me(null,0,a&&(h||!n.hasIconData()||C.get("icon-optional")),h&&(a||!n.hasTextData()||C.get("text-optional")),!0);!n.collisionArrays&&v&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(v);const S=(k,F,U)=>{for(let H=0;H<F/4;H++)k.opacityVertexArray.emplaceBack(U);k.hasVisibleVertices=k.hasVisibleVertices||U!==Tr};for(let k=0;k<n.symbolInstances.length;k++){const F=n.symbolInstances.get(k),{numHorizontalGlyphVertices:U,numVerticalGlyphVertices:H,crossTileID:W}=F;let Y=this.opacities[W];d[W]?Y=B:Y||(Y=T,this.opacities[W]=Y),d[W]=!0;const G=F.numIconVertices>0,se=this.placedOrientations[F.crossTileID],me=se===l.ai.vertical,Te=se===l.ai.horizontal||se===l.ai.horizontalOnly;if(U>0||H>0){const de=wi(Y.text);S(n.text,U,me?Tr:de),S(n.text,H,Te?Tr:de);const be=Y.text.isHidden();[F.rightJustifiedTextSymbolIndex,F.centerJustifiedTextSymbolIndex,F.leftJustifiedTextSymbolIndex].forEach(je=>{je>=0&&(n.text.placedSymbolArray.get(je).hidden=be||me?1:0)}),F.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(F.verticalPlacedTextSymbolIndex).hidden=be||Te?1:0);const ve=this.variableOffsets[F.crossTileID];ve&&this.markUsedJustification(n,ve.anchor,F,se);const Ye=this.placedOrientations[F.crossTileID];Ye&&(this.markUsedJustification(n,"left",F,Ye),this.markUsedOrientation(n,Ye,F))}if(G){const de=wi(Y.icon),be=!(b&&F.verticalPlacedIconSymbolIndex&&me);F.placedIconSymbolIndex>=0&&(S(n.icon,F.numIconVertices,be?de:Tr),n.icon.placedSymbolArray.get(F.placedIconSymbolIndex).hidden=Y.icon.isHidden()),F.verticalPlacedIconSymbolIndex>=0&&(S(n.icon,F.numVerticalIconVertices,be?Tr:de),n.icon.placedSymbolArray.get(F.verticalPlacedIconSymbolIndex).hidden=Y.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const de=n.collisionArrays[k];if(de){let be=new l.P(0,0);if(de.textBox||de.verticalTextBox){let Ye=!0;if(A){const je=this.variableOffsets[W];je?(be=et(je.anchor,je.width,je.height,je.textOffset,je.textBoxScale),p&&be._rotate(y?this.transform.angle:-this.transform.angle)):Ye=!1}de.textBox&&ut(n.textCollisionBox.collisionVertexArray,Y.text.placed,!Ye||me,be.x,be.y),de.verticalTextBox&&ut(n.textCollisionBox.collisionVertexArray,Y.text.placed,!Ye||Te,be.x,be.y)}const ve=!!(!Te&&de.verticalIconBox);de.iconBox&&ut(n.iconCollisionBox.collisionVertexArray,Y.icon.placed,ve,b?be.x:0,b?be.y:0),de.verticalIconBox&&ut(n.iconCollisionBox.collisionVertexArray,Y.icon.placed,!ve,b?be.x:0,b?be.y:0)}}}if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.text.opacityVertexArray.length!==n.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${n.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${n.text.layoutVertexArray.length}) / 4`);if(n.icon.opacityVertexArray.length!==n.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${n.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${n.icon.layoutVertexArray.length}) / 4`);if(n.bucketInstanceId in this.collisionCircleArrays){const k=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=k.invProjMatrix,n.placementViewportMatrix=k.viewportMatrix,n.collisionCircleArray=k.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,d){const v=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*v>n}setStale(){this.stale=!0}}function ut(E,n,d,v,w){E.emplaceBack(n?1:0,d?1:0,v||0,w||0),E.emplaceBack(n?1:0,d?1:0,v||0,w||0),E.emplaceBack(n?1:0,d?1:0,v||0,w||0),E.emplaceBack(n?1:0,d?1:0,v||0,w||0)}const Bt=Math.pow(2,25),Zt=Math.pow(2,24),ft=Math.pow(2,17),yt=Math.pow(2,16),Si=Math.pow(2,9),Lt=Math.pow(2,8),Rt=Math.pow(2,1);function wi(E){if(E.opacity===0&&!E.placed)return 0;if(E.opacity===1&&E.placed)return 4294967295;const n=E.placed?1:0,d=Math.floor(127*E.opacity);return d*Bt+n*Zt+d*ft+n*yt+d*Si+n*Lt+d*Rt+n}const Tr=0;class Xn{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,d,v,w,C){const B=this._bucketParts;for(;this._currentTileIndex<n.length;)if(d.getBucketParts(B,w,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,B.sort((a,h)=>a.sortKey-h.sortKey));this._currentPartIndex<B.length;)if(d.placeLayerBucketPart(B[this._currentPartIndex],this._seenCrossTileIDs,v),this._currentPartIndex++,C())return!0;return!1}}class tr{constructor(n,d,v,w,C,B,a,h){this.placement=new K(n,d,B,a,h),this._currentPlacementIndex=v.length-1,this._forceFullPlacement=w,this._showCollisionBoxes=C,this._done=!1}isDone(){return this._done}continuePlacement(n,d,v){const w=l.h.now(),C=()=>!this._forceFullPlacement&&l.h.now()-w>2;for(;this._currentPlacementIndex>=0;){const B=d[n[this._currentPlacementIndex]],a=this.placement.collisionIndex.transform.zoom;if(B.type==="symbol"&&(!B.minzoom||B.minzoom<=a)&&(!B.maxzoom||B.maxzoom>a)){if(this._inProgressLayer||(this._inProgressLayer=new Xn(B)),this._inProgressLayer.continuePlacement(v[B.source],this.placement,this._showCollisionBoxes,B,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Vi=512/l.N/2;class Vr{constructor(n,d,v){this.tileID=n,this.bucketInstanceId=v,this._symbolsByKey={};const w=new Map;for(let C=0;C<d.length;C++){const B=d.get(C),a=B.key,h=w.get(a);h?h.push(B):w.set(a,[B])}for(const[C,B]of w){const a={positions:B.map(h=>({x:Math.floor(h.anchorX*Vi),y:Math.floor(h.anchorY*Vi)})),crossTileIDs:B.map(h=>h.crossTileID)};if(a.positions.length>128){const h=new l.av(a.positions.length,16,Uint16Array);for(const{x:A,y:p}of a.positions)h.add(A,p);h.finish(),delete a.positions,a.index=h}this._symbolsByKey[C]=a}}getScaledCoordinates(n,d){const{x:v,y:w,z:C}=this.tileID.canonical,{x:B,y:a,z:h}=d.canonical,A=Vi/Math.pow(2,h-C),p=(a*l.N+n.anchorY)*A,y=w*l.N*Vi;return{x:Math.floor((B*l.N+n.anchorX)*A-v*l.N*Vi),y:Math.floor(p-y)}}findMatches(n,d,v){const w=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let C=0;C<n.length;C++){const B=n.get(C);if(B.crossTileID)continue;const a=this._symbolsByKey[B.key];if(!a)continue;const h=this.getScaledCoordinates(B,d);if(a.index){const A=a.index.range(h.x-w,h.y-w,h.x+w,h.y+w).sort();for(const p of A){const y=a.crossTileIDs[p];if(!v[y]){v[y]=!0,B.crossTileID=y;break}}}else if(a.positions)for(let A=0;A<a.positions.length;A++){const p=a.positions[A],y=a.crossTileIDs[A];if(Math.abs(p.x-h.x)<=w&&Math.abs(p.y-h.y)<=w&&!v[y]){v[y]=!0,B.crossTileID=y;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:n})=>n)}}class Qt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const d=Math.round((n-this.lng)/360);if(d!==0)for(const v in this.indexes){const w=this.indexes[v],C={};for(const B in w){const a=w[B];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+d),C[a.tileID.key]=a}this.indexes[v]=C}this.lng=n}addBucket(n,d,v){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let C=0;C<d.symbolInstances.length;C++)d.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const w=this.usedCrossTileIDs[n.overscaledZ];for(const C in this.indexes){const B=this.indexes[C];if(Number(C)>n.overscaledZ)for(const a in B){const h=B[a];h.tileID.isChildOf(n)&&h.findMatches(d.symbolInstances,n,w)}else{const a=B[n.scaledTo(Number(C)).key];a&&a.findMatches(d.symbolInstances,n,w)}}for(let C=0;C<d.symbolInstances.length;C++){const B=d.symbolInstances.get(C);B.crossTileID||(B.crossTileID=v.generate(),w[B.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Vr(n,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(n,d){for(const v of d.getCrossTileIDsLists())for(const w of v)delete this.usedCrossTileIDs[n][w]}removeStaleBuckets(n){let d=!1;for(const v in this.indexes){const w=this.indexes[v];for(const C in w)n[w[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[C]),delete w[C],d=!0)}return d}}class jr{constructor(){this.layerIndexes={},this.crossTileIDs=new Qt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,d,v){let w=this.layerIndexes[n.id];w===void 0&&(w=this.layerIndexes[n.id]=new zs);let C=!1;const B={};w.handleWrapJump(v);for(const a of d){const h=a.getBucket(n);h&&n.id===h.layerIds[0]&&(h.bucketInstanceId||(h.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(a.tileID,h,this.crossTileIDs)&&(C=!0),B[h.bucketInstanceId]=!0)}return w.removeStaleBuckets(B)&&(C=!0),C}pruneUnusedLayers(n){const d={};n.forEach(v=>{d[v]=!0});for(const v in this.layerIndexes)d[v]||delete this.layerIndexes[v]}}const bi=(E,n)=>l.x(E,n&&n.filter(d=>d.identifier!=="source.canvas")),Wt=l.F(l.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),le=l.F(l.ax,["setCenter","setZoom","setBearing","setPitch"]),Pt=l.aw();class Ti extends l.E{constructor(n,d={}){super(),this.map=n,this.dispatcher=new Pn(Mn(),this,n._getMapId()),this.imageManager=new Ot,this.imageManager.setEventedParent(this),this.glyphManager=new Nr(n._requestManager,d.localIdeographFontFamily),this.lineAtlas=new qn(256,512),this.crossTileSymbolIndex=new jr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.az());const v=this;this._rtlTextPluginCallback=Ti.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(C,B)=>{if(l.aA(C),B&&B.every(a=>a))for(const a in v.sourceCaches){const h=v.sourceCaches[a].getSource().type;h!=="vector"&&h!=="geojson"||v.sourceCaches[a].reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const C=this.sourceCaches[w.sourceId];if(!C)return;const B=C.getSource();if(B&&B.vectorLayerIds)for(const a in this._layers){const h=this._layers[a];h.source===B.id&&this._validateLayer(h)}})}loadURL(n,d={},v){this.fire(new l.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const w=this.map._requestManager.transformRequest(n,Ce.Style);this._request=l.f(w,(C,B)=>{this._request=null,C?this.fire(new l.j(C)):B&&this._load(B,d,v)})}loadJSON(n,d={},v){this.fire(new l.k("dataloading",{dataType:"style"})),this._request=l.h.frame(()=>{this._request=null,d.validate=d.validate!==!1,this._load(n,d,v)})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(Pt,{validate:!1})}_load(n,d,v){var w;const C=d.transformStyle?d.transformStyle(v,n):n;if(!d.validate||!bi(this,l.y(C))){this._loaded=!0,this.stylesheet=C;for(const B in C.sources)this.addSource(B,C.sources[B],{validate:!1});C.sprite?this._loadSprite(C.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(C.glyphs),this._createLayers(),this.light=new Cn(this.stylesheet.light),this.map.setTerrain((w=this.stylesheet.terrain)!==null&&w!==void 0?w:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const n=l.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",n),this._order=n.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of n){const v=l.aC(d);v.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=v}}_loadSprite(n,d=!1,v=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(w,C,B,a){const h=wt(w),A=h.length,p=B>1?"@2x":"",y={},b={},T={};for(const{id:S,url:k}of h){const F=C.transformRequest(C.normalizeSpriteURL(k,p,".json"),Ce.SpriteJSON),U=`${S}_${F.url}`;y[U]=l.f(F,(Y,G)=>{delete y[U],b[S]=G,ct(a,b,T,Y,A)});const H=C.transformRequest(C.normalizeSpriteURL(k,p,".png"),Ce.SpriteImage),W=`${S}_${H.url}`;y[W]=Ee.getImage(H,(Y,G)=>{delete y[W],T[S]=G,ct(a,b,T,Y,A)})}return{cancel(){for(const S of Object.values(y))S.cancel()}}}(n,this.map._requestManager,this.map.getPixelRatio(),(w,C)=>{if(this._spriteRequest=null,w)this.fire(new l.j(w));else if(C)for(const B in C){this._spritesImagesIds[B]=[];const a=this._spritesImagesIds[B]?this._spritesImagesIds[B].filter(h=>!(h in C)):[];for(const h of a)this.imageManager.removeImage(h),this._changedImages[h]=!0;for(const h in C[B]){const A=B==="default"?h:`${B}:${h}`;this._spritesImagesIds[B].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,C[B][h],!1):this.imageManager.addImage(A,C[B][h]),d&&(this._changedImages[A]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),v&&v(w)})}_unloadSprite(){for(const n of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(n),this._changedImages[n]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(n){const d=this.sourceCaches[n.source];if(!d)return;const v=n.sourceLayer;if(!v)return;const w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(v)===-1)&&this.fire(new l.j(new Error(`Source layer "${v}" does not exist on source "${w.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(n){const d=this._serializedAllLayers();if(!n||n.length===0)return Object.values(d);const v=[];for(const w of n)d[w]&&v.push(d[w]);return v}_serializedAllLayers(){let n=this._serializedLayers;if(n)return n;n=this._serializedLayers={};const d=Object.keys(this._layers);for(const v of d){const w=this._layers[v];w.type!=="custom"&&(n[v]=w.serialize())}return n}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const n in this.sourceCaches)if(this.sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;const d=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(w.length||C.length)&&this._updateWorkerLayers(w,C);for(const B in this._updatedSources){const a=this._updatedSources[B];if(a==="reload")this._reloadSource(B);else{if(a!=="clear")throw new Error(`Invalid action ${a}`);this._clearSource(B)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const B in this._updatedPaintProps)this._layers[B].updateTransitions(n);this.light.updateTransitions(n),this._resetUpdates()}const v={};for(const w in this.sourceCaches){const C=this.sourceCaches[w];v[w]=C.used,C.used=!1}for(const w of this._order){const C=this._layers[w];C.recalculate(n,this._availableImages),!C.isHidden(n.zoom)&&C.source&&(this.sourceCaches[C.source].used=!0)}for(const w in v){const C=this.sourceCaches[w];v[w]!==C.used&&C.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:w}))}this.light.recalculate(n),this.z=n.zoom,d&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(n,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(n),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(n,d={}){this._checkLoaded();const v=this.serialize();if(n=d.transformStyle?d.transformStyle(v,n):n,bi(this,l.y(n)))return!1;(n=l.aD(n)).layers=l.aB(n.layers);const w=l.aE(v,n).filter(B=>!(B.command in le));if(w.length===0)return!1;const C=w.filter(B=>!(B.command in Wt));if(C.length>0)throw new Error(`Unimplemented: ${C.map(B=>B.command).join(", ")}.`);for(const B of w)B.command!=="setTransition"&&this[B.command].apply(this,B.args);return this.stylesheet=n,this._serializedLayers=null,!0}addImage(n,d){if(this.getImage(n))return this.fire(new l.j(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,d),this._afterImageUpdated(n)}updateImage(n,d){this.imageManager.updateImage(n,d)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new l.j(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,d,v={}){if(this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error(`Source "${n}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.y.source,`sources.${n}`,d,null,v))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const w=this.sourceCaches[n]=new _i(n,d,this.dispatcher);w.style=this,w.setEventedParent(this,()=>({isSourceLoaded:w.loaded(),source:w.serialize(),sourceId:n})),w.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===n)return this.fire(new l.j(new Error(`Source "${n}" cannot be removed while layer "${v}" is using it.`)));const d=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],d.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,d){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error(`There is no source with this ID=${n}`);const v=this.sourceCaches[n].getSource();if(v.type!=="geojson")throw new Error(`geojsonSource.type is ${v.type}, which is !== 'geojson`);v.setData(d),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,d,v={}){this._checkLoaded();const w=n.id;if(this.getLayer(w))return void this.fire(new l.j(new Error(`Layer "${w}" already exists on this map.`)));let C;if(n.type==="custom"){if(bi(this,l.aF(n)))return;C=l.aC(n)}else{if("source"in n&&typeof n.source=="object"&&(this.addSource(w,n.source),n=l.aD(n),n=l.e(n,{source:w})),this._validate(l.y.layer,`layers.${w}`,n,{arrayIndex:-1},v))return;C=l.aC(n),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}})}const B=d?this._order.indexOf(d):this._order.length;if(d&&B===-1)this.fire(new l.j(new Error(`Cannot add layer "${w}" before non-existing layer "${d}".`)));else{if(this._order.splice(B,0,w),this._layerOrderChanged=!0,this._layers[w]=C,this._removedLayers[w]&&C.source&&C.type!=="custom"){const a=this._removedLayers[w];delete this._removedLayers[w],a.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",this.sourceCaches[C.source].pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map)}}moveLayer(n,d){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new l.j(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===d)return;const v=this._order.indexOf(n);this._order.splice(v,1);const w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new l.j(new Error(`Cannot move layer "${n}" before non-existing layer "${d}".`))):(this._order.splice(w,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();const d=this._layers[n];if(!d)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${n}".`)));d.setEventedParent(null);const v=this._order.indexOf(n);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=d,delete this._layers[n],this._serializedLayers&&delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],d.onRemove&&d.onRemove(this.map)}getLayer(n){return this._layers[n]}getLayersOrder(){return[...this._order]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,d,v){this._checkLoaded();const w=this.getLayer(n);w?w.minzoom===d&&w.maxzoom===v||(d!=null&&(w.minzoom=d),v!=null&&(w.maxzoom=v),this._updateLayer(w)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,d,v={}){this._checkLoaded();const w=this.getLayer(n);if(w){if(!l.aG(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(l.y.filter,`layers.${w.id}.filter`,d,null,v)||(w.filter=l.aD(d),this._updateLayer(w)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return l.aD(this.getLayer(n).filter)}setLayoutProperty(n,d,v,w={}){this._checkLoaded();const C=this.getLayer(n);C?l.aG(C.getLayoutProperty(d),v)||(C.setLayoutProperty(d,v,w),this._updateLayer(C)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,d){const v=this.getLayer(n);if(v)return v.getLayoutProperty(d);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,d,v,w={}){this._checkLoaded();const C=this.getLayer(n);C?l.aG(C.getPaintProperty(d),v)||(C.setPaintProperty(d,v,w)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${n}".`)))}getPaintProperty(n,d){return this.getLayer(n).getPaintProperty(d)}setFeatureState(n,d){this._checkLoaded();const v=n.source,w=n.sourceLayer,C=this.sourceCaches[v];if(C===void 0)return void this.fire(new l.j(new Error(`The source '${v}' does not exist in the map's style.`)));const B=C.getSource().type;B==="geojson"&&w?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):B!=="vector"||w?(n.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),C.setFeatureState(w,n.id,d)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,d){this._checkLoaded();const v=n.source,w=this.sourceCaches[v];if(w===void 0)return void this.fire(new l.j(new Error(`The source '${v}' does not exist in the map's style.`)));const C=w.getSource().type,B=C==="vector"?n.sourceLayer:void 0;C!=="vector"||B?d&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(B,n.id,d):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();const d=n.source,v=n.sourceLayer,w=this.sourceCaches[d];if(w!==void 0)return w.getSource().type!=="vector"||v?(n.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),w.getFeatureState(v,n.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const n=l.aH(this.sourceCaches,C=>C.serialize()),d=this._serializeByIds(this._order),v=this.map.getTerrain()||void 0,w=this.stylesheet;return l.aI({version:w.version,name:w.name,metadata:w.metadata,light:w.light,center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch,sprite:w.sprite,glyphs:w.glyphs,transition:w.transition,sources:n,layers:d,terrain:v},C=>C!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(n){const d=B=>this._layers[B].type==="fill-extrusion",v={},w=[];for(let B=this._order.length-1;B>=0;B--){const a=this._order[B];if(d(a)){v[a]=B;for(const h of n){const A=h[a];if(A)for(const p of A)w.push(p)}}}w.sort((B,a)=>a.intersectionZ-B.intersectionZ);const C=[];for(let B=this._order.length-1;B>=0;B--){const a=this._order[B];if(d(a))for(let h=w.length-1;h>=0;h--){const A=w[h].feature;if(v[A.layer.id]<B)break;C.push(A),w.pop()}else for(const h of n){const A=h[a];if(A)for(const p of A)C.push(p.feature)}}return C}queryRenderedFeatures(n,d,v){d&&d.filter&&this._validate(l.y.filter,"queryRenderedFeatures.filter",d.filter,null,d);const w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const a of d.layers){const h=this._layers[a];if(!h)return this.fire(new l.j(new Error(`The layer '${a}' does not exist in the map's style and cannot be queried for features.`))),[];w[h.source]=!0}}const C=[];d.availableImages=this._availableImages;const B=this._serializedAllLayers();for(const a in this.sourceCaches)d.layers&&!w[a]||C.push(mr(this.sourceCaches[a],this._layers,B,n,d,v));return this.placement&&C.push(function(a,h,A,p,y,b,T){const S={},k=b.queryRenderedSymbols(p),F=[];for(const U of Object.keys(k).map(Number))F.push(T[U]);F.sort(Ki);for(const U of F){const H=U.featureIndex.lookupSymbolFeatures(k[U.bucketInstanceId],h,U.bucketIndex,U.sourceLayerIndex,y.filter,y.layers,y.availableImages,a);for(const W in H){const Y=S[W]=S[W]||[],G=H[W];G.sort((se,me)=>{const Te=U.featureSortOrder;if(Te){const de=Te.indexOf(se.featureIndex);return Te.indexOf(me.featureIndex)-de}return me.featureIndex-se.featureIndex});for(const se of G)Y.push(se)}}for(const U in S)S[U].forEach(H=>{const W=H.feature,Y=A[a[U].source].getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=Y});return S}(this._layers,B,this.sourceCaches,n,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(n,d){d&&d.filter&&this._validate(l.y.filter,"querySourceFeatures.filter",d.filter,null,d);const v=this.sourceCaches[n];return v?function(w,C){const B=w.getRenderableIds().map(A=>w.getTileByID(A)),a=[],h={};for(let A=0;A<B.length;A++){const p=B[A],y=p.tileID.canonical.key;h[y]||(h[y]=!0,p.querySourceFeatures(a,C))}return a}(v,d):[]}addSourceType(n,d,v){return zr(n)?v(new Error(`A source type called "${n}" already exists.`)):(((w,C)=>{Ls[w]=C})(n,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:d.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(n,d={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const B in n)if(!l.aG(n[B],v[B])){w=!0;break}if(!w)return;const C={now:l.h.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,d),this.light.updateTransitions(C)}_validate(n,d,v,w,C={}){return(!C||C.validate!==!1)&&bi(this,n.call(l.y,l.e({key:d,style:this.serialize(),value:v,styleSpec:l.v},w)))}_remove(n=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const v=this.sourceCaches[d];v.setEventedParent(null),v.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(n)}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(const d in this.sourceCaches)this.sourceCaches[d].update(n,this.map.terrain)}_generateCollisionBoxes(){for(const n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,d,v,w,C=!1){let B=!1,a=!1;const h={};for(const A of this._order){const p=this._layers[A];if(p.type!=="symbol")continue;if(!h[p.source]){const b=this.sourceCaches[p.source];h[p.source]=b.getRenderableIds(!0).map(T=>b.getTileByID(T)).sort((T,S)=>S.tileID.overscaledZ-T.tileID.overscaledZ||(T.tileID.isLessThan(S.tileID)?-1:1))}const y=this.crossTileSymbolIndex.addLayer(p,h[p.source],n.center.lng);B=B||y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((C=C||this._layerOrderChanged||v===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.h.now(),n.zoom))&&(this.pauseablePlacement=new tr(n,this.map.terrain,this._order,C,d,v,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,h),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.h.now()),a=!0),B&&this.pauseablePlacement.placement.setStale()),a||B)for(const A of this._order){const p=this._layers[A];p.type==="symbol"&&this.placement.updateLayerOpacities(p,h[p.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.h.now())}_releaseSymbolFadeTiles(){for(const n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,d,v){this.imageManager.getImages(d.icons,v),this._updateTilesForChangedImages();const w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)}getGlyphs(n,d,v){this.glyphManager.getGlyphs(d.stacks,v);const w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,[""])}getResource(n,d,v){return l.m(d,v)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(n,d={}){this._checkLoaded(),n&&this._validate(l.y.glyphs,"glyphs",n,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=n,this.glyphManager.entries={},this.glyphManager.setURL(n))}addSprite(n,d,v={},w){this._checkLoaded();const C=[{id:n,url:d}],B=[...wt(this.stylesheet.sprite),...C];this._validate(l.y.sprite,"sprite",B,null,v)||(this.stylesheet.sprite=B,this._loadSprite(C,!0,w))}removeSprite(n){this._checkLoaded();const d=wt(this.stylesheet.sprite);if(d.find(v=>v.id===n)){if(this._spritesImagesIds[n])for(const v of this._spritesImagesIds[n])this.imageManager.removeImage(v),this._changedImages[v]=!0;d.splice(d.findIndex(v=>v.id===n),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[n],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${n}" doesn't exists on this map.`)))}getSprite(){return wt(this.stylesheet.sprite)}setSprite(n,d={},v){this._checkLoaded(),n&&this._validate(l.y.sprite,"sprite",n,null,d)||(this.stylesheet.sprite=n,n?this._loadSprite(n,!0,v):(this._unloadSprite(),v&&v(null)))}}Ti.registerForPluginStateChange=l.aK;var un=l.Q([{name:"a_pos",type:"Int16",components:2}]),rn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Pi={prelude:fi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:fi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:fi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:fi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:fi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:fi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:fi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:fi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:fi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:fi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:fi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:fi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:fi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:fi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:fi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:fi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:fi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:fi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:fi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:fi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:fi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:fi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:fi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:fi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:fi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",rn),terrainDepth:fi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",rn),terrainCoords:fi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",rn)};function fi(E,n){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=n.match(/attribute ([\w]+) ([\w]+)/g),w=E.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),B=C?C.concat(w):w,a={};return{fragmentSource:E=E.replace(d,(h,A,p,y,b)=>(a[b]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${b}
varying ${p} ${y} ${b};
#else
uniform ${p} ${y} u_${b};
#endif
`:`
#ifdef HAS_UNIFORM_u_${b}
    ${p} ${y} ${b} = u_${b};
#endif
`)),vertexSource:n=n.replace(d,(h,A,p,y,b)=>{const T=y==="float"?"vec2":"vec4",S=b.match(/color/)?"color":T;return a[b]?A==="define"?`
#ifndef HAS_UNIFORM_u_${b}
uniform lowp float u_${b}_t;
attribute ${p} ${T} a_${b};
varying ${p} ${y} ${b};
#else
uniform ${p} ${y} u_${b};
#endif
`:S==="vec4"?`
#ifndef HAS_UNIFORM_u_${b}
    ${b} = a_${b};
#else
    ${p} ${y} ${b} = u_${b};
#endif
`:`
#ifndef HAS_UNIFORM_u_${b}
    ${b} = unpack_mix_${S}(a_${b}, u_${b}_t);
#else
    ${p} ${y} ${b} = u_${b};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${b}
uniform lowp float u_${b}_t;
attribute ${p} ${T} a_${b};
#else
uniform ${p} ${y} u_${b};
#endif
`:S==="vec4"?`
#ifndef HAS_UNIFORM_u_${b}
    ${p} ${y} ${b} = a_${b};
#else
    ${p} ${y} ${b} = u_${b};
#endif
`:`
#ifndef HAS_UNIFORM_u_${b}
    ${p} ${y} ${b} = unpack_mix_${S}(a_${b}, u_${b}_t);
#else
    ${p} ${y} ${b} = u_${b};
#endif
`}),staticAttributes:v,staticUniforms:B}}class re{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,d,v,w,C,B,a,h,A){this.context=n;let p=this.boundPaintVertexBuffers.length!==w.length;for(let y=0;!p&&y<w.length;y++)this.boundPaintVertexBuffers[y]!==w[y]&&(p=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==v||p||this.boundIndexBuffer!==C||this.boundVertexOffset!==B||this.boundDynamicVertexBuffer!==a||this.boundDynamicVertexBuffer2!==h||this.boundDynamicVertexBuffer3!==A?this.freshBind(d,v,w,C,B,a,h,A):(n.bindVertexArray.set(this.vao),a&&a.bind(),C&&C.dynamicDraw&&C.bind(),h&&h.bind(),A&&A.bind())}freshBind(n,d,v,w,C,B,a,h){const A=n.numAttributes,p=this.context,y=p.gl;this.vao&&this.destroy(),this.vao=p.createVertexArray(),p.bindVertexArray.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=B,this.boundDynamicVertexBuffer2=a,this.boundDynamicVertexBuffer3=h,d.enableAttributes(y,n);for(const b of v)b.enableAttributes(y,n);B&&B.enableAttributes(y,n),a&&a.enableAttributes(y,n),h&&h.enableAttributes(y,n),d.bind(),d.setVertexAttribPointers(y,n,C);for(const b of v)b.bind(),b.setVertexAttribPointers(y,n,C);B&&(B.bind(),B.setVertexAttribPointers(y,n,C)),w&&w.bind(),a&&(a.bind(),a.setVertexAttribPointers(y,n,C)),h&&(h.bind(),h.setVertexAttribPointers(y,n,C)),p.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ii(E){const n=[];for(let d=0;d<E.length;d++){if(E[d]===null)continue;const v=E[d].split(" ");n.push(v.pop())}return n}class Yr{constructor(n,d,v,w,C,B){const a=n.gl;this.program=a.createProgram();const h=Ii(d.staticAttributes),A=v?v.getBinderAttributes():[],p=h.concat(A),y=Pi.prelude.staticUniforms?Ii(Pi.prelude.staticUniforms):[],b=d.staticUniforms?Ii(d.staticUniforms):[],T=v?v.getBinderUniforms():[],S=y.concat(b).concat(T),k=[];for(const se of S)k.indexOf(se)<0&&k.push(se);const F=v?v.defines():[];C&&F.push("#define OVERDRAW_INSPECTOR;"),B&&F.push("#define TERRAIN3D;");const U=F.concat(Pi.prelude.fragmentSource,d.fragmentSource).join(`
`),H=F.concat(Pi.prelude.vertexSource,d.vertexSource).join(`
`),W=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(W,U),a.compileShader(W),!a.getShaderParameter(W,a.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${a.getShaderInfoLog(W)}`);a.attachShader(this.program,W);const Y=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(Y,H),a.compileShader(Y),!a.getShaderParameter(Y,a.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${a.getShaderInfoLog(Y)}`);a.attachShader(this.program,Y),this.attributes={};const G={};this.numAttributes=p.length;for(let se=0;se<this.numAttributes;se++)p[se]&&(a.bindAttribLocation(this.program,se,p[se]),this.attributes[p[se]]=se);if(a.linkProgram(this.program),!a.getProgramParameter(this.program,a.LINK_STATUS))throw new Error(`Program failed to link: ${a.getProgramInfoLog(this.program)}`);a.deleteShader(Y),a.deleteShader(W);for(let se=0;se<k.length;se++){const me=k[se];if(me&&!G[me]){const Te=a.getUniformLocation(this.program,me);Te&&(G[me]=Te)}}this.fixedUniforms=w(n,G),this.terrainUniforms=((se,me)=>({u_depth:new l.aL(se,me.u_depth),u_terrain:new l.aL(se,me.u_terrain),u_terrain_dim:new l.aM(se,me.u_terrain_dim),u_terrain_matrix:new l.aN(se,me.u_terrain_matrix),u_terrain_unpack:new l.aO(se,me.u_terrain_unpack),u_terrain_exaggeration:new l.aM(se,me.u_terrain_exaggeration)}))(n,G),this.binderUniforms=v?v.getUniforms(n,G):[]}draw(n,d,v,w,C,B,a,h,A,p,y,b,T,S,k,F,U,H){const W=n.gl;if(this.failedToCreate)return;if(n.program.set(this.program),n.setDepthMode(v),n.setStencilMode(w),n.setColorMode(C),n.setCullFace(B),h){n.activeTexture.set(W.TEXTURE2),W.bindTexture(W.TEXTURE_2D,h.depthTexture),n.activeTexture.set(W.TEXTURE3),W.bindTexture(W.TEXTURE_2D,h.texture);for(const G in this.terrainUniforms)this.terrainUniforms[G].set(h[G])}for(const G in this.fixedUniforms)this.fixedUniforms[G].set(a[G]);k&&k.setUniforms(n,this.binderUniforms,T,{zoom:S});let Y=0;switch(d){case W.LINES:Y=2;break;case W.TRIANGLES:Y=3;break;case W.LINE_STRIP:Y=1}for(const G of b.get()){const se=G.vaos||(G.vaos={});(se[A]||(se[A]=new re)).bind(n,this,p,k?k.getPaintVertexBuffers():[],y,G.vertexOffset,F,U,H),W.drawElements(d,G.primitiveLength*Y,W.UNSIGNED_SHORT,G.primitiveOffset*Y*2)}}}function Gr(E,n,d){const v=1/Pe(d,1,n.transform.tileZoom),w=Math.pow(2,d.tileID.overscaledZ),C=d.tileSize*Math.pow(2,n.transform.tileZoom)/w,B=C*(d.tileID.canonical.x+d.tileID.wrap*w),a=C*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[v,E.fromScale,E.toScale],u_fade:E.t,u_pixel_coord_upper:[B>>16,a>>16],u_pixel_coord_lower:[65535&B,65535&a]}}const Ao=(E,n,d,v)=>{const w=n.style.light,C=w.properties.get("position"),B=[C.x,C.y,C.z],a=function(){var A=new l.A(9);return l.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();w.properties.get("anchor")==="viewport"&&function(A,p){var y=Math.sin(p),b=Math.cos(p);A[0]=b,A[1]=y,A[2]=0,A[3]=-y,A[4]=b,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(a,-n.transform.angle),function(A,p,y){var b=p[0],T=p[1],S=p[2];A[0]=b*y[0]+T*y[3]+S*y[6],A[1]=b*y[1]+T*y[4]+S*y[7],A[2]=b*y[2]+T*y[5]+S*y[8]}(B,B,a);const h=w.properties.get("color");return{u_matrix:E,u_lightpos:B,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[h.r,h.g,h.b],u_vertical_gradient:+d,u_opacity:v}},ws=(E,n,d,v,w,C,B)=>l.e(Ao(E,n,d,v),Gr(C,n,B),{u_height_factor:-Math.pow(2,w.overscaledZ)/B.tileSize/8}),qo=E=>({u_matrix:E}),fo=(E,n,d,v)=>l.e(qo(E),Gr(d,n,v)),Zn=(E,n)=>({u_matrix:E,u_world:n}),te=(E,n,d,v,w)=>l.e(fo(E,n,d,v),{u_world:w}),oe=(E,n,d,v)=>{const w=E.transform;let C,B;if(v.paint.get("circle-pitch-alignment")==="map"){const a=Pe(d,1,w.zoom);C=!0,B=[a,a]}else C=!1,B=w.pixelsToGLUnits;return{u_camera_to_center_distance:w.cameraToCenterDistance,u_scale_with_map:+(v.paint.get("circle-pitch-scale")==="map"),u_matrix:E.translatePosMatrix(n.posMatrix,d,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_pitch_with_map:+C,u_device_pixel_ratio:E.pixelRatio,u_extrude_scale:B}},we=(E,n,d)=>{const v=Pe(d,1,n.zoom),w=Math.pow(2,n.zoom-d.tileID.overscaledZ),C=d.tileID.overscaleFactor();return{u_matrix:E,u_camera_to_center_distance:n.cameraToCenterDistance,u_pixels_to_tile_units:v,u_extrude_scale:[n.pixelsToGLUnits[0]/(v*w),n.pixelsToGLUnits[1]/(v*w)],u_overscale_factor:C}},Ve=(E,n,d=1)=>({u_matrix:E,u_color:n,u_overlay:0,u_overlay_scale:d}),rt=E=>({u_matrix:E}),Et=(E,n,d,v)=>({u_matrix:E,u_extrude_scale:Pe(n,1,d),u_intensity:v});function ni(E,n){const d=Math.pow(2,n.canonical.z),v=n.canonical.y;return[new l.U(0,v/d).toLngLat().lat,new l.U(0,(v+1)/d).toLngLat().lat]}const Ji=(E,n,d,v)=>{const w=E.transform;return{u_matrix:Xo(E,n,d,v),u_ratio:1/Pe(n,1,w.zoom),u_device_pixel_ratio:E.pixelRatio,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},nr=(E,n,d,v,w)=>l.e(Ji(E,n,d,w),{u_image:0,u_image_height:v}),Er=(E,n,d,v,w)=>{const C=E.transform,B=Ia(n,C);return{u_matrix:Xo(E,n,d,w),u_texsize:n.imageAtlasTexture.size,u_ratio:1/Pe(n,1,C.zoom),u_device_pixel_ratio:E.pixelRatio,u_image:0,u_scale:[B,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},ui=(E,n,d,v,w,C)=>{const B=E.lineAtlas,a=Ia(n,E.transform),h=d.layout.get("line-cap")==="round",A=B.getDash(v.from,h),p=B.getDash(v.to,h),y=A.width*w.fromScale,b=p.width*w.toScale;return l.e(Ji(E,n,d,C),{u_patternscale_a:[a/y,-A.height/2],u_patternscale_b:[a/b,-p.height/2],u_sdfgamma:B.width/(256*Math.min(y,b)*E.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:p.y,u_mix:w.t})};function Ia(E,n){return 1/Pe(E,1,n.tileZoom)}function Xo(E,n,d,v){return E.translatePosMatrix(v?v.posMatrix:n.tileID.posMatrix,n,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const fc=(E,n,d,v,w)=>{return{u_matrix:E,u_tl_parent:n,u_scale_parent:d,u_buffer_scale:1,u_fade_t:v.mix,u_opacity:v.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(B=w.paint.get("raster-saturation"),B>0?1-1/(1.001-B):-B),u_contrast_factor:(C=w.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:dc(w.paint.get("raster-hue-rotate"))};var C,B};function dc(E){E*=Math.PI/180;const n=Math.sin(E),d=Math.cos(E);return[(2*d+1)/3,(-Math.sqrt(3)*n-d+1)/3,(Math.sqrt(3)*n-d+1)/3]}const fl=(E,n,d,v,w,C,B,a,h,A)=>{const p=w.transform;return{u_is_size_zoom_constant:+(E==="constant"||E==="source"),u_is_size_feature_constant:+(E==="constant"||E==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:p.cameraToCenterDistance,u_pitch:p.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:p.width/p.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:B,u_coord_matrix:a,u_is_text:+h,u_pitch_with_map:+v,u_texsize:A,u_texture:0}},Ma=(E,n,d,v,w,C,B,a,h,A,p)=>{const y=w.transform;return l.e(fl(E,n,d,v,w,C,B,a,h,A),{u_gamma_scale:v?Math.cos(y._pitch)*y.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:+p})},An=(E,n,d,v,w,C,B,a,h,A)=>l.e(Ma(E,n,d,v,w,C,B,a,!0,h,!0),{u_texsize_icon:A,u_texture_icon:1}),po=(E,n,d)=>({u_matrix:E,u_opacity:n,u_color:d}),Ts=(E,n,d,v,w,C)=>l.e(function(B,a,h,A){const p=h.imageManager.getPattern(B.from.toString()),y=h.imageManager.getPattern(B.to.toString()),{width:b,height:T}=h.imageManager.getPixelSize(),S=Math.pow(2,A.tileID.overscaledZ),k=A.tileSize*Math.pow(2,h.transform.tileZoom)/S,F=k*(A.tileID.canonical.x+A.tileID.wrap*S),U=k*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:p.tl,u_pattern_br_a:p.br,u_pattern_tl_b:y.tl,u_pattern_br_b:y.br,u_texsize:[b,T],u_mix:a.t,u_pattern_size_a:p.displaySize,u_pattern_size_b:y.displaySize,u_scale_a:a.fromScale,u_scale_b:a.toScale,u_tile_units_to_pixels:1/Pe(A,1,h.transform.tileZoom),u_pixel_coord_upper:[F>>16,U>>16],u_pixel_coord_lower:[65535&F,65535&U]}}(v,C,d,w),{u_matrix:E,u_opacity:n}),Ra={fillExtrusion:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_lightpos:new l.aP(E,n.u_lightpos),u_lightintensity:new l.aM(E,n.u_lightintensity),u_lightcolor:new l.aP(E,n.u_lightcolor),u_vertical_gradient:new l.aM(E,n.u_vertical_gradient),u_opacity:new l.aM(E,n.u_opacity)}),fillExtrusionPattern:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_lightpos:new l.aP(E,n.u_lightpos),u_lightintensity:new l.aM(E,n.u_lightintensity),u_lightcolor:new l.aP(E,n.u_lightcolor),u_vertical_gradient:new l.aM(E,n.u_vertical_gradient),u_height_factor:new l.aM(E,n.u_height_factor),u_image:new l.aL(E,n.u_image),u_texsize:new l.aQ(E,n.u_texsize),u_pixel_coord_upper:new l.aQ(E,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(E,n.u_pixel_coord_lower),u_scale:new l.aP(E,n.u_scale),u_fade:new l.aM(E,n.u_fade),u_opacity:new l.aM(E,n.u_opacity)}),fill:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix)}),fillPattern:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_image:new l.aL(E,n.u_image),u_texsize:new l.aQ(E,n.u_texsize),u_pixel_coord_upper:new l.aQ(E,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(E,n.u_pixel_coord_lower),u_scale:new l.aP(E,n.u_scale),u_fade:new l.aM(E,n.u_fade)}),fillOutline:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_world:new l.aQ(E,n.u_world)}),fillOutlinePattern:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_world:new l.aQ(E,n.u_world),u_image:new l.aL(E,n.u_image),u_texsize:new l.aQ(E,n.u_texsize),u_pixel_coord_upper:new l.aQ(E,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(E,n.u_pixel_coord_lower),u_scale:new l.aP(E,n.u_scale),u_fade:new l.aM(E,n.u_fade)}),circle:(E,n)=>({u_camera_to_center_distance:new l.aM(E,n.u_camera_to_center_distance),u_scale_with_map:new l.aL(E,n.u_scale_with_map),u_pitch_with_map:new l.aL(E,n.u_pitch_with_map),u_extrude_scale:new l.aQ(E,n.u_extrude_scale),u_device_pixel_ratio:new l.aM(E,n.u_device_pixel_ratio),u_matrix:new l.aN(E,n.u_matrix)}),collisionBox:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_camera_to_center_distance:new l.aM(E,n.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aM(E,n.u_pixels_to_tile_units),u_extrude_scale:new l.aQ(E,n.u_extrude_scale),u_overscale_factor:new l.aM(E,n.u_overscale_factor)}),collisionCircle:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_inv_matrix:new l.aN(E,n.u_inv_matrix),u_camera_to_center_distance:new l.aM(E,n.u_camera_to_center_distance),u_viewport_size:new l.aQ(E,n.u_viewport_size)}),debug:(E,n)=>({u_color:new l.aR(E,n.u_color),u_matrix:new l.aN(E,n.u_matrix),u_overlay:new l.aL(E,n.u_overlay),u_overlay_scale:new l.aM(E,n.u_overlay_scale)}),clippingMask:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix)}),heatmap:(E,n)=>({u_extrude_scale:new l.aM(E,n.u_extrude_scale),u_intensity:new l.aM(E,n.u_intensity),u_matrix:new l.aN(E,n.u_matrix)}),heatmapTexture:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_world:new l.aQ(E,n.u_world),u_image:new l.aL(E,n.u_image),u_color_ramp:new l.aL(E,n.u_color_ramp),u_opacity:new l.aM(E,n.u_opacity)}),hillshade:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_image:new l.aL(E,n.u_image),u_latrange:new l.aQ(E,n.u_latrange),u_light:new l.aQ(E,n.u_light),u_shadow:new l.aR(E,n.u_shadow),u_highlight:new l.aR(E,n.u_highlight),u_accent:new l.aR(E,n.u_accent)}),hillshadePrepare:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_image:new l.aL(E,n.u_image),u_dimension:new l.aQ(E,n.u_dimension),u_zoom:new l.aM(E,n.u_zoom),u_unpack:new l.aO(E,n.u_unpack)}),line:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_ratio:new l.aM(E,n.u_ratio),u_device_pixel_ratio:new l.aM(E,n.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(E,n.u_units_to_pixels)}),lineGradient:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_ratio:new l.aM(E,n.u_ratio),u_device_pixel_ratio:new l.aM(E,n.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(E,n.u_units_to_pixels),u_image:new l.aL(E,n.u_image),u_image_height:new l.aM(E,n.u_image_height)}),linePattern:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_texsize:new l.aQ(E,n.u_texsize),u_ratio:new l.aM(E,n.u_ratio),u_device_pixel_ratio:new l.aM(E,n.u_device_pixel_ratio),u_image:new l.aL(E,n.u_image),u_units_to_pixels:new l.aQ(E,n.u_units_to_pixels),u_scale:new l.aP(E,n.u_scale),u_fade:new l.aM(E,n.u_fade)}),lineSDF:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_ratio:new l.aM(E,n.u_ratio),u_device_pixel_ratio:new l.aM(E,n.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(E,n.u_units_to_pixels),u_patternscale_a:new l.aQ(E,n.u_patternscale_a),u_patternscale_b:new l.aQ(E,n.u_patternscale_b),u_sdfgamma:new l.aM(E,n.u_sdfgamma),u_image:new l.aL(E,n.u_image),u_tex_y_a:new l.aM(E,n.u_tex_y_a),u_tex_y_b:new l.aM(E,n.u_tex_y_b),u_mix:new l.aM(E,n.u_mix)}),raster:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_tl_parent:new l.aQ(E,n.u_tl_parent),u_scale_parent:new l.aM(E,n.u_scale_parent),u_buffer_scale:new l.aM(E,n.u_buffer_scale),u_fade_t:new l.aM(E,n.u_fade_t),u_opacity:new l.aM(E,n.u_opacity),u_image0:new l.aL(E,n.u_image0),u_image1:new l.aL(E,n.u_image1),u_brightness_low:new l.aM(E,n.u_brightness_low),u_brightness_high:new l.aM(E,n.u_brightness_high),u_saturation_factor:new l.aM(E,n.u_saturation_factor),u_contrast_factor:new l.aM(E,n.u_contrast_factor),u_spin_weights:new l.aP(E,n.u_spin_weights)}),symbolIcon:(E,n)=>({u_is_size_zoom_constant:new l.aL(E,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(E,n.u_is_size_feature_constant),u_size_t:new l.aM(E,n.u_size_t),u_size:new l.aM(E,n.u_size),u_camera_to_center_distance:new l.aM(E,n.u_camera_to_center_distance),u_pitch:new l.aM(E,n.u_pitch),u_rotate_symbol:new l.aL(E,n.u_rotate_symbol),u_aspect_ratio:new l.aM(E,n.u_aspect_ratio),u_fade_change:new l.aM(E,n.u_fade_change),u_matrix:new l.aN(E,n.u_matrix),u_label_plane_matrix:new l.aN(E,n.u_label_plane_matrix),u_coord_matrix:new l.aN(E,n.u_coord_matrix),u_is_text:new l.aL(E,n.u_is_text),u_pitch_with_map:new l.aL(E,n.u_pitch_with_map),u_texsize:new l.aQ(E,n.u_texsize),u_texture:new l.aL(E,n.u_texture)}),symbolSDF:(E,n)=>({u_is_size_zoom_constant:new l.aL(E,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(E,n.u_is_size_feature_constant),u_size_t:new l.aM(E,n.u_size_t),u_size:new l.aM(E,n.u_size),u_camera_to_center_distance:new l.aM(E,n.u_camera_to_center_distance),u_pitch:new l.aM(E,n.u_pitch),u_rotate_symbol:new l.aL(E,n.u_rotate_symbol),u_aspect_ratio:new l.aM(E,n.u_aspect_ratio),u_fade_change:new l.aM(E,n.u_fade_change),u_matrix:new l.aN(E,n.u_matrix),u_label_plane_matrix:new l.aN(E,n.u_label_plane_matrix),u_coord_matrix:new l.aN(E,n.u_coord_matrix),u_is_text:new l.aL(E,n.u_is_text),u_pitch_with_map:new l.aL(E,n.u_pitch_with_map),u_texsize:new l.aQ(E,n.u_texsize),u_texture:new l.aL(E,n.u_texture),u_gamma_scale:new l.aM(E,n.u_gamma_scale),u_device_pixel_ratio:new l.aM(E,n.u_device_pixel_ratio),u_is_halo:new l.aL(E,n.u_is_halo)}),symbolTextAndIcon:(E,n)=>({u_is_size_zoom_constant:new l.aL(E,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(E,n.u_is_size_feature_constant),u_size_t:new l.aM(E,n.u_size_t),u_size:new l.aM(E,n.u_size),u_camera_to_center_distance:new l.aM(E,n.u_camera_to_center_distance),u_pitch:new l.aM(E,n.u_pitch),u_rotate_symbol:new l.aL(E,n.u_rotate_symbol),u_aspect_ratio:new l.aM(E,n.u_aspect_ratio),u_fade_change:new l.aM(E,n.u_fade_change),u_matrix:new l.aN(E,n.u_matrix),u_label_plane_matrix:new l.aN(E,n.u_label_plane_matrix),u_coord_matrix:new l.aN(E,n.u_coord_matrix),u_is_text:new l.aL(E,n.u_is_text),u_pitch_with_map:new l.aL(E,n.u_pitch_with_map),u_texsize:new l.aQ(E,n.u_texsize),u_texsize_icon:new l.aQ(E,n.u_texsize_icon),u_texture:new l.aL(E,n.u_texture),u_texture_icon:new l.aL(E,n.u_texture_icon),u_gamma_scale:new l.aM(E,n.u_gamma_scale),u_device_pixel_ratio:new l.aM(E,n.u_device_pixel_ratio),u_is_halo:new l.aL(E,n.u_is_halo)}),background:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_opacity:new l.aM(E,n.u_opacity),u_color:new l.aR(E,n.u_color)}),backgroundPattern:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_opacity:new l.aM(E,n.u_opacity),u_image:new l.aL(E,n.u_image),u_pattern_tl_a:new l.aQ(E,n.u_pattern_tl_a),u_pattern_br_a:new l.aQ(E,n.u_pattern_br_a),u_pattern_tl_b:new l.aQ(E,n.u_pattern_tl_b),u_pattern_br_b:new l.aQ(E,n.u_pattern_br_b),u_texsize:new l.aQ(E,n.u_texsize),u_mix:new l.aM(E,n.u_mix),u_pattern_size_a:new l.aQ(E,n.u_pattern_size_a),u_pattern_size_b:new l.aQ(E,n.u_pattern_size_b),u_scale_a:new l.aM(E,n.u_scale_a),u_scale_b:new l.aM(E,n.u_scale_b),u_pixel_coord_upper:new l.aQ(E,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(E,n.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aM(E,n.u_tile_units_to_pixels)}),terrain:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_texture:new l.aL(E,n.u_texture),u_ele_delta:new l.aM(E,n.u_ele_delta)}),terrainDepth:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_ele_delta:new l.aM(E,n.u_ele_delta)}),terrainCoords:(E,n)=>({u_matrix:new l.aN(E,n.u_matrix),u_texture:new l.aL(E,n.u_texture),u_terrain_coords_id:new l.aM(E,n.u_terrain_coords_id),u_ele_delta:new l.aM(E,n.u_ele_delta)})};class Zo{constructor(n,d,v){this.context=n;const w=n.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const go={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yo{constructor(n,d,v,w){this.length=d.length,this.attributes=v,this.itemSize=d.bytesPerElement,this.dynamicDraw=w,this.context=n;const C=n.gl;this.buffer=C.createBuffer(),n.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){if(n.length!==this.length)throw new Error(`Length of new data is ${n.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,d){for(let v=0;v<this.attributes.length;v++){const w=d.attributes[this.attributes[v].name];w!==void 0&&n.enableVertexAttribArray(w)}}setVertexAttribPointers(n,d,v){for(let w=0;w<this.attributes.length;w++){const C=this.attributes[w],B=d.attributes[C.name];B!==void 0&&n.vertexAttribPointer(B,C.components,n[go[C.type]],!1,this.itemSize,C.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _o=new WeakMap;function Rn(E){var n;if(_o.has(E))return _o.get(E);{const d=(n=E.getParameter(E.VERSION))===null||n===void 0?void 0:n.startsWith("WebGL 2.0");return _o.set(E,d),d}}class Ai{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fr extends Ai{getDefault(){return l.aT.transparent}set(n){const d=this.current;(n.r!==d.r||n.g!==d.g||n.b!==d.b||n.a!==d.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class dr extends Ai{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Di extends Ai{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Go extends Ai{getDefault(){return[!0,!0,!0,!0]}set(n){const d=this.current;(n[0]!==d[0]||n[1]!==d[1]||n[2]!==d[2]||n[3]!==d[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Qo extends Ai{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Yn extends Ai{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class dl extends Ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const d=this.current;(n.func!==d.func||n.ref!==d.ref||n.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class pl extends Ai{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const d=this.current;(n[0]!==d[0]||n[1]!==d[1]||n[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class ka extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;n?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=n,this.dirty=!1}}class Da extends Ai{getDefault(){return[0,1]}set(n){const d=this.current;(n[0]!==d[0]||n[1]!==d[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class mo extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;n?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=n,this.dirty=!1}}class sn extends Ai{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class gl extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;n?d.enable(d.BLEND):d.disable(d.BLEND),this.current=n,this.dirty=!1}}class _l extends Ai{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const d=this.current;(n[0]!==d[0]||n[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class fn extends Ai{getDefault(){return l.aT.transparent}set(n){const d=this.current;(n.r!==d.r||n.g!==d.g||n.b!==d.b||n.a!==d.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Gn extends Ai{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class kn extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;n?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=n,this.dirty=!1}}class pc extends Ai{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class gc extends Ai{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class ml extends Ai{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class Oh extends Ai{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class yl extends Ai{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const d=this.current;(n[0]!==d[0]||n[1]!==d[1]||n[2]!==d[2]||n[3]!==d[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ko extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class bl extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class vl extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class yo extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class _c extends Ai{getDefault(){return null}set(n){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class mc extends Ai{getDefault(){return null}set(n){var d;if(n===this.current&&!this.dirty)return;const v=this.gl;Rn(v)?v.bindVertexArray(n):(d=v.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(n),this.current=n,this.dirty=!1}}class xl extends Ai{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Qn extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class yc extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Us extends Ai{constructor(n,d){super(n),this.context=n,this.parent=d}getDefault(){return null}}class bo extends Us{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class bc extends Us{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class wl extends Us{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class di{constructor(n,d,v,w,C){this.context=n,this.width=d,this.height=v;const B=n.gl,a=this.framebuffer=B.createFramebuffer();if(this.colorAttachment=new bo(n,a),w)this.depthAttachment=C?new wl(n,a):new bc(n,a);else if(C)throw new Error("Stencil cannot be setted without depth");if(B.checkFramebufferStatus(B.FRAMEBUFFER)!==B.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const n=this.context.gl,d=this.colorAttachment.get();if(d&&n.deleteTexture(d),this.depthAttachment){const v=this.depthAttachment.get();v&&n.deleteRenderbuffer(v)}n.deleteFramebuffer(this.framebuffer)}}class ji{constructor(n,d,v){this.blendFunction=n,this.blendColor=d,this.mask=v}}ji.Replace=[1,0],ji.disabled=new ji(ji.Replace,l.aT.transparent,[!1,!1,!1,!1]),ji.unblended=new ji(ji.Replace,l.aT.transparent,[!0,!0,!0,!0]),ji.alphaBlended=new ji([1,771],l.aT.transparent,[!0,!0,!0,!0]);class Tl{constructor(n){var d,v;if(this.gl=n,this.clearColor=new fr(this),this.clearDepth=new dr(this),this.clearStencil=new Di(this),this.colorMask=new Go(this),this.depthMask=new Qo(this),this.stencilMask=new Yn(this),this.stencilFunc=new dl(this),this.stencilOp=new pl(this),this.stencilTest=new ka(this),this.depthRange=new Da(this),this.depthTest=new mo(this),this.depthFunc=new sn(this),this.blend=new gl(this),this.blendFunc=new _l(this),this.blendColor=new fn(this),this.blendEquation=new Gn(this),this.cullFace=new kn(this),this.cullFaceSide=new pc(this),this.frontFace=new gc(this),this.program=new ml(this),this.activeTexture=new Oh(this),this.viewport=new yl(this),this.bindFramebuffer=new Ko(this),this.bindRenderbuffer=new bl(this),this.bindTexture=new vl(this),this.bindVertexBuffer=new yo(this),this.bindElementBuffer=new _c(this),this.bindVertexArray=new mc(this),this.pixelStoreUnpack=new xl(this),this.pixelStoreUnpackPremultiplyAlpha=new Qn(this),this.pixelStoreUnpackFlipY=new yc(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),Rn(n)){this.HALF_FLOAT=n.HALF_FLOAT;const w=n.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=n.RGBA16F)!==null&&d!==void 0?d:w==null?void 0:w.RGBA16F_EXT,this.RGB16F=(v=n.RGB16F)!==null&&v!==void 0?v:w==null?void 0:w.RGB16F_EXT,n.getExtension("EXT_color_buffer_float")}else{n.getExtension("EXT_color_buffer_half_float"),n.getExtension("OES_texture_half_float_linear");const w=n.getExtension("OES_texture_half_float");this.HALF_FLOAT=w==null?void 0:w.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,d){return new Zo(this,n,d)}createVertexBuffer(n,d,v){return new Yo(this,n,d,v)}createRenderbuffer(n,d,v){const w=this.gl,C=w.createRenderbuffer();return this.bindRenderbuffer.set(C),w.renderbufferStorage(w.RENDERBUFFER,n,d,v),this.bindRenderbuffer.set(null),C}createFramebuffer(n,d,v,w){return new di(this,n,d,v,w)}clear({color:n,depth:d,stencil:v}){const w=this.gl;let C=0;n&&(C|=w.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(C|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),v!==void 0&&(C|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),w.clear(C)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){l.aG(n.blendFunction,ji.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}createVertexArray(){var n;return Rn(this.gl)?this.gl.createVertexArray():(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.createVertexArrayOES()}deleteVertexArray(n){var d;return Rn(this.gl)?this.gl.deleteVertexArray(n):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(n)}unbindVAO(){this.bindVertexArray.set(null)}}class li{constructor(n,d,v){this.func=n,this.mask=d,this.range=v}}li.ReadOnly=!1,li.ReadWrite=!0,li.disabled=new li(519,li.ReadOnly,[0,1]);const Es=7680;class $i{constructor(n,d,v,w,C,B){this.test=n,this.ref=d,this.mask=v,this.fail=w,this.depthFail=C,this.pass=B}}$i.disabled=new $i({func:519,mask:0},0,0,Es,Es,Es);class Bi{constructor(n,d,v){this.enable=n,this.mode=d,this.frontFace=v}}let vo;function vc(E,n,d,v,w,C,B){const a=E.context,h=a.gl,A=E.useProgram("collisionBox"),p=[];let y=0,b=0;for(let W=0;W<v.length;W++){const Y=v[W],G=n.getTile(Y),se=G.getBucket(d);if(!se)continue;let me=Y.posMatrix;w[0]===0&&w[1]===0||(me=E.translatePosMatrix(Y.posMatrix,G,w,C));const Te=B?se.textCollisionBox:se.iconCollisionBox,de=se.collisionCircleArray;if(de.length>0){const be=l.Z(),ve=me;l.aU(be,se.placementInvProjMatrix,E.transform.glCoordMatrix),l.aU(be,be,se.placementViewportMatrix),p.push({circleArray:de,circleOffset:b,transform:ve,invTransform:be,coord:Y}),y+=de.length/4,b=y}Te&&A.draw(a,h.LINES,li.disabled,$i.disabled,E.colorModeForRenderPass(),Bi.disabled,we(me,E.transform,G),E.style.map.terrain&&E.style.map.terrain.getTerrainData(Y),d.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,E.transform.zoom,null,null,Te.collisionVertexBuffer)}if(!B||!p.length)return;const T=E.useProgram("collisionCircle"),S=new l.aV;S.resize(4*y),S._trim();let k=0;for(const W of p)for(let Y=0;Y<W.circleArray.length/4;Y++){const G=4*Y,se=W.circleArray[G+0],me=W.circleArray[G+1],Te=W.circleArray[G+2],de=W.circleArray[G+3];S.emplace(k++,se,me,Te,de,0),S.emplace(k++,se,me,Te,de,1),S.emplace(k++,se,me,Te,de,2),S.emplace(k++,se,me,Te,de,3)}(!vo||vo.length<2*y)&&(vo=function(W){const Y=2*W,G=new l.aX;G.resize(Y),G._trim();for(let se=0;se<Y;se++){const me=6*se;G.uint16[me+0]=4*se+0,G.uint16[me+1]=4*se+1,G.uint16[me+2]=4*se+2,G.uint16[me+3]=4*se+2,G.uint16[me+4]=4*se+3,G.uint16[me+5]=4*se+0}return G}(y));const F=a.createIndexBuffer(vo,!0),U=a.createVertexBuffer(S,l.aW.members,!0);for(const W of p){const Y={u_matrix:W.transform,u_inv_matrix:W.invTransform,u_camera_to_center_distance:(H=E.transform).cameraToCenterDistance,u_viewport_size:[H.width,H.height]};T.draw(a,h.TRIANGLES,li.disabled,$i.disabled,E.colorModeForRenderPass(),Bi.disabled,Y,E.style.map.terrain&&E.style.map.terrain.getTerrainData(W.coord),d.id,U,F,l.S.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,E.transform.zoom,null,null,null)}var H;U.destroy(),F.destroy()}Bi.disabled=new Bi(!1,1029,2305),Bi.backCCW=new Bi(!0,1029,2305);const Ba=l.ao(new Float32Array(16));function xo(E,n,d,v,w,C){const{horizontalAlign:B,verticalAlign:a}=l.au(E);return new l.P((-(B-.5)*n/w+v[0])*C,(-(a-.5)*d/w+v[1])*C)}function wo(E,n,d,v,w,C,B,a,h,A,p){const y=E.text.placedSymbolArray,b=E.text.dynamicLayoutVertexArray,T=E.icon.dynamicLayoutVertexArray,S={};b.clear();for(let k=0;k<y.length;k++){const F=y.get(k),U=F.hidden||!F.crossTileID||E.allowVerticalPlacement&&!F.placedOrientation?null:v[F.crossTileID];if(U){const H=new l.P(F.anchorX,F.anchorY),W=Ui(H,d?B:C,p),Y=hn(w.cameraToCenterDistance,W.signedDistanceFromCamera);let G=l.aj(E.textSizeData,h,F)*Y/l.ap;d&&(G*=E.tilePixelRatio/a);const{width:se,height:me,anchor:Te,textOffset:de,textBoxScale:be}=U,ve=xo(Te,se,me,de,be,G),Ye=d?Ui(H.add(ve),C,p).point:W.point.add(n?ve.rotate(-w.angle):ve),je=E.allowVerticalPlacement&&F.placedOrientation===l.ai.vertical?Math.PI/2:0;for(let He=0;He<F.numGlyphs;He++)l.ak(b,Ye,je);A&&F.associatedIconIndex>=0&&(S[F.associatedIconIndex]={shiftedAnchor:Ye,angle:je})}else ae(F.numGlyphs,b)}if(A){T.clear();const k=E.icon.placedSymbolArray;for(let F=0;F<k.length;F++){const U=k.get(F);if(U.hidden)ae(U.numGlyphs,T);else{const H=S[F];if(H)for(let W=0;W<U.numGlyphs;W++)l.ak(T,H.shiftedAnchor,H.angle);else ae(U.numGlyphs,T)}}E.icon.dynamicLayoutVertexBuffer.updateData(T)}E.text.dynamicLayoutVertexBuffer.updateData(b)}function To(E,n,d){return d.iconsInText&&n?"symbolTextAndIcon":E?"symbolSDF":"symbolIcon"}function Ci(E,n,d,v,w,C,B,a,h,A,p,y){const b=E.context,T=b.gl,S=E.transform,k=a==="map",F=h==="map",U=a!=="viewport"&&d.layout.get("symbol-placement")!=="point",H=k&&!F&&!U,W=!d.layout.get("symbol-sort-key").isConstant();let Y=!1;const G=E.depthModeForSublayer(0,li.ReadOnly),se=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),me=[];for(const Te of v){const de=n.getTile(Te),be=de.getBucket(d);if(!be)continue;const ve=w?be.text:be.icon;if(!ve||!ve.segments.get().length||!ve.hasVisibleVertices)continue;const Ye=ve.programConfigurations.get(d.id),je=w||be.sdfIcons,He=w?be.textSizeData:be.iconSizeData,$e=F||S.pitch!==0,zt=E.useProgram(To(je,w,be),Ye),vt=l.ah(He,S.zoom),mt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Te);let pt,Mt,St,ti,kt=[0,0],Jt=null;if(w)Mt=de.glyphAtlasTexture,St=T.LINEAR,pt=de.glyphAtlasTexture.size,be.iconsInText&&(kt=de.imageAtlasTexture.size,Jt=de.imageAtlasTexture,ti=$e||E.options.rotating||E.options.zooming||He.kind==="composite"||He.kind==="camera"?T.LINEAR:T.NEAREST);else{const or=d.layout.get("icon-size").constantOr(0)!==1||be.iconsNeedLinear;Mt=de.imageAtlasTexture,St=je||E.options.rotating||E.options.zooming||or||$e?T.LINEAR:T.NEAREST,pt=de.imageAtlasTexture.size}const Fi=Pe(de,1,E.transform.zoom),Oi=st(Te.posMatrix,F,k,E.transform,Fi),On=vs(Te.posMatrix,F,k,E.transform,Fi),Ln=se&&be.hasTextData(),Do=d.layout.get("icon-text-fit")!=="none"&&Ln&&be.hasIconData();if(U){const or=E.style.map.terrain?(Cs,ar)=>E.style.map.terrain.getElevation(Te,Cs,ar):null,Sr=d.layout.get("text-rotation-alignment")==="map";nt(be,Te.posMatrix,E,w,Oi,On,F,A,Sr,or)}const ha=E.translatePosMatrix(Te.posMatrix,de,C,B),Wa=U||w&&se||Do?Ba:Oi,es=E.translatePosMatrix(On,de,C,B,!0),Hr=je&&d.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let cs;cs=je?be.iconsInText?An(He.kind,vt,H,F,E,ha,Wa,es,pt,kt):Ma(He.kind,vt,H,F,E,ha,Wa,es,w,pt,!0):fl(He.kind,vt,H,F,E,ha,Wa,es,w,pt);const ua={program:zt,buffers:ve,uniformValues:cs,atlasTexture:Mt,atlasTextureIcon:Jt,atlasInterpolation:St,atlasInterpolationIcon:ti,isSDF:je,hasHalo:Hr};if(W&&be.canOverlap){Y=!0;const or=ve.segments.get();for(const Sr of or)me.push({segments:new l.S([Sr]),sortKey:Sr.sortKey,state:ua,terrainData:mt})}else me.push({segments:ve.segments,sortKey:0,state:ua,terrainData:mt})}Y&&me.sort((Te,de)=>Te.sortKey-de.sortKey);for(const Te of me){const de=Te.state;if(b.activeTexture.set(T.TEXTURE0),de.atlasTexture.bind(de.atlasInterpolation,T.CLAMP_TO_EDGE),de.atlasTextureIcon&&(b.activeTexture.set(T.TEXTURE1),de.atlasTextureIcon&&de.atlasTextureIcon.bind(de.atlasInterpolationIcon,T.CLAMP_TO_EDGE)),de.isSDF){const be=de.uniformValues;de.hasHalo&&(be.u_is_halo=1,El(de.buffers,Te.segments,d,E,de.program,G,p,y,be,Te.terrainData)),be.u_is_halo=0}El(de.buffers,Te.segments,d,E,de.program,G,p,y,de.uniformValues,Te.terrainData)}}function El(E,n,d,v,w,C,B,a,h,A){const p=v.context;w.draw(p,p.gl.TRIANGLES,C,B,a,Bi.disabled,h,A,d.id,E.layoutVertexBuffer,E.indexBuffer,n,d.paint,v.transform.zoom,E.programConfigurations.get(d.id),E.dynamicLayoutVertexBuffer,E.opacityVertexBuffer)}function Jo(E,n,d,v,w){if(!d||!v||!v.imageAtlas)return;const C=v.imageAtlas.patternPositions;let B=C[d.to.toString()],a=C[d.from.toString()];if(!B&&a&&(B=a),!a&&B&&(a=B),!B||!a){const h=w.getPaintProperty(n);B=C[h],a=C[h]}B&&a&&E.setConstantPatternPositions(B,a)}function ea(E,n,d,v,w,C,B){const a=E.context.gl,h="fill-pattern",A=d.paint.get(h),p=A&&A.constantOr(1),y=d.getCrossfadeParameters();let b,T,S,k,F;B?(T=p&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",b=a.LINES):(T=p?"fillPattern":"fill",b=a.TRIANGLES);const U=A.constantOr(null);for(const H of v){const W=n.getTile(H);if(p&&!W.patternsLoaded())continue;const Y=W.getBucket(d);if(!Y)continue;const G=Y.programConfigurations.get(d.id),se=E.useProgram(T,G),me=E.style.map.terrain&&E.style.map.terrain.getTerrainData(H);p&&(E.context.activeTexture.set(a.TEXTURE0),W.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),G.updatePaintBuffers(y)),Jo(G,h,U,W,d);const Te=me?H:null,de=E.translatePosMatrix(Te?Te.posMatrix:H.posMatrix,W,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(B){k=Y.indexBuffer2,F=Y.segments2;const be=[a.drawingBufferWidth,a.drawingBufferHeight];S=T==="fillOutlinePattern"&&p?te(de,E,y,W,be):Zn(de,be)}else k=Y.indexBuffer,F=Y.segments,S=p?fo(de,E,y,W):qo(de);se.draw(E.context,b,w,E.stencilModeForClipping(H),C,Bi.disabled,S,me,d.id,Y.layoutVertexBuffer,k,F,d.paint,E.transform.zoom,G)}}function ta(E,n,d,v,w,C,B){const a=E.context,h=a.gl,A="fill-extrusion-pattern",p=d.paint.get(A),y=p.constantOr(1),b=d.getCrossfadeParameters(),T=d.paint.get("fill-extrusion-opacity"),S=p.constantOr(null);for(const k of v){const F=n.getTile(k),U=F.getBucket(d);if(!U)continue;const H=E.style.map.terrain&&E.style.map.terrain.getTerrainData(k),W=U.programConfigurations.get(d.id),Y=E.useProgram(y?"fillExtrusionPattern":"fillExtrusion",W);y&&(E.context.activeTexture.set(h.TEXTURE0),F.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),W.updatePaintBuffers(b)),Jo(W,A,S,F,d);const G=E.translatePosMatrix(k.posMatrix,F,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),se=d.paint.get("fill-extrusion-vertical-gradient"),me=y?ws(G,E,se,T,k,b,F):Ao(G,E,se,T);Y.draw(a,a.gl.TRIANGLES,w,C,B,Bi.backCCW,me,H,d.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,d.paint,E.transform.zoom,W,E.style.map.terrain&&U.centroidVertexBuffer)}}function Lh(E,n,d,v,w,C,B){const a=E.context,h=a.gl,A=d.fbo;if(!A)return;const p=E.useProgram("hillshade"),y=E.style.map.terrain&&E.style.map.terrain.getTerrainData(n);a.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,A.colorAttachment.get()),p.draw(a,h.TRIANGLES,w,C,B,Bi.disabled,((b,T,S,k)=>{const F=S.paint.get("hillshade-shadow-color"),U=S.paint.get("hillshade-highlight-color"),H=S.paint.get("hillshade-accent-color");let W=S.paint.get("hillshade-illumination-direction")*(Math.PI/180);S.paint.get("hillshade-illumination-anchor")==="viewport"&&(W-=b.transform.angle);const Y=!b.options.moving;return{u_matrix:k?k.posMatrix:b.transform.calculatePosMatrix(T.tileID.toUnwrapped(),Y),u_image:0,u_latrange:ni(0,T.tileID),u_light:[S.paint.get("hillshade-exaggeration"),W],u_shadow:F,u_highlight:U,u_accent:H}})(E,d,v,y?n:null),y,v.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments)}function Sl(E,n,d,v,w,C){const B=E.context,a=B.gl,h=n.dem;if(h&&h.data){const A=h.dim,p=h.stride,y=h.getPixels();if(B.activeTexture.set(a.TEXTURE1),B.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||E.getTileTexture(p),n.demTexture){const T=n.demTexture;T.update(y,{premultiply:!1}),T.bind(a.NEAREST,a.CLAMP_TO_EDGE)}else n.demTexture=new at(B,y,a.RGBA,{premultiply:!1}),n.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE);B.activeTexture.set(a.TEXTURE0);let b=n.fbo;if(!b){const T=new at(B,{width:A,height:A,data:null},a.RGBA);T.bind(a.LINEAR,a.CLAMP_TO_EDGE),b=n.fbo=B.createFramebuffer(A,A,!0,!1),b.colorAttachment.set(T.texture)}B.bindFramebuffer.set(b.framebuffer),B.viewport.set([0,0,A,A]),E.useProgram("hillshadePrepare").draw(B,a.TRIANGLES,v,w,C,Bi.disabled,((T,S)=>{const k=S.stride,F=l.Z();return l.aS(F,0,l.N,-l.N,0,0,1),l.$(F,F,[0,-l.N,0]),{u_matrix:F,u_image:1,u_dimension:[k,k],u_zoom:T.overscaledZ,u_unpack:S.getUnpackVector()}})(n.tileID,h),null,d.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function Nh(E,n,d,v,w,C){const B=v.paint.get("raster-fade-duration");if(!C&&B>0){const a=l.h.now(),h=(a-E.timeAdded)/B,A=n?(a-n.timeAdded)/B:-1,p=d.getSource(),y=w.coveringZoomLevel({tileSize:p.tileSize,roundZoom:p.roundZoom}),b=!n||Math.abs(n.tileID.overscaledZ-y)>Math.abs(E.tileID.overscaledZ-y),T=b&&E.refreshedUponExpiration?1:l.ad(b?h:1-A,0,1);return E.refreshedUponExpiration&&h>=1&&(E.refreshedUponExpiration=!1),n?{opacity:1,mix:1-T}:{opacity:T,mix:0}}return{opacity:1,mix:0}}const $r=new l.aT(1,0,0,1),Eo=new l.aT(0,1,0,1),dn=new l.aT(0,0,1,1),xc=new l.aT(1,0,1,1),Fa=new l.aT(0,1,1,1);function ia(E,n,d,v){ra(E,0,n+d/2,E.transform.width,d,v)}function Wr(E,n,d,v){ra(E,n-d/2,0,d,E.transform.height,v)}function ra(E,n,d,v,w,C){const B=E.context,a=B.gl;a.enable(a.SCISSOR_TEST),a.scissor(n*E.pixelRatio,d*E.pixelRatio,v*E.pixelRatio,w*E.pixelRatio),B.clear({color:C}),a.disable(a.SCISSOR_TEST)}function Oa(E,n,d){const v=E.context,w=v.gl,C=d.posMatrix,B=E.useProgram("debug"),a=li.disabled,h=$i.disabled,A=E.colorModeForRenderPass(),p="$debug",y=E.style.map.terrain&&E.style.map.terrain.getTerrainData(d);v.activeTexture.set(w.TEXTURE0);const b=n.getTileByID(d.key).latestRawTileData,T=Math.floor((b&&b.byteLength||0)/1024),S=n.getTile(d).tileSize,k=512/Math.min(S,512)*(d.overscaledZ/E.transform.zoom)*.5;let F=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(F+=` => ${d.overscaledZ}`),function(U,H){U.initDebugOverlayCanvas();const W=U.debugOverlayCanvas,Y=U.context.gl,G=U.debugOverlayCanvas.getContext("2d");G.clearRect(0,0,W.width,W.height),G.shadowColor="white",G.shadowBlur=2,G.lineWidth=1.5,G.strokeStyle="white",G.textBaseline="top",G.font="bold 36px Open Sans, sans-serif",G.fillText(H,5,5),G.strokeText(H,5,5),U.debugOverlayTexture.update(W),U.debugOverlayTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}(E,`${F} ${T}kB`),B.draw(v,w.TRIANGLES,a,h,ji.alphaBlended,Bi.disabled,Ve(C,l.aT.transparent,k),null,p,E.debugBuffer,E.quadTriangleIndexBuffer,E.debugSegments),B.draw(v,w.LINE_STRIP,a,h,A,Bi.disabled,Ve(C,l.aT.red),y,p,E.debugBuffer,E.tileBorderIndexBuffer,E.debugSegments)}function Mi(E,n,d){const v=E.context,w=v.gl,C=E.colorModeForRenderPass(),B=new li(w.LEQUAL,li.ReadWrite,E.depthRangeFor3D),a=E.useProgram("terrain"),h=n.getTerrainMesh();v.bindFramebuffer.set(null),v.viewport.set([0,0,E.width,E.height]);for(const A of d){const p=E.renderToTexture.getTexture(A),y=n.getTerrainData(A.tileID);v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,p.texture);const b={u_matrix:E.transform.calculatePosMatrix(A.tileID.toUnwrapped()),u_texture:0,u_ele_delta:n.getMeshFrameDelta(E.transform.zoom)};a.draw(v,w.TRIANGLES,B,$i.disabled,C,Bi.backCCW,b,y,"terrain",h.vertexBuffer,h.indexBuffer,h.segments)}}class Vs{constructor(n,d){this.context=new Tl(n),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.Z(),renderTime:0},this.setup(),this.numSublayers=_i.maxUnderzooming+_i.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new jr}resize(n,d,v){if(this.width=Math.floor(n*v),this.height=Math.floor(d*v),this.pixelRatio=v,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const w of this.style._order)this.style._layers[w].resize()}setup(){const n=this.context,d=new l.a_;d.emplaceBack(0,0),d.emplaceBack(l.N,0),d.emplaceBack(0,l.N),d.emplaceBack(l.N,l.N),this.tileExtentBuffer=n.createVertexBuffer(d,un.members),this.tileExtentSegments=l.S.simpleSegment(0,0,4,2);const v=new l.a_;v.emplaceBack(0,0),v.emplaceBack(l.N,0),v.emplaceBack(0,l.N),v.emplaceBack(l.N,l.N),this.debugBuffer=n.createVertexBuffer(v,un.members),this.debugSegments=l.S.simpleSegment(0,0,4,5);const w=new l.V;w.emplaceBack(0,0,0,0),w.emplaceBack(l.N,0,l.N,0),w.emplaceBack(0,l.N,0,l.N),w.emplaceBack(l.N,l.N,l.N,l.N),this.rasterBoundsBuffer=n.createVertexBuffer(w,yi.members),this.rasterBoundsSegments=l.S.simpleSegment(0,0,4,2);const C=new l.a_;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(C,un.members),this.viewportSegments=l.S.simpleSegment(0,0,4,2);const B=new l.a$;B.emplaceBack(0),B.emplaceBack(1),B.emplaceBack(3),B.emplaceBack(2),B.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(B);const a=new l.b0;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(a);const h=this.context.gl;this.stencilClearMode=new $i({func:h.ALWAYS,mask:0},0,255,h.ZERO,h.ZERO,h.ZERO)}clearStencil(){const n=this.context,d=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const v=l.Z();l.aS(v,0,this.width,this.height,0,0,1),l.a0(v,v,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,d.TRIANGLES,li.disabled,this.stencilClearMode,ji.disabled,Bi.disabled,rt(v),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,d){if(this.currentStencilSource===n.source||!n.isTileClipped()||!d||!d.length)return;this.currentStencilSource=n.source;const v=this.context,w=v.gl;this.nextStencilID+d.length>256&&this.clearStencil(),v.setColorMode(ji.disabled),v.setDepthMode(li.disabled);const C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const B of d){const a=this._tileClippingMaskIDs[B.key]=this.nextStencilID++,h=this.style.map.terrain&&this.style.map.terrain.getTerrainData(B);C.draw(v,w.TRIANGLES,li.disabled,new $i({func:w.ALWAYS,mask:0},a,255,w.KEEP,w.KEEP,w.REPLACE),ji.disabled,Bi.disabled,rt(B.posMatrix),h,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,d=this.context.gl;return new $i({func:d.NOTEQUAL,mask:255},n,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(n){const d=this.context.gl;return new $i({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(n){const d=this.context.gl,v=n.sort((B,a)=>a.overscaledZ-B.overscaledZ),w=v[v.length-1].overscaledZ,C=v[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const B={};for(let a=0;a<C;a++)B[a+w]=new $i({func:d.GEQUAL,mask:255},a+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=C,[B,v]}return[{[w]:$i.disabled},v]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new ji([n.CONSTANT_COLOR,n.ONE],new l.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ji.unblended:ji.alphaBlended}depthModeForSublayer(n,d,v){if(!this.opaquePassEnabledForLayer())return li.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new li(v||this.context.gl.LEQUAL,d,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,d){this.style=n,this.options=d,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(l.h.now()),this.imageManager.beginFrame();const v=this.style._order,w=this.style.sourceCaches,C={},B={},a={};for(const h in w){const A=w[h];A.used&&A.prepare(this.context),C[h]=A.getVisibleCoordinates(),B[h]=C[h].slice().reverse(),a[h]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let h=0;h<v.length;h++)if(this.style._layers[v[h]].is3D()){this.opaquePassCutoff=h;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const h=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||h.length)&&(l.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,p){const y=A.context,b=y.gl,T=ji.unblended,S=new li(b.LEQUAL,li.ReadWrite,[0,1]),k=p.getTerrainMesh(),F=p.sourceCache.getRenderableTiles(),U=A.useProgram("terrainDepth");y.bindFramebuffer.set(p.getFramebuffer("depth").framebuffer),y.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),y.clear({color:l.aT.transparent,depth:1});for(const H of F){const W=p.getTerrainData(H.tileID),Y={u_matrix:A.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_ele_delta:p.getMeshFrameDelta(A.transform.zoom)};U.draw(y,b.TRIANGLES,S,$i.disabled,T,Bi.backCCW,Y,W,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}y.bindFramebuffer.set(null),y.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,p){const y=A.context,b=y.gl,T=ji.unblended,S=new li(b.LEQUAL,li.ReadWrite,[0,1]),k=p.getTerrainMesh(),F=p.getCoordsTexture(),U=p.sourceCache.getRenderableTiles(),H=A.useProgram("terrainCoords");y.bindFramebuffer.set(p.getFramebuffer("coords").framebuffer),y.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),y.clear({color:l.aT.transparent,depth:1}),p.coordsIndex=[];for(const W of U){const Y=p.getTerrainData(W.tileID);y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,F.texture);const G={u_matrix:A.transform.calculatePosMatrix(W.tileID.toUnwrapped()),u_terrain_coords_id:(255-p.coordsIndex.length)/255,u_texture:0,u_ele_delta:p.getMeshFrameDelta(A.transform.zoom)};H.draw(y,b.TRIANGLES,S,$i.disabled,T,Bi.backCCW,G,Y,"terrain",k.vertexBuffer,k.indexBuffer,k.segments),p.coordsIndex.push(W.tileID.key)}y.bindFramebuffer.set(null),y.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const h of v){const A=this.style._layers[h];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const p=B[A.source];(A.type==="custom"||p.length)&&this.renderLayer(this,w[A.source],A,p)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.aT.black:l.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const h=this.style._layers[v[this.currentLayer]],A=w[h.source],p=C[h.source];this._renderTileClippingMasks(h,p),this.renderLayer(this,A,h,p)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const h=this.style._layers[v[this.currentLayer]],A=w[h.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(h))continue;const p=(h.type==="symbol"?a:B)[h.source];this._renderTileClippingMasks(h,C[h.source]),this.renderLayer(this,A,h,p)}if(this.options.showTileBoundaries){const h=function(A,p){let y=null;const b=Object.values(A._layers).flatMap(F=>F.source&&!F.isHidden(p)?[A.sourceCaches[F.source]]:[]),T=b.filter(F=>F.getSource().type==="vector"),S=b.filter(F=>F.getSource().type!=="vector"),k=F=>{(!y||y.getSource().maxzoom<F.getSource().maxzoom)&&(y=F)};return T.forEach(F=>k(F)),y||S.forEach(F=>k(F)),y}(this.style,this.transform.zoom);h&&function(A,p,y){for(let b=0;b<y.length;b++)Oa(A,p,y[b])}(this,h,h.getVisibleCoordinates())}this.options.showPadding&&function(h){const A=h.transform.padding;ia(h,h.transform.height-(A.top||0),3,$r),ia(h,A.bottom||0,3,Eo),Wr(h,A.left||0,3,dn),Wr(h,h.transform.width-(A.right||0),3,xc);const p=h.transform.centerPoint;(function(y,b,T,S){ra(y,b-1,T-10,2,20,S),ra(y,b-10,T-1,20,2,S)})(h,p.x,h.transform.height-p.y,Fa)}(this),this.context.setDefault()}renderLayer(n,d,v,w){if(!v.isHidden(this.transform.zoom)&&(v.type==="background"||v.type==="custom"||(w||[]).length))switch(this.id=v.id,v.type){case"symbol":(function(C,B,a,h,A){if(C.renderPass!=="translucent")return;const p=$i.disabled,y=C.colorModeForRenderPass();(a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(b,T,S,k,F,U,H){const W=T.transform,Y=F==="map",G=U==="map";for(const se of b){const me=k.getTile(se),Te=me.getBucket(S);if(!Te||!Te.text||!Te.text.segments.get().length)continue;const de=l.ah(Te.textSizeData,W.zoom),be=Pe(me,1,T.transform.zoom),ve=st(se.posMatrix,G,Y,T.transform,be),Ye=S.layout.get("icon-text-fit")!=="none"&&Te.hasIconData();if(de){const je=Math.pow(2,W.zoom-me.tileID.overscaledZ);wo(Te,Y,G,H,W,ve,se.posMatrix,je,de,Ye,T.style.map.terrain?(He,$e)=>T.style.map.terrain.getElevation(se,He,$e):null)}}}(h,C,a,B,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),A),a.paint.get("icon-opacity").constantOr(1)!==0&&Ci(C,B,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),p,y),a.paint.get("text-opacity").constantOr(1)!==0&&Ci(C,B,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),p,y),B.map.showCollisionBoxes&&(vc(C,B,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),vc(C,B,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))})(n,d,v,w,this.style.placement.variableOffsets);break;case"circle":(function(C,B,a,h){if(C.renderPass!=="translucent")return;const A=a.paint.get("circle-opacity"),p=a.paint.get("circle-stroke-width"),y=a.paint.get("circle-stroke-opacity"),b=!a.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(p.constantOr(1)===0||y.constantOr(1)===0))return;const T=C.context,S=T.gl,k=C.depthModeForSublayer(0,li.ReadOnly),F=$i.disabled,U=C.colorModeForRenderPass(),H=[];for(let W=0;W<h.length;W++){const Y=h[W],G=B.getTile(Y),se=G.getBucket(a);if(!se)continue;const me=se.programConfigurations.get(a.id),Te=C.useProgram("circle",me),de=se.layoutVertexBuffer,be=se.indexBuffer,ve=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Y),Ye={programConfiguration:me,program:Te,layoutVertexBuffer:de,indexBuffer:be,uniformValues:oe(C,Y,G,a),terrainData:ve};if(b){const je=se.segments.get();for(const He of je)H.push({segments:new l.S([He]),sortKey:He.sortKey,state:Ye})}else H.push({segments:se.segments,sortKey:0,state:Ye})}b&&H.sort((W,Y)=>W.sortKey-Y.sortKey);for(const W of H){const{programConfiguration:Y,program:G,layoutVertexBuffer:se,indexBuffer:me,uniformValues:Te,terrainData:de}=W.state;G.draw(T,S.TRIANGLES,k,F,U,Bi.disabled,Te,de,a.id,se,me,W.segments,a.paint,C.transform.zoom,Y)}})(n,d,v,w);break;case"heatmap":(function(C,B,a,h){if(a.paint.get("heatmap-opacity")!==0)if(C.renderPass==="offscreen"){const A=C.context,p=A.gl,y=$i.disabled,b=new ji([p.ONE,p.ONE],l.aT.transparent,[!0,!0,!0,!0]);(function(T,S,k){const F=T.gl;T.activeTexture.set(F.TEXTURE1),T.viewport.set([0,0,S.width/4,S.height/4]);let U=k.heatmapFbo;if(U)F.bindTexture(F.TEXTURE_2D,U.colorAttachment.get()),T.bindFramebuffer.set(U.framebuffer);else{const H=F.createTexture();F.bindTexture(F.TEXTURE_2D,H),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),U=k.heatmapFbo=T.createFramebuffer(S.width/4,S.height/4,!1,!1),function(W,Y,G,se){var me,Te;const de=W.gl,be=(me=W.HALF_FLOAT)!==null&&me!==void 0?me:de.UNSIGNED_BYTE,ve=(Te=W.RGBA16F)!==null&&Te!==void 0?Te:de.RGBA;de.texImage2D(de.TEXTURE_2D,0,ve,Y.width/4,Y.height/4,0,de.RGBA,be,null),se.colorAttachment.set(G)}(T,S,H,U)}})(A,C,a),A.clear({color:l.aT.transparent});for(let T=0;T<h.length;T++){const S=h[T];if(B.hasRenderableParent(S))continue;const k=B.getTile(S),F=k.getBucket(a);if(!F)continue;const U=F.programConfigurations.get(a.id),H=C.useProgram("heatmap",U),{zoom:W}=C.transform;H.draw(A,p.TRIANGLES,li.disabled,y,b,Bi.disabled,Et(S.posMatrix,k,W,a.paint.get("heatmap-intensity")),null,a.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,a.paint,C.transform.zoom,U)}A.viewport.set([0,0,C.width,C.height])}else C.renderPass==="translucent"&&(C.context.setColorMode(C.colorModeForRenderPass()),function(A,p){const y=A.context,b=y.gl,T=p.heatmapFbo;if(!T)return;y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,T.colorAttachment.get()),y.activeTexture.set(b.TEXTURE1);let S=p.colorRampTexture;S||(S=p.colorRampTexture=new at(y,p.colorRamp,b.RGBA)),S.bind(b.LINEAR,b.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(y,b.TRIANGLES,li.disabled,$i.disabled,A.colorModeForRenderPass(),Bi.disabled,((k,F,U,H)=>{const W=l.Z();l.aS(W,0,k.width,k.height,0,0,1);const Y=k.context.gl;return{u_matrix:W,u_world:[Y.drawingBufferWidth,Y.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}})(A,p),null,p.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,p.paint,A.transform.zoom)}(C,a))})(n,d,v,w);break;case"line":(function(C,B,a,h){if(C.renderPass!=="translucent")return;const A=a.paint.get("line-opacity"),p=a.paint.get("line-width");if(A.constantOr(1)===0||p.constantOr(1)===0)return;const y=C.depthModeForSublayer(0,li.ReadOnly),b=C.colorModeForRenderPass(),T=a.paint.get("line-dasharray"),S=a.paint.get("line-pattern"),k=S.constantOr(1),F=a.paint.get("line-gradient"),U=a.getCrossfadeParameters(),H=k?"linePattern":T?"lineSDF":F?"lineGradient":"line",W=C.context,Y=W.gl;let G=!0;for(const se of h){const me=B.getTile(se);if(k&&!me.patternsLoaded())continue;const Te=me.getBucket(a);if(!Te)continue;const de=Te.programConfigurations.get(a.id),be=C.context.program.get(),ve=C.useProgram(H,de),Ye=G||ve.program!==be,je=C.style.map.terrain&&C.style.map.terrain.getTerrainData(se),He=S.constantOr(null);if(He&&me.imageAtlas){const vt=me.imageAtlas,mt=vt.patternPositions[He.to.toString()],pt=vt.patternPositions[He.from.toString()];mt&&pt&&de.setConstantPatternPositions(mt,pt)}const $e=je?se:null,zt=k?Er(C,me,a,U,$e):T?ui(C,me,a,T,U,$e):F?nr(C,me,a,Te.lineClipsArray.length,$e):Ji(C,me,a,$e);if(k)W.activeTexture.set(Y.TEXTURE0),me.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),de.updatePaintBuffers(U);else if(T&&(Ye||C.lineAtlas.dirty))W.activeTexture.set(Y.TEXTURE0),C.lineAtlas.bind(W);else if(F){const vt=Te.gradients[a.id];let mt=vt.texture;if(a.gradientVersion!==vt.version){let pt=256;if(a.stepInterpolant){const Mt=B.getSource().maxzoom,St=se.canonical.z===Mt?Math.ceil(1<<C.transform.maxZoom-se.canonical.z):1;pt=l.ad(l.aY(Te.maxLineLength/l.N*1024*St),256,W.maxTextureSize)}vt.gradient=l.aZ({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:pt,image:vt.gradient||void 0,clips:Te.lineClipsArray}),vt.texture?vt.texture.update(vt.gradient):vt.texture=new at(W,vt.gradient,Y.RGBA),vt.version=a.gradientVersion,mt=vt.texture}W.activeTexture.set(Y.TEXTURE0),mt.bind(a.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}ve.draw(W,Y.TRIANGLES,y,C.stencilModeForClipping(se),b,Bi.disabled,zt,je,a.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,a.paint,C.transform.zoom,de,Te.layoutVertexBuffer2),G=!1}})(n,d,v,w);break;case"fill":(function(C,B,a,h){const A=a.paint.get("fill-color"),p=a.paint.get("fill-opacity");if(p.constantOr(1)===0)return;const y=C.colorModeForRenderPass(),b=a.paint.get("fill-pattern"),T=C.opaquePassEnabledForLayer()&&!b.constantOr(1)&&A.constantOr(l.aT.transparent).a===1&&p.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===T){const S=C.depthModeForSublayer(1,C.renderPass==="opaque"?li.ReadWrite:li.ReadOnly);ea(C,B,a,h,S,y,!1)}if(C.renderPass==="translucent"&&a.paint.get("fill-antialias")){const S=C.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,li.ReadOnly);ea(C,B,a,h,S,y,!0)}})(n,d,v,w);break;case"fill-extrusion":(function(C,B,a,h){const A=a.paint.get("fill-extrusion-opacity");if(A!==0&&C.renderPass==="translucent"){const p=new li(C.context.gl.LEQUAL,li.ReadWrite,C.depthRangeFor3D);if(A!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))ta(C,B,a,h,p,$i.disabled,ji.disabled),ta(C,B,a,h,p,C.stencilModeFor3D(),C.colorModeForRenderPass());else{const y=C.colorModeForRenderPass();ta(C,B,a,h,p,$i.disabled,y)}}})(n,d,v,w);break;case"hillshade":(function(C,B,a,h){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;const A=C.context,p=C.depthModeForSublayer(0,li.ReadOnly),y=C.colorModeForRenderPass(),[b,T]=C.renderPass==="translucent"?C.stencilConfigForOverlap(h):[{},h];for(const S of T){const k=B.getTile(S);k.needsHillshadePrepare!==void 0&&k.needsHillshadePrepare&&C.renderPass==="offscreen"?Sl(C,k,a,p,$i.disabled,y):C.renderPass==="translucent"&&Lh(C,S,k,a,p,b[S.overscaledZ],y)}A.viewport.set([0,0,C.width,C.height])})(n,d,v,w);break;case"raster":(function(C,B,a,h){if(C.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!h.length)return;const A=C.context,p=A.gl,y=B.getSource(),b=C.useProgram("raster"),T=C.colorModeForRenderPass(),[S,k]=y instanceof ki?[{},h]:C.stencilConfigForOverlap(h),F=k[k.length-1].overscaledZ,U=!C.options.moving;for(const H of k){const W=C.depthModeForSublayer(H.overscaledZ-F,a.paint.get("raster-opacity")===1?li.ReadWrite:li.ReadOnly,p.LESS),Y=B.getTile(H);Y.registerFadeDuration(a.paint.get("raster-fade-duration"));const G=B.findLoadedParent(H,0),se=Nh(Y,G,B,a,C.transform,C.style.map.terrain);let me,Te;const de=a.paint.get("raster-resampling")==="nearest"?p.NEAREST:p.LINEAR;A.activeTexture.set(p.TEXTURE0),Y.texture.bind(de,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(p.TEXTURE1),G?(G.texture.bind(de,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST),me=Math.pow(2,G.tileID.overscaledZ-Y.tileID.overscaledZ),Te=[Y.tileID.canonical.x*me%1,Y.tileID.canonical.y*me%1]):Y.texture.bind(de,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST);const be=C.style.map.terrain&&C.style.map.terrain.getTerrainData(H),ve=be?H:null,Ye=ve?ve.posMatrix:C.transform.calculatePosMatrix(H.toUnwrapped(),U),je=fc(Ye,Te||[0,0],me||1,se,a);y instanceof ki?b.draw(A,p.TRIANGLES,W,$i.disabled,T,Bi.disabled,je,be,a.id,y.boundsBuffer,C.quadTriangleIndexBuffer,y.boundsSegments):b.draw(A,p.TRIANGLES,W,S[H.overscaledZ],T,Bi.disabled,je,be,a.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments)}})(n,d,v,w);break;case"background":(function(C,B,a,h){const A=a.paint.get("background-color"),p=a.paint.get("background-opacity");if(p===0)return;const y=C.context,b=y.gl,T=C.transform,S=T.tileSize,k=a.paint.get("background-pattern");if(C.isPatternMissing(k))return;const F=!k&&A.a===1&&p===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==F)return;const U=$i.disabled,H=C.depthModeForSublayer(0,F==="opaque"?li.ReadWrite:li.ReadOnly),W=C.colorModeForRenderPass(),Y=C.useProgram(k?"backgroundPattern":"background"),G=h||T.coveringTiles({tileSize:S,terrain:C.style.map.terrain});k&&(y.activeTexture.set(b.TEXTURE0),C.imageManager.bind(C.context));const se=a.getCrossfadeParameters();for(const me of G){const Te=h?me.posMatrix:C.transform.calculatePosMatrix(me.toUnwrapped()),de=k?Ts(Te,p,C,k,{tileID:me,tileSize:S},se):po(Te,p,A),be=C.style.map.terrain&&C.style.map.terrain.getTerrainData(me);Y.draw(y,b.TRIANGLES,H,U,W,Bi.disabled,de,be,a.id,C.tileExtentBuffer,C.quadTriangleIndexBuffer,C.tileExtentSegments)}})(n,0,v,w);break;case"custom":(function(C,B,a){const h=C.context,A=a.implementation;if(C.renderPass==="offscreen"){const p=A.prerender;p&&(C.setCustomLayerDefaults(),h.setColorMode(C.colorModeForRenderPass()),p.call(A,h.gl,C.transform.customLayerMatrix()),h.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),h.setColorMode(C.colorModeForRenderPass()),h.setStencilMode($i.disabled);const p=A.renderingMode==="3d"?new li(C.context.gl.LEQUAL,li.ReadWrite,C.depthRangeFor3D):C.depthModeForSublayer(0,li.ReadOnly);h.setDepthMode(p),A.render(h.gl,C.transform.customLayerMatrix()),h.setDirty(),C.setBaseState(),h.bindFramebuffer.set(null)}})(n,0,v)}}translatePosMatrix(n,d,v,w,C){if(!v[0]&&!v[1])return n;const B=C?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(B){const A=Math.sin(B),p=Math.cos(B);v=[v[0]*p-v[1]*A,v[0]*A+v[1]*p]}const a=[C?v[0]:Pe(d,v[0],this.transform.zoom),C?v[1]:Pe(d,v[1],this.transform.zoom),0],h=new Float32Array(16);return l.$(h,n,a),h}saveTileTexture(n){const d=this._tileTextures[n.size[0]];d?d.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const d=this._tileTextures[n];return d&&d.length>0?d.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const d=this.imageManager.getPattern(n.from.toString()),v=this.imageManager.getPattern(n.to.toString());return!d||!v}useProgram(n,d){this.cache=this.cache||{};const v=n+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[v]||(this.cache[v]=new Yr(this.context,Pi[n],d,Ra[n],this._showOverdrawInspector,this.style.map.terrain)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new at(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:n,drawingBufferHeight:d}=this.context.gl;return this.width!==n||this.height!==d}}class yr{constructor(n,d){this.points=n,this.planes=d}static fromInvProjectionMatrix(n,d,v){const w=Math.pow(2,v),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(a=>{const h=1/(a=l.ag([],a,n))[3]/d*w;return l.b3(a,a,[h,h,1/a[3],h])}),B=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(a=>{const h=function(b,T){var S=T[0],k=T[1],F=T[2],U=S*S+k*k+F*F;return U>0&&(U=1/Math.sqrt(U)),b[0]=T[0]*U,b[1]=T[1]*U,b[2]=T[2]*U,b}([],function(b,T,S){var k=T[0],F=T[1],U=T[2],H=S[0],W=S[1],Y=S[2];return b[0]=F*Y-U*W,b[1]=U*H-k*Y,b[2]=k*W-F*H,b}([],Je([],C[a[0]],C[a[1]]),Je([],C[a[2]],C[a[1]]))),A=-((p=h)[0]*(y=C[a[1]])[0]+p[1]*y[1]+p[2]*y[2]);var p,y;return h.concat(A)});return new yr(C,B)}}class So{constructor(n,d){this.min=n,this.max=d,this.center=function(v,w,C){return v[0]=.5*w[0],v[1]=.5*w[1],v[2]=.5*w[2],v}([],function(v,w,C){return v[0]=w[0]+C[0],v[1]=w[1]+C[1],v[2]=w[2]+C[2],v}([],this.min,this.max))}quadrant(n){const d=[n%2==0,n<2],v=Ne(this.min),w=Ne(this.max);for(let C=0;C<d.length;C++)v[C]=d[C]?this.min[C]:this.center[C],w[C]=d[C]?this.center[C]:this.max[C];return w[2]=this.max[2],new So(v,w)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersects(n){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let v=!0;for(let w=0;w<n.planes.length;w++){const C=n.planes[w];let B=0;for(let a=0;a<d.length;a++)l.b4(C,d[a])>=0&&B++;if(B===0)return 0;B!==d.length&&(v=!1)}if(v)return 2;for(let w=0;w<3;w++){let C=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(let a=0;a<n.points.length;a++){const h=n.points[a][w]-this.min[w];C=Math.min(C,h),B=Math.max(B,h)}if(B<0||C>this.max[w]-this.min[w])return 0}return 1}}class Co{constructor(n=0,d=0,v=0,w=0){if(isNaN(n)||n<0||isNaN(d)||d<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=d,this.left=v,this.right=w}interpolate(n,d,v){return d.top!=null&&n.top!=null&&(this.top=l.B.number(n.top,d.top,v)),d.bottom!=null&&n.bottom!=null&&(this.bottom=l.B.number(n.bottom,d.bottom,v)),d.left!=null&&n.left!=null&&(this.left=l.B.number(n.left,d.left,v)),d.right!=null&&n.right!=null&&(this.right=l.B.number(n.right,d.right,v)),this}getCenter(n,d){const v=l.ad((this.left+n-this.right)/2,0,n),w=l.ad((this.top+d-this.bottom)/2,0,d);return new l.P(v,w)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Co(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class La{constructor(n,d,v,w,C){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=C===void 0||!!C,this._minZoom=n||0,this._maxZoom=d||22,this._minPitch=v??0,this._maxPitch=w??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Co,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const n=new La(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.apply(this),n}apply(n){this.tileSize=n.tileSize,this.latRange=n.latRange,this.width=n.width,this.height=n.height,this._center=n._center,this._elevation=n._elevation,this._minEleveationForCurrentTile=n._minEleveationForCurrentTile,this.zoom=n.zoom,this.angle=n.angle,this._fov=n._fov,this._pitch=n._pitch,this._unmodified=n._unmodified,this._edgeInsets=n._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(n){const d=-l.b5(n,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var v=new l.A(4);return l.A!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v}(),function(v,w,C){var B=w[0],a=w[1],h=w[2],A=w[3],p=Math.sin(C),y=Math.cos(C);v[0]=B*y+h*p,v[1]=a*y+A*p,v[2]=B*-p+h*y,v[3]=a*-p+A*y}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const d=l.ad(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(n){const d=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(n){n!==this._elevation&&(this._elevation=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,d,v){this._unmodified=!1,this._edgeInsets.interpolate(n,d,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const d=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(n){const d=[new l.b6(0,n)];if(this._renderWorldCopies){const v=this.pointCoordinate(new l.P(0,0)),w=this.pointCoordinate(new l.P(this.width,0)),C=this.pointCoordinate(new l.P(this.width,this.height)),B=this.pointCoordinate(new l.P(0,this.height)),a=Math.floor(Math.min(v.x,w.x,C.x,B.x)),h=Math.floor(Math.max(v.x,w.x,C.x,B.x)),A=1;for(let p=a-A;p<=h+A;p++)p!==0&&d.push(new l.b6(p,n))}return d}coveringTiles(n){var d,v;let w=this.coveringZoomLevel(n);const C=w;if(n.minzoom!==void 0&&w<n.minzoom)return[];n.maxzoom!==void 0&&w>n.maxzoom&&(w=n.maxzoom);const B=this.pointCoordinate(this.getCameraPoint()),a=l.U.fromLngLat(this.center),h=Math.pow(2,w),A=[h*B.x,h*B.y,0],p=[h*a.x,h*a.y,0],y=yr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,w);let b=n.minzoom||0;!n.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(b=w);const T=n.terrain?2/Math.min(this.tileSize,n.tileSize)*this.tileSize:3,S=W=>({aabb:new So([W*h,0,0],[(W+1)*h,h,0]),zoom:0,x:0,y:0,wrap:W,fullyVisible:!1}),k=[],F=[],U=w,H=n.reparseOverscaled?C:w;if(this._renderWorldCopies)for(let W=1;W<=3;W++)k.push(S(-W)),k.push(S(W));for(k.push(S(0));k.length>0;){const W=k.pop(),Y=W.x,G=W.y;let se=W.fullyVisible;if(!se){const ve=W.aabb.intersects(y);if(ve===0)continue;se=ve===2}const me=n.terrain?A:p,Te=W.aabb.distanceX(me),de=W.aabb.distanceY(me),be=Math.max(Math.abs(Te),Math.abs(de));if(W.zoom===U||be>T+(1<<U-W.zoom)-2&&W.zoom>=b){const ve=U-W.zoom,Ye=A[0]-.5-(Y<<ve),je=A[1]-.5-(G<<ve);F.push({tileID:new l.O(W.zoom===U?H:W.zoom,W.wrap,W.zoom,Y,G),distanceSq:xt([p[0]-.5-Y,p[1]-.5-G]),tileDistanceToCamera:Math.sqrt(Ye*Ye+je*je)})}else for(let ve=0;ve<4;ve++){const Ye=(Y<<1)+ve%2,je=(G<<1)+(ve>>1),He=W.zoom+1;let $e=W.aabb.quadrant(ve);if(n.terrain){const zt=new l.O(He,W.wrap,He,Ye,je),vt=n.terrain.getMinMaxElevation(zt),mt=(d=vt.minElevation)!==null&&d!==void 0?d:this.elevation,pt=(v=vt.maxElevation)!==null&&v!==void 0?v:this.elevation;$e=new So([$e.min[0],$e.min[1],mt],[$e.max[0],$e.max[1],pt])}k.push({aabb:$e,zoom:He,x:Ye,y:je,wrap:W.wrap,fullyVisible:se})}}return F.sort((W,Y)=>W.distanceSq-Y.distanceSq).map(W=>W.tileID)}resize(n,d){this.width=n,this.height=d,this.pixelsToGLUnits=[2/n,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const d=l.ad(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.P(l.G(n.lng)*this.worldSize,l.H(d)*this.worldSize)}unproject(n){return new l.U(n.x/this.worldSize,n.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(n){const d=this.pointLocation(this.centerPoint,n),v=n.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-v))return;const w=this.getCameraPosition(),C=l.U.fromLngLat(w.lngLat,w.altitude),B=l.U.fromLngLat(d,v),a=C.x-B.x,h=C.y-B.y,A=C.z-B.z,p=Math.sqrt(a*a+h*h+A*A),y=this.scaleZoom(this.cameraToCenterDistance/p/this.tileSize);this._elevation=v,this._center=d,this.zoom=y}setLocationAtPoint(n,d){const v=this.pointCoordinate(d),w=this.pointCoordinate(this.centerPoint),C=this.locationCoordinate(n),B=new l.U(C.x-(v.x-w.x),C.y-(v.y-w.y));this.center=this.coordinateLocation(B),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(n,d){return d?this.coordinatePoint(this.locationCoordinate(n),d.getElevationForLngLatZoom(n,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(n))}pointLocation(n,d){return this.coordinateLocation(this.pointCoordinate(n,d))}locationCoordinate(n){return l.U.fromLngLat(n)}coordinateLocation(n){return n&&n.toLngLat()}pointCoordinate(n,d){if(d){const b=d.pointCoordinate(n);if(b!=null)return b}const v=[n.x,n.y,0,1],w=[n.x,n.y,1,1];l.ag(v,v,this.pixelMatrixInverse),l.ag(w,w,this.pixelMatrixInverse);const C=v[3],B=w[3],a=v[1]/C,h=w[1]/B,A=v[2]/C,p=w[2]/B,y=A===p?0:(0-A)/(p-A);return new l.U(l.B.number(v[0]/C,w[0]/B,y)/this.worldSize,l.B.number(a,h,y)/this.worldSize)}coordinatePoint(n,d=0,v=this.pixelMatrix){const w=[n.x*this.worldSize,n.y*this.worldSize,d,1];return l.ag(w,w,v),new l.P(w[0]/w[3],w[1]/w[3])}getBounds(){const n=Math.max(0,this.height/2-this.getHorizon());return new Ei().extend(this.pointLocation(new l.P(0,n))).extend(this.pointLocation(new l.P(this.width,n))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ei([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(n,d=!1){const v=n.key,w=d?this._alignedPosMatrixCache:this._posMatrixCache;if(w[v])return w[v];const C=n.canonical,B=this.worldSize/this.zoomScale(C.z),a=C.x+Math.pow(2,C.z)*n.wrap,h=l.ao(new Float64Array(16));return l.$(h,h,[a*B,C.y*B,0]),l.a0(h,h,[B/l.N,B/l.N,1]),l.a1(h,d?this.alignedProjMatrix:this.projMatrix,h),w[v]=new Float32Array(h),w[v]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let n,d,v,w,C=-90,B=90,a=-180,h=180;const A=this.size,p=this._unmodified;if(this.latRange){const T=this.latRange;C=l.H(T[1])*this.worldSize,B=l.H(T[0])*this.worldSize,n=B-C<A.y?A.y/(B-C):0}if(this.lngRange){const T=this.lngRange;a=l.b5(l.G(T[0])*this.worldSize,0,this.worldSize),h=l.b5(l.G(T[1])*this.worldSize,0,this.worldSize),h<a&&(h+=this.worldSize),d=h-a<A.x?A.x/(h-a):0}const y=this.point,b=Math.max(d||0,n||0);if(b)return this.center=this.unproject(new l.P(d?(h+a)/2:y.x,n?(B+C)/2:y.y)),this.zoom+=this.scaleZoom(b),this._unmodified=p,void(this._constraining=!1);if(this.latRange){const T=y.y,S=A.y/2;T-S<C&&(w=C+S),T+S>B&&(w=B-S)}if(this.lngRange){const T=(a+h)/2,S=l.b5(y.x,T-this.worldSize/2,T+this.worldSize/2),k=A.x/2;S-k<a&&(v=a+k),S+k>h&&(v=h-k)}v===void 0&&w===void 0||(this.center=this.unproject(new l.P(v!==void 0?v:y.x,w!==void 0?w:y.y)).wrap()),this._unmodified=p,this._constraining=!1}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,d=this.point.x,v=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b7(1,this.center.lat)*this.worldSize;let w=l.ao(new Float64Array(16));l.a0(w,w,[this.width/2,-this.height/2,1]),l.$(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=l.ao(new Float64Array(16)),l.a0(w,w,[1,-1,1]),l.$(w,w,[-1,-1,0]),l.a0(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w;const C=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),B=Math.min(this.elevation,this._minEleveationForCurrentTile),a=C-B*this._pixelPerMeter/Math.cos(this._pitch),h=B<0?a:C,A=Math.PI/2+this._pitch,p=this._fov*(.5+n.y/this.height),y=Math.sin(p)*h/Math.sin(l.ad(Math.PI-A-p,.01,Math.PI-.01)),b=this.getHorizon(),T=2*Math.atan(b/this.cameraToCenterDistance)*(.5+n.y/(2*b)),S=Math.sin(T)*h/Math.sin(l.ad(Math.PI-A-T,.01,Math.PI-.01)),k=Math.min(y,S),F=1.01*(Math.cos(Math.PI/2-this._pitch)*k+h),U=this.height/50;w=new Float64Array(16),l.b8(w,this._fov,this.width/this.height,U,F),w[8]=2*-n.x/this.width,w[9]=2*n.y/this.height,l.a0(w,w,[1,-1,1]),l.$(w,w,[0,0,-this.cameraToCenterDistance]),l.b9(w,w,this._pitch),l.ae(w,w,this.angle),l.$(w,w,[-d,-v,0]),this.mercatorMatrix=l.a0([],w,[this.worldSize,this.worldSize,this.worldSize]),l.a0(w,w,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.a1(new Float64Array(16),this.labelPlaneMatrix,w),l.$(w,w,[0,0,-this.elevation]),this.projMatrix=w,this.invProjMatrix=l.as([],w),this.pixelMatrix3D=l.a1(new Float64Array(16),this.labelPlaneMatrix,w);const H=this.width%2/2,W=this.height%2/2,Y=Math.cos(this.angle),G=Math.sin(this.angle),se=d-Math.round(d)+Y*H+G*W,me=v-Math.round(v)+Y*W+G*H,Te=new Float64Array(w);if(l.$(Te,Te,[se>.5?se-1:se,me>.5?me-1:me,0]),this.alignedProjMatrix=Te,w=l.as(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");this.pixelMatrixInverse=w,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const n=this.pointCoordinate(new l.P(0,0)),d=[n.x*this.worldSize,n.y*this.worldSize,0,1];return l.ag(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,n))}getCameraQueryGeometry(n){const d=this.getCameraPoint();if(n.length===1)return[n[0],d];{let v=d.x,w=d.y,C=d.x,B=d.y;for(const a of n)v=Math.min(v,a.x),w=Math.min(w,a.y),C=Math.max(C,a.x),B=Math.max(B,a.y);return[new l.P(v,w),new l.P(C,w),new l.P(C,B),new l.P(v,B),new l.P(v,w)]}}}function pn(E,n){let d,v=!1,w=null,C=null;const B=()=>{w=null,v&&(E.apply(C,d),w=setTimeout(B,n),v=!1)};return(...a)=>(v=!0,C=this,d=a,w||B(),w)}class sa{constructor(n){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let v;return d.split("&").map(w=>w.split("=")).forEach(w=>{w[0]===this._hashName&&(v=w)}),(v&&v[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(v=>isNaN(v))){const v=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:v,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=pn(this._updateHashUnthrottled,300),this._hashName=n&&encodeURIComponent(n)}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){const d=this._map.getCenter(),v=Math.round(100*this._map.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,w),B=Math.round(d.lng*C)/C,a=Math.round(d.lat*C)/C,h=this._map.getBearing(),A=this._map.getPitch();let p="";if(p+=n?`/${B}/${a}/${v}`:`${v}/${a}/${B}`,(h||A)&&(p+="/"+Math.round(10*h)/10),A&&(p+=`/${Math.round(A)}`),this._hashName){const y=this._hashName;let b=!1;const T=window.location.hash.slice(1).split("&").map(S=>{const k=S.split("=")[0];return k===y?(b=!0,`${k}=${p}`):S}).filter(S=>S);return b||T.push(`${y}=${p}`),`#${T.join("&")}`}return`#${p}`}}const Po={linearity:.3,easing:l.ba(0,0,.3,1)},Cl=l.e({deceleration:2500,maxSpeed:1400},Po),Pl=l.e({deceleration:20,maxSpeed:1400},Po),Io=l.e({deceleration:1e3,maxSpeed:360},Po),Kn=l.e({deceleration:1e3,maxSpeed:90},Po);class wc{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.h.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,d=l.h.now();for(;n.length>0&&d-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)d.zoom+=C.zoomDelta||0,d.bearing+=C.bearingDelta||0,d.pitch+=C.pitchDelta||0,C.panDelta&&d.pan._add(C.panDelta),C.around&&(d.around=C.around),C.pinchAround&&(d.pinchAround=C.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(d.pan.mag()){const C=na(d.pan.mag(),v,l.e({},Cl,n||{}));w.offset=d.pan.mult(C.amount/d.pan.mag()),w.center=this._map.transform.center,Qr(w,C)}if(d.zoom){const C=na(d.zoom,v,Pl);w.zoom=this._map.transform.zoom+C.amount,Qr(w,C)}if(d.bearing){const C=na(d.bearing,v,Io);w.bearing=this._map.transform.bearing+l.ad(C.amount,-179,179),Qr(w,C)}if(d.pitch){const C=na(d.pitch,v,Kn);w.pitch=this._map.transform.pitch+C.amount,Qr(w,C)}if(w.zoom||w.bearing){const C=d.pinchAround===void 0?d.around:d.pinchAround;w.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),l.e(w,{noMoveStart:!0})}}function Qr(E,n){(!E.duration||E.duration<n.duration)&&(E.duration=n.duration,E.easing=n.easing)}function na(E,n,d){const{maxSpeed:v,linearity:w,deceleration:C}=d,B=l.ad(E*w/(n/1e3),-v,v),a=Math.abs(B)/(C*w);return{easing:d.easing,duration:1e3*a,amount:B*(a/2)}}class os extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,d,v,w={}){const C=R.mousePos(d.getCanvasContainer(),v),B=d.unproject(C);super(n,l.e({point:C,lngLat:B,originalEvent:v},w)),this._defaultPrevented=!1,this.target=d}}class oa extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,d,v){const w=n==="touchend"?v.changedTouches:v.touches,C=R.touchPos(d.getCanvasContainer(),w),B=C.map(h=>d.unproject(h)),a=C.reduce((h,A,p,y)=>h.add(A.div(y.length)),new l.P(0,0));super(n,{points:C,point:a,lngLats:B,lngLat:d.unproject(a),originalEvent:v}),this._defaultPrevented=!1}}class Tc extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,d,v){super(n,{originalEvent:v}),this._defaultPrevented=!1}}class Ec{constructor(n,d){this._map=n,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new Tc(n.type,this._map,n))}mousedown(n,d){return this._mousedownPos=d,this._firePreventable(new os(n.type,this._map,n))}mouseup(n){this._map.fire(new os(n.type,this._map,n))}click(n,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new os(n.type,this._map,n))}dblclick(n){return this._firePreventable(new os(n.type,this._map,n))}mouseover(n){this._map.fire(new os(n.type,this._map,n))}mouseout(n){this._map.fire(new os(n.type,this._map,n))}touchstart(n){return this._firePreventable(new oa(n.type,this._map,n))}touchmove(n){this._map.fire(new oa(n.type,this._map,n))}touchend(n){this._map.fire(new oa(n.type,this._map,n))}touchcancel(n){this._map.fire(new oa(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sc{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(n){this._map.fire(new os(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new os("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._ignoreContextMenu||this._map.fire(new os(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gn{constructor(n){this._map=n}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(n){return this.transform.pointLocation(l.P.convert(n),this._map.terrain)}}class Na{constructor(n,d){this._map=n,this._tr=new gn(n),this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,d){this.isEnabled()&&n.shiftKey&&n.button===0&&(R.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(n,d){if(!this._active)return;const v=d;if(this._lastPos.equals(v)||!this._box&&v.dist(this._startPos)<this._clickTolerance)return;const w=this._startPos;this._lastPos=v,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",n));const C=Math.min(w.x,v.x),B=Math.max(w.x,v.x),a=Math.min(w.y,v.y),h=Math.max(w.y,v.y);R.setTransform(this._box,`translate(${C}px,${a}px)`),this._box.style.width=B-C+"px",this._box.style.height=h-a+"px"}mouseupWindow(n,d){if(!this._active||n.button!==0)return;const v=this._startPos,w=d;if(this.reset(),R.suppressClick(),v.x!==w.x||v.y!==w.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:n})),{cameraAnimation:C=>C.fitScreenCoordinates(v,w,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,d){return this._map.fire(new l.k(n,{originalEvent:d}))}}function as(E,n){if(E.length!==n.length)throw new Error(`The number of touches and points are not equal - touches ${E.length}, points ${n.length}`);const d={};for(let v=0;v<E.length;v++)d[E[v].identifier]=n[v];return d}class js{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,d,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const C=new l.P(0,0);for(const B of w)C._add(B);return C.div(w.length)}(d),this.touches=as(v,d)))}touchmove(n,d,v){if(this.aborted||!this.centroid)return;const w=as(v,d);for(const C in this.touches){const B=w[C];(!B||B.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(n,d,v){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class za{constructor(n){this.singleTap=new js(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,d,v){this.singleTap.touchstart(n,d,v)}touchmove(n,d,v){this.singleTap.touchmove(n,d,v)}touchend(n,d,v){const w=this.singleTap.touchend(n,d,v);if(w){const C=n.timeStamp-this.lastTime<500,B=!this.lastTap||this.lastTap.dist(w)<30;if(C&&B||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class _n{constructor(n){this._tr=new gn(n),this._zoomIn=new za({numTouches:1,numTaps:2}),this._zoomOut=new za({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,d,v){this._zoomIn.touchstart(n,d,v),this._zoomOut.touchstart(n,d,v)}touchmove(n,d,v){this._zoomIn.touchmove(n,d,v),this._zoomOut.touchmove(n,d,v)}touchend(n,d,v){const w=this._zoomIn.touchend(n,d,v),C=this._zoomOut.touchend(n,d,v),B=this._tr;return w?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:a=>a.easeTo({duration:300,zoom:B.zoom+1,around:B.unproject(w)},{originalEvent:n})}):C?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:a=>a.easeTo({duration:300,zoom:B.zoom-1,around:B.unproject(C)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mn{constructor(n){this._enabled=!!n.enable,this._moveStateManager=n.moveStateManager,this._clickTolerance=n.clickTolerance||1,this._moveFunction=n.move,this._activateOnStart=!!n.activateOnStart,n.assignEvents(this),this.reset()}reset(n){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(n)}_move(...n){const d=this._moveFunction(...n);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(n,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(n)&&(this._moveStateManager.startMove(n),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(n,d){if(!this.isEnabled())return;const v=this._lastPoint;if(!v)return;if(n.preventDefault(),!this._moveStateManager.isValidMoveEvent(n))return void this.reset(n);const w=d.length?d[0]:d;return!this._moved&&w.dist(v)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=w,this._move(v,w))}dragEnd(n){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(n)&&(this._moved&&R.suppressClick(),this.reset(n))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const zh={0:1,2:2};class Il{constructor(n){this._correctEvent=n.checkCorrectEvent}startMove(n){const d=R.mouseButton(n);this._eventButton=d}endMove(n){delete this._eventButton}isValidStartEvent(n){return this._correctEvent(n)}isValidMoveEvent(n){return!function(d,v){const w=zh[v];return d.buttons===void 0||(d.buttons&w)!==w}(n,this._eventButton)}isValidEndEvent(n){return R.mouseButton(n)===this._eventButton}}class Cc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(n){return n.targetTouches.length===1}_isSameTouchEvent(n){return n.targetTouches[0].identifier===this._firstTouch}startMove(n){this._firstTouch=n.targetTouches[0].identifier}endMove(n){delete this._firstTouch}isValidStartEvent(n){return this._isOneFingerTouch(n)}isValidMoveEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}isValidEndEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}}const Ua=E=>{E.mousedown=E.dragStart,E.mousemoveWindow=E.dragMove,E.mouseup=E.dragEnd,E.contextmenu=function(n){n.preventDefault()}},Jn=({enable:E,clickTolerance:n,bearingDegreesPerPixelMoved:d=.8})=>{const v=new Il({checkCorrectEvent:w=>R.mouseButton(w)===0&&w.ctrlKey||R.mouseButton(w)===2});return new mn({clickTolerance:n,move:(w,C)=>({bearingDelta:(C.x-w.x)*d}),moveStateManager:v,enable:E,assignEvents:Ua})},yn=({enable:E,clickTolerance:n,pitchDegreesPerPixelMoved:d=-.5})=>{const v=new Il({checkCorrectEvent:w=>R.mouseButton(w)===0&&w.ctrlKey||R.mouseButton(w)===2});return new mn({clickTolerance:n,move:(w,C)=>({pitchDelta:(C.y-w.y)*d}),moveStateManager:v,enable:E,assignEvents:Ua})};class bt{constructor(n,d){this._minTouches=n.cooperativeGestures?2:1,this._clickTolerance=n.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(n,d,v){return this._calculateTransform(n,d,v)}touchmove(n,d,v){if(this._map._cooperativeGestures&&(this._minTouches===2&&v.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(n,!1,v.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(v.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,d,v)}touchend(n,d,v){this._calculateTransform(n,d,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,d,v){v.length>0&&(this._active=!0);const w=as(v,d),C=new l.P(0,0),B=new l.P(0,0);let a=0;for(const A in w){const p=w[A],y=this._touches[A];y&&(C._add(p),B._add(p.sub(y)),a++,w[A]=p)}if(this._touches=w,a<this._minTouches||!B.mag())return;const h=B.div(a);return this._sum._add(h),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(a),panDelta:h}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ss{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(n,d,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([d[0],d[1]]))}touchmove(n,d,v){if(!this._firstTwoTouches)return;n.preventDefault();const[w,C]=this._firstTwoTouches,B=bn(v,d,w),a=bn(v,d,C);if(!B||!a)return;const h=this._aroundCenter?null:B.add(a).div(2);return this._move([B,a],h,n)}touchend(n,d,v){if(!this._firstTwoTouches)return;const[w,C]=this._firstTwoTouches,B=bn(v,d,w),a=bn(v,d,C);B&&a||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function bn(E,n,d){for(let v=0;v<E.length;v++)if(E[v].identifier===d)return n[v]}function Mo(E,n){return Math.log(E/n)/Math.LN2}class Pc extends Ss{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,d){const v=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Mo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mo(this._distance,v),pinchAround:d}}}function dt(E,n){return 180*E.angleWith(n)/Math.PI}class Ml extends Ss{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,d){const v=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:dt(this._vector,v),pinchAround:d}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const d=25/(Math.PI*this._minDiameter)*360,v=dt(n,this._startVector);return Math.abs(v)<d}}function Rl(E){return Math.abs(E.y)>Math.abs(E.x)}class Dn extends Ss{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(n,d,v){super.touchstart(n,d,v),this._currentTouchCount=v.length}_start(n){this._lastPoints=n,Rl(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,d,v){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const w=n[0].sub(this._lastPoints[0]),C=n[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(w,C,v.timeStamp),this._valid?(this._lastPoints=n,this._active=!0,{pitchDelta:(w.y+C.y)/2*-.5}):void 0}gestureBeginsVertically(n,d,v){if(this._valid!==void 0)return this._valid;const w=n.mag()>=2,C=d.mag()>=2;if(!w&&!C)return;if(!w||!C)return this._firstMove===void 0&&(this._firstMove=v),v-this._firstMove<100&&void 0;const B=n.y>0==d.y>0;return Rl(n)&&Rl(d)&&B}}const Va={panStep:100,bearingStep:15,pitchStep:10};class kl{constructor(n){this._tr=new gn(n);const d=Va;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let d=0,v=0,w=0,C=0,B=0;switch(n.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:n.shiftKey?v=-1:(n.preventDefault(),C=-1);break;case 39:n.shiftKey?v=1:(n.preventDefault(),C=1);break;case 38:n.shiftKey?w=1:(n.preventDefault(),B=-1);break;case 40:n.shiftKey?w=-1:(n.preventDefault(),B=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:a=>{const h=this._tr;a.easeTo({duration:300,easeId:"keyboardHandler",easing:Ic,zoom:d?Math.round(h.zoom)+d*(n.shiftKey?2:1):h.zoom,bearing:h.bearing+v*this._bearingStep,pitch:h.pitch+w*this._pitchStep,offset:[-C*this._panStep,-B*this._panStep],center:h.center},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ic(E){return E*(2-E)}const Mc=4.000244140625;class Uh{constructor(n,d){this._onTimeout=v=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(v)},this._map=n,this._tr=new gn(n),this._el=n.getCanvasContainer(),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!n[this._map._metaKey])return;n.preventDefault()}let d=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const v=l.h.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,d!==0&&d%Mc==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(w*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),n.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=n,this._delta-=d,this._active||this._start(n)),n.preventDefault()}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=R.mousePos(this._el,n),v=this._tr;this._around=l.L.convert(this._aroundCenter?v.center:v.unproject(d)),this._aroundPoint=v.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._tr.transform;if(this._delta!==0){const a=this._type==="wheel"&&Math.abs(this._delta)>Mc?this._wheelZoomRate:this._defaultZoomRate;let h=2/(1+Math.exp(-Math.abs(this._delta*a)));this._delta<0&&h!==0&&(h=1/h);const A=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(A*h))),this._type==="wheel"&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:n.zoom,v=this._startZoom,w=this._easing;let C,B=!1;if(this._type==="wheel"&&v&&w){const a=Math.min((l.h.now()-this._lastWheelEventTime)/200,1),h=w(a);C=l.B.number(v,d,h),a<1?this._frameId||(this._frameId=!0):B=!0}else C=d,B=!0;return this._active=!0,B&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!B,zoomDelta:C-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let d=l.bb;if(this._prevEase){const v=this._prevEase,w=(l.h.now()-v.start)/v.duration,C=v.easing(w+.01)-v.easing(w),B=.27/Math.sqrt(C*C+1e-4)*.01,a=Math.sqrt(.0729-B*B);d=l.ba(B,a,.25,1)}return this._prevEase={start:l.h.now(),duration:n,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Dl{constructor(n,d){this._clickZoom=n,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bl{constructor(n){this._tr=new gn(n),this.reset()}reset(){this._active=!1}dblclick(n,d){return n.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:this._tr.zoom+(n.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fl{constructor(){this._tap=new za({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(n,d,v){if(!this._swipePoint)if(this._tapTime){const w=d[0],C=n.timeStamp-this._tapTime<500,B=this._tapPoint.dist(w)<30;C&&B?v.length>0&&(this._swipePoint=w,this._swipeTouch=v[0].identifier):this.reset()}else this._tap.touchstart(n,d,v)}touchmove(n,d,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=d[0],C=w.y-this._swipePoint.y;return this._swipePoint=w,n.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(n,d,v)}touchend(n,d,v){if(this._tapTime)this._swipePoint&&v.length===0&&this.reset();else{const w=this._tap.touchend(n,d,v);w&&(this._tapTime=n.timeStamp,this._tapPoint=w)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ol{constructor(n,d,v){this._el=n,this._mousePan=d,this._touchPan=v}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Kr{constructor(n,d,v){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=d,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bn{constructor(n,d,v,w){this._el=n,this._touchZoom=d,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const aa=E=>E.zoom||E.drag||E.pitch||E.rotate;class Ll extends l.k{}function Ro(E){return E.panDelta&&E.panDelta.mag()||E.zoomDelta||E.bearingDelta||E.pitchDelta}class ja{constructor(n,d){this.handleWindowEvent=w=>{this.handleEvent(w,`${w.type}Window`)},this.handleEvent=(w,C)=>{if(w.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const B=w.type==="renderFrame"?void 0:w,a={needsRenderFrame:!1},h={},A={},p=w.touches,y=p?this._getMapTouches(p):void 0,b=y?R.touchPos(this._el,y):R.mousePos(this._el,w);for(const{handlerName:k,handler:F,allowed:U}of this._handlers){if(!F.isEnabled())continue;let H;this._blockedByActive(A,U,k)?F.reset():F[C||w.type]&&(H=F[C||w.type](w,b,y),this.mergeHandlerResult(a,h,H,k,B),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||F.isActive())&&(A[k]=F)}const T={};for(const k in this._previousActiveHandlers)A[k]||(T[k]=B);this._previousActiveHandlers=A,(Object.keys(T).length||Ro(a))&&(this._changes.push([a,h,T]),this._triggerRenderFrame()),(Object.keys(A).length||Ro(a))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:S}=a;S&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],S(this._map))},this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wc(n),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,C,B]of this._listeners)R.addEventListener(w,C,w===document?this.handleWindowEvent:this.handleEvent,B)}destroy(){for(const[n,d,v]of this._listeners)R.removeEventListener(n,d,n===document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(n){const d=this._map,v=d.getCanvasContainer();this._add("mapEvent",new Ec(d,n));const w=d.boxZoom=new Na(d,n);this._add("boxZoom",w),n.interactive&&n.boxZoom&&w.enable();const C=new _n(d),B=new Bl(d);d.doubleClickZoom=new Dl(B,C),this._add("tapZoom",C),this._add("clickZoom",B),n.interactive&&n.doubleClickZoom&&d.doubleClickZoom.enable();const a=new Fl;this._add("tapDragZoom",a);const h=d.touchPitch=new Dn(d);this._add("touchPitch",h),n.interactive&&n.touchPitch&&d.touchPitch.enable(n.touchPitch);const A=Jn(n),p=yn(n);d.dragRotate=new Kr(n,A,p),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",p,["mouseRotate"]),n.interactive&&n.dragRotate&&d.dragRotate.enable();const y=(({enable:U,clickTolerance:H})=>{const W=new Il({checkCorrectEvent:Y=>R.mouseButton(Y)===0&&!Y.ctrlKey});return new mn({clickTolerance:H,move:(Y,G)=>({around:G,panDelta:G.sub(Y)}),activateOnStart:!0,moveStateManager:W,enable:U,assignEvents:Ua})})(n),b=new bt(n,d);d.dragPan=new Ol(v,y,b),this._add("mousePan",y),this._add("touchPan",b,["touchZoom","touchRotate"]),n.interactive&&n.dragPan&&d.dragPan.enable(n.dragPan);const T=new Ml,S=new Pc;d.touchZoomRotate=new Bn(v,S,T,a),this._add("touchRotate",T,["touchPan","touchZoom"]),this._add("touchZoom",S,["touchPan","touchRotate"]),n.interactive&&n.touchZoomRotate&&d.touchZoomRotate.enable(n.touchZoomRotate);const k=d.scrollZoom=new Uh(d,()=>this._triggerRenderFrame());this._add("scrollZoom",k,["mousePan"]),n.interactive&&n.scrollZoom&&d.scrollZoom.enable(n.scrollZoom);const F=d.keyboard=new kl(d);this._add("keyboard",F),n.interactive&&n.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new Sc(d))}_add(n,d,v){this._handlers.push({handlerName:n,handler:d,allowed:v}),this._handlersById[n]=d}stop(n){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!aa(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,d,v){for(const w in n)if(w!==v&&(!d||d.indexOf(w)<0))return!0;return!1}_getMapTouches(n){const d=[];for(const v of n)this._el.contains(v.target)&&d.push(v);return d}mergeHandlerResult(n,d,v,w,C){if(!v)return;l.e(n,v);const B={handlerName:w,originalEvent:v.originalEvent||C};v.zoomDelta!==void 0&&(d.zoom=B),v.panDelta!==void 0&&(d.drag=B),v.pitchDelta!==void 0&&(d.pitch=B),v.bearingDelta!==void 0&&(d.rotate=B)}_applyChanges(){const n={},d={},v={};for(const[w,C,B]of this._changes)w.panDelta&&(n.panDelta=(n.panDelta||new l.P(0,0))._add(w.panDelta)),w.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(n.around=w.around),w.pinchAround!==void 0&&(n.pinchAround=w.pinchAround),w.noInertia&&(n.noInertia=w.noInertia),l.e(d,C),l.e(v,B);this._updateMapTransform(n,d,v),this._changes=[]}_updateMapTransform(n,d,v){const w=this._map,C=w._getTransformForUpdate(),B=w.terrain;if(!(Ro(n)||B&&this._terrainMovement))return this._fireEvents(d,v,!0);let{panDelta:a,zoomDelta:h,bearingDelta:A,pitchDelta:p,around:y,pinchAround:b}=n;b!==void 0&&(y=b),w._stop(!0),y=y||w.transform.centerPoint;const T=C.pointLocation(a?y.sub(a):y);A&&(C.bearing+=A),p&&(C.pitch+=p),h&&(C.zoom+=h),B?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?C.center=C.pointLocation(C.centerPoint.sub(a)):C.setLocationAtPoint(T,y):(this._terrainMovement=!0,this._map._elevationFreeze=!0,C.setLocationAtPoint(T,y),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,C.recalculateZoom(w.terrain)})):C.setLocationAtPoint(T,y),w._applyUpdatedTransform(C),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(d,v,!0)}_fireEvents(n,d,v){const w=aa(this._eventsInProgress),C=aa(n),B={};for(const p in n){const{originalEvent:y}=n[p];this._eventsInProgress[p]||(B[`${p}start`]=y),this._eventsInProgress[p]=n[p]}!w&&C&&this._fireEvent("movestart",C.originalEvent);for(const p in B)this._fireEvent(p,B[p]);C&&this._fireEvent("move",C.originalEvent);for(const p in n){const{originalEvent:y}=n[p];this._fireEvent(p,y)}const a={};let h;for(const p in this._eventsInProgress){const{handlerName:y,originalEvent:b}=this._eventsInProgress[p];this._handlersById[y].isActive()||(delete this._eventsInProgress[p],h=d[y]||b,a[`${p}end`]=h)}for(const p in a)this._fireEvent(p,a[p]);const A=aa(this._eventsInProgress);if(v&&(w||C)&&!A){this._updatingCamera=!0;const p=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),y=b=>b!==0&&-this._bearingSnap<b&&b<this._bearingSnap;!p||!p.essential&&l.h.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:h})),y(this._map.getBearing())&&this._map.resetNorth()):(y(p.bearing||this._map.getBearing())&&(p.bearing=0),p.freezeElevation=!0,this._map.easeTo(p,{originalEvent:h})),this._updatingCamera=!1}}_fireEvent(n,d){this._map.fire(new l.k(n,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new Ll("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ir extends l.E{constructor(n,d){super(),this._renderFrameCallback=()=>{const v=Math.min((l.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(v)),v<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.L(this.transform.center.lng,this.transform.center.lat)}setCenter(n,d){return this.jumpTo({center:n},d)}panBy(n,d,v){return n=l.P.convert(n).mult(-1),this.panTo(this.transform.center,l.e({offset:n},d),v)}panTo(n,d,v){return this.easeTo(l.e({center:n},d),v)}getZoom(){return this.transform.zoom}setZoom(n,d){return this.jumpTo({zoom:n},d),this}zoomTo(n,d,v){return this.easeTo(l.e({zoom:n},d),v)}zoomIn(n,d){return this.zoomTo(this.getZoom()+1,n,d),this}zoomOut(n,d){return this.zoomTo(this.getZoom()-1,n,d),this}getBearing(){return this.transform.bearing}setBearing(n,d){return this.jumpTo({bearing:n},d),this}getPadding(){return this.transform.padding}setPadding(n,d){return this.jumpTo({padding:n},d),this}rotateTo(n,d,v){return this.easeTo(l.e({bearing:n},d),v)}resetNorth(n,d){return this.rotateTo(0,l.e({duration:1e3},n),d),this}resetNorthPitch(n,d){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},n),d),this}snapToNorth(n,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,d):this}getPitch(){return this.transform.pitch}setPitch(n,d){return this.jumpTo({pitch:n},d),this}cameraForBounds(n,d){n=Ei.convert(n);const v=d&&d.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),v,d)}_cameraForBoxAndBearing(n,d,v,w){const C={top:0,bottom:0,right:0,left:0};if(typeof(w=l.e({padding:C,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){const G=w.padding;w.padding={top:G,bottom:G,right:G,left:G}}w.padding=l.e(C,w.padding);const B=this.transform,a=B.padding,h=B.project(l.L.convert(n)),A=B.project(l.L.convert(d)),p=h.rotate(-v*Math.PI/180),y=A.rotate(-v*Math.PI/180),b=new l.P(Math.max(p.x,y.x),Math.max(p.y,y.y)),T=new l.P(Math.min(p.x,y.x),Math.min(p.y,y.y)),S=b.sub(T),k=(B.width-(a.left+a.right+w.padding.left+w.padding.right))/S.x,F=(B.height-(a.top+a.bottom+w.padding.top+w.padding.bottom))/S.y;if(F<0||k<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const U=Math.min(B.scaleZoom(B.scale*Math.min(k,F)),w.maxZoom),H=l.P.convert(w.offset),W=new l.P((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(v*Math.PI/180),Y=H.add(W).mult(B.scale/B.zoomScale(U));return{center:B.unproject(h.add(A).div(2).sub(Y)),zoom:U,bearing:v}}fitBounds(n,d,v){return this._fitInternal(this.cameraForBounds(n,d),d,v)}fitScreenCoordinates(n,d,v,w,C){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(n)),this.transform.pointLocation(l.P.convert(d)),v,w),w,C)}_fitInternal(n,d,v){return n?(delete(d=l.e(n,d)).padding,d.linear?this.easeTo(d,v):this.flyTo(d,v)):this}jumpTo(n,d){this.stop();const v=this._getTransformForUpdate();let w=!1,C=!1,B=!1;return"zoom"in n&&v.zoom!==+n.zoom&&(w=!0,v.zoom=+n.zoom),n.center!==void 0&&(v.center=l.L.convert(n.center)),"bearing"in n&&v.bearing!==+n.bearing&&(C=!0,v.bearing=+n.bearing),"pitch"in n&&v.pitch!==+n.pitch&&(B=!0,v.pitch=+n.pitch),n.padding==null||v.isPaddingEqual(n.padding)||(v.padding=n.padding),this._applyUpdatedTransform(v),this.fire(new l.k("movestart",d)).fire(new l.k("move",d)),w&&this.fire(new l.k("zoomstart",d)).fire(new l.k("zoom",d)).fire(new l.k("zoomend",d)),C&&this.fire(new l.k("rotatestart",d)).fire(new l.k("rotate",d)).fire(new l.k("rotateend",d)),B&&this.fire(new l.k("pitchstart",d)).fire(new l.k("pitch",d)).fire(new l.k("pitchend",d)),this.fire(new l.k("moveend",d))}calculateCameraOptionsFromTo(n,d,v,w=0){const C=l.U.fromLngLat(n,d),B=l.U.fromLngLat(v,w),a=B.x-C.x,h=B.y-C.y,A=B.z-C.z,p=Math.hypot(a,h,A);if(p===0)throw new Error("Can't calculate camera options with same From and To");const y=Math.hypot(a,h),b=this.transform.scaleZoom(this.transform.cameraToCenterDistance/p/this.transform.tileSize),T=180*Math.atan2(a,-h)/Math.PI;let S=180*Math.acos(y/p)/Math.PI;return S=A<0?90-S:90+S,{center:B.toLngLat(),zoom:b,pitch:S,bearing:T}}easeTo(n,d){this._stop(!1,n.easeId),((n=l.e({offset:[0,0],duration:500,easing:l.bb},n)).animate===!1||!n.essential&&l.h.prefersReducedMotion)&&(n.duration=0);const v=this._getTransformForUpdate(),w=this.getZoom(),C=this.getBearing(),B=this.getPitch(),a=this.getPadding(),h="zoom"in n?+n.zoom:w,A="bearing"in n?this._normalizeBearing(n.bearing,C):C,p="pitch"in n?+n.pitch:B,y="padding"in n?n.padding:v.padding,b=l.P.convert(n.offset);let T=v.centerPoint.add(b);const S=v.pointLocation(T),k=l.L.convert(n.center||S);this._normalizeCenter(k);const F=v.project(S),U=v.project(k).sub(F),H=v.zoomScale(h-w);let W,Y;n.around&&(W=l.L.convert(n.around),Y=v.locationPoint(W));const G={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||h!==w,this._rotating=this._rotating||C!==A,this._pitching=this._pitching||p!==B,this._padding=!v.isPaddingEqual(y),this._easeId=n.easeId,this._prepareEase(d,n.noMoveStart,G),this.terrain&&this._prepareElevation(k),this._ease(se=>{if(this._zooming&&(v.zoom=l.B.number(w,h,se)),this._rotating&&(v.bearing=l.B.number(C,A,se)),this._pitching&&(v.pitch=l.B.number(B,p,se)),this._padding&&(v.interpolatePadding(a,y,se),T=v.centerPoint.add(b)),this.terrain&&!n.freezeElevation&&this._updateElevation(se),W)v.setLocationAtPoint(W,Y);else{const me=v.zoomScale(v.zoom-w),Te=h>w?Math.min(2,H):Math.max(.5,H),de=Math.pow(Te,1-se),be=v.unproject(F.add(U.mult(se*de)).mult(me));v.setLocationAtPoint(v.renderWorldCopies?be.wrap():be,T)}this._applyUpdatedTransform(v),this._fireMoveEvents(d)},se=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,se)},n),this}_prepareEase(n,d,v={}){this._moving=!0,d||v.moving||this.fire(new l.k("movestart",n)),this._zooming&&!v.zooming&&this.fire(new l.k("zoomstart",n)),this._rotating&&!v.rotating&&this.fire(new l.k("rotatestart",n)),this._pitching&&!v.pitching&&this.fire(new l.k("pitchstart",n))}_prepareElevation(n){this._elevationCenter=n,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(n){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(n<1&&d!==this._elevationTarget){const v=this._elevationTarget-this._elevationStart;this._elevationStart+=n*(v-(d-(v*n+this._elevationStart))/(1-n)),this._elevationTarget=d}this.transform.elevation=l.B.number(this._elevationStart,this._elevationTarget,n)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(n){if(!this.transformCameraUpdate)return;const d=n.clone(),{center:v,zoom:w,pitch:C,bearing:B,elevation:a}=this.transformCameraUpdate(d);v&&(d.center=v),w!==void 0&&(d.zoom=w),C!==void 0&&(d.pitch=C),B!==void 0&&(d.bearing=B),a!==void 0&&(d.elevation=a),this.transform.apply(d)}_fireMoveEvents(n){this.fire(new l.k("move",n)),this._zooming&&this.fire(new l.k("zoom",n)),this._rotating&&this.fire(new l.k("rotate",n)),this._pitching&&this.fire(new l.k("pitch",n))}_afterEase(n,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const v=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new l.k("zoomend",n)),w&&this.fire(new l.k("rotateend",n)),C&&this.fire(new l.k("pitchend",n)),this.fire(new l.k("moveend",n))}flyTo(n,d){if(!n.essential&&l.h.prefersReducedMotion){const $e=l.F(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo($e,d)}this.stop(),n=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.bb},n);const v=this._getTransformForUpdate(),w=this.getZoom(),C=this.getBearing(),B=this.getPitch(),a=this.getPadding(),h="zoom"in n?l.ad(+n.zoom,v.minZoom,v.maxZoom):w,A="bearing"in n?this._normalizeBearing(n.bearing,C):C,p="pitch"in n?+n.pitch:B,y="padding"in n?n.padding:v.padding,b=v.zoomScale(h-w),T=l.P.convert(n.offset);let S=v.centerPoint.add(T);const k=v.pointLocation(S),F=l.L.convert(n.center||k);this._normalizeCenter(F);const U=v.project(k),H=v.project(F).sub(U);let W=n.curve;const Y=Math.max(v.width,v.height),G=Y/b,se=H.mag();if("minZoom"in n){const $e=l.ad(Math.min(n.minZoom,w,h),v.minZoom,v.maxZoom),zt=Y/v.zoomScale($e-w);W=Math.sqrt(zt/se*2)}const me=W*W;function Te($e){const zt=(G*G-Y*Y+($e?-1:1)*me*me*se*se)/(2*($e?G:Y)*me*se);return Math.log(Math.sqrt(zt*zt+1)-zt)}function de($e){return(Math.exp($e)-Math.exp(-$e))/2}function be($e){return(Math.exp($e)+Math.exp(-$e))/2}const ve=Te(!1);let Ye=function($e){return be(ve)/be(ve+W*$e)},je=function($e){return Y*((be(ve)*(de(zt=ve+W*$e)/be(zt))-de(ve))/me)/se;var zt},He=(Te(!0)-ve)/W;if(Math.abs(se)<1e-6||!isFinite(He)){if(Math.abs(Y-G)<1e-6)return this.easeTo(n,d);const $e=G<Y?-1:1;He=Math.abs(Math.log(G/Y))/W,je=function(){return 0},Ye=function(zt){return Math.exp($e*W*zt)}}return n.duration="duration"in n?+n.duration:1e3*He/("screenSpeed"in n?+n.screenSpeed/W:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=C!==A,this._pitching=p!==B,this._padding=!v.isPaddingEqual(y),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(F),this._ease($e=>{const zt=$e*He,vt=1/Ye(zt);v.zoom=$e===1?h:w+v.scaleZoom(vt),this._rotating&&(v.bearing=l.B.number(C,A,$e)),this._pitching&&(v.pitch=l.B.number(B,p,$e)),this._padding&&(v.interpolatePadding(a,y,$e),S=v.centerPoint.add(T)),this.terrain&&!n.freezeElevation&&this._updateElevation($e);const mt=$e===1?F:v.unproject(U.add(H.mult(je(zt))).mult(vt));v.setLocationAtPoint(v.renderWorldCopies?mt.wrap():mt,S),this._applyUpdatedTransform(v),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const v=this._onEaseEnd;delete this._onEaseEnd,v.call(this,d)}if(!n){const v=this.handlers;v&&v.stop(!1)}return this}_ease(n,d,v){v.animate===!1||v.duration===0?(n(1),d()):(this._easeStart=l.h.now(),this._easeOptions=v,this._onEaseFrame=n,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(n,d){n=l.b5(n,-180,180);const v=Math.abs(n-d);return Math.abs(n-360-d)<v&&(n-=360),Math.abs(n+360-d)<v&&(n+=360),n}_normalizeCenter(n){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const v=n.lng-d.center.lng;n.lng+=v>180?-360:v<-180?360:0}queryTerrainElevation(n){return this.terrain?this.terrain.getElevationForLngLatZoom(l.L.convert(n),this.transform.tileZoom)-this.transform.elevation:null}}class ls{constructor(n={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=n}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options&&this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(n,d){const v=this._map._getUIString(`AttributionControl.${d}`);n.title=v,n.setAttribute("aria-label",v)}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(w=>typeof w!="string"?"":w)):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const d=this._map.style.sourceCaches;for(const w in d){const C=d[w];if(C.used||C.usedForTerrain){const B=C.getSource();B.attribution&&n.indexOf(B.attribution)<0&&n.push(B.attribution)}}n=n.filter(w=>String(w).trim()),n.sort((w,C)=>w.length-C.length),n=n.filter((w,C)=>{for(let B=C+1;B<n.length;B++)if(n[B].indexOf(w)>=0)return!1;return!0});const v=n.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,n.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class zi{constructor(n={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const v=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&v.classList.add("maplibregl-compact"):v.classList.remove("maplibregl-compact")}},this.options=n}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");const d=R.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Fn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const d=++this._id;return this._queue.push({callback:n,id:d,cancelled:!1}),d}remove(n){const d=this._currentlyRunning,v=d?this._queue.concat(d):this._queue;for(const w of v)if(w.id===n)return void(w.cancelled=!0)}run(n=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const v of d)if(!v.cancelled&&(v.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Jr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Rc=l.Q([{name:"a_pos3d",type:"Int16",components:3}]);class kc extends l.E{constructor(n){super(),this.sourceCache=n,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,n.usedForTerrain=!0,n.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(n,d){this.sourceCache.update(n,d),this._renderableTilesKeys=[];const v={};for(const w of n.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))v[w.key]=!0,this._renderableTilesKeys.push(w.key),this._tiles[w.key]||(w.posMatrix=new Float64Array(16),l.aS(w.posMatrix,0,l.N,0,l.N,0,1),this._tiles[w.key]=new Ur(w,this.tileSize));for(const w in this._tiles)v[w]||delete this._tiles[w]}freeRtt(n){for(const d in this._tiles){const v=this._tiles[d];(!n||v.tileID.equals(n)||v.tileID.isChildOf(n)||n.isChildOf(v.tileID))&&(v.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(n=>this.getTileByID(n))}getTileByID(n){return this._tiles[n]}getTerrainCoords(n){const d={};for(const v of this._renderableTilesKeys){const w=this._tiles[v].tileID;if(w.canonical.equals(n.canonical)){const C=n.clone();C.posMatrix=new Float64Array(16),l.aS(C.posMatrix,0,l.N,0,l.N,0,1),d[v]=C}else if(w.canonical.isChildOf(n.canonical)){const C=n.clone();C.posMatrix=new Float64Array(16);const B=w.canonical.z-n.canonical.z,a=w.canonical.x-(w.canonical.x>>B<<B),h=w.canonical.y-(w.canonical.y>>B<<B),A=l.N>>B;l.aS(C.posMatrix,0,A,0,A,0,1),l.$(C.posMatrix,C.posMatrix,[-a*A,-h*A,0]),d[v]=C}else if(n.canonical.isChildOf(w.canonical)){const C=n.clone();C.posMatrix=new Float64Array(16);const B=n.canonical.z-w.canonical.z,a=n.canonical.x-(n.canonical.x>>B<<B),h=n.canonical.y-(n.canonical.y>>B<<B),A=l.N>>B;l.aS(C.posMatrix,0,l.N,0,l.N,0,1),l.$(C.posMatrix,C.posMatrix,[a*A,h*A,0]),l.a0(C.posMatrix,C.posMatrix,[1/2**B,1/2**B,0]),d[v]=C}}return d}getSourceTile(n,d){const v=this.sourceCache._source;let w=n.overscaledZ-this.deltaZoom;if(w>v.maxzoom&&(w=v.maxzoom),w<v.minzoom)return null;this._sourceTileCache[n.key]||(this._sourceTileCache[n.key]=n.scaledTo(w).key);let C=this.sourceCache.getTileByID(this._sourceTileCache[n.key]);if((!C||!C.dem)&&d)for(;w>=v.minzoom&&(!C||!C.dem);)C=this.sourceCache.getTileByID(n.scaledTo(w--).key);return C}tilesAfterTime(n=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=n)}}class Dc{constructor(n,d,v){this.painter=n,this.sourceCache=new kc(d),this.options=v,this.exaggeration=typeof v.exaggeration=="number"?v.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(n,d,v,w=l.N){var C;if(!(d>=0&&d<w&&v>=0&&v<w))return 0;const B=this.getTerrainData(n),a=(C=B.tile)===null||C===void 0?void 0:C.dem;if(!a)return 0;const h=function(S,k,F){var U=k[0],H=k[1];return S[0]=F[0]*U+F[4]*H+F[12],S[1]=F[1]*U+F[5]*H+F[13],S}([],[d/w*l.N,v/w*l.N],B.u_terrain_matrix),A=[h[0]*a.dim,h[1]*a.dim],p=Math.floor(A[0]),y=Math.floor(A[1]),b=A[0]-p,T=A[1]-y;return a.get(p,y)*(1-b)*(1-T)+a.get(p+1,y)*b*(1-T)+a.get(p,y+1)*(1-b)*T+a.get(p+1,y+1)*b*T}getElevationForLngLatZoom(n,d){const{tileID:v,mercatorX:w,mercatorY:C}=this._getOverscaledTileIDFromLngLatZoom(n,d);return this.getElevation(v,w%l.N,C%l.N,l.N)}getElevation(n,d,v,w=l.N){return this.getDEMElevation(n,d,v,w)*this.exaggeration}getTerrainData(n){if(!this._emptyDemTexture){const w=this.painter.context,C=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new at(w,C,w.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new at(w,new l.R({width:1,height:1}),w.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(w.gl.NEAREST,w.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ao([])}const d=this.sourceCache.getSourceTile(n,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const w=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new at(w,d.dem.getPixels(),w.gl.RGBA,{premultiply:!1}),d.demTexture.bind(w.gl.NEAREST,w.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const v=d&&d+d.tileID.key+n.key;if(v&&!this._demMatrixCache[v]){const w=this.sourceCache.sourceCache._source.maxzoom;let C=n.canonical.z-d.tileID.canonical.z;n.overscaledZ>n.canonical.z&&(n.canonical.z>=w?C=n.canonical.z-w:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const B=n.canonical.x-(n.canonical.x>>C<<C),a=n.canonical.y-(n.canonical.y>>C<<C),h=l.bc(new Float64Array(16),[1/(l.N<<C),1/(l.N<<C),0]);l.$(h,h,[B*l.N,a*l.N,0]),this._demMatrixCache[n.key]={matrix:h,coord:n}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:v?this._demMatrixCache[n.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(n){const d=this.painter,v=d.width/devicePixelRatio,w=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===v&&this._fbo.height===w||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new at(d.context,{width:v,height:w,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new at(d.context,{width:v,height:w,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(v,w,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,v,w))),this._fbo.colorAttachment.set(n==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const n=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let C=0,B=0;C<this._coordsTextureSize;C++)for(let a=0;a<this._coordsTextureSize;a++,B+=4)d[B+0]=255&a,d[B+1]=255&C,d[B+2]=a>>8<<4|C>>8,d[B+3]=0;const v=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),w=new at(n,v,n.gl.RGBA,{premultiply:!1});return w.bind(n.gl.NEAREST,n.gl.CLAMP_TO_EDGE),this._coordsTexture=w,w}pointCoordinate(n){const d=new Uint8Array(4),v=this.painter.context,w=v.gl;v.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),w.readPixels(n.x,this.painter.height/devicePixelRatio-n.y-1,1,1,w.RGBA,w.UNSIGNED_BYTE,d),v.bindFramebuffer.set(null);const C=d[0]+(d[2]>>4<<8),B=d[1]+((15&d[2])<<8),a=this.coordsIndex[255-d[3]],h=a&&this.sourceCache.getTileByID(a);if(!h)return null;const A=this._coordsTextureSize,p=(1<<h.tileID.canonical.z)*A;return new l.U(this._allowMercatorOverflow(n,(h.tileID.canonical.x*A+C)/p),(h.tileID.canonical.y*A+B)/p,this.getElevation(h.tileID,C,B,A))}getTerrainMesh(){if(this._mesh)return this._mesh;const n=this.painter.context,d=new l.bd,v=new l.b0,w=this.meshSize,C=l.N/w,B=w*w;for(let y=0;y<=w;y++)for(let b=0;b<=w;b++)d.emplaceBack(b*C,y*C,0);for(let y=0;y<B;y+=w+1)for(let b=0;b<w;b++)v.emplaceBack(b+y,w+b+y+1,w+b+y+2),v.emplaceBack(b+y,w+b+y+2,b+y+1);const a=d.length,h=a+2*(w+1);for(const y of[0,1])for(let b=0;b<=w;b++)for(const T of[0,1])d.emplaceBack(b*C,y*l.N,T);for(let y=0;y<2*w;y+=2)v.emplaceBack(h+y,h+y+1,h+y+3),v.emplaceBack(h+y,h+y+3,h+y+2),v.emplaceBack(a+y,a+y+3,a+y+1),v.emplaceBack(a+y,a+y+2,a+y+3);const A=d.length,p=A+2*(w+1);for(const y of[0,1])for(let b=0;b<=w;b++)for(const T of[0,1])d.emplaceBack(y*l.N,b*C,T);for(let y=0;y<2*w;y+=2)v.emplaceBack(A+y,A+y+1,A+y+3),v.emplaceBack(A+y,A+y+3,A+y+2),v.emplaceBack(p+y,p+y+3,p+y+1),v.emplaceBack(p+y,p+y+2,p+y+3);return this._mesh={indexBuffer:n.createIndexBuffer(v),vertexBuffer:n.createVertexBuffer(d,Rc.members),segments:l.S.simpleSegment(0,0,d.length,v.length)},this._mesh}getMeshFrameDelta(n){return 2*Math.PI*l.be/Math.pow(2,n)/5}getMinTileElevationForLngLatZoom(n,d){var v;const{tileID:w}=this._getOverscaledTileIDFromLngLatZoom(n,d);return(v=this.getMinMaxElevation(w).minElevation)!==null&&v!==void 0?v:0}getMinMaxElevation(n){const d=this.getTerrainData(n).tile,v={minElevation:null,maxElevation:null};return d&&d.dem&&(v.minElevation=d.dem.min*this.exaggeration,v.maxElevation=d.dem.max*this.exaggeration),v}_getOverscaledTileIDFromLngLatZoom(n,d){const v=l.U.fromLngLat(n.wrap()),w=(1<<d)*l.N,C=v.x*w,B=v.y*w,a=Math.floor(C/l.N),h=Math.floor(B/l.N);return{tileID:new l.O(d,0,d,a,h),mercatorX:C,mercatorY:B}}_allowMercatorOverflow(n,d){const v=n.x<this.painter.width/2;let w=l.bf(d);const C=this.painter.transform.center.lng;return v&&Math.sign(w)>0&&Math.sign(C)<0||!v&&Math.sign(w)<0&&Math.sign(C)>0?(w=360*Math.sign(C)+w,l.G(w)):d}}class Bc{constructor(n,d,v){this._context=n,this._size=d,this._tileSize=v,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const n of this._objects)n.texture.destroy(),n.fbo.destroy()}_createObject(n){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),v=new at(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return v.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(v.texture),{id:n,fbo:d,texture:v,stamp:-1,inUse:!1}}getObjectForId(n){return this._objects[n]}useObject(n){n.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>n.id!==d),this._recentlyUsed.push(n.id)}stampObject(n){n.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const n=this._createObject(this._objects.length);return this._objects.push(n),n}freeObject(n){n.inUse=!1}freeAllObjects(){for(const n of this._objects)this.freeObject(n)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(n=>!n.inUse)===!1}}const Fr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class la{constructor(n,d){this.painter=n,this.terrain=d,this.pool=new Bc(n.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(n){return this.pool.getObjectForId(n.rtt[this._stacks.length-1].id).texture}prepareForRender(n,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=n._order.filter(v=>!n._layers[v].isHidden(d)),this._coordsDescendingInv={};for(const v in n.sourceCaches){this._coordsDescendingInv[v]={};const w=n.sourceCaches[v].getVisibleCoordinates();for(const C of w){const B=this.terrain.sourceCache.getTerrainCoords(C);for(const a in B)this._coordsDescendingInv[v][a]||(this._coordsDescendingInv[v][a]=[]),this._coordsDescendingInv[v][a].push(B[a])}}this._coordsDescendingInvStr={};for(const v of n._order){const w=n._layers[v],C=w.source;if(Fr[w.type]&&!this._coordsDescendingInvStr[C]){this._coordsDescendingInvStr[C]={};for(const B in this._coordsDescendingInv[C])this._coordsDescendingInvStr[C][B]=this._coordsDescendingInv[C][B].map(a=>a.key).sort().join()}}for(const v of this._renderableTiles)for(const w in this._coordsDescendingInvStr){const C=this._coordsDescendingInvStr[w][v.tileID.key];C&&C!==v.rttCoords[w]&&(v.rtt=[])}}renderLayer(n){if(n.isHidden(this.painter.transform.zoom))return!1;const d=n.type,v=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===n.id;if(Fr[d]&&(this._prevType&&Fr[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(n.id),!w))return!0;if(Fr[this._prevType]||Fr[d]&&w){this._prevType=d;const C=this._stacks.length-1,B=this._stacks[C]||[];for(const a of this._renderableTiles){if(this.pool.isFull()&&(Mi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(a),a.rtt[C]){const A=this.pool.getObjectForId(a.rtt[C].id);if(A.stamp===a.rtt[C].stamp){this.pool.useObject(A);continue}}const h=this.pool.getOrCreateFreeObject();this.pool.useObject(h),this.pool.stampObject(h),a.rtt[C]={id:h.id,stamp:h.stamp},v.context.bindFramebuffer.set(h.fbo.framebuffer),v.context.clear({color:l.aT.transparent,stencil:0}),v.currentStencilSource=void 0;for(let A=0;A<B.length;A++){const p=v.style._layers[B[A]],y=p.source?this._coordsDescendingInv[p.source][a.tileID.key]:[a.tileID];v.context.viewport.set([0,0,h.fbo.width,h.fbo.height]),v._renderTileClippingMasks(p,y),v.renderLayer(v,v.style.sourceCaches[p.source],p,y),p.source&&(a.rttCoords[p.source]=this._coordsDescendingInvStr[p.source][a.tileID.key])}}return Mi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Fr[d]}return!1}}const It=I,Ht={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},ca=E=>{E.touchstart=E.dragStart,E.touchmoveWindow=E.dragMove,E.touchend=E.dragEnd},Nl={showCompass:!0,showZoom:!0,visualizePitch:!1};class zl{constructor(n,d,v=!1){this.mousedown=B=>{this.startMouse(l.e({},B,{ctrlKey:!0,preventDefault:()=>B.preventDefault()}),R.mousePos(this.element,B)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=B=>{this.moveMouse(B,R.mousePos(this.element,B))},this.mouseup=B=>{this.mouseRotate.dragEnd(B),this.mousePitch&&this.mousePitch.dragEnd(B),this.offTemp()},this.touchstart=B=>{B.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,B.targetTouches)[0],this.startTouch(B,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=B=>{B.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,B.targetTouches)[0],this.moveTouch(B,this._lastPos))},this.touchend=B=>{B.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const w=n.dragRotate._mouseRotate.getClickTolerance(),C=n.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=Jn({clickTolerance:w,enable:!0}),this.touchRotate=(({enable:B,clickTolerance:a,bearingDegreesPerPixelMoved:h=.8})=>{const A=new Cc;return new mn({clickTolerance:a,move:(p,y)=>({bearingDelta:(y.x-p.x)*h}),moveStateManager:A,enable:B,assignEvents:ca})})({clickTolerance:w,enable:!0}),this.map=n,v&&(this.mousePitch=yn({clickTolerance:C,enable:!0}),this.touchPitch=(({enable:B,clickTolerance:a,pitchDegreesPerPixelMoved:h=-.5})=>{const A=new Cc;return new mn({clickTolerance:a,move:(p,y)=>({pitchDelta:(y.y-p.y)*h}),moveStateManager:A,enable:B,assignEvents:ca})})({clickTolerance:C,enable:!0})),R.addEventListener(d,"mousedown",this.mousedown),R.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(d,"touchcancel",this.reset)}startMouse(n,d){this.mouseRotate.dragStart(n,d),this.mousePitch&&this.mousePitch.dragStart(n,d),R.disableDrag()}startTouch(n,d){this.touchRotate.dragStart(n,d),this.touchPitch&&this.touchPitch.dragStart(n,d),R.disableDrag()}moveMouse(n,d){const v=this.map,{bearingDelta:w}=this.mouseRotate.dragMove(n,d)||{};if(w&&v.setBearing(v.getBearing()+w),this.mousePitch){const{pitchDelta:C}=this.mousePitch.dragMove(n,d)||{};C&&v.setPitch(v.getPitch()+C)}}moveTouch(n,d){const v=this.map,{bearingDelta:w}=this.touchRotate.dragMove(n,d)||{};if(w&&v.setBearing(v.getBearing()+w),this.touchPitch){const{pitchDelta:C}=this.touchPitch.dragMove(n,d)||{};C&&v.setPitch(v.getPitch()+C)}}off(){const n=this.element;R.removeEventListener(n,"mousedown",this.mousedown),R.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let rr;function nn(E,n,d){if(E=new l.L(E.lng,E.lat),n){const v=new l.L(E.lng-360,E.lat),w=new l.L(E.lng+360,E.lat),C=d.locationPoint(E).distSqr(n);d.locationPoint(v).distSqr(n)<C?E=v:d.locationPoint(w).distSqr(n)<C&&(E=w)}for(;Math.abs(E.lng-d.center.lng)>180;){const v=d.locationPoint(E);if(v.x>=0&&v.y>=0&&v.x<=d.width&&v.y<=d.height)break;E.lng>d.center.lng?E.lng-=360:E.lng+=360}return E}const sr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Kt(E,n,d){const v=E.classList;for(const w in sr)v.remove(`maplibregl-${d}-anchor-${w}`);v.add(`maplibregl-${d}-anchor-${n}`)}class Or extends l.E{constructor(n){if(super(),this._onKeyPress=d=>{const v=d.code,w=d.charCode||d.keyCode;v!=="Space"&&v!=="Enter"&&w!==32&&w!==13||this.togglePopup()},this._onMapClick=d=>{const v=d.originalEvent.target,w=this._element;this._popup&&(v===w||w.contains(v))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const v=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!v)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=nn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(w=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${sr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${C} ${w}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const B=this._map.unproject(this._pos),a=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=B.distanceTo(this._lngLat)>20*a?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=d=>{if(!this._isDragging){const v=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=v}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,n&&n.element)this._element=n.element,this._offset=l.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div"),this._element.setAttribute("aria-label","Map marker");const d=R.createNS("http://www.w3.org/2000/svg","svg"),v=41,w=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${v}px`),d.setAttributeNS(null,"width",`${w}px`),d.setAttributeNS(null,"viewBox",`0 0 ${w} ${v}`);const C=R.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");const B=R.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill-rule","nonzero");const a=R.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"transform","translate(3.0, 29.0)"),a.setAttributeNS(null,"fill","#000000");const h=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const U of h){const H=R.createNS("http://www.w3.org/2000/svg","ellipse");H.setAttributeNS(null,"opacity","0.04"),H.setAttributeNS(null,"cx","10.5"),H.setAttributeNS(null,"cy","5.80029008"),H.setAttributeNS(null,"rx",U.rx),H.setAttributeNS(null,"ry",U.ry),a.appendChild(H)}const A=R.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const p=R.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(p);const y=R.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"opacity","0.25"),y.setAttributeNS(null,"fill","#000000");const b=R.createNS("http://www.w3.org/2000/svg","path");b.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),y.appendChild(b);const T=R.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(6.0, 7.0)"),T.setAttributeNS(null,"fill","#FFFFFF");const S=R.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(8.0, 8.0)");const k=R.createNS("http://www.w3.org/2000/svg","circle");k.setAttributeNS(null,"fill","#000000"),k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"cx","5.5"),k.setAttributeNS(null,"cy","5.5"),k.setAttributeNS(null,"r","5.4999962");const F=R.createNS("http://www.w3.org/2000/svg","circle");F.setAttributeNS(null,"fill","#FFFFFF"),F.setAttributeNS(null,"cx","5.5"),F.setAttributeNS(null,"cy","5.5"),F.setAttributeNS(null,"r","5.4999962"),S.appendChild(k),S.appendChild(F),B.appendChild(a),B.appendChild(A),B.appendChild(y),B.appendChild(T),B.appendChild(S),d.appendChild(B),d.setAttributeNS(null,"height",v*this._scale+"px"),d.setAttributeNS(null,"width",w*this._scale+"px"),this._element.appendChild(d),this._offset=l.P.convert(n&&n.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),Kt(this._element,this._anchor,"marker"),n&&n.className)for(const d of n.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(n){return this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),n.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=l.L.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const w=Math.abs(13.5)/Math.SQRT2;n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?n.remove():n.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(n){return this._offset=l.P.convert(n),this._update(),this}addClassName(n){this._element.classList.add(n)}removeClassName(n){this._element.classList.remove(n)}toggleClassName(n){return this._element.classList.toggle(n)}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Nt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ci=0,eo=!1;const to={maxWidth:100,unit:"metric"};function $s(E,n,d){const v=d&&d.maxWidth||100,w=E._container.clientHeight/2,C=E.unproject([0,w]),B=E.unproject([v,w]),a=C.distanceTo(B);if(d&&d.unit==="imperial"){const h=3.2808*a;h>5280?io(n,v,h/5280,E._getUIString("ScaleControl.Miles")):io(n,v,h,E._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?io(n,v,a/1852,E._getUIString("ScaleControl.NauticalMiles")):a>=1e3?io(n,v,a/1e3,E._getUIString("ScaleControl.Kilometers")):io(n,v,a,E._getUIString("ScaleControl.Meters"))}function io(E,n,d,v){const w=function(C){const B=Math.pow(10,`${Math.floor(C)}`.length-1);let a=C/B;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(h){const A=Math.pow(10,Math.ceil(-Math.log(h)/Math.LN10));return Math.round(h*A)/A}(a),B*a}(d);E.style.width=n*(w/d)+"px",E.innerHTML=`${w}&nbsp;${v}`}const br={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ko=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ws(E){if(E){if(typeof E=="number"){const n=Math.round(Math.abs(E)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,E),"top-left":new l.P(n,n),"top-right":new l.P(-n,n),bottom:new l.P(0,-E),"bottom-left":new l.P(n,-n),"bottom-right":new l.P(-n,-n),left:new l.P(E,0),right:new l.P(-E,0)}}if(E instanceof l.P||Array.isArray(E)){const n=l.P.convert(E);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:l.P.convert(E.center||[0,0]),top:l.P.convert(E.top||[0,0]),"top-left":l.P.convert(E["top-left"]||[0,0]),"top-right":l.P.convert(E["top-right"]||[0,0]),bottom:l.P.convert(E.bottom||[0,0]),"bottom-left":l.P.convert(E["bottom-left"]||[0,0]),"bottom-right":l.P.convert(E["bottom-right"]||[0,0]),left:l.P.convert(E.left||[0,0]),right:l.P.convert(E.right||[0,0])}}return Ws(new l.P(0,0))}const $a={extend:(E,...n)=>l.e(E,...n),run(E){E()},logToElement(E,n=!1,d="log"){const v=window.document.getElementById(d);v&&(n&&(v.innerHTML=""),v.innerHTML+=`<br>${E}`)}},it=I;class Ge{static get version(){return it}static get workerCount(){return Zr.workerCount}static set workerCount(n){Zr.workerCount=n}static get maxParallelImageRequests(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(n){l.c.MAX_PARALLEL_IMAGE_REQUESTS=n}static get workerUrl(){return l.c.WORKER_URL}static set workerUrl(n){l.c.WORKER_URL=n}static addProtocol(n,d){l.c.REGISTERED_PROTOCOLS[n]=d}static removeProtocol(n){delete l.c.REGISTERED_PROTOCOLS[n]}}return Ge.Map=class extends ir{constructor(E){if(l.bg.mark(l.bh.create),(E=l.e({},Ht,E)).minZoom!=null&&E.maxZoom!=null&&E.minZoom>E.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(E.minPitch!=null&&E.maxPitch!=null&&E.minPitch>E.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(E.minPitch!=null&&E.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(E.maxPitch!=null&&E.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new La(E.minZoom,E.maxZoom,E.minPitch,E.maxPitch,E.renderWorldCopies),{bearingSnap:E.bearingSnap}),this._cooperativeGesturesOnWheel=n=>{this._onCooperativeGesture(n,n[this._metaKey],1)},this._contextLost=n=>{n.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=E.interactive,this._cooperativeGestures=E.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=E.maxTileCacheSize,this._maxTileCacheZoomLevels=E.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=E.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=E.preserveDrawingBuffer,this._antialias=E.antialias,this._trackResize=E.trackResize,this._bearingSnap=E.bearingSnap,this._refreshExpiredTiles=E.refreshExpiredTiles,this._fadeDuration=E.fadeDuration,this._crossSourceCollisions=E.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=E.collectResourceTiming,this._renderTaskQueue=new Fn,this._controls=[],this._mapId=l.a2(),this._locale=l.e({},Jr,E.locale),this._clickTolerance=E.clickTolerance,this._overridePixelRatio=E.pixelRatio,this._maxCanvasSize=E.maxCanvasSize,this.transformCameraUpdate=E.transformCameraUpdate,this._imageQueueHandle=Ee.addThrottleControl(()=>this.isMoving()),this._requestManager=new Le(E.transformRequest),typeof E.container=="string"){if(this._container=document.getElementById(E.container),!this._container)throw new Error(`Container '${E.container}' not found.`)}else{if(!(E.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=E.container}if(E.maxBounds&&this.setMaxBounds(E.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1;const d=pn(v=>{this._trackResize&&!this._removed&&this.resize(v)._update()},50);this._resizeObserver=new ResizeObserver(v=>{n?d(v):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ja(this,E),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=E.hash&&new sa(typeof E.hash=="string"&&E.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:E.center,zoom:E.zoom,bearing:E.bearing,pitch:E.pitch}),E.bounds&&(this.resize(),this.fitBounds(E.bounds,l.e({},E.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=E.localIdeographFontFamily,this._validateStyle=E.validateStyle,E.style&&this.setStyle(E.style,{localIdeographFontFamily:E.localIdeographFontFamily}),E.attributionControl&&this.addControl(new ls({customAttribution:E.customAttribution})),E.maplibreLogo&&this.addControl(new zi,E.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new l.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new l.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new l.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(E,n){if(n===void 0&&(n=E.getDefaultPosition?E.getDefaultPosition():"top-right"),!E||!E.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=E.onAdd(this);this._controls.push(E);const v=this._controlPositions[n];return n.indexOf("bottom")!==-1?v.insertBefore(d,v.firstChild):v.appendChild(d),this}removeControl(E){if(!E||!E.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(E);return n>-1&&this._controls.splice(n,1),E.onRemove(this),this}hasControl(E){return this._controls.indexOf(E)>-1}calculateCameraOptionsFromTo(E,n,d,v){return v==null&&this.terrain&&(v=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(E,n,d,v)}resize(E){var n;const d=this._containerDimensions(),v=d[0],w=d[1],C=this._getClampedPixelRatio(v,w);if(this._resizeCanvas(v,w,C),this.painter.resize(v,w,C),this.painter.overLimit()){const a=this.painter.context.gl;this._maxCanvasSize=[a.drawingBufferWidth,a.drawingBufferHeight];const h=this._getClampedPixelRatio(v,w);this._resizeCanvas(v,w,h),this.painter.resize(v,w,h)}this.transform.resize(v,w),(n=this._requestedCameraState)===null||n===void 0||n.resize(v,w);const B=!this._moving;return B&&(this.stop(),this.fire(new l.k("movestart",E)).fire(new l.k("move",E))),this.fire(new l.k("resize",E)),B&&this.fire(new l.k("moveend",E)),this}_getClampedPixelRatio(E,n){const{0:d,1:v}=this._maxCanvasSize,w=this.getPixelRatio(),C=E*w,B=n*w;return Math.min(C>d?d/C:1,B>v?v/B:1)*w}getPixelRatio(){var E;return(E=this._overridePixelRatio)!==null&&E!==void 0?E:devicePixelRatio}setPixelRatio(E){this._overridePixelRatio=E,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(E){return this.transform.setMaxBounds(Ei.convert(E)),this._update()}setMinZoom(E){if((E=E??-2)>=-2&&E<=this.transform.maxZoom)return this.transform.minZoom=E,this._update(),this.getZoom()<E&&this.setZoom(E),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(E){if((E=E??22)>=this.transform.minZoom)return this.transform.maxZoom=E,this._update(),this.getZoom()>E&&this.setZoom(E),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(E){if((E=E??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(E>=0&&E<=this.transform.maxPitch)return this.transform.minPitch=E,this._update(),this.getPitch()<E&&this.setPitch(E),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(E){if((E=E??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(E>=this.transform.minPitch)return this.transform.maxPitch=E,this._update(),this.getPitch()>E&&this.setPitch(E),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(E){return this.transform.renderWorldCopies=E,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(E){return this._cooperativeGestures=E,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(E){return this.transform.locationPoint(l.L.convert(E),this.style&&this.terrain)}unproject(E){return this.transform.pointLocation(l.P.convert(E),this.terrain)}isMoving(){var E;return this._moving||((E=this.handlers)===null||E===void 0?void 0:E.isMoving())}isZooming(){var E;return this._zooming||((E=this.handlers)===null||E===void 0?void 0:E.isZooming())}isRotating(){var E;return this._rotating||((E=this.handlers)===null||E===void 0?void 0:E.isRotating())}_createDelegatedListener(E,n,d){if(E==="mouseenter"||E==="mouseover"){let v=!1;return{layer:n,listener:d,delegates:{mousemove:C=>{const B=this.getLayer(n)?this.queryRenderedFeatures(C.point,{layers:[n]}):[];B.length?v||(v=!0,d.call(this,new os(E,this,C.originalEvent,{features:B}))):v=!1},mouseout:()=>{v=!1}}}}if(E==="mouseleave"||E==="mouseout"){let v=!1;return{layer:n,listener:d,delegates:{mousemove:B=>{(this.getLayer(n)?this.queryRenderedFeatures(B.point,{layers:[n]}):[]).length?v=!0:v&&(v=!1,d.call(this,new os(E,this,B.originalEvent)))},mouseout:B=>{v&&(v=!1,d.call(this,new os(E,this,B.originalEvent)))}}}}{const v=w=>{const C=this.getLayer(n)?this.queryRenderedFeatures(w.point,{layers:[n]}):[];C.length&&(w.features=C,d.call(this,w),delete w.features)};return{layer:n,listener:d,delegates:{[E]:v}}}}on(E,n,d){if(d===void 0)return super.on(E,n);const v=this._createDelegatedListener(E,n,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[E]=this._delegatedListeners[E]||[],this._delegatedListeners[E].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(E,n,d){if(d===void 0)return super.once(E,n);const v=this._createDelegatedListener(E,n,d);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(E,n,d){return d===void 0?super.off(E,n):(this._delegatedListeners&&this._delegatedListeners[E]&&(v=>{const w=this._delegatedListeners[E];for(let C=0;C<w.length;C++){const B=w[C];if(B.layer===n&&B.listener===d){for(const a in B.delegates)this.off(a,B.delegates[a]);return w.splice(C,1),this}}})(),this)}queryRenderedFeatures(E,n){if(!this.style)return[];let d;const v=E instanceof l.P||Array.isArray(E),w=v?E:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(v?{}:E)||{},w instanceof l.P||typeof w[0]=="number")d=[l.P.convert(w)];else{const C=l.P.convert(w[0]),B=l.P.convert(w[1]);d=[C,new l.P(B.x,C.y),B,new l.P(C.x,B.y),C]}return this.style.queryRenderedFeatures(d,n,this.transform)}querySourceFeatures(E,n){return this.style.querySourceFeatures(E,n)}setStyle(E,n){return(n=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&E?(this._diffStyle(E,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(E,n))}setTransformRequest(E){return this._requestManager.setTransformRequest(E),this}_getUIString(E){const n=this._locale[E];if(n==null)throw new Error(`Missing UI string '${E}'`);return n}_updateStyle(E,n){if(n.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(E,n));const d=this.style&&n.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!E)),E?(this.style=new Ti(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof E=="string"?this.style.loadURL(E,n,d):this.style.loadJSON(E,n,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ti(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(E,n){if(typeof E=="string"){const d=this._requestManager.transformRequest(E,Ce.Style);l.f(d,(v,w)=>{v?this.fire(new l.j(v)):w&&this._updateDiff(w,n)})}else typeof E=="object"&&this._updateDiff(E,n)}_updateDiff(E,n){try{this.style.setState(E,n)&&this._update(!0)}catch(d){l.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(E,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(E,n){return this._lazyInitEmptyStyle(),this.style.addSource(E,n),this._update(!0)}isSourceLoaded(E){const n=this.style&&this.style.sourceCaches[E];if(n!==void 0)return n.loaded();this.fire(new l.j(new Error(`There is no source with ID '${E}'`)))}setTerrain(E){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),E){const n=this.style.sourceCaches[E.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${E.source}`);for(const d in this.style._layers){const v=this.style._layers[d];v.type==="hillshade"&&v.source===E.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Dc(this.painter,n,E),this.painter.renderToTexture=new la(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==E.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:E})),this}getTerrain(){var E,n;return(n=(E=this.terrain)===null||E===void 0?void 0:E.options)!==null&&n!==void 0?n:null}areTilesLoaded(){const E=this.style&&this.style.sourceCaches;for(const n in E){const d=E[n]._tiles;for(const v in d){const w=d[v];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}addSourceType(E,n,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(E,n,d)}removeSource(E){return this.style.removeSource(E),this._update(!0)}getSource(E){return this.style.getSource(E)}addImage(E,n,d={}){const{pixelRatio:v=1,sdf:w=!1,stretchX:C,stretchY:B,content:a}=d;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||l.a(n))){if(n.width===void 0||n.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:h,height:A,data:p}=n,y=n;return this.style.addImage(E,{data:new l.R({width:h,height:A},new Uint8Array(p)),pixelRatio:v,stretchX:C,stretchY:B,content:a,sdf:w,version:0,userImage:y}),y.onAdd&&y.onAdd(this,E),this}}{const{width:h,height:A,data:p}=l.h.getImageData(n);this.style.addImage(E,{data:new l.R({width:h,height:A},p),pixelRatio:v,stretchX:C,stretchY:B,content:a,sdf:w,version:0})}}updateImage(E,n){const d=this.style.getImage(E);if(!d)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=n instanceof HTMLImageElement||l.a(n)?l.h.getImageData(n):n,{width:w,height:C,data:B}=v;if(w===void 0||C===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==d.data.width||C!==d.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const a=!(n instanceof HTMLImageElement||l.a(n));return d.data.replace(B,a),this.style.updateImage(E,d),this}getImage(E){return this.style.getImage(E)}hasImage(E){return E?!!this.style.getImage(E):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(E){this.style.removeImage(E)}loadImage(E,n){Ee.getImage(this._requestManager.transformRequest(E,Ce.Image),n)}listImages(){return this.style.listImages()}addLayer(E,n){return this._lazyInitEmptyStyle(),this.style.addLayer(E,n),this._update(!0)}moveLayer(E,n){return this.style.moveLayer(E,n),this._update(!0)}removeLayer(E){return this.style.removeLayer(E),this._update(!0)}getLayer(E){return this.style.getLayer(E)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(E,n,d){return this.style.setLayerZoomRange(E,n,d),this._update(!0)}setFilter(E,n,d={}){return this.style.setFilter(E,n,d),this._update(!0)}getFilter(E){return this.style.getFilter(E)}setPaintProperty(E,n,d,v={}){return this.style.setPaintProperty(E,n,d,v),this._update(!0)}getPaintProperty(E,n){return this.style.getPaintProperty(E,n)}setLayoutProperty(E,n,d,v={}){return this.style.setLayoutProperty(E,n,d,v),this._update(!0)}getLayoutProperty(E,n){return this.style.getLayoutProperty(E,n)}setGlyphs(E,n={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(E,n),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(E,n,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(E,n,d,v=>{v||this._update(!0)}),this}removeSprite(E){return this._lazyInitEmptyStyle(),this.style.removeSprite(E),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(E,n={}){return this._lazyInitEmptyStyle(),this.style.setSprite(E,n,d=>{d||this._update(!0)}),this}setLight(E,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(E,n),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(E,n){return this.style.setFeatureState(E,n),this._update()}removeFeatureState(E,n){return this.style.removeFeatureState(E,n),this._update()}getFeatureState(E){return this.style.getFeatureState(E)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let E=0,n=0;return this._container&&(E=this._container.clientWidth||400,n=this._container.clientHeight||300),[E,n]}_setupContainer(){const E=this._container;E.classList.add("maplibregl-map");const n=this._canvasContainer=R.create("div","maplibregl-canvas-container",E);this._interactive&&n.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),v=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],v);const w=this._controlContainer=R.create("div","maplibregl-control-container",E),C=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(B=>{C[B]=R.create("div",`maplibregl-ctrl-${B} `,w)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=R.create("div","maplibregl-cooperative-gesture-screen",this._container);let E=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(E=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${E}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){R.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(E,n,d){this._canvas.width=Math.floor(d*E),this._canvas.height=Math.floor(d*n),this._canvas.style.width=`${E}px`,this._canvas.style.height=`${n}px`}_setupPainter(){const E={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let n=null;this._canvas.addEventListener("webglcontextcreationerror",v=>{n={requestedAttributes:E},v&&(n.statusMessage=v.statusMessage,n.type=v.type)},{once:!0});const d=this._canvas.getContext("webgl2",E)||this._canvas.getContext("webgl",E);if(!d){const v="Failed to initialize WebGL";throw n?(n.message=v,new Error(JSON.stringify(n))):new Error(v)}this.painter=new Vs(d,this.transform),L.testSupport(d)}_onCooperativeGesture(E,n,d){return!n&&d<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(E){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||E,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(E){return this._update(),this._renderTaskQueue.add(E)}_cancelRenderFrame(E){this._renderTaskQueue.remove(E)}_render(E){const n=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(E),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const w=this.transform.zoom,C=l.h.now();this.style.zoomHistory.update(w,C);const B=new l.a8(w,{now:C,fadeDuration:n,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=B.crossFadingFactor();a===1&&a===this._crossFadingFactor||(d=!0,this._crossFadingFactor=a),this.style.update(B)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,n,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:n,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bg.mark(l.bh.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const v=this._sourcesDirty||this._styleDirty||this._placementDirty;return v||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||v||(this._fullyLoaded=!0,l.bg.mark(l.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var E;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ee.removeThrottleControl(this._imageQueueHandle),(E=this._resizeObserver)===null||E===void 0||E.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),l.bg.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.h.frame(E=>{l.bg.frame(E),this._frame=null,this._render(E)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(E){this._showTileBoundaries!==E&&(this._showTileBoundaries=E,this._update())}get showPadding(){return!!this._showPadding}set showPadding(E){this._showPadding!==E&&(this._showPadding=E,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(E){this._showCollisionBoxes!==E&&(this._showCollisionBoxes=E,E?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(E){this._showOverdrawInspector!==E&&(this._showOverdrawInspector=E,this._update())}get repaint(){return!!this._repaint}set repaint(E){this._repaint!==E&&(this._repaint=E,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(E){this._vertices=E,this._update()}get version(){return It}getCameraTargetElevation(){return this.transform.elevation}},Ge.NavigationControl=class{constructor(E){this._updateZoomButtons=()=>{const n=this._map.getZoom(),d=n===this._map.getMaxZoom(),v=n===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())},this._rotateCompassArrow=()=>{const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=n},this._setButtonTitle=(n,d)=>{const v=this._map._getUIString(`NavigationControl.${d}`);n.title=v,n.setAttribute("aria-label",v)},this.options=l.e({},Nl,E),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(E){return this._map=E,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(E,n){const d=R.create("button",E,this._container);return d.type="button",d.addEventListener("click",n),d}},Ge.GeolocateControl=class extends l.E{constructor(E){super(),this._onSuccess=n=>{if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(n),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(n),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",n)),this._finish()}},this._updateCamera=n=>{const d=new l.L(n.coords.longitude,n.coords.latitude),v=n.coords.accuracy,w=this._map.getBearing(),C=l.e({bearing:w},this.options.fitBoundsOptions),B=Ei.fromLngLat(d,v);this._map.fitBounds(B,C,{geolocateSource:!0})},this._updateMarker=n=>{if(n){const d=new l.L(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=n.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=n=>{if(this._map){if(this.options.trackUserLocation)if(n.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(n.code===3&&eo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",n)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=n=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",n===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Or({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Or({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},Nt,E)}onAdd(E){return this._map=E,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(n,d=!1){rr===void 0||d?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(v=>{rr=v.state!=="denied",n(rr)}).catch(()=>{rr=!!window.navigator.geolocation,n(rr)}):(rr=!!window.navigator.geolocation,n(rr)):n(rr)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ci=0,eo=!1}_isOutOfMapMaxBounds(E){const n=this._map.getMaxBounds(),d=E.coords;return n&&(d.longitude<n.getWest()||d.longitude>n.getEast()||d.latitude<n.getSouth()||d.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const E=this._map.getBounds(),n=E.getSouthEast(),d=E.getNorthEast(),v=n.distanceTo(d),w=Math.ceil(this._accuracy/(v/this._map._container.clientHeight)*2);this._circleElement.style.width=`${w}px`,this._circleElement.style.height=`${w}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ci--,eo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let E;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ci++,ci>1?(E={maximumAge:6e5,timeout:0},eo=!0):(E=this.options.positionOptions,eo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,E)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Ge.AttributionControl=ls,Ge.LogoControl=zi,Ge.ScaleControl=class{constructor(E){this._onMove=()=>{$s(this._map,this._container,this.options)},this.setUnit=n=>{this.options.unit=n,$s(this._map,this._container,this.options)},this.options=l.e({},to,E)}getDefaultPosition(){return"bottom-left"}onAdd(E){return this._map=E,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",E.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Ge.FullscreenControl=class extends l.E{constructor(E={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,E&&E.container&&(E.container instanceof HTMLElement?this._container=E.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(E){return this._map=E,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const E=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",E).setAttribute("aria-hidden","true"),E.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const E=this._getTitle();this._fullscreenButton.setAttribute("aria-label",E),this._fullscreenButton.title=E}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Ge.TerrainControl=class{constructor(E){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=E}onAdd(E){return this._map=E,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Ge.Popup=class extends l.E{constructor(E){super(),this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.k("close")),this),this._onMouseUp=n=>{this._update(n.point)},this._onMouseMove=n=>{this._update(n.point)},this._onDrag=n=>{this._update(n.point)},this._update=n=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const B of this.options.className.split(" "))this._container.classList.add(B);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=nn(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!n)return;const d=this._pos=this._trackPointer&&n?n:this._map.project(this._lngLat);let v=this.options.anchor;const w=Ws(this.options.offset);if(!v){const B=this._container.offsetWidth,a=this._container.offsetHeight;let h;h=d.y+w.bottom.y<a?["top"]:d.y>this._map.transform.height-a?["bottom"]:[],d.x<B/2?h.push("left"):d.x>this._map.transform.width-B/2&&h.push("right"),v=h.length===0?"bottom":h.join("-")}const C=d.add(w[v]).round();R.setTransform(this._container,`${sr[v]} translate(${C.x}px,${C.y}px)`),Kt(this._container,v,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(br),E)}addTo(E){return this._map&&this.remove(),this._map=E,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(E){return this._lngLat=l.L.convert(E),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(E){return this.setDOMContent(document.createTextNode(E))}setHTML(E){const n=document.createDocumentFragment(),d=document.createElement("body");let v;for(d.innerHTML=E;v=d.firstChild,v;)n.appendChild(v);return this.setDOMContent(n)}getMaxWidth(){var E;return(E=this._container)===null||E===void 0?void 0:E.style.maxWidth}setMaxWidth(E){return this.options.maxWidth=E,this._update(),this}setDOMContent(E){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(E),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(E){this._container&&this._container.classList.add(E)}removeClassName(E){this._container&&this._container.classList.remove(E)}setOffset(E){return this.options.offset=E,this._update(),this}toggleClassName(E){if(this._container)return this._container.classList.toggle(E)}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const E=this._container.querySelector(ko);E&&E.focus()}},Ge.Marker=Or,Ge.Style=Ti,Ge.LngLat=l.L,Ge.LngLatBounds=Ei,Ge.Point=l.P,Ge.MercatorCoordinate=l.U,Ge.Evented=l.E,Ge.AJAXError=l.bi,Ge.config=l.c,Ge.CanvasSource=Xr,Ge.GeoJSONSource=Dr,Ge.ImageSource=ki,Ge.RasterDEMTileSource=Qi,Ge.RasterTileSource=cn,Ge.VectorTileSource=ln,Ge.VideoSource=Js,Ge.setRTLTextPlugin=l.bj,Ge.getRTLTextPluginStatus=l.bk,Ge.prewarm=function(){Mn().acquire(oi)},Ge.clearPrewarmedResources=function(){const E=ys;E&&(E.isPreloaded()&&E.numActive()===1?(E.release(oi),ys=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},$a.extend(Ge,{isSafari:l.ac,getPerformanceMetrics:l.bg.getPerformanceMetrics}),Ge});var _=o;return _})})(I2);var XT=I2.exports;const ZT=Jf(XT);function uf(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Vp=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Lm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Lm&&parseFloat(Lm[1]);const wA=globalThis,qc=globalThis.process||{},YT=globalThis.navigator||{};function R2(t){var r,o;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((o=process.versions)!=null&&o.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,i=t||e;return!!(i&&i.indexOf("Electron")>=0)}function Al(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||R2()}function GT(t){return!t&&!Al()?"Node":R2(t)?"Electron":(t||YT.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const k2="4.0.7";function QT(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class KT{constructor(e,i,r="sessionStorage"){this.storage=QT(r),this.id=e,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function JT(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function e3(t,e=8){const i=Math.max(e-t.length,0);return`${" ".repeat(i)}${t}`}var Af;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Af||(Af={}));const t3=10;function Nm(t){return typeof t!="string"?t:(t=t.toUpperCase(),Af[t]||Af.WHITE)}function i3(t,e,i){return!Al&&typeof t=="string"&&(e&&(t=`\x1B[${Nm(e)}m${t}\x1B[39m`),i&&(t=`\x1B[${Nm(i)+t3}m${t}\x1B[49m`)),t}function r3(t,e=["constructor"]){const i=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(i),o=t;for(const u of r){const _=o[u];typeof _=="function"&&(e.find(l=>u===l)||(o[u]=_.bind(t)))}}function jp(t,e){if(!t)throw new Error(e||"Assertion failed")}function Xc(){var e,i,r;let t;if(Al()&&wA.performance)t=(i=(e=wA==null?void 0:wA.performance)==null?void 0:e.now)==null?void 0:i.call(e);else if("hrtime"in qc){const o=(r=qc==null?void 0:qc.hrtime)==null?void 0:r.call(qc);t=o[0]*1e3+o[1]/1e6}else t=Date.now();return t}const Zc={debug:Al()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},s3={enabled:!0,level:0};function Yc(){}const zm={},Um={once:!0};class Zu{constructor({id:e}={id:""}){this.VERSION=k2,this._startTs=Xc(),this._deltaTs=Xc(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new KT(`__probe-${this.id}__`,s3),this.timeStamp(`${this.id} started`),r3(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Xc()-this._startTs).toPrecision(10))}getDelta(){return Number((Xc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.setConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){if(!e)throw new Error(i||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Zc.warn,arguments,Um)}error(e){return this._getLogFunction(0,e,Zc.error,arguments)}deprecated(e,i){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(e,i){return this.error(`\`${e}\` has been removed. Use \`${i}\` instead`)}probe(e,i){return this._getLogFunction(e,i,Zc.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,Zc.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){return this._getLogFunction(e,i,Zc.debug||Zc.info,arguments,Um)}table(e,i,r){return i?this._getLogFunction(e,i,console.table||Yc,r&&[r],{tag:o3(i)}):Yc}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||Yc)}group(e,i,r={collapsed:!1}){const o=Vm({logLevel:e,message:i,opts:r}),{collapsed:u}=r;return o.method=(u?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,i,r={}){return this.group(e,i,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Yc)}withGroup(e,i,r){this.group(e,i)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=D2(e)}_getLogFunction(e,i,r,o,u){if(this._shouldLog(e)){u=Vm({logLevel:e,message:i,args:o,opts:u}),r=r||u.method,jp(r),u.total=this.getTotal(),u.delta=this.getDelta(),this._deltaTs=Xc();const _=u.tag||u.message;if(u.once&&_)if(!zm[_])zm[_]=Xc();else return Yc;return i=n3(this.id,u.message,u),r.bind(console,i,...u.args)}return Yc}}Zu.VERSION=k2;function D2(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return jp(Number.isFinite(e)&&e>=0),e}function Vm(t){const{logLevel:e,message:i}=t;t.logLevel=D2(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&r.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const o=typeof t.message;return jp(o==="string"||o==="object"),Object.assign(t,{args:r},t.opts)}function n3(t,e,i){if(typeof e=="string"){const r=i.time?e3(JT(i.total)):"";e=i.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=i3(e,i.color,i.background)}return e}function o3(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}const s0="4.3.1",a3=s0[0]>="0"&&s0[0]<="9"?`v${s0}`:"";function l3(){const t=new Zu({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=a3,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const c3=l3();function h3(t,e){return B2(t||{},e)}function B2(t,e,i=0){if(i>3)return e;const r={...t};for(const[o,u]of Object.entries(e))u&&typeof u=="object"&&!Array.isArray(u)?r[o]=B2(r[o]||{},e[o],i+1):r[o]=e[o];return r}const u3="latest";function A3(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const f3=A3();function hl(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Jl=typeof process!="object"||String(process)!=="[object process]"||process.browser,d3=typeof window<"u"&&typeof window.orientation<"u",jm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);jm&&parseFloat(jm[1]);class p3{constructor(e,i){ie(this,"name");ie(this,"workerThread");ie(this,"isRunning",!0);ie(this,"result");ie(this,"_resolve",()=>{});ie(this,"_reject",()=>{});this.name=e,this.workerThread=i,this.result=new Promise((r,o)=>{this._resolve=r,this._reject=o})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){hl(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){hl(this.isRunning),this.isRunning=!1,this._reject(e)}}class n0{terminate(){}}const o0=new Map;function g3(t){hl(t.source&&!t.url||!t.source&&t.url);let e=o0.get(t.source||t.url);return e||(t.url&&(e=_3(t.url),o0.set(t.url,e)),t.source&&(e=F2(t.source),o0.set(t.source,e))),hl(e),e}function _3(t){if(!t.startsWith("http"))return t;const e=m3(t);return F2(e)}function F2(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function m3(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function O2(t,e=!0,i){const r=i||new Set;if(t){if($m(t))r.add(t);else if($m(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const o in t)O2(t[o],e,r)}}return i===void 0?Array.from(r):[]}function $m(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const a0=()=>{};class $0{constructor(e){ie(this,"name");ie(this,"source");ie(this,"url");ie(this,"terminated",!1);ie(this,"worker");ie(this,"onMessage");ie(this,"onError");ie(this,"_loadableURL","");const{name:i,source:r,url:o}=e;hl(r||o),this.name=i,this.source=r,this.url=o,this.onMessage=a0,this.onError=u=>console.log(u),this.worker=Jl?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Jl||typeof n0<"u"&&!Jl}destroy(){this.onMessage=a0,this.onError=a0,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,i){i=i||O2(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,e.message&&(i+=`${e.message} in `),e.lineno&&(i+=`:${e.lineno}:${e.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=g3({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new n0(r,{eval:!1})}else if(this.source)e=new n0(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class y3{constructor(e){ie(this,"name","unnamed");ie(this,"source");ie(this,"url");ie(this,"maxConcurrency",1);ie(this,"maxMobileConcurrency",1);ie(this,"onDebug",()=>{});ie(this,"reuseWorkers",!0);ie(this,"props",{});ie(this,"jobQueue",[]);ie(this,"idleQueue",[]);ie(this,"count",0);ie(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return $0.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,i=(o,u,_)=>o.done(_),r=(o,u)=>o.error(u)){const o=new Promise(u=>(this.jobQueue.push({name:e,onMessage:i,onError:r,onStart:u}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const r=new p3(i.name,e);e.onMessage=o=>i.onMessage(r,o.type,o.payload),e.onError=o=>i.onError(r,o),i.onStart(r);try{await r.result}catch(o){console.error(`Worker exception: ${o}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Jl||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new $0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return d3?this.maxMobileConcurrency:this.maxConcurrency}}const b3={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},rl=class rl{constructor(e){ie(this,"props");ie(this,"workerPools",new Map);this.props={...b3},this.setProps(e),this.workerPools=new Map}static isSupported(){return $0.isSupported()}static getWorkerFarm(e={}){return rl._workerFarm=rl._workerFarm||new rl({}),rl._workerFarm.setProps(e),rl._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:r,url:o}=e;let u=this.workerPools.get(i);return u||(u=new y3({name:i,source:r,url:o}),u.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,u)),u}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};ie(rl,"_workerFarm");let ff=rl;function v3(t,e={}){const i=e[t.id]||{},r=Jl?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let o=i.workerUrl;if(!o&&t.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(Jl?o=`modules/${t.module}/dist/${r}`:o=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!o){let u=t.version;u==="latest"&&(u=u3);const _=u?`@${u}`:"";o=`https://unpkg.com/@loaders.gl/${t.module}${_}/dist/${r}`}return hl(o),o}function x3(t,e=f3){hl(t,"no worker provided");const i=t.version;return!(!e||!i)}function w3(t,e){return!ff.isSupported()||!Jl&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function T3(t,e,i,r,o){const u=t.id,_=v3(t,i),I=ff.getWorkerFarm(i).getWorkerPool({name:u,url:_});i=JSON.parse(JSON.stringify(i)),r=JSON.parse(JSON.stringify(r||{}));const R=await I.startJob("process-on-worker",E3.bind(null,o));return R.postMessage("process",{input:e,options:i,context:r}),await(await R.result).result}async function E3(t,e,i,r){switch(i){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:o,input:u,options:_}=r;try{const l=await t(u,_);e.postMessage("done",{id:o,result:l})}catch(l){const I=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:o,error:I})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function S3(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const r=new Uint8Array(t),o=new Uint8Array(e);for(let u=0;u<r.length;++u)if(r[u]!==o[u])return!1;return!0}function C3(...t){return P3(t)}function P3(t){const e=t.map(u=>u instanceof ArrayBuffer?new Uint8Array(u):u),i=e.reduce((u,_)=>u+_.byteLength,0),r=new Uint8Array(i);let o=0;for(const u of e)r.set(u,o),o+=u.byteLength;return r.buffer}async function I3(t){const e=[];for await(const i of t)e.push(i);return C3(...e)}function Wm(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Hm{constructor(e,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Wm(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Wm()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Yu{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,i="count"){return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const i of Object.values(this.stats))e(i)}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(i=>this._getOrCreate(i))}_getOrCreate(e){const{name:i,type:r}=e;let o=this.stats[i];return o||(e instanceof Hm?o=e:o=new Hm(i,r),this.stats[i]=o),o}}const M3="Queued Requests",R3="Active Requests",k3="Cancelled Requests",D3="Queued Requests Ever",B3="Active Requests Ever",F3={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class O3{constructor(e={}){ie(this,"props");ie(this,"stats");ie(this,"activeRequestCount",0);ie(this,"requestQueue",[]);ie(this,"requestMap",new Map);ie(this,"updateTimer",null);this.props={...F3,...e},this.stats=new Yu({id:this.props.id}),this.stats.get(M3),this.stats.get(R3),this.stats.get(k3),this.stats.get(D3),this.stats.get(B3)}scheduleRequest(e,i=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:i},o=new Promise(u=>(r.resolve=u,r));return this.requestQueue.push(r),this.requestMap.set(e,o),this._issueNewRequests(),o}_issueRequest(e){const{handle:i,resolve:r}=e;let o=!1;const u=()=>{o||(o=!0,this.requestMap.delete(i),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:u}):Promise.resolve({done:u})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let i=0;i<e;++i){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let i=0;i<e.length;++i){const r=e[i];this._updateRequest(r)||(e.splice(i,1),this.requestMap.delete(r.handle),i--)}e.sort((i,r)=>i.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let L3="";const qm={};function N3(t){for(const e in qm)if(t.startsWith(e)){const i=qm[e];t=t.replace(e,i)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${L3}${t}`),t}function z3(t){return t&&typeof t=="object"&&t.isBuffer}function L2(t){if(z3(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function N2(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function U3(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const V3=t=>typeof t=="boolean",xu=t=>typeof t=="function",Gu=t=>t!==null&&typeof t=="object",Xm=t=>Gu(t)&&t.constructor==={}.constructor,j3=t=>!!t&&typeof t[Symbol.iterator]=="function",$3=t=>t&&typeof t[Symbol.asyncIterator]=="function",lc=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,cc=t=>typeof Blob<"u"&&t instanceof Blob,W3=t=>t&&typeof t=="object"&&t.isBuffer,H3=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Gu(t)&&xu(t.tee)&&xu(t.cancel)&&xu(t.getReader),q3=t=>Gu(t)&&xu(t.read)&&xu(t.pipe)&&V3(t.readable),z2=t=>H3(t)||q3(t);class X3 extends Error{constructor(i,r){super(i);ie(this,"reason");ie(this,"url");ie(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const Z3=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Y3=/^([-\w.]+\/[-\w.+]+)/;function Zm(t,e){return t.toLowerCase()===e.toLowerCase()}function G3(t){const e=Y3.exec(t);return e?e[1]:t}function Ym(t){const e=Z3.exec(t);return e?e[1]:""}const U2=/\?.*/;function Q3(t){const e=t.match(U2);return e&&e[0]}function $p(t){return t.replace(U2,"")}function K3(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function ed(t){return lc(t)?t.url:cc(t)?t.name||"":typeof t=="string"?t:""}function Wp(t){if(lc(t)){const e=t,i=e.headers.get("content-type")||"",r=$p(e.url);return G3(i)||Ym(r)}return cc(t)?t.type||"":typeof t=="string"?Ym(t):""}function J3(t){return lc(t)?t.headers["content-length"]||-1:cc(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function V2(t){if(lc(t))return t;const e={},i=J3(t);i>=0&&(e["content-length"]=String(i));const r=ed(t),o=Wp(t);o&&(e["content-type"]=o);const u=await iE(t);u&&(e["x-first-bytes"]=u),typeof t=="string"&&(t=new TextEncoder().encode(t));const _=new Response(t,{headers:e});return Object.defineProperty(_,"url",{value:r}),_}async function eE(t){if(!t.ok)throw await tE(t)}async function tE(t){const e=K3(t.url);let i=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;i=i.length>100?`${i.slice(0,100)}...`:i;const r={reason:t.statusText,url:t.url,response:t};try{const o=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(o!=null&&o.includes("application/json"))?await t.json():await t.text()}catch{}return new X3(i,r)}async function iE(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const i=t.slice(0,5);return await new Promise(r=>{const o=new FileReader;o.onload=u=>{var _;return r((_=u==null?void 0:u.target)==null?void 0:_.result)},o.readAsDataURL(i)})}if(t instanceof ArrayBuffer){const i=t.slice(0,5);return`data:base64,${rE(i)}`}return null}function rE(t){let e="";const i=new Uint8Array(t);for(let r=0;r<i.byteLength;r++)e+=String.fromCharCode(i[r]);return btoa(e)}function sE(t){return!nE(t)&&!oE(t)}function nE(t){return t.startsWith("http:")||t.startsWith("https:")}function oE(t){return t.startsWith("data:")}async function Gm(t,e){var i,r;if(typeof t=="string"){const o=N3(t);return sE(o)&&(i=globalThis.loaders)!=null&&i.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(o,e):await fetch(o,e)}return await V2(t)}const Qm=new Zu({id:"loaders.gl"});class aE{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class lE{constructor(){ie(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const j2={fetch:null,mimeType:void 0,nothrow:!1,log:new lE,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Vp,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},cE={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function $2(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function W2(){const t=$2();return t.globalOptions=t.globalOptions||{...j2},t.globalOptions}function hE(t,e,i,r){return i=i||[],i=Array.isArray(i)?i:[i],uE(t,i),fE(e,t,r)}function uE(t,e){Km(t,null,j2,cE,e);for(const i of e){const r=t&&t[i.id]||{},o=i.options&&i.options[i.id]||{},u=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};Km(r,i.id,o,u,e)}}function Km(t,e,i,r,o){const u=e||"Top level",_=e?`${e}.`:"";for(const l in t){const I=!e&&Gu(t[l]),R=l==="baseUri"&&!e,L=l==="workerUrl"&&e;if(!(l in i)&&!R&&!L){if(l in r)Qm.warn(`${u} loader option '${_}${l}' no longer supported, use '${r[l]}'`)();else if(!I){const z=AE(l,o);Qm.warn(`${u} loader option '${_}${l}' not recognized. ${z}`)()}}}}function AE(t,e){const i=t.toLowerCase();let r="";for(const o of e)for(const u in o.options){if(t===u)return`Did you mean '${o.id}.${u}'?`;const _=u.toLowerCase();(i.startsWith(_)||_.startsWith(i))&&(r=r||`Did you mean '${o.id}.${u}'?`)}return r}function fE(t,e,i){const o={...t.options||{}};return dE(o,i),o.log===null&&(o.log=new aE),Jm(o,W2()),Jm(o,e),o}function Jm(t,e){for(const i in e)if(i in e){const r=e[i];Xm(r)&&Xm(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function dE(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Hp(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function qp(t){uf(t,"null loader"),uf(Hp(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const H2=()=>{const t=$2();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function q2(t){const e=H2();t=Array.isArray(t)?t:[t];for(const i of t){const r=qp(i);e.find(o=>r===o)||e.unshift(r)}}function pE(){return H2()}const gE=/\.([^.]+)$/;async function _E(t,e=[],i,r){if(!X2(t))return null;let o=ey(t,e,{...i,nothrow:!0},r);if(o)return o;if(cc(t)&&(t=await t.slice(0,10).arrayBuffer(),o=ey(t,e,i,r)),!o&&!(i!=null&&i.nothrow))throw new Error(Z2(t));return o}function ey(t,e=[],i,r){if(!X2(t))return null;if(e&&!Array.isArray(e))return qp(e);let o=[];e&&(o=o.concat(e)),i!=null&&i.ignoreRegisteredLoaders||o.push(...pE()),yE(o);const u=mE(t,o,i,r);if(!u&&!(i!=null&&i.nothrow))throw new Error(Z2(t));return u}function mE(t,e,i,r){const o=ed(t),u=Wp(t),_=$p(o)||(r==null?void 0:r.url);let l=null,I="";return i!=null&&i.mimeType&&(l=l0(e,i==null?void 0:i.mimeType),I=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),l=l||bE(e,_),I=I||(l?`matched url ${_}`:""),l=l||l0(e,u),I=I||(l?`matched MIME type ${u}`:""),l=l||xE(e,t),I=I||(l?`matched initial data ${Y2(t)}`:""),i!=null&&i.fallbackMimeType&&(l=l||l0(e,i==null?void 0:i.fallbackMimeType),I=I||(l?`matched fallback MIME type ${u}`:"")),I&&c3.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${I}.`),l}function X2(t){return!(t instanceof Response&&t.status===204)}function Z2(t){const e=ed(t),i=Wp(t);let r="No valid loader found (";r+=e?`${N2(e)}, `:"no url provided, ",r+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const o=t?Y2(t):"";return r+=o?` first bytes: "${o}"`:"first bytes: not available",r+=")",r}function yE(t){for(const e of t)qp(e)}function bE(t,e){const i=e&&gE.exec(e),r=i&&i[1];return r?vE(t,r):null}function vE(t,e){e=e.toLowerCase();for(const i of t)for(const r of i.extensions)if(r.toLowerCase()===e)return i;return null}function l0(t,e){var i;for(const r of t)if((i=r.mimeTypes)!=null&&i.some(o=>Zm(e,o))||Zm(e,`application/x.${r.id}`))return r;return null}function xE(t,e){if(!e)return null;for(const i of t)if(typeof e=="string"){if(wE(e,i))return i}else if(ArrayBuffer.isView(e)){if(ty(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&ty(e,0,i))return i;return null}function wE(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function ty(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(o=>TE(t,e,i,o))}function TE(t,e,i,r){if(r instanceof ArrayBuffer)return S3(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const o=W0(t,e,r.length);return r===o;default:return!1}}function Y2(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?W0(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?W0(t,0,e):""}function W0(t,e,i){if(t.byteLength<e+i)return"";const r=new DataView(t);let o="";for(let u=0;u<i;u++)o+=String.fromCharCode(r.getUint8(e+u));return o}const EE=256*1024;function*SE(t,e){const i=(e==null?void 0:e.chunkSize)||EE;let r=0;const o=new TextEncoder;for(;r<t.length;){const u=Math.min(t.length-r,i),_=t.slice(r,r+u);r+=u,yield o.encode(_)}}const CE=256*1024;function*PE(t,e={}){const{chunkSize:i=CE}=e;let r=0;for(;r<t.byteLength;){const o=Math.min(t.byteLength-r,i),u=new ArrayBuffer(o),_=new Uint8Array(t,r,o);new Uint8Array(u).set(_),r+=o,yield u}}const IE=1024*1024;async function*ME(t,e){const i=(e==null?void 0:e.chunkSize)||IE;let r=0;for(;r<t.size;){const o=r+i,u=await t.slice(r,o).arrayBuffer();r=o,yield u}}function iy(t,e){return Vp?RE(t,e):kE(t)}async function*RE(t,e){const i=t.getReader();let r;try{for(;;){const o=r||i.read();e!=null&&e._streamReadAhead&&(r=i.read());const{done:u,value:_}=await o;if(u)return;yield L2(_)}}catch{i.releaseLock()}}async function*kE(t,e){for await(const i of t)yield L2(i)}function DE(t,e){if(typeof t=="string")return SE(t,e);if(t instanceof ArrayBuffer)return PE(t,e);if(cc(t))return ME(t,e);if(z2(t))return iy(t,e);if(lc(t))return iy(t.body,e);throw new Error("makeIterator")}const G2="Cannot convert supplied data type";function BE(t,e,i){if(e.text&&typeof t=="string")return t;if(W3(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const o=t.byteLength||t.length;return(t.byteOffset!==0||o!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+o)),r}throw new Error(G2)}async function FE(t,e,i){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return BE(t,e);if(cc(t)&&(t=await V2(t)),lc(t)){const o=t;return await eE(o),e.binary?await o.arrayBuffer():await o.text()}if(z2(t)&&(t=DE(t,i)),j3(t)||$3(t))return I3(t);throw new Error(G2)}function Q2(t,e){const i=W2(),r=t||i;return typeof r.fetch=="function"?r.fetch:Gu(r.fetch)?o=>Gm(o,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Gm}function OE(t,e,i){if(i)return i;const r={fetch:Q2(e,t),...t};if(r.url){const o=$p(r.url);r.baseUrl=o,r.queryString=Q3(r.url),r.filename=N2(o),r.baseUrl=U3(o)}return Array.isArray(r.loaders)||(r.loaders=null),r}function LE(t,e){if(t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...r]:r}return i&&i.length?i:void 0}async function df(t,e,i,r){e&&!Array.isArray(e)&&!Hp(e)&&(r=void 0,i=e,e=void 0),t=await t,i=i||{};const o=ed(t),_=LE(e,r),l=await _E(t,_,i);return l?(i=hE(i,l,_,o),r=OE({url:o,_parse:df,loaders:_},i,r||null),await NE(l,t,i,r)):null}async function NE(t,e,i,r){if(x3(t),i=h3(t.options,i),lc(e)){const u=e,{ok:_,redirected:l,status:I,statusText:R,type:L,url:z}=u,V=Object.fromEntries(u.headers.entries());r.response={headers:V,ok:_,redirected:l,status:I,statusText:R,type:L,url:z}}e=await FE(e,t,i);const o=t;if(o.parseTextSync&&typeof e=="string")return o.parseTextSync(e,i,r);if(w3(t,i))return await T3(t,e,i,r,df);if(o.parseText&&typeof e=="string")return await o.parseText(e,i,r);if(o.parse)return await o.parse(e,i,r);throw hl(!o.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function pf(t,e,i,r){let o,u;!Array.isArray(e)&&!Hp(e)?(o=[],u=e):(o=e,u=i);const _=Q2(u);let l=t;return typeof t=="string"&&(l=await _(t)),cc(t)&&(l=await _(t)),Array.isArray(o)?await df(l,o,u):await df(l,o,u)}const zE="4.3.1";var P2;const UE=(P2=globalThis.loaders)==null?void 0:P2.parseImageNode,H0=typeof Image<"u",q0=typeof ImageBitmap<"u",VE=!!UE,X0=Vp?!0:VE;function jE(t){switch(t){case"auto":return q0||H0||X0;case"imagebitmap":return q0;case"image":return H0;case"data":return X0;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function $E(){if(q0)return"imagebitmap";if(H0)return"image";if(X0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function WE(t){const e=qE(t);if(!e)throw new Error("Not an image");return e}function HE(t){switch(WE(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function qE(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const XE=/^data:image\/svg\+xml/,ZE=/\.svg((\?|#).*)?$/;function Xp(t){return t&&(XE.test(t)||ZE.test(t))}function YE(t,e){if(Xp(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(u){throw new Error(u.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return K2(t,e)}function K2(t,e){if(Xp(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function J2(t,e,i){const r=YE(t,i),o=self.URL||self.webkitURL,u=typeof r!="string"&&o.createObjectURL(r);try{return await GE(u||r,e)}finally{u&&o.revokeObjectURL(u)}}async function GE(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((r,o)=>{try{i.onload=()=>r(i),i.onerror=u=>{const _=u instanceof Error?u.message:"error";o(new Error(_))}}catch(u){o(u)}})}const QE={};let ry=!0;async function KE(t,e,i){let r;Xp(i)?r=await J2(t,e,i):r=K2(t,i);const o=e&&e.imagebitmap;return await JE(r,o)}async function JE(t,e=null){if((eS(e)||!ry)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),ry=!1}return await createImageBitmap(t)}function eS(t){for(const e in t||QE)return!1;return!0}function tS(t){return!nS(t,"ftyp",4)||!(t[8]&96)?null:iS(t)}function iS(t){switch(rS(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function rS(t,e,i){return String.fromCharCode(...t.slice(e,i))}function sS(t){return[...t].map(e=>e.charCodeAt(0))}function nS(t,e,i=0){const r=sS(e);for(let o=0;o<r.length;++o)if(r[o]!==t[o+i])return!1;return!0}const jo=!1,wu=!0;function eb(t){const e=Qu(t);return aS(e)||hS(e)||lS(e)||cS(e)||oS(e)}function oS(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),i=tS(e);return i?{mimeType:i.mimeType,width:0,height:0}:null}function aS(t){const e=Qu(t);return e.byteLength>=24&&e.getUint32(0,jo)===2303741511?{mimeType:"image/png",width:e.getUint32(16,jo),height:e.getUint32(20,jo)}:null}function lS(t){const e=Qu(t);return e.byteLength>=10&&e.getUint32(0,jo)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,wu),height:e.getUint16(8,wu)}:null}function cS(t){const e=Qu(t);return e.byteLength>=14&&e.getUint16(0,jo)===16973&&e.getUint32(2,wu)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,wu),height:e.getUint32(22,wu)}:null}function hS(t){const e=Qu(t);if(!(e.byteLength>=3&&e.getUint16(0,jo)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:o}=uS();let u=2;for(;u+9<e.byteLength;){const _=e.getUint16(u,jo);if(o.has(_))return{mimeType:"image/jpeg",height:e.getUint16(u+5,jo),width:e.getUint16(u+7,jo)};if(!r.has(_))return null;u+=2,u+=e.getUint16(u,jo)}return null}function uS(){const t=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)t.add(i);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Qu(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function AS(t,e){var o;const{mimeType:i}=eb(t)||{},r=(o=globalThis.loaders)==null?void 0:o.parseImageNode;return uf(r),await r(t,i)}async function fS(t,e,i){e=e||{};const o=(e.image||{}).type||"auto",{url:u}=i||{},_=dS(o);let l;switch(_){case"imagebitmap":l=await KE(t,e,u);break;case"image":l=await J2(t,e,u);break;case"data":l=await AS(t);break;default:uf(!1)}return o==="data"&&(l=HE(l)),l}function dS(t){switch(t){case"auto":case"data":return $E();default:return jE(t),t}}const pS=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],gS=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],_S={image:{type:"auto",decode:!0}},mS={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:zE,mimeTypes:gS,extensions:pS,parse:fS,tests:[t=>!!eb(new DataView(t))],options:_S},yS=new Zu({id:"deck"}),mi=yS;let Z0={};function bS(t){Z0=t}function Fs(t,e,i,r){mi.level>0&&Z0[t]&&Z0[t].call(null,e,i,r)}function vS(t){const e=t[0],i=t[t.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const xS={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:vS,parseTextSync:JSON.parse};function wS(){const t="9.0.36",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(mi.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:mi,_registerLoggers:bS},q2([xS,[mS,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const tb=wS();function Gl(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const c0={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function TS(t){const e={};for(const[i,r]of Object.entries(t))e[i]=SS(r);return e}function ES(t,e,i){const r={};for(const[o,u]of Object.entries(e))t&&o in t&&!u.private?(u.validate&&Gl(u.validate(t[o],u),`${i}: invalid ${o}`),r[o]=t[o]):r[o]=u.value;return r}function SS(t){let e=sy(t);if(e!=="object")return{value:t,...c0[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...c0[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=sy(t.value),{...t,...c0[e],type:e}):{type:"object",value:null};throw new Error("props")}function sy(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const CS=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,PS=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,IS={vertex:CS,fragment:PS},ny=/void\s+main\s*\([^)]*\)\s*\{\n?/,oy=/}\n?[^{}]*$/,h0=[],ef="__LUMA_INJECT_DECLARATIONS__";function MS(t){const e={vertex:{},fragment:{}};for(const i in t){let r=t[i];const o=RS(i);typeof r=="string"&&(r={order:0,injection:r}),e[o][i]=r}return e}function RS(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function gf(t,e,i,r=!1){const o=e==="vertex";for(const u in i){const _=i[u];_.sort((I,R)=>I.order-R.order),h0.length=_.length;for(let I=0,R=_.length;I<R;++I)h0[I]=_[I].injection;const l=`${h0.join(`
`)}
`;switch(u){case"vs:#decl":o&&(t=t.replace(ef,l));break;case"vs:#main-start":o&&(t=t.replace(ny,I=>I+l));break;case"vs:#main-end":o&&(t=t.replace(oy,I=>l+I));break;case"fs:#decl":o||(t=t.replace(ef,l));break;case"fs:#main-start":o||(t=t.replace(ny,I=>I+l));break;case"fs:#main-end":o||(t=t.replace(oy,I=>l+I));break;default:t=t.replace(u,I=>I+l)}}return t=t.replace(ef,""),r&&(t=t.replace(/\}\s*$/,u=>u+IS[e])),t}let kS=1;class Ql{constructor(e){ie(this,"name");ie(this,"vs");ie(this,"fs");ie(this,"getModuleUniforms");ie(this,"dependencies");ie(this,"deprecations");ie(this,"defines");ie(this,"injections");ie(this,"uniforms",{});ie(this,"uniformTypes",{});const{name:i,vs:r,fs:o,dependencies:u=[],uniformTypes:_={},uniformPropTypes:l={},getUniforms:I,deprecations:R=[],defines:L={},inject:z={}}=e;Gl(typeof i=="string"),this.name=i,this.vs=r,this.fs=o,this.getModuleUniforms=I,this.dependencies=Ql.instantiateModules(u),this.deprecations=this._parseDeprecationDefinitions(R),this.defines=L,this.injections=MS(z),this.uniformTypes=_,l&&(this.uniforms=TS(l))}static instantiateModules(e){return e.map(i=>{if(i instanceof Ql)return i;Gl(typeof i!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(i)}' and use it directly.`),i.name||(console.warn("shader module has no name"),i.name=`shader-module-${kS++}`);const r=new Ql(i);return r.dependencies=Ql.instantiateModules(i.dependencies||[]),r})}getModuleSource(e){let i;switch(e){case"vertex":i=this.vs||"";break;case"fragment":i=this.fs||"";break;default:Gl(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${i}

`}getUniforms(e,i){return this.getModuleUniforms?this.getModuleUniforms(e,i):ES(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,i){this.deprecations.forEach(r=>{var o;(o=r.regex)!=null&&o.test(e)&&(r.deprecated?i.deprecated(r.old,r.new)():i.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(i=>{switch(i.type){case"function":i.regex=new RegExp(`\\b${i.old}\\(`);break;default:i.regex=new RegExp(`${i.type} ${i.old};`)}}),e}_defaultGetUniforms(e={}){const i={},r=this.uniforms;for(const o in r){const u=r[o];o in e&&!u.private?(u.validate&&Gl(u.validate(e[o],u),`${this.name}: invalid ${o}`),i[o]=e[o]):i[o]=u.value}return i}}function ay(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=ly(t.platformInfo,t.vs);let i;return t.fs&&(i=ly(t.platformInfo,t.fs)),{...t,vs:e,fs:i}}function ly(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function td(t){const e=Ql.instantiateModules(t);return DS(e)}function DS(t){const e={},i={};return ib({modules:t,level:0,moduleMap:e,moduleDepth:i}),Object.keys(i).sort((r,o)=>i[o]-i[r]).map(r=>e[r])}function ib(t){const{modules:e,level:i,moduleMap:r,moduleDepth:o}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const u of e)r[u.name]=u,(o[u.name]===void 0||o[u.name]<i)&&(o[u.name]=i);for(const u of e)u.dependencies&&ib({modules:u.dependencies,level:i+1,moduleMap:r,moduleDepth:o})}function BS(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function FS(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=cy(t,OS),t;case"fragment":return t=cy(t,LS),t;default:throw new Error(e)}}const rb=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],OS=[...rb,[Y0("attribute"),"in $1"],[Y0("varying"),"out $1"]],LS=[...rb,[Y0("varying"),"in $1"]];function cy(t,e){for(const[i,r]of e)t=t.replace(i,r);return t}function Y0(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function sb(t,e){let i="";for(const r in t){const o=t[r];if(i+=`void ${o.signature} {
`,o.header&&(i+=`  ${o.header}`),e[r]){const u=e[r];u.sort((_,l)=>_.order-l.order);for(const _ of u)i+=`  ${_.injection}
`}o.footer&&(i+=`  ${o.footer}`),i+=`}
`}return i}function nb(t){const e={vertex:{},fragment:{}};for(const i of t){let r,o;typeof i!="string"?(r=i,o=r.hook):(r={},o=i),o=o.trim();const[u,_]=o.split(":"),l=o.replace(/\(.+/,""),I=Object.assign(r,{signature:_});switch(u){case"vs":e.vertex[l]=I;break;case"fs":e.fragment[l]=I;break;default:throw new Error(u)}}return e}function NS(t,e){return{name:zS(t,e),language:"glsl",version:US(t)}}function zS(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function US(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const r=parseInt(i[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const ob=`

${ef}
`,VS=`precision highp float;
`;function jS(t){const e=td(t.modules||[]);return{source:G0(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:Zp(e)}}function $S(t){const e=td(t.modules||[]);return{vs:G0(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:G0(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:Zp(e)}}function WS(t){const{vs:e,fs:i}=t,r=td(t.modules||[]);return{vs:hy(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:hy(t.platformInfo,{...t,source:i,stage:"fragment",modules:r}),getUniforms:Zp(r)}}function G0(t,e){const{source:i,stage:r,modules:o,hookFunctions:u=[],inject:_={},log:l}=e;Gl(typeof i=="string","shader source must be a string");const I=i;let R="";const L=nb(u),z={},V={},q={};for(const Ae in _){const Ee=typeof _[Ae]=="string"?{injection:_[Ae],order:0}:_[Ae],Ce=/^(v|f)s:(#)?([\w-]+)$/.exec(Ae);if(Ce){const Le=Ce[2],Oe=Ce[3];Le?Oe==="decl"?V[Ae]=[Ee]:q[Ae]=[Ee]:z[Ae]=[Ee]}else q[Ae]=[Ee]}const ne=t.type!=="webgpu"?o:[];for(const Ae of ne){l&&Ae.checkDeprecations(I,l);const Ee=Ae.getModuleSource(r,"wgsl");R+=Ee;const Ce=Ae.injections[r];for(const Le in Ce){const Oe=/^(v|f)s:#([\w-]+)$/.exec(Le);if(Oe){const Qe=Oe[2]==="decl"?V:q;Qe[Le]=Qe[Le]||[],Qe[Le].push(Ce[Le])}else z[Le]=z[Le]||[],z[Le].push(Ce[Le])}}return R+=ob,R=gf(R,r,V),R+=sb(L[r],z),R+=I,R=gf(R,r,q),R}function hy(t,e){const{id:i,source:r,stage:o,language:u="glsl",modules:_,defines:l={},hookFunctions:I=[],inject:R={},prologue:L=!0,log:z}=e;Gl(typeof r=="string","shader source must be a string");const V=u==="glsl"?NS(r).version:-1,q=t.shaderLanguageVersion,ne=V===100?"#version 100":"#version 300 es",Ee=r.split(`
`).slice(1).join(`
`),Ce={};_.forEach(xt=>{Object.assign(Ce,xt.getDefines())}),Object.assign(Ce,l);let Le="";switch(u){case"wgsl":break;case"glsl":Le=L?`${ne}

// ----- PROLOGUE -------------------------
${HS({id:i,source:r,stage:o})}
${`#define SHADER_TYPE_${o.toUpperCase()}`}
${BS(t)}
${o==="fragment"?VS:""}

// ----- APPLICATION DEFINES -------------------------

${qS(Ce)}

`:`${ne}
`;break}const Oe=nb(I),Ne={},Qe={},Je={};for(const xt in R){const wt=typeof R[xt]=="string"?{injection:R[xt],order:0}:R[xt],ct=/^(v|f)s:(#)?([\w-]+)$/.exec(xt);if(ct){const at=ct[2],Vt=ct[3];at?Vt==="decl"?Qe[xt]=[wt]:Je[xt]=[wt]:Ne[xt]=[wt]}else Je[xt]=[wt]}for(const xt of _){z&&xt.checkDeprecations(Ee,z);const wt=xt.getModuleSource(o);Le+=wt;const ct=xt.injections[o];for(const at in ct){const Vt=/^(v|f)s:#([\w-]+)$/.exec(at);if(Vt){const $t=Vt[2]==="decl"?Qe:Je;$t[at]=$t[at]||[],$t[at].push(ct[at])}else Ne[at]=Ne[at]||[],Ne[at].push(ct[at])}}return Le+="// ----- MAIN SHADER SOURCE -------------------------",Le+=ob,Le=gf(Le,o,Qe),Le+=sb(Oe[o],Ne),Le+=Ee,Le=gf(Le,o,Je),u==="glsl"&&V!==q&&(Le=FS(Le,o)),Le.trim()}function Zp(t){return function(i){const r={};for(const o of t){const u=o.getUniforms(i,r);Object.assign(r,u)}return r}}function HS(t){const{id:e,source:i,stage:r}=t;return e&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function qS(t={}){let e="";for(const i in t){const r=t[i];(r||Number.isFinite(r))&&(e+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e}const Zl=class Zl{constructor(){ie(this,"_hookFunctions",[]);ie(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Zl.defaultShaderAssembler=Zl.defaultShaderAssembler||new Zl,Zl.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(i=>i.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==i)}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const i=this._getModuleList(e.modules),r=this._hookFunctions,o=ay(e);return{...jS({platformInfo:e.platformInfo,...o,modules:i,hookFunctions:r}),modules:i}}assembleShaderPair(e){const i=ay(e),r=this._getModuleList(e.modules),o=this._hookFunctions,{platformInfo:u}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?$S({platformInfo:u,...i,modules:r,hookFunctions:o}):WS({platformInfo:u,...i,modules:r,hookFunctions:o}),modules:r}}_getModuleList(e=[]){const i=new Array(this._defaultModules.length+e.length),r={};let o=0;for(let u=0,_=this._defaultModules.length;u<_;++u){const l=this._defaultModules[u],I=l.name;i[o++]=l,r[I]=!0}for(let u=0,_=e.length;u<_;++u){const l=e[u],I=l.name;r[I]||(i[o++]=l,r[I]=!0)}return i.length=o,Ql.instantiateModules(i)}};ie(Zl,"defaultShaderAssembler");let _f=Zl;const XS=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,ZS=`#version 300 es
${XS}`;function YS(t){const{input:e,inputChannels:i,output:r}=t||{};if(!e)return ZS;if(!i)throw new Error("inputChannels");const o=GS(i),u=QS(e,i);return`#version 300 es
in ${o} ${e};
out vec4 ${r};
void main() {
  ${r} = ${u};
}`}function GS(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function QS(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const ht=new Zu({id:"luma.gl"});class KS{constructor(){ie(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Yu({id:e})),this.stats.get(e)}}const Yp=new KS;function JS(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(Al()&&ht.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:ht,stats:Yp}),t}const eC=JS();function tC(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function Du(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:tC(t)}const u0={};function hc(t="id"){u0[t]=u0[t]||1;const e=u0[t]++;return`${t}-${e}`}function mf(t){let e=!0;for(const i in t){e=!1;break}return e}var j0;let Xi=(j0=class{constructor(e,i,r){ie(this,"id");ie(this,"props");ie(this,"userData",{});ie(this,"_device");ie(this,"destroyed",!1);ie(this,"allocatedBytes",0);ie(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=iC(i,r);const o=this.props.id!=="undefined"?this.props.id:hc(this[Symbol.toStringTag]);this.props.id=o,this.id=o,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get(`${i}s Active`).decrementCount()}trackAllocatedMemory(e,i=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${i} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").subtractCount(this.allocatedBytes),i.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${i}s Created`).incrementCount(),e.get(`${i}s Active`).incrementCount()}},ie(j0,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),j0);function iC(t,e){const i={...e};for(const r in t)t[r]!==void 0&&(i[r]=t[r]);return i}const ds=class ds extends Xi{constructor(i,r){const o={...r};(r.usage||0)&ds.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?o.indexType="uint32":r.data instanceof Uint16Array&&(o.indexType="uint16"));super(i,o,ds.defaultProps);ie(this,"usage");ie(this,"indexType");ie(this,"updateTimestamp");ie(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=o.indexType,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(i,r){throw new Error("not implemented")}_setDebugData(i,r,o){const u=ArrayBuffer.isView(i)?i.buffer:i,_=Math.min(i?i.byteLength:o,ds.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(_):r===0&&o===i.byteLength?this.debugData=u.slice(0,_):this.debugData=u.slice(r,r+_)}};ie(ds,"defaultProps",{...Xi.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),ie(ds,"MAP_READ",1),ie(ds,"MAP_WRITE",2),ie(ds,"COPY_SRC",4),ie(ds,"COPY_DST",8),ie(ds,"INDEX",16),ie(ds,"VERTEX",32),ie(ds,"UNIFORM",64),ie(ds,"STORAGE",128),ie(ds,"INDIRECT",256),ie(ds,"QUERY_RESOLVE",512),ie(ds,"DEBUG_DATA_MAX_LENGTH",32);let lr=ds;function ab(t){const e=uy[t],i=rC(e),r=t.includes("norm"),o=!r&&!t.startsWith("float"),u=t.startsWith("s");return{dataType:uy[t],byteLength:i,integer:o,signed:u,normalized:r}}function rC(t){return sC[t]}const uy={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},sC={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},nC=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],oC=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function aC(t){return nC.some(e=>t.startsWith(e))}function lb(t){const e=oC.exec(t);if(e){const[,i,r,o,u,_]=e;if(i){const l=`${o}${r}`,I=ab(l);return{format:i,components:i.length,srgb:u==="-srgb",unsized:_==="-unsized",webgl:_==="-webgl",...I}}}return cC(t)}const lC={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function cC(t){var i;const e=lC[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((i=e.format)==null?void 0:i.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class hC{}class uC{constructor(e=[],i){ie(this,"features");ie(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const Ru=class Ru{constructor(e){ie(this,"id");ie(this,"props");ie(this,"userData",{});ie(this,"statsManager",Yp);ie(this,"_lumaData",{});ie(this,"timestamp",0);this.props={...Ru.defaultProps,...e},this.id=this.props.id||hc(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return aC(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,i){throw new Error("not implemented")}readPixelsToBufferWebGL(e,i){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,i){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const i={...e};return(e.usage||0)&lr.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?i.indexType="uint32":e.data instanceof Uint16Array?i.indexType="uint16":ht.warn("indices buffer content must be of integer type")()),i}};ie(Ru,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!ht.get("debug"),spector:!!(ht.get("spector")||ht.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>ht.error(e.message)}),ie(Ru,"VERSION",eC);let vh=Ru;function er(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const ou=new Map,dh=class dh{static registerDevices(e){for(const i of e)er(i.type&&i.isSupported&&i.create),ou.set(i.type,i)}static getAvailableDevices(){return Array.from(ou).map(e=>e.type)}static getSupportedDevices(){return Array.from(ou).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(vh.defaultProps,e)}static async attachDevice(e){const i=Ay(e.devices)||ou;if(e.handle instanceof WebGL2RenderingContext){const r=i.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=i.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var u,_;e={...dh.defaultProps,...e},e.gl&&(e.type="webgl");const i=Ay(e.devices)||ou;let r,o;switch(e.type){case"webgpu":if(r=i.get("webgpu"),r)return await r.create(e);break;case"webgl":if(o=i.get("webgl"),o)return await o.create(e);break;case"unknown":const l=i.get("unknown");if(l)return await l.create(e);break;case"best-available":if(r=i.get("webgpu"),(u=r==null?void 0:r.isSupported)!=null&&u.call(r))return await r.create(e);if(o=i.get("webgl"),(_=o==null?void 0:o.isSupported)!=null&&_.call(o))return await o.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const i=HTMLCanvasElement.prototype;if(!e&&i.originalGetContext){i.getContext=i.originalGetContext,i.originalGetContext=void 0;return}i.originalGetContext=i.getContext,i.getContext=function(r,o){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",o):this.originalGetContext(r,o)}}};ie(dh,"defaultProps",{...vh.defaultProps,type:"best-available",devices:void 0}),ie(dh,"stats",Yp),ie(dh,"log",ht);let ph=dh;function Ay(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const i of t)e.set(i.type,i);return e}const AC=Al()&&typeof document<"u",id=()=>AC&&document.readyState==="complete",fC={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class Gp{constructor(e){ie(this,"id");ie(this,"props");ie(this,"canvas");ie(this,"htmlCanvas");ie(this,"offscreenCanvas");ie(this,"type");ie(this,"width",1);ie(this,"height",1);ie(this,"resizeObserver");ie(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...fC,...e},e=this.props,!Al()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=gC(e.canvas):this.canvas=e.canvas;else{const i=_C(e),r=pC((e==null?void 0:e.container)||null);r.insertBefore(i,r.firstChild),this.canvas=i,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const r of i)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return id()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*e,i.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,i]=this.getPixelSize();return e/i}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:i}=this._canvasSizeInfo;return i?e/i:1}catch{return 1}}cssToDevicePixels(e,i=!0){const r=this.cssToDeviceRatio(),[o,u]=this.getDrawingBufferSize();return mC(e,r,o,u,i)}setDevicePixelRatio(e,i={}){if(!this.htmlCanvas)return;let r="width"in i?i.width:this.htmlCanvas.clientWidth,o="height"in i?i.height:this.htmlCanvas.clientHeight;(!r||!o)&&(ht.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,o=this.htmlCanvas.height||1);const u=this._canvasSizeInfo;if(u.clientWidth!==r||u.clientHeight!==o||u.devicePixelRatio!==e){let _=e;const l=Math.floor(r*_),I=Math.floor(o*_);this.htmlCanvas.width=l,this.htmlCanvas.height=I;const[R,L]=this.getDrawingBufferSize();(R!==l||L!==I)&&(_=Math.min(R/r,L/o),this.htmlCanvas.width=Math.floor(r*_),this.htmlCanvas.height=Math.floor(o*_),ht.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=o,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}ie(Gp,"pageLoaded",dC());function dC(){return id()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function pC(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!id())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function gC(t){const e=document.getElementById(t);if(!e&&!id())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function _C(t){const{width:e,height:i}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=i||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(i)?`${i}px`:"100%",r}function mC(t,e,i,r,o){const u=t,_=fy(u[0],e,i);let l=dy(u[1],e,r,o),I=fy(u[0]+1,e,i);const R=I===i-1?I:I-1;I=dy(u[1]+1,e,r,o);let L;return o?(I=I===0?I:I+1,L=l,l=I):L=I===r-1?I:I-1,{x:_,y:l,width:Math.max(R-_+1,1),height:Math.max(L-l+1,1)}}function fy(t,e,i){return Math.min(Math.round(t*e),i-1)}function dy(t,e,i,r){return r?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const ba=class ba extends Xi{constructor(i,r,o=ba.defaultProps){super(i,r,o);ie(this,"dimension");ie(this,"format");ie(this,"width");ie(this,"height");ie(this,"depth");ie(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};ie(ba,"defaultProps",{...Xi.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),ie(ba,"COPY_SRC",1),ie(ba,"COPY_DST",2),ie(ba,"TEXTURE_BINDING",4),ie(ba,"STORAGE_BINDING",8),ie(ba,"RENDER_ATTACHMENT",16);let $n=ba;const Nf=class Nf extends Xi{get[Symbol.toStringTag](){return"TextureView"}constructor(e,i){super(e,i,Nf.defaultProps)}};ie(Nf,"defaultProps",{...Xi.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let yf=Nf;function yC(t,e,i){let r="";const o=e.split(/\r?\n/),u=t.slice().sort((_,l)=>_.lineNum-l.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let _=0;for(let l=1;l<=o.length;l++)for(r+=cb(o[l-1],l,i);u.length>_&&u[_].lineNum===l;){const I=u[_++];r+=py(I,o,I.lineNum,{...i,inlineSource:!1})}return r;case"issues":case"no":for(const l of t)r+=py(l,o,l.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return r}}function py(t,e,i,r){if(r!=null&&r.inlineSource){const o=bC(e,i),u=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${o}${u}${t.type.toUpperCase()}: ${t.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function bC(t,e,i){let r="";for(let o=e-2;o<=e;o++){const u=t[o-1];u!==void 0&&(r+=cb(u,e,i))}return r}function cb(t,e,i){const r=i!=null&&i.html?xC(t):t;return`${vC(String(e),4)}: ${r}${i!=null&&i.html?"<br/>":`
`}`}function vC(t,e){let i="";for(let r=t.length;r<e;++r)i+=" ";return i+t}function xC(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function hb(t,e){return{name:wC(t,e),language:"glsl",version:TC(t)}}function wC(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function TC(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const r=parseInt(i[1],10);Number.isFinite(r)&&(e=r)}return e}const zf=class zf extends Xi{constructor(i,r){super(i,{id:EC(r),...r},zf.defaultProps);ie(this,"stage");ie(this,"source");ie(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(i=this.props.debug){switch(i){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(i){var R;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=hb(this.source).name,o=`${this.stage} ${r}`;let u=yC(i,this.source,{showSourceCode:"all",html:!0});const _=this.getTranslatedSource();_&&(u+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${_}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${o}</h1><br /><br />
<code style="user-select:text;"><pre>
${u}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l);const I=document.getElementsByClassName("luma-compiler-log-error");(R=I[0])!=null&&R.scrollIntoView&&I[0].scrollIntoView(),l.onclick=()=>{const L=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(L)}}};ie(zf,"defaultProps",{...Xi.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let bf=zf;function EC(t){return hb(t.source).name||t.id||hc(`unnamed ${t.stage}-shader`)}const Uf=class Uf extends Xi{get[Symbol.toStringTag](){return"Sampler"}constructor(e,i){super(e,i,Uf.defaultProps)}};ie(Uf,"defaultProps",{...Xi.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let vf=Uf;const Vf=class Vf extends Xi{constructor(i,r={}){super(i,r,Vf.defaultProps);ie(this,"width");ie(this,"height");ie(this,"colorAttachments",[]);ie(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(i){let r=!i;if(i){const[o,u]=Array.isArray(i)?i:[i.width,i.height];r=r||u!==this.height||o!==this.width,this.width=o,this.height=u}r&&(ht.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const o=this.createColorTexture(r);return this.attachResource(o),o.view}return r instanceof $n?r.view:r});const i=this.props.depthStencilAttachment;if(i)if(typeof i=="string"){const r=this.createDepthStencilTexture(i);this.attachResource(r),this.depthStencilAttachment=r.view}else i instanceof $n?this.depthStencilAttachment=i.view:this.depthStencilAttachment=i}createColorTexture(i){return this.device.createTexture({id:"color-attachment",usage:$n.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}createDepthStencilTexture(i){return this.device.createTexture({id:"depth-stencil-attachment",usage:$n.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}resizeAttachments(i,r){for(let o=0;o<this.colorAttachments.length;++o)if(this.colorAttachments[o]){const u=this.device._createTexture({...this.colorAttachments[o].props,width:i,height:r});this.destroyAttachedResource(this.colorAttachments[o]),this.colorAttachments[o]=u.view,this.attachResource(u.view)}if(this.depthStencilAttachment){const o=this.device._createTexture({...this.depthStencilAttachment.props,width:i,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=o.view,this.attachResource(o)}}};ie(Vf,"defaultProps",{...Xi.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let xf=Vf;const jf=class jf extends Xi{constructor(i,r){super(i,r,jf.defaultProps);ie(this,"shaderLayout");ie(this,"bufferLayout");ie(this,"linkStatus","pending");ie(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(i){throw new Error("Use uniform blocks")}};ie(jf,"defaultProps",{...Xi.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let xh=jf;const $f=class $f extends Xi{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,i){super(e,i,$f.defaultProps)}};ie($f,"defaultProps",{...Xi.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Q0=$f;const Wf=class Wf extends Xi{constructor(i,r){super(i,r,Wf.defaultProps);ie(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};ie(Wf,"defaultProps",{...Xi.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let wf=Wf;const Hf=class Hf extends Xi{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,i){super(e,i,Hf.defaultProps)}};ie(Hf,"defaultProps",{...Xi.defaultProps,measureExecutionTime:void 0});let K0=Hf;const qf=class qf extends Xi{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,i){super(e,i,qf.defaultProps)}};ie(qf,"defaultProps",{...Xi.defaultProps});let J0=qf;function SC(t){const[e,i]=PC[t],r=e==="i32"||e==="u32",o=e!=="u32",u=IC[e]*i,_=CC(e,i);return{dataType:e,components:i,defaultVertexFormat:_,byteLength:u,integer:r,signed:o}}function CC(t,e){let i;switch(t){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?i:`${i}x${e}`}const PC={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},IC={f32:4,f16:2,i32:4,u32:4};function ub(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[i,r]=t.split("x"),o=i,u=r?parseInt(r):1,_=ab(o),l={type:o,components:u,byteLength:_.byteLength*u,integer:_.integer,signed:_.signed,normalized:_.normalized};return e&&(l.webglOnly=!0),l}function Ab(t,e){const i={};for(const r of t.attributes)i[r.name]=RC(t,e,r.name);return i}function MC(t,e,i=16){const r=Ab(t,e),o=new Array(i).fill(null);for(const u of Object.values(r))o[u.location]=u;return o}function RC(t,e,i){const r=kC(t,i),o=DC(e,i);if(!r)return null;const u=SC(r.type),_=(o==null?void 0:o.vertexFormat)||u.defaultVertexFormat,l=ub(_);return{attributeName:(o==null?void 0:o.attributeName)||r.name,bufferName:(o==null?void 0:o.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:u.dataType,shaderComponents:u.components,vertexFormat:_,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:u.integer,stepMode:(o==null?void 0:o.stepMode)||r.stepMode,byteOffset:(o==null?void 0:o.byteOffset)||0,byteStride:(o==null?void 0:o.byteStride)||0}}function kC(t,e){const i=t.attributes.find(r=>r.name===e);return i||ht.warn(`shader layout attribute "${e}" not present in shader`),i||null}function DC(t,e){BC(t);let i=FC(t,e);return i||(i=OC(t,e),i)?i:(ht.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function BC(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&ht.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function FC(t,e){for(const i of t)if(i.format&&i.name===e)return{attributeName:i.name,bufferName:e,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function OC(t,e){var i;for(const r of t){let o=r.byteStride;if(typeof r.byteStride!="number")for(const _ of r.attributes||[]){const l=ub(_.format);o+=l.byteLength}const u=(i=r.attributes)==null?void 0:i.find(_=>_.attribute===e);if(u)return{attributeName:u.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:u.format,byteOffset:u.byteOffset,byteStride:o}}return null}function LC(t,e){const i={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const o=i.attributes.find(u=>u.name===r.name);o?(o.type=r.type||o.type,o.stepMode=r.stepMode||o.stepMode):ht.warn(`shader layout attribute ${r.name} not present in shader`)}return i}const Xf=class Xf extends Xi{constructor(i,r){super(i,r,Xf.defaultProps);ie(this,"maxVertexAttributes");ie(this,"attributeInfos");ie(this,"indexBuffer",null);ie(this,"attributes");this.maxVertexAttributes=i.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=MC(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(i,r){throw new Error("constant attributes not supported")}};ie(Xf,"defaultProps",{...Xi.defaultProps,renderPipeline:null});let ep=Xf;const Zf=class Zf extends Xi{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,i){super(e,i,Zf.defaultProps)}};ie(Zf,"defaultProps",{...Xi.defaultProps,layout:void 0,buffers:{}});let tp=Zf;const Yf=class Yf extends Xi{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,i){super(e,i,Yf.defaultProps)}};ie(Yf,"defaultProps",{...Xi.defaultProps,type:void 0,count:void 0});let ip=Yf;const NC={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function zC(t){const e=NC[t];return er(t),e}function UC(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let TA;function fb(t){return(!TA||TA.byteLength<t)&&(TA=new ArrayBuffer(t)),TA}function VC(t,e){const i=fb(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}function jC(t){const{target:e,source:i,start:r=0,count:o=1}=t,u=i.length,_=o*u;let l=0;for(let I=r;l<u;l++)e[I++]=i[l];for(;l<_;)l<_-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+_-l),l=_);return t.target}const gy=1024;class $C{constructor(e){ie(this,"layout",{});ie(this,"byteLength");let i=0;for(const[o,u]of Object.entries(e)){const _=zC(u),{type:l,components:I}=_;i=UC(i,I);const R=i;i+=I,this.layout[o]={type:l,size:I,offset:R}}i+=(4-i%4)%4;const r=i*4;this.byteLength=Math.max(r,gy)}getData(e){const i=Math.max(this.byteLength,gy),r=fb(i),o={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[u,_]of Object.entries(e)){const l=this.layout[u];if(!l){ht.warn(`Supplied uniform value ${u} not present in uniform block layout`)();continue}const{type:I,size:R,offset:L}=l,z=o[I];if(R===1){if(typeof _!="number"&&typeof _!="boolean"){ht.warn(`Supplied value for single component uniform ${u} is not a number: ${_}`)();continue}z[L]=Number(_)}else{const V=Du(_);if(!V){ht.warn(`Supplied value for multi component / array uniform ${u} is not a numeric array: ${_}`)();continue}z.set(V,L)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function WC(t,e,i=16){if(t!==e)return!1;const r=Du(t);if(!r)return!1;const o=Du(e);if(o&&r.length===o.length){for(let u=0;u<r.length;++u)if(o[u]!==r[u])return!1}return!0}function HC(t){const e=Du(t);return e?e.slice():t}class qC{constructor(e){ie(this,"name");ie(this,"uniforms",{});ie(this,"modifiedUniforms",{});ie(this,"modified",!0);ie(this,"bindingLayout",{});ie(this,"needsRedraw","initialized");var i;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(i=e==null?void 0:e.shaderLayout.bindings)==null?void 0:i.find(u=>u.type==="uniform"&&u.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const o=r;for(const u of o.uniforms||[])this.bindingLayout[u.name]=u}}setUniforms(e){for(const[i,r]of Object.entries(e))this._setUniform(i,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,i){WC(this.uniforms[e],i)||(this.uniforms[e]=HC(i),this.modifiedUniforms[e]=!0,this.modified=!0)}}class XC{constructor(e){ie(this,"uniformBlocks",new Map);ie(this,"uniformBufferLayouts",new Map);ie(this,"uniformBuffers",new Map);for(const[i,r]of Object.entries(e)){const o=i,u=new $C(r.uniformTypes||{});this.uniformBufferLayouts.set(o,u);const _=new qC({name:i});_.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(o,_)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[i,r]of Object.entries(e))this.uniformBlocks.get(i).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const i=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(i)}createUniformBuffer(e,i,r){r&&this.setUniforms(r);const o=this.getUniformBufferByteLength(i),u=e.createBuffer({usage:lr.UNIFORM|lr.COPY_DST,byteLength:o}),_=this.getUniformBufferData(i);return u.write(_),u}getManagedUniformBuffer(e,i){if(!this.uniformBuffers.get(i)){const r=this.getUniformBufferByteLength(i),o=e.createBuffer({usage:lr.UNIFORM|lr.COPY_DST,byteLength:r});this.uniformBuffers.set(i,o)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let e=!1;for(const i of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(i);e||(e=r)}return e&&ht.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const i=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let o=!1;if(r&&i.needsRedraw){o||(o=i.needsRedraw);const u=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(u);const l=this.uniformBlocks.get(e).getAllUniforms();ht.log(4,`Writing to uniform buffer ${String(e)}`,u,l)()}return o}}function db(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function pb(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function ZC(t,e,i){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let o=db(t);if(o==="uint8"&&i&&r===1)return"unorm8-webgl";if(o==="uint8"&&i&&r===3)return"unorm8x3-webgl";if(o==="uint8"||o==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return i&&(o=o.replace("int","norm")),`${o}x${r}`}if(o==="uint16"||o==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return i&&(o=o.replace("int","norm")),`${o}x${r}`}return r===1?o:`${o}x${r}`}function YC(t){return Du(t)!==null||typeof t=="number"||typeof t=="boolean"}function Qp(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const r=t[i];YC(r)?e.uniforms[i]=r:e.bindings[i]=r}),e}function GC(t,e,i){const{removedProps:r={},deprecatedProps:o={},replacedProps:u={}}=i;for(const l in r)if(l in e){const R=r[l]?`${t}.${r[l]}`:"N/A";ht.removed(`${t}.${l}`,R)()}for(const l in o)if(l in e){const I=o[l];ht.deprecated(`${t}.${l}`,`${t}.${I}`)()}let _=null;for(const[l,I]of Object.entries(u))l in e&&(ht.deprecated(`${t}.${l}`,`${t}.${I}`)(),_=_||Object.assign({},e),_[I]=e[l],delete _[l]);return _||e}let QC="";async function KC(t,e){return await new Promise((i,r)=>{try{const o=new Image;o.onload=()=>i(o),o.onerror=()=>r(new Error(`Could not load image ${t}.`)),o.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",o.src=t.startsWith("http")?t:QC+t}catch(o){r(o)}})}async function gb(t,e){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),e&&(r.id=e),new Promise((o,u)=>{r.onload=o,r.onerror=_=>u(new Error(`Unable to load script '${t}': ${_}`)),i.appendChild(r)})}function rp(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!rp(t[r],e[r],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(const u of r)if(!e.hasOwnProperty(u)||!rp(t[u],e[u],i-1))return!1;return!0}return!1}function JC(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function eP(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class tP{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}let Pa=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,i){if(e){i(Tf.instance);for(const r of e)r instanceof Array?this.searchBlock(r,i):r.search(i);i(Ef.instance)}}};class Tf extends Pa{}Tf.instance=new Tf;class Ef extends Pa{}Ef.instance=new Ef;class cr extends Pa{constructor(){super()}}class sp extends cr{constructor(e,i,r,o,u,_){super(),this.calls=new Set,this.name=e,this.args=i,this.returnType=r,this.body=o,this.startLine=u,this.endLine=_}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class iP extends cr{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class rP extends cr{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class sP extends cr{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class nP extends cr{constructor(e,i,r,o){super(),this.init=e,this.condition=i,this.increment=r,this.body=o}get astNodeType(){return"for"}search(e){var i,r,o;(i=this.init)===null||i===void 0||i.search(e),(r=this.condition)===null||r===void 0||r.search(e),(o=this.increment)===null||o===void 0||o.search(e),this.searchBlock(this.body,e)}}class Xl extends cr{constructor(e,i,r,o,u){super(),this.name=e,this.type=i,this.storage=r,this.access=o,this.value=u}get astNodeType(){return"var"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class _b extends cr{constructor(e,i,r){super(),this.name=e,this.type=i,this.value=r}get astNodeType(){return"override"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class np extends cr{constructor(e,i,r,o,u){super(),this.name=e,this.type=i,this.storage=r,this.access=o,this.value=u}get astNodeType(){return"let"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class _y extends cr{constructor(e,i,r,o,u){super(),this.name=e,this.type=i,this.storage=r,this.access=o,this.value=u}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}var wh;(function(t){t.increment="++",t.decrement="--"})(wh||(wh={}));(function(t){function e(i){const r=i;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e})(wh||(wh={}));class oP extends cr{constructor(e,i){super(),this.operator=e,this.variable=i}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var Bu;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Bu||(Bu={}));(function(t){function e(i){const r=i;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e})(Bu||(Bu={}));class aP extends cr{constructor(e,i,r){super(),this.operator=e,this.variable=i,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class mb extends cr{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"call"}search(e){for(const i of this.args)i.search(e);e(this)}}class lP extends cr{constructor(e,i){super(),this.body=e,this.continuing=i}get astNodeType(){return"loop"}}class cP extends cr{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"body"}}class hP extends cr{constructor(e,i,r,o){super(),this.condition=e,this.body=i,this.elseif=r,this.else=o}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class uP extends cr{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class AP extends cr{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class fP extends cr{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class dP extends cr{constructor(e,i){super(),this.severity=e,this.rule=i}get astNodeType(){return"diagnostic"}}class yb extends cr{constructor(e,i){super(),this.name=e,this.type=i}get astNodeType(){return"alias"}}class pP extends cr{constructor(){super()}get astNodeType(){return"discard"}}class gP extends cr{constructor(){super()}get astNodeType(){return"break"}}class _P extends cr{constructor(){super()}get astNodeType(){return"continue"}}class uc extends cr{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class ql extends uc{constructor(e,i,r,o){super(e),this.members=i,this.startLine=r,this.endLine=o}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let i=0;i<this.members.length;i++)if(this.members[i].name==e)return i;return-1}}class bb extends uc{constructor(e,i,r){super(e),this.format=i,this.access=r}get astNodeType(){return"template"}}class mP extends uc{constructor(e,i,r,o){super(e),this.storage=i,this.type=r,this.access=o}get astNodeType(){return"pointer"}}class vb extends uc{constructor(e,i,r,o){super(e),this.attributes=i,this.format=r,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class _u extends uc{constructor(e,i,r){super(e),this.format=i,this.access=r}get astNodeType(){return"sampler"}}class Ho extends Pa{constructor(){super()}}class yP extends Ho{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class rh extends Ho{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const i of this.args)i.search(e)}evaluate(e){return this.args[0].evaluate(e)}}class xb extends Ho{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const i of this.args)i.search(e);e(this)}}class op extends Ho{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const i=e.constants.get(this.name);if(!i)throw new Error("Cannot evaluate node");return i.evaluate(e)}}class my extends Ho{constructor(e,i){super(),this.name=e,this.initializer=i}get astNodeType(){return"constExpr"}evaluate(e){var i,r;if(this.initializer instanceof rh){const o=(i=this.postfix)===null||i===void 0?void 0:i.evaluateString(e),u=(r=this.initializer.type)===null||r===void 0?void 0:r.name,_=e.structs.get(u),l=_==null?void 0:_.getMemberIndex(o);return l!==void 0&&l!=-1?this.initializer.args[l].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class yy extends Ho{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class bP extends Ho{constructor(e,i){super(),this.type=e,this.value=i}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class by extends Ho{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class vP extends Ho{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class wb extends Ho{constructor(){super()}}class xP extends wb{constructor(e,i){super(),this.operator=e,this.right=i}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Oo extends wb{constructor(e,i,r){super(),this.operator=e,this.left=i,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class Tb extends Pa{constructor(){super()}}class wP extends Tb{constructor(e,i){super(),this.selector=e,this.body=i}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class TP extends Tb{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class EP extends Pa{constructor(e,i,r){super(),this.name=e,this.type=i,this.attributes=r}get astNodeType(){return"argument"}}class SP extends Pa{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class CP extends Pa{constructor(e,i,r){super(),this.name=e,this.type=i,this.attributes=r}get astNodeType(){return"member"}}let PP=class extends Pa{constructor(e,i){super(),this.name=e,this.value=i}get astNodeType(){return"attribute"}};var ze,Be;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Be||(Be={}));class Fe{constructor(e,i,r){this.name=e,this.type=i,this.rule=r}toString(){return this.name}}class he{}ze=he;he.none=new Fe("",Be.reserved,"");he.eof=new Fe("EOF",Be.token,"");he.reserved={asm:new Fe("asm",Be.reserved,"asm"),bf16:new Fe("bf16",Be.reserved,"bf16"),do:new Fe("do",Be.reserved,"do"),enum:new Fe("enum",Be.reserved,"enum"),f16:new Fe("f16",Be.reserved,"f16"),f64:new Fe("f64",Be.reserved,"f64"),handle:new Fe("handle",Be.reserved,"handle"),i8:new Fe("i8",Be.reserved,"i8"),i16:new Fe("i16",Be.reserved,"i16"),i64:new Fe("i64",Be.reserved,"i64"),mat:new Fe("mat",Be.reserved,"mat"),premerge:new Fe("premerge",Be.reserved,"premerge"),regardless:new Fe("regardless",Be.reserved,"regardless"),typedef:new Fe("typedef",Be.reserved,"typedef"),u8:new Fe("u8",Be.reserved,"u8"),u16:new Fe("u16",Be.reserved,"u16"),u64:new Fe("u64",Be.reserved,"u64"),unless:new Fe("unless",Be.reserved,"unless"),using:new Fe("using",Be.reserved,"using"),vec:new Fe("vec",Be.reserved,"vec"),void:new Fe("void",Be.reserved,"void")};he.keywords={array:new Fe("array",Be.keyword,"array"),atomic:new Fe("atomic",Be.keyword,"atomic"),bool:new Fe("bool",Be.keyword,"bool"),f32:new Fe("f32",Be.keyword,"f32"),i32:new Fe("i32",Be.keyword,"i32"),mat2x2:new Fe("mat2x2",Be.keyword,"mat2x2"),mat2x3:new Fe("mat2x3",Be.keyword,"mat2x3"),mat2x4:new Fe("mat2x4",Be.keyword,"mat2x4"),mat3x2:new Fe("mat3x2",Be.keyword,"mat3x2"),mat3x3:new Fe("mat3x3",Be.keyword,"mat3x3"),mat3x4:new Fe("mat3x4",Be.keyword,"mat3x4"),mat4x2:new Fe("mat4x2",Be.keyword,"mat4x2"),mat4x3:new Fe("mat4x3",Be.keyword,"mat4x3"),mat4x4:new Fe("mat4x4",Be.keyword,"mat4x4"),ptr:new Fe("ptr",Be.keyword,"ptr"),sampler:new Fe("sampler",Be.keyword,"sampler"),sampler_comparison:new Fe("sampler_comparison",Be.keyword,"sampler_comparison"),struct:new Fe("struct",Be.keyword,"struct"),texture_1d:new Fe("texture_1d",Be.keyword,"texture_1d"),texture_2d:new Fe("texture_2d",Be.keyword,"texture_2d"),texture_2d_array:new Fe("texture_2d_array",Be.keyword,"texture_2d_array"),texture_3d:new Fe("texture_3d",Be.keyword,"texture_3d"),texture_cube:new Fe("texture_cube",Be.keyword,"texture_cube"),texture_cube_array:new Fe("texture_cube_array",Be.keyword,"texture_cube_array"),texture_multisampled_2d:new Fe("texture_multisampled_2d",Be.keyword,"texture_multisampled_2d"),texture_storage_1d:new Fe("texture_storage_1d",Be.keyword,"texture_storage_1d"),texture_storage_2d:new Fe("texture_storage_2d",Be.keyword,"texture_storage_2d"),texture_storage_2d_array:new Fe("texture_storage_2d_array",Be.keyword,"texture_storage_2d_array"),texture_storage_3d:new Fe("texture_storage_3d",Be.keyword,"texture_storage_3d"),texture_depth_2d:new Fe("texture_depth_2d",Be.keyword,"texture_depth_2d"),texture_depth_2d_array:new Fe("texture_depth_2d_array",Be.keyword,"texture_depth_2d_array"),texture_depth_cube:new Fe("texture_depth_cube",Be.keyword,"texture_depth_cube"),texture_depth_cube_array:new Fe("texture_depth_cube_array",Be.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Fe("texture_depth_multisampled_2d",Be.keyword,"texture_depth_multisampled_2d"),texture_external:new Fe("texture_external",Be.keyword,"texture_external"),u32:new Fe("u32",Be.keyword,"u32"),vec2:new Fe("vec2",Be.keyword,"vec2"),vec3:new Fe("vec3",Be.keyword,"vec3"),vec4:new Fe("vec4",Be.keyword,"vec4"),bitcast:new Fe("bitcast",Be.keyword,"bitcast"),block:new Fe("block",Be.keyword,"block"),break:new Fe("break",Be.keyword,"break"),case:new Fe("case",Be.keyword,"case"),continue:new Fe("continue",Be.keyword,"continue"),continuing:new Fe("continuing",Be.keyword,"continuing"),default:new Fe("default",Be.keyword,"default"),diagnostic:new Fe("diagnostic",Be.keyword,"diagnostic"),discard:new Fe("discard",Be.keyword,"discard"),else:new Fe("else",Be.keyword,"else"),enable:new Fe("enable",Be.keyword,"enable"),fallthrough:new Fe("fallthrough",Be.keyword,"fallthrough"),false:new Fe("false",Be.keyword,"false"),fn:new Fe("fn",Be.keyword,"fn"),for:new Fe("for",Be.keyword,"for"),function:new Fe("function",Be.keyword,"function"),if:new Fe("if",Be.keyword,"if"),let:new Fe("let",Be.keyword,"let"),const:new Fe("const",Be.keyword,"const"),loop:new Fe("loop",Be.keyword,"loop"),while:new Fe("while",Be.keyword,"while"),private:new Fe("private",Be.keyword,"private"),read:new Fe("read",Be.keyword,"read"),read_write:new Fe("read_write",Be.keyword,"read_write"),return:new Fe("return",Be.keyword,"return"),requires:new Fe("requires",Be.keyword,"requires"),storage:new Fe("storage",Be.keyword,"storage"),switch:new Fe("switch",Be.keyword,"switch"),true:new Fe("true",Be.keyword,"true"),alias:new Fe("alias",Be.keyword,"alias"),type:new Fe("type",Be.keyword,"type"),uniform:new Fe("uniform",Be.keyword,"uniform"),var:new Fe("var",Be.keyword,"var"),override:new Fe("override",Be.keyword,"override"),workgroup:new Fe("workgroup",Be.keyword,"workgroup"),write:new Fe("write",Be.keyword,"write"),r8unorm:new Fe("r8unorm",Be.keyword,"r8unorm"),r8snorm:new Fe("r8snorm",Be.keyword,"r8snorm"),r8uint:new Fe("r8uint",Be.keyword,"r8uint"),r8sint:new Fe("r8sint",Be.keyword,"r8sint"),r16uint:new Fe("r16uint",Be.keyword,"r16uint"),r16sint:new Fe("r16sint",Be.keyword,"r16sint"),r16float:new Fe("r16float",Be.keyword,"r16float"),rg8unorm:new Fe("rg8unorm",Be.keyword,"rg8unorm"),rg8snorm:new Fe("rg8snorm",Be.keyword,"rg8snorm"),rg8uint:new Fe("rg8uint",Be.keyword,"rg8uint"),rg8sint:new Fe("rg8sint",Be.keyword,"rg8sint"),r32uint:new Fe("r32uint",Be.keyword,"r32uint"),r32sint:new Fe("r32sint",Be.keyword,"r32sint"),r32float:new Fe("r32float",Be.keyword,"r32float"),rg16uint:new Fe("rg16uint",Be.keyword,"rg16uint"),rg16sint:new Fe("rg16sint",Be.keyword,"rg16sint"),rg16float:new Fe("rg16float",Be.keyword,"rg16float"),rgba8unorm:new Fe("rgba8unorm",Be.keyword,"rgba8unorm"),rgba8unorm_srgb:new Fe("rgba8unorm_srgb",Be.keyword,"rgba8unorm_srgb"),rgba8snorm:new Fe("rgba8snorm",Be.keyword,"rgba8snorm"),rgba8uint:new Fe("rgba8uint",Be.keyword,"rgba8uint"),rgba8sint:new Fe("rgba8sint",Be.keyword,"rgba8sint"),bgra8unorm:new Fe("bgra8unorm",Be.keyword,"bgra8unorm"),bgra8unorm_srgb:new Fe("bgra8unorm_srgb",Be.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Fe("rgb10a2unorm",Be.keyword,"rgb10a2unorm"),rg11b10float:new Fe("rg11b10float",Be.keyword,"rg11b10float"),rg32uint:new Fe("rg32uint",Be.keyword,"rg32uint"),rg32sint:new Fe("rg32sint",Be.keyword,"rg32sint"),rg32float:new Fe("rg32float",Be.keyword,"rg32float"),rgba16uint:new Fe("rgba16uint",Be.keyword,"rgba16uint"),rgba16sint:new Fe("rgba16sint",Be.keyword,"rgba16sint"),rgba16float:new Fe("rgba16float",Be.keyword,"rgba16float"),rgba32uint:new Fe("rgba32uint",Be.keyword,"rgba32uint"),rgba32sint:new Fe("rgba32sint",Be.keyword,"rgba32sint"),rgba32float:new Fe("rgba32float",Be.keyword,"rgba32float"),static_assert:new Fe("static_assert",Be.keyword,"static_assert")};he.tokens={decimal_float_literal:new Fe("decimal_float_literal",Be.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Fe("hex_float_literal",Be.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Fe("int_literal",Be.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Fe("uint_literal",Be.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Fe("ident",Be.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Fe("and",Be.token,"&"),and_and:new Fe("and_and",Be.token,"&&"),arrow:new Fe("arrow ",Be.token,"->"),attr:new Fe("attr",Be.token,"@"),forward_slash:new Fe("forward_slash",Be.token,"/"),bang:new Fe("bang",Be.token,"!"),bracket_left:new Fe("bracket_left",Be.token,"["),bracket_right:new Fe("bracket_right",Be.token,"]"),brace_left:new Fe("brace_left",Be.token,"{"),brace_right:new Fe("brace_right",Be.token,"}"),colon:new Fe("colon",Be.token,":"),comma:new Fe("comma",Be.token,","),equal:new Fe("equal",Be.token,"="),equal_equal:new Fe("equal_equal",Be.token,"=="),not_equal:new Fe("not_equal",Be.token,"!="),greater_than:new Fe("greater_than",Be.token,">"),greater_than_equal:new Fe("greater_than_equal",Be.token,">="),shift_right:new Fe("shift_right",Be.token,">>"),less_than:new Fe("less_than",Be.token,"<"),less_than_equal:new Fe("less_than_equal",Be.token,"<="),shift_left:new Fe("shift_left",Be.token,"<<"),modulo:new Fe("modulo",Be.token,"%"),minus:new Fe("minus",Be.token,"-"),minus_minus:new Fe("minus_minus",Be.token,"--"),period:new Fe("period",Be.token,"."),plus:new Fe("plus",Be.token,"+"),plus_plus:new Fe("plus_plus",Be.token,"++"),or:new Fe("or",Be.token,"|"),or_or:new Fe("or_or",Be.token,"||"),paren_left:new Fe("paren_left",Be.token,"("),paren_right:new Fe("paren_right",Be.token,")"),semicolon:new Fe("semicolon",Be.token,";"),star:new Fe("star",Be.token,"*"),tilde:new Fe("tilde",Be.token,"~"),underscore:new Fe("underscore",Be.token,"_"),xor:new Fe("xor",Be.token,"^"),plus_equal:new Fe("plus_equal",Be.token,"+="),minus_equal:new Fe("minus_equal",Be.token,"-="),times_equal:new Fe("times_equal",Be.token,"*="),division_equal:new Fe("division_equal",Be.token,"/="),modulo_equal:new Fe("modulo_equal",Be.token,"%="),and_equal:new Fe("and_equal",Be.token,"&="),or_equal:new Fe("or_equal",Be.token,"|="),xor_equal:new Fe("xor_equal",Be.token,"^="),shift_right_equal:new Fe("shift_right_equal",Be.token,">>="),shift_left_equal:new Fe("shift_left_equal",Be.token,"<<=")};he.simpleTokens={"@":ze.tokens.attr,"{":ze.tokens.brace_left,"}":ze.tokens.brace_right,":":ze.tokens.colon,",":ze.tokens.comma,"(":ze.tokens.paren_left,")":ze.tokens.paren_right,";":ze.tokens.semicolon};he.literalTokens={"&":ze.tokens.and,"&&":ze.tokens.and_and,"->":ze.tokens.arrow,"/":ze.tokens.forward_slash,"!":ze.tokens.bang,"[":ze.tokens.bracket_left,"]":ze.tokens.bracket_right,"=":ze.tokens.equal,"==":ze.tokens.equal_equal,"!=":ze.tokens.not_equal,">":ze.tokens.greater_than,">=":ze.tokens.greater_than_equal,">>":ze.tokens.shift_right,"<":ze.tokens.less_than,"<=":ze.tokens.less_than_equal,"<<":ze.tokens.shift_left,"%":ze.tokens.modulo,"-":ze.tokens.minus,"--":ze.tokens.minus_minus,".":ze.tokens.period,"+":ze.tokens.plus,"++":ze.tokens.plus_plus,"|":ze.tokens.or,"||":ze.tokens.or_or,"*":ze.tokens.star,"~":ze.tokens.tilde,_:ze.tokens.underscore,"^":ze.tokens.xor,"+=":ze.tokens.plus_equal,"-=":ze.tokens.minus_equal,"*=":ze.tokens.times_equal,"/=":ze.tokens.division_equal,"%=":ze.tokens.modulo_equal,"&=":ze.tokens.and_equal,"|=":ze.tokens.or_equal,"^=":ze.tokens.xor_equal,">>=":ze.tokens.shift_right_equal,"<<=":ze.tokens.shift_left_equal};he.regexTokens={decimal_float_literal:ze.tokens.decimal_float_literal,hex_float_literal:ze.tokens.hex_float_literal,int_literal:ze.tokens.int_literal,uint_literal:ze.tokens.uint_literal,ident:ze.tokens.ident};he.storage_class=[ze.keywords.function,ze.keywords.private,ze.keywords.workgroup,ze.keywords.uniform,ze.keywords.storage];he.access_mode=[ze.keywords.read,ze.keywords.write,ze.keywords.read_write];he.sampler_type=[ze.keywords.sampler,ze.keywords.sampler_comparison];he.sampled_texture_type=[ze.keywords.texture_1d,ze.keywords.texture_2d,ze.keywords.texture_2d_array,ze.keywords.texture_3d,ze.keywords.texture_cube,ze.keywords.texture_cube_array];he.multisampled_texture_type=[ze.keywords.texture_multisampled_2d];he.storage_texture_type=[ze.keywords.texture_storage_1d,ze.keywords.texture_storage_2d,ze.keywords.texture_storage_2d_array,ze.keywords.texture_storage_3d];he.depth_texture_type=[ze.keywords.texture_depth_2d,ze.keywords.texture_depth_2d_array,ze.keywords.texture_depth_cube,ze.keywords.texture_depth_cube_array,ze.keywords.texture_depth_multisampled_2d];he.texture_external_type=[ze.keywords.texture_external];he.any_texture_type=[...ze.sampled_texture_type,...ze.multisampled_texture_type,...ze.storage_texture_type,...ze.depth_texture_type,...ze.texture_external_type];he.texel_format=[ze.keywords.r8unorm,ze.keywords.r8snorm,ze.keywords.r8uint,ze.keywords.r8sint,ze.keywords.r16uint,ze.keywords.r16sint,ze.keywords.r16float,ze.keywords.rg8unorm,ze.keywords.rg8snorm,ze.keywords.rg8uint,ze.keywords.rg8sint,ze.keywords.r32uint,ze.keywords.r32sint,ze.keywords.r32float,ze.keywords.rg16uint,ze.keywords.rg16sint,ze.keywords.rg16float,ze.keywords.rgba8unorm,ze.keywords.rgba8unorm_srgb,ze.keywords.rgba8snorm,ze.keywords.rgba8uint,ze.keywords.rgba8sint,ze.keywords.bgra8unorm,ze.keywords.bgra8unorm_srgb,ze.keywords.rgb10a2unorm,ze.keywords.rg11b10float,ze.keywords.rg32uint,ze.keywords.rg32sint,ze.keywords.rg32float,ze.keywords.rgba16uint,ze.keywords.rgba16sint,ze.keywords.rgba16float,ze.keywords.rgba32uint,ze.keywords.rgba32sint,ze.keywords.rgba32float];he.const_literal=[ze.tokens.int_literal,ze.tokens.uint_literal,ze.tokens.decimal_float_literal,ze.tokens.hex_float_literal,ze.keywords.true,ze.keywords.false];he.literal_or_ident=[ze.tokens.ident,ze.tokens.int_literal,ze.tokens.uint_literal,ze.tokens.decimal_float_literal,ze.tokens.hex_float_literal];he.element_count_expression=[ze.tokens.int_literal,ze.tokens.uint_literal,ze.tokens.ident];he.template_types=[ze.keywords.vec2,ze.keywords.vec3,ze.keywords.vec4,ze.keywords.mat2x2,ze.keywords.mat2x3,ze.keywords.mat2x4,ze.keywords.mat3x2,ze.keywords.mat3x3,ze.keywords.mat3x4,ze.keywords.mat4x2,ze.keywords.mat4x3,ze.keywords.mat4x4,ze.keywords.atomic,ze.keywords.bitcast,...ze.any_texture_type];he.attribute_name=[ze.tokens.ident,ze.keywords.block,ze.keywords.diagnostic];he.assignment_operators=[ze.tokens.equal,ze.tokens.plus_equal,ze.tokens.minus_equal,ze.tokens.times_equal,ze.tokens.division_equal,ze.tokens.modulo_equal,ze.tokens.and_equal,ze.tokens.or_equal,ze.tokens.xor_equal,ze.tokens.shift_right_equal,ze.tokens.shift_left_equal];he.increment_operators=[ze.tokens.plus_plus,ze.tokens.minus_minus];class vy{constructor(e,i,r){this.type=e,this.lexeme=i,this.line=r}toString(){return this.lexeme}isTemplateType(){return he.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==he.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class IP{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new vy(he.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let _=1;for(;_>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),_--,_==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),_++)}return!0}}const i=he.simpleTokens[e];if(i)return this._addToken(i),!0;let r=he.none;const o=this._isAlpha(e),u=e==="_";if(this._isAlphaNumeric(e)){let _=this._peekAhead();for(;this._isAlphaNumeric(_);)e+=this._advance(),_=this._peekAhead()}if(o){const _=he.keywords[e];if(_)return this._addToken(_),!0}if(o||u)return this._addToken(he.tokens.ident),!0;for(;;){let _=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(he.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(he.tokens.minus_minus),!0;const I=this._tokens.length-1;if((he.literal_or_ident.indexOf(this._tokens[I].type)!=-1||this._tokens[I].type==he.tokens.paren_right)&&l!=">")return this._addToken(_),!0}if(e==">"&&(l==">"||l=="=")){let I=!1,R=this._tokens.length-1;for(let L=0;L<5&&R>=0&&he.assignment_operators.indexOf(this._tokens[R].type)===-1;++L,--R)if(this._tokens[R].type===he.tokens.less_than){R>0&&this._tokens[R-1].isArrayOrTemplateType()&&(I=!0);break}if(I)return this._addToken(_),!0}if(_===he.none){let I=e,R=0;const L=2;for(let z=0;z<L;++z)if(I+=this._peekAhead(z),_=this._findType(I),_!==he.none){R=z;break}if(_===he.none)return r===he.none?!1:(this._current--,this._addToken(r),!0);e=I,this._current+=R+1}if(r=_,this._isAtEnd())break;e+=this._advance()}return r===he.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in he.regexTokens){const o=he.regexTokens[r];if(this._match(e,o.rule))return o}const i=he.literalTokens[e];return i||he.none}_match(e,i){const r=i.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let i=this._source[this._current];return e=e||0,e++,this._current+=e,i}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const i=this._source.substring(this._start,this._current);this._tokens.push(new vy(e,i,this._line))}}class MP{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new tP,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const i=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;i.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const o=r.arrayType,u=r.countNode;if(u instanceof op){const l=u.name,I=this._context.constants.get(l);if(I)try{const R=I.evaluate(this._context);o.count=R}catch{}}}this._deferArrayCountEval.length=0}return i}_initialize(e){if(e)if(typeof e=="string"){const i=new IP(e);this._tokens=i.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,i){return{token:e,message:i,toString:function(){return`${i}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==he.eof}_match(e){if(e instanceof Fe)return this._check(e)?(this._advance(),!0):!1;for(let i=0,r=e.length;i<r;++i){const o=e[i];if(this._check(o))return this._advance(),!0}return!1}_consume(e,i){if(this._check(e))return this._advance();throw this._error(this._peek(),i)}_check(e){if(this._isAtEnd())return!1;const i=this._peek();if(e instanceof Array){const r=i.type;return e.indexOf(r)!=-1}return i.type==e}_advance(){var e,i;return this._currentLine=(i=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&i!==void 0?i:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(he.tokens.semicolon)&&!this._isAtEnd(););if(this._match(he.keywords.alias)){const i=this._type_alias();return this._consume(he.tokens.semicolon,"Expected ';'"),i}if(this._match(he.keywords.diagnostic)){const i=this._diagnostic();return this._consume(he.tokens.semicolon,"Expected ';'"),i}if(this._match(he.keywords.requires)){const i=this._requires_directive();return this._consume(he.tokens.semicolon,"Expected ';'"),i}if(this._match(he.keywords.enable)){const i=this._enable_directive();return this._consume(he.tokens.semicolon,"Expected ';'"),i}const e=this._attribute();if(this._check(he.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=e),this._consume(he.tokens.semicolon,"Expected ';'."),i}if(this._check(he.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=e),this._consume(he.tokens.semicolon,"Expected ';'."),i}if(this._check(he.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=e),this._consume(he.tokens.semicolon,"Expected ';'."),i}if(this._check(he.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=e),this._consume(he.tokens.semicolon,"Expected ';'."),i}if(this._check(he.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=e),i}if(this._check(he.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=e),i}return null}_function_decl(){if(!this._match(he.keywords.fn))return null;const e=this._currentLine,i=this._consume(he.tokens.ident,"Expected function name.").toString();this._consume(he.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(he.tokens.paren_right))do{if(this._check(he.tokens.paren_right))break;const l=this._attribute(),I=this._consume(he.tokens.ident,"Expected argument name.").toString();this._consume(he.tokens.colon,"Expected ':' for argument type.");const R=this._attribute(),L=this._type_decl();L!=null&&(L.attributes=R,r.push(new EP(I,L,l)))}while(this._match(he.tokens.comma));this._consume(he.tokens.paren_right,"Expected ')' after function arguments.");let o=null;if(this._match(he.tokens.arrow)){const l=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=l)}const u=this._compound_statement(),_=this._currentLine;return new sp(i,r,o,u,e,_)}_compound_statement(){const e=[];for(this._consume(he.tokens.brace_left,"Expected '{' for block.");!this._check(he.tokens.brace_right);){const i=this._statement();i!==null&&e.push(i)}return this._consume(he.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(he.tokens.semicolon)&&!this._isAtEnd(););if(this._check(he.tokens.attr)&&this._attribute(),this._check(he.keywords.if))return this._if_statement();if(this._check(he.keywords.switch))return this._switch_statement();if(this._check(he.keywords.loop))return this._loop_statement();if(this._check(he.keywords.for))return this._for_statement();if(this._check(he.keywords.while))return this._while_statement();if(this._check(he.keywords.continuing))return this._continuing_statement();if(this._check(he.keywords.static_assert))return this._static_assert_statement();if(this._check(he.tokens.brace_left))return this._compound_statement();let e=null;return this._check(he.keywords.return)?e=this._return_statement():this._check([he.keywords.var,he.keywords.let,he.keywords.const])?e=this._variable_statement():this._match(he.keywords.discard)?e=new pP:this._match(he.keywords.break)?e=new gP:this._match(he.keywords.continue)?e=new _P:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(he.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(he.keywords.static_assert))return null;const e=this._optional_paren_expression();return new iP(e)}_while_statement(){if(!this._match(he.keywords.while))return null;const e=this._optional_paren_expression();this._check(he.tokens.attr)&&this._attribute();const i=this._compound_statement();return new rP(e,i)}_continuing_statement(){if(!this._match(he.keywords.continuing))return null;const e=this._compound_statement();return new sP(e)}_for_statement(){if(!this._match(he.keywords.for))return null;this._consume(he.tokens.paren_left,"Expected '('.");const e=this._check(he.tokens.semicolon)?null:this._for_init();this._consume(he.tokens.semicolon,"Expected ';'.");const i=this._check(he.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(he.tokens.semicolon,"Expected ';'.");const r=this._check(he.tokens.paren_right)?null:this._for_increment();this._consume(he.tokens.paren_right,"Expected ')'."),this._check(he.tokens.attr)&&this._attribute();const o=this._compound_statement();return new nP(e,i,r,o)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(he.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(he.tokens.equal)&&(i=this._short_circuit_or_expression()),new Xl(e.name,e.type,e.storage,e.access,i)}if(this._match(he.keywords.let)){const e=this._consume(he.tokens.ident,"Expected name for let.").toString();let i=null;if(this._match(he.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(he.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new np(e,i,null,null,r)}if(this._match(he.keywords.const)){const e=this._consume(he.tokens.ident,"Expected name for const.").toString();let i=null;if(this._match(he.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(he.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new _y(e,i,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(he.increment_operators))return this._current=e,null;const r=this._consume(he.increment_operators,"Expected increment operator");return new oP(r.type===he.tokens.plus_plus?wh.increment:wh.decrement,i)}_assignment_statement(){let e=null;if(this._check(he.tokens.brace_right))return null;let i=this._match(he.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const r=this._consume(he.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return new aP(Bu.parse(r.lexeme),e,o)}_func_call_statement(){if(!this._check(he.tokens.ident))return null;const e=this._current,i=this._consume(he.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new mb(i.lexeme,r)}_loop_statement(){if(!this._match(he.keywords.loop))return null;this._check(he.tokens.attr)&&this._attribute(),this._consume(he.tokens.brace_left,"Expected '{' for loop.");const e=[];let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let o of i)e.push(o);else e.push(i);i=this._statement()}let r=null;return this._match(he.keywords.continuing)&&(r=this._compound_statement()),this._consume(he.tokens.brace_right,"Expected '}' for loop."),new lP(e,r)}_switch_statement(){if(!this._match(he.keywords.switch))return null;const e=this._optional_paren_expression();this._check(he.tokens.attr)&&this._attribute(),this._consume(he.tokens.brace_left,"Expected '{' for switch.");const i=this._switch_body();if(i==null||i.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(he.tokens.brace_right,"Expected '}' for switch."),new cP(e,i)}_switch_body(){const e=[];if(this._match(he.keywords.case)){const i=this._case_selectors();this._match(he.tokens.colon),this._check(he.tokens.attr)&&this._attribute(),this._consume(he.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(he.tokens.brace_right,"Exected '}' for switch case."),e.push(new wP(i,r))}if(this._match(he.keywords.default)){this._match(he.tokens.colon),this._check(he.tokens.attr)&&this._attribute(),this._consume(he.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(he.tokens.brace_right,"Exected '}' for switch default."),e.push(new TP(i))}if(this._check([he.keywords.default,he.keywords.case])){const i=this._switch_body();e.push(i[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(he.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(he.keywords.fallthrough))return this._consume(he.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const i=this._case_body();return i.length==0?e:[...e,i[0]]}_if_statement(){if(!this._match(he.keywords.if))return null;const e=this._optional_paren_expression();this._check(he.tokens.attr)&&this._attribute();const i=this._compound_statement();let r=[];this._match_elseif()&&(this._check(he.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let o=null;return this._match(he.keywords.else)&&(this._check(he.tokens.attr)&&this._attribute(),o=this._compound_statement()),new hP(e,i,r,o)}_match_elseif(){return this._tokens[this._current].type===he.keywords.else&&this._tokens[this._current+1].type===he.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const i=this._optional_paren_expression(),r=this._compound_statement();return e.push(new SP(i,r)),this._match_elseif()&&(this._check(he.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(he.keywords.return))return null;const e=this._short_circuit_or_expression();return new uP(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(he.tokens.or_or);)e=new Oo(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(he.tokens.and_and);)e=new Oo(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(he.tokens.or);)e=new Oo(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(he.tokens.xor);)e=new Oo(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(he.tokens.and);)e=new Oo(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([he.tokens.equal_equal,he.tokens.not_equal])?new Oo(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([he.tokens.less_than,he.tokens.greater_than,he.tokens.less_than_equal,he.tokens.greater_than_equal]);)e=new Oo(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([he.tokens.shift_left,he.tokens.shift_right]);)e=new Oo(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([he.tokens.plus,he.tokens.minus]);)e=new Oo(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([he.tokens.star,he.tokens.forward_slash,he.tokens.modulo]);)e=new Oo(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([he.tokens.minus,he.tokens.bang,he.tokens.tilde,he.tokens.star,he.tokens.and])?new xP(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),i=this._postfix_expression();return i&&(e.postfix=i),e}_postfix_expression(){if(this._match(he.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(he.tokens.bracket_right,"Expected ']'.");const i=new vP(e),r=this._postfix_expression();return r&&(i.postfix=r),i}if(this._match(he.tokens.period)){const e=this._consume(he.tokens.ident,"Expected member name."),i=this._postfix_expression(),r=new yP(e.lexeme);return i&&(r.postfix=i),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(he.tokens.ident)){const r=this._previous().toString();if(this._check(he.tokens.paren_left)){const o=this._argument_expression_list(),u=this._getStruct(r);return u!=null?new rh(u,o):new xb(r,o)}if(this._context.constants.has(r)){const o=this._context.constants.get(r);return new my(r,o.value)}return new op(r)}if(this._match(he.const_literal))return new yy(parseFloat(this._previous().toString()));if(this._check(he.tokens.paren_left))return this._paren_expression();if(this._match(he.keywords.bitcast)){this._consume(he.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(he.tokens.greater_than,"Expected '>'.");const o=this._paren_expression();return new bP(r,o)}const e=this._type_decl(),i=this._argument_expression_list();return new rh(e,i)}_argument_expression_list(){if(!this._match(he.tokens.paren_left))return null;const e=[];do{if(this._check(he.tokens.paren_right))break;const i=this._short_circuit_or_expression();e.push(i)}while(this._match(he.tokens.comma));return this._consume(he.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(he.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(he.tokens.paren_right),new by([e])}_paren_expression(){this._consume(he.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(he.tokens.paren_right,"Expected ')'."),new by([e])}_struct_decl(){if(!this._match(he.keywords.struct))return null;const e=this._currentLine,i=this._consume(he.tokens.ident,"Expected name for struct.").toString();this._consume(he.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(he.tokens.brace_right);){const _=this._attribute(),l=this._consume(he.tokens.ident,"Expected variable name.").toString();this._consume(he.tokens.colon,"Expected ':' for struct member type.");const I=this._attribute(),R=this._type_decl();R!=null&&(R.attributes=I),this._check(he.tokens.brace_right)?this._match(he.tokens.comma):this._consume(he.tokens.comma,"Expected ',' for struct member."),r.push(new CP(l,R,_))}this._consume(he.tokens.brace_right,"Expected '}' after struct body.");const o=this._currentLine,u=new ql(i,r,e,o);return this._context.structs.set(i,u),u}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(he.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(he.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(he.keywords.const))return null;const e=this._consume(he.tokens.ident,"Expected variable name");let i=null;if(this._match(he.tokens.colon)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}let r=null;if(this._match(he.tokens.equal)){const u=this._short_circuit_or_expression();if(u instanceof rh)r=u;else if(u instanceof my&&u.initializer instanceof rh)r=u.initializer;else try{const _=u.evaluate(this._context);r=new yy(_)}catch{r=u}}const o=new _y(e.toString(),i,"","",r);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(he.keywords.let))return null;const e=this._consume(he.tokens.ident,"Expected variable name");let i=null;if(this._match(he.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}let r=null;return this._match(he.tokens.equal)&&(r=this._const_expression()),new np(e.toString(),i,"","",r)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(he.keywords.var))return null;let e="",i="";this._match(he.tokens.less_than)&&(e=this._consume(he.storage_class,"Expected storage_class.").toString(),this._match(he.tokens.comma)&&(i=this._consume(he.access_mode,"Expected access_mode.").toString()),this._consume(he.tokens.greater_than,"Expected '>'."));const r=this._consume(he.tokens.ident,"Expected variable name");let o=null;if(this._match(he.tokens.colon)){const u=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=u)}return new Xl(r.toString(),o,e,i,null)}_override_decl(){if(!this._match(he.keywords.override))return null;const e=this._consume(he.tokens.ident,"Expected variable name");let i=null;if(this._match(he.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}return new _b(e.toString(),i,null)}_diagnostic(){this._consume(he.tokens.paren_left,"Expected '('");const e=this._consume(he.tokens.ident,"Expected severity control name.");this._consume(he.tokens.comma,"Expected ','");const i=this._consume(he.tokens.ident,"Expected diagnostic rule name.");return this._consume(he.tokens.paren_right,"Expected ')'"),new dP(e.toString(),i.toString())}_enable_directive(){const e=this._consume(he.tokens.ident,"identity expected.");return new AP(e.toString())}_requires_directive(){const e=[this._consume(he.tokens.ident,"identity expected.").toString()];for(;this._match(he.tokens.comma);){const i=this._consume(he.tokens.ident,"identity expected.");e.push(i.toString())}return new fP(e)}_type_alias(){const e=this._consume(he.tokens.ident,"identity expected.");this._consume(he.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const r=new yb(e.toString(),i);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([he.tokens.ident,...he.texel_format,he.keywords.bool,he.keywords.f32,he.keywords.i32,he.keywords.u32])){const r=this._advance(),o=r.toString();return this._context.structs.has(o)?this._context.structs.get(o):this._context.aliases.has(o)?this._context.aliases.get(o).type:new uc(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(he.template_types)){let r=this._advance().toString(),o=null,u=null;return this._match(he.tokens.less_than)&&(o=this._type_decl(),u=null,this._match(he.tokens.comma)&&(u=this._consume(he.access_mode,"Expected access_mode for pointer").toString()),this._consume(he.tokens.greater_than,"Expected '>' for type.")),new bb(r,o,u)}if(this._match(he.keywords.ptr)){let r=this._previous().toString();this._consume(he.tokens.less_than,"Expected '<' for pointer.");const o=this._consume(he.storage_class,"Expected storage_class for pointer");this._consume(he.tokens.comma,"Expected ',' for pointer.");const u=this._type_decl();let _=null;return this._match(he.tokens.comma)&&(_=this._consume(he.access_mode,"Expected access_mode for pointer").toString()),this._consume(he.tokens.greater_than,"Expected '>' for pointer."),new mP(r,o.toString(),u,_)}const i=this._attribute();if(this._match(he.keywords.array)){let r=null,o=-1;const u=this._previous();let _=null;if(this._match(he.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let I="";if(this._match(he.tokens.comma)){_=this._shift_expression();try{I=_.evaluate(this._context).toString(),_=null}catch{I="1"}}this._consume(he.tokens.greater_than,"Expected '>' for array."),o=I?parseInt(I):0}const l=new vb(u.toString(),i,r,o);return _&&this._deferArrayCountEval.push({arrayType:l,countNode:_}),l}return null}_texture_sampler_types(){if(this._match(he.sampler_type))return new _u(this._previous().toString(),null,null);if(this._match(he.depth_texture_type))return new _u(this._previous().toString(),null,null);if(this._match(he.sampled_texture_type)||this._match(he.multisampled_texture_type)){const e=this._previous();this._consume(he.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(he.tokens.greater_than,"Expected '>' for sampler type."),new _u(e.toString(),i,null)}if(this._match(he.storage_texture_type)){const e=this._previous();this._consume(he.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(he.texel_format,"Invalid texel format.").toString();this._consume(he.tokens.comma,"Expected ',' after texel format.");const r=this._consume(he.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(he.tokens.greater_than,"Expected '>' for sampler type."),new _u(e.toString(),i,r)}return null}_attribute(){let e=[];for(;this._match(he.tokens.attr);){const i=this._consume(he.attribute_name,"Expected attribute name"),r=new PP(i.toString(),null);if(this._match(he.tokens.paren_left)){if(r.value=this._consume(he.literal_or_ident,"Expected attribute value").toString(),this._check(he.tokens.comma)){this._advance();do{const o=this._consume(he.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(o)}while(this._match(he.tokens.comma))}this._consume(he.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class gh{constructor(e,i){this.name=e,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class xy{constructor(e,i,r){this.name=e,this.type=i,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class EA extends gh{constructor(e,i){super(e,i),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class A0 extends gh{constructor(e,i){super(e,i),this.count=0,this.stride=0}get isArray(){return!0}}class wy extends gh{constructor(e,i,r,o){super(e,r),this.format=i,this.access=o}get isTemplate(){return!0}}var il;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(il||(il={}));class SA{constructor(e,i,r,o,u,_,l){this.name=e,this.type=i,this.group=r,this.binding=o,this.attributes=u,this.resourceType=_,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class RP{constructor(e,i){this.name=e,this.type=i}}class CA{constructor(e,i){this.align=e,this.size=i}}class kP{constructor(e,i,r,o){this.name=e,this.type=i,this.locationType=r,this.location=o,this.interpolation=null}}class Ty{constructor(e,i,r,o){this.name=e,this.type=i,this.locationType=r,this.location=o}}class DP{constructor(e,i,r,o){this.name=e,this.type=i,this.attributes=r,this.id=o}}class BP{constructor(e,i){this.name=e,this.type=i}}class FP{constructor(e,i=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=i}}class OP{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class LP{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class va{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new OP,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new MP().parse(e);for(const o of r)o instanceof sp&&this._functions.set(o.name,new LP(o));for(const o of r)if(o instanceof ql){const u=this._getTypeInfo(o,null);u instanceof EA&&this.structs.push(u)}for(const o of r){if(o instanceof yb){this.aliases.push(this._getAliasInfo(o));continue}if(o instanceof _b){const u=o,_=this._getAttributeNum(u.attributes,"id",0),l=u.type!=null?this._getTypeInfo(u.type,u.attributes):null;this.overrides.push(new DP(u.name,l,u.attributes,_));continue}if(this._isUniformVar(o)){const u=o,_=this._getAttributeNum(u.attributes,"group",0),l=this._getAttributeNum(u.attributes,"binding",0),I=this._getTypeInfo(u.type,u.attributes),R=new SA(u.name,I,_,l,u.attributes,il.Uniform,u.access);this.uniforms.push(R);continue}if(this._isStorageVar(o)){const u=o,_=this._getAttributeNum(u.attributes,"group",0),l=this._getAttributeNum(u.attributes,"binding",0),I=this._getTypeInfo(u.type,u.attributes),R=this._isStorageTexture(I),L=new SA(u.name,I,_,l,u.attributes,R?il.StorageTexture:il.Storage,u.access);this.storage.push(L);continue}if(this._isTextureVar(o)){const u=o,_=this._getAttributeNum(u.attributes,"group",0),l=this._getAttributeNum(u.attributes,"binding",0),I=this._getTypeInfo(u.type,u.attributes),R=this._isStorageTexture(I),L=new SA(u.name,I,_,l,u.attributes,R?il.StorageTexture:il.Texture,u.access);R?this.storage.push(L):this.textures.push(L);continue}if(this._isSamplerVar(o)){const u=o,_=this._getAttributeNum(u.attributes,"group",0),l=this._getAttributeNum(u.attributes,"binding",0),I=this._getTypeInfo(u.type,u.attributes),R=new SA(u.name,I,_,l,u.attributes,il.Sampler,u.access);this.samplers.push(R);continue}if(o instanceof sp){const u=this._getAttribute(o,"vertex"),_=this._getAttribute(o,"fragment"),l=this._getAttribute(o,"compute"),I=u||_||l,R=new FP(o.name,I==null?void 0:I.name);R.startLine=o.startLine,R.endLine=o.endLine,this.functions.push(R),this._functions.get(o.name).info=R,I?(this._functions.get(o.name).inUse=!0,R.inUse=!0,R.resources=this._findResources(o,!!I),R.inputs=this._getInputs(o.args),R.outputs=this._getOutputs(o.returnType),this.entry[I.name].push(R)):(R.arguments=o.args.map(L=>new BP(L.name,this._getTypeInfo(L.type,L.attributes))),R.returnType=o.returnType?this._getTypeInfo(o.returnType,o.attributes):null);continue}}for(const o of this._functions.values())o.info&&(o.info.inUse=o.inUse,this._addCalls(o.node,o.info.calls));for(const o of this._functions.values())o.node.search(u=>{var _;if(u.astNodeType==="varExpr"){const l=u;for(const I of this.overrides)l.name==I.name&&((_=o.info)===null||_===void 0||_.overrides.push(I))}});for(const o of this.uniforms)this._markStructsInUse(o.type);for(const o of this.storage)this._markStructsInUse(o.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const i of e.members)this._markStructsInUse(i.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const i=this._getAlias(e.name);i&&this._markStructsInUse(i)}}_addCalls(e,i){var r;for(const o of e.calls){const u=(r=this._functions.get(o.name))===null||r===void 0?void 0:r.info;u&&i.add(u)}}findResource(e,i){for(const r of this.uniforms)if(r.group==e&&r.binding==i)return r;for(const r of this.storage)if(r.group==e&&r.binding==i)return r;for(const r of this.textures)if(r.group==e&&r.binding==i)return r;for(const r of this.samplers)if(r.group==e&&r.binding==i)return r;return null}_findResource(e){for(const i of this.uniforms)if(i.name==e)return i;for(const i of this.storage)if(i.name==e)return i;for(const i of this.textures)if(i.name==e)return i;for(const i of this.samplers)if(i.name==e)return i;return null}_markStructsFromAST(e){const i=this._getTypeInfo(e,null);this._markStructsInUse(i)}_findResources(e,i){const r=[],o=this,u=[];return e.search(_=>{if(_ instanceof Tf)u.push({});else if(_ instanceof Ef)u.pop();else if(_ instanceof Xl){const l=_;i&&l.type!==null&&this._markStructsFromAST(l.type),u.length>0&&(u[u.length-1][l.name]=l)}else if(_ instanceof rh){const l=_;i&&l.type!==null&&this._markStructsFromAST(l.type)}else if(_ instanceof np){const l=_;i&&l.type!==null&&this._markStructsFromAST(l.type),u.length>0&&(u[u.length-1][l.name]=l)}else if(_ instanceof op){const l=_;if(u.length>0&&u[u.length-1][l.name])return;const I=o._findResource(l.name);I&&r.push(I)}else if(_ instanceof xb){const l=_,I=o._functions.get(l.name);I&&(i&&(I.inUse=!0),e.calls.add(I.node),I.resources===null&&(I.resources=o._findResources(I.node,i)),r.push(...I.resources))}else if(_ instanceof mb){const l=_,I=o._functions.get(l.name);I&&(i&&(I.inUse=!0),e.calls.add(I.node),I.resources===null&&(I.resources=o._findResources(I.node,i)),r.push(...I.resources))}}),[...new Map(r.map(_=>[_.name,_])).values()]}getBindGroups(){const e=[];function i(r,o){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),o>=e[r].length&&(e[r].length=o+1)}for(const r of this.uniforms){i(r.group,r.binding);const o=e[r.group];o[r.binding]=r}for(const r of this.storage){i(r.group,r.binding);const o=e[r.group];o[r.binding]=r}for(const r of this.textures){i(r.group,r.binding);const o=e[r.group];o[r.binding]=r}for(const r of this.samplers){i(r.group,r.binding);const o=e[r.group];o[r.binding]=r}return e}_getOutputs(e,i=void 0){if(i===void 0&&(i=[]),e instanceof ql)this._getStructOutputs(e,i);else{const r=this._getOutputInfo(e);r!==null&&i.push(r)}return i}_getStructOutputs(e,i){for(const r of e.members)if(r.type instanceof ql)this._getStructOutputs(r.type,i);else{const o=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(o!==null){const u=this._getTypeInfo(r.type,r.type.attributes),_=this._parseInt(o.value),l=new Ty(r.name,u,o.name,_);i.push(l)}}}_getOutputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const r=this._getTypeInfo(e,e.attributes),o=this._parseInt(i.value);return new Ty("",r,i.name,o)}return null}_getInputs(e,i=void 0){i===void 0&&(i=[]);for(const r of e)if(r.type instanceof ql)this._getStructInputs(r.type,i);else{const o=this._getInputInfo(r);o!==null&&i.push(o)}return i}_getStructInputs(e,i){for(const r of e.members)if(r.type instanceof ql)this._getStructInputs(r.type,i);else{const o=this._getInputInfo(r);o!==null&&i.push(o)}}_getInputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const r=this._getAttribute(e,"interpolation"),o=this._getTypeInfo(e.type,e.attributes),u=this._parseInt(i.value),_=new kP(e.name,o,i.name,u);return r!==null&&(_.interpolation=this._parseString(r.value)),_}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const i=parseInt(e);return isNaN(i)?e:i}_getAlias(e){for(const i of this.aliases)if(i.name==e)return i.type;return null}_getAliasInfo(e){return new RP(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,i){if(this._types.has(e))return this._types.get(e);if(e instanceof vb){const o=e,u=o.format?this._getTypeInfo(o.format,o.attributes):null,_=new A0(o.name,i);return _.format=u,_.count=o.count,this._types.set(e,_),this._updateTypeInfo(_),_}if(e instanceof ql){const o=e,u=new EA(o.name,i);u.startLine=o.startLine,u.endLine=o.endLine;for(const _ of o.members){const l=this._getTypeInfo(_.type,_.attributes);u.members.push(new xy(_.name,l,_.attributes))}return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof _u){const o=e,u=o.format instanceof uc,_=o.format?u?this._getTypeInfo(o.format,null):new gh(o.format,null):null,l=new wy(o.name,_,i,o.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof bb){const o=e,u=o.format?this._getTypeInfo(o.format,null):null,_=new wy(o.name,u,i,o.access);return this._types.set(e,_),this._updateTypeInfo(_),_}const r=new gh(e.name,i);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var i,r;const o=this._getTypeSize(e);if(e.size=(i=o==null?void 0:o.size)!==null&&i!==void 0?i:0,e instanceof A0&&e.format){const u=this._getTypeSize(e.format);e.stride=(r=u==null?void 0:u.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof EA&&this._updateStructInfo(e)}_updateStructInfo(e){var i;let r=0,o=0,u=0,_=0;for(let l=0,I=e.members.length;l<I;++l){const R=e.members[l],L=this._getTypeSize(R);if(!L)continue;(i=this._getAlias(R.type.name))!==null&&i!==void 0||R.type;const z=L.align,V=L.size;r=this._roundUp(z,r+o),o=V,u=r,_=Math.max(_,z),R.offset=r,R.size=V,this._updateTypeInfo(R.type)}e.size=this._roundUp(_,u+o),e.align=_}_getTypeSize(e){var i,r;if(e==null)return null;const o=this._getAttributeNum(e.attributes,"size",0),u=this._getAttributeNum(e.attributes,"align",0);if(e instanceof xy&&(e=e.type),e instanceof gh){const _=this._getAlias(e.name);_!==null&&(e=_)}{const _=va._typeInfo[e.name];if(_!==void 0){const l=((i=e.format)===null||i===void 0?void 0:i.name)==="f16"?2:1;return new CA(Math.max(u,_.align/l),Math.max(o,_.size/l))}}{const _=va._typeInfo[e.name.substring(0,e.name.length-1)];if(_){const l=e.name[e.name.length-1]==="h"?2:1;return new CA(Math.max(u,_.align/l),Math.max(o,_.size/l))}}if(e instanceof A0){let _=e,l=8,I=8;const R=this._getTypeSize(_.format);R!==null&&(I=R.size,l=R.align);const L=_.count,z=this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(l,I));return I=L*z,o&&(I=o),new CA(Math.max(u,l),Math.max(o,I))}if(e instanceof EA){let _=0,l=0,I=0,R=0,L=0;for(const z of e.members){const V=this._getTypeSize(z.type);V!==null&&(_=Math.max(V.align,_),I=this._roundUp(V.align,I+R),R=V.size,L=I)}return l=this._roundUp(_,L+R),new CA(Math.max(u,_),Math.max(o,l))}return null}_isUniformVar(e){return e instanceof Xl&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Xl&&e.storage=="storage"}_isTextureVar(e){return e instanceof Xl&&e.type!==null&&va._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Xl&&e.type!==null&&va._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,i){const r=e;if(!r||!r.attributes)return null;const o=r.attributes;for(let u of o)if(u.name==i)return u;return null}_getAttributeNum(e,i,r){if(e===null)return r;for(let o of e)if(o.name==i){let u=o!==null&&o.value!==null?o.value:r;return u instanceof Array&&(u=u[0]),typeof u=="number"?u:typeof u=="string"?parseInt(u):r}return r}_roundUp(e,i){return Math.ceil(i/e)*e}}va._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};va._textureTypes=he.any_texture_type.map(t=>t.name);va._samplerTypes=he.sampler_type.map(t=>t.name);function NP(t){var u;const e={attributes:[],bindings:[]};let i;try{i=zP(t)}catch(_){return ht.error(_.message)(),e}for(const _ of i.uniforms){const l=[];for(const I of((u=_.type)==null?void 0:u.members)||[])l.push({name:I.name,type:Ey(I.type)});e.bindings.push({type:"uniform",name:_.name,location:_.binding,group:_.group,members:l})}const r=i.entry.vertex[0],o=(r==null?void 0:r.inputs.length)||0;for(let _=0;_<o;_++){const l=r.inputs[_];if(l.locationType==="location"){const I=Ey(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:I})}}return e}function Ey(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function zP(t){try{return new va(t)}catch(e){if(e instanceof Error)throw e;let i="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(i+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(i+=e.token.line||""),new Error(i,{cause:e})}}const UP=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,VP={name:"fp32",vs:UP},jP=[0,1,1,1],$P=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,WP=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,Sy={name:"picking",vs:$P,fs:WP,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:jP},getUniforms:HP};function HP(t={},e){const i={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,o=>o/255);Number.isFinite(r[3])||(r[3]=1),i.highlightColor=r}return t.isActive!==void 0&&(i.isActive=!!t.isActive,i.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(i.useFloatColors=!!t.useFloatColors),i}function Eb(t,e=[],i=0){const r=Math.fround(t),o=t-r;return e[i]=r,e[i+1]=o,e}function qP(t){return t-Math.fround(t)}function XP(t){const e=new Float32Array(32);for(let i=0;i<4;++i)for(let r=0;r<4;++r){const o=i*4+r;Eb(t[r*4+i],e,o*2)}return e}const ZP=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,YP={ONE:1};function GP(){return YP}const QP={name:"fp64-arithmetic",vs:ZP,getUniforms:GP,fp64ify:Eb,fp64LowPart:qP,fp64ifyMatrix4:XP},KP={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...KP}};const Ys=globalThis.mathgl.config;function JP(t,{precision:e=Ys.precision}={}){return t=e4(t),`${parseFloat(t.toPrecision(e))}`}function ic(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function sl(t,e,i){return i4(t,r=>Math.max(e,Math.min(i,r)))}function Th(t,e,i){return ic(t)?t.map((r,o)=>Th(r,e[o],i)):i*e+(1-i)*t}function wa(t,e,i){const r=Ys.EPSILON;i&&(Ys.EPSILON=i);try{if(t===e)return!0;if(ic(t)&&ic(e)){if(t.length!==e.length)return!1;for(let o=0;o<t.length;++o)if(!wa(t[o],e[o]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Ys.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Ys.EPSILON=r}}function e4(t){return Math.round(t/Ys.EPSILON)*Ys.EPSILON}function t4(t){return t.clone?t.clone():new Array(t.length)}function i4(t,e,i){if(ic(t)){const r=t;i=i||t4(r);for(let o=0;o<i.length&&o<r.length;++o){const u=typeof t=="number"?t:t[o];i[o]=e(u,o,i)}return i}return e(t)}class Kp extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+i];return this.check()}toArray(e=[],i=0){for(let r=0;r<this.ELEMENTS;++r)e[i+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ic(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ys)}formatString(e){let i="";for(let r=0;r<this.ELEMENTS;++r)i+=(r>0?", ":"")+JP(this[r],e);return`${e.printTypes?this.constructor.name:""}[${i}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!wa(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,r){if(r===void 0)return this.lerp(this,e,i);for(let o=0;o<this.ELEMENTS;++o){const u=e[o],_=typeof i=="number"?i:i[o];this[o]=u+r*(_-u)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),i[r]);return this.check()}add(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=i[r];return this.check()}subtract(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=i[r];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(Ys.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),i);return this.check()}get elements(){return this}}function r4(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function Yi(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Tu(t,e,i=""){if(Ys.debug&&!r4(t,e))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return t}function Fu(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class Sb extends Kp{get x(){return this[0]}set x(e){this[0]=Yi(e)}get y(){return this[1]}set y(e){this[1]=Yi(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let r=0;r<this.ELEMENTS;++r){const o=this[r]-e[r];i+=o*o}return Yi(i)}dot(e){let i=0;for(let r=0;r<this.ELEMENTS;++r)i+=this[r]*e[r];return Yi(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=i[r];return this.check()}divide(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=i[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Fu(e>=0&&e<this.ELEMENTS,"index is out of range"),Yi(this[e])}setComponent(e,i){return Fu(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}const Eu=1e-6;let uo=typeof Float32Array<"u"?Float32Array:Array;function s4(){const t=new uo(2);return uo!=Float32Array&&(t[0]=0,t[1]=0),t}function Cy(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function n4(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Cb(t,e,i,r){const o=e[0],u=e[1];return t[0]=o+r*(i[0]-o),t[1]=u+r*(i[1]-u),t}function o4(t,e,i){const r=e[0],o=e[1];return t[0]=i[0]*r+i[3]*o+i[6],t[1]=i[1]*r+i[4]*o+i[7],t}function a4(t,e,i){const r=e[0],o=e[1];return t[0]=i[0]*r+i[4]*o+i[12],t[1]=i[1]*r+i[5]*o+i[13],t}(function(){const t=s4();return function(e,i,r,o,u,_){let l,I;for(i||(i=2),r||(r=0),o?I=Math.min(o*i+r,e.length):I=e.length,l=r;l<I;l+=i)t[0]=e[l],t[1]=e[l+1],u(t,t,_),e[l]=t[0],e[l+1]=t[1];return e}})();function l4(t,e,i){const r=e[0],o=e[1],u=i[3]*r+i[7]*o||1;return t[0]=(i[0]*r+i[4]*o)/u,t[1]=(i[1]*r+i[5]*o)/u,t}function Pb(t,e,i){const r=e[0],o=e[1],u=e[2],_=i[3]*r+i[7]*o+i[11]*u||1;return t[0]=(i[0]*r+i[4]*o+i[8]*u)/_,t[1]=(i[1]*r+i[5]*o+i[9]*u)/_,t[2]=(i[2]*r+i[6]*o+i[10]*u)/_,t}function c4(t,e,i){const r=e[0],o=e[1];return t[0]=i[0]*r+i[2]*o,t[1]=i[1]*r+i[3]*o,t[2]=e[2],t}function h4(t,e,i){const r=e[0],o=e[1];return t[0]=i[0]*r+i[2]*o,t[1]=i[1]*r+i[3]*o,t[2]=e[2],t[3]=e[3],t}function Ib(t,e,i){const r=e[0],o=e[1],u=e[2];return t[0]=i[0]*r+i[3]*o+i[6]*u,t[1]=i[1]*r+i[4]*o+i[7]*u,t[2]=i[2]*r+i[5]*o+i[8]*u,t[3]=e[3],t}function Mb(){const t=new uo(3);return uo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function u4(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function Py(t,e,i){const r=new uo(3);return r[0]=t,r[1]=e,r[2]=i,r}function A4(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function f4(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function d4(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function p4(t,e){const i=e[0],r=e[1],o=e[2];let u=i*i+r*r+o*o;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t}function Rb(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function tf(t,e,i){const r=e[0],o=e[1],u=e[2],_=i[0],l=i[1],I=i[2];return t[0]=o*I-u*l,t[1]=u*_-r*I,t[2]=r*l-o*_,t}function g4(t,e,i,r){const o=e[0],u=e[1],_=e[2];return t[0]=o+r*(i[0]-o),t[1]=u+r*(i[1]-u),t[2]=_+r*(i[2]-_),t}function Jp(t,e,i){const r=e[0],o=e[1],u=e[2];let _=i[3]*r+i[7]*o+i[11]*u+i[15];return _=_||1,t[0]=(i[0]*r+i[4]*o+i[8]*u+i[12])/_,t[1]=(i[1]*r+i[5]*o+i[9]*u+i[13])/_,t[2]=(i[2]*r+i[6]*o+i[10]*u+i[14])/_,t}function kb(t,e,i){const r=e[0],o=e[1],u=e[2];return t[0]=r*i[0]+o*i[3]+u*i[6],t[1]=r*i[1]+o*i[4]+u*i[7],t[2]=r*i[2]+o*i[5]+u*i[8],t}function Db(t,e,i){const r=i[0],o=i[1],u=i[2],_=i[3],l=e[0],I=e[1],R=e[2];let L=o*R-u*I,z=u*l-r*R,V=r*I-o*l,q=o*V-u*z,ne=u*L-r*V,Ae=r*z-o*L;const Ee=_*2;return L*=Ee,z*=Ee,V*=Ee,q*=2,ne*=2,Ae*=2,t[0]=l+L+q,t[1]=I+z+ne,t[2]=R+V+Ae,t}function _4(t,e,i,r){const o=[],u=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],u[0]=o[0],u[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),u[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function m4(t,e,i,r){const o=[],u=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],u[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),u[1]=o[1],u[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function y4(t,e,i,r){const o=[],u=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],u[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),u[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),u[2]=o[2],t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function b4(t,e){const i=t[0],r=t[1],o=t[2],u=e[0],_=e[1],l=e[2],I=Math.sqrt((i*i+r*r+o*o)*(u*u+_*_+l*l)),R=I&&Rb(t,e)/I;return Math.acos(Math.min(Math.max(R,-1),1))}const Bb=A4,Fb=u4,f0=f4;(function(){const t=Mb();return function(e,i,r,o,u,_){let l,I;for(i||(i=3),r||(r=0),o?I=Math.min(o*i+r,e.length):I=e.length,l=r;l<I;l+=i)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],u(t,t,_),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const d0=[0,0,0];let PA;class Ft extends Sb{static get ZERO(){return PA||(PA=new Ft(0,0,0),Object.freeze(PA)),PA}constructor(e=0,i=0,r=0){super(-0,-0,-0),arguments.length===1&&ic(e)?this.copy(e):(Ys.debug&&(Yi(e),Yi(i),Yi(r)),this[0]=e,this[1]=i,this[2]=r)}set(e,i,r){return this[0]=e,this[1]=i,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ys.debug&&(Yi(e.x),Yi(e.y),Yi(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Yi(e)}angle(e){return b4(this,e)}cross(e){return tf(this,this,e),this.check()}rotateX({radians:e,origin:i=d0}){return _4(this,this,i,e),this.check()}rotateY({radians:e,origin:i=d0}){return m4(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=d0}){return y4(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Jp(this,this,e),this.check()}transformAsVector(e){return Pb(this,this,e),this.check()}transformByMatrix3(e){return kb(this,this,e),this.check()}transformByMatrix2(e){return c4(this,this,e),this.check()}transformByQuaternion(e){return Db(this,this,e),this.check()}}let IA;class eg extends Sb{static get ZERO(){return IA||(IA=new eg(0,0,0,0),Object.freeze(IA)),IA}constructor(e=0,i=0,r=0,o=0){super(-0,-0,-0,-0),ic(e)&&arguments.length===1?this.copy(e):(Ys.debug&&(Yi(e),Yi(i),Yi(r),Yi(o)),this[0]=e,this[1]=i,this[2]=r,this[3]=o)}set(e,i,r,o){return this[0]=e,this[1]=i,this[2]=r,this[3]=o,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Ys.debug&&(Yi(e.x),Yi(e.y),Yi(e.z),Yi(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Yi(e)}get w(){return this[3]}set w(e){this[3]=Yi(e)}transform(e){return Jp(this,this,e),this.check()}transformByMatrix3(e){return Ib(this,this,e),this.check()}transformByMatrix2(e){return h4(this,this,e),this.check()}transformByQuaternion(e){return Db(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class Ob extends Kp{toString(){let e="[";if(Ys.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+i]}`}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=` ${this[i]}`}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,r){return this[i*this.RANK+e]=Yi(r),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)i[o]=this[r+o];return i}setColumn(e,i){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)this[r+o]=i[o];return this}}function v4(){const t=new uo(9);return uo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function x4(t,e){if(t===e){const i=e[1],r=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function w4(t,e){const i=e[0],r=e[1],o=e[2],u=e[3],_=e[4],l=e[5],I=e[6],R=e[7],L=e[8],z=L*_-l*R,V=-L*u+l*I,q=R*u-_*I;let ne=i*z+r*V+o*q;return ne?(ne=1/ne,t[0]=z*ne,t[1]=(-L*r+o*R)*ne,t[2]=(l*r-o*_)*ne,t[3]=V*ne,t[4]=(L*i-o*I)*ne,t[5]=(-l*i+o*u)*ne,t[6]=q*ne,t[7]=(-R*i+r*I)*ne,t[8]=(_*i-r*u)*ne,t):null}function T4(t){const e=t[0],i=t[1],r=t[2],o=t[3],u=t[4],_=t[5],l=t[6],I=t[7],R=t[8];return e*(R*u-_*I)+i*(-R*o+_*l)+r*(I*o-u*l)}function Iy(t,e,i){const r=e[0],o=e[1],u=e[2],_=e[3],l=e[4],I=e[5],R=e[6],L=e[7],z=e[8],V=i[0],q=i[1],ne=i[2],Ae=i[3],Ee=i[4],Ce=i[5],Le=i[6],Oe=i[7],Ne=i[8];return t[0]=V*r+q*_+ne*R,t[1]=V*o+q*l+ne*L,t[2]=V*u+q*I+ne*z,t[3]=Ae*r+Ee*_+Ce*R,t[4]=Ae*o+Ee*l+Ce*L,t[5]=Ae*u+Ee*I+Ce*z,t[6]=Le*r+Oe*_+Ne*R,t[7]=Le*o+Oe*l+Ne*L,t[8]=Le*u+Oe*I+Ne*z,t}function E4(t,e,i){const r=e[0],o=e[1],u=e[2],_=e[3],l=e[4],I=e[5],R=e[6],L=e[7],z=e[8],V=i[0],q=i[1];return t[0]=r,t[1]=o,t[2]=u,t[3]=_,t[4]=l,t[5]=I,t[6]=V*r+q*_+R,t[7]=V*o+q*l+L,t[8]=V*u+q*I+z,t}function S4(t,e,i){const r=e[0],o=e[1],u=e[2],_=e[3],l=e[4],I=e[5],R=e[6],L=e[7],z=e[8],V=Math.sin(i),q=Math.cos(i);return t[0]=q*r+V*_,t[1]=q*o+V*l,t[2]=q*u+V*I,t[3]=q*_-V*r,t[4]=q*l-V*o,t[5]=q*I-V*u,t[6]=R,t[7]=L,t[8]=z,t}function My(t,e,i){const r=i[0],o=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=o*e[3],t[4]=o*e[4],t[5]=o*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function C4(t,e){const i=e[0],r=e[1],o=e[2],u=e[3],_=i+i,l=r+r,I=o+o,R=i*_,L=r*_,z=r*l,V=o*_,q=o*l,ne=o*I,Ae=u*_,Ee=u*l,Ce=u*I;return t[0]=1-z-ne,t[3]=L-Ce,t[6]=V+Ee,t[1]=L+Ce,t[4]=1-R-ne,t[7]=q-Ae,t[2]=V-Ee,t[5]=q+Ae,t[8]=1-R-z,t}var ap;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(ap||(ap={}));const P4=Object.freeze([1,0,0,0,1,0,0,0,1]);class gs extends Ob{static get IDENTITY(){return M4()}static get ZERO(){return I4()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return ap}constructor(e,...i){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):i.length>0?this.copy([e,...i]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(P4)}fromObject(e){return this.check()}fromQuaternion(e){return C4(this,e),this.check()}set(e,i,r,o,u,_,l,I,R){return this[0]=e,this[1]=i,this[2]=r,this[3]=o,this[4]=u,this[5]=_,this[6]=l,this[7]=I,this[8]=R,this.check()}setRowMajor(e,i,r,o,u,_,l,I,R){return this[0]=e,this[1]=o,this[2]=l,this[3]=i,this[4]=u,this[5]=I,this[6]=r,this[7]=_,this[8]=R,this.check()}determinant(){return T4(this)}transpose(){return x4(this,this),this.check()}invert(){return w4(this,this),this.check()}multiplyLeft(e){return Iy(this,e,this),this.check()}multiplyRight(e){return Iy(this,this,e),this.check()}rotate(e){return S4(this,this,e),this.check()}scale(e){return Array.isArray(e)?My(this,this,e):My(this,this,[e,e]),this.check()}translate(e){return E4(this,this,e),this.check()}transform(e,i){let r;switch(e.length){case 2:r=o4(i||[-0,-0],e,this);break;case 3:r=kb(i||[-0,-0,-0],e,this);break;case 4:r=Ib(i||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Tu(r,e.length),r}transformVector(e,i){return this.transform(e,i)}transformVector2(e,i){return this.transform(e,i)}transformVector3(e,i){return this.transform(e,i)}}let MA,RA=null;function I4(){return MA||(MA=new gs([0,0,0,0,0,0,0,0,0]),Object.freeze(MA)),MA}function M4(){return RA||(RA=new gs,Object.freeze(RA)),RA}function R4(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function k4(t,e){if(t===e){const i=e[1],r=e[2],o=e[3],u=e[6],_=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=u,t[11]=e[14],t[12]=o,t[13]=_,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function lp(t,e){const i=e[0],r=e[1],o=e[2],u=e[3],_=e[4],l=e[5],I=e[6],R=e[7],L=e[8],z=e[9],V=e[10],q=e[11],ne=e[12],Ae=e[13],Ee=e[14],Ce=e[15],Le=i*l-r*_,Oe=i*I-o*_,Ne=i*R-u*_,Qe=r*I-o*l,Je=r*R-u*l,xt=o*R-u*I,wt=L*Ae-z*ne,ct=L*Ee-V*ne,at=L*Ce-q*ne,Vt=z*Ee-V*Ae,Ot=z*Ce-q*Ae,$t=V*Ce-q*Ee;let qt=Le*$t-Oe*Ot+Ne*Vt+Qe*at-Je*ct+xt*wt;return qt?(qt=1/qt,t[0]=(l*$t-I*Ot+R*Vt)*qt,t[1]=(o*Ot-r*$t-u*Vt)*qt,t[2]=(Ae*xt-Ee*Je+Ce*Qe)*qt,t[3]=(V*Je-z*xt-q*Qe)*qt,t[4]=(I*at-_*$t-R*ct)*qt,t[5]=(i*$t-o*at+u*ct)*qt,t[6]=(Ee*Ne-ne*xt-Ce*Oe)*qt,t[7]=(L*xt-V*Ne+q*Oe)*qt,t[8]=(_*Ot-l*at+R*wt)*qt,t[9]=(r*at-i*Ot-u*wt)*qt,t[10]=(ne*Je-Ae*Ne+Ce*Le)*qt,t[11]=(z*Ne-L*Je-q*Le)*qt,t[12]=(l*ct-_*Vt-I*wt)*qt,t[13]=(i*Vt-r*ct+o*wt)*qt,t[14]=(Ae*Oe-ne*Qe-Ee*Le)*qt,t[15]=(L*Qe-z*Oe+V*Le)*qt,t):null}function D4(t){const e=t[0],i=t[1],r=t[2],o=t[3],u=t[4],_=t[5],l=t[6],I=t[7],R=t[8],L=t[9],z=t[10],V=t[11],q=t[12],ne=t[13],Ae=t[14],Ee=t[15],Ce=e*_-i*u,Le=e*l-r*u,Oe=i*l-r*_,Ne=R*ne-L*q,Qe=R*Ae-z*q,Je=L*Ae-z*ne,xt=e*Je-i*Qe+r*Ne,wt=u*Je-_*Qe+l*Ne,ct=R*Oe-L*Le+z*Ce,at=q*Oe-ne*Le+Ae*Ce;return I*xt-o*wt+Ee*ct-V*at}function ec(t,e,i){const r=e[0],o=e[1],u=e[2],_=e[3],l=e[4],I=e[5],R=e[6],L=e[7],z=e[8],V=e[9],q=e[10],ne=e[11],Ae=e[12],Ee=e[13],Ce=e[14],Le=e[15];let Oe=i[0],Ne=i[1],Qe=i[2],Je=i[3];return t[0]=Oe*r+Ne*l+Qe*z+Je*Ae,t[1]=Oe*o+Ne*I+Qe*V+Je*Ee,t[2]=Oe*u+Ne*R+Qe*q+Je*Ce,t[3]=Oe*_+Ne*L+Qe*ne+Je*Le,Oe=i[4],Ne=i[5],Qe=i[6],Je=i[7],t[4]=Oe*r+Ne*l+Qe*z+Je*Ae,t[5]=Oe*o+Ne*I+Qe*V+Je*Ee,t[6]=Oe*u+Ne*R+Qe*q+Je*Ce,t[7]=Oe*_+Ne*L+Qe*ne+Je*Le,Oe=i[8],Ne=i[9],Qe=i[10],Je=i[11],t[8]=Oe*r+Ne*l+Qe*z+Je*Ae,t[9]=Oe*o+Ne*I+Qe*V+Je*Ee,t[10]=Oe*u+Ne*R+Qe*q+Je*Ce,t[11]=Oe*_+Ne*L+Qe*ne+Je*Le,Oe=i[12],Ne=i[13],Qe=i[14],Je=i[15],t[12]=Oe*r+Ne*l+Qe*z+Je*Ae,t[13]=Oe*o+Ne*I+Qe*V+Je*Ee,t[14]=Oe*u+Ne*R+Qe*q+Je*Ce,t[15]=Oe*_+Ne*L+Qe*ne+Je*Le,t}function Sf(t,e,i){const r=i[0],o=i[1],u=i[2];let _,l,I,R,L,z,V,q,ne,Ae,Ee,Ce;return e===t?(t[12]=e[0]*r+e[4]*o+e[8]*u+e[12],t[13]=e[1]*r+e[5]*o+e[9]*u+e[13],t[14]=e[2]*r+e[6]*o+e[10]*u+e[14],t[15]=e[3]*r+e[7]*o+e[11]*u+e[15]):(_=e[0],l=e[1],I=e[2],R=e[3],L=e[4],z=e[5],V=e[6],q=e[7],ne=e[8],Ae=e[9],Ee=e[10],Ce=e[11],t[0]=_,t[1]=l,t[2]=I,t[3]=R,t[4]=L,t[5]=z,t[6]=V,t[7]=q,t[8]=ne,t[9]=Ae,t[10]=Ee,t[11]=Ce,t[12]=_*r+L*o+ne*u+e[12],t[13]=l*r+z*o+Ae*u+e[13],t[14]=I*r+V*o+Ee*u+e[14],t[15]=R*r+q*o+Ce*u+e[15]),t}function tg(t,e,i){const r=i[0],o=i[1],u=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function B4(t,e,i,r){let o=r[0],u=r[1],_=r[2],l=Math.sqrt(o*o+u*u+_*_),I,R,L,z,V,q,ne,Ae,Ee,Ce,Le,Oe,Ne,Qe,Je,xt,wt,ct,at,Vt,Ot,$t,qt,gi;return l<Eu?null:(l=1/l,o*=l,u*=l,_*=l,R=Math.sin(i),I=Math.cos(i),L=1-I,z=e[0],V=e[1],q=e[2],ne=e[3],Ae=e[4],Ee=e[5],Ce=e[6],Le=e[7],Oe=e[8],Ne=e[9],Qe=e[10],Je=e[11],xt=o*o*L+I,wt=u*o*L+_*R,ct=_*o*L-u*R,at=o*u*L-_*R,Vt=u*u*L+I,Ot=_*u*L+o*R,$t=o*_*L+u*R,qt=u*_*L-o*R,gi=_*_*L+I,t[0]=z*xt+Ae*wt+Oe*ct,t[1]=V*xt+Ee*wt+Ne*ct,t[2]=q*xt+Ce*wt+Qe*ct,t[3]=ne*xt+Le*wt+Je*ct,t[4]=z*at+Ae*Vt+Oe*Ot,t[5]=V*at+Ee*Vt+Ne*Ot,t[6]=q*at+Ce*Vt+Qe*Ot,t[7]=ne*at+Le*Vt+Je*Ot,t[8]=z*$t+Ae*qt+Oe*gi,t[9]=V*$t+Ee*qt+Ne*gi,t[10]=q*$t+Ce*qt+Qe*gi,t[11]=ne*$t+Le*qt+Je*gi,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Lb(t,e,i){const r=Math.sin(i),o=Math.cos(i),u=e[4],_=e[5],l=e[6],I=e[7],R=e[8],L=e[9],z=e[10],V=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*o+R*r,t[5]=_*o+L*r,t[6]=l*o+z*r,t[7]=I*o+V*r,t[8]=R*o-u*r,t[9]=L*o-_*r,t[10]=z*o-l*r,t[11]=V*o-I*r,t}function F4(t,e,i){const r=Math.sin(i),o=Math.cos(i),u=e[0],_=e[1],l=e[2],I=e[3],R=e[8],L=e[9],z=e[10],V=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*o-R*r,t[1]=_*o-L*r,t[2]=l*o-z*r,t[3]=I*o-V*r,t[8]=u*r+R*o,t[9]=_*r+L*o,t[10]=l*r+z*o,t[11]=I*r+V*o,t}function Nb(t,e,i){const r=Math.sin(i),o=Math.cos(i),u=e[0],_=e[1],l=e[2],I=e[3],R=e[4],L=e[5],z=e[6],V=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*o+R*r,t[1]=_*o+L*r,t[2]=l*o+z*r,t[3]=I*o+V*r,t[4]=R*o-u*r,t[5]=L*o-_*r,t[6]=z*o-l*r,t[7]=V*o-I*r,t}function O4(t,e){const i=e[0],r=e[1],o=e[2],u=e[4],_=e[5],l=e[6],I=e[8],R=e[9],L=e[10];return t[0]=Math.sqrt(i*i+r*r+o*o),t[1]=Math.sqrt(u*u+_*_+l*l),t[2]=Math.sqrt(I*I+R*R+L*L),t}function L4(t,e){const i=e[0],r=e[1],o=e[2],u=e[3],_=i+i,l=r+r,I=o+o,R=i*_,L=r*_,z=r*l,V=o*_,q=o*l,ne=o*I,Ae=u*_,Ee=u*l,Ce=u*I;return t[0]=1-z-ne,t[1]=L+Ce,t[2]=V-Ee,t[3]=0,t[4]=L-Ce,t[5]=1-R-ne,t[6]=q+Ae,t[7]=0,t[8]=V+Ee,t[9]=q-Ae,t[10]=1-R-z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function N4(t,e,i,r,o,u,_){const l=1/(i-e),I=1/(o-r),R=1/(u-_);return t[0]=u*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u*2*I,t[6]=0,t[7]=0,t[8]=(i+e)*l,t[9]=(o+r)*I,t[10]=(_+u)*R,t[11]=-1,t[12]=0,t[13]=0,t[14]=_*u*2*R,t[15]=0,t}function z4(t,e,i,r,o){const u=1/Math.tan(e/2);if(t[0]=u/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){const _=1/(r-o);t[10]=(o+r)*_,t[14]=2*o*r*_}else t[10]=-1,t[14]=-2*r;return t}const U4=z4;function V4(t,e,i,r,o,u,_){const l=1/(e-i),I=1/(r-o),R=1/(u-_);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*I,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*R,t[11]=0,t[12]=(e+i)*l,t[13]=(o+r)*I,t[14]=(_+u)*R,t[15]=1,t}const j4=V4;function $4(t,e,i,r){let o,u,_,l,I,R,L,z,V,q;const ne=e[0],Ae=e[1],Ee=e[2],Ce=r[0],Le=r[1],Oe=r[2],Ne=i[0],Qe=i[1],Je=i[2];return Math.abs(ne-Ne)<Eu&&Math.abs(Ae-Qe)<Eu&&Math.abs(Ee-Je)<Eu?R4(t):(z=ne-Ne,V=Ae-Qe,q=Ee-Je,o=1/Math.sqrt(z*z+V*V+q*q),z*=o,V*=o,q*=o,u=Le*q-Oe*V,_=Oe*z-Ce*q,l=Ce*V-Le*z,o=Math.sqrt(u*u+_*_+l*l),o?(o=1/o,u*=o,_*=o,l*=o):(u=0,_=0,l=0),I=V*l-q*_,R=q*u-z*l,L=z*_-V*u,o=Math.sqrt(I*I+R*R+L*L),o?(o=1/o,I*=o,R*=o,L*=o):(I=0,R=0,L=0),t[0]=u,t[1]=I,t[2]=z,t[3]=0,t[4]=_,t[5]=R,t[6]=V,t[7]=0,t[8]=l,t[9]=L,t[10]=q,t[11]=0,t[12]=-(u*ne+_*Ae+l*Ee),t[13]=-(I*ne+R*Ae+L*Ee),t[14]=-(z*ne+V*Ae+q*Ee),t[15]=1,t)}function W4(){const t=new uo(4);return uo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function H4(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function ig(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function q4(t){const e=t[0],i=t[1],r=t[2],o=t[3];return Math.sqrt(e*e+i*i+r*r+o*o)}function X4(t){const e=t[0],i=t[1],r=t[2],o=t[3];return e*e+i*i+r*r+o*o}function Z4(t,e){const i=e[0],r=e[1],o=e[2],u=e[3];let _=i*i+r*r+o*o+u*u;return _>0&&(_=1/Math.sqrt(_)),t[0]=i*_,t[1]=r*_,t[2]=o*_,t[3]=u*_,t}function Y4(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function G4(t,e,i,r){const o=e[0],u=e[1],_=e[2],l=e[3];return t[0]=o+r*(i[0]-o),t[1]=u+r*(i[1]-u),t[2]=_+r*(i[2]-_),t[3]=l+r*(i[3]-l),t}function Ih(t,e,i){const r=e[0],o=e[1],u=e[2],_=e[3];return t[0]=i[0]*r+i[4]*o+i[8]*u+i[12]*_,t[1]=i[1]*r+i[5]*o+i[9]*u+i[13]*_,t[2]=i[2]*r+i[6]*o+i[10]*u+i[14]*_,t[3]=i[3]*r+i[7]*o+i[11]*u+i[15]*_,t}function Q4(t,e,i){const r=e[0],o=e[1],u=e[2],_=i[0],l=i[1],I=i[2],R=i[3],L=R*r+l*u-I*o,z=R*o+I*r-_*u,V=R*u+_*o-l*r,q=-_*r-l*o-I*u;return t[0]=L*R+q*-_+z*-I-V*-l,t[1]=z*R+q*-l+V*-_-L*-I,t[2]=V*R+q*-I+L*-l-z*-_,t[3]=e[3],t}(function(){const t=W4();return function(e,i,r,o,u,_){let l,I;for(i||(i=4),r||(r=0),o?I=Math.min(o*i+r,e.length):I=e.length,l=r;l<I;l+=i)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],u(t,t,_),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var cp;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(cp||(cp={}));const K4=45*Math.PI/180,J4=1,p0=.1,g0=500,eI=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Gs extends Ob{static get IDENTITY(){return iI()}static get ZERO(){return tI()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return cp}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,r,o,u,_,l,I,R,L,z,V,q,ne,Ae,Ee){return this[0]=e,this[1]=i,this[2]=r,this[3]=o,this[4]=u,this[5]=_,this[6]=l,this[7]=I,this[8]=R,this[9]=L,this[10]=z,this[11]=V,this[12]=q,this[13]=ne,this[14]=Ae,this[15]=Ee,this.check()}setRowMajor(e,i,r,o,u,_,l,I,R,L,z,V,q,ne,Ae,Ee){return this[0]=e,this[1]=u,this[2]=R,this[3]=q,this[4]=i,this[5]=_,this[6]=L,this[7]=ne,this[8]=r,this[9]=l,this[10]=z,this[11]=Ae,this[12]=o,this[13]=I,this[14]=V,this[15]=Ee,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(eI)}fromObject(e){return this.check()}fromQuaternion(e){return L4(this,e),this.check()}frustum(e){const{left:i,right:r,bottom:o,top:u,near:_=p0,far:l=g0}=e;return l===1/0?rI(this,i,r,o,u,_):N4(this,i,r,o,u,_,l),this.check()}lookAt(e){const{eye:i,center:r=[0,0,0],up:o=[0,1,0]}=e;return $4(this,i,r,o),this.check()}ortho(e){const{left:i,right:r,bottom:o,top:u,near:_=p0,far:l=g0}=e;return j4(this,i,r,o,u,_,l),this.check()}orthographic(e){const{fovy:i=K4,aspect:r=J4,focalDistance:o=1,near:u=p0,far:_=g0}=e;Ry(i);const l=i/2,I=o*Math.tan(l),R=I*r;return this.ortho({left:-R,right:R,bottom:-I,top:I,near:u,far:_})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:r=1,near:o=.1,far:u=500}=e;return Ry(i),U4(this,i,r,o,u),this.check()}determinant(){return D4(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),o=1/r[0],u=1/r[1],_=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*u,e[2]=this[2]*_,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*u,e[6]=this[6]*_,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*u,e[10]=this[10]*_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),o=1/r[0],u=1/r[1],_=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*u,e[2]=this[2]*_,e[3]=this[4]*o,e[4]=this[5]*u,e[5]=this[6]*_,e[6]=this[8]*o,e[7]=this[9]*u,e[8]=this[10]*_,e}transpose(){return k4(this,this),this.check()}invert(){return lp(this,this),this.check()}multiplyLeft(e){return ec(this,e,this),this.check()}multiplyRight(e){return ec(this,this,e),this.check()}rotateX(e){return Lb(this,this,e),this.check()}rotateY(e){return F4(this,this,e),this.check()}rotateZ(e){return Nb(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return B4(this,this,e,i),this.check()}scale(e){return tg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Sf(this,this,e),this.check()}transform(e,i){return e.length===4?(i=Ih(i||[-0,-0,-0,-0],e,this),Tu(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:r}=e;let o;switch(r){case 2:o=a4(i||[-0,-0],e,this);break;case 3:o=Jp(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Tu(o,e.length),o}transformAsVector(e,i){let r;switch(e.length){case 2:r=l4(i||[-0,-0],e,this);break;case 3:r=Pb(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Tu(r,e.length),r}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,r){return this.identity().translate([e,i,r])}}let kA,DA;function tI(){return kA||(kA=new Gs([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(kA)),kA}function iI(){return DA||(DA=new Gs,Object.freeze(DA)),DA}function Ry(t){if(t>Math.PI*2)throw Error("expected radians")}function rI(t,e,i,r,o,u){const _=2*u/(i-e),l=2*u/(o-r),I=(i+e)/(i-e),R=(o+r)/(o-r),L=-1,z=-1,V=-2*u;return t[0]=_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=I,t[9]=R,t[10]=L,t[11]=z,t[12]=0,t[13]=0,t[14]=V,t[15]=0,t}function ky(){const t=new uo(4);return uo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function sI(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function zb(t,e,i){i=i*.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function Dy(t,e,i){const r=e[0],o=e[1],u=e[2],_=e[3],l=i[0],I=i[1],R=i[2],L=i[3];return t[0]=r*L+_*l+o*R-u*I,t[1]=o*L+_*I+u*l-r*R,t[2]=u*L+_*R+r*I-o*l,t[3]=_*L-r*l-o*I-u*R,t}function nI(t,e,i){i*=.5;const r=e[0],o=e[1],u=e[2],_=e[3],l=Math.sin(i),I=Math.cos(i);return t[0]=r*I+_*l,t[1]=o*I+u*l,t[2]=u*I-o*l,t[3]=_*I-r*l,t}function oI(t,e,i){i*=.5;const r=e[0],o=e[1],u=e[2],_=e[3],l=Math.sin(i),I=Math.cos(i);return t[0]=r*I-u*l,t[1]=o*I+_*l,t[2]=u*I+r*l,t[3]=_*I-o*l,t}function aI(t,e,i){i*=.5;const r=e[0],o=e[1],u=e[2],_=e[3],l=Math.sin(i),I=Math.cos(i);return t[0]=r*I+o*l,t[1]=o*I-r*l,t[2]=u*I+_*l,t[3]=_*I-u*l,t}function lI(t,e){const i=e[0],r=e[1],o=e[2];return t[0]=i,t[1]=r,t[2]=o,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-o*o)),t}function rf(t,e,i,r){const o=e[0],u=e[1],_=e[2],l=e[3];let I=i[0],R=i[1],L=i[2],z=i[3],V,q,ne,Ae,Ee;return V=o*I+u*R+_*L+l*z,V<0&&(V=-V,I=-I,R=-R,L=-L,z=-z),1-V>Eu?(q=Math.acos(V),Ee=Math.sin(q),ne=Math.sin((1-r)*q)/Ee,Ae=Math.sin(r*q)/Ee):(ne=1-r,Ae=r),t[0]=ne*o+Ae*I,t[1]=ne*u+Ae*R,t[2]=ne*_+Ae*L,t[3]=ne*l+Ae*z,t}function cI(t,e){const i=e[0],r=e[1],o=e[2],u=e[3],_=i*i+r*r+o*o+u*u,l=_?1/_:0;return t[0]=-i*l,t[1]=-r*l,t[2]=-o*l,t[3]=u*l,t}function hI(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Ub(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let o=0;e[4]>e[0]&&(o=1),e[8]>e[o*3+o]&&(o=2);const u=(o+1)%3,_=(o+2)%3;r=Math.sqrt(e[o*3+o]-e[u*3+u]-e[_*3+_]+1),t[o]=.5*r,r=.5/r,t[3]=(e[u*3+_]-e[_*3+u])*r,t[u]=(e[u*3+o]+e[o*3+u])*r,t[_]=(e[_*3+o]+e[o*3+_])*r}return t}const uI=H4,AI=ig,fI=Y4,dI=G4,pI=q4,gI=X4,Vb=Z4,_I=function(){const t=Mb(),e=Py(1,0,0),i=Py(0,1,0);return function(r,o,u){const _=Rb(o,u);return _<-.999999?(tf(t,e,o),Fb(t)<1e-6&&tf(t,i,o),p4(t,t),zb(r,t,Math.PI),r):_>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(tf(t,o,u),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+_,Vb(r,r))}}();(function(){const t=ky(),e=ky();return function(i,r,o,u,_,l){return rf(t,r,_,l),rf(e,o,u,l),rf(i,t,e,2*l*(1-l)),i}})();(function(){const t=v4();return function(e,i,r,o){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=o[0],t[4]=o[1],t[7]=o[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],Vb(e,Ub(e,t))}})();const mI=[0,0,0,1];class By extends Kp{constructor(e=0,i=0,r=0,o=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,i,r,o)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,i,r,o){return this[0]=e,this[1]=i,this[2]=r,this[3]=o,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Ub(this,e),this.check()}fromAxisRotation(e,i){return zb(this,e,i),this.check()}identity(){return sI(this),this.check()}setAxisAngle(e,i){return this.fromAxisRotation(e,i)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Yi(e)}get y(){return this[1]}set y(e){this[1]=Yi(e)}get z(){return this[2]}set z(e){this[2]=Yi(e)}get w(){return this[3]}set w(e){this[3]=Yi(e)}len(){return pI(this)}lengthSquared(){return gI(this)}dot(e){return fI(this,e)}rotationTo(e,i){return _I(this,e,i),this.check()}add(e){return uI(this,this,e),this.check()}calculateW(){return lI(this,this),this.check()}conjugate(){return hI(this,this),this.check()}invert(){return cI(this,this),this.check()}lerp(e,i,r){return r===void 0?this.lerp(this,e,i):(dI(this,e,i,r),this.check())}multiplyRight(e){return Dy(this,this,e),this.check()}multiplyLeft(e){return Dy(this,e,this),this.check()}normalize(){const e=this.len(),i=e>0?1/e:0;return this[0]=this[0]*i,this[1]=this[1]*i,this[2]=this[2]*i,this[3]=this[3]*i,e===0&&(this[3]=1),this.check()}rotateX(e){return nI(this,this,e),this.check()}rotateY(e){return oI(this,this,e),this.check()}rotateZ(e){return aI(this,this,e),this.check()}scale(e){return AI(this,this,e),this.check()}slerp(e,i,r){let o,u,_;switch(arguments.length){case 1:({start:o=mI,target:u,ratio:_}=e);break;case 2:o=this,u=e,_=i;break;default:o=e,u=i,_=r}return rf(this,o,u,_),this.check()}transformVector4(e,i=new eg){return Q4(i,e,this),Tu(i,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,i){return this.setAxisAngle(e,i)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const yI=1e-15,bI=1e-20,Fy=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,vI={lightSources:{}};function _0(t={}){const{color:e=[0,0,0],intensity:i=1}=t;return e.map(r=>r*i/255)}function xI({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const r={};return t?r["lighting_uAmbientLight.color"]=_0(t):r["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((o,u)=>{r[`lighting_uPointLight[${u}].color`]=_0(o),r[`lighting_uPointLight[${u}].position`]=o.position,r[`lighting_uPointLight[${u}].attenuation`]=o.attenuation||[1,0,0]}),r.lighting_uPointLightCount=e.length,i.forEach((o,u)=>{r[`lighting_uDirectionalLight[${u}].color`]=_0(o),r[`lighting_uDirectionalLight[${u}].direction`]=o.direction}),r.lighting_uDirectionalLightCount=i.length,r}function jb(t=vI){var e,i;if("lightSources"in t){const{ambientLight:r,pointLights:o,directionalLights:u}=t.lightSources||{};return r||o&&o.length>0||u&&u.length>0?Object.assign({},xI({ambientLight:r,pointLights:o,directionalLights:u}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const r={pointLights:[],directionalLights:[]};for(const o of t.lights||[])switch(o.type){case"ambient":r.ambientLight=o;break;case"directional":(e=r.directionalLights)==null||e.push(o);break;case"point":(i=r.pointLights)==null||i.push(o);break}return jb({lightSources:r})}return{}}const $b={name:"lights",vs:Fy,fs:Fy,getUniforms:jb,defines:{MAX_LIGHTS:3}},Wb=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,wI={};function TI(t){const{ambient:e=.35,diffuse:i=.6,shininess:r=32,specularColor:o=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:r,lighting_uSpecularColor:o.map(u=>u/255)}}function Hb(t=wI){if(!("material"in t))return{};const{material:e}=t;return e?TI(e):{lighting_uEnabled:!1}}const qb={name:"gouraud-lighting",dependencies:[$b],vs:Wb,defines:{LIGHTING_VERTEX:1},getUniforms:Hb},EI={name:"phong-lighting",dependencies:[$b],fs:Wb,defines:{LIGHTING_FRAGMENT:1},getUniforms:Hb},Xb="#define SMOOTH_EDGE_RADIUS 0.5",SI=`
${Xb}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,CI=`
${Xb}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,PI={name:"geometry",vs:SI,fs:CI},Ri={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ri,"IDENTITY",{get:()=>(mi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const lo={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ta={common:0,meters:1,pixels:2},hp={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},II=Object.keys(Ri).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Ri[t]};`).join(""),MI=Object.keys(lo).map(t=>`const int PROJECTION_MODE_${t} = ${lo[t]};`).join(""),RI=Object.keys(Ta).map(t=>`const int UNIT_${t.toUpperCase()} = ${Ta[t]};`).join(""),kI=`${II}
${MI}
${RI}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function DI(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Ku(t){let e={},i;return r=>{for(const o in r)if(!DI(r[o],e[o])){i=t(r),e=r;break}return i}}const Oy=[0,0,0,0],BI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Zb=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],FI=[0,0,0],Yb=[0,0,0],OI=Ku(zI);function Gb(t,e,i=Yb){i.length<3&&(i=[i[0],i[1],0]);let r=i,o,u=!0;switch(e===Ri.LNGLAT_OFFSETS||e===Ri.METER_OFFSETS?o=i:o=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case lo.WEB_MERCATOR:(e===Ri.LNGLAT||e===Ri.CARTESIAN)&&(o=[0,0,0],u=!1);break;case lo.WEB_MERCATOR_AUTO_OFFSET:e===Ri.LNGLAT?r=o:e===Ri.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],o=t.unprojectPosition(r),r[0]-=i[0],r[1]-=i[1],r[2]-=i[2]);break;case lo.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case lo.GLOBE:u=!1,o=null;break;default:u=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:r,offsetMode:u}}function LI(t,e,i){const{viewMatrixUncentered:r,projectionMatrix:o}=t;let{viewMatrix:u,viewProjectionMatrix:_}=t,l=Oy,I=Oy,R=t.cameraPosition;const{geospatialOrigin:L,shaderCoordinateOrigin:z,offsetMode:V}=Gb(t,e,i);return V&&(I=t.projectPosition(L||z),R=[R[0]-I[0],R[1]-I[1],R[2]-I[2]],I[3]=1,l=Ih([],I,_),u=r||u,_=ec([],o,u),_=ec([],_,BI)),{viewMatrix:u,viewProjectionMatrix:_,projectionCenter:l,originCommon:I,cameraPosCommon:R,shaderCoordinateOrigin:z,geospatialOrigin:L}}function NI({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:r=Ri.DEFAULT,coordinateOrigin:o=Yb,autoWrapLongitude:u=!1}){r===Ri.DEFAULT&&(r=t.isGeospatial?Ri.LNGLAT:Ri.CARTESIAN);const _=OI({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:o});return _.project_uWrapLongitude=u,_.project_uModelMatrix=i||Zb,_}function zI({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r}){const{projectionCenter:o,viewProjectionMatrix:u,originCommon:_,cameraPosCommon:l,shaderCoordinateOrigin:I,geospatialOrigin:R}=LI(t,i,r),L=t.getDistanceScales(),z=[t.width*e,t.height*e],V=Ih([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,q={project_uCoordinateSystem:i,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:I,project_uCommonOrigin:_.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:z,project_uDevicePixelRatio:e,project_uFocalDistance:V,project_uCommonUnitsPerMeter:L.unitsPerMeter,project_uCommonUnitsPerWorldUnit:L.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:FI,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:u,project_uModelMatrix:Zb,project_uCameraPosition:l};if(R){const ne=t.getDistanceScales(R);switch(i){case Ri.METER_OFFSETS:q.project_uCommonUnitsPerWorldUnit=ne.unitsPerMeter,q.project_uCommonUnitsPerWorldUnit2=ne.unitsPerMeter2;break;case Ri.LNGLAT:case Ri.LNGLAT_OFFSETS:t._pseudoMeters||(q.project_uCommonUnitsPerMeter=ne.unitsPerMeter),q.project_uCommonUnitsPerWorldUnit=ne.unitsPerDegree,q.project_uCommonUnitsPerWorldUnit2=ne.unitsPerDegree2;break;case Ri.CARTESIAN:q.project_uCommonUnitsPerWorldUnit=[1,1,ne.unitsPerMeter[2]],q.project_uCommonUnitsPerWorldUnit2=[0,0,ne.unitsPerMeter2[2]];break}}return q}const UI={};function VI(t=UI){return"viewport"in t?NI(t):{}}const rg={name:"project",dependencies:[VP,PI],vs:kI,getUniforms:VI},jI=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Mh={name:"project32",dependencies:[rg],vs:jI};function $I(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function _h(t,e){const i=Ih([],e,t);return ig(i,i,1/i[3]),i}function Ly(t,e){const i=t%e;return i<0?e+i:i}function up(t,e,i){return t<e?e:t>i?i:t}function WI(t){return Math.log(t)*Math.LOG2E}const sg=Math.log2||WI;function Ea(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const co=Math.PI,Qb=co/4,Hn=co/180,Ap=180/co,Eh=512,Cf=4003e4,BA=85.051129,HI=1.5;function qI(t){return sg(t)}function Sh(t){const[e,i]=t;Ea(Number.isFinite(e)),Ea(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const r=e*Hn,o=i*Hn,u=Eh*(r+co)/(2*co),_=Eh*(co+Math.log(Math.tan(Qb+o*.5)))/(2*co);return[u,_]}function Ch(t){const[e,i]=t,r=e/Eh*(2*co)-co,o=2*(Math.atan(Math.exp(i/Eh*(2*co)-co))-Qb);return[r*Ap,o*Ap]}function XI(t){const{latitude:e}=t;Ea(Number.isFinite(e));const i=Math.cos(e*Hn);return qI(Cf*i)-9}function m0(t){const e=Math.cos(t*Hn);return Eh/Cf/e}function fp(t){const{latitude:e,longitude:i,highPrecision:r=!1}=t;Ea(Number.isFinite(e)&&Number.isFinite(i));const o=Eh,u=Math.cos(e*Hn),_=o/360,l=_/u,I=o/Cf/u,R={unitsPerMeter:[I,I,I],metersPerUnit:[1/I,1/I,1/I],unitsPerDegree:[_,l,I],degreesPerUnit:[1/_,1/l,1/I]};if(r){const L=Hn*Math.tan(e*Hn)/u,z=_*L/2,V=o/Cf*L,q=V/l*I;R.unitsPerDegree2=[0,z,V],R.unitsPerMeter2=[q,0,q]}return R}function Kb(t,e){const[i,r,o]=t,[u,_,l]=e,{unitsPerMeter:I,unitsPerMeter2:R}=fp({longitude:i,latitude:r,highPrecision:!0}),L=Sh(t);L[0]+=u*(I[0]+R[0]*_),L[1]+=_*(I[1]+R[1]*_);const z=Ch(L),V=(o||0)+(l||0);return Number.isFinite(o)||Number.isFinite(l)?[z[0],z[1],V]:z}function ZI(t){const{height:e,pitch:i,bearing:r,altitude:o,scale:u,center:_}=t,l=$I();Sf(l,l,[0,0,-o]),Lb(l,l,-i*Hn),Nb(l,l,r*Hn);const I=u/e;return tg(l,l,[I,I,I]),_&&Sf(l,l,d4([],_)),l}function YI(t){const{width:e,height:i,altitude:r,pitch:o=0,offset:u,center:_,scale:l,nearZMultiplier:I=1,farZMultiplier:R=1}=t;let{fovy:L=Pf(HI)}=t;r!==void 0&&(L=Pf(r));const z=L*Hn,V=o*Hn,q=Jb(L);let ne=q;_&&(ne+=_[2]*l/Math.cos(V)/i);const Ae=z*(.5+(u?u[1]:0)/i),Ee=Math.sin(Ae)*ne/Math.sin(up(Math.PI/2-V-Ae,.01,Math.PI-.01)),Ce=Math.sin(V)*Ee+ne,Le=ne*10,Oe=Math.min(Ce*R,Le);return{fov:z,aspect:e/i,focalDistance:q,near:I,far:Oe}}function Pf(t){return 2*Math.atan(.5/t)*Ap}function Jb(t){return .5/Math.tan(.5*t*Hn)}function ev(t,e){const[i,r,o=0]=t;return Ea(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(o)),_h(e,[i,r,o,1])}function ng(t,e,i=0){const[r,o,u]=t;if(Ea(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u))return _h(e,[r,o,u,1]);const _=_h(e,[r,o,0,1]),l=_h(e,[r,o,1,1]),I=_[2],R=l[2],L=I===R?0:((i||0)-I)/(R-I);return Cb([],_,l,L)}function GI(t){const{width:e,height:i,bounds:r,minExtent:o=0,maxZoom:u=24,offset:_=[0,0]}=t,[[l,I],[R,L]]=r,z=QI(t.padding),V=Sh([l,up(L,-BA,BA)]),q=Sh([R,up(I,-BA,BA)]),ne=[Math.max(Math.abs(q[0]-V[0]),o),Math.max(Math.abs(q[1]-V[1]),o)],Ae=[e-z.left-z.right-Math.abs(_[0])*2,i-z.top-z.bottom-Math.abs(_[1])*2];Ea(Ae[0]>0&&Ae[1]>0);const Ee=Ae[0]/ne[0],Ce=Ae[1]/ne[1],Le=(z.right-z.left)/2/Ee,Oe=(z.top-z.bottom)/2/Ce,Ne=[(q[0]+V[0])/2+Le,(q[1]+V[1])/2+Oe],Qe=Ch(Ne),Je=Math.min(u,sg(Math.abs(Math.min(Ee,Ce))));return Ea(Number.isFinite(Je)),{longitude:Qe[0],latitude:Qe[1],zoom:Je}}function QI(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Ea(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Ny=Math.PI/180;function KI(t,e=0){const{width:i,height:r,unproject:o}=t,u={targetZ:e},_=o([0,r],u),l=o([i,r],u);let I,R;const L=t.fovy?.5*t.fovy*Ny:Math.atan(.5/t.altitude),z=(90-t.pitch)*Ny;return L>z-.01?(I=zy(t,0,e),R=zy(t,i,e)):(I=o([0,0],u),R=o([i,0],u)),[_,l,R,I]}function zy(t,e,i){const{pixelUnprojectionMatrix:r}=t,o=_h(r,[e,0,1,1]),u=_h(r,[e,t.height,1,1]),l=(i*t.distanceScales.unitsPerMeter[2]-o[2])/(u[2]-o[2]),I=Cb([],o,u,l),R=Ch(I);return R.push(i),R}const Uy=512;function JI(t){const{width:e,height:i,pitch:r=0}=t;let{longitude:o,latitude:u,zoom:_,bearing:l=0}=t;(o<-180||o>180)&&(o=Ly(o+180,360)-180),(l<-180||l>180)&&(l=Ly(l+180,360)-180);const I=sg(i/Uy);if(_<=I)_=I,u=0;else{const R=i/2/Math.pow(2,_),L=Ch([0,R])[1];if(u<L)u=L;else{const z=Ch([0,Uy-R])[1];u>z&&(u=z)}}return{width:e,height:i,longitude:o,latitude:u,zoom:_,pitch:r,bearing:l}}const eM=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,tM=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,iM=Ku(aM),rM=Ku(lM),sM=[0,0,0,1],nM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function oM(t,e){const[i,r,o]=t,u=ng([i,r,o],e);return Number.isFinite(o)?u:[u[0],u[1],0]}function aM({viewport:t,center:e}){return new Gs(t.viewProjectionMatrix).invert().transform(e)}function lM({viewport:t,shadowMatrices:e}){const i=[],r=t.pixelUnprojectionMatrix,o=t.isGeospatial?void 0:1,u=[[0,0,o],[t.width,0,o],[0,t.height,o],[t.width,t.height,o],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(_=>oM(_,r));for(const _ of e){const l=_.clone().translate(new Ft(t.center).negate()),I=u.map(L=>l.transform(L)),R=new Gs().ortho({left:Math.min(...I.map(L=>L[0])),right:Math.max(...I.map(L=>L[0])),bottom:Math.min(...I.map(L=>L[1])),top:Math.max(...I.map(L=>L[1])),near:Math.min(...I.map(L=>-L[2])),far:Math.max(...I.map(L=>-L[2]))});i.push(R.multiplyRight(_))}return i}function cM(t,e){const{shadowEnabled:i=!0}=t;if(!i||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||sM,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},o=iM({viewport:t.viewport,center:e.project_uCenter}),u=[],_=rM({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const I=_[l],R=I.clone().translate(new Ft(t.viewport.center).negate());e.project_uCoordinateSystem===Ri.LNGLAT&&e.project_uProjectionMode===lo.WEB_MERCATOR?(_[l]=R,u[l]=o):(_[l]=I.clone().multiplyRight(nM),u[l]=R.transform(o))}for(let l=0;l<_.length;l++)r[`shadow_uViewProjectionMatrices[${l}]`]=_[l],r[`shadow_uProjectCenters[${l}]`]=u[l];for(let l=0;l<2;l++)r[`shadow_uShadowMap${l}`]=t.shadowMaps&&t.shadowMaps[l]||t.dummyShadowMap;return r}const Vy={name:"shadow",dependencies:[rg],vs:eM,fs:tM,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?cM(t,e):{}},Rh={...Sy,defaultUniforms:{...Sy.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},hM=[rg],uM=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function AM(){const t=_f.getDefaultShaderAssembler();for(const e of hM)t.addDefaultModule(e);for(const e of uM)t.addShaderHook(e);return t}const fM=[255,255,255],dM=1;let pM=0;class gM{constructor(e={}){this.type="ambient";const{color:i=fM}=e,{intensity:r=dM}=e;this.id=e.id||`ambient-${pM++}`,this.color=i,this.intensity=r}}const _M=[255,255,255],mM=1,yM=[0,0,-1];let bM=0;class jy{constructor(e={}){this.type="directional";const{color:i=_M}=e,{intensity:r=mM}=e,{direction:o=yM}=e,{_shadow:u=!1}=e;this.id=e.id||`directional-${bM++}`,this.color=i,this.intensity=r,this.type="directional",this.direction=new Ft(o).normalize().toArray(),this.shadow=u}getProjectedLight(e){return this}}class vM{constructor(e,i={id:"pass"}){const{id:r}=i;this.id=r,this.device=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class og extends vM{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[i,r]=this.device.canvasContext.getDrawingBufferSize(),o=e.clearCanvas??!0,u=e.clearColor??(o?[0,0,0,0]:!1),_=o?1:!1,l=o?0:!1,I=e.colorMask??15,R={viewport:[0,0,i,r]};e.colorMask&&(R.colorMask=I),e.scissorRect&&(R.scissorRect=e.scissorRect);const L=this.device.beginRenderPass({framebuffer:e.target,parameters:R,clearColor:u,clearDepth:_,clearStencil:l});try{return this._drawLayers(L,e)}finally{L.end()}}_drawLayers(e,i){const{target:r,moduleParameters:o,viewports:u,views:_,onViewportActive:l,clearStack:I=!0}=i;i.pass=i.pass||"unknown",I&&(this._lastRenderIndex=-1);const R=[];for(const L of u){const z=_&&_[L.id];l==null||l(L);const V=this._getDrawLayerParams(L,i),q=L.subViewports||[L];for(const ne of q){const Ae=this._drawLayersInViewport(e,{target:r,moduleParameters:o,viewport:ne,view:z,pass:i.pass,layers:i.layers},V);R.push(Ae)}}return R}_getDrawLayerParams(e,{layers:i,pass:r,isPicking:o=!1,layerFilter:u,cullRect:_,effects:l,moduleParameters:I},R=!1){var ne;const L=[],z=tv(this._lastRenderIndex+1),V={layer:i[0],viewport:e,isPicking:o,renderPass:r,cullRect:_},q={};for(let Ae=0;Ae<i.length;Ae++){const Ee=i[Ae],Ce=this._shouldDrawLayer(Ee,V,u,q),Le={shouldDrawLayer:Ce};Ce&&!R&&(Le.layerRenderIndex=z(Ee,Ce),Le.moduleParameters=this._getModuleParameters(Ee,l,r,I),Le.layerParameters={...(ne=Ee.context.deck)==null?void 0:ne.props.parameters,...this.getLayerParameters(Ee,Ae,e)}),L[Ae]=Le}return L}_drawLayersInViewport(e,{layers:i,moduleParameters:r,pass:o,target:u,viewport:_,view:l},I){const R=xM(this.device,{moduleParameters:r,target:u,viewport:_});if(l&&l.props.clear){const z=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:R},()=>this.device.clearWebGL(z))}const L={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:R});for(let z=0;z<i.length;z++){const V=i[z],{shouldDrawLayer:q,layerRenderIndex:ne,moduleParameters:Ae,layerParameters:Ee}=I[z];if(q&&V.props.pickable&&L.pickableCount++,V.isComposite)L.compositeCount++;else if(q){L.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,ne),Ae.viewport=_,V.context.renderPass=e;try{V._drawLayer({renderPass:e,moduleParameters:Ae,uniforms:{layerIndex:ne},parameters:Ee})}catch(Ce){V.raiseError(Ce,`drawing ${V} to ${o}`)}}}return L}shouldDrawLayer(e){return!0}getModuleParameters(e,i){return null}getLayerParameters(e,i,r){return e.props.parameters}_shouldDrawLayer(e,i,r,o){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let _=e.parent;for(;_;){if(!_.props.visible||!_.filterSubLayer(i))return!1;i.layer=_,_=_.parent}if(r){const l=i.layer.id;if(l in o||(o[l]=r(i)),!o[l])return!1}return e.activateViewport(i.viewport),!0}_getModuleParameters(e,i,r,o){var l,I;const u=this.device.canvasContext.cssToDeviceRatio(),_=Object.assign(Object.create(((l=e.internalState)==null?void 0:l.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:u});if(i)for(const R of i)Object.assign(_,(I=R.getModuleParameters)==null?void 0:I.call(R,e));return Object.assign(_,this.getModuleParameters(e,i),o)}}function tv(t=0,e={}){const i={},r=(o,u)=>{const _=o.props._offset,l=o.id,I=o.parent&&o.parent.id;let R;if(I&&!(I in e)&&r(o.parent,!1),I in i){const L=i[I]=i[I]||tv(e[I],e);R=L(o,u),i[l]=L}else Number.isFinite(_)?(R=_+(e[I]||0),i[l]=null):R=t;return u&&R>=t&&(t=R+1),e[l]=R,R};return r}function xM(t,{moduleParameters:e,target:i,viewport:r}){const o=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,u]=t.canvasContext.getDrawingBufferSize(),_=i?i.height:u,l=r;return[l.x*o,_-(l.y+l.height)*o,l.width*o,l.height*o]}class wM extends og{constructor(e,i){super(e,i),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const i=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),o=e.viewports[0],u=o.width*r,_=o.height*r,l=[1,1,1,1];(u!==i.width||_!==i.height)&&i.resize({width:u,height:_}),super.render({...e,clearColor:l,target:i,pass:"shadow"})}getLayerParameters(e,i,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const TM={color:[255,255,255],intensity:1},$y=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],EM=[0,0,0,200/255];class iv{constructor(e={}){this.id="lighting-effect",this.shadowColor=EM,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:i,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),r._addDefaultShaderModule(Vy),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const i in e){const r=e[i];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:i,viewports:r,onViewportActive:o,views:u}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let _=0;_<this.shadowPasses.length;_++)this.shadowPasses[_].render({layers:e,layerFilter:i,viewports:r,onViewportActive:o,views:u,moduleParameters:{shadowLightId:_,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const i=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return i.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},i}cleanup(e){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Vy))}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const r=new Gs().lookAt({eye:new Ft(i.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const r=new wM(e);this.shadowPasses[i]=r,this.shadowMaps[i]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:r}=this;!e&&i.length===0&&r.length===0&&(this.ambientLight=new gM(TM),this.directionalLights.push(new jy($y[0]),new jy($y[1])))}}class SM{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:r=1,type:o,padding:u=0,copy:_=!1,initialize:l=!1,maxCount:I}){const R=o||e&&e.constructor||Float32Array,L=i*r+u;if(ArrayBuffer.isView(e)){if(L<=e.length)return e;if(L*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new R(e.buffer,0,L)}let z=1/0;I&&(z=I*r+u);const V=this._allocate(R,L,l,z);return e&&_?V.set(e):l||V.fill(0,0,4),this._release(e),V}release(e){this._release(e)}_allocate(e,i,r,o){let u=Math.max(Math.ceil(i*this.opts.overAlloc),1);u>o&&(u=o);const _=this._pool,l=e.BYTES_PER_ELEMENT*u,I=_.findIndex(R=>R.byteLength>=l);if(I>=0){const R=new e(_.splice(I,1)[0],0,u);return r&&R.fill(0),R}return new e(u)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:r}=e,{byteLength:o}=r,u=i.findIndex(_=>_.byteLength>=o);u<0?i.push(r):(u>0||i.length<this.opts.poolSize)&&i.splice(u,0,r),i.length>this.opts.poolSize&&i.shift()}}const Ph=new SM;function mu(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function CM(t){return[t[12],t[13],t[14]]}function PM(t){return{left:Gc(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Gc(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Gc(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Gc(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Gc(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Gc(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Wy=new Ft;function Gc(t,e,i,r){Wy.set(t,e,i);const o=Wy.len();return{distance:r/o,normal:new Ft(-t/o,-e/o,-i/o)}}function IM(t){return t-Math.fround(t)}let au;function y0(t,e){const{size:i=1,startIndex:r=0}=e,o=e.endIndex!==void 0?e.endIndex:t.length,u=(o-r)/i;au=Ph.allocate(au,u,{type:Float32Array,size:i*2});let _=r,l=0;for(;_<o;){for(let I=0;I<i;I++){const R=t[_++];au[l+I]=R,au[l+I+i]=IM(R)}l+=i*2}return au.subarray(0,u*i*2)}function MM(t){let e=null,i=!1;for(const r of t)r&&(e?(i||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],i=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const RM=Math.PI/180,kM=mu(),Hy=[0,0,0],DM={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function BM({width:t,height:e,orthographic:i,fovyRadians:r,focalDistance:o,padding:u,near:_,far:l}){const I=t/e,R=i?new Gs().orthographic({fovy:r,aspect:I,focalDistance:o,near:_,far:l}):new Gs().perspective({fovy:r,aspect:I,near:_,far:l});if(u){const{left:L=0,right:z=0,top:V=0,bottom:q=0}=u,ne=sl((L+t-z)/2,0,t)-t/2,Ae=sl((V+e-q)/2,0,e)-e/2;R[8]-=ne*2/t,R[9]+=Ae*2/e}return R}class rd{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||DM,this.focalDistance=e.focalDistance||1,this.position=e.position||Hy,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?lo.WEB_MERCATOR:lo.WEB_MERCATOR_AUTO_OFFSET:lo.IDENTITY}equals(e){return e instanceof rd?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&wa(e.projectionMatrix,this.projectionMatrix)&&wa(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const r=this.projectPosition(e),o=ev(r,this.pixelProjectionMatrix),[u,_]=o,l=i?_:this.height-_;return e.length===2?[u,l]:[u,l,o[2]]}unproject(e,{topLeft:i=!0,targetZ:r}={}){const[o,u,_]=e,l=i?u:this.height-u,I=r&&r*this.distanceScales.unitsPerMeter[2],R=ng([o,l,_],this.pixelUnprojectionMatrix,I),[L,z,V]=this.unprojectPosition(R);return Number.isFinite(_)?[L,z,V]:Number.isFinite(r)?[L,z,r]:[L,z]}projectPosition(e){const[i,r]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,r,o]}unprojectPosition(e){const[i,r]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,r,o]}projectFlat(e){if(this.isGeospatial){const i=Sh(e);return i[1]=sl(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?Ch(e):e}getBounds(e={}){const i={targetZ:e.z||0},r=this.unproject([0,0],i),o=this.unproject([this.width,0],i),u=this.unproject([0,this.height],i),_=this.unproject([this.width,this.height],i);return[Math.min(r[0],o[0],u[0],_[0]),Math.min(r[1],o[1],u[1],_[1]),Math.max(r[0],o[0],u[0],_[0]),Math.max(r[1],o[1],u[1],_[1])]}getDistanceScales(e){return e?fp({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:r=1,height:o=1}){return e<this.x+this.width&&this.x<e+r&&i<this.y+this.height&&this.y<i+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,PM(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=XI({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||fp({latitude:r,longitude:i}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:u,modelMatrix:_}=e;let l=Hy;if(u&&(l=_?new Gs(_).transformAsVector(u,[]):u),this.isGeospatial){const I=this.projectPosition([i,r,0]);this.center=new Ft(l).scale(this.distanceScales.unitsPerMeter).add(I)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:i=kM,projectionMatrix:r=null,orthographic:o=!1,fovyRadians:u,fovy:_=75,near:l=.1,far:I=1e3,padding:R=null,focalDistance:L=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new Gs().multiplyRight(i).translate(new Ft(this.center).negate()),this.projectionMatrix=r||BM({width:this.width,height:this.height,orthographic:o,fovyRadians:u||_*RM,focalDistance:L,padding:R,near:l,far:I});const z=mu();ec(z,z,this.projectionMatrix),ec(z,z,this.viewMatrix),this.viewProjectionMatrix=z,this.viewMatrixInverse=lp([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=CM(this.viewMatrixInverse);const V=mu(),q=mu();tg(V,V,[this.width/2,-this.height/2,1]),Sf(V,V,[1,-1,0]),ec(q,V,this.viewProjectionMatrix),this.pixelProjectionMatrix=q,this.pixelUnprojectionMatrix=lp(mu(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||mi.warn("Pixel project matrix not invertible")()}}rd.displayName="Viewport";const ag=rd;class Ou extends ag{constructor(e={}){const{latitude:i=0,longitude:r=0,zoom:o=0,pitch:u=0,bearing:_=0,nearZMultiplier:l=.1,farZMultiplier:I=1.01,nearZ:R,farZ:L,orthographic:z=!1,projectionMatrix:V,repeat:q=!1,worldOffset:ne=0,position:Ae,padding:Ee,legacyMeterSizes:Ce=!1}=e;let{width:Le,height:Oe,altitude:Ne=1.5}=e;const Qe=Math.pow(2,o);Le=Le||1,Oe=Oe||1;let Je,xt=null;if(V)Ne=V[5]/2,Je=Pf(Ne);else{e.fovy?(Je=e.fovy,Ne=Jb(Je)):Je=Pf(Ne);let ct;if(Ee){const{top:at=0,bottom:Vt=0}=Ee;ct=[0,sl((at+Oe-Vt)/2,0,Oe)-Oe/2]}xt=YI({width:Le,height:Oe,scale:Qe,center:Ae&&[0,0,Ae[2]*m0(i)],offset:ct,pitch:u,fovy:Je,nearZMultiplier:l,farZMultiplier:I}),Number.isFinite(R)&&(xt.near=R),Number.isFinite(L)&&(xt.far=L)}let wt=ZI({height:Oe,pitch:u,bearing:_,scale:Qe,altitude:Ne});ne&&(wt=new Gs().translate([512*ne,0,0]).multiplyLeft(wt)),super({...e,width:Le,height:Oe,viewMatrix:wt,longitude:r,latitude:i,zoom:o,...xt,fovy:Je,focalDistance:Ne}),this.latitude=i,this.longitude=r,this.zoom=o,this.pitch=u,this.bearing=_,this.altitude=Ne,this.fovy=Je,this.orthographic=z,this._subViewports=q?[]:null,this._pseudoMeters=Ce,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let o=i;o<=r;o++){const u=o?new Ou({...this,worldOffset:o}):this;this._subViewports.push(u)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,r]=this.projectFlat(e),o=(e[2]||0)*m0(e[1]);return[i,r,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,r]=this.unprojectFlat(e),o=(e[2]||0)/m0(r);return[i,r,o]}addMetersToLngLat(e,i){return Kb(e,i)}panByPosition(e,i){const r=ng(i,this.pixelUnprojectionMatrix),o=this.projectFlat(e),u=Cy([],o,n4([],r)),_=Cy([],this.center,u),[l,I]=this.unprojectFlat(_);return{longitude:l,latitude:I}}getBounds(e={}){const i=KI(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:r,height:o}=this,{longitude:u,latitude:_,zoom:l}=GI({width:r,height:o,bounds:e,...i});return new Ou({width:r,height:o,longitude:u,latitude:_,zoom:l})}}Ou.displayName="WebMercatorViewport";const If=Ou,qy=[0,0,0];function b0(t,e,i=!1){const r=e.projectPosition(t);if(i&&e instanceof If){const[o,u,_=0]=t,l=e.getDistanceScales([o,u]);r[2]=_*l.unitsPerMeter[2]}return r}function FM(t){const{viewport:e,modelMatrix:i,coordinateOrigin:r}=t;let{coordinateSystem:o,fromCoordinateSystem:u,fromCoordinateOrigin:_}=t;return o===Ri.DEFAULT&&(o=e.isGeospatial?Ri.LNGLAT:Ri.CARTESIAN),u===void 0&&(u=o),_===void 0&&(_=r),{viewport:e,coordinateSystem:o,coordinateOrigin:r,modelMatrix:i,fromCoordinateSystem:u,fromCoordinateOrigin:_}}function rv(t,{viewport:e,modelMatrix:i,coordinateSystem:r,coordinateOrigin:o,offsetMode:u}){let[_,l,I=0]=t;switch(i&&([_,l,I]=Ih([],[_,l,I,1],i)),r){case Ri.LNGLAT:return b0([_,l,I],e,u);case Ri.LNGLAT_OFFSETS:return b0([_+o[0],l+o[1],I+(o[2]||0)],e,u);case Ri.METER_OFFSETS:return b0(Kb(o,[_,l,I]),e,u);case Ri.CARTESIAN:default:return e.isGeospatial?[_+o[0],l+o[1],I+o[2]]:e.projectPosition([_,l,I])}}function OM(t,e){const{viewport:i,coordinateSystem:r,coordinateOrigin:o,modelMatrix:u,fromCoordinateSystem:_,fromCoordinateOrigin:l}=FM(e),{autoOffset:I=!0}=e,{geospatialOrigin:R=qy,shaderCoordinateOrigin:L=qy,offsetMode:z=!1}=I?Gb(i,r,o):{},V=rv(t,{viewport:i,modelMatrix:u,coordinateSystem:_,coordinateOrigin:l,offsetMode:z});if(z){const q=i.projectPosition(R||L);Bb(V,V,q)}return V}let LM=1,NM=1;class sv{constructor(){ie(this,"time",0);ie(this,"channels",new Map);ie(this,"animations",new Map);ie(this,"playing",!1);ie(this,"lastEngineTime",-1)}addChannel(e){const{delay:i=0,duration:r=Number.POSITIVE_INFINITY,rate:o=1,repeat:u=1}=e,_=LM++,l={time:0,delay:i,duration:r,rate:o,repeat:u};return this._setChannelTime(l,this.time),this.channels.set(_,l),_}removeChannel(e){this.channels.delete(e);for(const[i,r]of this.animations)r.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const o of i)this._setChannelTime(o,this.time);const r=this.animations.values();for(const o of r){const{animation:u,channel:_}=o;u.setTime(this.getTime(_))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const r=NM++;return this.animations.set(r,{animation:e,channel:i}),e.setTime(this.getTime(i)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const r=i-e.delay,o=e.duration*e.repeat;r>=o?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let zM=0;const UM={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:ph.stats.get(`animation-loop-${zM++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class VM{constructor(e){ie(this,"device",null);ie(this,"canvas",null);ie(this,"props");ie(this,"animationProps",null);ie(this,"timeline",null);ie(this,"stats");ie(this,"cpuTime");ie(this,"gpuTime");ie(this,"frameRate");ie(this,"display");ie(this,"needsRedraw","initialized");ie(this,"_initialized",!1);ie(this,"_running",!1);ie(this,"_animationFrameId",null);ie(this,"_nextFramePromise",null);ie(this,"_resolveNextFrame",null);ie(this,"_cpuStartTime",0);if(this.props={...UM,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=e.stats||new Yu({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const i=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=JC(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(eP(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,i;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(i=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:i.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:i,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(i);const r=this.props.onAddHTML(i);r&&(i.innerHTML=r)}}_getSizeAndAspect(){var u,_,l,I;if(!this.device)return{width:1,height:1,aspect:1};const[e,i]=((_=(u=this.device)==null?void 0:u.canvasContext)==null?void 0:_.getPixelSize())||[1,1];let r=1;const o=(I=(l=this.device)==null?void 0:l.canvasContext)==null?void 0:I.canvas;return o&&o.clientHeight?r=o.clientWidth/o.clientHeight:e>0&&i>0&&(r=e/i),{width:e,height:i,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,i;this.props.autoResizeDrawingBuffer&&((i=(e=this.device)==null?void 0:e.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class Xy{constructor(e){ie(this,"id");ie(this,"userData",{});ie(this,"topology");ie(this,"bufferLayout",[]);ie(this,"vertexCount");ie(this,"indices");ie(this,"attributes");this.id=e.id||hc("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&er(this.indices.usage===lr.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const i of Object.values(this.attributes))i.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function jM(t,e){if(e instanceof Xy)return e;const i=$M(t,e),{attributes:r,bufferLayout:o}=WM(t,e);return new Xy({topology:e.topology||"triangle-list",bufferLayout:o,vertexCount:e.vertexCount,indices:i,attributes:r})}function $M(t,e){if(!e.indices)return;const i=e.indices.value;return t.createBuffer({usage:lr.INDEX,data:i})}function WM(t,e){const i=[],r={};for(const[u,_]of Object.entries(e.attributes)){let l=u;switch(u){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}r[l]=t.createBuffer({data:_.value,id:`${u}-buffer`});const{value:I,size:R,normalized:L}=_;i.push({name:l,format:ZC(I,R,L)})}const o=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:i,vertexCount:o}}class HM{constructor(e){ie(this,"modules");ie(this,"moduleUniforms");ie(this,"moduleBindings");ie(this,"moduleUniformsChanged");const i=td(Object.values(e).filter(r=>r.dependencies));for(const r of i)e[r.name]=r;ht.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,o]of Object.entries(e)){const u=r;this.moduleUniforms[u]=o.defaultUniforms||{},this.moduleBindings[u]={}}}destroy(){}setProps(e){var i;for(const r of Object.keys(e)){const o=r,u=e[o],_=this.modules[o];if(!_){ht.warn(`Module ${r} not found`)();continue}const l=this.moduleUniforms[o],I=this.moduleBindings[o],R=((i=_.getUniforms)==null?void 0:i.call(_,u,l))||u,{uniforms:L,bindings:z}=Qp(R);this.moduleUniforms[o]={...l,...L},this.moduleBindings[o]={...I,...z}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const i of Object.values(this.moduleBindings))Object.assign(e,i);return e}getDebugTable(){var i;const e={};for(const[r,o]of Object.entries(this.moduleUniforms))for(const[u,_]of Object.entries(o))e[`${r}.${u}`]={type:(i=this.modules[r].uniformTypes)==null?void 0:i[u],value:String(_)};return e}}const Gf=class Gf{constructor(e){ie(this,"device");ie(this,"_hashCounter",0);ie(this,"_hashes",{});ie(this,"_renderPipelineCache",{});ie(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Gf(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const i={...xh.defaultProps,...e},r=this._hashRenderPipeline(i);if(!this._renderPipelineCache[r]){const o=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});o.hash=r,this._renderPipelineCache[r]={pipeline:o,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const i={...wf.defaultProps,...e},r=this._hashComputePipeline(i);if(!this._computePipelineCache[r]){const o=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});o.hash=r,this._computePipelineCache[r]={pipeline:o,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const i=e.hash,r=e instanceof wf?this._computePipelineCache:this._renderPipelineCache;r[i].useCount--,r[i].useCount===0&&(r[i].pipeline.destroy(),delete r[i])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const i=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,o="-",u=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${r}V${o}BL${u}`;default:const _=this._getHash(JSON.stringify(e.parameters));return`${i}/${r}V${o}T${e.topology}P${_}BL${u}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};ie(Gf,"defaultProps",{...xh.defaultProps});let dp=Gf;const Qf=class Qf{constructor(e){ie(this,"device");ie(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var i;return(i=e._lumaData).defaultShaderFactory||(i.defaultShaderFactory=new Qf(e)),e._lumaData.defaultShaderFactory}createShader(e){const i=this._hashShader(e);let r=this._cache[i];if(!r){const o=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[i]=r={shader:o,useCount:0}}return r.useCount++,r.shader}release(e){const i=this._hashShader(e),r=this._cache[i];r&&(r.useCount--,r.useCount===0&&(delete this._cache[i],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};ie(Qf,"defaultProps",{...bf.defaultProps});let pp=Qf;function qM(t,e){var o;const i={},r="Values";if(t.attributes.length===0&&!((o=t.varyings)!=null&&o.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const u of t.attributes)if(u){const _=`${u.location} ${u.name}: ${u.type}`;i[`in ${_}`]={[r]:u.stepMode||"vertex"}}for(const u of t.varyings||[]){const _=`${u.location} ${u.name}`;i[`out ${_}`]={[r]:JSON.stringify(u.accessor)}}return i}let ss=null,v0=null;function XM(t,{id:e,minimap:i,opaque:r,top:o="0",left:u="0",rgbaScale:_=1}){ss||(ss=document.createElement("canvas"),ss.id=e,ss.title=e,ss.style.zIndex="100",ss.style.position="absolute",ss.style.top=o,ss.style.left=u,ss.style.border="blue 1px solid",ss.style.transform="scaleY(-1)",document.body.appendChild(ss),v0=ss.getContext("2d")),(ss.width!==t.width||ss.height!==t.height)&&(ss.width=t.width/2,ss.height=t.height/2,ss.style.width="400px",ss.style.height="400px");const l=t.device.readPixelsToArrayWebGL(t),I=v0.createImageData(t.width,t.height),R=0;for(let L=0;L<l.length;L+=4)I.data[R+L+0]=l[L+0]*_,I.data[R+L+1]=l[L+1]*_,I.data[R+L+2]=l[L+2]*_,I.data[R+L+3]=r?255:l[L+3]*_;v0.putImageData(I,0,0)}const Qc=2,ZM=1e4,Kf=class Kf{constructor(e,i){ie(this,"device");ie(this,"id");ie(this,"source");ie(this,"vs");ie(this,"fs");ie(this,"pipelineFactory");ie(this,"shaderFactory");ie(this,"userData",{});ie(this,"parameters");ie(this,"topology");ie(this,"bufferLayout");ie(this,"isInstanced");ie(this,"instanceCount",0);ie(this,"vertexCount");ie(this,"indexBuffer",null);ie(this,"bufferAttributes",{});ie(this,"constantAttributes",{});ie(this,"bindings",{});ie(this,"uniforms",{});ie(this,"vertexArray");ie(this,"transformFeedback",null);ie(this,"pipeline");ie(this,"shaderInputs");ie(this,"_uniformStore");ie(this,"_attributeInfos",{});ie(this,"_gpuGeometry",null);ie(this,"_getModuleUniforms");ie(this,"props");ie(this,"_pipelineNeedsUpdate","newly created");ie(this,"_needsRedraw","initializing");ie(this,"_destroyed",!1);ie(this,"_lastDrawTimestamp",-1);ie(this,"_lastLogTime",0);ie(this,"_logOpen",!1);ie(this,"_drawCount",0);var l,I,R,L;this.props={...Kf.defaultProps,...i},i=this.props,this.id=i.id||hc("model"),this.device=e,Object.assign(this.userData,i.userData);const r=Object.fromEntries(((l=this.props.modules)==null?void 0:l.map(z=>[z.name,z]))||[]);this.setShaderInputs(i.shaderInputs||new HM(r));const o=YM(e),u=(((I=this.props.modules)==null?void 0:I.length)>0?this.props.modules:(R=this.shaderInputs)==null?void 0:R.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(L=this.props).shaderLayout||(L.shaderLayout=NP(this.props.source));const{source:z,getUniforms:V}=this.props.shaderAssembler.assembleShader({platformInfo:o,...this.props,modules:u});this.source=z,this._getModuleUniforms=V}else{const{vs:z,fs:V,getUniforms:q}=this.props.shaderAssembler.assembleShaderPair({platformInfo:o,...this.props,modules:u});this.vs=z,this.fs=V,this._getModuleUniforms=q}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||dp.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||pp.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniforms(i.uniforms),i.moduleSettings&&this.updateModuleSettings(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let i;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),mf(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,o=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const i=e&&jM(this.device,e);i&&(this.setTopology(i.topology||"triangle-list"),this.bufferLayout=Zy(i.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(i)),this._gpuGeometry=i}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?Zy(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){rp(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new XC(this.shaderInputs.modules);for(const i of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,i){e.indices&&ht.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,o]of Object.entries(e)){const u=this.bufferLayout.find(I=>Yy(I).includes(r));if(!u){ht.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const _=Yy(u);let l=!1;for(const I of _){const R=this._attributeInfos[I];R&&(this.vertexArray.setBuffer(R.location,o),l=!0)}!l&&!((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)&&ht.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,i){for(const[r,o]of Object.entries(e)){const u=this._attributeInfos[r];u?this.vertexArray.setConstantWebGL(u.location,o):((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)||ht.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){mf(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:i,uniforms:r}=Qp(this._getModuleUniforms(e));Object.assign(this.bindings,i),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const i of Object.values(this.bindings))i instanceof yf?e=Math.max(e,i.texture.updateTimestamp):i instanceof lr||i instanceof $n?e=Math.max(e,i.updateTimestamp):i instanceof vf||(e=Math.max(e,i.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const i={...e.attributes};for(const[r]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(o=>o.name===r)&&r!=="positions"&&delete i[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,i=null;this.pipeline&&(ht.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let o=null;this.source?o=r:this.fs&&(o=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:o}),this._attributeInfos=Ab(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),i&&this.shaderFactory.release(i)}return this.pipeline}_logDrawCallStart(){const e=ht.level>3?0:ZM;ht.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ht.group(Qc,`>>> DRAWING MODEL ${this.id}`,{collapsed:ht.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=qM(this.pipeline.shaderLayout,this.id);ht.table(Qc,e)();const i=this.shaderInputs.getDebugTable();for(const[o,u]of Object.entries(this.uniforms))i[o]={value:u};ht.table(Qc,i)();const r=this._getAttributeDebugTable();ht.table(Qc,this._attributeInfos)(),ht.table(Qc,r)(),ht.groupEnd(Qc)(),this._logOpen=!1}}_logFramebuffer(e){const i=ht.get("framebuffer");if(this._drawCount++,!i||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&XM(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[i,r]of Object.entries(this._attributeInfos))e[r.location]={name:i,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,r=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);e.indices={name:"indices",type:i.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,i){const r=pb(i);return(e instanceof lr?new r(e.debugData):e).toString()}};ie(Kf,"defaultProps",{...xh.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:_f.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Sn=Kf;function Zy(t,e){const i=[...t];for(const r of e){const o=i.findIndex(u=>u.name===r.name);o<0?i.push(r):i[o]=r}return i}function YM(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function Yy(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(i=>i.attribute):[t.name]}class Lu{constructor(e,i=Sn.defaultProps){ie(this,"device");ie(this,"model");ie(this,"transformFeedback");er(Lu.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Sn(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||YS(),topology:i.topology||"point-list",...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var i;return((i=e==null?void 0:e.info)==null?void 0:i.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const i=this.device.beginRenderPass(e);this.model.draw(i),i.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const i=this.getBuffer(e);if(i instanceof lr)return i.readAsync();const{buffer:r,byteOffset:o=0,byteLength:u=r.byteLength}=i;return r.readAsync(o,u)}}class rc{constructor(e){ie(this,"id");ie(this,"topology");ie(this,"vertexCount");ie(this,"indices");ie(this,"attributes");ie(this,"userData",{});const{attributes:i={},indices:r=null,vertexCount:o=null}=e;this.id=e.id||hc("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[u,_]of Object.entries(i)){const l=ArrayBuffer.isView(_)?{value:_}:_;er(ArrayBuffer.isView(l.value),`${this._print(u)}: must be typed array or object with value as typed array`),(u==="POSITION"||u==="positions")&&!l.size&&(l.size=3),u==="indices"?(er(!this.indices),this.indices=l):this.attributes[u]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,i){return this}_calculateVertexCount(e,i){if(i)return i.value.length;let r=1/0;for(const o of Object.values(e)){const{value:u,size:_,constant:l}=o;!l&&u&&_>=1&&(r=Math.min(r,u.length/_))}return er(Number.isFinite(r)),r}}const GM={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class nv extends og{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:r,viewports:o,onViewportActive:u,pickingFBO:_,deviceRect:{x:l,y:I,width:R,height:L},cullRect:z,effects:V,pass:q="picking",pickZ:ne,moduleParameters:Ae}){this.pickZ=ne;const Ee=this._resetColorEncoder(ne),Ce=[l,I,R,L],Le=super.render({target:_,layers:e,layerFilter:i,views:r,viewports:o,onViewportActive:u,cullRect:z,effects:V==null?void 0:V.filter(Ne=>Ne.useInPicking),pass:q,isPicking:!0,moduleParameters:Ae,clearColor:[0,0,0,0],colorMask:15,scissorRect:Ce});return this._colorEncoderState=null,{decodePickingColor:Ee&&KM.bind(null,Ee),stats:Le}}shouldDrawLayer(e){const{pickable:i,operation:r}=e.props;return i&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,i,r){const o={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:u,operation:_}=e.props;return!this._colorEncoderState||_.includes("terrain")?o.blend=!1:u&&_.includes("draw")&&(Object.assign(o,GM),o.blend=!0,o.blendColor=QM(this._colorEncoderState,e,r)),o}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function QM(t,e,i){const{byLayer:r,byAlpha:o}=t;let u,_=r.get(e);return _?(_.viewports.push(i),u=_.a):(u=r.size+1,u<=255?(_={a:u,layer:e,viewports:[i]},r.set(e,_),o[u]=_):(mi.warn("Too many pickable layers, only picking the first 255")(),u=0)),[0,0,0,u/255]}function KM(t,e){const i=t.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const ih={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Mf=Symbol.for("component"),ll=Symbol.for("propTypes"),x0=Symbol.for("deprecatedProps"),mh=Symbol.for("asyncPropDefaults"),sc=Symbol.for("asyncPropOriginal"),nl=Symbol.for("asyncPropResolved");function sd(t,e=()=>!0){return Array.isArray(t)?ov(t,e,[]):e(t)?[t]:[]}function ov(t,e,i){let r=-1;for(;++r<t.length;){const o=t[r];Array.isArray(o)?ov(o,e,i):e(o)&&i.push(o)}return i}function JM({target:t,source:e,start:i=0,count:r=1}){const o=e.length,u=r*o;let _=0;for(let l=i;_<o;_++)t[l++]=e[_];for(;_<u;)_<u-_?(t.copyWithin(i+_,i,i+_),_*=2):(t.copyWithin(i+_,i,i+u-_),_=u);return t}class e6{constructor(e,i,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const r=++this._loadCount;let o=e;typeof e=="string"&&(o=pf(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(u=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=u)}).catch(u=>{this._loadCount===r&&(this.isLoaded=!0,this._error=u||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const u of this._subscribers)u.onChange(this.getData())}}class t6{constructor(e){var i;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(i=e.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:r=!1,persistent:o=!0}){let u=this._resources[e];u?u.setData(i,r):(u=new e6(e,i,this._context),this._resources[e]=u),u.persistent=o}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const r in i){const o=i[r],u=this._resources[o.resourceId];u&&u.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:r,requestId:o="default"}){const{_resources:u,protocol:_}=this;e.startsWith(_)&&(e=e.replace(_,""),u[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=u[e];if(this._track(r,o,l,i),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,r,o){const u=this._consumers,_=u[e]=u[e]||{};let l=_[i];const I=l&&l.resourceId&&this._resources[l.resourceId];I&&(I.unsubscribe(l),this.prune()),r&&(l?(l.onChange=o,l.resourceId=r.id):l={onChange:o,resourceId:r.id},_[i]=l,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const i6="layerManager.setLayers",r6="layerManager.activateViewport";class s6{constructor(e,i){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=l=>{Fs(r6,this,l),l&&(this.context.viewport=l)};const{deck:r,stats:o,viewport:u,timeline:_}=i||{};this.layers=[],this.resourceManager=new t6({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:AM(),defaultShaderModules:[],renderPass:void 0,stats:o||new Yu({id:"deck.gl"}),viewport:u||new ag({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:_||new sv,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const o=r.getNeedsRedraw(e);i=i||o}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(r=>i.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){Fs(i6,this,i,e),this._lastRenderedLayers=e;const r=sd(e,Boolean);for(const o of r)o.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:i}=this.context;i.find(r=>r.name===e.name)||(i.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:i}=this.context,r=i.findIndex(o=>o.name===e.name);r>=0&&(i.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,i,r){r.raiseError(i,`${e} of ${r}`)}_updateLayers(e,i){const r={};for(const _ of e)r[_.id]?mi.warn(`Multiple old layers with same id ${_.id}`)():r[_.id]=_;if(this._defaultShaderModulesChanged){for(const _ of e)_.setNeedsUpdate(),_.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const o=[];this._updateSublayersRecursively(i,r,o),this._finalizeOldLayers(r);let u=!1;for(const _ of o)if(_.hasUniformTransition()){u=`Uniform transition in ${_}`;break}this._needsUpdate=u,this.layers=o}_updateSublayersRecursively(e,i,r){for(const o of e){o.context=this.context;const u=i[o.id];u===null&&mi.warn(`Multiple new layers with same id ${o.id}`)(),i[o.id]=null;let _=null;try{this._debug&&u!==o&&o.validateProps(),u?(this._transferLayerState(u,o),this._updateLayer(o)):this._initializeLayer(o),r.push(o),_=o.isComposite?o.getSubLayers():null}catch(l){this._handleError("matching",l,o)}_&&this._updateSublayersRecursively(_,i,r)}}_finalizeOldLayers(e){for(const i in e){const r=e[i];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ih.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=ih.MATCHED,i!==e&&(e.lifecycle=ih.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=ih.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ih.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function Wn(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Wn(t[r],e[r],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(const u of r)if(!e.hasOwnProperty(u)||!Wn(t[u],e[u],i-1))return!1;return!0}return!1}class n6{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,r=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,i){const r=this.getViewports(),o={x:e[0],y:e[1]};for(let u=r.length-1;u>=0;--u){const _=r[u];if(_.containsPixel(o)){const l=e.slice();return l[0]-=_.x,l[1]-=_.y,_.unproject(l,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=sd(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Wn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):mi.warn("missing `viewState` or `initialViewState`")()}_createController(e,i){const r=i.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:u=>{var _;return(_=this.getView(e.id))==null?void 0:_.makeViewport({viewState:u,width:this.width,height:this.height})}})}_updateController(e,i,r,o){const u=e.controller;if(u&&r){const _={...i,...u,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!o||o.constructor!==u.type)&&(o=this._createController(e,_)),o&&o.setProps(_),o}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let o=e.length;o--;){const u=e[o],_=this.getViewState(u),l=u.makeViewport({viewState:_,width:this.width,height:this.height});let I=i[u.id];const R=!!u.controller;R&&!I&&(r=!0),(r||!R)&&I&&(I.finalize(),I=null),this.controllers[u.id]=this._updateController(u,_,l,I),l&&this._viewports.unshift(l)}for(const o in i){const u=i[o];u&&!this.controllers[o]&&u.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((r,o)=>!e[o].equals(i[o]))}}const o6=/([0-9]+\.?[0-9]*)(%|px)/;function Qa(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=o6.exec(t);if(e&&e.length>=3){const i=e[2]==="%",r=parseFloat(e[1]);return{position:i?r/100:r,relative:i}}default:throw new Error(`Could not parse position string ${t}`)}}function Ka(t,e){return t.relative?Math.round(t.position*e):t.position}class a6{constructor(e){const{id:i,x:r=0,y:o=0,width:u="100%",height:_="100%",padding:l=null}=e;this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Qa(r),this._y=Qa(o),this._width=Qa(u),this._height=Qa(_),this._padding=l&&{left:Qa(l.left||0),right:Qa(l.right||0),top:Qa(l.top||0),bottom:Qa(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&Wn(this.props,e.props,2)}makeViewport({width:e,height:i,viewState:r}){r=this.filterViewState(r);const o=this.getDimensions({width:e,height:i});return!o.height||!o.width?null:new this.ViewportType({...r,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const r in this.props.viewState)r!=="id"&&(i[r]=this.props.viewState[r]);return i}return e}getDimensions({width:e,height:i}){const r={x:Ka(this._x,e),y:Ka(this._y,i),width:Ka(this._width,e),height:Ka(this._height,i)};return this._padding&&(r.padding={left:Ka(this._padding.left,e),top:Ka(this._padding.top,i),right:Ka(this._padding.right,e),bottom:Ka(this._padding.bottom,i)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class nd{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var i,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(i=this.settings).onStart)==null||r.call(i,this)}end(){var e,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(e=this.settings).onEnd)==null||i.call(e,this))}cancel(){var e,i;this._inProgress&&((i=(e=this.settings).onInterrupt)==null||i.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:o}=this;this._handle=r.addChannel({delay:r.getTime(),duration:o.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(e=this.settings).onUpdate)==null||i.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Gy=()=>{},gp={BREAK:1,SNAP_TO_END:2,IGNORE:3},l6=t=>t,c6=gp.BREAK;class h6{constructor(e){this._onTransitionUpdate=i=>{const{time:r,settings:{interpolator:o,startProps:u,endProps:_,duration:l,easing:I}}=i,R=I(r/l),L=o.interpolateProps(u,_,R);this.propsInTransition=this.getControllerState({...this.props,...L}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new nd(e.timeline),this.onViewStateChange=e.onViewStateChange||Gy,this.onStateChange=e.onStateChange||Gy}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let o=r;if(this.transition.inProgress){const{interruption:u,endProps:_}=this.transition.settings;o={...r,...u===gp.SNAP_TO_END?_:this.propsInTransition||r}}this._triggerTransition(o,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:r}=e;return(i>0||i==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===gp.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const r=this.getControllerState(e),o=this.getControllerState(i).shortestPathFrom(r),u=i.transitionInterpolator,_=u.getDuration?u.getDuration(e,i):i.transitionDuration;if(_===0)return;const l=u.initializeProps(e,o);this.propsInTransition={};const I={duration:_,easing:i.transitionEasing||l6,interpolator:u,interruption:i.transitionInterruption||c6,startProps:l.start,endProps:l.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(I),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(i)}}}function ps(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class u6{constructor(e){const{compare:i,extract:r,required:o}=e;this._propsToCompare=i,this._propsToExtract=r||i,this._requiredProps=o}arePropsEqual(e,i){for(const r of this._propsToCompare)if(!(r in e)||!(r in i)||!wa(e[r],i[r]))return!1;return!0}initializeProps(e,i){const r={},o={};for(const u of this._propsToExtract)(u in e||u in i)&&(r[u]=e[u],o[u]=i[u]);return this._checkRequiredProps(r),this._checkRequiredProps(o),{start:r,end:o}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(i=>{const r=e[i];ps(Number.isFinite(r)||Array.isArray(r),`${i} is required for transition`)})}}const A6=["longitude","latitude","zoom","bearing","pitch"],f6=["longitude","latitude","zoom"];class av extends u6{constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:A6,required:f6},super(r.transitionProps),this.opts=r}initializeProps(e,i){const r=super.initializeProps(e,i),{makeViewport:o,around:u}=this.opts;if(o&&u){const _=o(e),l=o(i),I=_.unproject(u);r.start.around=u,Object.assign(r.end,{around:l.project(I),aroundPosition:I,width:i.width,height:i.height})}return r}interpolateProps(e,i,r){const o={};for(const u of this._propsToExtract)o[u]=Th(e[u]||0,i[u]||0,r);if(i.aroundPosition&&this.opts.makeViewport){const u=this.opts.makeViewport({...i,...o});Object.assign(o,u.panByPosition(i.aroundPosition,Th(e.around,i.around,r)))}return o}}const Ja={transitionDuration:0},d6=300,FA=t=>1-(1-t)*(1-t),Kc={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Hl={};class p6{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new h6({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const i in this._events)this._events[i]&&((e=this.eventManager)==null||e.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return i?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:r}=this.props,{offsetCenter:o}=e;return[o.x-i,o.y-r]}isPointInBounds(e,i){const{width:r,height:o}=this.props;if(i&&i.handled)return!1;const u=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=o;return u&&i&&i.stopPropagation(),u}isFunctionKeyPressed(e){const{srcEvent:i}=e;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?d6:0;const{scrollZoom:r=!0,dragPan:o=!0,dragRotate:u=!0,doubleClickZoom:_=!0,touchZoom:l=!0,touchRotate:I=!1,keyboard:R=!0}=e,L=!!this.onViewStateChange;this.toggleEvents(Kc.WHEEL,L&&r),this.toggleEvents(Kc.PAN,L),this.toggleEvents(Kc.PINCH,L&&(l||I)),this.toggleEvents(Kc.TRIPLE_PAN,L&&I),this.toggleEvents(Kc.DOUBLE_TAP,L&&_),this.toggleEvents(Kc.KEYBOARD,L&&R),this.scrollZoom=r,this.dragPan=o,this.dragRotate=u,this.doubleClickZoom=_,this.touchZoom=l,this.touchRotate=I,this.keyboard=R}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(r=>{this._events[r]!==i&&(this._events[r]=i,i?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,i=null,r={}){const o={...e.getViewportProps(),...i},u=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),u){const _=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:_,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const o=this.controllerState[r?"panStart":"rotateStart"]({pos:i});return this._panMove=r,this.updateViewport(o,Ja,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),r=this.controllerState.pan({pos:i});return this.updateViewport(r,Ja,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const r=this.getCenter(e),o=[r[0]+e.velocityX*i/2,r[1]+e.velocityY*i/2],u=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:FA},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),r=this.controllerState.rotate({pos:i});return this.updateViewport(r,Ja,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const r=this.getCenter(e),o=[r[0]+e.velocityX*i/2,r[1]+e.velocityY*i/2],u=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:FA},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:u}=e;let _=2/(1+Math.exp(-Math.abs(u*r)));u<0&&_!==0&&(_=1/_);const l=this.controllerState.zoom({pos:i,scale:_});return this.updateViewport(l,{...this._getTransitionProps({around:i}),transitionDuration:o?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.controllerState.rotateStart({pos:i});return this.updateViewport(r,Ja,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const r=this.controllerState.rotate({pos:i});return this.updateViewport(r,Ja,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const r=this.getCenter(e),o=[r[0],r[1]+=e.velocityY*i/2],u=this.controllerState.rotate({pos:o});this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:FA},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return Hl._startPinchRotation=e.rotation,Hl._lastPinchEvent=e,this.updateViewport(r,Ja,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:r}=e,o=this.getCenter(e);i=i.zoom({pos:o,scale:r})}if(this.touchRotate){const{rotation:r}=e;i=i.rotate({deltaAngleX:Hl._startPinchRotation-r})}return this.updateViewport(i,Ja,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Hl._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:r}=Hl;if(this.touchZoom&&i&&r&&e.scale!==r.scale){const o=this.getCenter(e);let u=this.controllerState.rotateEnd();const _=Math.log2(e.scale),l=(_-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),I=Math.pow(2,_+l*i/2);u=u.zoom({pos:o,scale:I}).zoomEnd(),this.updateViewport(u,{...this._getTransitionProps({around:o}),transitionDuration:i,transitionEasing:FA},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Hl._startPinchRotation=null,Hl._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.isFunctionKeyPressed(e),o=this.controllerState.zoom({pos:i,scale:r?.5:2});return this.updateViewport(o,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:o,rotateSpeedX:u,rotateSpeedY:_}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let I;const R={};switch(e.srcEvent.code){case"Minus":I=i?l.zoomOut(r).zoomOut(r):l.zoomOut(r),R.isZooming=!0;break;case"Equal":I=i?l.zoomIn(r).zoomIn(r):l.zoomIn(r),R.isZooming=!0;break;case"ArrowLeft":i?(I=l.rotateLeft(u),R.isRotating=!0):(I=l.moveLeft(o),R.isPanning=!0);break;case"ArrowRight":i?(I=l.rotateRight(u),R.isRotating=!0):(I=l.moveRight(o),R.isPanning=!0);break;case"ArrowUp":i?(I=l.rotateUp(_),R.isRotating=!0):(I=l.moveUp(o),R.isPanning=!0);break;case"ArrowDown":i?(I=l.rotateDown(_),R.isRotating=!0):(I=l.moveDown(o),R.isPanning=!0);break;default:return!1}return this.updateViewport(I,this._getTransitionProps(),R),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?Ja:e?{...i,transitionInterpolator:new av({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class g6{constructor(e,i){this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Qy=5,_6=1.2;class m6 extends g6{constructor(e){const{width:i,height:r,latitude:o,longitude:u,zoom:_,bearing:l=0,pitch:I=0,altitude:R=1.5,position:L=[0,0,0],maxZoom:z=20,minZoom:V=0,maxPitch:q=60,minPitch:ne=0,startPanLngLat:Ae,startZoomLngLat:Ee,startRotatePos:Ce,startBearing:Le,startPitch:Oe,startZoom:Ne,normalize:Qe=!0}=e;ps(Number.isFinite(u)),ps(Number.isFinite(o)),ps(Number.isFinite(_)),super({width:i,height:r,latitude:o,longitude:u,zoom:_,bearing:l,pitch:I,altitude:R,maxZoom:z,minZoom:V,maxPitch:q,minPitch:ne,normalize:Qe,position:L},{startPanLngLat:Ae,startZoomLngLat:Ee,startRotatePos:Ce,startBearing:Le,startPitch:Oe,startZoom:Ne}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const r=this.getState().startPanLngLat||this._unproject(i);if(!r)return this;const u=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(u)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:r=0}){const{startRotatePos:o,startBearing:u,startPitch:_}=this.getState();if(!o||u===void 0||_===void 0)return this;let l;return e?l=this._getNewRotation(e,o,_,u):l={bearing:u+i,pitch:_+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:r}){let{startZoom:o,startZoomLngLat:u}=this.getState();if(u||(o=this.getViewportProps().zoom,u=this._unproject(i)||this._unproject(e)),!u)return this;const{maxZoom:_,minZoom:l}=this.getViewportProps();let I=o+Math.log2(r);I=sl(I,l,_);const R=this.makeViewport({...this.getViewportProps(),zoom:I});return this._getUpdatedState({zoom:I,...R.panByPosition(u,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),r={...this.getViewportProps()},{bearing:o,longitude:u}=r;return Math.abs(o-i.bearing)>180&&(r.bearing=o<0?o+360:o-360),Math.abs(u-i.longitude)>180&&(r.longitude=u<0?u+360:u-360),r}applyConstraints(e){const{maxZoom:i,minZoom:r,zoom:o}=e;e.zoom=sl(o,r,i);const{maxPitch:u,minPitch:_,pitch:l}=e;e.pitch=sl(l,_,u);const{normalize:I=!0}=e;return I&&Object.assign(e,JI(e)),e}_zoomFromCenter(e){const{width:i,height:r}=this.getViewportProps();return this.zoom({pos:[i/2,r/2],scale:e})}_panFromCenter(e){const{width:i,height:r}=this.getViewportProps();return this.pan({startPos:[i/2,r/2],pos:[i/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,r,o){const u=e[0]-i[0],_=e[1]-i[1],l=e[1],I=i[1],{width:R,height:L}=this.getViewportProps(),z=u/R;let V=0;_>0?Math.abs(L-I)>Qy&&(V=_/(I-L)*_6):_<0&&I>Qy&&(V=1-l/I),V=sl(V,-1,1);const{minPitch:q,maxPitch:ne}=this.getViewportProps(),Ae=o+180*z;let Ee=r;return V>0?Ee=r+V*(ne-r):V<0&&(Ee=r-V*(q-r)),{pitch:Ee,bearing:Ae}}}class y6 extends p6{constructor(){super(...arguments),this.ControllerState=m6,this.transition={transitionDuration:300,transitionInterpolator:new av({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class lv extends a6{constructor(e={}){super(e)}get ViewportType(){return If}get ControllerType(){return y6}}lv.displayName="MapView";const b6=lv,v6=new iv;function x6(t,e){const i=t.order??1/0,r=e.order??1/0;return i-r}class w6{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const i=this._defaultEffects;if(!i.find(r=>r.id===e.id)){const r=i.findIndex(o=>x6(o,e)>0);r<0?i.push(e):i.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Wn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(e){const i={};for(const o of this.effects)i[o.id]=o;const r=[];for(const o of e){const u=i[o.id];let _=o;u&&u!==o?u.setProps?(u.setProps(o.props),_=u):u.cleanup(this._context):u||o.setup(this._context),r.push(_),delete i[o.id]}for(const o in i)i[o].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(o=>o instanceof iv)||this._resolvedEffects.push(v6),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class T6 extends og{shouldDrawLayer(e){const{operation:i}=e.props;return i.includes("draw")||i.includes("terrain")}}const E6="deckRenderer.renderLayers";class S6{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new T6(e),this.pickLayersPass=new nv(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const o=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const u=i.render({...r,target:o});r.effects&&this._postRender(r.effects,r),this.renderCount++,Fs(E6,this,u,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const r of e)i.preRenderStats[r.id]=r.preRender(i),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,i=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const o=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[o]}))});for(const r of e)r.resize(i)}_postRender(e,i){const{renderBuffers:r}=this,o={...i,inputBuffer:r[0],swapBuffer:r[1]};for(const u of e)if(u.postRender){o.target=u.id===this.lastPostProcessEffect?i.target:void 0;const _=u.postRender(o);o.inputBuffer=_,o.swapBuffer=_===r[0]?r[1]:r[0]}}}const C6={pickedColor:null,pickedObjectIndex:-1};function P6({pickedColors:t,decodePickingColor:e,deviceX:i,deviceY:r,deviceRadius:o,deviceRect:u}){const{x:_,y:l,width:I,height:R}=u;let L=o*o,z=-1,V=0;for(let q=0;q<R;q++){const ne=q+l-r,Ae=ne*ne;if(Ae>L)V+=4*I;else for(let Ee=0;Ee<I;Ee++){if(t[V+3]-1>=0){const Le=Ee+_-i,Oe=Le*Le+Ae;Oe<=L&&(L=Oe,z=V)}V+=4}}if(z>=0){const q=t.slice(z,z+4),ne=e(q);if(ne){const Ae=Math.floor(z/4/I),Ee=z/4-Ae*I;return{...ne,pickedColor:q,pickedX:_+Ee,pickedY:l+Ae}}mi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return C6}function I6({pickedColors:t,decodePickingColor:e}){const i=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const u=t.slice(r,r+4),_=u.join(",");if(!i.has(_)){const l=e(u);l?i.set(_,{...l,color:u}):mi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function cv({pickInfo:t,viewports:e,pixelRatio:i,x:r,y:o,z:u}){let _=e[0];e.length>1&&(_=R6((t==null?void 0:t.pickedViewports)||e,{x:r,y:o}));let l;if(_){const I=[r-_.x,o-_.y];u!==void 0&&(I[2]=u),l=_.unproject(I)}return{color:null,layer:null,viewport:_,index:-1,picked:!1,x:r,y:o,pixel:[r,o],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function M6(t){const{pickInfo:e,lastPickedInfo:i,mode:r,layers:o}=t,{pickedColor:u,pickedLayer:_,pickedObjectIndex:l}=e,I=_?[_]:[];if(r==="hover"){const z=i.index,V=i.layerId,q=_?_.props.id:null;if(q!==V||l!==z){if(q!==V){const ne=o.find(Ae=>Ae.props.id===V);ne&&I.unshift(ne)}i.layerId=q,i.index=l,i.info=null}}const R=cv(t),L=new Map;return L.set(null,R),I.forEach(z=>{let V={...R};z===_&&(V.color=u,V.index=l,V.picked=!0),V=hv({layer:z,info:V,mode:r});const q=V.layer;z===_&&r==="hover"&&(i.info=V),L.set(q.id,V),r==="hover"&&q.updateAutoHighlight(V)}),L}function hv({layer:t,info:e,mode:i}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:r}),t=t.parent}return e}function R6(t,e){for(let i=t.length-1;i>=0;i--){const r=t[i];if(r.containsPixel(e))return r}return t[0]}class k6{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new nv(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:r,viewports:o},u=this.lastPickedInfo.info){const _=u&&u.layer&&u.layer.id,l=u&&u.viewport&&u.viewport.id,I=_?r.find(V=>V.id===_):null,R=l&&o.find(V=>V.id===l)||o[0],L=R&&R.unproject([e-R.x,i-R.y]);return{...u,...{x:e,y:i,viewport:R,coordinate:L,layer:I}}}_resizeBuffer(){var i,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const o=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=o}const{canvas:e}=this.device.getCanvasContext();(i=this.pickingFBO)==null||i.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:r,x:o,y:u,radius:_=0,depth:l=1,mode:I="query",unproject3D:R,onViewportActive:L,effects:z}){const V=this.device.canvasContext.cssToDeviceRatio(),q=this._getPickable(e);if(!q||r.length===0)return{result:[],emptyInfo:cv({viewports:r,x:o,y:u,pixelRatio:V})};this._resizeBuffer();const ne=this.device.canvasContext.cssToDevicePixels([o,u],!0),Ae=[ne.x+Math.floor(ne.width/2),ne.y+Math.floor(ne.height/2)],Ee=Math.round(_*V),{width:Ce,height:Le}=this.pickingFBO,Oe=this._getPickingRect({deviceX:Ae[0],deviceY:Ae[1],deviceRadius:Ee,deviceWidth:Ce,deviceHeight:Le}),Ne={x:o-_,y:u-_,width:_*2+1,height:_*2+1};let Qe;const Je=[],xt=new Set;for(let wt=0;wt<l;wt++){let ct;if(Oe){const Vt=this._drawAndSample({layers:q,views:i,viewports:r,onViewportActive:L,deviceRect:Oe,cullRect:Ne,effects:z,pass:`picking:${I}`});ct=P6({...Vt,deviceX:Ae[0],deviceY:Ae[1],deviceRadius:Ee,deviceRect:Oe})}else ct={pickedColor:null,pickedObjectIndex:-1};let at;if(ct.pickedLayer&&R&&this.depthFBO){const{pickedColors:Vt}=this._drawAndSample({layers:[ct.pickedLayer],views:i,viewports:r,onViewportActive:L,deviceRect:{x:ct.pickedX,y:ct.pickedY,width:1,height:1},cullRect:Ne,effects:z,pass:`picking:${I}:z`},!0);Vt[3]&&(at=Vt[0])}ct.pickedLayer&&wt+1<l&&(xt.add(ct.pickedLayer),ct.pickedLayer.disablePickingIndex(ct.pickedObjectIndex)),Qe=M6({pickInfo:ct,lastPickedInfo:this.lastPickedInfo,mode:I,layers:q,viewports:r,x:o,y:u,z:at,pixelRatio:V});for(const Vt of Qe.values())Vt.layer&&Je.push(Vt);if(!ct.pickedColor)break}for(const wt of xt)wt.restorePickingColors();return{result:Je,emptyInfo:Qe.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:r,x:o,y:u,width:_=1,height:l=1,mode:I="query",maxObjects:R=null,onViewportActive:L,effects:z}){const V=this._getPickable(e);if(!V||r.length===0)return[];this._resizeBuffer();const q=this.device.canvasContext.cssToDeviceRatio(),ne=this.device.canvasContext.cssToDevicePixels([o,u],!0),Ae=ne.x,Ee=ne.y+ne.height,Ce=this.device.canvasContext.cssToDevicePixels([o+_,u+l],!0),Le=Ce.x+Ce.width,Oe=Ce.y,Ne={x:Ae,y:Oe,width:Le-Ae,height:Ee-Oe},Qe=this._drawAndSample({layers:V,views:i,viewports:r,onViewportActive:L,deviceRect:Ne,cullRect:{x:o,y:u,width:_,height:l},effects:z,pass:`picking:${I}`}),Je=I6(Qe),xt=new Map,wt=[],ct=Number.isFinite(R);for(let at=0;at<Je.length&&!(ct&&wt.length>=R);at++){const Vt=Je[at];let Ot={color:Vt.pickedColor,layer:null,index:Vt.pickedObjectIndex,picked:!0,x:o,y:u,pixelRatio:q};Ot=hv({layer:Vt.pickedLayer,info:Ot,mode:I});const $t=Ot.layer.id;xt.has($t)||xt.set($t,new Set);const qt=xt.get($t),gi=Ot.object??Ot.index;qt.has(gi)||(qt.add(gi),wt.push(Ot))}return wt}_drawAndSample({layers:e,views:i,viewports:r,onViewportActive:o,deviceRect:u,cullRect:_,effects:l,pass:I},R=!1){const L=R?this.depthFBO:this.pickingFBO,z={layers:e,layerFilter:this.layerFilter,views:i,viewports:r,onViewportActive:o,pickingFBO:L,deviceRect:u,cullRect:_,effects:l,pass:I,pickZ:R,preRenderStats:{}};for(const Le of l)Le.useInPicking&&(z.preRenderStats[Le.id]=Le.preRender(z));const{decodePickingColor:V}=this.pickLayersPass.render(z),{x:q,y:ne,width:Ae,height:Ee}=u,Ce=new(R?Float32Array:Uint8Array)(Ae*Ee*4);return this.device.readPixelsToArrayWebGL(L,{sourceX:q,sourceY:ne,sourceWidth:Ae,sourceHeight:Ee,target:Ce}),{pickedColors:Ce,decodePickingColor:V}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:r,deviceWidth:o,deviceHeight:u}){const _=Math.max(0,e-r),l=Math.max(0,i-r),I=Math.min(o,e+r+1)-_,R=Math.min(u,i+r+1)-l;return I<=0||R<=0?null:{x:_,y:l,width:I,height:R}}}const D6={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},B6="top-left",Ky="__root";class F6{constructor({deck:e,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Wn(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(i=>i.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const i={};for(const r of this.resolvedWidgets)i[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)i[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const o=i[r.id];o?o.viewId!==r.viewId||o.placement!==r.placement?(this._remove(o),this._add(r)):r!==o&&(o.setProps(r.props),r=o):this._add(r),i[r.id]=null,this.resolvedWidgets.push(r)}for(const r in i){const o=i[r];o&&this._remove(o)}this.widgets=e}_add(e){const{viewId:i=null,placement:r=B6}=e,o=e.onAdd({deck:this.deck,viewId:i});o&&this._getContainer(i,r).append(o),e._element=o}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,i){var _;const r=e||Ky;let o=this.containers[r];o||(o=document.createElement("div"),o.style.pointerEvents="none",o.style.position="absolute",o.style.overflow="hidden",(_=this.parentElement)==null||_.append(o),this.containers[r]=o);let u=o.querySelector(`.${i}`);return u||(u=document.createElement("div"),u.className=i,u.style.position="absolute",u.style.zIndex="2",Object.assign(u.style,D6[i]),o.append(u)),u}_updateContainers(){const e=this.deck.width,i=this.deck.height;for(const r in this.containers){const o=this.lastViewports[r]||null,u=r===Ky||o,_=this.containers[r];u?(_.style.display="block",_.style.left=`${o?o.x:0}px`,_.style.top=`${o?o.y:0}px`,_.style.width=`${o?o.width:e}px`,_.style.height=`${o?o.height:i}px`):_.style.display="none"}}onRedraw({viewports:e,layers:i}){var u,_;const r=e.reduce((l,I)=>(l[I.id]=I,l),{}),{lastViewports:o}=this;for(const l of this.getWidgets()){const{viewId:I}=l;if(I){const R=r[I];R&&(l.onViewportChange&&!R.equals(o[I])&&l.onViewportChange(R),(u=l.onRedraw)==null||u.call(l,{viewports:[R],layers:i}))}else{if(l.onViewportChange)for(const R of e)R.equals(o[R.id])||l.onViewportChange(R);(_=l.onRedraw)==null||_.call(l,{viewports:e,layers:i})}}this.lastViewports=r,this._updateContainers()}onHover(e,i){var r,o;for(const u of this.getWidgets()){const{viewId:_}=u;(!_||_===((r=e.viewport)==null?void 0:r.id))&&((o=u.onHover)==null||o.call(u,e,i))}}onEvent(e,i){var o,u;const r=hp[i.type];if(r)for(const _ of this.getWidgets()){const{viewId:l}=_;(!l||l===((o=e.viewport)==null?void 0:o.id))&&((u=_[r.handler])==null||u.call(_,e,i))}}}const O6={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class L6{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,O6),this.deck=e,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var i;this.isVisible&&e.id===((i=this.lastViewport)==null?void 0:i.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:i}=this,r=i&&i.props.getTooltip;if(!r)return;const o=r(e);this.lastViewport=e.viewport,this.setTooltip(o,e.x,e.y)}setTooltip(e,i,r){const o=this.element;if(o){if(typeof e=="string")o.innerText=e;else if(e)e.text&&(o.innerText=e.text),e.html&&(o.innerHTML=e.html),e.className&&(o.className=e.className);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform=`translate(${i}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(o.style,e.style)}}}var sh;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(sh||(sh={}));const lg={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Lr=(t,e,i)=>e?t.enable(i):t.disable(i),Jy=(t,e,i)=>t.hint(i,e),En=(t,e,i)=>t.pixelStorei(i,e),e1=(t,e,i)=>{const r=i===36006?36009:36008;return t.bindFramebuffer(r,e)},lu=(t,e,i)=>{const o={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];t.bindBuffer(o,e)};function w0(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const N6={3042:Lr,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Lr,2885:(t,e)=>t.cullFace(e),2929:Lr,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Lr,35723:Jy,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var i;return(i=t.bindTransformFeedback)==null?void 0:i.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:e1,36010:e1,34964:lu,36662:lu,36663:lu,35053:lu,35055:lu,2886:(t,e)=>t.frontFace(e),33170:Jy,2849:(t,e)=>t.lineWidth(e),32823:Lr,32824:"polygonOffset",10752:"polygonOffset",35977:Lr,32926:Lr,32928:Lr,32938:"sampleCoverage",32939:"sampleCoverage",3089:Lr,3088:(t,e)=>t.scissor(...e),2960:Lr,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Lr,10754:Lr,12288:Lr,12289:Lr,12290:Lr,12291:Lr,12292:Lr,12293:Lr,12294:Lr,12295:Lr,3333:En,3317:En,37440:En,37441:En,37443:En,3330:En,3332:En,3331:En,3314:En,32878:En,3316:En,3315:En,32877:En,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const i=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...i)},blendFunc:(t,e)=>{const i=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...i)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=w0(e)?e:[e,e];const[i,r]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=w0(e)&&e.length===3?[...e,...e]:e;const[i,r,o,u,_,l]=e;t.stencilFuncSeparate(1028,i,r,o),t.stencilFuncSeparate(1029,u,_,l)},stencilOp:(t,e)=>{e=w0(e)&&e.length===3?[...e,...e]:e;const[i,r,o,u,_,l]=e;t.stencilOpSeparate(1028,i,r,o),t.stencilOpSeparate(1029,u,_,l)},viewport:(t,e)=>t.viewport(...e)};function wr(t,e,i){return e[t]!==void 0?e[t]:i[t]}const z6={blendEquation:(t,e,i)=>t.blendEquationSeparate(wr(32777,e,i),wr(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate(wr(32969,e,i),wr(32968,e,i),wr(32971,e,i),wr(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset(wr(32824,e,i),wr(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage(wr(32938,e,i),wr(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,wr(2962,e,i),wr(2967,e,i),wr(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,wr(34816,e,i),wr(36003,e,i),wr(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,wr(2964,e,i),wr(2965,e,i),wr(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,wr(34817,e,i),wr(34818,e,i),wr(34819,e,i))},t1={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,i)=>t({36007:i}),bindTransformFeedback:(t,e,i)=>t({36389:i}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({36006:i,36010:i});case 36009:return t({36006:i});case 36008:return t({36010:i});default:return null}},bindBuffer:(t,e,i)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:i}):{valueChanged:!0}},blendColor:(t,e,i,r,o)=>t({32773:new Float32Array([e,i,r,o])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,i)=>t({32777:e,34877:i}),blendFunc:(t,e,i)=>t({32969:e,32968:i,32971:e,32970:i}),blendFuncSeparate:(t,e,i,r,o)=>t({32969:e,32968:i,32971:r,32970:o}),clearColor:(t,e,i,r,o)=>t({3106:new Float32Array([e,i,r,o])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,i,r,o)=>t({3107:[e,i,r,o]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,i)=>t({2928:new Float32Array([e,i])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,i)=>t({32824:e,10752:i}),sampleCoverage:(t,e,i)=>t({32938:e,32939:i}),scissor:(t,e,i,r,o)=>t({3088:new Int32Array([e,i,r,o])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,i)=>t({[e===1028?2968:36005]:i}),stencilFunc:(t,e,i,r)=>t({2962:e,2967:i,2963:r,34816:e,36003:i,36004:r}),stencilFuncSeparate:(t,e,i,r,o)=>t({[e===1028?2962:34816]:i,[e===1028?2967:36003]:r,[e===1028?2963:36004]:o}),stencilOp:(t,e,i,r)=>t({2964:e,2965:i,2966:r,34817:e,34818:i,34819:r}),stencilOpSeparate:(t,e,i,r,o)=>t({[e===1028?2964:34817]:i,[e===1028?2965:34818]:r,[e===1028?2966:34819]:o}),viewport:(t,e,i,r,o)=>t({2978:[e,i,r,o]})},Lo=(t,e)=>t.isEnabled(e),i1={3042:Lo,2884:Lo,2929:Lo,3024:Lo,32823:Lo,32926:Lo,32928:Lo,3089:Lo,2960:Lo,35977:Lo},U6=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function kh(t,e){if(j6(e))return;const i={};for(const o in e){const u=Number(o),_=N6[o];_&&(typeof _=="string"?i[_]=!0:_(t,e[o],u))}const r=t.state&&t.state.cache;if(r)for(const o in i){const u=z6[o];u(t,e,r)}}function uv(t,e=lg){if(typeof e=="number"){const o=e,u=i1[o];return u?u(t,o):t.getParameter(o)}const i=Array.isArray(e)?e:Object.keys(e),r={};for(const o of i){const u=i1[o];r[o]=u?u(t,Number(o)):t.getParameter(Number(o))}return r}function V6(t){kh(t,lg)}function j6(t){for(const e in t)return!1;return!0}function $6(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&r&&t.length===e.length){for(let o=0;o<t.length;++o)if(t[o]!==e[o])return!1;return!0}return!1}class W6{constructor(e,{copyState:i=!1,log:r=()=>{}}={}){ie(this,"gl");ie(this,"program",null);ie(this,"stateStack",[]);ie(this,"enable",!0);ie(this,"cache");ie(this,"log");this.gl=e,this.cache=i?uv(e):Object.assign({},lg),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){er(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];kh(this.gl,e),this.stateStack.pop()}_updateCache(e){let i=!1,r;const o=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const u in e){er(u!==void 0);const _=e[u],l=this.cache[u];$6(_,l)||(i=!0,r=l,o&&!(u in o)&&(o[u]=l),this.cache[u]=_)}return{valueChanged:i,oldValue:r}}}function nc(t){return t.state}function Av(t,e){const{enable:i=!0,copyState:r}=e;if(er(r!==void 0),!t.state){t.state=new W6(t,{copyState:r}),q6(t);for(const u in t1){const _=t1[u];H6(t,u,_)}r1(t,"getParameter"),r1(t,"isEnabled")}const o=nc(t);return o.enable=i,t}function od(t){let e=nc(t);e||(Av(t,{copyState:!1}),e=nc(t)),e.push()}function Nu(t){const e=nc(t);er(e),e.pop()}function r1(t,e){const i=t[e].bind(t);t[e]=function(o){if(o===void 0||U6.has(o))return i(o);const u=nc(t);return o in u.cache||(u.cache[o]=i(o)),u.enable?u.cache[o]:i(o)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function H6(t,e,i){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...u){const _=nc(t),{valueChanged:l,oldValue:I}=i(_._updateCache,...u);return l&&r(...u),I},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function q6(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const o=nc(t);o.program!==r&&(e(r),o.program=r)}}const X6={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function Z6(t,e){e={...X6,...e};let i=null;const r=u=>i=u.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);let o=null;if(o||(o=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",r,!1),!o)throw new Error(`Failed to create WebGL context: ${i||"Unknown error"}`);if(e.onContextLost){const{onContextLost:u}=e;t.addEventListener("webglcontextlost",_=>u(_),!1)}if(e.onContextRestored){const{onContextRestored:u}=e;t.addEventListener("webglcontextrestored",_=>u(_),!1)}return o}function ul(t,e,i){return i[e]===void 0&&(i[e]=t.getExtension(e)||null),i[e]}function Y6(t,e){const i=t.getParameter(7936),r=t.getParameter(7937);ul(t,"WEBGL_debug_renderer_info",e);const o=e.WEBGL_debug_renderer_info,u=t.getParameter(o?o.UNMASKED_VENDOR_WEBGL:7936),_=t.getParameter(o?o.UNMASKED_RENDERER_WEBGL:7937),l=u||i,I=_||r,R=t.getParameter(7938),L=fv(l,I),z=G6(l,I),V=Q6(l,I);return{type:"webgl",gpu:L,gpuType:V,gpuBackend:z,vendor:l,renderer:I,version:R,shadingLanguage:"glsl",shadingLanguageVersion:300}}function fv(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function G6(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function Q6(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(fv(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function dv(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Ds="texture-compression-bc",Hi="texture-compression-astc",No="texture-compression-etc2",K6="texture-compression-etc1-webgl",OA="texture-compression-pvrtc-webgl",T0="texture-compression-atc-webgl",cu="float32-renderable-webgl",E0="float16-renderable-webgl",J6="rgb9e5ufloat_renderable-webgl",S0="snorm8-renderable-webgl",hu="norm16-renderable-webgl",C0="snorm16-renderable-webgl",LA="float32-filterable",s1="float16-filterable-webgl",yu="WEBGL_compressed_texture_s3tc",bu="WEBGL_compressed_texture_s3tc_srgb",nh="EXT_texture_compression_rgtc",oh="EXT_texture_compression_bptc",eR="WEBGL_compressed_texture_etc",tR="WEBGL_compressed_texture_astc",iR="WEBGL_compressed_texture_etc1",rR="WEBGL_compressed_texture_pvrtc",sR="WEBGL_compressed_texture_atc",n1="EXT_texture_norm16",o1="EXT_render_snorm",nR="EXT_color_buffer_float",cg={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[o1],"norm16-renderable-webgl":[n1],"snorm16-renderable-webgl":[n1,o1],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[yu,bu,nh,oh],"texture-compression-bc5-webgl":[nh],"texture-compression-bc7-webgl":[oh],"texture-compression-etc2":[eR],"texture-compression-astc":[tR],"texture-compression-etc1-webgl":[iR],"texture-compression-pvrtc-webgl":[rR],"texture-compression-atc-webgl":[sR]};function oR(t){return t in cg}function aR(t,e,i){return(cg[e]||[]).every(o=>ul(t,o,i))}const ad={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:S0},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:S0},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:E0,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:hu,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:C0},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:S0},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:E0,filter:s1,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:hu},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:C0},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:cu,filter:LA},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:J6},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:cu,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:hu},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:hu},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:cu,filter:LA,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:E0,filter:s1},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:hu,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:C0},"rgb32float-webgl":{gl:34837,render:cu,filter:LA,gl2ext:nR,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:cu,filter:LA,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:yu,f:Ds},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:bu,f:Ds},"bc1-rgba-unorm":{gl:33777,x:yu,f:Ds},"bc1-rgba-unorm-srgb":{gl:35916,x:bu,f:Ds},"bc2-rgba-unorm":{gl:33778,x:yu,f:Ds},"bc2-rgba-unorm-srgb":{gl:35918,x:bu,f:Ds},"bc3-rgba-unorm":{gl:33779,x:yu,f:Ds},"bc3-rgba-unorm-srgb":{gl:35919,x:bu,f:Ds},"bc4-r-unorm":{gl:36283,x:nh,f:Ds},"bc4-r-snorm":{gl:36284,x:nh,f:Ds},"bc5-rg-unorm":{gl:36285,x:nh,f:Ds},"bc5-rg-snorm":{gl:36286,x:nh,f:Ds},"bc6h-rgb-ufloat":{gl:36495,x:oh,f:Ds},"bc6h-rgb-float":{gl:36494,x:oh,f:Ds},"bc7-rgba-unorm":{gl:36492,x:oh,f:Ds},"bc7-rgba-unorm-srgb":{gl:36493,x:oh,f:Ds},"etc2-rgb8unorm":{gl:37492,f:No},"etc2-rgb8unorm-srgb":{gl:37494,f:No},"etc2-rgb8a1unorm":{gl:37496,f:No},"etc2-rgb8a1unorm-srgb":{gl:37497,f:No},"etc2-rgba8unorm":{gl:37493,f:No},"etc2-rgba8unorm-srgb":{gl:37495,f:No},"eac-r11unorm":{gl:37488,f:No},"eac-r11snorm":{gl:37489,f:No},"eac-rg11unorm":{gl:37490,f:No},"eac-rg11snorm":{gl:37491,f:No},"astc-4x4-unorm":{gl:37808,f:Hi},"astc-4x4-unorm-srgb":{gl:37840,f:Hi},"astc-5x4-unorm":{gl:37809,f:Hi},"astc-5x4-unorm-srgb":{gl:37841,f:Hi},"astc-5x5-unorm":{gl:37810,f:Hi},"astc-5x5-unorm-srgb":{gl:37842,f:Hi},"astc-6x5-unorm":{gl:37811,f:Hi},"astc-6x5-unorm-srgb":{gl:37843,f:Hi},"astc-6x6-unorm":{gl:37812,f:Hi},"astc-6x6-unorm-srgb":{gl:37844,f:Hi},"astc-8x5-unorm":{gl:37813,f:Hi},"astc-8x5-unorm-srgb":{gl:37845,f:Hi},"astc-8x6-unorm":{gl:37814,f:Hi},"astc-8x6-unorm-srgb":{gl:37846,f:Hi},"astc-8x8-unorm":{gl:37815,f:Hi},"astc-8x8-unorm-srgb":{gl:37847,f:Hi},"astc-10x5-unorm":{gl:37819,f:Hi},"astc-10x5-unorm-srgb":{gl:37851,f:Hi},"astc-10x6-unorm":{gl:37817,f:Hi},"astc-10x6-unorm-srgb":{gl:37849,f:Hi},"astc-10x8-unorm":{gl:37818,f:Hi},"astc-10x8-unorm-srgb":{gl:37850,f:Hi},"astc-10x10-unorm":{gl:37819,f:Hi},"astc-10x10-unorm-srgb":{gl:37851,f:Hi},"astc-12x10-unorm":{gl:37820,f:Hi},"astc-12x10-unorm-srgb":{gl:37852,f:Hi},"astc-12x12-unorm":{gl:37821,f:Hi},"astc-12x12-unorm-srgb":{gl:37853,f:Hi},"pvrtc-rgb4unorm-webgl":{gl:35840,f:OA},"pvrtc-rgba4unorm-webgl":{gl:35842,f:OA},"pvrtc-rbg2unorm-webgl":{gl:35841,f:OA},"pvrtc-rgba2unorm-webgl":{gl:35843,f:OA},"etc1-rbg-unorm-webgl":{gl:36196,f:K6},"atc-rgb-unorm-webgl":{gl:35986,f:T0},"atc-rgba-unorm-webgl":{gl:35986,f:T0},"atc-rgbai-unorm-webgl":{gl:34798,f:T0}},lR={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},cR={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function hg(t,e,i){const r=ad[e];if(!r||r.gl===void 0)return!1;const o=r.x||r.gl2ext;return o?!!ul(t,o,i):!0}function pv(t){const e=ad[t],i=e==null?void 0:e.gl;if(i===void 0)throw new Error(`Unsupported texture format ${t}`);return i}function hR(t,e,i){if(!hg(t,e,i)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(lb(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!ul(t,"OES_texture_float_linear, extensions",i):e.endsWith("16float")?!!ul(t,"OES_texture_half_float_linear, extensions",i):!0}function uR(t,e,i){return!(!hg(t,e,i)||typeof e=="number")}function Rf(t){var o;const e=ad[t],i=pv(t),r=lb(t);return{format:i,dataFormat:(e==null?void 0:e.dataFormat)||fR(r.format,r.integer,r.normalized,i),type:r.dataType?dv(r.dataType):((o=e==null?void 0:e.types)==null?void 0:o[0])||5121,compressed:r.compressed}}function AR(t){const e=ad[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function a1(t){const e=Rf(t),i=lR[e.dataFormat]||4,r=cR[e.type]||1;return i*r}function fR(t,e,i,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!i?36244:6403;case"rg":return e&&!i?33320:33319;case"rgb":return e&&!i?36248:6407;case"rgba":return e&&!i?36249:6408;default:return 6408}}const l1={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class dR extends uC{constructor(i,r,o){super([],o);ie(this,"gl");ie(this,"extensions");ie(this,"testedFeatures",new Set);this.gl=i,this.extensions=r,ul(i,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const i=this.getFeatures();for(const r of i)this.has(r)&&(yield r);return[]}has(i){return this.disabledFeatures[i]?!1:(this.testedFeatures.has(i)||(this.testedFeatures.add(i),oR(i)&&aR(this.gl,i,this.extensions)&&this.features.add(i),this.getWebGLFeature(i)&&this.features.add(i)),this.features.has(i))}initializeFeatures(){const i=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of i)this.has(r)}getFeatures(){return[...Object.keys(l1),...Object.keys(cg)]}getWebGLFeature(i){const r=l1[i];return typeof r=="string"?!!ul(this.gl,r,this.extensions):!!r}}class pR extends hC{constructor(i){super();ie(this,"gl");ie(this,"limits",{});this.gl=i}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(i){return this.limits[i]===void 0&&(this.limits[i]=this.gl.getParameter(i)),this.limits[i]}}function ol(t,e,i){if(gR(e))return i(t);const{nocatch:r=!0}=e;od(t),kh(t,e);let o;if(r)o=i(t),Nu(t);else try{o=i(t)}finally{Nu(t)}return o}function gR(t){for(const e in t)return!1;return!0}function _R(t,e,i,r){if(mf(e))return r(t);const o=t;od(o.gl);try{return mR(t,e),kh(o.gl,i),r(t)}finally{Nu(o.gl)}}function mR(t,e){const i=t,{gl:r}=i;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(tc("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const u=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,_=tc("provokingVertex",e.provokingVertex,{first:36429,last:36430});u==null||u.provokingVertexWEBGL(_)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const u=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,_=tc("polygonMode",e.polygonMode,{fill:6914,line:6913});u==null||u.polygonModeWEBGL(1028,_),u==null||u.polygonModeWEBGL(1029,_)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(bR("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(_p("depthCompare",e.depthCompare))),e.stencilWriteMask){const o=e.stencilWriteMask;r.stencilMaskSeparate(1028,o),r.stencilMaskSeparate(1029,o)}if(e.stencilReadMask&&ht.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const o=e.stencilReadMask||4294967295,u=_p("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,u,0,o),r.stencilFuncSeparate(1029,u,0,o)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const o=P0("stencilPassOperation",e.stencilPassOperation),u=P0("stencilFailOperation",e.stencilFailOperation),_=P0("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,u,_,o),r.stencilOpSeparate(1029,u,_,o)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const o=c1("blendColorOperation",e.blendColorOperation||"add"),u=c1("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(o,u);const _=NA("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=NA("blendColorDstFactor",e.blendColorDstFactor||"zero"),I=NA("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),R=NA("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(_,l,I,R)}}function _p(t,e){return tc(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function P0(t,e){return tc(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function c1(t,e){return tc(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function NA(t,e){return tc(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function yR(t,e){return`Illegal parameter ${e} for ${t}`}function tc(t,e,i){if(!(e in i))throw new Error(yR(t,e));return i[e]}function bR(t,e){return e}function gv(t){const e={};return t.addressModeU&&(e[10242]=I0(t.addressModeU)),t.addressModeV&&(e[10243]=I0(t.addressModeV)),t.addressModeW&&(e[32882]=I0(t.addressModeW)),t.magFilter&&(e[10240]=_v(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=vR(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=_p("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function I0(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function _v(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function vR(t,e){if(!e)return _v(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class cl extends lr{constructor(i,r={}){super(i,r);ie(this,"device");ie(this,"gl");ie(this,"handle");ie(this,"glTarget");ie(this,"glUsage");ie(this,"glIndexType",5123);ie(this,"byteLength");ie(this,"bytesUsed");this.device=i,this.gl=this.device.gl;const o=typeof r=="object"?r.handle:void 0;this.handle=o||this.gl.createBuffer(),i.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=xR(this.props.usage),this.glUsage=wR(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(i,r=0,o=i.byteLength+r){const u=this.glTarget;this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,o,this.glUsage),this.gl.bufferSubData(u,r,i),this.gl.bindBuffer(u,null),this.bytesUsed=o,this.byteLength=o,this._setDebugData(i,r,o),this.trackAllocatedMemory(o)}_initWithByteLength(i){er(i>=0);let r=i;i===0&&(r=new Float32Array(0));const o=this.glTarget;return this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,r,this.glUsage),this.gl.bindBuffer(o,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(null,0,i),this.trackAllocatedMemory(i),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(i,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,i),this.gl.bindBuffer(36663,null),this._setDebugData(i,r,i.byteLength)}async readAsync(i=0,r){return this.readSyncWebGL(i,r)}readSyncWebGL(i=0,r){r=r??this.byteLength-i;const o=new Uint8Array(r),u=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,o,u,r),this.gl.bindBuffer(36662,null),this._setDebugData(o,i,r),o}}function xR(t){return t&lr.INDEX?34963:t&lr.VERTEX?34962:t&lr.UNIFORM?35345:34962}function wR(t){return t&lr.INDEX||t&lr.VERTEX?35044:t&lr.UNIFORM?35048:35044}class mp extends vf{constructor(i,r){super(i,r);ie(this,"device");ie(this,"handle");ie(this,"parameters");this.device=i,this.parameters=gv(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(i){for(const[r,o]of Object.entries(i)){const u=Number(r);switch(u){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,u,o);break;default:this.device.gl.samplerParameteri(this.handle,u,o);break}}}}class ah extends yf{constructor(i,r){super(i,{...$n.defaultProps,...r});ie(this,"device");ie(this,"gl");ie(this,"handle");ie(this,"texture");this.device=i,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const TR={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},ku=class ku extends $n{constructor(i,r){var o;super(i,{...TR,format:"rgba8unorm",...r});ie(this,"MAX_ATTRIBUTES");ie(this,"device");ie(this,"gl");ie(this,"handle");ie(this,"sampler");ie(this,"view");ie(this,"glFormat");ie(this,"type");ie(this,"dataFormat");ie(this,"mipmaps");ie(this,"target");ie(this,"textureUnit");ie(this,"loaded",!1);ie(this,"_video");this.device=i,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=ER(this.props),this.loaded=!1,typeof((o=this.props)==null?void 0:o.data)=="string"&&Object.assign(this.props,{data:KC(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(i){return new ah(this.device,{...i,texture:this})}initialize(i={}){if(this.props.dimension==="cube")return this.initializeCube(i);let r=i.data;if(r instanceof Promise)return r.then(Ce=>this.initialize(Object.assign({},i,{pixels:Ce,data:Ce}))),this;const o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(o&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(i)),this;const{parameters:u={}}=i,{pixels:_=null,pixelStore:l={},textureUnit:I=void 0,mipmaps:R=!0}=i;r||(r=_);let{width:L,height:z,dataFormat:V,type:q,compressed:ne=!1}=i;const{depth:Ae=0}=i,Ee=pv(i.format);return{width:L,height:z,compressed:ne,dataFormat:V,type:q}=this._deduceParameters({format:i.format,type:q,dataFormat:V,compressed:ne,data:r,width:L,height:z}),this.width=L,this.height=z,this.glFormat=Ee,this.type=q,this.dataFormat=V,this.textureUnit=I,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=R,this.setImageData({data:r,width:L,height:z,depth:Ae,format:i.format,type:q,dataFormat:V,parameters:l,compressed:ne}),this.setSampler(i.sampler),this._setSamplerParameters(u),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),R&&this.device.isTextureFormatFilterable(i.format)&&this.generateMipmap(),o&&(this._video={video:r,parameters:u,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(i){const{mipmaps:r=!0,parameters:o={}}=i;return this.setCubeMapImageData(i).then(()=>{this.loaded=!0,r&&this.generateMipmap(i),this.setSampler(i.sampler),this._setSamplerParameters(o)}),this}setSampler(i={}){let r;i instanceof mp?(this.sampler=i,r=i.props):(this.sampler=new mp(this.device,i),r=i);const o=gv(r);return this._setSamplerParameters(o),this}resize(i){const{height:r,width:o,mipmaps:u=!1}=i;return o!==this.width||r!==this.height?this.initialize({width:o,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:u}):this}update(){if(this._video){const{video:i,parameters:r,lastTime:o}=this._video;if(o===i.currentTime||i.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:i,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=i.currentTime}}generateMipmap(i={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),ol(this.gl,i,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(i){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(i);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:o=null,level:u=0,glFormat:_=this.glFormat,offset:l=0,parameters:I={}}=i;let{data:R=null,type:L=this.type,width:z=this.width,height:V=this.height,dataFormat:q=this.dataFormat,compressed:ne=!1}=i;R||(R=o),{type:L,dataFormat:q,compressed:ne,width:z,height:V}=this._deduceParameters({format:this.props.format,type:L,dataFormat:q,compressed:ne,data:R,width:z,height:V});const{gl:Ae}=this;Ae.bindTexture(this.target,this.handle);let Ee=null;if({data:R,dataType:Ee}=this._getDataType({data:R,compressed:ne}),ol(this.gl,I,()=>{switch(Ee){case"null":Ae.texImage2D(r,u,_,z,V,0,q,L,R);break;case"typed-array":Ae.texImage2D(r,u,_,z,V,0,q,L,R,l);break;case"buffer":this.device.gl.bindBuffer(35052,R.handle||R),this.device.gl.texImage2D(r,u,_,z,V,0,q,L,l),this.device.gl.bindBuffer(35052,null);break;case"browser-object":Ae.texImage2D(r,u,_,z,V,0,q,L,R);break;case"compressed":for(const[Ce,Le]of R.entries())Ae.compressedTexImage2D(r,Ce,Le.format,Le.width,Le.height,0,Le.data);break;default:er(!1,"Unknown image data type")}}),R&&R.byteLength)this.trackAllocatedMemory(R.byteLength,"Texture");else{const Ce=a1(this.props.format);this.trackAllocatedMemory(this.width*this.height*Ce,"Texture")}return this.loaded=!0,this}setSubImageData({target:i=this.target,pixels:r=null,data:o=null,x:u=0,y:_=0,width:l=this.width,height:I=this.height,level:R=0,glFormat:L=this.glFormat,type:z=this.type,dataFormat:V=this.dataFormat,compressed:q=!1,offset:ne=0,parameters:Ae={}}){if({type:z,dataFormat:V,compressed:q,width:l,height:I}=this._deduceParameters({format:this.props.format,type:z,dataFormat:V,compressed:q,data:o,width:l,height:I}),er(this.depth===1,"texSubImage not supported for 3D textures"),o||(o=r),o&&o.data){const Ee=o;o=Ee.data,l=Ee.shape[0],I=Ee.shape[1]}o instanceof cl&&(o=o.handle),this.gl.bindTexture(this.target,this.handle),ol(this.gl,Ae,()=>{q?this.gl.compressedTexSubImage2D(i,R,u,_,l,I,L,o):o===null?this.gl.texSubImage2D(i,R,u,_,l,I,V,z,null):ArrayBuffer.isView(o)?this.gl.texSubImage2D(i,R,u,_,l,I,V,z,o,ne):typeof WebGLBuffer<"u"&&o instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,o),this.device.gl.texSubImage2D(i,R,u,_,l,I,V,z,ne),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(i,R,u,_,l,I,V,z,o)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(i={}){return ht.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(i=this.textureUnit){const{gl:r}=this;return i!==void 0&&(this.textureUnit=i,r.activeTexture(33984+i)),r.bindTexture(this.target,this.handle),i}unbind(i=this.textureUnit){const{gl:r}=this;return i!==void 0&&(this.textureUnit=i,r.activeTexture(33984+i)),r.bindTexture(this.target,null),i}_getDataType({data:i,compressed:r=!1}){return r?{data:i,dataType:"compressed"}:i===null?{data:i,dataType:"null"}:ArrayBuffer.isView(i)?{data:i,dataType:"typed-array"}:i instanceof cl?{data:i.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?{data:i,dataType:"buffer"}:{data:i,dataType:"browser-object"}}_deduceParameters(i){const{format:r,data:o}=i;let{width:u,height:_,dataFormat:l,type:I,compressed:R}=i;const L=Rf(r);return l=l||L.dataFormat,I=I||L.type,R=R||L.compressed,{width:u,height:_}=this._deduceImageSize(o,u,_),{dataFormat:l,type:I,compressed:R,width:u,height:_,format:r,data:o}}_deduceImageSize(i,r,o){let u;return typeof ImageData<"u"&&i instanceof ImageData?u={width:i.width,height:i.height}:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement?u={width:i.naturalWidth,height:i.naturalHeight}:typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement?u={width:i.width,height:i.height}:typeof ImageBitmap<"u"&&i instanceof ImageBitmap?u={width:i.width,height:i.height}:typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement?u={width:i.videoWidth,height:i.videoHeight}:i?u={width:r,height:o}:u={width:r>=0?r:1,height:o>=0?o:1},er(u,"Could not deduced texture size"),er(r===void 0||u.width===r,"Deduced texture width does not match supplied width"),er(o===void 0||u.height===o,"Deduced texture height does not match supplied height"),u}async setCubeMapImageData(i){const{gl:r}=this,{width:o,height:u,pixels:_,data:l,format:I=6408,type:R=5121}=i,L=_||l,z=await Promise.all(ku.FACES.map(V=>{const q=L[V];return Promise.all(Array.isArray(q)?q:[q])}));this.bind(),ku.FACES.forEach((V,q)=>{z[q].length>1&&this.props.mipmaps!==!1&&ht.warn(`${this.id} has mipmap and multiple LODs.`)(),z[q].forEach((ne,Ae)=>{o&&u?r.texImage2D(V,Ae,I,o,u,0,I,R,ne):r.texImage2D(V,Ae,I,I,R,ne)})}),this.unbind()}setImageDataForFace(i){const{face:r,width:o,height:u,pixels:_,data:l,format:I=6408,type:R=5121}=i,{gl:L}=this,z=_||l;return this.bind(),z instanceof Promise?z.then(V=>this.setImageDataForFace(Object.assign({},i,{face:r,data:V,pixels:V}))):this.width||this.height?L.texImage2D(r,0,I,o,u,0,I,R,z):L.texImage2D(r,0,I,I,R,z),this}setImageData3D(i){const{level:r=0,dataFormat:o,format:u,type:_,width:l,height:I,depth:R=1,offset:L=0,data:z,parameters:V={}}=i;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const q=Rf(u);if(ol(this.gl,V,()=>{ArrayBuffer.isView(z)&&this.gl.texImage3D(this.target,r,q.format,l,I,R,0,q.dataFormat,q.type,z),z instanceof cl&&(this.gl.bindBuffer(35052,z.handle),this.gl.texImage3D(this.target,r,o,l,I,R,0,u,_,L))}),z&&z.byteLength)this.trackAllocatedMemory(z.byteLength,"Texture");else{const ne=a1(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*ne,"Texture")}return this.loaded=!0,this}_setSamplerParameters(i){if(!mf(i)){SR(i),this.gl.bindTexture(this.target,this.handle);for(const[r,o]of Object.entries(i)){const u=Number(r),_=o;switch(u){case 33082:case 33083:this.gl.texParameterf(this.target,u,_);break;default:this.gl.texParameteri(this.target,u,_);break}}this.gl.bindTexture(this.target,null)}}};ie(ku,"FACES",[34069,34070,34071,34072,34073,34074]);let $o=ku;function ER(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function SR(t){ht.log(1,"texture sampler parameters",t)()}class Su extends xf{constructor(i,r){super(i,r);ie(this,"device");ie(this,"gl");ie(this,"handle");const o=r.handle===null;if(this.device=i,this.gl=i.gl,this.handle=this.props.handle||o?this.props.handle:this.gl.createFramebuffer(),!o){i.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const u=this.gl.bindFramebuffer(36160,this.handle);for(let _=0;_<this.colorAttachments.length;++_){const l=this.colorAttachments[_],I=36064+_;l&&this._attachOne(I,l)}if(this.depthStencilAttachment&&this._attachOne(AR(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const _=this.gl.checkFramebufferStatus(36160);if(_!==36053)throw new Error(`Framebuffer ${PR(_)}`)}this.gl.bindFramebuffer(36160,u)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(i){return new $o(this.device,{id:`${this.id}-depth-stencil`,format:i,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(i,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;i===void 0&&(i=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const o of this.colorAttachments)o.texture.resize({width:i,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:i,height:r}),this}_attachOne(i,r){if(Array.isArray(r)){const[o,u=0,_=0]=r;return this._attachTexture(i,o,u,_),o}if(r instanceof $o)return this._attachTexture(i,r,0,0),r;if(r instanceof ah){const o=r;return this._attachTexture(i,o.texture,o.props.baseMipLevel,o.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(i,r,o,u){const{gl:_}=this.device;switch(_.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:_.framebufferTextureLayer(36160,i,r.target,u,o);break;case 34067:const l=CR(o);_.framebufferTexture2D(36160,i,l,r.handle,u);break;case 3553:_.framebufferTexture2D(36160,i,3553,r.handle,u);break;default:er(!1,"Illegal texture type")}_.bindTexture(r.target,null)}}function CR(t){return t<34069?t+34069:t}function PR(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class IR extends Gp{constructor(i,r){super(r);ie(this,"device");ie(this,"presentationSize");ie(this,"_framebuffer",null);this.device=i,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Su(this.device,{handle:null}),this._framebuffer}update(){const i=this.getPixelSize();(i[0]!==this.presentationSize[0]||i[1]!==this.presentationSize[1])&&(this.presentationSize=i,this.resize())}resize(i){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(i==null?void 0:i.useDevicePixels);this.setDevicePixelRatio(r,i);return}}commit(){}}const MR={spector:ht.get("spector")||ht.get("spectorjs")},RR="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",kR=1;let qi=null,h1=!1;async function DR(t){if(!globalThis.SPECTOR)try{await gb(RR)}catch(e){ht.warn(String(e))}}function BR(t){if(t={...MR,...t},!(t!=null&&t.spector)||(!qi&&globalThis.SPECTOR&&(ht.probe(kR,"SPECTOR found and initialized")(),qi=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=qi)),!qi))return null;if(h1||(h1=!0,qi.spyCanvases(),qi==null||qi.onCaptureStarted.add(e=>ht.info("Spector capture started:",e)()),qi==null||qi.onCapture.add(e=>{ht.info("Spector capture complete:",e)(),qi==null||qi.getResultUI(),qi==null||qi.resultView.display(),qi==null||qi.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return qi;qi==null||qi.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{ht.info("Spector capture stopped after 2 seconds")(),qi==null||qi.stopCapture()})}return qi}const FR="https://unpkg.com/webgl-debug@2.0.1/index.js";function mv(t){return t.luma=t.luma||{},t.luma}async function OR(){Al()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await gb(FR))}function LR(t,e={}){return t?e.debug?zR(t,e):NR(t):null}function NR(t){const e=mv(t);return e.realContext?e.realContext:t}function zR(t,e){if(!globalThis.WebGLDebugUtils)return ht.warn("webgl-debug not loaded")(),t;const i=mv(t);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...sh,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,UR.bind(null,e),VR.bind(null,e));for(const _ in sh)!(_ in r)&&typeof sh[_]=="number"&&(r[_]=sh[_]);class o{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(o,r);const u=Object.create(o);return i.realContext=t,i.debugContext=u,u.debug=!0,u}function M0(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${t}(${i})`}function UR(t,e,i,r){r=Array.from(r).map(l=>l===void 0?"undefined":l);const o=globalThis.WebGLDebugUtils.glEnumToString(e),u=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,r),_=`${o} in gl.${i}(${u})`;ht.error(_)();debugger;if(t.throwOnError)throw new Error(_)}function VR(t,e,i){let r="";if(ht.level>=1&&(r=M0(e,i),ht.log(1,r)()),t.break&&t.break.length>0&&(r=r||M0(e,i),t.break.every(u=>r.indexOf(u)!==-1)))debugger;for(const o of i)if(o===void 0){if(r=r||M0(e,i),t.throwOnError)throw new Error(`Undefined argument: ${r}`);ht.error(`Undefined argument: ${r}`)();debugger}}function jR(t){const e=t.split(/\r?\n/),i=[];for(const r of e){if(r.length<=1)continue;const o=r.split(":");if(o.length===2){const[z,V]=o;i.push({message:V.trim(),type:u1(z),lineNum:0,linePos:0});continue}const[u,_,l,...I]=o;let R=parseInt(l,10);isNaN(R)&&(R=0);let L=parseInt(_,10);isNaN(L)&&(L=0),i.push({message:I.join(":").trim(),type:u1(u),lineNum:R,linePos:L})}return i}function u1(t){const e=["warning","error","info"],i=t.toLowerCase();return e.includes(i)?i:"info"}class $R extends bf{constructor(i,r){super(i,r);ie(this,"device");ie(this,"handle");switch(this.device=i,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const i=this.device.gl.getShaderInfoLog(this.handle);return jR(i)}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return r==null?void 0:r.getTranslatedShaderSource(this.handle)}async _compile(i){i=(u=>u.startsWith("#version ")?u:`#version 100
${u}`)(i);const{gl:o}=this.device;if(o.shaderSource(this.handle,i),o.compileShader(this.handle),ht.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ht.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ht.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const i=async u=>await new Promise(_=>setTimeout(_,u));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:o}=this.device;for(;;){if(o.getShaderParameter(this.handle,37297))return;await i(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const WR=256,HR=1024,qR=16384,R0=6144,XR=[1,2,4,8];class ZR extends Q0{constructor(i,r){super(i,r);ie(this,"device");ie(this,"glParameters");this.device=i,od(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Nu(this.device.gl)}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}setParameters(i={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,i.viewport&&(i.viewport.length>=6?(r.viewport=i.viewport.slice(0,4),r.depthRange=[i.viewport[4],i.viewport[5]]):r.viewport=i.viewport),i.scissorRect&&(r.scissorTest=!0,r.scissor=i.scissorRect),i.blendConstant&&(r.blendColor=i.blendConstant),i.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),i[2967]=i.stencilReference),i.colorMask&&(r.colorMask=XR.map(o=>!!(o&i.colorMask))),this.glParameters=r,kh(this.device.gl,r)}beginOcclusionQuery(i){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const i=this.props.occlusionQuerySet;i==null||i.endOcclusionQuery()}clear(){const i={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=qR,i.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=WR,i.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=HR,i.clearStencil=this.props.clearStencil),r!==0&&ol(this.device.gl,i,()=>{this.device.gl.clear(r)})}clearColorBuffer(i=0,r=[0,0,0,0]){ol(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(R0,i,r);break;case Uint32Array:this.device.gl.clearBufferuiv(R0,i,r);break;case Float32Array:default:this.device.gl.clearBufferfv(R0,i,r);break}})}}const YR="Failed to deduce GL constant from typed array";function GR(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(YR)}}function yp(t,e){const{clamped:i=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const QR={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},KR={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Cu{constructor(...e){ie(this,"offset");ie(this,"stride");ie(this,"type");ie(this,"size");ie(this,"divisor");ie(this,"normalized");ie(this,"integer");ie(this,"buffer");ie(this,"index");e.forEach(i=>this._assign(i)),Object.freeze(this)}static getBytesPerElement(e){return yp(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return er(e.size),yp(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Cu(QR,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Cu.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Cu.getBytesPerVertex(this)}_assign(e={}){return e=GC("Accessor",e,KR),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function JR(t){return e5.includes(t)}const e5=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],yv={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function bv(t){const e=yv[t];if(!e)throw new Error("uniform");const[i,r,,o]=e;return{format:o,components:r,glType:i}}function t5(t){const e=yv[t];if(!e)throw new Error("attribute");const[,i,,r,o]=e;return{attributeType:r,vertexFormat:o,components:i}}function i5(t,e){const i={attributes:[],bindings:[]};i.attributes=r5(t,e);const r=o5(t,e);for(const l of r){const I=l.uniforms.map(R=>({name:R.name,format:R.format,byteOffset:R.byteOffset,byteStride:R.byteStride,arrayLength:R.arrayLength}));i.bindings.push({type:"uniform",name:l.name,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:I})}const o=n5(t,e);let u=0;for(const l of o)if(JR(l.type)){const{viewDimension:I,sampleType:R}=l5(l.type);i.bindings.push({type:"texture",name:l.name,location:u,viewDimension:I,sampleType:R}),l.textureUnit=u,u+=1}o.length&&(i.uniforms=o);const _=s5(t,e);return _!=null&&_.length&&(i.varyings=_),i}function r5(t,e){const i=[],r=t.getProgramParameter(e,35721);for(let o=0;o<r;o++){const u=t.getActiveAttrib(e,o);if(!u)throw new Error("activeInfo");const{name:_,type:l}=u,I=t.getAttribLocation(e,_);if(I>=0){const{attributeType:R}=t5(l),L=/instance/i.test(_)?"instance":"vertex";i.push({name:_,location:I,stepMode:L,type:R})}}return i.sort((o,u)=>o.location-u.location),i}function s5(t,e){const i=[],r=t.getProgramParameter(e,35971);for(let o=0;o<r;o++){const u=t.getTransformFeedbackVarying(e,o);if(!u)throw new Error("activeInfo");const{name:_,type:l,size:I}=u,{glType:R,components:L}=bv(l),z=new Cu({type:R,size:I*L}),V={location:o,name:_,accessor:z};i.push(V)}return i.sort((o,u)=>o.location-u.location),i}function n5(t,e){const i=[],r=t.getProgramParameter(e,35718);for(let o=0;o<r;o++){const u=t.getActiveUniform(e,o);if(!u)throw new Error("activeInfo");const{name:_,size:l,type:I}=u,{name:R,isArray:L}=c5(_);let z=t.getUniformLocation(e,R);const V={location:z,name:R,size:l,type:I,isArray:L};if(i.push(V),V.size>1)for(let q=0;q<V.size;q++){const ne=`${R}[${q}]`;z=t.getUniformLocation(e,ne);const Ae={...V,name:ne,location:z};i.push(Ae)}}return i}function o5(t,e){const i=(u,_)=>t.getActiveUniformBlockParameter(e,u,_),r=[],o=t.getProgramParameter(e,35382);for(let u=0;u<o;u++){const _={name:t.getActiveUniformBlockName(e,u)||"",location:i(u,35391),byteLength:i(u,35392),vertex:i(u,35396),fragment:i(u,35398),uniformCount:i(u,35394),uniforms:[]},l=i(u,35395)||[],I=t.getActiveUniforms(e,l,35383),R=t.getActiveUniforms(e,l,35384),L=t.getActiveUniforms(e,l,35387),z=t.getActiveUniforms(e,l,35388);for(let V=0;V<_.uniformCount;++V){const q=t.getActiveUniform(e,l[V]);if(!q)throw new Error("activeInfo");_.uniforms.push({name:q.name,format:bv(I[V]).format,type:I[V],arrayLength:R[V],byteOffset:L[V],byteStride:z[V]})}r.push(_)}return r.sort((u,_)=>u.location-_.location),r}const a5={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function l5(t){const e=a5[t];if(!e)throw new Error("sampler");const[i,r]=e;return{viewDimension:i,sampleType:r}}function c5(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const i=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!i||i.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:i[1],length:i[2]?1:0,isArray:!!i[2]}}function h5(t,e,i,r){const o=t;let u=r;u===!0&&(u=1),u===!1&&(u=0);const _=typeof u=="number"?[u]:u;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,_);case 35664:return t.uniform2fv(e,_);case 35665:return t.uniform3fv(e,_);case 35666:return t.uniform4fv(e,_);case 5124:return t.uniform1iv(e,_);case 35667:return t.uniform2iv(e,_);case 35668:return t.uniform3iv(e,_);case 35669:return t.uniform4iv(e,_);case 35670:return t.uniform1iv(e,_);case 35671:return t.uniform2iv(e,_);case 35672:return t.uniform3iv(e,_);case 35673:return t.uniform4iv(e,_);case 5125:return o.uniform1uiv(e,_,1);case 36294:return o.uniform2uiv(e,_,2);case 36295:return o.uniform3uiv(e,_,3);case 36296:return o.uniform4uiv(e,_,4);case 35674:return t.uniformMatrix2fv(e,!1,_);case 35675:return t.uniformMatrix3fv(e,!1,_);case 35676:return t.uniformMatrix4fv(e,!1,_);case 35685:return o.uniformMatrix2x3fv(e,!1,_);case 35686:return o.uniformMatrix2x4fv(e,!1,_);case 35687:return o.uniformMatrix3x2fv(e,!1,_);case 35688:return o.uniformMatrix3x4fv(e,!1,_);case 35689:return o.uniformMatrix4x2fv(e,!1,_);case 35690:return o.uniformMatrix4x3fv(e,!1,_)}throw new Error("Illegal uniform")}function u5(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function A5(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const A1=4;class f5 extends xh{constructor(i,r){super(i,r);ie(this,"device");ie(this,"handle");ie(this,"vs");ie(this,"fs");ie(this,"introspectedLayout");ie(this,"uniforms",{});ie(this,"bindings",{});ie(this,"varyings",null);ie(this,"_uniformCount",0);ie(this,"_uniformSetters",{});this.device=i,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:o,bufferMode:u=35981}=r;switch(o&&o.length>0&&(this.varyings=o,this.device.gl.transformFeedbackVaryings(this.handle,o,u)),this._linkShaders(),ht.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=i5(this.device.gl,this.handle),ht.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=LC(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":ht.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(i,r){for(const[o,u]of Object.entries(i)){const _=this.shaderLayout.bindings.find(l=>l.name===o)||this.shaderLayout.bindings.find(l=>l.name===`${o}Uniforms`);if(!_){const l=this.shaderLayout.bindings.map(I=>`"${I.name}"`).join(", ");r!=null&&r.disableWarnings||ht.warn(`Unknown binding "${o}" in render pipeline "${this.id}", expected one of ${l}`)();continue}switch(u||ht.warn(`Unsetting binding "${o}" in render pipeline "${this.id}"`)(),_.type){case"uniform":if(!(u instanceof cl)&&!(u.buffer instanceof cl))throw new Error("buffer value");break;case"texture":if(!(u instanceof ah||u instanceof $o||u instanceof Su))throw new Error("texture value");break;case"sampler":ht.warn(`Ignoring sampler ${o}`)();break;default:throw new Error(_.type)}this.bindings[o]=u}}draw(i){var Ee;const{renderPass:r,parameters:o=this.props.parameters,topology:u=this.props.topology,vertexArray:_,vertexCount:l,instanceCount:I,isInstanced:R=!1,firstVertex:L=0,transformFeedback:z}=i,V=u5(u),q=!!_.indexBuffer,ne=(Ee=_.indexBuffer)==null?void 0:Ee.glIndexType;if(this.linkStatus!=="success")return ht.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||l===0)return ht.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(l===0)return ht.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),_.bindBeforeRender(r),z&&z.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const Ae=r;return _R(this.device,o,Ae.glParameters,()=>{q&&R?this.device.gl.drawElementsInstanced(V,l||0,ne,L,I||0):q?this.device.gl.drawElements(V,l||0,ne,L):R?this.device.gl.drawArraysInstanced(V,L,l||0,I||0):this.device.gl.drawArrays(V,L,l||0),z&&z.end()}),_.unbindAfterRender(r),!0}setUniformsWebGL(i){const{bindings:r}=Qp(i);Object.keys(r).forEach(o=>{ht.warn(`Unsupported value "${JSON.stringify(r[o])}" used in setUniforms() for key ${o}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,i)}async _linkShaders(){const{gl:i}=this.device;if(i.attachShader(this.handle,this.vs.handle),i.attachShader(this.handle,this.fs.handle),ht.time(A1,`linkProgram for ${this.id}`)(),i.linkProgram(this.handle),ht.timeEnd(A1,`linkProgram for ${this.id}`)(),ht.level,!this.device.features.has("compilation-status-async-webgl")){const o=this._getLinkStatus();this._reportLinkStatus(o);return}ht.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ht.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(i){var r;switch(i){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${i}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:i}=this.device;return i.getProgramParameter(this.handle,35714)?(i.validateProgram(this.handle),i.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const i=async u=>await new Promise(_=>setTimeout(_,u));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:o}=this.device;for(;;){if(o.getProgramParameter(this.handle,37297))return;await i(10)}}_areTexturesRenderable(){let i=!0;for(const[,r]of Object.entries(this.bindings))r instanceof $o&&(r.update(),i=i&&r.loaded);return i}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:i}=this.device;i.useProgram(this.handle);let r=0,o=0;for(const u of this.shaderLayout.bindings){const _=this.bindings[u.name]||this.bindings[u.name.replace(/Uniforms$/,"")];if(!_)throw new Error(`No value for binding ${u.name} in ${this.id}`);switch(u.type){case"uniform":const{name:l}=u,I=i.getUniformBlockIndex(this.handle,l);if(I===4294967295)throw new Error(`Invalid uniform block name ${l}`);i.uniformBlockBinding(this.handle,o,I),_ instanceof cl?i.bindBufferBase(35345,o,_.handle):i.bindBufferRange(35345,o,_.buffer.handle,_.offset||0,_.size||_.buffer.byteLength-_.offset),o+=1;break;case"texture":if(!(_ instanceof ah||_ instanceof $o||_ instanceof Su))throw new Error("texture");let R;if(_ instanceof ah)R=_.texture;else if(_ instanceof $o)R=_;else if(_ instanceof Su&&_.colorAttachments[0]instanceof ah)ht.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),R=_.colorAttachments[0].texture;else throw new Error("No texture");i.activeTexture(33984+r),i.bindTexture(R.target,R.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${u.type}' not supported in WebGL`)}}}_applyUniforms(){for(const i of this.shaderLayout.uniforms||[]){const{name:r,location:o,type:u,textureUnit:_}=i,l=this.uniforms[r]??_;l!==void 0&&h5(this.device.gl,o,u,l)}}}class d5 extends J0{constructor(i){super(i,{});ie(this,"device");ie(this,"commands",[]);this.device=i}submitCommands(i=this.commands){for(const r of i)switch(r.name){case"copy-buffer-to-buffer":p5(this.device,r.options);break;case"copy-buffer-to-texture":g5(this.device,r.options);break;case"copy-texture-to-buffer":_5(this.device,r.options);break;case"copy-texture-to-texture":m5(this.device,r.options);break}}}function p5(t,e){const i=e.source,r=e.destination;t.gl.bindBuffer(36662,i.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function g5(t,e){throw new Error("Not implemented")}function _5(t,e){const{source:i,mipLevel:r=0,aspect:o="all",width:u=e.source.width,height:_=e.source.height,depthOrArrayLayers:l=0,origin:I=[0,0],destination:R,byteOffset:L=0,bytesPerRow:z,rowsPerImage:V}=e;if(o!=="all")throw new Error("not supported");if(r!==0||l!==0||z||V)throw new Error("not implemented");const{framebuffer:q,destroyFramebuffer:ne}=vv(i);let Ae;try{const Ee=R,Ce=u||q.width,Le=_||q.height,Oe=Rf(q.texture.props.format),Ne=Oe.dataFormat,Qe=Oe.type;t.gl.bindBuffer(35051,Ee.handle),Ae=t.gl.bindFramebuffer(36160,q.handle),t.gl.readPixels(I[0],I[1],Ce,Le,Ne,Qe,L)}finally{t.gl.bindBuffer(35051,null),Ae!==void 0&&t.gl.bindFramebuffer(36160,Ae),ne&&q.destroy()}}function m5(t,e){const{source:i,destinationMipLevel:r=0,origin:o=[0,0],destinationOrigin:u=[0,0],destination:_}=e;let{width:l=e.destination.width,height:I=e.destination.height}=e;const{framebuffer:R,destroyFramebuffer:L}=vv(i),[z,V]=o,[q,ne,Ae]=u,Ee=t.gl.bindFramebuffer(36160,R.handle);let Ce=null,Le;if(_ instanceof $o)Ce=_,l=Number.isFinite(l)?l:Ce.width,I=Number.isFinite(I)?I:Ce.height,Ce.bind(0),Le=Ce.target;else throw new Error("invalid destination");switch(Le){case 3553:case 34067:t.gl.copyTexSubImage2D(Le,r,q,ne,z,V,l,I);break;case 35866:case 32879:t.gl.copyTexSubImage3D(Le,r,q,ne,Ae,z,V,l,I);break}Ce&&Ce.unbind(),t.gl.bindFramebuffer(36160,Ee),L&&R.destroy()}function vv(t){if(t instanceof $n){const{width:e,height:i,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:i,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class y5 extends K0{constructor(i,r){super(i,r);ie(this,"device");ie(this,"commandBuffer");this.device=i,this.commandBuffer=new d5(i)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(i){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:i})}copyBufferToTexture(i){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:i})}copyTextureToBuffer(i){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:i})}copyTextureToTexture(i){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:i})}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}resolveQuerySet(i,r,o){}}class ug extends ep{constructor(i,r){super(i,r);ie(this,"device");ie(this,"handle");ie(this,"buffer",null);ie(this,"bufferValue",null);this.device=i,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(i){return GT()==="Chrome"}destroy(){var i;super.destroy(),this.buffer&&((i=this.buffer)==null||i.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(i){const r=i;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(i,r){const o=r;if(o.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:u,type:_,stride:l,offset:I,normalized:R,integer:L,divisor:z}=this._getAccessor(i);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,o.handle),L?this.device.gl.vertexAttribIPointer(i,u,_,l,I):this.device.gl.vertexAttribPointer(i,u,_,R,l,I),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(i),this.device.gl.vertexAttribDivisor(i,z||0),this.attributes[i]=o,this.device.gl.bindVertexArray(null)}setConstantWebGL(i,r){this._enable(i,!1),this.attributes[i]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let i=0;i<this.maxVertexAttributes;++i){const r=this.attributes[i];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(i,r)}}_getAccessor(i){const r=this.attributeInfos[i];if(!r)throw new Error(`Unknown attribute location ${i}`);const o=dv(r.bufferDataType);return{size:r.bufferComponents,type:o,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(i,r=!0){const u=ug.isConstantAttributeZeroSupported(this.device)||i!==0;(r||u)&&(i=Number(i),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(i):this.device.gl.disableVertexAttribArray(i),this.device.gl.bindVertexArray(null))}getConstantBuffer(i,r){const o=b5(r),u=o.byteLength*i,_=o.length*i;if(this.buffer&&u!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${u} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:u}),l=l||!v5(o,this.bufferValue),l){const I=VC(r.constructor,_);jC({target:I,source:o,start:0,count:_}),this.buffer.write(I),this.bufferValue=r}return this.buffer}}function b5(t){return Array.isArray(t)?new Float32Array(t):t}function v5(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}class x5 extends tp{constructor(i,r){super(i,r);ie(this,"device");ie(this,"gl");ie(this,"handle");ie(this,"layout");ie(this,"buffers",{});ie(this,"unusedBuffers",{});ie(this,"bindOnUse",!0);ie(this,"_bound",!1);this.device=i,this.gl=i.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(i="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(A5(i))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(i){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in i)this.setBuffer(r,i[r])})}setBuffer(i,r){const o=this._getVaryingIndex(i),{buffer:u,byteLength:_,byteOffset:l}=this._getBufferRange(r);if(o<0){this.unusedBuffers[i]=u,ht.warn(`${this.id} unusedBuffers varying buffer ${i}`)();return}this.buffers[o]={buffer:u,byteLength:_,byteOffset:l},this.bindOnUse||this._bindBuffer(o,u,l,_)}getBuffer(i){if(f1(i))return this.buffers[i]||null;const r=this._getVaryingIndex(i);return r>=0?this.buffers[r]:null}bind(i=this.handle){if(typeof i!="function")return this.gl.bindTransformFeedback(36386,i),this;let r;return this._bound?r=i():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=i(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(i){if(i instanceof cl)return{buffer:i,byteOffset:0,byteLength:i.byteLength};const{buffer:r,byteOffset:o=0,byteLength:u=i.buffer.byteLength}=i;return{buffer:r,byteOffset:o,byteLength:u}}_getVaryingIndex(i){if(f1(i))return Number(i);for(const r of this.layout.varyings)if(i===r.name)return r.location;return-1}_bindBuffers(){for(const i in this.buffers){const{buffer:r,byteLength:o,byteOffset:u}=this._getBufferRange(this.buffers[i]);this._bindBuffer(Number(i),r,u,o)}}_unbindBuffers(){for(const i in this.buffers)this.gl.bindBufferBase(35982,Number(i),null)}_bindBuffer(i,r,o=0,u){const _=r&&r.handle;!_||u===void 0?this.gl.bindBufferBase(35982,i,_):this.gl.bindBufferRange(35982,i,_,o,u)}}function f1(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class w5 extends ip{constructor(i,r){super(i,r);ie(this,"device");ie(this,"handle");ie(this,"target",null);ie(this,"_queryPending",!1);ie(this,"_pollingPromise",null);if(this.device=i,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(i){return this._begin(i!=null&&i.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(i){this._queryPending||(this.target=i,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const i=this.device.gl.getQueryParameter(this.handle,34919);return i&&(this._queryPending=!1),i}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(i=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((o,u)=>{const _=()=>{this.isResultAvailable()?(o(this.getResult()),this._pollingPromise=null):r++>i?(u("Timed out"),this._pollingPromise=null):requestAnimationFrame(_)};requestAnimationFrame(_)}),this._pollingPromise}}function xv(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return er(!1),0}}function T5(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return er(!1),0}}function E5(t,e){var Ee,Ce;const{sourceX:i=0,sourceY:r=0,sourceFormat:o=6408,sourceAttachment:u=36064}=e||{};let{target:_=null,sourceWidth:l,sourceHeight:I,sourceType:R}=e||{};const{framebuffer:L,deleteFramebuffer:z}=wv(t);er(L);const{gl:V,handle:q}=L;l=l||L.width,I=I||L.height;const ne=u-36064;R=R||((Ce=(Ee=L.colorAttachments[ne])==null?void 0:Ee.texture)==null?void 0:Ce.type)||5121,_=P5(_,R,o,l,I),R=R||GR(_);const Ae=V.bindFramebuffer(36160,q);return V.readPixels(i,r,l,I,o,R,_),V.bindFramebuffer(36160,Ae||null),z&&L.destroy(),_}function S5(t,e){const{target:i,sourceX:r=0,sourceY:o=0,sourceFormat:u=6408,targetByteOffset:_=0}=e||{};let{sourceWidth:l,sourceHeight:I,sourceType:R}=e||{};const{framebuffer:L,deleteFramebuffer:z}=wv(t);er(L),l=l||L.width,I=I||L.height;const V=L;R=R||5121;let q=i;if(!q){const Ae=xv(u),Ee=T5(R),Ce=_+l*I*Ae*Ee;q=V.device.createBuffer({byteLength:Ce})}const ne=t.device.createCommandEncoder();return ne.copyTextureToBuffer({source:t,width:l,height:I,origin:[r,o],destination:q,byteOffset:_}),ne.destroy(),z&&L.destroy(),q}function wv(t){return t instanceof xf?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:C5(t),deleteFramebuffer:!0}}function C5(t,e){const{device:i,width:r,height:o,id:u}=t;return i.createFramebuffer({...e,id:`framebuffer-for-${u}`,width:r,height:o,colorAttachments:[t]})}function P5(t,e,i,r,o){if(t)return t;e=e||5121;const u=yp(e,{clamped:!1}),_=xv(i);return new u(r*o*_)}const I5=256,M5=1024,R5=16384,k5="clear: bad arguments";function D5(t,e){const{framebuffer:i=null,color:r=null,depth:o=null,stencil:u=null}=e||{},_={};i&&(_.framebuffer=i);let l=0;r&&(l|=R5,r!==!0&&(_.clearColor=r)),o&&(l|=I5,o!==!0&&(_.clearDepth=o)),u&&(l|=M5,o!==!0&&(_.clearStencil=o)),er(l!==0,k5);const I=t.gl;ol(I,_,()=>{I.clear(l)})}const uu=1,Yl=class Yl extends vh{constructor(i){var I,R;super({...i,id:i.id||hc("webgl-device")});ie(this,"type","webgl");ie(this,"handle");ie(this,"features");ie(this,"limits");ie(this,"info");ie(this,"canvasContext");ie(this,"lost");ie(this,"_resolveContextLost");ie(this,"renderPass",null);ie(this,"gl");ie(this,"debug",!1);ie(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});ie(this,"_extensions",{});ie(this,"_polyfilled",!1);ie(this,"spectorJS");ie(this,"_constants");const r=(I=i.gl)==null?void 0:I.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const o=((R=i.gl)==null?void 0:R.canvas)||i.canvas;this.canvasContext=new IR(this,{...i,canvas:o}),this.lost=new Promise(L=>{this._resolveContextLost=L});let u=i.gl||null;if(u||(u=Z6(this.canvasContext.canvas,{...i,onContextLost:L=>{var z;return(z=this._resolveContextLost)==null?void 0:z.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!u)throw new Error("WebGL context creation failed");this.handle=u,this.gl=u,this.gl.device=this,this.gl._version=2,i.spector&&(this.spectorJS=BR({...this.props,canvas:this.handle.canvas})),this.info=Y6(this.gl,this._extensions),this.limits=new pR(this.gl),this.features=new dR(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:_=!0,copyState:l=!1}=i;Av(this.gl,{enable:_,copyState:l,log:(...L)=>ht.log(1,...L)()}),i.debug&&(this.gl=LR(this.gl,{...i,throwOnError:!0}),this.debug=!0,ht.level=Math.max(ht.level,1),ht.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(i){if(i instanceof Yl)return i;if((i==null?void 0:i.device)instanceof vh)return i.device;if(!B5(i))throw new Error("Invalid WebGL2RenderingContext");return new Yl({gl:i})}static async create(i={}){var l;ht.groupCollapsed(uu,"WebGLDevice created")();const r=[];i.debug&&r.push(OR()),i.spector&&r.push(DR()),typeof i.canvas=="string"&&r.push(Gp.pageLoaded);const o=await Promise.allSettled(r);for(const I of o)I.status==="rejected"&&ht.error(`Failed to initialize debug libraries ${I.reason}`)();if(ht.probe(uu+1,"DOM is loaded")(),(l=i.gl)!=null&&l.device)return ht.warn("reattaching existing device")(),Yl.attach(i.gl);const u=new Yl(i),_=`Created ${u.type}${u.debug?" debug":""} context: ${u.info.vendor}, ${u.info.renderer} for canvas: ${u.canvasContext.id}`;return ht.probe(uu,_)(),ht.table(uu,u.info)(),ht.groupEnd(uu)(),u}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(i){return hg(this.gl,i,this._extensions)}isTextureFormatFilterable(i){return hR(this.gl,i,this._extensions)}isTextureFormatRenderable(i){return uR(this.gl,i,this._extensions)}createCanvasContext(i){throw new Error("WebGL only supports a single canvas")}createBuffer(i){const r=this._getBufferProps(i);return new cl(this,r)}_createTexture(i){return new $o(this,i)}createExternalTexture(i){throw new Error("createExternalTexture() not implemented")}createSampler(i){return new mp(this,i)}createShader(i){return new $R(this,i)}createFramebuffer(i){return new Su(this,i)}createVertexArray(i){return new ug(this,i)}createTransformFeedback(i){return new x5(this,i)}createQuerySet(i){return new w5(this,i)}createRenderPipeline(i){return new f5(this,i)}beginRenderPass(i){return new ZR(this,i)}createComputePipeline(i){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(i){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(i){return new y5(this,i)}submit(){var i;(i=this.renderPass)==null||i.end(),this.renderPass=null}readPixelsToArrayWebGL(i,r){return E5(i,r)}readPixelsToBufferWebGL(i,r){return S5(i,r)}setParametersWebGL(i){kh(this.gl,i)}getParametersWebGL(i){return uv(this.gl,i)}withParametersWebGL(i,r){return ol(this.gl,i,r)}clearWebGL(i){D5(this,i)}resetWebGL(){ht.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),V6(this.gl)}loseDevice(){var u;let i=!1;const o=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return o&&(i=!0,o.loseContext()),(u=this._resolveContextLost)==null||u.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){od(this.gl)}popState(){Nu(this.gl)}setSpectorMetadata(i,r){i.__SPECTOR_Metadata=r}getGLKey(i,r){r=r||this.gl2||this.gl;const o=Number(i);for(const u in r)if(r[u]===o)return`GL.${u}`;return String(i)}setConstantAttributeWebGL(i,r){const o=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(o).fill(null);const u=this._constants[i];switch(u&&N5(u,r)&&ht.info(1,`setConstantAttributeWebGL(${i}) could have been skipped, value unchanged`)(),this._constants[i]=r,r.constructor){case Float32Array:F5(this,i,r);break;case Int32Array:O5(this,i,r);break;case Uint32Array:L5(this,i,r);break;default:er(!1)}}getExtension(i){return ul(this.gl,i,this._extensions),this._extensions}};ie(Yl,"type","webgl");let Pu=Yl;function B5(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function F5(t,e,i){switch(i.length){case 1:t.gl.vertexAttrib1fv(e,i);break;case 2:t.gl.vertexAttrib2fv(e,i);break;case 3:t.gl.vertexAttrib3fv(e,i);break;case 4:t.gl.vertexAttrib4fv(e,i);break;default:er(!1)}}function O5(t,e,i){t.gl.vertexAttribI4iv(e,i)}function L5(t,e,i){t.gl.vertexAttribI4uiv(e,i)}function N5(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}var Tv={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,i,r,o){var u=["","webkit","Moz","MS","ms","o"],_=i.createElement("div"),l="function",I=Math.round,R=Math.abs,L=Date.now;function z(te,oe,we){return setTimeout(Oe(te,we),oe)}function V(te,oe,we){return Array.isArray(te)?(q(te,we[oe],we),!0):!1}function q(te,oe,we){var Ve;if(te)if(te.forEach)te.forEach(oe,we);else if(te.length!==o)for(Ve=0;Ve<te.length;)oe.call(we,te[Ve],Ve,te),Ve++;else for(Ve in te)te.hasOwnProperty(Ve)&&oe.call(we,te[Ve],Ve,te)}function ne(te,oe,we){var Ve="DEPRECATED METHOD: "+oe+`
`+we+` AT 
`;return function(){var rt=new Error("get-stack-trace"),Et=rt&&rt.stack?rt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ni=e.console&&(e.console.warn||e.console.log);return ni&&ni.call(e.console,Ve,Et),te.apply(this,arguments)}}var Ae;typeof Object.assign!="function"?Ae=function(oe){if(oe===o||oe===null)throw new TypeError("Cannot convert undefined or null to object");for(var we=Object(oe),Ve=1;Ve<arguments.length;Ve++){var rt=arguments[Ve];if(rt!==o&&rt!==null)for(var Et in rt)rt.hasOwnProperty(Et)&&(we[Et]=rt[Et])}return we}:Ae=Object.assign;var Ee=ne(function(oe,we,Ve){for(var rt=Object.keys(we),Et=0;Et<rt.length;)(!Ve||Ve&&oe[rt[Et]]===o)&&(oe[rt[Et]]=we[rt[Et]]),Et++;return oe},"extend","Use `assign`."),Ce=ne(function(oe,we){return Ee(oe,we,!0)},"merge","Use `assign`.");function Le(te,oe,we){var Ve=oe.prototype,rt;rt=te.prototype=Object.create(Ve),rt.constructor=te,rt._super=Ve,we&&Ae(rt,we)}function Oe(te,oe){return function(){return te.apply(oe,arguments)}}function Ne(te,oe){return typeof te==l?te.apply(oe&&oe[0]||o,oe):te}function Qe(te,oe){return te===o?oe:te}function Je(te,oe,we){q(at(oe),function(Ve){te.addEventListener(Ve,we,!1)})}function xt(te,oe,we){q(at(oe),function(Ve){te.removeEventListener(Ve,we,!1)})}function wt(te,oe){for(;te;){if(te==oe)return!0;te=te.parentNode}return!1}function ct(te,oe){return te.indexOf(oe)>-1}function at(te){return te.trim().split(/\s+/g)}function Vt(te,oe,we){if(te.indexOf&&!we)return te.indexOf(oe);for(var Ve=0;Ve<te.length;){if(we&&te[Ve][we]==oe||!we&&te[Ve]===oe)return Ve;Ve++}return-1}function Ot(te){return Array.prototype.slice.call(te,0)}function $t(te,oe,we){for(var Ve=[],rt=[],Et=0;Et<te.length;){var ni=oe?te[Et][oe]:te[Et];Vt(rt,ni)<0&&Ve.push(te[Et]),rt[Et]=ni,Et++}return we&&(oe?Ve=Ve.sort(function(nr,Er){return nr[oe]>Er[oe]}):Ve=Ve.sort()),Ve}function qt(te,oe){for(var we,Ve,rt=oe[0].toUpperCase()+oe.slice(1),Et=0;Et<u.length;){if(we=u[Et],Ve=we?we+rt:oe,Ve in te)return Ve;Et++}return o}var gi=1;function Nr(){return gi++}function hr(te){var oe=te.ownerDocument||te;return oe.defaultView||oe.parentWindow||e}var Ks=/mobile|tablet|ip(ad|hone|od)|android/i,Cn="ontouchstart"in e,qn=qt(e,"PointerEvent")!==o,Pn=Cn&&Ks.test(navigator.userAgent),ur="touch",Ei="pen",_r="mouse",ln="kinect",cn=25,Qi=1,Dr=2,yi=4,ki=8,Js=1,Xr=2,Ls=4,zr=8,ms=16,mr=Xr|Ls,Ki=zr|ms,Ur=mr|Ki,en=["x","y"],Xe=["clientX","clientY"];function _i(te,oe){var we=this;this.manager=te,this.callback=oe,this.element=te.element,this.target=te.options.inputTarget,this.domHandler=function(Ve){Ne(te.options.enable,[te])&&we.handler(Ve)},this.init()}_i.prototype={handler:function(){},init:function(){this.evEl&&Je(this.element,this.evEl,this.domHandler),this.evTarget&&Je(this.target,this.evTarget,this.domHandler),this.evWin&&Je(hr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&xt(this.element,this.evEl,this.domHandler),this.evTarget&&xt(this.target,this.evTarget,this.domHandler),this.evWin&&xt(hr(this.element),this.evWin,this.domHandler)}};function Br(te){var oe,we=te.options.inputClass;return we?oe=we:qn?oe=Ke:Pn?oe=Pe:Cn?oe=ue:oe=Yt,new oe(te,vi)}function vi(te,oe,we){var Ve=we.pointers.length,rt=we.changedPointers.length,Et=oe&Qi&&Ve-rt===0,ni=oe&(yi|ki)&&Ve-rt===0;we.isFirst=!!Et,we.isFinal=!!ni,Et&&(te.session={}),we.eventType=oe,oi(te,we),te.emit("hammer.input",we),te.recognize(we),te.session.prevInput=we}function oi(te,oe){var we=te.session,Ve=oe.pointers,rt=Ve.length;we.firstInput||(we.firstInput=ys(oe)),rt>1&&!we.firstMultiple?we.firstMultiple=ys(oe):rt===1&&(we.firstMultiple=!1);var Et=we.firstInput,ni=we.firstMultiple,Ji=ni?ni.center:Et.center,nr=oe.center=Mn(Ve);oe.timeStamp=L(),oe.deltaTime=oe.timeStamp-Et.timeStamp,oe.angle=st(Ji,nr),oe.distance=bs(Ji,nr),Zr(we,oe),oe.offsetDirection=Ns(oe.deltaX,oe.deltaY);var Er=tn(oe.deltaTime,oe.deltaX,oe.deltaY);oe.overallVelocityX=Er.x,oe.overallVelocityY=Er.y,oe.overallVelocity=R(Er.x)>R(Er.y)?Er.x:Er.y,oe.scale=ni?Ui(ni.pointers,Ve):1,oe.rotation=ni?vs(ni.pointers,Ve):0,oe.maxPointers=we.prevInput?oe.pointers.length>we.prevInput.maxPointers?oe.pointers.length:we.prevInput.maxPointers:oe.pointers.length,In(we,oe);var ui=te.element;wt(oe.srcEvent.target,ui)&&(ui=oe.srcEvent.target),oe.target=ui}function Zr(te,oe){var we=oe.center,Ve=te.offsetDelta||{},rt=te.prevDelta||{},Et=te.prevInput||{};(oe.eventType===Qi||Et.eventType===yi)&&(rt=te.prevDelta={x:Et.deltaX||0,y:Et.deltaY||0},Ve=te.offsetDelta={x:we.x,y:we.y}),oe.deltaX=rt.x+(we.x-Ve.x),oe.deltaY=rt.y+(we.y-Ve.y)}function In(te,oe){var we=te.lastInterval||oe,Ve=oe.timeStamp-we.timeStamp,rt,Et,ni,Ji;if(oe.eventType!=ki&&(Ve>cn||we.velocity===o)){var nr=oe.deltaX-we.deltaX,Er=oe.deltaY-we.deltaY,ui=tn(Ve,nr,Er);Et=ui.x,ni=ui.y,rt=R(ui.x)>R(ui.y)?ui.x:ui.y,Ji=Ns(nr,Er),te.lastInterval=oe}else rt=we.velocity,Et=we.velocityX,ni=we.velocityY,Ji=we.direction;oe.velocity=rt,oe.velocityX=Et,oe.velocityY=ni,oe.direction=Ji}function ys(te){for(var oe=[],we=0;we<te.pointers.length;)oe[we]={clientX:I(te.pointers[we].clientX),clientY:I(te.pointers[we].clientY)},we++;return{timeStamp:L(),pointers:oe,center:Mn(oe),deltaX:te.deltaX,deltaY:te.deltaY}}function Mn(te){var oe=te.length;if(oe===1)return{x:I(te[0].clientX),y:I(te[0].clientY)};for(var we=0,Ve=0,rt=0;rt<oe;)we+=te[rt].clientX,Ve+=te[rt].clientY,rt++;return{x:I(we/oe),y:I(Ve/oe)}}function tn(te,oe,we){return{x:oe/te||0,y:we/te||0}}function Ns(te,oe){return te===oe?Js:R(te)>=R(oe)?te<0?Xr:Ls:oe<0?zr:ms}function bs(te,oe,we){we||(we=en);var Ve=oe[we[0]]-te[we[0]],rt=oe[we[1]]-te[we[1]];return Math.sqrt(Ve*Ve+rt*rt)}function st(te,oe,we){we||(we=en);var Ve=oe[we[0]]-te[we[0]],rt=oe[we[1]]-te[we[1]];return Math.atan2(rt,Ve)*180/Math.PI}function vs(te,oe){return st(oe[1],oe[0],Xe)+st(te[1],te[0],Xe)}function Ui(te,oe){return bs(oe[0],oe[1],Xe)/bs(te[0],te[1],Xe)}var hn={mousedown:Qi,mousemove:Dr,mouseup:yi},xs="mousedown",nt="mousemove mouseup";function Yt(){this.evEl=xs,this.evWin=nt,this.pressed=!1,_i.apply(this,arguments)}Le(Yt,_i,{handler:function(oe){var we=hn[oe.type];we&Qi&&oe.button===0&&(this.pressed=!0),we&Dr&&oe.which!==1&&(we=yi),this.pressed&&(we&yi&&(this.pressed=!1),this.callback(this.manager,we,{pointers:[oe],changedPointers:[oe],pointerType:_r,srcEvent:oe}))}});var Xt={pointerdown:Qi,pointermove:Dr,pointerup:yi,pointercancel:ki,pointerout:ki},Ar={2:ur,3:Ei,4:_r,5:ln},ns="pointerdown",Gt="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(ns="MSPointerDown",Gt="MSPointerMove MSPointerUp MSPointerCancel");function Ke(){this.evEl=ns,this.evWin=Gt,_i.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Le(Ke,_i,{handler:function(oe){var we=this.store,Ve=!1,rt=oe.type.toLowerCase().replace("ms",""),Et=Xt[rt],ni=Ar[oe.pointerType]||oe.pointerType,Ji=ni==ur,nr=Vt(we,oe.pointerId,"pointerId");Et&Qi&&(oe.button===0||Ji)?nr<0&&(we.push(oe),nr=we.length-1):Et&(yi|ki)&&(Ve=!0),!(nr<0)&&(we[nr]=oe,this.callback(this.manager,Et,{pointers:we,changedPointers:[oe],pointerType:ni,srcEvent:oe}),Ve&&we.splice(nr,1))}});var fe={touchstart:Qi,touchmove:Dr,touchend:yi,touchcancel:ki},X="touchstart",Q="touchstart touchmove touchend touchcancel";function ae(){this.evTarget=X,this.evWin=Q,this.started=!1,_i.apply(this,arguments)}Le(ae,_i,{handler:function(oe){var we=fe[oe.type];if(we===Qi&&(this.started=!0),!!this.started){var Ve=pe.call(this,oe,we);we&(yi|ki)&&Ve[0].length-Ve[1].length===0&&(this.started=!1),this.callback(this.manager,we,{pointers:Ve[0],changedPointers:Ve[1],pointerType:ur,srcEvent:oe})}}});function pe(te,oe){var we=Ot(te.touches),Ve=Ot(te.changedTouches);return oe&(yi|ki)&&(we=$t(we.concat(Ve),"identifier",!0)),[we,Ve]}var ge={touchstart:Qi,touchmove:Dr,touchend:yi,touchcancel:ki},ke="touchstart touchmove touchend touchcancel";function Pe(){this.evTarget=ke,this.targetIds={},_i.apply(this,arguments)}Le(Pe,_i,{handler:function(oe){var we=ge[oe.type],Ve=ye.call(this,oe,we);Ve&&this.callback(this.manager,we,{pointers:Ve[0],changedPointers:Ve[1],pointerType:ur,srcEvent:oe})}});function ye(te,oe){var we=Ot(te.touches),Ve=this.targetIds;if(oe&(Qi|Dr)&&we.length===1)return Ve[we[0].identifier]=!0,[we,we];var rt,Et,ni=Ot(te.changedTouches),Ji=[],nr=this.target;if(Et=we.filter(function(Er){return wt(Er.target,nr)}),oe===Qi)for(rt=0;rt<Et.length;)Ve[Et[rt].identifier]=!0,rt++;for(rt=0;rt<ni.length;)Ve[ni[rt].identifier]&&Ji.push(ni[rt]),oe&(yi|ki)&&delete Ve[ni[rt].identifier],rt++;if(Ji.length)return[$t(Et.concat(Ji),"identifier",!0),Ji]}var Me=2500,qe=25;function ue(){_i.apply(this,arguments);var te=Oe(this.handler,this);this.touch=new Pe(this.manager,te),this.mouse=new Yt(this.manager,te),this.primaryTouch=null,this.lastTouches=[]}Le(ue,_i,{handler:function(oe,we,Ve){var rt=Ve.pointerType==ur,Et=Ve.pointerType==_r;if(!(Et&&Ve.sourceCapabilities&&Ve.sourceCapabilities.firesTouchEvents)){if(rt)Se.call(this,we,Ve);else if(Et&&et.call(this,Ve))return;this.callback(oe,we,Ve)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Se(te,oe){te&Qi?(this.primaryTouch=oe.changedPointers[0].identifier,We.call(this,oe)):te&(yi|ki)&&We.call(this,oe)}function We(te){var oe=te.changedPointers[0];if(oe.identifier===this.primaryTouch){var we={x:oe.clientX,y:oe.clientY};this.lastTouches.push(we);var Ve=this.lastTouches,rt=function(){var Et=Ve.indexOf(we);Et>-1&&Ve.splice(Et,1)};setTimeout(rt,Me)}}function et(te){for(var oe=te.srcEvent.clientX,we=te.srcEvent.clientY,Ve=0;Ve<this.lastTouches.length;Ve++){var rt=this.lastTouches[Ve],Et=Math.abs(oe-rt.x),ni=Math.abs(we-rt.y);if(Et<=qe&&ni<=qe)return!0}return!1}var g=qt(_.style,"touchAction"),K=g!==o,ut="compute",Bt="auto",Zt="manipulation",ft="none",yt="pan-x",Si="pan-y",Lt=Tr();function Rt(te,oe){this.manager=te,this.set(oe)}Rt.prototype={set:function(te){te==ut&&(te=this.compute()),K&&this.manager.element.style&&Lt[te]&&(this.manager.element.style[g]=te),this.actions=te.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var te=[];return q(this.manager.recognizers,function(oe){Ne(oe.options.enable,[oe])&&(te=te.concat(oe.getTouchAction()))}),wi(te.join(" "))},preventDefaults:function(te){var oe=te.srcEvent,we=te.offsetDirection;if(this.manager.session.prevented){oe.preventDefault();return}var Ve=this.actions,rt=ct(Ve,ft)&&!Lt[ft],Et=ct(Ve,Si)&&!Lt[Si],ni=ct(Ve,yt)&&!Lt[yt];if(rt){var Ji=te.pointers.length===1,nr=te.distance<2,Er=te.deltaTime<250;if(Ji&&nr&&Er)return}if(!(ni&&Et)&&(rt||Et&&we&mr||ni&&we&Ki))return this.preventSrc(oe)},preventSrc:function(te){this.manager.session.prevented=!0,te.preventDefault()}};function wi(te){if(ct(te,ft))return ft;var oe=ct(te,yt),we=ct(te,Si);return oe&&we?ft:oe||we?oe?yt:Si:ct(te,Zt)?Zt:Bt}function Tr(){if(!K)return!1;var te={},oe=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(we){te[we]=oe?e.CSS.supports("touch-action",we):!0}),te}var Xn=1,tr=2,Vi=4,Vr=8,Qt=Vr,zs=16,jr=32;function bi(te){this.options=Ae({},this.defaults,te||{}),this.id=Nr(),this.manager=null,this.options.enable=Qe(this.options.enable,!0),this.state=Xn,this.simultaneous={},this.requireFail=[]}bi.prototype={defaults:{},set:function(te){return Ae(this.options,te),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(te){if(V(te,"recognizeWith",this))return this;var oe=this.simultaneous;return te=Pt(te,this),oe[te.id]||(oe[te.id]=te,te.recognizeWith(this)),this},dropRecognizeWith:function(te){return V(te,"dropRecognizeWith",this)?this:(te=Pt(te,this),delete this.simultaneous[te.id],this)},requireFailure:function(te){if(V(te,"requireFailure",this))return this;var oe=this.requireFail;return te=Pt(te,this),Vt(oe,te)===-1&&(oe.push(te),te.requireFailure(this)),this},dropRequireFailure:function(te){if(V(te,"dropRequireFailure",this))return this;te=Pt(te,this);var oe=Vt(this.requireFail,te);return oe>-1&&this.requireFail.splice(oe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(te){return!!this.simultaneous[te.id]},emit:function(te){var oe=this,we=this.state;function Ve(rt){oe.manager.emit(rt,te)}we<Vr&&Ve(oe.options.event+Wt(we)),Ve(oe.options.event),te.additionalEvent&&Ve(te.additionalEvent),we>=Vr&&Ve(oe.options.event+Wt(we))},tryEmit:function(te){if(this.canEmit())return this.emit(te);this.state=jr},canEmit:function(){for(var te=0;te<this.requireFail.length;){if(!(this.requireFail[te].state&(jr|Xn)))return!1;te++}return!0},recognize:function(te){var oe=Ae({},te);if(!Ne(this.options.enable,[this,oe])){this.reset(),this.state=jr;return}this.state&(Qt|zs|jr)&&(this.state=Xn),this.state=this.process(oe),this.state&(tr|Vi|Vr|zs)&&this.tryEmit(oe)},process:function(te){},getTouchAction:function(){},reset:function(){}};function Wt(te){return te&zs?"cancel":te&Vr?"end":te&Vi?"move":te&tr?"start":""}function le(te){return te==ms?"down":te==zr?"up":te==Xr?"left":te==Ls?"right":""}function Pt(te,oe){var we=oe.manager;return we?we.get(te):te}function Ti(){bi.apply(this,arguments)}Le(Ti,bi,{defaults:{pointers:1},attrTest:function(te){var oe=this.options.pointers;return oe===0||te.pointers.length===oe},process:function(te){var oe=this.state,we=te.eventType,Ve=oe&(tr|Vi),rt=this.attrTest(te);return Ve&&(we&ki||!rt)?oe|zs:Ve||rt?we&yi?oe|Vr:oe&tr?oe|Vi:tr:jr}});function un(){Ti.apply(this,arguments),this.pX=null,this.pY=null}Le(un,Ti,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ur},getTouchAction:function(){var te=this.options.direction,oe=[];return te&mr&&oe.push(Si),te&Ki&&oe.push(yt),oe},directionTest:function(te){var oe=this.options,we=!0,Ve=te.distance,rt=te.direction,Et=te.deltaX,ni=te.deltaY;return rt&oe.direction||(oe.direction&mr?(rt=Et===0?Js:Et<0?Xr:Ls,we=Et!=this.pX,Ve=Math.abs(te.deltaX)):(rt=ni===0?Js:ni<0?zr:ms,we=ni!=this.pY,Ve=Math.abs(te.deltaY))),te.direction=rt,we&&Ve>oe.threshold&&rt&oe.direction},attrTest:function(te){return Ti.prototype.attrTest.call(this,te)&&(this.state&tr||!(this.state&tr)&&this.directionTest(te))},emit:function(te){this.pX=te.deltaX,this.pY=te.deltaY;var oe=le(te.direction);oe&&(te.additionalEvent=this.options.event+oe),this._super.emit.call(this,te)}});function rn(){Ti.apply(this,arguments)}Le(rn,Ti,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ft]},attrTest:function(te){return this._super.attrTest.call(this,te)&&(Math.abs(te.scale-1)>this.options.threshold||this.state&tr)},emit:function(te){if(te.scale!==1){var oe=te.scale<1?"in":"out";te.additionalEvent=this.options.event+oe}this._super.emit.call(this,te)}});function Pi(){bi.apply(this,arguments),this._timer=null,this._input=null}Le(Pi,bi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Bt]},process:function(te){var oe=this.options,we=te.pointers.length===oe.pointers,Ve=te.distance<oe.threshold,rt=te.deltaTime>oe.time;if(this._input=te,!Ve||!we||te.eventType&(yi|ki)&&!rt)this.reset();else if(te.eventType&Qi)this.reset(),this._timer=z(function(){this.state=Qt,this.tryEmit()},oe.time,this);else if(te.eventType&yi)return Qt;return jr},reset:function(){clearTimeout(this._timer)},emit:function(te){this.state===Qt&&(te&&te.eventType&yi?this.manager.emit(this.options.event+"up",te):(this._input.timeStamp=L(),this.manager.emit(this.options.event,this._input)))}});function fi(){Ti.apply(this,arguments)}Le(fi,Ti,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ft]},attrTest:function(te){return this._super.attrTest.call(this,te)&&(Math.abs(te.rotation)>this.options.threshold||this.state&tr)}});function re(){Ti.apply(this,arguments)}Le(re,Ti,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:mr|Ki,pointers:1},getTouchAction:function(){return un.prototype.getTouchAction.call(this)},attrTest:function(te){var oe=this.options.direction,we;return oe&(mr|Ki)?we=te.overallVelocity:oe&mr?we=te.overallVelocityX:oe&Ki&&(we=te.overallVelocityY),this._super.attrTest.call(this,te)&&oe&te.offsetDirection&&te.distance>this.options.threshold&&te.maxPointers==this.options.pointers&&R(we)>this.options.velocity&&te.eventType&yi},emit:function(te){var oe=le(te.offsetDirection);oe&&this.manager.emit(this.options.event+oe,te),this.manager.emit(this.options.event,te)}});function Ii(){bi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Le(Ii,bi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Zt]},process:function(te){var oe=this.options,we=te.pointers.length===oe.pointers,Ve=te.distance<oe.threshold,rt=te.deltaTime<oe.time;if(this.reset(),te.eventType&Qi&&this.count===0)return this.failTimeout();if(Ve&&rt&&we){if(te.eventType!=yi)return this.failTimeout();var Et=this.pTime?te.timeStamp-this.pTime<oe.interval:!0,ni=!this.pCenter||bs(this.pCenter,te.center)<oe.posThreshold;this.pTime=te.timeStamp,this.pCenter=te.center,!ni||!Et?this.count=1:this.count+=1,this._input=te;var Ji=this.count%oe.taps;if(Ji===0)return this.hasRequireFailures()?(this._timer=z(function(){this.state=Qt,this.tryEmit()},oe.interval,this),tr):Qt}return jr},failTimeout:function(){return this._timer=z(function(){this.state=jr},this.options.interval,this),jr},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Qt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Yr(te,oe){return oe=oe||{},oe.recognizers=Qe(oe.recognizers,Yr.defaults.preset),new ws(te,oe)}Yr.VERSION="2.0.7",Yr.defaults={domEvents:!1,touchAction:ut,enable:!0,inputTarget:null,inputClass:null,preset:[[fi,{enable:!1}],[rn,{enable:!1},["rotate"]],[re,{direction:mr}],[un,{direction:mr},["swipe"]],[Ii],[Ii,{event:"doubletap",taps:2},["tap"]],[Pi]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Gr=1,Ao=2;function ws(te,oe){this.options=Ae({},Yr.defaults,oe||{}),this.options.inputTarget=this.options.inputTarget||te,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=te,this.input=Br(this),this.touchAction=new Rt(this,this.options.touchAction),qo(this,!0),q(this.options.recognizers,function(we){var Ve=this.add(new we[0](we[1]));we[2]&&Ve.recognizeWith(we[2]),we[3]&&Ve.requireFailure(we[3])},this)}ws.prototype={set:function(te){return Ae(this.options,te),te.touchAction&&this.touchAction.update(),te.inputTarget&&(this.input.destroy(),this.input.target=te.inputTarget,this.input.init()),this},stop:function(te){this.session.stopped=te?Ao:Gr},recognize:function(te){var oe=this.session;if(!oe.stopped){this.touchAction.preventDefaults(te);var we,Ve=this.recognizers,rt=oe.curRecognizer;(!rt||rt&&rt.state&Qt)&&(rt=oe.curRecognizer=null);for(var Et=0;Et<Ve.length;)we=Ve[Et],oe.stopped!==Ao&&(!rt||we==rt||we.canRecognizeWith(rt))?we.recognize(te):we.reset(),!rt&&we.state&(tr|Vi|Vr)&&(rt=oe.curRecognizer=we),Et++}},get:function(te){if(te instanceof bi)return te;for(var oe=this.recognizers,we=0;we<oe.length;we++)if(oe[we].options.event==te)return oe[we];return null},add:function(te){if(V(te,"add",this))return this;var oe=this.get(te.options.event);return oe&&this.remove(oe),this.recognizers.push(te),te.manager=this,this.touchAction.update(),te},remove:function(te){if(V(te,"remove",this))return this;if(te=this.get(te),te){var oe=this.recognizers,we=Vt(oe,te);we!==-1&&(oe.splice(we,1),this.touchAction.update())}return this},on:function(te,oe){if(te!==o&&oe!==o){var we=this.handlers;return q(at(te),function(Ve){we[Ve]=we[Ve]||[],we[Ve].push(oe)}),this}},off:function(te,oe){if(te!==o){var we=this.handlers;return q(at(te),function(Ve){oe?we[Ve]&&we[Ve].splice(Vt(we[Ve],oe),1):delete we[Ve]}),this}},emit:function(te,oe){this.options.domEvents&&fo(te,oe);var we=this.handlers[te]&&this.handlers[te].slice();if(!(!we||!we.length)){oe.type=te,oe.preventDefault=function(){oe.srcEvent.preventDefault()};for(var Ve=0;Ve<we.length;)we[Ve](oe),Ve++}},destroy:function(){this.element&&qo(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function qo(te,oe){var we=te.element;if(we.style){var Ve;q(te.options.cssProps,function(rt,Et){Ve=qt(we.style,Et),oe?(te.oldCssProps[Ve]=we.style[Ve],we.style[Ve]=rt):we.style[Ve]=te.oldCssProps[Ve]||""}),oe||(te.oldCssProps={})}}function fo(te,oe){var we=i.createEvent("Event");we.initEvent(te,!0,!0),we.gesture=oe,oe.target.dispatchEvent(we)}Ae(Yr,{INPUT_START:Qi,INPUT_MOVE:Dr,INPUT_END:yi,INPUT_CANCEL:ki,STATE_POSSIBLE:Xn,STATE_BEGAN:tr,STATE_CHANGED:Vi,STATE_ENDED:Vr,STATE_RECOGNIZED:Qt,STATE_CANCELLED:zs,STATE_FAILED:jr,DIRECTION_NONE:Js,DIRECTION_LEFT:Xr,DIRECTION_RIGHT:Ls,DIRECTION_UP:zr,DIRECTION_DOWN:ms,DIRECTION_HORIZONTAL:mr,DIRECTION_VERTICAL:Ki,DIRECTION_ALL:Ur,Manager:ws,Input:_i,TouchAction:Rt,TouchInput:Pe,MouseInput:Yt,PointerEventInput:Ke,TouchMouseInput:ue,SingleTouchInput:ae,Recognizer:bi,AttrRecognizer:Ti,Tap:Ii,Pan:un,Swipe:re,Pinch:rn,Rotate:fi,Press:Pi,on:Je,off:xt,each:q,merge:Ce,extend:Ee,assign:Ae,inherit:Le,bindFn:Oe,prefixed:qt});var Zn=typeof e<"u"?e:typeof self<"u"?self:{};Zn.Hammer=Yr,typeof o=="function"&&o.amd?o(function(){return Yr}):t.exports?t.exports=Yr:e[r]=Yr})(window,document,"Hammer")})(Tv);var Ju=Tv.exports;const z5=Jf(Ju),zo=HT({__proto__:null,default:z5},[Ju]),Ev=1,Sv=2,bp=4,U5={mousedown:Ev,mousemove:Sv,mouseup:bp};function V5(t,e){for(let i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}function j5(t){const e=t.prototype.handler;t.prototype.handler=function(r){const o=this.store;r.button>0&&r.type==="pointerdown"&&(V5(o,u=>u.pointerId===r.pointerId)||o.push(r)),e.call(this,r)}}function $5(t){t.prototype.handler=function(i){let r=U5[i.type];r&Ev&&i.button>=0&&(this.pressed=!0),r&Sv&&i.buttons===0&&(r=bp),this.pressed&&(r&bp&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[i],changedPointers:[i],pointerType:"mouse",srcEvent:i}))}}j5(Ju.PointerEventInput);$5(Ju.MouseInput);const W5=Ju.Manager;class ld{constructor(e,i,r){this.element=e,this.callback=i,this.options={enable:!0,...r}}}const H5=zo?[[zo.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[zo.Rotate,{enable:!1}],[zo.Pinch,{enable:!1}],[zo.Swipe,{enable:!1}],[zo.Pan,{threshold:0,enable:!1}],[zo.Press,{enable:!1}],[zo.Tap,{event:"doubletap",taps:2,enable:!1}],[zo.Tap,{event:"anytap",enable:!1}],[zo.Tap,{enable:!1}]]:null,d1={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},q5={doubletap:["tap"]},X5={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Ag={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Z5={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},p1={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Y5=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",lh=typeof window<"u"?window:global;let vp=!1;try{const t={get passive(){return vp=!0,!0}};lh.addEventListener("test",null,t),lh.removeEventListener("test",null)}catch{vp=!1}const G5=Y5.indexOf("firefox")!==-1,{WHEEL_EVENTS:Q5}=Ag,g1="wheel",_1=4.000244140625,K5=40,J5=.25;class ek extends ld{constructor(e,i,r){super(e,i,r),this.handleEvent=o=>{if(!this.options.enable)return;let u=o.deltaY;lh.WheelEvent&&(G5&&o.deltaMode===lh.WheelEvent.DOM_DELTA_PIXEL&&(u/=lh.devicePixelRatio),o.deltaMode===lh.WheelEvent.DOM_DELTA_LINE&&(u*=K5)),u!==0&&u%_1===0&&(u=Math.floor(u/_1)),o.shiftKey&&u&&(u=u*J5),this.callback({type:g1,center:{x:o.clientX,y:o.clientY},delta:-u,srcEvent:o,pointerType:"mouse",target:o.target})},this.events=(this.options.events||[]).concat(Q5),this.events.forEach(o=>e.addEventListener(o,this.handleEvent,vp?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===g1&&(this.options.enable=i)}}const{MOUSE_EVENTS:tk}=Ag,m1="pointermove",y1="pointerover",b1="pointerout",v1="pointerenter",x1="pointerleave";class ik extends ld{constructor(e,i,r){super(e,i,r),this.handleEvent=u=>{this.handleOverEvent(u),this.handleOutEvent(u),this.handleEnterEvent(u),this.handleLeaveEvent(u),this.handleMoveEvent(u)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,this.events=(this.options.events||[]).concat(tk),this.events.forEach(u=>e.addEventListener(u,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===m1&&(this.enableMoveEvent=i),e===y1&&(this.enableOverEvent=i),e===b1&&(this.enableOutEvent=i),e===v1&&(this.enableEnterEvent=i),e===x1&&(this.enableLeaveEvent=i)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(y1,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(b1,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(v1,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(x1,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(m1,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:rk}=Ag,w1="keydown",T1="keyup";class sk extends ld{constructor(e,i,r){super(e,i,r),this.handleEvent=o=>{const u=o.target||o.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:w1,srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:T1,srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(rk),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===w1&&(this.enableDownEvent=i),e===T1&&(this.enableUpEvent=i)}}const E1="contextmenu";class nk extends ld{constructor(e,i,r){super(e,i,r),this.handleEvent=o=>{this.options.enable&&this.callback({type:E1,center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e===E1&&(this.options.enable=i)}}const S1=1,xp=2,C1=4,ok={pointerdown:S1,pointermove:xp,pointerup:C1,mousedown:S1,mousemove:xp,mouseup:C1},ak=0,lk=1,ck=2,hk=1,uk=2,Ak=4;function fk(t){const e=ok[t.srcEvent.type];if(!e)return null;const{buttons:i,button:r}=t.srcEvent;let o=!1,u=!1,_=!1;return e===xp?(o=!!(i&hk),u=!!(i&Ak),_=!!(i&uk)):(o=r===ak,u=r===lk,_=r===ck),{leftButton:o,middleButton:u,rightButton:_}}function dk(t,e){const i=t.center;if(!i)return null;const r=e.getBoundingClientRect(),o=r.width/e.offsetWidth||1,u=r.height/e.offsetHeight||1,_={x:(i.x-r.left-e.clientLeft)/o,y:(i.y-r.top-e.clientTop)/u};return{center:i,offsetCenter:_}}const k0={srcElement:"root",priority:0};class pk{constructor(e){this.handleEvent=i=>{if(this.isEmpty())return;const r=this._normalizeEvent(i);let o=i.srcEvent.target;for(;o&&o!==r.rootElement;){if(this._emit(r,o),r.handled)return;o=o.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,r,o=!1,u=!1){const{handlers:_,handlersByElement:l}=this;let I=k0;typeof r=="string"||r&&r.addEventListener?I={...k0,srcElement:r}:r&&(I={...k0,...r});let R=l.get(I.srcElement);R||(R=[],l.set(I.srcElement,R));const L={type:e,handler:i,srcElement:I.srcElement,priority:I.priority};o&&(L.once=!0),u&&(L.passive=!0),_.push(L),this._active=this._active||!L.passive;let z=R.length-1;for(;z>=0&&!(R[z].priority>=L.priority);)z--;R.splice(z+1,0,L)}remove(e,i){const{handlers:r,handlersByElement:o}=this;for(let u=r.length-1;u>=0;u--){const _=r[u];if(_.type===e&&_.handler===i){r.splice(u,1);const l=o.get(_.srcElement);l.splice(l.indexOf(_),1),l.length===0&&o.delete(_.srcElement)}}this._active=r.some(u=>!u.passive)}_emit(e,i){const r=this.handlersByElement.get(i);if(r){let o=!1;const u=()=>{e.handled=!0},_=()=>{e.handled=!0,o=!0},l=[];for(let I=0;I<r.length;I++){const{type:R,handler:L,once:z}=r[I];if(L({...e,type:R,stopPropagation:u,stopImmediatePropagation:_}),z&&l.push(r[I]),o)break}for(let I=0;I<l.length;I++){const{type:R,handler:L}=l[I];this.remove(R,L)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...fk(e),...dk(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const gk={events:null,recognizers:null,recognizerOptions:{},Manager:W5,touchAction:"none",tabIndex:0};class _k{constructor(e=null,i){this._onBasicInput=o=>{const{srcEvent:u}=o,_=X5[u.type];_&&this.manager.emit(_,o)},this._onOtherEvent=o=>{this.manager.emit(o.type,o)},this.options={...gk,...i},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:i}=this,r=i.Manager;this.manager=new r(e,{touchAction:i.touchAction,recognizers:i.recognizers||H5}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(d1).forEach(o=>{const u=this.manager.get(o);u&&d1[o].forEach(_=>{u.recognizeWith(_)})});for(const o in i.recognizerOptions){const u=this.manager.get(o);if(u){const _=i.recognizerOptions[o];delete _.enable,u.set(_)}}this.wheelInput=new ek(e,this._onOtherEvent,{enable:!1}),this.moveInput=new ik(e,this._onOtherEvent,{enable:!1}),this.keyInput=new sk(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new nk(e,this._onOtherEvent,{enable:!1});for(const[o,u]of this.events)u.isEmpty()||(this._toggleRecognizer(u.recognizerName,!0),this.manager.on(o,u.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,i,r){this._addEventHandler(e,i,r,!1)}once(e,i,r){this._addEventHandler(e,i,r,!0)}watch(e,i,r){this._addEventHandler(e,i,r,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){const{manager:r}=this;if(!r)return;const o=r.get(e);if(o&&o.options.enable!==i){o.set({enable:i});const u=q5[e];u&&!this.options.recognizers&&u.forEach(_=>{const l=r.get(_);i?(l.requireFailure(e),o.dropRequireFailure(_)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,i),this.moveInput.enableEventType(e,i),this.keyInput.enableEventType(e,i),this.contextmenuInput.enableEventType(e,i)}_addEventHandler(e,i,r,o,u){if(typeof e!="string"){r=i;for(const L in e)this._addEventHandler(L,e[L],r,o,u);return}const{manager:_,events:l}=this,I=p1[e]||e;let R=l.get(I);R||(R=new pk(this),l.set(I,R),R.recognizerName=Z5[I]||I,_&&_.on(I,R.handleEvent)),R.add(e,i,r,o,u),R.isEmpty()||this._toggleRecognizer(R.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const _ in e)this._removeEventHandler(_,e[_]);return}const{events:r}=this,o=p1[e]||e,u=r.get(o);if(u&&(u.remove(e,i),u.isEmpty())){const{recognizerName:_}=u;let l=!1;for(const I of r.values())if(I.recognizerName===_&&!I.isEmpty()){l=!0;break}l||this._toggleRecognizer(_,!1)}}}function el(){}const mk=({isDragging:t})=>t?"grabbing":"grab",Cv={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:el,onWebGLInitialized:el,onResize:el,onViewStateChange:el,onInteractionStateChange:el,onBeforeRender:el,onAfterRender:el,onLoad:el,onError:t=>mi.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:mk,getTooltip:null,debug:!1,drawPickingColors:!1};class fg{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Yu({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:o}=this;if(r.type==="pointerleave")o.x=-1,o.y=-1,o.radius=0;else{if(r.leftButton||r.rightButton)return;{const u=r.offsetCenter;if(!u)return;o.x=u.x,o.y=u.y,o.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:o.x,y:o.y}),o.event=r},this._onEvent=r=>{const o=hp[r.type],u=r.offsetCenter;if(!o||!u||!this.layerManager)return;const _=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:u.x,y:u.y,layers:_,viewports:this.getViewports(u)},this._lastPointerDownInfo),{layer:I}=l,R=I&&(I[o.handler]||I.props[o.handler]),L=this.props[o.handler];let z=!1;R&&(z=R.call(I,l,r)),z||(L==null||L(l,r),this.widgetManager.onEvent(l,r))},this._onPointerDown=r=>{const o=r.offsetCenter,u=this._pick("pickObject","pickObject Time",{x:o.x,y:o.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=u.result[0]||u.emptyInfo},this.props={...Cv,...e},e=this.props,e.viewState&&e.initialViewState&&mi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&mi.error("WebGL1 context not supported.")(),this.device=Pu.attach(e.gl));let i=this.device;i||(ph.registerDevices([Pu]),i=ph.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(i,e),this.setProps(e),e._typedArrayManagerProps&&Ph.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,r,o,u,_,l,I,R,L;(e=this.animationLoop)==null||e.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(o=this.viewManager)==null||o.finalize(),this.viewManager=null,(u=this.effectManager)==null||u.finalize(),this.effectManager=null,(_=this.deckRenderer)==null||_.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(I=this.eventManager)==null||I.destroy(),this.eventManager=null,(R=this.widgetManager)==null||R.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((L=this.canvas.parentElement)==null||L.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&mi.removed("onLayerHover","onHover")(),"onLayerClick"in e&&mi.removed("onLayerClick","onClick")(),e.initialViewState&&!Wn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),o=this.layerManager.needsRedraw(e),u=this.effectManager.needsRedraw(e),_=this.deckRenderer.needsRedraw(e);return i=i||r||o||u||_,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return ps(this.viewManager),this.viewManager.views}getViewports(e){return ps(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(e)}_pick(e,i,r){ps(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(i).timeStart();const u=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return o.get(i).timeEnd(),u}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),ps(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){var o;if(!this.canvas)return;const{width:i,height:r}=e;if(i||i===0){const u=Number.isFinite(i)?`${i}px`:i;this.canvas.style.width=u}if(r||r===0){const u=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((o=e.style)==null?void 0:o.position)||"absolute",this.canvas.style.height=u}}_updateCanvasSize(){var o,u;const{canvas:e}=this;if(!e)return;const i=e.clientWidth??e.width,r=e.clientHeight??e.height;(i!==this.width||r!==this.height)&&(this.width=i,this.height=r,(o=this.viewManager)==null||o.setProps({width:i,height:r}),(u=this.layerManager)==null||u.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:r}))}_createAnimationLoop(e,i){const{gl:r,onError:o,useDevicePixels:u}=i;return new VM({device:e,useDevicePixels:u,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:_=>this._setDevice(_.device),onRender:this._onRenderFrame.bind(this),onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,i=Array.isArray(e)?e:e?[e]:[new b6({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var i,r,o;const{_pickRequest:e}=this;if(e.event){const{result:u,emptyInfo:_}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=u.length>0;let l=_,I=!1;for(const R of u)l=R,I=((i=R.layer)==null?void 0:i.onHover(R,e.event))||I;I||((o=(r=this.props).onHover)==null||o.call(r,l,e.event),this.widgetManager.onHover(l,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var o,u;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(o=this.device.canvasContext)==null?void 0:o.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Pu&&this.props.onWebGLInitialized(this.device.gl);const i=new sv;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new _k(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const _ in hp)this.eventManager.on(_,this._onEvent);this.viewManager=new n6({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new s6(this.device,{deck:this,stats:this.stats,viewport:r,timeline:i}),this.effectManager=new w6({deck:this,device:this.device}),this.deckRenderer=new S6(this.device),this.deckPicker=new k6(this.device),this.widgetManager=new F6({deck:this,parentElement:(u=this.canvas)==null?void 0:u.parentElement}),this.widgetManager.addDefault(new L6),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){var _;const{device:r,gl:o}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:o});const u={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(_=this.deckRenderer)==null||_.renderLayers(u),u.pass==="screen"&&this.widgetManager.onRedraw({viewports:u.viewports,layers:u.layers}),this.props.onAfterRender({device:r,gl:o})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),mi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const r=ph.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}fg.defaultProps=Cv;fg.VERSION=tb;const yk=fg;function bk(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return pb(t)}}const vk=db;function zA(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Kl(t){return t.stride||t.size*t.bytesPerElement}function xk(t,e){return t.type===e.type&&t.size===e.size&&Kl(t)===Kl(e)&&(t.offset||0)===(e.offset||0)}function wp(t,e){e.offset&&mi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=Kl(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,o=e.elementOffset||0,u=r*i+o*t.bytesPerElement+(t.offset||0);return{...e,offset:u,stride:i}}function wk(t,e){const i=wp(t,e);return{high:i,low:{...i,offset:i.offset+t.size*4}}}class Tk{constructor(e,i,r){this._buffer=null,this.device=e,this.id=i.id||"",this.size=i.size||1;const o=i.logicalType||i.type,u=o==="float64";let{defaultValue:_}=i;_=Number.isFinite(_)?[_]:_||new Array(this.size).fill(0);let l;u?l="float32":!o&&i.isIndexed?l="uint32":l=o||"float32";let I=bk(o||l);this.doublePrecision=u,u&&i.fp64===!1&&(I=Float32Array),this.value=null,this.settings={...i,defaultType:I,defaultValue:_,logicalType:o,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:I.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Kl(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ph.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,i=null){const r={};if(this.state.constant){const o=this.value;if(i){const u=wp(this.getAccessor(),i),_=u.offset/o.BYTES_PER_ELEMENT,l=u.size||this.size;r[e]=o.subarray(_,_+l)}else r[e]=o}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,i=null){const r=this.getAccessor(),o=[],u={name:this.id,byteStride:Kl(r),attributes:o};if(this.doublePrecision){const _=wk(r,i||{});o.push(zA(e,{...r,..._.high}),zA(`${e}64Low`,{...r,..._.low}))}else if(i){const _=wp(r,i);o.push(zA(e,{...r,..._}))}else o.push(zA(e,r));return u}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const i=Array.from(this.value);e=[i,i]}else{const{value:i,numInstances:r,size:o}=this,u=r*o;if(i&&u&&i.length>=u){const _=new Array(o).fill(1/0),l=new Array(o).fill(-1/0);for(let I=0;I<u;)for(let R=0;R<o;R++){const L=i[I++];L<_[R]&&(_[R]=L),L>l[R]&&(l[R]=L)}e=[_,l]}}return this.state.bounds=e,e}setData(e){const{state:i}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof lr?r={buffer:e}:r=e;const o={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)o.type="float32";else{const _=vk(r.value);o.type=o.normalized?_.replace("int","norm"):_}o.bytesPerElement=r.value.BYTES_PER_ELEMENT,o.stride=Kl(o)}if(i.bounds=null,r.constant){let u=r.value;if(u=this._normalizeValue(u,[],0),this.settings.normalized&&(u=this.normalizeConstant(u)),!(!i.constant||!this._areValuesEqual(u,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(u)?u:new Float32Array(u)}else if(r.buffer){const u=r.buffer;i.externalBuffer=u,i.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let u=r.value;i.externalBuffer=null,i.constant=!1,this.value=u;let{buffer:_}=this;const l=Kl(o),I=(o.vertexOffset||0)*l;if(this.doublePrecision&&u instanceof Float64Array&&(u=y0(u,o)),this.settings.isIndexed){const L=this.settings.defaultType;u.constructor!==L&&(u=new L(u))}const R=u.byteLength+I+l*2;(!_||_.byteLength<R)&&(_=this._createBuffer(R)),_.write(u,I)}return this.setAccessor(o),!0}updateSubBuffer(e={}){this.state.bounds=null;const i=this.value,{startOffset:r=0,endOffset:o}=e;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?y0(i,{size:this.size,startIndex:r,endIndex:o}):i.subarray(r,o),r*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,i=!1){const{state:r}=this,o=r.allocatedValue,u=Ph.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=u;const{byteOffset:_}=this;let{buffer:l}=this;return(!l||l.byteLength<u.byteLength+_)&&(l=this._createBuffer(u.byteLength+_),i&&o&&l.write(o instanceof Float64Array?y0(o,this):o,_)),r.allocatedValue=u,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:i}=e;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=i.BYTES_PER_ELEMENT<4),o)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof r)&&this.settings.normalized&&!("normalized"in e)&&mi.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(e).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(i=>i/255);case"unorm16":return new Float32Array(e).map(i=>i/65535);default:return e}}_normalizeValue(e,i,r){const{defaultValue:o,size:u}=this.settings;if(Number.isFinite(e))return i[r]=e,i;if(!e){let _=u;for(;--_>=0;)i[r+_]=o[_];return i}switch(u){case 4:i[r+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:i[r+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:i[r+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:i[r+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let _=u;for(;--_>=0;)i[r+_]=Number.isFinite(e[_])?e[_]:o[_]}return i}_areValuesEqual(e,i){if(!e||!i)return!1;const{size:r}=this;for(let o=0;o<r;o++)if(e[o]!==i[o])return!1;return!0}_createBuffer(e){var o;this._buffer&&this._buffer.destroy();const{isIndexed:i,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(o=this._buffer)==null?void 0:o.props,id:this.id,usage:i?lr.INDEX:lr.VERTEX,indexType:i?r:void 0,byteLength:e}),this._buffer}}const P1=[],I1=[];function Dh(t,e=0,i=1/0){let r=P1;const o={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(I1.length=t.length,r=I1):r=P1,(e>0||Number.isFinite(i))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,i),o.index=e-1),{iterable:r,objectInfo:o}}function Pv(t){return t&&t[Symbol.asyncIterator]}function Iv(t,e){const{size:i,stride:r,offset:o,startIndices:u,nested:_}=e,l=t.BYTES_PER_ELEMENT,I=r?r/l:i,R=o?o/l:0,L=Math.floor((t.length-R)/I);return(z,{index:V,target:q})=>{if(!u){const Ce=V*I+R;for(let Le=0;Le<i;Le++)q[Le]=t[Ce+Le];return q}const ne=u[V],Ae=u[V+1]||L;let Ee;if(_){Ee=new Array(Ae-ne);for(let Ce=ne;Ce<Ae;Ce++){const Le=Ce*I+R;q=new Array(i);for(let Oe=0;Oe<i;Oe++)q[Oe]=t[Le+Oe];Ee[Ce-ne]=q}}else if(I===i)Ee=t.subarray(ne*i+R,Ae*i+R);else{Ee=new t.constructor((Ae-ne)*i);let Ce=0;for(let Le=ne;Le<Ae;Le++){const Oe=Le*I+R;for(let Ne=0;Ne<i;Ne++)Ee[Ce++]=t[Oe+Ne]}}return Ee}}const Ek=[],sf=[[0,1/0]];function Sk(t,e){if(t===sf||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const i=[],r=t.length;let o=0;for(let u=0;u<r;u++){const _=t[u];_[1]<e[0]?(i.push(_),o=u+1):_[0]>e[1]?i.push(_):e=[Math.min(_[0],e[0]),Math.max(_[1],e[1])]}return i.splice(o,0,e),i}const Ck={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function Mv(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const i=t.type||"interpolation";return{...Ck[i],...e,...t,type:i}}class Rv extends Tk{constructor(e,i){super(e,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:sf}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!e,i}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var i;(i=this.state).layoutChanged||(i.layoutChanged=!xk(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:i}=this.settings,r=this.settings.transition,o=Array.isArray(i)?e[i.find(u=>e[u])]:e[i];return Mv(o,r)}setNeedsUpdate(e=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),i){const{startRow:r=0,endRow:o=1/0}=i;this.state.updateRanges=Sk(this.state.updateRanges,[r,o])}else this.state.updateRanges=sf}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Ek}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:i,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,i.updateRanges!==sf),!0):!1}updateBuffer({numInstances:e,data:i,props:r,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:u},settings:{update:_,noAlloc:l}}=this;let I=!0;if(_){for(const[R,L]of u)_.call(o,this,{data:i,startRow:R,endRow:L,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[R,L]of u){const z=Number.isFinite(R)?this.getVertexOffset(R):0,V=Number.isFinite(L)?this.getVertexOffset(L):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:z,endOffset:V})}this._checkAttributeArray()}else I=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),I}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:i}=this;return e?(this.clearNeedsUpdate(),i.lastExternalBuffer===e||(i.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(e,i=null){const{state:r,settings:o}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),o.transform||i!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const _=e;ps(ArrayBuffer.isView(_.value),`invalid ${o.accessor}`);const l=!!_.size&&_.size!==this.size;return r.binaryAccessor=Iv(_.value,{size:_.size||this.size,stride:_.stride,offset:_.offset,startIndices:i,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:i}=this;return(i?e<i.length?i[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,i=super.getValue();if(!e)return i;for(const r in e)Object.assign(i,super.getValue(r,e[r]));return i}getBufferLayout(e){this.state.layoutChanged=!1;const i=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:o}=this.settings;if(o==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=o??"vertex",!i)return r;for(const u in i){const _=super._getBufferLayout(u,i[u]);r.attributes.push(..._.attributes)}return r}_autoUpdater(e,{data:i,startRow:r,endRow:o,props:u,numInstances:_}){if(e.constant)return;const{settings:l,state:I,value:R,size:L,startIndices:z}=e,{accessor:V,transform:q}=l,ne=I.binaryAccessor||(typeof V=="function"?V:u[V]);ps(typeof ne=="function",`accessor "${V}" is not a function`);let Ae=e.getVertexOffset(r);const{iterable:Ee,objectInfo:Ce}=Dh(i,r,o);for(const Le of Ee){Ce.index++;let Oe=ne(Le,Ce);if(q&&(Oe=q.call(this,Oe)),z){const Ne=(Ce.index<z.length-1?z[Ce.index+1]:_)-z[Ce.index];if(Oe&&Array.isArray(Oe[0])){let Qe=Ae;for(const Je of Oe)e._normalizeValue(Je,R,Qe),Qe+=L}else Oe&&Oe.length>L?R.set(Oe,Ae):(e._normalizeValue(Oe,Ce.target,0),JM({target:R,source:Ce.target,start:Ae,count:Ne}));Ae+=Ne*L}else e._normalizeValue(Oe,R,Ae),Ae+=L}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,i=Math.min(4,this.size);if(e&&e.length>=i){let r=!0;switch(i){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function D0(t){const{source:e,target:i,start:r=0,size:o,getData:u}=t,_=t.end||i.length,l=e.length,I=_-r;if(l>I){i.set(e.subarray(0,I),r);return}if(i.set(e,r),!u)return;let R=l;for(;R<I;){const L=u(R,e);for(let z=0;z<o;z++)i[r+R]=L[z]||0,R++}}function Pk({source:t,target:e,size:i,getData:r,sourceStartIndices:o,targetStartIndices:u}){if(!o||!u)return D0({source:t,target:e,size:i,getData:r}),e;let _=0,l=0;const I=r&&((L,z)=>r(L+l,z)),R=Math.min(o.length,u.length);for(let L=1;L<R;L++){const z=o[L]*i,V=u[L]*i;D0({source:t.subarray(_,z),target:e,start:l,end:V,size:i,getData:I}),_=z,l=V}return l<e.length&&D0({source:[],target:e,start:l,size:i,getData:I}),e}function Ik(t){const{device:e,settings:i,value:r}=t,o=new Rv(e,i);return o.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),o}function kv(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function Dv(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Bv(t){t.push(t.shift())}function Mk(t,e){const{doublePrecision:i,settings:r,value:o,size:u}=t,_=i&&o instanceof Float64Array?2:1;let l=0;const{shaderAttributes:I}=t.settings;if(I)for(const R of Object.values(I))l=Math.max(l,R.vertexOffset??0);return(r.noAlloc?o.length:(e+l)*u)*_}function Fv({device:t,source:e,target:i}){return(!i||i.byteLength<e.byteLength)&&(i==null||i.destroy(),i=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),i}function Ov({device:t,buffer:e,attribute:i,fromLength:r,toLength:o,fromStartIndices:u,getData:_=l=>l}){const l=i.doublePrecision&&i.value instanceof Float64Array?2:1,I=i.size*l,R=i.byteOffset,L=i.settings.bytesPerElement<4?R/i.settings.bytesPerElement*4:R,z=i.startIndices,V=u&&z,q=i.isConstant;if(!V&&e&&r>=o)return e;const ne=i.value instanceof Float64Array?Float32Array:i.value.constructor,Ae=q?i.value:new ne(i.getBuffer().readSyncWebGL(R,o*ne.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!q){const Oe=_;_=(Ne,Qe)=>i.normalizeConstant(Oe(Ne,Qe))}const Ee=q?(Oe,Ne)=>_(Ae,Ne):(Oe,Ne)=>_(Ae.subarray(Oe+R,Oe+R+I),Ne),Ce=e?new Float32Array(e.readSyncWebGL(L,r*4).buffer):new Float32Array(0),Le=new Float32Array(o);return Pk({source:Ce,target:Le,sourceStartIndices:u,targetStartIndices:z,size:I,getData:Ee}),(!e||e.byteLength<Le.byteLength+L)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:Le.byteLength+L,usage:35050})),e.write(Le,L),e}class Lv{constructor({device:e,attribute:i,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new nd(r),this.attribute=i,this.attributeInTransition=Ik(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(e,i,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Mk(this.attribute,i),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class Rk extends Lv{constructor({device:e,attribute:i,timeline:r}){super({device:e,attribute:i,timeline:r}),this.type="interpolation",this.transform=Bk(e,i)}start(e,i){const r=this.currentLength,o=this.currentStartIndices;if(super.start(e,i,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:u,attribute:_}=this;Bv(u),u[0]=Ov({device:this.device,buffer:u[0],attribute:_,fromLength:r,toLength:this.currentLength,fromStartIndices:o,getData:e.enter}),u[1]=Fv({device:this.device,source:u[0],target:u[1]}),this.setBuffer(u[1]);const{transform:l}=this,I=l.model;let R=Math.floor(this.currentLength/_.size);Nv(_)&&(R/=2),I.setVertexCount(R),_.isConstant?(I.setAttributes({aFrom:u[0]}),I.setConstantAttributes({aTo:_.value})):I.setAttributes({aFrom:u[0],aTo:_.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:u[1]})}onUpdate(){const{duration:e,easing:i}=this.settings,{time:r}=this.transition;let o=r/e;i&&(o=i(o));const{model:u}=this.transform;u.setUniforms({time:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const kk=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,Dk=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Nv(t){return t.doublePrecision&&t.value instanceof Float64Array}function Bk(t,e){const i=e.size,r=kv(i),o=Dv(i),u=e.getBufferLayout();return Nv(e)?new Lu(t,{vs:Dk,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:o,byteOffset:0},{attribute:"aFrom64Low",format:o,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:o,byteOffset:0},{attribute:"aTo64Low",format:o,byteOffset:4*i}]}],modules:[QP],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Lu(t,{vs:kk,bufferLayout:[{name:"aFrom",format:o},{name:"aTo",format:u.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class Fk extends Lv{constructor({device:e,attribute:i,timeline:r}){super({device:e,attribute:i,timeline:r}),this.type="spring",this.texture=zk(e),this.framebuffer=Uk(e,this.texture),this.transform=Nk(e,i)}start(e,i){const r=this.currentLength,o=this.currentStartIndices;super.start(e,i);const{buffers:u,attribute:_}=this;for(let I=0;I<2;I++)u[I]=Ov({device:this.device,buffer:u[I],attribute:_,fromLength:r,toLength:this.currentLength,fromStartIndices:o,getData:e.enter});u[2]=Fv({device:this.device,source:u[0],target:u[2]}),this.setBuffer(u[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/_.size)),_.isConstant?l.setConstantAttributes({aTo:_.value}):l.setAttributes({aTo:_.getBuffer()})}onUpdate(){const{buffers:e,transform:i,framebuffer:r,transition:o}=this,u=this.settings;i.model.setAttributes({aPrev:e[0],aCur:e[1]}),i.transformFeedback.setBuffers({vNext:e[2]}),i.model.setUniforms({stiffness:u.stiffness,damping:u.damping}),i.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Bv(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||o.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Ok=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Lk=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Nk(t,e){const i=kv(e.size),r=Dv(e.size);return new Lu(t,{vs:Ok,fs:Lk,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function zk(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Uk(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const Vk={interpolation:Rk,spring:Fk};class jk{constructor(e,{id:i,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:i,numInstances:r}){this.numInstances=r||1;for(const o in e){const u=e[o],_=u.getTransitionSetting(i);_&&this._updateAttribute(o,u,_)}for(const o in this.transitions){const u=e[o];(!u||!u.getTransitionSetting(i))&&this._removeTransition(o)}}hasAttribute(e){const i=this.transitions[e];return i&&i.inProgress}getAttributes(){const e={};for(const i in this.transitions){const r=this.transitions[i];r.inProgress&&(e[i]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,i,r){const o=this.transitions[e];let u=!o||o.type!==r.type;if(u){o&&this._removeTransition(e);const _=Vk[r.type];_?this.transitions[e]=new _({attribute:i,timeline:this.timeline,device:this.device}):(mi.error(`unsupported transition type '${r.type}'`)(),u=!1)}(u||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const M1="attributeManager.invalidate",$k="attributeManager.updateStart",Wk="attributeManager.updateEnd",Hk="attribute.updateStart",qk="attribute.allocate",Xk="attribute.updateEnd";class Zk{constructor(e,{id:i="attribute-manager",stats:r,timeline:o}={}){this.mergeBoundsMemoized=Ku(MM),this.id=i,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new jk(e,{id:`${i}-transitions`,timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const i of e)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(e,i){const r=this._invalidateTrigger(e,i);Fs(M1,this,e,r)}invalidateAll(e){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,e);Fs(M1,this,"all")}update({data:e,numInstances:i,startIndices:r=null,transitions:o,props:u={},buffers:_={},context:l={}}){let I=!1;Fs($k,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const R in this.attributes){const L=this.attributes[R],z=L.settings.accessor;L.startIndices=r,L.numInstances=i,u[R]&&mi.removed(`props.${R}`,`data.attributes.${R}`)(),L.setExternalBuffer(_[R])||L.setBinaryValue(typeof z=="string"?_[z]:void 0,e.startIndices)||typeof z=="string"&&!_[z]&&L.setConstantValue(u[z])||L.needsUpdate()&&(I=!0,this._updateAttribute({attribute:L,numInstances:i,data:e,props:u,context:l})),this.needsRedraw=this.needsRedraw||L.needsRedraw()}I&&Fs(Wk,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,i=e.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const i=e.map(r=>{var o;return(o=this.attributes[r])==null?void 0:o.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:r}=this,o={...r.getAttributes()};for(const u in i){const _=i[u];_.needsRedraw(e)&&!r.hasAttribute(u)&&(o[u]=_)}return o}getBufferLayouts(e){return Object.values(this.getAttributes()).map(i=>i.getBufferLayout(e))}_add(e,i){for(const r in e){const o=e[r],u={...o,id:r,size:o.isIndexed&&1||o.size||1,...i};this.attributes[r]=new Rv(this.device,u)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(i)});this.updateTriggers=e}_invalidateTrigger(e,i){const{attributes:r,updateTriggers:o}=this,u=o[e];return u&&u.forEach(_=>{const l=r[_];l&&l.setNeedsUpdate(l.id,i)}),u}_updateAttribute(e){const{attribute:i,numInstances:r}=e;if(Fs(Hk,i),i.constant){i.setConstantValue(i.value);return}i.allocate(r)&&Fs(qk,i,r),i.updateBuffer(e)&&(this.needsRedraw=!0,Fs(Xk,i,r))}}class Yk extends nd{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:i,toValue:r,duration:o,easing:u}}=this,_=u(e/o);this._value=Th(i,r,_)}}const R1=1e-5;function k1(t,e,i,r,o){const u=e-t,l=(i-e)*o,I=-u*r;return l+I+u+e}function Gk(t,e,i,r,o){if(Array.isArray(i)){const u=[];for(let _=0;_<i.length;_++)u[_]=k1(t[_],e[_],i[_],r,o);return u}return k1(t,e,i,r,o)}function D1(t,e){if(Array.isArray(t)){let i=0;for(let r=0;r<t.length;r++){const o=t[r]-e[r];i+=o*o}return Math.sqrt(i)}return Math.abs(t-e)}class Qk extends nd{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:i,damping:r,stiffness:o}=this.settings,{_prevValue:u=e,_currValue:_=e}=this;let l=Gk(u,_,i,r,o);const I=D1(l,i),R=D1(l,_);I<R1&&R<R1&&(l=i,this.end()),this._prevValue=_,this._currValue=l}}const Kk={interpolation:Yk,spring:Qk};class Jk{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,i,r,o){const{transitions:u}=this;if(u.has(e)){const I=u.get(e),{value:R=I.settings.fromValue}=I;i=R,this.remove(e)}if(o=Mv(o),!o)return;const _=Kk[o.type];if(!_){mi.error(`unsupported transition type '${o.type}'`)();return}const l=new _(this.timeline);l.start({...o,fromValue:i,toValue:r}),u.set(e,l)}remove(e){const{transitions:i}=this;i.has(e)&&(i.get(e).cancel(),i.delete(e))}update(){const e={};for(const[i,r]of this.transitions)r.update(),e[i]=r.value,r.inProgress||this.remove(i);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function e8(t){const e=t[ll];for(const i in e){const r=e[i],{validate:o}=r;if(o&&!o(t[i],r))throw new Error(`Invalid prop ${i}: ${t[i]}`)}}function t8(t,e){const i=zv({newProps:t,oldProps:e,propTypes:t[ll],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=r8(t,e);let o=!1;return r||(o=s8(t,e)),{dataChanged:r,propsChanged:i,updateTriggersChanged:o,extensionsChanged:n8(t,e),transitionsChanged:i8(t,e)}}function i8(t,e){if(!t.transitions)return!1;const i={},r=t[ll];let o=!1;for(const u in t.transitions){const _=r[u],l=_&&_.type;(l==="number"||l==="color"||l==="array")&&Tp(t[u],e[u],_)&&(i[u]=!0,o=!0)}return o?i:!1}function zv({newProps:t,oldProps:e,ignoreProps:i={},propTypes:r={},triggerName:o="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${o} changed shallowly`;if(typeof e!="object"||e===null)return`${o} changed shallowly`;for(const u of Object.keys(t))if(!(u in i)){if(!(u in e))return`${o}.${u} added`;const _=Tp(t[u],e[u],r[u]);if(_)return`${o}.${u} ${_}`}for(const u of Object.keys(e))if(!(u in i)){if(!(u in t))return`${o}.${u} dropped`;if(!Object.hasOwnProperty.call(t,u)){const _=Tp(t[u],e[u],r[u]);if(_)return`${o}.${u} ${_}`}}return!1}function Tp(t,e,i){let r=i&&i.equal;return r&&!r(t,e,i)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function r8(t,e){if(e===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:r,_dataDiff:o}=t;return r?r(t.data,e.data)||(i="Data comparator detected a change"):t.data!==e.data&&(i="A new data container was supplied"),i&&o&&(i=o(t.data,e.data)||i),i}function s8(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&B1(t,e,"all"))return{all:!0};const i={};let r=!1;for(const o in t.updateTriggers)o!=="all"&&B1(t,e,o)&&(i[o]=!0,r=!0);return r?i:!1}function n8(t,e){if(e===null)return!0;const i=e.extensions,{extensions:r}=t;if(r===i)return!1;if(!i||!r||r.length!==i.length)return!0;for(let o=0;o<r.length;o++)if(!r[o].equals(i[o]))return!0;return!1}function B1(t,e,i){let r=t.updateTriggers[i];r=r??{};let o=e.updateTriggers[i];return o=o??{},zv({oldProps:o,newProps:r,triggerName:i})}const o8="count(): argument not an object",a8="count(): argument not a container";function l8(t){if(!h8(t))throw new Error(o8);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(c8(t))return Object.keys(t).length;throw new Error(a8)}function c8(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function h8(t){return t!==null&&typeof t=="object"}function F1(t,e){if(!e)return t;const i={...t,...e};if("defines"in e&&(i.defines={...t.defines,...e.defines}),"modules"in e&&(i.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=i.modules.findIndex(o=>o.name==="project32");r>=0&&i.modules.splice(r,1)}if("inject"in e)if(!t.inject)i.inject=e.inject;else{const r={...t.inject};for(const o in e.inject)r[o]=(r[o]||"")+e.inject[o];i.inject=r}return i}const u8={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Ep={};function A8(t,e,i,r){if(i instanceof $n)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let o=null;i.compressed&&(o={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const u=e.createTexture({...i,sampler:{...u8,...o,...r}});return Ep[u.id]=t,u}function f8(t,e){!e||!(e instanceof $n)||Ep[e.id]===t&&(e.delete(),delete Ep[e.id])}const d8={boolean:{validate(t,e){return!0},equal(t,e,i){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Sp(t)&&(t.length===3||t.length===4)},equal(t,e,i){return Wn(t,e,1)}},accessor:{validate(t,e){const i=kf(t);return i==="function"||i===kf(e.value)},equal(t,e,i){return typeof e=="function"?!0:Wn(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Sp(t)},equal(t,e,i){const{compare:r}=i,o=Number.isInteger(r)?r:r?1:0;return r?Wn(t,e,o):t===e}},object:{equal(t,e,i){if(i.ignore)return!0;const{compare:r}=i,o=Number.isInteger(r)?r:r?1:0;return r?Wn(t,e,o):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,i){return!i.compare&&i.ignore!==!1||t===e}},data:{transform:(t,e,i)=>{if(!t)return t;const{dataTransform:r}=i.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,i)=>{const r=i.context;return!r||!r.device?null:A8(i.id,r.device,t,{...e.parameters,...i.props.textureParameters})},release:(t,e,i)=>{f8(i.id,t)}}};function p8(t){const e={},i={},r={};for(const[o,u]of Object.entries(t)){const _=u==null?void 0:u.deprecatedFor;if(_)r[o]=Array.isArray(_)?_:[_];else{const l=g8(o,u);e[o]=l,i[o]=l.value}}return{propTypes:e,defaultProps:i,deprecatedProps:r}}function g8(t,e){switch(kf(e)){case"object":return Au(t,e);case"array":return Au(t,{type:"array",value:e,compare:!1});case"boolean":return Au(t,{type:"boolean",value:e});case"number":return Au(t,{type:"number",value:e});case"function":return Au(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Au(t,e){return"type"in e?{name:t,...d8[e.type],...e}:"value"in e?{name:t,type:kf(e.value),...e}:{name:t,type:"object",value:e}}function Sp(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function kf(t){return Sp(t)?"array":t===null?"null":typeof t}function _8(t,e){let i;for(let u=e.length-1;u>=0;u--){const _=e[u];"extensions"in _&&(i=_.extensions)}const r=Cp(t.constructor,i),o=Object.create(r);o[Mf]=t,o[sc]={},o[nl]={};for(let u=0;u<e.length;++u){const _=e[u];for(const l in _)o[l]=_[l]}return Object.freeze(o),o}const m8="_mergedDefaultProps";function Cp(t,e){if(!(t instanceof Vv.constructor))return{};let i=m8;if(e)for(const o of e){const u=o.constructor;u&&(i+=`:${u.extensionName||u.name}`)}const r=Uv(t,i);return r||(t[i]=y8(t,e||[]))}function y8(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),o=Cp(r),u=Uv(t,"defaultProps")||{},_=p8(u),l=Object.assign(Object.create(null),o,_.defaultProps),I=Object.assign(Object.create(null),o==null?void 0:o[ll],_.propTypes),R=Object.assign(Object.create(null),o==null?void 0:o[x0],_.deprecatedProps);for(const L of e){const z=Cp(L.constructor);z&&(Object.assign(l,z),Object.assign(I,z[ll]),Object.assign(R,z[x0]))}return b8(l,t),x8(l,I),v8(l,R),l[ll]=I,l[x0]=R,e.length===0&&!dg(t,"_propTypes")&&(t._propTypes=I),l}function b8(t,e){const i=T8(e);Object.defineProperties(t,{id:{writable:!0,value:i}})}function v8(t,e){for(const i in e)Object.defineProperty(t,i,{enumerable:!1,set(r){const o=`${this.id}: ${i}`;for(const u of e[i])dg(this,u)||(this[u]=r);mi.deprecated(o,e[i].join("/"))()}})}function x8(t,e){const i={},r={};for(const o in e){const u=e[o],{name:_,value:l}=u;u.async&&(i[_]=l,r[_]=w8(_))}t[mh]=i,t[sc]={},Object.defineProperties(t,r)}function w8(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||Pv(e)?this[sc][t]=e:this[nl][t]=e},get(){if(this[nl]){if(t in this[nl])return this[nl][t]||this[mh][t];if(t in this[sc]){const e=this[Mf]&&this[Mf].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[mh][t]}}return this[mh][t]}}}function dg(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Uv(t,e){return dg(t,e)&&t[e]}function T8(t){const e=t.componentName;return e||mi.warn(`${t.name}.componentName not specified`)(),e||t.name}let E8=0;class pg{constructor(...e){this.props=_8(this,e),this.id=this.props.id,this.count=E8++}clone(e){const{props:i}=this,r={};for(const o in i[mh])o in i[nl]?r[o]=i[nl][o]:o in i[sc]&&(r[o]=i[sc][o]);return new this.constructor({...i,...r,...e})}}pg.componentName="Component";pg.defaultProps={};const Vv=pg,S8=Object.freeze({});class C8{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const i=this.asyncProps[e];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||S8}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const i=this.asyncProps[e];return i&&i.resolvedValue}isAsyncPropLoading(e){if(e){const i=this.asyncProps[e];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(e,i){this._watchPromise(e,Promise.resolve(i))}setAsyncProps(e){this.component=e[Mf]||this.component;const i=e[nl]||{},r=e[sc]||e,o=e[mh]||{};for(const u in i){const _=i[u];this._createAsyncPropData(u,o[u]),this._updateAsyncProp(u,_),i[u]=this.getAsyncProp(u)}for(const u in r){const _=r[u];this._createAsyncPropData(u,o[u]),this._updateAsyncProp(u,_)}}_fetch(e,i){return null}_onResolve(e,i){}_onError(e,i){}_updateAsyncProp(e,i){if(this._didAsyncInputValueChange(e,i)){if(typeof i=="string"&&(i=this._fetch(e,i)),i instanceof Promise){this._watchPromise(e,i);return}if(Pv(i)){this._resolveAsyncIterable(e,i);return}this._setPropValue(e,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,i){const r=this.asyncProps[e];return i===r.resolvedValue||i===r.lastValue?!1:(r.lastValue=i,!0)}_setPropValue(e,i){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(i=this._postProcessValue(r,i),r.resolvedValue=i,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,i,r){const o=this.asyncProps[e];o&&r>=o.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=i,o.resolvedLoadCount=r,this.onAsyncPropUpdated(e,i))}_watchPromise(e,i){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const o=r.pendingLoadCount;i.then(u=>{this.component&&(u=this._postProcessValue(r,u),this._setAsyncPropValue(e,u,o),this._onResolve(e,u))}).catch(u=>{this._onError(e,u)})}}async _resolveAsyncIterable(e,i){if(e!=="data"){this._setPropValue(e,i);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const o=r.pendingLoadCount;let u=[],_=0;for await(const l of i){if(!this.component)return;const{dataTransform:I}=this.component.props;I?u=I(l,u):u=u.concat(l),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:_,endRow:u.length}]}),_=u.length,this._setAsyncPropValue(e,u,o)}this._onResolve(e,u)}_postProcessValue(e,i){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(i,r,this.component):i}_createAsyncPropData(e,i){if(!this.asyncProps[e]){const o=this.component&&this.component.props[ll];this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class P8 extends C8{constructor({attributeManager:e,layer:i}){super(i),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,i){const r=this.layer,o=r==null?void 0:r.props.fetch;return o?o(i,{propName:e,layer:r}):super._fetch(e,i)}_onResolve(e,i){const r=this.layer;if(r){const o=r.props.onDataLoad;e==="data"&&o&&o(i,{propName:e,layer:r})}}_onError(e,i){const r=this.layer;r&&r.raiseError(i,`loading ${e} of ${this.layer}`)}}const I8="layer.changeFlag",M8="layer.initialize",R8="layer.update",k8="layer.finalize",D8="layer.matched",O1=2**24-1,B8=Object.freeze([]),F8=Ku(({oldViewport:t,viewport:e})=>t.equals(e));let Uo=new Uint8ClampedArray(0);const O8={data:{type:"data",value:B8,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:i,loaders:r,loadOptions:o,signal:u})=>{const{resourceManager:_}=i.context;o=o||i.getLoadOptions(),r=r||i.props.loaders,u&&(o={...o,fetch:{...o==null?void 0:o.fetch,signal:u}});let l=_.contains(t);return!l&&!o&&(_.add({resourceId:t,data:pf(t,r),persistent:!1}),l=!0),l?_.subscribe({resourceId:t,onChange:I=>{var R;return(R=i.internalState)==null?void 0:R.reloadAsyncProp(e,I)},consumerId:i.id,requestId:e}):pf(t,r,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ri.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class gg extends Vv{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ih.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){ps(this.internalState);const i=this.internalState.viewport||this.context.viewport,r=rv(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,u,_]=ev(r,i.pixelProjectionMatrix);return e.length===2?[o,u]:[o,u,_]}unproject(e){return ps(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,i){ps(this.internalState);const r=this.internalState.viewport||this.context.viewport;return OM(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const i of this.getModels())i.updateModuleSettings(e)}setShaderModuleProps(...e){for(const i of this.getModels())i.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ri.DEFAULT||e===Ri.LNGLAT||e===Ri.CARTESIAN}onHover(e,i){return this.props.onHover&&this.props.onHover(e,i)||!1}onClick(e,i){return this.props.onClick&&this.props.onClick(e,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,i=[]){return i[0]=e+1&255,i[1]=e+1>>8&255,i[2]=e+1>>8>>8&255,i}decodePickingColor(e){ps(e instanceof Uint8Array);const[i,r,o]=e;return i+r*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:l8(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=F1(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)e=F1(e,i.getShaders.call(this,i));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const i=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&i)if(Array.isArray(r))for(const o of r)i.invalidateAll(o);else i.invalidateAll();if(i){const{props:o}=e,u=this.internalState.hasPickingBuffer,_=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(u!==_){this.internalState.hasPickingBuffer=_;const{pickingColors:l,instancePickingColors:I}=i.attributes,R=l||I;R&&(_&&R.constant&&(R.constant=!1,i.invalidate(R.id)),!R.value&&!_&&(R.constant=!0,R.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const i of this.getModels())i.draw(e)}getPickingInfo({info:e,mode:i,sourceLayer:r}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,i){var r,o,u,_;i&&(e=new Error(`${i}: ${e.message}`,{cause:e})),(o=(r=this.props).onError)!=null&&o.call(r,e)||(_=(u=this.context)==null?void 0:u.onError)==null||_.call(u,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=e,(!i||!F8({oldViewport:i,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const i=this.getAttributeManager();i&&(e==="all"?i.invalidateAll():i.invalidate(e))}updateAttributes(e){let i=!1;for(const r in e)e[r].layoutChanged()&&(i=!0);for(const r of this.getModels())this._setModelAttributes(r,e,i)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const i=this.props,r=this.getNumInstances(),o=this.getStartIndices();e.update({data:i.data,numInstances:r,startIndices:o,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const u=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const i=e.update(),r=Object.create(this.props);for(const o in i)Object.defineProperty(r,o,{value:i[o]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:i}){if(e.constant)return;const r=Math.floor(Uo.length/4);if(this.internalState.usesPickingColorCache=!0,r<i){i>O1&&mi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Uo=Ph.allocate(Uo,i,{size:4,copy:!0,maxCount:Math.max(i,O1)});const o=Math.floor(Uo.length/4),u=[];for(let _=r;_<o;_++)this.encodePickingColor(_,u),Uo[_*4+0]=u[0],Uo[_*4+1]=u[1],Uo[_*4+2]=u[2]}e.value=Uo.subarray(0,i*4)}_setModelAttributes(e,i,r=!1){var l;if(!Object.keys(i).length)return;if(r){const I=this.getAttributeManager();e.setBufferLayout(I.getBufferLayouts(e)),i=I.getAttributes()}const o=((l=e.userData)==null?void 0:l.excludeAttributes)||{},u={},_={};for(const I in i){if(o[I])continue;const R=i[I].getValue();for(const L in R){const z=R[L];z instanceof lr?i[I].settings.isIndexed?e.setIndexBuffer(z):u[L]=z:z&&(_[L]=z)}}e.setAttributes(u),e.setConstantAttributes(_)}disablePickingIndex(e){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:o}=this.getAttributeManager().attributes,u=r||o,_=u&&i.attributes&&i.attributes[u.id];if(_&&_.value){const l=_.value,I=this.encodePickingColor(e);for(let R=0;R<i.length;R++){const L=u.getVertexOffset(R);l[L]===I[0]&&l[L+1]===I[1]&&l[L+2]===I[2]&&this._disablePickingIndex(R)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,o=i||r;if(!o)return;const u=o.getVertexOffset(e),_=o.getVertexOffset(e+1);o.buffer.write(new Uint8Array(_-u),u)}restorePickingColors(){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,r=e||i;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Uo.buffer&&(r.value=Uo.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){ps(!this.internalState),ps(Number.isFinite(this.props.coordinateSystem)),Fs(M8,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new P8({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(mi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Jk(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Fs(D8,this,this===e);const{state:i,internalState:r}=e;this!==e&&(this.internalState=r,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Fs(R8,this,e),!e)return;const i=this.props,r=this.context,o=this.internalState,u=r.viewport,_=this._updateUniformTransition();o.propsInTransition=_,r.viewport=o.viewport||u,this.props=_;try{const l=this._getUpdateParams(),I=this.getModels();if(r.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const L of this.props.extensions)L.updateState.call(this,l,L);const R=this.getModels()[0]!==I[0];this._postUpdate(l,R)}finally{r.viewport=u,this.props=i,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){Fs(k8,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:i=null,uniforms:r={},parameters:o={}}){this._updateAttributeTransition();const u=this.props,_=this.context;this.props=this.internalState.propsInTransition||u;const l=this.props.opacity;r.opacity=Math.pow(l,1/2.2);try{if(i){const{isActive:L,isAttribute:z}=i.picking;this.setModuleParameters(i),this.setShaderModuleProps({picking:{isActive:L,isAttribute:z}})}const{getPolygonOffset:I}=this.props,R=I&&I(r)||[0,0];_.device.setParametersWebGL({polygonOffset:R});for(const L of this.getModels())L.setParameters(o);_.device.withParametersWebGL(o,()=>{const L={renderPass:e,moduleParameters:i,uniforms:r,parameters:o,context:_};for(const z of this.props.extensions)z.draw.call(this,L,z);this.draw(L)})}finally{this.props=u}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const o in e)if(e[o]){let u=!1;switch(o){case"dataChanged":const _=e[o],l=i[o];_&&Array.isArray(l)&&(i.dataChanged=Array.isArray(_)?l.concat(_):_,u=!0);default:i[o]||(i[o]=e[o],u=!0)}u&&Fs(I8,this,o,e)}const r=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=r,i.somethingChanged=r||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,i){var o;const r=t8(e,i);if(r.updateTriggersChanged)for(const u in r.updateTriggersChanged)r.updateTriggersChanged[u]&&this.invalidateAttribute(u);if(r.transitionsChanged)for(const u in r.transitionsChanged)this.internalState.uniformTransitions.add(u,i[u],e[u],(o=e.transitions)==null?void 0:o[u]);return this.setChangeFlags(r)}validateProps(){e8(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const i={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(i.highlightColor=r(e)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Zk(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,i){const{props:r,oldProps:o}=e;this.setNeedsRedraw(),this._updateAttributes();const u=this.state.model;u!=null&&u.isInstanced&&u.setInstanceCount(this.getNumInstances());const{autoHighlight:_,highlightedObjectIndex:l,highlightColor:I}=r;if(i||o.autoHighlight!==_||o.highlightedObjectIndex!==l||o.highlightColor!==I){const R={};Array.isArray(I)&&(R.highlightColor=I),(i||o.autoHighlight!==_||l!==o.highlightedObjectIndex)&&(R.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:R})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),o=r?r.getNeedsRedraw(e):!1;if(i=i||o,i)for(const u of this.props.extensions)u.onNeedsRedraw.call(this,u);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}gg.defaultProps=O8;gg.layerName="Layer";const Ac=gg,L8="compositeLayer.renderLayers";class jv extends Ac{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:i}=e;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(e.object=i.__source.object,e.index=i.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,i){return i&&i.length}getSubLayerClass(e,i){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||i}getSubLayerRow(e,i,r){return e.__source={parent:this,object:i,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const i={index:-1,data:this.props.data,target:[]};return(r,o)=>r&&r.__source?(i.index=r.__source.index,e(r.__source.object,i)):e(r,o)}return e}getSubLayerProps(e={}){var xt;const{opacity:i,pickable:r,visible:o,parameters:u,getPolygonOffset:_,highlightedObjectIndex:l,autoHighlight:I,highlightColor:R,coordinateSystem:L,coordinateOrigin:z,wrapLongitude:V,positionFormat:q,modelMatrix:ne,extensions:Ae,fetch:Ee,operation:Ce,_subLayerProps:Le}=this.props,Oe={id:"",updateTriggers:{},opacity:i,pickable:r,visible:o,parameters:u,getPolygonOffset:_,highlightedObjectIndex:l,autoHighlight:I,highlightColor:R,coordinateSystem:L,coordinateOrigin:z,wrapLongitude:V,positionFormat:q,modelMatrix:ne,extensions:Ae,fetch:Ee,operation:Ce},Ne=Le&&e.id&&Le[e.id],Qe=Ne&&Ne.updateTriggers,Je=e.id||"sublayer";if(Ne){const wt=this.props[ll],ct=e.type?e.type._propTypes:{};for(const at in Ne){const Vt=ct[at]||wt[at];Vt&&Vt.type==="accessor"&&(Ne[at]=this.getSubLayerAccessor(Ne[at]))}}Object.assign(Oe,e,Ne),Oe.id=`${this.props.id}-${Je}`,Oe.updateTriggers={all:(xt=this.props.updateTriggers)==null?void 0:xt.all,...e.updateTriggers,...Qe};for(const wt of Ae){const ct=wt.getSubLayerProps.call(this,wt);ct&&Object.assign(Oe,ct,{updateTriggers:Object.assign(Oe.updateTriggers,ct.updateTriggers)})}return Oe}_updateAutoHighlight(e){for(const i of this.getSubLayers())i.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,i){let r=this.internalState.subLayers;const o=!r||this.needsUpdate();if(o){const u=this.renderLayers();r=sd(u,Boolean),this.internalState.subLayers=r}Fs(L8,this,o,r);for(const u of r)u.parent=this}}jv.layerName="CompositeLayer";const Bh=jv,UA=Math.PI/180,L1=180/Math.PI,nf=6370972,ch=256;function N8(){const t=ch/nf,e=Math.PI/180*ch;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class z8 extends ag{constructor(e={}){const{latitude:i=0,longitude:r=0,zoom:o=0,nearZMultiplier:u=.1,farZMultiplier:_=2,resolution:l=10}=e;let{height:I,altitude:R=1.5}=e;I=I||1,R=Math.max(.75,R);const L=new Gs().lookAt({eye:[0,-R,0],up:[0,0,1]}),z=Math.pow(2,o);L.rotateX(i*UA),L.rotateZ(-r*UA),L.scale(z/I);const V=Math.atan(.5/R),q=ch*2*z/I;super({...e,height:I,viewMatrix:L,longitude:r,latitude:i,zoom:o,distanceScales:N8(),fovyRadians:V*2,focalDistance:R,near:u,far:Math.min(2,1/q+1)*R*_}),this.latitude=i,this.longitude=r,this.resolution=l}get projectionMode(){return lo.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const i={targetZ:e.z||0},r=this.unproject([0,this.height/2],i),o=this.unproject([this.width/2,0],i),u=this.unproject([this.width,this.height/2],i),_=this.unproject([this.width/2,this.height],i);return u[0]<this.longitude&&(u[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],u[0],o[0],_[0]),Math.min(r[1],u[1],o[1],_[1]),Math.max(r[0],u[0],o[0],_[0]),Math.max(r[1],u[1],o[1],_[1])]}unproject(e,{topLeft:i=!0,targetZ:r}={}){const[o,u,_]=e,l=i?u:this.height-u,{pixelUnprojectionMatrix:I}=this;let R;if(Number.isFinite(_))R=B0(I,[o,l,_,1]);else{const q=B0(I,[o,l,-1,1]),ne=B0(I,[o,l,1,1]),Ae=((r||0)/nf+1)*ch,Ee=f0(Bb([],q,ne)),Ce=f0(q),Le=f0(ne),Ne=4*((4*Ce*Le-(Ee-Ce-Le)**2)/16)/Ee,Qe=Math.sqrt(Ce-Ne),Je=Math.sqrt(Math.max(0,Ae*Ae-Ne)),xt=(Qe-Je)/Math.sqrt(Ee);R=g4([],q,ne,xt)}const[L,z,V]=this.unprojectPosition(R);return Number.isFinite(_)?[L,z,V]:Number.isFinite(r)?[L,z,r]:[L,z]}projectPosition(e){const[i,r,o=0]=e,u=i*UA,_=r*UA,l=Math.cos(_),I=(o/nf+1)*ch;return[Math.sin(u)*l*I,-Math.cos(u)*l*I,Math.sin(_)*I]}unprojectPosition(e){const[i,r,o]=e,u=Fb(e),_=Math.asin(o/u),I=Math.atan2(i,-r)*L1,R=_*L1,L=(u/ch-1)*nf;return[I,R,L]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,i){const r=this.unproject(i);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}function B0(t,e){const i=Ih([],e,t);return ig(i,i,1/i[3]),i}class $v{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:i={}}=e;this.typedArrayManager=Ph,this.attributes={},this._attributeDefs=i,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:i,buffers:r={},getGeometry:o,geometryBuffer:u,positionFormat:_,dataChanged:l,normalize:I=!0}=this.opts;if(this.data=i,this.getGeometry=o,this.positionSize=u&&u.size||(_==="XY"?2:3),this.buffers=r,this.normalize=I,u&&(ps(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(u),I||(r.vertexPositions=u)),this.geometryBuffer=r.vertexPositions,Array.isArray(l))for(const R of l)this._rebuildGeometry(R);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:i}){this._rebuildGeometry({startRow:e,endRow:i})}getGeometryFromBuffer(e){const i=e.value||e;return ArrayBuffer.isView(i)?Iv(i,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,i){const{attributes:r,buffers:o,_attributeDefs:u,typedArrayManager:_}=this;for(const l in u)if(l in o)_.release(r[l]),r[l]=null;else{const I=u[l];I.copy=i,r[l]=_.allocate(r[l],e,I)}}_forEachGeometry(e,i,r){const{data:o,getGeometry:u}=this,{iterable:_,objectInfo:l}=Dh(o,i,r);for(const I of _){l.index++;const R=u?u(I,l):null;e(R,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:i,vertexStarts:r,instanceCount:o}=this;const{data:u,geometryBuffer:_}=this,{startRow:l=0,endRow:I=1/0}=e||{},R={};if(e||(i=[0],r=[0]),this.normalize||!_)this._forEachGeometry((z,V)=>{const q=z&&this.normalizeGeometry(z);R[V]=q,r[V+1]=r[V]+(q?this.getGeometrySize(q):0)},l,I),o=r[r.length-1];else if(r=u.startIndices,o=r[u.length]||0,ArrayBuffer.isView(_))o=o||_.length/this.positionSize;else if(_ instanceof lr){const z=this.positionSize*4;o=o||_.byteLength/z}else if(_.buffer){const z=_.stride||this.positionSize*4;o=o||_.buffer.byteLength/z}else if(_.value){const z=_.value,V=_.stride/z.BYTES_PER_ELEMENT||this.positionSize;o=o||z.length/V}this._allocate(o,!!e),this.indexStarts=i,this.vertexStarts=r,this.instanceCount=o;const L={};this._forEachGeometry((z,V)=>{const q=R[V]||z;L.vertexStart=r[V],L.indexStart=i[V];const ne=V<r.length-1?r[V+1]:o;L.geometrySize=ne-r[V],L.geometryIndex=V,this.updateGeometryAttributes(q,L)},l,I),this.vertexCount=i[i.length-1]}}const U8=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,V8=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,j8=1024,$8=4,N1=()=>{},z1={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},W8={x:0,y:0,width:0,height:0};function H8(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function q8(t,e,i,r){const o=Math.min(i/e.width,r/e.height),u=Math.floor(e.width*o),_=Math.floor(e.height*o);return o===1?{data:e,width:u,height:_}:(t.canvas.height=_,t.canvas.width=u,t.clearRect(0,0,u,_),t.drawImage(e,0,0,e.width,e.height,0,0,u,_),{data:t.canvas,width:u,height:_})}function zu(t){return t&&(t.id||t.url)}function X8(t,e,i,r){const{width:o,height:u,device:_}=t,l=_.createTexture({format:"rgba8unorm",width:e,height:i,sampler:r}),I=_.createCommandEncoder();return I.copyTextureToTexture({source:t,destination:l,width:o,height:u}),I.finish(),t.destroy(),l}function U1(t,e,i){for(let r=0;r<e.length;r++){const{icon:o,xOffset:u}=e[r],_=zu(o);t[_]={...o,x:u,y:i}}}function Z8({icons:t,buffer:e,mapping:i={},xOffset:r=0,yOffset:o=0,rowHeight:u=0,canvasWidth:_}){let l=[];for(let I=0;I<t.length;I++){const R=t[I],L=zu(R);if(!i[L]){const{height:z,width:V}=R;r+V+e>_&&(U1(i,l,o),r=0,o=u+o+e,u=0,l=[]),l.push({icon:R,xOffset:r}),r=r+V+e,u=Math.max(u,z)}}return l.length>0&&U1(i,l,o),{mapping:i,rowHeight:u,xOffset:r,yOffset:o,canvasWidth:_,canvasHeight:H8(u+o+e)}}function Y8(t,e,i){if(!t||!e)return null;i=i||{};const r={},{iterable:o,objectInfo:u}=Dh(t);for(const _ of o){u.index++;const l=e(_,u),I=zu(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!r[I]&&(!i[I]||l.url!==i[I].url)&&(r[I]={...l,source:_,sourceIndex:u.index})}return r}class G8{constructor(e,{onUpdate:i=N1,onError:r=N1}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=$8,this._canvasWidth=j8,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=i,this.onError=r}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const i=this._autoPacking?zu(e):e;return this._mapping[i]||W8}setProps({loadOptions:e,autoPacking:i,iconAtlas:r,iconMapping:o,textureParameters:u}){var _;e&&(this._loadOptions=e),i!==void 0&&(this._autoPacking=i),o&&(this._mapping=o),r&&((_=this._texture)==null||_.delete(),this._texture=null,this._externalTexture=r),u&&(this._textureParameters=u)}get isLoaded(){return this._pendingCount===0}packIcons(e,i){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(Y8(e,i,this._mapping)||{});if(r.length>0){const{mapping:o,xOffset:u,yOffset:_,rowHeight:l,canvasHeight:I}=Z8({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=o,this._xOffset=u,this._yOffset=_,this._canvasHeight=I,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||z1})),this._texture.height!==this._canvasHeight&&(this._texture=X8(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||z1)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const i=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,pf(r.url,this._loadOptions).then(o=>{const u=zu(r),_=this._mapping[u],{x:l,y:I,width:R,height:L}=_,{data:z,width:V,height:q}=q8(i,o,R,L);this._texture.setSubImageData({data:z,x:l+(R-V)/2,y:I+(L-q)/2,width:V,height:q}),_.width=V,_.height=q,this._texture.generateMipmap(),this.onUpdate()}).catch(o=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:o})}).finally(()=>{this._pendingCount--})}}const Wv=[0,0,0,255],Q8={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:Wv},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class _g extends Ac{getShaders(){return super.getShaders({vs:U8,fs:V8,modules:[Mh,Rh]})}initializeState(){this.state={iconManager:new G8(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:Wv},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var q;super.updateState(e);const{props:i,oldProps:r,changeFlags:o}=e,u=this.getAttributeManager(),{iconAtlas:_,iconMapping:l,data:I,getIcon:R,textureParameters:L}=i,{iconManager:z}=this.state;if(typeof _=="string")return;const V=_||this.internalState.isAsyncPropLoading("iconAtlas");z.setProps({loadOptions:i.loadOptions,autoPacking:!V,iconAtlas:_,iconMapping:V?l:null,textureParameters:L}),V?r.iconMapping!==i.iconMapping&&u.invalidate("getIcon"):(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&z.packIcons(I,R),o.extensionsChanged&&((q=this.state.model)==null||q.destroy(),this.state.model=this._getModel(),u.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:i,sizeMinPixels:r,sizeMaxPixels:o,sizeUnits:u,billboard:_,alphaCutoff:l}=this.props,{iconManager:I}=this.state,R=I.getTexture();if(R){const L=this.state.model;L.setBindings({iconsTexture:R}),L.setUniforms(e),L.setUniforms({iconsTextureDim:[R.width,R.height],sizeUnits:Ta[u],sizeScale:i,sizeMinPixels:r,sizeMaxPixels:o,billboard:_,alphaCutoff:l}),L.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Sn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new rc({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var r;const i=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;i?i(e):mi.error(e.error.message)()}getInstanceOffset(e){const{width:i,height:r,anchorX:o=i/2,anchorY:u=r/2}=this.state.iconManager.getIconMapping(e);return[i/2-o,r/2-u]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:i,y:r,width:o,height:u}=this.state.iconManager.getIconMapping(e);return[i,r,o,u]}}_g.defaultProps=Q8;_g.layerName="IconLayer";const Hv=_g,K8=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,J8=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,V1=[0,0,0,255],eD={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:V1},getLineColor:{type:"accessor",value:V1},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class mg extends Ac{getShaders(){return super.getShaders({vs:K8,fs:J8,modules:[Mh,Rh]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e),e.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:i,radiusScale:r,radiusMinPixels:o,radiusMaxPixels:u,stroked:_,filled:l,billboard:I,antialiasing:R,lineWidthUnits:L,lineWidthScale:z,lineWidthMinPixels:V,lineWidthMaxPixels:q}=this.props,ne=this.state.model;ne.setUniforms(e),ne.setUniforms({stroked:_?1:0,filled:l,billboard:I,antialiasing:R,radiusUnits:Ta[i],radiusScale:r,radiusMinPixels:o,radiusMaxPixels:u,lineWidthUnits:Ta[L],lineWidthScale:z,lineWidthMinPixels:V,lineWidthMaxPixels:q}),ne.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Sn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new rc({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}mg.defaultProps=eD;mg.layerName="ScatterplotLayer";const tD=mg,yg={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function bg(t,e,i={}){return iD(t,i)!==e?(sD(t,i),!0):!1}function iD(t,e={}){return Math.sign(rD(t,e))}const j1={x:0,y:1,z:2};function rD(t,e={}){const{start:i=0,end:r=t.length,plane:o="xy"}=e,u=e.size||2;let _=0;const l=j1[o[0]],I=j1[o[1]];for(let R=i,L=r-u;R<r;R+=u)_+=(t[R+l]-t[L+l])*(t[R+I]+t[L+I]),L=R;return _/2}function sD(t,e){const{start:i=0,end:r=t.length,size:o=2}=e,u=(r-i)/o,_=Math.floor(u/2);for(let l=0;l<_;++l){const I=i+l*o,R=i+(u-1-l)*o;for(let L=0;L<o;++L){const z=t[I+L];t[I+L]=t[R+L],t[R+L]=z}}}function ho(t,e){const i=e.length,r=t.length;if(r>0){let o=!0;for(let u=0;u<i;u++)if(t[r-i+u]!==e[u]){o=!1;break}if(o)return!1}for(let o=0;o<i;o++)t[r+o]=e[o];return!0}function Pp(t,e){const i=e.length;for(let r=0;r<i;r++)t[r]=e[r]}function Uu(t,e,i,r,o=[]){const u=r+e*i;for(let _=0;_<i;_++)o[_]=t[u+_];return o}function Ip(t,e,i,r,o=[]){let u,_;if(i&8)u=(r[3]-t[1])/(e[1]-t[1]),_=3;else if(i&4)u=(r[1]-t[1])/(e[1]-t[1]),_=1;else if(i&2)u=(r[2]-t[0])/(e[0]-t[0]),_=2;else if(i&1)u=(r[0]-t[0])/(e[0]-t[0]),_=0;else return null;for(let l=0;l<t.length;l++)o[l]=(_&1)===l?r[_]:u*(e[l]-t[l])+t[l];return o}function of(t,e){let i=0;return t[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}function qv(t,e){const{size:i=2,broken:r=!1,gridResolution:o=10,gridOffset:u=[0,0],startIndex:_=0,endIndex:l=t.length}=e||{},I=(l-_)/i;let R=[];const L=[R],z=Uu(t,0,i,_);let V,q;const ne=Zv(z,o,u,[]),Ae=[];ho(R,z);for(let Ee=1;Ee<I;Ee++){for(V=Uu(t,Ee,i,_,V),q=of(V,ne);q;){Ip(z,V,q,ne,Ae);const Ce=of(Ae,ne);Ce&&(Ip(z,Ae,Ce,ne,Ae),q=Ce),ho(R,Ae),Pp(z,Ae),oD(ne,o,q),r&&R.length>i&&(R=[],L.push(R),ho(R,z)),q=of(V,ne)}ho(R,V),Pp(z,V)}return r?L:L[0]}const $1=0,nD=1;function Xv(t,e=null,i){if(!t.length)return[];const{size:r=2,gridResolution:o=10,gridOffset:u=[0,0],edgeTypes:_=!1}=i||{},l=[],I=[{pos:t,types:_?new Array(t.length/r).fill(nD):null,holes:e||[]}],R=[[],[]];let L=[];for(;I.length;){const{pos:z,types:V,holes:q}=I.shift();aD(z,r,q[0]||z.length,R),L=Zv(R[0],o,u,L);const ne=of(R[1],L);if(ne){let Ae=W1(z,V,r,0,q[0]||z.length,L,ne);const Ee={pos:Ae[0].pos,types:Ae[0].types,holes:[]},Ce={pos:Ae[1].pos,types:Ae[1].types,holes:[]};I.push(Ee,Ce);for(let Le=0;Le<q.length;Le++)Ae=W1(z,V,r,q[Le],q[Le+1]||z.length,L,ne),Ae[0]&&(Ee.holes.push(Ee.pos.length),Ee.pos=VA(Ee.pos,Ae[0].pos),_&&(Ee.types=VA(Ee.types,Ae[0].types))),Ae[1]&&(Ce.holes.push(Ce.pos.length),Ce.pos=VA(Ce.pos,Ae[1].pos),_&&(Ce.types=VA(Ce.types,Ae[1].types)))}else{const Ae={positions:z};_&&(Ae.edgeTypes=V),q.length&&(Ae.holeIndices=q),l.push(Ae)}}return l}function W1(t,e,i,r,o,u,_){const l=(o-r)/i,I=[],R=[],L=[],z=[],V=[];let q,ne,Ae;const Ee=Uu(t,l-1,i,r);let Ce=Math.sign(_&8?Ee[1]-u[3]:Ee[0]-u[2]),Le=e&&e[l-1],Oe=0,Ne=0;for(let Qe=0;Qe<l;Qe++)q=Uu(t,Qe,i,r,q),ne=Math.sign(_&8?q[1]-u[3]:q[0]-u[2]),Ae=e&&e[r/i+Qe],ne&&Ce&&Ce!==ne&&(Ip(Ee,q,_,u,V),ho(I,V)&&L.push(Le),ho(R,V)&&z.push(Le)),ne<=0?(ho(I,q)&&L.push(Ae),Oe-=ne):L.length&&(L[L.length-1]=$1),ne>=0?(ho(R,q)&&z.push(Ae),Ne+=ne):z.length&&(z[z.length-1]=$1),Pp(Ee,q),Ce=ne,Le=Ae;return[Oe?{pos:I,types:e&&L}:null,Ne?{pos:R,types:e&&z}:null]}function Zv(t,e,i,r){const o=Math.floor((t[0]-i[0])/e)*e+i[0],u=Math.floor((t[1]-i[1])/e)*e+i[1];return r[0]=o,r[1]=u,r[2]=o+e,r[3]=u+e,r}function oD(t,e,i){i&8?(t[1]+=e,t[3]+=e):i&4?(t[1]-=e,t[3]-=e):i&2?(t[0]+=e,t[2]+=e):i&1&&(t[0]-=e,t[2]-=e)}function aD(t,e,i,r){let o=1/0,u=-1/0,_=1/0,l=-1/0;for(let I=0;I<i;I+=e){const R=t[I],L=t[I+1];o=R<o?R:o,u=R>u?R:u,_=L<_?L:_,l=L>l?L:l}return r[0][0]=o,r[0][1]=_,r[1][0]=u,r[1][1]=l,r}function VA(t,e){for(let i=0;i<e.length;i++)t.push(e[i]);return t}const lD=85.051129;function cD(t,e){const{size:i=2,startIndex:r=0,endIndex:o=t.length,normalize:u=!0}=e||{},_=t.slice(r,o);Yv(_,i,0,o-r);const l=qv(_,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(u)for(const I of l)Gv(I,i);return l}function hD(t,e=null,i){const{size:r=2,normalize:o=!0,edgeTypes:u=!1}=i||{};e=e||[];const _=[],l=[];let I=0,R=0;for(let z=0;z<=e.length;z++){const V=e[z]||t.length,q=R,ne=uD(t,r,I,V);for(let Ae=ne;Ae<V;Ae++)_[R++]=t[Ae];for(let Ae=I;Ae<ne;Ae++)_[R++]=t[Ae];Yv(_,r,q,R),AD(_,r,q,R,i==null?void 0:i.maxLatitude),I=V,l[z]=R}l.pop();const L=Xv(_,l,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:u});if(o)for(const z of L)Gv(z.positions,r);return L}function uD(t,e,i,r){let o=-1,u=-1;for(let _=i+1;_<r;_+=e){const l=Math.abs(t[_]);l>o&&(o=l,u=_-1)}return u}function AD(t,e,i,r,o=lD){const u=t[i],_=t[r-e];if(Math.abs(u-_)>180){const l=Uu(t,0,e,i);l[0]+=Math.round((_-u)/360)*360,ho(t,l),l[1]=Math.sign(l[1])*o,ho(t,l),l[0]=u,ho(t,l)}}function Yv(t,e,i,r){let o=t[0],u;for(let _=i;_<r;_+=e){u=t[_];const l=u-o;(l>180||l<-180)&&(u-=Math.round(l/360)*360),t[_]=o=u}}function Gv(t,e){let i;const r=t.length/e;for(let u=0;u<r&&(i=t[u*e],(i+180)%360===0);u++);const o=-Math.round(i/360)*360;if(o!==0)for(let u=0;u<r;u++)t[u*e]+=o}class fD extends rc{constructor(e){const{indices:i,attributes:r}=dD(e);super({...e,indices:i,attributes:r})}}function dD(t){const{radius:e,height:i=1,nradial:r=10}=t;let{vertices:o}=t;o&&(mi.assert(o.length>=r),o=o.flatMap(q=>[q[0],q[1]]),bg(o,yg.COUNTER_CLOCKWISE));const u=i>0,_=r+1,l=u?_*3+1:r,I=Math.PI*2/r,R=new Uint16Array(u?r*3*2:0),L=new Float32Array(l*3),z=new Float32Array(l*3);let V=0;if(u){for(let q=0;q<_;q++){const ne=q*I,Ae=q%r,Ee=Math.sin(ne),Ce=Math.cos(ne);for(let Le=0;Le<2;Le++)L[V+0]=o?o[Ae*2]:Ce*e,L[V+1]=o?o[Ae*2+1]:Ee*e,L[V+2]=(1/2-Le)*i,z[V+0]=o?o[Ae*2]:Ce,z[V+1]=o?o[Ae*2+1]:Ee,V+=3}L[V+0]=L[V-3],L[V+1]=L[V-2],L[V+2]=L[V-1],V+=3}for(let q=u?0:1;q<_;q++){const ne=Math.floor(q/2)*Math.sign(.5-q%2),Ae=ne*I,Ee=(ne+r)%r,Ce=Math.sin(Ae),Le=Math.cos(Ae);L[V+0]=o?o[Ee*2]:Le*e,L[V+1]=o?o[Ee*2+1]:Ce*e,L[V+2]=i/2,z[V+2]=1,V+=3}if(u){let q=0;for(let ne=0;ne<r;ne++)R[q++]=ne*2+0,R[q++]=ne*2+2,R[q++]=ne*2+0,R[q++]=ne*2+1,R[q++]=ne*2+1,R[q++]=ne*2+3}return{indices:R,attributes:{POSITION:{size:3,value:L},NORMAL:{size:3,value:z}}}}const pD=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
} else if (stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
if (isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = radius * coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
if (radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded && !isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,gD=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (extruded && !isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Df=[0,0,0,255],_D={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:Df},getLineColor:{type:"accessor",value:Df},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class vg extends Ac{getShaders(){const e={},{flatShading:i}=this.props;return i&&(e.FLAT_SHADING=1),super.getShaders({vs:pD,fs:gD,defines:e,modules:[Mh,i?EI:qb,Rh]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:Df},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:Df},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var l;super.updateState(e);const{props:i,oldProps:r,changeFlags:o}=e,u=o.extensionsChanged||i.flatShading!==r.flatShading;u&&((l=this.state.models)==null||l.forEach(I=>I.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const _=this.getNumInstances();this.state.fillModel.setInstanceCount(_),this.state.wireframeModel.setInstanceCount(_),(u||i.diskResolution!==r.diskResolution||i.vertices!==r.vertices||(i.extruded||i.stroked)!==(r.extruded||r.stroked))&&this._updateGeometry(i)}getGeometry(e,i,r){const o=new fD({radius:1,height:r?2:0,vertices:i,nradial:e});let u=0;if(i)for(let _=0;_<e;_++){const l=i[_],I=Math.sqrt(l[0]*l[0]+l[1]*l[1]);u+=I/e}else u=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*u}),o}_getModels(){const e=this.getShaders(),i=this.getAttributeManager().getBufferLayouts(),r=new Sn(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:i,isInstanced:!0}),o=new Sn(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:i,isInstanced:!0});return{fillModel:r,wireframeModel:o,models:[o,r]}}_updateGeometry({diskResolution:e,vertices:i,extruded:r,stroked:o}){const u=this.getGeometry(e,i,r||o);this.setState({fillVertexCount:u.attributes.POSITION.value.length/3});const _=this.state.fillModel,l=this.state.wireframeModel;_.setGeometry(u),_.setTopology("triangle-strip"),_.setIndexBuffer(null),l.setGeometry(u),l.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:i,lineWidthScale:r,lineWidthMinPixels:o,lineWidthMaxPixels:u,radiusUnits:_,elevationScale:l,extruded:I,filled:R,stroked:L,wireframe:z,offset:V,coverage:q,radius:ne,angle:Ae}=this.props,Ee=this.state.fillModel,Ce=this.state.wireframeModel,{fillVertexCount:Le,edgeDistance:Oe}=this.state,Ne={...e,radius:ne,angle:Ae/180*Math.PI,offset:V,extruded:I,stroked:L,coverage:q,elevationScale:l,edgeDistance:Oe,radiusUnits:Ta[_],widthUnits:Ta[i],widthScale:r,widthMinPixels:o,widthMaxPixels:u};I&&z&&(Ce.setUniforms(Ne),Ce.setUniforms({isStroke:!0}),Ce.draw(this.context.renderPass)),Ee.setUniforms(Ne),R&&(Ee.setVertexCount(Le),Ee.setUniforms({isStroke:!1}),Ee.draw(this.context.renderPass)),!I&&L&&(Ee.setVertexCount(Le*2/3),Ee.setUniforms({isStroke:!0}),Ee.draw(this.context.renderPass))}}vg.layerName="ColumnLayer";vg.defaultProps=_D;const mD=vg;function yD(t,e,i,r){let o;if(Array.isArray(t[0])){const u=t.length*e;o=new Array(u);for(let _=0;_<t.length;_++)for(let l=0;l<e;l++)o[_*e+l]=t[_][l]||0}else o=t;return i?qv(o,{size:e,gridResolution:i}):r?cD(o,{size:e}):o}const bD=1,vD=2,F0=4;class xD extends $v{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?yD(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(H1(e)){let r=0;for(const o of e)r+=this.getGeometrySize(o);return r}const i=this.getPathLength(e);return i<2?0:this.isClosed(e)?i<3?0:i+2:i}updateGeometryAttributes(e,i){if(i.geometrySize!==0)if(e&&H1(e))for(const r of e){const o=this.getGeometrySize(r);i.geometrySize=o,this.updateGeometryAttributes(r,i),i.vertexStart+=o}else this._updateSegmentTypes(e,i),this._updatePositions(e,i)}_updateSegmentTypes(e,i){const r=this.attributes.segmentTypes,o=e?this.isClosed(e):!1,{vertexStart:u,geometrySize:_}=i;r.fill(0,u,u+_),o?(r[u]=F0,r[u+_-2]=F0):(r[u]+=bD,r[u+_-2]+=vD),r[u+_-1]=F0}_updatePositions(e,i){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:o,geometrySize:u}=i,_=new Array(3);for(let l=o,I=0;I<u;l++,I++)this.getPointOnPath(e,I,_),r[l*3]=_[0],r[l*3+1]=_[1],r[l*3+2]=_[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,i,r=[]){const{positionSize:o}=this;i*o>=e.length&&(i+=1-e.length/o);const u=i*o;return r[0]=e[u],r[1]=e[u+1],r[2]=o===3&&e[u+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:i}=this,r=e.length-i;return e[0]===e[r]&&e[1]===e[r+1]&&(i===2||e[2]===e[r+2])}}function H1(t){return Array.isArray(t[0])}const wD=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,TD=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Qv=[0,0,0,255],ED={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:Qv},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},O0={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class xg extends Ac{getShaders(){return super.getShaders({vs:wD,fs:TD,modules:[Mh,Rh]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:O0,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:O0,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:O0,defaultValue:Qv},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:o,target:u})=>this.encodePickingColor(r&&r.__source?r.__source.index:o,u)}}),this.setState({pathTesselator:new xD({fp64:this.use64bitPositions()})})}updateState(e){var _;super.updateState(e);const{props:i,changeFlags:r}=e,o=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,I=i.data.attributes||{};l.updateGeometry({data:i.data,geometryBuffer:I.getPath,buffers:I,normalize:!i._pathType,loop:i._pathType==="loop",getGeometry:i.getPath,positionFormat:i.positionFormat,wrapLongitude:i.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),r.dataChanged||o.invalidateAll()}r.extensionsChanged&&((_=this.state.model)==null||_.destroy(),this.state.model=this._getModel(),o.invalidateAll())}getPickingInfo(e){const i=super.getPickingInfo(e),{index:r}=i,o=this.props.data;return o[0]&&o[0].__source&&(i.object=o.find(u=>u.__source.index===r)),i}disablePickingIndex(e){const i=this.props.data;if(i[0]&&i[0].__source)for(let r=0;r<i.length;r++)i[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:i,capRounded:r,billboard:o,miterLimit:u,widthUnits:_,widthScale:l,widthMinPixels:I,widthMaxPixels:R}=this.props,L=this.state.model;L.setUniforms(e),L.setUniforms({jointType:Number(i),capType:Number(r),billboard:o,widthUnits:Ta[_],widthScale:l,miterLimit:u,widthMinPixels:I,widthMaxPixels:R}),L.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Sn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new rc({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("positions")}calculateSegmentTypes(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("segmentTypes")}}xg.defaultProps=ED;xg.layerName="PathLayer";const Kv=xg;var wg={exports:{}};wg.exports=cd;wg.exports.default=cd;function cd(t,e,i){i=i||2;var r=e&&e.length,o=r?e[0]*i:t.length,u=Jv(t,0,o,i,!0),_=[];if(!u||u.next===u.prev)return _;var l,I,R,L,z,V,q;if(r&&(u=MD(t,e,u,i)),t.length>80*i){l=R=t[0],I=L=t[1];for(var ne=i;ne<o;ne+=i)z=t[ne],V=t[ne+1],z<l&&(l=z),V<I&&(I=V),z>R&&(R=z),V>L&&(L=V);q=Math.max(R-l,L-I),q=q!==0?32767/q:0}return Vu(u,_,i,l,I,q,0),_}function Jv(t,e,i,r,o){var u,_;if(o===kp(t,e,i,r)>0)for(u=e;u<i;u+=r)_=q1(u,t[u],t[u+1],_);else for(u=i-r;u>=e;u-=r)_=q1(u,t[u],t[u+1],_);return _&&hd(_,_.next)&&($u(_),_=_.next),_}function oc(t,e){if(!t)return t;e||(e=t);var i=t,r;do if(r=!1,!i.steiner&&(hd(i,i.next)||gr(i.prev,i,i.next)===0)){if($u(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function Vu(t,e,i,r,o,u,_){if(t){!_&&u&&FD(t,r,o,u);for(var l=t,I,R;t.prev!==t.next;){if(I=t.prev,R=t.next,u?CD(t,r,o,u):SD(t)){e.push(I.i/i|0),e.push(t.i/i|0),e.push(R.i/i|0),$u(t),t=R.next,l=R.next;continue}if(t=R,t===l){_?_===1?(t=PD(oc(t),e,i),Vu(t,e,i,r,o,u,2)):_===2&&ID(t,e,i,r,o,u):Vu(oc(t),e,i,r,o,u,1);break}}}}function SD(t){var e=t.prev,i=t,r=t.next;if(gr(e,i,r)>=0)return!1;for(var o=e.x,u=i.x,_=r.x,l=e.y,I=i.y,R=r.y,L=o<u?o<_?o:_:u<_?u:_,z=l<I?l<R?l:R:I<R?I:R,V=o>u?o>_?o:_:u>_?u:_,q=l>I?l>R?l:R:I>R?I:R,ne=r.next;ne!==e;){if(ne.x>=L&&ne.x<=V&&ne.y>=z&&ne.y<=q&&hh(o,l,u,I,_,R,ne.x,ne.y)&&gr(ne.prev,ne,ne.next)>=0)return!1;ne=ne.next}return!0}function CD(t,e,i,r){var o=t.prev,u=t,_=t.next;if(gr(o,u,_)>=0)return!1;for(var l=o.x,I=u.x,R=_.x,L=o.y,z=u.y,V=_.y,q=l<I?l<R?l:R:I<R?I:R,ne=L<z?L<V?L:V:z<V?z:V,Ae=l>I?l>R?l:R:I>R?I:R,Ee=L>z?L>V?L:V:z>V?z:V,Ce=Mp(q,ne,e,i,r),Le=Mp(Ae,Ee,e,i,r),Oe=t.prevZ,Ne=t.nextZ;Oe&&Oe.z>=Ce&&Ne&&Ne.z<=Le;){if(Oe.x>=q&&Oe.x<=Ae&&Oe.y>=ne&&Oe.y<=Ee&&Oe!==o&&Oe!==_&&hh(l,L,I,z,R,V,Oe.x,Oe.y)&&gr(Oe.prev,Oe,Oe.next)>=0||(Oe=Oe.prevZ,Ne.x>=q&&Ne.x<=Ae&&Ne.y>=ne&&Ne.y<=Ee&&Ne!==o&&Ne!==_&&hh(l,L,I,z,R,V,Ne.x,Ne.y)&&gr(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;Oe&&Oe.z>=Ce;){if(Oe.x>=q&&Oe.x<=Ae&&Oe.y>=ne&&Oe.y<=Ee&&Oe!==o&&Oe!==_&&hh(l,L,I,z,R,V,Oe.x,Oe.y)&&gr(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.prevZ}for(;Ne&&Ne.z<=Le;){if(Ne.x>=q&&Ne.x<=Ae&&Ne.y>=ne&&Ne.y<=Ee&&Ne!==o&&Ne!==_&&hh(l,L,I,z,R,V,Ne.x,Ne.y)&&gr(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function PD(t,e,i){var r=t;do{var o=r.prev,u=r.next.next;!hd(o,u)&&ex(o,r,r.next,u)&&ju(o,u)&&ju(u,o)&&(e.push(o.i/i|0),e.push(r.i/i|0),e.push(u.i/i|0),$u(r),$u(r.next),r=t=u),r=r.next}while(r!==t);return oc(r)}function ID(t,e,i,r,o,u){var _=t;do{for(var l=_.next.next;l!==_.prev;){if(_.i!==l.i&&ND(_,l)){var I=tx(_,l);_=oc(_,_.next),I=oc(I,I.next),Vu(_,e,i,r,o,u,0),Vu(I,e,i,r,o,u,0);return}l=l.next}_=_.next}while(_!==t)}function MD(t,e,i,r){var o=[],u,_,l,I,R;for(u=0,_=e.length;u<_;u++)l=e[u]*r,I=u<_-1?e[u+1]*r:t.length,R=Jv(t,l,I,r,!1),R===R.next&&(R.steiner=!0),o.push(LD(R));for(o.sort(RD),u=0;u<o.length;u++)i=kD(o[u],i);return i}function RD(t,e){return t.x-e.x}function kD(t,e){var i=DD(t,e);if(!i)return e;var r=tx(i,t);return oc(r,r.next),oc(i,i.next)}function DD(t,e){var i=e,r=t.x,o=t.y,u=-1/0,_;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var l=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(l<=r&&l>u&&(u=l,_=i.x<i.next.x?i:i.next,l===r))return _}i=i.next}while(i!==e);if(!_)return null;var I=_,R=_.x,L=_.y,z=1/0,V;i=_;do r>=i.x&&i.x>=R&&r!==i.x&&hh(o<L?r:u,o,R,L,o<L?u:r,o,i.x,i.y)&&(V=Math.abs(o-i.y)/(r-i.x),ju(i,t)&&(V<z||V===z&&(i.x>_.x||i.x===_.x&&BD(_,i)))&&(_=i,z=V)),i=i.next;while(i!==I);return _}function BD(t,e){return gr(t.prev,t,e.prev)<0&&gr(e.next,t,t.next)<0}function FD(t,e,i,r){var o=t;do o.z===0&&(o.z=Mp(o.x,o.y,e,i,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,OD(o)}function OD(t){var e,i,r,o,u,_,l,I,R=1;do{for(i=t,t=null,u=null,_=0;i;){for(_++,r=i,l=0,e=0;e<R&&(l++,r=r.nextZ,!!r);e++);for(I=R;l>0||I>0&&r;)l!==0&&(I===0||!r||i.z<=r.z)?(o=i,i=i.nextZ,l--):(o=r,r=r.nextZ,I--),u?u.nextZ=o:t=o,o.prevZ=u,u=o;i=r}u.nextZ=null,R*=2}while(_>1);return t}function Mp(t,e,i,r,o){return t=(t-i)*o|0,e=(e-r)*o|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function LD(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function hh(t,e,i,r,o,u,_,l){return(o-_)*(e-l)>=(t-_)*(u-l)&&(t-_)*(r-l)>=(i-_)*(e-l)&&(i-_)*(u-l)>=(o-_)*(r-l)}function ND(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!zD(t,e)&&(ju(t,e)&&ju(e,t)&&UD(t,e)&&(gr(t.prev,t,e.prev)||gr(t,e.prev,e))||hd(t,e)&&gr(t.prev,t,t.next)>0&&gr(e.prev,e,e.next)>0)}function gr(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function hd(t,e){return t.x===e.x&&t.y===e.y}function ex(t,e,i,r){var o=$A(gr(t,e,i)),u=$A(gr(t,e,r)),_=$A(gr(i,r,t)),l=$A(gr(i,r,e));return!!(o!==u&&_!==l||o===0&&jA(t,i,e)||u===0&&jA(t,r,e)||_===0&&jA(i,t,r)||l===0&&jA(i,e,r))}function jA(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function $A(t){return t>0?1:t<0?-1:0}function zD(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&ex(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function ju(t,e){return gr(t.prev,t,t.next)<0?gr(t,e,t.next)>=0&&gr(t,t.prev,e)>=0:gr(t,e,t.prev)<0||gr(t,t.next,e)<0}function UD(t,e){var i=t,r=!1,o=(t.x+e.x)/2,u=(t.y+e.y)/2;do i.y>u!=i.next.y>u&&i.next.y!==i.y&&o<(i.next.x-i.x)*(u-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function tx(t,e){var i=new Rp(t.i,t.x,t.y),r=new Rp(e.i,e.x,e.y),o=t.next,u=e.prev;return t.next=e,e.prev=t,i.next=o,o.prev=i,r.next=i,i.prev=r,u.next=r,r.prev=u,r}function q1(t,e,i,r){var o=new Rp(t,e,i);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function $u(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Rp(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}cd.deviation=function(t,e,i,r){var o=e&&e.length,u=o?e[0]*i:t.length,_=Math.abs(kp(t,0,u,i));if(o)for(var l=0,I=e.length;l<I;l++){var R=e[l]*i,L=l<I-1?e[l+1]*i:t.length;_-=Math.abs(kp(t,R,L,i))}var z=0;for(l=0;l<r.length;l+=3){var V=r[l]*i,q=r[l+1]*i,ne=r[l+2]*i;z+=Math.abs((t[V]-t[ne])*(t[q+1]-t[V+1])-(t[V]-t[q])*(t[ne+1]-t[V+1]))}return _===0&&z===0?0:Math.abs((z-_)/_)};function kp(t,e,i,r){for(var o=0,u=e,_=i-r;u<i;u+=r)o+=(t[_]-t[u])*(t[u+1]+t[_+1]),_=u;return o}cd.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,o=0;o<t.length;o++){for(var u=0;u<t[o].length;u++)for(var _=0;_<e;_++)i.vertices.push(t[o][u][_]);o>0&&(r+=t[o-1].length,i.holes.push(r))}return i};var VD=wg.exports;const jD=Jf(VD),WA=yg.CLOCKWISE,X1=yg.COUNTER_CLOCKWISE,al={isClosed:!0};function $D(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function vu(t){return"positions"in t?t.positions:t}function af(t){return"holeIndices"in t?t.holeIndices:null}function WD(t){return Array.isArray(t[0])}function HD(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function qD(t){const e=t[0],i=t[t.length-1];return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]}function XD(t,e,i,r){for(let o=0;o<e;o++)if(t[i+o]!==t[r-e+o])return!1;return!0}function Z1(t,e,i,r,o){let u=e;const _=i.length;for(let l=0;l<_;l++)for(let I=0;I<r;I++)t[u++]=i[l][I]||0;if(!qD(i))for(let l=0;l<r;l++)t[u++]=i[0][l]||0;return al.start=e,al.end=u,al.size=r,bg(t,o,al),u}function Y1(t,e,i,r,o=0,u,_){u=u||i.length;const l=u-o;if(l<=0)return e;let I=e;for(let R=0;R<l;R++)t[I++]=i[o+R];if(!XD(i,r,o,u))for(let R=0;R<r;R++)t[I++]=i[o+R];return al.start=e,al.end=I,al.size=r,bg(t,_,al),I}function ix(t,e){$D(t);const i=[],r=[];if("positions"in t){const{positions:o,holeIndices:u}=t;if(u){let _=0;for(let l=0;l<=u.length;l++)_=Y1(i,_,o,e,u[l-1],u[l],l===0?WA:X1),r.push(_);return r.pop(),{positions:i,holeIndices:r}}t=o}if(!WD(t))return Y1(i,0,t,e,0,i.length,WA),i;if(!HD(t)){let o=0;for(const[u,_]of t.entries())o=Z1(i,o,_,e,u===0?WA:X1),r.push(o);return r.pop(),{positions:i,holeIndices:r}}return Z1(i,0,t,e,WA),i}function L0(t,e,i){const r=t.length/3;let o=0;for(let u=0;u<r;u++){const _=(u+1)%r;o+=t[u*3+e]*t[_*3+i],o-=t[_*3+e]*t[u*3+i]}return Math.abs(o/2)}function G1(t,e,i,r){const o=t.length/3;for(let u=0;u<o;u++){const _=u*3,l=t[_+0],I=t[_+1],R=t[_+2];t[_+e]=l,t[_+i]=I,t[_+r]=R}}function ZD(t,e,i,r){let o=af(t);o&&(o=o.map(l=>l/e));let u=vu(t);const _=r&&e===3;if(i){const l=u.length;u=u.slice();const I=[];for(let R=0;R<l;R+=e){I[0]=u[R],I[1]=u[R+1],_&&(I[2]=u[R+2]);const L=i(I);u[R]=L[0],u[R+1]=L[1],_&&(u[R+2]=L[2])}}if(_){const l=L0(u,0,1),I=L0(u,0,2),R=L0(u,1,2);if(!l&&!I&&!R)return[];l>I&&l>R||(I>R?(i||(u=u.slice()),G1(u,0,2,1)):(i||(u=u.slice()),G1(u,2,0,1)))}return jD(u,o,e)}class YD extends $v{constructor(e){const{fp64:i,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:i}=this;return e==="indices"?i.indices&&i.indices.subarray(0,this.vertexCount):i[e]}updateGeometry(e){super.updateGeometry(e);const i=this.buffers.indices;if(i)this.vertexCount=(i.value||i).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const i=ix(e,this.positionSize);return this.opts.resolution?Xv(vu(i),af(i),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?hD(vu(i),af(i),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):i}return e}getGeometrySize(e){if(Q1(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}return vu(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,i){if(e&&Q1(e))for(const r of e){const o=this.getGeometrySize(r);i.geometrySize=o,this.updateGeometryAttributes(r,i),i.vertexStart+=o,i.indexStart=this.indexStarts[i.geometryIndex+1]}else{const r=e;this._updateIndices(r,i),this._updatePositions(r,i),this._updateVertexValid(r,i)}}_updateIndices(e,{geometryIndex:i,vertexStart:r,indexStart:o}){const{attributes:u,indexStarts:_,typedArrayManager:l}=this;let I=u.indices;if(!I||!e)return;let R=o;const L=ZD(e,this.positionSize,this.opts.preproject,this.opts.full3d);I=l.allocate(I,o+L.length,{copy:!0});for(let z=0;z<L.length;z++)I[R++]=L[z]+r;_[i+1]=o+L.length,u.indices=I}_updatePositions(e,{vertexStart:i,geometrySize:r}){const{attributes:{positions:o},positionSize:u}=this;if(!o||!e)return;const _=vu(e);for(let l=i,I=0;I<r;l++,I++){const R=_[I*u],L=_[I*u+1],z=u>2?_[I*u+2]:0;o[l*3]=R,o[l*3+1]=L,o[l*3+2]=z}}_updateVertexValid(e,{vertexStart:i,geometrySize:r}){const{positionSize:o}=this,u=this.attributes.vertexValid,_=e&&af(e);if(e&&e.edgeTypes?u.set(e.edgeTypes,i):u.fill(1,i,i+r),_)for(let l=0;l<_.length;l++)u[i+_[l]/o-1]=0;u[i+r-1]=0}}function Q1(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const rx=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,GD=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${rx}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,QD=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${rx}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,KD=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Bf=[0,0,0,255],JD={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Bf},getLineColor:{type:"accessor",value:Bf},material:!0},HA={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Tg extends Ac{getShaders(e){return super.getShaders({vs:e==="top"?GD:QD,fs:KD,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Mh,qb,Rh]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&i===Ri.DEFAULT&&(i=Ri.LNGLAT);let o;i===Ri.LNGLAT&&(r?o=e.projectPosition.bind(e):o=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new YD({preproject:o,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const u=this.getAttributeManager(),_=!0;u.remove(["instancePickingColors"]),u.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:_},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:HA,accessor:"getPolygon",update:this.calculatePositions,noAlloc:_,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:_},elevations:{size:1,stepMode:"dynamic",transition:HA,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:HA,accessor:"getFillColor",defaultValue:Bf},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:HA,accessor:"getLineColor",defaultValue:Bf},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(l,{index:I,target:R})=>this.encodePickingColor(l&&l.__source?l.__source.index:I,R)}})}getPickingInfo(e){const i=super.getPickingInfo(e),{index:r}=i,o=this.props.data;return o[0]&&o[0].__source&&(i.object=o.find(u=>u.__source.index===r)),i}disablePickingIndex(e){const i=this.props.data;if(i[0]&&i[0].__source)for(let r=0;r<i.length;r++)i[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:i,filled:r,wireframe:o,elevationScale:u}=this.props,{topModel:_,sideModel:l,wireframeModel:I,polygonTesselator:R}=this.state,L={...e,extruded:!!i,elevationScale:u};I&&o&&(I.setInstanceCount(R.instanceCount-1),I.setUniforms(L),I.draw(this.context.renderPass)),l&&r&&(l.setInstanceCount(R.instanceCount-1),l.setUniforms(L),l.draw(this.context.renderPass)),_&&r&&(_.setVertexCount(R.vertexCount),_.setUniforms(L),_.draw(this.context.renderPass))}updateState(e){var l;super.updateState(e),this.updateGeometry(e);const{props:i,oldProps:r,changeFlags:o}=e,u=this.getAttributeManager();(o.extensionsChanged||i.filled!==r.filled||i.extruded!==r.extruded)&&((l=this.state.models)==null||l.forEach(I=>I.destroy()),this.setState(this._getModels()),u.invalidateAll())}updateGeometry({props:e,oldProps:i,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:u}=this.state,_=e.data.attributes||{};u.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:_.getPolygon,buffers:_,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:u.instanceCount,startIndices:u.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:i,extruded:r}=this.props;let o,u,_;if(i){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1;const I=this.getAttributeManager().getBufferLayouts({isInstanced:!1});o=new Sn(this.context.device,{...l,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:I,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const l=this.getAttributeManager().getBufferLayouts({isInstanced:!0});u=new Sn(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:l,uniforms:{isWireframe:!1},geometry:new rc({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),_=new Sn(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:l,uniforms:{isWireframe:!0},geometry:new rc({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[u,_,o].filter(Boolean),topModel:o,sideModel:u,wireframeModel:_}}calculateIndices(e){const{polygonTesselator:i}=this.state;e.startIndices=i.indexStarts,e.value=i.get("indices")}calculatePositions(e){const{polygonTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Tg.defaultProps=JD;Tg.layerName="SolidPolygonLayer";const sx=Tg;function nx({data:t,getIndex:e,dataRange:i,replace:r}){const{startRow:o=0,endRow:u=1/0}=i,_=t.length;let l=_,I=_;for(let V=0;V<_;V++){const q=e(t[V]);if(l>V&&q>=o&&(l=V),q>=u){I=V;break}}let R=l;const z=I-l!==r.length?t.slice(I):void 0;for(let V=0;V<r.length;V++)t[R++]=r[V];if(z){for(let V=0;V<z.length;V++)t[R++]=z[V];t.length=R}return{startRow:l,endRow:l+r.length}}const ox=[0,0,0,255],eB=[0,0,0,255],tB={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:eB},getLineColor:{type:"accessor",value:ox},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Eg extends Bh{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&mi.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(i&&Array.isArray(e.dataChanged)){const r=this.state.paths.slice(),o=e.dataChanged.map(u=>nx({data:r,getIndex:_=>_.__source.index,dataRange:u,replace:this._getPaths(u)}));this.setState({paths:r,pathsDiff:o})}else i&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:i,getPolygon:r,positionFormat:o,_normalize:u}=this.props,_=[],l=o==="XY"?2:3,{startRow:I,endRow:R}=e,{iterable:L,objectInfo:z}=Dh(i,I,R);for(const V of L){z.index++;let q=r(V,z);u&&(q=ix(q,l));const{holeIndices:ne}=q,Ae=q.positions||q;if(ne)for(let Ee=0;Ee<=ne.length;Ee++){const Ce=Ae.slice(ne[Ee-1]||0,ne[Ee]||Ae.length);_.push(this.getSubLayerRow({path:Ce},V,z.index))}else _.push(this.getSubLayerRow({path:Ae},V,z.index))}return _}renderLayers(){const{data:e,_dataDiff:i,stroked:r,filled:o,extruded:u,wireframe:_,_normalize:l,_windingOrder:I,elevationScale:R,transitions:L,positionFormat:z}=this.props,{lineWidthUnits:V,lineWidthScale:q,lineWidthMinPixels:ne,lineWidthMaxPixels:Ae,lineJointRounded:Ee,lineMiterLimit:Ce,lineDashJustified:Le}=this.props,{getFillColor:Oe,getLineColor:Ne,getLineWidth:Qe,getLineDashArray:Je,getElevation:xt,getPolygon:wt,updateTriggers:ct,material:at}=this.props,{paths:Vt,pathsDiff:Ot}=this.state,$t=this.getSubLayerClass("fill",sx),qt=this.getSubLayerClass("stroke",Kv),gi=this.shouldRenderSubLayer("fill",Vt)&&new $t({_dataDiff:i,extruded:u,elevationScale:R,filled:o,wireframe:_,_normalize:l,_windingOrder:I,getElevation:xt,getFillColor:Oe,getLineColor:u&&_?Ne:ox,material:at,transitions:L},this.getSubLayerProps({id:"fill",updateTriggers:ct&&{getPolygon:ct.getPolygon,getElevation:ct.getElevation,getFillColor:ct.getFillColor,lineColors:u&&_,getLineColor:ct.getLineColor}}),{data:e,positionFormat:z,getPolygon:wt}),Nr=!u&&r&&this.shouldRenderSubLayer("stroke",Vt)&&new qt({_dataDiff:Ot&&(()=>Ot),widthUnits:V,widthScale:q,widthMinPixels:ne,widthMaxPixels:Ae,jointRounded:Ee,miterLimit:Ce,dashJustified:Le,_pathType:"loop",transitions:L&&{getWidth:L.getLineWidth,getColor:L.getLineColor,getPath:L.getPolygon},getColor:this.getSubLayerAccessor(Ne),getWidth:this.getSubLayerAccessor(Qe),getDashArray:this.getSubLayerAccessor(Je)},this.getSubLayerProps({id:"stroke",updateTriggers:ct&&{getWidth:ct.getLineWidth,getColor:ct.getLineColor,getDashArray:ct.getLineDashArray}}),{data:Vt,positionFormat:z,getPath:hr=>hr.path});return[!u&&gi,Nr,u&&gi]}}Eg.layerName="PolygonLayer";Eg.defaultProps=tB;const ax=Eg;function iB(t,e){if(!t)return null;const i="startIndices"in t?t.startIndices[e]:e,r=t.featureIds.value[i];return i!==-1?rB(t,r,i):null}function rB(t,e,i){const r={properties:{...t.properties[e]}};for(const o in t.numericProps)r.properties[o]=t.numericProps[o].value[i];return r}function sB(t,e){const i={points:null,lines:null,polygons:null};for(const r in i){const o=t[r].globalFeatureIds.value;i[r]=new Uint8ClampedArray(o.length*4);const u=[];for(let _=0;_<o.length;_++)e(o[_],u),i[r][_*4+0]=u[0],i[r][_*4+1]=u[1],i[r][_*4+2]=u[2],i[r][_*4+3]=255}return i}const nB=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,N0=192/256,K1=[],oB={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Sg extends Hv{getShaders(){return{...super.getShaders(),fs:nB}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(i,{index:r,target:o})=>this.encodePickingColor(r,o)}})}updateState(e){super.updateState(e);const{props:i,oldProps:r}=e;let{outlineColor:o}=i;o!==r.outlineColor&&(o=o.map(u=>u/255),o[3]=Number.isFinite(o[3])?o[3]:1,this.setState({outlineColor:o})),!i.sdf&&i.outlineWidth&&mi.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:i,smoothing:r,outlineWidth:o}=this.props,{outlineColor:u}=this.state,_=o?Math.max(r,N0*(1-o)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:N0,outlineBuffer:_,gamma:r,sdf:!!i,outlineColor:u},super.draw(e),i&&o){const{iconManager:l}=this.state,I=l.getTexture(),R=this.state.model;I&&(R.setUniforms({outlineBuffer:N0}),R.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(i=>super.getInstanceOffset(i)):K1}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(i=>super.getInstanceIconFrame(i)):K1}}Sg.defaultProps=oB;Sg.layerName="MultiIconLayer";const aB=Sg,Iu=1e20;class lB{constructor({fontSize:e=24,buffer:i=3,radius:r=8,cutoff:o=.25,fontFamily:u="sans-serif",fontWeight:_="normal",fontStyle:l="normal"}={}){this.buffer=i,this.cutoff=o,this.radius=r;const I=this.size=e+i*4,R=this._createCanvas(I),L=this.ctx=R.getContext("2d",{willReadFrequently:!0});L.font=`${l} ${_} ${e}px ${u}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(e){const i=document.createElement("canvas");return i.width=i.height=e,i}draw(e){const{width:i,actualBoundingBoxAscent:r,actualBoundingBoxDescent:o,actualBoundingBoxLeft:u,actualBoundingBoxRight:_}=this.ctx.measureText(e),l=Math.ceil(r),I=0,R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-u))),L=Math.min(this.size-this.buffer,l+Math.ceil(o)),z=R+2*this.buffer,V=L+2*this.buffer,q=Math.max(z*V,0),ne=new Uint8ClampedArray(q),Ae={data:ne,width:z,height:V,glyphWidth:R,glyphHeight:L,glyphTop:l,glyphLeft:I,glyphAdvance:i};if(R===0||L===0)return Ae;const{ctx:Ee,buffer:Ce,gridInner:Le,gridOuter:Oe}=this;Ee.clearRect(Ce,Ce,R,L),Ee.fillText(e,Ce,Ce+l);const Ne=Ee.getImageData(Ce,Ce,R,L);Oe.fill(Iu,0,q),Le.fill(0,0,q);for(let Qe=0;Qe<L;Qe++)for(let Je=0;Je<R;Je++){const xt=Ne.data[4*(Qe*R+Je)+3]/255;if(xt===0)continue;const wt=(Qe+Ce)*z+Je+Ce;if(xt===1)Oe[wt]=0,Le[wt]=Iu;else{const ct=.5-xt;Oe[wt]=ct>0?ct*ct:0,Le[wt]=ct<0?ct*ct:0}}J1(Oe,0,0,z,V,z,this.f,this.v,this.z),J1(Le,Ce,Ce,R,L,z,this.f,this.v,this.z);for(let Qe=0;Qe<q;Qe++){const Je=Math.sqrt(Oe[Qe])-Math.sqrt(Le[Qe]);ne[Qe]=Math.round(255-255*(Je/this.radius+this.cutoff))}return Ae}}function J1(t,e,i,r,o,u,_,l,I){for(let R=e;R<e+r;R++)e2(t,i*u+R,u,o,_,l,I);for(let R=i;R<i+o;R++)e2(t,R*u+e,1,r,_,l,I)}function e2(t,e,i,r,o,u,_){u[0]=0,_[0]=-Iu,_[1]=Iu,o[0]=t[e];for(let l=1,I=0,R=0;l<r;l++){o[l]=t[e+l*i];const L=l*l;do{const z=u[I];R=(o[l]-o[z]+L-z*z)/(l-z)/2}while(R<=_[I]&&--I>-1);I++,u[I]=l,_[I]=R,_[I+1]=Iu}for(let l=0,I=0;l<r;l++){for(;_[I+1]<l;)I++;const R=u[I],L=l-R;t[e+l*i]=o[R]+L*L}}const cB=32,hB=[];function uB(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function AB({characterSet:t,getFontWidth:e,fontHeight:i,buffer:r,maxCanvasWidth:o,mapping:u={},xOffset:_=0,yOffset:l=0}){let I=0,R=_;const L=i+r*2;for(const z of t)if(!u[z]){const V=e(z);R+V+r*2>o&&(R=0,I++),u[z]={x:R+r,y:l+I*L+r,width:V,height:L,layoutWidth:V,layoutHeight:i},R+=V+r*2}return{mapping:u,xOffset:R,yOffset:l+I*L,canvasHeight:uB(l+(I+1)*L)}}function lx(t,e,i,r){var u;let o=0;for(let _=e;_<i;_++){const l=t[_];o+=((u=r[l])==null?void 0:u.layoutWidth)||0}return o}function cx(t,e,i,r,o,u){let _=e,l=0;for(let I=e;I<i;I++){const R=lx(t,I,I+1,o);l+R>r&&(_<I&&u.push(I),_=I,l=0),l+=R}return l}function fB(t,e,i,r,o,u){let _=e,l=e,I=e,R=0;for(let L=e;L<i;L++)if((t[L]===" "||t[L+1]===" "||L+1===i)&&(I=L+1),I>l){let z=lx(t,l,I,o);R+z>r&&(_<l&&(u.push(l),_=l,R=0),z>r&&(z=cx(t,l,I,r,o,u),_=u[u.length-1])),l=I,R+=z}return R}function dB(t,e,i,r,o=0,u){u===void 0&&(u=t.length);const _=[];return e==="break-all"?cx(t,o,u,i,r,_):fB(t,o,u,i,r,_),_}function pB(t,e,i,r,o,u){let _=0,l=0;for(let I=e;I<i;I++){const R=t[I],L=r[R];L?(l||(l=L.layoutHeight),o[I]=_+L.layoutWidth/2,_+=L.layoutWidth):(mi.warn(`Missing character: ${R} (${R.codePointAt(0)})`)(),o[I]=_,_+=cB)}u[0]=_,u[1]=l}function gB(t,e,i,r,o){var Ee;const u=Array.from(t),_=u.length,l=new Array(_),I=new Array(_),R=new Array(_),L=(i==="break-word"||i==="break-all")&&isFinite(r)&&r>0,z=[0,0],V=[0,0];let q=0,ne=0,Ae=0;for(let Ce=0;Ce<=_;Ce++){const Le=u[Ce];if((Le===`
`||Ce===_)&&(Ae=Ce),Ae>ne){const Oe=L?dB(u,i,r,o,ne,Ae):hB;for(let Ne=0;Ne<=Oe.length;Ne++){const Qe=Ne===0?ne:Oe[Ne-1],Je=Ne<Oe.length?Oe[Ne]:Ae;pB(u,Qe,Je,o,l,V);for(let xt=Qe;xt<Je;xt++){const wt=u[xt],ct=((Ee=o[wt])==null?void 0:Ee.layoutOffsetY)||0;I[xt]=q+V[1]/2+ct,R[xt]=V[0]}q=q+V[1]*e,z[0]=Math.max(z[0],V[0])}ne=Ae}Le===`
`&&(l[ne]=0,I[ne]=0,R[ne]=0,ne++)}return z[1]=q,{x:l,y:I,rowWidth:R,size:z}}function _B({value:t,length:e,stride:i,offset:r,startIndices:o,characterSet:u}){const _=t.BYTES_PER_ELEMENT,l=i?i/_:1,I=r?r/_:0,R=o[e]||Math.ceil((t.length-I)/l),L=u&&new Set,z=new Array(e);let V=t;if(l>1||I>0){const q=t.constructor;V=new q(R);for(let ne=0;ne<R;ne++)V[ne]=t[ne*l+I]}for(let q=0;q<e;q++){const ne=o[q],Ae=o[q+1]||R,Ee=V.subarray(ne,Ae);z[q]=String.fromCodePoint.apply(null,Ee),L&&Ee.forEach(L.add,L)}if(L)for(const q of L)u.add(String.fromCodePoint(q));return{texts:z,characterCount:R}}class hx{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const i=this._cache[e];return i&&(this._deleteOrder(e),this._appendOrder(e)),i}set(e,i){this._cache[e]?(this.delete(e),this._cache[e]=i,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=i,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const i=this._order.indexOf(e);i>=0&&this._order.splice(i,1)}_appendOrder(e){this._order.push(e)}}function mB(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const yh={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:mB(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},t2=1024,i2=.9,r2=1.2,ux=3;let Ff=new hx(ux);function yB(t,e){let i;typeof e=="string"?i=new Set(Array.from(e)):i=new Set(e);const r=Ff.get(t);if(!r)return i;for(const o in r.mapping)i.has(o)&&i.delete(o);return i}function bB(t,e){for(let i=0;i<t.length;i++)e.data[4*i+3]=t[i]}function s2(t,e,i,r){t.font=`${r} ${i}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function vB(t){mi.assert(Number.isFinite(t)&&t>=ux,"Invalid cache limit"),Ff=new hx(t)}class xB{constructor(){this.props={...yh}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:i}=this.props;return(e*r2+i*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const i=yB(this._key,this.props.characterSet),r=Ff.get(this._key);if(r&&i.size===0){this._atlas!==r&&(this._atlas=r);return}const o=this._generateFontAtlas(i,r);this._atlas=o,Ff.set(this._key,o)}_generateFontAtlas(e,i){const{fontFamily:r,fontWeight:o,fontSize:u,buffer:_,sdf:l,radius:I,cutoff:R}=this.props;let L=i&&i.data;L||(L=document.createElement("canvas"),L.width=t2);const z=L.getContext("2d",{willReadFrequently:!0});s2(z,r,u,o);const{mapping:V,canvasHeight:q,xOffset:ne,yOffset:Ae}=AB({getFontWidth:Ee=>z.measureText(Ee).width,fontHeight:u*r2,buffer:_,characterSet:e,maxCanvasWidth:t2,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(L.height!==q){const Ee=z.getImageData(0,0,L.width,L.height);L.height=q,z.putImageData(Ee,0,0)}if(s2(z,r,u,o),l){const Ee=new lB({fontSize:u,buffer:_,radius:I,cutoff:R,fontFamily:r,fontWeight:`${o}`});for(const Ce of e){const{data:Le,width:Oe,height:Ne,glyphTop:Qe}=Ee.draw(Ce);V[Ce].width=Oe,V[Ce].layoutOffsetY=u*i2-Qe;const Je=z.createImageData(Oe,Ne);bB(Le,Je),z.putImageData(Je,V[Ce].x,V[Ce].y)}}else for(const Ee of e)z.fillText(Ee,V[Ee].x,V[Ee].y+_+u*i2);return{xOffset:ne,yOffset:Ae,mapping:V,data:L,width:L.width,height:L.height}}_getKey(){const{fontFamily:e,fontWeight:i,fontSize:r,buffer:o,sdf:u,radius:_,cutoff:l}=this.props;return u?`${e} ${i} ${r} ${o} ${_} ${l}`:`${e} ${i} ${r} ${o}`}}const wB=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,TB=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,EB={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Cg extends Ac{getShaders(){return super.getShaders({vs:wB,fs:TB,modules:[Mh,Rh]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e);const{changeFlags:i}=e;i.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:i,sizeScale:r,sizeUnits:o,sizeMinPixels:u,sizeMaxPixels:_,getLineWidth:l}=this.props;let{padding:I}=this.props;I.length<4&&(I=[I[0],I[1],I[0],I[1]]);const R=this.state.model;R.setUniforms(e),R.setUniforms({billboard:i,stroked:!!l,padding:I,sizeUnits:Ta[o],sizeScale:r,sizeMinPixels:u,sizeMaxPixels:_}),R.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new Sn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new rc({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}Cg.defaultProps=EB;Cg.layerName="TextBackgroundLayer";const SB=Cg,n2={start:1,middle:0,end:-1},o2={top:1,center:0,bottom:-1},z0=[0,0,0,255],CB=1,PB={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:z0},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:yh.characterSet},fontFamily:yh.fontFamily,fontWeight:yh.fontWeight,lineHeight:CB,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:z0},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:z0},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Pg extends Bh{constructor(){super(...arguments),this.getBoundingRect=(e,i)=>{let{size:[r,o]}=this.transformParagraph(e,i);const{fontSize:u}=this.state.fontAtlasManager.props;r/=u,o/=u;const{getTextAnchor:_,getAlignmentBaseline:l}=this.props,I=n2[typeof _=="function"?_(e,i):_],R=o2[typeof l=="function"?l(e,i):l];return[(I-1)*r/2,(R-1)*o/2,r,o]},this.getIconOffsets=(e,i)=>{const{getTextAnchor:r,getAlignmentBaseline:o}=this.props,{x:u,y:_,rowWidth:l,size:[I,R]}=this.transformParagraph(e,i),L=n2[typeof r=="function"?r(e,i):r],z=o2[typeof o=="function"?o(e,i):o],V=u.length,q=new Array(V*2);let ne=0;for(let Ae=0;Ae<V;Ae++){const Ee=(1-L)*(I-l[Ae])/2;q[ne++]=(L-1)*I/2+Ee+u[Ae],q[ne++]=(z-1)*R/2+_[Ae]}return q}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new xB},this.props.maxWidth>0&&mi.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:i,oldProps:r,changeFlags:o}=e;(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||i.lineHeight!==r.lineHeight||i.wordBreak!==r.wordBreak||i.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:i,fontWeight:r}=this.props,{fontAtlasManager:o,characterSet:u}=this.state,_={...e,characterSet:u,fontFamily:i,fontWeight:r};if(!o.mapping)return o.setProps(_),!0;for(const l in _)if(_[l]!==o.props[l])return o.setProps(_),!0;return!1}_updateText(){var I;const{data:e,characterSet:i}=this.props,r=(I=e.attributes)==null?void 0:I.getText;let{getText:o}=this.props,u=e.startIndices,_;const l=i==="auto"&&new Set;if(r&&u){const{texts:R,characterCount:L}=_B({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:u,characterSet:l});_=L,o=(z,{index:V})=>R[V]}else{const{iterable:R,objectInfo:L}=Dh(e);u=[0],_=0;for(const z of R){L.index++;const V=Array.from(o(z,L)||"");l&&V.forEach(l.add,l),_+=V.length,u.push(_)}}this.setState({getText:o,startIndices:u,numInstances:_,characterSet:l||i})}transformParagraph(e,i){const{fontAtlasManager:r}=this.state,o=r.mapping,u=this.state.getText,{wordBreak:_,lineHeight:l,maxWidth:I}=this.props,R=u(e,i)||"";return gB(R,l,_,I*r.props.fontSize,o)}renderLayers(){const{startIndices:e,numInstances:i,getText:r,fontAtlasManager:{scale:o,atlas:u,mapping:_},styleVersion:l}=this.state,{data:I,_dataDiff:R,getPosition:L,getColor:z,getSize:V,getAngle:q,getPixelOffset:ne,getBackgroundColor:Ae,getBorderColor:Ee,getBorderWidth:Ce,backgroundPadding:Le,background:Oe,billboard:Ne,fontSettings:Qe,outlineWidth:Je,outlineColor:xt,sizeScale:wt,sizeUnits:ct,sizeMinPixels:at,sizeMaxPixels:Vt,transitions:Ot,updateTriggers:$t}=this.props,qt=this.getSubLayerClass("characters",aB),gi=this.getSubLayerClass("background",SB);return[Oe&&new gi({getFillColor:Ae,getLineColor:Ee,getLineWidth:Ce,padding:Le,getPosition:L,getSize:V,getAngle:q,getPixelOffset:ne,billboard:Ne,sizeScale:wt,sizeUnits:ct,sizeMinPixels:at,sizeMaxPixels:Vt,transitions:Ot&&{getPosition:Ot.getPosition,getAngle:Ot.getAngle,getSize:Ot.getSize,getFillColor:Ot.getBackgroundColor,getLineColor:Ot.getBorderColor,getLineWidth:Ot.getBorderWidth,getPixelOffset:Ot.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:$t.getPosition,getAngle:$t.getAngle,getSize:$t.getSize,getFillColor:$t.getBackgroundColor,getLineColor:$t.getBorderColor,getLineWidth:$t.getBorderWidth,getPixelOffset:$t.getPixelOffset,getBoundingRect:{getText:$t.getText,getTextAnchor:$t.getTextAnchor,getAlignmentBaseline:$t.getAlignmentBaseline,styleVersion:l}}}),{data:I.attributes&&I.attributes.background?{length:I.length,attributes:I.attributes.background}:I,_dataDiff:R,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new qt({sdf:Qe.sdf,smoothing:Number.isFinite(Qe.smoothing)?Qe.smoothing:yh.smoothing,outlineWidth:Je/(Qe.radius||yh.radius),outlineColor:xt,iconAtlas:u,iconMapping:_,getPosition:L,getColor:z,getSize:V,getAngle:q,getPixelOffset:ne,billboard:Ne,sizeScale:wt*o,sizeUnits:ct,sizeMinPixels:at*o,sizeMaxPixels:Vt*o,transitions:Ot&&{getPosition:Ot.getPosition,getAngle:Ot.getAngle,getColor:Ot.getColor,getSize:Ot.getSize,getPixelOffset:Ot.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:$t.getText,getPosition:$t.getPosition,getAngle:$t.getAngle,getColor:$t.getColor,getSize:$t.getSize,getPixelOffset:$t.getPixelOffset,getIconOffsets:{getTextAnchor:$t.getTextAnchor,getAlignmentBaseline:$t.getAlignmentBaseline,styleVersion:l}}}),{data:I,_dataDiff:R,startIndices:e,numInstances:i,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){vB(e)}}Pg.defaultProps=PB;Pg.layerName="TextLayer";const IB=Pg,lf={circle:{type:tD,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Hv,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:IB,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},cf={type:Kv,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Dp={type:sx,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function fu({type:t,props:e}){const i={};for(const r in e)i[r]=t.defaultProps[e[r]];return i}function U0(t,e){const{transitions:i,updateTriggers:r}=t.props,o={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(const u in e){const _=e[u];let l=t.props[u];u.startsWith("get")&&(l=t.getSubLayerAccessor(l),o.updateTriggers[_]=r[u],i&&(o.transitions[_]=i[u])),o[_]=l}return o}function MB(t){if(Array.isArray(t))return t;switch(mi.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return mi.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function a2(t,e,i={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:o=0,endRow:u=t.length}=i;for(let _=o;_<u;_++){const l=t[_],{geometry:I}=l;if(I)if(I.type==="GeometryCollection"){mi.assert(Array.isArray(I.geometries),"GeoJSON does not have geometries array");const{geometries:R}=I;for(let L=0;L<R.length;L++){const z=R[L];l2(z,r,e,l,_)}}else l2(I,r,e,l,_)}return r}function l2(t,e,i,r,o){const{type:u,coordinates:_}=t,{pointFeatures:l,lineFeatures:I,polygonFeatures:R,polygonOutlineFeatures:L}=e;if(!kB(u,_)){mi.warn(`${u} coordinates are malformed`)();return}switch(u){case"Point":l.push(i({geometry:t},r,o));break;case"MultiPoint":_.forEach(z=>{l.push(i({geometry:{type:"Point",coordinates:z}},r,o))});break;case"LineString":I.push(i({geometry:t},r,o));break;case"MultiLineString":_.forEach(z=>{I.push(i({geometry:{type:"LineString",coordinates:z}},r,o))});break;case"Polygon":R.push(i({geometry:t},r,o)),_.forEach(z=>{L.push(i({geometry:{type:"LineString",coordinates:z}},r,o))});break;case"MultiPolygon":_.forEach(z=>{R.push(i({geometry:{type:"Polygon",coordinates:z}},r,o)),z.forEach(V=>{L.push(i({geometry:{type:"LineString",coordinates:V}},r,o))})});break}}const RB={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function kB(t,e){let i=RB[t];for(mi.assert(i,`Unknown GeoJSON type ${t}`);e&&--i>0;)e=e[0];return e&&Number.isFinite(e[0])}function Ax(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function qA(t){return t.geometry.coordinates}function DB(t,e){const i=Ax(),{pointFeatures:r,lineFeatures:o,polygonFeatures:u,polygonOutlineFeatures:_}=t;return i.points.data=r,i.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),i.points.getPosition=qA,i.lines.data=o,i.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),i.lines.getPath=qA,i.polygons.data=u,i.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),i.polygons.getPolygon=qA,i.polygonsOutline.data=_,i.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),i.polygonsOutline.getPath=qA,i}function BB(t,e){const i=Ax(),{points:r,lines:o,polygons:u}=t,_=sB(t,e);return i.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:4,value:_.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.lines.data={length:o.pathIndices.value.length-1,startIndices:o.pathIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:_.lines}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},i.lines._pathType="open",i.polygons.data={length:u.polygonIndices.value.length-1,startIndices:u.polygonIndices.value,attributes:{...u.attributes,getPolygon:u.positions,pickingColors:{size:4,value:_.polygons}},properties:u.properties,numericProps:u.numericProps,featureIds:u.featureIds},i.polygons._normalize=!1,u.triangles&&(i.polygons.data.attributes.indices=u.triangles.value),i.polygonsOutline.data={length:u.primitivePolygonIndices.value.length-1,startIndices:u.primitivePolygonIndices.value,attributes:{...u.attributes,getPath:u.positions,instancePickingColors:{size:4,value:_.polygons}},properties:u.properties,numericProps:u.numericProps,featureIds:u.featureIds},i.polygonsOutline._pathType="open",i}const FB=["points","linestrings","polygons"],OB={...fu(lf.circle),...fu(lf.icon),...fu(lf.text),...fu(cf),...fu(Dp),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Ig extends Bh{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:i}){if(!i.dataChanged)return;const{data:r}=this.props,o=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:o}),o?this._updateStateBinary({props:e,changeFlags:i}):this._updateStateJSON({props:e,changeFlags:i})}_updateStateBinary({props:e,changeFlags:i}){const r=BB(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:i}){const r=MB(e.data),o=this.getSubLayerRow.bind(this);let u={};const _={};if(Array.isArray(i.dataChanged)){const I=this.state.features;for(const R in I)u[R]=I[R].slice(),_[R]=[];for(const R of i.dataChanged){const L=a2(r,o,R);for(const z in I)_[z].push(nx({data:u[z],getIndex:V=>V.__source.index,dataRange:R,replace:L[z]}))}}else u=a2(r,o);const l=DB(u,_);this.setState({features:u,featuresDiff:_,layerProps:l})}getPickingInfo(e){const i=super.getPickingInfo(e),{index:r,sourceLayer:o}=i;return i.featureType=FB.find(u=>o.id.startsWith(`${this.id}-${u}-`)),r>=0&&o.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(i.index=this.props.data.points.globalFeatureIds.value[r]),i}_updateAutoHighlight(e){const i=`${this.id}-points-`,r=e.featureType==="points";for(const o of this.getSubLayers())o.id.startsWith(i)===r&&o.updateAutoHighlight(e)}_renderPolygonLayer(){var _;const{extruded:e,wireframe:i}=this.props,{layerProps:r}=this.state,o="polygons-fill",u=this.shouldRenderSubLayer(o,(_=r.polygons)==null?void 0:_.data)&&this.getSubLayerClass(o,Dp.type);if(u){const l=U0(this,Dp.props),I=e&&i;return I||delete l.getLineColor,l.updateTriggers.lineColors=I,new u(l,this.getSubLayerProps({id:o,updateTriggers:l.updateTriggers}),r.polygons)}return null}_renderLineLayers(){var I,R;const{extruded:e,stroked:i}=this.props,{layerProps:r}=this.state,o="polygons-stroke",u="linestrings",_=!e&&i&&this.shouldRenderSubLayer(o,(I=r.polygonsOutline)==null?void 0:I.data)&&this.getSubLayerClass(o,cf.type),l=this.shouldRenderSubLayer(u,(R=r.lines)==null?void 0:R.data)&&this.getSubLayerClass(u,cf.type);if(_||l){const L=U0(this,cf.props);return[_&&new _(L,this.getSubLayerProps({id:o,updateTriggers:L.updateTriggers}),r.polygonsOutline),l&&new l(L,this.getSubLayerProps({id:u,updateTriggers:L.updateTriggers}),r.lines)]}return null}_renderPointLayers(){var l;const{pointType:e}=this.props,{layerProps:i,binary:r}=this.state;let{highlightedObjectIndex:o}=this.props;!r&&Number.isFinite(o)&&(o=i.points.data.findIndex(I=>I.__source.index===o));const u=new Set(e.split("+")),_=[];for(const I of u){const R=`points-${I}`,L=lf[I],z=L&&this.shouldRenderSubLayer(R,(l=i.points)==null?void 0:l.data)&&this.getSubLayerClass(R,L.type);if(z){const V=U0(this,L.props);let q=i.points;if(I==="text"&&r){const{instancePickingColors:ne,...Ae}=q.data.attributes;q={...q,data:{...q.data,attributes:Ae}}}_.push(new z(V,this.getSubLayerProps({id:R,updateTriggers:V.updateTriggers,highlightedObjectIndex:o}),q))}}return _}renderLayers(){const{extruded:e}=this.props,i=this._renderPolygonLayer(),r=this._renderLineLayers(),o=this._renderPointLayers();return[!e&&i,r,o,e&&i]}getSubLayerAccessor(e){const{binary:i}=this.state;return!i||typeof e!="function"?super.getSubLayerAccessor(e):(r,o)=>{const{data:u,index:_}=o,l=iB(u,_);return e(l,o)}}}Ig.layerName="GeoJsonLayer";Ig.defaultProps=OB;const LB=Ig;class NB{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:i,onLoad:r,onError:o}){const{index:u,id:_,bbox:l,userData:I,zoom:R}=this,L=this._loaderId;this._abortController=new AbortController;const{signal:z}=this._abortController,V=await i.scheduleRequest(this,Ae=>Ae.isSelected?1:-1);if(!V){this._isCancelled=!0;return}if(this._isCancelled){V.done();return}let q=null,ne;try{q=await e({index:u,id:_,bbox:l,userData:I,zoom:R,signal:z})}catch(Ae){ne=Ae||!0}finally{V.done()}if(L===this._loaderId){if(this._loader=void 0,this.content=q,this._isCancelled&&!q){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,ne?o(ne,this):r(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const Os={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},c2=new Ft,zB=new Ft;class Mg{constructor(e=[0,0,0],i=[0,0,0],r){r=r||c2.copy(e).add(i).scale(.5),this.center=new Ft(r),this.halfDiagonal=new Ft(i).subtract(this.center),this.minimum=new Ft(e),this.maximum=new Ft(i)}clone(){return new Mg(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:i}=this,r=zB.from(e.normal),o=i.x*Math.abs(r.x)+i.y*Math.abs(r.y)+i.z*Math.abs(r.z),u=this.center.dot(r)+e.distance;return u-o>0?Os.INSIDE:u+o<0?Os.OUTSIDE:Os.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const i=c2.from(e).subtract(this.center),{halfDiagonal:r}=this;let o=0,u;return u=Math.abs(i.x)-r.x,u>0&&(o+=u*u),u=Math.abs(i.y)-r.y,u>0&&(o+=u*u),u=Math.abs(i.z)-r.z,u>0&&(o+=u*u),o}}const du=new Ft,h2=new Ft;class Rg{constructor(e=[0,0,0],i=0){this.radius=-0,this.center=new Ft,this.fromCenterRadius(e,i)}fromCenterRadius(e,i){return this.center.from(e),this.radius=i,this}fromCornerPoints(e,i){return i=du.from(i),this.center=new Ft().from(e).add(i).scale(.5),this.radius=this.center.distance(i),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Rg(this.center,this.radius)}union(e){const i=this.center,r=this.radius,o=e.center,u=e.radius,_=du.copy(o).subtract(i),l=_.magnitude();if(r>=l+u)return this.clone();if(u>=l+r)return e.clone();const I=(r+l+u)*.5;return h2.copy(_).scale((-r+I)/l).add(i),this.center.copy(h2),this.radius=I,this}expand(e){const r=du.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const i=O4(du,e);return this.radius=Math.max(i[0],Math.max(i[1],i[2]))*this.radius,this}distanceSquaredTo(e){const i=this.distanceTo(e);return i*i}distanceTo(e){const r=du.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const i=this.center,r=this.radius,u=e.normal.dot(i)+e.distance;return u<-r?Os.OUTSIDE:u<r?Os.INTERSECTING:Os.INSIDE}}const UB=new Ft,VB=new Ft,XA=new Ft,ZA=new Ft,YA=new Ft,jB=new Ft,$B=new Ft,ma={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class kg{constructor(e=[0,0,0],i=[0,0,0,0,0,0,0,0,0]){this.center=new Ft().from(e),this.halfAxes=new gs(i)}get halfSize(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Ft(e).len(),new Ft(i).len(),new Ft(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),o=new Ft(e).normalize(),u=new Ft(i).normalize(),_=new Ft(r).normalize();return new By().fromMatrix3(new gs([...o,...u,..._]))}fromCenterHalfSizeQuaternion(e,i,r){const o=new By(r),u=new gs().fromQuaternion(o);return u[0]=u[0]*i[0],u[1]=u[1]*i[0],u[2]=u[2]*i[0],u[3]=u[3]*i[1],u[4]=u[4]*i[1],u[5]=u[5]*i[1],u[6]=u[6]*i[2],u[7]=u[7]*i[2],u[8]=u[8]*i[2],this.center=new Ft().from(e),this.halfAxes=u,this}clone(){return new kg(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Rg){const i=this.halfAxes,r=i.getColumn(0,XA),o=i.getColumn(1,ZA),u=i.getColumn(2,YA),_=UB.copy(r).add(o).add(u);return e.center.copy(this.center),e.radius=_.magnitude(),e}intersectPlane(e){const i=this.center,r=e.normal,o=this.halfAxes,u=r.x,_=r.y,l=r.z,I=Math.abs(u*o[ma.COLUMN0ROW0]+_*o[ma.COLUMN0ROW1]+l*o[ma.COLUMN0ROW2])+Math.abs(u*o[ma.COLUMN1ROW0]+_*o[ma.COLUMN1ROW1]+l*o[ma.COLUMN1ROW2])+Math.abs(u*o[ma.COLUMN2ROW0]+_*o[ma.COLUMN2ROW1]+l*o[ma.COLUMN2ROW2]),R=r.dot(i)+e.distance;return R<=-I?Os.OUTSIDE:R>=I?Os.INSIDE:Os.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const i=VB.from(e).subtract(this.center),r=this.halfAxes,o=r.getColumn(0,XA),u=r.getColumn(1,ZA),_=r.getColumn(2,YA),l=o.magnitude(),I=u.magnitude(),R=_.magnitude();o.normalize(),u.normalize(),_.normalize();let L=0,z;return z=Math.abs(i.dot(o))-l,z>0&&(L+=z*z),z=Math.abs(i.dot(u))-I,z>0&&(L+=z*z),z=Math.abs(i.dot(_))-R,z>0&&(L+=z*z),L}computePlaneDistances(e,i,r=[-0,-0]){let o=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;const _=this.center,l=this.halfAxes,I=l.getColumn(0,XA),R=l.getColumn(1,ZA),L=l.getColumn(2,YA),z=jB.copy(I).add(R).add(L).add(_),V=$B.copy(z).subtract(e);let q=i.dot(V);return o=Math.min(q,o),u=Math.max(q,u),z.copy(_).add(I).add(R).subtract(L),V.copy(z).subtract(e),q=i.dot(V),o=Math.min(q,o),u=Math.max(q,u),z.copy(_).add(I).subtract(R).add(L),V.copy(z).subtract(e),q=i.dot(V),o=Math.min(q,o),u=Math.max(q,u),z.copy(_).add(I).subtract(R).subtract(L),V.copy(z).subtract(e),q=i.dot(V),o=Math.min(q,o),u=Math.max(q,u),_.copy(z).subtract(I).add(R).add(L),V.copy(z).subtract(e),q=i.dot(V),o=Math.min(q,o),u=Math.max(q,u),_.copy(z).subtract(I).add(R).subtract(L),V.copy(z).subtract(e),q=i.dot(V),o=Math.min(q,o),u=Math.max(q,u),_.copy(z).subtract(I).subtract(R).add(L),V.copy(z).subtract(e),q=i.dot(V),o=Math.min(q,o),u=Math.max(q,u),_.copy(z).subtract(I).subtract(R).subtract(L),V.copy(z).subtract(e),q=i.dot(V),o=Math.min(q,o),u=Math.max(q,u),r[0]=o,r[1]=u,r}transform(e){this.center.transformAsPoint(e);const i=this.halfAxes.getColumn(0,XA);i.transformAsPoint(e);const r=this.halfAxes.getColumn(1,ZA);r.transformAsPoint(e);const o=this.halfAxes.getColumn(2,YA);return o.transformAsPoint(e),this.halfAxes=new gs([...i,...r,...o]),this}getTransform(){throw new Error("not implemented")}}const u2=new Ft,A2=new Ft;class Wu{constructor(e=[0,0,1],i=0){this.normal=new Ft,this.distance=-0,this.fromNormalDistance(e,i)}fromNormalDistance(e,i){return Fu(Number.isFinite(i)),this.normal.from(e).normalize(),this.distance=i,this}fromPointNormal(e,i){e=u2.from(e),this.normal.from(i).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,i,r,o){return this.normal.set(e,i,r),Fu(wa(this.normal.len(),1)),this.distance=o,this}clone(){return new Wu(this.normal,this.distance)}equals(e){return wa(this.distance,e.distance)&&wa(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const i=A2.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,i)}projectPointOntoPlane(e,i=[0,0,0]){const r=u2.from(e),o=this.getPointDistance(r),u=A2.copy(this.normal).scale(o);return r.subtract(u).to(i)}}const f2=[new Ft([1,0,0]),new Ft([0,1,0]),new Ft([0,0,1])],d2=new Ft,WB=new Ft;class xa{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*f2.length;const i=e.center,r=e.radius;let o=0;for(const u of f2){let _=this.planes[o],l=this.planes[o+1];_||(_=this.planes[o]=new Wu),l||(l=this.planes[o+1]=new Wu);const I=d2.copy(u).scale(-r).add(i);_.fromPointNormal(I,u);const R=d2.copy(u).scale(r).add(i),L=WB.copy(u).negate();l.fromPointNormal(R,L),o+=2}return this}computeVisibility(e){let i=Os.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case Os.OUTSIDE:return Os.OUTSIDE;case Os.INTERSECTING:i=Os.INTERSECTING;break}return i}computeVisibilityWithPlaneMask(e,i){if(Fu(Number.isFinite(i),"parentPlaneMask is required."),i===xa.MASK_OUTSIDE||i===xa.MASK_INSIDE)return i;let r=xa.MASK_INSIDE;const o=this.planes;for(let u=0;u<this.planes.length;++u){const _=u<31?1<<u:0;if(u<31&&!(i&_))continue;const l=o[u],I=e.intersectPlane(l);if(I===Os.OUTSIDE)return xa.MASK_OUTSIDE;I===Os.INTERSECTING&&(r|=_)}return r}}xa.MASK_OUTSIDE=4294967295;xa.MASK_INSIDE=0;xa.MASK_INDETERMINATE=2147483647;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;new Ft;const Vo=new gs,HB=new gs,qB=new gs,GA=new gs,p2=new gs;function XB(t,e={}){const i=bI,r=10;let o=0,u=0;const _=HB,l=qB;_.identity(),l.copy(t);const I=i*ZB(l);for(;u<r&&YB(l)>I;)GB(l,GA),p2.copy(GA).transpose(),l.multiplyRight(GA),l.multiplyLeft(p2),_.multiplyRight(GA),++o>2&&(++u,o=0);return e.unitary=_.toTarget(e.unitary),e.diagonal=l.toTarget(e.diagonal),e}function ZB(t){let e=0;for(let i=0;i<9;++i){const r=t[i];e+=r*r}return Math.sqrt(e)}const Bp=[1,0,0],Fp=[2,2,1];function YB(t){let e=0;for(let i=0;i<3;++i){const r=t[Vo.getElementIndex(Fp[i],Bp[i])];e+=2*r*r}return Math.sqrt(e)}function GB(t,e){const i=yI;let r=0,o=1;for(let R=0;R<3;++R){const L=Math.abs(t[Vo.getElementIndex(Fp[R],Bp[R])]);L>r&&(o=R,r=L)}const u=Bp[o],_=Fp[o];let l=1,I=0;if(Math.abs(t[Vo.getElementIndex(_,u)])>i){const R=t[Vo.getElementIndex(_,_)],L=t[Vo.getElementIndex(u,u)],z=t[Vo.getElementIndex(_,u)],V=(R-L)/2/z;let q;V<0?q=-1/(-V+Math.sqrt(1+V*V)):q=1/(V+Math.sqrt(1+V*V)),l=1/Math.sqrt(1+q*q),I=q*l}return gs.IDENTITY.to(e),e[Vo.getElementIndex(u,u)]=e[Vo.getElementIndex(_,_)]=l,e[Vo.getElementIndex(_,u)]=I,e[Vo.getElementIndex(u,_)]=-I,e}const tl=new Ft,QB=new Ft,KB=new Ft,JB=new Ft,eF=new Ft,tF=new gs,iF={diagonal:new gs,unitary:new gs};function rF(t,e=new kg){if(!t||t.length===0)return e.halfAxes=new gs([0,0,0,0,0,0,0,0,0]),e.center=new Ft,e;const i=t.length,r=new Ft(0,0,0);for(const ct of t)r.add(ct);const o=1/i;r.multiplyByScalar(o);let u=0,_=0,l=0,I=0,R=0,L=0;for(const ct of t){const at=tl.copy(ct).subtract(r);u+=at.x*at.x,_+=at.x*at.y,l+=at.x*at.z,I+=at.y*at.y,R+=at.y*at.z,L+=at.z*at.z}u*=o,_*=o,l*=o,I*=o,R*=o,L*=o;const z=tF;z[0]=u,z[1]=_,z[2]=l,z[3]=_,z[4]=I,z[5]=R,z[6]=l,z[7]=R,z[8]=L;const{unitary:V}=XB(z,iF),q=e.halfAxes.copy(V);let ne=q.getColumn(0,KB),Ae=q.getColumn(1,JB),Ee=q.getColumn(2,eF),Ce=-Number.MAX_VALUE,Le=-Number.MAX_VALUE,Oe=-Number.MAX_VALUE,Ne=Number.MAX_VALUE,Qe=Number.MAX_VALUE,Je=Number.MAX_VALUE;for(const ct of t)tl.copy(ct),Ce=Math.max(tl.dot(ne),Ce),Le=Math.max(tl.dot(Ae),Le),Oe=Math.max(tl.dot(Ee),Oe),Ne=Math.min(tl.dot(ne),Ne),Qe=Math.min(tl.dot(Ae),Qe),Je=Math.min(tl.dot(Ee),Je);ne=ne.multiplyByScalar(.5*(Ne+Ce)),Ae=Ae.multiplyByScalar(.5*(Qe+Le)),Ee=Ee.multiplyByScalar(.5*(Je+Oe)),e.center.copy(ne).add(Ae).add(Ee);const xt=QB.set(Ce-Ne,Le-Qe,Oe-Je).multiplyByScalar(.5),wt=new gs([xt[0],0,0,0,xt[1],0,0,0,xt[2]]);return e.halfAxes.multiplyRight(wt),e}const uh=512,g2=3,fx=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],dx=fx.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),sF=dx.concat([[.25,.5],[.75,.5]]);class Ah{constructor(e,i,r){this.x=e,this.y=i,this.z=r}get children(){if(!this._children){const e=this.x*2,i=this.y*2,r=this.z+1;this._children=[new Ah(e,i,r),new Ah(e,i+1,r),new Ah(e+1,i,r),new Ah(e+1,i+1,r)]}return this._children}update(e){const{viewport:i,cullingVolume:r,elevationBounds:o,minZ:u,maxZ:_,bounds:l,offset:I,project:R}=e,L=this.getBoundingVolume(o,I,R);if(l&&!this.insideBounds(l)||r.computeVisibility(L)<0)return!1;if(!this.childVisible){let{z:V}=this;if(V<_&&V>=u){const q=L.distanceTo(i.cameraPosition)*i.scale/i.height;V+=Math.floor(Math.log2(q))}if(V>=_)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const V of this.children)V.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const i of this._children)i.getSelected(e);return e}insideBounds([e,i,r,o]){const u=Math.pow(2,this.z),_=uh/u;return this.x*_<r&&this.y*_<o&&(this.x+1)*_>e&&(this.y+1)*_>i}getBoundingVolume(e,i,r){if(r){const I=this.z<1?sF:this.z<2?dx:fx,R=[];for(const L of I){const z=Lp(this.x+L[0],this.y+L[1],this.z);z[2]=e[0],R.push(r(z)),e[0]!==e[1]&&(z[2]=e[1],R.push(r(z)))}return rF(R)}const o=Math.pow(2,this.z),u=uh/o,_=this.x*u+i*uh,l=uh-(this.y+1)*u;return new Mg([_,l,e[0]],[_+u,l+u,e[1]])}}function nF(t,e,i,r){const o=t instanceof z8&&t.resolution?t.projectPosition:null,u=Object.values(t.getFrustumPlanes()).map(({normal:q,distance:ne})=>new Wu(q.clone().negate(),ne)),_=new xa(u),l=t.distanceScales.unitsPerMeter[2],I=i&&i[0]*l||0,R=i&&i[1]*l||0,L=t instanceof If&&t.pitch<=60?e:0;if(r){const[q,ne,Ae,Ee]=r,Ce=Sh([q,Ee]),Le=Sh([Ae,ne]);r=[Ce[0],uh-Ce[1],Le[0],uh-Le[1]]}const z=new Ah(0,0,0),V={viewport:t,project:o,cullingVolume:_,elevationBounds:[I,R],minZ:L,maxZ:e,bounds:r,offset:0};if(z.update(V),t instanceof If&&t.subViewports&&t.subViewports.length>1){for(V.offset=-1;z.update(V)&&!(--V.offset<-g2););for(V.offset=1;z.update(V)&&!(++V.offset>g2););}return z.getSelected()}const Sa=512,oF=[-1/0,-1/0,1/0,1/0],aF={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(i=>typeof i=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const i=t.length;if(i!==e.length)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}};function px(t,e){const i=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...i.map(o=>o[0])),Math.min(...i.map(o=>o[1])),Math.max(...i.map(o=>o[0])),Math.max(...i.map(o=>o[1]))]}function lF(t){return Math.abs(t.split("").reduce((e,i)=>(e<<5)-e+i.charCodeAt(0)|0,0))}function cF(t,e){if(!t||!t.length)return null;const{index:i,id:r}=e;if(Array.isArray(t)){const u=lF(r)%t.length;t=t[u]}let o=t;for(const u of Object.keys(i)){const _=new RegExp(`{${u}}`,"g");o=o.replace(_,String(i[u]))}return Number.isInteger(i.y)&&Number.isInteger(i.z)&&(o=o.replace(/\{-y\}/g,String(Math.pow(2,i.z)-i.y-1))),o}function hF(t,e,i){let r;if(e&&e.length===2){const[o,u]=e,_=t.getBounds({z:o}),l=t.getBounds({z:u});r=[Math.min(_[0],l[0]),Math.min(_[1],l[1]),Math.max(_[2],l[2]),Math.max(_[3],l[3])]}else r=t.getBounds();return t.isGeospatial?[Math.max(r[0],i[0]),Math.max(r[1],i[1]),Math.min(r[2],i[2]),Math.min(r[3],i[3])]:[Math.max(Math.min(r[0],i[2]),i[0]),Math.max(Math.min(r[1],i[3]),i[1]),Math.min(Math.max(r[2],i[0]),i[2]),Math.min(Math.max(r[3],i[1]),i[3])]}function uF({viewport:t,z:e,cullRect:i}){return(t.subViewports||[t]).map(o=>Op(o,e||0,i))}function Op(t,e,i){if(!Array.isArray(e)){const u=i.x-t.x,_=i.y-t.y,{width:l,height:I}=i,R={targetZ:e},L=t.unproject([u,_],R),z=t.unproject([u+l,_],R),V=t.unproject([u,_+I],R),q=t.unproject([u+l,_+I],R);return[Math.min(L[0],z[0],V[0],q[0]),Math.min(L[1],z[1],V[1],q[1]),Math.max(L[0],z[0],V[0],q[0]),Math.max(L[1],z[1],V[1],q[1])]}const r=Op(t,e[0],i),o=Op(t,e[1],i);return[Math.min(r[0],o[0]),Math.min(r[1],o[1]),Math.max(r[2],o[2]),Math.max(r[3],o[3])]}function AF(t,e,i){return i?px(t,i).map(o=>o*e/Sa):t.map(r=>r*e/Sa)}function Dg(t,e){return Math.pow(2,t)*Sa/e}function Lp(t,e,i){const r=Dg(i,Sa),o=t/r*360-180,u=Math.PI-2*Math.PI*e/r,_=180/Math.PI*Math.atan(.5*(Math.exp(u)-Math.exp(-u)));return[o,_]}function _2(t,e,i,r){const o=Dg(i,r);return[t/o*Sa,e/o*Sa]}function fF(t,e,i,r,o=Sa){if(t.isGeospatial){const[R,L]=Lp(e,i,r),[z,V]=Lp(e+1,i+1,r);return{west:R,north:L,east:z,south:V}}const[u,_]=_2(e,i,r,o),[l,I]=_2(e+1,i+1,r,o);return{left:u,top:_,right:l,bottom:I}}function dF(t,e,i,r,o){const u=hF(t,null,r),_=Dg(e,i),[l,I,R,L]=AF(u,_,o),z=[];for(let V=Math.floor(l);V<R;V++)for(let q=Math.floor(I);q<L;q++)z.push({x:V,y:q,z:e});return z}function pF({viewport:t,maxZoom:e,minZoom:i,zRange:r,extent:o,tileSize:u=Sa,modelMatrix:_,modelMatrixInverse:l,zoomOffset:I=0}){let R=t.isGeospatial?Math.round(t.zoom+Math.log2(Sa/u))+I:Math.ceil(t.zoom)+I;if(typeof i=="number"&&Number.isFinite(i)&&R<i){if(!o)return[];R=i}typeof e=="number"&&Number.isFinite(e)&&R>e&&(R=e);let L=o;return _&&l&&o&&!t.isGeospatial&&(L=px(o,_)),t.isGeospatial?nF(t,R,r,o):dF(t,R,u,L||oF,l)}function gF(t){let e={},i;return r=>{for(const o in r)if(!_F(r[o],e[o])){i=t(r),e=r;break}return i}}function _F(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}return!1}const m2=1,ud=2,mF="never",yF="no-overlap",Bg="best-available",bF=5,vF={[Bg]:wF,[yF]:TF,[mF]:()=>{}},xF={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class gx{constructor(e){this._getCullBounds=gF(uF),this.opts={...xF,...e},this.setOptions(this.opts),this.onTileLoad=i=>{var r,o;(o=(r=this.opts).onTileLoad)==null||o.call(r,i),this.opts.maxCacheByteSize!=null&&(this._cacheByteSize+=i.byteLength,this._resizeCache())},this._requestScheduler=new O3({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Gs,this._modelMatrixInverse=new Gs}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const i=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(i)?this._cache.delete(e):i.setNeedsReload()}}update(e,{zRange:i,modelMatrix:r}={zRange:null,modelMatrix:null}){const o=r?new Gs(r):new Gs,u=!o.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!wa(this._zRange,i)||u){u&&(this._modelMatrixInverse=o.clone().invert(),this._modelMatrix=o),this._viewport=e,this._zRange=i;const l=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:i,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=l.map(I=>this._getTile(I,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(l=>this._getTile(l.index,!0)));const _=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),_&&this._frameNumber++,this._frameNumber}isTileVisible(e,i){if(!e.isVisible)return!1;if(i&&this._viewport){const r=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:i}),{bbox:o}=e;for(const[u,_,l,I]of r){let R;if("west"in o)R=o.west<l&&o.east>u&&o.south<I&&o.north>_;else{const L=Math.min(o.top,o.bottom),z=Math.max(o.top,o.bottom);R=o.left<l&&o.right>u&&L<I&&z>_}if(R)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:i,minZoom:r,zRange:o,modelMatrix:u,modelMatrixInverse:_}){const{tileSize:l,extent:I,zoomOffset:R}=this.opts;return pF({viewport:e,maxZoom:i,minZoom:r,zRange:o,tileSize:l,extent:I,modelMatrix:u,modelMatrixInverse:_,zoomOffset:R})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:i}=this.opts;return{bbox:fF(this._viewport,e.x,e.y,e.z,i)}}getParentIndex(e){const i=Math.floor(e.x/2),r=Math.floor(e.y/2),o=e.z-1;return{x:i,y:r,z:o}}updateTileStates(){const e=this.opts.refinementStrategy||Bg,i=new Array(this._cache.size);let r=0;for(const o of this._cache.values())i[r++]=o.isVisible,o.isSelected=!1,o.isVisible=!1;for(const o of this._selectedTiles)o.isSelected=!0,o.isVisible=!0;(typeof e=="function"?e:vF[e])(Array.from(this._cache.values())),r=0;for(const o of this._cache.values())if(i[r++]!==o.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,i=[];let r=0;for(const o of this._cache.values())o.isLoading&&(r++,!o.isSelected&&!o.isVisible&&i.push(o));for(;e>0&&r>e&&i.length>0;)i.shift().abort(),r--}_rebuildTree(){const{_cache:e}=this;for(const i of e.values())i.parent=null,i.children&&(i.children.length=0);for(const i of e.values()){const r=this._getNearestAncestor(i);i.parent=r,r!=null&&r.children&&r.children.push(i)}}_resizeCache(){var _,l;const{_cache:e,opts:i}=this,r=i.maxCacheSize??(i.maxCacheByteSize!=null?1/0:bF*this.selectedTiles.length),o=i.maxCacheByteSize??1/0;if(e.size>r||this._cacheByteSize>o){for(const[I,R]of e)if(!R.isVisible&&!R.isSelected&&(this._cacheByteSize-=i.maxCacheByteSize!=null?R.byteLength:0,e.delete(I),(l=(_=this.opts).onTileUnload)==null||l.call(_,R)),e.size<=r&&this._cacheByteSize<=o)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((I,R)=>I.zoom-R.zoom),this._dirty=!1)}_getTile(e,i){const r=this.getTileId(e);let o=this._cache.get(r),u=!1;return!o&&i?(o=new NB(e),Object.assign(o,this.getTileMetadata(o.index)),Object.assign(o,{id:r,zoom:this.getTileZoom(o.index)}),u=!0,this._cache.set(r,o),this._dirty=!0):o&&o.needsReload&&(u=!0),o&&u&&o.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),o}_getNearestAncestor(e){const{_minZoom:i=0}=this;let r=e.index;for(;this.getTileZoom(r)>i;){r=this.getParentIndex(r);const o=this._getTile(r);if(o)return o}return null}}function wF(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!_x(e)&&Fg(e);for(const e of t)e.isVisible=!!(e.state&ud)}function TF(t){for(const i of t)i.state=0;for(const i of t)i.isSelected&&_x(i);const e=Array.from(t).sort((i,r)=>i.zoom-r.zoom);for(const i of e)if(i.isVisible=!!(i.state&ud),i.children&&(i.isVisible||i.state&m2))for(const r of i.children)r.state=m2;else i.isSelected&&Fg(i)}function _x(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=ud,!0;e=e.parent}return!1}function Fg(t){for(const e of t.children)e.isLoaded||e.content?e.state|=ud:Fg(e)}const EF={TilesetClass:gx,data:{type:"data",value:[]},dataComparator:aF.equal,renderSubLayers:{type:"function",value:t=>new LB(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Bg,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class Og extends Bh{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,i;(i=(e=this.state)==null?void 0:e.tileset)==null||i.finalize()}get isLoaded(){var e,i,r;return!!((r=(i=(e=this.state)==null?void 0:e.tileset)==null?void 0:i.selectedTiles)!=null&&r.every(o=>o.isLoaded&&o.layers&&o.layers.every(u=>u.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:i}=this.state;const r=e.propsOrDataChanged||e.updateTriggersChanged,o=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);i?r&&(i.setOptions(this._getTilesetOptions()),o?i.reloadAll():i.tiles.forEach(u=>{u.layers=null})):(i=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:i})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:i,maxCacheByteSize:r,refinementStrategy:o,extent:u,maxZoom:_,minZoom:l,maxRequests:I,debounceTime:R,zoomOffset:L}=this.props;return{maxCacheSize:i,maxCacheByteSize:r,maxZoom:_,minZoom:l,tileSize:e,refinementStrategy:o,extent:u,maxRequests:I,debounceTime:R,zoomOffset:L,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:i,modelMatrix:r}=this.props,o=e.update(this.context.viewport,{zRange:i,modelMatrix:r}),{isLoaded:u}=e,_=this.state.isLoaded!==u,l=this.state.frameNumber!==o;u&&(_||l)&&this._onViewportLoad(),l&&this.setState({frameNumber:o}),this.state.isLoaded=u}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:i}=this.props;i&&i(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,i){this.props.onTileError(e),i.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:i,getTileData:r,fetch:o}=this.props,{signal:u}=e;return e.url=typeof i=="string"||Array.isArray(i)?cF(i,e):null,r?r(e):o&&e.url?o(e.url,{propName:"data",layer:this,signal:u}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const i=e.sourceLayer,r=i.props.tile,o=e.info;return o.picked&&(o.tile=r),o.sourceTile=r,o.sourceTileSubLayer=i,o}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const i=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)i&&e.layers[0]&&Object.keys(i).some(r=>e.layers[0].props[r]!==i[r])&&(e.layers=e.layers.map(r=>r.clone(i)));else{const r=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=sd(r,Boolean).map(o=>o.clone({tile:e,...i}))}return e.layers})}filterSubLayer({layer:e,cullRect:i}){const{tile:r}=e.props;return this.state.tileset.isTileVisible(r,i)}}Og.defaultProps=EF;Og.layerName="TileLayer";const SF=Og;var ei=function(t){t=t||{};var e=typeof t<"u"?t:{},i={},r;for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);var o="";function u(ue){return e.locateFile?e.locateFile(ue,o):o+ue}var _;typeof document<"u"&&document.currentScript&&(o=document.currentScript.src),o.indexOf("blob:")!==0?o=o.substr(0,o.lastIndexOf("/")+1):o="",_=function(Se,We,et){var g=new XMLHttpRequest;g.open("GET",Se,!0),g.responseType="arraybuffer",g.onload=function(){if(g.status==200||g.status==0&&g.response){We(g.response);return}var ut=Ar(Se);if(ut){We(ut.buffer);return}et()},g.onerror=et,g.send(null)};var l=e.print||console.log.bind(console),I=e.printErr||console.warn.bind(console);for(r in i)i.hasOwnProperty(r)&&(e[r]=i[r]);i=null,e.arguments&&e.arguments;var R=0,L=function(ue){R=ue},z=function(){return R},V=8;function q(ue,Se,We,et){switch(We=We||"i8",We.charAt(We.length-1)==="*"&&(We="i32"),We){case"i1":Ot[ue>>0]=Se;break;case"i8":Ot[ue>>0]=Se;break;case"i16":qt[ue>>1]=Se;break;case"i32":gi[ue>>2]=Se;break;case"i64":Zr=[Se>>>0,(oi=Se,+Ls(oi)>=1?oi>0?(mr(+ms(oi/4294967296),4294967295)|0)>>>0:~~+zr((oi-+(~~oi>>>0))/4294967296)>>>0:0)],gi[ue>>2]=Zr[0],gi[ue+4>>2]=Zr[1];break;case"float":Nr[ue>>2]=Se;break;case"double":hr[ue>>3]=Se;break;default:qe("invalid type for setValue: "+We)}}function ne(ue,Se,We){switch(Se=Se||"i8",Se.charAt(Se.length-1)==="*"&&(Se="i32"),Se){case"i1":return Ot[ue>>0];case"i8":return Ot[ue>>0];case"i16":return qt[ue>>1];case"i32":return gi[ue>>2];case"i64":return gi[ue>>2];case"float":return Nr[ue>>2];case"double":return hr[ue>>3];default:qe("invalid type for getValue: "+Se)}return null}var Ae=!1;function Ee(ue,Se){ue||qe("Assertion failed: "+Se)}function Ce(ue){var Se=e["_"+ue];return Ee(Se,"Cannot call unknown function "+ue+", make sure it is exported"),Se}function Le(ue,Se,We,et,g){var K={string:function(Rt){var wi=0;if(Rt!=null&&Rt!==0){var Tr=(Rt.length<<2)+1;wi=X(Tr),wt(Rt,wi,Tr)}return wi},array:function(Rt){var wi=X(Rt.length);return ct(Rt,wi),wi}};function ut(Rt){return Se==="string"?Je(Rt):Se==="boolean"?!!Rt:Rt}var Bt=Ce(ue),Zt=[],ft=0;if(et)for(var yt=0;yt<et.length;yt++){var Si=K[We[yt]];Si?(ft===0&&(ft=ae()),Zt[yt]=Si(et[yt])):Zt[yt]=et[yt]}var Lt=Bt.apply(null,Zt);return Lt=ut(Lt),ft!==0&&Q(ft),Lt}function Oe(ue,Se,We,et){We=We||[];var g=We.every(function(ut){return ut==="number"}),K=Se!=="string";return K&&g&&!et?Ce(ue):function(){return Le(ue,Se,We,arguments)}}var Ne=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Qe(ue,Se,We){for(var et=Se+We,g=Se;ue[g]&&!(g>=et);)++g;if(g-Se>16&&ue.subarray&&Ne)return Ne.decode(ue.subarray(Se,g));for(var K="";Se<g;){var ut=ue[Se++];if(!(ut&128)){K+=String.fromCharCode(ut);continue}var Bt=ue[Se++]&63;if((ut&224)==192){K+=String.fromCharCode((ut&31)<<6|Bt);continue}var Zt=ue[Se++]&63;if((ut&240)==224?ut=(ut&15)<<12|Bt<<6|Zt:ut=(ut&7)<<18|Bt<<12|Zt<<6|ue[Se++]&63,ut<65536)K+=String.fromCharCode(ut);else{var ft=ut-65536;K+=String.fromCharCode(55296|ft>>10,56320|ft&1023)}}return K}function Je(ue,Se){return ue?Qe($t,ue,Se):""}function xt(ue,Se,We,et){if(!(et>0))return 0;for(var g=We,K=We+et-1,ut=0;ut<ue.length;++ut){var Bt=ue.charCodeAt(ut);if(Bt>=55296&&Bt<=57343){var Zt=ue.charCodeAt(++ut);Bt=65536+((Bt&1023)<<10)|Zt&1023}if(Bt<=127){if(We>=K)break;Se[We++]=Bt}else if(Bt<=2047){if(We+1>=K)break;Se[We++]=192|Bt>>6,Se[We++]=128|Bt&63}else if(Bt<=65535){if(We+2>=K)break;Se[We++]=224|Bt>>12,Se[We++]=128|Bt>>6&63,Se[We++]=128|Bt&63}else{if(We+3>=K)break;Se[We++]=240|Bt>>18,Se[We++]=128|Bt>>12&63,Se[We++]=128|Bt>>6&63,Se[We++]=128|Bt&63}}return Se[We]=0,We-g}function wt(ue,Se,We){return xt(ue,$t,Se,We)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function ct(ue,Se){Ot.set(ue,Se)}function at(ue,Se){return ue%Se>0&&(ue+=Se-ue%Se),ue}var Vt,Ot,$t,qt,gi,Nr,hr;function Ks(ue){Vt=ue,e.HEAP8=Ot=new Int8Array(ue),e.HEAP16=qt=new Int16Array(ue),e.HEAP32=gi=new Int32Array(ue),e.HEAPU8=$t=new Uint8Array(ue),e.HEAPU16=new Uint16Array(ue),e.HEAPU32=new Uint32Array(ue),e.HEAPF32=Nr=new Float32Array(ue),e.HEAPF64=hr=new Float64Array(ue)}var Cn=5267040,qn=24128,Pn=e.TOTAL_MEMORY||33554432;e.buffer?Vt=e.buffer:Vt=new ArrayBuffer(Pn),Pn=Vt.byteLength,Ks(Vt),gi[qn>>2]=Cn;function ur(ue){for(;ue.length>0;){var Se=ue.shift();if(typeof Se=="function"){Se();continue}var We=Se.func;typeof We=="number"?Se.arg===void 0?e.dynCall_v(We):e.dynCall_vi(We,Se.arg):We(Se.arg===void 0?null:Se.arg)}}var Ei=[],_r=[],ln=[],cn=[];function Qi(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)Js(e.preRun.shift());ur(Ei)}function Dr(){ur(_r)}function yi(){ur(ln)}function ki(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Xr(e.postRun.shift());ur(cn)}function Js(ue){Ei.unshift(ue)}function Xr(ue){cn.unshift(ue)}var Ls=Math.abs,zr=Math.ceil,ms=Math.floor,mr=Math.min,Ki=0,Ur=null;function en(ue){Ki++,e.monitorRunDependencies&&e.monitorRunDependencies(Ki)}function Xe(ue){if(Ki--,e.monitorRunDependencies&&e.monitorRunDependencies(Ki),Ki==0&&Ur){var Se=Ur;Ur=null,Se()}}e.preloadedImages={},e.preloadedAudios={};var _i=null,Br="data:application/octet-stream;base64,";function vi(ue){return String.prototype.startsWith?ue.startsWith(Br):ue.indexOf(Br)===0}var oi,Zr;_i="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var In=24144;function ys(ue){return ue}function Mn(ue){var Se=/\b__Z[\w\d_]+/g;return ue.replace(Se,function(We){var et=We;return We===et?We:et+" ["+We+"]"})}function tn(){var ue=new Error;if(!ue.stack){try{throw new Error(0)}catch(Se){ue=Se}if(!ue.stack)return"(no stack trace available)"}return ue.stack.toString()}function Ns(){var ue=tn();return e.extraStackTrace&&(ue+=`
`+e.extraStackTrace()),Mn(ue)}function bs(ue,Se,We,et){qe("Assertion failed: "+Je(ue)+", at: "+[Se?Je(Se):"unknown filename",We,et?Je(et):"unknown function"])}function st(){return Ot.length}function vs(ue,Se,We){$t.set($t.subarray(Se,Se+We),ue)}function Ui(ue){return e.___errno_location&&(gi[e.___errno_location()>>2]=ue),ue}function hn(ue){qe("OOM")}function xs(ue){try{var Se=new ArrayBuffer(ue);return Se.byteLength!=ue?void 0:(new Int8Array(Se).set(Ot),fe(Se),Ks(Se),1)}catch{}}function nt(ue){var Se=st(),We=16777216,et=2147483648-We;if(ue>et)return!1;for(var g=16777216,K=Math.max(Se,g);K<ue;)K<=536870912?K=at(2*K,We):K=Math.min(at((3*K+2147483648)/4,We),et);var ut=xs(K);return!!ut}var Yt=typeof atob=="function"?atob:function(ue){var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",We="",et,g,K,ut,Bt,Zt,ft,yt=0;ue=ue.replace(/[^A-Za-z0-9\+\/\=]/g,"");do ut=Se.indexOf(ue.charAt(yt++)),Bt=Se.indexOf(ue.charAt(yt++)),Zt=Se.indexOf(ue.charAt(yt++)),ft=Se.indexOf(ue.charAt(yt++)),et=ut<<2|Bt>>4,g=(Bt&15)<<4|Zt>>2,K=(Zt&3)<<6|ft,We=We+String.fromCharCode(et),Zt!==64&&(We=We+String.fromCharCode(g)),ft!==64&&(We=We+String.fromCharCode(K));while(yt<ue.length);return We};function Xt(ue){try{for(var Se=Yt(ue),We=new Uint8Array(Se.length),et=0;et<Se.length;++et)We[et]=Se.charCodeAt(et);return We}catch{throw new Error("Converting base64 string to bytes failed.")}}function Ar(ue){if(vi(ue))return Xt(ue.slice(Br.length))}var ns={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Gt={a:qe,b:L,c:z,d:bs,e:Ui,f:st,g:vs,h:nt,i:hn,j:ys,k:Mn,l:xs,m:tn,n:Ns,o:In,p:qn},Ke=function(ue,Se,We){"almost asm";var et=new ue.Int8Array(We),g=new ue.Int32Array(We);new ue.Uint8Array(We),new ue.Float32Array(We);var K=new ue.Float64Array(We),ut=Se.o|0,Bt=Se.p|0,Zt=ue.Math.floor,ft=ue.Math.abs,yt=ue.Math.sqrt,Si=ue.Math.pow,Lt=ue.Math.cos,Rt=ue.Math.sin,wi=ue.Math.tan,Tr=ue.Math.acos,Xn=ue.Math.asin,tr=ue.Math.atan,Vi=ue.Math.atan2,Vr=ue.Math.ceil,Qt=ue.Math.imul,zs=ue.Math.min,jr=ue.Math.max,bi=ue.Math.clz32,Wt=Se.b,le=Se.c,Pt=Se.d,Ti=Se.e,un=Se.f,rn=Se.g,Pi=Se.h,fi=Se.i,re=24160;function Ii(a){return et=new Int8Array(a),g=new Int32Array(a),K=new Float64Array(a),We=a,!0}function Yr(a){a=a|0;var h=0;return h=re,re=re+a|0,re=re+15&-16,h|0}function Gr(){return re|0}function Ao(a){a=a|0,re=a}function ws(a,h){a=a|0,re=a}function qo(a,h){a=a|0,h=h|0;var A=0,p=0,y=0;return(a|0)<0?(h=2,h|0):(a|0)>13780509?(h=Na(15,h)|0,h|0):(A=((a|0)<0)<<31>>31,y=br(a|0,A|0,3,0)|0,p=le()|0,A=Nt(a|0,A|0,1,0)|0,A=br(y|0,p|0,A|0,le()|0)|0,A=Nt(A|0,le()|0,1,0)|0,a=le()|0,g[h>>2]=A,g[h+4>>2]=a,h=0,h|0)}function fo(a,h,A,p){return a=a|0,h=h|0,A=A|0,p=p|0,Zn(a,h,A,p,0)|0}function Zn(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0,F=0;if(k=re,re=re+16|0,T=k,!(te(a,h,A,p,y)|0))return p=0,re=k,p|0;do if((A|0)>=0){if((A|0)>13780509){if(b=Na(15,T)|0,b|0)break;S=T,T=g[S>>2]|0,S=g[S+4>>2]|0}else b=((A|0)<0)<<31>>31,F=br(A|0,b|0,3,0)|0,S=le()|0,b=Nt(A|0,b|0,1,0)|0,b=br(F|0,S|0,b|0,le()|0)|0,b=Nt(b|0,le()|0,1,0)|0,S=le()|0,g[T>>2]=b,g[T+4>>2]=S,T=b;if(w(p|0,0,T<<3|0)|0,y|0){w(y|0,0,T<<2|0)|0,b=oe(a,h,A,p,y,T,S,0)|0;break}b=Or(T,4)|0,b?(F=oe(a,h,A,p,b,T,S,0)|0,Kt(b),b=F):b=13}else b=2;while(0);return F=b,re=k,F|0}function te(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0;if(se=re,re=re+16|0,Y=se,G=se+8|0,W=Y,g[W>>2]=a,g[W+4>>2]=h,(A|0)<0)return G=2,re=se,G|0;if(b=p,g[b>>2]=a,g[b+4>>2]=h,b=(y|0)!=0,b&&(g[y>>2]=0),Ci(a,h)|0)return G=9,re=se,G|0;g[G>>2]=0;e:do if((A|0)>=1)if(b)for(U=1,F=0,H=0,W=1,b=a;;){if(!(F|H)){if(b=we(b,h,4,G,Y)|0,b|0)break e;if(h=Y,b=g[h>>2]|0,h=g[h+4>>2]|0,Ci(b,h)|0){b=9;break e}}if(b=we(b,h,g[22384+(H<<2)>>2]|0,G,Y)|0,b|0)break e;if(h=Y,b=g[h>>2]|0,h=g[h+4>>2]|0,a=p+(U<<3)|0,g[a>>2]=b,g[a+4>>2]=h,g[y+(U<<2)>>2]=W,a=F+1|0,T=(a|0)==(W|0),S=H+1|0,k=(S|0)==6,Ci(b,h)|0){b=9;break e}if(W=W+(k&T&1)|0,(W|0)>(A|0)){b=0;break}else U=U+1|0,F=T?0:a,H=T?k?0:S:H}else for(U=1,F=0,H=0,W=1,b=a;;){if(!(F|H)){if(b=we(b,h,4,G,Y)|0,b|0)break e;if(h=Y,b=g[h>>2]|0,h=g[h+4>>2]|0,Ci(b,h)|0){b=9;break e}}if(b=we(b,h,g[22384+(H<<2)>>2]|0,G,Y)|0,b|0)break e;if(h=Y,b=g[h>>2]|0,h=g[h+4>>2]|0,a=p+(U<<3)|0,g[a>>2]=b,g[a+4>>2]=h,a=F+1|0,T=(a|0)==(W|0),S=H+1|0,k=(S|0)==6,Ci(b,h)|0){b=9;break e}if(W=W+(k&T&1)|0,(W|0)>(A|0)){b=0;break}else U=U+1|0,F=T?0:a,H=T?k?0:S:H}else b=0;while(0);return G=b,re=se,G|0}function oe(a,h,A,p,y,b,T,S){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0,b=b|0,T=T|0,S=S|0;var k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0;if(se=re,re=re+16|0,Y=se+8|0,G=se,k=Ws(a|0,h|0,b|0,T|0)|0,U=le()|0,H=p+(k<<3)|0,me=H,Te=g[me>>2]|0,me=g[me+4>>2]|0,F=(Te|0)==(a|0)&(me|0)==(h|0),!((Te|0)==0&(me|0)==0|F))do k=Nt(k|0,U|0,1,0)|0,k=ko(k|0,le()|0,b|0,T|0)|0,U=le()|0,H=p+(k<<3)|0,Te=H,me=g[Te>>2]|0,Te=g[Te+4>>2]|0,F=(me|0)==(a|0)&(Te|0)==(h|0);while(!((me|0)==0&(Te|0)==0|F));if(k=y+(k<<2)|0,F&&(g[k>>2]|0)<=(S|0)||(Te=H,g[Te>>2]=a,g[Te+4>>2]=h,g[k>>2]=S,(S|0)>=(A|0)))return Te=0,re=se,Te|0;switch(F=S+1|0,g[Y>>2]=0,k=we(a,h,2,Y,G)|0,k|0){case 9:{W=9;break}case 0:{k=G,k=oe(g[k>>2]|0,g[k+4>>2]|0,A,p,y,b,T,F)|0,k||(W=9);break}}e:do if((W|0)==9){switch(g[Y>>2]=0,k=we(a,h,3,Y,G)|0,k|0){case 9:break;case 0:{if(k=G,k=oe(g[k>>2]|0,g[k+4>>2]|0,A,p,y,b,T,F)|0,k|0)break e;break}default:break e}switch(g[Y>>2]=0,k=we(a,h,1,Y,G)|0,k|0){case 9:break;case 0:{if(k=G,k=oe(g[k>>2]|0,g[k+4>>2]|0,A,p,y,b,T,F)|0,k|0)break e;break}default:break e}switch(g[Y>>2]=0,k=we(a,h,5,Y,G)|0,k|0){case 9:break;case 0:{if(k=G,k=oe(g[k>>2]|0,g[k+4>>2]|0,A,p,y,b,T,F)|0,k|0)break e;break}default:break e}switch(g[Y>>2]=0,k=we(a,h,4,Y,G)|0,k|0){case 9:break;case 0:{if(k=G,k=oe(g[k>>2]|0,g[k+4>>2]|0,A,p,y,b,T,F)|0,k|0)break e;break}default:break e}switch(g[Y>>2]=0,k=we(a,h,6,Y,G)|0,k|0){case 9:break;case 0:{if(k=G,k=oe(g[k>>2]|0,g[k+4>>2]|0,A,p,y,b,T,F)|0,k|0)break e;break}default:break e}return Te=0,re=se,Te|0}while(0);return Te=k,re=se,Te|0}function we(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0;if(A>>>0>6)return y=1,y|0;if(H=(g[p>>2]|0)%6|0,g[p>>2]=H,(H|0)>0){b=0;do A=Gn(A)|0,b=b+1|0;while((b|0)<(g[p>>2]|0))}if(H=it(a|0,h|0,45)|0,le()|0,U=H&127,U>>>0>121)return y=5,y|0;k=$r(a,h)|0,b=it(a|0,h|0,52)|0,le()|0,b=b&15;e:do if(!b)F=8;else{for(;;){if(T=(15-b|0)*3|0,S=it(a|0,h|0,T|0)|0,le()|0,S=S&7,(S|0)==7){h=5;break}if(G=(Wr(b)|0)==0,b=b+-1|0,W=Ge(7,0,T|0)|0,h=h&~(le()|0),Y=Ge(g[(G?432:16)+(S*28|0)+(A<<2)>>2]|0,0,T|0)|0,T=le()|0,A=g[(G?640:224)+(S*28|0)+(A<<2)>>2]|0,a=Y|a&~W,h=T|h,!A){A=0;break e}if(!b){F=8;break e}}return h|0}while(0);(F|0)==8&&(G=g[848+(U*28|0)+(A<<2)>>2]|0,Y=Ge(G|0,0,45)|0,a=Y|a,h=le()|0|h&-1040385,A=g[4272+(U*28|0)+(A<<2)>>2]|0,(G&127|0)==127&&(G=Ge(g[848+(U*28|0)+20>>2]|0,0,45)|0,h=le()|0|h&-1040385,A=g[4272+(U*28|0)+20>>2]|0,a=dn(G|a,h)|0,h=le()|0,g[p>>2]=(g[p>>2]|0)+1)),S=it(a|0,h|0,45)|0,le()|0,S=S&127;e:do if(ui(S)|0){t:do if(($r(a,h)|0)==1){if((U|0)!=(S|0))if(Ma(S,g[7696+(U*28|0)>>2]|0)|0){a=Fa(a,h)|0,T=1,h=le()|0;break}else Pt(23313,22416,436,22424);switch(k|0){case 3:{a=dn(a,h)|0,h=le()|0,g[p>>2]=(g[p>>2]|0)+1,T=0;break t}case 5:{a=Fa(a,h)|0,h=le()|0,g[p>>2]=(g[p>>2]|0)+5,T=0;break t}case 0:return G=9,G|0;default:return G=1,G|0}}else T=0;while(0);if((A|0)>0){b=0;do a=Eo(a,h)|0,h=le()|0,b=b+1|0;while((b|0)!=(A|0))}if((U|0)!=(S|0)){if(!(Ia(S)|0)){if((T|0)!=0|($r(a,h)|0)!=5)break;g[p>>2]=(g[p>>2]|0)+1;break}switch(H&127){case 8:case 118:break e}($r(a,h)|0)!=3&&(g[p>>2]=(g[p>>2]|0)+1)}}else if((A|0)>0){b=0;do a=dn(a,h)|0,h=le()|0,b=b+1|0;while((b|0)!=(A|0))}while(0);return g[p>>2]=((g[p>>2]|0)+A|0)%6|0,G=y,g[G>>2]=a,g[G+4>>2]=h,G=0,G|0}function Ve(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0;for(S=re,re=re+16|0,b=S,T=S+8|0,y=(Ci(a,h)|0)==0,y=y?1:2;;){if(g[T>>2]=0,F=(we(a,h,y,T,b)|0)==0,k=b,F&((g[k>>2]|0)==(A|0)?(g[k+4>>2]|0)==(p|0):0)){a=4;break}if(y=y+1|0,y>>>0>=7){y=7,a=4;break}}return(a|0)==4?(re=S,y|0):0}function rt(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0;if(G=re,re=re+16|0,W=G,Y=G+8|0,H=W,g[H>>2]=a,g[H+4>>2]=h,!A)return Y=p,g[Y>>2]=a,g[Y+4>>2]=h,Y=0,re=G,Y|0;g[Y>>2]=0;e:do if(Ci(a,h)|0)a=9;else{if(b=(A|0)>0,b){y=0,H=a;do{if(a=we(H,h,4,Y,W)|0,a|0)break e;if(h=W,H=g[h>>2]|0,h=g[h+4>>2]|0,y=y+1|0,Ci(H,h)|0){a=9;break e}}while((y|0)<(A|0));if(U=p,g[U>>2]=H,g[U+4>>2]=h,U=A+-1|0,b){F=0,a=1;do{if(y=22384+(F<<2)|0,(F|0)==5)for(T=g[y>>2]|0,b=0,y=a;;){if(a=W,a=we(g[a>>2]|0,g[a+4>>2]|0,T,Y,W)|0,a|0)break e;if((b|0)!=(U|0))if(k=W,S=g[k>>2]|0,k=g[k+4>>2]|0,a=p+(y<<3)|0,g[a>>2]=S,g[a+4>>2]=k,!(Ci(S,k)|0))a=y+1|0;else{a=9;break e}else a=y;if(b=b+1|0,(b|0)>=(A|0))break;y=a}else for(T=W,k=g[y>>2]|0,S=0,y=a,b=g[T>>2]|0,T=g[T+4>>2]|0;;){if(a=we(b,T,k,Y,W)|0,a|0)break e;if(T=W,b=g[T>>2]|0,T=g[T+4>>2]|0,a=p+(y<<3)|0,g[a>>2]=b,g[a+4>>2]=T,a=y+1|0,Ci(b,T)|0){a=9;break e}if(S=S+1|0,(S|0)>=(A|0))break;y=a}F=F+1|0}while(F>>>0<6);a=W,T=H,y=g[a>>2]|0,b=h,a=g[a+4>>2]|0}else T=H,y=H,b=h,a=h}else T=p,g[T>>2]=a,g[T+4>>2]=h,T=a,y=a,b=h,a=h;a=(T|0)==(y|0)&(b|0)==(a|0)?0:9}while(0);return Y=a,re=G,Y|0}function Et(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0;if(S=re,re=re+48|0,y=S+16|0,b=S+8|0,T=S,A|0)return T=15,re=S,T|0;if(F=a,k=g[F+4>>2]|0,A=b,g[A>>2]=g[F>>2],g[A+4>>2]=k,kl(b,y),h=Yo(y,h,T)|0,!h){if(A=g[b>>2]|0,b=g[a+8>>2]|0,(b|0)>0){y=g[a+12>>2]|0,h=0;do A=(g[y+(h<<3)>>2]|0)+A|0,h=h+1|0;while((h|0)<(b|0))}h=T,y=g[h>>2]|0,h=g[h+4>>2]|0,b=((A|0)<0)<<31>>31,(h|0)<(b|0)|(h|0)==(b|0)&y>>>0<A>>>0?(h=T,g[h>>2]=A,g[h+4>>2]=b,h=b):A=y,k=Nt(A|0,h|0,12,0)|0,F=le()|0,h=T,g[h>>2]=k,g[h+4>>2]=F,h=p,g[h>>2]=k,g[h+4>>2]=F,h=0}return F=h,re=S,F|0}function ni(a,h,A,p,y,b,T){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0,b=b|0,T=T|0;var S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0,be=0,ve=0,Ye=0,je=0,He=0,$e=0,zt=0,vt=0,mt=0,pt=0,Mt=0,St=0,ti=0,kt=0,Jt=0,Fi=0,Oi=0;if(ti=re,re=re+64|0,mt=ti+48|0,pt=ti+32|0,Mt=ti+24|0,Ye=ti+8|0,je=ti,k=g[a>>2]|0,(k|0)<=0)return St=0,re=ti,St|0;for(He=a+4|0,$e=mt+8|0,zt=pt+8|0,vt=Ye+8|0,S=0,be=0;;){F=g[He>>2]|0,de=F+(be<<4)|0,g[mt>>2]=g[de>>2],g[mt+4>>2]=g[de+4>>2],g[mt+8>>2]=g[de+8>>2],g[mt+12>>2]=g[de+12>>2],(be|0)==(k+-1|0)?(g[pt>>2]=g[F>>2],g[pt+4>>2]=g[F+4>>2],g[pt+8>>2]=g[F+8>>2],g[pt+12>>2]=g[F+12>>2]):(de=F+(be+1<<4)|0,g[pt>>2]=g[de>>2],g[pt+4>>2]=g[de+4>>2],g[pt+8>>2]=g[de+8>>2],g[pt+12>>2]=g[de+12>>2]),k=_o(mt,pt,p,Mt)|0;e:do if(k)F=0,S=k;else if(F=Mt,k=g[F>>2]|0,F=g[F+4>>2]|0,(F|0)>0|(F|0)==0&k>>>0>0){Te=0,de=0;t:for(;;){if(Oi=+K[mt>>3],me=ci(k|0,F|0,Te|0,de|0)|0,Fi=+(me>>>0)+4294967296*+(le()|0),kt=+(k>>>0)+4294967296*+(F|0),Jt=+(Te>>>0)+4294967296*+(de|0),K[Ye>>3]=Oi*Fi/kt+ +K[pt>>3]*Jt/kt,K[vt>>3]=+K[$e>>3]*Fi/kt+ +K[zt>>3]*Jt/kt,k=ra(Ye,p,je)|0,k|0){S=k;break}me=je,se=g[me>>2]|0,me=g[me+4>>2]|0,W=Ws(se|0,me|0,h|0,A|0)|0,U=le()|0,k=T+(W<<3)|0,H=k,F=g[H>>2]|0,H=g[H+4>>2]|0;i:do if((F|0)==0&(H|0)==0)ve=k,St=16;else for(Y=0,G=0;;){if((Y|0)>(A|0)|(Y|0)==(A|0)&G>>>0>h>>>0){S=1;break t}if((F|0)==(se|0)&(H|0)==(me|0))break i;if(k=Nt(W|0,U|0,1,0)|0,W=ko(k|0,le()|0,h|0,A|0)|0,U=le()|0,G=Nt(G|0,Y|0,1,0)|0,Y=le()|0,k=T+(W<<3)|0,H=k,F=g[H>>2]|0,H=g[H+4>>2]|0,(F|0)==0&(H|0)==0){ve=k,St=16;break}}while(0);if((St|0)==16&&(St=0,!((se|0)==0&(me|0)==0))&&(G=ve,g[G>>2]=se,g[G+4>>2]=me,G=b+(g[y>>2]<<3)|0,g[G>>2]=se,g[G+4>>2]=me,G=y,G=Nt(g[G>>2]|0,g[G+4>>2]|0,1,0)|0,se=le()|0,me=y,g[me>>2]=G,g[me+4>>2]=se),Te=Nt(Te|0,de|0,1,0)|0,de=le()|0,F=Mt,k=g[F>>2]|0,F=g[F+4>>2]|0,!((F|0)>(de|0)|(F|0)==(de|0)&k>>>0>Te>>>0)){F=1;break e}}F=0}else F=1;while(0);if(be=be+1|0,!F){St=21;break}if(k=g[a>>2]|0,(be|0)>=(k|0)){S=0,St=21;break}}return(St|0)==21?(re=ti,S|0):0}function Ji(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0,be=0,ve=0,Ye=0,je=0,He=0,$e=0,zt=0,vt=0,mt=0,pt=0,Mt=0,St=0,ti=0,kt=0,Jt=0,Fi=0;if(Fi=re,re=re+112|0,St=Fi+80|0,k=Fi+72|0,ti=Fi,kt=Fi+56|0,A|0)return Jt=15,re=Fi,Jt|0;if(F=a+8|0,Jt=sr((g[F>>2]<<5)+32|0)|0,!Jt)return Jt=13,re=Fi,Jt|0;if(Ic(a,Jt),pt=a,Mt=g[pt+4>>2]|0,A=k,g[A>>2]=g[pt>>2],g[A+4>>2]=Mt,kl(k,St),A=Yo(St,h,ti)|0,A)pt=0,Mt=0;else{if(A=g[k>>2]|0,b=g[F>>2]|0,(b|0)>0){T=g[a+12>>2]|0,y=0;do A=(g[T+(y<<3)>>2]|0)+A|0,y=y+1|0;while((y|0)!=(b|0));y=A}else y=A;A=ti,b=g[A>>2]|0,A=g[A+4>>2]|0,T=((y|0)<0)<<31>>31,(A|0)<(T|0)|(A|0)==(T|0)&b>>>0<y>>>0?(A=ti,g[A>>2]=y,g[A+4>>2]=T,A=T):y=b,pt=Nt(y|0,A|0,12,0)|0,Mt=le()|0,A=ti,g[A>>2]=pt,g[A+4>>2]=Mt,A=0}if(A|0)return Kt(Jt),Jt=A,re=Fi,Jt|0;if(y=Or(pt,8)|0,!y)return Kt(Jt),Jt=13,re=Fi,Jt|0;if(S=Or(pt,8)|0,!S)return Kt(Jt),Kt(y),Jt=13,re=Fi,Jt|0;vt=St,g[vt>>2]=0,g[vt+4>>2]=0,vt=a,mt=g[vt+4>>2]|0,A=k,g[A>>2]=g[vt>>2],g[A+4>>2]=mt,A=ni(k,pt,Mt,h,St,y,S)|0;e:do if(A)Kt(y),Kt(S),Kt(Jt);else{t:do if((g[F>>2]|0)>0){for(T=a+12|0,b=0;A=ni((g[T>>2]|0)+(b<<3)|0,pt,Mt,h,St,y,S)|0,b=b+1|0,!(A|0);)if((b|0)>=(g[F>>2]|0))break t;Kt(y),Kt(S),Kt(Jt);break e}while(0);(Mt|0)>0|(Mt|0)==0&pt>>>0>0&&w(S|0,0,pt<<3|0)|0,mt=St,vt=g[mt+4>>2]|0;t:do if((vt|0)>0|(vt|0)==0&(g[mt>>2]|0)>>>0>0){He=y,$e=S,zt=y,vt=S,mt=y,A=y,ve=y,Ye=S,je=S,y=S;i:for(;;){for(me=0,Te=0,de=0,be=0,b=0,T=0;;){S=ti,k=S+56|0;do g[S>>2]=0,S=S+4|0;while((S|0)<(k|0));if(h=He+(me<<3)|0,F=g[h>>2]|0,h=g[h+4>>2]|0,te(F,h,1,ti,0)|0){S=ti,k=S+56|0;do g[S>>2]=0,S=S+4|0;while((S|0)<(k|0));S=Or(7,4)|0,S|0&&(oe(F,h,1,ti,S,7,0,0)|0,Kt(S))}for(se=0;;){G=ti+(se<<3)|0,Y=g[G>>2]|0,G=g[G+4>>2]|0;r:do if((Y|0)==0&(G|0)==0)S=b,k=T;else{if(U=Ws(Y|0,G|0,pt|0,Mt|0)|0,F=le()|0,S=p+(U<<3)|0,h=S,k=g[h>>2]|0,h=g[h+4>>2]|0,!((k|0)==0&(h|0)==0)){H=0,W=0;do{if((H|0)>(Mt|0)|(H|0)==(Mt|0)&W>>>0>pt>>>0)break i;if((k|0)==(Y|0)&(h|0)==(G|0)){S=b,k=T;break r}S=Nt(U|0,F|0,1,0)|0,U=ko(S|0,le()|0,pt|0,Mt|0)|0,F=le()|0,W=Nt(W|0,H|0,1,0)|0,H=le()|0,S=p+(U<<3)|0,h=S,k=g[h>>2]|0,h=g[h+4>>2]|0}while(!((k|0)==0&(h|0)==0))}(Y|0)==0&(G|0)==0?(S=b,k=T):(Vs(Y,G,kt)|0,Mc(a,Jt,kt)|0&&(W=Nt(b|0,T|0,1,0)|0,T=le()|0,H=S,g[H>>2]=Y,g[H+4>>2]=G,b=$e+(b<<3)|0,g[b>>2]=Y,g[b+4>>2]=G,b=W),S=b,k=T)}while(0);if(se=se+1|0,se>>>0>=7)break;b=S,T=k}if(me=Nt(me|0,Te|0,1,0)|0,Te=le()|0,de=Nt(de|0,be|0,1,0)|0,be=le()|0,T=St,b=g[T>>2]|0,T=g[T+4>>2]|0,(be|0)<(T|0)|(be|0)==(T|0)&de>>>0<b>>>0)b=S,T=k;else break}if((T|0)>0|(T|0)==0&b>>>0>0){b=0,T=0;do be=He+(b<<3)|0,g[be>>2]=0,g[be+4>>2]=0,b=Nt(b|0,T|0,1,0)|0,T=le()|0,be=St,de=g[be+4>>2]|0;while((T|0)<(de|0)|((T|0)==(de|0)?b>>>0<(g[be>>2]|0)>>>0:0))}if(be=St,g[be>>2]=S,g[be+4>>2]=k,(k|0)>0|(k|0)==0&S>>>0>0)se=y,me=je,Te=mt,de=Ye,be=$e,y=ve,je=A,Ye=zt,ve=se,A=me,mt=vt,vt=Te,zt=de,$e=He,He=be;else break t}Kt(zt),Kt(vt),Kt(Jt),A=1;break e}else A=S;while(0);Kt(Jt),Kt(y),Kt(A),A=0}while(0);return Jt=A,re=Fi,Jt|0}function nr(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0;if(U=re,re=re+176|0,k=U,(h|0)<1)return Bc(A,0,0),F=0,re=U,F|0;for(S=a,S=it(g[S>>2]|0,g[S+4>>2]|0,52)|0,le()|0,Bc(A,(h|0)>6?h:6,S&15),S=0;p=a+(S<<3)|0,p=yr(g[p>>2]|0,g[p+4>>2]|0,k)|0,!(p|0);){if(p=g[k>>2]|0,(p|0)>0){T=0;do b=k+8+(T<<4)|0,T=T+1|0,p=k+8+(((T|0)%(p|0)|0)<<4)|0,y=ca(A,p,b)|0,y?It(A,y)|0:Ht(A,b,p)|0,p=g[k>>2]|0;while((T|0)<(p|0))}if(S=S+1|0,(S|0)>=(h|0)){p=0,F=13;break}}return(F|0)==13?(re=U,p|0):(Fr(A),F=p,re=U,F|0)}function Er(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0;if(b=re,re=re+32|0,p=b,y=b+16|0,a=nr(a,h,y)|0,a|0)return A=a,re=b,A|0;if(g[A>>2]=0,g[A+4>>2]=0,g[A+8>>2]=0,a=la(y)|0,a|0)do{h=Cc(A)|0;do Ua(h,a)|0,T=a+16|0,g[p>>2]=g[T>>2],g[p+4>>2]=g[T+4>>2],g[p+8>>2]=g[T+8>>2],g[p+12>>2]=g[T+12>>2],It(y,a)|0,a=Nl(y,p)|0;while(a|0);a=la(y)|0}while(a|0);return Fr(y),a=yn(A)|0,a?(Jn(A),T=a,re=b,T|0):(T=0,re=b,T|0)}function ui(a){return a=a|0,a>>>0>121?(a=0,a|0):(a=g[7696+(a*28|0)+16>>2]|0,a|0)}function Ia(a){return a=a|0,(a|0)==4|(a|0)==117|0}function Xo(a){return a=a|0,g[11120+((g[a>>2]|0)*216|0)+((g[a+4>>2]|0)*72|0)+((g[a+8>>2]|0)*24|0)+(g[a+12>>2]<<3)>>2]|0}function fc(a){return a=a|0,g[11120+((g[a>>2]|0)*216|0)+((g[a+4>>2]|0)*72|0)+((g[a+8>>2]|0)*24|0)+(g[a+12>>2]<<3)+4>>2]|0}function dc(a,h){a=a|0,h=h|0,a=7696+(a*28|0)|0,g[h>>2]=g[a>>2],g[h+4>>2]=g[a+4>>2],g[h+8>>2]=g[a+8>>2],g[h+12>>2]=g[a+12>>2]}function fl(a,h){a=a|0,h=h|0;var A=0,p=0;if(h>>>0>20)return h=-1,h|0;do if((g[11120+(h*216|0)>>2]|0)!=(a|0))if((g[11120+(h*216|0)+8>>2]|0)!=(a|0))if((g[11120+(h*216|0)+16>>2]|0)!=(a|0))if((g[11120+(h*216|0)+24>>2]|0)!=(a|0))if((g[11120+(h*216|0)+32>>2]|0)!=(a|0))if((g[11120+(h*216|0)+40>>2]|0)!=(a|0))if((g[11120+(h*216|0)+48>>2]|0)!=(a|0))if((g[11120+(h*216|0)+56>>2]|0)!=(a|0))if((g[11120+(h*216|0)+64>>2]|0)!=(a|0))if((g[11120+(h*216|0)+72>>2]|0)!=(a|0))if((g[11120+(h*216|0)+80>>2]|0)!=(a|0))if((g[11120+(h*216|0)+88>>2]|0)!=(a|0))if((g[11120+(h*216|0)+96>>2]|0)!=(a|0))if((g[11120+(h*216|0)+104>>2]|0)!=(a|0))if((g[11120+(h*216|0)+112>>2]|0)!=(a|0))if((g[11120+(h*216|0)+120>>2]|0)!=(a|0))if((g[11120+(h*216|0)+128>>2]|0)!=(a|0))if((g[11120+(h*216|0)+136>>2]|0)==(a|0))a=2,A=1,p=2;else{if((g[11120+(h*216|0)+144>>2]|0)==(a|0)){a=0,A=2,p=0;break}if((g[11120+(h*216|0)+152>>2]|0)==(a|0)){a=0,A=2,p=1;break}if((g[11120+(h*216|0)+160>>2]|0)==(a|0)){a=0,A=2,p=2;break}if((g[11120+(h*216|0)+168>>2]|0)==(a|0)){a=1,A=2,p=0;break}if((g[11120+(h*216|0)+176>>2]|0)==(a|0)){a=1,A=2,p=1;break}if((g[11120+(h*216|0)+184>>2]|0)==(a|0)){a=1,A=2,p=2;break}if((g[11120+(h*216|0)+192>>2]|0)==(a|0)){a=2,A=2,p=0;break}if((g[11120+(h*216|0)+200>>2]|0)==(a|0)){a=2,A=2,p=1;break}if((g[11120+(h*216|0)+208>>2]|0)==(a|0)){a=2,A=2,p=2;break}else a=-1;return a|0}else a=2,A=1,p=1;else a=2,A=1,p=0;else a=1,A=1,p=2;else a=1,A=1,p=1;else a=1,A=1,p=0;else a=0,A=1,p=2;else a=0,A=1,p=1;else a=0,A=1,p=0;else a=2,A=0,p=2;else a=2,A=0,p=1;else a=2,A=0,p=0;else a=1,A=0,p=2;else a=1,A=0,p=1;else a=1,A=0,p=0;else a=0,A=0,p=2;else a=0,A=0,p=1;else a=0,A=0,p=0;while(0);return h=g[11120+(h*216|0)+(A*72|0)+(a*24|0)+(p<<3)+4>>2]|0,h|0}function Ma(a,h){return a=a|0,h=h|0,(g[7696+(a*28|0)+20>>2]|0)==(h|0)?(h=1,h|0):(h=(g[7696+(a*28|0)+24>>2]|0)==(h|0),h|0)}function An(a,h){return a=a|0,h=h|0,g[848+(a*28|0)+(h<<2)>>2]|0}function po(a,h){return a=a|0,h=h|0,(g[848+(a*28|0)>>2]|0)==(h|0)?(h=0,h|0):(g[848+(a*28|0)+4>>2]|0)==(h|0)?(h=1,h|0):(g[848+(a*28|0)+8>>2]|0)==(h|0)?(h=2,h|0):(g[848+(a*28|0)+12>>2]|0)==(h|0)?(h=3,h|0):(g[848+(a*28|0)+16>>2]|0)==(h|0)?(h=4,h|0):(g[848+(a*28|0)+20>>2]|0)==(h|0)?(h=5,h|0):((g[848+(a*28|0)+24>>2]|0)==(h|0)?6:7)|0}function Ts(){return 122}function Ra(a){a=a|0;var h=0,A=0,p=0;h=0;do Ge(h|0,0,45)|0,p=le()|0|134225919,A=a+(h<<3)|0,g[A>>2]=-1,g[A+4>>2]=p,h=h+1|0;while((h|0)!=122);return 0}function Zo(a){return a=a|0,+K[a+16>>3]<+K[a+24>>3]|0}function go(a,h){a=a|0,h=h|0;var A=0,p=0,y=0;return A=+K[h>>3],!(A>=+K[a+8>>3])||!(A<=+K[a>>3])?(h=0,h|0):(p=+K[a+16>>3],A=+K[a+24>>3],y=+K[h+8>>3],h=y>=A,a=y<=p&1,p<A?h&&(a=1):h||(a=0),h=(a|0)!=0,h|0)}function Yo(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0;G=re,re=re+288|0,U=G+264|0,H=G+96|0,F=G,S=F,k=S+96|0;do g[S>>2]=0,S=S+4|0;while((S|0)<(k|0));return h=pn(h,F)|0,h|0?(Y=h,re=G,Y|0):(k=F,F=g[k>>2]|0,k=g[k+4>>2]|0,Vs(F,k,U)|0,yr(F,k,H)|0,T=+Qr(U,H+8|0),K[U>>3]=+K[a>>3],k=U+8|0,K[k>>3]=+K[a+16>>3],K[H>>3]=+K[a+8>>3],F=H+8|0,K[F>>3]=+K[a+24>>3],y=+Qr(U,H),me=+K[k>>3]-+K[F>>3],b=+ft(+me),se=+K[U>>3]-+K[H>>3],p=+ft(+se),!(me==0|se==0)&&(me=+E(+b,+p),me=+Vr(+(y*y/+n(+(me/+n(+b,+p)),3)/(T*(T*2.59807621135)*.8))),K[ut>>3]=me,W=~~me>>>0,Y=+ft(me)>=1?me>0?~~+zs(+Zt(me/4294967296),4294967295)>>>0:~~+Vr((me-+(~~me>>>0))/4294967296)>>>0:0,(g[ut+4>>2]&2146435072|0)!=2146435072)?(H=(W|0)==0&(Y|0)==0,h=A,g[h>>2]=H?1:W,g[h+4>>2]=H?0:Y,h=0):h=1,Y=h,re=G,Y|0)}function _o(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0,U=0;F=re,re=re+288|0,T=F+264|0,S=F+96|0,k=F,y=k,b=y+96|0;do g[y>>2]=0,y=y+4|0;while((y|0)<(b|0));return A=pn(A,k)|0,A|0?(p=A,re=F,p|0):(A=k,y=g[A>>2]|0,A=g[A+4>>2]|0,Vs(y,A,T)|0,yr(y,A,S)|0,U=+Qr(T,S+8|0),U=+Vr(+(+Qr(a,h)/(U*2))),K[ut>>3]=U,A=~~U>>>0,y=+ft(U)>=1?U>0?~~+zs(+Zt(U/4294967296),4294967295)>>>0:~~+Vr((U-+(~~U>>>0))/4294967296)>>>0:0,(g[ut+4>>2]&2146435072|0)==2146435072?(p=1,re=F,p|0):(k=(A|0)==0&(y|0)==0,g[p>>2]=k?1:A,g[p+4>>2]=k?0:y,p=0,re=F,p|0))}function Rn(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0,g[a>>2]=h,g[a+4>>2]=A,g[a+8>>2]=p}function Ai(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0;H=h+8|0,g[H>>2]=0,k=+K[a>>3],T=+ft(+k),F=+K[a+8>>3],S=+ft(+F)/.8660254037844386,T=T+S*.5,A=~~T,a=~~S,T=T-+(A|0),S=S-+(a|0);do if(T<.5)if(T<.3333333333333333)if(g[h>>2]=A,S<(T+1)*.5){g[h+4>>2]=a;break}else{a=a+1|0,g[h+4>>2]=a;break}else if(W=1-T,a=(!(S<W)&1)+a|0,g[h+4>>2]=a,W<=S&S<T*2){A=A+1|0,g[h>>2]=A;break}else{g[h>>2]=A;break}else{if(!(T<.6666666666666666))if(A=A+1|0,g[h>>2]=A,S<T*.5){g[h+4>>2]=a;break}else{a=a+1|0,g[h+4>>2]=a;break}if(S<1-T){if(g[h+4>>2]=a,T*2+-1<S){g[h>>2]=A;break}}else a=a+1|0,g[h+4>>2]=a;A=A+1|0,g[h>>2]=A}while(0);do if(k<0)if(a&1){U=(a+1|0)/2|0,U=ci(A|0,((A|0)<0)<<31>>31|0,U|0,((U|0)<0)<<31>>31|0)|0,A=~~(+(A|0)-((+(U>>>0)+4294967296*+(le()|0))*2+1)),g[h>>2]=A;break}else{U=(a|0)/2|0,U=ci(A|0,((A|0)<0)<<31>>31|0,U|0,((U|0)<0)<<31>>31|0)|0,A=~~(+(A|0)-(+(U>>>0)+4294967296*+(le()|0))*2),g[h>>2]=A;break}while(0);U=h+4|0,F<0&&(A=A-((a<<1|1|0)/2|0)|0,g[h>>2]=A,a=0-a|0,g[U>>2]=a),p=a-A|0,(A|0)<0?(y=0-A|0,g[U>>2]=p,g[H>>2]=y,g[h>>2]=0,a=p,A=0):y=0,(a|0)<0&&(A=A-a|0,g[h>>2]=A,y=y-a|0,g[H>>2]=y,g[U>>2]=0,a=0),b=A-y|0,p=a-y|0,(y|0)<0&&(g[h>>2]=b,g[U>>2]=p,g[H>>2]=0,a=p,A=b,y=0),p=(a|0)<(A|0)?a:A,p=(y|0)<(p|0)?y:p,!((p|0)<=0)&&(g[h>>2]=A-p,g[U>>2]=a-p,g[H>>2]=y-p)}function fr(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0;h=g[a>>2]|0,T=a+4|0,A=g[T>>2]|0,(h|0)<0&&(A=A-h|0,g[T>>2]=A,b=a+8|0,g[b>>2]=(g[b>>2]|0)-h,g[a>>2]=0,h=0),(A|0)<0?(h=h-A|0,g[a>>2]=h,b=a+8|0,y=(g[b>>2]|0)-A|0,g[b>>2]=y,g[T>>2]=0,A=0):(y=a+8|0,b=y,y=g[y>>2]|0),(y|0)<0&&(h=h-y|0,g[a>>2]=h,A=A-y|0,g[T>>2]=A,g[b>>2]=0,y=0),p=(A|0)<(h|0)?A:h,p=(y|0)<(p|0)?y:p,!((p|0)<=0)&&(g[a>>2]=h-p,g[T>>2]=A-p,g[b>>2]=y-p)}function dr(a,h){a=a|0,h=h|0;var A=0,p=0;p=g[a+8>>2]|0,A=+((g[a+4>>2]|0)-p|0),K[h>>3]=+((g[a>>2]|0)-p|0)-A*.5,K[h+8>>3]=A*.8660254037844386}function Di(a,h,A){a=a|0,h=h|0,A=A|0,g[A>>2]=(g[h>>2]|0)+(g[a>>2]|0),g[A+4>>2]=(g[h+4>>2]|0)+(g[a+4>>2]|0),g[A+8>>2]=(g[h+8>>2]|0)+(g[a+8>>2]|0)}function Go(a,h,A){a=a|0,h=h|0,A=A|0,g[A>>2]=(g[a>>2]|0)-(g[h>>2]|0),g[A+4>>2]=(g[a+4>>2]|0)-(g[h+4>>2]|0),g[A+8>>2]=(g[a+8>>2]|0)-(g[h+8>>2]|0)}function Qo(a,h){a=a|0,h=h|0;var A=0,p=0;A=Qt(g[a>>2]|0,h)|0,g[a>>2]=A,A=a+4|0,p=Qt(g[A>>2]|0,h)|0,g[A>>2]=p,a=a+8|0,h=Qt(g[a>>2]|0,h)|0,g[a>>2]=h}function Yn(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;T=g[a>>2]|0,S=(T|0)<0,p=(g[a+4>>2]|0)-(S?T:0)|0,b=(p|0)<0,y=(b?0-p|0:0)+((g[a+8>>2]|0)-(S?T:0))|0,A=(y|0)<0,a=A?0:y,h=(b?0:p)-(A?y:0)|0,y=(S?0:T)-(b?p:0)-(A?y:0)|0,A=(h|0)<(y|0)?h:y,A=(a|0)<(A|0)?a:A,p=(A|0)>0,a=a-(p?A:0)|0,h=h-(p?A:0)|0;e:do switch(y-(p?A:0)|0){case 0:switch(h|0){case 0:return S=a|0?(a|0)==1?1:7:0,S|0;case 1:return S=a|0?(a|0)==1?3:7:2,S|0;default:break e}case 1:switch(h|0){case 0:return S=a|0?(a|0)==1?5:7:4,S|0;case 1:{if(!a)a=6;else break e;return a|0}default:break e}}while(0);return S=7,S|0}function dl(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;T=a+8|0,y=g[T>>2]|0,b=(g[a>>2]|0)-y|0,S=a+4|0,y=(g[S>>2]|0)-y|0;do if(b>>>0>715827881|y>>>0>715827881){if(A=(b|0)>0,A){if((2147483647-b|0)<(b|0)||(2147483647-(b<<1)|0)<(b|0))return S=1,S|0}else if((-2147483648-b|0)>(b|0)||(-2147483648-(b<<1)|0)>(b|0))return S=1,S|0;if(h=b*3|0,(y|0)>0){if((2147483647-y|0)<(y|0))return S=1,S|0}else if((-2147483648-y|0)>(y|0))return S=1,S|0;if(p=y<<1,(b|0)>-1){if((h|-2147483648|0)>=(y|0))return S=1,S|0}else if((h^-2147483648|0)<(y|0))return S=1,S|0;if(A){if((2147483647-b|0)<(p|0))h=1;else{A=p;break}return h|0}else{if((-2147483648-b|0)>(p|0))h=1;else{A=p;break}return h|0}}else A=y<<1,h=b*3|0;while(0);p=nn(+(h-y|0)/7)|0,g[a>>2]=p,y=nn(+(A+b|0)/7)|0,g[S>>2]=y,g[T>>2]=0,A=(y|0)<(p|0),h=A?p:y,A=A?y:p;do if((A|0)<0){if((h|0)>0){if((h|-2147483648|0)<(A|0)&((A|0)!=-2147483648&(2147483647-h|0)>=(A|0)))break;Pt(23313,22444,355,22455)}if((A|0)==-2147483648|(-2147483648-h|0)>(A|0)&&Pt(23313,22444,355,22455),(h|0)>-1){if((h|-2147483648|0)<(A|0))break;Pt(23313,22444,355,22455)}else{if((h^-2147483648|0)>=(A|0))break;Pt(23313,22444,355,22455)}}while(0);return h=y-p|0,(p|0)<0?(A=0-p|0,g[S>>2]=h,g[T>>2]=A,g[a>>2]=0,p=0):(h=y,A=0),(h|0)<0&&(p=p-h|0,g[a>>2]=p,A=A-h|0,g[T>>2]=A,g[S>>2]=0,h=0),b=p-A|0,y=h-A|0,(A|0)<0?(g[a>>2]=b,g[S>>2]=y,g[T>>2]=0,h=y,y=b,A=0):y=p,p=(h|0)<(y|0)?h:y,p=(A|0)<(p|0)?A:p,(p|0)<=0?(S=0,S|0):(g[a>>2]=y-p,g[S>>2]=h-p,g[T>>2]=A-p,S=0,S|0)}function pl(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;T=a+8|0,y=g[T>>2]|0,b=(g[a>>2]|0)-y|0,S=a+4|0,y=(g[S>>2]|0)-y|0;do if(b>>>0>715827881|y>>>0>715827881){if(A=(b|0)>0,A){if((2147483647-b|0)<(b|0))return S=1,S|0}else if((-2147483648-b|0)>(b|0))return S=1,S|0;if(h=b<<1,(y|0)>0){if((2147483647-y|0)<(y|0)||(2147483647-(y<<1)|0)<(y|0))return S=1,S|0}else if((-2147483648-y|0)>(y|0)||(-2147483648-(y<<1)|0)>(y|0))return S=1,S|0;if(p=y*3|0,A){if((2147483647-h|0)<(y|0))return S=1,S|0}else if((-2147483648-h|0)>(y|0))return S=1,S|0;if((y|0)>-1){if((p|-2147483648|0)<(b|0)){A=p;break}else h=1;return h|0}else{if((p^-2147483648|0)<(b|0))h=1;else{A=p;break}return h|0}}else A=y*3|0,h=b<<1;while(0);p=nn(+(h+y|0)/7)|0,g[a>>2]=p,y=nn(+(A-b|0)/7)|0,g[S>>2]=y,g[T>>2]=0,A=(y|0)<(p|0),h=A?p:y,A=A?y:p;do if((A|0)<0){if((h|0)>0){if((h|-2147483648|0)<(A|0)&((A|0)!=-2147483648&(2147483647-h|0)>=(A|0)))break;Pt(23313,22444,404,22469)}if((A|0)==-2147483648|(-2147483648-h|0)>(A|0)&&Pt(23313,22444,404,22469),(h|0)>-1){if((h|-2147483648|0)<(A|0))break;Pt(23313,22444,404,22469)}else{if((h^-2147483648|0)>=(A|0))break;Pt(23313,22444,404,22469)}}while(0);return h=y-p|0,(p|0)<0?(A=0-p|0,g[S>>2]=h,g[T>>2]=A,g[a>>2]=0,p=0):(h=y,A=0),(h|0)<0&&(p=p-h|0,g[a>>2]=p,A=A-h|0,g[T>>2]=A,g[S>>2]=0,h=0),b=p-A|0,y=h-A|0,(A|0)<0?(g[a>>2]=b,g[S>>2]=y,g[T>>2]=0,h=y,y=b,A=0):y=p,p=(h|0)<(y|0)?h:y,p=(A|0)<(p|0)?A:p,(p|0)<=0?(S=0,S|0):(g[a>>2]=y-p,g[S>>2]=h-p,g[T>>2]=A-p,S=0,S|0)}function ka(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;T=a+8|0,A=g[T>>2]|0,h=(g[a>>2]|0)-A|0,S=a+4|0,A=(g[S>>2]|0)-A|0,p=nn(+((h*3|0)-A|0)/7)|0,g[a>>2]=p,h=nn(+((A<<1)+h|0)/7)|0,g[S>>2]=h,g[T>>2]=0,A=h-p|0,(p|0)<0?(b=0-p|0,g[S>>2]=A,g[T>>2]=b,g[a>>2]=0,h=A,p=0,A=b):A=0,(h|0)<0&&(p=p-h|0,g[a>>2]=p,A=A-h|0,g[T>>2]=A,g[S>>2]=0,h=0),b=p-A|0,y=h-A|0,(A|0)<0?(g[a>>2]=b,g[S>>2]=y,g[T>>2]=0,h=y,y=b,A=0):y=p,p=(h|0)<(y|0)?h:y,p=(A|0)<(p|0)?A:p,!((p|0)<=0)&&(g[a>>2]=y-p,g[S>>2]=h-p,g[T>>2]=A-p)}function Da(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;T=a+8|0,A=g[T>>2]|0,h=(g[a>>2]|0)-A|0,S=a+4|0,A=(g[S>>2]|0)-A|0,p=nn(+((h<<1)+A|0)/7)|0,g[a>>2]=p,h=nn(+((A*3|0)-h|0)/7)|0,g[S>>2]=h,g[T>>2]=0,A=h-p|0,(p|0)<0?(b=0-p|0,g[S>>2]=A,g[T>>2]=b,g[a>>2]=0,h=A,p=0,A=b):A=0,(h|0)<0&&(p=p-h|0,g[a>>2]=p,A=A-h|0,g[T>>2]=A,g[S>>2]=0,h=0),b=p-A|0,y=h-A|0,(A|0)<0?(g[a>>2]=b,g[S>>2]=y,g[T>>2]=0,h=y,y=b,A=0):y=p,p=(h|0)<(y|0)?h:y,p=(A|0)<(p|0)?A:p,!((p|0)<=0)&&(g[a>>2]=y-p,g[S>>2]=h-p,g[T>>2]=A-p)}function mo(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;h=g[a>>2]|0,T=a+4|0,A=g[T>>2]|0,S=a+8|0,p=g[S>>2]|0,y=A+(h*3|0)|0,g[a>>2]=y,A=p+(A*3|0)|0,g[T>>2]=A,h=(p*3|0)+h|0,g[S>>2]=h,p=A-y|0,(y|0)<0?(h=h-y|0,g[T>>2]=p,g[S>>2]=h,g[a>>2]=0,A=p,p=0):p=y,(A|0)<0&&(p=p-A|0,g[a>>2]=p,h=h-A|0,g[S>>2]=h,g[T>>2]=0,A=0),b=p-h|0,y=A-h|0,(h|0)<0?(g[a>>2]=b,g[T>>2]=y,g[S>>2]=0,p=b,h=0):y=A,A=(y|0)<(p|0)?y:p,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(g[a>>2]=p-A,g[T>>2]=y-A,g[S>>2]=h-A)}function sn(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;y=g[a>>2]|0,T=a+4|0,h=g[T>>2]|0,S=a+8|0,A=g[S>>2]|0,p=(h*3|0)+y|0,y=A+(y*3|0)|0,g[a>>2]=y,g[T>>2]=p,h=(A*3|0)+h|0,g[S>>2]=h,A=p-y|0,(y|0)<0?(h=h-y|0,g[T>>2]=A,g[S>>2]=h,g[a>>2]=0,y=0):A=p,(A|0)<0&&(y=y-A|0,g[a>>2]=y,h=h-A|0,g[S>>2]=h,g[T>>2]=0,A=0),b=y-h|0,p=A-h|0,(h|0)<0?(g[a>>2]=b,g[T>>2]=p,g[S>>2]=0,y=b,h=0):p=A,A=(p|0)<(y|0)?p:y,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(g[a>>2]=y-A,g[T>>2]=p-A,g[S>>2]=h-A)}function gl(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0,S=0;(h+-1|0)>>>0>=6||(y=(g[15440+(h*12|0)>>2]|0)+(g[a>>2]|0)|0,g[a>>2]=y,S=a+4|0,p=(g[15440+(h*12|0)+4>>2]|0)+(g[S>>2]|0)|0,g[S>>2]=p,T=a+8|0,h=(g[15440+(h*12|0)+8>>2]|0)+(g[T>>2]|0)|0,g[T>>2]=h,A=p-y|0,(y|0)<0?(h=h-y|0,g[S>>2]=A,g[T>>2]=h,g[a>>2]=0,p=0):(A=p,p=y),(A|0)<0&&(p=p-A|0,g[a>>2]=p,h=h-A|0,g[T>>2]=h,g[S>>2]=0,A=0),b=p-h|0,y=A-h|0,(h|0)<0?(g[a>>2]=b,g[S>>2]=y,g[T>>2]=0,p=b,h=0):y=A,A=(y|0)<(p|0)?y:p,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(g[a>>2]=p-A,g[S>>2]=y-A,g[T>>2]=h-A))}function _l(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;y=g[a>>2]|0,T=a+4|0,h=g[T>>2]|0,S=a+8|0,A=g[S>>2]|0,p=h+y|0,y=A+y|0,g[a>>2]=y,g[T>>2]=p,h=A+h|0,g[S>>2]=h,A=p-y|0,(y|0)<0?(h=h-y|0,g[T>>2]=A,g[S>>2]=h,g[a>>2]=0,p=0):(A=p,p=y),(A|0)<0&&(p=p-A|0,g[a>>2]=p,h=h-A|0,g[S>>2]=h,g[T>>2]=0,A=0),b=p-h|0,y=A-h|0,(h|0)<0?(g[a>>2]=b,g[T>>2]=y,g[S>>2]=0,p=b,h=0):y=A,A=(y|0)<(p|0)?y:p,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(g[a>>2]=p-A,g[T>>2]=y-A,g[S>>2]=h-A)}function fn(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;h=g[a>>2]|0,T=a+4|0,p=g[T>>2]|0,S=a+8|0,A=g[S>>2]|0,y=p+h|0,g[a>>2]=y,p=A+p|0,g[T>>2]=p,h=A+h|0,g[S>>2]=h,A=p-y|0,(y|0)<0?(h=h-y|0,g[T>>2]=A,g[S>>2]=h,g[a>>2]=0,p=0):(A=p,p=y),(A|0)<0&&(p=p-A|0,g[a>>2]=p,h=h-A|0,g[S>>2]=h,g[T>>2]=0,A=0),b=p-h|0,y=A-h|0,(h|0)<0?(g[a>>2]=b,g[T>>2]=y,g[S>>2]=0,p=b,h=0):y=A,A=(y|0)<(p|0)?y:p,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(g[a>>2]=p-A,g[T>>2]=y-A,g[S>>2]=h-A)}function Gn(a){switch(a=a|0,a|0){case 1:{a=5;break}case 5:{a=4;break}case 4:{a=6;break}case 6:{a=2;break}case 2:{a=3;break}case 3:{a=1;break}}return a|0}function kn(a){switch(a=a|0,a|0){case 1:{a=3;break}case 3:{a=2;break}case 2:{a=6;break}case 6:{a=4;break}case 4:{a=5;break}case 5:{a=1;break}}return a|0}function pc(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;h=g[a>>2]|0,T=a+4|0,A=g[T>>2]|0,S=a+8|0,p=g[S>>2]|0,y=A+(h<<1)|0,g[a>>2]=y,A=p+(A<<1)|0,g[T>>2]=A,h=(p<<1)+h|0,g[S>>2]=h,p=A-y|0,(y|0)<0?(h=h-y|0,g[T>>2]=p,g[S>>2]=h,g[a>>2]=0,A=p,p=0):p=y,(A|0)<0&&(p=p-A|0,g[a>>2]=p,h=h-A|0,g[S>>2]=h,g[T>>2]=0,A=0),b=p-h|0,y=A-h|0,(h|0)<0?(g[a>>2]=b,g[T>>2]=y,g[S>>2]=0,p=b,h=0):y=A,A=(y|0)<(p|0)?y:p,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(g[a>>2]=p-A,g[T>>2]=y-A,g[S>>2]=h-A)}function gc(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;y=g[a>>2]|0,T=a+4|0,h=g[T>>2]|0,S=a+8|0,A=g[S>>2]|0,p=(h<<1)+y|0,y=A+(y<<1)|0,g[a>>2]=y,g[T>>2]=p,h=(A<<1)+h|0,g[S>>2]=h,A=p-y|0,(y|0)<0?(h=h-y|0,g[T>>2]=A,g[S>>2]=h,g[a>>2]=0,y=0):A=p,(A|0)<0&&(y=y-A|0,g[a>>2]=y,h=h-A|0,g[S>>2]=h,g[T>>2]=0,A=0),b=y-h|0,p=A-h|0,(h|0)<0?(g[a>>2]=b,g[T>>2]=p,g[S>>2]=0,y=b,h=0):p=A,A=(p|0)<(y|0)?p:y,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(g[a>>2]=y-A,g[T>>2]=p-A,g[S>>2]=h-A)}function ml(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0,S=0;return T=(g[a>>2]|0)-(g[h>>2]|0)|0,S=(T|0)<0,p=(g[a+4>>2]|0)-(g[h+4>>2]|0)-(S?T:0)|0,b=(p|0)<0,y=(S?0-T|0:0)+(g[a+8>>2]|0)-(g[h+8>>2]|0)+(b?0-p|0:0)|0,a=(y|0)<0,h=a?0:y,A=(b?0:p)-(a?y:0)|0,y=(S?0:T)-(b?p:0)-(a?y:0)|0,a=(A|0)<(y|0)?A:y,a=(h|0)<(a|0)?h:a,p=(a|0)>0,h=h-(p?a:0)|0,A=A-(p?a:0)|0,a=y-(p?a:0)|0,a=(a|0)>-1?a:0-a|0,A=(A|0)>-1?A:0-A|0,h=(h|0)>-1?h:0-h|0,h=(A|0)>(h|0)?A:h,((a|0)>(h|0)?a:h)|0}function Oh(a,h){a=a|0,h=h|0;var A=0;A=g[a+8>>2]|0,g[h>>2]=(g[a>>2]|0)-A,g[h+4>>2]=(g[a+4>>2]|0)-A}function yl(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0,S=0;p=g[a>>2]|0,g[h>>2]=p,y=g[a+4>>2]|0,T=h+4|0,g[T>>2]=y,S=h+8|0,g[S>>2]=0,A=(y|0)<(p|0),a=A?p:y,A=A?y:p;do if((A|0)<0){if((a|0)>0){if((a|-2147483648|0)<(A|0)&((A|0)!=-2147483648&(2147483647-a|0)>=(A|0)))break;return a=1,a|0}if((A|0)==-2147483648|(-2147483648-a|0)>(A|0))return h=1,h|0;if((a|0)>-1){if((a|-2147483648|0)<(A|0))break;return a=1,a|0}else{if((a^-2147483648|0)<(A|0))a=1;else break;return a|0}}while(0);return a=y-p|0,(p|0)<0?(A=0-p|0,g[T>>2]=a,g[S>>2]=A,g[h>>2]=0,p=0):(a=y,A=0),(a|0)<0&&(p=p-a|0,g[h>>2]=p,A=A-a|0,g[S>>2]=A,g[T>>2]=0,a=0),b=p-A|0,y=a-A|0,(A|0)<0?(g[h>>2]=b,g[T>>2]=y,g[S>>2]=0,a=y,y=b,A=0):y=p,p=(a|0)<(y|0)?a:y,p=(A|0)<(p|0)?A:p,(p|0)<=0?(h=0,h|0):(g[h>>2]=y-p,g[T>>2]=a-p,g[S>>2]=A-p,h=0,h|0)}function Ko(a){a=a|0;var h=0,A=0,p=0,y=0;h=a+8|0,y=g[h>>2]|0,A=y-(g[a>>2]|0)|0,g[a>>2]=A,p=a+4|0,a=(g[p>>2]|0)-y|0,g[p>>2]=a,g[h>>2]=0-(a+A)}function bl(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;A=g[a>>2]|0,h=0-A|0,g[a>>2]=h,T=a+8|0,g[T>>2]=0,S=a+4|0,p=g[S>>2]|0,y=p+A|0,(A|0)>0?(g[S>>2]=y,g[T>>2]=A,g[a>>2]=0,h=0,p=y):A=0,(p|0)<0?(b=h-p|0,g[a>>2]=b,A=A-p|0,g[T>>2]=A,g[S>>2]=0,y=b-A|0,h=0-A|0,(A|0)<0?(g[a>>2]=y,g[S>>2]=h,g[T>>2]=0,p=h,A=0):(p=0,y=b)):y=h,h=(p|0)<(y|0)?p:y,h=(A|0)<(h|0)?A:h,!((h|0)<=0)&&(g[a>>2]=y-h,g[S>>2]=p-h,g[T>>2]=A-h)}function vl(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0,F=0,U=0,H=0;if(H=re,re=re+64|0,U=H,S=H+56|0,!(!0&(h&2013265920|0)==134217728&(!0&(p&2013265920|0)==134217728)))return y=5,re=H,y|0;if((a|0)==(A|0)&(h|0)==(p|0))return g[y>>2]=0,y=0,re=H,y|0;if(T=it(a|0,h|0,52)|0,le()|0,T=T&15,F=it(A|0,p|0,52)|0,le()|0,(T|0)!=(F&15|0))return y=12,re=H,y|0;if(b=T+-1|0,T>>>0>1){wo(a,h,b,U)|0,wo(A,p,b,S)|0,F=U,k=g[F>>2]|0,F=g[F+4>>2]|0;e:do if((k|0)==(g[S>>2]|0)&&(F|0)==(g[S+4>>2]|0)){T=(T^15)*3|0,b=it(a|0,h|0,T|0)|0,le()|0,b=b&7,T=it(A|0,p|0,T|0)|0,le()|0,T=T&7;do if((b|0)==0|(T|0)==0)g[y>>2]=1,b=0;else if((b|0)==7)b=5;else{if((b|0)==1|(T|0)==1&&Ci(k,F)|0){b=5;break}if((g[15536+(b<<2)>>2]|0)!=(T|0)&&(g[15568+(b<<2)>>2]|0)!=(T|0))break e;g[y>>2]=1,b=0}while(0);return y=b,re=H,y|0}while(0)}b=U,T=b+56|0;do g[b>>2]=0,b=b+4|0;while((b|0)<(T|0));return fo(a,h,1,U)|0,h=U,!((g[h>>2]|0)==(A|0)&&(g[h+4>>2]|0)==(p|0))&&(h=U+8|0,!((g[h>>2]|0)==(A|0)&&(g[h+4>>2]|0)==(p|0)))&&(h=U+16|0,!((g[h>>2]|0)==(A|0)&&(g[h+4>>2]|0)==(p|0)))&&(h=U+24|0,!((g[h>>2]|0)==(A|0)&&(g[h+4>>2]|0)==(p|0)))&&(h=U+32|0,!((g[h>>2]|0)==(A|0)&&(g[h+4>>2]|0)==(p|0)))&&(h=U+40|0,!((g[h>>2]|0)==(A|0)&&(g[h+4>>2]|0)==(p|0)))?(b=U+48|0,b=((g[b>>2]|0)==(A|0)?(g[b+4>>2]|0)==(p|0):0)&1):b=1,g[y>>2]=b,y=0,re=H,y|0}function yo(a,h,A,p,y){return a=a|0,h=h|0,A=A|0,p=p|0,y=y|0,A=Ve(a,h,A,p)|0,(A|0)==7?(y=11,y|0):(p=Ge(A|0,0,56)|0,h=h&-2130706433|(le()|0)|268435456,g[y>>2]=a|p,g[y+4>>2]=h,y=0,y|0)}function _c(a,h,A){return a=a|0,h=h|0,A=A|0,!0&(h&2013265920|0)==268435456?(g[A>>2]=a,g[A+4>>2]=h&-2130706433|134217728,A=0,A|0):(A=6,A|0)}function mc(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0;return y=re,re=re+16|0,p=y,g[p>>2]=0,!0&(h&2013265920|0)==268435456?(b=it(a|0,h|0,56)|0,le()|0,p=we(a,h&-2130706433|134217728,b&7,p,A)|0,re=y,p|0):(p=6,re=y,p|0)}function xl(a,h){a=a|0,h=h|0;var A=0;switch(A=it(a|0,h|0,56)|0,le()|0,A&7){case 0:case 7:return A=0,A|0}return A=h&-2130706433|134217728,!(!0&(h&2013265920|0)==268435456)||!0&(h&117440512|0)==16777216&(Ci(a,A)|0)!=0?(A=0,A|0):(A=xo(a,A)|0,A|0)}function Qn(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0;return y=re,re=re+16|0,p=y,!0&(h&2013265920|0)==268435456?(b=h&-2130706433|134217728,T=A,g[T>>2]=a,g[T+4>>2]=b,g[p>>2]=0,h=it(a|0,h|0,56)|0,le()|0,p=we(a,b,h&7,p,A+8|0)|0,re=y,p|0):(p=6,re=y,p|0)}function yc(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0;return y=(Ci(a,h)|0)==0,h=h&-2130706433,p=A,g[p>>2]=y?a:0,g[p+4>>2]=y?h|285212672:0,p=A+8|0,g[p>>2]=a,g[p+4>>2]=h|301989888,p=A+16|0,g[p>>2]=a,g[p+4>>2]=h|318767104,p=A+24|0,g[p>>2]=a,g[p+4>>2]=h|335544320,p=A+32|0,g[p>>2]=a,g[p+4>>2]=h|352321536,A=A+40|0,g[A>>2]=a,g[A+4>>2]=h|369098752,0}function Us(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0;return T=re,re=re+16|0,y=T,b=h&-2130706433|134217728,!0&(h&2013265920|0)==268435456?(p=it(a|0,h|0,56)|0,le()|0,p=zi(a,b,p&7)|0,(p|0)==-1?(g[A>>2]=0,b=6,re=T,b|0):(Mi(a,b,y)|0&&Pt(23313,22484,282,22499),h=it(a|0,h|0,52)|0,le()|0,h=h&15,Ci(a,b)|0?Tl(y,h,p,2,A):Bi(y,h,p,2,A),b=0,re=T,b|0)):(b=6,re=T,b|0)}function bo(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0;p=re,re=re+16|0,y=p,bc(a,h,A,y),Ai(y,A+4|0),re=p}function bc(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0;if(S=re,re=re+16|0,k=S,wl(a,A,k),b=+Tr(+(1-+K[k>>3]*.5)),b<1e-16){g[p>>2]=0,g[p+4>>2]=0,g[p+8>>2]=0,g[p+12>>2]=0,re=S;return}if(k=g[A>>2]|0,y=+K[15920+(k*24|0)>>3],y=+Io(y-+Io(+os(15600+(k<<4)|0,a))),Wr(h)|0?T=+Io(y+-.3334731722518321):T=y,y=+wi(+b)/.381966011250105,(h|0)>0){a=0;do y=y*2.6457513110645907,a=a+1|0;while((a|0)!=(h|0))}b=+Lt(+T)*y,K[p>>3]=b,T=+Rt(+T)*y,K[p+8>>3]=T,re=S}function wl(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0;if(b=re,re=re+32|0,y=b,ls(a,y),g[h>>2]=0,K[A>>3]=5,p=+ir(16400,y),p<+K[A>>3]&&(g[h>>2]=0,K[A>>3]=p),p=+ir(16424,y),p<+K[A>>3]&&(g[h>>2]=1,K[A>>3]=p),p=+ir(16448,y),p<+K[A>>3]&&(g[h>>2]=2,K[A>>3]=p),p=+ir(16472,y),p<+K[A>>3]&&(g[h>>2]=3,K[A>>3]=p),p=+ir(16496,y),p<+K[A>>3]&&(g[h>>2]=4,K[A>>3]=p),p=+ir(16520,y),p<+K[A>>3]&&(g[h>>2]=5,K[A>>3]=p),p=+ir(16544,y),p<+K[A>>3]&&(g[h>>2]=6,K[A>>3]=p),p=+ir(16568,y),p<+K[A>>3]&&(g[h>>2]=7,K[A>>3]=p),p=+ir(16592,y),p<+K[A>>3]&&(g[h>>2]=8,K[A>>3]=p),p=+ir(16616,y),p<+K[A>>3]&&(g[h>>2]=9,K[A>>3]=p),p=+ir(16640,y),p<+K[A>>3]&&(g[h>>2]=10,K[A>>3]=p),p=+ir(16664,y),p<+K[A>>3]&&(g[h>>2]=11,K[A>>3]=p),p=+ir(16688,y),p<+K[A>>3]&&(g[h>>2]=12,K[A>>3]=p),p=+ir(16712,y),p<+K[A>>3]&&(g[h>>2]=13,K[A>>3]=p),p=+ir(16736,y),p<+K[A>>3]&&(g[h>>2]=14,K[A>>3]=p),p=+ir(16760,y),p<+K[A>>3]&&(g[h>>2]=15,K[A>>3]=p),p=+ir(16784,y),p<+K[A>>3]&&(g[h>>2]=16,K[A>>3]=p),p=+ir(16808,y),p<+K[A>>3]&&(g[h>>2]=17,K[A>>3]=p),p=+ir(16832,y),p<+K[A>>3]&&(g[h>>2]=18,K[A>>3]=p),p=+ir(16856,y),!(p<+K[A>>3])){re=b;return}g[h>>2]=19,K[A>>3]=p,re=b}function di(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0;if(b=+Ll(a),b<1e-16){h=15600+(h<<4)|0,g[y>>2]=g[h>>2],g[y+4>>2]=g[h+4>>2],g[y+8>>2]=g[h+8>>2],g[y+12>>2]=g[h+12>>2];return}if(T=+Vi(+ +K[a+8>>3],+ +K[a>>3]),(A|0)>0){a=0;do b=b/2.6457513110645907,a=a+1|0;while((a|0)!=(A|0))}p?(b=b/3,A=(Wr(A)|0)==0,b=+tr(+((A?b:b/2.6457513110645907)*.381966011250105))):(b=+tr(+(b*.381966011250105)),Wr(A)|0&&(T=+Io(T+.3334731722518321))),oa(15600+(h<<4)|0,+Io(+K[15920+(h*24|0)>>3]-T),b,y)}function ji(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0;p=re,re=re+16|0,y=p,dr(a+4|0,y),di(y,g[a>>2]|0,h,0,A),re=p}function Tl(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0,be=0,ve=0,Ye=0,je=0,He=0,$e=0,zt=0,vt=0,mt=0,pt=0,Mt=0,St=0,ti=0,kt=0;if(St=re,re=re+272|0,b=St+256|0,de=St+240|0,mt=St,pt=St+224|0,Mt=St+208|0,be=St+176|0,ve=St+160|0,Ye=St+192|0,je=St+144|0,He=St+128|0,$e=St+112|0,zt=St+96|0,vt=St+80|0,g[b>>2]=h,g[de>>2]=g[a>>2],g[de+4>>2]=g[a+4>>2],g[de+8>>2]=g[a+8>>2],g[de+12>>2]=g[a+12>>2],li(de,b,mt),g[y>>2]=0,de=p+A+((p|0)==5&1)|0,(de|0)<=(A|0)){re=St;return}k=g[b>>2]|0,F=pt+4|0,U=be+4|0,H=A+5|0,W=16880+(k<<2)|0,Y=16960+(k<<2)|0,G=He+8|0,se=$e+8|0,me=zt+8|0,Te=Mt+4|0,S=A;e:for(;;){T=mt+(((S|0)%5|0)<<4)|0,g[Mt>>2]=g[T>>2],g[Mt+4>>2]=g[T+4>>2],g[Mt+8>>2]=g[T+8>>2],g[Mt+12>>2]=g[T+12>>2];do;while((Es(Mt,k,0,1)|0)==2);if((S|0)>(A|0)&(Wr(h)|0)!=0){if(g[be>>2]=g[Mt>>2],g[be+4>>2]=g[Mt+4>>2],g[be+8>>2]=g[Mt+8>>2],g[be+12>>2]=g[Mt+12>>2],dr(F,ve),p=g[be>>2]|0,b=g[17040+(p*80|0)+(g[pt>>2]<<2)>>2]|0,g[be>>2]=g[18640+(p*80|0)+(b*20|0)>>2],T=g[18640+(p*80|0)+(b*20|0)+16>>2]|0,(T|0)>0){a=0;do _l(U),a=a+1|0;while((a|0)<(T|0))}switch(T=18640+(p*80|0)+(b*20|0)+4|0,g[Ye>>2]=g[T>>2],g[Ye+4>>2]=g[T+4>>2],g[Ye+8>>2]=g[T+8>>2],Qo(Ye,(g[W>>2]|0)*3|0),Di(U,Ye,U),fr(U),dr(U,je),ti=+(g[Y>>2]|0),K[He>>3]=ti*3,K[G>>3]=0,kt=ti*-1.5,K[$e>>3]=kt,K[se>>3]=ti*2.598076211353316,K[zt>>3]=kt,K[me>>3]=ti*-2.598076211353316,g[17040+((g[be>>2]|0)*80|0)+(g[Mt>>2]<<2)>>2]|0){case 1:{a=$e,p=He;break}case 3:{a=zt,p=$e;break}case 2:{a=He,p=zt;break}default:{a=12;break e}}Ro(ve,je,p,a,vt),di(vt,g[be>>2]|0,k,1,y+8+(g[y>>2]<<4)|0),g[y>>2]=(g[y>>2]|0)+1}if((S|0)<(H|0)&&(dr(Te,be),di(be,g[Mt>>2]|0,k,1,y+8+(g[y>>2]<<4)|0),g[y>>2]=(g[y>>2]|0)+1),g[pt>>2]=g[Mt>>2],g[pt+4>>2]=g[Mt+4>>2],g[pt+8>>2]=g[Mt+8>>2],g[pt+12>>2]=g[Mt+12>>2],S=S+1|0,(S|0)>=(de|0)){a=3;break}}if((a|0)==3){re=St;return}else(a|0)==12&&Pt(22522,22569,571,22579)}function li(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0;k=re,re=re+128|0,p=k+64|0,y=k,b=p,T=20240,S=b+60|0;do g[b>>2]=g[T>>2],b=b+4|0,T=T+4|0;while((b|0)<(S|0));b=y,T=20304,S=b+60|0;do g[b>>2]=g[T>>2],b=b+4|0,T=T+4|0;while((b|0)<(S|0));S=(Wr(g[h>>2]|0)|0)==0,p=S?p:y,y=a+4|0,pc(y),gc(y),Wr(g[h>>2]|0)|0&&(sn(y),g[h>>2]=(g[h>>2]|0)+1),g[A>>2]=g[a>>2],h=A+4|0,Di(y,p,h),fr(h),g[A+16>>2]=g[a>>2],h=A+20|0,Di(y,p+12|0,h),fr(h),g[A+32>>2]=g[a>>2],h=A+36|0,Di(y,p+24|0,h),fr(h),g[A+48>>2]=g[a>>2],h=A+52|0,Di(y,p+36|0,h),fr(h),g[A+64>>2]=g[a>>2],A=A+68|0,Di(y,p+48|0,A),fr(A),re=k}function Es(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0;if(G=re,re=re+32|0,W=G+12|0,S=G,Y=a+4|0,H=g[16960+(h<<2)>>2]|0,U=(p|0)!=0,H=U?H*3|0:H,y=g[Y>>2]|0,F=a+8|0,T=g[F>>2]|0,U){if(b=a+12|0,p=g[b>>2]|0,y=T+y+p|0,(y|0)==(H|0))return Y=1,re=G,Y|0;k=b}else k=a+12|0,p=g[k>>2]|0,y=T+y+p|0;if((y|0)<=(H|0))return Y=0,re=G,Y|0;do if((p|0)>0){if(p=g[a>>2]|0,(T|0)>0){b=18640+(p*80|0)+60|0,p=a;break}p=18640+(p*80|0)+40|0,A?(Rn(W,H,0,0),Go(Y,W,S),fn(S),Di(S,W,Y),b=p,p=a):(b=p,p=a)}else b=18640+((g[a>>2]|0)*80|0)+20|0,p=a;while(0);if(g[p>>2]=g[b>>2],y=b+16|0,(g[y>>2]|0)>0){p=0;do _l(Y),p=p+1|0;while((p|0)<(g[y>>2]|0))}return a=b+4|0,g[W>>2]=g[a>>2],g[W+4>>2]=g[a+4>>2],g[W+8>>2]=g[a+8>>2],h=g[16880+(h<<2)>>2]|0,Qo(W,U?h*3|0:h),Di(Y,W,Y),fr(Y),U?p=((g[F>>2]|0)+(g[Y>>2]|0)+(g[k>>2]|0)|0)==(H|0)?1:2:p=2,Y=p,re=G,Y|0}function $i(a,h){a=a|0,h=h|0;var A=0;do A=Es(a,h,0,1)|0;while((A|0)==2);return A|0}function Bi(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0,be=0,ve=0,Ye=0,je=0,He=0,$e=0,zt=0,vt=0,mt=0;if(zt=re,re=re+240|0,b=zt+224|0,Ye=zt+208|0,je=zt,He=zt+192|0,$e=zt+176|0,me=zt+160|0,Te=zt+144|0,de=zt+128|0,be=zt+112|0,ve=zt+96|0,g[b>>2]=h,g[Ye>>2]=g[a>>2],g[Ye+4>>2]=g[a+4>>2],g[Ye+8>>2]=g[a+8>>2],g[Ye+12>>2]=g[a+12>>2],vo(Ye,b,je),g[y>>2]=0,se=p+A+((p|0)==6&1)|0,(se|0)<=(A|0)){re=zt;return}k=g[b>>2]|0,F=A+6|0,U=16960+(k<<2)|0,H=Te+8|0,W=de+8|0,Y=be+8|0,G=He+4|0,T=0,S=A,p=-1;e:for(;;){if(b=(S|0)%6|0,a=je+(b<<4)|0,g[He>>2]=g[a>>2],g[He+4>>2]=g[a+4>>2],g[He+8>>2]=g[a+8>>2],g[He+12>>2]=g[a+12>>2],a=T,T=Es(He,k,0,1)|0,(S|0)>(A|0)&(Wr(h)|0)!=0&&(a|0)!=1&&(g[He>>2]|0)!=(p|0)){switch(dr(je+(((b+5|0)%6|0)<<4)+4|0,$e),dr(je+(b<<4)+4|0,me),vt=+(g[U>>2]|0),K[Te>>3]=vt*3,K[H>>3]=0,mt=vt*-1.5,K[de>>3]=mt,K[W>>3]=vt*2.598076211353316,K[be>>3]=mt,K[Y>>3]=vt*-2.598076211353316,b=g[Ye>>2]|0,g[17040+(b*80|0)+(((p|0)==(b|0)?g[He>>2]|0:p)<<2)>>2]|0){case 1:{a=de,p=Te;break}case 3:{a=be,p=de;break}case 2:{a=Te,p=be;break}default:{a=8;break e}}Ro($e,me,p,a,ve),!(ja($e,ve)|0)&&!(ja(me,ve)|0)&&(di(ve,g[Ye>>2]|0,k,1,y+8+(g[y>>2]<<4)|0),g[y>>2]=(g[y>>2]|0)+1)}if((S|0)<(F|0)&&(dr(G,$e),di($e,g[He>>2]|0,k,1,y+8+(g[y>>2]<<4)|0),g[y>>2]=(g[y>>2]|0)+1),S=S+1|0,(S|0)>=(se|0)){a=3;break}else p=g[He>>2]|0}if((a|0)==3){re=zt;return}else(a|0)==8&&Pt(22606,22569,736,22651)}function vo(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0;k=re,re=re+160|0,p=k+80|0,y=k,b=p,T=20368,S=b+72|0;do g[b>>2]=g[T>>2],b=b+4|0,T=T+4|0;while((b|0)<(S|0));b=y,T=20448,S=b+72|0;do g[b>>2]=g[T>>2],b=b+4|0,T=T+4|0;while((b|0)<(S|0));S=(Wr(g[h>>2]|0)|0)==0,p=S?p:y,y=a+4|0,pc(y),gc(y),Wr(g[h>>2]|0)|0&&(sn(y),g[h>>2]=(g[h>>2]|0)+1),g[A>>2]=g[a>>2],h=A+4|0,Di(y,p,h),fr(h),g[A+16>>2]=g[a>>2],h=A+20|0,Di(y,p+12|0,h),fr(h),g[A+32>>2]=g[a>>2],h=A+36|0,Di(y,p+24|0,h),fr(h),g[A+48>>2]=g[a>>2],h=A+52|0,Di(y,p+36|0,h),fr(h),g[A+64>>2]=g[a>>2],h=A+68|0,Di(y,p+48|0,h),fr(h),g[A+80>>2]=g[a>>2],A=A+84|0,Di(y,p+60|0,A),fr(A),re=k}function vc(a,h){return a=a|0,h=h|0,h=it(a|0,h|0,52)|0,le()|0,h&15|0}function Ba(a,h){return a=a|0,h=h|0,h=it(a|0,h|0,45)|0,le()|0,h&127|0}function xo(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0,S=0;if(!(!0&(h&-16777216|0)==134217728)||(T=it(a|0,h|0,45)|0,le()|0,T=T&127,T>>>0>121))return h=0,h|0;A=it(a|0,h|0,52)|0,le()|0,A=A&15;do if(A|0){for(y=1,p=0;;){if(b=it(a|0,h|0,(15-y|0)*3|0)|0,le()|0,b=b&7,(b|0)!=0&(p^1))if((b|0)==1&(ui(T)|0)!=0){S=0,p=13;break}else p=1;if((b|0)==7){S=0,p=13;break}if(y>>>0<A>>>0)y=y+1|0;else{p=9;break}}if((p|0)==9){if((A|0)==15)S=1;else break;return S|0}else if((p|0)==13)return S|0}while(0);for(;;){if(S=it(a|0,h|0,(14-A|0)*3|0)|0,le()|0,!((S&7|0)==7&!0)){S=0,p=13;break}if(A>>>0<14)A=A+1|0;else{S=1,p=13;break}}return(p|0)==13?S|0:0}function wo(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0;if(b=it(a|0,h|0,52)|0,le()|0,b=b&15,A>>>0>15)return p=4,p|0;if((b|0)<(A|0))return p=12,p|0;if((b|0)==(A|0))return g[p>>2]=a,g[p+4>>2]=h,p=0,p|0;if(y=Ge(A|0,0,52)|0,y=y|a,a=le()|0|h&-15728641,(b|0)>(A|0))do h=Ge(7,0,(14-A|0)*3|0)|0,A=A+1|0,y=h|y,a=le()|0|a;while((A|0)<(b|0));return g[p>>2]=y,g[p+4>>2]=a,p=0,p|0}function To(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0;if(b=it(a|0,h|0,52)|0,le()|0,b=b&15,!((A|0)<16&(b|0)<=(A|0)))return p=4,p|0;y=A-b|0,A=it(a|0,h|0,45)|0,le()|0;e:do if(!(ui(A&127)|0))A=Dn(7,0,y,((y|0)<0)<<31>>31)|0,y=le()|0;else{t:do if(b|0){for(A=1;T=Ge(7,0,(15-A|0)*3|0)|0,!!((T&a|0)==0&((le()|0)&h|0)==0);)if(A>>>0<b>>>0)A=A+1|0;else break t;A=Dn(7,0,y,((y|0)<0)<<31>>31)|0,y=le()|0;break e}while(0);A=Dn(7,0,y,((y|0)<0)<<31>>31)|0,A=br(A|0,le()|0,5,0)|0,A=Nt(A|0,le()|0,-5,-1)|0,A=$s(A|0,le()|0,6,0)|0,A=Nt(A|0,le()|0,1,0)|0,y=le()|0}while(0);return T=p,g[T>>2]=A,g[T+4>>2]=y,T=0,T|0}function Ci(a,h){a=a|0,h=h|0;var A=0,p=0,y=0;if(y=it(a|0,h|0,45)|0,le()|0,!(ui(y&127)|0))return y=0,y|0;y=it(a|0,h|0,52)|0,le()|0,y=y&15;e:do if(!y)A=0;else for(p=1;;){if(A=it(a|0,h|0,(15-p|0)*3|0)|0,le()|0,A=A&7,A|0)break e;if(p>>>0<y>>>0)p=p+1|0;else{A=0;break}}while(0);return y=(A|0)==0&1,y|0}function El(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0;if(T=re,re=re+16|0,b=T,Cl(b,a,h,A),h=b,a=g[h>>2]|0,h=g[h+4>>2]|0,(a|0)==0&(h|0)==0)return re=T,0;y=0,A=0;do S=p+(y<<3)|0,g[S>>2]=a,g[S+4>>2]=h,y=Nt(y|0,A|0,1,0)|0,A=le()|0,Pl(b),S=b,a=g[S>>2]|0,h=g[S+4>>2]|0;while(!((a|0)==0&(h|0)==0));return re=T,0}function Jo(a,h,A,p){return a=a|0,h=h|0,A=A|0,p=p|0,(p|0)<(A|0)?(A=h,p=a,Wt(A|0),p|0):(A=Ge(-1,-1,((p-A|0)*3|0)+3|0)|0,p=Ge(~A|0,~(le()|0)|0,(15-p|0)*3|0)|0,A=~(le()|0)&h,p=~p&a,Wt(A|0),p|0)}function ea(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0;return y=it(a|0,h|0,52)|0,le()|0,y=y&15,(A|0)<16&(y|0)<=(A|0)?((y|0)<(A|0)&&(y=Ge(-1,-1,((A+-1-y|0)*3|0)+3|0)|0,y=Ge(~y|0,~(le()|0)|0,(15-A|0)*3|0)|0,h=~(le()|0)&h,a=~y&a),y=Ge(A|0,0,52)|0,A=h&-15728641|(le()|0),g[p>>2]=a|y,g[p+4>>2]=A,p=0,p|0):(p=4,p|0)}function ta(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0,be=0,ve=0,Ye=0,je=0,He=0,$e=0;if((A|0)==0&(p|0)==0)return He=0,He|0;if(y=a,b=g[y>>2]|0,y=g[y+4>>2]|0,!0&(y&15728640|0)==0){if(!((p|0)>0|(p|0)==0&A>>>0>0)||(He=h,g[He>>2]=b,g[He+4>>2]=y,(A|0)==1&(p|0)==0))return He=0,He|0;y=1;do Ye=a+(y<<3)|0,je=g[Ye+4>>2]|0,He=h+(y<<3)|0,g[He>>2]=g[Ye>>2],g[He+4>>2]=je,y=y+1|0;while(0<(p|0)|(p|0)==0&y>>>0<A>>>0);return y=0,y|0}if(ve=A<<3,je=sr(ve)|0,!je)return He=13,He|0;if(v(je|0,a|0,ve|0)|0,Ye=Or(A,8)|0,!Ye)return Kt(je),He=13,He|0;e:do if(A|0){t:for(;;){y=je,Te=g[y>>2]|0,y=g[y+4>>2]|0,de=it(Te|0,y|0,52)|0,le()|0,de=de&15,be=de+-1|0,me=(A|0)>0;i:do if((de|0)!=0&me){if(Y=((A|0)<0)<<31>>31,G=Ge(be|0,0,52)|0,se=le()|0,be>>>0>15){if(!((Te|0)==0&(y|0)==0)){He=17;break t}for(b=0;;){if(b=b+1|0,(b|0)>=(A|0))break i;if(p=je+(b<<3)|0,se=g[p>>2]|0,p=g[p+4>>2]|0,!((se|0)==0&(p|0)==0)){y=p,He=17;break t}}}for(b=0,a=Te,p=y;;){if(!((a|0)==0&(p|0)==0)){if(!(!0&(p&117440512|0)==0)){He=22;break t}if(S=it(a|0,p|0,52)|0,le()|0,S=S&15,(S|0)<(be|0)){y=12,He=28;break t}if((S|0)!=(be|0)&&(a=a|G,p=p&-15728641|se,S>>>0>=de>>>0)){T=be;do W=Ge(7,0,(14-T|0)*3|0)|0,T=T+1|0,a=W|a,p=le()|0|p;while(T>>>0<S>>>0)}if(T=Ws(a|0,p|0,A|0,Y|0)|0,le()|0,F=Ye+(T<<3)|0,S=F,k=g[S>>2]|0,S=g[S+4>>2]|0,(k|0)==0&(S|0)==0)T=F;else for(W=0;;){if((W|0)>(A|0)){He=32;break t}if((k|0)==(a|0)&(S&-117440513|0)==(p|0)){U=it(k|0,S|0,56)|0,le()|0,U=U&7,H=U+1|0,$e=it(k|0,S|0,45)|0,le()|0;r:do if(!(ui($e&127)|0))S=7;else{if(k=it(k|0,S|0,52)|0,le()|0,k=k&15,!k){S=6;break}for(S=1;;){if($e=Ge(7,0,(15-S|0)*3|0)|0,!(($e&a|0)==0&((le()|0)&p|0)==0)){S=7;break r}if(S>>>0<k>>>0)S=S+1|0;else{S=6;break}}}while(0);if((U+2|0)>>>0>S>>>0){He=42;break t}$e=Ge(H|0,0,56)|0,p=le()|0|p&-117440513,H=F,g[H>>2]=0,g[H+4>>2]=0,a=$e|a}else T=(T+1|0)%(A|0)|0;if(F=Ye+(T<<3)|0,S=F,k=g[S>>2]|0,S=g[S+4>>2]|0,(k|0)==0&(S|0)==0){T=F;break}else W=W+1|0}$e=T,g[$e>>2]=a,g[$e+4>>2]=p}if(b=b+1|0,(b|0)>=(A|0))break i;p=je+(b<<3)|0,a=g[p>>2]|0,p=g[p+4>>2]|0}}while(0);if((A+5|0)>>>0<11){He=85;break}if(se=Or((A|0)/6|0,8)|0,!se){He=49;break}i:do if(me){W=0,H=0;do{if(S=Ye+(W<<3)|0,p=S,b=g[p>>2]|0,p=g[p+4>>2]|0,!((b|0)==0&(p|0)==0)){k=it(b|0,p|0,56)|0,le()|0,k=k&7,a=k+1|0,F=p&-117440513,$e=it(b|0,p|0,45)|0,le()|0;r:do if(ui($e&127)|0){if(U=it(b|0,p|0,52)|0,le()|0,U=U&15,U|0)for(T=1;;){if($e=Ge(7,0,(15-T|0)*3|0)|0,!((b&$e|0)==0&(F&(le()|0)|0)==0))break r;if(T>>>0<U>>>0)T=T+1|0;else break}p=Ge(a|0,0,56)|0,b=p|b,p=le()|0|F,a=S,g[a>>2]=b,g[a+4>>2]=p,a=k+2|0}while(0);(a|0)==7&&($e=se+(H<<3)|0,g[$e>>2]=b,g[$e+4>>2]=p&-117440513,H=H+1|0)}W=W+1|0}while((W|0)!=(A|0));if(me){if(W=((A|0)<0)<<31>>31,Y=Ge(be|0,0,52)|0,G=le()|0,be>>>0>15){if(!((Te|0)==0&(y|0)==0)){y=4,He=84;break t}for(y=0;;){if(y=y+1|0,(y|0)>=(A|0)){b=0,y=H;break i}if($e=je+(y<<3)|0,!((g[$e>>2]|0)==0&(g[$e+4>>2]|0)==0)){y=4,He=84;break t}}}for(U=0,b=0,F=Te;;){do if(!((F|0)==0&(y|0)==0)){if(S=it(F|0,y|0,52)|0,le()|0,S=S&15,(S|0)<(be|0)){y=12,He=84;break t}do if((S|0)==(be|0))p=F,S=y;else{if(p=F|Y,a=y&-15728641|G,S>>>0<de>>>0){S=a;break}T=be;do $e=Ge(7,0,(14-T|0)*3|0)|0,T=T+1|0,p=$e|p,a=le()|0|a;while(T>>>0<S>>>0);S=a}while(0);for(T=Ws(p|0,S|0,A|0,W|0)|0,le()|0,a=0;;){if((a|0)>(A|0)){He=77;break t}if($e=Ye+(T<<3)|0,k=g[$e+4>>2]|0,(k&-117440513|0)==(S|0)&&(g[$e>>2]|0)==(p|0)){He=79;break}if(T=(T+1|0)%(A|0)|0,$e=Ye+(T<<3)|0,(g[$e>>2]|0)==(p|0)&&(g[$e+4>>2]|0)==(S|0))break;a=a+1|0}if((He|0)==79&&(He=0,!0&(k&117440512|0)==100663296))break;$e=h+(b<<3)|0,g[$e>>2]=F,g[$e+4>>2]=y,b=b+1|0}while(0);if(y=U+1|0,(y|0)>=(A|0)){y=H;break i}$e=je+(y<<3)|0,U=y,F=g[$e>>2]|0,y=g[$e+4>>2]|0}}else b=0,y=H}else b=0,y=0;while(0);if(w(Ye|0,0,ve|0)|0,v(je|0,se|0,y<<3|0)|0,Kt(se),y)h=h+(b<<3)|0,A=y;else break e}if((He|0)==17)!0&(y&117440512|0)==0?(y=4,He=28):He=22;else if((He|0)==32)Pt(23313,22674,362,22684);else{if((He|0)==42)return Kt(je),Kt(Ye),$e=10,$e|0;if((He|0)==49)return Kt(je),Kt(Ye),$e=13,$e|0;if((He|0)==77)Pt(23313,22674,462,22684);else{if((He|0)==84)return Kt(se),Kt(je),Kt(Ye),$e=y,$e|0;if((He|0)==85){v(h|0,je|0,A<<3|0)|0;break}}}if((He|0)==22)return Kt(je),Kt(Ye),$e=5,$e|0;if((He|0)==28)return Kt(je),Kt(Ye),$e=y,$e|0}while(0);return Kt(je),Kt(Ye),$e=0,$e|0}function Lh(a,h,A,p,y,b,T){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0,b=b|0,T=T|0;var S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0;if(se=re,re=re+16|0,G=se,!((A|0)>0|(A|0)==0&h>>>0>0))return G=0,re=se,G|0;if((T|0)>=16)return G=12,re=se,G|0;W=0,Y=0,H=0,S=0;e:for(;;){if(F=a+(W<<3)|0,k=g[F>>2]|0,F=g[F+4>>2]|0,U=it(k|0,F|0,52)|0,le()|0,(U&15|0)>(T|0)){S=12,k=11;break}if(Cl(G,k,F,T),U=G,F=g[U>>2]|0,U=g[U+4>>2]|0,(F|0)==0&(U|0)==0)k=H;else{k=H;do{if(!((S|0)<(b|0)|(S|0)==(b|0)&k>>>0<y>>>0)){k=10;break e}H=p+(k<<3)|0,g[H>>2]=F,g[H+4>>2]=U,k=Nt(k|0,S|0,1,0)|0,S=le()|0,Pl(G),H=G,F=g[H>>2]|0,U=g[H+4>>2]|0}while(!((F|0)==0&(U|0)==0))}if(W=Nt(W|0,Y|0,1,0)|0,Y=le()|0,(Y|0)<(A|0)|(Y|0)==(A|0)&W>>>0<h>>>0)H=k;else{S=0,k=11;break}}return(k|0)==10?(G=14,re=se,G|0):(k|0)==11?(re=se,S|0):0}function Sl(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0;W=re,re=re+16|0,H=W;e:do if((A|0)>0|(A|0)==0&h>>>0>0){for(F=0,T=0,b=0,U=0;;){if(k=a+(F<<3)|0,S=g[k>>2]|0,k=g[k+4>>2]|0,!((S|0)==0&(k|0)==0)&&(k=(To(S,k,p,H)|0)==0,S=H,T=Nt(g[S>>2]|0,g[S+4>>2]|0,T|0,b|0)|0,b=le()|0,!k)){b=12;break}if(F=Nt(F|0,U|0,1,0)|0,U=le()|0,!((U|0)<(A|0)|(U|0)==(A|0)&F>>>0<h>>>0))break e}return re=W,b|0}else T=0,b=0;while(0);return g[y>>2]=T,g[y+4>>2]=b,y=0,re=W,y|0}function Nh(a,h){return a=a|0,h=h|0,h=it(a|0,h|0,52)|0,le()|0,h&1|0}function $r(a,h){a=a|0,h=h|0;var A=0,p=0,y=0;if(y=it(a|0,h|0,52)|0,le()|0,y=y&15,!y)return y=0,y|0;for(p=1;;){if(A=it(a|0,h|0,(15-p|0)*3|0)|0,le()|0,A=A&7,A|0){p=5;break}if(p>>>0<y>>>0)p=p+1|0;else{A=0,p=5;break}}return(p|0)==5?A|0:0}function Eo(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0,S=0,k=0;if(k=it(a|0,h|0,52)|0,le()|0,k=k&15,!k)return S=h,k=a,Wt(S|0),k|0;for(S=1,A=0;;){b=(15-S|0)*3|0,p=Ge(7,0,b|0)|0,y=le()|0,T=it(a|0,h|0,b|0)|0,le()|0,b=Ge(Gn(T&7)|0,0,b|0)|0,T=le()|0,a=b|a&~p,h=T|h&~y;e:do if(!A)if((b&p|0)==0&(T&y|0)==0)A=0;else if(p=it(a|0,h|0,52)|0,le()|0,p=p&15,!p)A=1;else{A=1;t:for(;;){switch(T=it(a|0,h|0,(15-A|0)*3|0)|0,le()|0,T&7){case 1:break t;case 0:break;default:{A=1;break e}}if(A>>>0<p>>>0)A=A+1|0;else{A=1;break e}}for(A=1;;)if(T=(15-A|0)*3|0,y=it(a|0,h|0,T|0)|0,le()|0,b=Ge(7,0,T|0)|0,h=h&~(le()|0),T=Ge(Gn(y&7)|0,0,T|0)|0,a=a&~b|T,h=h|(le()|0),A>>>0<p>>>0)A=A+1|0;else{A=1;break}}while(0);if(S>>>0<k>>>0)S=S+1|0;else break}return Wt(h|0),a|0}function dn(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0;if(p=it(a|0,h|0,52)|0,le()|0,p=p&15,!p)return A=h,p=a,Wt(A|0),p|0;for(A=1;b=(15-A|0)*3|0,T=it(a|0,h|0,b|0)|0,le()|0,y=Ge(7,0,b|0)|0,h=h&~(le()|0),b=Ge(Gn(T&7)|0,0,b|0)|0,a=b|a&~y,h=le()|0|h,A>>>0<p>>>0;)A=A+1|0;return Wt(h|0),a|0}function xc(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0,S=0,k=0;if(k=it(a|0,h|0,52)|0,le()|0,k=k&15,!k)return S=h,k=a,Wt(S|0),k|0;for(S=1,A=0;;){b=(15-S|0)*3|0,p=Ge(7,0,b|0)|0,y=le()|0,T=it(a|0,h|0,b|0)|0,le()|0,b=Ge(kn(T&7)|0,0,b|0)|0,T=le()|0,a=b|a&~p,h=T|h&~y;e:do if(!A)if((b&p|0)==0&(T&y|0)==0)A=0;else if(p=it(a|0,h|0,52)|0,le()|0,p=p&15,!p)A=1;else{A=1;t:for(;;){switch(T=it(a|0,h|0,(15-A|0)*3|0)|0,le()|0,T&7){case 1:break t;case 0:break;default:{A=1;break e}}if(A>>>0<p>>>0)A=A+1|0;else{A=1;break e}}for(A=1;;)if(y=(15-A|0)*3|0,b=Ge(7,0,y|0)|0,T=h&~(le()|0),h=it(a|0,h|0,y|0)|0,le()|0,h=Ge(kn(h&7)|0,0,y|0)|0,a=a&~b|h,h=T|(le()|0),A>>>0<p>>>0)A=A+1|0;else{A=1;break}}while(0);if(S>>>0<k>>>0)S=S+1|0;else break}return Wt(h|0),a|0}function Fa(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0;if(p=it(a|0,h|0,52)|0,le()|0,p=p&15,!p)return A=h,p=a,Wt(A|0),p|0;for(A=1;T=(15-A|0)*3|0,b=Ge(7,0,T|0)|0,y=h&~(le()|0),h=it(a|0,h|0,T|0)|0,le()|0,h=Ge(kn(h&7)|0,0,T|0)|0,a=h|a&~b,h=le()|0|y,A>>>0<p>>>0;)A=A+1|0;return Wt(h|0),a|0}function ia(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0;if(k=re,re=re+64|0,S=k+40|0,p=k+24|0,y=k+12|0,b=k,Ge(h|0,0,52)|0,A=le()|0|134225919,!h)return(g[a+4>>2]|0)>2||(g[a+8>>2]|0)>2||(g[a+12>>2]|0)>2?(T=0,S=0,Wt(T|0),re=k,S|0):(Ge(Xo(a)|0,0,45)|0,T=le()|0|A,S=-1,Wt(T|0),re=k,S|0);if(g[S>>2]=g[a>>2],g[S+4>>2]=g[a+4>>2],g[S+8>>2]=g[a+8>>2],g[S+12>>2]=g[a+12>>2],T=S+4|0,(h|0)>0)for(a=-1;g[p>>2]=g[T>>2],g[p+4>>2]=g[T+4>>2],g[p+8>>2]=g[T+8>>2],h&1?(ka(T),g[y>>2]=g[T>>2],g[y+4>>2]=g[T+4>>2],g[y+8>>2]=g[T+8>>2],mo(y)):(Da(T),g[y>>2]=g[T>>2],g[y+4>>2]=g[T+4>>2],g[y+8>>2]=g[T+8>>2],sn(y)),Go(p,y,b),fr(b),U=(15-h|0)*3|0,F=Ge(7,0,U|0)|0,A=A&~(le()|0),U=Ge(Yn(b)|0,0,U|0)|0,a=U|a&~F,A=le()|0|A,(h|0)>1;)h=h+-1|0;else a=-1;e:do if((g[T>>2]|0)<=2&&(g[S+8>>2]|0)<=2&&(g[S+12>>2]|0)<=2){if(p=Xo(S)|0,h=Ge(p|0,0,45)|0,h=h|a,a=le()|0|A&-1040385,b=fc(S)|0,!(ui(p)|0)){if((b|0)<=0)break;for(y=0;;){if(p=it(h|0,a|0,52)|0,le()|0,p=p&15,p)for(A=1;U=(15-A|0)*3|0,S=it(h|0,a|0,U|0)|0,le()|0,F=Ge(7,0,U|0)|0,a=a&~(le()|0),U=Ge(Gn(S&7)|0,0,U|0)|0,h=h&~F|U,a=a|(le()|0),A>>>0<p>>>0;)A=A+1|0;if(y=y+1|0,(y|0)==(b|0))break e}}y=it(h|0,a|0,52)|0,le()|0,y=y&15;t:do if(y){A=1;i:for(;;){switch(U=it(h|0,a|0,(15-A|0)*3|0)|0,le()|0,U&7){case 1:break i;case 0:break;default:break t}if(A>>>0<y>>>0)A=A+1|0;else break t}if(Ma(p,g[S>>2]|0)|0)for(A=1;S=(15-A|0)*3|0,F=Ge(7,0,S|0)|0,U=a&~(le()|0),a=it(h|0,a|0,S|0)|0,le()|0,a=Ge(kn(a&7)|0,0,S|0)|0,h=h&~F|a,a=U|(le()|0),A>>>0<y>>>0;)A=A+1|0;else for(A=1;U=(15-A|0)*3|0,S=it(h|0,a|0,U|0)|0,le()|0,F=Ge(7,0,U|0)|0,a=a&~(le()|0),U=Ge(Gn(S&7)|0,0,U|0)|0,h=h&~F|U,a=a|(le()|0),A>>>0<y>>>0;)A=A+1|0}while(0);if((b|0)>0){A=0;do h=Eo(h,a)|0,a=le()|0,A=A+1|0;while((A|0)!=(b|0))}}else h=0,a=0;while(0);return F=a,U=h,Wt(F|0),re=k,U|0}function Wr(a){return a=a|0,(a|0)%2|0|0}function ra(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0;return y=re,re=re+16|0,p=y,h>>>0>15?(p=4,re=y,p|0):(g[a+4>>2]&2146435072|0)==2146435072||(g[a+8+4>>2]&2146435072|0)==2146435072?(p=3,re=y,p|0):(bo(a,h,p),h=ia(p,h)|0,p=le()|0,g[A>>2]=h,g[A+4>>2]=p,(h|0)==0&(p|0)==0&&Pt(23313,22674,786,22697),p=0,re=y,p|0)}function Oa(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0;if(y=A+4|0,b=it(a|0,h|0,52)|0,le()|0,b=b&15,T=it(a|0,h|0,45)|0,le()|0,p=(b|0)==0,ui(T&127)|0){if(p)return T=1,T|0;p=1}else{if(p)return T=0,T|0;!(g[y>>2]|0)&&!(g[A+8>>2]|0)?p=(g[A+12>>2]|0)!=0&1:p=1}for(A=1;A&1?mo(y):sn(y),T=it(a|0,h|0,(15-A|0)*3|0)|0,le()|0,gl(y,T&7),A>>>0<b>>>0;)A=A+1|0;return p|0}function Mi(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0;if(U=re,re=re+16|0,k=U,F=it(a|0,h|0,45)|0,le()|0,F=F&127,F>>>0>121)return g[A>>2]=0,g[A+4>>2]=0,g[A+8>>2]=0,g[A+12>>2]=0,F=5,re=U,F|0;e:do if(ui(F)|0&&(b=it(a|0,h|0,52)|0,le()|0,b=b&15,(b|0)!=0)){p=1;t:for(;;){switch(S=it(a|0,h|0,(15-p|0)*3|0)|0,le()|0,S&7){case 5:break t;case 0:break;default:{p=h;break e}}if(p>>>0<b>>>0)p=p+1|0;else{p=h;break e}}for(y=1,p=h;h=(15-y|0)*3|0,T=Ge(7,0,h|0)|0,S=p&~(le()|0),p=it(a|0,p|0,h|0)|0,le()|0,p=Ge(kn(p&7)|0,0,h|0)|0,a=a&~T|p,p=S|(le()|0),y>>>0<b>>>0;)y=y+1|0}else p=h;while(0);if(S=7696+(F*28|0)|0,g[A>>2]=g[S>>2],g[A+4>>2]=g[S+4>>2],g[A+8>>2]=g[S+8>>2],g[A+12>>2]=g[S+12>>2],!(Oa(a,p,A)|0))return F=0,re=U,F|0;if(T=A+4|0,g[k>>2]=g[T>>2],g[k+4>>2]=g[T+4>>2],g[k+8>>2]=g[T+8>>2],b=it(a|0,p|0,52)|0,le()|0,S=b&15,b&1?(sn(T),b=S+1|0):b=S,!(ui(F)|0))p=0;else{e:do if(!S)p=0;else for(h=1;;){if(y=it(a|0,p|0,(15-h|0)*3|0)|0,le()|0,y=y&7,y|0){p=y;break e}if(h>>>0<S>>>0)h=h+1|0;else{p=0;break}}while(0);p=(p|0)==4&1}if(!(Es(A,b,p,0)|0))(b|0)!=(S|0)&&(g[T>>2]=g[k>>2],g[T+4>>2]=g[k+4>>2],g[T+8>>2]=g[k+8>>2]);else{if(ui(F)|0)do;while(Es(A,b,0,0)|0);(b|0)!=(S|0)&&Da(T)}return F=0,re=U,F|0}function Vs(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0;return b=re,re=re+16|0,p=b,y=Mi(a,h,p)|0,y|0?(re=b,y|0):(y=it(a|0,h|0,52)|0,le()|0,ji(p,y&15,A),y=0,re=b,y|0)}function yr(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0;if(T=re,re=re+16|0,b=T,p=Mi(a,h,b)|0,p|0)return b=p,re=T,b|0;p=it(a|0,h|0,45)|0,le()|0,p=(ui(p&127)|0)==0,y=it(a|0,h|0,52)|0,le()|0,y=y&15;e:do if(!p){if(y|0)for(p=1;;){if(S=Ge(7,0,(15-p|0)*3|0)|0,!((S&a|0)==0&((le()|0)&h|0)==0))break e;if(p>>>0<y>>>0)p=p+1|0;else break}return Tl(b,y,0,5,A),S=0,re=T,S|0}while(0);return Bi(b,y,0,6,A),S=0,re=T,S|0}function So(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0;if(y=it(a|0,h|0,45)|0,le()|0,!(ui(y&127)|0))return y=2,g[A>>2]=y,0;if(y=it(a|0,h|0,52)|0,le()|0,y=y&15,!y)return y=5,g[A>>2]=y,0;for(p=1;;){if(b=Ge(7,0,(15-p|0)*3|0)|0,!((b&a|0)==0&((le()|0)&h|0)==0)){p=2,a=6;break}if(p>>>0<y>>>0)p=p+1|0;else{p=5,a=6;break}}return(a|0)==6&&(g[A>>2]=p),0}function Co(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0;H=re,re=re+128|0,F=H+112|0,b=H+96|0,U=H,y=it(a|0,h|0,52)|0,le()|0,S=y&15,g[F>>2]=S,T=it(a|0,h|0,45)|0,le()|0,T=T&127;e:do if(ui(T)|0){if(S|0)for(p=1;;){if(k=Ge(7,0,(15-p|0)*3|0)|0,!((k&a|0)==0&((le()|0)&h|0)==0)){y=0;break e}if(p>>>0<S>>>0)p=p+1|0;else break}if(y&1)y=1;else return k=Ge(S+1|0,0,52)|0,U=le()|0|h&-15728641,F=Ge(7,0,(14-S|0)*3|0)|0,U=Co((k|a)&~F,U&~(le()|0),A)|0,re=H,U|0}else y=0;while(0);if(p=Mi(a,h,b)|0,!p){y?(li(b,F,U),k=5):(vo(b,F,U),k=6);e:do if(ui(T)|0)if(!S)a=5;else for(p=1;;){if(T=Ge(7,0,(15-p|0)*3|0)|0,!((T&a|0)==0&((le()|0)&h|0)==0)){a=2;break e}if(p>>>0<S>>>0)p=p+1|0;else{a=5;break}}else a=2;while(0);w(A|0,-1,a<<2|0)|0;e:do if(y)for(b=0;;){if(T=U+(b<<4)|0,$i(T,g[F>>2]|0)|0,T=g[T>>2]|0,S=g[A>>2]|0,(S|0)==-1|(S|0)==(T|0))p=A;else{y=0;do{if(y=y+1|0,y>>>0>=a>>>0){p=1;break e}p=A+(y<<2)|0,S=g[p>>2]|0}while(!((S|0)==-1|(S|0)==(T|0)))}if(g[p>>2]=T,b=b+1|0,b>>>0>=k>>>0){p=0;break}}else for(b=0;;){if(T=U+(b<<4)|0,Es(T,g[F>>2]|0,0,1)|0,T=g[T>>2]|0,S=g[A>>2]|0,(S|0)==-1|(S|0)==(T|0))p=A;else{y=0;do{if(y=y+1|0,y>>>0>=a>>>0){p=1;break e}p=A+(y<<2)|0,S=g[p>>2]|0}while(!((S|0)==-1|(S|0)==(T|0)))}if(g[p>>2]=T,b=b+1|0,b>>>0>=k>>>0){p=0;break}}while(0)}return U=p,re=H,U|0}function La(){return 12}function pn(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0,S=0,k=0;if(a>>>0>15)return S=4,S|0;if(Ge(a|0,0,52)|0,S=le()|0|134225919,!a){A=0,p=0;do ui(p)|0&&(Ge(p|0,0,45)|0,T=S|(le()|0),a=h+(A<<3)|0,g[a>>2]=-1,g[a+4>>2]=T,A=A+1|0),p=p+1|0;while((p|0)!=122);return A=0,A|0}A=0,T=0;do{if(ui(T)|0){for(Ge(T|0,0,45)|0,p=1,y=-1,b=S|(le()|0);k=Ge(7,0,(15-p|0)*3|0)|0,y=y&~k,b=b&~(le()|0),(p|0)!=(a|0);)p=p+1|0;k=h+(A<<3)|0,g[k>>2]=y,g[k+4>>2]=b,A=A+1|0}T=T+1|0}while((T|0)!=122);return A=0,A|0}function sa(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0;if(de=re,re=re+16|0,me=de,Te=it(a|0,h|0,52)|0,le()|0,Te=Te&15,A>>>0>15)return Te=4,re=de,Te|0;if((Te|0)<(A|0))return Te=12,re=de,Te|0;if((Te|0)!=(A|0))if(b=Ge(A|0,0,52)|0,b=b|a,S=le()|0|h&-15728641,(Te|0)>(A|0)){k=A;do se=Ge(7,0,(14-k|0)*3|0)|0,k=k+1|0,b=se|b,S=le()|0|S;while((k|0)<(Te|0));se=b}else se=b;else se=a,S=h;G=it(se|0,S|0,45)|0,le()|0;e:do if(ui(G&127)|0){if(k=it(se|0,S|0,52)|0,le()|0,k=k&15,k|0)for(b=1;;){if(G=Ge(7,0,(15-b|0)*3|0)|0,!((G&se|0)==0&((le()|0)&S|0)==0)){F=33;break e}if(b>>>0<k>>>0)b=b+1|0;else break}if(G=p,g[G>>2]=0,g[G+4>>2]=0,(Te|0)>(A|0)){for(G=h&-15728641,Y=Te;;){if(W=Y,Y=Y+-1|0,Y>>>0>15|(Te|0)<(Y|0)){F=19;break}if((Te|0)!=(Y|0))if(b=Ge(Y|0,0,52)|0,b=b|a,k=le()|0|G,(Te|0)<(W|0))H=b;else{F=Y;do H=Ge(7,0,(14-F|0)*3|0)|0,F=F+1|0,b=H|b,k=le()|0|k;while((F|0)<(Te|0));H=b}else H=a,k=h;if(U=it(H|0,k|0,45)|0,le()|0,!(ui(U&127)|0))b=0;else{U=it(H|0,k|0,52)|0,le()|0,U=U&15;t:do if(!U)b=0;else for(F=1;;){if(b=it(H|0,k|0,(15-F|0)*3|0)|0,le()|0,b=b&7,b|0)break t;if(F>>>0<U>>>0)F=F+1|0;else{b=0;break}}while(0);b=(b|0)==0&1}if(k=it(a|0,h|0,(15-W|0)*3|0)|0,le()|0,k=k&7,(k|0)==7){y=5,F=42;break}if(b=(b|0)!=0,(k|0)==1&b){y=5,F=42;break}if(H=k+(((k|0)!=0&b)<<31>>31)|0,H|0&&(F=Te-W|0,F=Dn(7,0,F,((F|0)<0)<<31>>31)|0,U=le()|0,b?(b=br(F|0,U|0,5,0)|0,b=Nt(b|0,le()|0,-5,-1)|0,b=$s(b|0,le()|0,6,0)|0,b=Nt(b|0,le()|0,1,0)|0,k=le()|0):(b=F,k=U),W=H+-1|0,W=br(F|0,U|0,W|0,((W|0)<0)<<31>>31|0)|0,W=Nt(b|0,k|0,W|0,le()|0)|0,H=le()|0,U=p,U=Nt(W|0,H|0,g[U>>2]|0,g[U+4>>2]|0)|0,H=le()|0,W=p,g[W>>2]=U,g[W+4>>2]=H),(Y|0)<=(A|0)){F=37;break}}if((F|0)==19)Pt(23313,22674,1099,22710);else if((F|0)==37){T=p,y=g[T+4>>2]|0,T=g[T>>2]|0;break}else if((F|0)==42)return re=de,y|0}else y=0,T=0}else F=33;while(0);e:do if((F|0)==33)if(G=p,g[G>>2]=0,g[G+4>>2]=0,(Te|0)>(A|0)){for(b=Te;;){if(y=it(a|0,h|0,(15-b|0)*3|0)|0,le()|0,y=y&7,(y|0)==7){y=5;break}if(T=Te-b|0,T=Dn(7,0,T,((T|0)<0)<<31>>31)|0,y=br(T|0,le()|0,y|0,0)|0,T=le()|0,G=p,T=Nt(g[G>>2]|0,g[G+4>>2]|0,y|0,T|0)|0,y=le()|0,G=p,g[G>>2]=T,g[G+4>>2]=y,b=b+-1|0,(b|0)<=(A|0))break e}return re=de,y|0}else y=0,T=0;while(0);return To(se,S,Te,me)|0&&Pt(23313,22674,1063,22725),Te=me,me=g[Te+4>>2]|0,((y|0)>-1|(y|0)==-1&T>>>0>4294967295)&((me|0)>(y|0)|((me|0)==(y|0)?(g[Te>>2]|0)>>>0>T>>>0:0))?(Te=0,re=de,Te|0):(Pt(23313,22674,1139,22710),0)}function Po(a,h,A,p,y,b){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0,b=b|0;var T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0;if(H=re,re=re+16|0,T=H,y>>>0>15)return b=4,re=H,b|0;if(S=it(A|0,p|0,52)|0,le()|0,S=S&15,(S|0)>(y|0))return b=12,re=H,b|0;if(To(A,p,y,T)|0&&Pt(23313,22674,1063,22725),U=T,F=g[U+4>>2]|0,!(((h|0)>-1|(h|0)==-1&a>>>0>4294967295)&((F|0)>(h|0)|((F|0)==(h|0)?(g[U>>2]|0)>>>0>a>>>0:0))))return b=2,re=H,b|0;U=y-S|0,y=Ge(y|0,0,52)|0,k=le()|0|p&-15728641,F=b,g[F>>2]=y|A,g[F+4>>2]=k,F=it(A|0,p|0,45)|0,le()|0;e:do if(ui(F&127)|0){if(S|0)for(T=1;;){if(F=Ge(7,0,(15-T|0)*3|0)|0,!((F&A|0)==0&((le()|0)&p|0)==0))break e;if(T>>>0<S>>>0)T=T+1|0;else break}if((U|0)<1)return b=0,re=H,b|0;for(F=S^15,p=-1,k=1,T=1;;){S=U-k|0,S=Dn(7,0,S,((S|0)<0)<<31>>31)|0,A=le()|0;do if(T)if(T=br(S|0,A|0,5,0)|0,T=Nt(T|0,le()|0,-5,-1)|0,T=$s(T|0,le()|0,6,0)|0,y=le()|0,(h|0)>(y|0)|(h|0)==(y|0)&a>>>0>T>>>0){h=Nt(a|0,h|0,-1,-1)|0,h=ci(h|0,le()|0,T|0,y|0)|0,T=le()|0,W=b,G=g[W>>2]|0,W=g[W+4>>2]|0,se=(F+p|0)*3|0,Y=Ge(7,0,se|0)|0,W=W&~(le()|0),p=$s(h|0,T|0,S|0,A|0)|0,a=le()|0,y=Nt(p|0,a|0,2,0)|0,se=Ge(y|0,le()|0,se|0)|0,W=le()|0|W,y=b,g[y>>2]=se|G&~Y,g[y+4>>2]=W,a=br(p|0,a|0,S|0,A|0)|0,a=ci(h|0,T|0,a|0,le()|0)|0,T=0,h=le()|0;break}else{se=b,Y=g[se>>2]|0,se=g[se+4>>2]|0,G=Ge(7,0,(F+p|0)*3|0)|0,se=se&~(le()|0),T=b,g[T>>2]=Y&~G,g[T+4>>2]=se,T=1;break}else Y=b,y=g[Y>>2]|0,Y=g[Y+4>>2]|0,p=(F+p|0)*3|0,W=Ge(7,0,p|0)|0,Y=Y&~(le()|0),se=$s(a|0,h|0,S|0,A|0)|0,T=le()|0,p=Ge(se|0,T|0,p|0)|0,Y=le()|0|Y,G=b,g[G>>2]=p|y&~W,g[G+4>>2]=Y,T=br(se|0,T|0,S|0,A|0)|0,a=ci(a|0,h|0,T|0,le()|0)|0,T=0,h=le()|0;while(0);if((U|0)>(k|0))p=~k,k=k+1|0;else{h=0;break}}return re=H,h|0}while(0);if((U|0)<1)return se=0,re=H,se|0;for(y=S^15,T=1;;)if(G=U-T|0,G=Dn(7,0,G,((G|0)<0)<<31>>31)|0,se=le()|0,k=b,A=g[k>>2]|0,k=g[k+4>>2]|0,S=(y-T|0)*3|0,p=Ge(7,0,S|0)|0,k=k&~(le()|0),W=$s(a|0,h|0,G|0,se|0)|0,Y=le()|0,S=Ge(W|0,Y|0,S|0)|0,k=le()|0|k,F=b,g[F>>2]=S|A&~p,g[F+4>>2]=k,se=br(W|0,Y|0,G|0,se|0)|0,a=ci(a|0,h|0,se|0,le()|0)|0,h=le()|0,(U|0)<=(T|0)){h=0;break}else T=T+1|0;return re=H,h|0}function Cl(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0;y=it(h|0,A|0,52)|0,le()|0,y=y&15,(h|0)==0&(A|0)==0|((p|0)>15|(y|0)>(p|0))?(p=-1,y=-1,h=0,A=0):(b=Jo(h,A,y+1|0,p)|0,A=(le()|0)&-15728641,h=Ge(p|0,0,52)|0,h=b|h,A=A|(le()|0),b=(Ci(h,A)|0)==0,p=b?-1:p),b=a,g[b>>2]=h,g[b+4>>2]=A,g[a+8>>2]=y,g[a+12>>2]=p}function Pl(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0,k=0,F=0;if(A=a,h=g[A>>2]|0,A=g[A+4>>2]|0,!((h|0)==0&(A|0)==0)&&(p=it(h|0,A|0,52)|0,le()|0,p=p&15,S=Ge(1,0,(p^15)*3|0)|0,h=Nt(S|0,le()|0,h|0,A|0)|0,A=le()|0,S=a,g[S>>2]=h,g[S+4>>2]=A,S=a+8|0,T=g[S>>2]|0,!((p|0)<(T|0)))){for(k=a+12|0,b=p;;){if((b|0)==(T|0)){p=5;break}if(F=(b|0)==(g[k>>2]|0),y=(15-b|0)*3|0,p=it(h|0,A|0,y|0)|0,le()|0,p=p&7,F&((p|0)==1&!0)){p=7;break}if(!((p|0)==7&!0)){p=10;break}if(F=Ge(1,0,y|0)|0,h=Nt(h|0,A|0,F|0,le()|0)|0,A=le()|0,F=a,g[F>>2]=h,g[F+4>>2]=A,(b|0)>(T|0))b=b+-1|0;else{p=10;break}}if((p|0)==5){F=a,g[F>>2]=0,g[F+4>>2]=0,g[S>>2]=-1,g[k>>2]=-1;return}else if((p|0)==7){T=Ge(1,0,y|0)|0,T=Nt(h|0,A|0,T|0,le()|0)|0,S=le()|0,F=a,g[F>>2]=T,g[F+4>>2]=S,g[k>>2]=b+-1;return}else if((p|0)==10)return}}function Io(a){a=+a;var h=0;return h=a<0?a+6.283185307179586:a,+(a>=6.283185307179586?h+-6.283185307179586:h)}function Kn(a,h){return a=a|0,h=h|0,+ft(+(+K[a>>3]-+K[h>>3]))<17453292519943298e-27?(h=+ft(+(+K[a+8>>3]-+K[h+8>>3]))<17453292519943298e-27,h|0):(h=0,h|0)}function wc(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0;return y=+K[h>>3],p=+K[a>>3],b=+Rt(+((y-p)*.5)),A=+Rt(+((+K[h+8>>3]-+K[a+8>>3])*.5)),A=b*b+A*(+Lt(+y)*+Lt(+p)*A),+(+Vi(+ +yt(+A),+ +yt(+(1-A)))*2)}function Qr(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0;return y=+K[h>>3],p=+K[a>>3],b=+Rt(+((y-p)*.5)),A=+Rt(+((+K[h+8>>3]-+K[a+8>>3])*.5)),A=b*b+A*(+Lt(+y)*+Lt(+p)*A),+(+Vi(+ +yt(+A),+ +yt(+(1-A)))*2*6371.007180918475)}function na(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0;return y=+K[h>>3],p=+K[a>>3],b=+Rt(+((y-p)*.5)),A=+Rt(+((+K[h+8>>3]-+K[a+8>>3])*.5)),A=b*b+A*(+Lt(+y)*+Lt(+p)*A),+(+Vi(+ +yt(+A),+ +yt(+(1-A)))*2*6371.007180918475*1e3)}function os(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0;return b=+K[h>>3],p=+Lt(+b),y=+K[h+8>>3]-+K[a+8>>3],T=p*+Rt(+y),A=+K[a>>3],+ +Vi(+T,+(+Rt(+b)*+Lt(+A)-+Lt(+y)*(p*+Rt(+A))))}function oa(a,h,A,p){a=a|0,h=+h,A=+A,p=p|0;var y=0,b=0,T=0,S=0;if(A<1e-16){g[p>>2]=g[a>>2],g[p+4>>2]=g[a+4>>2],g[p+8>>2]=g[a+8>>2],g[p+12>>2]=g[a+12>>2];return}b=h<0?h+6.283185307179586:h,b=h>=6.283185307179586?b+-6.283185307179586:b;do if(b<1e-16)h=+K[a>>3]+A,K[p>>3]=h,y=p;else{if(y=+ft(+(b+-3.141592653589793))<1e-16,h=+K[a>>3],y){h=h-A,K[p>>3]=h,y=p;break}if(T=+Lt(+A),A=+Rt(+A),h=T*+Rt(+h)+ +Lt(+b)*(A*+Lt(+h)),h=h>1?1:h,h=+Xn(+(h<-1?-1:h)),K[p>>3]=h,+ft(+(h+-1.5707963267948966))<1e-16){K[p>>3]=1.5707963267948966,K[p+8>>3]=0;return}if(+ft(+(h+1.5707963267948966))<1e-16){K[p>>3]=-1.5707963267948966,K[p+8>>3]=0;return}if(S=+Lt(+h),b=A*+Rt(+b)/S,A=+K[a>>3],h=(T-+Rt(+h)*+Rt(+A))/+Lt(+A)/S,T=b>1?1:b,h=h>1?1:h,h=+K[a+8>>3]+ +Vi(+(T<-1?-1:T),+(h<-1?-1:h)),h>3.141592653589793)do h=h+-6.283185307179586;while(h>3.141592653589793);if(h<-3.141592653589793)do h=h+6.283185307179586;while(h<-3.141592653589793);K[p+8>>3]=h;return}while(0);if(+ft(+(h+-1.5707963267948966))<1e-16){K[y>>3]=1.5707963267948966,K[p+8>>3]=0;return}if(+ft(+(h+1.5707963267948966))<1e-16){K[y>>3]=-1.5707963267948966,K[p+8>>3]=0;return}if(h=+K[a+8>>3],h>3.141592653589793)do h=h+-6.283185307179586;while(h>3.141592653589793);if(h<-3.141592653589793)do h=h+6.283185307179586;while(h<-3.141592653589793);K[p+8>>3]=h}function Tc(a,h){return a=a|0,h=h|0,a>>>0>15?(h=4,h|0):(K[h>>3]=+K[20528+(a<<3)>>3],h=0,h|0)}function Ec(a,h){return a=a|0,h=h|0,a>>>0>15?(h=4,h|0):(K[h>>3]=+K[20656+(a<<3)>>3],h=0,h|0)}function Sc(a,h){return a=a|0,h=h|0,a>>>0>15?(h=4,h|0):(K[h>>3]=+K[20784+(a<<3)>>3],h=0,h|0)}function gn(a,h){return a=a|0,h=h|0,a>>>0>15?(h=4,h|0):(K[h>>3]=+K[20912+(a<<3)>>3],h=0,h|0)}function Na(a,h){a=a|0,h=h|0;var A=0;return a>>>0>15?(h=4,h|0):(A=Dn(7,0,a,((a|0)<0)<<31>>31)|0,A=br(A|0,le()|0,120,0)|0,a=le()|0,g[h>>2]=A|2,g[h+4>>2]=a,h=0,h|0)}function as(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0;return W=+K[h>>3],U=+K[a>>3],k=+Rt(+((W-U)*.5)),b=+K[h+8>>3],F=+K[a+8>>3],T=+Rt(+((b-F)*.5)),S=+Lt(+U),H=+Lt(+W),T=k*k+T*(H*S*T),T=+Vi(+ +yt(+T),+ +yt(+(1-T)))*2,k=+K[A>>3],W=+Rt(+((k-W)*.5)),p=+K[A+8>>3],b=+Rt(+((p-b)*.5)),y=+Lt(+k),b=W*W+b*(H*y*b),b=+Vi(+ +yt(+b),+ +yt(+(1-b)))*2,k=+Rt(+((U-k)*.5)),p=+Rt(+((F-p)*.5)),p=k*k+p*(S*y*p),p=+Vi(+ +yt(+p),+ +yt(+(1-p)))*2,y=(T+b+p)*.5,+(+tr(+ +yt(+(+wi(+(y*.5))*+wi(+((y-T)*.5))*+wi(+((y-b)*.5))*+wi(+((y-p)*.5)))))*4)}function js(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0;if(S=re,re=re+192|0,b=S+168|0,T=S,y=Vs(a,h,b)|0,y|0)return A=y,re=S,A|0;if(yr(a,h,T)|0&&Pt(23313,22742,386,22751),h=g[T>>2]|0,(h|0)>0){if(p=+as(T+8|0,T+8+(((h|0)!=1&1)<<4)|0,b)+0,(h|0)!=1){a=1;do y=a,a=a+1|0,p=p+ +as(T+8+(y<<4)|0,T+8+(((a|0)%(h|0)|0)<<4)|0,b);while((a|0)<(h|0))}}else p=0;return K[A>>3]=p,A=0,re=S,A|0}function za(a,h,A){return a=a|0,h=h|0,A=A|0,a=js(a,h,A)|0,a|0||(K[A>>3]=+K[A>>3]*6371.007180918475*6371.007180918475),a|0}function _n(a,h,A){return a=a|0,h=h|0,A=A|0,a=js(a,h,A)|0,a|0||(K[A>>3]=+K[A>>3]*6371.007180918475*6371.007180918475*1e3*1e3),a|0}function mn(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0;if(S=re,re=re+176|0,T=S,a=Us(a,h,T)|0,a|0)return T=a,re=S,T|0;if(K[A>>3]=0,a=g[T>>2]|0,(a|0)<=1)return T=0,re=S,T|0;h=a+-1|0,a=0,p=+K[T+8>>3],y=+K[T+16>>3],b=0;do a=a+1|0,F=p,p=+K[T+8+(a<<4)>>3],U=+Rt(+((p-F)*.5)),k=y,y=+K[T+8+(a<<4)+8>>3],k=+Rt(+((y-k)*.5)),k=U*U+k*(+Lt(+p)*+Lt(+F)*k),b=b+ +Vi(+ +yt(+k),+ +yt(+(1-k)))*2;while((a|0)<(h|0));return K[A>>3]=b,T=0,re=S,T|0}function zh(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0;if(S=re,re=re+176|0,T=S,a=Us(a,h,T)|0,a|0)return T=a,b=+K[A>>3],b=b*6371.007180918475,K[A>>3]=b,re=S,T|0;if(K[A>>3]=0,a=g[T>>2]|0,(a|0)<=1)return T=0,b=0,b=b*6371.007180918475,K[A>>3]=b,re=S,T|0;h=a+-1|0,a=0,p=+K[T+8>>3],y=+K[T+16>>3],b=0;do a=a+1|0,F=p,p=+K[T+8+(a<<4)>>3],U=+Rt(+((p-F)*.5)),k=y,y=+K[T+8+(a<<4)+8>>3],k=+Rt(+((y-k)*.5)),k=U*U+k*(+Lt(+F)*+Lt(+p)*k),b=b+ +Vi(+ +yt(+k),+ +yt(+(1-k)))*2;while((a|0)!=(h|0));return K[A>>3]=b,T=0,U=b,U=U*6371.007180918475,K[A>>3]=U,re=S,T|0}function Il(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0;if(S=re,re=re+176|0,T=S,a=Us(a,h,T)|0,a|0)return T=a,b=+K[A>>3],b=b*6371.007180918475,b=b*1e3,K[A>>3]=b,re=S,T|0;if(K[A>>3]=0,a=g[T>>2]|0,(a|0)<=1)return T=0,b=0,b=b*6371.007180918475,b=b*1e3,K[A>>3]=b,re=S,T|0;h=a+-1|0,a=0,p=+K[T+8>>3],y=+K[T+16>>3],b=0;do a=a+1|0,F=p,p=+K[T+8+(a<<4)>>3],U=+Rt(+((p-F)*.5)),k=y,y=+K[T+8+(a<<4)+8>>3],k=+Rt(+((y-k)*.5)),k=U*U+k*(+Lt(+F)*+Lt(+p)*k),b=b+ +Vi(+ +yt(+k),+ +yt(+(1-k)))*2;while((a|0)!=(h|0));return K[A>>3]=b,T=0,U=b,U=U*6371.007180918475,U=U*1e3,K[A>>3]=U,re=S,T|0}function Cc(a){a=a|0;var h=0,A=0,p=0;return h=Or(1,12)|0,h||Pt(22832,22787,49,22845),A=a+4|0,p=g[A>>2]|0,p|0?(p=p+8|0,g[p>>2]=h,g[A>>2]=h,h|0):(g[a>>2]|0&&Pt(22862,22787,61,22885),p=a,g[p>>2]=h,g[A>>2]=h,h|0)}function Ua(a,h){a=a|0,h=h|0;var A=0,p=0;return p=sr(24)|0,p||Pt(22899,22787,78,22913),g[p>>2]=g[h>>2],g[p+4>>2]=g[h+4>>2],g[p+8>>2]=g[h+8>>2],g[p+12>>2]=g[h+12>>2],g[p+16>>2]=0,h=a+4|0,A=g[h>>2]|0,A|0?(g[A+16>>2]=p,g[h>>2]=p,p|0):(g[a>>2]|0&&Pt(22928,22787,82,22913),g[a>>2]=p,g[h>>2]=p,p|0)}function Jn(a){a=a|0;var h=0,A=0,p=0,y=0;if(a)for(p=1;;){if(h=g[a>>2]|0,h|0)do{if(A=g[h>>2]|0,A|0)do y=A,A=g[A+16>>2]|0,Kt(y);while(A|0);y=h,h=g[h+8>>2]|0,Kt(y)}while(h|0);if(h=a,a=g[a+8>>2]|0,p||Kt(h),a)p=0;else break}}function yn(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0,be=0,ve=0,Ye=0,je=0,He=0,$e=0,zt=0,vt=0,mt=0,pt=0,Mt=0,St=0,ti=0,kt=0;if(y=a+8|0,g[y>>2]|0)return kt=1,kt|0;if(p=g[a>>2]|0,!p)return kt=0,kt|0;h=p,A=0;do A=A+1|0,h=g[h+8>>2]|0;while(h|0);if(A>>>0<2)return kt=0,kt|0;St=sr(A<<2)|0,St||Pt(22948,22787,317,22967),Mt=sr(A<<5)|0,Mt||Pt(22989,22787,321,22967),g[a>>2]=0,je=a+4|0,g[je>>2]=0,g[y>>2]=0,A=0,pt=0,Ye=0,H=0;e:for(;;){if(U=g[p>>2]|0,U){b=0,T=U;do{if(k=+K[T+8>>3],h=T,T=g[T+16>>2]|0,F=(T|0)==0,y=F?U:T,S=+K[y+8>>3],+ft(+(k-S))>3.141592653589793){kt=14;break}b=b+(S-k)*(+K[h>>3]+ +K[y>>3])}while(!F);if((kt|0)==14){kt=0,b=0,h=U;do ve=+K[h+8>>3],mt=h+16|0,vt=g[mt>>2]|0,vt=vt|0?vt:U,be=+K[vt+8>>3],b=b+(+K[h>>3]+ +K[vt>>3])*((be<0?be+6.283185307179586:be)-(ve<0?ve+6.283185307179586:ve)),h=g[(h|0?mt:p)>>2]|0;while(h|0)}b>0?(g[St+(pt<<2)>>2]=p,pt=pt+1|0,y=Ye,h=H):kt=19}else kt=19;if((kt|0)==19){kt=0;do if(A){if(h=A+8|0,g[h>>2]|0){kt=21;break e}if(A=Or(1,12)|0,!A){kt=23;break e}g[h>>2]=A,y=A+4|0,T=A,h=H}else if(H){y=je,T=H+8|0,h=p,A=a;break}else if(g[a>>2]|0){kt=27;break e}else{y=je,T=a,h=p,A=a;break}while(0);if(g[T>>2]=p,g[y>>2]=p,T=Mt+(Ye<<5)|0,F=g[p>>2]|0,F){for(U=Mt+(Ye<<5)+8|0,K[U>>3]=17976931348623157e292,H=Mt+(Ye<<5)+24|0,K[H>>3]=17976931348623157e292,K[T>>3]=-17976931348623157e292,W=Mt+(Ye<<5)+16|0,K[W>>3]=-17976931348623157e292,Te=17976931348623157e292,de=-17976931348623157e292,y=0,Y=F,k=17976931348623157e292,se=17976931348623157e292,me=-17976931348623157e292,S=-17976931348623157e292;b=+K[Y>>3],ve=+K[Y+8>>3],Y=g[Y+16>>2]|0,G=(Y|0)==0,be=+K[(G?F:Y)+8>>3],b<k&&(K[U>>3]=b,k=b),ve<se&&(K[H>>3]=ve,se=ve),b>me?K[T>>3]=b:b=me,ve>S&&(K[W>>3]=ve,S=ve),Te=ve>0&ve<Te?ve:Te,de=ve<0&ve>de?ve:de,y=y|+ft(+(ve-be))>3.141592653589793,!G;)me=b;y&&(K[W>>3]=de,K[H>>3]=Te)}else g[T>>2]=0,g[T+4>>2]=0,g[T+8>>2]=0,g[T+12>>2]=0,g[T+16>>2]=0,g[T+20>>2]=0,g[T+24>>2]=0,g[T+28>>2]=0;y=Ye+1|0}if(mt=p+8|0,p=g[mt>>2]|0,g[mt>>2]=0,p)Ye=y,H=h;else{kt=45;break}}if((kt|0)==21)Pt(22765,22787,35,22799);else if((kt|0)==23)Pt(22819,22787,37,22799);else if((kt|0)==27)Pt(22862,22787,61,22885);else if((kt|0)==45){e:do if((pt|0)>0){for(mt=(y|0)==0,zt=y<<2,vt=(a|0)==0,$e=0,h=0;;){if(He=g[St+($e<<2)>>2]|0,mt)kt=73;else{if(Ye=sr(zt)|0,!Ye){kt=50;break}if(je=sr(zt)|0,!je){kt=52;break}t:do if(vt)A=0;else{for(y=0,A=0,T=a;p=Mt+(y<<5)|0,bt(g[T>>2]|0,p,g[He>>2]|0)|0?(g[Ye+(A<<2)>>2]=T,g[je+(A<<2)>>2]=p,G=A+1|0):G=A,T=g[T+8>>2]|0,T;)y=y+1|0,A=G;if((G|0)>0)if(p=g[Ye>>2]|0,(G|0)==1)A=p;else for(W=0,Y=-1,A=p,H=p;;){for(F=g[H>>2]|0,p=0,T=0;y=g[g[Ye+(T<<2)>>2]>>2]|0,(y|0)==(F|0)?U=p:U=p+((bt(y,g[je+(T<<2)>>2]|0,g[F>>2]|0)|0)&1)|0,T=T+1|0,(T|0)!=(G|0);)p=U;if(y=(U|0)>(Y|0),A=y?H:A,p=W+1|0,(p|0)==(G|0))break t;W=p,Y=y?U:Y,H=g[Ye+(p<<2)>>2]|0}else A=0}while(0);if(Kt(Ye),Kt(je),A){if(y=A+4|0,p=g[y>>2]|0,p)A=p+8|0;else if(g[A>>2]|0){kt=70;break}g[A>>2]=He,g[y>>2]=He}else kt=73}if((kt|0)==73){if(kt=0,h=g[He>>2]|0,h|0)do je=h,h=g[h+16>>2]|0,Kt(je);while(h|0);Kt(He),h=1}if($e=$e+1|0,($e|0)>=(pt|0)){ti=h;break e}}(kt|0)==50?Pt(23004,22787,249,23023):(kt|0)==52?Pt(23042,22787,252,23023):(kt|0)==70&&Pt(22862,22787,61,22885)}else ti=0;while(0);return Kt(St),Kt(Mt),kt=ti,kt|0}return 0}function bt(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0;if(!(go(h,A)|0)||(h=Zo(h)|0,p=+K[A>>3],y=+K[A+8>>3],y=h&y<0?y+6.283185307179586:y,a=g[a>>2]|0,!a))return a=0,a|0;if(h){h=0,F=y,A=a;e:for(;;){for(;T=+K[A>>3],y=+K[A+8>>3],A=A+16|0,U=g[A>>2]|0,U=U|0?U:a,b=+K[U>>3],S=+K[U+8>>3],T>b?(k=T,T=S):(k=b,b=T,T=y,y=S),p=p==b|p==k?p+2220446049250313e-31:p,!!(p<b|p>k);)if(A=g[A>>2]|0,!A){A=22;break e}if(S=T<0?T+6.283185307179586:T,T=y<0?y+6.283185307179586:y,F=S==F|T==F?F+-2220446049250313e-31:F,k=S+(T-S)*((p-b)/(k-b)),(k<0?k+6.283185307179586:k)>F&&(h=h^1),A=g[A>>2]|0,!A){A=22;break}}if((A|0)==22)return h|0}else{h=0,F=y,A=a;e:for(;;){for(;T=+K[A>>3],y=+K[A+8>>3],A=A+16|0,U=g[A>>2]|0,U=U|0?U:a,b=+K[U>>3],S=+K[U+8>>3],T>b?(k=T,T=S):(k=b,b=T,T=y,y=S),p=p==b|p==k?p+2220446049250313e-31:p,!!(p<b|p>k);)if(A=g[A>>2]|0,!A){A=22;break e}if(F=T==F|y==F?F+-2220446049250313e-31:F,T+(y-T)*((p-b)/(k-b))>F&&(h=h^1),A=g[A>>2]|0,!A){A=22;break}}if((A|0)==22)return h|0}return 0}function Ss(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0;if(de=re,re=re+32|0,Te=de+16|0,me=de,b=it(a|0,h|0,52)|0,le()|0,b=b&15,Y=it(A|0,p|0,52)|0,le()|0,(b|0)!=(Y&15|0))return Te=12,re=de,Te|0;if(F=it(a|0,h|0,45)|0,le()|0,F=F&127,U=it(A|0,p|0,45)|0,le()|0,U=U&127,F>>>0>121|U>>>0>121)return Te=5,re=de,Te|0;if(Y=(F|0)!=(U|0),Y){if(S=po(F,U)|0,(S|0)==7)return Te=1,re=de,Te|0;k=po(U,F)|0,(k|0)==7?Pt(23066,23090,161,23100):(G=S,T=k)}else G=0,T=0;H=ui(F)|0,W=ui(U)|0,g[Te>>2]=0,g[Te+4>>2]=0,g[Te+8>>2]=0,g[Te+12>>2]=0;do if(G){if(U=g[4272+(F*28|0)+(G<<2)>>2]|0,S=(U|0)>0,W)if(S){F=0,k=A,S=p;do k=xc(k,S)|0,S=le()|0,T=kn(T)|0,(T|0)==1&&(T=kn(1)|0),F=F+1|0;while((F|0)!=(U|0));U=T,F=k,k=S}else U=T,F=A,k=p;else if(S){F=0,k=A,S=p;do k=Fa(k,S)|0,S=le()|0,T=kn(T)|0,F=F+1|0;while((F|0)!=(U|0));U=T,F=k,k=S}else U=T,F=A,k=p;if(Oa(F,k,Te)|0,Y||Pt(23115,23090,191,23100),S=(H|0)!=0,T=(W|0)!=0,S&T&&Pt(23142,23090,192,23100),S){if(T=$r(a,h)|0,(T|0)==7){b=5;break}if(et[21872+(T*7|0)+G>>0]|0){b=1;break}k=g[21040+(T*28|0)+(G<<2)>>2]|0,F=k}else if(T){if(T=$r(F,k)|0,(T|0)==7){b=5;break}if(et[21872+(T*7|0)+U>>0]|0){b=1;break}F=0,k=g[21040+(U*28|0)+(T<<2)>>2]|0}else F=0,k=0;if((F|k|0)<0)b=5;else{if((k|0)>0){S=Te+4|0,T=0;do fn(S),T=T+1|0;while((T|0)!=(k|0))}if(g[me>>2]=0,g[me+4>>2]=0,g[me+8>>2]=0,gl(me,G),b|0)for(;Wr(b)|0?mo(me):sn(me),(b|0)>1;)b=b+-1|0;if((F|0)>0){b=0;do fn(me),b=b+1|0;while((b|0)!=(F|0))}se=Te+4|0,Di(se,me,se),fr(se),se=51}}else if(Oa(A,p,Te)|0,(H|0)!=0&(W|0)!=0)if((U|0)!=(F|0)&&Pt(23173,23090,261,23100),T=$r(a,h)|0,b=$r(A,p)|0,(T|0)==7|(b|0)==7)b=5;else if(et[21872+(T*7|0)+b>>0]|0)b=1;else if(T=g[21040+(T*28|0)+(b<<2)>>2]|0,(T|0)>0){S=Te+4|0,b=0;do fn(S),b=b+1|0;while((b|0)!=(T|0));se=51}else se=51;else se=51;while(0);return(se|0)==51&&(b=Te+4|0,g[y>>2]=g[b>>2],g[y+4>>2]=g[b+4>>2],g[y+8>>2]=g[b+8>>2],b=0),Te=b,re=de,Te|0}function bn(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0,be=0;if(se=re,re=re+48|0,F=se+36|0,T=se+24|0,S=se+12|0,k=se,y=it(a|0,h|0,52)|0,le()|0,y=y&15,W=it(a|0,h|0,45)|0,le()|0,W=W&127,W>>>0>121)return p=5,re=se,p|0;if(U=ui(W)|0,Ge(y|0,0,52)|0,me=le()|0|134225919,b=p,g[b>>2]=-1,g[b+4>>2]=me,!y)return y=Yn(A)|0,(y|0)==7||(y=An(W,y)|0,(y|0)==127)?(me=1,re=se,me|0):(Y=Ge(y|0,0,45)|0,G=le()|0,W=p,G=g[W+4>>2]&-1040385|G,me=p,g[me>>2]=g[W>>2]|Y,g[me+4>>2]=G,me=0,re=se,me|0);for(g[F>>2]=g[A>>2],g[F+4>>2]=g[A+4>>2],g[F+8>>2]=g[A+8>>2],A=y;;){if(b=A,A=A+-1|0,g[T>>2]=g[F>>2],g[T+4>>2]=g[F+4>>2],g[T+8>>2]=g[F+8>>2],Wr(b)|0){if(y=dl(F)|0,y|0){A=13;break}g[S>>2]=g[F>>2],g[S+4>>2]=g[F+4>>2],g[S+8>>2]=g[F+8>>2],mo(S)}else{if(y=pl(F)|0,y|0){A=13;break}g[S>>2]=g[F>>2],g[S+4>>2]=g[F+4>>2],g[S+8>>2]=g[F+8>>2],sn(S)}if(Go(T,S,k),fr(k),y=p,de=g[y>>2]|0,y=g[y+4>>2]|0,be=(15-b|0)*3|0,Te=Ge(7,0,be|0)|0,y=y&~(le()|0),be=Ge(Yn(k)|0,0,be|0)|0,y=le()|0|y,me=p,g[me>>2]=be|de&~Te,g[me+4>>2]=y,(b|0)<=1){A=14;break}}e:do if((A|0)!=13&&(A|0)==14)if((g[F>>2]|0)<=1&&(g[F+4>>2]|0)<=1&&(g[F+8>>2]|0)<=1){A=Yn(F)|0,y=An(W,A)|0,(y|0)==127?k=0:k=ui(y)|0;t:do if(A){if(U){if(y=$r(a,h)|0,(y|0)==7){y=5;break e}if(b=g[21248+(y*28|0)+(A<<2)>>2]|0,(b|0)>0){y=A,A=0;do y=Gn(y)|0,A=A+1|0;while((A|0)!=(b|0))}else y=A;if((y|0)==1){y=9;break e}A=An(W,y)|0,(A|0)==127&&Pt(23200,23090,411,23230),ui(A)|0?Pt(23245,23090,412,23230):(G=A,Y=b,H=y)}else G=y,Y=0,H=A;if(S=g[4272+(W*28|0)+(H<<2)>>2]|0,(S|0)<=-1&&Pt(23276,23090,419,23230),!k){if((Y|0)<0){y=5;break e}if(Y|0){b=p,y=0,A=g[b>>2]|0,b=g[b+4>>2]|0;do A=dn(A,b)|0,b=le()|0,be=p,g[be>>2]=A,g[be+4>>2]=b,y=y+1|0;while((y|0)<(Y|0))}if((S|0)<=0){y=G,A=58;break}for(b=p,y=0,A=g[b>>2]|0,b=g[b+4>>2]|0;;)if(A=dn(A,b)|0,b=le()|0,be=p,g[be>>2]=A,g[be+4>>2]=b,y=y+1|0,(y|0)==(S|0)){y=G,A=58;break t}}if(T=po(G,W)|0,(T|0)==7&&Pt(23066,23090,428,23230),y=p,A=g[y>>2]|0,y=g[y+4>>2]|0,(S|0)>0){b=0;do A=dn(A,y)|0,y=le()|0,be=p,g[be>>2]=A,g[be+4>>2]=y,b=b+1|0;while((b|0)!=(S|0))}if(y=$r(A,y)|0,(y|0)==7&&Pt(23313,23090,440,23230),A=Ia(G)|0,A=g[(A?21664:21456)+(T*28|0)+(y<<2)>>2]|0,(A|0)<0&&Pt(23313,23090,454,23230),!A)y=G,A=58;else{T=p,y=0,b=g[T>>2]|0,T=g[T+4>>2]|0;do b=Eo(b,T)|0,T=le()|0,be=p,g[be>>2]=b,g[be+4>>2]=T,y=y+1|0;while((y|0)<(A|0));y=G,A=58}}else if((U|0)!=0&(k|0)!=0){if(A=$r(a,h)|0,b=p,b=$r(g[b>>2]|0,g[b+4>>2]|0)|0,(A|0)==7|(b|0)==7){y=5;break e}if(b=g[21248+(A*28|0)+(b<<2)>>2]|0,(b|0)<0){y=5;break e}if(!b)A=59;else{S=p,A=0,T=g[S>>2]|0,S=g[S+4>>2]|0;do T=dn(T,S)|0,S=le()|0,be=p,g[be>>2]=T,g[be+4>>2]=S,A=A+1|0;while((A|0)<(b|0));A=58}}else A=58;while(0);if((A|0)==58&&k&&(A=59),(A|0)==59&&(be=p,($r(g[be>>2]|0,g[be+4>>2]|0)|0)==1)){y=9;break}be=p,Te=g[be>>2]|0,be=g[be+4>>2]&-1040385,de=Ge(y|0,0,45)|0,be=be|(le()|0),y=p,g[y>>2]=Te|de,g[y+4>>2]=be,y=0}else y=1;while(0);return be=y,re=se,be|0}function Mo(a,h,A,p,y,b){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0,b=b|0;var T=0,S=0;return S=re,re=re+16|0,T=S,y?a=15:(a=Ss(a,h,A,p,T)|0,a||(Oh(T,b),a=0)),re=S,a|0}function Pc(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0;return T=re,re=re+16|0,b=T,p?A=15:(A=yl(A,b)|0,A||(A=bn(a,h,b,y)|0)),re=T,A|0}function dt(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0;return k=re,re=re+32|0,T=k+12|0,S=k,b=Ss(a,h,a,h,T)|0,b|0?(S=b,re=k,S|0):(a=Ss(a,h,A,p,S)|0,a|0?(S=a,re=k,S|0):(T=ml(T,S)|0,S=y,g[S>>2]=T,g[S+4>>2]=((T|0)<0)<<31>>31,S=0,re=k,S|0))}function Ml(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0;return k=re,re=re+32|0,T=k+12|0,S=k,b=Ss(a,h,a,h,T)|0,!b&&(b=Ss(a,h,A,p,S)|0,!b)?(p=ml(T,S)|0,p=Nt(p|0,((p|0)<0)<<31>>31|0,1,0)|0,T=le()|0,S=y,g[S>>2]=p,g[S+4>>2]=T,S=0,re=k,S|0):(S=b,re=k,S|0)}function Rl(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0,be=0,ve=0,Ye=0,je=0,He=0,$e=0;if(He=re,re=re+48|0,T=He+24|0,S=He+12|0,je=He,b=Ss(a,h,a,h,T)|0,!b&&(b=Ss(a,h,A,p,S)|0,!b)){ve=ml(T,S)|0,Ye=((ve|0)<0)<<31>>31,g[T>>2]=0,g[T+4>>2]=0,g[T+8>>2]=0,g[S>>2]=0,g[S+4>>2]=0,g[S+8>>2]=0,Ss(a,h,a,h,T)|0&&Pt(23313,23090,691,23299),Ss(a,h,A,p,S)|0&&Pt(23313,23090,696,23299),Ko(T),Ko(S),ve?(H=g[T>>2]|0,G=+(ve|0),Te=T+4|0,W=g[Te>>2]|0,de=T+8|0,Y=g[de>>2]|0,be=T,p=H,b=W,A=Y,se=+((g[S>>2]|0)-H|0)/G,me=+((g[S+4>>2]|0)-W|0)/G,G=+((g[S+8>>2]|0)-Y|0)/G):(b=T+4|0,A=T+8|0,Te=b,de=A,be=T,p=g[T>>2]|0,b=g[b>>2]|0,A=g[A>>2]|0,se=0,me=0,G=0),g[je>>2]=p,Y=je+4|0,g[Y>>2]=b,W=je+8|0,g[W>>2]=A;e:do if((ve|0)<0)b=0;else for(U=0,H=0,b=p;;){F=+(H>>>0)+4294967296*+(U|0),$e=se*F+ +(b|0),k=me*F+ +(g[Te>>2]|0),F=G*F+ +(g[de>>2]|0),A=~~+d(+$e),T=~~+d(+k),b=~~+d(+F),$e=+ft(+(+(A|0)-$e)),k=+ft(+(+(T|0)-k)),F=+ft(+(+(b|0)-F));do if($e>k&$e>F)A=0-(T+b)|0,p=T;else if(S=0-A|0,k>F){p=S-b|0;break}else{p=T,b=S-T|0;break}while(0);if(g[je>>2]=A,g[Y>>2]=p,g[W>>2]=b,bl(je),b=bn(a,h,je,y+(H<<3)|0)|0,b|0)break e;if(!((U|0)<(Ye|0)|(U|0)==(Ye|0)&H>>>0<ve>>>0)){b=0;break e}b=Nt(H|0,U|0,1,0)|0,S=le()|0,U=S,H=b,b=g[be>>2]|0}while(0);return je=b,re=He,je|0}return je=b,re=He,je|0}function Dn(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0;if((A|0)==0&(p|0)==0)return y=0,b=1,Wt(y|0),b|0;b=a,y=h,a=1,h=0;do T=(A&1|0)==0&!0,a=br((T?1:b)|0,(T?0:y)|0,a|0,h|0)|0,h=le()|0,A=$a(A|0,p|0,1)|0,p=le()|0,b=br(b|0,y|0,b|0,y|0)|0,y=le()|0;while(!((A|0)==0&(p|0)==0));return Wt(h|0),a|0}function Va(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0;if(!(go(h,A)|0)||(h=Zo(h)|0,p=+K[A>>3],y=+K[A+8>>3],y=h&y<0?y+6.283185307179586:y,W=g[a>>2]|0,(W|0)<=0))return W=0,W|0;if(H=g[a+4>>2]|0,h){h=0,U=y,A=-1,a=0;e:for(;;){for(F=a;T=+K[H+(F<<4)>>3],y=+K[H+(F<<4)+8>>3],a=(A+2|0)%(W|0)|0,b=+K[H+(a<<4)>>3],S=+K[H+(a<<4)+8>>3],T>b?(k=T,T=S):(k=b,b=T,T=y,y=S),p=p==b|p==k?p+2220446049250313e-31:p,!!(p<b|p>k);)if(A=F+1|0,(A|0)>=(W|0)){A=22;break e}else a=F,F=A,A=a;if(S=T<0?T+6.283185307179586:T,T=y<0?y+6.283185307179586:y,U=S==U|T==U?U+-2220446049250313e-31:U,k=S+(T-S)*((p-b)/(k-b)),(k<0?k+6.283185307179586:k)>U&&(h=h^1),a=F+1|0,(a|0)>=(W|0)){A=22;break}else A=F}if((A|0)==22)return h|0}else{h=0,U=y,A=-1,a=0;e:for(;;){for(F=a;T=+K[H+(F<<4)>>3],y=+K[H+(F<<4)+8>>3],a=(A+2|0)%(W|0)|0,b=+K[H+(a<<4)>>3],S=+K[H+(a<<4)+8>>3],T>b?(k=T,T=S):(k=b,b=T,T=y,y=S),p=p==b|p==k?p+2220446049250313e-31:p,!!(p<b|p>k);)if(A=F+1|0,(A|0)>=(W|0)){A=22;break e}else a=F,F=A,A=a;if(U=T==U|y==U?U+-2220446049250313e-31:U,T+(y-T)*((p-b)/(k-b))>U&&(h=h^1),a=F+1|0,(a|0)>=(W|0)){A=22;break}else A=F}if((A|0)==22)return h|0}return 0}function kl(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0;if(G=g[a>>2]|0,!G){g[h>>2]=0,g[h+4>>2]=0,g[h+8>>2]=0,g[h+12>>2]=0,g[h+16>>2]=0,g[h+20>>2]=0,g[h+24>>2]=0,g[h+28>>2]=0;return}if(se=h+8|0,K[se>>3]=17976931348623157e292,me=h+24|0,K[me>>3]=17976931348623157e292,K[h>>3]=-17976931348623157e292,Te=h+16|0,K[Te>>3]=-17976931348623157e292,!((G|0)<=0)){for(W=g[a+4>>2]|0,F=17976931348623157e292,U=-17976931348623157e292,H=0,a=-1,b=17976931348623157e292,T=17976931348623157e292,k=-17976931348623157e292,p=-17976931348623157e292,Y=0;A=+K[W+(Y<<4)>>3],S=+K[W+(Y<<4)+8>>3],a=a+2|0,y=+K[W+(((a|0)==(G|0)?0:a)<<4)+8>>3],A<b&&(K[se>>3]=A,b=A),S<T&&(K[me>>3]=S,T=S),A>k?K[h>>3]=A:A=k,S>p&&(K[Te>>3]=S,p=S),F=S>0&S<F?S:F,U=S<0&S>U?S:U,H=H|+ft(+(S-y))>3.141592653589793,a=Y+1|0,(a|0)!=(G|0);)de=Y,k=A,Y=a,a=de;H&&(K[Te>>3]=U,K[me>>3]=F)}}function Ic(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0,be=0,ve=0,Ye=0,je=0,He=0;if(G=g[a>>2]|0,G){if(se=h+8|0,K[se>>3]=17976931348623157e292,me=h+24|0,K[me>>3]=17976931348623157e292,K[h>>3]=-17976931348623157e292,Te=h+16|0,K[Te>>3]=-17976931348623157e292,(G|0)>0){for(y=g[a+4>>2]|0,W=17976931348623157e292,Y=-17976931348623157e292,p=0,A=-1,k=17976931348623157e292,F=17976931348623157e292,H=-17976931348623157e292,T=-17976931348623157e292,de=0;b=+K[y+(de<<4)>>3],U=+K[y+(de<<4)+8>>3],je=A+2|0,S=+K[y+(((je|0)==(G|0)?0:je)<<4)+8>>3],b<k&&(K[se>>3]=b,k=b),U<F&&(K[me>>3]=U,F=U),b>H?K[h>>3]=b:b=H,U>T&&(K[Te>>3]=U,T=U),W=U>0&U<W?U:W,Y=U<0&U>Y?U:Y,p=p|+ft(+(U-S))>3.141592653589793,A=de+1|0,(A|0)!=(G|0);)je=de,H=b,de=A,A=je;p&&(K[Te>>3]=Y,K[me>>3]=W)}}else g[h>>2]=0,g[h+4>>2]=0,g[h+8>>2]=0,g[h+12>>2]=0,g[h+16>>2]=0,g[h+20>>2]=0,g[h+24>>2]=0,g[h+28>>2]=0;if(je=a+8|0,A=g[je>>2]|0,!((A|0)<=0)){Ye=a+12|0,ve=0;do if(y=g[Ye>>2]|0,p=ve,ve=ve+1|0,me=h+(ve<<5)|0,Te=g[y+(p<<3)>>2]|0,Te){if(de=h+(ve<<5)+8|0,K[de>>3]=17976931348623157e292,a=h+(ve<<5)+24|0,K[a>>3]=17976931348623157e292,K[me>>3]=-17976931348623157e292,be=h+(ve<<5)+16|0,K[be>>3]=-17976931348623157e292,(Te|0)>0){for(G=g[y+(p<<3)+4>>2]|0,W=17976931348623157e292,Y=-17976931348623157e292,y=0,p=-1,se=0,k=17976931348623157e292,F=17976931348623157e292,U=-17976931348623157e292,T=-17976931348623157e292;b=+K[G+(se<<4)>>3],H=+K[G+(se<<4)+8>>3],p=p+2|0,S=+K[G+(((p|0)==(Te|0)?0:p)<<4)+8>>3],b<k&&(K[de>>3]=b,k=b),H<F&&(K[a>>3]=H,F=H),b>U?K[me>>3]=b:b=U,H>T&&(K[be>>3]=H,T=H),W=H>0&H<W?H:W,Y=H<0&H>Y?H:Y,y=y|+ft(+(H-S))>3.141592653589793,p=se+1|0,(p|0)!=(Te|0);)He=se,se=p,U=b,p=He;y&&(K[be>>3]=Y,K[a>>3]=W)}}else g[me>>2]=0,g[me+4>>2]=0,g[me+8>>2]=0,g[me+12>>2]=0,g[me+16>>2]=0,g[me+20>>2]=0,g[me+24>>2]=0,g[me+28>>2]=0,A=g[je>>2]|0;while((ve|0)<(A|0))}}function Mc(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0;if(!(Va(a,h,A)|0))return y=0,y|0;if(y=a+8|0,(g[y>>2]|0)<=0)return y=1,y|0;for(p=a+12|0,a=0;;){if(b=a,a=a+1|0,Va((g[p>>2]|0)+(b<<3)|0,h+(a<<5)|0,A)|0){a=0,p=6;break}if((a|0)>=(g[y>>2]|0)){a=1,p=6;break}}return(p|0)==6?a|0:0}function Uh(){return 8}function Dl(){return 16}function Bl(){return 168}function Fl(){return 8}function Ol(){return 16}function Kr(){return 12}function Bn(){return 8}function aa(a){return a=a|0,+(+((g[a>>2]|0)>>>0)+4294967296*+(g[a+4>>2]|0))}function Ll(a){a=a|0;var h=0,A=0;return A=+K[a>>3],h=+K[a+8>>3],+ +yt(+(A*A+h*h))}function Ro(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0;F=+K[a>>3],k=+K[h>>3]-F,S=+K[a+8>>3],T=+K[h+8>>3]-S,H=+K[A>>3],b=+K[p>>3]-H,W=+K[A+8>>3],U=+K[p+8>>3]-W,b=(b*(S-W)-(F-H)*U)/(k*U-T*b),K[y>>3]=F+k*b,K[y+8>>3]=S+T*b}function ja(a,h){return a=a|0,h=h|0,+ft(+(+K[a>>3]-+K[h>>3]))<11920928955078125e-23?(h=+ft(+(+K[a+8>>3]-+K[h+8>>3]))<11920928955078125e-23,h|0):(h=0,h|0)}function ir(a,h){a=a|0,h=h|0;var A=0,p=0,y=0;return y=+K[a>>3]-+K[h>>3],p=+K[a+8>>3]-+K[h+8>>3],A=+K[a+16>>3]-+K[h+16>>3],+(y*y+p*p+A*A)}function ls(a,h){a=a|0,h=h|0;var A=0,p=0,y=0;A=+K[a>>3],p=+Lt(+A),A=+Rt(+A),K[h+16>>3]=A,A=+K[a+8>>3],y=p*+Lt(+A),K[h>>3]=y,A=p*+Rt(+A),K[h+8>>3]=A}function zi(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0;if(b=re,re=re+16|0,y=b,p=Ci(a,h)|0,(A+-1|0)>>>0>5||(p=(p|0)!=0,(A|0)==1&p))return y=-1,re=b,y|0;do if(Fn(a,h,y)|0)p=-1;else if(p){p=((g[21936+(A<<2)>>2]|0)+5-(g[y>>2]|0)|0)%5|0;break}else{p=((g[21968+(A<<2)>>2]|0)+6-(g[y>>2]|0)|0)%6|0;break}while(0);return y=p,re=b,y|0}function Fn(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0,F=0;if(F=re,re=re+32|0,T=F+16|0,S=F,p=Mi(a,h,T)|0,p|0)return A=p,re=F,A|0;b=Ba(a,h)|0,k=$r(a,h)|0,dc(b,S),p=fl(b,g[T>>2]|0)|0;e:do if(ui(b)|0){do switch(b|0){case 4:{a=0;break}case 14:{a=1;break}case 24:{a=2;break}case 38:{a=3;break}case 49:{a=4;break}case 58:{a=5;break}case 63:{a=6;break}case 72:{a=7;break}case 83:{a=8;break}case 97:{a=9;break}case 107:{a=10;break}case 117:{a=11;break}default:{p=1;break e}}while(0);if(y=g[22e3+(a*24|0)+8>>2]|0,h=g[22e3+(a*24|0)+16>>2]|0,a=g[T>>2]|0,(a|0)!=(g[S>>2]|0)&&(S=Ia(b)|0,a=g[T>>2]|0,S|(a|0)==(h|0)&&(p=(p+1|0)%6|0)),(k|0)==3&(a|0)==(h|0)){p=(p+5|0)%6|0,y=22;break}(k|0)==5&(a|0)==(y|0)&&(p=(p+1|0)%6|0),y=22}else y=22;while(0);return(y|0)==22&&(g[A>>2]=p,p=0),A=p,re=F,A|0}function Jr(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0,be=0;if(be=re,re=re+32|0,de=be+24|0,me=be+20|0,G=be+8|0,Y=be+16|0,W=be,k=(Ci(a,h)|0)==0,k=k?6:5,U=it(a|0,h|0,52)|0,le()|0,U=U&15,k>>>0<=A>>>0)return p=2,re=be,p|0;H=(U|0)==0,!H&&(se=Ge(7,0,(U^15)*3|0)|0,(se&a|0)==0&((le()|0)&h|0)==0)?y=A:b=4;e:do if((b|0)==4){if(y=(Ci(a,h)|0)!=0,((y?4:5)|0)<(A|0)||Fn(a,h,de)|0||(b=(g[de>>2]|0)+A|0,y?y=22288+(((b|0)%5|0)<<2)|0:y=22320+(((b|0)%6|0)<<2)|0,se=g[y>>2]|0,(se|0)==7))return p=1,re=be,p|0;g[me>>2]=0,y=we(a,h,se,me,G)|0;do if(!y){if(S=G,F=g[S>>2]|0,S=g[S+4>>2]|0,T=S>>>0<h>>>0|(S|0)==(h|0)&F>>>0<a>>>0,b=T?F:a,T=T?S:h,!H&&(H=Ge(7,0,(U^15)*3|0)|0,(F&H|0)==0&(S&(le()|0)|0)==0))y=A;else{if(S=(A+-1+k|0)%(k|0)|0,y=Ci(a,h)|0,(S|0)<0&&Pt(23313,23315,245,23324),k=(y|0)!=0,((k?4:5)|0)<(S|0)&&Pt(23313,23315,245,23324),Fn(a,h,de)|0&&Pt(23313,23315,245,23324),y=(g[de>>2]|0)+S|0,k?y=22288+(((y|0)%5|0)<<2)|0:y=22320+(((y|0)%6|0)<<2)|0,S=g[y>>2]|0,(S|0)==7&&Pt(23313,23315,245,23324),g[Y>>2]=0,y=we(a,h,S,Y,W)|0,y|0)break;F=W,k=g[F>>2]|0,F=g[F+4>>2]|0;do if(F>>>0<T>>>0|(F|0)==(T|0)&k>>>0<b>>>0){if(Ci(k,F)|0?b=Ve(k,F,a,h)|0:b=g[22384+((((g[Y>>2]|0)+(g[22352+(S<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,y=Ci(k,F)|0,(b+-1|0)>>>0>5){y=-1,b=k,T=F;break}if(y=(y|0)!=0,(b|0)==1&y){y=-1,b=k,T=F;break}do if(Fn(k,F,de)|0)y=-1;else if(y){y=((g[21936+(b<<2)>>2]|0)+5-(g[de>>2]|0)|0)%5|0;break}else{y=((g[21968+(b<<2)>>2]|0)+6-(g[de>>2]|0)|0)%6|0;break}while(0);b=k,T=F}else y=A;while(0);S=G,F=g[S>>2]|0,S=g[S+4>>2]|0}if((b|0)==(F|0)&(T|0)==(S|0)){if(k=(Ci(F,S)|0)!=0,k?a=Ve(F,S,a,h)|0:a=g[22384+((((g[me>>2]|0)+(g[22352+(se<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,y=Ci(F,S)|0,(a+-1|0)>>>0<=5&&(Te=(y|0)!=0,!((a|0)==1&Te)))do if(Fn(F,S,de)|0)y=-1;else if(Te){y=((g[21936+(a<<2)>>2]|0)+5-(g[de>>2]|0)|0)%5|0;break}else{y=((g[21968+(a<<2)>>2]|0)+6-(g[de>>2]|0)|0)%6|0;break}while(0);else y=-1;y=y+1|0,y=(y|0)==6|k&(y|0)==5?0:y}h=T,a=b;break e}while(0);return p=y,re=be,p|0}while(0);return Te=Ge(y|0,0,56)|0,de=le()|0|h&-2130706433|536870912,g[p>>2]=Te|a,g[p+4>>2]=de,p=0,re=be,p|0}function Rc(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0;return b=(Ci(a,h)|0)==0,p=Jr(a,h,0,A)|0,y=(p|0)==0,b?!y||(p=Jr(a,h,1,A+8|0)|0,p|0)||(p=Jr(a,h,2,A+16|0)|0,p|0)||(p=Jr(a,h,3,A+24|0)|0,p|0)||(p=Jr(a,h,4,A+32|0)|0,p)?(b=p,b|0):Jr(a,h,5,A+40|0)|0:!y||(p=Jr(a,h,1,A+8|0)|0,p|0)||(p=Jr(a,h,2,A+16|0)|0,p|0)||(p=Jr(a,h,3,A+24|0)|0,p|0)||(p=Jr(a,h,4,A+32|0)|0,p|0)?(b=p,b|0):(b=A+40|0,g[b>>2]=0,g[b+4>>2]=0,b=0,b|0)}function kc(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0,S=0,k=0;return k=re,re=re+192|0,y=k,b=k+168|0,T=it(a|0,h|0,56)|0,le()|0,T=T&7,S=h&-2130706433|134217728,p=Mi(a,S,b)|0,p|0?(S=p,re=k,S|0):(h=it(a|0,h|0,52)|0,le()|0,h=h&15,Ci(a,S)|0?Tl(b,h,T,1,y):Bi(b,h,T,1,y),S=y+8|0,g[A>>2]=g[S>>2],g[A+4>>2]=g[S+4>>2],g[A+8>>2]=g[S+8>>2],g[A+12>>2]=g[S+12>>2],S=0,re=k,S|0)}function Dc(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0;return y=re,re=re+16|0,A=y,!(!0&(h&2013265920|0)==536870912)||(p=h&-2130706433|134217728,!(xo(a,p)|0))?(p=0,re=y,p|0):(b=it(a|0,h|0,56)|0,le()|0,b=(Jr(a,p,b&7,A)|0)==0,p=A,p=b&((g[p>>2]|0)==(a|0)?(g[p+4>>2]|0)==(h|0):0)&1,re=y,p|0)}function Bc(a,h,A){a=a|0,h=h|0,A=A|0;var p=0;(h|0)>0?(p=Or(h,4)|0,g[a>>2]=p,p||Pt(23337,23360,40,23374)):g[a>>2]=0,g[a+4>>2]=h,g[a+8>>2]=0,g[a+12>>2]=A}function Fr(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0;y=a+4|0,b=a+12|0,T=a+8|0;e:for(;;){for(A=g[y>>2]|0,h=0;;){if((h|0)>=(A|0))break e;if(p=g[a>>2]|0,S=g[p+(h<<2)>>2]|0,!S)h=h+1|0;else break}h=p+(~~(+ft(+(+Si(10,+ +(15-(g[b>>2]|0)|0))*(+K[S>>3]+ +K[S+8>>3])))%+(A|0))>>>0<<2)|0,A=g[h>>2]|0;t:do if(A|0){if(p=S+32|0,(A|0)==(S|0))g[h>>2]=g[p>>2];else{if(A=A+32|0,h=g[A>>2]|0,!h)break;for(;(h|0)!=(S|0);)if(A=h+32|0,h=g[A>>2]|0,!h)break t;g[A>>2]=g[p>>2]}Kt(S),g[T>>2]=(g[T>>2]|0)+-1}while(0)}Kt(g[a>>2]|0)}function la(a){a=a|0;var h=0,A=0,p=0;for(p=g[a+4>>2]|0,A=0;;){if((A|0)>=(p|0)){h=0,A=4;break}if(h=g[(g[a>>2]|0)+(A<<2)>>2]|0,!h)A=A+1|0;else{A=4;break}}return(A|0)==4?h|0:0}function It(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0;if(A=~~(+ft(+(+Si(10,+ +(15-(g[a+12>>2]|0)|0))*(+K[h>>3]+ +K[h+8>>3])))%+(g[a+4>>2]|0))>>>0,A=(g[a>>2]|0)+(A<<2)|0,p=g[A>>2]|0,!p)return b=1,b|0;b=h+32|0;do if((p|0)!=(h|0)){if(A=g[p+32>>2]|0,!A)return b=1,b|0;for(y=A;;){if((y|0)==(h|0)){y=8;break}if(A=g[y+32>>2]|0,A)p=y,y=A;else{A=1,y=10;break}}if((y|0)==8){g[p+32>>2]=g[b>>2];break}else if((y|0)==10)return A|0}else g[A>>2]=g[b>>2];while(0);return Kt(h),b=a+8|0,g[b>>2]=(g[b>>2]|0)+-1,b=0,b|0}function Ht(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0;b=sr(40)|0,b||Pt(23390,23360,98,23403),g[b>>2]=g[h>>2],g[b+4>>2]=g[h+4>>2],g[b+8>>2]=g[h+8>>2],g[b+12>>2]=g[h+12>>2],y=b+16|0,g[y>>2]=g[A>>2],g[y+4>>2]=g[A+4>>2],g[y+8>>2]=g[A+8>>2],g[y+12>>2]=g[A+12>>2],g[b+32>>2]=0,y=~~(+ft(+(+Si(10,+ +(15-(g[a+12>>2]|0)|0))*(+K[h>>3]+ +K[h+8>>3])))%+(g[a+4>>2]|0))>>>0,y=(g[a>>2]|0)+(y<<2)|0,p=g[y>>2]|0;do if(!p)g[y>>2]=b;else{for(;!(Kn(p,h)|0&&Kn(p+16|0,A)|0);)if(y=g[p+32>>2]|0,p=y|0?y:p,!(g[p+32>>2]|0)){T=10;break}if((T|0)==10){g[p+32>>2]=b;break}return Kt(b),T=p,T|0}while(0);return T=a+8|0,g[T>>2]=(g[T>>2]|0)+1,T=b,T|0}function ca(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0;if(y=~~(+ft(+(+Si(10,+ +(15-(g[a+12>>2]|0)|0))*(+K[h>>3]+ +K[h+8>>3])))%+(g[a+4>>2]|0))>>>0,y=g[(g[a>>2]|0)+(y<<2)>>2]|0,!y)return A=0,A|0;if(!A){for(a=y;;){if(Kn(a,h)|0){p=10;break}if(a=g[a+32>>2]|0,!a){a=0,p=10;break}}if((p|0)==10)return a|0}for(a=y;;){if(Kn(a,h)|0&&Kn(a+16|0,A)|0){p=10;break}if(a=g[a+32>>2]|0,!a){a=0,p=10;break}}return(p|0)==10?a|0:0}function Nl(a,h){a=a|0,h=h|0;var A=0;if(A=~~(+ft(+(+Si(10,+ +(15-(g[a+12>>2]|0)|0))*(+K[h>>3]+ +K[h+8>>3])))%+(g[a+4>>2]|0))>>>0,a=g[(g[a>>2]|0)+(A<<2)>>2]|0,!a)return A=0,A|0;for(;;){if(Kn(a,h)|0){h=5;break}if(a=g[a+32>>2]|0,!a){a=0,h=5;break}}return(h|0)==5?a|0:0}function zl(){return 23424}function rr(a){return a=+a,+ +C(+a)}function nn(a){return a=+a,~~+rr(a)|0}function sr(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0,se=0,me=0,Te=0,de=0,be=0,ve=0,Ye=0;Ye=re,re=re+16|0,W=Ye;do if(a>>>0<245){if(F=a>>>0<11?16:a+11&-8,a=F>>>3,H=g[5857]|0,A=H>>>a,A&3|0)return h=(A&1^1)+a|0,a=23468+(h<<1<<2)|0,A=a+8|0,p=g[A>>2]|0,y=p+8|0,b=g[y>>2]|0,(b|0)==(a|0)?g[5857]=H&~(1<<h):(g[b+12>>2]=a,g[A>>2]=b),ve=h<<3,g[p+4>>2]=ve|3,ve=p+ve+4|0,g[ve>>2]=g[ve>>2]|1,ve=y,re=Ye,ve|0;if(U=g[5859]|0,F>>>0>U>>>0){if(A|0)return h=2<<a,h=A<<a&(h|0-h),h=(h&0-h)+-1|0,S=h>>>12&16,h=h>>>S,A=h>>>5&8,h=h>>>A,b=h>>>2&4,h=h>>>b,a=h>>>1&2,h=h>>>a,p=h>>>1&1,p=(A|S|b|a|p)+(h>>>p)|0,h=23468+(p<<1<<2)|0,a=h+8|0,b=g[a>>2]|0,S=b+8|0,A=g[S>>2]|0,(A|0)==(h|0)?(a=H&~(1<<p),g[5857]=a):(g[A+12>>2]=h,g[a>>2]=A,a=H),ve=p<<3,T=ve-F|0,g[b+4>>2]=F|3,y=b+F|0,g[y+4>>2]=T|1,g[b+ve>>2]=T,U|0&&(p=g[5862]|0,h=U>>>3,A=23468+(h<<1<<2)|0,h=1<<h,a&h?(a=A+8|0,h=g[a>>2]|0):(g[5857]=a|h,h=A,a=A+8|0),g[a>>2]=p,g[h+12>>2]=p,g[p+8>>2]=h,g[p+12>>2]=A),g[5859]=T,g[5862]=y,ve=S,re=Ye,ve|0;if(b=g[5858]|0,b){for(A=(b&0-b)+-1|0,y=A>>>12&16,A=A>>>y,p=A>>>5&8,A=A>>>p,T=A>>>2&4,A=A>>>T,S=A>>>1&2,A=A>>>S,k=A>>>1&1,k=g[23732+((p|y|T|S|k)+(A>>>k)<<2)>>2]|0,A=k,S=k,k=(g[k+4>>2]&-8)-F|0;a=g[A+16>>2]|0,!(!a&&(a=g[A+20>>2]|0,!a));)T=(g[a+4>>2]&-8)-F|0,y=T>>>0<k>>>0,A=a,S=y?a:S,k=y?T:k;if(T=S+F|0,T>>>0>S>>>0){y=g[S+24>>2]|0,h=g[S+12>>2]|0;do if((h|0)==(S|0)){if(a=S+20|0,h=g[a>>2]|0,!h&&(a=S+16|0,h=g[a>>2]|0,!h)){A=0;break}for(;;)if(p=h+20|0,A=g[p>>2]|0,A)h=A,a=p;else if(p=h+16|0,A=g[p>>2]|0,A)h=A,a=p;else break;g[a>>2]=0,A=h}else A=g[S+8>>2]|0,g[A+12>>2]=h,g[h+8>>2]=A,A=h;while(0);do if(y|0){if(h=g[S+28>>2]|0,a=23732+(h<<2)|0,(S|0)==(g[a>>2]|0)){if(g[a>>2]=A,!A){g[5858]=b&~(1<<h);break}}else if(ve=y+16|0,g[((g[ve>>2]|0)==(S|0)?ve:y+20|0)>>2]=A,!A)break;g[A+24>>2]=y,h=g[S+16>>2]|0,h|0&&(g[A+16>>2]=h,g[h+24>>2]=A),h=g[S+20>>2]|0,h|0&&(g[A+20>>2]=h,g[h+24>>2]=A)}while(0);return k>>>0<16?(ve=k+F|0,g[S+4>>2]=ve|3,ve=S+ve+4|0,g[ve>>2]=g[ve>>2]|1):(g[S+4>>2]=F|3,g[T+4>>2]=k|1,g[T+k>>2]=k,U|0&&(p=g[5862]|0,h=U>>>3,A=23468+(h<<1<<2)|0,h=1<<h,h&H?(a=A+8|0,h=g[a>>2]|0):(g[5857]=h|H,h=A,a=A+8|0),g[a>>2]=p,g[h+12>>2]=p,g[p+8>>2]=h,g[p+12>>2]=A),g[5859]=k,g[5862]=T),ve=S+8|0,re=Ye,ve|0}else H=F}else H=F}else H=F}else if(a>>>0<=4294967231)if(a=a+11|0,F=a&-8,p=g[5858]|0,p){y=0-F|0,a=a>>>8,a?F>>>0>16777215?k=31:(H=(a+1048320|0)>>>16&8,se=a<<H,S=(se+520192|0)>>>16&4,se=se<<S,k=(se+245760|0)>>>16&2,k=14-(S|H|k)+(se<<k>>>15)|0,k=F>>>(k+7|0)&1|k<<1):k=0,A=g[23732+(k<<2)>>2]|0;e:do if(!A)A=0,a=0,se=61;else for(a=0,S=F<<((k|0)==31?0:25-(k>>>1)|0),b=0;;){if(T=(g[A+4>>2]&-8)-F|0,T>>>0<y>>>0)if(T)a=A,y=T;else{a=A,y=0,se=65;break e}if(se=g[A+20>>2]|0,A=g[A+16+(S>>>31<<2)>>2]|0,b=(se|0)==0|(se|0)==(A|0)?b:se,A)S=S<<1;else{A=b,se=61;break}}while(0);if((se|0)==61){if((A|0)==0&(a|0)==0){if(a=2<<k,a=(a|0-a)&p,!a){H=F;break}H=(a&0-a)+-1|0,T=H>>>12&16,H=H>>>T,b=H>>>5&8,H=H>>>b,S=H>>>2&4,H=H>>>S,k=H>>>1&2,H=H>>>k,A=H>>>1&1,a=0,A=g[23732+((b|T|S|k|A)+(H>>>A)<<2)>>2]|0}A?se=65:(S=a,T=y)}if((se|0)==65)for(b=A;;)if(H=(g[b+4>>2]&-8)-F|0,A=H>>>0<y>>>0,y=A?H:y,a=A?b:a,A=g[b+16>>2]|0,A||(A=g[b+20>>2]|0),A)b=A;else{S=a,T=y;break}if(S|0&&T>>>0<((g[5859]|0)-F|0)>>>0&&(U=S+F|0,U>>>0>S>>>0)){b=g[S+24>>2]|0,h=g[S+12>>2]|0;do if((h|0)==(S|0)){if(a=S+20|0,h=g[a>>2]|0,!h&&(a=S+16|0,h=g[a>>2]|0,!h)){h=0;break}for(;;)if(y=h+20|0,A=g[y>>2]|0,A)h=A,a=y;else if(y=h+16|0,A=g[y>>2]|0,A)h=A,a=y;else break;g[a>>2]=0}else ve=g[S+8>>2]|0,g[ve+12>>2]=h,g[h+8>>2]=ve;while(0);do if(b){if(a=g[S+28>>2]|0,A=23732+(a<<2)|0,(S|0)==(g[A>>2]|0)){if(g[A>>2]=h,!h){p=p&~(1<<a),g[5858]=p;break}}else if(ve=b+16|0,g[((g[ve>>2]|0)==(S|0)?ve:b+20|0)>>2]=h,!h)break;g[h+24>>2]=b,a=g[S+16>>2]|0,a|0&&(g[h+16>>2]=a,g[a+24>>2]=h),a=g[S+20>>2]|0,a&&(g[h+20>>2]=a,g[a+24>>2]=h)}while(0);e:do if(T>>>0<16)ve=T+F|0,g[S+4>>2]=ve|3,ve=S+ve+4|0,g[ve>>2]=g[ve>>2]|1;else{if(g[S+4>>2]=F|3,g[U+4>>2]=T|1,g[U+T>>2]=T,h=T>>>3,T>>>0<256){A=23468+(h<<1<<2)|0,a=g[5857]|0,h=1<<h,a&h?(a=A+8|0,h=g[a>>2]|0):(g[5857]=a|h,h=A,a=A+8|0),g[a>>2]=U,g[h+12>>2]=U,g[U+8>>2]=h,g[U+12>>2]=A;break}if(h=T>>>8,h?T>>>0>16777215?A=31:(be=(h+1048320|0)>>>16&8,ve=h<<be,de=(ve+520192|0)>>>16&4,ve=ve<<de,A=(ve+245760|0)>>>16&2,A=14-(de|be|A)+(ve<<A>>>15)|0,A=T>>>(A+7|0)&1|A<<1):A=0,h=23732+(A<<2)|0,g[U+28>>2]=A,a=U+16|0,g[a+4>>2]=0,g[a>>2]=0,a=1<<A,!(p&a)){g[5858]=p|a,g[h>>2]=U,g[U+24>>2]=h,g[U+12>>2]=U,g[U+8>>2]=U;break}h=g[h>>2]|0;t:do if((g[h+4>>2]&-8|0)!=(T|0)){for(p=T<<((A|0)==31?0:25-(A>>>1)|0);A=h+16+(p>>>31<<2)|0,a=g[A>>2]|0,!!a;)if((g[a+4>>2]&-8|0)==(T|0)){h=a;break t}else p=p<<1,h=a;g[A>>2]=U,g[U+24>>2]=h,g[U+12>>2]=U,g[U+8>>2]=U;break e}while(0);be=h+8|0,ve=g[be>>2]|0,g[ve+12>>2]=U,g[be>>2]=U,g[U+8>>2]=ve,g[U+12>>2]=h,g[U+24>>2]=0}while(0);return ve=S+8|0,re=Ye,ve|0}else H=F}else H=F;else H=-1;while(0);if(A=g[5859]|0,A>>>0>=H>>>0)return h=A-H|0,a=g[5862]|0,h>>>0>15?(ve=a+H|0,g[5862]=ve,g[5859]=h,g[ve+4>>2]=h|1,g[a+A>>2]=h,g[a+4>>2]=H|3):(g[5859]=0,g[5862]=0,g[a+4>>2]=A|3,ve=a+A+4|0,g[ve>>2]=g[ve>>2]|1),ve=a+8|0,re=Ye,ve|0;if(T=g[5860]|0,T>>>0>H>>>0)return de=T-H|0,g[5860]=de,ve=g[5863]|0,be=ve+H|0,g[5863]=be,g[be+4>>2]=de|1,g[ve+4>>2]=H|3,ve=ve+8|0,re=Ye,ve|0;if(g[5975]|0?a=g[5977]|0:(g[5977]=4096,g[5976]=4096,g[5978]=-1,g[5979]=-1,g[5980]=0,g[5968]=0,g[5975]=W&-16^1431655768,a=4096),S=H+48|0,k=H+47|0,b=a+k|0,y=0-a|0,F=b&y,F>>>0<=H>>>0||(a=g[5967]|0,a|0&&(U=g[5965]|0,W=U+F|0,W>>>0<=U>>>0|W>>>0>a>>>0)))return ve=0,re=Ye,ve|0;e:do if(g[5968]&4)h=0,se=143;else{A=g[5863]|0;t:do if(A){for(p=23876;W=g[p>>2]|0,!(W>>>0<=A>>>0&&(W+(g[p+4>>2]|0)|0)>>>0>A>>>0);)if(a=g[p+8>>2]|0,a)p=a;else{se=128;break t}if(h=b-T&y,h>>>0<2147483647)if(a=B(h|0)|0,(a|0)==((g[p>>2]|0)+(g[p+4>>2]|0)|0)){if((a|0)!=-1){T=h,b=a,se=145;break e}}else p=a,se=136;else h=0}else se=128;while(0);do if((se|0)==128)if(A=B(0)|0,(A|0)!=-1&&(h=A,Y=g[5976]|0,G=Y+-1|0,h=(G&h|0?(G+h&0-Y)-h|0:0)+F|0,Y=g[5965]|0,G=h+Y|0,h>>>0>H>>>0&h>>>0<2147483647)){if(W=g[5967]|0,W|0&&G>>>0<=Y>>>0|G>>>0>W>>>0){h=0;break}if(a=B(h|0)|0,(a|0)==(A|0)){T=h,b=A,se=145;break e}else p=a,se=136}else h=0;while(0);do if((se|0)==136){if(A=0-h|0,!(S>>>0>h>>>0&(h>>>0<2147483647&(p|0)!=-1)))if((p|0)==-1){h=0;break}else{T=h,b=p,se=145;break e}if(a=g[5977]|0,a=k-h+a&0-a,a>>>0>=2147483647){T=h,b=p,se=145;break e}if((B(a|0)|0)==-1){B(A|0)|0,h=0;break}else{T=a+h|0,b=p,se=145;break e}}while(0);g[5968]=g[5968]|4,se=143}while(0);if((se|0)==143&&F>>>0<2147483647&&(de=B(F|0)|0,G=B(0)|0,me=G-de|0,Te=me>>>0>(H+40|0)>>>0,!((de|0)==-1|Te^1|de>>>0<G>>>0&((de|0)!=-1&(G|0)!=-1)^1))&&(T=Te?me:h,b=de,se=145),(se|0)==145){h=(g[5965]|0)+T|0,g[5965]=h,h>>>0>(g[5966]|0)>>>0&&(g[5966]=h),k=g[5863]|0;e:do if(k){for(h=23876;;){if(a=g[h>>2]|0,A=g[h+4>>2]|0,(b|0)==(a+A|0)){se=154;break}if(p=g[h+8>>2]|0,p)h=p;else break}if((se|0)==154&&(be=h+4|0,(g[h+12>>2]&8|0)==0)&&b>>>0>k>>>0&a>>>0<=k>>>0){g[be>>2]=A+T,ve=(g[5860]|0)+T|0,de=k+8|0,de=de&7|0?0-de&7:0,be=k+de|0,de=ve-de|0,g[5863]=be,g[5860]=de,g[be+4>>2]=de|1,g[k+ve+4>>2]=40,g[5864]=g[5979];break}for(b>>>0<(g[5861]|0)>>>0&&(g[5861]=b),A=b+T|0,h=23876;;){if((g[h>>2]|0)==(A|0)){se=162;break}if(a=g[h+8>>2]|0,a)h=a;else break}if((se|0)==162&&!(g[h+12>>2]&8|0)){g[h>>2]=b,U=h+4|0,g[U>>2]=(g[U>>2]|0)+T,U=b+8|0,U=b+(U&7|0?0-U&7:0)|0,h=A+8|0,h=A+(h&7|0?0-h&7:0)|0,F=U+H|0,S=h-U-H|0,g[U+4>>2]=H|3;t:do if((k|0)==(h|0))ve=(g[5860]|0)+S|0,g[5860]=ve,g[5863]=F,g[F+4>>2]=ve|1;else{if((g[5862]|0)==(h|0)){ve=(g[5859]|0)+S|0,g[5859]=ve,g[5862]=F,g[F+4>>2]=ve|1,g[F+ve>>2]=ve;break}if(a=g[h+4>>2]|0,(a&3|0)==1){T=a&-8,p=a>>>3;i:do if(a>>>0<256)if(a=g[h+8>>2]|0,A=g[h+12>>2]|0,(A|0)==(a|0)){g[5857]=g[5857]&~(1<<p);break}else{g[a+12>>2]=A,g[A+8>>2]=a;break}else{b=g[h+24>>2]|0,a=g[h+12>>2]|0;do if((a|0)==(h|0)){if(A=h+16|0,p=A+4|0,a=g[p>>2]|0,a)A=p;else if(a=g[A>>2]|0,!a){a=0;break}for(;;)if(y=a+20|0,p=g[y>>2]|0,p)a=p,A=y;else if(y=a+16|0,p=g[y>>2]|0,p)a=p,A=y;else break;g[A>>2]=0}else ve=g[h+8>>2]|0,g[ve+12>>2]=a,g[a+8>>2]=ve;while(0);if(!b)break;A=g[h+28>>2]|0,p=23732+(A<<2)|0;do if((g[p>>2]|0)!=(h|0)){if(ve=b+16|0,g[((g[ve>>2]|0)==(h|0)?ve:b+20|0)>>2]=a,!a)break i}else{if(g[p>>2]=a,a|0)break;g[5858]=g[5858]&~(1<<A);break i}while(0);if(g[a+24>>2]=b,A=h+16|0,p=g[A>>2]|0,p|0&&(g[a+16>>2]=p,g[p+24>>2]=a),A=g[A+4>>2]|0,!A)break;g[a+20>>2]=A,g[A+24>>2]=a}while(0);h=h+T|0,y=T+S|0}else y=S;if(h=h+4|0,g[h>>2]=g[h>>2]&-2,g[F+4>>2]=y|1,g[F+y>>2]=y,h=y>>>3,y>>>0<256){A=23468+(h<<1<<2)|0,a=g[5857]|0,h=1<<h,a&h?(a=A+8|0,h=g[a>>2]|0):(g[5857]=a|h,h=A,a=A+8|0),g[a>>2]=F,g[h+12>>2]=F,g[F+8>>2]=h,g[F+12>>2]=A;break}h=y>>>8;do if(!h)p=0;else{if(y>>>0>16777215){p=31;break}be=(h+1048320|0)>>>16&8,ve=h<<be,de=(ve+520192|0)>>>16&4,ve=ve<<de,p=(ve+245760|0)>>>16&2,p=14-(de|be|p)+(ve<<p>>>15)|0,p=y>>>(p+7|0)&1|p<<1}while(0);if(h=23732+(p<<2)|0,g[F+28>>2]=p,a=F+16|0,g[a+4>>2]=0,g[a>>2]=0,a=g[5858]|0,A=1<<p,!(a&A)){g[5858]=a|A,g[h>>2]=F,g[F+24>>2]=h,g[F+12>>2]=F,g[F+8>>2]=F;break}h=g[h>>2]|0;i:do if((g[h+4>>2]&-8|0)!=(y|0)){for(p=y<<((p|0)==31?0:25-(p>>>1)|0);A=h+16+(p>>>31<<2)|0,a=g[A>>2]|0,!!a;)if((g[a+4>>2]&-8|0)==(y|0)){h=a;break i}else p=p<<1,h=a;g[A>>2]=F,g[F+24>>2]=h,g[F+12>>2]=F,g[F+8>>2]=F;break t}while(0);be=h+8|0,ve=g[be>>2]|0,g[ve+12>>2]=F,g[be>>2]=F,g[F+8>>2]=ve,g[F+12>>2]=h,g[F+24>>2]=0}while(0);return ve=U+8|0,re=Ye,ve|0}for(h=23876;a=g[h>>2]|0,!(a>>>0<=k>>>0&&(ve=a+(g[h+4>>2]|0)|0,ve>>>0>k>>>0));)h=g[h+8>>2]|0;y=ve+-47|0,a=y+8|0,a=y+(a&7|0?0-a&7:0)|0,y=k+16|0,a=a>>>0<y>>>0?k:a,h=a+8|0,A=T+-40|0,de=b+8|0,de=de&7|0?0-de&7:0,be=b+de|0,de=A-de|0,g[5863]=be,g[5860]=de,g[be+4>>2]=de|1,g[b+A+4>>2]=40,g[5864]=g[5979],A=a+4|0,g[A>>2]=27,g[h>>2]=g[5969],g[h+4>>2]=g[5970],g[h+8>>2]=g[5971],g[h+12>>2]=g[5972],g[5969]=b,g[5970]=T,g[5972]=0,g[5971]=h,h=a+24|0;do be=h,h=h+4|0,g[h>>2]=7;while((be+8|0)>>>0<ve>>>0);if((a|0)!=(k|0)){if(b=a-k|0,g[A>>2]=g[A>>2]&-2,g[k+4>>2]=b|1,g[a>>2]=b,h=b>>>3,b>>>0<256){A=23468+(h<<1<<2)|0,a=g[5857]|0,h=1<<h,a&h?(a=A+8|0,h=g[a>>2]|0):(g[5857]=a|h,h=A,a=A+8|0),g[a>>2]=k,g[h+12>>2]=k,g[k+8>>2]=h,g[k+12>>2]=A;break}if(h=b>>>8,h?b>>>0>16777215?p=31:(be=(h+1048320|0)>>>16&8,ve=h<<be,de=(ve+520192|0)>>>16&4,ve=ve<<de,p=(ve+245760|0)>>>16&2,p=14-(de|be|p)+(ve<<p>>>15)|0,p=b>>>(p+7|0)&1|p<<1):p=0,A=23732+(p<<2)|0,g[k+28>>2]=p,g[k+20>>2]=0,g[y>>2]=0,h=g[5858]|0,a=1<<p,!(h&a)){g[5858]=h|a,g[A>>2]=k,g[k+24>>2]=A,g[k+12>>2]=k,g[k+8>>2]=k;break}h=g[A>>2]|0;t:do if((g[h+4>>2]&-8|0)!=(b|0)){for(p=b<<((p|0)==31?0:25-(p>>>1)|0);A=h+16+(p>>>31<<2)|0,a=g[A>>2]|0,!!a;)if((g[a+4>>2]&-8|0)==(b|0)){h=a;break t}else p=p<<1,h=a;g[A>>2]=k,g[k+24>>2]=h,g[k+12>>2]=k,g[k+8>>2]=k;break e}while(0);be=h+8|0,ve=g[be>>2]|0,g[ve+12>>2]=k,g[be>>2]=k,g[k+8>>2]=ve,g[k+12>>2]=h,g[k+24>>2]=0}}else ve=g[5861]|0,(ve|0)==0|b>>>0<ve>>>0&&(g[5861]=b),g[5969]=b,g[5970]=T,g[5972]=0,g[5866]=g[5975],g[5865]=-1,g[5870]=23468,g[5869]=23468,g[5872]=23476,g[5871]=23476,g[5874]=23484,g[5873]=23484,g[5876]=23492,g[5875]=23492,g[5878]=23500,g[5877]=23500,g[5880]=23508,g[5879]=23508,g[5882]=23516,g[5881]=23516,g[5884]=23524,g[5883]=23524,g[5886]=23532,g[5885]=23532,g[5888]=23540,g[5887]=23540,g[5890]=23548,g[5889]=23548,g[5892]=23556,g[5891]=23556,g[5894]=23564,g[5893]=23564,g[5896]=23572,g[5895]=23572,g[5898]=23580,g[5897]=23580,g[5900]=23588,g[5899]=23588,g[5902]=23596,g[5901]=23596,g[5904]=23604,g[5903]=23604,g[5906]=23612,g[5905]=23612,g[5908]=23620,g[5907]=23620,g[5910]=23628,g[5909]=23628,g[5912]=23636,g[5911]=23636,g[5914]=23644,g[5913]=23644,g[5916]=23652,g[5915]=23652,g[5918]=23660,g[5917]=23660,g[5920]=23668,g[5919]=23668,g[5922]=23676,g[5921]=23676,g[5924]=23684,g[5923]=23684,g[5926]=23692,g[5925]=23692,g[5928]=23700,g[5927]=23700,g[5930]=23708,g[5929]=23708,g[5932]=23716,g[5931]=23716,ve=T+-40|0,de=b+8|0,de=de&7|0?0-de&7:0,be=b+de|0,de=ve-de|0,g[5863]=be,g[5860]=de,g[be+4>>2]=de|1,g[b+ve+4>>2]=40,g[5864]=g[5979];while(0);if(h=g[5860]|0,h>>>0>H>>>0)return de=h-H|0,g[5860]=de,ve=g[5863]|0,be=ve+H|0,g[5863]=be,g[be+4>>2]=de|1,g[ve+4>>2]=H|3,ve=ve+8|0,re=Ye,ve|0}return ve=zl()|0,g[ve>>2]=12,ve=0,re=Ye,ve|0}function Kt(a){a=a|0;var h=0,A=0,p=0,y=0,b=0,T=0,S=0,k=0;if(a){A=a+-8|0,y=g[5861]|0,a=g[a+-4>>2]|0,h=a&-8,k=A+h|0;do if(a&1)S=A,T=A;else{if(p=g[A>>2]|0,!(a&3)||(T=A+(0-p)|0,b=p+h|0,T>>>0<y>>>0))return;if((g[5862]|0)==(T|0)){if(a=k+4|0,h=g[a>>2]|0,(h&3|0)!=3){S=T,h=b;break}g[5859]=b,g[a>>2]=h&-2,g[T+4>>2]=b|1,g[T+b>>2]=b;return}if(A=p>>>3,p>>>0<256)if(a=g[T+8>>2]|0,h=g[T+12>>2]|0,(h|0)==(a|0)){g[5857]=g[5857]&~(1<<A),S=T,h=b;break}else{g[a+12>>2]=h,g[h+8>>2]=a,S=T,h=b;break}y=g[T+24>>2]|0,a=g[T+12>>2]|0;do if((a|0)==(T|0)){if(h=T+16|0,A=h+4|0,a=g[A>>2]|0,a)h=A;else if(a=g[h>>2]|0,!a){a=0;break}for(;;)if(p=a+20|0,A=g[p>>2]|0,A)a=A,h=p;else if(p=a+16|0,A=g[p>>2]|0,A)a=A,h=p;else break;g[h>>2]=0}else S=g[T+8>>2]|0,g[S+12>>2]=a,g[a+8>>2]=S;while(0);if(y){if(h=g[T+28>>2]|0,A=23732+(h<<2)|0,(g[A>>2]|0)==(T|0)){if(g[A>>2]=a,!a){g[5858]=g[5858]&~(1<<h),S=T,h=b;break}}else if(S=y+16|0,g[((g[S>>2]|0)==(T|0)?S:y+20|0)>>2]=a,!a){S=T,h=b;break}g[a+24>>2]=y,h=T+16|0,A=g[h>>2]|0,A|0&&(g[a+16>>2]=A,g[A+24>>2]=a),h=g[h+4>>2]|0,h?(g[a+20>>2]=h,g[h+24>>2]=a,S=T,h=b):(S=T,h=b)}else S=T,h=b}while(0);if(!(T>>>0>=k>>>0)&&(a=k+4|0,p=g[a>>2]|0,!!(p&1))){if(p&2)g[a>>2]=p&-2,g[S+4>>2]=h|1,g[T+h>>2]=h,y=h;else{if((g[5863]|0)==(k|0)){if(k=(g[5860]|0)+h|0,g[5860]=k,g[5863]=S,g[S+4>>2]=k|1,(S|0)!=(g[5862]|0))return;g[5862]=0,g[5859]=0;return}if((g[5862]|0)==(k|0)){k=(g[5859]|0)+h|0,g[5859]=k,g[5862]=T,g[S+4>>2]=k|1,g[T+k>>2]=k;return}y=(p&-8)+h|0,A=p>>>3;do if(p>>>0<256)if(h=g[k+8>>2]|0,a=g[k+12>>2]|0,(a|0)==(h|0)){g[5857]=g[5857]&~(1<<A);break}else{g[h+12>>2]=a,g[a+8>>2]=h;break}else{b=g[k+24>>2]|0,a=g[k+12>>2]|0;do if((a|0)==(k|0)){if(h=k+16|0,A=h+4|0,a=g[A>>2]|0,a)h=A;else if(a=g[h>>2]|0,!a){A=0;break}for(;;)if(p=a+20|0,A=g[p>>2]|0,A)a=A,h=p;else if(p=a+16|0,A=g[p>>2]|0,A)a=A,h=p;else break;g[h>>2]=0,A=a}else A=g[k+8>>2]|0,g[A+12>>2]=a,g[a+8>>2]=A,A=a;while(0);if(b|0){if(a=g[k+28>>2]|0,h=23732+(a<<2)|0,(g[h>>2]|0)==(k|0)){if(g[h>>2]=A,!A){g[5858]=g[5858]&~(1<<a);break}}else if(p=b+16|0,g[((g[p>>2]|0)==(k|0)?p:b+20|0)>>2]=A,!A)break;g[A+24>>2]=b,a=k+16|0,h=g[a>>2]|0,h|0&&(g[A+16>>2]=h,g[h+24>>2]=A),a=g[a+4>>2]|0,a|0&&(g[A+20>>2]=a,g[a+24>>2]=A)}}while(0);if(g[S+4>>2]=y|1,g[T+y>>2]=y,(S|0)==(g[5862]|0)){g[5859]=y;return}}if(a=y>>>3,y>>>0<256){A=23468+(a<<1<<2)|0,h=g[5857]|0,a=1<<a,h&a?(h=A+8|0,a=g[h>>2]|0):(g[5857]=h|a,a=A,h=A+8|0),g[h>>2]=S,g[a+12>>2]=S,g[S+8>>2]=a,g[S+12>>2]=A;return}a=y>>>8,a?y>>>0>16777215?p=31:(T=(a+1048320|0)>>>16&8,k=a<<T,b=(k+520192|0)>>>16&4,k=k<<b,p=(k+245760|0)>>>16&2,p=14-(b|T|p)+(k<<p>>>15)|0,p=y>>>(p+7|0)&1|p<<1):p=0,a=23732+(p<<2)|0,g[S+28>>2]=p,g[S+20>>2]=0,g[S+16>>2]=0,h=g[5858]|0,A=1<<p;e:do if(!(h&A))g[5858]=h|A,g[a>>2]=S,g[S+24>>2]=a,g[S+12>>2]=S,g[S+8>>2]=S;else{a=g[a>>2]|0;t:do if((g[a+4>>2]&-8|0)!=(y|0)){for(p=y<<((p|0)==31?0:25-(p>>>1)|0);A=a+16+(p>>>31<<2)|0,h=g[A>>2]|0,!!h;)if((g[h+4>>2]&-8|0)==(y|0)){a=h;break t}else p=p<<1,a=h;g[A>>2]=S,g[S+24>>2]=a,g[S+12>>2]=S,g[S+8>>2]=S;break e}while(0);T=a+8|0,k=g[T>>2]|0,g[k+12>>2]=S,g[T>>2]=S,g[S+8>>2]=k,g[S+12>>2]=a,g[S+24>>2]=0}while(0);if(k=(g[5865]|0)+-1|0,g[5865]=k,!(k|0)){for(a=23884;a=g[a>>2]|0,a;)a=a+8|0;g[5865]=-1}}}}function Or(a,h){a=a|0,h=h|0;var A=0;return a?(A=Qt(h,a)|0,(h|a)>>>0>65535&&(A=((A>>>0)/(a>>>0)|0|0)==(h|0)?A:-1)):A=0,a=sr(A)|0,!a||!(g[a+-4>>2]&3)||w(a|0,0,A|0)|0,a|0}function Nt(a,h,A,p){return a=a|0,h=h|0,A=A|0,p=p|0,A=a+A>>>0,Wt(h+p+(A>>>0<a>>>0|0)>>>0|0),A|0|0}function ci(a,h,A,p){return a=a|0,h=h|0,A=A|0,p=p|0,p=h-p-(A>>>0>a>>>0|0)>>>0,Wt(p|0),a-A>>>0|0|0}function eo(a){return a=a|0,(a?31-(bi(a^a-1)|0)|0:32)|0}function to(a,h,A,p,y){a=a|0,h=h|0,A=A|0,p=p|0,y=y|0;var b=0,T=0,S=0,k=0,F=0,U=0,H=0,W=0,Y=0,G=0;if(U=a,k=h,F=k,T=A,W=p,S=W,!F)return b=(y|0)!=0,S?b?(g[y>>2]=a|0,g[y+4>>2]=h&0,W=0,y=0,Wt(W|0),y|0):(W=0,y=0,Wt(W|0),y|0):(b&&(g[y>>2]=(U>>>0)%(T>>>0),g[y+4>>2]=0),W=0,y=(U>>>0)/(T>>>0)>>>0,Wt(W|0),y|0);b=(S|0)==0;do if(T){if(!b){if(b=(bi(S|0)|0)-(bi(F|0)|0)|0,b>>>0<=31){H=b+1|0,S=31-b|0,h=b-31>>31,T=H,a=U>>>(H>>>0)&h|F<<S,h=F>>>(H>>>0)&h,b=0,S=U<<S;break}return y?(g[y>>2]=a|0,g[y+4>>2]=k|h&0,W=0,y=0,Wt(W|0),y|0):(W=0,y=0,Wt(W|0),y|0)}if(b=T-1|0,b&T|0){S=(bi(T|0)|0)+33-(bi(F|0)|0)|0,G=64-S|0,H=32-S|0,k=H>>31,Y=S-32|0,h=Y>>31,T=S,a=H-1>>31&F>>>(Y>>>0)|(F<<H|U>>>(S>>>0))&h,h=h&F>>>(S>>>0),b=U<<G&k,S=(F<<G|U>>>(Y>>>0))&k|U<<H&S-33>>31;break}return y|0&&(g[y>>2]=b&U,g[y+4>>2]=0),(T|0)==1?(Y=k|h&0,G=a|0|0,Wt(Y|0),G|0):(G=eo(T|0)|0,Y=F>>>(G>>>0)|0,G=F<<32-G|U>>>(G>>>0)|0,Wt(Y|0),G|0)}else{if(b)return y|0&&(g[y>>2]=(F>>>0)%(T>>>0),g[y+4>>2]=0),Y=0,G=(F>>>0)/(T>>>0)>>>0,Wt(Y|0),G|0;if(!U)return y|0&&(g[y>>2]=0,g[y+4>>2]=(F>>>0)%(S>>>0)),Y=0,G=(F>>>0)/(S>>>0)>>>0,Wt(Y|0),G|0;if(b=S-1|0,!(b&S))return y|0&&(g[y>>2]=a|0,g[y+4>>2]=b&F|h&0),Y=0,G=F>>>((eo(S|0)|0)>>>0),Wt(Y|0),G|0;if(b=(bi(S|0)|0)-(bi(F|0)|0)|0,b>>>0<=30){h=b+1|0,S=31-b|0,T=h,a=F<<S|U>>>(h>>>0),h=F>>>(h>>>0),b=0,S=U<<S;break}return y?(g[y>>2]=a|0,g[y+4>>2]=k|h&0,Y=0,G=0,Wt(Y|0),G|0):(Y=0,G=0,Wt(Y|0),G|0)}while(0);if(!T)F=S,k=0,S=0;else{H=A|0|0,U=W|p&0,F=Nt(H|0,U|0,-1,-1)|0,A=le()|0,k=S,S=0;do p=k,k=b>>>31|k<<1,b=S|b<<1,p=a<<1|p>>>31|0,W=a>>>31|h<<1|0,ci(F|0,A|0,p|0,W|0)|0,G=le()|0,Y=G>>31|((G|0)<0?-1:0)<<1,S=Y&1,a=ci(p|0,W|0,Y&H|0,(((G|0)<0?-1:0)>>31|((G|0)<0?-1:0)<<1)&U|0)|0,h=le()|0,T=T-1|0;while(T|0);F=k,k=0}return T=0,y|0&&(g[y>>2]=a,g[y+4>>2]=h),Y=(b|0)>>>31|(F|T)<<1|(T<<1|b>>>31)&0|k,G=(b<<1|0)&-2|S,Wt(Y|0),G|0}function $s(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0;return F=h>>31|((h|0)<0?-1:0)<<1,k=((h|0)<0?-1:0)>>31|((h|0)<0?-1:0)<<1,b=p>>31|((p|0)<0?-1:0)<<1,y=((p|0)<0?-1:0)>>31|((p|0)<0?-1:0)<<1,S=ci(F^a|0,k^h|0,F|0,k|0)|0,T=le()|0,a=b^F,h=y^k,ci((to(S,T,ci(b^A|0,y^p|0,b|0,y|0)|0,le()|0,0)|0)^a|0,(le()|0)^h|0,a|0,h|0)|0}function io(a,h){a=a|0,h=h|0;var A=0,p=0,y=0,b=0;return b=a&65535,y=h&65535,A=Qt(y,b)|0,p=a>>>16,a=(A>>>16)+(Qt(y,p)|0)|0,y=h>>>16,h=Qt(y,b)|0,Wt((a>>>16)+(Qt(y,p)|0)+(((a&65535)+h|0)>>>16)|0),a+h<<16|A&65535|0|0}function br(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0;return y=a,b=A,A=io(y,b)|0,a=le()|0,Wt((Qt(h,b)|0)+(Qt(p,y)|0)+a|a&0|0),A|0|0|0}function ko(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0,T=0,S=0,k=0,F=0;return y=re,re=re+16|0,S=y|0,T=h>>31|((h|0)<0?-1:0)<<1,b=((h|0)<0?-1:0)>>31|((h|0)<0?-1:0)<<1,F=p>>31|((p|0)<0?-1:0)<<1,k=((p|0)<0?-1:0)>>31|((p|0)<0?-1:0)<<1,a=ci(T^a|0,b^h|0,T|0,b|0)|0,h=le()|0,to(a,h,ci(F^A|0,k^p|0,F|0,k|0)|0,le()|0,S)|0,p=ci(g[S>>2]^T|0,g[S+4>>2]^b|0,T|0,b|0)|0,A=le()|0,re=y,Wt(A|0),p|0}function Ws(a,h,A,p){a=a|0,h=h|0,A=A|0,p=p|0;var y=0,b=0;return b=re,re=re+16|0,y=b|0,to(a,h,A,p,y)|0,re=b,Wt(g[y+4>>2]|0),g[y>>2]|0|0}function $a(a,h,A){return a=a|0,h=h|0,A=A|0,(A|0)<32?(Wt(h>>A|0),a>>>A|(h&(1<<A)-1)<<32-A):(Wt(((h|0)<0?-1:0)|0),h>>A-32|0)}function it(a,h,A){return a=a|0,h=h|0,A=A|0,(A|0)<32?(Wt(h>>>A|0),a>>>A|(h&(1<<A)-1)<<32-A):(Wt(0),h>>>A-32|0)}function Ge(a,h,A){return a=a|0,h=h|0,A=A|0,(A|0)<32?(Wt(h<<A|(a&(1<<A)-1<<32-A)>>>32-A|0),a<<A):(Wt(a<<A-32|0),0)}function E(a,h){return a=+a,h=+h,a!=a?+h:h!=h?+a:+jr(+a,+h)}function n(a,h){return a=+a,h=+h,a!=a?+h:h!=h?+a:+zs(+a,+h)}function d(a){return a=+a,a>=0?+Zt(a+.5):+Vr(a-.5)}function v(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0;if((A|0)>=8192)return rn(a|0,h|0,A|0)|0,a|0;if(b=a|0,y=a+A|0,(a&3)==(h&3)){for(;a&3;){if(!A)return b|0;et[a>>0]=et[h>>0]|0,a=a+1|0,h=h+1|0,A=A-1|0}for(A=y&-4|0,p=A-64|0;(a|0)<=(p|0);)g[a>>2]=g[h>>2],g[a+4>>2]=g[h+4>>2],g[a+8>>2]=g[h+8>>2],g[a+12>>2]=g[h+12>>2],g[a+16>>2]=g[h+16>>2],g[a+20>>2]=g[h+20>>2],g[a+24>>2]=g[h+24>>2],g[a+28>>2]=g[h+28>>2],g[a+32>>2]=g[h+32>>2],g[a+36>>2]=g[h+36>>2],g[a+40>>2]=g[h+40>>2],g[a+44>>2]=g[h+44>>2],g[a+48>>2]=g[h+48>>2],g[a+52>>2]=g[h+52>>2],g[a+56>>2]=g[h+56>>2],g[a+60>>2]=g[h+60>>2],a=a+64|0,h=h+64|0;for(;(a|0)<(A|0);)g[a>>2]=g[h>>2],a=a+4|0,h=h+4|0}else for(A=y-4|0;(a|0)<(A|0);)et[a>>0]=et[h>>0]|0,et[a+1>>0]=et[h+1>>0]|0,et[a+2>>0]=et[h+2>>0]|0,et[a+3>>0]=et[h+3>>0]|0,a=a+4|0,h=h+4|0;for(;(a|0)<(y|0);)et[a>>0]=et[h>>0]|0,a=a+1|0,h=h+1|0;return b|0}function w(a,h,A){a=a|0,h=h|0,A=A|0;var p=0,y=0,b=0,T=0;if(b=a+A|0,h=h&255,(A|0)>=67){for(;a&3;)et[a>>0]=h,a=a+1|0;for(p=b&-4|0,T=h|h<<8|h<<16|h<<24,y=p-64|0;(a|0)<=(y|0);)g[a>>2]=T,g[a+4>>2]=T,g[a+8>>2]=T,g[a+12>>2]=T,g[a+16>>2]=T,g[a+20>>2]=T,g[a+24>>2]=T,g[a+28>>2]=T,g[a+32>>2]=T,g[a+36>>2]=T,g[a+40>>2]=T,g[a+44>>2]=T,g[a+48>>2]=T,g[a+52>>2]=T,g[a+56>>2]=T,g[a+60>>2]=T,a=a+64|0;for(;(a|0)<(p|0);)g[a>>2]=T,a=a+4|0}for(;(a|0)<(b|0);)et[a>>0]=h,a=a+1|0;return b-A|0}function C(a){return a=+a,a>=0?+Zt(a+.5):+Vr(a-.5)}function B(a){a=a|0;var h=0,A=0,p=0;return p=un()|0,A=g[Bt>>2]|0,h=A+a|0,(a|0)>0&(h|0)<(A|0)|(h|0)<0?(fi(h|0)|0,Ti(12),-1):(h|0)>(p|0)&&!(Pi(h|0)|0)?(Ti(12),-1):(g[Bt>>2]=h,A|0)}return{___divdi3:$s,___muldi3:br,___remdi3:ko,___uremdi3:Ws,_areNeighborCells:vl,_bitshift64Ashr:$a,_bitshift64Lshr:it,_bitshift64Shl:Ge,_calloc:Or,_cellAreaKm2:za,_cellAreaM2:_n,_cellAreaRads2:js,_cellToBoundary:yr,_cellToCenterChild:ea,_cellToChildPos:sa,_cellToChildren:El,_cellToChildrenSize:To,_cellToLatLng:Vs,_cellToLocalIj:Mo,_cellToParent:wo,_cellToVertex:Jr,_cellToVertexes:Rc,_cellsToDirectedEdge:yo,_cellsToLinkedMultiPolygon:Er,_childPosToCell:Po,_compactCells:ta,_destroyLinkedMultiPolygon:Jn,_directedEdgeToBoundary:Us,_directedEdgeToCells:Qn,_edgeLengthKm:zh,_edgeLengthM:Il,_edgeLengthRads:mn,_emscripten_replace_memory:Ii,_free:Kt,_getBaseCellNumber:Ba,_getDirectedEdgeDestination:mc,_getDirectedEdgeOrigin:_c,_getHexagonAreaAvgKm2:Tc,_getHexagonAreaAvgM2:Ec,_getHexagonEdgeLengthAvgKm:Sc,_getHexagonEdgeLengthAvgM:gn,_getIcosahedronFaces:Co,_getNumCells:Na,_getPentagons:pn,_getRes0Cells:Ra,_getResolution:vc,_greatCircleDistanceKm:Qr,_greatCircleDistanceM:na,_greatCircleDistanceRads:wc,_gridDisk:fo,_gridDiskDistances:Zn,_gridDistance:dt,_gridPathCells:Rl,_gridPathCellsSize:Ml,_gridRingUnsafe:rt,_i64Add:Nt,_i64Subtract:ci,_isPentagon:Ci,_isResClassIII:Nh,_isValidCell:xo,_isValidDirectedEdge:xl,_isValidVertex:Dc,_latLngToCell:ra,_llvm_maxnum_f64:E,_llvm_minnum_f64:n,_llvm_round_f64:d,_localIjToCell:Pc,_malloc:sr,_maxFaceCount:So,_maxGridDiskSize:qo,_maxPolygonToCellsSize:Et,_memcpy:v,_memset:w,_originToDirectedEdges:yc,_pentagonCount:La,_polygonToCells:Ji,_readInt64AsDoubleFromPointer:aa,_res0CellCount:Ts,_round:C,_sbrk:B,_sizeOfCellBoundary:Bl,_sizeOfCoordIJ:Bn,_sizeOfGeoLoop:Fl,_sizeOfGeoPolygon:Ol,_sizeOfH3Index:Uh,_sizeOfLatLng:Dl,_sizeOfLinkedGeoPolygon:Kr,_uncompactCells:Lh,_uncompactCellsSize:Sl,_vertexToLatLng:kc,establishStackSpace:ws,stackAlloc:Yr,stackRestore:Ao,stackSave:Gr}}(ns,Gt,Vt);e.___divdi3=Ke.___divdi3,e.___muldi3=Ke.___muldi3,e.___remdi3=Ke.___remdi3,e.___uremdi3=Ke.___uremdi3,e._areNeighborCells=Ke._areNeighborCells,e._bitshift64Ashr=Ke._bitshift64Ashr,e._bitshift64Lshr=Ke._bitshift64Lshr,e._bitshift64Shl=Ke._bitshift64Shl,e._calloc=Ke._calloc,e._cellAreaKm2=Ke._cellAreaKm2,e._cellAreaM2=Ke._cellAreaM2,e._cellAreaRads2=Ke._cellAreaRads2,e._cellToBoundary=Ke._cellToBoundary,e._cellToCenterChild=Ke._cellToCenterChild,e._cellToChildPos=Ke._cellToChildPos,e._cellToChildren=Ke._cellToChildren,e._cellToChildrenSize=Ke._cellToChildrenSize,e._cellToLatLng=Ke._cellToLatLng,e._cellToLocalIj=Ke._cellToLocalIj,e._cellToParent=Ke._cellToParent,e._cellToVertex=Ke._cellToVertex,e._cellToVertexes=Ke._cellToVertexes,e._cellsToDirectedEdge=Ke._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=Ke._cellsToLinkedMultiPolygon,e._childPosToCell=Ke._childPosToCell,e._compactCells=Ke._compactCells,e._destroyLinkedMultiPolygon=Ke._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=Ke._directedEdgeToBoundary,e._directedEdgeToCells=Ke._directedEdgeToCells,e._edgeLengthKm=Ke._edgeLengthKm,e._edgeLengthM=Ke._edgeLengthM,e._edgeLengthRads=Ke._edgeLengthRads;var fe=e._emscripten_replace_memory=Ke._emscripten_replace_memory;e._free=Ke._free,e._getBaseCellNumber=Ke._getBaseCellNumber,e._getDirectedEdgeDestination=Ke._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=Ke._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=Ke._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=Ke._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=Ke._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=Ke._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=Ke._getIcosahedronFaces,e._getNumCells=Ke._getNumCells,e._getPentagons=Ke._getPentagons,e._getRes0Cells=Ke._getRes0Cells,e._getResolution=Ke._getResolution,e._greatCircleDistanceKm=Ke._greatCircleDistanceKm,e._greatCircleDistanceM=Ke._greatCircleDistanceM,e._greatCircleDistanceRads=Ke._greatCircleDistanceRads,e._gridDisk=Ke._gridDisk,e._gridDiskDistances=Ke._gridDiskDistances,e._gridDistance=Ke._gridDistance,e._gridPathCells=Ke._gridPathCells,e._gridPathCellsSize=Ke._gridPathCellsSize,e._gridRingUnsafe=Ke._gridRingUnsafe,e._i64Add=Ke._i64Add,e._i64Subtract=Ke._i64Subtract,e._isPentagon=Ke._isPentagon,e._isResClassIII=Ke._isResClassIII,e._isValidCell=Ke._isValidCell,e._isValidDirectedEdge=Ke._isValidDirectedEdge,e._isValidVertex=Ke._isValidVertex,e._latLngToCell=Ke._latLngToCell,e._llvm_maxnum_f64=Ke._llvm_maxnum_f64,e._llvm_minnum_f64=Ke._llvm_minnum_f64,e._llvm_round_f64=Ke._llvm_round_f64,e._localIjToCell=Ke._localIjToCell,e._malloc=Ke._malloc,e._maxFaceCount=Ke._maxFaceCount,e._maxGridDiskSize=Ke._maxGridDiskSize,e._maxPolygonToCellsSize=Ke._maxPolygonToCellsSize,e._memcpy=Ke._memcpy,e._memset=Ke._memset,e._originToDirectedEdges=Ke._originToDirectedEdges,e._pentagonCount=Ke._pentagonCount,e._polygonToCells=Ke._polygonToCells,e._readInt64AsDoubleFromPointer=Ke._readInt64AsDoubleFromPointer,e._res0CellCount=Ke._res0CellCount,e._round=Ke._round,e._sbrk=Ke._sbrk,e._sizeOfCellBoundary=Ke._sizeOfCellBoundary,e._sizeOfCoordIJ=Ke._sizeOfCoordIJ,e._sizeOfGeoLoop=Ke._sizeOfGeoLoop,e._sizeOfGeoPolygon=Ke._sizeOfGeoPolygon,e._sizeOfH3Index=Ke._sizeOfH3Index,e._sizeOfLatLng=Ke._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=Ke._sizeOfLinkedGeoPolygon,e._uncompactCells=Ke._uncompactCells,e._uncompactCellsSize=Ke._uncompactCellsSize,e._vertexToLatLng=Ke._vertexToLatLng,e.establishStackSpace=Ke.establishStackSpace;var X=e.stackAlloc=Ke.stackAlloc,Q=e.stackRestore=Ke.stackRestore,ae=e.stackSave=Ke.stackSave;if(e.asm=Ke,e.cwrap=Oe,e.setValue=q,e.getValue=ne,_i){vi(_i)||(_i=u(_i));{en();var pe=function(ue){ue.byteLength&&(ue=new Uint8Array(ue)),$t.set(ue,V),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,Xe()},ge=function(){_(_i,pe,function(){throw"could not load memory initializer "+_i})},ke=Ar(_i);if(ke)pe(ke.buffer);else if(e.memoryInitializerRequest){var Pe=function(){var ue=e.memoryInitializerRequest,Se=ue.response;if(ue.status!==200&&ue.status!==0){var We=Ar(e.memoryInitializerRequestURL);if(We)Se=We.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+ue.status+", retrying "+_i),ge();return}}pe(Se)};e.memoryInitializerRequest.response?setTimeout(Pe,0):e.memoryInitializerRequest.addEventListener("load",Pe)}else ge()}}var ye;Ur=function ue(){ye||Me(),ye||(Ur=ue)};function Me(ue){if(Ki>0||(Qi(),Ki>0))return;function Se(){ye||(ye=!0,!Ae&&(Dr(),yi(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),ki()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),Se()},1)):Se()}e.run=Me;function qe(ue){throw e.onAbort&&e.onAbort(ue),ue+="",l(ue),I(ue),Ae=!0,"abort("+ue+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=qe,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return Me(),t}(typeof ei=="object"?ei:{}),hi="number",ii=hi,pu=hi,ri=hi,si=hi,Bs=hi,Ut=hi,CF=[["sizeOfH3Index",hi],["sizeOfLatLng",hi],["sizeOfCellBoundary",hi],["sizeOfGeoLoop",hi],["sizeOfGeoPolygon",hi],["sizeOfLinkedGeoPolygon",hi],["sizeOfCoordIJ",hi],["readInt64AsDoubleFromPointer",hi],["isValidCell",pu,[ri,si]],["latLngToCell",ii,[hi,hi,Bs,Ut]],["cellToLatLng",ii,[ri,si,Ut]],["cellToBoundary",ii,[ri,si,Ut]],["maxGridDiskSize",ii,[hi,Ut]],["gridDisk",ii,[ri,si,hi,Ut]],["gridDiskDistances",ii,[ri,si,hi,Ut,Ut]],["gridRingUnsafe",ii,[ri,si,hi,Ut]],["maxPolygonToCellsSize",ii,[Ut,Bs,hi,Ut]],["polygonToCells",ii,[Ut,Bs,hi,Ut]],["cellsToLinkedMultiPolygon",ii,[Ut,hi,Ut]],["destroyLinkedMultiPolygon",null,[Ut]],["compactCells",ii,[Ut,Ut,hi,hi]],["uncompactCells",ii,[Ut,hi,hi,Ut,hi,Bs]],["uncompactCellsSize",ii,[Ut,hi,hi,Bs,Ut]],["isPentagon",pu,[ri,si]],["isResClassIII",pu,[ri,si]],["getBaseCellNumber",hi,[ri,si]],["getResolution",hi,[ri,si]],["maxFaceCount",ii,[ri,si,Ut]],["getIcosahedronFaces",ii,[ri,si,Ut]],["cellToParent",ii,[ri,si,Bs,Ut]],["cellToChildren",ii,[ri,si,Bs,Ut]],["cellToCenterChild",ii,[ri,si,Bs,Ut]],["cellToChildrenSize",ii,[ri,si,Bs,Ut]],["cellToChildPos",ii,[ri,si,Bs,Ut]],["childPosToCell",ii,[hi,hi,ri,si,Bs,Ut]],["areNeighborCells",ii,[ri,si,ri,si,Ut]],["cellsToDirectedEdge",ii,[ri,si,ri,si,Ut]],["getDirectedEdgeOrigin",ii,[ri,si,Ut]],["getDirectedEdgeDestination",ii,[ri,si,Ut]],["isValidDirectedEdge",pu,[ri,si]],["directedEdgeToCells",ii,[ri,si,Ut]],["originToDirectedEdges",ii,[ri,si,Ut]],["directedEdgeToBoundary",ii,[ri,si,Ut]],["gridDistance",ii,[ri,si,ri,si,Ut]],["gridPathCells",ii,[ri,si,ri,si,Ut]],["gridPathCellsSize",ii,[ri,si,ri,si,Ut]],["cellToLocalIj",ii,[ri,si,ri,si,hi,Ut]],["localIjToCell",ii,[ri,si,Ut,hi,Ut]],["getHexagonAreaAvgM2",ii,[Bs,Ut]],["getHexagonAreaAvgKm2",ii,[Bs,Ut]],["getHexagonEdgeLengthAvgM",ii,[Bs,Ut]],["getHexagonEdgeLengthAvgKm",ii,[Bs,Ut]],["greatCircleDistanceM",hi,[Ut,Ut]],["greatCircleDistanceKm",hi,[Ut,Ut]],["greatCircleDistanceRads",hi,[Ut,Ut]],["cellAreaM2",ii,[ri,si,Ut]],["cellAreaKm2",ii,[ri,si,Ut]],["cellAreaRads2",ii,[ri,si,Ut]],["edgeLengthM",ii,[ri,si,Ut]],["edgeLengthKm",ii,[ri,si,Ut]],["edgeLengthRads",ii,[ri,si,Ut]],["getNumCells",ii,[Bs,Ut]],["getRes0Cells",ii,[Ut]],["res0CellCount",hi],["getPentagons",ii,[hi,Ut]],["pentagonCount",hi],["cellToVertex",ii,[ri,si,hi,Ut]],["cellToVertexes",ii,[ri,si,Ut]],["vertexToLatLng",ii,[ri,si,Ut]],["isValidVertex",pu,[ri,si]]],PF=0,IF=1,MF=2,RF=3,mx=4,kF=5,DF=6,BF=7,FF=8,OF=9,LF=10,NF=11,zF=12,UF=13,VF=14,jF=15,_s={};_s[PF]="Success";_s[IF]="The operation failed but a more specific error is not available";_s[MF]="Argument was outside of acceptable range";_s[RF]="Latitude or longitude arguments were outside of acceptable range";_s[mx]="Resolution argument was outside of acceptable range";_s[kF]="Cell argument was not valid";_s[DF]="Directed edge argument was not valid";_s[BF]="Undirected edge argument was not valid";_s[FF]="Vertex argument was not valid";_s[OF]="Pentagon distortion was encountered";_s[LF]="Duplicate input";_s[NF]="Cell arguments were not neighbors";_s[zF]="Cell arguments had incompatible resolutions";_s[UF]="Memory allocation failed";_s[VF]="Bounds of provided memory were insufficient";_s[jF]="Mode or flags argument was not valid";var Lg=1e3,yx=1001,bx=1002,Ad={};Ad[Lg]="Unknown unit";Ad[yx]="Array length out of bounds";Ad[bx]="Got unexpected null value for H3 index";var $F="Unknown error";function vx(t,e,i){var r=i&&"value"in i,o=new Error((t[e]||$F)+" (code: "+e+(r?", value: "+i.value:"")+")");return o.code=e,o}function xx(t,e){var i=arguments.length===2?{value:e}:{};return vx(_s,t,i)}function fd(t,e){var i=arguments.length===2?{value:e}:{};return vx(Ad,t,i)}function Qs(t){if(t!==0)throw xx(t)}var Gi={};CF.forEach(function(e){Gi[e[0]]=ei.cwrap.apply(ei,e)});var fh=16,Hu=4,Ca=8,Ng=8,ac=Gi.sizeOfH3Index(),zg=Gi.sizeOfLatLng(),WF=Gi.sizeOfCellBoundary(),HF=Gi.sizeOfGeoPolygon(),Mu=Gi.sizeOfGeoLoop();Gi.sizeOfLinkedGeoPolygon();Gi.sizeOfCoordIJ();var bh={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function wx(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw xx(mx,t);return t}function Tx(t){if(!t)throw fd(bx);return t}var qF=Math.pow(2,32)-1;function Ex(t){if(t>qF)throw fd(yx,t);return t}var XF=/[^0-9a-fA-F]/;function Wo(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||XF.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),fh),i=parseInt(t.substring(t.length-8),fh);return[i,e]}function y2(t){if(t>=0)return t.toString(fh);t=t&2147483647;var e=Sx(8,t.toString(fh)),i=(parseInt(e[0],fh)+8).toString(fh);return e=i+e.substring(1),e}function ZF(t,e){return y2(e)+Sx(8,y2(t))}function Sx(t,e){for(var i=t-e.length,r="",o=0;o<i;o++)r+="0";return r=r+e,r}function b2(t,e,i){for(var r=t.length,o=ei._calloc(r,zg),u=i?1:0,_=i?0:1,l=0;l<r*2;l+=2)ei.HEAPF64.set([t[l/2][u],t[l/2][_]].map(Mx),o/Ca+l);return ei.HEAPU32.set([r,o],e/Hu),e}function YF(t,e){var i=t.length-1,r=ei._calloc(HF),o=0,u=o+Mu,_=u+Hu;b2(t[0],r+o,e);var l;if(i>0){l=ei._calloc(i,Mu);for(var I=0;I<i;I++)b2(t[I+1],l+Mu*I,e)}return ei.setValue(r+u,i,"i32"),ei.setValue(r+_,l,"i32"),r}function GF(t){var e=0,i=e+Mu,r=i+Hu,o=Hu;ei._free(ei.getValue(t+e+o,"i8*"));var u=ei.getValue(t+i,"i32");if(u>0){for(var _=ei.getValue(t+r,"i32"),l=0;l<u;l++)ei._free(ei.getValue(_+Mu*l+o,"i8*"));ei._free(_)}ei._free(t)}function Ug(t,e){e===void 0&&(e=0);var i=ei.getValue(t+ac*e,"i32"),r=ei.getValue(t+ac*e+Hu,"i32");return r?ZF(i,r):null}function Cx(t,e){return e===void 0&&(e=0),ei.getValue(t+Ca*e,"double")}function Vg(t){return Gi.readInt64AsDoubleFromPointer(t)}function jg(t,e){for(var i=[],r=0;r<e;r++){var o=Ug(t,r);o!==null&&i.push(o)}return i}function Of(t){return aO(ei.getValue(t,"double"))}function Px(t){return[Of(t),Of(t+Ca)]}function QF(t){return[Of(t+Ca),Of(t)]}function KF(t,e,i){for(var r=ei.getValue(t,"i32"),o=t+Ca,u=[],_=e?QF:Px,l=0;l<r*2;l+=2)u.push(_(o+Ca*l));return i&&u.push(u[0]),u}function JF(t){var e=Wo(t),i=e[0],r=e[1];return!!Gi.isPentagon(i,r)}function Np(t){var e=Wo(t),i=e[0],r=e[1];return Gi.isValidCell(i,r)?Gi.getResolution(i,r):-1}function $g(t,e,i){var r=ei._malloc(zg);ei.HEAPF64.set([t,e].map(Mx),r/Ca);var o=ei._malloc(ac);try{return Qs(Gi.latLngToCell(r,i,o)),Tx(Ug(o))}finally{ei._free(o),ei._free(r)}}function Wg(t){var e=ei._malloc(zg),i=Wo(t),r=i[0],o=i[1];try{return Qs(Gi.cellToLatLng(r,o,e)),Px(e)}finally{ei._free(e)}}function Ix(t,e){var i=ei._malloc(WF),r=Wo(t),o=r[0],u=r[1];try{return Qs(Gi.cellToBoundary(o,u,i)),KF(i,e,e)}finally{ei._free(i)}}function eO(t,e){var i=Wo(t),r=i[0],o=i[1],u=ei._malloc(ac);try{return Qs(Gi.cellToParent(r,o,e,u)),Tx(Ug(u))}finally{ei._free(u)}}function tO(t,e){var i=Wo(t),r=i[0],o=i[1],u=ei._malloc(Ng);try{Qs(Gi.maxGridDiskSize(e,u));var _=Ex(Vg(u)),l=ei._calloc(_,ac);try{return Qs(Gi.gridDisk(r,o,e,l)),jg(l,_)}finally{ei._free(l)}}finally{ei._free(u)}}function iO(t,e,i){if(wx(e),i=!!i,t.length===0||t[0].length===0)return[];var r=typeof t[0][0]=="number"?[t]:t,o=YF(r,i),u=ei._malloc(Ng);try{Qs(Gi.maxPolygonToCellsSize(o,e,0,u));var _=Ex(Vg(u)),l=ei._calloc(_,ac);try{return Qs(Gi.polygonToCells(o,e,0,l)),jg(l,_)}finally{ei._free(l)}}finally{ei._free(u),GF(o)}}function rO(t){var e=Wo(t),i=e[0],r=e[1],o=6,u=ei._calloc(o,ac);try{return Qs(Gi.originToDirectedEdges(i,r,u)),jg(u,o)}finally{ei._free(u)}}function sO(t,e){var i=Wo(t),r=i[0],o=i[1],u=Wo(e),_=u[0],l=u[1],I=ei._malloc(Ng);try{return Qs(Gi.gridDistance(r,o,_,l,I)),Vg(I)}finally{ei._free(I)}}function nO(t,e){var i=Wo(t),r=i[0],o=i[1],u=ei._malloc(Ca);try{switch(e){case bh.m:Qs(Gi.edgeLengthM(r,o,u));break;case bh.km:Qs(Gi.edgeLengthKm(r,o,u));break;case bh.rads:Qs(Gi.edgeLengthRads(r,o,u));break;default:throw fd(Lg,e)}return Cx(u)}finally{ei._free(u)}}function oO(t,e){wx(t);var i=ei._malloc(Ca);try{switch(e){case bh.m:Qs(Gi.getHexagonEdgeLengthAvgM(t,i));break;case bh.km:Qs(Gi.getHexagonEdgeLengthAvgKm(t,i));break;default:throw fd(Lg,e)}return Cx(i)}finally{ei._free(i)}}function Mx(t){return t*Math.PI/180}function aO(t){return t*180/Math.PI}function Rx(t,e){e=e===void 0?t[0][0]:e;for(const i of t){const r=i[0]-e;r>180?i[0]-=360:r<-180&&(i[0]+=360)}}function lO(t,e,i){const[r,o]=Wg(t),u=e.length;Rx(e,o);const _=e[0]===e[u-1]?u-1:u;for(let l=0;l<_;l++)e[l][0]=Th(o,e[l][0],i),e[l][1]=Th(r,e[l][1],i)}function cO(t,e,i){const r=t(e,i),[o,u]=Wg(r);return[u,o]}function v2(t,e=1){const i=Ix(t,!0);return e!==1?lO(t,i,e):Rx(i),i}function hO(t){const e=new Float64Array(t.length*2);let i=0;for(const r of t)e[i++]=r[0],e[i++]=r[1];return e}const uO=10;function AO(t,e){let i;return t==null?i=e:typeof t=="object"?i={...t,coverage:e}:i={getHexagon:t,coverage:e},i}const fO={...ax.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0};class Fh extends Bh{initializeState(){Fh._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:i}){if(e.highPrecision!==!0&&(i.dataChanged||i.updateTriggersChanged&&i.updateTriggersChanged.getHexagon)){const r=this._calculateH3DataProps();this.setState(r)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,i=!1,r=!1;const{iterable:o,objectInfo:u}=Dh(this.props.data);for(const _ of o){u.index++;const l=this.props.getHexagon(_,u),I=Np(l);if(e<0){if(e=I,!this.props.highPrecision)break}else if(e!==I){r=!0;break}if(JF(l)){i=!0;break}}return{resolution:e,edgeLengthKM:e>=0?oO(e,"km"):0,hasMultipleRes:r,hasPentagon:i}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:i,hasMultipleRes:r}=this.state,{viewport:o}=this.context;return!!(o!=null&&o.resolution)||r||i||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:i,edgeLengthKM:r,centerHex:o}=this.state;if(i<0)return;const u=this.props.centerHexagon||$g(e.latitude,e.longitude,i);if(o===u)return;if(o)try{if(sO(o,u)*r<uO)return}catch{}const{unitsPerMeter:_}=e.distanceScales;let l=v2(u);const[I,R]=Wg(u),[L,z]=e.projectFlat([R,I]);l=l.map(V=>{const q=e.projectFlat(V);return[(q[0]-L)/_[0],(q[1]-z)/_[1]]}),this.setState({centerHex:u,vertices:l})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:i,coverage:r,extruded:o,wireframe:u,stroked:_,filled:l,lineWidthUnits:I,lineWidthScale:R,lineWidthMinPixels:L,lineWidthMaxPixels:z,getFillColor:V,getElevation:q,getLineColor:ne,getLineWidth:Ae,transitions:Ee,updateTriggers:Ce}=this.props;return{elevationScale:e,extruded:o,coverage:r,wireframe:u,stroked:_,filled:l,lineWidthUnits:I,lineWidthScale:R,lineWidthMinPixels:L,lineWidthMaxPixels:z,material:i,getElevation:q,getFillColor:V,getLineColor:ne,getLineWidth:Ae,transitions:Ee,updateTriggers:{getFillColor:Ce.getFillColor,getElevation:Ce.getElevation,getLineColor:Ce.getLineColor,getLineWidth:Ce.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:i,updateTriggers:r,coverage:o}=this.props,u=this.getSubLayerClass("hexagon-cell-hifi",ax),_=this._getForwardProps();return _.updateTriggers.getPolygon=AO(r.getHexagon,o),new u(_,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:_.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(l,I)=>{const R=i(l,I);return hO(v2(R,o))}})}_renderColumnLayer(){const{data:e,getHexagon:i,updateTriggers:r}=this.props,o=this.getSubLayerClass("hexagon-cell",mD),u=this._getForwardProps();return u.updateTriggers.getPosition=r.getHexagon,new o(u,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:u.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:cO.bind(null,i)})}}Fh.defaultProps=fO;Fh.layerName="H3HexagonLayer";Fh._checkH3Lib=()=>{};const kx=Fh;var Hg={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Hg.read=function(t,e,i,r,o){var u,_,l=o*8-r-1,I=(1<<l)-1,R=I>>1,L=-7,z=i?o-1:0,V=i?-1:1,q=t[e+z];for(z+=V,u=q&(1<<-L)-1,q>>=-L,L+=l;L>0;u=u*256+t[e+z],z+=V,L-=8);for(_=u&(1<<-L)-1,u>>=-L,L+=r;L>0;_=_*256+t[e+z],z+=V,L-=8);if(u===0)u=1-R;else{if(u===I)return _?NaN:(q?-1:1)*(1/0);_=_+Math.pow(2,r),u=u-R}return(q?-1:1)*_*Math.pow(2,u-r)};Hg.write=function(t,e,i,r,o,u){var _,l,I,R=u*8-o-1,L=(1<<R)-1,z=L>>1,V=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=r?0:u-1,ne=r?1:-1,Ae=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,_=L):(_=Math.floor(Math.log(e)/Math.LN2),e*(I=Math.pow(2,-_))<1&&(_--,I*=2),_+z>=1?e+=V/I:e+=V*Math.pow(2,1-z),e*I>=2&&(_++,I/=2),_+z>=L?(l=0,_=L):_+z>=1?(l=(e*I-1)*Math.pow(2,o),_=_+z):(l=e*Math.pow(2,z-1)*Math.pow(2,o),_=0));o>=8;t[i+q]=l&255,q+=ne,l/=256,o-=8);for(_=_<<o|l,R+=o;R>0;t[i+q]=_&255,q+=ne,_/=256,R-=8);t[i+q-ne]|=Ae*128};var dO=Ni,QA=Hg;function Ni(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ni.Varint=0;Ni.Fixed64=1;Ni.Bytes=2;Ni.Fixed32=5;var zp=65536*65536,x2=1/zp,pO=12,Dx=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");Ni.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),o=r>>3,u=this.pos;this.type=r&7,t(o,e,this),this.pos===u&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=KA(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=T2(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=KA(this.buf,this.pos)+KA(this.buf,this.pos+4)*zp;return this.pos+=8,t},readSFixed64:function(){var t=KA(this.buf,this.pos)+T2(this.buf,this.pos+4)*zp;return this.pos+=8,t},readFloat:function(){var t=QA.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=QA.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,i,r;return r=e[this.pos++],i=r&127,r<128||(r=e[this.pos++],i|=(r&127)<<7,r<128)||(r=e[this.pos++],i|=(r&127)<<14,r<128)||(r=e[this.pos++],i|=(r&127)<<21,r<128)?i:(r=e[this.pos],i|=(r&15)<<28,gO(i,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=pO&&Dx?MO(this.buf,e,t):IO(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ni.Bytes)return t.push(this.readVarint(e));var i=ya(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ni.Bytes)return t.push(this.readSVarint());var e=ya(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ni.Bytes)return t.push(this.readBoolean());var e=ya(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ni.Bytes)return t.push(this.readFloat());var e=ya(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ni.Bytes)return t.push(this.readDouble());var e=ya(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ni.Bytes)return t.push(this.readFixed32());var e=ya(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ni.Bytes)return t.push(this.readSFixed32());var e=ya(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ni.Bytes)return t.push(this.readFixed64());var e=ya(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ni.Bytes)return t.push(this.readSFixed64());var e=ya(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===Ni.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ni.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ni.Fixed32)this.pos+=4;else if(e===Ni.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),eh(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),eh(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),eh(this.buf,t&-1,this.pos),eh(this.buf,Math.floor(t*x2),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),eh(this.buf,t&-1,this.pos),eh(this.buf,Math.floor(t*x2),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){_O(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=RO(this.buf,t,this.pos);var i=this.pos-e;i>=128&&w2(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),QA.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),QA.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&w2(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Ni.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,bO,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,vO,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,TO,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,xO,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,wO,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,EO,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,SO,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,CO,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,PO,e)},writeBytesField:function(t,e){this.writeTag(t,Ni.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ni.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ni.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ni.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ni.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ni.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ni.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ni.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ni.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ni.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function gO(t,e,i){var r=i.buf,o,u;if(u=r[i.pos++],o=(u&112)>>4,u<128||(u=r[i.pos++],o|=(u&127)<<3,u<128)||(u=r[i.pos++],o|=(u&127)<<10,u<128)||(u=r[i.pos++],o|=(u&127)<<17,u<128)||(u=r[i.pos++],o|=(u&127)<<24,u<128)||(u=r[i.pos++],o|=(u&1)<<31,u<128))return Jc(t,o,e);throw new Error("Expected varint not more than 10 bytes")}function ya(t){return t.type===Ni.Bytes?t.readVarint()+t.pos:t.pos+1}function Jc(t,e,i){return i?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function _O(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),mO(i,r,e),yO(r,e)}function mO(t,e,i){i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos]=t&127}function yO(t,e){var i=(t&7)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function w2(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(r);for(var o=i.pos-1;o>=t;o--)i.buf[o+r]=i.buf[o]}function bO(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function vO(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function xO(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function wO(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function TO(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function EO(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function SO(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function CO(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function PO(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function KA(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function eh(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function T2(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function IO(t,e,i){for(var r="",o=e;o<i;){var u=t[o],_=null,l=u>239?4:u>223?3:u>191?2:1;if(o+l>i)break;var I,R,L;l===1?u<128&&(_=u):l===2?(I=t[o+1],(I&192)===128&&(_=(u&31)<<6|I&63,_<=127&&(_=null))):l===3?(I=t[o+1],R=t[o+2],(I&192)===128&&(R&192)===128&&(_=(u&15)<<12|(I&63)<<6|R&63,(_<=2047||_>=55296&&_<=57343)&&(_=null))):l===4&&(I=t[o+1],R=t[o+2],L=t[o+3],(I&192)===128&&(R&192)===128&&(L&192)===128&&(_=(u&15)<<18|(I&63)<<12|(R&63)<<6|L&63,(_<=65535||_>=1114112)&&(_=null))),_===null?(_=65533,l=1):_>65535&&(_-=65536,r+=String.fromCharCode(_>>>10&1023|55296),_=56320|_&1023),r+=String.fromCharCode(_),o+=l}return r}function MO(t,e,i){return Dx.decode(t.subarray(e,i))}function RO(t,e,i){for(var r=0,o,u;r<e.length;r++){if(o=e.charCodeAt(r),o>55295&&o<57344)if(u)if(o<56320){t[i++]=239,t[i++]=191,t[i++]=189,u=o;continue}else o=u-55296<<10|o-56320|65536,u=null;else{o>56319||r+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):u=o;continue}else u&&(t[i++]=239,t[i++]=191,t[i++]=189,u=null);o<128?t[i++]=o:(o<2048?t[i++]=o>>6|192:(o<65536?t[i++]=o>>12|224:(t[i++]=o>>18|240,t[i++]=o>>12&63|128),t[i++]=o>>6&63|128),t[i++]=o&63|128)}return i}const kO=Jf(dO);function DO(t){return t.toString(16)}const Bx=512,BO=4;function qg(t,e,i){const r=e.type===2?e.readVarint()+e.pos:e.pos+1;return i.value=new t(e.buf.buffer.slice(e.pos,r)),e.pos=r,i.value}class Xg{static read(e,i){return e.readFields(Xg._readField,{key:"",value:null},i)}static _readField(e,i,r){e===1?i.key=r.readString():e===2&&(i.value=r.readString())}}class Zg{static read(e,i){return e.readFields(Zg._readField,{},i)}static _readField(e,i,r){if(e===1){const{key:o,value:u}=Xg.read(r,r.readVarint()+r.pos);i[o]=u}}}class Yg{static read(e,i){return e.readFields(Yg._readField,{value:[]},i)}static _readField(e,i,r){e===1&&qg(Float64Array,r,i)}}class Gg{static read(e,i){return e.readFields(Gg._readField,{key:"",value:null},i)}static _readField(e,i,r){e===1?i.key=r.readString():e===2&&(i.value=Yg.read(r,r.readVarint()+r.pos))}}class Qg{static read(e,i){return e.readFields(Qg._readField,{value:[]},i)}static _readField(e,i,r){e===1&&qg(BigUint64Array,r,i)}}class Kg{static read(e,i){return e.readFields(Kg._readField,{indices:null,properties:[],numericProps:{}},i)}static _readField(e,i,r){if(e===1)i.indices=Qg.read(r,r.readVarint()+r.pos);else if(e===2)i.properties.push(Zg.read(r,r.readVarint()+r.pos));else if(e===3){const o=Gg.read(r,r.readVarint()+r.pos);i.numericProps[o.key]=o.value}}}let FO=class Fx{static read(e,i){return e.readFields(Fx._readField,{scheme:0,cells:null},i)}static _readField(e,i,r){e===1?i.scheme=r.readVarint():e===2&&(i.cells=Kg.read(r,r.readVarint()+r.pos))}};function Ox(t,e){const i=new kO(t);return e.read(i)}function qu(t,e){mi.assert(t,e)}function Lx(t,e){return`https://unpkg.com/@deck.gl/carto@${e}/dist/${t}-worker.js`}const OO=t=>t!==null&&typeof t=="object",LO=t=>OO(t)&&t.constructor==={}.constructor;function NO(t){const{cells:e,scheme:i}=t,r=e.indices.value.length,o=[];for(let u=0;u<r;u++){const _=i==="h3"?DO(e.indices.value[u]):e.indices.value[u],l={...e.properties[u]};for(const I of Object.keys(e.numericProps))l[I]=e.numericProps[I].value[u];o.push({id:_,properties:l})}return o}const Nx="9.0.36",zx="cartoSpatialTile",zO={cartoSpatialTile:{scheme:"quadbin",workerUrl:Lx(zx,Nx)}},UO={name:"CARTO Spatial Tile",version:Nx,id:zx,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(t,e)=>E2(t,e),parseSync:E2,worker:!0,options:zO};function E2(t,e){var _;if(!t)return null;const i=Ox(t,FO),{cells:r}=i,o=(_=e==null?void 0:e.cartoSpatialTile)==null?void 0:_.scheme;return NO({cells:r,scheme:o})}const VO=UO;function jO(t,e){var i,r,o;(r=(i=t==null?void 0:t.fetch)==null?void 0:i.headers)!=null&&r.Authorization||(t.fetch={...t.fetch,headers:{...(o=t.fetch)==null?void 0:o.headers,Authorization:`Bearer ${e}`}})}const $O={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="object"&&Array.isArray(t.tiles)&&t.tiles.every(i=>typeof i=="string"),equal:(t,e)=>Wn(t,e,2),async:!0},S2=85.051128;function WO({west:t,north:e,east:i,south:r},o){const l=[[e,i],[r,i],[r,t],[e,t]].map(L=>$g(L[0],L[1],o)).map(L=>Math.max(...rO(L).map(z=>nO(z,bh.rads)))*180/Math.PI),I=Math.max(...l),R=Math.min(180,I/Math.cos((e+r)/2*Math.PI/180));return{north:Math.min(e+I,S2),east:i+R,south:Math.max(r-I,-S2),west:t-R}}function Ux({west:t,north:e,east:i,south:r},o){const u=Math.abs(i-t);if(u>180){const l=Math.ceil(u/180);let I=[];for(let R=0;R<l;R++){const L=t+R*180,z=Math.min(L+179.9999999,i);I=I.concat(Ux({west:L,north:e,east:z,south:r},o))}return[...new Set(I)]}return iO([[e,i],[r,i],[r,t],[e,t],[e,i]],o)}function HO(t){const e=Ix(t),i=e.map(I=>I[0]),r=e.map(I=>I[1]),o=Math.min(...r),u=Math.min(...i),_=Math.max(...r),l=Math.max(...i);return{west:o,south:u,east:_,north:l}}const qO=2;function Up(t,e){const i=Math.log2(e/512),r=2/3*(t.zoom-i),o=Math.log(1/Math.cos(Math.PI*t.latitude/180));return Math.max(0,Math.floor(r+o-qO))}class XO extends gx{getTileIndices({viewport:e,minZoom:i,maxZoom:r}){if(e.latitude===void 0)return[];const[o,u,_,l]=e.getBounds(),{tileSize:I}=this.opts;let R=Up(e,I),L;if(typeof i=="number"&&Number.isFinite(i)&&R<i)return[];if(typeof r=="number"&&Number.isFinite(r)&&R>r){R=r;const z=$g(e.latitude,e.longitude,r);L=tO(z,1)}else{const z=WO({west:o,north:l,east:_,south:u},R);L=Ux(z,R)}return L.map(z=>({i:z}))}getTileId({i:e}){return e}getTileMetadata({i:e}){return{bbox:HO(e)}}getTileZoom({i:e}){return Np(e)}getParentIndex(e){const i=Np(e.i);return{i:eO(e.i,i-1)}}}const ZO={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:BigUint64Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class Jg{static read(e,i){return e.readFields(Jg._readField,{name:"",type:"",data:null},i)}static _readField(e,i,r){if(e===1)i.name=r.readString();else if(e===2)i.type=r.readString();else if(e===3){const o=ZO[i.type];if(!o)throw Error(`Invalid data type: ${i.type}`);i.data={},qg(o,r,i.data)}}}class e_{static read(e,i){return e.readFields(e_._readField,{blockSize:0,bands:[]},i)}static _readField(e,i,r){e===1?i.blockSize=r.readVarint():e===2&&i.bands.push(Jg.read(r,r.readVarint()+r.pos))}}const Vx="9.0.36",jx="cartoRasterTile",YO={cartoRasterTile:{workerUrl:Lx(jx,Vx)}},GO={name:"CARTO Raster Tile",version:Vx,id:jx,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-raster-tile"],category:"geometry",parse:async(t,e)=>C2(t),parseSync:C2,worker:!0,options:YO};function C2(t,e){if(!t)return null;const{bands:i,blockSize:r}=Ox(t,e_),o={};for(let u=0;u<i.length;u++){const{name:_,data:l}=i[u];o[_]=l}return{blockSize:r,cells:{numericProps:o,properties:[]}}}const QO=GO;q2([QO,VO]);function KO(t){return t!=null&&t!==""}const JO={tileSize:Bx};class t_ extends SF{_updateAutoHighlight(e){const{hoveredFeatureId:i}=this.state,r=e.object;let o=null;if(r&&(o=r.id),i!==o){let{highlightColor:u}=this.props;typeof u=="function"&&(u=u(e)),this.setState({highlightColor:u,hoveredFeatureId:o})}}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:i}=this.state,r=e.content;return!KO(i)||!Array.isArray(r)||!this._featureInTile(e,i)?-1:r.findIndex(u=>u.id===i)}_featureInTile(e,i){const r=this.state.tileset,o=r.getTileZoom(e.index),u=e.index.q?"q":"i";let _={[u]:i},l=r.getTileZoom(_);for(;!(l<=o);)_=r.getParentIndex(_),l=r.getTileZoom(_);return _[u]===e.index[u]}}t_.layerName="SpatialIndexTileLayer";t_.defaultProps=JO;const eL=t_,tL=t=>{const{data:e}=t,{index:i}=t.tile;return!e||!e.length?null:new kx(t,{getHexagon:r=>r.id,centerHexagon:i,highPrecision:!0})},iL={data:$O,tileSize:Bx};class i_ extends Bh{initializeState(){kx._checkH3Lib()}getLoadOptions(){const e=super.getLoadOptions()||{},i=this.props.data;return jO(e,i.accessToken),e.cartoSpatialTile={...e.cartoSpatialTile,scheme:"h3"},e}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:i}=e;let{minresolution:r,maxresolution:o}=e;this.props.minZoom&&(r=Math.max(r,Up({zoom:this.props.minZoom,latitude:0},this.props.tileSize))),this.props.maxZoom&&(o=Math.min(o,Up({zoom:this.props.maxZoom,latitude:0},this.props.tileSize)));const u=this.getSubLayerClass("spatial-index-tile",eL);return new u(this.props,{id:`h3-tile-layer-${this.props.id}`,data:i,TilesetClass:XO,renderSubLayers:tL,minZoom:r,maxZoom:o,loadOptions:this.getLoadOptions()})}}i_.layerName="H3TileLayer";i_.defaultProps=iL;const rL=i_;class sL extends Error{constructor(e,i,r,o){let u="Failed to connect";r&&(u="Server returned: ",r.status===400?u+="Bad request":r.status===401||r.status===403?u+="Unauthorized access":r.status===404?u+="Not found":u+="Error",u+=` (${r.status}):`),u+=` ${e.message||e}`;let _=`${i.requestType} API request failed`;_+=`
${u}`;for(const l of Object.keys(i))l!=="requestType"&&(_+=`
${nL(l)}: ${i[l]}`);_+=`
`,super(_),this.name="CartoAPIError",this.response=r,this.responseJson=o,this.error=e,this.errorContext=i}}function nL(t){return t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}const oL="https://basemaps.cartocdn.com/gl/{basemap}-gl-style/style.json";function th(t){return oL.replace("{basemap}",t)}const aL={VOYAGER:th("voyager"),POSITRON:th("positron"),DARK_MATTER:th("dark-matter"),VOYAGER_NOLABELS:th("voyager-nolabels"),POSITRON_NOLABELS:th("positron-nolabels"),DARK_MATTER_NOLABELS:th("dark-matter-nolabels")};function hf(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function lL(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function $x(t){let e,i,r;t.length!==2?(e=hf,i=(l,I)=>hf(t(l),I),r=(l,I)=>t(l)-I):(e=t===hf||t===lL?t:cL,i=t,r=t);function o(l,I,R=0,L=l.length){if(R<L){if(e(I,I)!==0)return L;do{const z=R+L>>>1;i(l[z],I)<0?R=z+1:L=z}while(R<L)}return R}function u(l,I,R=0,L=l.length){if(R<L){if(e(I,I)!==0)return L;do{const z=R+L>>>1;i(l[z],I)<=0?R=z+1:L=z}while(R<L)}return R}function _(l,I,R=0,L=l.length){const z=o(l,I,R,L-1);return z>R&&r(l[z-1],I)>-r(l[z],I)?z-1:z}return{left:o,center:_,right:u}}function cL(){return 0}function hL(t){return t===null?NaN:+t}const uL=$x(hf),AL=uL.right;$x(hL).center;const fL=AL;function dL(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Wx(){var t=[.5],e=[0,1],i,r=1;function o(u){return u!=null&&u<=u?e[fL(t,u,0,r)]:i}return o.domain=function(u){return arguments.length?(t=Array.from(u),r=Math.min(t.length,e.length-1),o):t.slice()},o.range=function(u){return arguments.length?(e=Array.from(u),r=Math.min(t.length,e.length-1),o):e.slice()},o.invertExtent=function(u){var _=e.indexOf(u);return[t[_-1],t[_]]},o.unknown=function(u){return arguments.length?(i=u,o):i},o.copy=function(){return Wx().domain(t).range(e).unknown(i)},dL.apply(o,arguments)}var xi={schemeGroups:{sequential:["BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","YlGnBu","YlOrBr","YlOrRd"],singlehue:["Blues","Greens","Greys","Oranges","Purples","Reds"],diverging:["BrBG","PiYG","PRGn","PuOr","RdBu","RdGy","RdYlBu","RdYlGn","Spectral"],qualitative:["Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3"]},YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},pL={2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},gL={2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},_L={2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},mL={2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},yL={2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},bL={2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},vL={2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},xL={2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},wL={2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},TL={2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},EL={2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},SL={2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},CL={2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},PL={2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},IL={2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},ML={2:["#f9ddda","#573b88"],3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},RL={2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},kL={2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},DL={2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},BL={2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},FL={2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},OL={2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},LL={2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},NL={2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},zL={2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},UL={2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},VL={2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},jL={2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},$L={2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},WL={2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},HL={2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},qL={2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},XL={2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},ZL={2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]},YL={...xi.BuGn,tags:["quantitative"]},GL={...xi.BuPu,tags:["quantitative"]},QL={...xi.GnBu,tags:["quantitative"]},KL={...xi.OrRd,tags:["quantitative"]},JL={...xi.PuBu,tags:["quantitative"]},eN={...xi.PuBuGn,tags:["quantitative"]},tN={...xi.PuRd,tags:["quantitative"]},iN={...xi.RdPu,tags:["quantitative"]},rN={...xi.YlGn,tags:["quantitative"]},sN={...xi.YlGnBu,tags:["quantitative"]},nN={...xi.YlOrBr,tags:["quantitative"]},oN={...xi.YlOrRd,tags:["quantitative"]},aN={...xi.Accent,tags:["qualitative"]},lN={...xi.Dark2,tags:["qualitative"]},cN={...xi.Paired,tags:["qualitative"]},hN={...xi.Pastel1,tags:["qualitative"]},uN={...xi.Pastel2,tags:["qualitative"]},AN={...xi.Set1,tags:["qualitative"]},fN={...xi.Set2,tags:["qualitative"]},dN={...xi.Set3,tags:["qualitative"]},pN={...xi.Blues,tags:["quantitative"]},gN={...xi.Greens,tags:["quantitative"]},_N={...xi.Greys,tags:["quantitative"]},mN={...xi.Oranges,tags:["quantitative"]},yN={...xi.Purples,tags:["quantitative"]},bN={...xi.Reds,tags:["quantitative"]},vN={...xi.BrBG,tags:["diverging"]},xN={...xi.PiYG,tags:["diverging"]},wN={...xi.PRGn,tags:["diverging"]},TN={...xi.PuOr,tags:["diverging"]},EN={...xi.RdBu,tags:["diverging"]},SN={...xi.RdGy,tags:["diverging"]},CN={...xi.RdYlBu,tags:["diverging"]},PN={...xi.RdYlGn,tags:["diverging"]},IN={...xi.Spectral,tags:["diverging"]};const MN=Object.freeze(Object.defineProperty({__proto__:null,Antique:$L,ArmyRose:OL,BluGrn:xL,BluYl:SL,Bold:WL,BrwnYl:FL,Burg:pL,BurgYl:gL,DarkMint:wL,Earth:jL,Emrld:TL,Fall:LL,Geyser:NL,Magenta:kL,Mint:vL,OrYel:mL,Pastel:HL,Peach:yL,PinkYl:bL,Prism:qL,Purp:IL,PurpOr:ML,RedOr:_L,Safe:XL,Sunset:RL,SunsetDark:DL,Teal:CL,TealGrn:PL,TealRose:UL,Temps:zL,Tropic:VL,Vivid:ZL,ag_GrnYl:EL,ag_Sunset:BL,cb_Accent:aN,cb_Blues:pN,cb_BrBG:vN,cb_BuGn:YL,cb_BuPu:GL,cb_Dark2:lN,cb_GnBu:QL,cb_Greens:gN,cb_Greys:_N,cb_OrRd:KL,cb_Oranges:mN,cb_PRGn:wN,cb_Paired:cN,cb_Pastel1:hN,cb_Pastel2:uN,cb_PiYG:xN,cb_PuBu:JL,cb_PuBuGn:eN,cb_PuOr:TN,cb_PuRd:tN,cb_Purples:yN,cb_RdBu:EN,cb_RdGy:SN,cb_RdPu:iN,cb_RdYlBu:CN,cb_RdYlGn:PN,cb_Reds:bN,cb_Set1:AN,cb_Set2:fN,cb_Set3:dN,cb_Spectral:IN,cb_YlGn:rN,cb_YlGnBu:sN,cb_YlOrBr:nN,cb_YlOrRd:oN},Symbol.toStringTag,{value:"Module"})),RN="PurpOr",kN=[204,204,204];function DN(t,e){const i=MN[t];let r=e;qu(i,`Palette "${t}" not found. Expected a CARTOColors string`);const o=Object.keys(i).filter(I=>I!=="tags").map(Number),u=Math.max(...o),_=Math.min(...o);!Number.isInteger(e)||e>u?r=u:e<_&&(r=_);let l=i[r];return i.tags&&i.tags.includes("qualitative")&&(l=l.slice(0,-1)),l.map(I=>BN(I))}function BN(t){let e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(t);return e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),255]:(e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(t),e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),parseInt(e[4]+e[4],16)]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),255]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),qu(e,`Hexadecimal color "${t}" was not parsed correctly`),[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),parseInt(e[4],16)])))}const FN=Object.freeze(["function","string"]);function ON(t,e,i){var r;return qu(typeof e=="object",'Expected "data" to be an object'),qu(FN.includes(typeof t),'Expected "attr" to be a function or string'),typeof t=="function"?t(e,i):(r=e==null?void 0:e.properties)==null?void 0:r[t]}function LN({attr:t,domain:e,colors:i=RN,nullColor:r=kN}){qu(Array.isArray(e),'Expected "domain" to be an array of numbers');const o=typeof i=="string"?DN(i,e.length+1):i,u=Wx().domain(e).range(o);return(_,l)=>{const I=ON(t,_,l);return typeof I=="number"&&Number.isFinite(I)?u(I):r}}const NN="https://gcp-us-east1.api.carto.com",zN="deck-gl-carto",UN="3.4",Hx=7e3;function VN(...t){return t.map(e=>e.endsWith("/")?e.slice(0,-1):e).join("/")}function jN(t,e,i,...r){return VN(t,e,i,...r)}function $N({apiBaseUrl:t,connectionName:e,endpoint:i}){return jN(t,"v3","maps",e,i)}const WN={v:UN,deckglVersion:tb},HN={Accept:"application/json","Content-Type":"application/json"},JA=new Map;async function V0({baseUrl:t,parameters:e={},headers:i={},errorContext:r,maxLengthURL:o=Hx}){e={...WN,...e},t=ZN(t,Object.keys(e));const u=qN(t,e,i);if(JA.has(u))return JA.get(u);const _=XN(t,e),l={...HN,...i},I=_.length>o?fetch(t,{method:"POST",body:JSON.stringify(e),headers:l}):fetch(_,{headers:l});let R,L;const z=I.then(V=>(R=V,R.json())).then(V=>{if(L=V,!R||!R.ok)throw new Error(V.error);return V}).catch(V=>{throw JA.delete(u),new sL(V,r,R,L)});return JA.set(u,z),z}function qN(t,e,i){const r=Object.entries(e).sort(([u],[_])=>u>_?1:-1),o=Object.entries(i).sort(([u],[_])=>u>_?1:-1);return JSON.stringify({baseUrl:t,parameters:r,headers:o})}function XN(t,e){const i=new URL(t);for(const[r,o]of Object.entries(e))LO(o)||Array.isArray(o)?i.searchParams.set(r,JSON.stringify(o)):i.searchParams.set(r,o.toString());return i.toString()}function ZN(t,e){const i=new URL(t);for(const r of e)i.searchParams.has(r)&&i.searchParams.delete(r);return i.toString()}const YN={apiBaseUrl:NN,clientId:zN,format:"tilejson",headers:{},maxLengthURL:Hx};async function GN(t,e,i){const{accessToken:r,connectionName:o,cache:u,..._}=e,l={...YN,accessToken:r,connectionName:o,endpoint:t};for(const Ce in _)_[Ce]&&(l[Ce]=_[Ce]);const I=$N(l),{clientId:R,maxLengthURL:L,format:z}=l,V={Authorization:`Bearer ${e.accessToken}`,...e.headers},q={client:R,...i},ne={requestType:"Map instantiation",connection:e.connectionName,type:t,source:JSON.stringify(q,void 0,2)},Ee=(await V0({baseUrl:I,parameters:q,headers:V,errorContext:ne,maxLengthURL:L}))[z].url[0];if(u&&(u.value=parseInt(new URL(Ee).searchParams.get("cache")||"",10)),ne.requestType="Map data",z==="tilejson"){const Ce=await V0({baseUrl:Ee,headers:V,errorContext:ne,maxLengthURL:L});return r&&(Ce.accessToken=r),Ce}return await V0({baseUrl:Ee,headers:V,errorContext:ne,maxLengthURL:L})}const QN=async function(t){const{aggregationExp:e,aggregationResLevel:i=BO,sqlQuery:r,spatialDataColumn:o="h3",queryParameters:u,filters:_}=t,l={aggregationExp:e,spatialDataColumn:o,spatialDataType:"h3",q:r};return i&&(l.aggregationResLevel=String(i)),u&&(l.queryParameters=u),_&&(l.filters=_),GN("query",t,l)};async function KN(){const t=document.getElementById("variable"),i=(await JN()).filter(r=>r.db_type==="FLOAT").map(r=>`<option value="${r.column_name}" data-agg-method="${r.agg_method}">${r.name}</option>`);t.innerHTML=i.join("")}async function JN(){return(await fetch("https://public.carto.com/api/v4/data/observatory/metadata/datasets/cdb_spatial_fea_94e6b1f/variables?minimal=false")).json()}const e7={apiBaseUrl:"https://gcp-us-east1.api.carto.com",accessToken:"eyJhbGciOiJIUzI1NiJ9.eyJhIjoiYWNfbHFlM3p3Z3UiLCJqdGkiOiJkOTU4OWMyZiJ9.78MdzU2J6y-J6Far71_Mh7IQO9eYIZD9nECUiZJAVL4",connectionName:"carto_dw"},t7={latitude:40.7128,longitude:-74.006,zoom:7,pitch:0,bearing:0,minZoom:3.5,maxZoom:15};let Lf="population",Xu=`SUM(${Lf})`;const gu=document.getElementById("variable"),qx=document.getElementById("agg-method");qx.innerText=Xu;gu==null||gu.addEventListener("change",()=>{const t=gu.selectedOptions[0].dataset.aggMethod||"SUM";Lf=gu.value,Xu=`${t}(${Lf})`,qx.innerText=Xu,Xx()});function Xx(){const t=QN({...e7,aggregationExp:`${Xu}as value`,sqlQuery:"SELECT * FROM cartobq.public_account.derived_spatialfeatures_usa_h3int_res8_v1_yearly_v2"}),e=[new rL({id:"h3_layer",data:t,opacity:.8,pickable:!0,extruded:!1,getFillColor:LN({attr:"value",domain:[0,100,1e3,1e4,1e5,1e6],colors:"PinkYl"}),lineWidthMinPixels:.5,getLineWidth:.5,getLineColor:[255,255,255,100]})];Zx.setProps({layers:e,getTooltip:({object:i})=>i&&{html:`Hex ID: ${i.id}</br>
        ${Lf.toUpperCase()}: ${parseInt(i.properties.value)}</br>
        Aggregation Expression: ${Xu}`}})}const i7=new ZT.Map({container:"map",style:aL.DARK_MATTER,interactive:!1}),Zx=new yk({canvas:"deck-canvas",initialViewState:t7,controller:!0});Zx.setProps({onViewStateChange:({viewState:t})=>{const{longitude:e,latitude:i,...r}=t;i7.jumpTo({center:[e,i],...r})}});KN();Xx();
